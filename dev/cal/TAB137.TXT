OBJECT Table 137 Inc. Doc. Attachment Overview
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.00;
  }
  PROPERTIES
  {
    OnDelete=VAR
               IncomingDocumentAttachment@1000 : Record 133;
             BEGIN
               IF IncomingDocumentAttachment.GET("Incoming Document Entry No.","Line No.") THEN
                 IncomingDocumentAttachment.DELETE(TRUE);
             END;

    CaptionML=[ENU=Inc. Doc. Attachment Overview;
               NOR=Oversikt over vedlegg for inng. dok.;
               SVE=™versikt ”ver ink. dok.bilaga];
  }
  FIELDS
  {
    { 1   ;   ;Incoming Document Entry No.;Integer;TableRelation="Incoming Document";
                                                   CaptionML=[ENU=Incoming Document Entry No.;
                                                              NOR=L›penummer for inng†ende dokument;
                                                              SVE=L”pnr f”r inkommande dokument] }
    { 2   ;   ;Line No.            ;Integer       ;InitValue=0;
                                                   CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 3   ;   ;Created Date-Time   ;DateTime      ;CaptionML=[ENU=Created Date-Time;
                                                              NOR=Opprettelsesdato og -klokkeslett;
                                                              SVE=Skapat datum/tid] }
    { 4   ;   ;Created By User Name;Code50        ;DataClassification=EndUserIdentifiableInformation;
                                                   CaptionML=[ENU=Created By User Name;
                                                              NOR=Opprettet av brukernavn;
                                                              SVE=Skapat av anv„ndarnamn] }
    { 5   ;   ;Name                ;Text250       ;CaptionML=[ENU=Name;
                                                              NOR=Navn;
                                                              SVE=Namn];
                                                   Editable=No }
    { 6   ;   ;Type                ;Option        ;CaptionML=[ENU=Type;
                                                              NOR=Type;
                                                              SVE=Typ];
                                                   OptionCaptionML=[ENU=" ,Image,PDF,Word,Excel,PowerPoint,Email,XML,Other";
                                                                    NOR=" ,Bilde,PDF,Word,Excel,PowerPoint,E-post,XML,Annet";
                                                                    SVE=" ,Bild,PDF,Word,Excel,PowerPoint,E-post,XML,Annat"];
                                                   OptionString=[ ,Image,PDF,Word,Excel,PowerPoint,Email,XML,Other];
                                                   Editable=No }
    { 7   ;   ;File Extension      ;Text30        ;CaptionML=[ENU=File Extension;
                                                              NOR=Filtype;
                                                              SVE=Fil„ndelse];
                                                   Editable=No }
    { 100 ;   ;Attachment Type     ;Option        ;CaptionML=[ENU=Attachment Type;
                                                              NOR=Vedleggstype;
                                                              SVE=Bilagetyp];
                                                   OptionCaptionML=[ENU=,Group,Main Attachment,OCR Result,Supporting Attachment,Link;
                                                                    NOR=,Gruppe,Hovedvedlegg,OCR-resultat,St›ttevedlegg,Kobling;
                                                                    SVE=,Grupp,Huvudbilaga,OCR-resultat,St”dbilaga,L„nk];
                                                   OptionString=,Group,Main Attachment,OCR Result,Supporting Attachment,Link;
                                                   Editable=No }
    { 101 ;   ;Sorting Order       ;Integer       ;CaptionML=[ENU=Sorting Order;
                                                              NOR=Sorteringsrekkef›lge;
                                                              SVE=Sorteringsordning] }
    { 102 ;   ;Indentation         ;Integer       ;CaptionML=[ENU=Indentation;
                                                              NOR=Innrykking;
                                                              SVE=Indrag] }
  }
  KEYS
  {
    {    ;Sorting Order,Incoming Document Entry No.;
                                                   Clustered=Yes }
  }
  FIELDGROUPS
  {
    { 1   ;Brick               ;Created Date-Time,Name,File Extension    }
  }
  CODE
  {
    VAR
      SupportingAttachmentsTxt@1000 : TextConst 'ENU=Supporting Attachments;NOR=St›ttevedlegg;SVE=St”dbilagor';
      NotAvailableAttachmentMsg@1001 : TextConst 'ENU=The attachment is no longer available.;NOR=Vedlegget er ikke lenger tilgjengelig.;SVE=Bilagan „r inte l„ngre tillg„nglig.';
      ClientTypeManagement@1077 : Codeunit 4030;

    [Internal]
    PROCEDURE NameDrillDown@13();
    VAR
      IncomingDocument@1001 : Record 130;
      IncomingDocumentAttachment@1000 : Record 133;
    BEGIN
      CASE "Attachment Type" OF
        "Attachment Type"::Group:
          EXIT;
        "Attachment Type"::Link:
          BEGIN
            IncomingDocument.GET("Incoming Document Entry No.");
            HYPERLINK(IncomingDocument.GetURL);
          END
        ELSE BEGIN
          IF NOT IncomingDocumentAttachment.GET("Incoming Document Entry No.","Line No.") THEN
            MESSAGE(NotAvailableAttachmentMsg)
          ELSE
            IF (Type = Type::Image) AND (ClientTypeManagement.GetCurrentClientType = CLIENTTYPE::Phone) THEN
              PAGE.RUN(PAGE::"O365 Incoming Doc. Att. Pict.",IncomingDocumentAttachment)
            ELSE
              IncomingDocumentAttachment.Export(Name + '.' + "File Extension",TRUE);
        END
      END;
    END;

    [External]
    PROCEDURE GetStyleTxt@4() : Text;
    BEGIN
      CASE "Attachment Type" OF
        "Attachment Type"::Group,
        "Attachment Type"::"Main Attachment",
        "Attachment Type"::Link:
          EXIT('Strong');
        ELSE
          EXIT('Standard');
      END;
    END;

    [External]
    PROCEDURE InsertFromIncomingDocument@2(IncomingDocument@1000 : Record 130;VAR TempIncDocAttachmentOverview@1003 : TEMPORARY Record 137);
    VAR
      SortingOrder@1004 : Integer;
    BEGIN
      InsertMainAttachment(IncomingDocument,TempIncDocAttachmentOverview,SortingOrder);
      InsertLinkAddress(IncomingDocument,TempIncDocAttachmentOverview,SortingOrder);
      InsertSupportingAttachments(
        IncomingDocument,TempIncDocAttachmentOverview,SortingOrder,
        IncomingDocument."Document Type" <> IncomingDocument."Document Type"::"Sales Invoice");
    END;

    [External]
    PROCEDURE InsertSupportingAttachmentsFromIncomingDocument@1(IncomingDocument@1001 : Record 130;VAR TempIncDocAttachmentOverview@1000 : TEMPORARY Record 137);
    VAR
      SortingOrder@1002 : Integer;
    BEGIN
      InsertSupportingAttachments(IncomingDocument,TempIncDocAttachmentOverview,SortingOrder,FALSE);
    END;

    LOCAL PROCEDURE InsertMainAttachment@3(IncomingDocument@1000 : Record 130;VAR TempIncDocAttachmentOverview@1001 : TEMPORARY Record 137;VAR SortingOrder@1002 : Integer);
    VAR
      IncomingDocumentAttachment@1003 : Record 133;
    BEGIN
      IF NOT IncomingDocument.GetMainAttachment(IncomingDocumentAttachment) THEN
        EXIT;

      IF IncomingDocument."Document Type" = IncomingDocument."Document Type"::"Sales Invoice" THEN
        InsertFromIncomingDocumentAttachment(
          TempIncDocAttachmentOverview,IncomingDocumentAttachment,SortingOrder,
          TempIncDocAttachmentOverview."Attachment Type"::"Supporting Attachment",0)
      ELSE
        InsertFromIncomingDocumentAttachment(
          TempIncDocAttachmentOverview,IncomingDocumentAttachment,SortingOrder,
          TempIncDocAttachmentOverview."Attachment Type"::"Main Attachment",0);
    END;

    LOCAL PROCEDURE InsertSupportingAttachments@6(IncomingDocument@1000 : Record 130;VAR TempIncDocAttachmentOverview@1001 : TEMPORARY Record 137;VAR SortingOrder@1002 : Integer;IncludeGroupCaption@1004 : Boolean);
    VAR
      IncomingDocumentAttachment@1003 : Record 133;
      Indentation2@1005 : Integer;
    BEGIN
      IF NOT IncomingDocument.GetAdditionalAttachments(IncomingDocumentAttachment) THEN
        EXIT;

      IF IncludeGroupCaption THEN
        InsertGroup(TempIncDocAttachmentOverview,IncomingDocument,SortingOrder,SupportingAttachmentsTxt);
      IF IncomingDocument."Document Type" = IncomingDocument."Document Type"::"Sales Invoice" THEN
        Indentation2 := 0
      ELSE
        Indentation2 := 1;
      REPEAT
        InsertFromIncomingDocumentAttachment(
          TempIncDocAttachmentOverview,IncomingDocumentAttachment,SortingOrder,
          TempIncDocAttachmentOverview."Attachment Type"::"Supporting Attachment",Indentation2);
      UNTIL IncomingDocumentAttachment.NEXT = 0;
    END;

    LOCAL PROCEDURE InsertLinkAddress@8(IncomingDocument@1003 : Record 130;VAR TempIncDocAttachmentOverview@1000 : TEMPORARY Record 137;VAR SortingOrder@1002 : Integer);
    VAR
      URL@1001 : Text;
    BEGIN
      URL := IncomingDocument.GetURL;
      IF URL = '' THEN
        EXIT;

      CLEAR(TempIncDocAttachmentOverview);
      TempIncDocAttachmentOverview.INIT;
      TempIncDocAttachmentOverview."Incoming Document Entry No." := IncomingDocument."Entry No.";
      AssignSortingNo(TempIncDocAttachmentOverview,SortingOrder);
      TempIncDocAttachmentOverview.Name := COPYSTR(URL,1,MAXSTRLEN(TempIncDocAttachmentOverview.Name));
      TempIncDocAttachmentOverview."Attachment Type" := TempIncDocAttachmentOverview."Attachment Type"::Link;
      TempIncDocAttachmentOverview.INSERT(TRUE);
    END;

    LOCAL PROCEDURE InsertFromIncomingDocumentAttachment@7(VAR TempIncDocAttachmentOverview@1001 : TEMPORARY Record 137;IncomingDocumentAttachment@1000 : Record 133;VAR SortingOrder@1002 : Integer;AttachmentType@1003 : Option;Indentation2@1004 : Integer);
    BEGIN
      CLEAR(TempIncDocAttachmentOverview);
      TempIncDocAttachmentOverview.INIT;
      TempIncDocAttachmentOverview.TRANSFERFIELDS(IncomingDocumentAttachment);
      AssignSortingNo(TempIncDocAttachmentOverview,SortingOrder);
      TempIncDocAttachmentOverview."Attachment Type" := AttachmentType;
      TempIncDocAttachmentOverview.Indentation := Indentation2;
      TempIncDocAttachmentOverview.INSERT(TRUE);
    END;

    LOCAL PROCEDURE InsertGroup@10(VAR TempIncDocAttachmentOverview@1001 : TEMPORARY Record 137;IncomingDocument@1000 : Record 130;VAR SortingOrder@1002 : Integer;Description@1003 : Text[50]);
    BEGIN
      CLEAR(TempIncDocAttachmentOverview);
      TempIncDocAttachmentOverview.INIT;
      TempIncDocAttachmentOverview."Incoming Document Entry No." := IncomingDocument."Entry No.";
      AssignSortingNo(TempIncDocAttachmentOverview,SortingOrder);
      TempIncDocAttachmentOverview."Attachment Type" := TempIncDocAttachmentOverview."Attachment Type"::Group;
      TempIncDocAttachmentOverview.Type := Type::" ";
      TempIncDocAttachmentOverview.Name := Description;
      TempIncDocAttachmentOverview.INSERT(TRUE);
    END;

    LOCAL PROCEDURE AssignSortingNo@5(VAR TempIncDocAttachmentOverview@1000 : TEMPORARY Record 137;VAR SortingOrder@1001 : Integer);
    BEGIN
      SortingOrder += 1;
      TempIncDocAttachmentOverview."Sorting Order" := SortingOrder;
    END;

    BEGIN
    END.
  }
}

