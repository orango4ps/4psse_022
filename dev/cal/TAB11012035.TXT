OBJECT Table 11012035 Prognosis Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    Permissions=TableData 11072003=rm;
    DataCaptionFields=Project No.,Prognosis Date;
    OnInsert=BEGIN
               //>> 151022 ITERO.SB RFC-010
               IF PrognosisRec.GET("Project No.", "Prognosis Date") THEN
                 PrognosisRec.CheckProjectPreclosure();
               //<<

               ProjRec.GET("Project No.");
               "Main Project No." := ProjRec."Main Project";
               UpdateCostControlStatus(UpdateAction::Insert);

               //DP00042.sn
               CASE "Cost Type" OF
                 "Cost Type"::Labor: UpdatePrognosisSpecification(0, Quantity, 0, Rate, 0, Amount);  //C034480
               ELSE
                 UpdatePrognosisSpecification(0, Quantity, 0, Price, 0, Amount);  //C034480
               END;
               //DP00042.en
               MakeTemporaryUsedFieldsEmpty;
             END;

    OnModify=BEGIN
               //** Call C010346.sn
               IF PrognosisRec.GET("Project No.", "Prognosis Date") THEN
                 PrognosisRec.TESTFIELD(Fixed,FALSE);

               //>> 151022 ITERO.SB RFC-010
               IF PrognosisRec.GET("Project No.", "Prognosis Date") THEN
                 PrognosisRec.CheckProjectPreclosure();
               //<<

               //** Call C010346.en
               UpdateCostControlStatus(UpdateAction::Modify);
               PrognosisRec.UpdateLogBook("Project No.", "Prognosis Date"); //mg, 10-12-10: M24403

               //DP00042.sn
               CASE "Cost Type" OF
                 "Cost Type"::Labor: UpdatePrognosisSpecification(xRec.Quantity, Quantity, xRec.Rate, Rate, xRec.Amount, Amount);  //C034480
               ELSE
                 UpdatePrognosisSpecification(xRec.Quantity, Quantity, xRec.Price, Price, xRec.Amount, Amount);  //C034480
               END;
               //DP00042.en
               MakeTemporaryUsedFieldsEmpty;
             END;

    OnDelete=VAR
               PrognosisLineSpec@1210190000 : Record 11020687;
             BEGIN
               //db.sn, 04-01-11: M24105
               IF NOT DeleteControlOnProg THEN BEGIN  //**4PS, SR C011681 17-01-14
                 IF PrognosisRec.GET("Project No.", "Prognosis Date") THEN
                   PrognosisRec.TESTFIELD(Fixed,FALSE);
                 //>> 151022 ITERO.SB RFC-010
                 PrognosisRec.CheckProjectPreclosure();
                 //<<
                 UpdateCostControlStatus(UpdateAction::Delete);//**4PS, SR C013794 10-03-14
                 PrognosisRec.UpdateLogBook("Project No.", "Prognosis Date"); //mg, 10-12-10: M24403
               END;
               //IF PrognosisRec.Fixed THEN
               //  ERROR(Text000);
               //db.en, 04-01-11: M24105
               //DP00042.sn  (Note: Also delete if project setup "Prognosis Specifications" is 'No', if present then delete)
               PrognosisLineSpec.SETRANGE("Project No.", "Project No.");
               PrognosisLineSpec.SETRANGE("Prognosis Date", "Prognosis Date");
               IF Element = '' THEN  //db, 15-11-11
                 PrognosisLineSpec.SETFILTER(Element, '%1', '')
               ELSE
                 PrognosisLineSpec.SETRANGE(Element, Element);
               PrognosisLineSpec.SETRANGE("Cost Type", "Cost Type");
               PrognosisLineSpec.SETRANGE("Cost Object", "Cost Object");
               PrognosisLineSpec.DELETEALL;
               //DP00042.en
             END;

    OnRename=BEGIN
               MakeTemporaryUsedFieldsEmpty;
             END;

    CaptionML=[ENU=Prognosis Line;
               NOR=Prognoserad;
               SVE=Prognosrad];
    DrillDownPageID=Page11012088;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 20  ;   ;Prognosis Date      ;Date          ;OnValidate=BEGIN
                                                                //C017374.so
                                                                //PrevPrognDateFilter := '<'+FORMAT("Prognosis Date");
                                                                ////**Call 19910 Exact filter for previous prognosis wanted.
                                                                //IF lPrognosisRec.GET("Project No.", "Prognosis Date") THEN BEGIN
                                                                //  lPrognosisRec.RESET;
                                                                //  lPrognosisRec.SETRANGE("Project No.", "Project No.");
                                                                //  lPrognosisRec.SETFILTER("Prognosis Date", '<%1', "Prognosis Date");
                                                                //  IF lPrognosisRec.FINDLAST THEN BEGIN
                                                                //    PrevPrognDateFilter := FORMAT(lPrognosisRec."Prognosis Date");
                                                                //  END;
                                                                //END;
                                                                //C017374.eo
                                                              END;

                                                   CaptionML=[ENU=Prognosis Date;
                                                              NOR=Prognosedato;
                                                              SVE=Prognosdatum] }
    { 30  ;   ;Cost Type           ;Option        ;CaptionML=[ENU=Cost Type;
                                                              NOR=Kosttype;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=Labor,Material,Subcontracting,Plant,Sundry,Revenue;
                                                                    NOR=Arbeidskraft,Materiale,Underentrepenõr,Maskin,Diverse,Inntekt;
                                                                    SVE=Arbetskraft,Material,Underentreprenad,Maskin,Diverse,IntÑkt];
                                                   OptionString=Labor,Material,Subcontracting,Plant,Sundry,Revenue;
                                                   Editable=No }
    { 40  ;   ;Cost Object         ;Code20        ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2),
                                                                                               Project Filter=FIELD(Project No.),
                                                                                               Cost Type=FIELD(Cost Type));
                                                   OnValidate=BEGIN
                                                                IF ("Cost Object" <> '') AND ("Cost Object" <> xRec."Cost Object") THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE, '');
                                                                  "Cost Type" := DimValRec."Cost Type";
                                                                  VALIDATE("Unit of Measure", DimValRec."Unit of Measure");
                                                                  VALIDATE("Cost Component", DimValRec."Cost Component");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              NOR=Kostnadsobjekt;
                                                              SVE=Kostnadsobjekt];
                                                   CaptionClass='1,1,2' }
    { 41  ;   ;Cost Object Description;Text100    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Code=FIELD(Cost Object),
                                                                                                    Global Dimension No.=CONST(2)));
                                                   CaptionML=[ENU=Cost Object Description;
                                                              NOR=Kostnadsobjekt, Beskrivelse;
                                                              SVE=Kostnadsobjekt, beskrivning];
                                                   Editable=No;
                                                   CaptionClass='1,11012000,2, , ' + Text000 }
    { 42  ;   ;Project Related Name;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project - Cost Object".Name WHERE (Project No.=FIELD(Project No.),
                                                                                                          Cost Object=FIELD(Cost Object)));
                                                   CaptionML=[ENU=Project Related Name;
                                                              NOR=Prosjektrelatert navn;
                                                              SVE=Projektrelaterat namn];
                                                   Description=Name Cost Object;
                                                   Editable=No }
    { 50  ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                CalculateAmount;
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5 }
    { 60  ;   ;Price               ;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                CalculateAmount;
                                                              END;

                                                   CaptionML=[ENU=Price;
                                                              NOR=Pris;
                                                              SVE=Pris];
                                                   AutoFormatType=2 }
    { 70  ;   ;Amount incl. Surcharge;Decimal     ;OnValidate=VAR
                                                                BudgetRateManagement@1100528600 : Codeunit 11012358;
                                                                BudgetRateFoundAt@1100528601 : Text[250];
                                                                lvRate@1100525000 : Decimal;
                                                              BEGIN
                                                                CalculateRateOrQuantity;
                                                                CalculatePrognosisFields;

                                                                "Amount incl. Surcharge" := ROUND("Amount incl. Surcharge"); //C016993
                                                                Amount := ROUND("Amount incl. Surcharge" - "Ovh. Surcharge"); //C016993

                                                                //M20040 sn
                                                                IF ("Amount incl. Surcharge" <> 0) AND ("Cost Type" = "Cost Type"::Labor) AND ("Rate Code" <> '') THEN BEGIN
                                                                  ProjRec.GET("Project No.");
                                                                  lvRate := BudgetRateManagement.GetBudgetRate(
                                                                    0, "Project No.", '', '', ProjRec."Global Dimension 1 Code", "Rate Code", "Prognosis Date", BudgetRateFoundAt);
                                                                  IF lvRate <> Rate THEN
                                                                    "Rate Code" := '';
                                                                END;
                                                                //M20040 en
                                                              END;

                                                   CaptionML=[ENU=Amount incl. Ovh. Surcharge;
                                                              NOR=Belõp inkludert overheadkost;
                                                              SVE=Belopp inkl. overheadkostnad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 73  ;   ;Amount              ;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                VALIDATE("Amount incl. Surcharge", Amount + "Ovh. Surcharge")
                                                              END;

                                                   CaptionML=[ENU=Amount;
                                                              NOR=Belõp;
                                                              SVE=Belopp];
                                                   AutoFormatType=1 }
    { 75  ;   ;Ovh. Surcharge      ;Decimal       ;CaptionML=[ENU=Ovh. Surch. prognosis;
                                                              NOR=Overhead Kostprognose;
                                                              SVE=Overheadkostnadsprognos];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 80  ;   ;Element             ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                ElementFormat.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN BEGIN
                                                                  IF "Project No." = '' THEN BEGIN
                                                                    ElemRec.GET(Element);
                                                                    Level := ElemRec.Level;
                                                                    Chapter := ElemRec.Chapter;
                                                                    Paragraph := ElemRec.Paragraph;
                                                                  END ELSE BEGIN
                                                                    ProjRec.GET("Project No.");
                                                                    IF  ProjRec."Prognosis Level" = ProjRec."Prognosis Level"::Detailed THEN
                                                                      ProjRec.TESTFIELD("Prognosis per Element", TRUE);
                                                                    ProjElemRec.GET("Project No.",Element);
                                                                    Level := ProjElemRec.Level;
                                                                    Chapter := ProjElemRec.Chapter;
                                                                    Paragraph := ProjElemRec.Paragraph;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  CLEAR(Level);
                                                                  CLEAR(Chapter);
                                                                  CLEAR(Paragraph);
                                                                END;
                                                                CALCFIELDS("Element Description");
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 81  ;   ;Level               ;Integer       ;CaptionML=[ENU=Level;
                                                              NOR=NivÜ;
                                                              SVE=NivÜ];
                                                   Editable=No }
    { 82  ;   ;Chapter             ;Code20        ;CaptionML=[ENU=Chapter;
                                                              NOR=Kapittel;
                                                              SVE=Kapitel];
                                                   Editable=No }
    { 83  ;   ;Paragraph           ;Code20        ;CaptionML=[ENU=Paragraph;
                                                              NOR=Avsnitt;
                                                              SVE=Stycke];
                                                   Editable=No }
    { 85  ;   ;Element Description ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Element)));
                                                   CaptionML=[ENU=Element Description;
                                                              NOR=Elementbeskrivelse;
                                                              SVE=Elementbeskrivning];
                                                   Editable=No }
    { 90  ;   ;Unit Cost Object    ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit Cost Object;
                                                              NOR=Enhet for kostnadsobjekt;
                                                              SVE=Enhet fîr kostnadsobjekt] }
    { 100 ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=MÜleenhet;
                                                              SVE=MÜttenhet] }
    { 110 ;   ;Rate Code           ;Code10        ;TableRelation="Budget Rate".Code WHERE (Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                BudgetRateManagement@1100528600 : Codeunit 11012358;
                                                                BudgetRateFoundAt@1100528601 : Text[255];
                                                              BEGIN
                                                                CheckSurchargesCalculated;
                                                                ProjRec.GET("Project No.");
                                                                Rate :=
                                                                  BudgetRateManagement.GetBudgetRate(0, "Project No.", '', '',
                                                                    ProjRec."Global Dimension 1 Code", "Rate Code", "Prognosis Date", BudgetRateFoundAt);
                                                                CalculateAmount;
                                                              END;

                                                   OnLookup=VAR
                                                              BudgetRate@1100525000 : Record 11012000;
                                                            BEGIN
                                                              BudgetRate.SETRANGE("Project Filter", "Project No.");
                                                              BudgetRate.SETRANGE("Starting Date", 0D, "Prognosis Date");
                                                              BudgetRate.SETFILTER("Ending Date", '%1|>=%2', 0D, "Prognosis Date");
                                                              IF BudgetRate.GET("Rate Code") THEN;

                                                              IF PAGE.RUNMODAL(0, BudgetRate) = ACTION::LookupOK THEN
                                                                VALIDATE("Rate Code", BudgetRate.Code);
                                                            END;

                                                   CaptionML=[ENU=Rate Code;
                                                              NOR=Avgiftskode;
                                                              SVE=Avgiftskod] }
    { 120 ;   ;Rate                ;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                CalculateAmount;
                                                              END;

                                                   CaptionML=[ENU=Rate;
                                                              NOR=Avgift;
                                                              SVE=Avgift];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 140 ;   ;Previous Date       ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Max("Prognosis Line"."Prognosis Date" WHERE (Project No.=FIELD(Project No.),
                                                                                                            Cost Type=FIELD(Cost Type),
                                                                                                            Element=FIELD(Element),
                                                                                                            Cost Object=FIELD(Cost Object),
                                                                                                            Prognosis Date=FIELD(FILTER(Previous Date Filter))));
                                                   CaptionML=[ENU=Previous Date;
                                                              NOR=Forrige dato;
                                                              SVE=FîregÜende datum];
                                                   Editable=No }
    { 141 ;   ;Previous Date Filter;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Previous Date Flter;
                                                   Description=C017374 }
    { 150 ;   ;Previous Prognosis  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                       Prognosis Date=FIELD(Previous Date Filter),
                                                                                                                       Cost Type=FIELD(Cost Type),
                                                                                                                       Element=FIELD(Element),
                                                                                                                       Cost Object=FIELD(Cost Object)));
                                                   CaptionML=[ENU=Previous Prognosis;
                                                              NOR=Forrige prognose;
                                                              SVE=FîregÜende prognos];
                                                   Editable=No }
    { 155 ;   ;Fix Prognosis Line  ;Boolean       ;CaptionML=[ENU=Fix Prognosis Line;
                                                              NOR=Handlingsprognoserad;
                                                              SVE=ètgÑrdsprognosrad];
                                                   Editable=No }
    { 160 ;   ;Budget Amount       ;Decimal       ;CaptionML=[ENU=Budget Amount;
                                                              NOR=Budsjettbelõp;
                                                              SVE=Budgetbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 165 ;   ;Budget Surcharge Amount;Decimal    ;CaptionML=[ENU=Budget Overhead Surcharge Amount;
                                                              NOR=Budsjett overheadskost, belõp;
                                                              SVE=Budgetoverheadskostnad, belopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 170 ;   ;Budget Hours        ;Decimal       ;CaptionML=[ENU=Budget Hours;
                                                              NOR=Budsjett (Timer);
                                                              SVE=Budget (timmar)];
                                                   Editable=No }
    { 180 ;   ;Actual Costs        ;Decimal       ;CaptionML=[ENU=Actual Costs;
                                                              NOR=Faktiske koster;
                                                              SVE=Verkliga kostnader];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 190 ;   ;Actual Hours        ;Decimal       ;CaptionML=[ENU=Actual Hours;
                                                              NOR=Reelle timer;
                                                              SVE=Verkliga timmar];
                                                   Editable=No }
    { 195 ;   ;Product Discount (Purchase);Decimal;CaptionML=ENU=Product Discount (Purchase);
                                                   Description=DP01727;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 200 ;   ;Open (Purchase)     ;Decimal       ;CaptionML=[ENU=Open (Purchase);
                                                              NOR=èpne innkjõp;
                                                              SVE=ôppna inkîp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 210 ;   ;Received/Not Invoiced;Decimal      ;CaptionML=[ENU=Received/Not Invoiced;
                                                              NOR=Mottatt/ikke fakturert;
                                                              SVE=Mottaget/inte fakturerat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 211 ;   ;Open Ovh. Surch. (Purchase);Decimal;CaptionML=[ENU=Open Ovh. Surch. (Purchase);
                                                              NOR=èpne Overheadkost (innkjõp);
                                                              SVE=ôppen overheadkostnad (inkîp)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 215 ;   ;Open Amount (Hours) ;Decimal       ;CaptionML=[ENU=Open Amount (Hours);
                                                              NOR=èpne belõp (Timer);
                                                              SVE=ôppna belopp (timmar)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 216 ;   ;Open Hours          ;Decimal       ;CaptionML=[ENU=Open Hours;
                                                              NOR=èpne timer;
                                                              SVE=ôppna timmar];
                                                   Editable=No }
    { 217 ;   ;Open Ovh. Surch. (Hours);Decimal   ;CaptionML=[ENU=Open Ovh. Surch. (Hours);
                                                              NOR=èpen tilleggsgebyr for overhead (Timer);
                                                              SVE=ôppen overheadkostnad (timmar)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 218 ;   ;Open (Inventory)    ;Decimal       ;CaptionML=[ENU=Open (Inventory);
                                                              NOR=èpne (lager);
                                                              SVE=ôppna (lager)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 219 ;   ;Open Ovh. Surch. (Inventory);Decimal;
                                                   CaptionML=[ENU=Open Ovh. Surch. (Inventory);
                                                              NOR=èpen overheadkost (lager);
                                                              SVE=ôppen overheadkostnad (lager)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 220 ;   ;Allowed Costs       ;Decimal       ;CaptionML=[ENU=Allowed Costs;
                                                              NOR=Tillatte koster;
                                                              SVE=TillÜtna kostnader];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 230 ;   ;Allowed Hours       ;Decimal       ;CaptionML=[ENU=Allowed Hours;
                                                              NOR=Tillatte timer;
                                                              SVE=TillÜtna timmar];
                                                   Editable=No }
    { 240 ;   ;Prognosis End Result;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                "Amount incl. Surcharge" := ROUND("Budget Amount" - "Total Cost" - "Prognosis End Result");  // Call C009648.modify
                                                                Amount := ROUND("Amount incl. Surcharge" - "Ovh. Surcharge");                                // Call C009648.modify
                                                                "Prognosis Total Cost" := ROUND("Amount incl. Surcharge" + "Total Cost");                    // Call C009648.modify
                                                                CalculateRateOrQuantity;
                                                              END;

                                                   CaptionML=[ENU=Prognosis End Result;
                                                              NOR=Forventet Sluttresultat;
                                                              SVE=FîrvÑntat \slutresultat];
                                                   AutoFormatType=1 }
    { 250 ;   ;Comment             ;Text100       ;CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar] }
    { 260 ;   ;Total Cost          ;Decimal       ;CaptionML=[ENU=Total Cost;
                                                              NOR=Total kost;
                                                              SVE=Totalkostnad];
                                                   AutoFormatType=1 }
    { 265 ;   ;Total Cost (Excl. Risc Cov.);Decimal;
                                                   CaptionML=[ENU=Total Cost (Excl. Risc Cov.);
                                                              NOR=Totalkost (ekskludert Riskdekning);
                                                              SVE=Totalkostnad (exkl. risktÑckn.)];
                                                   AutoFormatType=1 }
    { 270 ;   ;Total Hours         ;Decimal       ;CaptionML=[ENU=Total Hours;
                                                              NOR=Timer totalt;
                                                              SVE=Timmar totalt];
                                                   Editable=No }
    { 280 ;   ;General Total Budget Hours;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Budget Hours" WHERE (Project No.=FIELD(Project No.),
                                                                                                          Prognosis Date=FIELD(Prognosis Date),
                                                                                                          Cost Type=FILTER(Labor)));
                                                   CaptionML=[ENU=General Total Budget Hours Labor;
                                                              NOR=Generelle totale budsjetttimer for arbeidskraft;
                                                              SVE=AllmÑnna totala budgettimmar fîr arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 290 ;   ;General Total Hours ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Total Hours" WHERE (Project No.=FIELD(Project No.),
                                                                                                         Prognosis Date=FIELD(Prognosis Date),
                                                                                                         Cost Type=FILTER(Labor)));
                                                   CaptionML=[ENU=General Total Hours Labor;
                                                              NOR=Generelle totale timer for arbeidskraft;
                                                              SVE=AllmÑnna totala timmar fîr arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 295 ;   ;General Total Quantity;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line".Quantity WHERE (Project No.=FIELD(Project No.),
                                                                                                    Prognosis Date=FIELD(Prognosis Date),
                                                                                                    Cost Type=FILTER(Labor)));
                                                   CaptionML=[ENU=General Total Quantity Labor;
                                                              NOR=Generelt totalt antall for arbeidskraft;
                                                              SVE=AllmÑnt totalt antal fîr arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 300 ;   ;Total Progn. End Result Labor;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Prognosis Date=FIELD(Prognosis Date),
                                                                                                                  Cost Type=FILTER(Labor)));
                                                   CaptionML=[ENU=Total Prognosis End Result Labor;
                                                              NOR=Sluttresultat for totalprognose, arbeidskraft;
                                                              SVE=Slutresultat fîr totalprognos, arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 310 ;   ;Total Progn. End Result Mat.;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Prognosis Date=FIELD(Prognosis Date),
                                                                                                                  Cost Type=FILTER(Material)));
                                                   CaptionML=[ENU=Total Prognosis End Result Material;
                                                              NOR=Sluttresultat for totalprognose, Materiale;
                                                              SVE=Slutresultat fîr totalprognos, material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 320 ;   ;Total Progn. End Result Subc.;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Prognosis Date=FIELD(Prognosis Date),
                                                                                                                  Cost Type=FILTER(Subcontracting)));
                                                   CaptionML=[ENU=Total Prognosis End Result Subcontracting;
                                                              NOR=Sluttresultat for totalprognose, underentrepenõr;
                                                              SVE=Slutresultat fîr totalprognos, Underentreprenad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 330 ;   ;Total Progn. End Result Plant;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Prognosis Date=FIELD(Prognosis Date),
                                                                                                                  Cost Type=FILTER(Plant)));
                                                   CaptionML=[ENU=Total Prognosis End Result Plant;
                                                              NOR=Sluttresultat for totalprognose, maskin;
                                                              SVE=Slutresultat fîr totalprognos, Maskin];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 340 ;   ;Total Progn. End Result Sundry;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Prognosis Date=FIELD(Prognosis Date),
                                                                                                                  Cost Type=FILTER(Sundry)));
                                                   CaptionML=[ENU=Total Prognosis End Result Sundry;
                                                              NOR=Sluttresultat for totalprognose, diverse;
                                                              SVE=Slutresultat fîr totalprognos, diverse];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 350 ;   ;Total Prognosis End Result;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Prognosis Date=FIELD(Prognosis Date)));
                                                   CaptionML=[ENU=Total Prognosis End Result;
                                                              NOR=Sluttresultat for totalprognose;
                                                              SVE=Slutresultat fîr totalprognos];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 360 ;   ;Total Prognosis Labor;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Prognosis Date=FIELD(Prognosis Date),
                                                                                                                    Cost Type=FILTER(Labor)));
                                                   CaptionML=[ENU=Total Prognosis Labor;
                                                              NOR=Totalprognose for arbeidskraft;
                                                              SVE=Totalprognos fîr arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 370 ;   ;Total Prognosis Material;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Prognosis Date=FIELD(Prognosis Date),
                                                                                                                    Cost Type=FILTER(Material)));
                                                   CaptionML=[ENU=Total Prognosis Material;
                                                              NOR=Totalprognose for Materiale;
                                                              SVE=Totalprognos fîr material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 380 ;   ;Total Prognosis Subcontracting;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Prognosis Date=FIELD(Prognosis Date),
                                                                                                                    Cost Type=FILTER(Subcontracting)));
                                                   CaptionML=[ENU=Total Prognosis Subcontracting;
                                                              NOR=Totalprognose for underentrepenõr;
                                                              SVE=Totalprognos fîr Underentreprenad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 390 ;   ;Total Prognosis Plant;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Prognosis Date=FIELD(Prognosis Date),
                                                                                                                    Cost Type=FILTER(Plant)));
                                                   CaptionML=[ENU=Total Prognosis Plant;
                                                              NOR=Totalprognose for maskin;
                                                              SVE=Totalprognos fîr Maskin];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 400 ;   ;Total Prognosis Sundry;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Prognosis Date=FIELD(Prognosis Date),
                                                                                                                    Cost Type=FILTER(Sundry)));
                                                   CaptionML=[ENU=Total Prognosis Sundry;
                                                              NOR=Totalprognose for diverse;
                                                              SVE=Totalprognos fîr diverse];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 410 ;   ;Total Prognosis     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Prognosis Date=FIELD(Prognosis Date)));
                                                   CaptionML=[ENU=Total Prognosis;
                                                              NOR=Totalprognose;
                                                              SVE=Totalprognos];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 420 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadskomponent];
                                                   Editable=No }
    { 430 ;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Main Project No.;
                                                              NOR=Hovedprosjektnr.;
                                                              SVE=Huvudprojektnr] }
    { 440 ;   ;Prev Prognosis End Result;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Prognosis Line"."Prognosis End Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                     Prognosis Date=FIELD(Previous Date Filter),
                                                                                                                     Cost Type=FIELD(Cost Type),
                                                                                                                     Element=FIELD(Element),
                                                                                                                     Cost Object=FIELD(Cost Object)));
                                                   CaptionML=[ENU=Prev Prognosis End Result;
                                                              NOR=Forrige prognose for Sluttresultat;
                                                              SVE=FîregÜende prognos fîr slutresultat];
                                                   Editable=No }
    { 450 ;   ;Prognosis Total Cost;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                // jhoek.begin
                                                                "Prognosis End Result" := ROUND("Budget Amount" - "Prognosis Total Cost"); //C016993
                                                                "Amount incl. Surcharge" := ROUND("Prognosis Total Cost" - "Total Cost"); //C016993
                                                                CalculateRateOrQuantity;
                                                                // jhoek.end
                                                                Amount := ROUND("Amount incl. Surcharge" - "Ovh. Surcharge"); //C016993
                                                              END;

                                                   CaptionML=[ENU=Prognosis Total Cost;
                                                              NOR=Prognose for totale kostnader;
                                                              SVE=Prognos totala kostnader];
                                                   AutoFormatType=1 }
    { 455 ;   ;Prognosis Total Hours;Decimal      ;OnValidate=BEGIN
                                                                // 15532.n
                                                                VALIDATE(Quantity,"Prognosis Total Hours" - "Total Hours");
                                                              END;

                                                   CaptionML=[ENU=Prognosis Total Hours;
                                                              NOR=Prognose for timer totalt;
                                                              SVE=Prognos fîr timmar totalt] }
    { 460 ;   ;Prognosis End Result Hours;Decimal ;CaptionML=[ENU=Prognosis End Result Hours;
                                                              NOR=Prognose for sluttresultat, timer;
                                                              SVE=Prognos fîr slutresultat, timmar];
                                                   Editable=No }
    { 470 ;   ;Result Hours        ;Decimal       ;CaptionML=[ENU=Result Hours;
                                                              NOR=Resultattimer;
                                                              SVE=Resultattimmar];
                                                   Editable=No }
    { 480 ;   ;Estimated Purchase Result;Decimal  ;CaptionML=[ENU=Estimated Purchase Result;
                                                              NOR=Kalkulert Innkjõpsresultat;
                                                              SVE=Kalkylerat inkîpsresultat];
                                                   Editable=No }
    { 490 ;   ;Purchase Result     ;Decimal       ;CaptionML=[ENU=Purchase Result;
                                                              NOR=Innkjõpsresultat;
                                                              SVE=Inkîpsresultat];
                                                   Editable=No }
    { 500 ;   ;Amount Revenue      ;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                "Prognosis Total Revenues" := Invoiced + "Amount Revenue";
                                                                "Prognosis End Result Revenues" := "Prognosis Total Revenues" - "Installment Amount";
                                                                "Diff W Prev Prog End Res Rev" := "Prognosis End Result Revenues" - GetPrevProgEndResultRev;
                                                              END;

                                                   CaptionML=[ENU=Amount Revenue;
                                                              NOR=Inntektsbelõp;
                                                              SVE=IntÑktsbelopp];
                                                   AutoFormatType=1 }
    { 510 ;   ;Prognosis Revenue   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount Revenue" WHERE (Project No.=FIELD(Project No.),
                                                                                                            Prognosis Date=FIELD(Prognosis Date),
                                                                                                            Cost Type=FILTER(Revenue)));
                                                   CaptionML=[ENU=Prognosis Revenue;
                                                              NOR=Prognostiserte inntekter;
                                                              SVE=Prognos intÑkter];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 520 ;   ;Risc Coverage       ;Decimal       ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                "Total Cost" := "Total Cost (Excl. Risc Cov.)" + "Risc Coverage";
                                                                VALIDATE("Amount incl. Surcharge");
                                                              END;

                                                   CaptionML=[ENU=Risc Coverage;
                                                              NOR=Riskdekning;
                                                              SVE=RisktÑckning];
                                                   AutoFormatType=1 }
    { 530 ;   ;Invoiced            ;Decimal       ;CaptionML=[ENU=Invoiced;
                                                              NOR=Fakturert;
                                                              SVE=Fakt. intÑkt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 540 ;   ;Total Risc Coverage Amount;Decimal ;CaptionML=[ENU=Total Risc Coverage Amount;
                                                              NOR=Totalt Riskdekningsbelõp;
                                                              SVE=Totalt risktÑckningsbelopp];
                                                   Editable=No }
    { 545 ;   ;Total Release Risc Coverage;Decimal;CaptionML=[ENU=Total Release Risc Coverage;
                                                              NOR="Totalt, frigi Riskdekning ";
                                                              SVE=Total slÑppning fîr risktÑckning];
                                                   Editable=No }
    { 560 ;   ;Original Budget Amount;Decimal     ;CaptionML=[ENU=Original Budget Amount;
                                                              NOR=Opprinnelig Budsjettbelõp;
                                                              SVE=Ursprungligt budgetbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 570 ;   ;Adjustments         ;Decimal       ;CaptionML=[ENU=Adjustments;
                                                              NOR=Justeringer;
                                                              SVE=Justeringar];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 580 ;   ;Extension           ;Decimal       ;CaptionML=[ENU=Extension;
                                                              NOR=Direktenr.;
                                                              SVE=Extension];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 585 ;   ;Options             ;Decimal       ;CaptionML=[ENU=Options;
                                                              NOR=Alternativer;
                                                              SVE=Alternativ];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 590 ;   ;Purchase Budget     ;Decimal       ;CaptionML=[ENU=Purchase Budget;
                                                              NOR=Innkjõpsbudsjett;
                                                              SVE=Inkîpsbudget];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 600 ;   ;Purchase Amount     ;Decimal       ;CaptionML=[ENU=Purchase Amount;
                                                              NOR=Innkjõpsbelõp;
                                                              SVE=Inkîpsbelopp];
                                                   Editable=No }
    { 605 ;   ;Purchase Amount (Get Orders);Decimal;
                                                   CaptionML=ENU=Purchase Amount (Get Orders);
                                                   Editable=No }
    { 610 ;   ;Actual Costs (Purchase Action);Decimal;
                                                   CaptionML=[ENU=Actual Costs (Purchase Action);
                                                              NOR=Reelle Kostnader (Innkjõphandling);
                                                              SVE=Verkliga kostnader (inkîpsÜtgÑrd)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 615 ;   ;Actual Costs (Not P. O. Rel.);Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Actual Costs (Not Purchase Order Related);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 620 ;   ;Prev Prognosis Total Cost;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Prognosis Line"."Prognosis Total Cost" WHERE (Project No.=FIELD(Project No.),
                                                                                                                     Prognosis Date=FIELD(Previous Date Filter),
                                                                                                                     Cost Type=FIELD(Cost Type),
                                                                                                                     Element=FIELD(Element),
                                                                                                                     Cost Object=FIELD(Cost Object)));
                                                   CaptionML=ENU=Prev Prognosis Total Cost;
                                                   Editable=No }
    { 630 ;   ;Received/To Process ;Decimal       ;InitValue=0;
                                                   CaptionML=ENU=Received/To Process }
    { 640 ;   ;Purchase (Purchase Action);Decimal ;CaptionML=ENU=Purchase Amount (Purchase Action);
                                                   Editable=No }
    { 650 ;   ;Diff. with Prev. End Result;Decimal;CaptionML=ENU=Diff. with Prev. End Result;
                                                   Description=Only for temporary use!;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 660 ;   ;Result              ;Decimal       ;CaptionML=[ENU=Result;
                                                              SVE=Resultat];
                                                   Description=Only for temporary use!;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 670 ;   ;Installment Amount  ;Decimal       ;CaptionML=[ENU=Installment Amount;
                                                              SVE=Betalplansbelopp];
                                                   Editable=No }
    { 680 ;   ;Prognosis Total Revenues;Decimal   ;OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                "Amount Revenue" := "Prognosis Total Revenues" - Invoiced;
                                                                "Prognosis End Result Revenues" := "Prognosis Total Revenues" - "Installment Amount";
                                                                "Diff W Prev Prog End Res Rev" := "Prognosis End Result Revenues" - GetPrevProgEndResultRev;
                                                              END;

                                                   CaptionML=[ENU=Prognosis Total Revenues;
                                                              SVE=Prognos totala intÑkter] }
    { 690 ;   ;Prognosis End Result Revenues;Decimal;
                                                   OnValidate=BEGIN
                                                                CheckSurchargesCalculated;
                                                                "Amount Revenue" := "Prognosis End Result Revenues" + "Installment Amount" - Invoiced;
                                                                "Prognosis Total Revenues" := "Prognosis End Result Revenues" + "Installment Amount";
                                                                "Diff W Prev Prog End Res Rev" := "Prognosis End Result Revenues" - GetPrevProgEndResultRev;
                                                              END;

                                                   CaptionML=ENU=Prognosis End Result Revenues }
    { 700 ;   ;Diff W Prev Prog End Res Rev;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Difference with Prev Prognosis End Result Revenues;
                                                   Editable=No }
    { 710 ;   ;Hours Available     ;Decimal       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Hours Available;
                                                   Editable=No }
    { 720 ;   ;Specification Line Exists;Boolean  ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Prognosis Line Specification" WHERE (Project No.=FIELD(Project No.),
                                                                                                           Prognosis Date=FIELD(Prognosis Date),
                                                                                                           Element=FIELD(Element),
                                                                                                           Cost Type=FIELD(Cost Type),
                                                                                                           Cost Object=FIELD(Cost Object)));
                                                   CaptionML=ENU=Specification Line Exists;
                                                   Editable=No }
    { 730 ;   ;Remaining Budget    ;Decimal       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Remaining Budget;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 760 ;   ;Allowed %           ;Decimal       ;CaptionML=[ENU=Allowed %;
                                                              SVE=TillÜten procent];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Project No.,Prognosis Date,Cost Type,Element,Cost Object;
                                                   SumIndexFields=Amount incl. Surcharge,Risc Coverage,Prognosis Total Cost,Prognosis End Result,Budget Amount,Total Cost,Amount Revenue,Quantity,Budget Hours,Total Hours,Received/To Process;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Prognosis Date                          ;MaintainSQLIndex=No;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Prognosis Date,Element,Chapter,Paragraph;
                                                   SumIndexFields=Amount incl. Surcharge,Quantity,Received/To Process;
                                                   MaintainSQLIndex=No;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Prognosis Date,Cost Type,Cost Object,Element;
                                                   MaintainSQLIndex=No;
                                                   MaintainSIFTIndex=No }
    {    ;Main Project No.,Project No.,Prognosis Date,Cost Type;
                                                   SumIndexFields=Amount incl. Surcharge,Quantity,Amount Revenue,Prognosis Total Cost,Received/To Process }
    {    ;Main Project No.,Project No.,Cost Component,Prognosis Date;
                                                   SumIndexFields=Amount incl. Surcharge,Quantity,Risc Coverage,Prognosis Total Cost,Received/To Process }
    {    ;Main Project No.,Project No.,Cost Object,Prognosis Date;
                                                   SumIndexFields=Amount incl. Surcharge,Risc Coverage,Prognosis Total Cost,Received/To Process }
    {    ;Main Project No.,Project No.,Element,Cost Object }
    {    ;Main Project No.,Project No.,Element,Prognosis Date;
                                                   SumIndexFields=Amount incl. Surcharge,Quantity,Risc Coverage,Prognosis Total Cost,Received/To Process }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ProjElemRec@1210190003 : Record 11012010;
      ElemRec@1100525000 : Record 11012060;
      ProjRec@1100485000 : Record 11072003;
      PrognosisRec@1100525006 : Record 11012034;
      DimValRec@1100525002 : Record 349;
      ProjSetup@1100528800 : Record 315;
      ElementFormat@1100525001 : Codeunit 11012022;
      DimMgt@1100525003 : Codeunit 408;
      PrognosisManagement@1100529700 : Codeunit 11020217;
      UpdateAction@1100525004 : 'Insert,Modify,Delete';
      DeleteControlOnProg@1100525005 : Boolean;
      Text000@1100527350 : TextConst 'ENU=Description;SVE=Beskrivning';

    PROCEDURE CalculateAmount@1();
    BEGIN
      IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
        VALIDATE(Amount, ROUND(Quantity * Rate));  // Call C009648.modify
        Price := 0;
      END ELSE BEGIN
        VALIDATE(Amount, ROUND(Quantity * Price)); // Call C009648.modify
        Rate := 0;
      END;
    END;

    PROCEDURE CalculateRateOrQuantity@2();
    VAR
      Currency@1100525000 : Record 4;
    BEGIN
      //M20040 so
      //IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
      //  IF Rate <> 0 THEN
      //    Quantity := "Amount incl. Surcharge" / Rate;
      //  Price := 0;
      //END ELSE BEGIN
      //  IF Price <> 0 THEN
      //    Quantity := "Amount incl. Surcharge" / Price;
      //  Rate := 0;
      //END;
      //M20040 eo

      Currency.InitRoundingPrecision; //C009648 rounding added
      // dp00029.sn
      ProjSetup.GET;
      IF ProjSetup."Recalc Rate or Hours Prognosis" = ProjSetup."Recalc Rate or Hours Prognosis"::Rate THEN BEGIN
      // dp00029.en
        //M20040 sn
        IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
          //In case of Labor Quantity is NOT recalculated. In Stead Rate is Calculated.
          IF Quantity <> 0 THEN
            Rate := ROUND(Amount/Quantity,Currency."Unit-Amount Rounding Precision"); //C009648 rounding added
          Price := 0;
        END ELSE BEGIN
          IF Quantity <> 0 THEN
            Price := ROUND(Amount/Quantity,Currency."Unit-Amount Rounding Precision"); //C009648 rounding added
          IF Price <> 0 THEN
            Quantity := Amount / Price;
          Rate := 0;
        END;
        //M20040 en
      // dp00029.sn
      END ELSE BEGIN
        IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
          IF Rate <> 0 THEN
            //Quantity := "Amount incl. Surcharge" / Rate; //C036560.o
            Quantity := Amount / Rate;  //C036560.n
          Price := 0;
        END ELSE BEGIN
          IF Price <> 0 THEN
            //Quantity := "Amount incl. Surcharge" / Price;//C036560.o
            Quantity := Amount / Price;//C036560.n
          Rate := 0;
        END;
      END;
      // dp00029.en
    END;

    PROCEDURE UpdateCostControlStatus@10(lUpdateAction@1100485002 : 'Insert,Modify,Delete');
    BEGIN
      IF ProjRec.GET("Project No.") THEN
        ProjRec.UpdateCostControlStatus(lUpdateAction, xRec."Cost Object", "Cost Object");
    END;

    PROCEDURE CalculatePrognosisFields@1100525000();
    BEGIN
      "Prognosis End Result" := "Budget Amount" - "Total Cost" - "Amount incl. Surcharge";
      "Prognosis End Result Hours" := "Budget Hours" - "Total Hours" - Quantity;
      "Prognosis Total Cost" := "Amount incl. Surcharge" + "Total Cost";                              //20060810-JE //20090119 PS
      "Prognosis Total Hours" := "Total Hours" + Quantity;  // 15532.n
    END;

    PROCEDURE CheckSurchargesCalculated@1100525001() : Boolean;
    VAR
      lvPrognosis@1100525000 : Record 11012034;
    BEGIN
      lvPrognosis.INIT;
      lvPrognosis.SETRANGE("Project No.", "Project No.");
      lvPrognosis.SETRANGE("Prognosis Date", "Prognosis Date");
      IF lvPrognosis.FINDFIRST THEN BEGIN
        IF lvPrognosis."Ovh. Surcharges Calculated" THEN
          IF NOT lvPrognosis."Altered After Calculation" THEN BEGIN
            lvPrognosis."Altered After Calculation" := TRUE;  //M21759
            lvPrognosis.MODIFY;                               //M21759
          END;
      END;
    END;

    PROCEDURE UpdatePrognosisSpecification@11136551(OldQuantity@11136550 : Decimal;NewQuantity@11136552 : Decimal;OldPrice@11136553 : Decimal;NewPrice@11136554 : Decimal;OldAmount@1100525000 : Decimal;NewAmount@1100525001 : Decimal);
    BEGIN
      CALCFIELDS("Cost Object Description");
      PrognosisManagement.UpdatePrognosisSpecification("Project No.", "Prognosis Date", Element, "Cost Type", "Cost Object",
        OldQuantity, NewQuantity, OldPrice, NewPrice, OldAmount, NewAmount, "Cost Object Description");  //C034480
    END;

    PROCEDURE AmountOnDrillDown@11136550();
    BEGIN
      PrognosisManagement.AmountOnDrillDown("Project No.","Prognosis Date",Element,"Cost Type","Cost Object")
    END;

    PROCEDURE SetDeleteControlOnProg@1100525002();
    BEGIN
      //**4PS, SR C011681 17-01-14
      DeleteControlOnProg := TRUE;
    END;

    PROCEDURE SetPreviousDateFilter@1100528000();
    VAR
      Prognosis@1100528000 : Record 11012034;
    BEGIN
      //C017374
      SETRANGE("Previous Date Filter",0D);

      Prognosis.SETRANGE("Project No.","Project No."); //C036445.n
      IF Prognosis.GET("Project No.","Prognosis Date") THEN
        IF Prognosis.NEXT(-1) <> 0 THEN
          SETFILTER("Previous Date Filter",FORMAT(Prognosis."Prognosis Date"));
    END;

    LOCAL PROCEDURE MakeTemporaryUsedFieldsEmpty@1100528402();
    BEGIN
      IF ISTEMPORARY THEN
        EXIT;

      "Diff. with Prev. End Result" := 0;
      Result := 0;
    END;

    LOCAL PROCEDURE GetPreviousDate@1100527404() : Date;
    BEGIN
      IF NOT PrognosisRec.GET("Project No.", "Prognosis Date") THEN
        EXIT(0D);
      PrognosisRec.SETRANGE("Project No.", "Project No.");
      IF PrognosisRec.NEXT(-1) = 0 THEN
        EXIT(0D);

      EXIT(PrognosisRec."Prognosis Date");
    END;

    PROCEDURE GetPrevAmountRev@1100527401() PrevAmountRev : Decimal;
    VAR
      PrognosisLine@1100527400 : Record 11012035;
    BEGIN
      PrognosisLine.SETRANGE("Project No.","Project No.");
      PrognosisLine.SETRANGE("Prognosis Date",GetPreviousDate);
      PrognosisLine.SETRANGE("Cost Type","Cost Type"::Revenue);
      PrognosisLine.SETRANGE("Cost Object","Cost Object");

      IF PrognosisLine.FINDSET THEN
        REPEAT
          PrevAmountRev := PrognosisLine."Amount Revenue" + PrevAmountRev;
        UNTIL PrognosisLine.NEXT = 0;
    END;

    PROCEDURE GetTotalPrevProgRev@1100527400() TotalPrevProgRev : Decimal;
    VAR
      PrognosisLine@1100527400 : Record 11012035;
    BEGIN
      PrognosisLine.SETRANGE("Project No.","Project No.");
      PrognosisLine.SETRANGE("Prognosis Date",GetPreviousDate);
      PrognosisLine.SETRANGE("Cost Type","Cost Type"::Revenue);
      PrognosisLine.SETRANGE("Cost Object","Cost Object");

      IF PrognosisLine.FINDSET THEN
        REPEAT
          TotalPrevProgRev := PrognosisLine."Prognosis Total Revenues" + TotalPrevProgRev;
        UNTIL PrognosisLine.NEXT = 0;
    END;

    PROCEDURE GetPrevProgEndResultRev@1100527410() PrevProgEndResultRev : Decimal;
    VAR
      PrognosisLine@1100527400 : Record 11012035;
    BEGIN
      PrognosisLine.SETRANGE("Project No.","Project No.");
      PrognosisLine.SETRANGE("Prognosis Date",GetPreviousDate);
      PrognosisLine.SETRANGE("Cost Type","Cost Type"::Revenue);
      PrognosisLine.SETRANGE("Cost Object","Cost Object");

      IF PrognosisLine.FINDSET THEN
        REPEAT
          PrevProgEndResultRev := PrognosisLine."Prognosis End Result Revenues" + PrevProgEndResultRev;
        UNTIL PrognosisLine.NEXT = 0;
    END;

    PROCEDURE GetAvailable@1100528403() : Decimal;
    VAR
      JobsSetup@1100528400 : Record 315;
      PrognosisManagement@1100528401 : Codeunit 11020217;
    BEGIN
      IF NOT JobsSetup.GET THEN
        EXIT;
      EXIT(PrognosisManagement.CalculateAvailable(
        "Budget Amount", "Allowed Costs", "Open (Purchase)",
        "Product Discount (Purchase)", "Total Cost",
        JobsSetup."Calculate Available" = JobsSetup."Calculate Available"::"Budget - Allowed Cost"));
    END;

    PROCEDURE GetAvailableHours@1100528400() : Decimal;
    VAR
      JobsSetup@1100528400 : Record 315;
      PrognosisManagement@1100528401 : Codeunit 11020217;
    BEGIN
      IF NOT JobsSetup.GET THEN
        EXIT;
      EXIT(PrognosisManagement.CalculateAvailableHours(
        "Budget Hours", "Allowed Hours", "Open Hours", "Total Hours",
        JobsSetup."Calculate Available" = JobsSetup."Calculate Available"::"Budget - Allowed Cost"));
    END;

    PROCEDURE CalculateAllowedPercentage@1210190005(VAR PrognosisLine@1100527350 : Record 11012035);
    BEGIN
      WITH PrognosisLine DO BEGIN
        IF "Budget Amount" = 0 THEN
          "Allowed %" := 0
        ELSE
          "Allowed %" := "Allowed Costs" / "Budget Amount" * 100;
      END;
    END;

    BEGIN
    {
      //20060706-JE : Added fields [Prev Prognosis End Result], [Total Expected Costs]
      //20060706-JE : Added fields [Prognosis End Result Hours], [Result Hours]
      //20060810-JE : Field "Total Expected Costs" will be updated after changing amount field.

      151022 ITERO.SB RFC-010 Added function/setup to check if prognosis is used in project preclosure
    }
    END.
  }
}

