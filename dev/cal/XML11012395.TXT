OBJECT XMLport 11012395 Import KPD-Budget Construct
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Import KPD-Budget Construct;
               SVE=Import KPD-Budget Construct];
    Direction=Import;
    DefaultFieldsValidation=No;
    PreserveWhiteSpace=Yes;
    TextEncoding=WINDOWS;
    OnPreXMLport=BEGIN
                   LineCounter := 0;

                   BudgetRec.SETRANGE("Project No.", ProjectCde);
                   BudgetRec.SETRANGE("Extension Contract", ExtensionCde);
                   BudgetRec.SETRANGE(Adjustment, AdjustmentCde);
                   BudgetRec.SETRANGE(Option, OptionCde);
                   BudgetRec.SETRANGE("Settlement Quantity Code", SettlementQuantityCde);
                   IF BudgetRec.FINDLAST THEN
                     LineCounter := BudgetRec."Line No.";

                   IF (OptionCde = '') OR (ProjectCde <> '') THEN
                     ProjRec.GET(ProjectCde);
                 END;

    OnPostXMLport=VAR
                    lvSumSheetRec@1100525000 : Record 11012064;
                  BEGIN
                    lvSumSheetRec."Project No." := ProjectCde;
                    lvSumSheetRec."Contract No." := ExtensionCde;
                    lvSumSheetRec."Plot No." := PlotCde;
                    lvSumSheetRec."House Model" := HouseModelCde;
                    lvSumSheetRec."Main Group" := MainGroupCde;
                    lvSumSheetRec.Group := GroupCde;
                    lvSumSheetRec."Sub Group" := SubGroupCde;
                    lvSumSheetRec.Option := OptionCde;
                    lvSumSheetRec."Settlement Quantity Code" := SettlementQuantityCde;
                    IF OptionCde <> '' THEN BEGIN
                      lvSumSheetRec.ReCalcOptionSummaryLines();
                      lvSumSheetRec.UpdateOptBudgetLines();
                      END ELSE BEGIN
                        IF SettlementQuantityCde <> '' THEN BEGIN
                          lvSumSheetRec.ReCalcSettlQuanSummaryLines();
                          lvSumSheetRec.UpdateSettlQuanBudgLines();
                        END ELSE BEGIN
                          lvSumSheetRec.ReCalcSummaryLines(AdjustmentCde);
                          lvSumSheetRec.UpdateBudgetLines(TRUE, AdjustmentCde);
                        END;
                    END;

                    CheckUpdateOption();
                      CheckUpdateSettlQuantity();
                  END;

    Format=Variable Text;
    FieldDelimiter='';
    FieldSeparator=[;];
    UseRequestPage=No;
  }
  ELEMENTS
  {
    { [{BD69F2F7-7E07-4A1F-B411-0D288B4E1F21}];  ;Root                ;Element ;Text     }

    { [{B45FEF86-1D0A-4F4C-8E1C-4392130667F6}];1 ;BudgetLine          ;Element ;Table   ;
                                                  SourceTable=Table11012001;
                                                  SourceTableView=SORTING(Field1,Field31,Field33,Field38,Field14);
                                                  Import::OnAfterInitRecord=BEGIN
                                                                              "Budget Line".INIT;
                                                                              CLEAR(DummyTxt);
                                                                              CLEAR(StatusTxt);
                                                                              CLEAR(DescriptionTxt);
                                                                              CLEAR(QuantityTxt);
                                                                              CLEAR(NormTxt);
                                                                              CLEAR(HoursTxt);
                                                                              CLEAR(LaborTotTxt);
                                                                              CLEAR(CostObjectLaborTxt);
                                                                              CLEAR(MaterialPriceTxt);
                                                                              CLEAR(MaterialTotTxt);
                                                                              CLEAR(CostObjectMaterialTxt);
                                                                              CLEAR(PlantPriceTxt);
                                                                              CLEAR(PlantTotTxt);
                                                                              CLEAR(CostObjectPlantTxt);
                                                                              CLEAR(SubcPriceTxt);
                                                                              CLEAR(SubcTotTxt);
                                                                              CLEAR(CostObjectSubcontrTxt);
                                                                              CLEAR(LineTotalTxt);
                                                                            END;

                                                  Import::OnBeforeInsertRecord=BEGIN
                                                                                 WITH "Budget Line" DO BEGIN

                                                                                 Quantity :=0;
                                                                                 Norm := 0;
                                                                                 Hours := 0;
                                                                                 LaborTot := 0;
                                                                                 MaterialPrice := 0;
                                                                                 MaterialTot := 0;
                                                                                 SubcPrice := 0;
                                                                                 SubcTot := 0;
                                                                                 PlantPrice := 0;
                                                                                 PlantTot := 0;

                                                                                 IF NOT EVALUATE(Quantity,QuantityTxt) THEN Quantity :=0;

                                                                                 IF EVALUATE(Norm,NormTxt) THEN;
                                                                                 IF EVALUATE(Hours,HoursTxt) THEN;
                                                                                 IF EVALUATE(LaborTot,LaborTotTxt) THEN;
                                                                                 IF EVALUATE(MaterialPrice,MaterialPriceTxt) THEN;
                                                                                 IF EVALUATE(MaterialTot,MaterialTotTxt) THEN;
                                                                                 IF EVALUATE(SubcPrice,SubcPriceTxt) THEN;
                                                                                 IF EVALUATE(SubcTot,SubcTotTxt) THEN;
                                                                                 IF NOT EVALUATE(PlantPrice,PlantPriceTxt) THEN;
                                                                                 IF NOT EVALUATE(PlantTot,PlantTotTxt) THEN;
                                                                                 IF EVALUATE(LineTotal,LineTotalTxt) THEN;

                                                                                 Description := COPYSTR(DescriptionTxt, 1, 50) ;

                                                                                 "Project No." := ProjectCde;
                                                                                 FillMainProject;
                                                                                 "Extension Contract" := ExtensionCde;
                                                                                 Adjustment := AdjustmentCde;
                                                                                 Option := OptionCde;
                                                                                 "Settlement Quantity Code" := SettlementQuantityCde;
                                                                                 "Time Quantity" := 1;
                                                                                 "Department Code" := ProjRec."Global Dimension 1 Code";

                                                                                 GetVersionDate;
                                                                                 UpdateExtContractStatus;

                                                                                 IF Option <> '' THEN BEGIN
                                                                                   "Extension Contract Status" := "Extension Contract Status"::Expired;
                                                                                   OptionRec.SETRANGE("Project No.","Project No.");
                                                                                   OptionRec.SETRANGE("Plot No.","Plot No.");
                                                                                   OptionRec.SETRANGE("House Model",HouseModelCde);
                                                                                   OptionRec.SETRANGE("Main Group",MainGroupCde);
                                                                                   OptionRec.SETRANGE(Group,GroupCde);
                                                                                   OptionRec.SETRANGE("Sub Group",SubGroupCde);
                                                                                   OptionRec.SETRANGE(Option,Option);
                                                                                   IF OptionRec.FINDFIRST THEN
                                                                                     "Version Date" := OptionRec."Version Date";
                                                                                 END;

                                                                                 IF "Settlement Quantity Code" <> '' THEN BEGIN
                                                                                   "Extension Contract Status" := "Extension Contract Status"::Expired;
                                                                                   SettlementQuantityRec.SETRANGE("Project No.","Project No.");
                                                                                   SettlementQuantityRec.SETRANGE("House Model",HouseModelCde);
                                                                                   SettlementQuantityRec.SETRANGE(Code, "Settlement Quantity Code");
                                                                                   IF SettlementQuantityRec.FINDFIRST THEN
                                                                                     "Version Date" := SettlementQuantityRec."Version Date";
                                                                                 END;

                                                                                 "Project No."  := ProjectCde;

                                                                                 IF Quantity <> 0 THEN BEGIN
                                                                                   IF (LaborTot <> 0) THEN BEGIN
                                                                                     IF TestCostObject(CostObjectLaborTxt) THEN BEGIN
                                                                                       "Cost Object" := DimValRec.Code;
                                                                                       IF NOT DimValRec.Blocked THEN
                                                                                         "Purchase Action" := DimValRec."Purchase Action";
                                                                                     END;
                                                                                     "Cost Type" := "Cost Type"::Labor;
                                                                                     Element := startcode;
                                                                                     Paragraph := '';
                                                                                     Chapter := '';
                                                                                     FillElementPhaseCodeBasedOnElement;
                                                                                     IF Hours <> 0 THEN
                                                                                       "Rate (LCY)" := ROUND((LaborTot/Hours),0.01)
                                                                                     ELSE
                                                                                       "Rate (LCY)" := LaborTot;

                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                     CalcTotals;
                                                                                     "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                     FillDefaultFscType();
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                       INSERT
                                                                                     ELSE
                                                                                       AssignOptionBudget;
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   END;

                                                                                   CLEAR("Cost Object");
                                                                                   CLEAR("Cost Type");
                                                                                   CLEAR("Purchase Action");
                                                                                   "Price (LCY)" := 0;
                                                                                   Norm := 0;
                                                                                   "Rate (LCY)" := 0;
                                                                                   Hours := 0;
                                                                                   "Amount (LCY)" := 0;

                                                                                   IF (MaterialTot <> 0) THEN BEGIN
                                                                                     IF TestCostObject(CostObjectMaterialTxt) THEN BEGIN
                                                                                       "Cost Object" := DimValRec.Code;
                                                                                       IF NOT DimValRec.Blocked THEN
                                                                                         "Purchase Action" := DimValRec."Purchase Action";
                                                                                     END;
                                                                                     "Cost Type" := "Cost Type"::Material;
                                                                                     "Price (LCY)" := MaterialPrice;

                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                     CalcTotals;
                                                                                     "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                     FillDefaultFscType();
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                       INSERT
                                                                                     ELSE
                                                                                       AssignOptionBudget;
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   END;

                                                                                   CLEAR("Cost Object");
                                                                                   CLEAR("Cost Type");
                                                                                   CLEAR("Purchase Action");
                                                                                   "Price (LCY)" := 0;
                                                                                   "Amount (LCY)" := 0;

                                                                                   IF (SubcTot <> 0) THEN BEGIN
                                                                                     IF TestCostObject(CostObjectSubcontrTxt) THEN BEGIN
                                                                                       "Cost Object" := DimValRec.Code;
                                                                                       IF NOT DimValRec.Blocked THEN
                                                                                         "Purchase Action" := DimValRec."Purchase Action";
                                                                                     END;
                                                                                     "Cost Type" := "Cost Type"::Subcontracting;
                                                                                     "Price (LCY)" := SubcPrice;

                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                     CalcTotals;
                                                                                     "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                     FillDefaultFscType();
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                       INSERT
                                                                                     ELSE
                                                                                       AssignOptionBudget;
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   END;

                                                                                   CLEAR("Cost Object");
                                                                                   CLEAR("Cost Type");
                                                                                   CLEAR("Purchase Action");
                                                                                   "Price (LCY)" := 0;
                                                                                   "Amount (LCY)" := 0;

                                                                                   IF (PlantTot <> 0) THEN BEGIN
                                                                                     IF TestCostObject(CostObjectPlantTxt) THEN BEGIN
                                                                                       "Cost Object" := DimValRec.Code;
                                                                                       IF NOT DimValRec.Blocked THEN
                                                                                         "Purchase Action" := DimValRec."Purchase Action";
                                                                                     END;
                                                                                     "Cost Type" := "Cost Type"::Plant;
                                                                                     "Price (LCY)" := PlantPrice;

                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                     CalcTotals;
                                                                                     "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                     FillDefaultFscType();
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                       INSERT
                                                                                     ELSE
                                                                                       AssignOptionBudget;
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   END;

                                                                                   CLEAR("Cost Object");
                                                                                   CLEAR("Cost Type");
                                                                                   CLEAR("Purchase Action");
                                                                                   "Price (LCY)" := 0;
                                                                                   "Amount (LCY)" := 0;

                                                                                 END ELSE BEGIN

                                                                                   IF StatusTxt = 'P' THEN BEGIN
                                                                                     CLEAR("Cost Object");
                                                                                     CLEAR("Cost Type");
                                                                                     CLEAR("Purchase Action");
                                                                                     "Price (LCY)" := 0;
                                                                                     "Amount (LCY)" := 0;
                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                     "Cost Type" := "Cost Type"::Material;
                                                                                     CalcTotals;
                                                                                     "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                       INSERT
                                                                                     ELSE
                                                                                       AssignOptionBudget;
                                                                                     IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   END;
                                                                                 END;

                                                                                 IF "Unit of Measure" <> '' THEN
                                                                                   IF NOT UnitRec.GET("Unit of Measure") THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text999, FIELDCAPTION("Unit of Measure"), "Unit of Measure"));

                                                                                 currXMLport.SKIP;

                                                                                 END;
                                                                               END;
                                                                                }

    { [{6F178248-DA9A-4C5F-A93C-FEF59A4F8D1F}];2 ;DummyTxt            ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{DF510190-4097-4EA8-9409-C8426EE63B46}];2 ;StatusTxt           ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{BB934FB7-D9F7-4B8B-AD15-5F7FCFF27D98}];2 ;DescriptionTxt      ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{A1A3B666-2ABB-4C67-A083-E5C4F668FE70}];2 ;UnitOfMeasure       ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Unit of Measure;
                                                  MinOccurs=Zero }

    { [{3005A888-5087-4814-BBF5-38F1C1FAA2A6}];2 ;QuantityTxt         ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{C533F99D-6093-42A0-8575-5C637446F106}];2 ;NormTxt             ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{39EEC972-D56E-4A69-9F4C-057DEC063B38}];2 ;HoursTxt            ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{08DF83CC-0934-454C-A406-39955573FE93}];2 ;LaborTotTxt         ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{6EC5E8ED-EB3E-4F03-8484-A7BD6D7F0185}];2 ;CostObjectLaborTxt  ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{33A615BC-28E6-484E-AED5-04E973E9A0B3}];2 ;MaterialPriceTxt    ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{78F4A490-D9BF-4895-AD91-47A9EB892BE9}];2 ;MaterialTotTxt      ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{D86707AF-39E8-4501-8DC6-C6DA2489176F}];2 ;CostObjectMaterialTxt;Element;Text    ;
                                                  MinOccurs=Zero }

    { [{11609CB8-5BCD-466C-937C-A76FD2FF1C9D}];2 ;PlantPriceTxt       ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{67348123-F85E-494A-B7DC-53AF16D6927B}];2 ;PlantTotTxt         ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{907F6D96-6917-42C6-ADDB-CE87F746BC49}];2 ;CostObjectPlantTxt  ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{2099E927-6B87-40F8-AE1F-4E11D69A31EA}];2 ;SubcPriceTxt        ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{EAD6341D-69F5-4915-BE1D-85F8711D21C1}];2 ;SubcTotTxt          ;Element ;Text    ;
                                                  MinOccurs=Zero }

    { [{CA539F2D-1085-4E69-AB94-1E444BDB160B}];2 ;CostObjectSubcontrTxt;Element;Text    ;
                                                  MinOccurs=Zero }

    { [{EB36F985-F6C4-4CB1-9803-9CD36B123DE2}];2 ;LineTotalTxt        ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Import::OnAfterAssignVariable=BEGIN
                                                                                  LineTotalTxt := CONVERTSTR(LineTotalTxt, '.', ',');
                                                                                END;
                                                                                 }

  }
  EVENTS
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      ProjRec@1100525044 : Record 11072003;
      BudgetRec@1100525043 : Record 11012001;
      OptionRec@1100525042 : Record 11012502;
      OptionBudgetRec@1100525041 : Record 11012503;
      UnitRec@1100525040 : Record 204;
      DimValRec@1100525039 : Record 349;
      DimMgt@1100525038 : Codeunit 408;
      LaborTot@1100525028 : Decimal;
      MaterialPrice@1100525026 : Decimal;
      MaterialTot@1100525024 : Decimal;
      SubcPrice@1100525022 : Decimal;
      SubcTot@1100525020 : Decimal;
      PlantPrice@1100525018 : Decimal;
      PlantTot@1100525016 : Decimal;
      LineTotal@1100525013 : Decimal;
      ProjectCde@1100525010 : Code[20];
      AdjustmentCde@1100525009 : Code[10];
      ExtensionCde@1100525008 : Code[10];
      PlotCde@1100525007 : Code[20];
      HouseModelCde@1100525006 : Code[20];
      MainGroupCde@1100525005 : Code[20];
      GroupCde@1100525004 : Code[20];
      SubGroupCde@1100525003 : Code[20];
      OptionCde@1100525002 : Code[20];
      LineCounter@1100525001 : Integer;
      startcode@1100525000 : Code[20];
      Text013@1210190000 : TextConst 'ENU=Cost Object %1 is blocked;SVE=Kostnadsobjekt %1 „r blockerad';
      Text999@1100525012 : TextConst 'ENU=%1 %2 not present;SVE=%1 %2 finns inte';
      SettlementQuantityCde@1100528203 : Code[20];
      FromSettlementQuantity@1100528202 : Boolean;
      SettlementQuantityRec@1100528201 : Record 11072243;
      SettlementQuantityBudgetRec@1100528200 : Record 11072244;

    PROCEDURE DetermineSelection@1100525002(lvProject@11012000 : Code[20];lvAdjustment@11012001 : Code[10];lvExtension@11012002 : Code[10];lvHouseModel@1210190003 : Code[20];lvMainGroup@1210190002 : Code[20];lvGroup@1210190001 : Code[20];lvSubGroup@1210190000 : Code[20];lvOption@11012003 : Code[20];lvPlotCde@1100485000 : Code[20]);
    BEGIN
      ProjectCde := lvProject;
      AdjustmentCde := lvAdjustment;
      ExtensionCde := lvExtension;
      PlotCde := lvPlotCde;
      HouseModelCde := lvHouseModel;
      MainGroupCde := lvMainGroup;
      GroupCde := lvGroup;
      SubGroupCde := lvSubGroup;
      OptionCde := lvOption;
    END;

    PROCEDURE AssignOptionBudget@3();
    VAR
      LastLino@11012000 : Integer;
    BEGIN
      IF SettlementQuantityCde <> '' THEN BEGIN
        AssignSettlQuantityBudget;
        EXIT;
      END;

      BudgetRec.COPY("Budget Line");

      OptionBudgetRec.SETRANGE("Project No.",ProjectCde);
      IF PlotCde <> '' THEN
        OptionBudgetRec.SETRANGE("Plot No.",PlotCde)
      ELSE
        OptionBudgetRec.SETFILTER("Plot No.",'%1','');
      OptionBudgetRec.SETRANGE("House Model",HouseModelCde);
      OptionBudgetRec.SETRANGE("Main Group",MainGroupCde);
      OptionBudgetRec.SETRANGE(Group,GroupCde);
      OptionBudgetRec.SETRANGE("Sub Group",SubGroupCde);
      OptionBudgetRec.SETRANGE(Option,OptionCde);
      IF NOT OptionBudgetRec.FINDLAST THEN
        LastLino := 10000
      ELSE
        LastLino := OptionBudgetRec."Line No." + 10000;

      OptionBudgetRec.INIT;
      OptionBudgetRec."Project No." := BudgetRec."Project No.";
      OptionBudgetRec."Plot No." := PlotCde;
      OptionBudgetRec."House Model" := HouseModelCde;
      OptionBudgetRec."Main Group" := MainGroupCde;
      OptionBudgetRec.Group := GroupCde;
      OptionBudgetRec."Sub Group" := SubGroupCde;
      OptionBudgetRec.Option := BudgetRec.Option;
      OptionBudgetRec.Element := BudgetRec.Element;
      OptionBudgetRec."Cost Object" := BudgetRec."Cost Object";
      OptionBudgetRec."Cost Component" := BudgetRec."Cost Component";
      OptionBudgetRec.Description := BudgetRec.Description;
      OptionBudgetRec.Quantity := BudgetRec.Quantity;
      OptionBudgetRec."Unit of Measure" := BudgetRec."Unit of Measure";
      OptionBudgetRec.Norm := BudgetRec.Norm;
      OptionBudgetRec."Rate Code" := BudgetRec."Rate Code";
      OptionBudgetRec.Rate := BudgetRec."Rate (LCY)";
      OptionBudgetRec.Hours := BudgetRec.Hours;
      OptionBudgetRec.Amount := BudgetRec."Amount (LCY)";
      OptionBudgetRec."Line No." := LastLino;
      OptionBudgetRec."Total Amount" := BudgetRec."Total Amount";
      OptionBudgetRec."Total Hours" := BudgetRec."Total Hours";
      OptionBudgetRec."Cost Type" := BudgetRec."Cost Type";
      OptionBudgetRec.Price := BudgetRec."Price (LCY)";
      OptionBudgetRec."Time Quantity" := BudgetRec."Time Quantity";
      OptionBudgetRec."Unit of Time" := BudgetRec."Unit of Time";
      OptionBudgetRec.Chapter := BudgetRec.Chapter;
      OptionBudgetRec.Paragraph := BudgetRec.Paragraph;

      OptionBudgetRec.CheckInsertSummarySheet(FALSE);  //* Must be done before INSERT, because of test 'only when first'.
      OptionBudgetRec.INSERT;
    END;

    PROCEDURE AssignSettlQuantityBudget@1100528205();
    VAR
      LastLino@11012000 : Integer;
    BEGIN
      BudgetRec.COPY("Budget Line");

      SettlementQuantityBudgetRec.SETRANGE("Project No.",ProjectCde);
      SettlementQuantityBudgetRec.SETRANGE("House Model",HouseModelCde);
      SettlementQuantityBudgetRec.SETRANGE("Settlement Quantity Code", SettlementQuantityCde);
      IF NOT SettlementQuantityBudgetRec.FINDLAST THEN
        LastLino := 10000
      ELSE
        LastLino := SettlementQuantityBudgetRec."Line No." + 10000;

      SettlementQuantityBudgetRec.INIT;
      SettlementQuantityBudgetRec."Project No." := BudgetRec."Project No.";
      SettlementQuantityBudgetRec."Settlement Quantity Code":= BudgetRec."Settlement Quantity Code";
      SettlementQuantityBudgetRec."House Model" := HouseModelCde;
      SettlementQuantityBudgetRec."Line No." := LastLino;
      SettlementQuantityBudgetRec.Element := BudgetRec.Element;
      SettlementQuantityBudgetRec."Cost Type" := BudgetRec."Cost Type";
      SettlementQuantityBudgetRec."Cost Object" := BudgetRec."Cost Object";
      SettlementQuantityBudgetRec.Description := BudgetRec.Description;
      SettlementQuantityBudgetRec."Cost Component" := BudgetRec."Cost Component";
      SettlementQuantityBudgetRec.Quantity := BudgetRec.Quantity;
      SettlementQuantityBudgetRec."Unit of Measure" := BudgetRec."Unit of Measure";
      SettlementQuantityBudgetRec.Norm := BudgetRec.Norm;
      SettlementQuantityBudgetRec."Rate Code" := BudgetRec."Rate Code";
      SettlementQuantityBudgetRec.Rate := BudgetRec."Rate (LCY)";
      SettlementQuantityBudgetRec.Hours := BudgetRec.Hours;
      SettlementQuantityBudgetRec.Amount := BudgetRec."Amount (LCY)";
      SettlementQuantityBudgetRec."Total Amount" := BudgetRec."Total Amount";
      SettlementQuantityBudgetRec."Total Hours" := BudgetRec."Total Hours";
      SettlementQuantityBudgetRec.Price := BudgetRec."Price (LCY)";
      SettlementQuantityBudgetRec."Time Quantity" := BudgetRec."Time Quantity";
      SettlementQuantityBudgetRec."Unit of Time" := BudgetRec."Unit of Time";
      SettlementQuantityBudgetRec.Chapter := BudgetRec.Chapter;
      SettlementQuantityBudgetRec.Paragraph := BudgetRec.Paragraph;

      SettlementQuantityBudgetRec.CheckInsertSummarySheet(FALSE);  //* Must be done before INSERT, because of test 'only when first'.
      SettlementQuantityBudgetRec.INSERT;
    END;

    PROCEDURE TestCostObject@1210190007(lCostObject@1210190000 : Code[10]) Exist : Boolean;
    BEGIN
      DimMgt.GetDimValueRec(2,lCostObject, DimValRec, FALSE,'');
      IF DimValRec.Code = '' THEN
        EXIT(FALSE);

      IF DimValRec.Blocked THEN
        StoreMessage("Budget Line".Description, STRSUBSTNO(Text013,lCostObject));  // Not 'EXIT(FALSE)' if blocked!

      EXIT(TRUE);
    END;

    PROCEDURE StoreMessage@5("Line Description"@11012000 : Text[100];ErrorText@11012001 : Text[80]);
    VAR
      ErrorRec@1210190000 : Record 11012051;
      lvError@11012002 : Integer;
    BEGIN
      IF ErrorRec.FINDLAST THEN
        lvError := ErrorRec."Line No." + 1
      ELSE
        lvError := 1;
      ErrorRec.INIT;
      ErrorRec."User ID" := USERID;
      ErrorRec."Source Type" := ErrorRec."Source Type"::"Import Budget";
      ErrorRec."Line No." := lvError;
      ErrorRec."Project No." := ProjRec."No.";
      ErrorRec."Error message" := ErrorText;
      ErrorRec.Description := "Line Description";
      ErrorRec.INSERT;
    END;

    PROCEDURE CheckUpdateOption@1100485000();
    VAR
      lvDummyOptionSurchRec@1100485001 : Record 11012512;
      lvBuyerMgtCU@1100485000 : Codeunit 11012500;
    BEGIN
      IF OptionCde = '' THEN
        EXIT;

      lvBuyerMgtCU.BmCalcSurchargesUpdateOption(
        ProjectCde, PlotCde, HouseModelCde, MainGroupCde, GroupCde, SubGroupCde, OptionCde, FALSE, lvDummyOptionSurchRec);
    END;

    PROCEDURE DefaultCostComponent@1100485001(lvCostObject@1100485000 : Code[20];lvProject@1100485001 : Code[20]) lvCostComponent : Code[20];
    VAR
      lvDimValRec@1100485002 : Record 349;
    BEGIN
      lvCostComponent := '';
      IF lvCostObject <> '' THEN BEGIN
        DimMgt.GetDimValueRec(2, lvCostObject, lvDimValRec, FALSE, lvProject);
        IF NOT lvDimValRec.Blocked THEN
          lvCostComponent := lvDimValRec."Cost Component";
      END;
    END;

    PROCEDURE SetDefaultsSettlQuantity@1100528203(ISettlementQuantityCde@11012000 : Code[20]);
    BEGIN
      IF SettlementQuantityRec.WRITEPERMISSION AND SettlementQuantityBudgetRec.WRITEPERMISSION THEN BEGIN
        FromSettlementQuantity := TRUE;
        SettlementQuantityCde := ISettlementQuantityCde;
      END ELSE BEGIN
        FromSettlementQuantity := FALSE;
        SettlementQuantityCde := '';
      END;
    END;

    PROCEDURE CheckUpdateSettlQuantity@1100528200();
    VAR
      lvDummySettlementQuantitySurcharge@1100485001 : Record 11072247;
      lvSettlementQuantityManagement@1100485000 : Codeunit 11071690;
    BEGIN
      IF SettlementQuantityCde = '' THEN
        EXIT;

      lvSettlementQuantityManagement.MMRCalcSurchargesUpdateSettlQuan(
        ProjectCde, HouseModelCde, SettlementQuantityCde, FALSE,lvDummySettlementQuantitySurcharge)
    END;

    BEGIN
    END.
  }
}

