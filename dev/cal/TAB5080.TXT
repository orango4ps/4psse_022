OBJECT Table 5080 To-do
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.01,4PS14.00;
  }
  PROPERTIES
  {
    DataCaptionFields=No.,Description;
    OnInsert=BEGIN
               IF "No." = '' THEN BEGIN
                 RMSetup.GET;
                 RMSetup.TESTFIELD("To-do Nos.");
                 NoSeriesMgt.InitSeries(RMSetup."To-do Nos.",xRec."No. Series",0D,"No.","No. Series");
               END;
               IF (("System To-do Type" = "System To-do Type"::Organizer) AND
                   ("Team Code" = '')) OR
                  ("System To-do Type" = "System To-do Type"::Team)
               THEN
                 "Organizer To-do No." := "No.";
               "Modified by" := USERID; //**4PS.n
               "Last Date Modified" := TODAY;
               "Last Time Modified" := TIME;
               "Planned by" := USERID; //**4PS
               "Planned on" := TODAY;  //**4PS
             END;

    OnModify=BEGIN
               IF "No." <> '' THEN BEGIN
                 "Last Date Modified" := TODAY;
                 "Last Time Modified" := TIME;
                 "Modified by" := USERID; //**4PS.n

                 UpdateAttendeeTasks("No.");
               END;
             END;

    OnDelete=VAR
               Attendee@1001 : Record 5199;
               Task@1000 : Record 5080;
               TaskInteractionLanguage@1002 : Record 5196;
               RMCommentLine@1003 : Record 5061;
               CRMPortalAppointment@1100525000 : Record 11128542;
             BEGIN
               RMCommentLine.SETRANGE("Table Name",RMCommentLine."Table Name"::"To-do");
               RMCommentLine.SETRANGE("No.","No.");
               RMCommentLine.DELETEALL;
               Task.SETRANGE("Organizer To-do No.","No.");
               Task.SETFILTER("No.",'<>%1',"No.");
               IF Task.FINDFIRST THEN
                 Task.DELETEALL;

               Attendee.SETRANGE("To-do No.","No.");
               Attendee.DELETEALL;

               TaskInteractionLanguage.SETRANGE("To-do No.","No.");
               TaskInteractionLanguage.DELETEALL(TRUE);

               //**4PS.sn
               CRMPortalAppointment.SETCURRENTKEY("To-do No.");
               CRMPortalAppointment.SETRANGE("To-do No.","No.");
               CRMPortalAppointment.DELETEALL;
               //**4PS.en
             END;

    CaptionML=[ENU=Task;
               NOR=Oppgave;
               SVE=Uppgift];
    LookupPageID=Page5096;
    DrillDownPageID=Page5096;
  }
  FIELDS
  {
    { 1   ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  RMSetup.GET;
                                                                  NoSeriesMgt.TestManual(RMSetup."To-do Nos.");
                                                                  "No. Series" := '';
                                                                  IF ("System To-do Type" = "System To-do Type"::Organizer) OR
                                                                     ("System To-do Type" = "System To-do Type"::Team)
                                                                  THEN
                                                                    UpdateAttendeeTasks(xRec."No.");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr.;
                                                              SVE=Nr] }
    { 2   ;   ;Team Code           ;Code10        ;TableRelation=Team;
                                                   OnValidate=BEGIN
                                                                IF ("Team Code" <> xRec."Team Code") AND
                                                                   ("No." <> '') AND
                                                                   IsCalledFromForm
                                                                THEN BEGIN
                                                                  IF ("Team Code" = '') AND ("Salesperson Code" = '') THEN
                                                                    ERROR(Text035,FIELDCAPTION("Salesperson Code"),FIELDCAPTION("Team Code"));
                                                                  IF xRec."Team Code" <> '' THEN BEGIN
                                                                    IF Closed THEN BEGIN
                                                                      IF CONFIRM(STRSUBSTNO(Text039,"No.",xRec."Team Code","Team Code")) THEN BEGIN
                                                                        ChangeTeam;
                                                                        GET("No.");
                                                                        VALIDATE(Closed,FALSE);
                                                                      END ELSE
                                                                        "Team Code" := xRec."Team Code"
                                                                    END ELSE BEGIN
                                                                      IF CONFIRM(STRSUBSTNO(TasksWillBeDeletedQst,xRec."Team Code","Team Code")) THEN
                                                                        ChangeTeam
                                                                      ELSE
                                                                        "Team Code" := xRec."Team Code"
                                                                    END
                                                                  END ELSE BEGIN
                                                                    IF Closed THEN BEGIN
                                                                      IF CONFIRM(STRSUBSTNO(Text042,"No.","Team Code")) THEN BEGIN
                                                                        ReassignSalespersonTaskToTeam;
                                                                        GET("No.");
                                                                        VALIDATE(Closed,FALSE);
                                                                      END ELSE
                                                                        "Team Code" := ''
                                                                    END ELSE
                                                                      ReassignSalespersonTaskToTeam;
                                                                  END
                                                                END
                                                              END;

                                                   CaptionML=[ENU=Team Code;
                                                              NOR=Prosjektgruppekode;
                                                              SVE=Teamkod] }
    { 3   ;   ;Salesperson Code    ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   OnValidate=BEGIN
                                                                IF (xRec."Salesperson Code" <> "Salesperson Code") AND
                                                                   ("No." <> '') AND
                                                                   IsCalledFromForm
                                                                THEN BEGIN
                                                                  IF ("Team Code" = '') AND ("Salesperson Code" = '') THEN
                                                                    ERROR(Text035,FIELDCAPTION("Salesperson Code"),FIELDCAPTION("Team Code"));
                                                                  IF (Type = Type::Meeting) AND ("Team Code" = '') THEN
                                                                    ERROR(Text009,FIELDCAPTION("Salesperson Code"));

                                                                  IF "Team Code" <> '' THEN BEGIN
                                                                    IF Type = Type::Meeting THEN
                                                                      IF Closed THEN
                                                                        IF CONFIRM(STRSUBSTNO(Text040,"No.","Salesperson Code")) THEN BEGIN
                                                                          ReassignTeamTaskToSalesperson;
                                                                          GET("No.");
                                                                          VALIDATE(Closed,FALSE);
                                                                        END ELSE
                                                                          "Salesperson Code" := xRec."Salesperson Code"
                                                                      ELSE
                                                                        IF CONFIRM(STRSUBSTNO(Text033,"No.","Salesperson Code")) THEN
                                                                          ReassignTeamTaskToSalesperson
                                                                        ELSE
                                                                          "Salesperson Code" := xRec."Salesperson Code"
                                                                    ELSE
                                                                      IF Closed THEN
                                                                        IF CONFIRM(STRSUBSTNO(Text041,"No.","Salesperson Code")) THEN BEGIN
                                                                          ReassignTeamTaskToSalesperson;
                                                                          GET("No.");
                                                                          VALIDATE(Closed,FALSE);
                                                                        END ELSE
                                                                          "Salesperson Code" := xRec."Salesperson Code"
                                                                      ELSE
                                                                        IF CONFIRM(STRSUBSTNO(Text032,"No.","Salesperson Code")) THEN
                                                                          ReassignTeamTaskToSalesperson
                                                                        ELSE
                                                                          "Salesperson Code" := xRec."Salesperson Code"
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Salesperson Code;
                                                              NOR=Selgerkode;
                                                              SVE=SÑljarkod] }
    { 4   ;   ;Campaign No.        ;Code20        ;TableRelation=Campaign;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Campaign Description"); //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Campaign No.;
                                                              NOR=Kampanjenr.;
                                                              SVE=Kampanjnr] }
    { 5   ;   ;Contact No.         ;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                TempAttendee@1000 : TEMPORARY Record 5199;
                                                              BEGIN
                                                                IF Cont.GET("Contact No.") THEN
                                                                  "Contact Company No." := Cont."Company No."
                                                                ELSE
                                                                  CLEAR("Contact Company No.");

                                                                IF ("No." <> '') AND
                                                                   ("No." = "Organizer To-do No.") AND
                                                                   ("Contact No." <> xRec."Contact No.") AND
                                                                   (Type <> Type::Meeting)
                                                                THEN
                                                                  CASE TRUE OF
                                                                    (xRec."Contact No." = '') AND ("Contact No." <> ''):
                                                                      BEGIN
                                                                        TempAttendee.CreateAttendee(
                                                                          TempAttendee,
                                                                          "No.",10000,TempAttendee."Attendance Type"::Required,
                                                                          TempAttendee."Attendee Type"::Contact,
                                                                          "Contact No.",FALSE);
                                                                        CreateSubTask(TempAttendee,Rec);
                                                                      END;
                                                                    (xRec."Contact No." <> '') AND ("Contact No." = ''):
                                                                      BEGIN
                                                                        TempAttendee.CreateAttendee(
                                                                          TempAttendee,
                                                                          "No.",10000,TempAttendee."Attendance Type"::Required,
                                                                          TempAttendee."Attendee Type"::Contact,
                                                                          xRec."Contact No.",FALSE);
                                                                        DeleteAttendeeTask(TempAttendee);
                                                                      END;
                                                                    xRec."Contact No." <> "Contact No.":
                                                                      BEGIN
                                                                        TempAttendee.CreateAttendee(
                                                                          TempAttendee,
                                                                          "No.",10000,TempAttendee."Attendance Type"::Required,
                                                                          TempAttendee."Attendee Type"::Contact,
                                                                          xRec."Contact No.",FALSE);
                                                                        DeleteAttendeeTask(TempAttendee);
                                                                        TempAttendee.CreateAttendee(
                                                                          TempAttendee,
                                                                          "No.",20000,TempAttendee."Attendance Type"::Required,
                                                                          TempAttendee."Attendee Type"::Contact,
                                                                          "Contact No.",FALSE);
                                                                        CreateSubTask(TempAttendee,Rec);
                                                                      END;
                                                                  END;
                                                                //**4PS.sn
                                                                CALCFIELDS("Contact Name", "Contact Company Name");
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Contact No.;
                                                              NOR=Kontaktnr.;
                                                              SVE=Kontaktnr] }
    { 6   ;   ;Opportunity No.     ;Code20        ;TableRelation=Opportunity;
                                                   OnValidate=VAR
                                                                OppEntry@1001 : Record 5093;
                                                              BEGIN
                                                                OppEntry.RESET;
                                                                OppEntry.SETCURRENTKEY(Active,"Opportunity No.");
                                                                OppEntry.SETRANGE(Active,TRUE);
                                                                OppEntry.SETRANGE("Opportunity No.","Opportunity No.");
                                                                IF OppEntry.FINDFIRST THEN
                                                                  "Opportunity Entry No." := OppEntry."Entry No."
                                                                ELSE
                                                                  "Opportunity Entry No." := 0;
                                                              END;

                                                   CaptionML=[ENU=Opportunity No.;
                                                              NOR=Salgsmulighetsnr.;
                                                              SVE=AffÑrsmîjlighetsnr] }
    { 7   ;   ;Segment No.         ;Code20        ;TableRelation="Segment Header";
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Segment No.;
                                                              NOR=Segmentnr.;
                                                              SVE=Segmentnr] }
    { 8   ;   ;Type                ;Option        ;OnValidate=VAR
                                                                OldEndDate@1000 : Date;
                                                              BEGIN
                                                                IF "No." <> '' THEN BEGIN
                                                                  IF ((xRec.Type = Type::Meeting) AND (Type <> Type::Meeting)) OR
                                                                     ((xRec.Type <> Type::Meeting) AND (Type = Type::Meeting))
                                                                  THEN
                                                                    ERROR(Text012);
                                                                END ELSE BEGIN
                                                                  IF CurrFieldNo = 0 THEN
                                                                    EXIT;

                                                                  IF xRec.Type <> Type::Meeting THEN
                                                                    TempEndDateTime := CREATEDATETIME(xRec.Date,xRec."Start Time") - OneDayDuration + xRec.Duration
                                                                  ELSE
                                                                    TempEndDateTime := CREATEDATETIME(xRec.Date,xRec."Start Time") + xRec.Duration;

                                                                  OldEndDate := DT2DATE(TempEndDateTime);

                                                                  IF (xRec.Type = Type::Meeting) AND (Type <> Type::Meeting) THEN BEGIN
                                                                    "Start Time" := 0T;
                                                                    "All Day Event" := FALSE;
                                                                    SetDuration(OldEndDate,0T);
                                                                  END;

                                                                  IF (xRec.Type <> Type::Meeting) AND (Type = Type::Meeting) THEN BEGIN
                                                                    "Start Time" := 0T;
                                                                    IF OldEndDate = Date THEN BEGIN
                                                                      SetDuration(OldEndDate,DT2TIME(CREATEDATETIME(OldEndDate,0T) + 30 * 60 * 1000));
                                                                    END ELSE
                                                                      SetDuration(OldEndDate,0T);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Type;
                                                              NOR=Type;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=[ENU=" ,Meeting,Phone Call";
                                                                    NOR=" ,Mõte,Telefonsamtale";
                                                                    SVE=" ,Mîte,Telefonsamtal"];
                                                   OptionString=[ ,Meeting,Phone Call] }
    { 9   ;   ;Date                ;Date          ;OnValidate=BEGIN
                                                                IF (Date < DMY2DATE(1,1,1900)) OR (Date > DMY2DATE(31,12,2999)) THEN
                                                                  ERROR(Text006,DMY2DATE(1,1,1900),DMY2DATE(31,12,2999));

                                                                IF Date <> xRec.Date THEN
                                                                  GetEndDateTime;
                                                              END;

                                                   CaptionML=[ENU=Date;
                                                              NOR=Dato;
                                                              SVE=Datum];
                                                   NotBlank=Yes }
    { 10  ;   ;Status              ;Option        ;OnValidate=BEGIN
                                                                //**4PS.so
                                                                //IF Status = Status::Completed THEN
                                                                //  VALIDATE(Closed,TRUE)
                                                                //ELSE
                                                                //  VALIDATE(Closed,FALSE);
                                                                //**4PS.eo
                                                                //**4PS.sn
                                                                IF Closed <> (Status = Status::Completed) THEN
                                                                  VALIDATE(Closed, (Status = Status::Completed));
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=[ENU=Not Started,In Progress,Completed,Waiting,Postponed;
                                                                    NOR=Ikke startet,I arbeid,Ferdig,Venter,Utsatt;
                                                                    SVE=Ej pÜbîrjad,PÜgÜende,Slutfîrd,VÑntar,Uppskjuten];
                                                   OptionString=Not Started,In Progress,Completed,Waiting,Postponed }
    { 11  ;   ;Priority            ;Option        ;InitValue=Normal;
                                                   CaptionML=[ENU=Priority;
                                                              NOR=Prioritet;
                                                              SVE=Prioritet];
                                                   OptionCaptionML=[ENU=Low,Normal,High;
                                                                    NOR=Lav,Normal,Hõy;
                                                                    SVE=LÜg,Normal,Hîg];
                                                   OptionString=Low,Normal,High }
    { 12  ;   ;Description         ;Text100       ;OnValidate=BEGIN
                                                                AddCommentLine; //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 13  ;   ;Closed              ;Boolean       ;OnValidate=VAR
                                                                lInteractionLogEntry@1210190000 : Record 11072027;
                                                                LicensePermissionRec@1100525000 : Record 2000000043;
                                                                Task@1100528700 : Record 5080;
                                                                DoCreateInteraction@1100525001 : Boolean;
                                                                FPSLicenseManagement@1100528500 : Codeunit 11229289;
                                                              BEGIN
                                                                IF Closed THEN BEGIN
                                                                  "Date Closed" := TODAY;
                                                                  Status := Status::Completed;
                                                                  IF NOT Canceled THEN BEGIN
                                                                    IF ("Team Code" <> '') AND
                                                                       ("Completed By" = '')
                                                                    THEN
                                                                      ERROR(Text029,FIELDCAPTION("Completed By"));
                                                                //**4PS.so
                                                                //    IF CurrFieldNo <> 0 THEN
                                                                //      IF CONFIRM(Text004,TRUE) THEN
                                                                //        CreateInteraction;
                                                                //**4PS.eo

                                                                //**4PS.sn
                                                                    // Only ask for creating interact. log if table and form are in license
                                                                    IF FPSLicenseManagement.LicenseAndReadPermissionForTable(lInteractionLogEntry) THEN
                                                                      IF LicensePermissionRec.GET(LicensePermissionRec."Object Type"::Page, PAGE::"Create Interaction") THEN
                                                                        IF LicensePermissionRec."Execute Permission" = LicensePermissionRec."Execute Permission"::Yes THEN BEGIN
                                                                          IF GUIALLOWED THEN
                                                                            DoCreateInteraction := CONFIRM(Text004,TRUE)
                                                                          ELSE
                                                                            DoCreateInteraction := TRUE;
                                                                          IF DoCreateInteraction THEN BEGIN
                                                                            IF "Contact No." = '' THEN BEGIN
                                                                              Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
                                                                              Task.SETRANGE("Organizer To-do No.", "Organizer To-do No.");
                                                                              Task.SETFILTER("Contact No.", '<>%1', '');
                                                                              Task.FINDFIRST;
                                                                            END ELSE
                                                                              Task.GET("No.");
                                                                            Task.CreateInteraction;
                                                                          END;
                                                                        END;
                                                                //**4PS.en
                                                                  END;
                                                                  IF Recurring THEN
                                                                    CreateRecurringTask;
                                                                END ELSE BEGIN
                                                                  Canceled := FALSE;
                                                                  "Date Closed" := 0D;
                                                                  IF Status = Status::Completed THEN
                                                                    Status := Status::"In Progress";
                                                                  IF "Completed By" <> '' THEN
                                                                    "Completed By" := ''
                                                                END;
                                                                IF CurrFieldNo <> 0 THEN
                                                                  MODIFY(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Closed;
                                                              NOR=Lukket;
                                                              SVE=StÑngd] }
    { 14  ;   ;Date Closed         ;Date          ;OnValidate=BEGIN
                                                                //**4PS.sn
                                                                IF (("Date Closed" <> 0D) AND NOT Closed) OR
                                                                   (("Date Closed" = 0D) AND Closed)
                                                                THEN
                                                                  VALIDATE(Closed, ("Date Closed" <> 0D));
                                                                 //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Date Closed;
                                                              NOR=Lukket den;
                                                              SVE=Avslutsdatum] }
    { 15  ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr.serie;
                                                              SVE=Nr-serie];
                                                   Editable=No }
    { 16  ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Rlshp. Mgt. Comment Line" WHERE (Table Name=CONST(To-do),
                                                                                                       No.=FIELD(Organizer To-do No.),
                                                                                                       Sub No.=CONST(0)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Merknad;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 17  ;   ;Canceled            ;Boolean       ;OnValidate=BEGIN
                                                                IF Canceled AND NOT Closed THEN
                                                                  VALIDATE(Closed,TRUE);
                                                                IF (NOT Canceled) AND Closed THEN
                                                                  VALIDATE(Closed,FALSE);
                                                              END;

                                                   CaptionML=[ENU=Canceled;
                                                              NOR=Avbrutt;
                                                              SVE=Avbruten] }
    { 18  ;   ;Contact Name        ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact No.)));
                                                   CaptionML=[ENU=Contact Name;
                                                              NOR=Kontaktnavn;
                                                              SVE=Kontaktnamn];
                                                   Editable=No }
    { 19  ;   ;Team Name           ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Team.Name WHERE (Code=FIELD(Team Code)));
                                                   CaptionML=[ENU=Team Name;
                                                              NOR=Navn pÜ prosjektgruppe;
                                                              SVE=Teamnamn];
                                                   NotBlank=No;
                                                   Editable=No }
    { 20  ;   ;Salesperson Name    ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Salesperson Code)));
                                                   CaptionML=[ENU=Salesperson Name;
                                                              NOR=Selgernavn;
                                                              SVE=SÑljarnamn];
                                                   Editable=No }
    { 21  ;   ;Campaign Description;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Campaign.Description WHERE (No.=FIELD(Campaign No.)));
                                                   CaptionML=[ENU=Campaign Description;
                                                              NOR=Kampanjebeskrivelse;
                                                              SVE=Kampanjbeskrivning];
                                                   Editable=No }
    { 22  ;   ;Contact Company No. ;Code20        ;TableRelation=Contact WHERE (Type=CONST(Company));
                                                   OnValidate=BEGIN
                                                                //**4PS.sn
                                                                CALCFIELDS("Contact Company Name");
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Contact Company No.;
                                                              NOR=Kontaktselskapets nr.;
                                                              SVE=Kontaktfîretag nr] }
    { 23  ;   ;Contact Company Name;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact Company No.)));
                                                   CaptionML=[ENU=Contact Company Name;
                                                              NOR=Kontaktselskapets navn;
                                                              SVE=Kontaktfîretag namn];
                                                   Editable=No }
    { 24  ;   ;Recurring           ;Boolean       ;CaptionML=[ENU=Recurring;
                                                              NOR=Gjentakende;
                                                              SVE=èterkommande] }
    { 25  ;   ;Recurring Date Interval;DateFormula;OnValidate=BEGIN
                                                                IF Recurring THEN
                                                                  TESTFIELD("Recurring Date Interval");
                                                              END;

                                                   CaptionML=[ENU=Recurring Date Interval;
                                                              NOR=Gjentakende datointervall;
                                                              SVE=èterkommande datumintervall] }
    { 26  ;   ;Calc. Due Date From ;Option        ;OnValidate=BEGIN
                                                                IF Recurring THEN
                                                                  TESTFIELD("Calc. Due Date From");
                                                              END;

                                                   CaptionML=[ENU=Calc. Due Date From;
                                                              NOR=Beregn forf.dato fra;
                                                              SVE=BerÑkna fîrfallodatum frÜn];
                                                   OptionCaptionML=[ENU=" ,Due Date,Closing Date";
                                                                    NOR=" ,Forfallsdato,Avslutningsdato";
                                                                    SVE=" ,Fîrfallodatum,Avslutsdatum"];
                                                   OptionString=[ ,Due Date,Closing Date] }
    { 27  ;   ;Opportunity Description;Text100    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Opportunity.Description WHERE (No.=FIELD(Opportunity No.)));
                                                   CaptionML=[ENU=Opportunity Description;
                                                              NOR=Beskrivelse av salgsmulighet;
                                                              SVE=Beskrivning av affÑrsmîjlighet];
                                                   Editable=No }
    { 28  ;   ;Start Time          ;Time          ;OnValidate=BEGIN
                                                                IF "Start Time" <> xRec."Start Time" THEN
                                                                  GetEndDateTime;
                                                              END;

                                                   CaptionML=[ENU=Start Time;
                                                              NOR=Starttidspunkt;
                                                              SVE=Starttid] }
    { 29  ;   ;Duration            ;Duration      ;OnValidate=BEGIN
                                                                IF Duration < 0 THEN
                                                                  ERROR(Text005);

                                                                IF Duration < (60 * 1000) THEN
                                                                  ERROR(Text007);

                                                                IF Duration > (CREATEDATETIME(TODAY + 3650,0T) - CREATEDATETIME(TODAY,0T)) THEN
                                                                  ERROR(Text008);

                                                                IF Duration <> xRec.Duration THEN
                                                                  GetEndDateTime;
                                                              END;

                                                   CaptionML=[ENU=Duration;
                                                              NOR=Varighet;
                                                              SVE=Varaktighet] }
    { 31  ;   ;Opportunity Entry No.;Integer      ;TableRelation="Opportunity Entry";
                                                   CaptionML=[ENU=Opportunity Entry No.;
                                                              NOR=Lõpenr. for salgsmulighet;
                                                              SVE=AffÑrsmîjlighet lîpnr] }
    { 32  ;   ;Last Date Modified  ;Date          ;CaptionML=[ENU=Last Date Modified;
                                                              NOR=Endret den;
                                                              SVE=Uppdateringsdatum];
                                                   Editable=No }
    { 33  ;   ;Last Time Modified  ;Time          ;CaptionML=[ENU=Last Time Modified;
                                                              NOR=Sist endret;
                                                              SVE=Uppdateringstid];
                                                   Editable=No }
    { 34  ;   ;All Day Event       ;Boolean       ;OnValidate=BEGIN
                                                                IF "All Day Event" THEN BEGIN
                                                                  "Start Time" := 0T;
                                                                  TempStartDateTime := CREATEDATETIME(Date,"Start Time");
                                                                  TempEndDateTime := TempStartDateTime + Duration;
                                                                  IF DT2DATE(TempEndDateTime) = Date THEN
                                                                    Duration := 1440 * 1000 * 60
                                                                  ELSE
                                                                    Duration := ROUNDDATETIME(TempEndDateTime + 1,1440 * 1000 * 60,'>') - TempStartDateTime;
                                                                END ELSE
                                                                  Duration := Duration - 1440 * 1000 * 60;
                                                              END;

                                                   CaptionML=[ENU=All Day Event;
                                                              NOR=Hele dagen;
                                                              SVE=Hela dagen] }
    { 35  ;   ;Location            ;Text100       ;CaptionML=[ENU=Location;
                                                              NOR=Lokasjon;
                                                              SVE=LagerstÑlle] }
    { 36  ;   ;Organizer To-do No. ;Code20        ;TableRelation=To-do;
                                                   CaptionML=[ENU=Organizer Task No.;
                                                              NOR=Arrangõroppgavenr.;
                                                              SVE=Organisatîrens uppgiftsnr.] }
    { 37  ;   ;Interaction Template Code;Code10   ;TableRelation="Interaction Template";
                                                   OnValidate=VAR
                                                                TaskInteractionLanguage@1000 : Record 5196;
                                                                Attachment@1001 : Record 11072030;
                                                              BEGIN
                                                                IF "No." <> '' THEN
                                                                  UpdateInteractionTemplate(
                                                                    Rec,TaskInteractionLanguage,Attachment,"Interaction Template Code",FALSE);
                                                              END;

                                                   CaptionML=[ENU=Interaction Template Code;
                                                              NOR=Samhandlingsmal - kode;
                                                              SVE=Interaktionsmallkod] }
    { 38  ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   OnValidate=VAR
                                                                TaskInteractionLanguage@1000 : Record 5196;
                                                              BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  MODIFY;

                                                                IF "Language Code" = xRec."Language Code" THEN
                                                                  EXIT;

                                                                IF NOT TaskInteractionLanguage.GET("No.","Language Code") THEN BEGIN
                                                                  IF "No." = '' THEN
                                                                    EXIT;
                                                                  IF CurrFieldNo <> 0 THEN
                                                                    IF CONFIRM(Text010,TRUE,TaskInteractionLanguage.TABLECAPTION,"Language Code") THEN BEGIN
                                                                      TaskInteractionLanguage.INIT;
                                                                      TaskInteractionLanguage."To-do No." := "No.";
                                                                      TaskInteractionLanguage."Language Code" := "Language Code";
                                                                      TaskInteractionLanguage.Description := FORMAT("Interaction Template Code") + ' ' + FORMAT("Language Code");
                                                                      TaskInteractionLanguage.INSERT(TRUE);
                                                                      "Attachment No." := 0;
                                                                      MODIFY;
                                                                    END ELSE
                                                                      ERROR('');
                                                                END ELSE
                                                                  "Attachment No." := TaskInteractionLanguage."Attachment No.";
                                                              END;

                                                   OnLookup=VAR
                                                              TaskInteractionLanguage@1000 : Record 5196;
                                                            BEGIN
                                                              MODIFY;
                                                              COMMIT;

                                                              TaskInteractionLanguage.SETRANGE("To-do No.","Organizer To-do No.");
                                                              IF TaskInteractionLanguage.GET("Organizer To-do No.","Language Code") THEN;
                                                              IF PAGE.RUNMODAL(0,TaskInteractionLanguage) = ACTION::LookupOK THEN BEGIN
                                                                IF ("System To-do Type" = "System To-do Type"::Organizer) OR
                                                                   ("System To-do Type" = "System To-do Type"::Team)
                                                                THEN
                                                                  IF NOT TaskInteractionLanguage.ISEMPTY THEN BEGIN
                                                                    "Language Code" := TaskInteractionLanguage."Language Code";
                                                                    "Attachment No." := TaskInteractionLanguage."Attachment No.";
                                                                  END ELSE BEGIN
                                                                    "Language Code" := '';
                                                                    "Attachment No." := 0;
                                                                  END;
                                                              END ELSE
                                                                IF NOT TaskInteractionLanguage.ISEMPTY THEN BEGIN
                                                                  IF "Language Code" = TaskInteractionLanguage."Language Code" THEN
                                                                    "Attachment No." := TaskInteractionLanguage."Attachment No.";
                                                                END ELSE BEGIN
                                                                  "Language Code" := '';
                                                                  "Attachment No." := 0;
                                                                END;
                                                            END;

                                                   CaptionML=[ENU=Language Code;
                                                              NOR=SprÜkkode;
                                                              SVE=SprÜkkod] }
    { 39  ;   ;Attachment No.      ;Integer       ;CaptionML=[ENU=Attachment No.;
                                                              NOR=Vedleggsnr.;
                                                              SVE=Bilagenr] }
    { 40  ;   ;Subject             ;Text100       ;OnValidate=BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Subject;
                                                              NOR=Emne;
                                                              SVE=AngÜende] }
    { 41  ;   ;Unit Cost (LCY)     ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Unit Cost (LCY);
                                                              NOR=Enhetskost (NOK);
                                                              SVE=Styckkostnad (BVA)];
                                                   DecimalPlaces=2:2 }
    { 42  ;   ;Unit Duration (Min.);Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Unit Duration (Min.);
                                                              NOR=Varighet (min.);
                                                              SVE=Interaktionstid (min.)];
                                                   DecimalPlaces=0:2 }
    { 43  ;   ;No. of Attendees    ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count(Attendee WHERE (To-do No.=FIELD(Organizer To-do No.)));
                                                   CaptionML=[ENU=No. of Attendees;
                                                              NOR=Ant. deltakere;
                                                              SVE=Antal deltagare];
                                                   Editable=No }
    { 44  ;   ;Attendees Accepted No.;Integer     ;FieldClass=FlowField;
                                                   CalcFormula=Count(Attendee WHERE (To-do No.=FIELD(Organizer To-do No.),
                                                                                     Invitation Response Type=CONST(Accepted)));
                                                   CaptionML=[ENU=Attendees Accepted No.;
                                                              NOR=Ant. deltakere som har godtatt;
                                                              SVE=Antal deltagare som bekrÑftat];
                                                   Editable=No }
    { 45  ;   ;System To-do Type   ;Option        ;CaptionML=[ENU=System Task Type;
                                                              NOR=Systemoppgavetype;
                                                              SVE=Systemuppgiftstyp];
                                                   OptionCaptionML=[ENU=Organizer,Salesperson Attendee,Contact Attendee,Team;
                                                                    NOR=Arrangõr,Selgers deltaker,Kontaktens deltaker,Prosjektgruppe;
                                                                    SVE=Organisatîr,SÑljdeltagare,Kontaktdeltagare,Team];
                                                   OptionString=Organizer,Salesperson Attendee,Contact Attendee,Team }
    { 46  ;   ;Completed By        ;Code20        ;TableRelation=Salesperson/Purchaser.Code;
                                                   OnValidate=BEGIN
                                                                IF (xRec."Completed By" = '') AND
                                                                   ("Completed By" <> '')
                                                                THEN
                                                                  IF CONFIRM(Text034) THEN
                                                                    VALIDATE(Closed,TRUE)
                                                                  ELSE
                                                                    "Completed By" := '';
                                                              END;

                                                   DataClassification=EndUserIdentifiableInformation;
                                                   CaptionML=[ENU=Completed By;
                                                              NOR=Fullfõrt av;
                                                              SVE=Avslutad av] }
    { 47  ;   ;Ending Date         ;Date          ;OnValidate=BEGIN
                                                                IF "Ending Date" <> xRec."Ending Date" THEN
                                                                  SetDuration("Ending Date","Ending Time");
                                                              END;

                                                   CaptionML=[ENU=Ending Date;
                                                              NOR=Sluttdato;
                                                              SVE=Slutdatum] }
    { 48  ;   ;Ending Time         ;Time          ;OnValidate=BEGIN
                                                                IF "Ending Time" <> xRec."Ending Time" THEN
                                                                  SetDuration("Ending Date","Ending Time");
                                                              END;

                                                   CaptionML=[ENU=Ending Time;
                                                              NOR=Sluttidspunkt;
                                                              SVE=Sluttid] }
    { 9501;   ;Wizard Step         ;Option        ;CaptionML=[ENU=Wizard Step;
                                                              NOR=Trinn i veiviser;
                                                              SVE=Guidesteg];
                                                   OptionCaptionML=[ENU=" ,1,2,3,4,5,6";
                                                                    NOR=" ,1,2,3,4,5,6";
                                                                    SVE=" ,1,2,3,4,5,6"];
                                                   OptionString=[ ,1,2,3,4,5,6];
                                                   Editable=No }
    { 9504;   ;Team To-do          ;Boolean       ;CaptionML=[ENU=Team Task;
                                                              NOR=Oppgave for prosjektgruppe;
                                                              SVE=Teamuppgift] }
    { 9505;   ;Send on finish      ;Boolean       ;CaptionML=[ENU=Send on finish;
                                                              NOR=Send ved avslutning;
                                                              SVE=Skicka efter slutfîrande] }
    { 9506;   ;Segment Description ;Text100       ;CaptionML=[ENU=Segment Description;
                                                              NOR=Segmentbeskrivelse;
                                                              SVE=Segmentbeskrivning] }
    { 9507;   ;Team Meeting Organizer;Code20      ;CaptionML=[ENU=Team Meeting Organizer;
                                                              NOR=Gruppemõtearrangõr;
                                                              SVE=Mîtesorganisatîr fîr team] }
    { 9508;   ;Activity Code       ;Code10        ;TableRelation=Activity.Code;
                                                   CaptionML=[ENU=Activity Code;
                                                              NOR=Aktivitetskode;
                                                              SVE=Aktivitetskod] }
    { 9509;   ;Wizard Contact Name ;Text100       ;CaptionML=[ENU=Wizard Contact Name;
                                                              NOR=Kontaktnavn for veiviser;
                                                              SVE=Kontaktnamn, guide] }
    { 9510;   ;Wizard Campaign Description;Text100;CaptionML=[ENU=Wizard Campaign Description;
                                                              NOR=Kampanjebeskrivelse for veiviser;
                                                              SVE=Kampanjbeskrivning, guide] }
    { 9511;   ;Wizard Opportunity Description;Text100;
                                                   CaptionML=[ENU=Wizard Opportunity Description;
                                                              NOR=Beskrivelse av salgsmulighet for veiviser;
                                                              SVE=Beskrivning av affÑrsmîjlighet, guide] }
    { 11012000;;Try-out No.        ;Code20        ;TableRelation=Try-out.Code;
                                                   CaptionML=[ENU=Try-out No.;
                                                              SVE=Anbudsnr] }
    { 11012010;;Responsibility Code;Code10        ;TableRelation=Responsibility.Code;
                                                   CaptionML=[ENU=Responsibility Code;
                                                              SVE=Ansvar] }
    { 11012020;;Responsible Person ;Code20        ;TableRelation=Employee.No.;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Name Employee"); //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Responsible Person;
                                                              SVE=Ansvarig person] }
    { 11012030;;Try-out Quote No.  ;Code20        ;TableRelation="Try-out Quote".Code;
                                                   CaptionML=[ENU=Try-out Quote No.;
                                                              SVE=AnbudsfîrfrÜgan] }
    { 11012050;;Planned by         ;Text50        ;OnLookup=VAR
                                                              UserCode@1100528701 : Code[50];
                                                              LoginManagement@1100528700 : Codeunit 418;
                                                            BEGIN
                                                              //**4PS
                                                              UserCode := "Planned by";
                                                              LoginManagement.LookupUserID(UserCode);
                                                            END;

                                                   CaptionML=[ENU=Planned by;
                                                              SVE=Planerat av];
                                                   Editable=No }
    { 11012060;;Planned in Outlook ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Planned in Outlook;
                                                              SVE=Planerat i Outlook];
                                                   Editable=No }
    { 11012070;;Planned on         ;Date          ;CaptionML=[ENU=Planned on;
                                                              SVE=Planerat den];
                                                   Editable=No }
    { 11012090;;Description Try-out;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Try-out.Description WHERE (Code=FIELD(Try-out No.)));
                                                   CaptionML=[ENU=Description Try-out;
                                                              SVE=Anbudsbeskrivning];
                                                   Editable=No }
    { 11012100;;Description Try-out Quote;Text50  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Try-out Quote".Description WHERE (Code=FIELD(Try-out Quote No.)));
                                                   CaptionML=[ENU=Description Try-out Quote;
                                                              SVE=Beskrivning av anbudsoffert];
                                                   Editable=No }
    { 11012110;;Name Employee      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Responsible Person)));
                                                   CaptionML=[ENU=Name Responsible Person;
                                                              SVE=Namn pÜ ansvarig];
                                                   Editable=No }
    { 11012120;;Name Sales Person  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Salesperson Code)));
                                                   CaptionML=[ENU=Name Sales Person;
                                                              SVE=Namn pÜ fîrsÑljare];
                                                   Editable=No }
    { 11012130;;Description Campaign;Text100      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Campaign.Description WHERE (No.=FIELD(Campaign No.)));
                                                   CaptionML=[ENU=Description Campaign;
                                                              SVE=Kampanjbeskrivning];
                                                   Editable=No }
    { 11012150;;Project No.        ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Project No.;
                                                              SVE=Projektnr] }
    { 11012151;;Project Description;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 11012160;;Modified by        ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              SVE=éndrad av];
                                                   Editable=No }
    { 11012170;;Standard To-do Code;Code10        ;TableRelation="Standard To-do";
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Standard To-do Description"); //**4PS.n
                                                              END;

                                                   CaptionML=ENU=Standard To-do Code }
    { 11012180;;Standard To-do Description;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Standard To-do".Description WHERE (Code=FIELD(Standard To-do Code)));
                                                   CaptionML=ENU=Standard To-do Description;
                                                   Editable=No }
    { 11012800;;Service Call No.   ;Code20        ;TableRelation="Service Call";
                                                   CaptionML=[ENU=Service Call No.;
                                                              SVE=Servicesamtalsnr] }
    { 11012810;;Service Order No.  ;Code20        ;TableRelation="Service Order";
                                                   CaptionML=[ENU=Service Order No.;
                                                              SVE=Serviceordernr] }
    { 11012820;;Service Contract No.;Code20       ;TableRelation=Service-Contract;
                                                   CaptionML=[ENU=Service Contract No.;
                                                              SVE=Servicekontraktnr] }
    { 11012830;;Service Location No.;Code20       ;TableRelation="Service Location".No.;
                                                   CaptionML=[ENU=Service Location No.;
                                                              SVE=Serviceplatsnr] }
    { 11012840;;Description Call   ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Call".Description WHERE (No.=FIELD(Service Call No.)));
                                                   CaptionML=[ENU=Description Call;
                                                              SVE=Beskrivning, samtal];
                                                   Editable=No }
    { 11012850;;Description Order  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Description WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Description Service Order;
                                                              SVE=Serviceorderbeskrivning];
                                                   Editable=No }
    { 11012860;;Description Contract;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Contract.Description WHERE (No.=FIELD(Service Contract No.)));
                                                   CaptionML=[ENU=Description Contract;
                                                              SVE=Kontraktsbeskrivning];
                                                   Editable=No }
    { 11012870;;Description Service Location;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location".Description WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Description Service Location;
                                                              SVE=Serviceplatsbeskrivning];
                                                   Editable=No }
    { 11012880;;Action No.         ;Integer       ;TableRelation="Cust. Cockpit Actions"."Action No.";
                                                   OnValidate=BEGIN
                                                                IF "Action No." <> xRec."Action No." THEN
                                                                  CALCFIELDS("Action Description");
                                                              END;

                                                   CaptionML=[ENU=Action No.;
                                                              SVE=ètgÑrdsnr];
                                                   Description=For merge of 11012397 with 5080 }
    { 11012890;;Action Description ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Cust. Cockpit Actions".Description WHERE (Action No.=FIELD(Action No.)));
                                                   CaptionML=[ENU=Action Description;
                                                              SVE=ètgÑrdsbeskrivning];
                                                   Description=For merge of 11012397 with 5080;
                                                   Editable=No }
    { 11012900;;Cust. Ledger Entry No.;Integer    ;CaptionML=[ENU=Cust. Ledger Entry No.;
                                                              SVE=Kundreskontra lîpnr];
                                                   Description=For merge of 11012397 with 5080;
                                                   Editable=No }
    { 11012910;;Customer No.       ;Code30        ;CaptionML=[ENU=Customer No.;
                                                              SVE=Kundnr];
                                                   Description=For merge of 11012397 with 5080 }
    { 11012915;;Customer Name      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Customer No.)));
                                                   CaptionML=[ENU=Customer Name;
                                                              SVE=Kundens namn];
                                                   Editable=No }
    { 11012920;;Document No.       ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Cust. Ledger Entry"."Document No." WHERE (Entry No.=FIELD(Cust. Ledger Entry No.)));
                                                   CaptionML=[ENU=Document No.;
                                                              SVE=Dokumentnr];
                                                   Description=For merge of 11012397 with 5080;
                                                   Editable=No }
    { 11012930;;Description 2      ;Text50        ;CaptionML=[ENU=Description 2;
                                                              SVE=Beskrivning 2] }
    { 11012940;;Parcel No.         ;Code20        ;TableRelation=Parcel;
                                                   CaptionML=[ENU=Parcel No.;
                                                              SVE=Paketnr] }
    { 11012950;;Quote Number       ;Code20        ;CaptionML=[ENU=Quote Number;
                                                              SVE=Offertnummer] }
    { 11012960;;Building Code      ;Code20        ;TableRelation=Building;
                                                   CaptionML=[ENU=Building;
                                                              SVE=Byggnad] }
    { 11012970;;Building Description;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Building.Description WHERE (Code=FIELD(Building Code)));
                                                   CaptionML=[ENU=Building Description;
                                                              SVE=Beskrivning Byggnad];
                                                   Editable=No }
    { 11012980;;Estimate No.       ;Code20        ;TableRelation=Estimate WHERE (RAW Estimate=CONST(No));
                                                   CaptionML=[ENU=Estimate No.;
                                                              SVE=Kalkylnr] }
    { 11012985;;Estimate Description;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=[ENU=Estimate Description;
                                                              SVE=Kalkylbeskrivning];
                                                   Editable=No }
    { 11012990;;Rubric             ;Code20        ;TableRelation="To-do Rubric";
                                                   CaptionML=[ENU=Rubric;
                                                              SVE=Rubrik] }
    { 11013000;;Estimate No. RAW   ;Code20        ;TableRelation=Estimate WHERE (RAW Estimate=CONST(Yes));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Estimate No. RAW }
    { 11013010;;Estimate Description RAW;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No. RAW)));
                                                   CaptionML=ENU=Estimate Description RAW }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Contact Company No.,Date,Contact No.,Closed }
    {    ;Contact Company No.,Contact No.,Closed,Date }
    {    ;Salesperson Code,Date,Closed             }
    {    ;Team Code,Date,Closed                    }
    {    ;Campaign No.,Date                        }
    {    ;Segment No.,Date                         }
    {    ;Opportunity No.,Date,Closed              }
    {    ;Organizer To-do No.,System To-do Type    }
    {    ;Date,Start Time,Try-out No.,Try-out Quote No. }
    {    ;Responsible Person,Status,Closed         }
    {    ;Action No.,Date,Date Closed,Salesperson Code }
    {    ;Cust. Ledger Entry No.,Date Closed       }
    {    ;Customer No.                             }
    {    ;Quote Number                             }
    {    ;Try-out No.,Date,Closed                  }
    {    ;Try-out Quote No.,Date,Closed            }
    {    ;Project No.,Date,Closed                  }
    {    ;Parcel No.,Date,Closed                   }
    {    ;Service Location No.,Date,Closed         }
    {    ;Service Contract No.,Date,Closed         }
    {    ;Service Call No.,Date,Closed             }
    {    ;Service Order No.,Date,Closed            }
    {    ;Estimate No.,Date,Closed                 }
    {    ;Building Code,Date,Closed                }
    {    ;Estimate No. RAW,Date,Closed             }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;No.,Description,Status                   }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=%1 must be specified.;NOR=%1 mÜ angis.;SVE=%1 mÜste specificeras.';
      Text001@1001 : TextConst 'ENU=%1 No. %2 has been created from recurring %3 %4.;NOR=%1 Nr. %2 er opprettet fra gjentakende %3 %4.;SVE=%1 nr %2 har skapats frÜn Üterkommande %3 %4.';
      Text002@1002 : TextConst '@@@="%1 = Segment Header No.";ENU=Do you want to create a Task for all contacts in the %1 Segment;NOR=Vil du opprette en oppgave for alle kontaktene i segmentet %1;SVE=Vill du skapa en uppgift fîr alla kontakter i segment %1';
      Text003@1003 : TextConst '@@@="%1 = Segment Header No.";ENU=Do you want to assign an activity to all Contacts in the %1 Segment;NOR=Vil du tilordne en aktivitet til alle kontaktene i segmentet %1;SVE=Vill du tilldela en aktivitet till alla kontakter i segment %1';
      RMSetup@1004 : Record 5079;
      Cont@1005 : Record 5050;
      Salesperson@1021 : Record 13;
      Activity@1069 : Record 5081;
      Campaign@1059 : Record 11072034;
      Team@1050 : Record 5083;
      Opp@1041 : Record 5092;
      SegHeader@1040 : Record 11072039;
      TempAttendee@1039 : TEMPORARY Record 5199;
      TempTaskInteractionLanguage@1037 : TEMPORARY Record 5196;
      TempAttachment@1026 : TEMPORARY Record 11072030;
      TempRMCommentLine@1024 : TEMPORARY Record 5061;
      NoSeriesMgt@1007 : Codeunit 396;
      Text004@1008 : TextConst 'ENU=Do you want to register an Interaction Log Entry?;NOR=Vil du registrere en samhandlingspost?;SVE=Vill du registrera en interaktionsloggtransaktion?';
      TempEndDateTime@1012 : DateTime;
      Text005@1013 : TextConst 'ENU=Information that you have entered in this field will cause the duration to be negative which is not allowed. Please modify the ending date/time value.;NOR=Opplysningene du har angitt i dette feltet, vil fõre til at varigheten blir negativ, noe som ikke er tillatt. Du mÜ endre verdien for sluttdato/-klokkeslett.;SVE=Informationen som registrerats i det hÑr fÑltet kommer att ge en negativ varaktighet, vilket inte Ñr tillÜtet. éndra slutdatum och sluttid.';
      TempStartDateTime@1014 : DateTime;
      Text006@1015 : TextConst 'ENU=The valid range of dates is from %1 to %2. Please enter a date within this range.;NOR=Det gyldige datointervallet er fra %1 til %2. Angi en dato i dette intervallet.;SVE=Det giltiga intervallet av datum Ñr frÜn %1 till %2. Ange ett datum i det intervallet.';
      Text007@1016 : TextConst 'ENU=Information that you have entered in this field will cause the duration to be less than 1 minute, which is not allowed. Please modify the ending date/time value.;NOR=Opplysningene du har angitt i dette feltet, vil fõre til at varigheten blir kortere enn ett minutt, noe som ikke er tillatt. Du mÜ endre verdien for sluttdato/-klokkeslett.;SVE=Den registrerade informationen i det hÑr fÑltet kommer att ge en varaktighet som Ñr mindre Ñn 1 minut, vilket inte Ñr tillÜtet. éndra slutdatum och sluttid.';
      Text008@1017 : TextConst 'ENU=Information that you have entered in this field will cause the duration to be more than 10 years, which is not allowed. Please modify the ending date/time value.;NOR=Opplysningene du har angitt i dette feltet, vil fõre til at varigheten blir mer enn ti Ür, noe som ikke er tillatt. Du mÜ endre verdien for sluttdato/-klokkeslett.;SVE=Den registrerade informationen i det hÑr fÑltet kommer att ge en varaktighet som Ñr mer Ñn 10 Ür, vilket inte Ñr tillÜtet. éndra slutdatum och sluttid.';
      Text009@1022 : TextConst '@@@="%1=Salesperson Code";ENU=You cannot change the %1 for this Task, because this salesperson is the meeting organizer.;NOR=Du kan ikke endre %1 for dette oppgaven, fordi det er denne selgeren som er mõtearrangõr.;SVE=Du kan inte Ñndra %1 fîr den hÑr uppgiften dÑrfîr att den hÑr sÑljaren Ñr mîtesorganisatîren.';
      Text010@1023 : TextConst '@@@="%1=Task Interaction Language,%2=Language Code";ENU=Do you want to create a new %2 value in %1 for this Task?;NOR=Vil du opprette en ny verdi for %2 i %1 for denne oppgaven?;SVE=Vill du skapa ett nytt %2-vÑrde i %1 fîr den hÑr uppgiften?';
      Text012@1025 : TextConst 'ENU=You cannot change a Task type from Blank or Phone Call to Meeting and vice versa. You can only change a Task type from Blank to Phone Call or from Phone Call to Blank.;NOR=Du kan ikke endre en oppgavetype fra Tom eller Telefonsamtale til Mõte, og omvendt. Du kan bare endre en oppgavetype fra Tom til Telefonsamtale eller fra Telefonsamtale til Tom.;SVE=Du kan inte Ñndra uppgiftstypen Blank eller Telefonsamtal till Mîte och vice versa. Du kan endast Ñndra uppgiftstypen frÜn Blank till Telefonsamtal eller frÜn Telefonsamtal till Blank.';
      Text015@1029 : TextConst 'ENU=Dear %1,;NOR=Til %1,;SVE=BÑste %1,';
      Text016@1030 : TextConst '@@@="%1 = Task Date,%2 = Task StartTime,%3=Task location";ENU=You are cordially invited to attend the meeting, which will take place on %1, %2 at %3.;NOR=Vi har gleden av Ü invitere deg til Ü delta pÜ mõtet den %1, %2 i %3.;SVE=HÑrmed inbjuds du till att delta i mîtet som kommer att Ñga rum den %1, %2 klockan %3.';
      Text017@1028 : TextConst 'ENU=Yours sincerely,;NOR=Med vennlig hilsen,;SVE=Med vÑnlig hÑlsning';
      Text018@1031 : TextConst 'ENU=The %1 check box is not selected.;NOR=Det er ikke satt noen hake i avmerkingsboksen %1.;SVE=%1 Ñr inte markerad.';
      Text019@1032 : TextConst 'ENU=Send invitations to all Attendees with selected %1 check boxes.;NOR=Send invitasjoner til alle deltakere som har en hake i avmerkingsboksene %1.;SVE=Skicka inbjudan till alla deltagare med markerade %1-kryssrutor.';
      Text020@1033 : TextConst 'ENU=Send invitations to Attendees who have not been sent invitations yet.;NOR=Send invitasjoner til deltakere som det enda ikke er sendt invitasjoner til.;SVE=Skicka inbjudningar till deltagare som Ñnnu inte har fÜtt inbjudningar.';
      Text021@1034 : TextConst 'ENU=Do not send invitations.;NOR=Send ikke invitasjoner.;SVE=Skicka inte nÜgra inbjudningar.';
      Text022@1035 : TextConst 'ENU=Invitations have already been sent to Attendees with selected %1 check boxes. Do you want to resend the invitations?;NOR=Det er allerede sendt invitasjoner til deltakere som har en hake i avmerkingsboksene %1. Vil du sende invitasjoner pÜ nytt?;SVE=Inbjudningar har redan skickats till deltagare med markerade %1-kryssrutor. Vill du skicka om inbjudningarna?';
      Text023@1036 : TextConst 'ENU=Outlook failed to send an invitation to %1.;NOR=Outlook sendte ikke invitasjon til %1.;SVE=Outlook misslyckades med att skicka en inbjudan till %1.';
      Text029@1042 : TextConst '@@@="%1=Completed By";ENU=The %1 field must be filled in for Tasks assigned to a team.;NOR=Feltet %1 mÜ fylles ut for oppgaver som er tilordnet en prosjektgruppe.;SVE=FÑltet %1 mÜste fyllas i fîr uppgifter som har tilldelats ett team.';
      TasksWillBeDeletedQst@1043 : TextConst '@@@="%1 = old Team code, %2 = new Team code";ENU=Tasks of the %1 team members who do not belong to the %2 team will be deleted. Do you want to continue?;NOR=Oppgaver for medlemmene i prosjektgruppen %1 som ikke tilhõrer prosjektgruppen %2, vil bli slettet. Vil du fortsette?;SVE=Uppgifter fîr medlemmarna i teamet %1 som inte tillhîr teamet %2 tas bort. Vill du fortsÑtta?';
      Text032@1045 : TextConst '@@@="%1=Task No.,%2=Salesperson Code";ENU=Task No. %1 will be reassigned to %2 and the corresponding salesperson Tasks for team members will be deleted. Do you want to continue?;NOR=Oppgavenr. %1 vil bli tilordnet pÜ nytt til %2, og de tilsvarende selgeroppgavene for medlemmene i prosjektgruppen vil bli slettet. Vil du fortsette?;SVE=Uppgift nr %1 omfîrdelas till %2 och motsvarande sÑljaruppgifter fîr teammedlemmar tas bort. Vill du fortsÑtta?';
      Text033@1046 : TextConst '@@@="%1=Task No.,%2=Salesperson Code";ENU=Task No. %1 will be reassigned to %2. Do you want to continue?;NOR=Oppgavenr. %1 vil bli tilordnet pÜ nytt til %2. Vil du fortsette?;SVE=Uppgift nr %1 omfîrdelas till %2. Vill du fortsÑtta?';
      Text034@1047 : TextConst 'ENU=Do you want to close the Task?;NOR=Vil du lukke oppgaven?;SVE=Vill du stÑnga uppgiften?';
      Text035@1027 : TextConst 'ENU=You must fill in either the %1 field or the %2 field.;NOR=Du mÜ fylle ut feltet %1 eller feltet %2.;SVE=Du mÜste fylla i fÑlt %1 eller fÑlt %2.';
      Text036@1049 : TextConst 'ENU=Creating Tasks...\;NOR=Oppretter oppgaver...\;SVE=Skapar uppgifter...\';
      TaskNoMsg@1048 : TextConst '@@@="%1 = counter";ENU=Task No. #1##############\;NOR=Oppgavenr. #1##############\;SVE=Uppgiftsnr. #1##############\';
      Text038@1044 : TextConst 'ENU=Status    @2@@@@@@@@@@@@@@;NOR=Status     @2@@@@@@@@@@@@@@;SVE=Status      @2@@@@@@@@@@@@@@';
      Text039@1051 : TextConst '@@@="%1=Task No,%2=Team Code,%3=Team Code";ENU=Task No. %1 is closed and will be reopened. The Tasks of the %2 team members who do not belong to the %3 team will be deleted. Do you want to continue?;NOR=Oppgavenr. %1 er lukket og vil bli Üpnet pÜ nytt. Oppgavene for medlemmene i prosjektgruppen %2 som ikke tilhõrer prosjektgruppen %3, vil bli slettet. Vil du fortsette?;SVE=Uppgift nr %1 Ñr stÑngd och îppnas dÑrfîr pÜ nytt. Uppgifterna fîr de %2-teammedlemmar som inte tillhîr teamet %3 kommer att tas bort. Vill du fortsÑtta?';
      Text040@1052 : TextConst '@@@="%1=Task No.,%2=Salesperson Code";ENU=Task No. %1 is closed and will be reopened. It will be reassigned to %2, and the corresponding salesperson Tasks for team members will be deleted. Do you want to continue?;NOR=Oppgavenr. %1 er lukket og vil bli Üpnet pÜ nytt. Den blir tilordnet pÜ nytt til %2, og de tilsvarende selgeroppgavene for medlemmene i prosjektgruppen vil bli slettet. Vil du fortsette?;SVE=Uppgift nr %1 Ñr stÑngd och îppnas dÑrfîr pÜ nytt. Den tilldelas %2, och motsvarande sÑljaruppgifter fîr teammedlemmar kommer att tas bort. Vill du fortsÑtta?';
      Text041@1053 : TextConst '@@@="%1=Task No.,%2=Salesperson Code";ENU=Task No. %1 is closed. It will be reopened and reassigned to %2. Do you want to continue?;NOR=Oppgavenr. %1 er lukket. Det vil bli Üpnet og tilordnet pÜ nytt til %2. Vil du fortsette?;SVE=Uppgift nr %1 Ñr stÑngd. Den ska îppnas pÜ nytt och tilldelas %2. Vill du fortsÑtta?';
      Text042@1054 : TextConst '@@@="%1=Task No.,%2=Team Code";ENU=Task No. %1 is closed. Do you want to reopen it and assign to the %2 team?;NOR=Oppgavenr. %1 er lukket. Vil du Üpne det og tilordne det pÜ nytt til prosjektgruppen %2?;SVE=Uppgift nr %1 Ñr stÑngd. Vill du îppna den pÜ nytt och tilldela den team %2?';
      Text043@1068 : TextConst 'ENU=You must fill in the %1 field.;NOR=Du mÜ fylle ut feltet %1.;SVE=Du mÜste fylla i fÑltet %1.';
      Text047@1072 : TextConst 'ENU=You cannot use the wizard to create an attachment. You can create an attachment in the Interaction Template window.;NOR=Du kan ikke bruke veiviseren til Ü opprette et vedlegg. Vedlegg kan opprettes i vinduet Samhandlingsmal.;SVE=Du kan inte anvÑnda guiden fîr att skapa en bilaga. Du kan skapa en bilaga i fînstret interaktionsmall.';
      Text051@1077 : TextConst 'ENU=Activity Code;NOR=Aktivitetskode;SVE=Aktivitetskod';
      Text053@1076 : TextConst 'ENU=You must specify %1 or %2.;NOR=Du mÜ angi %1 eller %2.;SVE=Du mÜste specificera %1 eller %2.';
      Text056@1073 : TextConst '@@@="%1=Activity Code";ENU=Activity %1 contains Tasks of type Meeting. You must fill in the Meeting Organizer field.;NOR=Aktiviteten %1 inneholder oppgaver av typen Mõte. Du mÜ fylle ut feltet Mõtearrangõr.;SVE=Aktivitet %1 innehÜller uppgifter av typen mîte. Du mÜste fylla i fÑltet Mîtesorganisatîr.';
      Text065@1083 : TextConst 'ENU=You must specify the Task organizer.;NOR=Du mÜ angi oppgavearrangõr.;SVE=Du mÜste specificera uppgiftsorganisatîren.';
      Text067@1019 : TextConst 'ENU=The %1 must contain an attachment if you want to send an invitation to an %2 of the contact type.;NOR=%1 mÜ inneholde et vedlegg hvis du vil sende en invitasjon til %2 av kontakttypen.;SVE=%1 mÜste innehÜlla en bilaga om du vill skicka en inbjudan till %2 med denna kontakttyp.';
      Text068@1080 : TextConst 'ENU=You cannot select the Send invitation(s) on Finish check box, because none of the %1 check boxes are selected.;NOR=Du kan ikke merke av i Send invitasjon(er) ved Fullfõr, fordi det ikke er merket av i noen av boksene %1.;SVE=Du kan inte vÑlja Skicka inbjudan i Slutfîr dÑrfîr att ingen av %1 Ñr valda.';
      RunFormCode@1020 : Boolean;
      CreateExchangeAppointment@1009 : Boolean;
      Text11012001@1100525002 : TextConst 'ENU=New Activity;SVE=Ny aktivitet';
      Text11012002@1100525000 : TextConst 'ENU=Action %1, on %2;SVE=ètgÑrd %1, pÜ %2';
      Text11012003@1100528700 : TextConst 'ENU=The current filter on %1 do not result in a single %2. Please change the filter before creating a %3.;SVE=Nuvarande filter %1 ger inte ett en enskild %2. VÑnligen Ñndra filtret innan du skapa en %3.';
      Text11012004@1100525001 : TextConst 'ENU=You can not select a Team with Members who do not have a %1 filled.;SVE=Du kan inte vÑlja ett Team med medlemmar som inte har %1 ifyllt.';

    [External]
    PROCEDURE CreateTaskFromTask@1(VAR Task@1000 : Record 5080);
    BEGIN
      DELETEALL;
      INIT;
      SetFilterFromTask(Task);

      OnCreateTaskFromTaskOnBeforeStartWizard(Rec,Task);
      StartWizard;
    END;

    [External]
    PROCEDURE CreateTaskFromSalesHeader@50(SalesHeader@1000 : Record 36);
    BEGIN
      DELETEALL;
      INIT;
      VALIDATE("Contact No.",SalesHeader."Sell-to Contact No.");
      SETRANGE("Contact No.",SalesHeader."Sell-to Contact No.");
      IF SalesHeader."Salesperson Code" <> '' THEN BEGIN
        "Salesperson Code" := SalesHeader."Salesperson Code";
        SETRANGE("Salesperson Code","Salesperson Code");
      END;
      IF SalesHeader."Campaign No." <> '' THEN BEGIN
        "Campaign No." := SalesHeader."Campaign No.";
        SETRANGE("Campaign No.","Campaign No.");
      END;
      //**4PS.sn
      IF (SalesHeader."Document Type" = SalesHeader."Document Type"::Quote) AND
         (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated") THEN
        "Quote Number" := SalesHeader."No.";
      IF "Responsible Person" = '' THEN
        "Responsible Person" := "Salesperson Code";
      //**4PS.en

      OnCreateTaskFromSalesHeaderOnBeforeStartWizard(Rec,SalesHeader);
      OnCreateTaskFromSalesHeaderoOnBeforeStartWizard(Rec,SalesHeader); // Obsolete
      StartWizard;
    END;

    [External]
    PROCEDURE CreateTaskFromInteractLogEntry@51(InteractionLogEntry@1000 : Record 11072027);
    BEGIN
      INIT;
      VALIDATE("Contact No.",InteractionLogEntry."Contact No.");
      "Salesperson Code" := InteractionLogEntry."Salesperson Code";
      "Campaign No." := InteractionLogEntry."Campaign No.";

      //**4PS.sn
      IF "Responsible Person" = '' THEN
        "Responsible Person" := "Salesperson Code";
      //**4PS.en

      OnCreateTaskFromInteractLogEntryOnBeforeStartWizard(Rec,InteractionLogEntry);
      StartWizard;
    END;

    PROCEDURE CreateInteraction@10();
    VAR
      TempSegLine@1000 : TEMPORARY Record 11072040;
    BEGIN
      //**4PS Changed to global function

      IF Type = Type::"Phone Call" THEN BEGIN
        TempSegLine."Campaign No." := "Campaign No.";
        TempSegLine."Opportunity No." := "Opportunity No.";
        TempSegLine."Contact No." := "Contact No.";
        TempSegLine."To-do No." := "No.";
        TempSegLine."Salesperson Code" := "Salesperson Code";
        TempSegLine.CreatePhoneCall;
      END ELSE
        TempSegLine.CreateInteractionFromTask(Rec);
    END;

    PROCEDURE CreateRecurringTask@4();
    VAR
      Task2@1002 : Record 5080;
      TaskInteractLanguage@1003 : Record 5196;
      Attachment@1004 : Record 11072030;
      Attendee@1005 : Record 5199;
      TempAttendee@1007 : TEMPORARY Record 5199;
      RMCommentLine@1000 : Record 5061;
      RMCommentLine3@1006 : Record 5061;
    BEGIN
      //**4PS function changed to global
      TESTFIELD("Recurring Date Interval");
      IF "Calc. Due Date From" = "Calc. Due Date From"::" " THEN
        ERROR(Text000,FIELDCAPTION("Calc. Due Date From"));

      Task2 := Rec;
      WITH Task2 DO BEGIN
        Status := 0;
        Closed := FALSE;
        Canceled := FALSE;
        "Date Closed" := 0D;
        "Completed By" := '';
        CASE "Calc. Due Date From" OF
          "Calc. Due Date From"::"Due Date":
            Date := CALCDATE("Recurring Date Interval",Date);
          "Calc. Due Date From"::"Closing Date":
            Date := CALCDATE("Recurring Date Interval",TODAY);
        END;
        GetEndDateTime;

        RMCommentLine3.RESET;
        RMCommentLine3.SETRANGE("Table Name",RMCommentLine."Table Name"::"To-do");
        RMCommentLine3.SETRANGE("No.","No.");
        RMCommentLine3.SETRANGE("Sub No.",0);

        TaskInteractLanguage.SETRANGE("To-do No.","No.");

        IF Type = Type::Meeting THEN BEGIN
          Attendee.SETRANGE("To-do No.","No.");
          GET(InsertTaskAndRelatedData(
              Task2,TaskInteractLanguage,Attachment,Attendee,RMCommentLine3));
        END ELSE BEGIN
          CreateAttendeesFromTask(TempAttendee,Task2,'');
          GET(InsertTaskAndRelatedData(
              Task2,TaskInteractLanguage,Attachment,TempAttendee,RMCommentLine3));
        END;
      END;

      MESSAGE(
        STRSUBSTNO(Text001,
          TABLECAPTION,Task2."Organizer To-do No.",TABLECAPTION,"No."));
    END;

    [Internal]
    PROCEDURE InsertTask@2(Task2@1000 : Record 5080;VAR RMCommentLine@1004 : Record 5061;VAR TempAttendee@1005 : TEMPORARY Record 5199;VAR TaskInteractionLanguage@1007 : Record 5196;VAR TempAttachment@1008 : TEMPORARY Record 11072030;ActivityCode@1001 : Code[10];Deliver@1010 : Boolean);
    VAR
      SegHeader@1002 : Record 11072039;
      SegLine@1003 : Record 11072040;
      ConfirmText@1006 : Text[250];
    BEGIN
      IF SegHeader.GET(GETFILTER("Segment No.")) THEN BEGIN
        SegLine.SETRANGE("Segment No.",SegHeader."No.");
        SegLine.SETFILTER("Contact No.",'<>%1','');
        IF SegLine.FINDFIRST THEN BEGIN
          IF ActivityCode = '' THEN
            ConfirmText := Text002
          ELSE
            ConfirmText := Text003;
          IF CONFIRM(ConfirmText,TRUE,SegHeader."No.") THEN BEGIN
            IF ActivityCode = '' THEN BEGIN
              Task2.GET(InsertTaskAndRelatedData(
                  Task2,TaskInteractionLanguage,TempAttachment,TempAttendee,RMCommentLine));
              IF (Task2.Type = Type::Meeting) AND Deliver THEN
                SendMAPIInvitations(Task2,TRUE);
            END ELSE
              InsertActivityTask(Task2,ActivityCode,TempAttendee);
          END;
        END;
      END ELSE BEGIN
        IF ActivityCode = '' THEN BEGIN
          Task2.GET(InsertTaskAndRelatedData(
              Task2,TaskInteractionLanguage,TempAttachment,TempAttendee,RMCommentLine));
          IF (Task2.Type = Type::Meeting) AND Deliver THEN
            SendMAPIInvitations(Task2,TRUE);
        END ELSE
          InsertActivityTask(Task2,ActivityCode,TempAttendee);
      END;

      IF (Task2.Type = Task2.Type::Meeting) AND
         Task2.GET(Task2."Organizer To-do No.")
      THEN
        Task2.ArrangeOrganizerAttendee;
    END;

    LOCAL PROCEDURE InsertTaskAndRelatedData@14(Task2@1000 : Record 5080;VAR TaskInteractLanguage@1001 : Record 5196;VAR Attachment@1002 : Record 11072030;VAR Attendee@1003 : Record 5199;VAR RMCommentLine@1004 : Record 5061) TaskNo : Code[20];
    VAR
      TaskInteractLanguage2@1005 : Record 5196;
      TempAttendee@1006 : TEMPORARY Record 5199;
      Task@1007 : Record 5080;
      TeamSalesperson@1008 : Record 5084;
      Attendee2@1010 : Record 5199;
      Window@1013 : Dialog;
      AttendeeCounter@1017 : Integer;
      TotalAttendees@1018 : Integer;
      CommentLineInserted@1019 : Boolean;
      SkipTaskType@1009 : Boolean;
    BEGIN
      SkipTaskType := FALSE;
      OnBeforeInsertTaskAndRelatedData(Task2,SkipTaskType);
      IF NOT SkipTaskType THEN
        IF Task2."Team Code" = '' THEN
          Task2."System To-do Type" := "System To-do Type"::Organizer
        ELSE
          Task2."System To-do Type" := "System To-do Type"::Team;

      IF Task2.Type = Type::Meeting THEN BEGIN
        CLEAR(Task2."No.");
        IF Task2."System To-do Type" = Task2."System To-do Type"::Team THEN
          Task2."Salesperson Code" := '';
        Task2.INSERT(TRUE);

        CreateTaskInteractLanguages(TaskInteractLanguage,Attachment,Task2."No.");
        IF TaskInteractLanguage2.GET(Task2."No.",Task2."Language Code") THEN BEGIN
          Task2."Attachment No." := TaskInteractLanguage2."Attachment No.";
          Task2.MODIFY;
        END;

        IF "Team Code" <> '' THEN BEGIN
          Attendee.SETCURRENTKEY("To-do No.","Attendance Type");
          Attendee.SETRANGE("Attendance Type",Attendee."Attendance Type"::"To-do Organizer");
          IF Attendee.FIND('-') THEN BEGIN
            CreateSubTask(Attendee,Task2);
            Attendee2.INIT;
            Attendee2 := Attendee;
            Attendee2."To-do No." := Task2."No.";
            Attendee2.INSERT;
          END;
          Attendee.SETFILTER("Attendance Type",'<>%1',Attendee."Attendance Type"::"To-do Organizer")
        END;
        IF Attendee.FIND('-') THEN
          REPEAT
            CreateSubTask(Attendee,Task2);
            Attendee2.INIT;
            Attendee2 := Attendee;
            Attendee2."To-do No." := Task2."No.";
            Attendee2.INSERT
          UNTIL Attendee.NEXT = 0;

        Task2.GetMeetingOrganizerTask(Task);
        TaskNo := Task."No."
      END ELSE
        IF Task2."Segment No." = '' THEN BEGIN
          CLEAR(Task2."No.");

          Task2.INSERT(TRUE);
          TaskNo := Task2."No.";
          IF Task2."System To-do Type" = "System To-do Type"::Team THEN BEGIN
            TeamSalesperson.SETRANGE("Team Code",Task2."Team Code");
            IF TeamSalesperson.FIND('-') THEN
              REPEAT
                TempAttendee.CreateAttendee(
                  TempAttendee,
                  Task2."No.",10000,
                  TempAttendee."Attendance Type"::"To-do Organizer",
                  TempAttendee."Attendee Type"::Salesperson,
                  TeamSalesperson."Salesperson Code",
                  TRUE);
                CreateSubTask(TempAttendee,Task2);
                TempAttendee.DELETEALL
              UNTIL TeamSalesperson.NEXT = 0
          END;
          IF Attendee.FIND('-') THEN
            REPEAT
              CreateSubTask(Attendee,Task2);
            UNTIL Attendee.NEXT = 0;
        END ELSE
          IF Attendee.FIND('-') THEN BEGIN
            Window.OPEN(Text036 + TaskNoMsg + Text038);
            TotalAttendees := Attendee.COUNT;
            REPEAT
              IF Task2."System To-do Type" = "System To-do Type"::Team THEN BEGIN
                Task.INIT;
                Task := Task2;
                CLEAR(Task."No.");
                FillSalesPersonContact(Task,Attendee);
                Task.INSERT(TRUE);
                TaskNo := Task."No.";
                TempAttendee.INIT;
                TempAttendee := Attendee;
                TempAttendee.INSERT;
                CreateSubTask(TempAttendee,Task);
                TempAttendee.DELETEALL;
                TeamSalesperson.SETRANGE("Team Code",Task."Team Code");
                IF TeamSalesperson.FIND('-') THEN
                  REPEAT
                    TempAttendee.CreateAttendee(
                      TempAttendee,
                      "No.",10000,
                      TempAttendee."Attendance Type"::"To-do Organizer",
                      TempAttendee."Attendee Type"::Salesperson,
                      TeamSalesperson."Salesperson Code",
                      TRUE);
                    CreateSubTask(TempAttendee,Task);
                    TempAttendee.DELETEALL
                  UNTIL TeamSalesperson.NEXT = 0
              END ELSE BEGIN
                Task.INIT;
                Task := Task2;
                CLEAR(Task."No.");
                Task."System To-do Type" := "System To-do Type"::Organizer;
                FillSalesPersonContact(Task,Attendee);
                Task.INSERT(TRUE);
                TaskNo := Task."No.";

                TempAttendee.INIT;
                TempAttendee := Attendee;
                TempAttendee.INSERT;
                CreateSubTask(TempAttendee,Task);
              END;
              AttendeeCounter := AttendeeCounter + 1;
              CreateCommentLines(RMCommentLine,TaskNo);
              Window.UPDATE(1,Task."Organizer To-do No.");
              Window.UPDATE(2,ROUND(AttendeeCounter / TotalAttendees * 10000,1));
              COMMIT
            UNTIL Attendee.NEXT = 0;
            Window.CLOSE;
            CommentLineInserted := TRUE;
          END;
      IF NOT CommentLineInserted THEN
        CreateCommentLines(RMCommentLine,Task2."No.");
    END;

    [External]
    PROCEDURE CreateSubTask@15(VAR Attendee@1001 : Record 5199;Task@1000 : Record 5080) : Code[20];
    VAR
      Task2@1002 : Record 5080;
      TaskNo@1004 : Code[20];
      IsHandled@1003 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCreateSubTask(Attendee,Task,TaskNo,IsHandled);
      IF IsHandled THEN
        EXIT(TaskNo);

      Task2.INIT;
      Task2.TRANSFERFIELDS(Task,FALSE);

      IF Attendee."Attendance Type" <> Attendee."Attendance Type"::"To-do Organizer" THEN BEGIN
        IF Attendee."Attendee Type" = Attendee."Attendee Type"::Salesperson THEN BEGIN
          Task2.VALIDATE("Salesperson Code",Attendee."Attendee No.");
          Task2."Organizer To-do No." := Task."No.";
          Task2."System To-do Type" := "System To-do Type"::"Salesperson Attendee";
        END ELSE BEGIN
          Task2.VALIDATE("Salesperson Code",Task."Salesperson Code");
          Task2.VALIDATE("Team Code",Task."Team Code");
          Task2.VALIDATE("Contact No.",Attendee."Attendee No.");
          Task2."Organizer To-do No." := Task."No.";
          Task2."System To-do Type" := "System To-do Type"::"Contact Attendee";
        END;
        Task2.INSERT(TRUE)
      END ELSE
        IF Task."Team Code" <> '' THEN BEGIN
          Task2."System To-do Type" := Task2."System To-do Type"::Organizer;
          Task2.VALIDATE("Salesperson Code",Attendee."Attendee No.");
          Task2.INSERT(TRUE);
        END;
      EXIT(Task2."No.")
    END;

    [External]
    PROCEDURE DeleteAttendeeTask@20(Attendee@1000 : Record 5199);
    VAR
      Task@1001 : Record 5080;
    BEGIN
      IF FindAttendeeTask(Task,Attendee) THEN
        Task.DELETE;
    END;

    [External]
    PROCEDURE FindAttendeeTask@25(VAR Task@1000 : Record 5080;Attendee@1001 : Record 5199) : Boolean;
    BEGIN
      Task.RESET;
      Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
      Task.SETRANGE("Organizer To-do No.",Attendee."To-do No.");
      IF Attendee."Attendee Type" = Attendee."Attendee Type"::Contact THEN BEGIN
        Task.SETRANGE("System To-do Type",Task."System To-do Type"::"Contact Attendee");
        Task.SETRANGE("Contact No.",Attendee."Attendee No.")
      END ELSE BEGIN
        Task.SETRANGE("System To-do Type",Task."System To-do Type"::"Salesperson Attendee");
        Task.SETRANGE("Salesperson Code",Attendee."Attendee No.");
      END;
      EXIT(Task.FIND('-'));
    END;

    LOCAL PROCEDURE CreateAttendeesFromTask@19(VAR Attendee@1000 : Record 5199;Task@1001 : Record 5080;TeamMeetingOrganizer@1008 : Code[20]);
    VAR
      Cont@1002 : Record 5050;
      Salesperson@1003 : Record 13;
      SegHeader@1004 : Record 11072039;
      SegLine@1005 : Record 11072040;
      Opp@1006 : Record 5092;
      AttendeeLineNo@1007 : Integer;
    BEGIN
      IF Task."Segment No." = '' THEN BEGIN
        IF Task.Type = Type::Meeting THEN
          IF Task."Team Code" = '' THEN BEGIN
            IF Salesperson.GET(Task."Salesperson Code") THEN
              Attendee.CreateAttendee(
                Attendee,
                Task."No.",10000,Attendee."Attendance Type"::"To-do Organizer",
                Attendee."Attendee Type"::Salesperson,
                Salesperson.Code,TRUE)
          END ELSE
            Task.CreateAttendeesFromTeam(
              Attendee,
              TeamMeetingOrganizer);

        IF Attendee.FIND('+') THEN
          AttendeeLineNo := Attendee."Line No." + 10000
        ELSE
          AttendeeLineNo := 10000;

        IF Cont.GET(Task."Contact No.") THEN
          Attendee.CreateAttendee(
            Attendee,
            Task."No.",AttendeeLineNo,Attendee."Attendance Type"::Required,
            Attendee."Attendee Type"::Contact,
            Cont."No.",Cont."E-Mail" <> '');
      END ELSE BEGIN
        IF Task.Type = Type::Meeting THEN
          IF Task."Team Code" = '' THEN BEGIN
            IF Salesperson.GET(Task."Salesperson Code") THEN
              Attendee.CreateAttendee(
                Attendee,
                Task."No.",10000,Attendee."Attendance Type"::"To-do Organizer",
                Attendee."Attendee Type"::Salesperson,
                Salesperson.Code,TRUE);
          END ELSE
            Task.CreateAttendeesFromTeam(Attendee,Task."Team Meeting Organizer");

        IF Attendee.FIND('+') THEN
          AttendeeLineNo := Attendee."Line No." + 10000
        ELSE
          AttendeeLineNo := 10000;

        IF Opp.GET(Task."Opportunity No.") THEN
          Attendee.CreateAttendee(
            Attendee,
            Task."No.",AttendeeLineNo,Attendee."Attendance Type"::Required,
            Attendee."Attendee Type"::Contact,
            Opp."Contact No.",
            (Cont.GET(Opp."Contact No.") AND
             (Cont."E-Mail" <> '')))
        ELSE
          IF SegHeader.GET(Task."Segment No.") THEN BEGIN
            SegLine.SETRANGE("Segment No.",Task."Segment No.");
            SegLine.SETFILTER("Contact No.",'=%1',Task."Contact No.");
            IF SegLine.FIND('-') THEN
              REPEAT
                Attendee.CreateAttendee(
                  Attendee,
                  Task."No.",AttendeeLineNo,Attendee."Attendance Type"::Required,
                  Attendee."Attendee Type"::Contact,
                  SegLine."Contact No.",
                  (Cont.GET(SegLine."Contact No.") AND
                   (Cont."E-Mail" <> '')));
                AttendeeLineNo := AttendeeLineNo + 10000;
              UNTIL SegLine.NEXT = 0;
          END;
      END;
    END;

    LOCAL PROCEDURE CreateTaskInteractLanguages@17(VAR TaskInteractLanguage@1000 : Record 5196;VAR Attachment@1001 : Record 11072030;TaskNo@1002 : Code[20]);
    VAR
      TaskInteractLanguage2@1003 : Record 5196;
      Attachment2@1004 : Record 11072030;
      MarketingSetup@1006 : Record 5079;
      AttachmentManagement@1005 : Codeunit 11072021;
      FileName@1007 : Text;
    BEGIN
      IF TaskInteractLanguage.FIND('-') THEN
        REPEAT
          TaskInteractLanguage2.INIT;
          TaskInteractLanguage2."To-do No." := TaskNo;
          TaskInteractLanguage2."Language Code" := TaskInteractLanguage."Language Code";
          TaskInteractLanguage2.Description := TaskInteractLanguage.Description;
          IF TaskInteractLanguage."Attachment No." <> 0 THEN BEGIN
            Attachment.GET(TaskInteractLanguage."Attachment No.");
            Attachment2.GET(AttachmentManagement.InsertAttachment(0));
            Attachment2.TRANSFERFIELDS(Attachment,FALSE);
            Attachment.CALCFIELDS("Attachment File");
            Attachment2."Attachment File" := Attachment."Attachment File";
            Attachment2.WizSaveAttachment;
            Attachment2.MODIFY(TRUE);
            MarketingSetup.GET;
            IF MarketingSetup."Attachment Storage Type" = MarketingSetup."Attachment Storage Type"::"Disk File" THEN
              IF Attachment2."No." <> 0 THEN BEGIN
                FileName := Attachment2.ConstDiskFileName;
                IF FileName <> '' THEN
                  Attachment.ExportAttachmentToServerFile(FileName);
              END;
            TaskInteractLanguage2."Attachment No." := Attachment2."No.";
          END ELSE
            TaskInteractLanguage2."Attachment No." := 0;
          TaskInteractLanguage2.INSERT;
        UNTIL TaskInteractLanguage.NEXT = 0;
    END;

    [External]
    PROCEDURE AssignActivityFromTask@9(VAR Task@1007 : Record 5080);
    BEGIN
      INIT;
      SetFilterFromTask(Task);

      StartWizard2;
    END;

    LOCAL PROCEDURE InsertActivityTask@3(Task2@1000 : Record 5080;ActivityCode@1001 : Code[10];VAR Attendee@1004 : Record 5199);
    VAR
      ActivityStep@1002 : Record 5082;
      TaskDate@1003 : Date;
    BEGIN
      TaskDate := Task2.Date;
      ActivityStep.SETRANGE("Activity Code",ActivityCode);
      IF ActivityStep.FIND('-') THEN BEGIN
        REPEAT
          InsertActivityStepTask(Task2,ActivityStep,TaskDate,Attendee);
        UNTIL ActivityStep.NEXT = 0;
      END ELSE
        InsertActivityStepTask(Task2,ActivityStep,TaskDate,Attendee);
    END;

    LOCAL PROCEDURE InsertActivityStepTask@22(Task2@1010 : Record 5080;ActivityStep@1009 : Record 5082;TaskDate@1012 : Date;VAR Attendee2@1015 : Record 5199) TaskNo : Code[20];
    VAR
      TempTask@1011 : TEMPORARY Record 5080;
      InteractionTemplateSetup@1008 : Record 5122;
      InteractionTemplate@1007 : Record 11072032;
      TempTaskInteractionLanguage@1006 : TEMPORARY Record 5196;
      TempAttachment@1005 : TEMPORARY Record 11072030;
      TempAttendee@1004 : TEMPORARY Record 5199;
      TempRMCommentLine@1003 : TEMPORARY Record 5061;
    BEGIN
      TempTask.INIT;
      TempTask := Task2;
      TempTask.INSERT;
      IF NOT ActivityStep.ISEMPTY THEN BEGIN
        TempTask.Type := ActivityStep.Type;
        TempTask.Priority := ActivityStep.Priority;
        TempTask.Description := ActivityStep.Description;
        TempTask.Date := CALCDATE(ActivityStep."Date Formula",TaskDate);
      END;

      IF TempTask.Type = Type::Meeting THEN BEGIN
        IF NOT Attendee2.ISEMPTY THEN BEGIN
          Attendee2.SETRANGE("Attendance Type",Attendee2."Attendance Type"::"To-do Organizer");
          Attendee2.FIND('-')
        END;
        TempAttendee.DELETEALL;
        TempTask.VALIDATE("All Day Event",TRUE);

        InteractionTemplateSetup.GET;
        IF (InteractionTemplateSetup."Meeting Invitation" <> '') AND
           InteractionTemplate.GET(InteractionTemplateSetup."Meeting Invitation")
        THEN
          UpdateInteractionTemplate(
            TempTask,TempTaskInteractionLanguage,TempAttachment,InteractionTemplate.Code,TRUE);

        CreateAttendeesFromTask(TempAttendee,TempTask,Attendee2."Attendee No.");

        TempTask.VALIDATE("Contact No.",'');

        TaskNo := InsertTaskAndRelatedData(
            TempTask,TempTaskInteractionLanguage,TempAttachment,TempAttendee,TempRMCommentLine);
      END ELSE BEGIN
        TempAttendee.DELETEALL;
        CreateAttendeesFromTask(TempAttendee,TempTask,'');

        InsertTaskAndRelatedData(
          TempTask,TempTaskInteractionLanguage,TempAttachment,TempAttendee,TempRMCommentLine);
      END;
      TempTask.DELETE;
    END;

    LOCAL PROCEDURE SetFilterFromTask@35(VAR Task@1000 : Record 5080);
    VAR
      Cont@1006 : Record 5050;
      Salesperson@1005 : Record 13;
      Team@1004 : Record 5083;
      Campaign@1003 : Record 11072034;
      Opp@1002 : Record 5092;
      SegHeader@1001 : Record 11072039;
      Tryout@1100525011 : Record 11012750;
      TryoutQuote@1100525010 : Record 11012758;
      Employee@1100525009 : Record 5200;
      Responsibility@1100525008 : Record 11012007;
      Estimate@1100525007 : Record 11012151;
      Parcel@1100525006 : Record 11012240;
      Job@1100525005 : Record 11072003;
      ServiceOrder@1100525004 : Record 11012823;
      ServiceCall@1100525003 : Record 11012822;
      ServiceContract@1100525002 : Record 11012812;
      ServiceLocation@1100525001 : Record 11012801;
      Building@1100525000 : Record 11071819;
    BEGIN
      //**4PS.so
      // IF Cont.GET(Task.GETFILTER("Contact Company No.")) THEN BEGIN
      //  Cont.CheckIfPrivacyBlockedGeneric;
      //  VALIDATE("Contact No.",Cont."No.");
      //  "Salesperson Code" := Cont."Salesperson Code";
      //  SETRANGE("Contact Company No.","Contact No.");
      // END;
      // IF Cont.GET(Task.GETFILTER("Contact No.")) THEN BEGIN
      //  Cont.CheckIfPrivacyBlockedGeneric;
      //  VALIDATE("Contact No.",Cont."No.");
      //  "Salesperson Code" := Cont."Salesperson Code";
      //  SETRANGE("Contact No.","Contact No.");
      // END;
      // IF Salesperson.GET(Task.GETFILTER("Salesperson Code")) THEN BEGIN
      //  "Salesperson Code" := Salesperson.Code;
      //  SETRANGE("Salesperson Code","Salesperson Code");
      // END;
      // IF Team.GET(Task.GETFILTER("Team Code")) THEN BEGIN
      //  VALIDATE("Team Code",Team.Code);
      //  SETRANGE("Team Code","Team Code");
      // END;
      // IF Campaign.GET(Task.GETFILTER("Campaign No.")) THEN BEGIN
      //  "Campaign No." := Campaign."No.";
      //  "Salesperson Code" := Campaign."Salesperson Code";
      //  SETRANGE("Campaign No.","Campaign No.");
      // END;
      // IF Opp.GET(Task.GETFILTER("Opportunity No.")) THEN BEGIN
      //  VALIDATE("Opportunity No.",Opp."No.");
      //  "Contact No." := Opp."Contact No.";
      //  "Contact Company No." := Opp."Contact Company No.";
      //  "Campaign No." := Opp."Campaign No.";
      //  "Salesperson Code" := Opp."Salesperson Code";
      //  SETRANGE("Opportunity No.","Opportunity No.");
      // END;
      // IF SegHeader.GET(Task.GETFILTER("Segment No.")) THEN BEGIN
      //  VALIDATE("Segment No.",SegHeader."No.");
      //  "Campaign No." := SegHeader."Campaign No.";
      //  "Salesperson Code" := SegHeader."Salesperson Code";
      //  SETRANGE("Segment No.","Segment No.");
      // END;
      //**4PS.eo

      //**4PS,sn
      IF (Task.GETFILTER("Contact Company No.") <> '') AND
         (Task.GETFILTER("Contact Company No.") <> '''''')
      THEN BEGIN
        Task.COPYFILTER("Contact Company No.", Cont."No.");
        IF Cont.COUNT = 1 THEN BEGIN
          Cont.FINDFIRST;
          VALIDATE("Contact No.", Cont."No.");
          "Salesperson Code" := Cont."Salesperson Code";
          SETRANGE("Contact Company No.", "Contact No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Contact Company No."), Cont.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Contact No.") <> '' THEN BEGIN
        Task.COPYFILTER("Contact No.", Cont."No.");
        IF Cont.COUNT = 1 THEN BEGIN
          Cont.FINDFIRST;
          VALIDATE("Contact No.", Cont."No.");
          "Salesperson Code" := Cont."Salesperson Code";
          SETRANGE("Contact No.", "Contact No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Contact No."), Cont.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Try-out No.") <> '' THEN BEGIN
        Task.COPYFILTER("Try-out No.", Tryout.Code);
        IF Tryout.COUNT = 1 THEN BEGIN
          Tryout.FINDFIRST;
          VALIDATE("Try-out No.", Tryout.Code);
          "Salesperson Code" := Tryout."Salesperson Code"; // Salesperson Code can be overwritten by filter on Salesperson Code
          SETRANGE("Try-out No.", "Try-out No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Try-out No."), Tryout.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Try-out Quote No.") <> '' THEN BEGIN
        Task.COPYFILTER("Try-out Quote No.", TryoutQuote.Code);
        IF TryoutQuote.COUNT = 1 THEN BEGIN
          TryoutQuote.FINDFIRST;
          VALIDATE("Try-out Quote No.", TryoutQuote.Code);
          "Salesperson Code" := TryoutQuote."Salesperson Code"; // Salesperson Code can be overwritten by filter on Salesperson Code
          SETRANGE("Try-out Quote No.", "Try-out Quote No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Try-out Quote No."), TryoutQuote.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Salesperson Code") <> '' THEN BEGIN
        Task.COPYFILTER("Salesperson Code", Salesperson.Code);
        IF Salesperson.COUNT = 1 THEN BEGIN
          Salesperson.FINDFIRST;
          "Salesperson Code" := Salesperson.Code;
          SETRANGE("Salesperson Code", "Salesperson Code");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Salesperson Code"), Salesperson.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Team Code") <> '' THEN BEGIN
        Task.COPYFILTER("Team Code", Team.Code);
        IF Team.COUNT = 1 THEN BEGIN
          Team.FINDFIRST;
          VALIDATE("Team Code", Team.Code);
          SETRANGE("Team Code", "Team Code");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Team Code"), Team.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Campaign No.") <> '' THEN BEGIN
        Task.COPYFILTER("Campaign No.", Campaign."No.");
        IF Campaign.COUNT = 1 THEN BEGIN
          Campaign.FINDFIRST;
          "Campaign No." := Campaign."No.";
          "Salesperson Code" := Campaign."Salesperson Code";
          SETRANGE("Campaign No.", "Campaign No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Campaign No."), Campaign.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Opportunity No.") <> '' THEN BEGIN
        Task.COPYFILTER("Opportunity No.", Opp."No.");
        IF Opp.COUNT = 1 THEN BEGIN
          Opp.FINDFIRST;
          VALIDATE("Opportunity No.", Opp."No.");
          "Contact No." := Opp."Contact No.";
          "Contact Company No." := Opp."Contact Company No.";
          "Campaign No." := Opp."Campaign No.";
          "Salesperson Code" := Opp."Salesperson Code";
          SETRANGE("Opportunity No.", "Opportunity No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Opportunity No."), Opp.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Segment No.") <> '' THEN BEGIN
        Task.COPYFILTER("Segment No.", SegHeader."No.");
        IF SegHeader.COUNT = 1 THEN BEGIN
          SegHeader.FINDFIRST;
          "Segment No." := SegHeader."No.";
          "Campaign No." := SegHeader."Campaign No.";
          "Salesperson Code" := SegHeader."Salesperson Code";
          SETRANGE("Segment No.", "Segment No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Segment No."), SegHeader.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Responsible Person") <> '' THEN BEGIN
        Task.COPYFILTER("Responsible Person", Employee."No.");
        IF Employee.COUNT = 1 THEN BEGIN
          Employee.FINDFIRST;
          VALIDATE("Responsible Person", Employee."No.");
          SETRANGE("Responsible Person", "Responsible Person");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Responsible Person"), Employee.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Responsibility Code") <> '' THEN BEGIN
        Task.COPYFILTER("Responsibility Code", Responsibility.Code);
        IF Responsibility.COUNT = 1 THEN BEGIN
          Responsibility.FINDFIRST;
          VALIDATE("Responsibility Code", Responsibility.Code);
          SETRANGE("Responsibility Code", Rec."Responsibility Code");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Responsibility Code"), Employee.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Estimate No.") <> '' THEN BEGIN
        Task.COPYFILTER("Estimate No.", Estimate."No.");
        IF Estimate.COUNT = 1 THEN BEGIN
          Estimate.FINDFIRST;
          VALIDATE("Estimate No.", Estimate."No.");
          SETRANGE("Estimate No.", "Estimate No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Estimate No."), Estimate.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Estimate No. RAW") <> '' THEN BEGIN
        Task.COPYFILTER("Estimate No. RAW", Estimate."No.");
        IF Estimate.COUNT = 1 THEN BEGIN
          Estimate.FINDFIRST;
          VALIDATE("Estimate No. RAW", Estimate."No.");
          SETRANGE("Estimate No. RAW", Estimate."No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Estimate No. RAW"), Estimate.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Parcel No.") <> '' THEN BEGIN
        Task.COPYFILTER("Parcel No.", Parcel."No.");
        IF Parcel.COUNT = 1 THEN BEGIN
          Parcel.FINDFIRST;
          VALIDATE("Parcel No.", Parcel."No.");
          SETRANGE("Parcel No.", "Parcel No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Parcel No."), Parcel.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Project No.") <> '' THEN BEGIN
        Task.COPYFILTER("Project No.", Job."No.");
        IF Job.COUNT = 1 THEN BEGIN
          Job.FINDFIRST;
          Job.CALCFIELDS(Prospect);
          VALIDATE("Project No.", Job."No.");
          IF Cont.GET(Job.Prospect) THEN
             VALIDATE("Contact No.", Cont."No.");
          "Salesperson Code" := Job."Purchaser Code";
          SETRANGE("Project No.", "Project No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Project No."), Job.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Service Location No.") <> '' THEN BEGIN
        Task.COPYFILTER("Service Location No.", ServiceLocation."No.");
        IF ServiceLocation.COUNT = 1 THEN BEGIN
          ServiceLocation.FINDFIRST;
          ServiceLocation.CALCFIELDS("Contact No.");
          VALIDATE("Service Location No.", ServiceLocation."No.");
          IF Cont.GET(ServiceLocation."Contact No.") THEN
             VALIDATE("Contact No.", Cont."No.");
          SETRANGE("Service Location No.", "Service Location No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Service Location No."), ServiceLocation.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Service Contract No.") <> '' THEN BEGIN
        Task.COPYFILTER("Service Contract No.", ServiceContract."No.");
        IF ServiceContract.COUNT = 1 THEN BEGIN
          ServiceContract.FINDFIRST;
          ServiceContract.CALCFIELDS("Contact No.");
          VALIDATE("Service Contract No.", ServiceContract."No.");
          IF Cont.GET(ServiceContract."Contact No.") THEN
             VALIDATE("Contact No.", Cont."No.");
          SETRANGE("Service Contract No.", "Service Contract No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Service Contract No."), ServiceContract.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Service Call No.") <> '' THEN BEGIN
        Task.COPYFILTER("Service Call No.", ServiceCall."No.");
        IF ServiceCall.COUNT = 1 THEN BEGIN
          ServiceCall.FINDFIRST;
          ServiceCall.CALCFIELDS(Prospect);
          VALIDATE("Service Call No.", ServiceCall."No.");
          IF Cont.GET(ServiceCall.Prospect) THEN
             VALIDATE("Contact No.", Cont."No.");
          "Service Location No." := ServiceCall."Service Location No.";
          "Service Contract No." := ServiceCall."Service Contract No.";
          "Service Order No." := ServiceCall."Service Order No.";
          SETRANGE("Service Call No.", "Service Call No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Service Call No."), ServiceCall.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Service Order No.") <> '' THEN BEGIN
        Task.COPYFILTER("Service Order No.", ServiceOrder."No.");
        IF ServiceOrder.COUNT = 1 THEN BEGIN
          ServiceOrder.FINDFIRST;
          ServiceOrder.CALCFIELDS("Contact No.");
          VALIDATE("Service Order No.", ServiceOrder."No.");
          IF Cont.GET(ServiceOrder."Contact No.") THEN
             VALIDATE("Contact No.", Cont."No.");
          "Service Location No." := ServiceOrder."Service Location No.";
          "Service Contract No." := ServiceOrder."Service Contract No.";
          "Service Call No." := ServiceOrder."Call No.";
          SETRANGE("Service Order No.", "Service Order No.");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Service Order No."), ServiceOrder.TABLECAPTION, TABLECAPTION);
      END;

      IF Task.GETFILTER("Building Code") <> '' THEN BEGIN
        Task.COPYFILTER("Building Code", Building.Code);
        IF Building.COUNT = 1 THEN BEGIN
          Building.FINDFIRST;
          VALIDATE("Building Code", Building.Code);
          SETRANGE("Building Code", "Building Code");
        END ELSE
          ERROR(Text11012003, FIELDCAPTION("Building Code"), Building.TABLECAPTION, TABLECAPTION);
      END;

      IF "Responsible Person" = '' THEN
        "Responsible Person" := "Salesperson Code";
      //**4PS.en

      OnAfterSetFilterFromTask(Rec,Task);
    END;

    [External]
    PROCEDURE CancelOpenTasks@6(OpportunityNo@1000 : Code[20]);
    VAR
      OldTask@1001 : Record 5080;
      OldTask2@1002 : Record 5080;
    BEGIN
      IF OpportunityNo = '' THEN
        EXIT;

      OldTask.RESET;
      OldTask.SETCURRENTKEY("Opportunity No.");
      OldTask.SETRANGE("Opportunity No.",OpportunityNo);
      OldTask.SETRANGE(Closed,FALSE);
      OldTask.SETRANGE(Canceled,FALSE);

      IF OldTask.FIND('-') THEN
        REPEAT
          OldTask2.GET(OldTask."No.");
          OldTask2.Recurring := FALSE;
          OldTask2.VALIDATE(Canceled,TRUE);
          OldTask2.MODIFY;
        UNTIL OldTask.NEXT = 0;
    END;

    LOCAL PROCEDURE CreateCommentLines@7(VAR RMCommentLine2@1001 : Record 5061;TaskNo@1000 : Code[20]);
    VAR
      RMCommentLine@1002 : Record 5061;
    BEGIN
      IF RMCommentLine2.FIND('-') THEN
        REPEAT
          RMCommentLine.INIT;
          RMCommentLine := RMCommentLine2;
          RMCommentLine."No." := TaskNo;
          RMCommentLine.INSERT;
        UNTIL RMCommentLine2.NEXT = 0;
    END;

    [External]
    PROCEDURE SetDuration@16(EndingDate@1000 : Date;EndingTime@1001 : Time);
    BEGIN
      IF (EndingDate < DMY2DATE(1,1,1900)) OR (EndingDate > DMY2DATE(31,12,2999)) THEN
        ERROR(Text006,DMY2DATE(1,1,1900),DMY2DATE(31,12,2999));
      IF NOT "All Day Event" AND (Type = Type::Meeting) THEN
        Duration := CREATEDATETIME(EndingDate,EndingTime) - CREATEDATETIME(Date,"Start Time")
      ELSE
        Duration := CREATEDATETIME(EndingDate + 1,0T) - CREATEDATETIME(Date,0T);

      VALIDATE(Duration);
    END;

    [External]
    PROCEDURE GetEndDateTime@18();
    BEGIN
      IF (Type <> Type::Meeting) OR "All Day Event" THEN
        IF "Start Time" <> 0T THEN
          TempEndDateTime := CREATEDATETIME(Date - 1,"Start Time") + Duration
        ELSE BEGIN
          TempEndDateTime := CREATEDATETIME(Date,0T) + Duration;
          IF "All Day Event" THEN
            TempEndDateTime := CREATEDATETIME(DT2DATE(TempEndDateTime - 1000),0T);
        END
      ELSE
        TempEndDateTime := CREATEDATETIME(Date,"Start Time") + Duration;

      "Ending Date" := DT2DATE(TempEndDateTime);
      IF "All Day Event" THEN
        "Ending Time" := 0T
      ELSE
        "Ending Time" := DT2TIME(TempEndDateTime);
    END;

    LOCAL PROCEDURE UpdateAttendeeTasks@12(OldTaskNo@1003 : Code[20]);
    VAR
      Task2@1001 : Record 5080;
      TempTask@1002 : TEMPORARY Record 5080;
    BEGIN
      Task2.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
      Task2.SETRANGE("Organizer To-do No.",OldTaskNo);
      IF "Team Code" = '' THEN
        Task2.SETFILTER(
          "System To-do Type",
          '%1|%2',
          Task2."System To-do Type"::"Salesperson Attendee",
          Task2."System To-do Type"::"Contact Attendee")
      ELSE
        Task2.SETFILTER("System To-do Type",'<>%1',Task2."System To-do Type"::Team);
      IF Task2.FIND('-') THEN
        REPEAT
          TempTask.INIT;
          TempTask.TRANSFERFIELDS(Task2,FALSE);
          TempTask.INSERT;
          Task2.TRANSFERFIELDS(Rec,FALSE);
          Task2."System To-do Type" := TempTask."System To-do Type";
          IF Task2."System To-do Type" = Task2."System To-do Type"::"Contact Attendee" THEN
            Task2.VALIDATE("Contact No.",TempTask."Contact No.")
          ELSE
            Task2."Salesperson Code" := TempTask."Salesperson Code";
          IF Task2."No." <> OldTaskNo THEN
            Task2.MODIFY(TRUE);
          TempTask.DELETE;
        UNTIL Task2.NEXT = 0
    END;

    LOCAL PROCEDURE UpdateInteractionTemplate@13(VAR Task@1004 : Record 5080;VAR TaskInteractionLanguage@1007 : Record 5196;VAR Attachment@1001 : Record 11072030;InteractTmplCode@1006 : Code[10];AttachmentTemporary@1005 : Boolean);
    VAR
      InteractTmpl@1002 : Record 11072032;
      InteractTemplLanguage@1008 : Record 5103;
      Attachment2@1003 : Record 11072030;
      AttachmentManagement@1000 : Codeunit 11072021;
    BEGIN
      Task.MODIFY;
      TaskInteractionLanguage.SETRANGE("To-do No.",Task."No.");

      IF AttachmentTemporary THEN
        TaskInteractionLanguage.DELETEALL
      ELSE
        TaskInteractionLanguage.DELETEALL(TRUE);

      Task."Interaction Template Code" := InteractTmplCode;

      IF InteractTmpl.GET(Task."Interaction Template Code") THEN BEGIN
        Task."Language Code" := InteractTmpl."Language Code (Default)";
        Task.Subject := InteractTmpl.Description;
        Task."Unit Cost (LCY)" := InteractTmpl."Unit Cost (LCY)";
        Task."Unit Duration (Min.)" := InteractTmpl."Unit Duration (Min.)";
        IF Task."Campaign No." = '' THEN
          Task."Campaign No." := InteractTmpl."Campaign No.";

        IF AttachmentTemporary THEN
          Attachment.DELETEALL;

        InteractTemplLanguage.RESET;
        InteractTemplLanguage.SETRANGE("Interaction Template Code",Task."Interaction Template Code");
        IF InteractTemplLanguage.FIND('-') THEN
          REPEAT
            TaskInteractionLanguage.INIT;
            TaskInteractionLanguage."To-do No." := Task."No.";
            TaskInteractionLanguage."Language Code" := InteractTemplLanguage."Language Code";
            TaskInteractionLanguage.Description := InteractTemplLanguage.Description;
            IF Attachment2.GET(InteractTemplLanguage."Attachment No.") THEN BEGIN
              IF AttachmentTemporary THEN BEGIN
                Attachment.INIT;
                IF Attachment2."Storage Type" = Attachment2."Storage Type"::Embedded THEN
                  Attachment2.CALCFIELDS("Attachment File");
                Attachment.TRANSFERFIELDS(Attachment2);
                Attachment.INSERT;
                TaskInteractionLanguage."Attachment No." := Attachment."No.";
              END ELSE
                TaskInteractionLanguage."Attachment No." :=
                  AttachmentManagement.InsertAttachment(InteractTemplLanguage."Attachment No.");
            END;
            TaskInteractionLanguage.INSERT;
          UNTIL InteractTemplLanguage.NEXT = 0
        ELSE
          Task."Attachment No." := 0;
      END ELSE BEGIN
        Task."Language Code" := '';
        Task.Subject := '';
        Task."Unit Cost (LCY)" := 0;
        Task."Unit Duration (Min.)" := 0;
        Task."Attachment No." := 0;
      END;

      IF TaskInteractionLanguage.GET(Task."No.",Task."Language Code") THEN
        Task."Attachment No." := TaskInteractionLanguage."Attachment No.";

      Task.MODIFY;
    END;

    [Internal]
    PROCEDURE SendMAPIInvitations@21(Task@1000 : Record 5080;FromWizard@1019 : Boolean);
    VAR
      Attendee@1001 : Record 5199;
      NoToSend@1014 : Integer;
      NoNotSent@1016 : Integer;
      Selected@1018 : Integer;
      Options@1017 : Text[1024];
    BEGIN
      IF Task."System To-do Type" <> Task."System To-do Type"::Organizer THEN
        Task.GetMeetingOrganizerTask(Task);
      IF Task."Attachment No." = 0 THEN BEGIN
        Attendee.SETRANGE("To-do No.",Task."Organizer To-do No.");
        Attendee.SETRANGE("Send Invitation",TRUE);
        Attendee.SETRANGE("Attendee Type",Attendee."Attendee Type"::Contact);
        IF NOT Attendee.ISEMPTY THEN BEGIN
          Attendee.SETCURRENTKEY("To-do No.","Attendance Type");
          Attendee.SETRANGE("Send Invitation");
          Attendee.SETRANGE("Attendee Type");
          Attendee.SETRANGE("Attendance Type",Attendee."Attendance Type"::"To-do Organizer");
          IF NOT Attendee.ISEMPTY THEN
            ERROR(Text067,Task.TABLECAPTION,Attendee.TABLECAPTION)
        END;
        Attendee.RESET;
      END;

      Attendee.SETRANGE("To-do No.",Task."Organizer To-do No.");
      Attendee.SETFILTER("Attendance Type",'<>%1',Attendee."Attendance Type"::"To-do Organizer");
      Attendee.SETRANGE("Send Invitation",TRUE);

      IF NOT FromWizard THEN BEGIN
        NoToSend := Attendee.COUNT;
        Attendee.SETRANGE("Invitation Sent",FALSE);
        NoNotSent := Attendee.COUNT;
        IF NoToSend = 0 THEN
          ERROR(Text018,Attendee.FIELDCAPTION("Send Invitation"));
        IF (NoToSend > NoNotSent) AND (NoNotSent <> 0) THEN BEGIN
          Options :=
            STRSUBSTNO(
              Text019,Attendee.FIELDCAPTION("Send Invitation")) + ',' +
            Text020 + ',' +
            Text021;
          Selected := STRMENU(Options,1);
          IF Selected IN [0,3] THEN
            ERROR('');
        END;
        IF NoNotSent = 0 THEN BEGIN
          IF NOT CONFIRM(
               STRSUBSTNO(
                 Text022,Attendee.FIELDCAPTION("Send Invitation")),FALSE)
          THEN
            ERROR('');
        END;
        IF NoToSend = NoNotSent THEN BEGIN
          IF NOT CONFIRM(STRSUBSTNO(Text019,Attendee.FIELDCAPTION("Send Invitation")),FALSE) THEN
            ERROR('');
        END;

        Attendee.RESET;
        Attendee.SETRANGE("To-do No.",Task."Organizer To-do No.");
        Attendee.SETRANGE("Send Invitation",TRUE);
        IF Selected = 2 THEN
          Attendee.SETRANGE("Invitation Sent",FALSE);
      END;

      IF Attendee.FINDFIRST THEN
        ProcessAttendeeAppointment(Task,Attendee);
    END;

    [Internal]
    PROCEDURE CreateAttachment@23(PageNotEditable@1000 : Boolean);
    VAR
      TaskInteractionLanguage@1001 : Record 5196;
    BEGIN
      IF "Interaction Template Code" = '' THEN
        EXIT;
      IF NOT TaskInteractionLanguage.GET("Organizer To-do No.","Language Code") THEN BEGIN
        TaskInteractionLanguage.INIT;
        TaskInteractionLanguage."To-do No." := "Organizer To-do No.";
        TaskInteractionLanguage."Language Code" := "Language Code";
        TaskInteractionLanguage.INSERT(TRUE);
      END;
      IF TaskInteractionLanguage.CreateAttachment(PageNotEditable) THEN BEGIN
        "Attachment No." := TaskInteractionLanguage."Attachment No.";
        MODIFY(TRUE);
      END;
    END;

    [Internal]
    PROCEDURE OpenAttachment@24(PageNotEditable@1000 : Boolean);
    VAR
      TaskInteractionLanguage@1001 : Record 5196;
    BEGIN
      IF "Interaction Template Code" = '' THEN
        EXIT;
      IF TaskInteractionLanguage.GET("Organizer To-do No.","Language Code") THEN
      // IF TaskInteractionLanguage."Attachment No." <> 0 THEN //**4PS.o
        IF TaskInteractionLanguage."Attachment No." <> 0 THEN BEGIN //**4PS.n
          TaskInteractionLanguage.SetTemplateCode("Interaction Template Code"); //**4PS.n
          TaskInteractionLanguage.OpenAttachment(PageNotEditable);
        END; //**4PS.n
      MODIFY(TRUE);
    END;

    [Internal]
    PROCEDURE ImportAttachment@26();
    VAR
      TaskInteractionLanguage@1000 : Record 5196;
    BEGIN
      IF "Interaction Template Code" = '' THEN
        EXIT;

      IF NOT TaskInteractionLanguage.GET("Organizer To-do No.","Language Code") THEN BEGIN
        TaskInteractionLanguage.INIT;
        TaskInteractionLanguage."To-do No." := "Organizer To-do No.";
        TaskInteractionLanguage."Language Code" := "Language Code";
        TaskInteractionLanguage.INSERT(TRUE);
      END;
      TaskInteractionLanguage.ImportAttachment;
      "Attachment No." := TaskInteractionLanguage."Attachment No.";
      MODIFY(TRUE);
    END;

    [Internal]
    PROCEDURE ExportAttachment@27();
    VAR
      TaskInteractionLanguage@1000 : Record 5196;
    BEGIN
      IF "Interaction Template Code" = '' THEN
        EXIT;

      IF TaskInteractionLanguage.GET("Organizer To-do No.","Language Code") THEN
        IF TaskInteractionLanguage."Attachment No." <> 0 THEN
          TaskInteractionLanguage.ExportAttachment;
    END;

    [Internal]
    PROCEDURE RemoveAttachment@28(Prompt@1000 : Boolean);
    VAR
      TaskInteractionLanguage@1001 : Record 5196;
    BEGIN
      IF "Interaction Template Code" = '' THEN
        EXIT;

      IF TaskInteractionLanguage.GET("Organizer To-do No.","Language Code") THEN
        IF TaskInteractionLanguage."Attachment No." <> 0 THEN
          IF TaskInteractionLanguage.RemoveAttachment(Prompt) THEN BEGIN
            "Attachment No." := 0;
            MODIFY(TRUE);
          END;
      MODIFY(TRUE);
    END;

    LOCAL PROCEDURE LogTaskInteraction@30(VAR Task@1006 : Record 5080;VAR Task2@1000 : Record 5080;Deliver@1010 : Boolean);
    VAR
      TempSegLine@1001 : TEMPORARY Record 11072040;
      Cont@1002 : Record 5050;
      Salesperson@1003 : Record 13;
      Campaign@1004 : Record 11072034;
      Attachment@1007 : Record 11072030;
      TempAttachment@1008 : TEMPORARY Record 11072030;
      TempInterLogEntryCommentLine@1009 : TEMPORARY Record 11072067;
      SegManagement@1005 : Codeunit 5051;
      InteractionTemplate@1210190000 : Record 11072032;
    BEGIN
      IF Attachment.GET(Task."Attachment No.") THEN BEGIN
        TempAttachment.DELETEALL;
        TempAttachment.INIT;
        TempAttachment.WizEmbeddAttachment(Attachment);
        TempAttachment.INSERT;
      END;

      TempSegLine.DELETEALL;
      TempSegLine.INIT;
      TempSegLine."To-do No." := Task."Organizer To-do No.";
      TempSegLine.SETRANGE("To-do No.",TempSegLine."To-do No.");
      IF Cont.GET(Task2."Contact No.") THEN
        TempSegLine.VALIDATE("Contact No.",Task2."Contact No.");
      IF Salesperson.GET(Task."Salesperson Code") THEN
        TempSegLine."Salesperson Code" := Salesperson.Code;
      IF Campaign.GET(Task."Campaign No.") THEN
        TempSegLine."Campaign No." := Campaign."No.";
      TempSegLine."Interaction Template Code" := Task."Interaction Template Code";
      TempSegLine."Attachment No." := Task."Attachment No.";
      TempSegLine."Language Code" := Task."Language Code";
      TempSegLine.Subject := Task.Description;
      TempSegLine.Description := Task.Description;
      //**4PS.sn Call 32195
      IF InteractionTemplate.GET(Task."Interaction Template Code") THEN BEGIN
        IF InteractionTemplate."Ignore Contact Corres. Type" OR
           ((InteractionTemplate."Ignore Contact Corres. Type" = FALSE) AND
            (Cont."Correspondence Type" = Cont."Correspondence Type"::" ") AND
            (InteractionTemplate."Correspondence Type (Default)" <> InteractionTemplate."Correspondence Type (Default)"::" ")) THEN
          TempSegLine."Correspondence Type" := InteractionTemplate."Correspondence Type (Default)"
        ELSE
          IF Cont."Correspondence Type" <> Cont."Correspondence Type"::" " THEN
            TempSegLine."Correspondence Type" := Cont."Correspondence Type";
      END;
      IF TempSegLine."Correspondence Type" = TempSegLine."Correspondence Type"::" " THEN
      //**4PS.en Call 32195.en
        TempSegLine."Correspondence Type" := TempSegLine."Correspondence Type"::Email;
      TempSegLine."Cost (LCY)" := Task."Unit Cost (LCY)";
      TempSegLine."Duration (Min.)" := Task."Unit Duration (Min.)";
      TempSegLine."Opportunity No." := Task."Opportunity No.";
      TempSegLine.VALIDATE(Date,WORKDATE);

      TempSegLine.INSERT;
      SegManagement.LogInteraction(TempSegLine,TempAttachment,TempInterLogEntryCommentLine,Deliver,FALSE);
    END;

    [External]
    PROCEDURE CreateAttendeesFromTeam@33(VAR Attendee@1002 : Record 5199;TeamMeetingOrganizer@1000 : Code[20]);
    VAR
      TeamSalesperson@1003 : Record 5084;
      AttendeeLineNo@1004 : Integer;
    BEGIN
      IF TeamMeetingOrganizer = '' THEN
        EXIT;
      Attendee.CreateAttendee(
        Attendee,
        "No.",10000,Attendee."Attendance Type"::"To-do Organizer",
        Attendee."Attendee Type"::Salesperson,
        TeamMeetingOrganizer,
        TRUE);

      TeamSalesperson.SETRANGE("Team Code","Team Code");
      IF TeamSalesperson.FIND('-') THEN BEGIN
        AttendeeLineNo := 20000;
        REPEAT
          IF TeamSalesperson."Salesperson Code" <> TeamMeetingOrganizer THEN
            Attendee.CreateAttendee(
              Attendee,
              "No.",AttendeeLineNo,Attendee."Attendance Type"::Required,
              Attendee."Attendee Type"::Salesperson,
              TeamSalesperson."Salesperson Code",
              FALSE);
          AttendeeLineNo := AttendeeLineNo + 10000;
        UNTIL TeamSalesperson.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE ChangeTeam@37();
    VAR
      Task@1000 : Record 5080;
      TeamSalesperson@1001 : Record 5084;
      TeamSalespersonOld@1004 : Record 5084;
      TempAttendee@1002 : TEMPORARY Record 5199;
      Attendee@1003 : Record 5199;
      Salesperson@1007 : Record 13;
      AttendeeLineNo@1005 : Integer;
      SendInvitation@1006 : Boolean;
      TeamCode@1009 : Code[10];
    BEGIN
      MODIFY;
      TeamSalespersonOld.SETRANGE("Team Code",xRec."Team Code");
      TeamSalesperson.SETRANGE("Team Code","Team Code");
      IF TeamSalesperson.FIND('-') THEN
        REPEAT
          TeamSalesperson.MARK(TRUE)
        UNTIL TeamSalesperson.NEXT = 0;

      IF Type = Type::Meeting THEN BEGIN
        Attendee.SETCURRENTKEY("To-do No.","Attendee Type","Attendee No.");
        Attendee.SETRANGE("To-do No.","Organizer To-do No.");
        Attendee.SETRANGE("Attendee Type",Attendee."Attendee Type"::Salesperson);
        IF Attendee.FIND('-') THEN
          REPEAT
            TeamSalesperson.SETRANGE("Salesperson Code",Attendee."Attendee No.");
            IF TeamSalesperson.FIND('-') THEN
              TeamSalesperson.MARK(FALSE)
            ELSE
              IF Attendee."Attendance Type" <> Attendee."Attendance Type"::"To-do Organizer" THEN BEGIN
                TeamSalespersonOld.SETRANGE("Salesperson Code",Attendee."Attendee No.");
                IF TeamSalespersonOld.FINDFIRST THEN BEGIN
                  Attendee.MARK(TRUE);
                  DeleteAttendeeTask(Attendee)
                END
              END
          UNTIL Attendee.NEXT = 0;
        Attendee.MARKEDONLY(TRUE);
        Attendee.DELETEALL
      END ELSE BEGIN
        Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
        Task.SETRANGE("Organizer To-do No.","Organizer To-do No.");
        Task.SETFILTER("System To-do Type",'%1|%2',
          Task."System To-do Type"::Organizer,
          Task."System To-do Type"::"Salesperson Attendee");
        IF Task.FIND('-') THEN
          REPEAT
            TeamSalesperson.SETRANGE("Salesperson Code",Task."Salesperson Code");
            IF TeamSalesperson.FIND('-') THEN
              TeamSalesperson.MARK(FALSE)
            ELSE
              Task.DELETE(TRUE)
          UNTIL Task.NEXT = 0
      END;

      TeamCode := "Team Code";
      GET("No.");
      "Team Code" := TeamCode;

      TeamSalesperson.MARKEDONLY(TRUE);
      TeamSalesperson.SETRANGE("Salesperson Code");
      IF TeamSalesperson.FIND('-') THEN BEGIN
        IF Type = Type::Meeting THEN
          REPEAT
            Attendee.RESET;
            Attendee.SETRANGE("To-do No.","Organizer To-do No.");
            IF Attendee.FIND('+') THEN
              AttendeeLineNo := Attendee."Line No." + 10000
            ELSE
              AttendeeLineNo := 10000;
            IF Salesperson.GET(TeamSalesperson."Salesperson Code") THEN
              IF Salesperson."E-Mail" <> '' THEN
                SendInvitation := TRUE
              ELSE
                SendInvitation := FALSE;
            Attendee.CreateAttendee(
              Attendee,
              "Organizer To-do No.",AttendeeLineNo,
              Attendee."Attendance Type"::Required,
              Attendee."Attendee Type"::Salesperson,
              TeamSalesperson."Salesperson Code",SendInvitation);
            CreateSubTask(Attendee,Rec)
          UNTIL TeamSalesperson.NEXT = 0
        ELSE
          REPEAT
            TempAttendee.CreateAttendee(
              TempAttendee,
              "No.",10000,
              TempAttendee."Attendance Type"::"To-do Organizer",
              TempAttendee."Attendee Type"::Salesperson,
              TeamSalesperson."Salesperson Code",
              TRUE);
            CreateSubTask(TempAttendee,Rec);
            TempAttendee.DELETEALL
          UNTIL TeamSalesperson.NEXT = 0
      END;
      MODIFY(TRUE)
    END;

    LOCAL PROCEDURE ReassignTeamTaskToSalesperson@38();
    VAR
      Task@1000 : Record 5080;
      Attendee@1001 : Record 5199;
      AttendeeLineNo@1002 : Integer;
      SalespersonCode@1005 : Code[20];
      IsHandled@1003 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeReassignTeamTaskToSalesperson(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      MODIFY;
      IF Type = Type::Meeting THEN BEGIN
        Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
        Task.SETRANGE("Organizer To-do No.","No.");
        Task.SETRANGE("Salesperson Code","Salesperson Code");
        IF Task.FINDFIRST THEN BEGIN
          Attendee.SETCURRENTKEY("To-do No.","Attendee Type","Attendee No.");
          Attendee.SETRANGE("To-do No.","No.");
          Attendee.SETRANGE("Attendee Type",Attendee."Attendee Type"::Salesperson);
          Attendee.SETRANGE("Attendee No.","Salesperson Code");
          IF Attendee.FINDFIRST THEN
            IF Attendee."Attendance Type" = Attendee."Attendance Type"::"To-do Organizer" THEN BEGIN
              Attendee.DELETE;
              Task.DELETE;
            END ELSE
              Attendee.DELETE(TRUE)
        END;

        SalespersonCode := "Salesperson Code";
        GET("No.");
        "Salesperson Code" := SalespersonCode;

        Task.SETRANGE("Salesperson Code");
        Task.SETRANGE("System To-do Type","System To-do Type"::Organizer);
        IF Task.FINDFIRST THEN BEGIN
          Attendee.RESET;
          Attendee.SETCURRENTKEY("To-do No.","Attendee Type","Attendee No.");
          Attendee.SETRANGE("To-do No.","No.");
          Attendee.SETRANGE("Attendee Type",Attendee."Attendee Type"::Salesperson);
          Attendee.SETRANGE("Attendee No.",Task."Salesperson Code");
          IF Attendee.FINDFIRST THEN BEGIN
            Attendee."Attendance Type" := Attendee."Attendance Type"::Required;
            Attendee.MODIFY
          END;
          Task."System To-do Type" := Task."System To-do Type"::"Salesperson Attendee";
          Task.MODIFY(TRUE)
        END;

        Attendee.RESET;
        Attendee.SETRANGE("To-do No.","No.");
        IF Attendee.FINDLAST THEN
          AttendeeLineNo := Attendee."Line No." + 10000
        ELSE
          AttendeeLineNo := 10000;
        Attendee.CreateAttendee(
          Attendee,"No.",AttendeeLineNo,
          Attendee."Attendance Type"::"To-do Organizer",
          Attendee."Attendee Type"::Salesperson,
          "Salesperson Code",TRUE);
        ArrangeOrganizerAttendee;
      END ELSE BEGIN
        Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
        Task.SETRANGE("Organizer To-do No.","No.");
        Task.SETRANGE("System To-do Type","System To-do Type"::Organizer);
        IF Task.FINDFIRST THEN
          Task.DELETEALL(TRUE);

        IF "Contact No." <> '' THEN BEGIN
          Task.SETRANGE("System To-do Type","System To-do Type"::"Contact Attendee");
          IF Task.FINDFIRST THEN BEGIN
            Task."Salesperson Code" := "Salesperson Code";
            Task.MODIFY(TRUE)
          END
        END
      END;

      "System To-do Type" := "System To-do Type"::Organizer;
      "Team Code" := '';
      MODIFY(TRUE);
    END;

    LOCAL PROCEDURE ReassignSalespersonTaskToTeam@36();
    VAR
      TeamSalesperson@1000 : Record 5084;
      Attendee@1001 : Record 5199;
      TempAttendee@1002 : TEMPORARY Record 5199;
      Task@1003 : Record 5080;
      AttendeeLineNo@1004 : Integer;
      SendInvitation@1005 : Boolean;
      SalespersonCode@1006 : Code[20];
      TaskNo@1007 : Code[20];
      IsHandled@1008 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeReassignSalespersonTaskToTeam(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      MODIFY;
      SalespersonCode := "Salesperson Code";
      "Salesperson Code" := '';
      "System To-do Type" := "System To-do Type"::Team;
      MODIFY;

      Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
      Task.SETRANGE("Organizer To-do No.","No.");

      IF Type = Type::Meeting THEN BEGIN
        Attendee.SETRANGE("To-do No.","No.");
        Attendee.SETRANGE("Attendance Type",Attendee."Attendance Type"::"To-do Organizer");
        IF Attendee.FINDFIRST THEN BEGIN
          Attendee."Attendance Type" := Attendee."Attendance Type"::Required;
          TaskNo := CreateSubTask(Attendee,Rec);
          Attendee."Attendance Type" := Attendee."Attendance Type"::"To-do Organizer";
          Attendee.MODIFY;
          IF Task.GET(TaskNo) THEN BEGIN
            Task."System To-do Type" := Task."System To-do Type"::Organizer;
            Task.MODIFY;
          END
        END;

        Task.SETFILTER("System To-do Type",'<>%1',Task."System To-do Type"::"Contact Attendee");
        TeamSalesperson.SETRANGE("Team Code","Team Code");
        IF TeamSalesperson.FIND('-') THEN
          REPEAT
            Task.SETRANGE("Salesperson Code",TeamSalesperson."Salesperson Code");
            IF Task.FINDFIRST THEN BEGIN
              IF (Task."System To-do Type" = Task."System To-do Type"::Organizer) AND
                 (Task."Salesperson Code" <> SalespersonCode)
              THEN BEGIN
                Task."System To-do Type" := Task."System To-do Type"::"Salesperson Attendee";
                MODIFY(TRUE)
              END
            END ELSE BEGIN
              Attendee.RESET;
              Attendee.SETRANGE("To-do No.","No.");
              IF Attendee.FINDLAST THEN
                AttendeeLineNo := Attendee."Line No." + 10000
              ELSE
                AttendeeLineNo := 10000;
              IF Salesperson.GET(TeamSalesperson."Salesperson Code") THEN
                IF Salesperson."E-Mail" <> '' THEN
                  SendInvitation := TRUE
                ELSE
                  SendInvitation := FALSE;
              Attendee.CreateAttendee(
                Attendee,"No.",AttendeeLineNo,
                Attendee."Attendance Type"::Required,
                Attendee."Attendee Type"::Salesperson,
                TeamSalesperson."Salesperson Code",
                SendInvitation);
              CreateSubTask(Attendee,Rec)
            END
          UNTIL TeamSalesperson.NEXT = 0
      END ELSE BEGIN
        TeamSalesperson.SETRANGE("Team Code","Team Code");
        IF TeamSalesperson.FIND('-') THEN
          REPEAT
            TempAttendee.CreateAttendee(
              TempAttendee,
              "No.",10000,
              TempAttendee."Attendance Type"::"To-do Organizer",
              TempAttendee."Attendee Type"::Salesperson,
              TeamSalesperson."Salesperson Code",
              TRUE);
            CreateSubTask(TempAttendee,Rec);
            TempAttendee.DELETEALL
          UNTIL TeamSalesperson.NEXT = 0;
      END;

      MODIFY(TRUE)
    END;

    [External]
    PROCEDURE GetMeetingOrganizerTask@39(VAR Task@1000 : Record 5080);
    BEGIN
      IF Type = Type::Meeting THEN
        IF "Team Code" <> '' THEN BEGIN
          Task.SETCURRENTKEY("Organizer To-do No.","System To-do Type");
          Task.SETRANGE("Organizer To-do No.","Organizer To-do No.");
          Task.SETRANGE("System To-do Type","System To-do Type"::Organizer);
          Task.FIND('-')
        END ELSE
          Task.GET("Organizer To-do No.")
    END;

    [External]
    PROCEDURE ArrangeOrganizerAttendee@40();
    VAR
      Attendee@1000 : Record 5199;
      FirstLineNo@1001 : Integer;
      LastLineNo@1002 : Integer;
      OrganizerLineNo@1003 : Integer;
    BEGIN
      Attendee.SETRANGE("To-do No.","No.");
      IF NOT Attendee.FINDFIRST THEN
        EXIT;
      FirstLineNo := Attendee."Line No.";
      Attendee.FINDLAST;
      LastLineNo := Attendee."Line No.";

      Attendee.SETCURRENTKEY("To-do No.","Attendance Type");
      Attendee.SETRANGE("Attendance Type",Attendee."Attendance Type"::"To-do Organizer");
      Attendee.FINDFIRST;
      OrganizerLineNo := Attendee."Line No.";

      IF FirstLineNo <> OrganizerLineNo THEN BEGIN
        Attendee.RENAME("No.",LastLineNo + 1);
        Attendee.GET("No.",FirstLineNo);
        Attendee.RENAME("No.",OrganizerLineNo);
        Attendee.GET("No.",LastLineNo + 1);
        Attendee.RENAME("No.",FirstLineNo)
      END
    END;

    LOCAL PROCEDURE StartWizard@48();
    BEGIN
      "Wizard Step" := "Wizard Step"::"1";

      "Wizard Contact Name" := GetContactName;
      IF Campaign.GET("Campaign No.") THEN
        "Wizard Campaign Description" := Campaign.Description;
      IF Opp.GET("Opportunity No.") THEN
        "Wizard Opportunity Description" := Opp.Description;
      IF SegHeader.GET(GETFILTER("Segment No.")) THEN
        "Segment Description" := SegHeader.Description;
      IF Team.GET(GETFILTER("Team Code")) THEN
        "Team To-do" := TRUE;

      Duration := 1440 * 1000 * 60;
      Date := TODAY;
      GetEndDateTime;

      INSERT;
      IF PAGE.RUNMODAL(PAGE::"Create Task",Rec) = ACTION::OK THEN;
    END;

    [External]
    PROCEDURE CheckStatus@42();
    VAR
      Salesperson@1001 : Record 13;
      TeamSalesperson@1100525000 : Record 5084;
    BEGIN
      IF Date = 0D THEN
        ErrorMessage(FIELDCAPTION(Date));

      IF Description = '' THEN
        ErrorMessage(FIELDCAPTION(Description));

      //**4PS.so
      //IF "Team To-do" AND ("Team Code" = '') THEN
      //  ErrorMessage(FIELDCAPTION("Team Code"));
      //**4PS.eo
      //**4PS.sn  //kzwerver, 120716, #T000560
      IF "Team To-do" THEN BEGIN
        IF ("Team Code" = '') THEN
          ErrorMessage(FIELDCAPTION("Team Code"));
        IF (Type = Type::"Phone Call") THEN BEGIN
          TeamSalesperson.SETRANGE("Team Code", "Team Code");
          TeamSalesperson.SETFILTER("Salesperson Code", '%1', '');
          IF (TeamSalesperson.FINDFIRST) THEN
            ERROR(Text11012004, TeamSalesperson.FIELDCAPTION("Salesperson Code"));
        END;
      END;
      //**4PS.en
      IF NOT "Team To-do" AND ("Salesperson Code" = '') THEN
        ErrorMessage(FIELDCAPTION("Salesperson Code"));

      IF Type = Type::Meeting THEN BEGIN
        IF NOT "All Day Event" THEN BEGIN
          IF "Start Time" = 0T THEN
            ErrorMessage(FIELDCAPTION("Start Time"));
          IF Duration = 0 THEN
            ErrorMessage(FIELDCAPTION(Duration));
        END;

        IF ("Interaction Template Code" = '') AND "Send on finish" THEN
          ErrorMessage(FIELDCAPTION("Interaction Template Code"));

        TempAttendee.RESET;
        TempAttendee.SETRANGE("Attendance Type",TempAttendee."Attendance Type"::"To-do Organizer");
        IF TempAttendee.ISEMPTY THEN BEGIN
          TempAttendee.RESET;
          ERROR(Text065);
        END;

        IF TempAttendee.FIND('-') THEN
          Salesperson.GET(TempAttendee."Attendee No.");
        TempAttendee.RESET;
        IF ("Attachment No." = 0) AND "Send on finish" THEN BEGIN
          TempAttendee.SETRANGE("Send Invitation",TRUE);
          TempAttendee.SETRANGE("Attendee Type",TempAttendee."Attendee Type"::Contact);
          IF NOT TempAttendee.ISEMPTY THEN BEGIN
            TempAttendee.RESET;
            ERROR(Text067,TABLECAPTION,TempAttendee.TABLECAPTION);
          END;
          TempAttendee.RESET;
        END;
        TempAttendee.RESET;
        IF "Send on finish" THEN BEGIN
          TempAttendee.SETRANGE("Send Invitation",TRUE);
          IF TempAttendee.ISEMPTY THEN BEGIN
            TempAttendee.RESET;
            ERROR(Text068,TempAttendee.FIELDCAPTION("Send Invitation"));
          END;
          TempAttendee.RESET;
        END;
      END;

      IF (Location = '') AND "Send on finish" THEN
        ErrorMessage(FIELDCAPTION(Location));
    END;

    [Internal]
    PROCEDURE FinishWizard@41(SendExchangeAppointment@1002 : Boolean);
    VAR
      SegLine@1000 : Record 11072040;
      SendOnFinish@1001 : Boolean;
    BEGIN
      CreateExchangeAppointment := SendExchangeAppointment;
      IF Recurring THEN BEGIN
        TESTFIELD("Recurring Date Interval");
        TESTFIELD("Calc. Due Date From");
      END;
      IF Type = Type::Meeting THEN BEGIN
        IF NOT "Team To-do" THEN BEGIN
          TempAttendee.SETRANGE("Attendance Type",TempAttendee."Attendance Type"::"To-do Organizer");
          TempAttendee.FIND('-');
          VALIDATE("Salesperson Code",TempAttendee."Attendee No.");
          TempAttendee.RESET;
        END;
        VALIDATE("Contact No.",'');
      END ELSE BEGIN
        IF Cont.GET("Contact No.") THEN
          TempAttendee.CreateAttendee(
            TempAttendee,
            "No.",10000,TempAttendee."Attendance Type"::Required,
            TempAttendee."Attendee Type"::Contact,
            Cont."No.",Cont."E-Mail" <> '');
        IF SegHeader.GET("Segment No.") THEN BEGIN
          SegLine.SETRANGE("Segment No.","Segment No.");
          SegLine.SETFILTER("Contact No.",'<>%1','');
          IF SegLine.FIND('-') THEN
            REPEAT
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",SegLine."Line No.",TempAttendee."Attendance Type"::Required,
                TempAttendee."Attendee Type"::Contact,
                SegLine."Contact No.",
                (Cont.GET(SegLine."Contact No.") AND
                 (Cont."E-Mail" <> '')));
            UNTIL SegLine.NEXT = 0;
        END;
      END;

      SendOnFinish := "Send on finish";
      //"Wizard Step" := "Wizard Step"::" "; //**4PS.o
      //"Team To-do" := FALSE;  //**4PS.o
      "Send on finish" := FALSE;
      //"Segment Description" := ''; //**4PS.o
      "Team Meeting Organizer" := '';
      "Activity Code" := '';
      //"Wizard Contact Name" := '';  //**4PS.o
      //"Wizard Campaign Description" := '';  //**4PS.o
      //"Wizard Opportunity Description" := '';  //**4PS.o
      MODIFY;
      InsertTask(Rec,TempRMCommentLine,TempAttendee,TempTaskInteractionLanguage,TempAttachment,'',SendOnFinish);
      DELETE;
    END;

    LOCAL PROCEDURE GetContactName@65() : Text[100];
    BEGIN
      IF Cont.GET("Contact No.") THEN
        EXIT(Cont.Name);
      IF Cont.GET("Contact Company No.") THEN
        EXIT(Cont.Name);
    END;

    LOCAL PROCEDURE ErrorMessage@47(FieldName@1000 : Text[1024]);
    BEGIN
      ERROR(Text043,FieldName);
    END;

    [Internal]
    PROCEDURE AssignDefaultAttendeeInfo@46();
    VAR
      InteractionTemplate@1002 : Record 11072032;
      InteractionTemplateSetup@1001 : Record 5122;
      SegLine@1003 : Record 11072040;
      TeamSalesperson@1004 : Record 5084;
      Salesperson@1000 : Record 13;
      AttendeeLineNo@1005 : Integer;
    BEGIN
      IF TempAttendee.FIND('+') THEN
        AttendeeLineNo := TempAttendee."Line No." + 10000
      ELSE
        AttendeeLineNo := 10000;
      CASE TRUE OF
        (GETFILTER("Contact No.") <> '') AND (GETFILTER("Salesperson Code") <> ''):
          BEGIN
            IF Salesperson.GET(GETFILTER("Salesperson Code")) THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::"To-do Organizer",
                TempAttendee."Attendee Type"::Salesperson,
                Salesperson.Code,TRUE);
              AttendeeLineNo += 10000;
            END;
            IF Cont.GET(GETFILTER("Contact No.")) THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::Required,
                TempAttendee."Attendee Type"::Contact,
                Cont."No.",
                Cont."E-Mail" <> '');
              AttendeeLineNo += 10000;
            END;
          END;
        (GETFILTER("Contact No.") <> '') AND (GETFILTER("Campaign No.") <> ''):
          BEGIN
            IF Campaign.GET(GETFILTER("Campaign No.")) THEN
              IF Salesperson.GET(Campaign."Salesperson Code") THEN BEGIN
                TempAttendee.CreateAttendee(
                  TempAttendee,
                  "No.",AttendeeLineNo,
                  TempAttendee."Attendance Type"::"To-do Organizer",
                  TempAttendee."Attendee Type"::Salesperson,
                  Salesperson.Code,TRUE);
                AttendeeLineNo += 10000
              END;
            IF Cont.GET(GETFILTER("Contact No.")) THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::Required,
                TempAttendee."Attendee Type"::Contact,
                Cont."No.",Cont."E-Mail" <> '');
              AttendeeLineNo += 10000;
            END;
          END
        ELSE BEGIN
          IF Cont.GET(GETFILTER("Contact No.")) THEN BEGIN
            IF Cont."Salesperson Code" <> '' THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::"To-do Organizer",
                TempAttendee."Attendee Type"::Salesperson,
                Cont."Salesperson Code",TRUE);
              AttendeeLineNo += 10000
            END;
            TempAttendee.CreateAttendee(
              TempAttendee,
              "No.",AttendeeLineNo,
              TempAttendee."Attendance Type"::Required,
              TempAttendee."Attendee Type"::Contact,
              Cont."No.",Cont."E-Mail" <> '');
            AttendeeLineNo += 10000;
          END ELSE
            IF Cont.GET(GETFILTER("Contact Company No.")) THEN BEGIN
              IF Cont."Salesperson Code" <> '' THEN BEGIN
                TempAttendee.CreateAttendee(
                  TempAttendee,
                  "No.",AttendeeLineNo,
                  TempAttendee."Attendance Type"::"To-do Organizer",
                  TempAttendee."Attendee Type"::Salesperson,
                  Cont."Salesperson Code",TRUE);
                AttendeeLineNo += 10000
              END;
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::Required,
                TempAttendee."Attendee Type"::Contact,
                Cont."No.",Cont."E-Mail" <> '');
              AttendeeLineNo += 10000;
            END;

          IF Salesperson.GET(GETFILTER("Salesperson Code")) THEN BEGIN
            TempAttendee.CreateAttendee(
              TempAttendee,
              "No.",AttendeeLineNo,
              TempAttendee."Attendance Type"::"To-do Organizer",
              TempAttendee."Attendee Type"::Salesperson,
              Salesperson.Code,TRUE);
            AttendeeLineNo += 10000;
          END;

          IF Campaign.GET(GETFILTER("Campaign No.")) THEN
            IF Salesperson.GET(Campaign."Salesperson Code") THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::"To-do Organizer",
                TempAttendee."Attendee Type"::Salesperson,
                Salesperson.Code,TRUE);
              AttendeeLineNo += 10000
            END;

          IF Opp.GET(GETFILTER("Opportunity No.")) THEN BEGIN
            IF Salesperson.GET(Opp."Salesperson Code") THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::"To-do Organizer",
                TempAttendee."Attendee Type"::Salesperson,
                Salesperson.Code,TRUE);
              AttendeeLineNo += 10000
            END;
            IF Cont.GET(Opp."Contact No.") THEN BEGIN
              TempAttendee.CreateAttendee(
                TempAttendee,
                "No.",AttendeeLineNo,
                TempAttendee."Attendance Type"::Required,
                TempAttendee."Attendee Type"::Contact,
                Cont."No.",Cont."E-Mail" <> '');
              AttendeeLineNo += 10000
            END;
          END;
        END;
      END;

      IF SegHeader.GET(GETFILTER("Segment No.")) THEN BEGIN
        IF Salesperson.GET(SegHeader."Salesperson Code") THEN BEGIN
          TempAttendee.CreateAttendee(
            TempAttendee,
            "No.",AttendeeLineNo,
            TempAttendee."Attendance Type"::"To-do Organizer",
            TempAttendee."Attendee Type"::Salesperson,
            Salesperson.Code,TRUE);
          AttendeeLineNo += 10000
        END;
        SegLine.SETRANGE("Segment No.","Segment No.");
        SegLine.SETFILTER("Contact No.",'<>%1','');
        IF SegLine.FIND('-') THEN
          REPEAT
            TempAttendee.CreateAttendee(
              TempAttendee,
              "No.",AttendeeLineNo,
              TempAttendee."Attendance Type"::Required,
              TempAttendee."Attendee Type"::Contact,
              SegLine."Contact No.",
              (Cont.GET(SegLine."Contact No.") AND
               (Cont."E-Mail" <> '')));
            AttendeeLineNo += 10000
          UNTIL SegLine.NEXT = 0;
      END;
      IF Team.GET("Team Code") THEN BEGIN
        TeamSalesperson.SETRANGE("Team Code",Team.Code);
        IF TeamSalesperson.FIND('-') THEN
          REPEAT
            TempAttendee.SETRANGE("Attendee Type",TempAttendee."Attendee Type"::Salesperson);
            TempAttendee.SETRANGE("Attendee No.",TeamSalesperson."Salesperson Code");
            IF NOT TempAttendee.FIND('-') THEN
              IF Salesperson.GET(TeamSalesperson."Salesperson Code") THEN BEGIN
                TempAttendee.RESET;
                TempAttendee.CreateAttendee(
                  TempAttendee,
                  "No.",AttendeeLineNo,
                  TempAttendee."Attendance Type"::Required,
                  TempAttendee."Attendee Type"::Salesperson,
                  TeamSalesperson."Salesperson Code",
                  Salesperson."E-Mail" <> '');
                AttendeeLineNo += 10000
              END;
            TempAttendee.RESET;
          UNTIL TeamSalesperson.NEXT = 0;
      END;

      InteractionTemplateSetup.GET;
      IF (InteractionTemplateSetup."Meeting Invitation" <> '') AND
         InteractionTemplate.GET(InteractionTemplateSetup."Meeting Invitation")
      THEN
        UpdateInteractionTemplate(
          Rec,TempTaskInteractionLanguage,TempAttachment,InteractionTemplate.Code,TRUE);
    END;

    [Internal]
    PROCEDURE ValidateInteractionTemplCode@66();
    BEGIN
      UpdateInteractionTemplate(
        Rec,TempTaskInteractionLanguage,TempAttachment,"Interaction Template Code",TRUE);
      LoadTempAttachment;
    END;

    [Internal]
    PROCEDURE AssistEditAttachment@58();
    BEGIN
      IF TempAttachment.GET("Attachment No.") THEN BEGIN
        TempAttachment.SetTemplateCode("Interaction Template Code"); //**4PS.n
        TempAttachment.OpenAttachment("Interaction Template Code" + ' ' + Description,TRUE,"Language Code");
        TempAttachment.MODIFY;
      END ELSE
        ERROR(Text047);
    END;

    [External]
    PROCEDURE ValidateLanguageCode@67();
    BEGIN
      IF "Language Code" = xRec."Language Code" THEN
        EXIT;

      IF NOT TempTaskInteractionLanguage.GET("No.","Language Code") THEN BEGIN
        IF "No." = '' THEN
          ERROR(Text009,TempTaskInteractionLanguage.TABLECAPTION);
      END ELSE
        "Attachment No." := TempTaskInteractionLanguage."Attachment No.";
    END;

    [External]
    PROCEDURE LookupLanguageCode@68();
    BEGIN
      TempTaskInteractionLanguage.SETFILTER("To-do No.",'');
      IF TempTaskInteractionLanguage.GET('',"Language Code") THEN
        IF PAGE.RUNMODAL(0,TempTaskInteractionLanguage) = ACTION::LookupOK THEN BEGIN
          "Language Code" := TempTaskInteractionLanguage."Language Code";
          "Attachment No." := TempTaskInteractionLanguage."Attachment No.";
        END;
    END;

    [Internal]
    PROCEDURE LoadTempAttachment@45();
    VAR
      Attachment@1000 : Record 11072030;
      TempAttachment2@1001 : TEMPORARY Record 11072030;
    BEGIN
      IF TempAttachment.FINDSET THEN
        REPEAT
          TempAttachment2 := TempAttachment;
          TempAttachment2.INSERT;
        UNTIL TempAttachment.NEXT = 0;

      IF TempAttachment2.FINDSET THEN
        REPEAT
          Attachment.GET(TempAttachment2."No.");
          Attachment.CALCFIELDS("Attachment File");
          TempAttachment.GET(TempAttachment2."No.");
          TempAttachment.WizEmbeddAttachment(Attachment);
          TempAttachment."No." := TempAttachment2."No.";
          TempAttachment.MODIFY;
        UNTIL TempAttachment2.NEXT = 0;
    END;

    [External]
    PROCEDURE ClearDefaultAttendeeInfo@44();
    BEGIN
      TempAttendee.DELETEALL;
      TempAttachment.DELETEALL;
      TempTaskInteractionLanguage.DELETEALL;
      "Interaction Template Code" := '';
      "Language Code" := '';
      "Attachment No." := 0;
      Subject := '';
      "Unit Cost (LCY)" := 0;
      "Unit Duration (Min.)" := 0;
      MODIFY;
    END;

    [External]
    PROCEDURE GetAttendee@59(VAR Attendee@1000 : Record 5199);
    BEGIN
      Attendee.DELETEALL;
      IF TempAttendee.FIND('-') THEN
        REPEAT
          Attendee := TempAttendee;
          Attendee.INSERT;
        UNTIL TempAttendee.NEXT = 0;
    END;

    [External]
    PROCEDURE SetAttendee@49(VAR Attendee@1000 : Record 5199);
    BEGIN
      TempAttendee.DELETEALL;

      IF Attendee.FINDSET THEN
        REPEAT
          TempAttendee := Attendee;
          TempAttendee.INSERT;
        UNTIL Attendee.NEXT = 0;
    END;

    [External]
    PROCEDURE SetComments@53(VAR RMCommentLine@1001 : Record 5061);
    BEGIN
      TempRMCommentLine.DELETEALL;
      IF RMCommentLine.FINDSET THEN
        REPEAT
          TempRMCommentLine := RMCommentLine;
          TempRMCommentLine.INSERT;
        UNTIL RMCommentLine.NEXT = 0;
    END;

    LOCAL PROCEDURE StartWizard2@63();
    BEGIN
      "Wizard Contact Name" := GetContactName;
      IF Cont.GET(GETFILTER("Contact No.")) THEN
        "Wizard Contact Name" := Cont.Name
      ELSE
        IF Cont.GET(GETFILTER("Contact Company No.")) THEN
          "Wizard Contact Name" := Cont.Name;

      IF Campaign.GET(GETFILTER("Campaign No.")) THEN
        "Wizard Campaign Description" := Campaign.Description;

      IF SegHeader.GET(GETFILTER("Segment No.")) THEN
        "Segment Description" := SegHeader.Description;

      "Wizard Step" := "Wizard Step"::"1";
      Duration := 1440 * 1000 * 60;

      INSERT;

      IF PAGE.RUNMODAL(PAGE::"Assign Activity",Rec) = ACTION::OK THEN;
    END;

    [External]
    PROCEDURE CheckAssignActivityStatus@60();
    BEGIN
      IF "Activity Code" = '' THEN
        ErrorMessage(Text051);
      IF Date = 0D THEN
        ErrorMessage(FIELDCAPTION(Date));
      IF ("Team Code" = '') AND ("Salesperson Code" = '') THEN
        ERROR(Text053,FIELDCAPTION("Salesperson Code"),FIELDCAPTION("Team Code"));
      IF ("Team Code" <> '') AND
         Activity.IncludesMeeting("Activity Code") AND
         ("Team Meeting Organizer" = '')
      THEN
        ERROR(Text056,"Activity Code");
    END;

    [Internal]
    PROCEDURE FinishAssignActivity@54();
    VAR
      TempRMCommentLine@1003 : TEMPORARY Record 5061;
      TempAttendee@1002 : TEMPORARY Record 5199;
      TempTaskInteractionLanguage@1001 : TEMPORARY Record 5196;
      TempAttachment@1000 : TEMPORARY Record 11072030;
    BEGIN
      TempAttendee.DELETEALL;
      IF "Team Meeting Organizer" <> '' THEN
        TempAttendee.CreateAttendee(
          TempAttendee,
          "No.",10000,TempAttendee."Attendance Type"::"To-do Organizer",
          TempAttendee."Attendee Type"::Salesperson,
          "Team Meeting Organizer",
          TRUE)
      ELSE
        IF "Salesperson Code" <> '' THEN
          TempAttendee.CreateAttendee(
            TempAttendee,
            "No.",10000,TempAttendee."Attendance Type"::"To-do Organizer",
            TempAttendee."Attendee Type"::Salesperson,
            "Salesperson Code",
            TRUE);
      InsertTask(
        Rec,TempRMCommentLine,TempAttendee,
        TempTaskInteractionLanguage,TempAttachment,"Activity Code",FALSE);
      DELETE;
    END;

    LOCAL PROCEDURE FillSalesPersonContact@8(VAR TaskParameter@1000 : Record 5080;AttendeeParameter@1001 : Record 5199);
    BEGIN
      CASE AttendeeParameter."Attendee Type" OF
        AttendeeParameter."Attendee Type"::Contact:
          TaskParameter.VALIDATE("Contact No.",AttendeeParameter."Attendee No.");
        AttendeeParameter."Attendee Type"::Salesperson:
          TaskParameter.VALIDATE("Salesperson Code",AttendeeParameter."Attendee No.");
      END;
    END;

    [External]
    PROCEDURE SetRunFromForm@11();
    BEGIN
      RunFormCode := TRUE;
    END;

    LOCAL PROCEDURE IsCalledFromForm@29() : Boolean;
    BEGIN
      //EXIT((CurrFieldNo <> 0) OR RunFormCode); //**4PS.o
      EXIT(((CurrFieldNo <> 0) AND GUIALLOWED) OR RunFormCode); //**4PS.n //kzwerver, 140523
    END;

    LOCAL PROCEDURE OneDayDuration@31() : Integer;
    BEGIN
      EXIT(86400000); // 24 * 60 * 60 * 1000 = 86,400,000 ms in 24 hours
    END;

    LOCAL PROCEDURE GetCurrentUserTimeZone@32(VAR TimeZoneInfo@1006 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.TimeZoneInfo";TimeZoneID@1000 : Text);
    VAR
      TimeZoneInfoRussianStandard@1008 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.TimeZoneInfo";
    BEGIN
      IF TimeZoneID = 'Russian Standard Time' THEN BEGIN
        TimeZoneInfoRussianStandard := TimeZoneInfoRussianStandard.FindSystemTimeZoneById(TimeZoneID);
        TimeZoneInfo := TimeZoneInfo.CreateCustomTimeZone(TimeZoneID,TimeZoneInfoRussianStandard.BaseUtcOffset,'','');
      END ELSE
        TimeZoneInfo := TimeZoneInfo.FindSystemTimeZoneById(TimeZoneID);
    END;

    LOCAL PROCEDURE InitializeExchangeAppointment@81(VAR Appointment@1000 : DotNet "'Microsoft.Dynamics.Nav.EwsWrapper, Version=14.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Exchange.IAppointment";VAR ExchangeWebServicesServer@1001 : Codeunit 5321);
    VAR
      TimeZoneInfo@1003 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.TimeZoneInfo";
    BEGIN
      SetupExchangeService(ExchangeWebServicesServer);
      ExchangeWebServicesServer.CreateAppointment(Appointment);
      GetCurrentUserTimeZone(TimeZoneInfo,ExchangeWebServicesServer.GetCurrentUserTimeZone);
      UpdateAppointment(Appointment,TimeZoneInfo);
    END;

    LOCAL PROCEDURE UpdateAppointmentSalesPersonList@82(VAR SalesPersonList@1000 : Text;AddSalesPersonName@1001 : Text[50]);
    BEGIN
      IF AddSalesPersonName <> '' THEN
        IF SalesPersonList = '' THEN
          SalesPersonList := AddSalesPersonName
        ELSE
          SalesPersonList += ', ' + AddSalesPersonName ;
    END;

    LOCAL PROCEDURE SaveAppointment@52(VAR Appointment@1001 : DotNet "'Microsoft.Dynamics.Nav.EwsWrapper, Version=14.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Exchange.IAppointment");
    BEGIN
      Appointment.SendAppointment;
    END;

    [Internal]
    PROCEDURE UpdateAppointment@61(VAR Appointment@1000 : DotNet "'Microsoft.Dynamics.Nav.EwsWrapper, Version=14.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Exchange.IAppointment";TimeZoneInfo@1002 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.TimeZoneInfo");
    VAR
      DateTime@1001 : DateTime;
    BEGIN
      Appointment.Subject := Description;
      Appointment.Location := Location;
      DateTime := CREATEDATETIME(Date,"Start Time");
      Appointment.MeetingStart := DateTime;
      IF "All Day Event" THEN
        Appointment.IsAllDayEvent := TRUE
      ELSE BEGIN
        DateTime := CREATEDATETIME("Ending Date","Ending Time");
        Appointment.MeetingEnd := DateTime;
      END;
      Appointment.StartTimeZone := TimeZoneInfo;
      Appointment.EndTimeZone := TimeZoneInfo;
    END;

    [Internal]
    PROCEDURE SetupExchangeService@62(VAR ExchangeWebServicesServer@1000 : Codeunit 5321);
    VAR
      User@1001 : Record 2000000120;
    BEGIN
      COMMIT;
      User.SETRANGE("User Name",USERID);
      IF NOT User.FINDFIRST AND NOT Initialize(ExchangeWebServicesServer,User."Authentication Email") THEN
        IF NOT InitializeServiceWithCredentials(ExchangeWebServicesServer) THEN
          ERROR('');
    END;

    LOCAL PROCEDURE MakeAppointmentBody@43(Task@1001 : Record 5080;SalespersonsList@1000 : Text;SalespersonName@1002 : Text[50]) : Text;
    BEGIN
      EXIT(
        STRSUBSTNO(Text015,SalespersonsList) + '<br/><br/>' +
        STRSUBSTNO(Text016,FORMAT(Task.Date),FORMAT(Task."Start Time"),FORMAT(Task.Location)) + '<br/><br/>' +
        Text017 + '<br/>' +
        SalespersonName + '<br/>' +
      //FORMAT(TODAY) + ' ' + FORMAT(TIME)); //**4PS.o
        FORMAT(TODAY) + ' ' + FORMAT(DT2TIME(CURRENTDATETIME))); //**4PS.n
    END;

    LOCAL PROCEDURE SetAttendeeInvitationSent@76(VAR Attendee@1000 : Record 5199);
    BEGIN
      Attendee."Invitation Sent" := TRUE;
      Attendee.MODIFY;
    END;

    [Internal]
    PROCEDURE AddAppointmentAttendee@70(VAR Appointment@1000 : DotNet "'Microsoft.Dynamics.Nav.EwsWrapper, Version=14.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Exchange.IAppointment";VAR Attendee@1001 : Record 5199;Email@1002 : Text);
    BEGIN
      IF Attendee."Attendance Type" = Attendee."Attendance Type"::Required THEN
        Appointment.AddRequiredAttendee(Email)
      ELSE
        Appointment.AddOptionalAttendee(Email);
      SetAttendeeInvitationSent(Attendee);
    END;

    LOCAL PROCEDURE ProcessAttendeeAppointment@72(Task@1002 : Record 5080;VAR Attendee@1004 : Record 5199);
    VAR
      Task2@1003 : Record 5080;
      Salesperson@1006 : Record 13;
      Salesperson2@1005 : Record 13;
      ExchangeWebServicesServer@1001 : Codeunit 5321;
      Mail@1009 : Codeunit 397;
      Appointment@1000 : DotNet "'Microsoft.Dynamics.Nav.EwsWrapper, Version=14.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Exchange.IAppointment";
      SalesPersonList@1007 : Text;
      Body@1008 : Text;
      Contact@1100529700 : Record 5050;
    BEGIN
      IF CreateExchangeAppointment THEN
        InitializeExchangeAppointment(Appointment,ExchangeWebServicesServer);
      REPEAT
        IF FindAttendeeTask(Task2,Attendee) THEN
          IF Attendee."Attendee Type" = Attendee."Attendee Type"::Salesperson THEN
            IF Salesperson2.GET(Task2."Salesperson Code") AND
               Salesperson.GET(Task."Salesperson Code")
            THEN
              IF CreateExchangeAppointment THEN BEGIN
                UpdateAppointmentSalesPersonList(SalesPersonList,Salesperson2.Name);
                IF Salesperson2."E-Mail" <> '' THEN
                  AddAppointmentAttendee(Appointment,Attendee,Salesperson2."E-Mail");
              END ELSE BEGIN
                Body := MakeAppointmentBody(Task,Salesperson2.Name,Salesperson.Name);
                CLEAR(Mail); //**4PS.n
                IF Mail.NewMessage(Salesperson2."E-Mail",'','',Task2.Description,Body,'',FALSE) THEN
                  SetAttendeeInvitationSent(Attendee)
                ELSE
                  MESSAGE(Text023,Attendee."Attendee Name");
              END
            ELSE BEGIN
              LogTaskInteraction(Task,Task2,TRUE);
              SetAttendeeInvitationSent(Attendee);
            END
            //**4PS.sn
            ELSE
              IF Attendee."Attendee Type" = Attendee."Attendee Type"::Contact THEN
                IF Contact.GET(Attendee."Attendee No.") AND
                   Salesperson.GET(Task."Salesperson Code")
                THEN
                  IF CreateExchangeAppointment THEN BEGIN
                    UpdateAppointmentSalesPersonList(SalesPersonList,Contact.Name);
                    IF Contact."E-Mail" <> '' THEN
                      AddAppointmentAttendee(Appointment,Attendee,Contact."E-Mail");
                  END ELSE BEGIN
                    Body := MakeAppointmentBody(Task,Contact.Name,Salesperson.Name);
                    CLEAR(Mail);
                    IF Mail.NewMessage(Contact."E-Mail",'','',Task2.Description,Body,'',FALSE) THEN
                      SetAttendeeInvitationSent(Attendee)
                    ELSE
                      MESSAGE(Text023,Attendee."Attendee Name");
                  END
                ELSE BEGIN
                  LogTaskInteraction(Task,Task2,TRUE);
                  SetAttendeeInvitationSent(Attendee);
                END
            //**4PS.en
      UNTIL Attendee.NEXT = 0;
      IF CreateExchangeAppointment AND (SalesPersonList <> '') THEN BEGIN
        Body := MakeAppointmentBody(Task,SalesPersonList,Salesperson.Name);
        Appointment.Body := Body;
        SaveAppointment(Appointment)
      END;
    END;

    [TryFunction]
    LOCAL PROCEDURE InitializeServiceWithCredentials@73(VAR ExchangeWebServicesServer@1001 : Codeunit 5321);
    VAR
      TempOfficeAdminCredentials@1000 : TEMPORARY Record 1612;
      WebCredentials@1004 : DotNet "'Microsoft.Exchange.WebServices, Version=15.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Exchange.WebServices.Data.WebCredentials";
      WebCredentialsLogin@1002 : Text[250];
    BEGIN
      TempOfficeAdminCredentials.INIT;
      TempOfficeAdminCredentials.INSERT;
      COMMIT;
      CLEARLASTERROR;
      IF PAGE.RUNMODAL(PAGE::"Office 365 Credentials",TempOfficeAdminCredentials) <> ACTION::LookupOK THEN
        ERROR('');
      WebCredentialsLogin := TempOfficeAdminCredentials.Email;
      WebCredentials := WebCredentials.WebCredentials(WebCredentialsLogin,TempOfficeAdminCredentials.GetPassword);
      TempOfficeAdminCredentials.DELETE;
      ExchangeWebServicesServer.Initialize(
        WebCredentialsLogin,ExchangeWebServicesServer.ProdEndpoint,WebCredentials,FALSE);
    END;

    [TryFunction]
    LOCAL PROCEDURE Initialize@34(VAR ExchangeWebServicesServer@1004 : Codeunit 5321;AuthenticationEmail@1003 : Text[250]);
    VAR
      ExchangeServiceSetup@1000 : Record 5324;
      AzureADMgt@1001 : Codeunit 6300;
      AccessToken@1002 : Text;
    BEGIN
      AccessToken := AzureADMgt.GetAccessToken(AzureADMgt.GetO365Resource,AzureADMgt.GetO365ResourceName,FALSE);

      IF AccessToken <> '' THEN BEGIN
        ExchangeWebServicesServer.InitializeWithOAuthToken(AccessToken,ExchangeWebServicesServer.GetEndpoint);
        EXIT;
      END;

      ExchangeServiceSetup.GET;

      ExchangeWebServicesServer.InitializeWithCertificate(
        ExchangeServiceSetup."Azure AD App. ID",ExchangeServiceSetup."Azure AD App. Cert. Thumbprint",
        ExchangeServiceSetup."Azure AD Auth. Endpoint",ExchangeServiceSetup."Exchange Service Endpoint",
        ExchangeServiceSetup."Exchange Resource Uri");

      ExchangeWebServicesServer.SetImpersonatedIdentity(AuthenticationEmail);
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetFilterFromTask@5(VAR ToTask@1000 : Record 5080;VAR FromTask@1001 : Record 5080);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCreateSubTask@71(Attendee@1000 : Record 5199;Task@1001 : Record 5080;VAR TaskNo@1002 : Code[20];VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeInsertTaskAndRelatedData@56(VAR Task@1000 : Record 5080;VAR SkipTypeUpdate@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeReassignSalespersonTaskToTeam@75(VAR Task@1000 : Record 5080;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeReassignTeamTaskToSalesperson@78(VAR Task@1000 : Record 5080;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateTaskFromTaskOnBeforeStartWizard@57(VAR Task@1000 : Record 5080;FromTask@1001 : Record 5080);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateTaskFromSalesHeaderOnBeforeStartWizard@87(VAR Task@1000 : Record 5080;SalesHeader@1001 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateTaskFromSalesHeaderoOnBeforeStartWizard@55(VAR Task@1000 : Record 5080;SalesHeader@1001 : Record 36);
    BEGIN
      // Obsolete
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateTaskFromInteractLogEntryOnBeforeStartWizard@69(VAR Task@1000 : Record 5080;InteractionLogEntry@1001 : Record 11072027);
    BEGIN
    END;

    PROCEDURE AddCommentLine@1100495000();
    VAR
      CustLedgerEntryRec@1100525000 : Record 21;
      SalesCommentLine@1100525001 : Record 44;
      CockpitActionRec@1100525003 : Record 11012396;
      CustCockpitRec@1100525005 : Record 11012395;
      NextLine@1100525002 : Integer;
      CommentTxt@1100525004 : Text[80];
      DocTypeSalComLine@1100525006 : 'Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order,Shipment,Posted Invoice,Posted Credit Memo,Posted Return Receipt,,,,,Payment,Refund';
    BEGIN
      //**4PS
      IF "Cust. Ledger Entry No." = 0 THEN
        EXIT;

      IF Description = xRec.Description THEN
        EXIT;

      IF CustLedgerEntryRec.GET("Cust. Ledger Entry No.") THEN BEGIN
        CASE CustLedgerEntryRec."Document Type" OF
          CustLedgerEntryRec."Document Type"::Invoice:
            DocTypeSalComLine := DocTypeSalComLine::"Posted Invoice";
          CustLedgerEntryRec."Document Type"::"Credit Memo":
            DocTypeSalComLine := DocTypeSalComLine::"Posted Credit Memo";
          CustLedgerEntryRec."Document Type"::Payment:
            DocTypeSalComLine := DocTypeSalComLine::Payment;
          CustLedgerEntryRec."Document Type"::Refund:
            DocTypeSalComLine := DocTypeSalComLine::Refund;
          ELSE
            EXIT;
        END;
        SalesCommentLine.SETRANGE("Document Type", DocTypeSalComLine);
        SalesCommentLine.SETRANGE("No.",CustLedgerEntryRec."Document No.");
        IF SalesCommentLine.FIND('+') THEN
          NextLine := SalesCommentLine."Line No." + 1000
        ELSE
          NextLine := 1000;
        CockpitActionRec.GET("Action No.");
        CommentTxt := STRSUBSTNO(Text11012002,CockpitActionRec.Description,Date);
        CustCockpitRec.InsertCommentline(
          NextLine,
          CustLedgerEntryRec."Document No.",
          WORKDATE,
          0,
          USERID,
          CommentTxt,
          DocTypeSalComLine);
        NextLine := NextLine -1;
        CockpitActionRec.GET("Action No.");
        CustCockpitRec.InsertCommentline(
          NextLine,
          CustLedgerEntryRec."Document No.",
          WORKDATE,
          0,
          USERID,
          Description,
          DocTypeSalComLine);

      END;
    END;

    PROCEDURE CreateNewActivity@1100525000() : Code[20];
    VAR
      Task@1100525001 : Record 5080;
    BEGIN
      //**4PS
      Task.COPY(Rec);
      Task."No." := '';
      Task.Description := Text11012001;
      Task.Status := Task.Status::"Not Started";
      Task.Canceled := FALSE;
      Task.Closed := FALSE;
      Task."Date Closed" := 0D;
      Task.INSERT(TRUE);
      EXIT(Task."No.");
    END;

    PROCEDURE PrepareTryoutContactLookup@1100528700(VAR Contact@1100528700 : Record 5050);
    VAR
      TryoutLine@1100528701 : Record 11012755;
    BEGIN
      //**4PS
      IF "Try-out No." <> '' THEN BEGIN
        TryoutLine.SETRANGE("Try-out No.", "Try-out No.");
        IF TryoutLine.FINDSET THEN BEGIN
          REPEAT
            IF TryoutLine."Contact No." <> '' THEN BEGIN
              Contact."No." := TryoutLine."Contact No.";
              Contact.MARK(TRUE);
            END;
            IF TryoutLine."Contact Person No." <> '' THEN BEGIN
              Contact."No." := TryoutLine."Contact Person No.";
              Contact.MARK(TRUE);
            END;
          UNTIL TryoutLine.NEXT = 0;
          Contact.MARKEDONLY(TRUE);
        END;
      END;
    END;

    PROCEDURE PrepareTryoutQuoteContLookup@1100528703(VAR Contact@1100528700 : Record 5050);
    VAR
      TryoutQuoteLine@1100528701 : Record 11125864;
    BEGIN
      //**4PS
      IF "Try-out Quote No." <> '' THEN BEGIN
        TryoutQuoteLine.SETRANGE("Try-out Quote", "Try-out Quote No.");
        IF TryoutQuoteLine.FINDSET THEN BEGIN
          REPEAT
            IF TryoutQuoteLine."Contact No." <> '' THEN BEGIN
              Contact."No." := TryoutQuoteLine."Contact No.";
              Contact.MARK(TRUE);
            END;
            IF TryoutQuoteLine."Contact Person No." <> '' THEN BEGIN
              Contact."No." := TryoutQuoteLine."Contact Person No.";
              Contact.MARK(TRUE);
            END;
          UNTIL TryoutQuoteLine.NEXT = 0;
          Contact.MARKEDONLY(TRUE);
        END;
      END;
    END;

    PROCEDURE SetFilterMyTasks@1100528702();
    VAR
      UserSetup@1100528700 : Record 91;
    BEGIN
      //**4PS
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("Employee No.");
      SETRANGE("Responsible Person", UserSetup."Employee No.");
    END;

    PROCEDURE CreateTaskFromCustLedgerEntry@1100528701(CustLedgerEntry@1100528700 : Record 21);
    VAR
      CustCockpitAction@1100528703 : Record 11012396;
      CustCockpitActionList@1100528702 : Page 11020375;
    BEGIN
      //**4PS
      INIT;
      "Cust. Ledger Entry No." := CustLedgerEntry."Entry No.";
      "Customer No." := CustLedgerEntry."Customer No.";

      CustCockpitActionList.LOOKUPMODE(TRUE);
      IF CustCockpitActionList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        CustCockpitActionList.GETRECORD(CustCockpitAction);
        "Action No." := CustCockpitAction."Action No.";
      END ELSE
        EXIT;

      IF "Responsible Person" = '' THEN
        "Responsible Person" := "Salesperson Code";

      StartWizard;
    END;

    BEGIN
    {
      4PS - 03-10-06 - "Date Closed" Changed to Editable
    }
    END.
  }
}

