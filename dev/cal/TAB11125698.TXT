OBJECT Table 11125698 Estimate Line RAW
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnInsert=VAR
               EstimateParagraphRAW@1100525000 : Record 11125679;
               EstimateParagraphRAW2@1100525002 : Record 11125679;
               EstimateParagraphRAW3@1100525003 : Record 11125679;
               EstimateLineRAW@1100525001 : Record 11125698;
             BEGIN
               InitRecord;  //C041773
               CheckEstLineAllowedForPercElements();  //C026965

               IF (NOT MessageAlreadyShown) THEN BEGIN
                 IF STRLEN("Tender Paragraph No.") = 6 THEN BEGIN
                   // Find corresponding estimate element
                   EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
                   EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                   EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                   EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
                   EstimateParagraphRAW.FINDFIRST;

                   CASE EstimateParagraphRAW.Type OF
                     EstimateParagraphRAW.Type::"Commitment (Main Line)":
                       // User is adding an estimate line for a commitment; check for commitment description estimate elements
                       BEGIN
                         EstimateParagraphRAW3.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
                         EstimateParagraphRAW3.SETRANGE("Estimate No.", "Estimate No.");
                         EstimateParagraphRAW3.SETFILTER(
                           "Tender Paragraph No.",
                           '%1..%2',
                           COPYSTR("Tender Paragraph No.", 1, 5) + '1',
                           COPYSTR("Tender Paragraph No.", 1, 5) + '9');
                         EstimateParagraphRAW3.SETRANGE("Construction Spec. Line No.", '00');
                         IF EstimateParagraphRAW3.FINDFIRST THEN BEGIN
                           MESSAGE(
                             Text021,
                             TABLECAPTION,
                             EstimateParagraphRAW.TABLECAPTION,
                             EstimateParagraphRAW.FIELDCAPTION(Type),
                             EstimateParagraphRAW.Type,
                             EstimateParagraphRAW3.Type);
                           MessageAlreadyShown := ShowMessageOnce;
                         END;
                       END;
                     EstimateParagraphRAW.Type::"Commitment Description (Main Line)":
                       // User is adding an estimate line for a commitment description; check for commitment estimate lines
                       BEGIN
                         EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                         EstimateLineRAW.SETRANGE("Tender Paragraph No.", COPYSTR("Tender Paragraph No.", 1, 5) + '0');
                         IF NOT EstimateLineRAW.ISEMPTY THEN BEGIN
                           EstimateParagraphRAW2.Type := EstimateParagraphRAW2.Type::"Commitment (Main Line)";
                           MESSAGE(
                             Text020,
                             TABLECAPTION,
                             EstimateParagraphRAW.TABLECAPTION,
                             EstimateParagraphRAW.FIELDCAPTION(Type),
                             EstimateParagraphRAW.Type,
                             EstimateParagraphRAW2.Type);
                           MessageAlreadyShown := ShowMessageOnce;
                         END;
                       END;
                   END;
                 END;
               END;

               IF "VAT Prod. Posting Group" = '' THEN
                 VALIDATE("VAT Prod. Posting Group", Estimate."VAT Prod. Posting Group (H)");

               InitAdjustmentFactor;
               IF Quantity <> 0 THEN
                 VALIDATE(Quantity);  //if Ctrl C+V used, force update hours based on adjustment factor

               "Price Agreement" := FALSE;
               "Norm Agreement" := FALSE;

               InitPurchaseFields();
               InsertSurcharge;//DP00433
               "Excel Line" := FALSE;  //DP01561
             END;

    OnModify=BEGIN
               TESTFIELD("Summary Line", FALSE);
               //DP01676.sn
               CheckRelatedApplianceType;
               IF "Recipe Type" = "Recipe Type"::"Recipe Header" THEN BEGIN
                 "Rate Code" := '';
                 Rate := 0;
                 "Rate Type" := "Rate Type"::Hours;
               END;
               //DP01676.en

               IF NOT SkipUpdateLogBook THEN
                 Estimate.UpdateLogbook("Estimate No.");
             END;

    OnDelete=VAR
               EstimateLineRAW@1210190000 : Record 11125698;
               EstimateLineRAW1@1100528903 : Record 11125698;
               EstimateLineRAW2@1100528902 : Record 11125698;
               CommentLineRAW@1100525000 : Record 11125684;
               EstimateApplianceCodeRAW@1100528900 : Record 11125697;
               EstimateCode@1100528901 : Record 11229772;
             BEGIN
               IF NOT SkipUpdateLogBook THEN
                 Estimate.UpdateLogbook("Estimate No.");

               EstimateMgmt.ModifyLinkedEstLinesRAW(0,Rec,0); //0:delete  (DP01208)

               IF "Line No." <> 0 THEN BEGIN   //when line no.=0 Navision will be closed; error possible as a result of import
                 //DP01676.sn
                 IF ("Appliance Type" = "Appliance Type"::Recipe) OR
                    ("Appliance Type" = "Appliance Type"::EstimateRecipe)  THEN BEGIN
                   EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                   EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                   EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
                   EstimateLineRAW.DELETEALL(TRUE);
                 END;
                 IF ("Appliance Type" = "Appliance Type"::PlantSet) OR
                    ("Appliance Type" = "Appliance Type"::PlantType) THEN BEGIN
                   EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                   EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                   EstimateLineRAW.SETRANGE("Attached to Line No.", "Line No.");
                   EstimateLineRAW.DELETEALL(TRUE);
                 END;
                 //DP01676.en
               END;

               //DP01676.sn
               EstimateCode.SETRANGE("Estimate No.","Estimate No.");
               EstimateCode.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
               EstimateCode.SETRANGE("Estimate Line", "Line No.");
               EstimateCode.DELETEALL;

               EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
               EstimateApplianceCodeRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
               EstimateApplianceCodeRAW.SETRANGE("Line No.", "Line No.");
               IF EstimateApplianceCodeRAW.FINDSET THEN BEGIN
                 REPEAT
                   EstimateApplianceCodeRAW.DELETE;
                   //
                   EstimateLineRAW1.SETCURRENTKEY("Estimate No.", "Appliance Type",  "Appliance Code");
                   EstimateLineRAW1.SETRANGE("Estimate No.", "Estimate No.");
                   EstimateLineRAW1.SETRANGE("Appliance Type", "Appliance Type"::EstimateAppliance);
                   EstimateLineRAW1.SETRANGE("Appliance Code", "Appliance Code");
                   IF EstimateLineRAW1.FINDSET THEN BEGIN
                     REPEAT
                       IF (EstimateLineRAW1."Tender Paragraph No." <> "Tender Paragraph No.") OR
                          (EstimateLineRAW1."Line No." <> "Line No.") THEN BEGIN
                         EstimateLineRAW2 := EstimateLineRAW1;
                         EstimateLineRAW2."Appliance Type" := EstimateLineRAW2."Appliance Type"::" ";
                         EstimateLineRAW2."Appliance Code" := '';
                         EstimateLineRAW2.MODIFY;
                       END;
                     UNTIL EstimateLineRAW1.NEXT = 0;
                   END;
                 UNTIL EstimateApplianceCodeRAW.NEXT = 0;
               END;
               //DP01676.en

               CommentLineRAW.DeleteEstimateLineComment("Estimate No.", "Tender Paragraph No.", "Line No.");  //DP01086.n
             END;

    CaptionML=ENU=Estimate Line RAW;
    DrillDownPageID=Page11125685;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate;
                                                   CaptionML=[ENU=Estimate No.;
                                                              SVE=Kalkylnr] }
    { 15  ;   ;Tender Paragraph No.;Code6         ;TableRelation="Estimate Paragraph RAW"."Tender Paragraph No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   OnValidate=VAR
                                                                EstimateParagraphRAW@1100525000 : Record 11125679;
                                                              BEGIN
                                                                EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
                                                                EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                                                                EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');

                                                                IF NOT EstimateParagraphRAW.FINDFIRST THEN
                                                                  EstimateParagraphRAW.INIT;

                                                                VALIDATE("Part Quantity", EstimateParagraphRAW.Quantity);
                                                                "Surcharge % Labor" := EstimateParagraphRAW."Surcharge % Labor";
                                                                "Surcharge % Material" := EstimateParagraphRAW."Surcharge % Material";
                                                                "Surcharge % Subcontracting" := EstimateParagraphRAW."Surcharge % Subcontracting";
                                                                "Surcharge % Plant" := EstimateParagraphRAW."Surcharge % Plant";
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph;
                                                              SVE=Anbudsstycke];
                                                   Description=DP01676 }
    { 20  ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=[ENU=Estimate Description;
                                                              SVE=Kalkylbeskrivning];
                                                   Editable=No }
    { 30  ;   ;Appliance Type      ;Option        ;OnValidate=VAR
                                                                EstimateLineRAW@1100525000 : Record 11125698;
                                                              BEGIN
                                                                IF "Appliance Type" = "Appliance Type"::" " THEN BEGIN
                                                                  //C052698.sn
                                                                    IF (xRec."Appliance Type" = "Appliance Type"::Recipe) OR
                                                                       (xRec."Appliance Type" = "Appliance Type"::EstimateRecipe)  THEN BEGIN
                                                                    EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                                                                    EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                                                                    EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
                                                                    IF NOT EstimateLineRAW.ISEMPTY THEN
                                                                      ERROR(Text024);
                                                                  END;
                                                                  IF (xRec."Appliance Type" = "Appliance Type"::PlantSet) OR
                                                                     (xRec."Appliance Type" = "Appliance Type"::PlantType) THEN BEGIN
                                                                    EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                                                                    EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                                                                    EstimateLineRAW.SETRANGE("Attached to Line No.", "Line No.");
                                                                    IF NOT EstimateLineRAW.ISEMPTY THEN
                                                                      ERROR(Text024);
                                                                  END;
                                                                  //C052698.en
                                                                  "Appliance Type" := xRec."Appliance Type";
                                                                  VALIDATE("Appliance Code",'');  //clear related fields
                                                                  "Appliance Type" := "Appliance Type"::" ";
                                                                  //C052698.sn
                                                                  InitNormRelatedFields(0);
                                                                  InitRateRelatedFields;
                                                                  InitPriceRelatedFields;
                                                                  InitCostTypeRelatedFields;
                                                                  //C052698.en
                                                                END ELSE BEGIN
                                                                  IF ("Appliance Type" <> xRec."Appliance Type") AND (xRec."Appliance Type" <> "Appliance Type"::" ") THEN
                                                                    SwitchApplianceAllowed;  //C052698
                                                                END;
                                                                IF "Appliance Type" = "Appliance Type"::RateCode THEN
                                                                  GetDefaultEstimateRate;
                                                                IF "Appliance Type" = "Appliance Type"::TradeItem THEN
                                                                  GetDefaultEstimateVendor;  //C051377
                                                              END;

                                                   CaptionML=ENU=Appliance Type;
                                                   OptionCaptionML=ENU=" ,Item,Trade Item,Recipe,Plant Type,Plant Set,Subcontracting Activity,Estimate Appliance,Rate Code,Estimate Recipe,Cost Object";
                                                   OptionString=[ ,Item,TradeItem,Recipe,PlantType,PlantSet,SubcontractingActivity,EstimateAppliance,RateCode,EstimateRecipe,CostObject];
                                                   Description=DP01619 }
    { 35  ;   ;Appliance Code      ;Code20        ;OnValidate=BEGIN
                                                                ValidateAppliance;  //DP01619
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupAppliance;  //DP01619
                                                            END;

                                                   CaptionML=ENU=Appliance Code;
                                                   Description=DP01619 }
    { 65  ;   ;Recipe Group        ;Code10        ;TableRelation="Recipe Group";
                                                   CaptionML=[ENU=Recipe Group;
                                                              SVE=Malltyp];
                                                   Editable=No }
    { 70  ;   ;Recipe No.          ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Recipe Group));
                                                   OnValidate=VAR
                                                                BaseRecipe@1100525000 : Record 11020581;
                                                                LastLine@1100525001 : Integer;
                                                                EstimateLineRAW@1100528900 : Record 11125698;
                                                              BEGIN
                                                                //DP01619
                                                                IF "Recipe No." <> xRec."Recipe No." THEN BEGIN
                                                                  IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", "Line No.") THEN BEGIN
                                                                    EstimateLineRAW.SETRANGE("Estimate No.", EstimateLineRAW."Estimate No.");
                                                                    EstimateLineRAW.SETRANGE("Tender Paragraph No.", EstimateLineRAW."Tender Paragraph No.");
                                                                    EstimateLineRAW.SETRANGE("Attached to Recipe Line", EstimateLineRAW."Line No.");
                                                                    EstimateLineRAW.DELETEALL;
                                                                  END;
                                                                END;
                                                                BaseRecipe.GET("Recipe Group", "Recipe No.");
                                                                Description := BaseRecipe.Description;
                                                                "Unit of Measure" := BaseRecipe."Unit of Measure";
                                                                Source := Source::User;  //do not used Source::Recipe
                                                                "Recipe Type" := "Recipe Type"::"Recipe Header";
                                                                FillObligation;
                                                                IF ExplodeRcp THEN BEGIN
                                                                  MODIFY;
                                                                  LastLine := "Line No.";
                                                                  AddLineFromStandardRecipe("Estimate No.", "Tender Paragraph No.",
                                                                   "Recipe Group", "Recipe No.",
                                                                   "Line No.", "Recipe Type"::"Recipe Line", "Part Quantity", Source, LastLine);
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Recipe No.;
                                                              SVE=Mallnr];
                                                   Editable=No }
    { 80  ;   ;Line No.            ;Integer       ;ValidateTableRelation=No;
                                                   CaptionML=[ENU=Line No.;
                                                              SVE=Radnr] }
    { 87  ;   ;Line Level          ;Integer       ;CaptionML=ENU=Line Level }
    { 90  ;   ;Set Code            ;Code10        ;TableRelation="Plant Set";
                                                   OnValidate=BEGIN
                                                                ValidateSetCode;  //DP01208
                                                                EstimateMgmt.ModifyLinkedEstLinesRAW(0,Rec,0); //0:delete
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Set Code;
                                                              SVE=StÑll in kod] }
    { 91  ;   ;Set Level           ;Integer       ;CaptionML=[ENU=Set Level;
                                                              SVE=StÑll in nivÜ];
                                                   Description=DP01208 }
    { 95  ;   ;Attached to Line No.;Integer       ;TableRelation="Estimate Line RAW"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                       Tender Paragraph No.=FIELD(Tender Paragraph No.));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              SVE=Bifogad till radnr];
                                                   Description=DP01208;
                                                   Editable=No }
    { 100 ;   ;Description         ;Text100       ;OnValidate=BEGIN
                                                                UpdateEst.CheckBackSlash(Description);
                                                              END;

                                                   CaptionML=[ENU=Description;
                                                              SVE=Beskrivning] }
    { 105 ;   ;Source              ;Option        ;CaptionML=[ENU=Source;
                                                              SVE=KÑlla];
                                                   OptionCaptionML=ENU=User,Recipe,,,Summary;
                                                   OptionString=User,Recipe,,,Summary;
                                                   Editable=No }
    { 110 ;   ;Time Quantity       ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Time Quantity") THEN
                                                                  UpdateRecipeFields;  //DP01676

                                                                UpdateCumulativeQty;
                                                              END;

                                                   CaptionML=[ENU=Time Quantity;
                                                              SVE=Tidskvantitet];
                                                   BlankZero=Yes }
    { 120 ;   ;Unit of Time        ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Time;
                                                              SVE=Tidsenhet] }
    { 140 ;   ;Quantity            ;Decimal       ;OnValidate=VAR
                                                                ResultObligation@1100528901 : Decimal;
                                                              BEGIN
                                                                //VALIDATE("Part Quantity");
                                                                EstimateMgmt.SetQuantityRatio(Quantity, xRec.Quantity);  //C044680
                                                                EstimateMgmt.ModifyLinkedEstLinesRAW(1,Rec,0); //1:modify quantity

                                                                UpdateCumulativeQty;

                                                                //DP01676.sn
                                                                IF (CurrFieldNo = FIELDNO(Quantity)) OR CalledByObligation THEN BEGIN
                                                                  IF ("Appliance Type" <> "Appliance Type"::Recipe) AND ("Appliance Type" <> "Appliance Type"::EstimateRecipe) THEN BEGIN
                                                                    IF ("Cost Type" = "Cost Type"::Material) OR ("Cost Type" = "Cost Type"::Sundry) OR
                                                                      (("Cost Type" = "Cost Type"::Subcontracting) AND ("Subcontracting in Hours" = FALSE)) OR
                                                                      (("Cost Type" = "Cost Type"::Plant) AND ("Plant Rates in Hours" = FALSE)) THEN BEGIN  //C057123
                                                                      ResultObligation := ReadObligation;
                                                                      IF ResultObligation <> 0 THEN BEGIN
                                                                        "Apply Obligation" := TRUE;
                                                                        "Ignore Paragraph Quantity" := "Apply Obligation";
                                                                      END;
                                                                    END ELSE BEGIN
                                                                      "Apply Obligation" := EvaluateResultObligation(Quantity, "Production Rate",FIELDNO(Quantity),ResultObligation);
                                                                      IF IgnoreParagraphQuantityForEuroEntry THEN  //C056424
                                                                        "Ignore Paragraph Quantity" := TRUE
                                                                      ELSE
                                                                        "Ignore Paragraph Quantity" := "Apply Obligation";
                                                                      IF "Apply Obligation" THEN BEGIN
                                                                        IF ("Cost Type" = "Cost Type"::Labor) OR
                                                                          (("Cost Type" = "Cost Type"::Subcontracting) AND ("Subcontracting in Hours")) OR
                                                                          (("Cost Type" = "Cost Type"::Plant) AND ("Plant Rates in Hours")) THEN  //C060821
                                                                          VALIDATE("Production Rate", ResultObligation);
                                                                      END;
                                                                    END;
                                                                    UpdateCumulativeQty;  //C060821
                                                                  END;
                                                                  CheckRecipeTotals;
                                                                END;
                                                                //DP01676.en
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 150 ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN BEGIN
                                                                  IF "Unit of Measure" <>  xRec."Unit of Measure" THEN
                                                                    CheckItemUnitConversion(Rec, xRec);
                                                                  CalculateTotals;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              SVE=Enhet] }
    { 155 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                DetermineNorm;
                                                              END;

                                                   CaptionML=[ENU=Norm Group;
                                                              SVE=Normgrupp] }
    { 157 ;   ;Sub Operation Code  ;Code20        ;TableRelation="Sub Operation".Code;
                                                   OnValidate=VAR
                                                                SubOperRec@11012000 : Record 11012166;
                                                                OperRec@11012001 : Record 11012165;
                                                              BEGIN
                                                                DetermineNormGroup;
                                                                DetermineNorm;

                                                                IF SubOperRec.GET("Sub Operation Code") THEN BEGIN
                                                                  IF OperRec.GET(SubOperRec.Operation) THEN BEGIN
                                                                    //DP01676.sn
                                                                    IF ("Cost Object" = '') OR (OldSubOperationDefault = TRUE) THEN BEGIN
                                                                      OperRec.TESTFIELD("Cost Object");
                                                                      VALIDATE("Cost Object", OperRec."Cost Object");
                                                                      CheckCostObject("Cost Object", FALSE);
                                                                    END;
                                                                    //DP01676.en
                                                                    IF OperRec."Rate Code" <> '' THEN
                                                                      VALIDATE("Rate Code", OperRec."Rate Code");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Sub Operation Code;
                                                              SVE=Underinsatskod] }
    { 160 ;   ;Norm                ;Decimal       ;OnValidate=BEGIN
                                                                Norm := ROUND(Norm, 0.00001);  //??

                                                                IF CurrFieldNo <> FIELDNO("Production Rate") THEN
                                                                  OnValidateNorm;  //DP01676

                                                                CalculateTotals;  //norm and production rate used to calculate hours
                                                              END;

                                                   CaptionML=[ENU=Norm;
                                                              SVE=Norm];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 165 ;   ;Production Rate     ;Decimal       ;OnValidate=BEGIN
                                                                OnValidateProductionRate;  //DP01676

                                                                IF CurrFieldNo = FIELDNO("Production Rate") THEN
                                                                  UpdateRecipeFields;  //DP01676
                                                              END;

                                                   CaptionML=[ENU=Production Rate;
                                                              SVE=Produktionstakt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 170 ;   ;Rate Code           ;Code10        ;TableRelation="Estimate Rate"."Rate Code" WHERE (Estimate No.=FIELD(Estimate No.));
                                                   OnValidate=BEGIN
                                                                EstSetup.GET;
                                                                IF RateRec.GET("Estimate No.","Rate Code") THEN BEGIN
                                                                  //DP01676.sn
                                                                  TESTFIELD("Cost Type", "Cost Type"::Labor);
                                                                  IF ("Item No." + "Basic Item" + "Trade Item" = '') AND
                                                                     ("Sub Operation Code" + "Subcontracting Activity" = '') AND
                                                                     ("Plant Type" + "Set Code" = '') AND
                                                                     ("Recipe No." = '') THEN BEGIN
                                                                    Description := RateRec.Description;
                                                                  END;
                                                                  IF (EstSetup."Upd. Cost Object by Rate Code") OR ("Cost Object" = '') THEN BEGIN
                                                                    IF RateRec."Cost Object" <> '' THEN BEGIN
                                                                      "Cost Object" := RateRec."Cost Object";
                                                                      Estimate.GET("Estimate No.");
                                                                      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE,'');
                                                                      VALIDATE("Cost Component", DimValRec."Cost Component");
                                                                      UpdateSurchargePct; //C052361
                                                                      IF "Appliance Type" = "Appliance Type"::RateCode THEN //DP01676
                                                                        "Unit of Measure" := DimValRec."Unit of Measure";
                                                                      IF Estimate."Estimate Based On" = Estimate."Estimate Based On"::CostObject THEN
                                                                        Description := DimValRec.Name;
                                                                    END;
                                                                  END;
                                                                  //DP01676.en
                                                                  Rate := RateRec."Cost Rate";
                                                                  "Rate Type" := RateRec."Rate Type";
                                                                  IF "Rate Type" = "Rate Type"::Minutes THEN
                                                                    "Team Size" := RateRec."Team Size"
                                                                  ELSE
                                                                    "Team Size" := 0;
                                                                  //check conversion norm after change of rate type and team size:
                                                                  IF ("Rate Type" <> xRec."Rate Type") OR ("Team Size" <> xRec."Team Size") THEN
                                                                    ConvertNorm(("Rate Type" <> xRec."Rate Type"), ("Team Size" <> xRec."Team Size"));
                                                                END ELSE BEGIN
                                                                  IF "Sub Operation Code" <> '' THEN
                                                                    TESTFIELD("Rate Code");
                                                                  InitRateRelatedFields;  //DP01676
                                                                  InitNormRelatedFields(0);  //C053751
                                                                END;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Rate Code;
                                                              SVE=Avgiftskod] }
    { 180 ;   ;Rate                ;Decimal       ;CaptionML=[ENU=Rate;
                                                              SVE=Avgift];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 211 ;   ;Buy Back Price      ;Decimal       ;OnValidate=BEGIN
                                                                EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",1,"Net Cost Price","Buy Back Price","Buy Back %");  //DP01676
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Buy Back Price;
                                                              SVE=èterkîpspris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 214 ;   ;Buy Back %          ;Decimal       ;OnValidate=BEGIN
                                                                EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",2,"Net Cost Price","Buy Back Price","Buy Back %");  //DP01676
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Buy Back %;
                                                              SVE=èterkîpsprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 220 ;   ;Hours               ;Decimal       ;CaptionML=[ENU=Hours;
                                                              SVE=Timmar];
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 230 ;   ;Labor Amount        ;Decimal       ;CaptionML=[ENU=Labor Amount;
                                                              SVE=Arbetskraftsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Material Amount     ;Decimal       ;CaptionML=[ENU=Material Amount;
                                                              SVE=Materialbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 241 ;   ;Gross Amount        ;Decimal       ;CaptionML=[ENU=Gross Amount;
                                                              SVE=Brutto Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Subcontracting Amount;Decimal      ;CaptionML=[ENU=Subcontracting Amount;
                                                              SVE=Underentreprenadsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 260 ;   ;Plant Amount        ;Decimal       ;CaptionML=[ENU=Plant Amount;
                                                              SVE=Maskin belopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 261 ;   ;Buy Back Amount     ;Decimal       ;CaptionML=[ENU=Buy Back Amount;
                                                              SVE=èterkîpsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Amount              ;Decimal       ;CaptionML=[ENU=Amount;
                                                              SVE=Summa];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Project No.         ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Project No.;
                                                              SVE=Projektnr.] }
    { 290 ;   ;Element             ;Code20        ;TableRelation="Base Element";
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              SVE=Element] }
    { 520 ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=BEGIN
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  ClearFields(1); //Plant
                                                                  Estimate.GET("Estimate No.");
                                                                  ValidateItem(ItemTypeOpt::Item, Estimate, TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              SVE=Artikelnr] }
    { 530 ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  Estimate.GET("Estimate No.");
                                                                  ValidateItem(ItemTypeOpt::"Basic Item", Estimate, TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              SVE=Basartikel] }
    { 531 ;   ;Item Type           ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Type" WHERE (Product Code=FIELD(Basic Item),
                                                                                                      Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Type;
                                                              SVE=Artikeltyp];
                                                   Editable=No }
    { 532 ;   ;Item Brand          ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Brand" WHERE (Product Code=FIELD(Basic Item),
                                                                                                       Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Brand;
                                                              SVE=Artikelns varumÑrke];
                                                   Editable=No }
    { 533 ;   ;Item Series         ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Series" WHERE (Product Code=FIELD(Basic Item),
                                                                                                        Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Series;
                                                              SVE=Artikelserier];
                                                   Editable=No }
    { 540 ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
                                                                  Estimate.GET("Estimate No.");
                                                                  ValidateItem(ItemTypeOpt::"Trade Item", Estimate, TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              SVE=Anskaffningsartikel] }
    { 560 ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF lvExecValidate THEN BEGIN
                                                                    Estimate.GET("Estimate No.");
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item", Estimate, TRUE)
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor", Estimate, TRUE);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              SVE=Leverantîr (Skaffningsartikel)] }
    { 570 ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              SVE=Tillverkare] }
    { 580 ;   ;Gross Price         ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNetPrice;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 588 ;   ;Purchase Discount % ;Decimal       ;OnValidate=BEGIN
                                                                //DP01676
                                                                CalculateNetPrice;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Purchase Discount %;
                                                              SVE=Inkîpsrabattprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 589 ;   ;Sales Discount %    ;Decimal       ;CaptionML=[ENU=Sales Discount %;
                                                              SVE=FîrsÑljningsrabattprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 600 ;   ;Price Reference Date;Date          ;CaptionML=[ENU=Price Reference Date;
                                                              SVE=PrissÑttningsdatum];
                                                   Editable=No }
    { 610 ;   ;Part Quantity       ;Decimal       ;OnValidate=VAR
                                                                DummyFieldNo@1100529000 : Integer;
                                                              BEGIN
                                                                IF IsEstimateLineForPercentage(DummyFieldNo) THEN BEGIN  //C026965
                                                                  "Ignore Paragraph Quantity" := TRUE;
                                                                  "Part Quantity" := 1;
                                                                END;
                                                                UpdateCumulativeQty;
                                                              END;

                                                   CaptionML=[ENU=Part Quantity;
                                                              SVE=Delantal];
                                                   Editable=No }
    { 620 ;   ;Cumulative Hours    ;Decimal       ;CaptionML=[ENU=Cumulative Hours;
                                                              SVE=Ackumulerade timmar];
                                                   Editable=No }
    { 630 ;   ;Cumulative Labor    ;Decimal       ;CaptionML=[ENU=Cumulative Labor;
                                                              SVE=Ackumulerad arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 640 ;   ;Cumulative Material ;Decimal       ;CaptionML=[ENU=Cumulative Material;
                                                              SVE=Ackumulerat material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 641 ;   ;Cumulative Gross Price;Decimal     ;CaptionML=ENU=Cumulative Gross Price;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 650 ;   ;Cumulative Subcontracting;Decimal  ;CaptionML=[ENU=Cumulative Subcontracting;
                                                              SVE=Ackumulerad underentreprenad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 660 ;   ;Cumulative Plant    ;Decimal       ;CaptionML=[ENU=Cumulative Plant;
                                                              SVE=Ackumulerad Maskin];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 661 ;   ;Cumulative Buy Back ;Decimal       ;CaptionML=[ENU=Cumulative Buy Back;
                                                              SVE=Ackumulerat Üterkîp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 670 ;   ;Cumulative Total    ;Decimal       ;CaptionML=[ENU=Cumulative Total;
                                                              SVE=Ackumulerat totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 671 ;   ;Cumulative Weight   ;Decimal       ;CaptionML=[ENU=Cumulative Weight;
                                                              SVE=Ackumulerad vikt];
                                                   DecimalPlaces=0:2 }
    { 680 ;   ;Line Status         ;Code10        ;TableRelation="Line Status".Status;
                                                   CaptionML=[ENU=Line Status;
                                                              SVE=Radstatus] }
    { 690 ;   ;External Text Block ;Boolean       ;CaptionML=[ENU=External Text Block;
                                                              SVE=Externt textblock];
                                                   Editable=No }
    { 691 ;   ;Internal Text Block ;Boolean       ;CaptionML=[ENU=Internal Text Block;
                                                              SVE=Internt textblock];
                                                   Editable=No }
    { 700 ;   ;Rate Type           ;Option        ;CaptionML=[ENU=Rate Type;
                                                              SVE=Avgiftstyp];
                                                   OptionCaptionML=ENU=Hours,Minutes;
                                                   OptionString=Hours,Minutes;
                                                   Editable=No }
    { 710 ;   ;Team Size           ;Decimal       ;CaptionML=[ENU=Team Size;
                                                              SVE=Teamstorlek];
                                                   Editable=No }
    { 720 ;   ;Length              ;Decimal       ;OnValidate=BEGIN
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Length;
                                                              SVE=LÑngd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,1' }
    { 730 ;   ;Width               ;Decimal       ;OnValidate=BEGIN
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Width;
                                                              SVE=Bredd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,2' }
    { 735 ;   ;Height              ;Decimal       ;OnValidate=BEGIN
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Height;
                                                              SVE=Hîjd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,3' }
    { 740 ;   ;External Text       ;Text250       ;OnValidate=BEGIN
                                                                "External Text Block" := "External Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=External Text;
                                                              SVE=Extern text] }
    { 741 ;   ;Internal Text       ;Text250       ;OnValidate=BEGIN
                                                                "Internal Text Block" := "Internal Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=Internal Text;
                                                              SVE=Intern text] }
    { 750 ;   ;Volume              ;Decimal       ;CaptionML=[ENU=Volume;
                                                              SVE=Volym];
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 755 ;   ;Weight              ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Weight;
                                                              SVE=Vikt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 756 ;   ;Total Weight        ;Decimal       ;CaptionML=[ENU=Total Weight;
                                                              SVE=Totalvikt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 760 ;   ;Uncoded Labor       ;Boolean       ;CaptionML=[ENU=Uncoded Labor;
                                                              SVE=Okodad arbetskraft];
                                                   Editable=No }
    { 761 ;   ;Uncoded Material    ;Boolean       ;CaptionML=[ENU=Uncoded Material;
                                                              SVE=Okodat material];
                                                   Editable=No }
    { 762 ;   ;Uncoded Subcontracting;Boolean     ;CaptionML=[ENU=Uncoded Subcontracting;
                                                              SVE=Okodad underentreprenad];
                                                   Editable=No }
    { 764 ;   ;Uncoded Plant       ;Boolean       ;CaptionML=[ENU=Uncoded Plant;
                                                              SVE=Okodad Maskin];
                                                   Editable=No }
    { 765 ;   ;Uncoded Line        ;Boolean       ;CaptionML=[ENU=Uncoded Line;
                                                              SVE=Okodad rad];
                                                   Editable=No }
    { 766 ;   ;Uncoded Sundry      ;Boolean       ;CaptionML=ENU=Uncoded Sundry;
                                                   Editable=No }
    { 770 ;   ;Adjustment Factor   ;Decimal       ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor;
                                                              END;

                                                   CaptionML=ENU=Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 775 ;   ;Cum. Adj. Factor    ;Decimal       ;CaptionML=ENU=Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 780 ;   ;Ask for Quote       ;Boolean       ;OnValidate=BEGIN
                                                                IF "Ask for Quote" THEN BEGIN
                                                                  IF (("Net Cost Price" = 0) AND ("Cost Object" = '')) THEN BEGIN  //DP01676
                                                                    "Ask for Quote" := FALSE;
                                                                    IF CurrFieldNo <> 0 THEN
                                                                      FIELDERROR("Ask for Quote", Text002);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Ask for Quote;
                                                              SVE=BegÑr offert] }
    { 790 ;   ;Purchase Route Reference;Code20    ;OnLookup=VAR
                                                              lvRouteRefMgtCU@1210190000 : Codeunit 11012045;
                                                            BEGIN
                                                              lvRouteRefMgtCU.ShowReferenceList("Purchase Route Reference");
                                                            END;

                                                   CaptionML=[ENU=Purchase Route Reference;
                                                              SVE=Referens fîr inkîpsfîljd];
                                                   Editable=No }
    { 800 ;   ;Document No.        ;Code20        ;TableRelation="Document Properties";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Document No.;
                                                              SVE=Dokumentnr] }
    { 810 ;   ;Code                ;Code20        ;OnValidate=VAR
                                                                CodingSystem@1100525000 : Record 11012088;
                                                                EstimateCode@1100528900 : Record 11229772;
                                                                CodeperCodingSystem@1100528901 : Record 11012089;
                                                              BEGIN
                                                                //DP01676
                                                                Estimate.GET("Estimate No.");
                                                                Estimate.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  CodingSystem.GET(Estimate."Coding System");
                                                                  IF CodingSystem."Deviant Code allowed" = FALSE THEN BEGIN
                                                                    FormatMgt.SetSelection(Estimate."Coding System");
                                                                    FormatMgt.FormatElem(Code,4,'');
                                                                    CodeperCodingSystem.GET(Estimate."Coding System", Code);
                                                                  END;
                                                                END;

                                                                EstimateCode.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstimateCode.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                                                                EstimateCode.SETRANGE("Estimate Line", "Line No.");
                                                                EstimateCode.SETRANGE("Coding System", Estimate."Coding System");
                                                                EstimateCode.DELETEALL;

                                                                IF Code <> '' THEN BEGIN
                                                                  EstimateCode.INIT;
                                                                  EstimateCode."Estimate No." := "Estimate No.";
                                                                  EstimateCode."Sub-Estimate No." := '';
                                                                  EstimateCode."Part Group" := '';
                                                                  EstimateCode.Part := '';
                                                                  EstimateCode."Estimate Line" := "Line No.";
                                                                  EstimateCode."Recipe Group" := '';
                                                                  EstimateCode.Recipe := '';
                                                                  EstimateCode."Recipe Line" := 0;
                                                                  EstimateCode."Tender Paragraph No." := "Tender Paragraph No.";
                                                                  EstimateCode."Coding System" := Estimate."Coding System";
                                                                  EstimateCode.Code := Code;
                                                                  EstimateCode.INSERT;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              CodeperCodingSystem@1100528900 : Record 11012089;
                                                            BEGIN
                                                              //DP01676
                                                              Estimate.GET("Estimate No.");
                                                              Estimate.TESTFIELD("Coding System");
                                                              CodeperCodingSystem.SETRANGE("Coding System", Estimate."Coding System");
                                                              CodeperCodingSystem.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeperCodingSystem) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeperCodingSystem.Code);
                                                            END;

                                                   CaptionML=[ENU=Code;
                                                              SVE=Kod];
                                                   Description=DP01676 }
    { 820 ;   ;Price Agreement     ;Boolean       ;CaptionML=[ENU=Price Agreement;
                                                              SVE=Prisavtal] }
    { 821 ;   ;Norm Agreement      ;Boolean       ;CaptionML=[ENU=Norm Agreement;
                                                              SVE=Normavtal] }
    { 830 ;   ;Vendor              ;Code20        ;TableRelation=Vendor;
                                                   CaptionML=[ENU=Vendor;
                                                              SVE=Leverantîr] }
    { 831 ;   ;Vendor Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=[ENU=Vendor Name;
                                                              SVE=Leverantîrsnamn];
                                                   Editable=No }
    { 840 ;   ;Condition           ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=[ENU=Condition;
                                                              SVE=Villkor];
                                                   Editable=No }
    { 850 ;   ;Removal Contribution;Boolean       ;CaptionML=[ENU=Removal Contribution;
                                                              SVE=Borttagningsbidrag] }
    { 860 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   OnValidate=BEGIN
                                                                CalculateTotals;//DP00433
                                                              END;

                                                   CaptionML=[ENU=Cost Component;
                                                              SVE=Kostnadskomponent] }
    { 870 ;   ;Discipline          ;Code10        ;TableRelation=Discipline;
                                                   CaptionML=[ENU=Discipline;
                                                              SVE=Disciplin] }
    { 871 ;   ;Trade Speciality    ;Code10        ;TableRelation="Trade Speciality".Code WHERE (Discipline=FIELD(Discipline));
                                                   CaptionML=[ENU=Trade Speciality;
                                                              SVE=SNI-nummer] }
    { 872 ;   ;Trade Expertise     ;Code10        ;TableRelation="Trade Expertise";
                                                   OnValidate=BEGIN
                                                                TradeExpRec.GetRelatedValue(Discipline, "Trade Speciality", "Trade Expertise");
                                                              END;

                                                   CaptionML=[ENU=Trade Expertise;
                                                              SVE=Branschexpertis] }
    { 888 ;   ;Subcontracting Activity;Code10     ;TableRelation="Subcontracting Activity".Code;
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO("Subcontracting Activity"));  //DP01958a
                                                              END;

                                                   CaptionML=ENU=Subcontracting Activity;
                                                   Description=DP01492-2 }
    { 890 ;   ;Subcontractor       ;Code20        ;TableRelation=IF (Subcontracting Activity=FILTER(='')) Vendor.No. WHERE (Subcontractor Type=FILTER(Subcontractor|Self Employed|Employment Agency))
                                                                 ELSE IF (Subcontracting Activity=FILTER(<>'')) "Subcontracting Activity Price"."Subcontractor No." WHERE (Subcontracting Activity=FIELD(Subcontracting Activity));
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO(Subcontractor));  //DP01958a
                                                              END;

                                                   CaptionML=[ENU=Subcontractor;
                                                              SVE=Underentreprenîr];
                                                   Description=DP01492-2 }
    { 891 ;   ;Subcontractor Name  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=[ENU=Subcontractor Name;
                                                              SVE=Underentreprenîrens namn];
                                                   Editable=No }
    { 892 ;   ;Scheme Code         ;Code15        ;CaptionML=[ENU=Scheme Code;
                                                              SVE=Plankod] }
    { 893 ;   ;Comments            ;Text50        ;CaptionML=[ENU=Comment;
                                                              SVE=Kommentar] }
    { 894 ;   ;Supply              ;Boolean       ;CaptionML=[ENU=Supply;
                                                              SVE=FîrrÜd] }
    { 895 ;   ;Comments for Logistics;Text50      ;CaptionML=[ENU=Comments for Logistics;
                                                              SVE=Kommentarer fîr logistik] }
    { 896 ;   ;Material Sheet      ;Option        ;CaptionML=[ENU=Material Sheet;
                                                              SVE=Materialark];
                                                   OptionCaptionML=[ENU=Customer and Assemly,Customer Only,Assembly only,Do not report;
                                                                    SVE=Kund och montering,Endast kund,Endast montering,Rapportera inte];
                                                   OptionString=Customer and Assemly,Customer Only,Assembly only,Do not report }
    { 897 ;   ;E-Plan Item         ;Code50        ;TableRelation="E-Plan Item".No.;
                                                   CaptionML=[ENU=E-Plan Item;
                                                              SVE=E-Plan-artikel];
                                                   Editable=No }
    { 920 ;   ;Plant Type          ;Code20        ;TableRelation="Plant Type";
                                                   OnValidate=BEGIN
                                                                IF ("Plant Type" <> xRec."Plant Type") AND ("Plant Type" <> '') THEN BEGIN
                                                                  ClearFields(0); //Material
                                                                  GetDefaultsPlantType;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Plant Type;
                                                              SVE=Maskintyp] }
    { 921 ;   ;Plant Price Type    ;Option        ;CaptionML=[ENU=Plant Price Type;
                                                              SVE=Maskin pristyp];
                                                   OptionCaptionML=[ENU=" ,Day,Week,,Month,,,,,Hour";
                                                                    SVE=" ,Dag,Vecka,,MÜnad,,,,,Timme"];
                                                   OptionString=[ ,Day,Week,,Month,,,,,Hour];
                                                   Editable=No }
    { 922 ;   ;Start Rental Period ;Date          ;OnValidate=BEGIN
                                                                xRec."Plant Type" := '';
                                                                VALIDATE("Plant Type");
                                                                CalcRentalUnits;
                                                                EstimateMgmt.ModifyLinkedEstLinesRAW(3,Rec,FIELDNO("Start Rental Period")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=Start Rental Period;
                                                              SVE=Starta uthyrningsperiod] }
    { 923 ;   ;End Rental Period   ;Date          ;OnValidate=BEGIN
                                                                CalcRentalUnits;
                                                                EstimateMgmt.ModifyLinkedEstLinesRAW(3,Rec,FIELDNO("End Rental Period")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=End Rental Period;
                                                              SVE=Slut pÜ uthyrningsperiod] }
    { 924 ;   ;Rental Period Formula;DateFormula  ;OnValidate=BEGIN
                                                                IF FORMAT("Rental Period Formula") <> '' THEN BEGIN
                                                                  TESTFIELD("Plant Price Type");
                                                                  VALIDATE("Time Quantity",EstimateMgmt.ConvPlantCalcPeriod("Rental Period Formula","Plant Price Type"));
                                                                END ELSE BEGIN
                                                                  IF "Rental Time Units" <> 0 THEN
                                                                    VALIDATE("Time Quantity","Rental Time Units")
                                                                  ELSE
                                                                    VALIDATE("Time Quantity",1);
                                                                END;
                                                                EstimateMgmt.ModifyLinkedEstLinesRAW(3,Rec,FIELDNO("Rental Period Formula")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=Rental Period Formula;
                                                              SVE=Formel fîr uthyrningsperiod] }
    { 925 ;   ;Rental Time Units   ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Rental Period Formula");
                                                                EstimateMgmt.ModifyLinkedEstLinesRAW(3,Rec,FIELDNO("Rental Time Units")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=Rental Time Units;
                                                              SVE=Uthyrningstidsenhet];
                                                   BlankZero=Yes }
    { 930 ;   ;Admicode            ;Code10        ;TableRelation="Admi Code";
                                                   OnValidate=VAR
                                                                lvAdmiCodeRec@1100485000 : Record 11012390;
                                                              BEGIN
                                                                IF Admicode <> '' THEN BEGIN
                                                                  lvAdmiCodeRec.GET(Admicode);
                                                                  IF Description = '' THEN
                                                                    Description := lvAdmiCodeRec.Description;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Admi Code;
                                                              SVE=Admi-kod] }
    { 940 ;   ;Purchase Action     ;Code10        ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action;
                                                              SVE=InkîpsÜtgÑrd] }
    { 950 ;   ;Purchase Action Filter;Code10      ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Purchase Action Filter;
                                                              SVE=InkîpsÜtgÑrdsfilter] }
    { 960 ;   ;Purchase Phase      ;Code10        ;CaptionML=[ENU=Purchase Phase;
                                                              SVE=Inkîpsfas];
                                                   Numeric=Yes }
    { 970 ;   ;Purchase Action Status;Option      ;CaptionML=[ENU=Purchase Action Status;
                                                              SVE=InkîpsÜtgÑrdsstatus, material];
                                                   OptionCaptionML=[ENU=Concept,Applied,Approved,Definitive;
                                                                    SVE=Koncept,TillÑmpat,GodkÑnt,Definitiv];
                                                   OptionString=Concept,Applied,Approved,Definitive;
                                                   Editable=No }
    { 980 ;   ;Purch. Action Appr. Date;Date      ;CaptionML=[ENU=Purch. Action Approval Date;
                                                              SVE=Inkîp GodkÑnnandedatum fîr ÜtgÑrd, material];
                                                   Editable=No }
    { 990 ;   ;Advised             ;Boolean       ;CaptionML=[ENU=Advised;
                                                              SVE=Fîreslaget material] }
    { 1120;   ;Ignore Paragraph Quantity;Boolean  ;OnValidate=VAR
                                                                DummyFieldNo@1100529000 : Integer;
                                                              BEGIN
                                                                IF CurrFieldNo = FIELDNO("Ignore Paragraph Quantity") THEN BEGIN
                                                                  CheckIgnoreRecipeQuantity;  //db, 11-10-19
                                                                  UpdateRecipeFields;  //DP01676
                                                                END;
                                                                IF IsEstimateLineForPercentage(DummyFieldNo) THEN BEGIN  //C026965
                                                                  "Ignore Paragraph Quantity" := TRUE;
                                                                  "Part Quantity" := 1;
                                                                END ELSE BEGIN
                                                                  CheckParagraphQuantityForEuroEntry;  //C039386
                                                                END;
                                                                VALIDATE(Quantity);
                                                                UpdateCumulativeQty;
                                                              END;

                                                   CaptionML=ENU=Ignore Tender Paragraph Quantity }
    { 1130;   ;Ignore Recipe Quantity;Boolean     ;OnValidate=BEGIN
                                                                //C053781
                                                                IF CurrFieldNo = FIELDNO("Ignore Recipe Quantity") THEN BEGIN
                                                                  TESTFIELD("Recipe No.");
                                                                  VALIDATE("Ignore Paragraph Quantity", "Ignore Recipe Quantity");
                                                                END;
                                                                UpdateCumulativeQty;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Ignore Recipe Quantity;
                                                              SVE=Ignorera mallantal];
                                                   Description=C053781 }
    { 1140;   ;Service Order No.   ;Code20        ;TableRelation="Service Order".No. WHERE (No.=FIELD(Service Order No.));
                                                   CaptionML=[ENU=Service Order No.;
                                                              SVE=Serviceordernr] }
    { 1250;   ;Wage Component      ;Code10        ;TableRelation="Wage Component";
                                                   OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Wage Component;
                                                              SVE=Lîneart];
                                                   Description=DP01676 }
    { 1300;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Labor;
                                                              SVE=TillÑggsavgiftsprocent, arbetskraft];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1301;   ;Surcharge % Material;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Material;
                                                              SVE=TillÑggsavgiftsprocent, material];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1302;   ;Surcharge % Subcontracting;Decimal ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Subcontracting;
                                                              SVE=TillÑggsavgiftsprocent, underentreprenad];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1303;   ;Surcharge % Plant   ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Plant;
                                                              SVE=TillÑggsavgiftsprocent, Maskin];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1400;   ;Surcharge Amount Labor;Decimal     ;CaptionML=[ENU=Surcharge Amount Labor;
                                                              SVE=TillÑggsbelopp, arbetskraft];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1401;   ;Surcharge Amount Material;Decimal  ;CaptionML=[ENU=Surcharge Amount Material;
                                                              SVE=TillÑggsbelopp, material];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1402;   ;Surcharge Amount Subcontr.;Decimal ;CaptionML=[ENU=Surcharge Amount Subcontr.;
                                                              SVE=TillÑggsbelopp, underentreprenîr];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1403;   ;Surcharge Amount Plant;Decimal     ;CaptionML=[ENU=Surcharge Amount Plant;
                                                              SVE=TillÑggsbelopp, Maskin];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1410;   ;Total Surcharge Amount;Decimal     ;CaptionML=[ENU=Total Surcharge Amount;
                                                              SVE=TillÑggsbelopp totalt];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1500;   ;Plant Rates in Hours;Boolean       ;OnValidate=BEGIN
                                                                //C053751.sn
                                                                IF "Cost Type" = "Cost Type"::Plant THEN BEGIN
                                                                  IF NOT "Plant Rates in Hours" THEN BEGIN
                                                                    Quantity := Hours;
                                                                    UpdateCumulativeQty;
                                                                    InitNormRelatedFields(0);
                                                                  END ELSE BEGIN
                                                                    InitNormRelatedFields(1);
                                                                  END;
                                                                END;
                                                                //C053751.en
                                                                DeterminePlantPrice;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Plant Rates in Hours;
                                                              SVE=Maskinavgifter i timmar];
                                                   Description=DP01492-5 }
    { 1510;   ;Subcontracting in Hours;Boolean    ;OnValidate=BEGIN
                                                                //C053751.sn
                                                                IF "Cost Type" = "Cost Type"::Subcontracting THEN BEGIN
                                                                  IF NOT "Subcontracting in Hours" THEN BEGIN
                                                                    Quantity := Hours;
                                                                    UpdateCumulativeQty;
                                                                    InitNormRelatedFields(0);
                                                                  END ELSE BEGIN
                                                                    InitNormRelatedFields(1);
                                                                  END;
                                                                END;
                                                                //C053751.en
                                                                CalculateTotals;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Subcontracting in Hours;
                                                   Description=C053751 }
    { 2000;   ;Cost Object         ;Code20        ;TableRelation=IF (Cost Type=CONST(" ")) "Dimension Value".Code WHERE (Cost Type=FILTER(<>Revenue),
                                                                                                                         Global Dimension No.=CONST(2))
                                                                                                                         ELSE IF (Cost Type=CONST(Labor)) "Dimension Value".Code WHERE (Cost Type=FILTER(Labor),
                                                                                                                                                                                        Global Dimension No.=CONST(2))
                                                                                                                                                                                        ELSE IF (Cost Type=CONST(Material)) "Dimension Value".Code WHERE (Cost Type=FILTER(Material),
                                                                                                                                                                                                                                                          Global Dimension No.=CONST(2))
                                                                                                                                                                                                                                                          ELSE IF (Cost Type=CONST(Plant)) "Dimension Value".Code WHERE (Cost Type=FILTER(Plant),
                                                                                                                                                                                                                                                                                                                         Global Dimension No.=CONST(2))
                                                                                                                                                                                                                                                                                                                         ELSE IF (Cost Type=CONST(Sundry)) "Dimension Value".Code WHERE (Cost Type=FILTER(Sundry),
                                                                                                                                                                                                                                                                                                                                                                                         Global Dimension No.=CONST(2))
                                                                                                                                                                                                                                                                                                                                                                                         ELSE IF (Cost Type=CONST(Subcontracting)) "Dimension Value".Code WHERE (Cost Type=FILTER(Subcontracting),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Global Dimension No.=CONST(2));
                                                   OnValidate=BEGIN
                                                                //DP01676
                                                                IF "Cost Object" = '' THEN BEGIN
                                                                  VALIDATE("Cost Type", "Cost Type"::" ");
                                                                END ELSE BEGIN
                                                                  IF "Recipe Type" = "Recipe Type"::"Recipe Header" THEN
                                                                    TESTFIELD("Cost Object", '');
                                                                  DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE, '');
                                                                  DimValRec.TESTFIELD(Blocked, FALSE);
                                                                  "Cost Type" := DimValRec."Cost Type" + 1;
                                                                  IF "Cost Type" <> xRec."Cost Type" THEN
                                                                    GetDefaultCalcHours;
                                                                END;
                                                                UpdateSurchargePct;
                                                                //
                                                                IF CurrFieldNo = FIELDNO("Cost Object") THEN BEGIN
                                                                  EstSetup.GET;
                                                                  IF EstSetup."Default Purchase Action" THEN BEGIN
                                                                    IF "Cost Object" <> '' THEN
                                                                      IF xRec."Cost Object" = '' THEN
                                                                        GetDefaultsCostObject("Cost Type", "Cost Object" )
                                                                      ELSE
                                                                        IF "Cost Object" <> xRec."Cost Object" THEN
                                                                          IF "Item No." + "Basic Item" + "Trade Item" = '' THEN
                                                                            IF CONFIRM(Text008 + Text009) THEN
                                                                              GetDefaultsCostObject("Cost Type", "Cost Object" );
                                                                  END;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              SVE=Kostnadsobjekt];
                                                   Description=DP01676;
                                                   CaptionClass='1,1,2' }
    { 2005;   ;Cost Type           ;Option        ;OnValidate=BEGIN
                                                                //DP01676
                                                                IF "Cost Type" <> xRec."Cost Type" THEN BEGIN
                                                                  SwitchApplianceAllowed;  //C052698
                                                                  TESTFIELD("Appliance Type","Appliance Type"::" ");
                                                                  TESTFIELD("Appliance Code",'');
                                                                END;
                                                                GetDefaultCalcHours;
                                                              END;

                                                   CaptionML=[ENU=Cost Type;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=" ,Labor,Material,Subcontracting,Plant,Sundry";
                                                                    SVE=" ,Arbetskraft,Material,Underentreprenad,Maskin,Diverse"];
                                                   OptionString=[ ,Labor,Material,Subcontracting,Plant,Sundry];
                                                   Description=DP01676 }
    { 2010;   ;Net Cost Price      ;Decimal       ;OnValidate=BEGIN
                                                                //DP01676
                                                                CalculateDiscount;
                                                                EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",0,"Net Cost Price","Buy Back Price","Buy Back %");
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Net Cost Price;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   AutoFormatType=2 }
    { 2030;   ;Apply Obligation    ;Boolean       ;OnValidate=BEGIN
                                                                //DP01676
                                                                IF CurrFieldNo = FIELDNO("Apply Obligation") THEN
                                                                  UpdateRecipeFields;
                                                                OnValidateApplyObligation;
                                                              END;

                                                   CaptionML=ENU=Apply Obligation;
                                                   Description=DP01676 }
    { 11012434;;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Project Planning Activity Code;
                                                              SVE=Projektplan, aktivitetskod] }
    { 11012520;;Recipe Type        ;Option        ;CaptionML=ENU=Recipe Type;
                                                   OptionCaptionML=[ENU=" ,Recipe Header,Recipe Line";
                                                                    SVE=" ,Mallrubrik,Mallrad"];
                                                   OptionString=[ ,Recipe Header,Recipe Line] }
    { 11012521;;Attached to Recipe Line;Integer   ;TableRelation="Estimate Line RAW"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                       Tender Paragraph No.=FIELD(Tender Paragraph No.));
                                                   CaptionML=[ENU=Attached to Recipe Line;
                                                              SVE=Bifogad till mallrad];
                                                   Editable=No }
    { 11012530;;Excel Line         ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Excel Line;
                                                   Description=DP01561 }
    { 11125522;;Adjustment Line    ;Boolean       ;CaptionML=ENU=Adjustment Line }
    { 11125666;;Summary Line       ;Boolean       ;CaptionML=[ENU=Summary Line;
                                                              SVE=Summeringrad] }
    { 11125668;;Sundry Amount      ;Decimal       ;CaptionML=[ENU=Sundry Amount;
                                                              SVE=Diverse, belopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 11125670;;Cumulative Sundry  ;Decimal       ;CaptionML=[ENU=Cumulative Sundry;
                                                              SVE=Ackumulerad diverse];
                                                   AutoFormatType=1 }
    { 11125671;;VAT Prod. Posting Group;Code20    ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=VAR
                                                                VATPostingSetup@1100525000 : Record 325;
                                                              BEGIN
                                                                Estimate.GET("Estimate No.");

                                                                CASE "VAT Prod. Posting Group" OF
                                                                  Estimate."VAT Prod. Posting Group (L)": "VAT Type" := "VAT Type"::Low;
                                                                  Estimate."VAT Prod. Posting Group (Z)": "VAT Type" := "VAT Type"::Zero;
                                                                ELSE
                                                                  "VAT Type" := "VAT Type"::High;
                                                                END;

                                                                "VAT %" := 0;

                                                                IF "VAT Prod. Posting Group" <> '' THEN BEGIN
                                                                  Estimate.TESTFIELD("VAT Bus. Posting Group");
                                                                  VATPostingSetup.GET(Estimate."VAT Bus. Posting Group", "VAT Prod. Posting Group");
                                                                  "VAT %" := VATPostingSetup."VAT %";
                                                                  "VAT Calculation Type" := VATPostingSetup."VAT Calculation Type";
                                                                  IF NOT EstimateVATSpec.GET("Estimate No.", "Tender Paragraph No.", "VAT Prod. Posting Group") THEN BEGIN
                                                                     EstimateVATSpec.INIT;
                                                                     EstimateVATSpec."Estimate No." := "Estimate No.";
                                                                     EstimateVATSpec."Tender Paragraph No." := "Tender Paragraph No.";
                                                                     EstimateVATSpec."VAT Prod. Posting Group" := "VAT Prod. Posting Group";
                                                                     EstimateVATSpec.INSERT;
                                                                  END;
                                                                END;

                                                                "VAT Base Amount" := "Cumulative Total" + "Total Surcharge Amount";
                                                                "VAT Amount" := "VAT Base Amount" * ("VAT %" / 100);
                                                                "VAT Amount" := ROUND("VAT Amount");
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              SVE=Moms produktbokfîringsmall] }
    { 11125672;;VAT Type           ;Option        ;CaptionML=[ENU=VAT Type;
                                                              SVE=Momstyp];
                                                   OptionCaptionML=[ENU=High,Low,Zero;
                                                                    SVE=Hîg,LÜg,Noll];
                                                   OptionString=High,Low,Zero;
                                                   Editable=No }
    { 11125673;;VAT %              ;Decimal       ;CaptionML=[ENU=VAT %;
                                                              SVE=Momssats %];
                                                   Editable=No }
    { 11125674;;VAT Amount         ;Decimal       ;CaptionML=[ENU=VAT Amount;
                                                              SVE=Momsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 11125675;;Cumulative Quantity;Decimal       ;CaptionML=[ENU=Cumulative Quantity;
                                                              SVE=Ackumulerat antal];
                                                   DecimalPlaces=0:2;
                                                   Editable=No }
    { 11125682;;VAT Base Amount    ;Decimal       ;CaptionML=[ENU=VAT Base Amount;
                                                              SVE=Nettobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 11125683;;VAT Calculation Type;Option       ;CaptionML=[ENU=VAT Calculation Type;
                                                              SVE=MomsberÑkningstyp];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    SVE=Normal moms,OmvÑnd EG-moms,Enbart moms,OmsÑttningsskatt];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax }
  }
  KEYS
  {
    {    ;Estimate No.,Tender Paragraph No.,Line No.;
                                                   SumIndexFields=Hours,Labor Amount,Material Amount,Gross Amount,Subcontracting Amount,Plant Amount,Amount,Cumulative Hours,Cumulative Labor,Cumulative Material,Cumulative Gross Price,Cumulative Subcontracting,Cumulative Plant,Cumulative Total,Volume,Total Surcharge Amount,Cumulative Sundry;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Estimate No.,Recipe Group,Recipe No.    ;SumIndexFields=Surcharge Amount Labor,Surcharge Amount Material,Surcharge Amount Subcontr.,Surcharge Amount Plant }
    {    ;Purchase Route Reference,Ask for Quote   }
    {    ;Estimate No.,Purchase Action             }
    {    ;Estimate No.,Plant Type                 ;KeyGroups=PLTEST }
    {    ;Estimate No.,Tender Paragraph No.,Source }
    {    ;Estimate No.,Tender Paragraph No.,VAT Prod. Posting Group;
                                                   SumIndexFields=VAT Amount,VAT Base Amount }
    {    ;Estimate No.,Tender Paragraph No.,VAT Type;
                                                   SumIndexFields=Cumulative Total }
    {    ;Estimate No.,VAT Type,VAT Calculation Type;
                                                   SumIndexFields=VAT Amount,VAT Base Amount }
    {    ;Estimate No.,Summary Line                }
    {    ;Estimate No.,Appliance Type,Appliance Code }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      EstSetup@1100485004 : Record 11012150;
      Estimate@11012000 : Record 11012151;
      RateRec@11012007 : Record 11012160;
      TradeItemRec@1210190018 : Record 11012317;
      BasicItemRec@1210190005 : Record 11012316;
      ItemRec@1210190003 : Record 27;
      DimValRec@1210190001 : Record 349;
      ElemRec@1210190020 : Record 11012060;
      ProjElemRec@1210190019 : Record 11012010;
      TradeExpRec@1100485002 : Record 11020286;
      EstimateVATSpec@1100525010 : Record 11125678;
      DimMgt@1210190002 : Codeunit 408;
      FormatMgt@11012008 : Codeunit 11012022;
      UpdateEst@1210190007 : Codeunit 11125671;
      ValidateCu@1210190008 : Codeunit 11012033;
      SearchRateCu@1100525001 : Codeunit 11012567;
      EstimateMgmt@1100525002 : Codeunit 11012232;
      ItemTypeOpt@11012010 : 'Item,Basic Item,Trade Item,Trade Vendor';
      Text002@1210190010 : TextConst 'ENU=only allowed for material, subcontracting or plant (fill one of the prices or cost objects);SVE=endast tillÜtet fîr material, underentreprenad eller Maskin (fyll i ett av priserna eller kostnadsobjekten)';
      CostType@1100485005 : 'Labor,Material,Subcontracting,Plant,Sundry';
      Text008@1100485009 : TextConst 'ENU=Copy Purchase action from new Cost Object?\\';
      Text009@1100485008 : TextConst 'ENU=Only empty fields will be filled. Existing data will not be changed.;SVE=Endast tomma fÑlt kommer att fyllas i. Befintliga data kommer inte att Ñndras.';
      TotalWeight@1100525005 : Decimal;
      TotalBuyBack@1100525006 : Decimal;
      Text020@1100525000 : TextConst 'ENU=Warning: you are creating %1 records for an %2 of %3 "%4", but %1 records already exist for the/an %2 of %3 "%5".';
      SkipUpdateLogBook@1100525004 : Boolean;
      MessageAlreadyShown@1100525007 : Boolean;
      ShowMessageOnce@1100525008 : Boolean;
      Text021@1100525009 : TextConst 'ENU=Warning: you are creating %1 records for an %2 of %3 "%4", but one or more %2 records exist of %3 "%5".';
      Text022@1100529000 : TextConst 'ENU=%1 is filled, estimate lines not allowed for %2 ''%3''';
      Text023@1100525011 : TextConst 'ENU=% should be activated for %2 with %3 EUR';
      ExplodeRcp@1100525012 : Boolean;
      CalledByObligation@1100528901 : Boolean;
      Text024@1100525003 : TextConst 'ENU=Change Appliance Type not allowed due to attached lines';
      Text025@1100528900 : TextConst 'ENU=%1 already present for Appliance Code %2';

    PROCEDURE CalculateTotals@1();
    VAR
      PartQty@1100525000 : Decimal;
      WageComponent@1100528900 : Record 11012014;
      OverTimeFactorCost@1100528902 : Decimal;
      OverTimeFactorSales@1100528901 : Decimal;
    BEGIN
      InitLineTotals;
      IF "Cost Type" = "Cost Type"::" " THEN EXIT;  //C060821

      IF "Cum. Adj. Factor" = 0 THEN
        "Cum. Adj. Factor" := 1;  //DP01676

      IF "Apply Obligation" THEN BEGIN
        //DP01676.sn
        IF "Production Rate" = 0 THEN
          Hours := 0
        ELSE
          Hours := "Time Quantity" * Quantity;
        //DP01676.en
      END ELSE BEGIN
        IF "Production Rate" < 1 THEN
          Hours := "Time Quantity" * Quantity * Norm
        ELSE
          Hours := "Time Quantity" * Quantity / "Production Rate";
      END;
      Hours := Hours * "Cum. Adj. Factor";  //DP01676
      IF "Rate Type" = "Rate Type"::Minutes THEN
        Hours := Hours * "Team Size" / 60;

      //DP01676.sn
      IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
        "Labor Amount" := Hours * Rate;
        IF "Wage Component" <> '' THEN BEGIN
          WageComponent.GetOverTimeFactors("Wage Component",OverTimeFactorCost, OverTimeFactorSales);
          IF OverTimeFactorCost <> 0 THEN
            "Labor Amount" := "Labor Amount" * OverTimeFactorCost;
          //IF OverTimeFactorSales <> 0 THEN
          //  "Labor Sales Amount" := "Labor Sales Amount" * OverTimeFactorSales;
        END;
      END;
      "Gross Amount" := "Time Quantity" * Quantity * "Gross Price" * "Cum. Adj. Factor";
      IF "Cost Type" = "Cost Type"::Material THEN
        "Material Amount" := "Time Quantity" * Quantity * "Net Cost Price" * "Cum. Adj. Factor";
      IF "Cost Type" = "Cost Type"::Subcontracting THEN BEGIN
        IF Norm = 0 THEN BEGIN
          "Subcontracting Amount" := "Time Quantity" * Quantity * "Net Cost Price" * "Cum. Adj. Factor";
        END ELSE BEGIN
          "Subcontracting Amount" := Hours * "Net Cost Price";
          "Gross Amount" := Hours * "Gross Price";
        END;
      END;
      IF "Cost Type" = "Cost Type"::Plant THEN BEGIN
        IF Norm = 0 THEN BEGIN
          "Plant Amount" := "Time Quantity" * Quantity * "Net Cost Price" * "Cum. Adj. Factor";
        END ELSE BEGIN
          "Plant Amount" := Hours * "Net Cost Price";
          "Gross Amount" := Hours * "Gross Price";
        END;
      END;
      IF "Cost Type" = "Cost Type"::Sundry THEN
        "Sundry Amount" := "Time Quantity" * Quantity * "Net Cost Price" * "Cum. Adj. Factor";
      //DP01676.en

      "Labor Amount" := ROUND("Labor Amount");
      "Material Amount" := ROUND("Material Amount");
      "Gross Amount" := ROUND("Gross Amount");
      "Subcontracting Amount" := ROUND("Subcontracting Amount");
      "Plant Amount" := ROUND("Plant Amount");
      Amount := "Labor Amount" + "Material Amount" + "Subcontracting Amount" + "Plant Amount" + "Sundry Amount";
      "Total Weight" := ROUND(Quantity * Weight);
      "Buy Back Amount" := ROUND(Quantity * "Buy Back Price");

      CASE "Ignore Paragraph Quantity" OF
        TRUE: PartQty := 1;
        FALSE: PartQty := "Part Quantity";
      END;

      "Cumulative Hours" := Hours * PartQty;  //DP01676
      "Cumulative Gross Price" := "Gross Amount" * PartQty;

      //DP01676.sn
      IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
        "Cumulative Labor" := "Cumulative Hours" * Rate;
        IF OverTimeFactorCost <> 0 THEN
          "Cumulative Labor" := "Cumulative Labor" * OverTimeFactorCost;
      END;
      IF "Cost Type" = "Cost Type"::Material THEN
        "Cumulative Material" := "Cumulative Quantity" * "Net Cost Price";
      IF "Cost Type" = "Cost Type"::Subcontracting THEN BEGIN
        IF ("Subcontracting in Hours") THEN  //C053751
          "Cumulative Subcontracting" := "Cumulative Hours" * "Net Cost Price"
        ELSE
          "Cumulative Subcontracting" := "Cumulative Quantity" * "Net Cost Price";
      END;
      IF "Cost Type" = "Cost Type"::Plant THEN BEGIN
        IF ("Plant Rates in Hours") THEN  //C053751
          "Cumulative Plant" := "Cumulative Hours" * "Net Cost Price"
        ELSE
          "Cumulative Plant" := "Cumulative Quantity" * "Net Cost Price";
      END;
      IF "Cost Type" = "Cost Type"::Sundry THEN
        "Cumulative Sundry" := "Cumulative Quantity" * "Net Cost Price";
      //DP01676.en

      "Cumulative Total" :=
        "Cumulative Labor" + "Cumulative Material" + "Cumulative Subcontracting" + "Cumulative Plant" + "Cumulative Sundry";

      "Cumulative Weight" := "Total Weight" * PartQty;
      "Cumulative Buy Back" := "Buy Back Amount" * PartQty;

      "Surcharge Amount Labor" := "Cumulative Labor" * ("Surcharge % Labor" / 100);
      "Surcharge Amount Material" := "Cumulative Material" * ("Surcharge % Material" / 100);
      "Surcharge Amount Subcontr." := "Cumulative Subcontracting" * ("Surcharge % Subcontracting" / 100);
      "Surcharge Amount Plant" := "Cumulative Plant" * ("Surcharge % Plant" / 100);

      "Total Surcharge Amount" :=
        "Surcharge Amount Labor" +
        "Surcharge Amount Material" +
        "Surcharge Amount Subcontr." +
        "Surcharge Amount Plant";

      "VAT Base Amount" := "Cumulative Total" + "Total Surcharge Amount";
      "VAT Amount" := ("VAT Base Amount") * ("VAT %" / 100);
      "VAT Amount" := ROUND("VAT Amount");

      UpdateParagraphTotal;  //DP02340
    END;

    PROCEDURE CalculateNetPrice@13();
    BEGIN
      //DP01676
      VALIDATE("Net Cost Price","Gross Price" - (("Gross Price"/100) * "Purchase Discount %"));
    END;

    PROCEDURE CalculateDiscount@1210190012();
    BEGIN
      //DP01676
      IF "Gross Price" <> 0 THEN BEGIN
        IF  ("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Purchase Discount %" = 0) THEN BEGIN
          "Gross Price" := "Net Cost Price";
        END ELSE BEGIN
          "Purchase Discount %" := (("Gross Price" - "Net Cost Price") / "Gross Price") * 100;
        END;
      END ELSE BEGIN
        IF "Purchase Discount %" = 0 THEN
          "Gross Price" := "Net Cost Price";
        IF "Purchase Discount %" <> 100 THEN BEGIN
          IF NOT (("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Purchase Discount %" = 0)) THEN BEGIN
            "Gross Price" := "Net Cost Price" / ((100 - "Purchase Discount %") / 100);
          END;
        END ELSE BEGIN
          "Gross Price" := "Net Cost Price";
        END;
      END;
    END;

    PROCEDURE CalculateGrossPrice@1100485000();
    BEGIN
      //DP01676
      IF "Purchase Discount %" <> 100 THEN
        "Gross Price" := "Net Cost Price" * 100 / (100 - "Purchase Discount %");
    END;

    PROCEDURE CalculateQuantity@11012000();
    VAR
      lv1@1210190000 : Decimal;
      lv2@1210190001 : Decimal;
      lv3@1210190002 : Decimal;
    BEGIN
      lv1 := Length;
      lv2 := Width;
      lv3 := Height;

      IF Length = 0 THEN lv1 := 1;
      IF Width = 0 THEN lv2 := 1;
      IF Height = 0 THEN lv3 := 1;

      VALIDATE(Quantity, lv1 * lv2 * lv3);
    END;

    PROCEDURE DetermineNormGroup@10();
    BEGIN
      IF "Norm Group" = '' THEN
        IF Estimate.GET("Estimate No.") THEN
          "Norm Group" := Estimate."Norm Group";
    END;

    PROCEDURE DetermineNorm@7();
    VAR
      NormRec@11012000 : Record 11012163;
    BEGIN
      IF NormRec.GET("Sub Operation Code","Norm Group") THEN BEGIN
        VALIDATE(Norm, NormRec.Norm);
        ConvertNorm(FALSE, FALSE);
      END ELSE BEGIN
        IF ("Norm Group" <> '') AND ("Sub Operation Code" <> '') THEN BEGIN
          VALIDATE(Norm, 0);
        END;
      END;
      CalculateTotals;
    END;

    PROCEDURE ConvertNorm@1210190002(SwitchType@1210190001 : Boolean;SwitchSize@1210190002 : Boolean);
    VAR
      NormGrpRec@1210190000 : Record 11012164;
    BEGIN
      IF (SwitchType = FALSE) AND (SwitchSize = FALSE) THEN BEGIN
        IF NormGrpRec.GET("Norm Group") THEN BEGIN
          IF NormGrpRec."Rate Type" <> "Rate Type" THEN
            SwitchType := TRUE;
          IF NormGrpRec."Team Size" <> "Team Size" THEN BEGIN
            SwitchSize := TRUE;
            xRec."Team Size" := NormGrpRec."Team Size";
          END;
        END;
      END;

      IF SwitchType = TRUE THEN
        IF "Rate Type" = "Rate Type"::Hours THEN
          Norm := Norm / 60
        ELSE
          Norm := Norm * 60;

      IF SwitchSize = TRUE THEN BEGIN
        IF "Team Size" <> 0 THEN
          Norm := Norm / "Team Size";
        IF xRec."Team Size" <> 0 THEN
          Norm := Norm * xRec."Team Size";
      END;

      IF SwitchType OR SwitchSize THEN
        IF Norm <> 0 THEN
          "Production Rate" := 1 / Norm
        ELSE
          "Production Rate" := 0;
    END;

    PROCEDURE ValidateItem@3(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item,Trade Vendor';lvEstRec@1210190000 : Record 11012151;lvSwitchItem@1210190002 : Boolean);
    VAR
      Desc1Txt@1210190001 : Text[50];
      Desc2Txt@1210190003 : Text[50];
      lvItemOper@1100485002 : Code[20];
      lvRefDate@1100485001 : Date;
      lvDiscRef1@1100485004 : Code[20];
      lvDiscRef2@1100485003 : Code[20];
      lvRefPrio@1100525000 : Code[10];
      lvDiscType@1100528000 : 'Purchase,Sales';
    BEGIN
      IF lvSwitchItem = TRUE THEN
        "Price Agreement" := FALSE;

      IF ("Purchase Route Reference" = '') AND ("Price Agreement" = FALSE) THEN BEGIN
        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2, lvEstRec, lvDiscType::Purchase);
        lvRefPrio := ValidateCu.GetRefPrioEstimate(lvEstRec, lvDiscType::Purchase);

        ValidateCu.ValidateItem(
          LTypeArtOpt, "Trade Item", "Item No.", Manufacturer, "Vendor (Trade Item)", "Basic Item",
          "Cost Object", Desc1Txt, "Unit of Measure", "Net Cost Price",  //DP01676
          "Purchase Discount %", "Price Reference Date", "Gross Price", Desc2Txt, "Cost Component",
          lvDiscRef1, lvDiscRef2, lvRefDate, lvRefPrio);

        VALIDATE("Cost Object");  //DP01676
        IF "Cost Object" <> xRec."Cost Object" THEN
          GetDefaultsCostObject(CostType::Material, "Cost Object");

        ClearFields(2); //Buyback
        IF LTypeArtOpt = LTypeArtOpt::Item THEN BEGIN
          ValidateCu.GetSalesBuyBackRates("Item No.", Estimate."Plant Location",lvRefDate,"Net Cost Price","Buy Back Price");  //DP01676
          VALIDATE("Buy Back Price");
          VALIDATE("Net Cost Price");  //DP01676
        END;

        IF Desc2Txt = '' THEN
          Description := Desc1Txt
        ELSE
          Description := COPYSTR((Desc1Txt + '\' + Desc2Txt), 1, MAXSTRLEN(Description));
      END;

      IF lvSwitchItem = TRUE THEN BEGIN
        lvItemOper := '';
        IF ItemRec.GET("Item No.") THEN BEGIN
          VALIDATE("External Text", ItemRec.Text);
          lvItemOper := ItemRec."Sub Operation Code";
        END;
        //IF ("Recipe No." = '') AND ("Rate Code" = '') THEN
        //  VALIDATE("Rate Code", lvEstRec."Rate Code");  //DP01676
        CASE LTypeArtOpt OF
          LTypeArtOpt::Item:
            BEGIN
              IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
              ItemRec.TESTFIELD(Blocked,FALSE);
              Weight := ItemRec.Weight;
              VALIDATE("VAT Prod. Posting Group", ItemRec."VAT Prod. Posting Group");
            END;
          LTypeArtOpt::"Basic Item":
            BEGIN
              IF NOT BasicItemRec.GET(Manufacturer, "Basic Item") THEN BasicItemRec.INIT;
              BasicItemRec.TESTFIELD(Expired,FALSE);
              Weight := BasicItemRec."Net Weight";
              IF BasicItemRec."Sub Operation Code" <> '' THEN
                lvItemOper := BasicItemRec."Sub Operation Code";
            END;
          LTypeArtOpt::"Trade Item",
          LTypeArtOpt::"Trade Vendor":
            BEGIN
              IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN TradeItemRec.INIT;
              TradeItemRec.TESTFIELD(Expired,FALSE);
              Weight := TradeItemRec."Gross Weight";
              IF TradeItemRec."Sub Operation Code" <> '' THEN
                lvItemOper := TradeItemRec."Sub Operation Code";
            END;
        END;
        IF lvItemOper <> '' THEN
          VALIDATE("Sub Operation Code", lvItemOper);
      END;

      CalculateTotals;
    END;

    PROCEDURE HandleLookupItem@1100525003(lvFieldNo@1100525004 : Integer) lvRefresh : Boolean;
    VAR
      BasicItemRec@1100525011 : Record 11012316;
      TradeItemRec@1100525010 : Record 11012317;
      ItemFrm@1100525009 : Page 31;
      BasicItemFrm@1100525008 : Page 11012333;
      TradeItemFrm@1100525007 : Page 11012334;
      lvRefDate@1100525003 : Date;
      lvDiscRef1@1100525002 : Code[20];
      lvDiscRef2@1100525001 : Code[20];
      lvDiscType@1100528000 : 'Purchase,Sales';
      lvTempEstimateLine@1100525005 : TEMPORARY Record 11125698;
      g_ItemCode@1100525014 : Code[20];
      g_Vendor@1100525013 : Code[20];
    BEGIN
      Estimate.GET("Estimate No.");
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2, Estimate, lvDiscType::Purchase);

      IF lvFieldNo = FIELDNO("Item No.") THEN BEGIN
        CLEAR(ItemFrm);
        ItemFrm.LOOKUPMODE(TRUE);
        ItemFrm.DetermineInterface(DATABASE::"Estimate Line RAW",
          "Estimate No.","Tender Paragraph No.",'','',0,'','',"Line No.",'','');

        IF ItemRec.GET("Item No.") THEN
          ItemFrm.SETRECORD(ItemRec);

        IF ItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          ItemFrm.GETRECORD(ItemRec);
          VALIDATE("Item No.", ItemRec."No.");
        END ELSE BEGIN
          lvRefresh := ItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Basic Item") THEN BEGIN
        CLEAR(BasicItemFrm);
        BasicItemFrm.LOOKUPMODE(TRUE);
        BasicItemFrm.SetSelection(DATABASE::"Estimate Line RAW",
          "Estimate No.","Tender Paragraph No.",'','',0,'','',"Line No.",'','');

        BasicItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);
        BasicItemRec.InitLookup(BasicItemRec, "Basic Item", Manufacturer);
        BasicItemFrm.SETRECORD(BasicItemRec);

        IF BasicItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          BasicItemFrm.GETRECORD(BasicItemRec);
          Manufacturer := BasicItemRec.Manufacturer;
          VALIDATE("Basic Item", BasicItemRec."Product Code");
        END ELSE BEGIN
          lvRefresh := BasicItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Trade Item") THEN BEGIN
        IF "Item No." <> '' THEN BEGIN
          lvTempEstimateLine.COPY(Rec);
          lvTempEstimateLine.VALIDATE("Item No.","Item No.");
          g_ItemCode := lvTempEstimateLine."Trade Item";
          g_Vendor := lvTempEstimateLine."Vendor (Trade Item)";
        END ELSE BEGIN
          g_ItemCode := '';
          g_Vendor := '';
        END;

        CLEAR(TradeItemFrm);
        TradeItemFrm.LOOKUPMODE(TRUE);

        TradeItemFrm.SetSelection(DATABASE::"Estimate Line RAW",
          "Estimate No.","Tender Paragraph No.",'','',0,'','',"Line No.",'','',
          "Vendor (Trade Item)","Trade Item",Manufacturer,"Basic Item",g_ItemCode,g_Vendor);

        TradeItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);
        TradeItemRec.InitLookup(TradeItemRec, "Basic Item", Manufacturer, "Trade Item", "Vendor (Trade Item)");
        TradeItemFrm.SETRECORD(TradeItemRec);

        IF TradeItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          TradeItemFrm.GETRECORD(TradeItemRec);
          Manufacturer := TradeItemRec.Manufacturer;
          "Basic Item" := TradeItemRec."Product Code";
          "Vendor (Trade Item)" := TradeItemRec.Vendor;
          VALIDATE("Trade Item", TradeItemRec."Item Code");
        END ELSE BEGIN
          lvRefresh := TradeItemFrm.CheckMultiCopy;
        END;
      END;

      EXIT(lvRefresh);
    END;

    PROCEDURE HandleLookupUnit@1210190011();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";
        VALIDATE("Unit of Measure", lvUnit);
      END;
    END;

    PROCEDURE CheckItemUnitConversion@1210190010(VAR MainNewRec@1210190006 : Record 11125698;MainOldRec@1210190007 : Record 11125698);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
    BEGIN
      WITH MainNewRec DO BEGIN
        UnitFactorOld := 1;
        UnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            Quantity,"Unit of Measure",UnitFactorNew);
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              Quantity,"Unit of Measure",UnitFactorNew);
          END ELSE BEGIN
            IF "Item No." <> '' THEN BEGIN
              ItemRec.GET("Item No.");
              UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, MainOldRec."Unit of Measure");
              UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, "Unit of Measure");
              UnitFactor := UnitFactorOld;
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                Quantity,"Unit of Measure",UnitFactor);
            END;
          END;
        END;
        IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
          IF UnitFactorNew <> UnitFactorOld THEN BEGIN
            VALIDATE("Gross Price", ("Gross Price" * UnitFactorNew / UnitFactorOld));
            VALIDATE(Weight,(Weight * UnitFactorNew / UnitFactorOld));
          END;
        END;
      END;
    END;

    PROCEDURE CheckSameValue@1210190009(lvCostType@1210190001 : Integer;lvCostObjectOld@1210190002 : Code[20]);
    VAR
      lvEstLineRec@1210190000 : Record 11125698;
    BEGIN
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETFILTER("Cost Object", '%1', lvCostObjectOld);  //DP01676
      lvEstLineRec.SETRANGE(Description, Description);
      lvEstLineRec.SETRANGE("Unit of Measure", "Unit of Measure");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Cost Object", "Cost Object");  //DP01676
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckCostObject@1210190005(CostObject@1210190000 : Code[20];DirectValidate@1210190001 : Boolean);
    BEGIN
      Estimate.GET("Estimate No.");

      IF CostObject <> '' THEN BEGIN
        DimMgt.GetDimValueRec(2, CostObject, DimValRec, TRUE,'');
        VALIDATE("Cost Component", DimValRec."Cost Component");
        IF "Appliance Type" = "Appliance Type"::RateCode THEN  //DP01676
          "Unit of Measure" := DimValRec."Unit of Measure";
        IF Estimate."Estimate Based On" <> Estimate."Estimate Based On"::CostObject THEN EXIT;
        IF ("Item No." + "Basic Item" + "Trade Item" <> '') THEN BEGIN
          IF DirectValidate = TRUE THEN BEGIN
            DimValRec.TESTFIELD("Cost Type", DimValRec."Cost Type"::Material);
            EXIT;
          END;
        END;
        IF "Sub Operation Code" <> '' THEN BEGIN
          ProcessSubOperation;
          EXIT;
        END;
        IF "Norm Agreement" OR "Price Agreement" THEN BEGIN  //DP01676
          IF DimValRec."Cost Type" = DimValRec."Cost Type"::Labor THEN BEGIN
            IF DimValRec."Rate Code" = '' THEN
              VALIDATE("Rate Code", Estimate."Rate Code")
            ELSE
              VALIDATE("Rate Code", DimValRec."Rate Code");
          END;
          EXIT;
        END;
        Description := DimValRec.Name;
        Norm := 0;
        "Production Rate" := 0;
        "Gross Price" := 0;
        "Net Cost Price" := 0;  //DP01676
        IF DimValRec."Cost Type" = DimValRec."Cost Type"::Labor THEN BEGIN
          IF DimValRec."Rate Code" = '' THEN
            VALIDATE("Rate Code", Estimate."Rate Code")
          ELSE
            VALIDATE("Rate Code", DimValRec."Rate Code");
          IF "Sub Operation Code" <> '' THEN
            DetermineNorm
          ELSE
            VALIDATE(Norm, DimValRec.Norm);
        END ELSE BEGIN
          VALIDATE("Gross Price", DimValRec.Price);
          VALIDATE("Net Cost Price", DimValRec.Price);  //DP01676
        END;
      END;
    END;

    PROCEDURE OldSubOperationDefault@1210190006() : Boolean;
    VAR
      OldSubOperRec@1210190001 : Record 11012166;
      OldOperRec@1210190000 : Record 11012165;
    BEGIN
      OldOperRec.INIT;
      IF OldSubOperRec.GET(xRec."Sub Operation Code") THEN
        IF NOT OldOperRec.GET(OldSubOperRec.Operation) THEN OldOperRec.INIT;

      EXIT(xRec."Cost Object" = OldOperRec."Cost Object");  //DP01676
    END;

    PROCEDURE ProcessSubOperation@1100485002();
    VAR
      SubOperRec@1100485000 : Record 11012166;
    BEGIN
      IF "Item No." + "Basic Item" + "Trade Item" <> '' THEN EXIT;

      IF SubOperRec.GET("Sub Operation Code") THEN BEGIN
        Description := COPYSTR(SubOperRec.Description, 1, MAXSTRLEN(Description));
        IF SubOperRec."Unit of Measure" <> '' THEN
          "Unit of Measure" := SubOperRec."Unit of Measure";
      END;
    END;

    PROCEDURE EnterQuantity@1210190013(lvOrigin@1210190002 : Integer) : Boolean;
    VAR
      QuanSheetRec@1210190000 : Record 11012186;
      EstModelRec@1100485000 : Record 11012196;
    BEGIN
      //lvOrigin:
      //  1 = Length, Width and Height
      //  2 = quantity (input)
      //  3 = house type
      //  4 = quantity (lookup)

      IF lvOrigin <> 1 THEN BEGIN
        IF Length <> 0 THEN EXIT(FALSE);
        IF Width <> 0 THEN EXIT(FALSE);
        IF Height <> 0 THEN EXIT(FALSE);
      END;

      IF lvOrigin <> 4 THEN BEGIN
        QuanSheetRec.SETRANGE("Estimate No.", "Estimate No.");
        IF QuanSheetRec.FINDFIRST THEN EXIT(FALSE);  //not implemented for RAW
      END;

      IF lvOrigin <> 3 THEN BEGIN
        EstModelRec.SETRANGE("Estimate No.", "Estimate No.");
        IF EstModelRec.FINDFIRST THEN EXIT(FALSE);  //not implemented for RAW
      END ELSE BEGIN
        EstModelRec.SETRANGE("Estimate No.", "Estimate No.");
        IF NOT EstModelRec.FINDFIRST THEN EXIT(FALSE);
      END;

      EXIT(TRUE);
    END;

    PROCEDURE InitAdjustmentFactor@1210190003();
    BEGIN
      IF "Adjustment Factor" = 0 THEN
        "Adjustment Factor" := 1;
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190004();
    BEGIN
      IF "Adjustment Factor" = 0 THEN
        "Adjustment Factor" := 1;
      MODIFY;
    END;

    PROCEDURE GetItemSpecifications@1100485006();
    BEGIN
      IF ItemRec.GET("Item No.") THEN BEGIN
        "Item Series" := ItemRec."Item Series";
        "Item Type" := ItemRec."Item Type";
        "Item Brand" := ItemRec."Item Brand";
      END;
    END;

    PROCEDURE GetDefaultsPlantType@1100485010();
    VAR
      PlantTypeRec@1100485000 : Record 11012551;
      EstRec@1100529400 : Record 11012151;
    BEGIN
      IF NOT EstRec.GET("Estimate No.") THEN EstRec.INIT;
      IF EstRec."Plant Company" <> '' THEN
        PlantTypeRec.CHANGECOMPANY(EstRec."Plant Company");  //DP01208
      PlantTypeRec.GET("Plant Type");
      Description := PlantTypeRec.Description;
      "Unit of Measure" := PlantTypeRec."Unit of Measure";
      PlantTypeRec.TESTFIELD("Cost Object");
      VALIDATE("Cost Object", PlantTypeRec."Cost Object");  //DP01676
      Weight := PlantTypeRec.Weight;
      CLEAR("Price Agreement");  //DP01676
      DeterminePlantPrice;
    END;

    PROCEDURE DeterminePlantPrice@1100485011();
    VAR
      EstRec@1100525007 : Record 11012151;
      SearchRateCu@1100485000 : Codeunit 11012567;
      RefDate@1100485001 : Date;
      RentalType@1100525006 : Option;
      DummyPlantPriceType@1100525005 : Option;
      DummyRentalType@1100525004 : Option;
      PlantDiscount@1100525003 : Decimal;
      PlantPrice@1100525002 : Decimal;
      BuyBackPrice@1100525001 : Decimal;
      PlantTypeRec@1100525000 : Record 11012551;
    BEGIN
      IF ("Plant Type" = '') OR "Price Agreement" THEN  //DP01676
        EXIT;
      //C036770.sn
      ClearFields(2); //Buyback
      ClearFields(3); //Discount
      //C036770.en
      IF NOT EstRec.GET("Estimate No.") THEN EstRec.INIT;

      IF "Start Rental Period" <> 0D THEN
        RefDate := "Start Rental Period"
      ELSE BEGIN
        IF Estimate."Reference Date (Rate)" <> 0D THEN
          RefDate := EstRec."Reference Date (Rate)"
        ELSE
          RefDate := TODAY;
      END;

      //DP01047.sn
      //- calculatiesoort staat altijd op kostprijs; methodiek in raw-calculatie gebaseerd op CostPlus;
      //- verkoopkorting wordt dus nooit bepaald; ook in SearchRateCu is dit alleen uitgewerkt voor verhuur
      RentalType := -1;  //0=rental, 1=sales, 2=buy-back, 3= hours
      IF EstRec."Plant Company" <> '' THEN
        PlantTypeRec.CHANGECOMPANY(EstRec."Plant Company");  //DP01208
      PlantTypeRec.GET("Plant Type");
      IF "Plant Rates in Hours" THEN BEGIN  //DP01492
        //DP01676.sn
        "Rate Code" := '';
        InitRateRelatedFields;
        //DP01676.en
        IF (PlantTypeRec."Rental Type" <> PlantTypeRec."Rental Type"::"Sales/Buy Back") THEN
          RentalType := 3;
      END;

      PlantPrice := SearchRateCu.CostRateFromEstimate("Plant Type",'', EstRec."Plant Location",RefDate,EstRec."Plant Company",RentalType,"Plant Price Type");
      VALIDATE("Net Cost Price", PlantPrice);  //DP01676
      VALIDATE("Gross Price", "Net Cost Price");
      //PlantPrice := SearchRateCu.SalesRateFromEstimate(
      //  "Plant Type",'',EstRec."Plant Location",EstRec."Customer No.",EstRec."Kind of Plant Rate"+1,RefDate,EstRec."Plant Company",RentalType,"Plant Price Type");
      IF RentalType = 1 THEN BEGIN
        DummyRentalType := 2;
        BuyBackPrice := SearchRateCu.SalesRateFromEstimate("Plant Type",'',EstRec."Plant Location",EstRec."Customer No.",0,RefDate,EstRec."Plant Company",DummyRentalType,DummyPlantPriceType);
      END;
      PlantDiscount := SearchRateCu.SalesDiscountFromEstimate(
        "Plant Type",'',EstRec."Plant Location",EstRec."Customer No.",EstRec."Customer Disc. Group",RefDate,EstRec."Plant Company",RentalType);
      VALIDATE("Buy Back Price", BuyBackPrice * (100-PlantDiscount)/100);
      VALIDATE("Net Cost Price", PlantPrice * (100-PlantDiscount)/100);  //DP01492-1: discount should be evaluated with missing Sales Price on Estimate Line
      //DP01047.en
    END;

    PROCEDURE GetDefaultsCostObject@1100485012(CostType@1100485000 : 'Labor,Material,Subcontracting,Plant,Sundry';CostObject@1100485001 : Code[20]);
    VAR
      DimensionValue@1100485002 : Record 349;
      EstimatePurchaseAction@1100485003 : Record 11012366;
    BEGIN
      //DP01676: function derived from BudgetLine; skip message on validate
      EstSetup.GET;
      IF NOT EstSetup."Default Purchase Action" THEN
        EXIT;

      DimMgt.GetDimValueRec(2, CostObject, DimensionValue, TRUE, '');
      DimensionValue.TESTFIELD(Blocked, FALSE);

      IF (CostType = CostType::Material) OR (CostType = CostType::Subcontracting) OR (CostType = CostType::Plant) THEN BEGIN
        IF NOT EstimatePurchaseAction.GET("Estimate No.", DimensionValue."Purchase Action") THEN EXIT;
        IF EstimatePurchaseAction.Status >= EstimatePurchaseAction.Status::Applied THEN EXIT;
        IF ("Purchase Action" = '') AND (DimensionValue."Purchase Action" <> '') THEN
          VALIDATE("Purchase Action", DimensionValue."Purchase Action");
      END;
    END;

    PROCEDURE GetReferenceData@1100525002(VAR lvRefDate@1100525003 : Date;VAR lvDiscRef1@1100525002 : Code[20];VAR lvDiscRef2@1100525001 : Code[20];lvEstRec@1100525000 : Record 11012151;lvDiscType@1100525004 : 'Purchase,Sales');
    BEGIN
      lvRefDate := ValidateCu.GetRefDateEstimate(lvEstRec);
      ValidateCu.GetRefDiscEstimate(lvEstRec, lvDiscRef1, lvDiscRef2, lvDiscType);
    END;

    PROCEDURE CalcRentalUnits@1100525007();
    VAR
      PlantLocation@1100525000 : Record 11012554;
      RateTypeUsed@1100525002 : Option;
      CalcRentalPeriodsCu@1100525001 : Codeunit 11012568;
    BEGIN
      //DP01208.sn
      Estimate.GET("Estimate No.");
      IF Estimate."Plant Location" <> '' THEN BEGIN
        IF Estimate."Plant Company" <> '' THEN
          PlantLocation.CHANGECOMPANY(Estimate."Plant Company");
        PlantLocation.GET(Estimate."Plant Location");
      END ELSE BEGIN
        PlantLocation.INIT;
        PlantLocation.InitRecord;
      END;
      //DP01208.en

      VALIDATE("Rental Time Units",
        CalcRentalPeriodsCu.NumberRentalPeriods(
          PlantLocation,"Start Rental Period","End Rental Period","Plant Type",'',RateTypeUsed));

      TESTFIELD("Plant Price Type",RateTypeUsed + 1);
    END;

    PROCEDURE ClearFields@1100525004(FieldGroup@1100525000 : 'Material,Plant,BuyBack,Discount');
    BEGIN
      CASE FieldGroup OF
        FieldGroup::Material:
          BEGIN
            CLEAR("Net Cost Price");  //DP01676
            CLEAR("Item No.");
            CLEAR("Cost Object");  //DP01676
            CLEAR("Cost Type");  //DP01676
            CLEAR("Basic Item");
            CLEAR("Vendor (Trade Item)");
            CLEAR("Trade Item");
          END;
        FieldGroup::Plant:
          BEGIN
            CLEAR("Net Cost Price");  //DP01676
            CLEAR("Plant Type");
            CLEAR("Plant Price Type");
            CLEAR("Cost Object");  //DP01676
            CLEAR("Cost Type");  //DP01676
          END;
        FieldGroup::BuyBack:
          BEGIN
            CLEAR("Buy Back Price");
            CLEAR("Buy Back %");
          END;
        FieldGroup::Discount:
          BEGIN
            CLEAR("Gross Price");
            CLEAR("Purchase Discount %");  //DP01676
          END;
      END;
    END;

    PROCEDURE GetTotalWeight@1100525009() : Decimal;
    BEGIN
      EXIT(TotalWeight);
    END;

    PROCEDURE GetTotalBuyBack@1100525010() : Decimal;
    BEGIN
      EXIT(TotalBuyBack);
    END;

    PROCEDURE CalcNonIndexedTotals@1100525011();
    BEGIN
      CLEAR(TotalWeight);
      CLEAR(TotalBuyBack);

      IF FINDSET THEN
        REPEAT
          TotalWeight := TotalWeight + "Cumulative Weight";
          TotalBuyBack := TotalBuyBack + "Cumulative Buy Back";
        UNTIL NEXT = 0;
    END;

    PROCEDURE UpdateCumulativeQty@1100525006();
    BEGIN
      CASE "Ignore Paragraph Quantity" OF
        TRUE: "Cumulative Quantity" := Quantity * "Time Quantity";
        FALSE: "Cumulative Quantity" := "Part Quantity" * Quantity * "Time Quantity";
      END;

      CalculateTotals;
    END;

    PROCEDURE SetSkipUpdateLogBook@1100525015(SkipUpdateLogBook2@1100525000 : Boolean);
    BEGIN
      SkipUpdateLogBook := SkipUpdateLogBook2;
    END;

    PROCEDURE SetShowMessageOnce@1100525013(ShowMessageOnce2@1100525000 : Boolean);
    BEGIN
      ShowMessageOnce := ShowMessageOnce2;
    END;

    PROCEDURE AddLineFromStandardRecipe@1210190000(iEstimate@1210190006 : Code[20];iElement@1210190007 : Code[20];iRecipeGroup@1210190003 : Code[20];iRecipe@1210190004 : Code[20];iAttachedToLine@1210190010 : Integer;iRecipeType@1210190009 : Integer;iQuantity@1210190008 : Decimal;iSource@1210190011 : Integer;VAR NextLineNo@1100525001 : Integer);
    VAR
      Recipe@1210190000 : Record 11020581;
      RecipeLine@1210190001 : Record 11020582;
      EstimateLineRAW@1210190002 : Record 11125698;
      EstimateLineRAW2@1100528902 : Record 11125698;
      CommentLineRAW@1100525000 : Record 11125684;
      SaveCostObject@1100528900 : Code[20];
      ResultObligation@1100528901 : Decimal;
      NumLines@1100528903 : Integer;
      Gap@1100528904 : Integer;
    BEGIN
      SetShowMessageOnce(TRUE);

      IF NextLineNo = 0 THEN BEGIN  //DP01619: explode child-recipe
        EstimateLineRAW.SETRANGE("Estimate No.", iEstimate);
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", iElement);
        IF NOT EstimateLineRAW.FINDLAST THEN;
        NextLineNo := EstimateLineRAW."Line No.";
      END;

      Recipe.GET(iRecipeGroup, iRecipe);
      Recipe.TESTFIELD(Blocked, FALSE);

      RecipeLine.RESET;
      RecipeLine.SETRANGE("Recipe Group", iRecipeGroup);
      RecipeLine.SETRANGE(Recipe, iRecipe);

      IF RecipeLine.FINDSET THEN BEGIN
        //C052698.sn
        NumLines := RecipeLine.COUNT;
        Gap := ROUND((10000/NumLines), 1);
        //C052698.en
        REPEAT
          NextLineNo := NextLineNo + Gap;  //C052698: reduce gap for switch to other recipe

          EstimateLineRAW.INIT;
          EstimateLineRAW."Estimate No." := iEstimate;
          EstimateLineRAW.VALIDATE("Tender Paragraph No.", iElement);
          EstimateLineRAW."Line No." := NextLineNo;
          EstimateLineRAW.INSERT(TRUE);

          EstimateLineRAW.Source := iSource;
          EstimateLineRAW."Recipe Type" := iRecipeType;
          EstimateLineRAW."Recipe Group" := iRecipeGroup;
          EstimateLineRAW."Recipe No." := iRecipe;
          EstimateLineRAW."Attached to Recipe Line" := iAttachedToLine;

          //DP01676.sn
          IF RecipeLine."Recipe (Child)" <> '' THEN BEGIN
            RecipeLine.Norm := 0;
            RecipeLine."Production Rate" := 0;
            RecipeLine."Rate Code" := '';
            RecipeLine."Gross Price" := 0;
            RecipeLine."Purchase Discount %" := 0;
            RecipeLine."Net Cost Price" := 0;
          END ELSE BEGIN
            IF RecipeLine."Cost Object Labor" <> '' THEN BEGIN
              RecipeLine.TESTFIELD("Cost Object Price", '');
              EstimateLineRAW.VALIDATE("Cost Object", RecipeLine."Cost Object Labor");
            END;
            IF RecipeLine."Cost Object Price" <> '' THEN BEGIN
              RecipeLine.TESTFIELD("Cost Object Labor", '');
              EstimateLineRAW.VALIDATE("Cost Object", RecipeLine."Cost Object Price");
            END;
            IF (RecipeLine.Quantity <> 0) THEN
              EstimateLineRAW.TESTFIELD("Cost Object");
            IF RecipeLine."Cost Type (Hours)" = RecipeLine."Cost Type (Hours)"::Labor THEN BEGIN
              IF (RecipeLine.Norm <> 0) OR (RecipeLine."Sub Operation Code" <> '') THEN BEGIN
                RecipeLine.TESTFIELD("Gross Price", 0);
                RecipeLine.TESTFIELD("Net Cost Price", 0);
              END;
              IF (RecipeLine."Gross Price" <> 0) OR (RecipeLine."Net Cost Price" <> 0) THEN BEGIN
                RecipeLine.TESTFIELD(Norm, 0);
                RecipeLine.TESTFIELD("Production Rate", 0);
              END;
            END;
          END;
          //
          EstimateLineRAW2.GET(iEstimate, iElement, iAttachedToLine);
          EstimateLineRAW."Ignore Paragraph Quantity" := EstimateLineRAW2."Ignore Paragraph Quantity";
          EstimateLineRAW."Apply Obligation" := EstimateLineRAW2."Apply Obligation";
          //DP01676.en

          EstimateLineRAW."Ignore Recipe Quantity" := RecipeLine."Ignore Recipe Quantity";  //C053781
          EstimateLineRAW."Project No." := RecipeLine."Project No.";
          IF RecipeLine.Element <> '' THEN  //default set by InitRecord
            EstimateLineRAW.Element := RecipeLine.Element;
          EstimateLineRAW."Project Planning Activity Code" := RecipeLine."Project Planning Activity Code";

          EstimateLineRAW.Quantity := RecipeLine.Quantity;
          EstimateLineRAW."Time Quantity" := RecipeLine."Time Quantity";
          EstimateLineRAW.VALIDATE("Part Quantity", iQuantity);
          EstimateLineRAW.CheckIgnoreRecipeQuantity;  //db, 11-10-19
          EstimateLineRAW."Unit of Time" := RecipeLine."Unit of Time";
          EstimateLineRAW."Line Status" := RecipeLine."Line Status";
          EstimateLineRAW."Unit of Measure" := RecipeLine."Unit of Measure";
          EstimateLineRAW."Norm Group" := RecipeLine."Norm Group";
          EstimateLineRAW."Sub Operation Code" := RecipeLine."Sub Operation Code";
          EstimateLineRAW.Norm := RecipeLine.Norm;
          EstimateLineRAW."Production Rate" := RecipeLine."Production Rate";
          //DP01676.sn
          IF EstimateLineRAW."Apply Obligation" THEN BEGIN
            IF (RecipeLine."Cost Type (Price)" = RecipeLine."Cost Type (Price)"::Material) OR
               (RecipeLine."Cost Type (Price)" = RecipeLine."Cost Type (Price)"::Sundry) OR
              ((RecipeLine."Cost Type (Price)" = RecipeLine."Cost Type (Price)"::Subcontracting) AND (RecipeLine."Subcontracting in Hours" = FALSE)) OR
              ((RecipeLine."Cost Type (Price)" = RecipeLine."Cost Type (Price)"::Plant) AND (RecipeLine."Plant Rates in Hours" = FALSE)) THEN BEGIN  //C056955
              EstimateLineRAW.UpdateCumulativeQty;  //db, 11-10-19
            END ELSE BEGIN
              IF EstimateLineRAW."Production Rate" = 0 THEN BEGIN  //C056955
                ResultObligation := ReadObligation;
                IF (EstimateLineRAW.Quantity <> 0) AND (ResultObligation <> 0) THEN BEGIN  //db, 11-10-19: calculate production rate
                  EstimateLineRAW.Norm := 1;
                  EstimateLineRAW."Production Rate" := ResultObligation / EstimateLineRAW.Quantity;
                  EstimateLineRAW.VALIDATE(Quantity, RecipeLine.Quantity);
                END ELSE BEGIN
                  EstimateLineRAW.UpdateCumulativeQty;  //db, 13-09-19: curious combination in recipe: production rate empty and quantity filled with indication that hours should be derived from norm
                END;
              END ELSE BEGIN
                EvaluateResultObligation(EstimateLineRAW.Quantity, EstimateLineRAW."Production Rate",FIELDNO("Production Rate"),ResultObligation);
                EstimateLineRAW.Norm := 1;
                EstimateLineRAW.VALIDATE(Quantity, ResultObligation);
              END;
            END;
          END ELSE BEGIN
            EstimateLineRAW.UpdateCumulativeQty;  //db, 11-10-19
          END;
          //DP01676.en
          IF RecipeLine."Rate Code" <> '' THEN BEGIN
            SaveCostObject := EstimateLineRAW."Cost Object";
            EstimateLineRAW.VALIDATE("Rate Code", RecipeLine."Rate Code");
            EstimateLineRAW."Cost Object" := SaveCostObject;
          END;
          EstimateLineRAW."Gross Price" := RecipeLine."Gross Price";
          EstimateLineRAW."Purchase Discount %" := RecipeLine."Purchase Discount %";
          EstimateLineRAW."Net Cost Price" := RecipeLine."Net Cost Price";
          EstimateLineRAW."Price Reference Date" := RecipeLine."Price Reference Date";
          EstimateLineRAW."Cost Component" := RecipeLine."Cost Component";
          EstimateLineRAW."Item No." := RecipeLine."Item No.";
          EstimateLineRAW."Basic Item" := RecipeLine."Basic Item";
          EstimateLineRAW."Trade Item" := RecipeLine."Trade Item";
          EstimateLineRAW."Vendor (Trade Item)" := RecipeLine."Vendor (Trade Item)";
          EstimateLineRAW.Manufacturer := RecipeLine.Manufacturer;
          EstimateLineRAW.Length := RecipeLine.Length;
          EstimateLineRAW.Width := RecipeLine.Width;
          EstimateLineRAW.Height := RecipeLine.Height;
          EstimateLineRAW."External Text" := RecipeLine."External Text";
          EstimateLineRAW."External Text Block" := RecipeLine."External Text Block";
          EstimateLineRAW."Internal Text" := RecipeLine."Internal Text";
          EstimateLineRAW."Internal Text Block" := RecipeLine."Internal Text Block";
          EstimateLineRAW."Purchase Route Reference" := RecipeLine."Purchase Route Reference";
          EstimateLineRAW."Document No." := RecipeLine."Document No.";
          EstimateLineRAW."Price Agreement" := RecipeLine."Price Agreement";
          EstimateLineRAW."Norm Agreement" := RecipeLine."Norm Agreement";
          EstimateLineRAW.Vendor := RecipeLine.Vendor;
          EstimateLineRAW.Subcontractor := RecipeLine.Subcontractor;
          EstimateLineRAW."Subcontracting Activity" := RecipeLine."Subcontracting Activity";  //C053751
          EstimateLineRAW."Subcontracting in Hours" := RecipeLine."Subcontracting in Hours";  //C053751
          EstimateLineRAW."Plant Type" := RecipeLine."Plant Type";
          EstimateLineRAW."Plant Rates in Hours" := RecipeLine."Plant Rates in Hours";
          EstimateLineRAW."Set Code" := RecipeLine."Set Code";
          EstimateLineRAW."Set Level" := RecipeLine."Set Level";
          IF RecipeLine."VAT Prod. Posting Group" <> '' THEN
            EstimateLineRAW.VALIDATE("VAT Prod. Posting Group", RecipeLine."VAT Prod. Posting Group");
          EstimateLineRAW.Description := RecipeLine.Description;  //disturbed by validate (rate code)

          EstimateLineRAW.FillApplianceTypeFromRecipeActivity;  //db, 04-02-20
          EstimateLineRAW.CalculateTotals;
          EstimateLineRAW.MODIFY;
          CommentLineRAW.CopyCommentRecipeToEstLine(RecipeLine."Recipe Group", RecipeLine.Recipe, RecipeLine."Line No.", EstimateLineRAW);  //DP01086

          IF RecipeLine."Recipe (Child)" <> '' THEN  //DP01619: explode child-recipe
            AddLineFromStandardRecipe(iEstimate, iElement,
              RecipeLine."Recipe Group (Child)", RecipeLine."Recipe (Child)",
              iAttachedToLine, iRecipeType, iQuantity, iSource, NextLineNo);
        UNTIL RecipeLine.NEXT = 0;
      END;
    END;

    PROCEDURE CheckRecipeTotals@1210190001();
    VAR
      EstimateLineRAW@1210190000 : Record 11125698;
      OldQuan@1210190001 : Decimal;
      NewQuan@1210190002 : Decimal;
      ResultObligation@1100528900 : Decimal;
    BEGIN
      //DP01676
      IF NOT(
        ("Appliance Type" = "Appliance Type"::Recipe) OR
        ("Appliance Type" = "Appliance Type"::EstimateRecipe)) THEN EXIT;

      IF xRec.Quantity = 0 THEN
        OldQuan := 1
      ELSE
        OldQuan := xRec.Quantity;
      IF Quantity = 0 THEN
        NewQuan := 1
      ELSE
        NewQuan := Quantity;

      ResultObligation := ReadObligation;

      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF EstimateLineRAW."Apply Obligation" THEN BEGIN
            IF (EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Material) OR (EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Sundry) THEN BEGIN
              IF ResultObligation <> 0 THEN
                EstimateLineRAW."Cumulative Quantity" := EstimateLineRAW.Quantity * EstimateLineRAW."Time Quantity" * ResultObligation
              ELSE
                EstimateLineRAW.UpdateCumulativeQty;
            END ELSE BEGIN
              IF EstimateLineRAW."Production Rate" <> 0 THEN
                EstimateLineRAW.VALIDATE(Quantity, Quantity / EstimateLineRAW."Production Rate");
            END;
          END ELSE BEGIN
            EstimateLineRAW.VALIDATE(Quantity, (EstimateLineRAW.Quantity * NewQuan / OldQuan));
          END;
          EstimateLineRAW.CalculateTotals;
          EstimateLineRAW.MODIFY(TRUE);
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    PROCEDURE InitRecord@1100525016();
    VAR
      EstimateParagraphRAW@1100525000 : Record 11125679;
      EstimateRAWUnitMapping@1100528900 : Record 11125675;
    BEGIN
      //C041773
      IF Estimate.GET("Estimate No.") THEN BEGIN
        IF "Cost Type" = "Cost Type"::Plant THEN  //DP01676
          "Plant Rates in Hours" := Estimate."Plant Rates in Hours";
        IF "Cost Type" = "Cost Type"::Subcontracting THEN  //C053751
          "Subcontracting in Hours" := Estimate."Subcontracting in Hours";
      END;

      IF IgnoreParagraphQuantityForEuroEntry THEN //C055334
        "Ignore Paragraph Quantity" := TRUE;

      EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
      EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
      IF EstimateParagraphRAW.FINDFIRST THEN BEGIN
        Element := EstimateParagraphRAW."Base Element";  //C040309
       //DP01676.sn
        IF EstimateRAWUnitMapping.GET(EstimateParagraphRAW."External Unit of Measure Code") THEN
          IF EstimateRAWUnitMapping."Ignore Result Obligation" THEN
            "Ignore Paragraph Quantity" := TRUE;
        //DP01676.en
      END;
    END;

    PROCEDURE InitPurchaseFields@1100529000();
    BEGIN
      "Purchase Route Reference" := '';

      CLEAR("Purchase Action");
      CLEAR("Purchase Phase");
      CLEAR("Purchase Action Status");
      "Purch. Action Appr. Date" := 0D;
      Advised := FALSE;
    END;

    PROCEDURE InitRateRelatedFields@1100525033();
    BEGIN
      //DP01676
      Rate := 0;
      CLEAR("Rate Type");
      "Team Size" := 0;
      "Wage Component" := '';
    END;

    PROCEDURE InitNormRelatedFields@1100525032(iValue@1100528900 : Decimal);
    BEGIN
      //C053751: 0=clear; 1=init (switch plant/norm in hours should be budget neutral)
      Norm := iValue;
      "Production Rate" := iValue;
    END;

    PROCEDURE InitPriceRelatedFields@1100525005();
    BEGIN
      //C052698
      "Gross Price" := 0;
      "Net Cost Price" := 0;
      "Purchase Discount %" := 0;
      "Sales Discount %" := 0;
      "Buy Back Price" := 0;
      "Buy Back %" := 0;
    END;

    LOCAL PROCEDURE InitCostTypeRelatedFields@1100525017();
    BEGIN
      //C052698
      "Cost Type" := "Cost Type"::" ";
      "Cost Object" := '';
    END;

    PROCEDURE UpdateSurchargePct@1100529300();
    VAR
      EstimateRAWSurcharges@1100529300 : Record 11012236;
      Estimate@1100529301 : Record 11012151;
    BEGIN
      //DP00433
      IF NOT Estimate.GET("Estimate No.") THEN EXIT;  //skip error on CopyEstimate

      IF "Cost Type" = "Cost Type"::Labor THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          VALIDATE("Surcharge % Labor",EstimateRAWSurcharges."Surcharge %")
        ELSE
          VALIDATE("Surcharge % Labor", Estimate."Surcharge % Labor");
      END;

      IF "Cost Type" = "Cost Type"::Material THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          VALIDATE("Surcharge % Material", EstimateRAWSurcharges."Surcharge %")
        ELSE
          VALIDATE("Surcharge % Material", Estimate."Surcharge % Material");
      END;

      IF "Cost Type" = "Cost Type"::Subcontracting THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          VALIDATE("Surcharge % Subcontracting", EstimateRAWSurcharges."Surcharge %")
        ELSE
          VALIDATE("Surcharge % Subcontracting", Estimate."Surcharge % Subcontracting");
      END;

      IF "Cost Type" = "Cost Type"::Plant THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          VALIDATE("Surcharge % Plant", EstimateRAWSurcharges."Surcharge %")
        ELSE
          VALIDATE("Surcharge % Plant", Estimate."Surcharge % Plant");
      END;

      //C051075.sn
      IF "Cost Type" <> "Cost Type"::Labor THEN
        VALIDATE("Surcharge % Labor", 0);
      IF "Cost Type" <> "Cost Type"::Material THEN
        VALIDATE("Surcharge % Material", 0);
      IF "Cost Type" <> "Cost Type"::Subcontracting THEN
        VALIDATE("Surcharge % Subcontracting", 0);
      IF "Cost Type" <> "Cost Type"::Plant THEN
        VALIDATE("Surcharge % Plant", 0);
      //C051075.en
    END;

    PROCEDURE InsertSurcharge@1100529301();
    VAR
      Estimate@1100529300 : Record 11012151;
      EstimateRAWSurcharges@1100525000 : Record 11012236;
    BEGIN
      //DP00433
      Estimate.GET("Estimate No.");

      //C051075.sn
      "Surcharge % Labor" := 0;
      "Surcharge % Material" := 0;
      "Surcharge % Subcontracting" := 0;
      "Surcharge % Plant" := 0;
      //C051075.en

      IF "Cost Type" = "Cost Type"::Labor THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          "Surcharge % Labor" := EstimateRAWSurcharges."Surcharge %"
        ELSE
          "Surcharge % Labor" := Estimate."Surcharge % Labor";
      END;

      IF "Cost Type" = "Cost Type"::Material THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          "Surcharge % Material" := EstimateRAWSurcharges."Surcharge %"
        ELSE
          "Surcharge % Material" := Estimate."Surcharge % Material";
      END;

      IF "Cost Type" = "Cost Type"::Subcontracting THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          "Surcharge % Subcontracting" := EstimateRAWSurcharges."Surcharge %"
        ELSE
          "Surcharge % Subcontracting" := Estimate."Surcharge % Subcontracting";
      END;

      IF "Cost Type" = "Cost Type"::Plant THEN BEGIN  //DP01676
        IF EstimateRAWSurcharges.GET("Cost Object","Estimate No.") THEN
          "Surcharge % Plant" := EstimateRAWSurcharges."Surcharge %"
        ELSE
          "Surcharge % Plant" := Estimate."Surcharge % Plant";
      END;
    END;

    PROCEDURE SetFilterZeroLinesByUser@1100525025(VAR EstimateLine@1100525002 : Record 11125698);
    VAR
      UserSetup@1100525000 : Record 91;
    BEGIN
      //C025240
      WITH EstimateLine DO BEGIN
        UserSetup.GET(USERID);
        IF UserSetup."Hide Zero Lines" = FALSE THEN BEGIN
          UserSetup."Hide Zero Lines" := TRUE;
        END ELSE BEGIN
          UserSetup."Hide Zero Lines" := FALSE;
        END;
        UserSetup.MODIFY;
      END;
      GetFilterZeroLinesByUser(EstimateLine);
    END;

    PROCEDURE GetFilterZeroLinesByUser@1100525012(VAR EstimateLine@1100525002 : Record 11125698);
    VAR
      UserSetup@1100525001 : Record 91;
    BEGIN
      //C025240
      WITH EstimateLine DO BEGIN
        UserSetup.GET(USERID);
        IF UserSetup."Hide Zero Lines" = FALSE THEN BEGIN
          SETRANGE(Quantity);
        END ELSE BEGIN
          SETFILTER(Quantity, '<>%1', 0);
        END;
      END;
    END;

    PROCEDURE CheckHideZeroLines@1100525008();
    VAR
      UserSetup@1100525000 : Record 91;
    BEGIN
      //C025240
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("Hide Zero Lines", FALSE);
    END;

    LOCAL PROCEDURE CheckEstLineAllowedForPercElements@1100529001();
    VAR
      FieldNoPercentage@1100529000 : Integer;
    BEGIN
      //C026965
      IF NOT IsEstimateLineForPercentage(FieldNoPercentage) THEN
        EXIT;
      Estimate.GET("Estimate No.");
      CASE FieldNoPercentage OF
        Estimate.FIELDNO("Percentage (GeneralCost)"):
          IF Estimate."Percentage (GeneralCost)" <> 0 THEN
            ERROR(Text022, Estimate.FIELDCAPTION("Percentage (GeneralCost)"), FIELDCAPTION("Tender Paragraph No."), "Tender Paragraph No.");
         Estimate.FIELDNO("Percentage (Profit/Risk)"):
          IF Estimate."Percentage (Profit/Risk)" <> 0 THEN
            ERROR(Text022, Estimate.FIELDCAPTION("Percentage (Profit/Risk)"), FIELDCAPTION("Tender Paragraph No."), "Tender Paragraph No.");
        Estimate.FIELDNO("Percentage (ExecutionCost)"):
          IF Estimate."Percentage (ExecutionCost)" <> 0 THEN
            ERROR(Text022, Estimate.FIELDCAPTION("Percentage (ExecutionCost)"), FIELDCAPTION("Tender Paragraph No."), "Tender Paragraph No.");
        Estimate.FIELDNO("Percentage (Discount)"):
          IF Estimate."Percentage (Discount)" <> 0 THEN
            ERROR(Text022, Estimate.FIELDCAPTION("Percentage (Discount)"), FIELDCAPTION("Tender Paragraph No."), "Tender Paragraph No.");
      END;
    END;

    LOCAL PROCEDURE IsEstimateLineForPercentage@1100529002(VAR FieldNoPercentage@1100529000 : Integer) : Boolean;
    VAR
      EstimateRAWSetup@1100529001 : Record 11125673;
    BEGIN
      //C026965
      FieldNoPercentage := 0;
      IF ("Tender Paragraph No." <> '') AND (NOT "Summary Line") THEN BEGIN
        EstimateRAWSetup.GET;
        CASE "Tender Paragraph No." OF
          EstimateRAWSetup."Paragraph No.(GeneralCost)":
            FieldNoPercentage := Estimate.FIELDNO("Percentage (GeneralCost)");
          EstimateRAWSetup."Paragraph No.(Profit/Risk)":
            FieldNoPercentage := Estimate.FIELDNO("Percentage (Profit/Risk)");
          EstimateRAWSetup."Paragraph No.(ExecutionCost)":
            FieldNoPercentage := Estimate.FIELDNO("Percentage (ExecutionCost)");
          EstimateRAWSetup."Paragraph No.(Discount)":
            FieldNoPercentage := Estimate.FIELDNO("Percentage (Discount)");
        END;
      END;
      EXIT(FieldNoPercentage <> 0);
    END;

    PROCEDURE LookupPlantType@1100529402();
    VAR
      PlantType@1100529400 : Record 11012551;
    BEGIN
      //DP01208
      Estimate.GET("Estimate No.");
      IF Estimate."Plant Company" <> '' THEN
         PlantType.CHANGECOMPANY(Estimate."Plant Company");
      IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN
        VALIDATE("Plant Type", PlantType.Code);
    END;

    PROCEDURE LookupSetCode@1100529403();
    VAR
      PlantSet@1100529400 : Record 11012587;
    BEGIN
      //DP01208
      Estimate.GET("Estimate No.");
      IF Estimate."Plant Company" <> '' THEN
         PlantSet.CHANGECOMPANY(Estimate."Plant Company");
      IF PAGE.RUNMODAL(0, PlantSet) = ACTION::LookupOK THEN
        VALIDATE("Set Code", PlantSet.Code);
    END;

    PROCEDURE ValidateSetCode@1100529404();
    VAR
      PlantSet@1100529400 : Record 11012587;
    BEGIN
      //DP01208
      IF "Set Code" = '' THEN EXIT;
      Estimate.GET("Estimate No.");
      IF Estimate."Plant Company" <> '' THEN
        PlantSet.CHANGECOMPANY(Estimate."Plant Company");
      PlantSet.GET("Set Code");
      Description := PlantSet.Description;
      "Unit of Measure" := PlantSet."Unit of Measure";
    END;

    PROCEDURE GetActivityCode@1100525001() ActivityCode : Code[6];
    VAR
      ElementLine@1100525002 : Record 11125670;
      Estimate@1100525001 : Record 11012151;
    BEGIN
      Estimate.RESET;
      Estimate.GET("Estimate No.");
      IF Estimate."Construction Spec. No." <> '' THEN BEGIN
        ElementLine.RESET;
        ElementLine.SETRANGE("Specification No.",Estimate."Construction Spec. No.");
        ElementLine.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        ElementLine.SETRANGE(Type,ElementLine.Type::"Commitment Description (Sub Line)");
        ElementLine.SETRANGE(Title,FALSE);
      END;
      IF ElementLine.FINDFIRST THEN BEGIN
        ActivityCode:=ElementLine.Activity;
      END;
      EXIT(ActivityCode);
    END;

    LOCAL PROCEDURE GetSubcontractorActivity@1100529900(CalledBy@1100528500 : Integer);
    VAR
      SubcontractingActivityPrice@1100529900 : Record 11229373;
      Estimate@1100525000 : Record 11012151;
    BEGIN
      //DP01492-2
      Estimate.GET("Estimate No.");
      Estimate.TESTFIELD(Fixed, FALSE);  //C041836

      SubcontractingActivityPrice.SETRANGE("Subcontracting Activity", "Subcontracting Activity");
      IF CalledBy = FIELDNO("Subcontracting Activity") THEN  //DP01958a
        SubcontractingActivityPrice.SETRANGE("Preferred Subcontractor", TRUE)
      ELSE
        SubcontractingActivityPrice.SETRANGE("Subcontractor No.", Subcontractor);
      IF SubcontractingActivityPrice.FINDFIRST THEN BEGIN
        VALIDATE("Net Cost Price", SubcontractingActivityPrice.GetPrice(Estimate."Reference Date (Rate)"));  //DP01958a
        IF CalledBy = FIELDNO("Subcontracting Activity") THEN BEGIN  //DP01958a
          SubcontractingActivityPrice.CALCFIELDS("Activity Description");
          Description := SubcontractingActivityPrice."Activity Description";
        END;
        "Unit of Measure" := SubcontractingActivityPrice."Unit of Measure";
        SubcontractingActivityPrice.TESTFIELD("Cost Object");
        VALIDATE("Cost Object", SubcontractingActivityPrice."Cost Object");  //DP01676
        Subcontractor := SubcontractingActivityPrice."Subcontractor No.";
      END ELSE BEGIN
        GetDefaultCalcHours;  //db, 31-12-19
      END;
    END;

    LOCAL PROCEDURE CheckParagraphQuantityForEuroEntry@1100525014();
    VAR
      EstimateParagraphRAW@1100525000 : Record 11125679;
    BEGIN
      //C039386
      EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
      EstimateParagraphRAW.SETRANGE("External Unit of Measure Code", 'EUR');
      IF EstimateParagraphRAW.FINDFIRST THEN
        IF "Ignore Paragraph Quantity" = FALSE THEN
          ERROR(Text023, FIELDCAPTION("Ignore Paragraph Quantity"),
            EstimateParagraphRAW.TABLECAPTION,
            EstimateParagraphRAW.FIELDCAPTION("External Unit of Measure Code"));
    END;

    LOCAL PROCEDURE IgnoreParagraphQuantityForEuroEntry@1100528923() : Boolean;
    VAR
      EstimateParagraphRAW@1100525000 : Record 11125679;
    BEGIN
      //DP01676: function introduced for C039386 (moved from page to table)
      EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
      EstimateParagraphRAW.SETRANGE("External Unit of Measure Code", 'EUR');
      IF EstimateParagraphRAW.FINDFIRST THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE ValidateAppliance@1100528900();
    VAR
      Item@1100528900 : Record 27;
      TradeItem@1100528903 : Record 11012317;
      PlantType@1100528901 : Record 11012551;
      PlantSet@1100528904 : Record 11012587;
      SubcontractingActivity@1100528902 : Record 11229372;
      EstimateApplianceCodeRAW@1100525000 : Record 11125697;
      EstimateRate@1100525002 : Record 11012160;
      EstimateSetupRAW@1100527350 : Record 11125673;
    BEGIN
      //DP01676
      CASE "Appliance Type" OF
        "Appliance Type"::Item:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              "Cost Type" := "Cost Type"::Material;
              Item.GET("Appliance Code");
              VALIDATE("Item No.", "Appliance Code");
            END ELSE BEGIN
              "Item No." := '';
            END;
          END;
        "Appliance Type"::TradeItem:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              "Cost Type" := "Cost Type"::Material;
              TradeItem.GET("Vendor (Trade Item)", "Appliance Code");
              VALIDATE("Trade Item", "Appliance Code");
            END ELSE BEGIN
              "Trade Item" := '';
              "Vendor (Trade Item)" := '';
            END;
          END;
        "Appliance Type"::PlantType:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              "Cost Type" := "Cost Type"::Plant;
              //PlantType.GET("Appliance Code");  //C054634: check switch PlantCompany
              VALIDATE("Plant Type", "Appliance Code");
              IF EstimateSetupRAW.GET THEN BEGIN
                IF EstimateSetupRAW."Default Unit of Measure Plant" <> '' THEN
                  VALIDATE("Unit of Measure", EstimateSetupRAW."Default Unit of Measure Plant");
              END;
            END ELSE BEGIN
              "Plant Type" := '';
              "Plant Rates in Hours" := FALSE;
            END;
          END;
        "Appliance Type"::PlantSet:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              "Cost Type" := "Cost Type"::Plant;
              //PlantSet.GET("Appliance Code");  //C054634: check switch PlantCompany
              VALIDATE("Set Code", "Appliance Code");
            END ELSE BEGIN
              "Set Code" := '';
              "Plant Rates in Hours" := FALSE;
            END;
          END;
        "Appliance Type"::SubcontractingActivity:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              "Cost Type" := "Cost Type"::Subcontracting;
              SubcontractingActivity.GET("Appliance Code");
              Description := SubcontractingActivity.Description;  //db, 20-01-20
              VALIDATE("Subcontracting Activity", "Appliance Code");
              IF EstimateSetupRAW.GET THEN BEGIN
                IF EstimateSetupRAW."Def. Unit of Measure Subcontr." <> '' THEN
                  VALIDATE("Unit of Measure", EstimateSetupRAW."Def. Unit of Measure Subcontr.");
              END;
            END ELSE BEGIN
              "Subcontracting Activity" := '';
              "Subcontracting in Hours" := FALSE;
            END;
          END;
        "Appliance Type"::Recipe:
          BEGIN
            IF "Recipe Group" = '' THEN BEGIN
              Estimate.GET("Estimate No.");
              "Recipe Group":= Estimate."Recipe Group";
            END;
            "Cost Type" := "Cost Type"::" ";  //C052698
            IF "Appliance Code" <> '' THEN BEGIN
              ExplodeRcp := TRUE;
              VALIDATE("Recipe No.", "Appliance Code");
              ExplodeRcp := FALSE;
            END ELSE BEGIN
              "Recipe Group" := '';
              "Recipe No." := '';
            END;
            InsertSurcharge;  //C052698
          END;
       "Appliance Type"::EstimateAppliance:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              EstimateApplianceCodeRAW.SETCURRENTKEY("Estimate No.", "Appliance Code");
              EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
              EstimateApplianceCodeRAW.SETRANGE("Appliance Code", "Appliance Code");
              EstimateApplianceCodeRAW.SETRANGE("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::SingleLine);
              IF EstimateApplianceCodeRAW.FINDFIRST THEN BEGIN
                CopyDetailsApplianceCode;
              END ELSE BEGIN
                CreateApplianceType(0, "Appliance Code", FALSE);
              END;
            END ELSE BEGIN
              "Appliance Type" := "Appliance Type"::" ";
            END;
          END;
        "Appliance Type"::RateCode:
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              "Cost Type" := "Cost Type"::Labor;
              EstimateRate.GET("Estimate No.", "Appliance Code");
              Description := EstimateRate.Description;  //C052698: required for recipe lines
              IF EstimateRate."Cost Object" <> '' THEN
                "Cost Object" := '';  //C052361: force update from DimensionValue in next validate
              VALIDATE("Rate Code", "Appliance Code");
            END ELSE BEGIN
              VALIDATE("Rate Code", '');  //C052698: init norm/rate related fields
            END;
          END;
       "Appliance Type"::EstimateRecipe:
          BEGIN
            "Cost Type" := "Cost Type"::" ";
            IF "Appliance Code" <> '' THEN BEGIN
              EstimateApplianceCodeRAW.SETCURRENTKEY("Estimate No.", "Appliance Code");
              EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
              EstimateApplianceCodeRAW.SETRANGE("Appliance Code", "Appliance Code");
              EstimateApplianceCodeRAW.SETRANGE("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::MultiLine);
              IF EstimateApplianceCodeRAW.FINDFIRST THEN BEGIN
                CopyDetailsApplianceCode;
              END ELSE BEGIN
                CreateApplianceType(1, "Appliance Code", FALSE);
                AddLineToHeader;
              END;
            END;
          END;
       "Appliance Type"::CostObject:  //C060821+C052698
          BEGIN
            IF "Appliance Code" <> '' THEN BEGIN
              VALIDATE("Cost Object", "Appliance Code");
              DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE, '');
              IF "Cost Type" = "Cost Type"::Labor THEN BEGIN
                IF DimValRec."Rate Code" <> '' THEN
                  VALIDATE("Rate Code", DimValRec."Rate Code");
              END ELSE BEGIN
                IF DimValRec.Price <> 0 THEN
                  VALIDATE("Gross Price", DimValRec.Price);
              END;
              Description := DimValRec.Name;
            END ELSE BEGIN
              "Cost Type" :=  "Cost Type"::" ";
              "Cost Object" := '';
            END;
          END;
      END;
    END;

    PROCEDURE LookupAppliance@1100528902();
    VAR
      Item@1100528900 : Record 27;
      TradeItem@1100528903 : Record 11012317;
      PlantType@1100528901 : Record 11012551;
      PlantSet@1100528904 : Record 11012587;
      SubcontractingActivity@1100528902 : Record 11229372;
      BaseRecipe@1100525000 : Record 11020581;
      EstimateApplianceCodeRAW@1100525001 : Record 11125697;
      EstimateRate@1100525002 : Record 11012160;
      DimensionValue@1100528905 : Record 349;
    BEGIN
      //DP01676
      CASE "Appliance Type" OF
        "Appliance Type"::Item:
          BEGIN
            Item."No." := "Appliance Code";
            IF PAGE.RUNMODAL(0, Item) = ACTION::LookupOK THEN
              VALIDATE("Appliance Code", Item."No.");
          END;
        "Appliance Type"::TradeItem:
          BEGIN
            IF "Vendor (Trade Item)" <> '' THEN
              TradeItem.SETRANGE(Vendor, "Vendor (Trade Item)");  //C051377
            TradeItem."Item Code" := "Appliance Code";
            IF PAGE.RUNMODAL(0, TradeItem) = ACTION::LookupOK THEN BEGIN
              "Vendor (Trade Item)" := TradeItem.Vendor;  //C051377
              VALIDATE("Appliance Code", TradeItem."Item Code");
            END;
          END;
        "Appliance Type"::PlantType:
          BEGIN
            Estimate.GET("Estimate No.");
            IF Estimate."Plant Company" <> '' THEN
              PlantType.CHANGECOMPANY(Estimate."Plant Company");
            PlantType.Code := "Appliance Code";
            IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN
              VALIDATE("Appliance Code", PlantType.Code);
          END;
        "Appliance Type"::PlantSet:
          BEGIN
            Estimate.GET("Estimate No.");
            IF Estimate."Plant Company" <> '' THEN
              PlantSet.CHANGECOMPANY(Estimate."Plant Company");
            PlantSet.Code := "Appliance Code";
            IF PAGE.RUNMODAL(0, PlantSet) = ACTION::LookupOK THEN
              VALIDATE("Appliance Code", PlantSet.Code);
          END;
        "Appliance Type"::SubcontractingActivity:
          BEGIN
            SubcontractingActivity.Code := "Appliance Code";
            IF PAGE.RUNMODAL(0, SubcontractingActivity) = ACTION::LookupOK THEN
              VALIDATE("Appliance Code", SubcontractingActivity.Code);
          END;
        "Appliance Type"::Recipe:
          BEGIN
            IF "Recipe Group" = '' THEN BEGIN
              Estimate.GET("Estimate No.");
              "Recipe Group":= Estimate."Recipe Group";
            END;
            BaseRecipe."Recipe Group" := "Recipe Group";
            BaseRecipe."No." := "Appliance Code";
            IF PAGE.RUNMODAL(0, BaseRecipe) = ACTION::LookupOK THEN BEGIN
              "Recipe Group":= BaseRecipe."Recipe Group";
              ExplodeRcp := TRUE;
              VALIDATE("Appliance Code", BaseRecipe."No.");
              ExplodeRcp := FALSE;
            END;
          END;
        "Appliance Type"::EstimateAppliance:
          BEGIN
            EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
            EstimateApplianceCodeRAW.SETRANGE("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::SingleLine);
            EstimateApplianceCodeRAW."Appliance Code" := "Appliance Code";
            IF PAGE.RUNMODAL(0, EstimateApplianceCodeRAW) = ACTION::LookupOK THEN BEGIN
              EstimateApplianceCodeRAW.TESTFIELD("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::SingleLine);
              VALIDATE("Appliance Code", EstimateApplianceCodeRAW."Appliance Code");
            END;
          END;
        "Appliance Type"::RateCode:
          BEGIN
            EstimateRate.SETRANGE("Estimate No.", "Estimate No.");
            EstimateRate."Rate Code" := "Appliance Code";
            IF PAGE.RUNMODAL(PAGE::"Estimate Rate List RAW", EstimateRate) = ACTION::LookupOK THEN
              VALIDATE("Appliance Code", EstimateRate."Rate Code");
          END;
        "Appliance Type"::EstimateRecipe:
          BEGIN
            EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
            EstimateApplianceCodeRAW.SETRANGE("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::MultiLine);
            EstimateApplianceCodeRAW."Appliance Code" := "Appliance Code";
            IF PAGE.RUNMODAL(0, EstimateApplianceCodeRAW) = ACTION::LookupOK THEN BEGIN
              EstimateApplianceCodeRAW.TESTFIELD("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::MultiLine);
              VALIDATE("Appliance Code", EstimateApplianceCodeRAW."Appliance Code");
            END;
          END;
       "Appliance Type"::CostObject:  //C060821
          BEGIN
            DimensionValue.SETRANGE("Global Dimension No.", 2);
            IF "Cost Type" = "Cost Type"::" " THEN
              DimensionValue.SETFILTER("Cost Type", '<>%1', DimensionValue."Cost Type"::Revenue)
            ELSE
              DimensionValue.SETRANGE("Cost Type", "Cost Type"-1);
            DimensionValue.Code := "Appliance Code";
            IF PAGE.RUNMODAL(0, DimensionValue) = ACTION::LookupOK THEN
              VALIDATE("Appliance Code", DimensionValue.Code);
          END;
      END;
    END;

    PROCEDURE SelectBaseRecipe@1100485005();
    VAR
      RecipePag@1100485001 : Page 11125073;
    BEGIN
      //DP01619
      CLEAR(RecipePag);
      RecipePag.SetSelection(DATABASE::"Estimate Line RAW",
        "Estimate No.","Tender Paragraph No.",'','','','','','','',TRUE,"Line No.");
      RecipePag.RUNMODAL;
    END;

    PROCEDURE CheckRelatedApplianceType@1100528901();
    BEGIN
      //DP01676
      CASE "Appliance Type" OF
        "Appliance Type"::Item: "Appliance Code" := "Item No.";
        "Appliance Type"::TradeItem: "Appliance Code" := "Trade Item";
        "Appliance Type"::PlantType: "Appliance Code" := "Plant Type";
        "Appliance Type"::PlantSet: "Appliance Code" := "Set Code";
        "Appliance Type"::SubcontractingActivity: "Appliance Code" := "Subcontracting Activity";
        "Appliance Type"::Recipe: "Appliance Code" := "Recipe No.";
        "Appliance Type"::RateCode: "Appliance Code" := "Rate Code";
        "Appliance Type"::CostObject: "Appliance Code" := "Cost Object";  //C060821
      END;
    END;

    PROCEDURE GetActualCostAmount@1100528903() Result : Decimal;
    VAR
      EstimateLineRAW@1100528900 : Record 11125698;
    BEGIN
      //DP01676
      IF ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN BEGIN
        Result := 0;
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
        IF EstimateLineRAW.FINDSET THEN BEGIN
          REPEAT
            Result := Result +
              EstimateLineRAW."Cumulative Labor" + EstimateLineRAW."Surcharge Amount Labor" +
              EstimateLineRAW."Cumulative Material" + EstimateLineRAW."Surcharge Amount Material" +
              EstimateLineRAW."Cumulative Subcontracting" + EstimateLineRAW."Surcharge Amount Subcontr." +
              EstimateLineRAW."Cumulative Plant" + EstimateLineRAW."Surcharge Amount Plant" +
              EstimateLineRAW."Cumulative Sundry";  //EstimateLineRAW."Surcharge Amount Sundry";
          UNTIL EstimateLineRAW.NEXT = 0;
        END;
        EXIT(Result);
      END;
      //
      Result :=
        "Cumulative Labor" + "Surcharge Amount Labor" +
        "Cumulative Material" + "Surcharge Amount Material" +
        "Cumulative Subcontracting" + "Surcharge Amount Subcontr." +
        "Cumulative Plant" + "Surcharge Amount Plant" +
        "Cumulative Sundry";  // + "Surcharge Amount Sundry";
      EXIT(Result);
    END;

    PROCEDURE GetActualUnitPrice@1100528904() Result : Decimal;
    BEGIN
      //DP01676
      Result := GetActualCostAmount;
      IF "Part Quantity" = 0 THEN
        Result := 0
      ELSE
        Result := Result / "Part Quantity";
      EXIT(Result);
    END;

    PROCEDURE GetCalculatedCostAmount@1100528905() Result : Decimal;
    VAR
      EstimateLineRAW@1100528900 : Record 11125698;
    BEGIN
      //DP01676
      IF ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN BEGIN
        Result := 0;
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
        IF EstimateLineRAW.FINDSET THEN BEGIN
          REPEAT
            Result := Result + EstimateLineRAW."Cumulative Total";
          UNTIL EstimateLineRAW.NEXT = 0;
        END;
        EXIT(Result);
      END;
      //
      Result := "Cumulative Total";
      EXIT(Result);
    END;

    PROCEDURE GetCalculatedUnitPrice@1100528906() Result : Decimal;
    BEGIN
      //DP01676
      Result := GetCalculatedCostAmount;
      IF "Part Quantity" = 0 THEN
        Result := 0
      ELSE
        Result := Result / "Part Quantity";
      EXIT(Result);
    END;

    PROCEDURE GetTotalAttachedLines@1100528911(VAR TotalHours@1100528907 : Decimal;VAR LaborAmount@1100528906 : Decimal;VAR MaterialAmount@1100528905 : Decimal;VAR SubcontractingAmount@1100528904 : Decimal;VAR PlantAmount@1100528903 : Decimal;VAR SundryAmount@1100528902 : Decimal;VAR TotalAmount@1100528901 : Decimal);
    VAR
      EstimateLineRAW@1100528900 : Record 11125698;
    BEGIN
      //DP01676
      IF ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN BEGIN
        TotalHours := 0;
        LaborAmount := 0;
        MaterialAmount := 0;
        SubcontractingAmount := 0;
        PlantAmount := 0;
        SundryAmount := 0;
        TotalAmount := 0;
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
        IF EstimateLineRAW.FINDSET THEN BEGIN
          REPEAT
            TotalHours := TotalHours + EstimateLineRAW."Cumulative Hours";
            LaborAmount := LaborAmount + EstimateLineRAW."Cumulative Labor";
            MaterialAmount := MaterialAmount + EstimateLineRAW."Cumulative Material";
            SubcontractingAmount := SubcontractingAmount + EstimateLineRAW."Cumulative Subcontracting";
            PlantAmount := PlantAmount + EstimateLineRAW."Cumulative Plant";
            SundryAmount := SundryAmount + EstimateLineRAW."Cumulative Sundry";
            TotalAmount := TotalAmount + EstimateLineRAW."Cumulative Total";
          UNTIL EstimateLineRAW.NEXT = 0;
        END;
      END ELSE BEGIN
        IF "Cost Type" <> "Cost Type"::Labor THEN
          TotalHours := 0;
      END;
    END;

    PROCEDURE UpdateSurchargeAmountAttachedLines@1100528913(OldSubTotal@1100528905 : Decimal;NewSubTotal@1100528906 : Decimal);
    VAR
      EstimateParagraphRAW@1100528900 : Record 11125679;
      EstimateLineRAW@1100528904 : Record 11125698;
      Result@1100528901 : Decimal;
    BEGIN
      //DP01676
      IF "Recipe No." <> '' THEN
        TESTFIELD("Appliance Type", "Appliance Type"::Recipe)
      ELSE
        TESTFIELD("Appliance Type", "Appliance Type"::EstimateRecipe);

      IF ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN BEGIN
        EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
        EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
        IF EstimateParagraphRAW.FINDFIRST THEN
          EstimateParagraphRAW.TESTFIELD("Lock Actual Amount for Updates", FALSE);
        //
        Result := 0;
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
        IF EstimateLineRAW.FINDSET THEN BEGIN
          REPEAT
            IF EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Labor THEN BEGIN
              Result := (EstimateLineRAW."Cumulative Labor" + EstimateLineRAW."Surcharge Amount Labor") * NewSubTotal/OldSubTotal;
              EstimateLineRAW."Surcharge Amount Labor" := Result - EstimateLineRAW."Cumulative Labor";
              EstimateLineRAW."Surcharge % Labor" := 100 * ((Result / EstimateLineRAW."Cumulative Total") - 1);
            END;
            IF EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Material THEN BEGIN
              Result := (EstimateLineRAW."Cumulative Material" + EstimateLineRAW."Surcharge Amount Material") * NewSubTotal/OldSubTotal;
              EstimateLineRAW."Surcharge Amount Material" := Result - EstimateLineRAW."Cumulative Material";
              EstimateLineRAW."Surcharge % Material" := 100 * ((Result / EstimateLineRAW."Cumulative Total") - 1);
            END;
            IF EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Subcontracting THEN BEGIN
              Result := (EstimateLineRAW."Cumulative Subcontracting" + EstimateLineRAW."Surcharge Amount Subcontr.") * NewSubTotal/OldSubTotal;
              EstimateLineRAW."Surcharge Amount Subcontr." := Result - EstimateLineRAW."Cumulative Subcontracting";
              EstimateLineRAW."Surcharge % Subcontracting" := 100 * ((Result / EstimateLineRAW."Cumulative Total") - 1);
            END;
            IF EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Plant THEN BEGIN
              Result := (EstimateLineRAW."Cumulative Plant" + EstimateLineRAW."Surcharge Amount Plant") * NewSubTotal/OldSubTotal;
              EstimateLineRAW."Surcharge Amount Plant" := Result - EstimateLineRAW."Cumulative Plant";
              EstimateLineRAW."Surcharge % Plant" := 100 * ((Result / EstimateLineRAW."Cumulative Total") - 1);
            END;
            EstimateLineRAW.MODIFY;
          UNTIL EstimateLineRAW.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE UpdateRecipeFields@1100528907();
    VAR
      EstimateLineRAW@1100525000 : Record 11125698;
      NewTimeQuan@1100525002 : Decimal;
      lvText000@1100525004 : TextConst 'ENU="Changing %1 for Estimate Lines not allowed; update related Recipe Lines?";SVE=éndring %1 for kalkylrader Ñr inte tillÜtet. Uppdatera relaterade mallrader?';
      NewProductionRate@1100528400 : Decimal;
      FieldName@1100525005 : Text[100];
      SkipQuestion@1100528900 : Boolean;
    BEGIN
      //DP01676
      IF NOT(
        ("Appliance Type" = "Appliance Type"::Recipe) OR
        ("Appliance Type" = "Appliance Type"::EstimateRecipe)) THEN EXIT;

      CASE CurrFieldNo OF
        FIELDNO("Ignore Paragraph Quantity"):
          BEGIN
            FieldName := FIELDCAPTION("Ignore Paragraph Quantity");
            SkipQuestion := TRUE;
          END;
        FIELDNO("Time Quantity"):
          BEGIN
            NewTimeQuan := "Time Quantity";
            "Time Quantity" := 1;
            FieldName := FIELDCAPTION("Time Quantity");
          END;
        FIELDNO("Production Rate"):
          BEGIN
            NewProductionRate := "Production Rate";
            "Production Rate" := 0;
            FieldName := FIELDCAPTION("Production Rate");
          END;
        FIELDNO("Apply Obligation"):
          BEGIN
            "Ignore Paragraph Quantity" := "Apply Obligation";
            FieldName := FIELDCAPTION("Apply Obligation");
            SkipQuestion := TRUE;
          END;
      END;
      IF MODIFY THEN;
      COMMIT;

      IF NOT SkipQuestion THEN
        IF NOT CONFIRM(lvText000, TRUE, FieldName) THEN EXIT;

      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      IF ("Appliance Type" = "Appliance Type"::Recipe) OR
         ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN
        EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
      IF ("Appliance Type" = "Appliance Type"::PlantSet) OR
         ("Appliance Type" = "Appliance Type"::PlantType) THEN
        EstimateLineRAW.SETRANGE("Attached to Line No.", "Line No.");
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          CASE CurrFieldNo OF
            FIELDNO("Ignore Paragraph Quantity"):
              BEGIN
                IF EstimateLineRAW."Ignore Recipe Quantity" THEN BEGIN  //C053781
                  EstimateLineRAW.VALIDATE("Ignore Paragraph Quantity", EstimateLineRAW."Ignore Recipe Quantity");
                END ELSE BEGIN
                  EstimateLineRAW.VALIDATE("Ignore Paragraph Quantity", "Ignore Paragraph Quantity");
                END;
              END;
            FIELDNO("Time Quantity"):
              EstimateLineRAW.VALIDATE("Time Quantity", NewTimeQuan);
            FIELDNO("Production Rate"):
              IF (EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Labor) OR
                ((EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Subcontracting) AND (EstimateLineRAW."Subcontracting in Hours")) OR
                ((EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Plant) AND (EstimateLineRAW."Plant Rates in Hours")) THEN  //db, 06-02-20
                EstimateLineRAW.VALIDATE("Production Rate", NewProductionRate);
            FIELDNO("Apply Obligation"):
              EstimateLineRAW.VALIDATE("Apply Obligation", "Apply Obligation");
          END;
          EstimateLineRAW.CalculateTotals;
          EstimateLineRAW.MODIFY(TRUE);
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    PROCEDURE AddLineToHeader@1100528908();
    VAR
      EstimateLineRAW@1100528900 : Record 11125698;
      BaseEstimateLine@1100528903 : Record 11125698;
      NextLine@1100528901 : Integer;
      BaseLine@1100528902 : Integer;
    BEGIN
      //DP01676
      IF "Line No." = 0 THEN BEGIN
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        IF NOT EstimateLineRAW.FINDLAST THEN EXIT;
        //
        NextLine := EstimateLineRAW."Line No." + 10000;
        IF (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::Recipe) OR
           (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::EstimateRecipe) OR
           (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::PlantType) OR
           (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::PlantSet) THEN
          BaseLine := EstimateLineRAW."Line No.";
        IF EstimateLineRAW."Attached to Recipe Line" <> 0 THEN
          IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", EstimateLineRAW."Attached to Recipe Line") THEN
            BaseLine := EstimateLineRAW."Line No.";
        IF EstimateLineRAW."Attached to Line No." <> 0 THEN
          IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", EstimateLineRAW."Attached to Line No.") THEN
            BaseLine := EstimateLineRAW."Line No.";
      END ELSE BEGIN
        IF ("Appliance Type" = "Appliance Type"::Recipe) OR
           ("Appliance Type" = "Appliance Type"::EstimateRecipe) OR
           ("Appliance Type" = "Appliance Type"::PlantType) OR
           ("Appliance Type" = "Appliance Type"::PlantSet) THEN
          BaseLine := "Line No.";
        IF "Attached to Recipe Line" <> 0 THEN
          IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", "Attached to Recipe Line") THEN
            BaseLine := EstimateLineRAW."Line No.";
        IF "Attached to Line No." <> 0 THEN
          IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", "Attached to Line No.") THEN
            BaseLine := EstimateLineRAW."Line No.";
        //
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETFILTER("Line No.", '>%1', "Line No.");
        IF EstimateLineRAW.FINDFIRST THEN
          NextLine := "Line No." + ROUND(((EstimateLineRAW."Line No." - "Line No.")/2),1)
        ELSE
          NextLine := "Line No." + 10000;
      END;

      IF BaseLine = 0 THEN EXIT;
      BaseEstimateLine.GET("Estimate No.", "Tender Paragraph No.", BaseLine);
      //
      EstimateLineRAW.INIT;
      EstimateLineRAW."Estimate No." := "Estimate No.";
      EstimateLineRAW.VALIDATE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW."Line No." := NextLine;
      EstimateLineRAW.INSERT(TRUE);
      //
      IF BaseEstimateLine."Recipe No." <> '' THEN BEGIN
        EstimateLineRAW.Source := BaseEstimateLine.Source;
        EstimateLineRAW."Recipe Type" := EstimateLineRAW."Recipe Type"::"Recipe Line";
        EstimateLineRAW."Recipe Group" := BaseEstimateLine."Recipe Group";
        EstimateLineRAW."Recipe No." := BaseEstimateLine."Recipe No.";
        EstimateLineRAW.Description := '<' + FORMAT("Recipe Type"::"Recipe Line")+ '>';
        EstimateLineRAW."Attached to Recipe Line" := BaseLine;
      END;
      IF BaseEstimateLine."Appliance Type" = BaseEstimateLine."Appliance Type"::EstimateRecipe THEN BEGIN
        EstimateLineRAW.Description := '<' + FIELDCAPTION("Attached to Line No.") + ': ' + FORMAT(BaseLine) + '>';
        EstimateLineRAW."Attached to Recipe Line" := BaseLine;
      END;
      IF (BaseEstimateLine."Appliance Type" = BaseEstimateLine."Appliance Type"::PlantType) OR
         (BaseEstimateLine."Appliance Type" = BaseEstimateLine."Appliance Type"::PlantSet) THEN BEGIN
        EstimateLineRAW.Description := '<' + FIELDCAPTION("Attached to Line No.") + ': ' + FORMAT(BaseLine) + '>';
        EstimateLineRAW."Attached to Line No." := BaseLine;
        EstimateLineRAW."Set Level" := BaseEstimateLine."Set Level" + 1;
      END;
      EstimateLineRAW.MODIFY;
    END;

    PROCEDURE CreateApplianceType@1100528909(ApplianceType@1100528902 : Integer;ApplianceCode@1100528900 : Code[20];ActivatedByFunction@1100528905 : Boolean);
    VAR
      EstimateLineRAW@1100528903 : Record 11125698;
      EstimateApplianceCodeRAW@1100528901 : Record 11125697;
      ManualBln@1100528904 : Boolean;
    BEGIN
      //DP01676
      TESTFIELD("Line No.");
      ManualBln := (ApplianceCode <> '');
      IF (ApplianceType = 0) AND (ApplianceCode = '') THEN BEGIN
        TESTFIELD("Appliance Type", "Appliance Type"::" ");
        TESTFIELD("Appliance Code", '');
        //
        EstimateApplianceCodeRAW.SETCURRENTKEY("Estimate No.", "Appliance Code");
        EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateApplianceCodeRAW.SETRANGE("Appliance Type", EstimateApplianceCodeRAW."Appliance Type"::SingleLine);
        EstimateApplianceCodeRAW.SETRANGE(Manual, FALSE);
        IF EstimateApplianceCodeRAW.FINDLAST THEN
          ApplianceCode := EstimateApplianceCodeRAW."Appliance Code"
        ELSE
          ApplianceCode := PADSTR('', 5, '0');  //reduce length to simplify manual input
        ApplianceCode := INCSTR(ApplianceCode);
      END;
      CheckDuplicateApplianceType(ApplianceType, ApplianceCode);  //T008537
      //
      EstimateApplianceCodeRAW.INIT;
      EstimateApplianceCodeRAW."Estimate No." := "Estimate No.";
      EstimateApplianceCodeRAW."Tender Paragraph No." := "Tender Paragraph No.";
      EstimateApplianceCodeRAW."Line No." := "Line No.";
      EstimateApplianceCodeRAW."Appliance Code" := ApplianceCode;
      EstimateApplianceCodeRAW.Manual := ManualBln;
      IF ApplianceType = 1 THEN
        EstimateApplianceCodeRAW."Appliance Type" := EstimateApplianceCodeRAW."Appliance Type"::MultiLine;
      EstimateApplianceCodeRAW.INSERT;
      //
      IF (ApplianceType = 0) THEN BEGIN
        IF (ManualBln = FALSE) THEN BEGIN
          EstimateLineRAW := Rec;
          EstimateLineRAW."Appliance Type" := EstimateLineRAW."Appliance Type"::EstimateAppliance;
          EstimateLineRAW."Appliance Code" := ApplianceCode;
          EstimateLineRAW.MODIFY;
        END;
      END;
      IF (ActivatedByFunction) THEN BEGIN  //switch ApplianceType only allowed by function even for lines with filled Type+Code
        IF (ApplianceType = 0) THEN
          "Appliance Type" := "Appliance Type"::EstimateAppliance;
        IF (ApplianceType = 1) THEN
          "Appliance Type" := "Appliance Type"::EstimateRecipe;
      END ELSE BEGIN
        //C057114.sn
        IF (ApplianceType = 1) THEN  //EstimateRecipe
          FillObligation;
        //C057114.en
      END;
    END;

    LOCAL PROCEDURE CopyDetailsApplianceCode@1100528912();
    VAR
      EstimateApplianceCodeRAW@1100528901 : Record 11125697;
      EstimateLineRAW@1100528907 : Record 11125698;
      EstimateLineFrom@1100528900 : Record 11125698;
      EstimateLineTo@1100528904 : Record 11125698;
      Gap@1100528902 : Integer;
      NumLines@1100528903 : Integer;
      NextLine@1100528905 : Integer;
      HeaderLine@1100528906 : Integer;
    BEGIN
      //DP01676
      EstimateApplianceCodeRAW.SETCURRENTKEY("Estimate No.", "Appliance Code");
      EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateApplianceCodeRAW.SETFILTER("Appliance Code", "Appliance Code");
      IF NOT EstimateApplianceCodeRAW.FINDFIRST THEN EXIT;
      //
      IF NOT EstimateLineFrom.GET(EstimateApplianceCodeRAW."Estimate No.", EstimateApplianceCodeRAW."Tender Paragraph No.", EstimateApplianceCodeRAW."Line No.") THEN EXIT;
      //
      AssignFieldsRelatedToApplianceCode(EstimateLineFrom,Rec,0);
      IF EstimateApplianceCodeRAW."Appliance Type" = EstimateApplianceCodeRAW."Appliance Type"::MultiLine THEN BEGIN
        FillObligation;
      END ELSE BEGIN
        IF "Apply Obligation" AND ("Production Rate" <> 0) THEN
          VALIDATE("Production Rate");  //C057153
      END;
      UpdateCumulativeQty;
      MODIFY;
      //
      IF EstimateApplianceCodeRAW."Appliance Type" = EstimateApplianceCodeRAW."Appliance Type"::SingleLine THEN EXIT;
      HeaderLine := "Line No.";

      //T008537.sn
      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
      EstimateLineRAW.DELETEALL;
      //
      EstimateLineRAW.RESET;
      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETFILTER("Line No.", '>%1', "Line No.");
      IF EstimateLineRAW.FINDFIRST THEN
        Gap := EstimateLineRAW."Line No." - "Line No.";
      //T008537.en

      EstimateLineFrom.SETRANGE("Estimate No.", EstimateApplianceCodeRAW."Estimate No.");
      EstimateLineFrom.SETRANGE("Tender Paragraph No.", EstimateApplianceCodeRAW."Tender Paragraph No.");
      IF ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN
         EstimateLineFrom.SETRANGE("Attached to Recipe Line", EstimateApplianceCodeRAW."Line No.")
      ELSE
        EstimateLineFrom.SETRANGE("Attached to Line No.", EstimateApplianceCodeRAW."Line No.");
      IF EstimateLineFrom.FINDSET THEN BEGIN
        NumLines := EstimateLineFrom.COUNT;
        IF Gap = 0 THEN
          Gap := 10000
        ELSE
          Gap := ROUND(Gap/(NumLines+1),1);  //T008537
        NextLine := "Line No." + Gap;
        REPEAT
          EstimateLineTo.INIT;  //C062275
          EstimateLineTo."Estimate No." := "Estimate No.";
          EstimateLineTo.VALIDATE("Tender Paragraph No.", "Tender Paragraph No.");
          EstimateLineTo."Line No." := NextLine;
          NextLine := EstimateLineTo."Line No." + Gap;
          EstimateLineTo.INSERT(TRUE);
          //
          AssignFieldsRelatedToApplianceCode(EstimateLineFrom,EstimateLineTo,HeaderLine);
          EstimateLineTo.UpdateCumulativeQty;
          EstimateLineTo.MODIFY;
        UNTIL EstimateLineFrom.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE AssignFieldsRelatedToApplianceCode@1100528910(EstimateLineFrom@1100528900 : Record 11125698;VAR EstimateLineTo@1100528901 : Record 11125698;HeaderLine@1100528902 : Integer);
    BEGIN
      //DP01676
      WITH EstimateLineTo DO BEGIN
        "Appliance Type" := EstimateLineFrom."Appliance Type";
        "Appliance Code" := EstimateLineFrom."Appliance Code";
        "Attached to Recipe Line" := HeaderLine;
        Description := EstimateLineFrom.Description;
        "Unit of Measure" := EstimateLineFrom."Unit of Measure";
        Quantity := EstimateLineFrom.Quantity;
        "Unit of Time" := EstimateLineFrom."Unit of Time";
        "Time Quantity" := EstimateLineFrom."Time Quantity";
        "Ignore Paragraph Quantity" := EstimateLineFrom."Ignore Paragraph Quantity";
        Length:= EstimateLineFrom.Length;
        Width := EstimateLineFrom.Width;
        Height := EstimateLineFrom.Height;
        "Line Status" := EstimateLineFrom."Line Status";
        "Norm Group" := EstimateLineFrom."Norm Group";
        "Sub Operation Code" := EstimateLineFrom."Sub Operation Code";
        Norm := EstimateLineFrom.Norm;
        "Production Rate" := EstimateLineFrom."Production Rate";
        "Apply Obligation" := EstimateLineFrom."Apply Obligation";
        "Plant Rates in Hours" := EstimateLineFrom."Plant Rates in Hours";
        "Rate Code" := EstimateLineFrom."Rate Code";
        Rate := EstimateLineFrom.Rate;
        "Rate Type" := EstimateLineFrom."Rate Type";
        "Team Size" := EstimateLineFrom."Team Size";
        "Wage Component" := EstimateLineFrom."Wage Component";
        "Gross Price" := EstimateLineFrom."Gross Price";
        "Purchase Discount %" := EstimateLineFrom."Purchase Discount %";
        "Net Cost Price" := EstimateLineFrom."Net Cost Price";
        VALIDATE("Cost Object", EstimateLineFrom."Cost Object");
        "Cost Component" := EstimateLineFrom."Cost Component";
        Vendor := EstimateLineFrom.Vendor;
        Subcontractor := EstimateLineFrom.Subcontractor;
        "Subcontracting Activity" := EstimateLineFrom."Subcontracting Activity";
        "Subcontracting in Hours" := EstimateLineFrom."Subcontracting in Hours";  //C053751
        "Item No." := EstimateLineFrom."Item No.";
        Manufacturer := EstimateLineFrom.Manufacturer;
        "Basic Item" := EstimateLineFrom."Basic Item";
        "Vendor (Trade Item)" := EstimateLineFrom."Vendor (Trade Item)";
        "Trade Item" := EstimateLineFrom."Trade Item";
        "Plant Type" := EstimateLineFrom."Plant Type";
        "Set Code" := EstimateLineFrom."Set Code";
        //C059334.sn
        "Surcharge % Labor" := EstimateLineFrom."Surcharge % Labor";
        "Surcharge % Material" := EstimateLineFrom."Surcharge % Material";
        "Surcharge % Subcontracting" := EstimateLineFrom."Surcharge % Subcontracting";
        "Surcharge % Plant" := EstimateLineFrom."Surcharge % Plant";
        //C059334.en
      END;
    END;

    LOCAL PROCEDURE GetDefaultEstimateVendor@1100528500();
    BEGIN
      //C051377
      Estimate.GET("Estimate No.");
      IF Estimate."Preferred Supplier" = '' THEN EXIT;
      Estimate.CALCFIELDS("Vendor (Trade Item)");
      "Vendor (Trade Item)" := Estimate."Vendor (Trade Item)";
    END;

    LOCAL PROCEDURE GetDefaultEstimateRate@1100528914();
    BEGIN
      //DP01676
      IF "Rate Code" <> '' THEN EXIT;
      //
      Estimate.GET("Estimate No.");
      IF Estimate."Rate Code" <> '' THEN BEGIN
        "Cost Type" := "Cost Type"::Labor;
        xRec."Rate Type" := "Rate Type";  //disable function ConvertNorm by next validate
        xRec."Team Size" := "Team Size";
        VALIDATE("Rate Code", Estimate."Rate Code");
        DetermineNormGroup;
        CheckRelatedApplianceType;
      END;
    END;

    LOCAL PROCEDURE GetDefaultCalcHours@1100528915();
    BEGIN
      //DP01676
      IF NOT Estimate.GET("Estimate No.") THEN EXIT;  //skip error on CopyEstimate
      "Plant Rates in Hours" := (Estimate."Plant Rates in Hours") AND ("Cost Type" = "Cost Type"::Plant);
      "Subcontracting in Hours" := (Estimate."Subcontracting in Hours") AND ("Cost Type" = "Cost Type"::Subcontracting);  //C053751
    END;

    PROCEDURE EvaluateResultObligation@1100528916(iQuantity@1100528904 : Decimal;iProductionFactor@1100528905 : Decimal;CalledByField@1100528906 : Integer;VAR varResult@1100528907 : Decimal) : Boolean;
    VAR
      ResultObligation@1100528901 : Decimal;
    BEGIN
      //DP01676
      varResult := 0;
      ResultObligation := ReadObligation;
      IF ResultObligation = 0 THEN EXIT(FALSE);
      //
      IF CalledByField = FIELDNO(Quantity) THEN
        IF (iQuantity <> 0) THEN
          varResult := ResultObligation / iQuantity;
      IF CalledByField = FIELDNO("Production Rate") THEN
        IF (iProductionFactor <> 0) THEN
          varResult := ResultObligation / iProductionFactor;
      //
      EXIT(varResult <> 0);
    END;

    PROCEDURE UpdateResultObligation@1100528917(SkipCheck@1100528904 : Boolean);
    VAR
      EstimateLineRAW@1100528901 : Record 11125698;
      EstimateParagraphRAW@1100528900 : Record 11125679;
      ContinueCheck@1100528902 : Boolean;
      ResultObligation@1100528903 : Decimal;
    BEGIN
      //DP01676
      IF  ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN
        IF "Apply Obligation" THEN
          ResultObligation := Quantity;
      IF ResultObligation = 0 THEN BEGIN
        EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
        EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
        IF EstimateParagraphRAW.FINDFIRST THEN
          IF NOT SkipCheck THEN
            ResultObligation := EstimateParagraphRAW."Quantity (Result Obligation)";
      END;
      //
      IF ("Appliance Type" = "Appliance Type"::Recipe) OR
         ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN BEGIN
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETRANGE("Attached to Recipe Line", "Line No.");
        ContinueCheck := NOT EstimateLineRAW.ISEMPTY;
      END;
      IF ("Appliance Type" = "Appliance Type"::PlantSet) OR
         ("Appliance Type" = "Appliance Type"::PlantType) THEN BEGIN
        EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateLineRAW.SETRANGE("Attached to Line No.", "Line No.");
        ContinueCheck := NOT EstimateLineRAW.ISEMPTY;
      END;
      IF NOT ContinueCheck THEN BEGIN
        IF (ResultObligation <> 0) AND ("Production Rate" <> 0) THEN
          OnValidateApplyObligation;
        EXIT;
      END;
      //
      EstimateLineRAW.SETFILTER("Production Rate", '<>%1', 0);
      IF EstimateLineRAW.FINDSET THEN BEGIN
        REPEAT
          IF ResultObligation = 0 THEN BEGIN
            EstimateLineRAW."Apply Obligation" := FALSE;
            EstimateLineRAW.VALIDATE("Production Rate");
          END ELSE BEGIN
            EstimateLineRAW."Apply Obligation" := TRUE;
            EstimateLineRAW.Norm := 1;
            EstimateLineRAW.VALIDATE(Quantity, ResultObligation / EstimateLineRAW."Production Rate");
          END;
          EstimateLineRAW."Ignore Paragraph Quantity" := EstimateLineRAW."Apply Obligation";
          EstimateLineRAW.CalculateTotals;
          EstimateLineRAW.MODIFY;
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE FillObligation@1100528919();
    VAR
      EstimateParagraphRAW@1100528900 : Record 11125679;
    BEGIN
      //DP01676
      EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
      EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
      IF EstimateParagraphRAW.FINDFIRST THEN BEGIN
        Quantity := EstimateParagraphRAW."Quantity (Result Obligation)";
        "Unit of Measure" := EstimateParagraphRAW."Unit of Measure (Obligation)";
        "Apply Obligation" := (EstimateParagraphRAW."Quantity (Result Obligation)" <> 0);
        "Ignore Paragraph Quantity" := "Apply Obligation";
        UpdateCumulativeQty;
      END;
    END;

    PROCEDURE ReadObligation@1100528920() ResultObligation : Decimal;
    VAR
      EstimateParagraphRAW@1100528901 : Record 11125679;
      EstimateLineRAW@1100528900 : Record 11125698;
    BEGIN
      //DP01676
      IF  ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN
        IF "Apply Obligation" THEN
           ResultObligation := Quantity;
      IF ResultObligation = 0 THEN BEGIN
        IF "Attached to Line No." <> 0 THEN
          IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", "Attached to Line No.") THEN
            IF EstimateLineRAW."Apply Obligation" THEN
              ResultObligation := EstimateLineRAW.Quantity;
        IF "Attached to Recipe Line" <> 0 THEN
          IF EstimateLineRAW.GET("Estimate No.", "Tender Paragraph No.", "Attached to Recipe Line") THEN
            IF EstimateLineRAW."Apply Obligation" THEN
              ResultObligation := EstimateLineRAW.Quantity;
      END;
      IF ResultObligation = 0 THEN BEGIN
        EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
        EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
        IF EstimateParagraphRAW.FINDFIRST THEN
          ResultObligation := EstimateParagraphRAW."Quantity (Result Obligation)";
      END;
      EXIT(ResultObligation)
    END;

    PROCEDURE SetCalledByObligation@1100528921(iCalledByObligation@1100528900 : Boolean);
    BEGIN
      CalledByObligation := iCalledByObligation;
    END;

    LOCAL PROCEDURE OnValidateApplyObligation@1100528918();
    VAR
      ResultObligation@1100528902 : Decimal;
    BEGIN
      //DP01676
      ResultObligation := ReadObligation;
      "Apply Obligation" := FALSE;
      IF ResultObligation <> 0 THEN BEGIN
        IF ("Appliance Type" = "Appliance Type"::Recipe) OR ("Appliance Type" = "Appliance Type"::EstimateRecipe) THEN BEGIN
          "Apply Obligation" := TRUE;
          EXIT;
        END;
        IF ("Cost Type" = "Cost Type"::Material) OR ("Cost Type" = "Cost Type"::Sundry) THEN BEGIN
          "Apply Obligation" := TRUE;
        END ELSE BEGIN
          IF "Production Rate" <> 0 THEN BEGIN
            "Apply Obligation" := TRUE;
            Norm := 1;
            VALIDATE(Quantity, ResultObligation / "Production Rate");
          END;
        END;
      END;
      "Ignore Paragraph Quantity" := "Apply Obligation";
      IF ("Cost Type" = "Cost Type"::Material) OR ("Cost Type" = "Cost Type"::Sundry) THEN BEGIN
        UpdateCumulativeQty;  //C051202+C053781
      END ELSE BEGIN
        IF "Apply Obligation" = FALSE THEN
          VALIDATE("Production Rate");
      END;
      CalculateTotals;
    END;

    PROCEDURE OnValidateProductionRate@1100528922();
    VAR
      ResultObligation@1100528900 : Decimal;
    BEGIN
      //DP01676
      IF ("Appliance Type" <> "Appliance Type"::Recipe) AND ("Appliance Type" <> "Appliance Type"::EstimateRecipe) THEN BEGIN
        "Apply Obligation" := EvaluateResultObligation(Quantity, "Production Rate",FIELDNO("Production Rate"),ResultObligation);
        IF IgnoreParagraphQuantityForEuroEntry THEN  //C056424
          "Ignore Paragraph Quantity" := TRUE
        ELSE
          "Ignore Paragraph Quantity" := "Apply Obligation";
        IF "Apply Obligation" THEN BEGIN
          IF "Production Rate" <> 0 THEN
            Norm := 1
          ELSE
            Norm := 0;
          IF (CurrFieldNo = FIELDNO(Quantity)) THEN BEGIN
            CalculateTotals;  //C051060
            EXIT;  //avoid recursion
          END;
          VALIDATE(Quantity, ResultObligation);
        END ELSE BEGIN
          IF "Production Rate" <> 0 THEN
            VALIDATE(Norm, 1 / "Production Rate")
          ELSE
            VALIDATE(Norm, 0);
        END;
      END;
    END;

    LOCAL PROCEDURE OnValidateNorm@1100528924();
    BEGIN
      //DP01676
      IF "Apply Obligation" THEN BEGIN
        IF "Production Rate" <> 0 THEN
          Norm := 1
        ELSE
          Norm := 0;
      END ELSE BEGIN
        IF Norm <> 0 THEN
          "Production Rate" := 1 / Norm
        ELSE
          "Production Rate" := 0;
      END;
    END;

    PROCEDURE UpdateParagraphTotal@1100528925();
    VAR
      EstimateParagraphRAW@1100528900 : Record 11125679;
      EstimateLineRAW@1100528901 : Record 11125698;
      CalculatedAmount@1100528902 : Decimal;
      SurchargeAmount@1100528904 : Decimal;
      ActualAmount@1100528903 : Decimal;
      SurchargeLabor@1100528905 : Decimal;
      SurchargeMaterial@1100528906 : Decimal;
      SurchargeSubcontracting@1100528907 : Decimal;
      SurchargePlant@1100528908 : Decimal;
    BEGIN
      //DP02340
      IF CurrFieldNo = 0 THEN
        IF CalledByObligation = FALSE THEN  //C060445
          EXIT;  //process only when field changes

      CalculatedAmount := 0;
      SurchargeAmount := 0;
      ActualAmount := 0;

      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETFILTER("Line No.", '<>%1', "Line No.");
      IF EstimateLineRAW.FINDSET THEN BEGIN
        REPEAT
          CalculatedAmount := CalculatedAmount + EstimateLineRAW.Amount;
          SurchargeAmount := SurchargeAmount + EstimateLineRAW."Total Surcharge Amount";
          CASE EstimateLineRAW."Cost Type" OF
            EstimateLineRAW."Cost Type"::Labor: SurchargeLabor := SurchargeLabor + EstimateLineRAW."Surcharge Amount Labor";
            EstimateLineRAW."Cost Type"::Material: SurchargeMaterial := SurchargeMaterial + EstimateLineRAW."Surcharge Amount Material";
            EstimateLineRAW."Cost Type"::Subcontracting: SurchargeSubcontracting := SurchargeSubcontracting + EstimateLineRAW."Surcharge Amount Subcontr.";
            EstimateLineRAW."Cost Type"::Plant: SurchargePlant := SurchargePlant + EstimateLineRAW."Surcharge Amount Plant";
          END;
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
      CalculatedAmount := CalculatedAmount + Amount;
      SurchargeAmount := SurchargeAmount + "Total Surcharge Amount";
      ActualAmount := CalculatedAmount + SurchargeAmount;
      CASE "Cost Type" OF
        "Cost Type"::Labor: SurchargeLabor := SurchargeLabor + "Surcharge Amount Labor";
        "Cost Type"::Material: SurchargeMaterial := SurchargeMaterial + "Surcharge Amount Material";
        "Cost Type"::Subcontracting: SurchargeSubcontracting := SurchargeSubcontracting + "Surcharge Amount Subcontr.";
        "Cost Type"::Plant: SurchargePlant := SurchargePlant + "Surcharge Amount Plant";
      END;

      EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
      IF EstimateParagraphRAW.FINDSET THEN BEGIN
        EstimateParagraphRAW.SetSkipUpdateLines(TRUE);
        EstimateParagraphRAW.VALIDATE("Calculated Amount", CalculatedAmount);
        EstimateParagraphRAW."Calculate Summary Cost" := TRUE;
        IF EstimateParagraphRAW."Lock Actual Amount for Updates" = FALSE THEN BEGIN
          //do not validate Surcharge-fields on Paragraph
          EstimateParagraphRAW."Total Surcharge Amount" := SurchargeAmount;
          EstimateParagraphRAW."Surcharge Amount Labor" := SurchargeLabor;
          EstimateParagraphRAW."Surcharge Amount Material" := SurchargeMaterial;
          EstimateParagraphRAW."Surcharge Amount Subcontr." := SurchargeSubcontracting;
          EstimateParagraphRAW."Surcharge Amount Plant" := SurchargePlant;
          //
          EstimateParagraphRAW.CALCFIELDS("Calculated Amount Labor", "Calculated Amount Material", "Calculated Amount Subcontr.", "Calculated Amount Plant");
          EstimateParagraphRAW."Surcharge % Labor" := EstimateParagraphRAW.SafeDivision(EstimateParagraphRAW."Surcharge Amount Labor", EstimateParagraphRAW."Calculated Amount Labor") * 100;
          EstimateParagraphRAW."Surcharge % Material" := EstimateParagraphRAW.SafeDivision(EstimateParagraphRAW."Surcharge Amount Material", EstimateParagraphRAW."Calculated Amount Material") * 100;
          EstimateParagraphRAW."Surcharge % Subcontracting" := EstimateParagraphRAW.SafeDivision(EstimateParagraphRAW."Surcharge Amount Subcontr.", EstimateParagraphRAW."Calculated Amount Subcontr.") * 100;
          EstimateParagraphRAW."Surcharge % Plant" := EstimateParagraphRAW.SafeDivision(EstimateParagraphRAW."Surcharge Amount Plant", EstimateParagraphRAW."Calculated Amount Plant") * 100;
          //
          EstimateParagraphRAW.VALIDATE("Actual Amount", ActualAmount);
        END;
        EstimateParagraphRAW.MODIFY;
        EstimateParagraphRAW.SetSkipUpdateLines(FALSE);
      END;
    END;

    PROCEDURE CheckIgnoreRecipeQuantity@1100528926();
    BEGIN
      //db, 11-10-19
      IF ("Ignore Paragraph Quantity" = FALSE) AND ("Ignore Recipe Quantity" = TRUE) THEN
        "Ignore Paragraph Quantity" := TRUE;  //C053781
    END;

    LOCAL PROCEDURE InitLineTotals@1100528927();
    BEGIN
      //C060821
      Hours := 0;
      "Labor Amount" := 0;
      "Gross Amount" := 0;
      "Material Amount" := 0;
      "Subcontracting Amount" := 0;
      "Plant Amount" := 0;
      "Sundry Amount" := 0;
      Amount := 0;
      //
      "Cumulative Hours" := 0;
      "Cumulative Labor" := 0;
      "Cumulative Material" := 0;
      "Cumulative Subcontracting" := 0;
      "Cumulative Plant" := 0;
      "Cumulative Sundry" := 0;
      "Cumulative Total" := 0;
      //
      "Surcharge Amount Labor" := 0;
      "Surcharge Amount Material" := 0;
      "Surcharge Amount Subcontr." := 0;
      "Surcharge Amount Plant" := 0;
      "Total Surcharge Amount" := 0;
      //
      "VAT Base Amount" := 0;
      "VAT Amount" := 0;
    END;

    LOCAL PROCEDURE SwitchApplianceAllowed@1100525000();
    BEGIN
      //C052698
      TESTFIELD("Recipe No.",'');
      TESTFIELD("Item No.",'');
      TESTFIELD("Trade Item",'');
      TESTFIELD("Subcontracting Activity",'');
      TESTFIELD("Plant Type",'');
      TESTFIELD("Set Code",'');
      TESTFIELD("Rate Code",'');
      TESTFIELD("Cost Object",'');
      TESTFIELD(Amount,0);
    END;

    PROCEDURE FillApplianceTypeFromRecipeActivity@1100525018();
    BEGIN
      //db, 04-02-20
      IF "Trade Item" <> '' THEN BEGIN
        "Appliance Type" := "Appliance Type"::TradeItem;
      END ELSE BEGIN
        IF "Item No." <> '' THEN
          "Appliance Type" := "Appliance Type"::Item;
      END;
      IF "Set Code" <> '' THEN BEGIN
        "Appliance Type" := "Appliance Type"::PlantSet;
      END ELSE BEGIN
        IF "Plant Type" <> '' THEN
          "Appliance Type" := "Appliance Type"::PlantType;
      END;
      IF "Subcontracting Activity" <> '' THEN
        "Appliance Type" := "Appliance Type"::SubcontractingActivity;
      IF "Recipe Type" = "Recipe Type"::"Recipe Header" THEN
        "Appliance Type" := "Appliance Type"::Recipe;
      IF "Appliance Type" = "Appliance Type"::" " THEN
        IF "Rate Code" <> '' THEN
          "Appliance Type" := "Appliance Type"::RateCode;
      IF "Appliance Type" = "Appliance Type"::" " THEN
        IF "Cost Object" <> '' THEN
          "Appliance Type" := "Appliance Type"::CostObject;
      CheckRelatedApplianceType;
    END;

    LOCAL PROCEDURE CheckDuplicateApplianceType@1100528928(ApplianceType@1100528902 : Integer;ApplianceCode@1100528901 : Code[20]);
    VAR
      EstimateApplianceCodeRAW@1100528900 : Record 11125697;
      EstimateLineRAW@1100528903 : Record 11125698;
    BEGIN
      //T008537
      EstimateApplianceCodeRAW.SETCURRENTKEY("Estimate No.", "Appliance Code");
      EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateApplianceCodeRAW.SETRANGE("Appliance Code", ApplianceCode);
      EstimateApplianceCodeRAW.SETRANGE("Appliance Type", ApplianceType);
      IF EstimateApplianceCodeRAW.FINDFIRST THEN BEGIN
        IF ApplianceType = 0 THEN
          EstimateLineRAW."Appliance Type" := EstimateLineRAW."Appliance Type"::EstimateAppliance;
        IF ApplianceType = 1 THEN
          EstimateLineRAW."Appliance Type" := EstimateLineRAW."Appliance Type"::EstimateRecipe;
        ERROR(Text025, EstimateLineRAW."Appliance Type", ApplianceCode);
      END;
    END;

    BEGIN
    END.
  }
}

