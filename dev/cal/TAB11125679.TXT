OBJECT Table 11125679 Estimate Paragraph RAW
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Estimate No.,Tender Paragraph No.,Text;
    OnInsert=VAR
               Estimate@1100525001 : Record 11012151;
               EstimateParagraphRAW@1100525000 : Record 11125679;
             BEGIN
               IF "Construction Spec. Line No." = '00' THEN BEGIN
                 EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                 EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 IF NOT EstimateParagraphRAW.ISEMPTY THEN
                   ERROR(Text000, FIELDCAPTION("Tender Paragraph No."), "Tender Paragraph No.", Estimate.TABLECAPTION, "Estimate No.");
               END ELSE BEGIN
                 IF "Construction Spec. Line No." = '' THEN
                   VALIDATE("Construction Spec. Line No.", '09');
                 IF Activity = '' THEN
                   Activity := GetActivityFrom00; //no validate
               END;
             END;

    OnDelete=VAR
               EstimateRAWSetup@1100525004 : Record 11125673;
               Estimate@1100525002 : Record 11012151;
               EstimateParagraphRAW@1100525001 : Record 11125679;
               EstimateLineRAW@1100525000 : Record 11125698;
               EstimateVATSpecRAW@1100525003 : Record 11125678;
               CommentLineRAW@1100525005 : Record 11125684;
               EstimateApplianceCodeRAW@1100528900 : Record 11125697;
               EstimateCode@1100528901 : Record 11229772;
             BEGIN
               IF Type = Type::"Commitment (Main Line)" THEN BEGIN
                 EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.");
                 EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                 //EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", '%1..%2', COPYSTR("Tender Paragraph No.",1,5)+'1', COPYSTR("Tender Paragraph No.",1,5)+'9'); //C026972.o
                 EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", COPYSTR("Tender Paragraph No.",1,5)+'1', GetMaxSubParagraphNo("Estimate No.","Tender Paragraph No.")); //C026972.n
                 EstimateParagraphRAW.DELETEALL(TRUE);
               END;

               EstimateRAWSetup.GET;
               IF ("Tender Paragraph No." = EstimateRAWSetup."Paragraph No.(GeneralCost)") AND (EstimateRAWSetup."Paragraph No.(GeneralCost)" <> '') THEN BEGIN
                 Estimate.GET("Estimate No.");
                 Estimate."Percentage (GeneralCost)" := 0;
                 Estimate.MODIFY(TRUE);
               END;
               IF ("Tender Paragraph No." = EstimateRAWSetup."Paragraph No.(Profit/Risk)") AND (EstimateRAWSetup."Paragraph No.(Profit/Risk)" <> '') THEN BEGIN
                 Estimate.GET("Estimate No.");
                 Estimate."Percentage (Profit/Risk)" := 0;
                 Estimate.MODIFY(TRUE);
               END;
               //DP01488.sn
               IF ("Tender Paragraph No." = EstimateRAWSetup."Paragraph No.(ExecutionCost)") AND (EstimateRAWSetup."Paragraph No.(ExecutionCost)" <> '') THEN BEGIN
                 Estimate.GET("Estimate No.");
                 Estimate."Percentage (ExecutionCost)" := 0;
                 Estimate.MODIFY(TRUE);
               END;
               IF ("Tender Paragraph No." = EstimateRAWSetup."Paragraph No.(Discount)") AND (EstimateRAWSetup."Paragraph No.(Discount)" <> '') THEN BEGIN
                 Estimate.GET("Estimate No.");
                 Estimate."Percentage (Discount)" := 0;
                 Estimate.MODIFY(TRUE);
               END;
               //DP01488.en

               IF "Construction Spec. Line No." = '00' THEN BEGIN
                 // Delete other lines belonging to same paragraph
                 EstimateParagraphRAW.RESET;
                 EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
                 EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                 EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 EstimateParagraphRAW.SETFILTER("Construction Spec. Line No.", '<>%1', '00');  //db, 14-04-16 (field not properly filled for paragraph with defi-codes)
                 EstimateParagraphRAW.DELETEALL;

                 //db, 10-05-16: deleting paragraph for defi-codes should not remove estimate details
                 EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                 EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 EstimateLineRAW.DELETEALL;

                 CommentLineRAW.SETRANGE("Table No.", DATABASE::"Estimate Line RAW");  //DP01086 Delete comment estimate line
                 CommentLineRAW.SETRANGE("Estimate No.", "Estimate No.");
                 CommentLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 CommentLineRAW.DELETEALL;

                 EstimateVATSpecRAW.SETRANGE("Estimate No.", "Estimate No.");
                 EstimateVATSpecRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 EstimateVATSpecRAW.DELETEALL;

                 //DP01676.sn
                 EstimateApplianceCodeRAW.SETRANGE("Estimate No.", "Estimate No.");
                 EstimateApplianceCodeRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 EstimateApplianceCodeRAW.DELETEALL;

                 EstimateCode.SETRANGE("Estimate No.","Estimate No.");
                 EstimateCode.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
                 EstimateCode.DELETEALL;
                 //DP01676.en

                 CommentLineRAW.DeleteEstElemLineComment("Estimate No.", "Tender Paragraph No.", "Line No.");  //DP01086.n
                 DeleteExcelFile(Rec); //DP01561
               END;
             END;

    CaptionML=[ENU=Estimate Paragraph RAW;
               NOR=Kalkyleelement (RAW);
               SVE=Kalkylelement (RAW)];
    LookupPageID=Page11125683;
    DrillDownPageID=Page11125683;
  }
  FIELDS
  {
    { 1   ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate;
                                                   OnValidate=VAR
                                                                Estimate@1100525000 : Record 11012151;
                                                              BEGIN
                                                                IF NOT Estimate.GET("Estimate No.") THEN
                                                                  Estimate.INIT;

                                                                "Surcharge % Labor" := Estimate."Surcharge % Labor";
                                                                "Surcharge % Material" := Estimate."Surcharge % Material";
                                                                "Surcharge % Subcontracting" := Estimate."Surcharge % Subcontracting";
                                                                "Surcharge % Plant" := Estimate."Surcharge % Plant";
                                                              END;

                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr] }
    { 2   ;   ;Tender Paragraph No.;Text6         ;OnValidate=VAR
                                                                EstimateParagraphRAW@1100525000 : Record 11125679;
                                                                CommitmentNo@1100525001 : Text[6];
                                                              BEGIN
                                                                IF STRLEN("Tender Paragraph No.") = 6 THEN BEGIN
                                                                  IF COPYSTR("Tender Paragraph No.", 6, 1) <> '0' THEN BEGIN
                                                                    CommitmentNo := COPYSTR("Tender Paragraph No.", 1, 5) + '0';
                                                                    EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                                                                    EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", CommitmentNo);
                                                                    IF EstimateParagraphRAW.ISEMPTY THEN BEGIN  //C026972.n
                                                                      IF COPYSTR("Tender Paragraph No.", 1, 1) = '9' THEN
                                                                        ERROR(Text002, CommitmentNo)
                                                                      ELSE BEGIN
                                                                        EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", COPYSTR(CommitmentNo,1,4)+'00', CommitmentNo);
                                                                        EstimateParagraphRAW.FILTERGROUP(9);
                                                                        EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", COPYSTR(CommitmentNo,1,4)+'?0');
                                                                        EstimateParagraphRAW.FILTERGROUP(0);
                                                                        IF EstimateParagraphRAW.ISEMPTY THEN
                                                                          ERROR(Text002, CommitmentNo);
                                                                      END;
                                                                    END;
                                                                  END;
                                                                END;
                                                                UpdateIndentation;
                                                                UpdateCommitment;
                                                                UpdateType;

                                                                IF (STRLEN(xRec."Tender Paragraph No.") = 6) AND (STRLEN("Tender Paragraph No.") < 6) THEN BEGIN
                                                                  Activity := '';
                                                                  "Internal Unit of Measure Code" := '';
                                                                  "External Unit of Measure Code" := '';
                                                                  Quantity := 0;
                                                                  "Quantity Type" := "Quantity Type"::" ";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph;
                                                              NOR=Elementnr;
                                                              SVE=Elementnr];
                                                   NotBlank=Yes }
    { 3   ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 10  ;   ;Type                ;Option        ;CaptionML=[ENU=Type;
                                                              NOR=Type;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=[ENU=" ,,,,,Chapter,,,,,Paragraph,,,,,Subparagraph,,,,,Subsubparagraph,,,,,Commitment (Main Line),,,,,Commitment (Sub Line),,,,,Commitment Description (Main Line),,,,,Commitment Description (Sub Line)";
                                                                    NOR=" ,,,,,Kapittel,,,,,Avsnitt,,,,,Underavsnitt,,,,,Del av underavsnitt,,,,,Forpliktelse (hovedrad),,,,,Forpliktelse (underrad),,,,,Forpliktelsebeskrivelse (hovedrad),,,,,Forpliktelsebeskrivelse (underrad)";
                                                                    SVE=" ,,,,,Kapitel,,,,,Stycke,,,,,Delstycke,,,,,Del av delstycke,,,,,ètagande (huvudrad),,,,,ètagande (underrad),,,,,ètagande beskrivning (huvudrad),,,,,ètagande beskrivning (underrad)"];
                                                   OptionString=[ ,,,,,Chapter,,,,,Paragraph,,,,,Subparagraph,,,,,Subsubparagraph,,,,,Commitment (Main Line),,,,,Commitment (Sub Line),,,,,Commitment Description (Main Line),,,,,Commitment Description (Sub Line)];
                                                   Editable=No }
    { 15  ;   ;Source              ;Option        ;CaptionML=[ENU=Source;
                                                              NOR=Kilde;
                                                              SVE=KÑlla];
                                                   OptionCaptionML=[ENU=" ,,,,,Construction Specification";
                                                                    NOR=" ,,,,,Konstruksjonsspesifikasjon";
                                                                    SVE=" ,,,,,Konstruktionsspecifikation"];
                                                   OptionString=[ ,,,,,Construction Specification];
                                                   Editable=No }
    { 17  ;   ;Status Code         ;Code10        ;TableRelation="Estimate Paragraph Status RAW";
                                                   CaptionML=[ENU=Status Code;
                                                              NOR=Statuskode;
                                                              SVE=Statuskod] }
    { 20  ;   ;Defi Code Position 1;Code1         ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Defi Code Position 1;
                                                              NOR=Defi-kodeposisjon 1;
                                                              SVE=Defi. kodposition 1] }
    { 21  ;   ;Defi Code Position 2;Code1         ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Defi Code Position 2;
                                                              NOR=Defi-kodeposisjon 2;
                                                              SVE=Defi. kodposition 2] }
    { 22  ;   ;Defi Code Position 3;Code1         ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Defi Code Position 3;
                                                              NOR=Defi-kodeposisjon 3;
                                                              SVE=Defi. kodposition 3] }
    { 23  ;   ;Defi Code Position 4;Code1         ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Defi Code Position 4;
                                                              NOR=Defi-kodeposisjon 4;
                                                              SVE=Defi. kodposition 4] }
    { 24  ;   ;Defi Code Position 5;Code1         ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Defi Code Position 5;
                                                              NOR=Defi-kodeposisjon 5;
                                                              SVE=Defi. kodposition 5] }
    { 25  ;   ;Defi Code Position 6;Code1         ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Defi Code Position 6;
                                                              NOR=Defi-kodeposisjon 6;
                                                              SVE=Defi. kodposition 6] }
    { 30  ;   ;Construction Spec. Line No.;Code2  ;OnValidate=BEGIN
                                                                UpdateCommitment;
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Construction Spec. Line No.;
                                                              NOR=Radnr for konstruksjonsspesifikasjon;
                                                              SVE=Konstruktionsspec. Radnr] }
    { 40  ;   ;Comments            ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Comment Line RAW" WHERE (Table No.=CONST(11125679),
                                                                                               Part Group=CONST(),
                                                                                               Activity=CONST(),
                                                                                               Estimate No.=FIELD(Estimate No.),
                                                                                               Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                               Tender Paragraph Line=FIELD(Line No.),
                                                                                               Estimate Line No.=CONST(0)));
                                                   CaptionML=[ENU=Comments;
                                                              NOR=Merknader;
                                                              SVE=Kommentarer];
                                                   BlankZero=Yes;
                                                   Description=Number of Comment Lines;
                                                   Editable=No }
    { 55  ;   ;Activity            ;Code6         ;TableRelation="Constr. Spec. Activity RAW".Activity;
                                                   OnValidate=VAR
                                                                EstimateGroup@1100525000 : Record 11012157;
                                                                EstimateLineRAW@1100525001 : Record 11125698;
                                                                ConstrSpecActivityRAW@1100525002 : Record 11125682;
                                                                PrevActivity@1100529400 : Code[20];
                                                              BEGIN
                                                                //db, 29-03-16: skip relation with recipegroup; use new table relation
                                                                IF EstimateGroup.GET(Activity, EstimateGroup.Type::Recipe) THEN BEGIN
                                                                  Text := EstimateGroup.Description;
                                                                  "External Unit of Measure Code" := EstimateGroup."External UOM Code (RAW)";
                                                                  "Internal Unit of Measure Code" := EstimateGroup."Internal UOM Code (RAW)";
                                                                  "Units Inherited from Activity" :=
                                                                    (EstimateGroup."External UOM Code (RAW)" <> '') AND
                                                                    (EstimateGroup."Internal UOM Code (RAW)" <> '')
                                                                END;

                                                                Estimate.GET("Estimate No.");
                                                                IF ConstrSpecActivityRAW.GET(Estimate."Part Group", Activity) THEN BEGIN
                                                                  Text := ConstrSpecActivityRAW.Description;
                                                                END;

                                                                PrevActivity := xRec.Activity;
                                                                IF "Tender Paragraph No."<> xRec."Tender Paragraph No." THEN
                                                                  PrevActivity := '';
                                                                CopyActivityCommentRAW(PrevActivity, Activity, FALSE, '');  //DP01086.n
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupActivity;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Activity;
                                                              NOR=Aktivitet;
                                                              SVE=Aktivitet] }
    { 57  ;   ;Commitment          ;Boolean       ;OnValidate=BEGIN
                                                                UpdateType;
                                                              END;

                                                   CaptionML=[ENU=Commitment;
                                                              NOR=Forpliktelse;
                                                              SVE=ètagande] }
    { 60  ;   ;Text                ;Text50        ;CaptionML=[ENU=Text;
                                                              NOR=Text;
                                                              SVE=BenÑmning] }
    { 65  ;   ;Title               ;Boolean       ;CaptionML=[ENU=Title;
                                                              NOR=Tittel;
                                                              SVE=Titel] }
    { 67  ;   ;Indentation         ;Integer       ;CaptionML=[ENU=Indentation;
                                                              NOR=Innrykking;
                                                              SVE=Indrag];
                                                   Editable=No }
    { 70  ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                "Calculated Amount" := Quantity * "Calculated Unit Price";
                                                                EvaluateQuantityObligation(FIELDNO(Quantity)); //C052643

                                                                IF "Construction Spec. Line No." = '00' THEN
                                                                  UpdatePartQuantity;  //C056424
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 75  ;   ;Actual Quantity     ;Decimal       ;CaptionML=[ENU=Actual Quantity;
                                                              NOR=Faktisk antall;
                                                              SVE=Verkligt antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 80  ;   ;External Unit of Measure Code;Code4;TableRelation="Estimate Unit Mapping RAW";
                                                   OnValidate=VAR
                                                                EstimateRAWUnitMapping@1100525000 : Record 11125675;
                                                              BEGIN
                                                                IF NOT EstimateRAWUnitMapping.GET("External Unit of Measure Code") THEN
                                                                  EstimateRAWUnitMapping.INIT;

                                                                "Internal Unit of Measure Code" := EstimateRAWUnitMapping."Internal Unit of Measure Code";
                                                                EvaluateQuantityObligation(FIELDNO("Internal Unit of Measure Code")); //C052643
                                                              END;

                                                   CaptionML=[ENU=External Unit of Measure Code;
                                                              NOR=Ekstern mÜleenhetskode;
                                                              SVE=Extern enhet fîr mÑtkod] }
    { 81  ;   ;Internal Unit of Measure Code;Code10;
                                                   TableRelation="Unit of Measure";
                                                   OnValidate=VAR
                                                                EstimateRAWUnitMapping@1100525000 : Record 11125675;
                                                              BEGIN
                                                                "External Unit of Measure Code" := '';

                                                                IF "Internal Unit of Measure Code" <> '' THEN BEGIN
                                                                  EstimateRAWUnitMapping.SETCURRENTKEY("Internal Unit of Measure Code");
                                                                  EstimateRAWUnitMapping.SETRANGE("Internal Unit of Measure Code", "Internal Unit of Measure Code");
                                                                  EstimateRAWUnitMapping.FINDFIRST; // crash & burn if mapping not found

                                                                  IF EstimateRAWUnitMapping.COUNT > 1 THEN
                                                                    IF PAGE.RUNMODAL(0, EstimateRAWUnitMapping) <> ACTION::LookupOK THEN
                                                                      ERROR('');

                                                                  "External Unit of Measure Code" := EstimateRAWUnitMapping."External Unit of Measure Code";
                                                                END;

                                                                EvaluateQuantityObligation(FIELDNO("Internal Unit of Measure Code")); //C052643
                                                              END;

                                                   CaptionML=[ENU=Internal Unit of Measure Code;
                                                              NOR=Intern mÜleenhetskode;
                                                              SVE=Intern enhet fîr mÑtkod] }
    { 82  ;   ;Units Inherited from Activity;Boolean;
                                                   CaptionML=[ENU=Units Inherited from Activity;
                                                              NOR=Enheter arvet fra aktivitet;
                                                              SVE=Enheter Ñrvda frÜn aktivitet];
                                                   Editable=No }
    { 90  ;   ;Quantity Type       ;Option        ;CaptionML=[ENU=Quantity Type;
                                                              NOR=Antallstype;
                                                              SVE=Antal typ];
                                                   OptionCaptionML=[ENU=" ,V,N,M,O,A,L,T,I,F";
                                                                    NOR=" ,V,N,M,O,A,L,T,I,F";
                                                                    SVE=" ,V,N,M,O,A,L,T,I,F"];
                                                   OptionString=[ ,V,N,M,O,A,L,T,I,F] }
    { 100 ;   ;Calculated Amount   ;Decimal       ;OnValidate=BEGIN
                                                                "Calculated Unit Price" := SafeDivision("Calculated Amount", Quantity);

                                                                IF IsEuroParagraph THEN BEGIN
                                                                  Quantity := "Calculated Amount";
                                                                  "Actual Quantity" := "Actual Amount";
                                                                  "Calculated Unit Price" := 1;
                                                                  "Actual Unit Price" := 1;

                                                                  IF ("Construction Spec. Line No." = '00') AND (SkipUpdateLines = FALSE) THEN //DP02340
                                                                    UpdatePartQuantity;  //C056424
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Calculated Amount;
                                                              NOR=Estimert belõp;
                                                              SVE=BerÑknat belopp];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 110 ;   ;Calculated Unit Price;Decimal      ;CaptionML=[ENU=Calculated Unit Price;
                                                              NOR=Estimert enhetspris;
                                                              SVE=BerÑknat enhetspris];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 120 ;   ;Actual Unit Price   ;Decimal       ;OnValidate=BEGIN
                                                                "Actual Unit Price" := ROUND("Actual Unit Price");
                                                                VALIDATE("Actual Amount", "Actual Unit Price" * Quantity);
                                                              END;

                                                   CaptionML=[ENU=Actual Unit Price;
                                                              NOR=Faktisk enhetspris;
                                                              SVE=Faktiskt ennhetspris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 130 ;   ;Actual Amount       ;Decimal       ;OnValidate=VAR
                                                                OldSkipValidateActualAmount@1100525000 : Boolean;
                                                              BEGIN
                                                                IF CurrFieldNo = FIELDNO("Actual Amount") THEN
                                                                  IF IsProvisionalSum("Tender Paragraph No.") THEN
                                                                    RecalculateEstimateRAW.CheckProvisionalSum("Estimate No.", "Tender Paragraph No.","Actual Amount");  //C056424

                                                                CASE IsEuroParagraph OF
                                                                  FALSE:
                                                                    BEGIN
                                                                      "Actual Quantity" := Quantity;
                                                                      "Actual Unit Price" := ROUND(SafeDivision("Actual Amount", "Actual Quantity"));
                                                                    END;
                                                                  TRUE:
                                                                    BEGIN
                                                                      "Actual Unit Price" := 1;
                                                                      "Actual Quantity" := ROUND(SafeDivision("Actual Amount", "Actual Unit Price"));
                                                                    END;
                                                                END;

                                                                IF (SkipUpdateLines = FALSE) THEN BEGIN  //DP02340
                                                                  OldSkipValidateActualAmount := SkipValidateActualAmount;
                                                                  SkipValidateActualAmount := TRUE;
                                                                  VALIDATE("Total Surcharge Amount", "Actual Amount" - "Calculated Amount");
                                                                  SkipValidateActualAmount := OldSkipValidateActualAmount;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Actual Amount;
                                                              NOR=Faktisk belõp;
                                                              SVE=Faktiskt belopp];
                                                   BlankZero=Yes;
                                                   AutoFormatType=1 }
    { 140 ;   ;Lock Actual Amount for Updates;Boolean;
                                                   OnValidate=VAR
                                                                EstimateParagraphRAW@1100525000 : Record 11125679;
                                                              BEGIN
                                                                IF "Lock Actual Amount for Updates" THEN
                                                                  TESTFIELD(Type, Type::"Commitment (Main Line)");

                                                                EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.");
                                                                EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                                                                //EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", '%1..%2', COPYSTR("Tender Paragraph No.",1,5)+'1', COPYSTR("Tender Paragraph No.",1,5)+'9'); //C026972.o
                                                                EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", COPYSTR("Tender Paragraph No.",1,5)+'1', GetMaxSubParagraphNo("Estimate No.","Tender Paragraph No.")); //C026972.n

                                                                IF EstimateParagraphRAW.FINDSET THEN
                                                                  REPEAT
                                                                    EstimateParagraphRAW."Lock Actual Amount for Updates" := "Lock Actual Amount for Updates";
                                                                    EstimateParagraphRAW.UpdateSurcharge;
                                                                    EstimateParagraphRAW.MODIFY;
                                                                  UNTIL EstimateParagraphRAW.NEXT = 0;

                                                                UpdateSurcharge;
                                                              END;

                                                   CaptionML=[ENU=Lock Actual Amount for Updates;
                                                              NOR=LÜs faktisk belõp for oppdateringer;
                                                              SVE=LÜs faktiskt bel. fîr uppd.] }
    { 150 ;   ;Information Notice  ;Boolean       ;CaptionML=[ENU=Information Notice;
                                                              NOR=Informasjonsmelding;
                                                              SVE=Information meddelande] }
    { 160 ;   ;Destination Paragraph No.;Text6    ;CaptionML=[ENU=Destination Paragraph No.;
                                                              NOR=Mottakerelementnr;
                                                              SVE=Dest. Elwmwntnr];
                                                   Description=May only be used in Temporary table/record, used for copy elements }
    { 200 ;   ;Recipe No. OLD      ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Activity));
                                                   CaptionML=[ENU=Recipe No. (OLD);
                                                              NOR=Malnr;
                                                              SVE=Mallnr];
                                                   Description=DP01676: expired }
    { 210 ;   ;Estimate Line Amount;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Tender Paragraph No.=FIELD(Tender Paragraph No.)));
                                                   CaptionML=[ENU=Estimate Line Amount;
                                                              NOR=Estimert belõp;
                                                              SVE=Kalkylrad belopp];
                                                   Editable=No }
    { 220 ;   ;Base Element        ;Code20        ;TableRelation="Base Element";
                                                   OnValidate=VAR
                                                                BaseElement@1100525000 : Record 11012060;
                                                                FormatMgt@1100525001 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatMgt.FormatElem("Base Element",2,'');
                                                                IF "Base Element" <> '' THEN
                                                                  BaseElement.GET("Base Element");

                                                                UpdateProjElem(1);
                                                              END;

                                                   OnLookup=VAR
                                                              BaseElement@1100525000 : Record 11012060;
                                                            BEGIN
                                                              BaseElement.Code := "Base Element";
                                                              IF PAGE.RUNMODAL(PAGE::Elements, BaseElement) = ACTION::LookupOK THEN
                                                                VALIDATE("Base Element", BaseElement.Code);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Base Element;
                                                              NOR=Grunnelement;
                                                              SVE=Baselement];
                                                   Description=C040309 }
    { 230 ;   ;Quantity (Result Obligation);Decimal;
                                                   OnValidate=BEGIN
                                                                UpdateResultObligation(FIELDNO("Quantity (Result Obligation)"));  //DP01676
                                                              END;

                                                   CaptionML=ENU=Quantity  (Result Obligation);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01676 }
    { 235 ;   ;Unit of Measure (Obligation);Code10;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                UpdateResultObligation(FIELDNO("Unit of Measure (Obligation)"));  //DP01676
                                                              END;

                                                   CaptionML=ENU=Unit of Measure (Result Obligation);
                                                   Description=DP01676 }
    { 240 ;   ;Production Rate     ;Decimal       ;OnValidate=BEGIN
                                                                UpdateProductionRateEstimateLine;  //DP02243
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Production Rate;
                                                              SVE=Produktionstakt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP02243 }
    { 300 ;   ;Calculated Amount Labor;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                 Cost Type=CONST(Labor)));
                                                   CaptionML=[ENU=Calculated Amount Labor;
                                                              NOR=Estimert belõp, arbeidskraft;
                                                              SVE=BerÑknat belopp, arbetskraft];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 301 ;   ;Calculated Amount Material;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                    Cost Type=CONST(Material)));
                                                   CaptionML=[ENU=Calculated Amount Material;
                                                              NOR=Estimert belõp, materiale;
                                                              SVE=BerÑknat belopp, material];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 302 ;   ;Calculated Amount Subcontr.;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                          Cost Type=CONST(Subcontracting)));
                                                   CaptionML=[ENU=Calculated Amount Subcontr.;
                                                              NOR=Estimert belõp, underentrepenõr;
                                                              SVE=BerÑknat belopp, underent.];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 303 ;   ;Calculated Amount Plant;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                 Cost Type=CONST(Plant)));
                                                   CaptionML=[ENU=Calculated Amount Plant;
                                                              NOR=Estimert belõp, maskin;
                                                              SVE=BerÑknat belopp, maskin];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 304 ;   ;Calculated Amount Sundry;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Sundry" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                  Cost Type=CONST(Sundry)));
                                                   CaptionML=ENU=Calculated Amount Sundry;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   Editable=No }
    { 305 ;   ;Calculated Hours    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                 Cost Type=CONST(Labor)));
                                                   CaptionML=ENU=Calculated Hours;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   Editable=No }
    { 360 ;   ;Excel Estimate Template;Text50     ;OnValidate=BEGIN
                                                                //DP01561
                                                                IF ExcelFileExists THEN EXIT;

                                                                IF (xRec."Excel Estimate Template" <> Rec."Excel Estimate Template") AND ExcelFileExists THEN
                                                                  IF CONFIRM(Text005,TRUE,FIELDCAPTION("Excel Estimate Template")) THEN
                                                                    FileMgt.DeleteClientFile4PS(ExcelEstimateMgt.GetPathFileNameRAW(Rec), TRUE)
                                                                  ELSE
                                                                    ERROR(Text006,FIELDCAPTION("Excel Estimate Template"));

                                                                IF CheckValidExcelTemplate(TRUE) THEN;
                                                              END;

                                                   OnLookup=VAR
                                                              EstimateSetup@1100528904 : Record 11012150;
                                                              ExcelTemplate@1100528902 : Text[250];
                                                              DirectoryName@1100528901 : Text;
                                                              FileAbsPathName@1100528900 : Text;
                                                            BEGIN
                                                              //DP01561
                                                              EstimateSetup.GET;
                                                              DirectoryName := EstimateSetup."Pathname Excel Est. Template";
                                                              IF FileMgt.SelectFile('xlt', DirectoryName, ExcelTemplate, FileAbsPathName) THEN
                                                                VALIDATE("Excel Estimate Template",ExcelTemplate);
                                                            END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Excel Estimate Template;
                                                              SVE=Excel-kalkylmall];
                                                   Description=DP01561 }
    { 370 ;   ;Updated form Excel  ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Updated form Excel;
                                                              SVE=Excel-formulÑret har uppdaterats];
                                                   Description=DP01561;
                                                   Editable=No }
    { 380 ;   ;Calculate Summary Cost;Boolean     ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Calculate Summary Cost;
                                                   Description=DP02340 }
    { 700 ;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Labor"), "Surcharge % Labor");
                                                                UpdateSurcharge;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Labor;
                                                              NOR=Tilleggsgebyrsprosent, arbeidskraft;
                                                              SVE=TillÑggsavgiftsprocent, arbetskraft];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 701 ;   ;Surcharge % Material;Decimal       ;OnValidate=BEGIN
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Material"), "Surcharge % Material");
                                                                UpdateSurcharge;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Material;
                                                              NOR=Tilleggsgebyrsprosent, Materiale;
                                                              SVE=TillÑggsavgiftsprocent, material];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 702 ;   ;Surcharge % Subcontracting;Decimal ;OnValidate=BEGIN
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Subcontracting"), "Surcharge % Subcontracting");
                                                                UpdateSurcharge;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Subcontracting;
                                                              NOR=Tilleggsgebyrsprosent, underentrepenõr;
                                                              SVE=TillÑggsavgiftsprocent, underentreprenad];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 703 ;   ;Surcharge % Plant   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Plant"), "Surcharge % Plant");
                                                                UpdateSurcharge;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Plant;
                                                              NOR=Tilleggsgebyrsprosent, maskin;
                                                              SVE=TillÑggsavgiftsprocent, Maskin];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 1400;   ;Surcharge Amount Labor;Decimal     ;OnValidate=BEGIN
                                                                UpdateSurchargePct;
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Labor"), "Surcharge % Labor");
                                                              END;

                                                   CaptionML=[ENU=Surcharge Amount Labor;
                                                              NOR=Tilleggsgebyr, arbeidskraft;
                                                              SVE=TillÑggsbelopp, arbetskraft];
                                                   BlankZero=Yes }
    { 1401;   ;Surcharge Amount Material;Decimal  ;OnValidate=BEGIN
                                                                UpdateSurchargePct;
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Material"), "Surcharge % Material");
                                                              END;

                                                   CaptionML=[ENU=Surcharge Amount Material;
                                                              NOR=Tilleggsgebyr, Materiale;
                                                              SVE=TillÑggsbelopp, material];
                                                   BlankZero=Yes }
    { 1402;   ;Surcharge Amount Subcontr.;Decimal ;OnValidate=BEGIN
                                                                UpdateSurchargePct;
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Subcontracting"), "Surcharge % Subcontracting");
                                                              END;

                                                   CaptionML=[ENU=Surcharge Amount Subcontr.;
                                                              NOR=Tilleggsgebyr, Underentreprenõr;
                                                              SVE=TillÑggsbelopp, underentreprenîr];
                                                   BlankZero=Yes }
    { 1403;   ;Surcharge Amount Plant;Decimal     ;OnValidate=BEGIN
                                                                UpdateSurchargePct;
                                                                UpdateEstimateLineSurchargePct(FIELDNO("Surcharge % Plant"), "Surcharge % Plant");
                                                              END;

                                                   CaptionML=[ENU=Surcharge Amount Plant;
                                                              NOR=Tilleggsgebyr, maskin;
                                                              SVE=TillÑggsbelopp, Maskin];
                                                   BlankZero=Yes }
    { 1410;   ;Total Surcharge Amount;Decimal     ;OnValidate=VAR
                                                                EstimateParagraphRAW@1100525005 : Record 11125679;
                                                                OldSurcharge@1100525000 : Decimal;
                                                                NewSurcharge@1100525001 : Decimal;
                                                                Ratio@1100525002 : Decimal;
                                                                OldSurchargePct@1100525006 : Decimal;
                                                                NewSurchargePct@1100525007 : Decimal;
                                                                Delta@1100525008 : Decimal;
                                                                IsMainParagraph@1100525003 : Boolean;
                                                                HasSubParagraph@1100525004 : Boolean;
                                                              BEGIN
                                                                IsMainParagraph := COPYSTR("Tender Paragraph No.", 6, 1) = '0';

                                                                IF IsMainParagraph THEN BEGIN
                                                                  EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
                                                                  //EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", COPYSTR("Tender Paragraph No.", 1, 5) + '1', COPYSTR("Tender Paragraph No.", 1, 5) + '9'); //C026972.o
                                                                  EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", COPYSTR("Tender Paragraph No.",1,5)+'1', GetMaxSubParagraphNo("Estimate No.","Tender Paragraph No.")); //C026972.n
                                                                  EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
                                                                  HasSubParagraph := NOT EstimateParagraphRAW.ISEMPTY;
                                                                END;

                                                                EstimateParagraphRAW.SetSkipUpdateLogBook(SkipUpdateLogBook);

                                                                CASE (IsMainParagraph AND HasSubParagraph) OF
                                                                  TRUE:
                                                                    BEGIN
                                                                      IF "Calculated Amount" <> 0 THEN BEGIN
                                                                        OldSurchargePct := (xRec."Total Surcharge Amount" / "Calculated Amount") * 100;
                                                                        NewSurchargePct := ("Total Surcharge Amount" / "Calculated Amount") * 100;
                                                                        Delta := NewSurchargePct - OldSurchargePct;
                                                                        IF Delta <> 0 THEN BEGIN //call 23956
                                                                          EstimateParagraphRAW.FINDSET(TRUE, FALSE);
                                                                          REPEAT
                                                                            EstimateParagraphRAW.VALIDATE("Surcharge % Labor", EstimateParagraphRAW."Surcharge % Labor" + Delta);
                                                                            EstimateParagraphRAW.VALIDATE("Surcharge % Material", EstimateParagraphRAW."Surcharge % Material" + Delta);
                                                                            EstimateParagraphRAW.VALIDATE("Surcharge % Subcontracting", EstimateParagraphRAW."Surcharge % Subcontracting" + Delta);
                                                                            EstimateParagraphRAW.VALIDATE("Surcharge % Plant", EstimateParagraphRAW."Surcharge % Plant" + Delta);
                                                                            EstimateParagraphRAW.MODIFY;
                                                                          UNTIL EstimateParagraphRAW.NEXT = 0;
                                                                        END; //call 23956
                                                                      END;
                                                                    END;
                                                                  FALSE:
                                                                    BEGIN
                                                                      OldSurcharge :=
                                                                        "Surcharge Amount Labor" +
                                                                        "Surcharge Amount Material" +
                                                                        "Surcharge Amount Subcontr." +
                                                                        "Surcharge Amount Plant";
                                                                      NewSurcharge := "Total Surcharge Amount";

                                                                      IF OldSurcharge <> NewSurcharge THEN BEGIN //DP00433
                                                                        CASE (OldSurcharge = 0) OF
                                                                          FALSE:
                                                                            BEGIN
                                                                              Ratio := ROUND(SafeDivision(NewSurcharge, OldSurcharge),0.00001);//DP00433
                                                                              IF Ratio <> 1 THEN BEGIN //call 23956
                                                                                VALIDATE("Surcharge Amount Labor", Ratio * "Surcharge Amount Labor");
                                                                                VALIDATE("Surcharge Amount Material", Ratio * "Surcharge Amount Material");
                                                                                VALIDATE("Surcharge Amount Subcontr.", Ratio * "Surcharge Amount Subcontr.");
                                                                                VALIDATE("Surcharge Amount Plant", Ratio * "Surcharge Amount Plant");
                                                                              END; //call 23956
                                                                            END;
                                                                          TRUE:
                                                                            BEGIN
                                                                              NewSurcharge := "Total Surcharge Amount";
                                                                              CALCFIELDS(
                                                                                "Calculated Amount Labor",
                                                                                "Calculated Amount Material",
                                                                                "Calculated Amount Subcontr.",
                                                                                "Calculated Amount Plant");
                                                                              VALIDATE("Surcharge Amount Labor",
                                                                                NewSurcharge * SafeDivision("Calculated Amount Labor", "Calculated Amount"));
                                                                              VALIDATE("Surcharge Amount Material",
                                                                                NewSurcharge * SafeDivision("Calculated Amount Material", "Calculated Amount"));
                                                                              VALIDATE("Surcharge Amount Subcontr.",
                                                                                NewSurcharge * SafeDivision("Calculated Amount Subcontr.", "Calculated Amount"));
                                                                              VALIDATE("Surcharge Amount Plant",
                                                                                NewSurcharge * SafeDivision("Calculated Amount Plant", "Calculated Amount"));
                                                                            END;
                                                                        END;
                                                                      END;
                                                                    END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Total Surcharge Amount;
                                                              NOR=Tilleggsgebyr Totalt;
                                                              SVE=TillÑggsbelopp totalt];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1500;   ;Surchrg. Amt. Labor (Calc.);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Surcharge Amount Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                       Cost Type=CONST(Labor)));
                                                   CaptionML=[ENU=Surcharge Amount Labor (Calc.);
                                                              NOR=Tilleggsgebyr for arbeidskraft (estimert);
                                                              SVE=TillÑggsbel, arb.kraft(berÑkn)];
                                                   Editable=No }
    { 1501;   ;Surchrg. Amt. Material (Calc.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Surcharge Amount Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                          Cost Type=CONST(Material)));
                                                   CaptionML=[ENU=Surchrg. Amt. Material (Calc.);
                                                              NOR=Tilleggsgebyr for materiale (estimert);
                                                              SVE=TillÑggsavg. Bel. Material (berÑkn.)];
                                                   Editable=No }
    { 1502;   ;Surchrg. Amt. Subcntr. (Calc.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Surcharge Amount Subcontr." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                           Cost Type=CONST(Subcontracting)));
                                                   CaptionML=[ENU=Surchrg. Amt. Subcntr. (Calc.);
                                                              NOR=Tilleggsgebyr for underentrepenõr (estimert);
                                                              SVE=TillÑggsavg. Bel. Legotillv. (BerÑkn.)];
                                                   Editable=No }
    { 1503;   ;Surchrg. Amt. Plant (Calc.);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line RAW"."Surcharge Amount Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Tender Paragraph No.=FIELD(Tender Paragraph No.),
                                                                                                                       Cost Type=CONST(Plant)));
                                                   CaptionML=[ENU=Surcharge Amount Plant (Calc.);
                                                              NOR=Tilleggsgebyr for maskin (estimert);
                                                              SVE=TillÑggsbelopp, maskin (berÑkn.)];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Estimate No.,Tender Paragraph No.,Line No.;
                                                   SumIndexFields=Calculated Amount,Actual Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Estimate No.,Construction Spec. Line No. }
    {    ;Estimate No.,Type,Construction Spec. Line No.;
                                                   SumIndexFields=Actual Amount,Calculated Amount }
    {    ;Estimate No.,Tender Paragraph No.,Indentation;
                                                   SumIndexFields=Calculated Amount }
    {    ;Estimate No.,Tender Paragraph No.,Construction Spec. Line No.;
                                                   SumIndexFields=Actual Amount,Calculated Amount }
    {    ;Status Code                              }
    {    ;Estimate No.,Lock Actual Amount for Updates }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Estimate@1100525000 : Record 11012151;
      Text000@1100525001 : TextConst 'ENU=%1 %2 already exists in %3 %4.;NOR=%1 %2 finnes allerede i %3 %4.;SVE=%1 %2 finns redan i %3 %4.';
      SkipValidateActualAmount@1100525006 : Boolean;
      SkipUpdateLogBook@1100525003 : Boolean;
      Text002@1100525004 : TextConst 'ENU=Commitment %1 does not exist yet. Please create the commitment element first.;NOR=Forpliktelse %1 finnes ikke enda. Venligst opprett forpliktelseselementet fõrst.;SVE=ètagande %1 finns inte Ñn. VÑnligen skapa Ütagandeelementet fîrst.';
      SkipUpdateLines@1100528905 : Boolean;
      FileMgt@1100528900 : Codeunit 419;
      Text005@1100528902 : TextConst 'ENU=The existing Excelfile doesn''t match %1 anymore, remove Excelfile is removed.;SVE=Den befintliga Excel-filen stÑmmer inte îverens med %1 lÑngre, Excel-filen har tagits bort.';
      Text006@1100528901 : TextConst 'ENU=%1 is not changed.;SVE=%1 har inte Ñndrats.';
      ExcelEstimateMgt@1100528903 : Codeunit 11012231;
      Text007@1100528904 : TextConst 'ENU=%1 %2 doesn''t exist.;SVE=%1 %2 finns inte.';
      RecalculateEstimateRAW@1100528906 : Codeunit 11125669;
      SwitchUnitObligation@1100528907 : Boolean;

    PROCEDURE CombineDefiCodes@1100525009(VAR Result@1100525001 : ARRAY [6] OF Code[1]);
    VAR
      EstimateParagraphRAW@1100525000 : Record 11125679;
    BEGIN
      IF "Construction Spec. Line No." = '00' THEN BEGIN
        CLEAR(Result);

        EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateParagraphRAW.SETFILTER("Construction Spec. Line No.", '<>%1', '00');

        IF EstimateParagraphRAW.FINDSET THEN
          REPEAT
            IF EstimateParagraphRAW."Defi Code Position 1" <> '' THEN
              Result[1] := EstimateParagraphRAW."Defi Code Position 1";
            IF EstimateParagraphRAW."Defi Code Position 2" <> '' THEN
              Result[2] := EstimateParagraphRAW."Defi Code Position 2";
            IF EstimateParagraphRAW."Defi Code Position 3" <> '' THEN
              Result[3] := EstimateParagraphRAW."Defi Code Position 3";
            IF EstimateParagraphRAW."Defi Code Position 4" <> '' THEN
              Result[4] := EstimateParagraphRAW."Defi Code Position 4";
            IF EstimateParagraphRAW."Defi Code Position 5" <> '' THEN
              Result[5] := EstimateParagraphRAW."Defi Code Position 5";
            IF EstimateParagraphRAW."Defi Code Position 6" <> '' THEN
              Result[6] := EstimateParagraphRAW."Defi Code Position 6";
          UNTIL EstimateParagraphRAW.NEXT = 0;
      END;
    END;

    PROCEDURE HasConditions@1100525002() : Boolean;
    VAR
      ConstrSpecCondLineRAW@1100525000 : Record 11125671;
    BEGIN
      IF Activity = '' THEN
        EXIT(FALSE);

      IF Estimate."No." <> "Estimate No." THEN
        IF NOT Estimate.GET("Estimate No.") THEN
          EXIT(FALSE);

      IF Estimate."Construction Spec. No." = '' THEN
        EXIT(FALSE);

      ConstrSpecCondLineRAW.SETCURRENTKEY("Specification No.", "Chapter No.");
      ConstrSpecCondLineRAW.SETRANGE("Specification No.", Estimate."Construction Spec. No.");
      ConstrSpecCondLineRAW.SETRANGE("Chapter No.", COPYSTR(Activity, 1, 2));

      EXIT(NOT ConstrSpecCondLineRAW.ISEMPTY);
    END;

    PROCEDURE ShowConditions@1100525001();
    VAR
      EstimateRAW@1100525000 : Record 11012151;
      ConstrSpecCondLineRAW@1100525001 : Record 11125671;
    BEGIN
      IF Activity <> '' THEN
        IF Estimate.GET("Estimate No.") THEN
          IF Estimate."Construction Spec. No." <> '' THEN BEGIN
            ConstrSpecCondLineRAW.SETCURRENTKEY("Specification No.", "Chapter No.");
            ConstrSpecCondLineRAW.SETRANGE("Specification No.", Estimate."Construction Spec. No.");
            ConstrSpecCondLineRAW.SETRANGE("Chapter No.", COPYSTR(Activity, 1, 2));
            IF NOT ConstrSpecCondLineRAW.ISEMPTY THEN
              PAGE.RUN(0, ConstrSpecCondLineRAW);
          END;
    END;

    PROCEDURE RecipeNoAssistEdit@1100525000();
    VAR
      EstimateRAWRecipeSel@1100525000 : Record 11125674;
    BEGIN
      IF Activity <> '' THEN BEGIN
        EstimateRAWRecipeSel.SETRANGE("Recipe Group No.", Activity);
        PAGE.RUN(0, EstimateRAWRecipeSel);
      END;
    END;

    PROCEDURE SafeDivision@1100525004(Numerator@1100525000 : Decimal;Denominator@1100525001 : Decimal) : Decimal;
    BEGIN
      IF Denominator = 0 THEN
        EXIT(0);
      EXIT(Numerator / Denominator);
    END;

    PROCEDURE AreDefiCodesBlank@1100525008() : Boolean;
    BEGIN
      EXIT(
        ("Defi Code Position 1" = '') AND
        ("Defi Code Position 2" = '') AND
        ("Defi Code Position 3" = '') AND
        ("Defi Code Position 4" = '') AND
        ("Defi Code Position 5" = '') AND
        ("Defi Code Position 6" = ''));
    END;

    PROCEDURE UpdateIndentation@1100525003();
    BEGIN
      CASE STRLEN("Tender Paragraph No.") = 6 OF
        TRUE: Indentation := 4;
        FALSE: Indentation := STRLEN("Tender Paragraph No.") - 1;
      END;
    END;

    PROCEDURE UpdateCommitment@1100525007();
    BEGIN
      Commitment := FALSE;

      IF AreDefiCodesBlank THEN
        IF ("Construction Spec. Line No." IN ['00', '01']) THEN
          IF STRLEN("Tender Paragraph No.") = 6 THEN
             IF COPYSTR("Tender Paragraph No.", STRLEN("Tender Paragraph No.")) = '0' THEN
               Commitment := TRUE;
    END;

    PROCEDURE UpdateType@1100525005();
    BEGIN
      CASE TRUE OF
        STRLEN("Tender Paragraph No.") = 1:
          Type := Type::Chapter;
        STRLEN("Tender Paragraph No.") = 2:
          Type := Type::Paragraph;
        STRLEN("Tender Paragraph No.") = 3:
          Type := Type::Subparagraph;
        STRLEN("Tender Paragraph No.") = 4:
          Type := Type::Subsubparagraph;
        STRLEN("Tender Paragraph No.") <> 6:
          Type := Type::" ";
        (Commitment) AND ("Construction Spec. Line No." IN ['00', '01']):
          Type := Type::"Commitment (Main Line)";
        Commitment:
          Type := Type::"Commitment (Sub Line)";
        (NOT Commitment) AND ("Construction Spec. Line No." IN ['00', '01']):
          Type := Type::"Commitment Description (Main Line)";
        NOT Commitment:
          Type := Type::"Commitment Description (Sub Line)";
      END;
    END;

    PROCEDURE IsEuroParagraph@1100525010() : Boolean;
    BEGIN
      EXIT("External Unit of Measure Code" = 'EUR');
    END;

    PROCEDURE UpdateEstimateLineSurchargePct@1100525011(FieldNo@1100525000 : Integer;NewValue@1100525002 : Decimal);
    VAR
      EstimateLineRAW@1100525001 : Record 11125698;
      LineChanged@1210190000 : Boolean;
      NewAmount@1100529300 : Decimal;
      NewSurchargeAmount@1100529301 : Decimal;
      NewSurchargePct@1100529302 : Decimal;
    BEGIN
      EstimateLineRAW.SetSkipUpdateLogBook(SkipUpdateLogBook);
      EstimateLineRAW.SETCURRENTKEY("Estimate No.", "Summary Line");
      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETRANGE("Summary Line", FALSE);
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          LineChanged := FALSE;
          CASE FieldNo OF
            Rec.FIELDNO("Surcharge % Labor"):
              BEGIN
                CALCFIELDS("Calculated Amount Labor");
                IF ("Calculated Amount Labor" <> 0) AND (EstimateLineRAW."Cumulative Labor" <> 0) THEN BEGIN
                  NewAmount := ("Calculated Amount Labor" + ("Calculated Amount Labor" / 100 * "Surcharge % Labor")) /
                    ("Calculated Amount Labor" + xRec."Surcharge Amount Labor") *
                    (EstimateLineRAW."Cumulative Labor" + EstimateLineRAW."Surcharge Amount Labor");
                  NewSurchargeAmount := NewAmount - EstimateLineRAW."Cumulative Labor";
                  NewSurchargePct := NewSurchargeAmount * 100 / EstimateLineRAW."Cumulative Labor";
                  EstimateLineRAW.VALIDATE("Surcharge % Labor", NewSurchargePct);
                  LineChanged := TRUE;
                END;
              END;
            Rec.FIELDNO("Surcharge % Material"):
              BEGIN
                CALCFIELDS("Calculated Amount Material");
                IF ("Calculated Amount Material" <> 0) AND (EstimateLineRAW."Cumulative Material" <> 0) THEN BEGIN
                  NewAmount := ("Calculated Amount Material" + ("Calculated Amount Material" / 100 * "Surcharge % Material")) /
                    ("Calculated Amount Material" + xRec."Surcharge Amount Material") *
                    (EstimateLineRAW."Cumulative Material" + EstimateLineRAW."Surcharge Amount Material");
                  NewSurchargeAmount := NewAmount - EstimateLineRAW."Cumulative Material";
                  NewSurchargePct := NewSurchargeAmount * 100 / EstimateLineRAW."Cumulative Material";
                  EstimateLineRAW.VALIDATE("Surcharge % Material", NewSurchargePct);
                  LineChanged := TRUE;
                END;
              END;
            Rec.FIELDNO("Surcharge % Subcontracting"):
              BEGIN
                CALCFIELDS("Calculated Amount Subcontr.");
                IF ("Calculated Amount Subcontr." <> 0) AND (EstimateLineRAW."Cumulative Subcontracting" <> 0) THEN BEGIN
                  NewAmount := ("Calculated Amount Subcontr." + ("Calculated Amount Subcontr." / 100 * "Surcharge % Subcontracting")) /
                    ("Calculated Amount Subcontr." + xRec."Surcharge Amount Subcontr.") *
                    (EstimateLineRAW."Cumulative Subcontracting" + EstimateLineRAW."Surcharge Amount Subcontr.");
                  NewSurchargeAmount := NewAmount - EstimateLineRAW."Cumulative Subcontracting";
                  NewSurchargePct := NewSurchargeAmount * 100 / EstimateLineRAW."Cumulative Subcontracting";
                  EstimateLineRAW.VALIDATE("Surcharge % Subcontracting", NewSurchargePct);
                  LineChanged := TRUE;
                END;
              END;
            Rec.FIELDNO("Surcharge % Plant"):
              BEGIN
                CALCFIELDS("Calculated Amount Plant");
                IF ("Calculated Amount Plant" <> 0) AND (EstimateLineRAW."Cumulative Plant" <> 0) THEN BEGIN
                  NewAmount := ("Calculated Amount Plant" + ("Calculated Amount Plant" / 100 * "Surcharge % Plant")) /
                    ("Calculated Amount Plant" + xRec."Surcharge Amount Plant") *
                    (EstimateLineRAW."Cumulative Plant" + EstimateLineRAW."Surcharge Amount Plant");
                  NewSurchargeAmount := NewAmount - EstimateLineRAW."Cumulative Plant";
                  NewSurchargePct := NewSurchargeAmount * 100 / EstimateLineRAW."Cumulative Plant";
                  EstimateLineRAW.VALIDATE("Surcharge % Plant", NewSurchargePct);
                  LineChanged := TRUE;
                END;
              END;
          END;
          IF LineChanged THEN
            EstimateLineRAW.MODIFY(TRUE);
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateSurcharge@1100525012();
    BEGIN
      IF "Construction Spec. Line No." <> '00' THEN BEGIN
        "Surcharge % Labor" := 0;
        "Surcharge % Material" := 0;
        "Surcharge % Subcontracting" := 0;
        "Surcharge % Plant" := 0;
      END;

      CALCFIELDS("Calculated Amount Labor", "Calculated Amount Material", "Calculated Amount Subcontr.", "Calculated Amount Plant");
      "Surcharge Amount Labor" := "Calculated Amount Labor" * ("Surcharge % Labor" / 100);
      "Surcharge Amount Material" := "Calculated Amount Material" * ("Surcharge % Material" / 100);
      "Surcharge Amount Subcontr." := "Calculated Amount Subcontr." * ("Surcharge % Subcontracting" / 100);
      "Surcharge Amount Plant" := "Calculated Amount Plant" * ("Surcharge % Plant" / 100);

      "Total Surcharge Amount" :=
        "Surcharge Amount Labor" + "Surcharge Amount Material" + "Surcharge Amount Subcontr." + "Surcharge Amount Plant";

      IF NOT SkipValidateActualAmount THEN
        IF NOT "Lock Actual Amount for Updates" THEN
          VALIDATE("Actual Amount", "Calculated Amount" + "Total Surcharge Amount");
    END;

    PROCEDURE UpdateSurchargePct@1100525014();
    BEGIN
      CALCFIELDS("Calculated Amount Labor", "Calculated Amount Material", "Calculated Amount Subcontr.", "Calculated Amount Plant");
      "Surcharge % Labor" := SafeDivision("Surcharge Amount Labor", "Calculated Amount Labor") * 100;
      "Surcharge % Material" := SafeDivision("Surcharge Amount Material", "Calculated Amount Material") * 100;
      "Surcharge % Subcontracting" := SafeDivision("Surcharge Amount Subcontr.", "Calculated Amount Subcontr.") * 100;
      "Surcharge % Plant" := SafeDivision("Surcharge Amount Plant", "Calculated Amount Plant") * 100;

      "Total Surcharge Amount" :=
        "Surcharge Amount Labor" + "Surcharge Amount Material" + "Surcharge Amount Subcontr." + "Surcharge Amount Plant";

      IF NOT SkipValidateActualAmount THEN
        IF NOT "Lock Actual Amount for Updates" THEN
          VALIDATE("Actual Amount", "Calculated Amount" + "Total Surcharge Amount");
    END;

    PROCEDURE SetSkipUpdateLogBook@1100525013(SkipUpdateLogBook2@1100525000 : Boolean);
    BEGIN
      SkipUpdateLogBook := SkipUpdateLogBook2;
    END;

    PROCEDURE GetActivityFrom00@1210190000() : Code[6];
    VAR
      EstimateParagraphRAW@1210190000 : Record 11125679;
    BEGIN
      EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.", "Construction Spec. Line No.");
      EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
      IF EstimateParagraphRAW.FINDFIRST THEN
        EXIT(EstimateParagraphRAW.Activity);
    END;

    PROCEDURE GetEstimateDescription@1100529006(EstNo@1100529001 : Code[20]) : Text[100];
    VAR
      Est@1100529000 : Record 11012151;
    BEGIN
      IF Est.GET(EstNo) THEN
        EXIT(Est.Description);
    END;

    PROCEDURE GetMaxSubParagraphNo@1100529000(EstimateNo@1100529001 : Code[20];MainParagraphNo@1100529002 : Text[6]) MaxParagraphNo : Text[6];
    VAR
      EstimateParagraphRAW@1100529000 : Record 11125679;
    BEGIN
      //C026972
      MaxParagraphNo := COPYSTR(MainParagraphNo, 1, 5) + '9';
      IF COPYSTR(MainParagraphNo, 1, 1) = '9' THEN
        EXIT;

      EstimateParagraphRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.");
      EstimateParagraphRAW.SETRANGE("Estimate No.", EstimateNo);
      EstimateParagraphRAW.FILTERGROUP(9);
      EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", '>%1', MaxParagraphNo);
      EstimateParagraphRAW.FILTERGROUP(0);
      EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", COPYSTR(MainParagraphNo,1,4)+'?0');
      IF EstimateParagraphRAW.FINDFIRST THEN BEGIN
        EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", '<%1', EstimateParagraphRAW."Tender Paragraph No.");
        IF EstimateParagraphRAW.FINDLAST THEN
          MaxParagraphNo := EstimateParagraphRAW."Tender Paragraph No.";
      END ELSE BEGIN
        EstimateParagraphRAW.SETFILTER("Tender Paragraph No.", COPYSTR(MainParagraphNo,1,4)+'??');
        IF EstimateParagraphRAW.FINDLAST THEN
          MaxParagraphNo := EstimateParagraphRAW."Tender Paragraph No.";
      END;
    END;

    PROCEDURE LookupActivity@1100525006();
    VAR
      ConstrSpecActivityRAW@1100525000 : Record 11125682;
      ActivityPage@1100525001 : Page 11125761;
      ActivityEditable@1100525002 : Boolean;
    BEGIN
      ActivityEditable := (STRLEN("Tender Paragraph No.") = 6) AND "Information Notice";
      Estimate.GET("Estimate No.");
      ConstrSpecActivityRAW."Part Group" := Estimate."Part Group";
      ConstrSpecActivityRAW.Activity := Activity;
      ActivityPage.LOOKUPMODE(TRUE);
      ActivityPage.SetSelection(Estimate."Part Group");
      ActivityPage.SETRECORD(ConstrSpecActivityRAW);
      IF ActivityPage.RUNMODAL = ACTION::LookupOK THEN BEGIN
        IF ActivityEditable THEN BEGIN
          ActivityPage.GETRECORD(ConstrSpecActivityRAW);
          VALIDATE(Activity, ConstrSpecActivityRAW.Activity);
        END;
      END;
    END;

    PROCEDURE CopyActivityCommentRAW@1100519001(ActivityOld@1100525002 : Code[10];ActivityNew@1100525001 : Code[10];UsePartGroup@1100525003 : Boolean;PartGroup@1100525004 : Code[10]);
    VAR
      CommentLineRAW@1100525000 : Record 11125684;
    BEGIN
      //DP01086
      IF (ActivityNew = '') OR (ActivityNew = ActivityOld) OR ("Construction Spec. Line No." <> '00') THEN
        EXIT;
      IF UsePartGroup THEN
        Estimate."Part Group" := PartGroup
      ELSE BEGIN
        IF NOT Estimate.GET("Estimate No.") THEN
          EXIT;
      END;
      IF NOT CommentLineRAW.HasActivityComment(Estimate."Part Group", ActivityNew) THEN
        EXIT;
      CommentLineRAW.DeleteEstElemLineComment("Estimate No.", "Tender Paragraph No.", "Line No.");
      CommentLineRAW.CopyComment(
        DATABASE::"Constr. Spec. Activity RAW", Estimate."Part Group", ActivityNew, '', '', 0, 0,
        DATABASE::"Estimate Paragraph RAW", '', '', "Estimate No.", "Tender Paragraph No.", "Line No.", 0);
      CALCFIELDS(Comments);
    END;

    PROCEDURE QuantityDefinedOnConstructionSpec@1100529501() : Boolean;
    VAR
      ConstrSpecElemLineRAW@1100529500 : Record 11125670;
    BEGIN
      //C034000
      IF (STRLEN("Tender Paragraph No.") < 6) THEN EXIT(TRUE);

      Estimate.GET("Estimate No.");
      IF Estimate."Construction Spec. No." = '' THEN EXIT(FALSE);

      ConstrSpecElemLineRAW.SETCURRENTKEY("Specification No.", "Tender Paragraph No.");
      ConstrSpecElemLineRAW.SETRANGE("Specification No.", Estimate."Construction Spec. No.");
      ConstrSpecElemLineRAW.SETRANGE(Type, ConstrSpecElemLineRAW.Type::"Commitment (Main Line)");
      ConstrSpecElemLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      ConstrSpecElemLineRAW.SETFILTER(Quantity, '<>%1', 0);
      IF ConstrSpecElemLineRAW.FINDFIRST THEN
        EXIT(TRUE)
      ELSE
        EXIT(FALSE);
    END;

    PROCEDURE UpdateProjElem@1100525015(lvAction@1100485000 : Integer);
    VAR
      EstimateLineRAW@1100485001 : Record 11125698;
    BEGIN
      IF lvAction <> 1 THEN EXIT;  //C040309

      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETFILTER(Element, '%1|%2', '', xRec."Base Element");
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          EstimateLineRAW.VALIDATE(Element, "Base Element");
          EstimateLineRAW.MODIFY;
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateResultObligation@1100528900(CalledByField@1100528900 : Integer);
    VAR
      EstimateLineRAW@1100485001 : Record 11125698;
      EstimateParagraphRAW@1100528901 : Record 11125679;
    BEGIN
      //DP01676
      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      //EstimateLineRAW.SETRANGE("Apply Obligation", TRUE);  //C060816
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF (EstimateLineRAW."Recipe Type" = EstimateLineRAW."Recipe Type"::"Recipe Header") OR
      //       (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::PlantSet) OR  //db, 17-12-18: evaluate production rate (C051060)
      //       (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::PlantType) OR
             (EstimateLineRAW."Appliance Type" = EstimateLineRAW."Appliance Type"::EstimateRecipe) THEN BEGIN
            EstimateLineRAW.SetCalledByObligation(TRUE);
            IF CalledByField = FIELDNO("Unit of Measure (Obligation)") THEN BEGIN
              IF EstimateLineRAW."Unit of Measure" = xRec."Unit of Measure (Obligation)" THEN
                EstimateLineRAW."Unit of Measure" := "Unit of Measure (Obligation)";
            END;
            IF CalledByField = FIELDNO("Quantity (Result Obligation)") THEN BEGIN
              IF EstimateLineRAW.Quantity = xRec."Quantity (Result Obligation)" THEN
                EstimateLineRAW.VALIDATE(Quantity, "Quantity (Result Obligation)");
            END;
            EstimateLineRAW.MODIFY;
            EstimateLineRAW.SetCalledByObligation(FALSE);
          END ELSE BEGIN
            IF EstimateLineRAW."Attached to Recipe Line" = 0 THEN BEGIN  //C051060
              //C060816.sn
              IF SwitchUnitObligation THEN BEGIN
                EstimateLineRAW."Apply Obligation" := ("Quantity (Result Obligation)" <> 0);
                IF IsEuroParagraph THEN
                  EstimateLineRAW."Ignore Paragraph Quantity" := TRUE
                ELSE
                  EstimateLineRAW."Ignore Paragraph Quantity" := EstimateLineRAW."Apply Obligation";
              END;
              //C060816.en
              IF EstimateLineRAW."Apply Obligation" THEN BEGIN
                IF EstimateLineRAW."Production Rate" <> 0 THEN
                  EstimateLineRAW.VALIDATE(Quantity, "Quantity (Result Obligation)"/ EstimateLineRAW."Production Rate");
                  EstimateLineRAW.MODIFY;
              END ELSE BEGIN
                EstimateLineRAW.UpdateCumulativeQty;  //C060816
                EstimateLineRAW.MODIFY;
              END;
            END;
          END;
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
      //C060445.sn
      IF CalledByField = FIELDNO("Quantity (Result Obligation)") THEN BEGIN
        IF MODIFY THEN;
        //save current record and get result of validate quantity on estimate lines
        EstimateLineRAW.SetCalledByObligation(TRUE);
        EstimateLineRAW.UpdateParagraphTotal;
        EstimateLineRAW.SetCalledByObligation(FALSE);
        //get totals of paragraph (Actual Amount, Surcharge Amount/Percentage) updated by function above
        EstimateParagraphRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateParagraphRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
        EstimateParagraphRAW.SETRANGE("Construction Spec. Line No.", '00');
        IF EstimateParagraphRAW.FINDSET THEN
          Rec := EstimateParagraphRAW;
      END;
      //C060445.en
    END;

    PROCEDURE UpdateProductionRateEstimateLine@1100528901();
    VAR
      EstimateLineRAW@1100485001 : Record 11125698;
    BEGIN
      //DP02243
      IF "Production Rate" = 0 THEN EXIT;

      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      EstimateLineRAW.SETRANGE("Norm Agreement", FALSE);
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF (EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Labor) OR
            ((EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Subcontracting) AND (EstimateLineRAW."Subcontracting in Hours")) OR
            ((EstimateLineRAW."Cost Type" = EstimateLineRAW."Cost Type"::Plant) AND (EstimateLineRAW."Plant Rates in Hours")) THEN
           BEGIN
             EstimateLineRAW.VALIDATE("Production Rate", "Production Rate");
             EstimateLineRAW.MODIFY;
           END;
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    PROCEDURE ExcelFileExists@1100485001() : Boolean;
    BEGIN
      //DP01561
      EXIT(FileMgt.ClientFileExists(ExcelEstimateMgt.GetPathFileNameRAW(Rec)));
    END;

    PROCEDURE CheckValidExcelTemplate@1100485003(iUserInteraction@1100485003 : Boolean) rResult : Boolean;
    BEGIN
      //DP01561
      IF "Excel Estimate Template" = '' THEN
        EXIT(TRUE);

      IF NOT FileMgt.ClientFileExists(ExcelEstimateMgt.GetTemplPathFileRAW(Rec)) THEN
        IF iUserInteraction THEN
          ERROR(Text007,FIELDCAPTION("Excel Estimate Template"),ExcelEstimateMgt.GetTemplPathFileRAW(Rec))
        ELSE
          EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckExcelTemplateFilled@1100485005();
    VAR
      EstSetup@1100485000 : Record 11012150;
      ExcelTemplate@1100525000 : Text[250];
    BEGIN
      //DP01561
      IF "Excel Estimate Template" = '' THEN BEGIN
        EstSetup.GET;
        ExcelTemplate := EstSetup."Excel Estimate Template RAW";
        IF CheckValidExcelTemplate(FALSE) THEN
          VALIDATE("Excel Estimate Template", ExcelTemplate)
        ELSE
          "Excel Estimate Template" := '';
      END;
    END;

    PROCEDURE DeleteExcelFile@1100485006(VAR EstimateParagraphRAW@1100485001 : Record 11125679);
    VAR
      EstimateParagraphRAW2@1210190000 : Record 11125679;
    BEGIN
      //DP01561
      EstimateParagraphRAW2.COPY(EstimateParagraphRAW);
      WITH EstimateParagraphRAW2 DO BEGIN
        IF FINDSET(FALSE, FALSE) THEN BEGIN
          REPEAT
            IF ExcelFileExists THEN
              FileMgt.DeleteClientFile4PS(ExcelEstimateMgt.GetPathFileNameRAW(EstimateParagraphRAW2), TRUE);
          UNTIL NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE EvaluateQuantityObligation@1100528500(CalledByFieldNo@1100528502 : Integer);
    VAR
      EstimateRAWUnitMapping@1100528900 : Record 11125675;
      EstimateRAWUnitMapping2@1100528901 : Record 11125675;
    BEGIN
      //C052643
      IF CalledByFieldNo = FIELDNO(Quantity) THEN
        VALIDATE("Quantity (Result Obligation)", Quantity);
      IF CalledByFieldNo = FIELDNO("Internal Unit of Measure Code") THEN BEGIN
        "Unit of Measure (Obligation)" := "Internal Unit of Measure Code";
        //C060816.sn
        IF NOT EstimateRAWUnitMapping.GET("External Unit of Measure Code") THEN
          EstimateRAWUnitMapping.INIT;
        IF NOT EstimateRAWUnitMapping2.GET(xRec."External Unit of Measure Code") THEN
          EstimateRAWUnitMapping2.INIT;
        SwitchUnitObligation := (EstimateRAWUnitMapping."Ignore Result Obligation" <> EstimateRAWUnitMapping2."Ignore Result Obligation");
        IF EstimateRAWUnitMapping."Ignore Result Obligation" THEN BEGIN
          "Unit of Measure (Obligation)" := '';
          VALIDATE("Quantity (Result Obligation)", 0);
        END ELSE BEGIN
          VALIDATE("Quantity (Result Obligation)", Quantity);
        END;
        SwitchUnitObligation := FALSE;
        //C060816.en
      END;
      MODIFY;
    END;

    PROCEDURE CalculateSummaryCostRequired@1100529400(EstimateNo@1100528902 : Code[20]) UpdateSummaryCost : Boolean;
    VAR
      EstimateParagraphRAW@1100528901 : Record 11125679;
    BEGIN
      //DP02340
      EstimateParagraphRAW.SETRANGE("Estimate No.", EstimateNo);
      EstimateParagraphRAW.SETRANGE("Calculate Summary Cost", TRUE);
      IF EstimateParagraphRAW.FINDFIRST THEN
        UpdateSummaryCost := TRUE;

      EXIT(UpdateSummaryCost);
    END;

    PROCEDURE SetSkipUpdateLines@1100528902(iSkipUpdateLines@1100528900 : Boolean);
    BEGIN
      //DP02340
      SkipUpdateLines := iSkipUpdateLines;
    END;

    PROCEDURE EUR@1100528903() : Code[10];
    BEGIN
      //C056424: In RAW the euro paragraphs have a special meaning. Therefore this code must be checked
      EXIT('EUR');
    END;

    PROCEDURE IsProvisionalSum@1100528906(TenderParagraphNo@1100525000 : Code[20]) : Boolean;
    BEGIN
      //C056424
      IF STRLEN(TenderParagraphNo) <> 6 THEN
        EXIT(FALSE);
      IF COPYSTR(TenderParagraphNo, 1, 2) <> '95' THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE OriginalQuantityConstructionSpec@1100528904() : Decimal;
    VAR
      Estimate@1100528901 : Record 11012151;
      ConstrSpecElemLineRAW@1100528900 : Record 11125670;
    BEGIN
      //C056424
      Estimate.GET("Estimate No.");
      IF Estimate."Construction Spec. No." = '' THEN EXIT(0);

      ConstrSpecElemLineRAW.SETCURRENTKEY("Specification No.", "Tender Paragraph No.");
      ConstrSpecElemLineRAW.SETRANGE("Specification No.", Estimate."Construction Spec. No.");
      ConstrSpecElemLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      IF ConstrSpecElemLineRAW.FINDFIRST THEN
        EXIT(ConstrSpecElemLineRAW.Quantity)
      ELSE
        EXIT(0);
    END;

    LOCAL PROCEDURE UpdatePartQuantity@1100528905();
    VAR
      EstimateLineRAW@1100528900 : Record 11125698;
    BEGIN
      //C056424
      EstimateLineRAW.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLineRAW.SETRANGE("Tender Paragraph No.", "Tender Paragraph No.");
      IF EstimateLineRAW.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          EstimateLineRAW.VALIDATE("Part Quantity", Quantity);
          EstimateLineRAW.MODIFY;
        UNTIL EstimateLineRAW.NEXT = 0;
      END;
    END;

    BEGIN
    END.
  }
}

