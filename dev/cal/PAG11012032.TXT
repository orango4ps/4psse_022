OBJECT Page 11012032 Project Purchase Action
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Project Purchase Action;
               NOR=Prosjektinnkj›pshandling;
               SVE=Projektink”ps†tg„rd];
    SourceTable=Table11012026;
    PageType=Document;
    RefreshOnActivate=Yes;
    PromotedActionCategoriesML=ENU=New,Process,Report,Approval;
    OnInit=BEGIN
             ProjectNoEditable := TRUE;
             AssignButtonEnable := TRUE;
           END;

    OnOpenPage=BEGIN
                 IF (NOT Job.GET("Project No.")) THEN
                   Job.INIT;
                 SetQuoteSubsitePresent;
               END;

    OnAfterGetRecord=BEGIN
                       PurchActVendRec2.RESET;
                       PurchActVendRec2.SETRANGE(Source, PurchActVendRec2.Source::Project);
                       PurchActVendRec2.SETRANGE("Estimate No.", '');
                       PurchActVendRec2.SETRANGE("Project No.","Project No.");
                       PurchActVendRec2.SETRANGE("Purchase Action",Code);
                       Number := 0;
                       IF PurchActVendRec2.FINDSET THEN
                         REPEAT
                           Number := Number + 1;
                         UNTIL PurchActVendRec2.NEXT = 0;

                       QuoteHeadRec2.RESET;
                       QuoteHeadRec2.SETCURRENTKEY("Document Type","Job No.");
                       QuoteHeadRec2.SETRANGE("Document Type",QuoteHeadRec2."Document Type"::Quote);
                       QuoteHeadRec2.SETRANGE("Job No.","Project No.");
                       QuoteHeadRec2.SETRANGE("Purchase Action",Code);
                       NoOfPurchQuote := 0;
                       IF QuoteHeadRec2.FINDSET THEN
                         REPEAT
                           NoOfPurchQuote := NoOfPurchQuote +1;
                         UNTIL QuoteHeadRec2.NEXT = 0;

                       OrderHeadRec2.RESET;
                       OrderHeadRec2.SETCURRENTKEY("Document Type","Job No.");
                       OrderHeadRec2.SETRANGE("Document Type", OrderHeadRec2."Document Type"::Order);
                       OrderHeadRec2.SETRANGE("Job No.","Project No.");
                       OrderHeadRec2.SETRANGE("Purchase Action",Code);
                       NoOfPurchOrder := 0;
                       IF OrderHeadRec2.FINDSET THEN
                         REPEAT
                           NoOfPurchOrder := NoOfPurchOrder +1;
                         UNTIL OrderHeadRec2.NEXT = 0;
                       OnAfterGetCurrentRecord;
                     END;

    OnNewRecord=BEGIN
                  IF gProjCde <> '' THEN
                    "Project No." := gProjCde;
                  OnAfterGetCurrentRecord;
                END;

    OnInsertRecord=BEGIN
                     TESTFIELD(Code); //TEST
                   END;

    OnAfterGetCurrRecord=BEGIN
                           ShowWorkflowStatus := CurrPage.WorkflowStatus.PAGE.SetFilterOnWorkflowRecord(RECORDID);
                           SetControlAppearance;
                           ControlAvailable := InstallationManagement.LicensePermissionForCodeUnit(CODEUNIT::"CTRL Management");
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 31      ;1   ;ActionGroup;
                      CaptionML=[ENU=&Purchase Action;
                                 NOR=&Innkj›pshandling;
                                 SVE=&Ink”ps†tg„rd] }
      { 1210190002;2 ;Action    ;
                      CaptionML=[ENU=Texts;
                                 NOR=Tekster;
                                 SVE=Texter];
                      RunObject=Page 11012126;
                      RunPageLink=Line Type=CONST(Project Purchase Action),
                                  No.=FIELD(Project No.),
                                  Purchase Action=FIELD(Code);
                      Image=Text }
      { 1210190003;2 ;Action    ;
                      CaptionML=[ENU=Vendors;
                                 NOR=Leverand›rer;
                                 SVE=Leverant”rer];
                      RunObject=Page 11012129;
                      RunPageView=SORTING(Source,Estimate No.,Project No.,Purchase Action,Type,Vendor No.)
                                  WHERE(Source=CONST(Project),
                                        Estimate No.=CONST());
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Purchase Action=FIELD(Code);
                      Promoted=Yes;
                      Image=Segment;
                      PromotedCategory=Process }
      { 1100485016;2 ;Action    ;
                      CaptionML=[ENU=Features;
                                 NOR=Funksjoner;
                                 SVE=Funktioner];
                      Promoted=Yes;
                      Visible=FALSE;
                      Image=LotInfo;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 LFeatByPurchActionRec@1100485000 : Record 11012069;
                               BEGIN
                                 LFeatByPurchActionRec.RESET;
                                 LFeatByPurchActionRec.SETRANGE("Project No.","Project No.");
                                 LFeatByPurchActionRec.SETRANGE("Purchase Action",Code);

                                 PAGE.RUNMODAL(PAGE::"Features by Purchase Action",LFeatByPurchActionRec);
                               END;
                                }
      { 1100529401;2 ;Action    ;
                      CaptionML=[ENU=Purchase Requisition;
                                 SVE=Ink”psrekvisitioner];
                      RunObject=Page 11126652;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Purchase Action=FIELD(Code);
                      Visible=FALSE;
                      Image=Worksheet }
      { 1210190006;2 ;Action    ;
                      CaptionML=[ENU=Purchase &Orders;
                                 NOR=Innkj›ps&ordre;
                                 SVE=Ink”ps&order];
                      Promoted=Yes;
                      Image=Document;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 lPurchHeader@1100485000 : Record 38;
                                 lPurchLine@1100485002 : Record 39;
                               BEGIN
                                 lPurchLine.SETCURRENTKEY("Document Type", "Job No.");
                                 lPurchLine.SETRANGE("Document Type", lPurchLine."Document Type"::Order);
                                 lPurchLine.SETRANGE("Job No.", "Project No.");
                                 lPurchLine.SETRANGE("Purchase Action", Code);
                                 IF lPurchLine.FINDSET THEN
                                   REPEAT
                                     IF lPurchHeader.GET(lPurchLine."Document Type", lPurchLine."Document No.") THEN
                                       lPurchHeader.MARK(TRUE);
                                   UNTIL lPurchLine.NEXT = 0;

                                 lPurchHeader.SETRANGE("Document Type", lPurchHeader."Document Type"::Order);
                                 lPurchHeader.MARKEDONLY(TRUE);

                                 PAGE.RUNMODAL(PAGE::"Purchase Order List", lPurchHeader);
                               END;
                                }
      { 1210190005;2 ;Action    ;
                      CaptionML=[ENU=Purchase Quotes;
                                 NOR=Innkj›pstilbud;
                                 SVE=Ink”psofferter];
                      RunObject=Page 9306;
                      RunPageView=SORTING(Document Type,Job No.)
                                  WHERE(Document Type=CONST(Quote));
                      RunPageLink=Job No.=FIELD(Project No.),
                                  Purchase Action=FIELD(Code);
                      Promoted=Yes;
                      Image=Quote;
                      PromotedCategory=Process }
      { 1100525010;1 ;ActionGroup;
                      CaptionML=[ENU=&Documents;
                                 NOR=&Dokumenter;
                                 SVE=&Dokument] }
      { 1100485018;2 ;Action    ;
                      CaptionML=[ENU=Do&cuments;
                                 NOR=Do&kumenter;
                                 SVE=Do&kument];
                      Promoted=Yes;
                      Image=Documents;
                      OnAction=VAR
                                 RecRef@1199198001 : RecordRef;
                                 DocumentFilters@1100525001 : Codeunit 11012432;
                               BEGIN
                                 RecRef.GETTABLE(Rec);
                                 DocumentFilters.CreateTempFilterAndExecute1(RecRef, '', FALSE, TRUE);
                               END;
                                }
      { 1210190004;2 ;Action    ;
                      CaptionML=[ENU=Document Relations;
                                 NOR=Dokumentrelasjoner;
                                 SVE=Dokumentrelationer];
                      RunObject=Page 11012130;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Purchase Action=FIELD(Code);
                      Promoted=Yes;
                      Image=Relationship }
      { 1100485011;2 ;Action    ;
                      CaptionML=[ENU=Matrix Document Relations;
                                 NOR=Matrisedokumentrelasjoner;
                                 SVE=Matrisdokumentrelationer];
                      RunObject=Page 11071829;
                      RunPageLink=No.=FIELD(Project No.);
                      Promoted=Yes;
                      Visible=FALSE;
                      Image=ShowMatrix }
      { 1100525009;1 ;ActionGroup;
                      CaptionML=[ENU=&Quote Comparison;
                                 NOR=&Tilbudssammenligning] }
      { 1210190017;2 ;Action    ;
                      CaptionML=[ENU=Quote Comparison (Excel);
                                 NOR=Tilbudssammenligning (excel);
                                 SVE=Offertj„mf”relse (Excel)];
                      Image=Excel;
                      OnAction=VAR
                                 lvQuoteCompCU@1210190000 : Codeunit 11012054;
                               BEGIN
                                 lvQuoteCompCU.RunQuoteCompByPurchAction("Project No.", Code);
                               END;
                                }
      { 1100485017;2 ;Action    ;
                      CaptionML=[ENU=Quote Comparison all Purchase Action (Excel);
                                 NOR=Tilbudssammenligning - alle Innkj›pshandlinger (Excel);
                                 SVE=Offertj„mf”relse f”r alla ink”ps†tg„rder (Excel)];
                      Image=Excel;
                      OnAction=VAR
                                 lvQuoteCompCU@1100485001 : Codeunit 11012054;
                               BEGIN
                                 lvQuoteCompCU.AllPurchQuoteCompToExcel("Project No.");
                               END;
                                }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1100528414;1 ;ActionGroup;
                      CaptionML=[ENU=Approval;
                                 NOR=Godkjenning;
                                 SVE=Godk„nnande] }
      { 1100528413;2 ;Action    ;
                      Name=Approve;
                      CaptionML=[ENU=Approve;
                                 NOR=Godkjenn;
                                 SVE=Godk„nn];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Approve;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.ApproveRecordApprovalRequest(RECORDID);
                               END;
                                }
      { 1100528412;2 ;Action    ;
                      Name=Reject;
                      CaptionML=[ENU=Reject;
                                 NOR=Avvis;
                                 SVE=Avvisa];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Reject;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.RejectRecordApprovalRequest(RECORDID);
                               END;
                                }
      { 1100528411;2 ;Action    ;
                      Name=Delegate;
                      CaptionML=[ENU=Delegate;
                                 NOR=Deleger;
                                 SVE=Delegera];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      Image=Delegate;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.DelegateRecordApprovalRequest(RECORDID);
                               END;
                                }
      { 1100528410;2 ;Action    ;
                      Name=Comment;
                      CaptionML=[ENU=Comments;
                                 NOR=Merknader;
                                 SVE=Kommentar];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      Image=ViewComments;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1100528500 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.GetApprovalComment(Rec); //**4PS.n
                               END;
                                }
      { 1100528409;1 ;ActionGroup;
                      CaptionML=[ENU=Request Approval;
                                 NOR=Be om godkjenning;
                                 SVE=Beg„r godk„nnande];
                      Visible=FALSE }
      { 1100528408;2 ;Action    ;
                      Name=SendApprovalRequest;
                      CaptionML=[ENU=Send A&pproval Request;
                                 NOR=&Send godkjenningsforesp›rsel;
                                 SVE=Skicka godk&„nnandebeg„ran];
                      Visible=FALSE;
                      Enabled=NOT OpenApprovalEntriesExist;
                      Image=SendApprovalRequest;
                      OnAction=VAR
                                 ApprovalManagement4PSConstr@1001 : Codeunit 11125349;
                                 ApprovalsBridge4PSConstruct@1100528400 : Codeunit 11125348;
                               BEGIN
                                 IF ApprovalManagement4PSConstr.CheckProjectPurchaseActionApprovalsWorkflowEnabled(Rec) THEN
                                   ApprovalsBridge4PSConstruct.OnSendProjectPurchaseActionForApproval(Rec);
                               END;
                                }
      { 1100528407;2 ;Action    ;
                      Name=CancelApprovalRequest;
                      CaptionML=[ENU=Cancel Approval Re&quest;
                                 NOR=&Annuller godkjenningsforesp›rsel;
                                 SVE=Annullera &godk„nnandebeg„ran];
                      Visible=FALSE;
                      Enabled=CanCancelApprovalRequest;
                      Image=Cancel;
                      OnAction=VAR
                                 ApprovalsBridge4PSConstruct@1100528400 : Codeunit 11125348;
                               BEGIN
                                 ApprovalsBridge4PSConstruct.OnCancelProjectPurchaseActionApprovalRequest(Rec);
                               END;
                                }
      { 1100525001;1 ;Action    ;
                      Name=AssignButton;
                      CaptionML=[ENU=&Assign;
                                 NOR=&Tilordne;
                                 SVE=&Tilldela];
                      Promoted=Yes;
                      Enabled=AssignButtonEnable;
                      PromotedIsBig=Yes;
                      Image=AddAction;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 CopyBudgetPage@1100525000 : Page 11130131;
                               BEGIN
                                 TESTFIELD("Project No.");
                                 TESTFIELD(Code);
                                 CopyBudgetPage.SetSelectionPurchaseAction("Project No.", Code);
                                 CopyBudgetPage.RUNMODAL;
                               END;
                                }
      { 1210190009;1 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Create Purchase &Quotes;
                                 NOR=Opprett Innkj›ps&tilbud;
                                 SVE=Skapa ink”ps&offerter];
                      Promoted=Yes;
                      Image=MakeOrder;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 Job@1100528300 : Record 11072003;
                                 lvCounter@1210190000 : Integer;
                                 lvOptionNo@1210190004 : Integer;
                               BEGIN
                                 IF Status = Status::Definitive THEN
                                   ERROR(Text006);

                                 IF NOT PurchActVendRec.PreferredVendorPresent("Project No.", Code) THEN  //DP00885
                                   ERROR(Text000);

                                 Job.GET(PurchActVendRec."Project No.");
                                 IF (Job."Project Portal Project") OR (Job.IsDocumentPortalDualProject) THEN
                                   lvOptionNo := STRMENU(Text003,2)
                                 ELSE
                                   lvOptionNo := STRMENU(Text003,3);
                                 IF (lvOptionNo < 1) THEN
                                   ERROR('');

                                 PurchaseActionMgt.CreateQuote(Rec, lvOptionNo, lvCounter);  //DP01267
                                 IF (lvCounter > 0) THEN
                                   MESSAGE(Text002,lvCounter)
                                 ELSE
                                   ERROR(Text002,lvCounter);
                               END;
                                }
      { 1210190023;1 ;Action    ;
                      Name=CreatePurchaseQuotesForMoreActions;
                      CaptionML=[ENU=Create Purchase Quotes for &more Purchase Actions;
                                 NOR=Opprette Innkj›pstilbud for &flere Innkj›pshandlinger;
                                 SVE=Skapa ink”psofferter f”r &fler ink”ps†tg„rder];
                      Visible=FALSE;
                      Image=CreateJobSalesCreditMemo;
                      OnAction=VAR
                                 ProjectPurchaseAction@1210190002 : Record 11012026;
                                 ProjectPurchaseActionList@1210190001 : Page 11012034;
                                 lvOptionNo@1210190003 : Integer;
                                 lvCounter@1210190004 : Integer;
                               BEGIN
                                 // C-019435.n
                                 lvOptionNo := STRMENU(Text003,3);
                                 IF (lvOptionNo < 1) THEN
                                   ERROR('');

                                 ProjectPurchaseAction.FILTERGROUP(9);
                                 ProjectPurchaseAction.SETRANGE("Project No.","Project No.");
                                 ProjectPurchaseAction.FILTERGROUP(0);
                                 //ProjectPurchaseAction.SETRANGE(Status, ProjectPurchaseAction.Status::Approved);  //C057080+C060128
                                 ProjectPurchaseActionList.SETTABLEVIEW(ProjectPurchaseAction);
                                 ProjectPurchaseActionList.LOOKUPMODE(TRUE);
                                 IF ProjectPurchaseActionList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                   ProjectPurchaseActionList.GetMarkedRecords(ProjPurchAction2);
                                   IF ProjPurchAction2.FINDSET THEN BEGIN
                                     REPEAT
                                       IF ProjPurchAction2.Status <> ProjPurchAction2.Status::Definitive THEN
                                         IF PurchActVendRec.PreferredVendorPresent(ProjPurchAction2."Project No.", ProjPurchAction2.Code) THEN  //DP00885
                                           PurchaseActionMgt.CreateQuote(ProjPurchAction2, lvOptionNo,lvCounter);  //DP01267
                                     UNTIL ProjPurchAction2.NEXT = 0;
                                   END ELSE
                                     ERROR(Text020);
                                 END;

                                 IF (lvCounter > 0) THEN
                                   MESSAGE(Text002,lvCounter)
                                 ELSE
                                   ERROR(Text002,lvCounter);
                               END;
                                }
      { 1100485006;1 ;Action    ;
                      CaptionML=[ENU=Create Purchase &Order;
                                 NOR=Opprette Innkj›p &Ordre;
                                 SVE=Skapa ink”ps&order];
                      Promoted=Yes;
                      Image=MakeOrder;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 PurchaseActionMgt.CreateOrder(Rec);  //DP01267
                               END;
                                }
      { 1210190018;1 ;Action    ;
                      CaptionML=[ENU=Create &Documents;
                                 NOR=Opprette &Dokumenter;
                                 SVE=Skapa &dokument];
                      Promoted=Yes;
                      Image=Word;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 DocGenerateFrm@1210190001 : Page 11020261;
                               BEGIN
                                 DocGenerateFrm.SetFilter("Project No.",'',Code);
                                 DocGenerateFrm.RUNMODAL;
                               END;
                                }
      { 1100485004;1 ;Action    ;
                      CaptionML=[ENU=Print Purchase Quote Documents;
                                 NOR=Skriv ut innkj›pstilbudsdokumenter;
                                 SVE=Skriv ut ink”psoffertdokument];
                      Promoted=Yes;
                      Visible=FALSE;
                      Image=PrintDocument;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 PurchaseActionMgt.PrintQuoteDocs(Rec);  //DP01267
                               END;
                                }
      { 1100528800;1 ;Action    ;
                      CaptionML=ENU=Email Quotes;
                      Image=Email;
                      OnAction=BEGIN
                                 PurchaseActionMgt.SendMailQuote(Rec);  //DP01267
                               END;
                                }
      { 1100528400;1 ;Action    ;
                      CaptionML=ENU=Email Quote Thanks Letters;
                      Image=Email;
                      OnAction=BEGIN
                                 PurchaseActionMgt.SendMailQuoteLetter(Rec);  //DP01267
                               END;
                                }
      { 1100528302;1 ;ActionGroup;
                      CaptionML=[ENU=Document Portal;
                                 SVE=Dokumentportal];
                      Visible=QuoteSubsitePresent;
                      Image=Web }
      { 1100528300;2 ;Action    ;
                      CaptionML=ENU=Send Quote Requests;
                      Promoted=Yes;
                      Image=Web;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 DocumentPortalProject@1100528300 : Codeunit 11012948;
                               BEGIN
                                 DocumentPortalProject.UpdateQuoteRequests(Rec, 1); //1=Add
                               END;
                                }
      { 1100528303;2 ;Action    ;
                      CaptionML=ENU=Update All Responsible Persons;
                      Image=Segment;
                      OnAction=VAR
                                 Job@1100528301 : Record 11072003;
                                 DocumentPortalProject@1100528302 : Codeunit 11012948;
                               BEGIN
                                 Job.GET("Project No.");
                                 DocumentPortalProject.AddQuoteResponsiblePersons(Job);
                               END;
                                }
      { 1100528301;2 ;Action    ;
                      CaptionML=ENU=Update Vendors;
                      Image=Segment;
                      OnAction=VAR
                                 DocumentPortalProject@1100528301 : Codeunit 11012948;
                               BEGIN
                                 DocumentPortalProject.AddQuoteVendors(Rec);
                               END;
                                }
      { 1100409000;2 ;Action    ;
                      CaptionML=ENU=Update Quote Request;
                      Promoted=Yes;
                      Image=Web;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 DocumentPortalProject@1100528301 : Codeunit 11012948;
                               BEGIN
                                 DocumentPortalProject.UpdateQuoteRequests(Rec, 2); //2=Modify
                               END;
                                }
      { 1100528304;2 ;Action    ;
                      CaptionML=ENU=Update Related Documents;
                      Image=PostDocument;
                      OnAction=VAR
                                 DocumentPortalProject@1100528301 : Codeunit 11012948;
                               BEGIN
                                 DocumentPortalProject.AddQuoteAttachments(Rec, TRUE);
                               END;
                                }
      { 1100527801;1 ;ActionGroup;
                      CaptionML=ENU=4PS Control }
      { 1100527802;2 ;Action    ;
                      CaptionML=ENU=Synchronize Purchase Action;
                      Image=Web;
                      OnAction=BEGIN
                                 ValidatePublishInControl;
                               END;
                                }
      { 1100525007;  ;ActionContainer;
                      ActionContainerType=Reports }
      { 1210190013;1 ;Action    ;
                      CaptionML=[ENU=Quote Reports;
                                 NOR=Tilbudsrapporter;
                                 SVE=Offertrapporter];
                      Promoted=Yes;
                      Visible=FALSE;
                      Image=PrintForm;
                      PromotedCategory=Report;
                      OnAction=BEGIN
                                 PurchaseActionMgt.PrintWriteOff(Rec);  //DP01267
                               END;
                                }
      { 29      ;1   ;Action    ;
                      CaptionML=[ENU=Purchase Action Reports;
                                 NOR=Rapporter over innkj›pshandlinger;
                                 SVE=Rapporter ”ver ink”ps†tg„rder];
                      Promoted=Yes;
                      Image=Print;
                      PromotedCategory=Report;
                      OnAction=BEGIN
                                 SETRANGE(Status, Status);
                                 PrintDoc.PrintPurchaseAction(Rec);
                               END;
                                }
      { 30      ;1   ;Action    ;
                      CaptionML=[ENU=B&udget Reports;
                                 NOR=B&udsjettrapporter;
                                 SVE=B&udgetrapporter];
                      Visible=FALSE;
                      Image=PrintCover;
                      OnAction=VAR
                                 BudgetRec@11012001 : Record 11012001;
                               BEGIN
                                 BudgetRec."Project No." := "Project No.";
                                 BudgetRec."Purchase Action" := Code;
                                 PrintDoc.PrintBudget(BudgetRec);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;;Container;
                ContainerType=ContentArea }

    { 5   ;1   ;Group     ;
                CaptionML=[ENU=General;
                           NOR=Generell;
                           SVE=Allm„nt] }

    { 6   ;2   ;Field     ;
                SourceExpr="Project No.";
                Editable=ProjectNoEditable;
                OnValidate=BEGIN
                             IF "Project No." <> '' THEN
                               GetDefaultNr;
                           END;
                            }

    { 12  ;2   ;Field     ;
                SourceExpr=Code;
                Importance=Promoted;
                OnLookup=VAR
                           lookupFrm@1210190000 : Page 11012031;
                           lPurchActRec@1210190001 : Record 11012025;
                         BEGIN
                           CLEAR(lookupFrm);
                           lookupFrm.LOOKUPMODE(TRUE);
                           lookupFrm.SetCopyFunction("Project No.");
                           IF lookupFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
                             lookupFrm.GETRECORD(lPurchActRec);
                             VALIDATE(Code,lPurchActRec.Code);
                           END ELSE BEGIN
                             IF lookupFrm.CheckMultiCopy(ProjPurchActRec) THEN BEGIN
                               CurrPage.UPDATE(FALSE);
                               Rec := ProjPurchActRec;
                               FIND;
                               CurrPage.UPDATE(FALSE);
                             END;
                           END;
                         END;
                          }

    { 1210190011;2;Field  ;
                SourceExpr="Project Description" }

    { 10  ;2   ;Field     ;
                SourceExpr=Description }

    { 1100485012;2;Field  ;
                SourceExpr="Amounts Only";
                Importance=Additional }

    { 14  ;2   ;Field     ;
                SourceExpr="Search Name";
                Importance=Additional;
                Visible=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr="Responsible Employee";
                Importance=Additional;
                Visible=FALSE;
                OnValidate=BEGIN
                             CALCFIELDS("Name Employee");
                             RefreshPage;
                           END;
                            }

    { 1100485005;2;Field  ;
                SourceExpr="Name Employee";
                Importance=Additional;
                Visible=FALSE }

    { 16  ;2   ;Field     ;
                SourceExpr=Status;
                Importance=Promoted;
                OnValidate=BEGIN
                             IF Status = Status::Applied THEN
                               CheckIfSettingStatusToAppliedIsAllowed(xRec.Status);
                             RefreshPage;
                           END;
                            }

    { 1100527800;2;Field  ;
                SourceExpr="Publish in Control";
                Editable=ControlAvailable }

    { 3   ;1   ;Part      ;
                Name=PurchaseBudget;
                SubPageLink=Project No.=FIELD(Project No.),
                            Purchase Action=FIELD(Code),
                            Purchase Action Filter=FIELD(Code);
                PagePartID=Page11012033 }

    { 1902859001;1;Group  ;
                CaptionML=[ENU=Text;
                           NOR=Tekst;
                           SVE=Ben„mning] }

    { 18  ;2   ;Field     ;
                SourceExpr=Text;
                MultiLine=Yes }

    { 1905289801;1;Group  ;
                CaptionML=[ENU=Data;
                           NOR=Data;
                           SVE=Data] }

    { 1210190010;2;Field  ;
                SourceExpr="Requested Quote Receipt Date" }

    { 1210190015;2;Field  ;
                SourceExpr="Vendors react before" }

    { 1210190021;2;Field  ;
                SourceExpr="Document Template" }

    { 1100525013;2;Field  ;
                SourceExpr="Requested Receipt Date" }

    { 1901994701;1;Group  ;
                CaptionML=[ENU=Log;
                           NOR=Logg;
                           SVE=Logg] }

    { 20  ;2   ;Field     ;
                SourceExpr="Changed by" }

    { 22  ;2   ;Field     ;
                SourceExpr="Changed on" }

    { 1210190000;2;Field  ;
                SourceExpr="Activate for";
                Importance=Additional }

    { 1100485002;2;Field  ;
                SourceExpr="Approval Date";
                Editable=FALSE }

    { 1907544901;1;Group  ;
                CaptionML=[ENU=Request Data;
                           NOR=Foresp›rseldata;
                           SVE=Beg„r data] }

    { 1100485000;2;Field  ;
                SourceExpr="Expected No. of Vendors";
                Importance=Additional }

    { 1100485008;2;Field  ;
                CaptionML=[ENU=Sum of selected vendors;
                           NOR=Antall valgte leverand›rer;
                           SVE=Antal valda leverant”rer];
                SourceExpr=Number;
                Editable=FALSE;
                OnDrillDown=BEGIN
                              PurchActVendRec2.RESET;
                              PurchActVendRec2.SETRANGE(Source, PurchActVendRec2.Source::Project);
                              PurchActVendRec2.SETRANGE("Estimate No.", '');
                              PurchActVendRec2.SETRANGE("Project No.","Project No.");
                              PurchActVendRec2.SETRANGE("Purchase Action",Code);
                              IF PurchActVendRec2.FIND('-') THEN
                                PAGE.RUNMODAL(PAGE::"Vendors by Purchase Action",PurchActVendRec2);
                              CurrPage.UPDATE;
                            END;
                             }

    { 1100485010;2;Field  ;
                Lookup=No;
                DrillDown=Yes;
                CaptionML=[ENU=Count of Quotes;
                           NOR=Antall tilbud;
                           SVE=Antal offerter];
                SourceExpr=NoOfPurchQuote;
                Editable=FALSE;
                OnDrillDown=BEGIN
                              QuoteHeadRec2.RESET;
                              QuoteHeadRec2.SETCURRENTKEY("Document Type","Job No.");
                              //QuoteHeadRec2.SETFILTER("Document Type",'Offerte'); //**4PS.o
                              QuoteHeadRec2.SETRANGE("Document Type",QuoteHeadRec2."Document Type"::Quote); //**4PS.n
                              QuoteHeadRec2.SETFILTER("Job No.","Project No.");
                              QuoteHeadRec2.SETFILTER("Purchase Action",Code);
                              IF QuoteHeadRec2.FIND('-') THEN
                                PAGE.RUNMODAL(53,QuoteHeadRec2);
                            END;
                             }

    { 1100485014;2;Field  ;
                DrillDown=Yes;
                CaptionML=[ENU=No. Of Purchase Headers;
                           NOR=Antall innkj›pstitler;
                           SVE=Antal ink”psrubriker];
                SourceExpr=NoOfPurchOrder;
                Editable=FALSE;
                OnDrillDown=BEGIN
                              OrderHeadRec2.RESET;
                              OrderHeadRec2.SETCURRENTKEY("Document Type","Job No.");
                              //OrderHeadRec2.SETFILTER("Document Type",'Order'); //**4PS.o
                              OrderHeadRec2.SETRANGE("Document Type",OrderHeadRec2."Document Type"::Order); //**4PS.n
                              OrderHeadRec2.SETFILTER("Job No.","Project No.");
                              OrderHeadRec2.SETFILTER("Purchase Action",Code);
                              IF OrderHeadRec2.FIND('-') THEN
                                PAGE.RUNMODAL(53,OrderHeadRec2);
                            END;
                             }

    { 1903597801;1;Group  ;
                CaptionML=[ENU=Budget Adjustment;
                           NOR=Budsjettjustering;
                           SVE=Budgetjustering] }

    { 1100525000;2;Field  ;
                SourceExpr="Default Cost Object Purchase";
                OnValidate=BEGIN
                             RefreshPage;
                           END;
                            }

    { 1100525004;2;Field  ;
                SourceExpr="Default Cost Object Purch.Desc" }

    { 1100525002;2;Field  ;
                SourceExpr="Budget Adjustment Type";
                OnValidate=BEGIN
                             RefreshPage;
                           END;
                            }

    { 1100525005;2;Field  ;
                SourceExpr="Budget Adjustment Type Desc." }

    { 1100525006;2;Field  ;
                SourceExpr="Budget Neutral";
                Importance=Additional }

    { 1100525008;2;Field  ;
                SourceExpr="Created Budget Adjustments" }

    { 1210190001;0;Container;
                ContainerType=FactBoxArea }

    { 1100529900;1;Part   ;
                Name=RegisterExternalDocumentFB;
                PagePartID=Page11125053;
                PartType=Page }

    { 1210190016;1;Part   ;
                SubPageLink=Project No.=FIELD(Project No.),
                            Purchase Action=FIELD(Code),
                            Purchase Action Filter=FIELD(Code);
                PagePartID=Page11130109;
                PartType=Page }

    { 1210190014;1;Part   ;
                SubPageView=WHERE(Purchase Action Filter=FILTER(''));
                SubPageLink=Project No.=FIELD(Project No.);
                PagePartID=Page11130001;
                PartType=Page }

    { 1100528406;1;Part   ;
                SubPageLink=Table ID=CONST(11012026),
                            Document No.=FIELD(Code),
                            Project No.=FIELD(Project No.);
                PagePartID=Page9103;
                Visible=OpenApprovalEntriesExistForCurrUser;
                PartType=Page }

    { 1100528405;1;Part   ;
                SubPageLink=Table ID=CONST(11012026),
                            Document No.=FIELD(Code),
                            Project No.=FIELD(Project No.);
                PagePartID=Page9092;
                Visible=FALSE;
                PartType=Page }

    { 1100528404;1;Part   ;
                Name=WorkflowStatus;
                PagePartID=Page1528;
                Visible=ShowWorkflowStatus;
                Enabled=FALSE;
                Editable=FALSE;
                PartType=Page;
                ShowFilter=No }

    { 1100525012;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 1100525011;1;Part   ;
                PartType=System;
                SystemPartID=Notes }

  }
  CODE
  {
    VAR
      ProjPurchActRec@11012000 : Record 11012026;
      ProjPurchAction2@1210190014 : Record 11012026;
      PrintDoc@11012001 : Codeunit 229;
      InstallationManagement@1100527801 : Codeunit 11012268;
      PurchActVendRec@1210190007 : Record 11012068;
      PurchActVendRec2@1100485002 : Record 11012068;
      Text000@1210190015 : TextConst 'ENU=No Vendors selected for this Purchase Action;NOR=Ingen leverandr›rer er valgt for denne innkj›pshandlingen;SVE=Inga leverant”rer har valts f”r den h„r ink”ps†tg„rden';
      Text002@1210190013 : TextConst 'ENU=%1 quotes created;NOR=%1 tilbud er opprettet;SVE=%1 offerter har skapats';
      Text003@1210190001 : TextConst 'ENU=Quotes,Quotes + Word documents,Quotes + Print Word Documents,Quotes + Print Word Documents with printer selection;NOR=Tilbud,Tilbud + Word-dokument,Tilbud + Skriv ut Word-dokument,Tilbud + Skriv ut Word-dokument med skrivervalgg;SVE=Offerter,Offerter + Word-dokument,Offerter + Skriv ut Word-dokument,Offerter + Skriv ut Word-dokument med skrivarval';
      Text006@1210190017 : TextConst 'ENU=Status is definitive, creation of quotes not possible;NOR=Status er definitiv, ikke mulig † opprette tilbud;SVE=Status „r definitiv, det g†r inte att skapa offerter';
      gProjCde@1100485000 : Code[20];
      Number@1100485003 : Integer;
      NoOfPurchQuote@1100485005 : Integer;
      QuoteHeadRec2@1100485006 : Record 38;
      OrderHeadRec2@1100485007 : Record 38;
      NoOfPurchOrder@1100485008 : Integer;
      Text020@1210190012 : TextConst 'ENU=There are not marked Purchase Actions;NOR=Det finnes ingen markerte innkj›pshandlinger;SVE=Det finns inga m„rkta ink”ps†tg„rder';
      AssignButtonEnable@19053009 : Boolean INDATASET;
      ProjectNoEditable@19028701 : Boolean INDATASET;
      QuoteSubsitePresent@1100528300 : Boolean;
      Job@1100528301 : Record 11072003;
      PurchaseActionMgt@1100528902 : Codeunit 11229288;
      OpenApprovalEntriesExistForCurrUser@1100528402 : Boolean;
      OpenApprovalEntriesExist@1100528401 : Boolean;
      ShowWorkflowStatus@1100528400 : Boolean;
      CanCancelApprovalRequest@1100528200 : Boolean;
      ControlAvailable@1100527800 : Boolean;

    PROCEDURE GetDefaultNr@1();
    VAR
      ProjActRec@1000000000 : Record 11012026;
    BEGIN
      IF "Project No." <> '' THEN BEGIN
        ProjActRec.SETRANGE("Project No.","Project No.");
        IF ProjActRec.FINDLAST THEN
          Code := INCSTR(ProjActRec.Code)
        ELSE
          Code := '1';
      END;
    END;

    PROCEDURE Setfilter@1100485000(lProjCde@1210190000 : Code[20]);
    BEGIN
      FILTERGROUP(2);
      SETRANGE("Project No.",lProjCde);
      ProjectNoEditable := FALSE;
      gProjCde := lProjCde;
      FILTERGROUP(0);
    END;

    LOCAL PROCEDURE OnAfterGetCurrentRecord@19077479();
    VAR
      RecRef@1100529900 : RecordRef;
    BEGIN
      xRec := Rec;
      AssignButtonEnable := (NOT (Status = Status::Definitive));

      RecRef.GETTABLE(Rec);
      CurrPage.RegisterExternalDocumentFB.PAGE.SetRecordReference(RecRef);
      CurrPage.RegisterExternalDocumentFB.PAGE.SetByCompany(TRUE);
      CurrPage.RegisterExternalDocumentFB.PAGE.SetDepartmentCode('');
    END;

    LOCAL PROCEDURE RefreshPage@1100528900();
    BEGIN
      CurrPage.UPDATE;  //db, 12-10-16
    END;

    LOCAL PROCEDURE SetControlAppearance@5();
    VAR
      ApprovalsMgmt@1002 : Codeunit 1535;
    BEGIN
      OpenApprovalEntriesExistForCurrUser := ApprovalsMgmt.HasOpenApprovalEntriesForCurrentUser(RECORDID);
      OpenApprovalEntriesExist := ApprovalsMgmt.HasOpenApprovalEntries(RECORDID);
      CanCancelApprovalRequest := ApprovalsMgmt.CanCancelApprovalForRecord(RECORDID)
    END;

    LOCAL PROCEDURE SetQuoteSubsitePresent@1100527800();
    BEGIN
      QuoteSubsitePresent := Job."Quote Subsite Generated";
    END;

    BEGIN
    {
      4PS, dbeekman, 22-10-2008:
        - ReportSelection changed. cod229.GetReportSelection called to select reports to be printed

      4PS, 11-11-13, Report "Project Purchase Actions" and "Purchase Shipment" no longer supported in NAV2013
    }
    END.
  }
}

