OBJECT Table 12013588 Exflow Purchase Document Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=EXF510000,4PS;
  }
  PROPERTIES
  {
    OnInsert=VAR
               ExFWorkFlowMgt@1100285001 : Codeunit 12013593;
             BEGIN
               IF NOT ExfPurchDocHead.GET("Inbound Document No.") THEN
                 CLEAR(ExfPurchDocHead);

               IF "Document Type" = 0 THEN
                 "Document Type" := ExfPurchDocHead."Document Type";

               LOCKTABLE;

               ExFWorkFlowMgt.CreateProposals(Rec,TRUE, ("Shortcut Dimension 1 Code" <> xRec."Shortcut Dimension 1 Code") OR
                                                        ("Shortcut Dimension 2 Code" <> xRec."Shortcut Dimension 2 Code"),TRUE,TRUE);
             END;

    OnModify=VAR
               ExFWorkFlowMgt@1100285000 : Codeunit 12013593;
             BEGIN
               ExFWorkFlowMgt.CreateProposals(Rec,TRUE, ("Shortcut Dimension 1 Code" <> xRec."Shortcut Dimension 1 Code") OR
                                                        ("Shortcut Dimension 2 Code" <> xRec."Shortcut Dimension 2 Code"),TRUE,TRUE);

               IF IsLineModified(Rec,xRec) THEN
                 "Line manually changed" := TRUE;
             END;

    OnDelete=VAR
               EXProposal@1100285001 : Record 12013615;
             BEGIN
               IF NOT StatusCheckSuspended AND
                  (Type IN [Type::"G/L Account",Type::"Charge (Item)"])
               THEN BEGIN
                 DoNoUpdateVAT := TRUE;
                 VALIDATE(Quantity,0);
                 DoNoUpdateVAT := FALSE;
               END;

               IF Type = Type::Item THEN
                 DeleteItemChargeAssgnt("Document Type","Inbound Document No.","Line No.");

               IF Type = Type::"Charge (Item)" THEN
                 DeleteChargeChargeAssgnt("Inbound Document No.","Line No.");

               ExfPurchDocLine2.RESET;
               ExfPurchDocLine2.SETCURRENTKEY("Attached to Line No.");
               ExfPurchDocLine2.SETRANGE("Inbound Document No.","Inbound Document No.");
               ExfPurchDocLine2.SETFILTER("Line No.",'<>%1',"Line No.");
               ExfPurchDocLine2.SETRANGE("Attached to Line No.","Line No.");
               IF NOT ExfPurchDocLine2.ISEMPTY THEN
                 ExfPurchDocLine2.DELETEALL(TRUE);

               EXProposal.RESET;
               EXProposal.SETRANGE("Entry No.", "Inbound Document No.");
               EXProposal.SETRANGE("Line No.", "Line No.");
               EXProposal.DELETEALL(TRUE);

               IF "Order No." <> '' THEN BEGIN
                 ExfPurchDocLine2.RESET;
                 ExfPurchDocLine2.SETRANGE("Inbound Document No.","Inbound Document No.");
                 ExfPurchDocLine2.SETFILTER("Line No.",'<>%1',"Line No.");
                 ExfPurchDocLine2.SETFILTER("No.", '<>%1', '');
                 IF ExfPurchDocLine2.FINDFIRST THEN BEGIN
                   ExfPurchDocLine2."Line manually changed" := TRUE;
                   ExfPurchDocLine2.MODIFY;
                 END;
               END;

               IF "Deferral Code" <> '' THEN
                 DeferralUtilities.DeferralCodeOnDelete(
                   DeferralUtilities.GetPurchDeferralDocType,'','',
                   "Document Type",FORMAT("Inbound Document No."),"Line No.");
             END;

    OnRename=BEGIN
               ERROR(Text000,TABLECAPTION);
             END;

    CaptionML=[ENU=Exflow Purchase Document Line;
               SVE=Exflow ink”psdok.rad];
    PasteIsValid=No;
    LookupPageID=Page12013631;
    DrillDownPageID=Page12013631;
  }
  FIELDS
  {
    { 1   ;   ;Document Type       ;Option        ;CaptionML=[ENU=Document Type;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=[ENU=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order;
                                                                    SVE=Offert,Order,Faktura,Kreditnota,Avropsorder,Returorder];
                                                   OptionString=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order }
    { 2   ;   ;Buy-from Vendor No. ;Code20        ;CaptionML=[ENU=Buy-from Vendor No.;
                                                              SVE=Leverant”rsnr];
                                                   Editable=Yes }
    { 4   ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              SVE=Radnr] }
    { 5   ;   ;Type                ;Option        ;OnValidate=BEGIN
                                                                GetExfPurchDocHeader;

                                                                TESTFIELD("Qty. Rcd. Not Invoiced",0);
                                                                TESTFIELD("Quantity Received",0);
                                                                TESTFIELD("Receipt No.",'');

                                                                TESTFIELD("Return Qty. Shipped Not Invd.",0);
                                                                TESTFIELD("Return Qty. Shipped",0);
                                                                TESTFIELD("Return Shipment No.",'');

                                                                TESTFIELD("Prepmt. Amt. Inv.",0);

                                                                TempExfPurchDocLine := Rec;

                                                                IF Type <> xRec.Type THEN BEGIN
                                                                  IF xRec.Type = Type::Item THEN
                                                                    DeleteItemChargeAssgnt("Document Type","Inbound Document No.","Line No.");
                                                                  IF xRec.Type = Type::"Charge (Item)" THEN
                                                                    DeleteChargeChargeAssgnt("Inbound Document No.","Line No.");
                                                                END;

                                                                INIT;
                                                                IF CurrFieldNo = 0 THEN
                                                                  "Document Type" := TempExfPurchDocLine."Document Type"
                                                                ELSE
                                                                  "Document Type" := ExfPurchDocHead."Document Type";

                                                                Type := TempExfPurchDocLine.Type;
                                                                "System-Created Entry" := TempExfPurchDocLine."System-Created Entry";

                                                                CopyImportFieldsFromTempTable(TempExfPurchDocLine);

                                                                VALIDATE("FA Posting Type");

                                                                IF Type = Type::Item THEN
                                                                  "Allow Item Charge Assignment" := TRUE
                                                                ELSE
                                                                  "Allow Item Charge Assignment" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Type;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=[ENU=" ,G/L Account,Item,,Fixed Asset,Charge (Item)";
                                                                    SVE=" ,Redov.konto,Artikel,,Anl.tillg†ng,Omkostnad (artikel)"];
                                                   OptionString=[ ,G/L Account,Item,,Fixed Asset,Charge (Item)] }
    { 6   ;   ;No.                 ;Code20        ;TableRelation=IF (Type=CONST(" ")) "Standard Text"
                                                                 ELSE IF (Type=CONST(G/L Account),
                                                                          System-Created Entry=CONST(No)) "G/L Account" WHERE (Direct Posting=CONST(Yes),
                                                                                                                               Account Type=CONST(Posting),
                                                                                                                               Blocked=CONST(No))
                                                                                                                               ELSE IF (Type=CONST(G/L Account),
                                                                                                                                        System-Created Entry=CONST(Yes)) "G/L Account"
                                                                                                                                        ELSE IF (Type=CONST(Fixed Asset)) "Fixed Asset"
                                                                                                                                        ELSE IF (Type=CONST("Charge (Item)")) "Item Charge"
                                                                                                                                        ELSE IF (Type=CONST(Item)) Item;
                                                   OnValidate=VAR
                                                                ExFlowSetup@1100285002 : Record 12013601;
                                                                ExfValidateDoc@1100285003 : Codeunit 12013594;
                                                                ExFWorkFlowMgt@1100285000 : Codeunit 12013593;
                                                                DoNotUpdateDim@1100285004 : Boolean;
                                                                ClearDims4PS@1100285005 : Boolean;
                                                              BEGIN
                                                                TESTFIELD("Qty. Rcd. Not Invoiced",0);
                                                                TESTFIELD("Quantity Received",0);
                                                                TESTFIELD("Receipt No.",'');

                                                                TESTFIELD("Prepmt. Amt. Inv.",0);

                                                                TESTFIELD("Return Qty. Shipped Not Invd.",0);
                                                                TESTFIELD("Return Qty. Shipped",0);
                                                                TESTFIELD("Return Shipment No.",'');

                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("No.") THEN
                                                                    TESTFIELD("Order Line No.",0);

                                                                  IF (CurrFieldNo <> 0) AND "OCR Imported Line" THEN
                                                                    ExfValidateDoc.AutoCreateMapping(Rec); // contains a confirm

                                                                  IF Type = Type::Item THEN
                                                                    DeleteItemChargeAssgnt("Document Type","Inbound Document No.","Line No.");
                                                                  IF Type = Type::"Charge (Item)" THEN
                                                                    DeleteChargeChargeAssgnt("Inbound Document No.","Line No.");

                                                                  //4PS
                                                                  IF (CurrFieldNo = FIELDNO("No.")) AND ("Shortcut Dimension 2 Code" <> '') AND ("Job No." <> '') THEN BEGIN
                                                                    ClearDims4PS := TRUE;
                                                                    "Job No." := '';
                                                                    "Shortcut Dimension 1 Code" := '';
                                                                    "Shortcut Dimension 2 Code" := '';
                                                                    //"Dimension Set ID" := 0;

                                                                  END;
                                                                  //4PS
                                                                END;

                                                                TempExfPurchDocLine := Rec;
                                                                INIT;
                                                                GetExfPurchDocHeader;
                                                                ExfPurchDocHead.TESTFIELD("Buy-from Vendor No.");
                                                                IF CurrFieldNo = 0 THEN
                                                                  "Document Type" := TempExfPurchDocLine."Document Type"
                                                                ELSE
                                                                  "Document Type" := ExfPurchDocHead."Document Type";

                                                                Type := TempExfPurchDocLine.Type;
                                                                "No." := TempExfPurchDocLine."No.";

                                                                CopyImportFieldsFromTempTable(TempExfPurchDocLine);

                                                                IF "No." = '' THEN
                                                                  EXIT;
                                                                IF Type <> Type::" " THEN
                                                                  Quantity := TempExfPurchDocLine.Quantity;

                                                                "System-Created Entry" := TempExfPurchDocLine."System-Created Entry";

                                                                IF CurrFieldNo = FIELDNO("No.") THEN
                                                                  "Exflow-Created Entry" := "Exflow-Created Entry"::" ";

                                                                IF "Template Rule" = '' THEN
                                                                  "Template Rule" := ExfPurchDocHead."Template Rule";
                                                                IF "First Approver" = '' THEN
                                                                  "First Approver" := ExfPurchDocHead."First Approver";

                                                                "Buy-from Vendor No." := ExfPurchDocHead."Buy-from Vendor No.";
                                                                "Currency Code" := ExfPurchDocHead."Currency Code";
                                                                //4PS
                                                                IF NOT ClearDims4PS THEN BEGIN
                                                                //4PS
                                                                  "Shortcut Dimension 1 Code" := ExfPurchDocHead."Shortcut Dimension 1 Code";
                                                                  "Shortcut Dimension 2 Code" := ExfPurchDocHead."Shortcut Dimension 2 Code";
                                                                END;

                                                                IF NOT IsServiceItem THEN
                                                                  "Location Code" := ExfPurchDocHead."Location Code";
                                                                "Pay-to Vendor No." := ExfPurchDocHead."Pay-to Vendor No.";
                                                                "Gen. Bus. Posting Group" := ExfPurchDocHead."Gen. Bus. Posting Group";
                                                                "VAT Bus. Posting Group" := ExfPurchDocHead."VAT Bus. Posting Group";
                                                                "Entry Point" := ExfPurchDocHead."Entry Point";
                                                                Area := ExfPurchDocHead.Area;
                                                                "Transaction Specification" := ExfPurchDocHead."Transaction Specification";
                                                                "Tax Area Code" := ExfPurchDocHead."Tax Area Code";
                                                                "Tax Liable" := ExfPurchDocHead."Tax Liable";
                                                                "Prepayment Tax Area Code" := ExfPurchDocHead."Tax Area Code";
                                                                "Prepayment Tax Liable" := ExfPurchDocHead."Tax Liable";

                                                                IF ("Job No." = '') OR (CurrFieldNo = 0) THEN
                                                                  IF ExfPurchDocHead."Job No." <> '' THEN
                                                                    IF NOT IsLineVATLine(Rec) THEN
                                                                      //4PS
                                                                      IF TempExfPurchDocLine."Job No." = '' THEN
                                                                      //4PS
                                                                        IF NOT ClearDims4PS AND (CurrFieldNo <> FIELDNO("No.")) THEN
                                                                      //4PS
                                                                          VALIDATE("Job No.", ExfPurchDocHead."Job No.");

                                                                IF ("Purchaser Code" = '') OR (CurrFieldNo = 0) THEN
                                                                  IF ExfPurchDocHead."Purchaser Code" <> '' THEN
                                                                    VALIDATE("Purchaser Code", ExfPurchDocHead."Purchaser Code");

                                                                "PO Matched Document" := ExfPurchDocHead."PO Matched Document";

                                                                CASE Type OF
                                                                  Type::" ":
                                                                    BEGIN
                                                                      StdTxt.GET("No.");
                                                                      Description := StdTxt.Description;
                                                                      "Allow Item Charge Assignment" := FALSE;
                                                                    END;
                                                                  Type::"G/L Account":
                                                                    BEGIN
                                                                      GLAcc.GET("No.");
                                                                      GLAcc.CheckGLAcc;
                                                                      IF NOT "System-Created Entry" THEN
                                                                        //4PS
                                                                        IF (TempExfPurchDocLine."Shortcut Dimension 2 Code" = '') AND (TempExfPurchDocLine."Job No." = '') THEN
                                                                          GLAcc.TESTFIELD("Direct Posting",TRUE);
                                                                        //4PS
                                                                      Description := GLAcc.Name;
                                                                      "Gen. Prod. Posting Group" := GLAcc."Gen. Prod. Posting Group";
                                                                      //**4PS.sn
                                                                      //"VAT Prod. Posting Group" := GLAcc."VAT Prod. Posting Group";
                                                                      IF GLAcc."VAT Prod. Posting Group" <> '' THEN
                                                                        "VAT Prod. Posting Group" := GLAcc."VAT Prod. Posting Group"
                                                                      ELSE
                                                                        "VAT Prod. Posting Group" := ExfPurchDocHead."VAT Prod. Posting Group";
                                                                      //GetPlantPostingGroup;
                                                                      //**4PS.en
                                                                      "Tax Group Code" := GLAcc."Tax Group Code";
                                                                      "Allow Invoice Disc." := FALSE;
                                                                      "Allow Item Charge Assignment" := FALSE;

                                                                      ExFlowSEMgt.AddAddAccGroup(Rec,GLAcc);
                                                                    END;
                                                                  Type::Item:
                                                                    BEGIN
                                                                      GetItem;
                                                                      GetGLSetup;
                                                                      Item.TESTFIELD(Blocked,FALSE);
                                                                      Item.TESTFIELD("Gen. Prod. Posting Group");
                                                                      IF Item.Type = Item.Type::Inventory THEN BEGIN
                                                                        Item.TESTFIELD("Inventory Posting Group");
                                                                        "Posting Group" := Item."Inventory Posting Group";
                                                                      END;
                                                                      Description := Item.Description;
                                                                      "Description 2" := Item."Description 2";
                                                                      "Units per Parcel" := Item."Units per Parcel";
                                                                      "Indirect Cost %" := Item."Indirect Cost %";
                                                                      "Overhead Rate" := Item."Overhead Rate";
                                                                      "Allow Item Charge Assignment" := TRUE;
                                                                      "Allow Invoice Disc." := Item."Allow Invoice Disc.";
                                                                      "Gen. Prod. Posting Group" := Item."Gen. Prod. Posting Group";
                                                                      "VAT Prod. Posting Group" := Item."VAT Prod. Posting Group";
                                                                      "Tax Group Code" := Item."Tax Group Code";

                                                                      IF Item."Price Includes VAT" THEN BEGIN
                                                                        IF NOT VATPostingSetup.GET(
                                                                             Item."VAT Bus. Posting Gr. (Price)",Item."VAT Prod. Posting Group")
                                                                        THEN
                                                                          VATPostingSetup.INIT;
                                                                        CASE VATPostingSetup."VAT Calculation Type" OF
                                                                          VATPostingSetup."VAT Calculation Type"::"Reverse Charge VAT":
                                                                            VATPostingSetup."VAT %" := 0;
                                                                          VATPostingSetup."VAT Calculation Type"::"Sales Tax":
                                                                            ERROR(
                                                                              Text002,
                                                                              VATPostingSetup.FIELDCAPTION("VAT Calculation Type"),
                                                                              VATPostingSetup."VAT Calculation Type");
                                                                        END;
                                                                      END;

                                                                      IF ExfPurchDocHead."Language Code" <> '' THEN
                                                                        GetItemTranslation;

                                                                      "Unit of Measure Code" := Item."Purch. Unit of Measure";
                                                                    END;
                                                                  Type::"3":
                                                                    ERROR(Text003);
                                                                  Type::"Fixed Asset":
                                                                    BEGIN
                                                                      FA.GET("No.");
                                                                      FA.TESTFIELD(Inactive,FALSE);
                                                                      FA.TESTFIELD(Blocked,FALSE);
                                                                      GetFAPostingGroup;
                                                                      Description := FA.Description;
                                                                      "Description 2" := FA."Description 2";
                                                                      "Allow Invoice Disc." := FALSE;
                                                                      "Allow Item Charge Assignment" := FALSE;
                                                                    END;
                                                                  Type::"Charge (Item)":
                                                                    BEGIN
                                                                      ItemCharge.GET("No.");
                                                                      Description := ItemCharge.Description;
                                                                      "Gen. Prod. Posting Group" := ItemCharge."Gen. Prod. Posting Group";
                                                                      "VAT Prod. Posting Group" := ItemCharge."VAT Prod. Posting Group";
                                                                      "Tax Group Code" := ItemCharge."Tax Group Code";
                                                                      "Allow Invoice Disc." := FALSE;
                                                                      "Indirect Cost %" := 0;
                                                                      "Overhead Rate" := 0;
                                                                      "Allow Item Charge Assignment" := FALSE;
                                                                    END;
                                                                END;

                                                                VALIDATE("Prepayment %");

                                                                IF (xRec."No." <> "No.") AND (Type IN [Type::"G/L Account",Type::"Fixed Asset"]) THEN BEGIN
                                                                  VALIDATE("Direct Unit Cost", xRec."Direct Unit Cost");
                                                                  VALIDATE("Line Discount %", xRec."Line Discount %");
                                                                  IF xRec.Description <> '' THEN BEGIN
                                                                    DocLine."Line Type" := xRec.Type;
                                                                    DocLine."No." := xRec."No.";
                                                                    IF xRec.Description <> DocLine.GetName THEN
                                                                      Description := xRec.Description;
                                                                  END;
                                                                END;

                                                                ExFlowSetup.GET;
                                                                IF Type > 0 THEN BEGIN
                                                                  IF "Gen. Prod. Posting Group" = '' THEN
                                                                    "Gen. Prod. Posting Group" := ExFlowSetup."Std. Prod. Posting Group";

                                                                  IF "VAT Prod. Posting Group" = '' THEN
                                                                    "VAT Prod. Posting Group" := ExFlowSetup."Std. VAT Prod. Posting Group";

                                                                  IF ExfPurchDocHead."Propose VAT Line" THEN
                                                                    IF NOT IsLineVATLine(Rec) THEN BEGIN
                                                                      IF Type = Type::"Fixed Asset" THEN
                                                                        VALIDATE("VAT Prod. Posting Group", ExFlowSetup."VAT Prod. Posting Group 0%")
                                                                      ELSE
                                                                        "VAT Prod. Posting Group" := ExFlowSetup."VAT Prod. Posting Group 0%";
                                                                    END;
                                                                END;

                                                                IF Type <> Type::" " THEN BEGIN
                                                                  IF Type <> Type::"Fixed Asset" THEN
                                                                    VALIDATE("VAT Prod. Posting Group");
                                                                  Quantity := xRec.Quantity;
                                                                  VALIDATE("Unit of Measure Code");
                                                                  IF Quantity <> 0 THEN BEGIN
                                                                    InitOutstanding;
                                                                    IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
                                                                      InitQtyToShip
                                                                    ELSE
                                                                      InitQtyToReceive;
                                                                  END;
                                                                  UpdateDirectUnitCost(FIELDNO("No."));
                                                                  IF xRec."Job No." <> '' THEN
                                                                    //4PS
                                                                    IF NOT ClearDims4PS THEN
                                                                    //4PS
                                                                    "Job No." := xRec."Job No.";
                                                                  "Job Line Type" := xRec."Job Line Type";
                                                                  IF xRec."Job Task No." <> '' THEN
                                                                    VALIDATE("Job Task No.",xRec."Job Task No.");
                                                                END;

                                                                DoNotUpdateDim := FALSE;
                                                                IF ((xRec."No." <> '') OR (xRec."Line Amount" <> 0)) AND (Type > 0) THEN BEGIN
                                                                  ExFlowSetup.GET;
                                                                  IF ExFlowSetup."Do Not Upd Dim Purchase Line" OR
                                                                     ("Order No." <> '')
                                                                  THEN BEGIN
                                                                    DoNotUpdateDim := TRUE;
                                                                    "Shortcut Dimension 1 Code" := xRec."Shortcut Dimension 1 Code";
                                                                    "Shortcut Dimension 2 Code" := xRec."Shortcut Dimension 2 Code";
                                                                    "Dimension Set ID" := xRec."Dimension Set ID";
                                                                  END;
                                                                END;
                                                                IF NOT DoNotUpdateDim THEN
                                                                  CreateDim(
                                                                    DimMgt.TypeToTableID3(Type),"No.",
                                                                    DATABASE::Job,"Job No.",
                                                                    DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                    0,'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(TRUE);
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;

                                                                IF (Rec."No."<> xRec."No.") AND (CurrFieldNo = FIELDNO("No.")) THEN
                                                                  IF "OCR Imported Line" THEN
                                                                    RecreateImportLine(Rec);

                                                                //4PS
                                                                IF ClearDims4PS THEN BEGIN
                                                                  VALIDATE("Shortcut Dimension 1 Code",'');
                                                                  VALIDATE("Shortcut Dimension 2 Code",'');
                                                                END;


                                                                IF CurrFieldNo <> 0 THEN
                                                                  ExFWorkFlowMgt.CreateProposals(Rec,TRUE,FALSE,TRUE,TRUE);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=No.;
                                                              SVE=Nr] }
    { 7   ;   ;Location Code       ;Code10        ;TableRelation=Location WHERE (Use As In-Transit=CONST(No));
                                                   OnValidate=BEGIN
                                                                IF "Location Code" <> '' THEN
                                                                  IF IsServiceItem THEN
                                                                    Item.TESTFIELD(Type,Item.Type::Inventory);
                                                                IF xRec."Location Code" <> "Location Code" THEN BEGIN
                                                                  TESTFIELD("Qty. Rcd. Not Invoiced",0);
                                                                  TESTFIELD("Receipt No.",'');

                                                                  TESTFIELD("Return Qty. Shipped Not Invd.",0);
                                                                  TESTFIELD("Return Shipment No.",'');
                                                                END;

                                                                IF "Location Code" <> xRec."Location Code" THEN
                                                                  InitItemAppl;

                                                                "Bin Code" := '';

                                                                IF Type = Type::Item THEN
                                                                  UpdateDirectUnitCost(FIELDNO("Location Code"));
                                                              END;

                                                   CaptionML=[ENU=Location Code;
                                                              SVE=Lagerst„llekod] }
    { 8   ;   ;Posting Group       ;Code20        ;TableRelation=IF (Type=CONST(Item)) "Inventory Posting Group"
                                                                 ELSE IF (Type=CONST(Fixed Asset)) "FA Posting Group";
                                                   CaptionML=[ENU=Posting Group;
                                                              SVE=Bokf”ringsmall];
                                                   Editable=Yes }
    { 11  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              SVE=Beskrivning] }
    { 12  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              SVE=Beskrivning 2] }
    { 13  ;   ;Unit of Measure     ;Text10        ;CaptionML=[ENU=Unit of Measure;
                                                              SVE=Enhet] }
    { 15  ;   ;Quantity            ;Decimal       ;OnValidate=VAR
                                                                ExFlowSetup@1100285000 : Record 12013601;
                                                              BEGIN
                                                                "Quantity (Base)" := CalcBaseQty(Quantity);
                                                                IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
                                                                  IF (Quantity * "Return Qty. Shipped" < 0) OR
                                                                     ((ABS(Quantity) < ABS("Return Qty. Shipped")) AND ("Return Shipment No." = '')) THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text004,FIELDCAPTION("Return Qty. Shipped")));
                                                                  IF ("Quantity (Base)" * "Return Qty. Shipped (Base)" < 0) OR
                                                                     ((ABS("Quantity (Base)") < ABS("Return Qty. Shipped (Base)")) AND ("Return Shipment No." = ''))
                                                                  THEN
                                                                    FIELDERROR("Quantity (Base)",STRSUBSTNO(Text004,FIELDCAPTION("Return Qty. Shipped (Base)")));
                                                                END ELSE BEGIN
                                                                  IF (Quantity * "Quantity Received" < 0) OR
                                                                     ((ABS(Quantity) < ABS("Quantity Received")) AND ("Receipt No." = ''))
                                                                  THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text004,FIELDCAPTION("Quantity Received")));
                                                                  IF ("Quantity (Base)" * "Qty. Received (Base)" < 0) OR
                                                                     ((ABS("Quantity (Base)") < ABS("Qty. Received (Base)")) AND ("Receipt No." = ''))
                                                                  THEN
                                                                    FIELDERROR("Quantity (Base)",STRSUBSTNO(Text004,FIELDCAPTION("Qty. Received (Base)")));
                                                                END;

                                                                IF (Type = Type::"Charge (Item)") AND (CurrFieldNo <> 0) THEN BEGIN
                                                                  IF ((Quantity = 0) AND ("Qty. to Assign" <> 0)) THEN
                                                                    FIELDERROR("Qty. to Assign",STRSUBSTNO(Text011,FIELDCAPTION(Quantity),Quantity));
                                                                  IF (Quantity * "Qty. Assigned" < 0) OR (ABS(Quantity) < ABS("Qty. Assigned")) THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text004,FIELDCAPTION("Qty. Assigned")));
                                                                END;

                                                                IF (xRec.Quantity <> Quantity) OR (xRec."Quantity (Base)" <> "Quantity (Base)") OR
                                                                   (Rec."No." = xRec."No.")
                                                                THEN BEGIN
                                                                  InitOutstanding;
                                                                  IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
                                                                    InitQtyToShip
                                                                  ELSE
                                                                    InitQtyToReceive;
                                                                END;
                                                                IF (Quantity * xRec.Quantity < 0) OR (Quantity = 0) THEN
                                                                  InitItemAppl;

                                                                IF Type = Type::Item THEN
                                                                  UpdateDirectUnitCost(FIELDNO(Quantity))
                                                                ELSE
                                                                  VALIDATE("Line Discount %");

                                                                IF (xRec.Quantity <> Quantity) OR (xRec."Quantity (Base)" <> "Quantity (Base)") THEN BEGIN
                                                                  CheckApplToItemLedgEntry;
                                                                END;

                                                                IF (xRec.Quantity <> Quantity) AND (Quantity = 0) AND
                                                                   ((Amount <> 0) OR ("Amount Including VAT" <> 0) OR ("VAT Base Amount" <> 0))
                                                                THEN BEGIN
                                                                  Amount := 0;
                                                                  "Amount Including VAT" := 0;
                                                                  "VAT Base Amount" := 0;
                                                                END;

                                                                IF ("Document Type" = "Document Type"::Invoice) AND ("Prepayment %" <> 0) THEN
                                                                  UpdatePrePaymentAmounts;

                                                                ExFlowSetup.GET;
                                                                IF (ExFlowSetup."Order Applies-to" <> ExFlowSetup."Order Applies-to"::"Order not used") THEN BEGIN
                                                                  IF ("Return Shipment No." = '') AND ("Receipt No." = '') AND
                                                                     (("Order No. (Import)" <> '') OR (CurrFieldNo = FIELDNO(Quantity))) THEN
                                                                      "Outstanding Quantity (Order)" := Quantity;
                                                                END;

                                                                GetExfPurchDocHeader;
                                                                ExFlow.SetApproveForExFPurchLine(ExfPurchDocHead,Rec);

                                                                IF (Type <> Type::" ") AND (Quantity <> 0) AND
                                                                   ("Exflow-Created Entry" <> "Exflow-Created Entry"::DiffLine) THEN BEGIN
                                                                  SetReceiptNoMandatory(ExfPurchDocHead."Receipt No. Mandatory");
                                                                  IF "Receipt No." <> '' THEN
                                                                    "Receipt No. Mandatory" := TRUE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 16  ;   ;Outstanding Quantity;Decimal       ;CaptionML=[ENU=Outstanding Quantity;
                                                              SVE=Restnoterat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 17  ;   ;Qty. to Invoice     ;Decimal       ;OnValidate=BEGIN
                                                                IF "Qty. to Invoice" = MaxQtyToInvoice THEN
                                                                  InitQtyToInvoice
                                                                ELSE
                                                                  "Qty. to Invoice (Base)" := CalcBaseQty("Qty. to Invoice");
                                                                IF ("Qty. to Invoice" * Quantity < 0) OR (ABS("Qty. to Invoice") > ABS(MaxQtyToInvoice)) THEN
                                                                  ERROR(
                                                                    Text006,
                                                                    MaxQtyToInvoice);
                                                                IF ("Qty. to Invoice (Base)" * "Quantity (Base)" < 0) OR (ABS("Qty. to Invoice (Base)") > ABS(MaxQtyToInvoiceBase)) THEN
                                                                  ERROR(
                                                                    Text007,
                                                                    MaxQtyToInvoiceBase);
                                                                "VAT Difference" := 0;
                                                                CalcInvDiscToInvoice;
                                                                CalcPrepaymentToDeduct;

                                                                IF "Job Planning Line No." <> 0 THEN
                                                                  VALIDATE("Job Planning Line No.");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Invoice;
                                                              SVE=Ant. att fakturera];
                                                   DecimalPlaces=0:5 }
    { 18  ;   ;Qty. to Receive     ;Decimal       ;CaptionML=[ENU=Qty. to Receive;
                                                              SVE=Ant. att inlevereras];
                                                   DecimalPlaces=0:5 }
    { 22  ;   ;Direct Unit Cost    ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Line Discount %");
                                                              END;

                                                   CaptionML=[ENU=Direct Unit Cost;
                                                              SVE=Ink”pspris];
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Direct Unit Cost")) }
    { 23  ;   ;Unit Cost (LCY)     ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("No.");
                                                                TESTFIELD(Quantity);

                                                                IF CurrFieldNo = FIELDNO("Unit Cost (LCY)") THEN
                                                                  IF Type = Type::Item THEN BEGIN
                                                                    GetItem;
                                                                    IF Item."Costing Method" = Item."Costing Method"::Standard THEN
                                                                      ERROR(
                                                                        Text010,
                                                                        FIELDCAPTION("Unit Cost (LCY)"),Item.FIELDCAPTION("Costing Method"),Item."Costing Method");
                                                                  END;

                                                                UnitCostCurrency := "Unit Cost (LCY)";
                                                                GetExfPurchDocHeader;
                                                                IF ExfPurchDocHead."Currency Code" <> '' THEN BEGIN
                                                                  ExfPurchDocHead.TESTFIELD("Currency Factor");
                                                                  GetGLSetup;
                                                                  UnitCostCurrency :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtLCYToFCY(0,"Job No.", // 4PS
                                                                        GetDate,"Currency Code",
                                                                        "Unit Cost (LCY)",ExfPurchDocHead."Currency Factor",FALSE), // 4PS
                                                                      GLSetup."Unit-Amount Rounding Precision");
                                                                END;

                                                                IF ("Direct Unit Cost" <> 0) AND
                                                                   ("Direct Unit Cost" <> ("Line Discount Amount" / Quantity))
                                                                THEN
                                                                  "Indirect Cost %" :=
                                                                    ROUND(
                                                                      (UnitCostCurrency - "Direct Unit Cost" + "Line Discount Amount" / Quantity) /
                                                                      ("Direct Unit Cost" - "Line Discount Amount" / Quantity) * 100,0.00001)
                                                                ELSE
                                                                  "Indirect Cost %" := 0;

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Unit Cost (LCY)","Unit Cost (LCY)");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END
                                                              END;

                                                   CaptionML=[ENU=Unit Cost (LCY);
                                                              SVE=Styckkostnad (BVA)];
                                                   AutoFormatType=2 }
    { 25  ;   ;VAT %               ;Decimal       ;CaptionML=[ENU=VAT %;
                                                              SVE=Momssats %];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 27  ;   ;Line Discount %     ;Decimal       ;OnValidate=BEGIN
                                                                GetExfPurchDocHeader;
                                                                "Line Discount Amount" :=
                                                                  ROUND(
                                                                    ROUND(Quantity * "Direct Unit Cost",Currency."Amount Rounding Precision") *
                                                                    "Line Discount %" / 100,
                                                                    Currency."Amount Rounding Precision");
                                                                "Inv. Discount Amount" := 0;
                                                                "Inv. Disc. Amount to Invoice" := 0;
                                                                UpdateAmounts;
                                                                UpdateUnitCost;
                                                              END;

                                                   CaptionML=[ENU=Line Discount %;
                                                              SVE=Radrabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 28  ;   ;Line Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD(Quantity);
                                                                IF xRec."Line Discount Amount" <> "Line Discount Amount" THEN
                                                                  IF ROUND(Quantity * "Direct Unit Cost",Currency."Amount Rounding Precision") <> 0 THEN
                                                                    "Line Discount %" :=
                                                                      ROUND(
                                                                        "Line Discount Amount" /
                                                                        ROUND(Quantity * "Direct Unit Cost",Currency."Amount Rounding Precision") * 100,
                                                                        0.00001)
                                                                  ELSE
                                                                    "Line Discount %" := 0;
                                                                "Inv. Discount Amount" := 0;
                                                                "Inv. Disc. Amount to Invoice" := 0;
                                                                UpdateAmounts;
                                                                UpdateUnitCost;
                                                              END;

                                                   CaptionML=[ENU=Line Discount Amount;
                                                              SVE=Radrabatt];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 29  ;   ;Amount              ;Decimal       ;OnValidate=BEGIN
                                                                GetExfPurchDocHeader;
                                                                Amount := ROUND(Amount,Currency."Amount Rounding Precision");
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Normal VAT",
                                                                  "VAT Calculation Type"::"Reverse Charge VAT":
                                                                    BEGIN
                                                                      "VAT Base Amount" :=
                                                                        ROUND(Amount * (1 - ExfPurchDocHead."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                                                                      "Amount Including VAT" :=
                                                                        ROUND(Amount + "VAT Base Amount" * "VAT %" / 100,Currency."Amount Rounding Precision");
                                                                    END;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    IF Amount <> 0 THEN
                                                                      FIELDERROR(Amount,
                                                                        STRSUBSTNO(
                                                                          Text011,FIELDCAPTION("VAT Calculation Type"),
                                                                          "VAT Calculation Type"));
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    BEGIN
                                                                      ExfPurchDocHead.TESTFIELD("VAT Base Discount %",0);
                                                                      "VAT Base Amount" := Amount;
                                                                      IF "Use Tax" THEN
                                                                        "Amount Including VAT" := "VAT Base Amount"
                                                                      ELSE BEGIN
                                                                        "Amount Including VAT" :=
                                                                          Amount +
                                                                          ROUND(
                                                                            SalesTaxCalculate.CalculateTax(
                                                                              "Tax Area Code","Tax Group Code","Tax Liable",ExfPurchDocHead."Posting Date",
                                                                              "VAT Base Amount","Quantity (Base)",ExfPurchDocHead."Currency Factor"),
                                                                            Currency."Amount Rounding Precision");
                                                                        IF "VAT Base Amount" <> 0 THEN
                                                                          "VAT %" :=
                                                                            ROUND(100 * ("Amount Including VAT" - "VAT Base Amount") / "VAT Base Amount",0.00001)
                                                                        ELSE
                                                                          "VAT %" := 0;
                                                                      END;
                                                                    END;
                                                                END;

                                                                InitOutstandingAmount;
                                                                UpdateUnitCost;
                                                              END;

                                                   CaptionML=[ENU=Amount;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 30  ;   ;Amount Including VAT;Decimal       ;OnValidate=BEGIN
                                                                GetExfPurchDocHeader;
                                                                "Amount Including VAT" := ROUND("Amount Including VAT",Currency."Amount Rounding Precision");
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Normal VAT",
                                                                  "VAT Calculation Type"::"Reverse Charge VAT":
                                                                    BEGIN
                                                                      Amount :=
                                                                        ROUND(
                                                                          "Amount Including VAT" /
                                                                          (1 + (1 - ExfPurchDocHead."VAT Base Discount %" / 100) * "VAT %" / 100),
                                                                          Currency."Amount Rounding Precision");
                                                                      "VAT Base Amount" :=
                                                                        ROUND(Amount * (1 - ExfPurchDocHead."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                                                                    END;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    BEGIN
                                                                      Amount := 0;
                                                                      "VAT Base Amount" := 0;
                                                                    END;
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    BEGIN
                                                                      ExfPurchDocHead.TESTFIELD("VAT Base Discount %",0);
                                                                      IF "Use Tax" THEN BEGIN
                                                                        Amount := "Amount Including VAT";
                                                                        "VAT Base Amount" := Amount;
                                                                      END ELSE BEGIN
                                                                        Amount :=
                                                                          ROUND(
                                                                            SalesTaxCalculate.ReverseCalculateTax(
                                                                              "Tax Area Code","Tax Group Code","Tax Liable",ExfPurchDocHead."Posting Date",
                                                                              "Amount Including VAT","Quantity (Base)",ExfPurchDocHead."Currency Factor"),
                                                                            Currency."Amount Rounding Precision");
                                                                        "VAT Base Amount" := Amount;
                                                                        IF "VAT Base Amount" <> 0 THEN
                                                                          "VAT %" :=
                                                                            ROUND(100 * ("Amount Including VAT" - "VAT Base Amount") / "VAT Base Amount",0.00001)
                                                                        ELSE
                                                                          "VAT %" := 0;
                                                                      END;
                                                                    END;
                                                                END;

                                                                InitOutstandingAmount;
                                                                UpdateUnitCost;
                                                              END;

                                                   CaptionML=[ENU=Amount Including VAT;
                                                              SVE=Belopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 32  ;   ;Allow Invoice Disc. ;Boolean       ;InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                IF ("Allow Invoice Disc." <> xRec."Allow Invoice Disc.") AND
                                                                   (NOT "Allow Invoice Disc.")
                                                                THEN BEGIN
                                                                  "Inv. Discount Amount" := 0;
                                                                  "Inv. Disc. Amount to Invoice" := 0;
                                                                  UpdateAmounts;
                                                                  UpdateUnitCost;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Allow Invoice Disc.;
                                                              SVE=Ber„kna fakturarabatt] }
    { 34  ;   ;Gross Weight        ;Decimal       ;CaptionML=[ENU=Gross Weight;
                                                              SVE=Bruttovikt];
                                                   DecimalPlaces=0:5 }
    { 35  ;   ;Net Weight          ;Decimal       ;CaptionML=[ENU=Net Weight;
                                                              SVE=Nettovikt];
                                                   DecimalPlaces=0:5 }
    { 36  ;   ;Units per Parcel    ;Decimal       ;CaptionML=[ENU=Units per Parcel;
                                                              SVE=Antal per kolli];
                                                   DecimalPlaces=0:5 }
    { 37  ;   ;Unit Volume         ;Decimal       ;CaptionML=[ENU=Unit Volume;
                                                              SVE=Volym];
                                                   DecimalPlaces=0:5 }
    { 38  ;   ;Appl.-to Item Entry ;Integer       ;OnValidate=BEGIN
                                                                IF "Appl.-to Item Entry" <> 0 THEN
                                                                  "Location Code" := CheckApplToItemLedgEntry;
                                                              END;

                                                   OnLookup=BEGIN
                                                              SelectItemEntry;
                                                            END;

                                                   CaptionML=[ENU=Appl.-to Item Entry;
                                                              SVE=Koppla till artikell”pnr] }
    { 40  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=BEGIN
                                                                //**4PS.sn
                                                                //CheckCompanyIC;
                                                                IF "Shortcut Dimension 1 Code" <> '' THEN
                                                                  DimMgt.GetDimValueRec(1, "Shortcut Dimension 1 Code", DimVal1Rec, TRUE,'');
                                                                //**4PS.en

                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS.sn
                                                              OnLookupDim1Code(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Shortcut Dimension 1 Code;
                                                              SVE=Genv„g dimension 1 kod];
                                                   CaptionClass='1,2,1' }
    { 41  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                xDimValRec@1001 : Record 349;
                                                                lvCompName@1000 : Text[50];
                                                                TempRec@1100285000 : Record 12013588;
                                                              BEGIN
                                                                //>> 4PS
                                                                IF "Shortcut Dimension 2 Code" <> '' THEN BEGIN
                                                                  CheckCompanyIC;
                                                                  DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimVal2Rec, TRUE, "Job No.");

                                                                  DimVal2Rec.TESTFIELD(Blocked, FALSE);
                                                                  "Cost Component" := DimVal2Rec."Cost Component";
                                                                  IF "Cost Type" = "Cost Type"::" " THEN BEGIN
                                                                    HideDialog := TRUE;
                                                                    VALIDATE("Cost Type", DimVal2Rec."Cost Type" + 1); //Call 26946
                                                                    HideDialog := FALSE;
                                                                  END;
                                                                  IF "Cost Type" <> DimVal2Rec."Cost Type" + 1 THEN
                                                                    FIELDERROR("Cost Type", Text11012000);
                                                                  CheckCostTypeOrder;
                                                                  IF "Cost Type" <> xRec."Cost Type" THEN
                                                                    CheckCostTypeCondition;  //db, 11-02-11: M25031

                                                                  //IF "Receiving Company" <> '' THEN
                                                                  //  lvCompName := "Receiving Company"
                                                                  // ELSE
                                                                    lvCompName := COMPANYNAME;
                                                                  TempRec := Rec;
                                                                  //4PS
                                                                  IF "Service Order No." <> '' THEN BEGIN
                                                                    //******* Service Order *********************************************************
                                                                    IF ServOrderRec.GET("Service Order No.") THEN;
                                                                      ServOrderRec.TESTFIELD("Service Type");
                                                                      ServTypeRec.GET(ServOrderRec."Service Type");
                                                                    //END;

                                                                    "No." := ServTypeRec.GetWipAcc(ServTypeRec.Code,
                                                                                                   DimVal2Rec."Cost Type",
                                                                                                   lvCompName,
                                                                                                   "Cost Type",
                                                                                                   "Buy-from Vendor No.",'');

                                                                    VALIDATE("No.");
                                                                    VALIDATE("Shortcut Dimension 1 Code", ServOrderRec."Global Dimension 1 Code");
                                                                    IF xRec."No." <> "No." THEN BEGIN
                                                                      "Service Order No." := TempRec."Service Order No.";
                                                                      "Shortcut Dimension 1 Code" := TempRec."Shortcut Dimension 1 Code";
                                                                      "Shortcut Dimension 2 Code" := TempRec."Shortcut Dimension 2 Code";
                                                                    END;
                                                                  END ELSE BEGIN
                                                                  //4PS
                                                                  //******* Project *********************************************************
                                                                  IF "Job No." <> '' THEN BEGIN
                                                                    ProjRec.GET("Job No.");
                                                                    ProjRec.TESTFIELD("Project Type");
                                                                    ProjTypeRec.GET(ProjRec."Project Type");
                                                                    //IF NOT ReleaseRetention THEN
                                                                      "No." := ProjTypeRec.GetWipAcc(ProjTypeRec.Code,
                                                                                                     DimVal2Rec."Cost Type",
                                                                                                     ProjRec."Project Status",
                                                                                                     ICProjSetupRec."Provisions at Closure",
                                                                                                     lvCompName,
                                                                                                     "Cost Type", PurchHeader."Buy-from Vendor No.",'');
                                                                    IF xRec."No." <> "No." THEN BEGIN
                                                                      VALIDATE("No.");
                                                                      "Cost Type" := TempRec."Cost Type";
                                                                      "Cost Component" :=TempRec."Cost Component";

                                                                      "Shortcut Dimension 2 Code" := TempRec."Shortcut Dimension 2 Code";
                                                                      "Shortcut Dimension 1 Code" := TempRec."Shortcut Dimension 1 Code";
                                                                      "Job No." := TempRec."Job No.";
                                                                      //"Main Project No." := TempRec."Main Project No.";
                                                                      GLAcc.GET("No.");
                                                                      Description := GLAcc.Name;
                                                                    //**4PS05.sn
                                                                      IF DimVal2Rec.Element <> '' THEN
                                                                        IF "Job No." <> '' THEN
                                                                          VALIDATE(Element, DimVal2Rec.Element);
                                                                    END;
                                                                    //**4PS05.en
                                                                  END;

                                                                  IF ("Item No." + "Basic Item" + "Trade Item" = '') THEN BEGIN
                                                                    IF ("Shortcut Dimension 2 Code" <> xRec."Shortcut Dimension 2 Code") OR
                                                                       ("Job No." <> xRec."Job No.") OR
                                                                       (Description = '') THEN
                                                                    BEGIN
                                                                      IF Description = '' THEN
                                                                        Description := DimVal2Rec.Name
                                                                      ELSE BEGIN
                                                                        //xDimValRec.CHANGECOMPANY(xRec."Receiving Company");
                                                                        DimMgt.GetDimValueRec(2, xRec."Shortcut Dimension 2 Code", xDimValRec, FALSE, xRec."Job No.");
                                                                        IF (Description = xDimValRec.Name) THEN
                                                                          Description := DimVal2Rec.Name;
                                                                      END;
                                                                      IF DimVal2Rec."Unit of Measure" <> '' THEN //**4PSmg.c, 26-09-12
                                                                        "Unit of Measure Code" := DimVal2Rec."Unit of Measure";
                                                                    END;
                                                                  END;
                                                                  //CheckCostCompServOrderType; //** 4PS06.n
                                                                  CheckCostTypeOrder;
                                                                                                                                  END;
                                                                END;
                                                                //<< 4PS
                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                              END;

                                                   OnLookup=VAR
                                                              Dim2Editable@1000000000 : Boolean;
                                                            BEGIN
                                                              //**4PS.sn
                                                              Dim2Editable := TRUE;
                                                              OnLookupDim2Code(Dim2Editable);
                                                            END;

                                                   CaptionML=[ENU=Shortcut Dimension 2 Code;
                                                              SVE=Genv„g dimension 2 kod];
                                                   CaptionClass='1,2,2' }
    { 45  ;   ;Job No.             ;Code20        ;TableRelation=Job;
                                                   OnValidate=VAR
                                                                Job@1100285000 : Record 11072003;
                                                                xDimValRec@1000 : Record 349;
                                                                Plot@1001 : Record 11012500;
                                                              BEGIN
                                                                { *** Exflow org
                                                                TESTFIELD("Receipt No.",'');
                                                                IF "Document Type" = "Document Type"::Order THEN
                                                                  TESTFIELD("Quantity Received",0);

                                                                IF "Job No." <> xRec."Job No." THEN BEGIN
                                                                  VALIDATE("Job Task No.",'');
                                                                  VALIDATE("Job Planning Line No.",0);
                                                                END;

                                                                IF "Job No." = '' THEN BEGIN
                                                                  CreateDim(
                                                                    DATABASE::Job,"Job No.",
                                                                    DimMgt.TypeToTableID3(Type),"No.",
                                                                    DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                    0,'');
                                                                  EXIT;
                                                                END;

                                                                IF NOT (Type IN [Type::Item,Type::"G/L Account"]) THEN
                                                                  FIELDERROR("Job No.",STRSUBSTNO(Text012,FIELDCAPTION(Type),Type));
                                                                Job.GET("Job No.");
                                                                Job.TestBlocked;
                                                                "Job Currency Code" := Job."Currency Code";

                                                                CreateDim(
                                                                  DATABASE::Job,"Job No.",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  0,'');
                                                                *** }

                                                                //>> 4PS
                                                                //IF "Job No." <> '' THEN
                                                                //  TESTFIELD("Service Order No.", '');
                                                                //TESTFIELD("Drop Shipment",FALSE);
                                                                //TESTFIELD("Special Order",FALSE);

                                                                TESTFIELD("Receipt No.",'');
                                                                IF "Document Type" = "Document Type"::Order THEN
                                                                  TESTFIELD("Quantity Received",0);

                                                                //IF ReservEntryExist THEN
                                                                //  TESTFIELD("Job No.",'');

                                                                IF "Job No." <> xRec."Job No." THEN BEGIN
                                                                  VALIDATE("Job Task No.",'');
                                                                  VALIDATE("Job Planning Line No.",0);
                                                                END;

                                                                //TestStatusOpen;
                                                                CheckCompanyIC;
                                                                IF "Document Type" = "Document Type"::Order THEN BEGIN
                                                                  TESTFIELD("Qty. Rcd. Not Invoiced",0);
                                                                  { **
                                                                  TESTFIELD("Reserved Qty. (Base)",0);
                                                                  GetPurchHeader;
                                                                  IF PurchHeader."Amounts only" THEN BEGIN
                                                                    TESTFIELD("Amt. Rcd. Not Invoiced",0);
                                                                    TESTFIELD("Amnt. Received",0);
                                                                  END;
                                                                  ** }
                                                                END;
                                                                IF "Job No." <> '' THEN BEGIN
                                                                  CheckProjectStatus(FALSE);
                                                                  "Main Project No." := ProjRec."Main Project";
                                                                  //CALCFIELDS("Job Description");
                                                                  Type := Type::"G/L Account";
                                                                  //IF ("Rental Unit" <> '') THEN
                                                                  //  VALIDATE("Rental Unit");
                                                                  //Job.CHANGECOMPANY("Receiving Company");
                                                                //**4PS.en
                                                                  IF NOT (Type IN [Type::Item,Type::"G/L Account"]) THEN
                                                                    FIELDERROR("Job No.",STRSUBSTNO(Text012,FIELDCAPTION(Type),Type));
                                                                  Job.GET("Job No.");
                                                                  Job.TestBlocked;
                                                                  "Job Currency Code" := Job."Currency Code";
                                                                //**4PS.sn
                                                                  //"Job Description" := Job.Description; //kkleermaker.n, 130902, C004024
                                                                END ELSE BEGIN
                                                                  "Main Project No." := '';
                                                                  //"Inward Processing Relief" := FALSE;
                                                                  //"Rental Unit" := '';
                                                                  //IF "Service Order No." <> '' THEN BEGIN
                                                                  //  Type := Type::"G/L Account";
                                                                  //END ELSE BEGIN
                                                                    IF "Item No." <> '' THEN BEGIN
                                                                      Type := Type::Item;
                                                                      "No." := "Item No.";
                                                                    END ELSE BEGIN
                                                                      "No." := '';
                                                                    END;
                                                                  //END;
                                                                END;
                                                                FillSystemCreatedEntry;
                                                                IF ("Shortcut Dimension 1 Code" <> '') AND ("Job No." <> '') AND
                                                                   (CurrFieldNo = FIELDNO("Job No.")) AND ("Job No." <> xRec."Job No.") THEN
                                                                  "Shortcut Dimension 1 Code" := '';
                                                                IF "Shortcut Dimension 2 Code" <> '' THEN BEGIN
                                                                  VALIDATE("Shortcut Dimension 2 Code");
                                                                  IF ("Item No." = '') AND (Manufacturer = '') AND ("Vendor (Trade Item)" = '') AND
                                                                     (CurrFieldNo = FIELDNO("Job No.")) AND ("Job No." <> xRec."Job No.")
                                                                  THEN BEGIN
                                                                    IF Description = '' THEN
                                                                      Description := DimVal2Rec.Name
                                                                    ELSE BEGIN
                                                                      DimMgt.GetDimValueRec(2, xRec."Shortcut Dimension 2 Code", xDimValRec, FALSE, xRec."Job No.");
                                                                      IF Description = xDimValRec.Name THEN
                                                                        Description := DimVal2Rec.Name;
                                                                    END;
                                                                  END;
                                                                END;

                                                                IF Element <> '' THEN
                                                                  IF NOT ProjElemRec.GET("Job No.",Element) THEN
                                                                    VALIDATE(Element, '');
                                                                IF "Plot No." <> '' THEN
                                                                  IF NOT Plot.GET("Job No.","Plot No.") THEN
                                                                    VALIDATE("Plot No.", '');

                                                                //IF "Document Type" = "Document Type"::Order THEN
                                                                //  IF PurchHeader."Amounts only" THEN
                                                                //    InitAmntToReceive
                                                                //  ELSE
                                                                //    InitQtyToReceive;

                                                                //** DP0121
                                                                //IF "Job No." <> xRec."Job No." THEN
                                                                //  IF (Quantity <> 0) AND NSItemExists(xRec."Item No.") THEN
                                                                //    ReservePurchLine.VerifyChange(Rec,xRec);
                                                                //**4PS.en

                                                                //**4PS.sn 25-03-2010
                                                                IF ("Job No." <> xRec."Job No.") AND
                                                                   (CurrFieldNo = FIELDNO("Job No.")) THEN
                                                                BEGIN
                                                                  "Shortcut Dimension 1 Code" := Job."Global Dimension 1 Code";
                                                                END;
                                                                //**4PS.en 25-03-2010
                                                                CreateDim4PS(
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Plant Number", DimMgt.MakeCombinedPlantNo("Plant Type","Plant No."), //**4PS.n
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Service Order",'', //"Service Order No.", //** 4PS 09-06-2010
                                                                  DATABASE::"Responsibility Center",'', //"Responsibility Center",
                                                                  DATABASE::"Work Center","Work Center No.");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n  //*C007227.o


                                                                //**4PS.sn
                                                                //IF NOT CreateFromReqLine THEN
                                                                //  StrategicPurchMgt.FindContractForPurchaseLine(Rec);
                                                                //IF ("Job No." <> xRec."Job No.") THEN BEGIN //*DP00129
                                                                //  GetPurchHeader;
                                                                //  IF NOT (FscTypeOnHeaderLevelAllowed() AND (PurchHeader."FSC Type Code" <> '')) THEN
                                                                //    FillDefaultFscType();
                                                                //END;
                                                                //**4PS.en

                                                                //ClearEditableAssemYardNoFields; //**4PS.n
                                                                //<< 4PS
                                                              END;

                                                   CaptionML=[ENU=Job No.;
                                                              SVE=Projektnr] }
    { 54  ;   ;Indirect Cost %     ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("No.");

                                                                IF Type = Type::"Charge (Item)" THEN
                                                                  TESTFIELD("Indirect Cost %",0);

                                                                IF (Type = Type::Item) THEN BEGIN
                                                                  GetItem;
                                                                  IF Item."Costing Method" = Item."Costing Method"::Standard THEN
                                                                    ERROR(
                                                                      Text010,
                                                                      FIELDCAPTION("Indirect Cost %"),Item.FIELDCAPTION("Costing Method"),Item."Costing Method");
                                                                END;

                                                                UpdateUnitCost;
                                                              END;

                                                   CaptionML=[ENU=Indirect Cost %;
                                                              SVE=Indirekt kostnad %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0 }
    { 57  ;   ;Outstanding Amount  ;Decimal       ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetExfPurchDocHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF ExfPurchDocHead."Currency Code" <> '' THEN
                                                                  "Outstanding Amount (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(0,"Job No.",
                                                                        GetDate,"Currency Code",
                                                                        "Outstanding Amount",ExfPurchDocHead."Currency Factor",FALSE), // 4PS
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Outstanding Amount (LCY)" :=
                                                                    ROUND("Outstanding Amount",Currency2."Amount Rounding Precision");

                                                                "Outstanding Amt. Ex. VAT (LCY)" :=
                                                                  ROUND("Outstanding Amount (LCY)" / (1 + "VAT %" / 100),Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Outstanding Amount;
                                                              SVE=Utest†ende belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 58  ;   ;Qty. Rcd. Not Invoiced;Decimal     ;CaptionML=[ENU=Qty. Rcd. Not Invoiced;
                                                              SVE=Inlevrd. antal ej faktrd.];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 59  ;   ;Amt. Rcd. Not Invoiced;Decimal     ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetExfPurchDocHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF ExfPurchDocHead."Currency Code" <> '' THEN
                                                                  "Amt. Rcd. Not Invoiced (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(0,"Job No.", // 4PS
                                                                        GetDate,"Currency Code",
                                                                        "Amt. Rcd. Not Invoiced",ExfPurchDocHead."Currency Factor",FALSE), // 4PS
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Amt. Rcd. Not Invoiced (LCY)" :=
                                                                    ROUND("Amt. Rcd. Not Invoiced",Currency2."Amount Rounding Precision");

                                                                "A. Rcd. Not Inv. Ex. VAT (LCY)" :=
                                                                  ROUND("Amt. Rcd. Not Invoiced (LCY)" / (1 + "VAT %" / 100),Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Amt. Rcd. Not Invoiced;
                                                              SVE=Inlevererat bel. ej faktrd];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 60  ;   ;Quantity Received   ;Decimal       ;CaptionML=[ENU=Quantity Received;
                                                              SVE=Inlevererat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 61  ;   ;Quantity Invoiced   ;Decimal       ;CaptionML=[ENU=Quantity Invoiced;
                                                              SVE=Fakturerat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 63  ;   ;Receipt No.         ;Code20        ;TableRelation="Purch. Rcpt. Line"."Document No.";
                                                   CaptionML=[ENU=Receipt No.;
                                                              SVE=Inleveransnr];
                                                   Editable=No }
    { 64  ;   ;Receipt Line No.    ;Integer       ;CaptionML=[ENU=Receipt Line No.;
                                                              SVE=Inleveransradnr];
                                                   Editable=No }
    { 68  ;   ;Pay-to Vendor No.   ;Code20        ;TableRelation=Vendor;
                                                   CaptionML=[ENU=Pay-to Vendor No.;
                                                              SVE=Betalas leverant”rsnr];
                                                   Editable=No }
    { 69  ;   ;Inv. Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                                UpdateUnitCost;
                                                                CalcInvDiscToInvoice;
                                                              END;

                                                   CaptionML=[ENU=Inv. Discount Amount;
                                                              SVE=Fakturarabatt];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 70  ;   ;Vendor Item No.     ;Text20        ;CaptionML=[ENU=Vendor Item No.;
                                                              SVE=Leverant”rens artikelnr] }
    { 71  ;   ;Sales Order No. (Order);Code20     ;TableRelation=IF (Drop Shipment (Order)=CONST(Yes)) "Sales Header".No. WHERE (Document Type=CONST(Order));
                                                   CaptionML=[ENU=Sales Order No. (Order);
                                                              SVE=F”rs.ordernr (Order)];
                                                   Editable=No }
    { 72  ;   ;Sales Order Line No. (Order);Integer;
                                                   TableRelation=IF (Drop Shipment (Order)=CONST(Yes)) "Sales Line"."Line No." WHERE (Document Type=CONST(Order),
                                                                                                                                      Document No.=FIELD("Sales Order No. (Order)"));
                                                   CaptionML=[ENU=Sales Order Line No. (Order);
                                                              SVE=F”rs.orderradnr (Order)];
                                                   Editable=No }
    { 73  ;   ;Drop Shipment (Order);Boolean      ;CaptionML=[ENU=Drop Shipment (Order);
                                                              SVE=Direktutleverans (Order)];
                                                   Editable=No }
    { 74  ;   ;Gen. Bus. Posting Group;Code20     ;TableRelation="Gen. Business Posting Group";
                                                   OnValidate=BEGIN
                                                                IF xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group" THEN
                                                                  IF GenBusPostingGrp.ValidateVatBusPostingGroup(GenBusPostingGrp,"Gen. Bus. Posting Group") THEN
                                                                    VALIDATE("VAT Bus. Posting Group",GenBusPostingGrp."Def. VAT Bus. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Gen. Bus. Posting Group;
                                                              SVE=Gen. r”relsebokf”ringsmall] }
    { 75  ;   ;Gen. Prod. Posting Group;Code20    ;TableRelation="Gen. Product Posting Group";
                                                   OnValidate=BEGIN
                                                                IF xRec."Gen. Prod. Posting Group" <> "Gen. Prod. Posting Group" THEN
                                                                  IF GenProdPostingGrp.ValidateVatProdPostingGroup(GenProdPostingGrp,"Gen. Prod. Posting Group") THEN
                                                                    VALIDATE("VAT Prod. Posting Group",GenProdPostingGrp."Def. VAT Prod. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Gen. Prod. Posting Group;
                                                              SVE=Produktbokf”ringsmall] }
    { 77  ;   ;VAT Calculation Type;Option        ;CaptionML=[ENU=VAT Calculation Type;
                                                              SVE=Momsber„kningstyp];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    SVE=Normal moms,Omv„nd EG-moms,Enbart moms,Oms„ttningsskatt];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax }
    { 80  ;   ;Attached to Line No.;Integer       ;CaptionML=[ENU=Attached to Line No.;
                                                              SVE=Bifogad till radnr] }
    { 81  ;   ;Entry Point         ;Code10        ;TableRelation="Entry/Exit Point";
                                                   CaptionML=[ENU=Entry Point;
                                                              SVE=Inskeppningshamn] }
    { 82  ;   ;Area                ;Code10        ;TableRelation=Area;
                                                   CaptionML=[ENU=Area;
                                                              SVE=Omr†de] }
    { 83  ;   ;Transaction Specification;Code10   ;TableRelation="Transaction Specification";
                                                   CaptionML=[ENU=Transaction Specification;
                                                              SVE=EU transaktionsspecifikation] }
    { 85  ;   ;Tax Area Code       ;Code20        ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Area Code;
                                                              SVE=Skatteomr†deskod] }
    { 86  ;   ;Tax Liable          ;Boolean       ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Liable;
                                                              SVE=Skattepliktig] }
    { 87  ;   ;Tax Group Code      ;Code10        ;TableRelation="Tax Group";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Group Code;
                                                              SVE=Skattegruppskod] }
    { 88  ;   ;Use Tax             ;Boolean       ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Use Tax;
                                                              SVE=Anv„nd skatt] }
    { 89  ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=BEGIN
                                                                VALIDATE("VAT Prod. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 90  ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=BEGIN
                                                                VATPostingSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group");
                                                                "VAT Difference" := 0;
                                                                "VAT %" := VATPostingSetup."VAT %";
                                                                "VAT Calculation Type" := VATPostingSetup."VAT Calculation Type";
                                                                "VAT Identifier" := VATPostingSetup."VAT Identifier";
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Reverse Charge VAT",
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    "VAT %" := 0;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    BEGIN
                                                                      TESTFIELD(Type,Type::"G/L Account");
                                                                      VATPostingSetup.TESTFIELD("Purchase VAT Account");
                                                                      TESTFIELD("No.",VATPostingSetup."Purchase VAT Account");
                                                                    END;
                                                                END;
                                                                IF ExfPurchDocHead."Prices Including VAT" AND (Type = Type::Item) THEN
                                                                  "Direct Unit Cost" :=
                                                                    ROUND(
                                                                      "Direct Unit Cost" * (100 + "VAT %") / (100 + xRec."VAT %"),
                                                                      Currency."Unit-Amount Rounding Precision");
                                                                UpdateAmounts;

                                                                IF ("VAT Prod. Posting Group" <> xRec."VAT Prod. Posting Group") AND ("VAT Prod. Posting Group" <> '') THEN
                                                                  IF (CurrFieldNo = FIELDNO("VAT Prod. Posting Group")) OR (CurrFieldNo = FIELDNO("Gen. Prod. Posting Group")) THEN
                                                                    ExFlow.SetApproveForExFPurchLine(ExfPurchDocHead,Rec);
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 91  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   CaptionML=[ENU=Currency Code;
                                                              SVE=Valutakod];
                                                   Editable=No }
    { 92  ;   ;Outstanding Amount (LCY);Decimal   ;CaptionML=[ENU=Outstanding Amount (LCY);
                                                              SVE=Utest†ende belopp (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 93  ;   ;Amt. Rcd. Not Invoiced (LCY);Decimal;
                                                   CaptionML=[ENU=Amt. Rcd. Not Invoiced (LCY);
                                                              SVE=Inlevns bel. ej faktrd (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 99  ;   ;VAT Base Amount     ;Decimal       ;CaptionML=[ENU=VAT Base Amount;
                                                              SVE=Nettobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 100 ;   ;Unit Cost           ;Decimal       ;CaptionML=[ENU=Unit Cost;
                                                              SVE=Styckkostnad];
                                                   Editable=No;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 101 ;   ;System-Created Entry;Boolean       ;CaptionML=[ENU=System-Created Entry;
                                                              SVE=Systemkreerad trans.];
                                                   Editable=No }
    { 103 ;   ;Line Amount         ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD(Type);
                                                                TESTFIELD(Quantity);
                                                                TESTFIELD("Direct Unit Cost");

                                                                GetExfPurchDocHeader;
                                                                "Line Amount" := ROUND("Line Amount",Currency."Amount Rounding Precision");
                                                                VALIDATE(
                                                                  "Line Discount Amount",ROUND(Quantity * "Direct Unit Cost",Currency."Amount Rounding Precision") - "Line Amount");
                                                              END;

                                                   CaptionML=[ENU=Line Amount;
                                                              SVE=Radbelopp];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Line Amount")) }
    { 104 ;   ;VAT Difference      ;Decimal       ;CaptionML=[ENU=VAT Difference;
                                                              SVE=Momsdifferens];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 105 ;   ;Inv. Disc. Amount to Invoice;Decimal;
                                                   CaptionML=[ENU=Inv. Disc. Amount to Invoice;
                                                              SVE=Fakturarabatt att fakturera];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 106 ;   ;VAT Identifier      ;Code10        ;CaptionML=[ENU=VAT Identifier;
                                                              SVE=Moms-ID];
                                                   Editable=No }
    { 109 ;   ;Prepayment %        ;Decimal       ;OnValidate=VAR
                                                                GenPostingSetup@1001 : Record 252;
                                                                GLAcc@1000 : Record 15;
                                                              BEGIN
                                                                IF ("Prepayment %" <> 0) AND (Type <> Type::" ") THEN BEGIN
                                                                  TESTFIELD("Document Type","Document Type"::Order);
                                                                  TESTFIELD("No.");
                                                                  GenPostingSetup.GET("Gen. Bus. Posting Group","Gen. Prod. Posting Group");
                                                                  IF GenPostingSetup."Purch. Prepayments Account" <> '' THEN BEGIN
                                                                    GLAcc.GET(GenPostingSetup."Purch. Prepayments Account");
                                                                    VATPostingSetup.GET("VAT Bus. Posting Group",GLAcc."VAT Prod. Posting Group");
                                                                  END ELSE
                                                                    CLEAR(VATPostingSetup);
                                                                  "Prepayment VAT %" := VATPostingSetup."VAT %";
                                                                  "Prepmt. VAT Calc. Type" := VATPostingSetup."VAT Calculation Type";
                                                                  "Prepayment VAT Identifier" := VATPostingSetup."VAT Identifier";
                                                                  CASE "Prepmt. VAT Calc. Type" OF
                                                                    "VAT Calculation Type"::"Reverse Charge VAT",
                                                                    "VAT Calculation Type"::"Sales Tax":
                                                                      "Prepayment VAT %" := 0;
                                                                    "VAT Calculation Type"::"Full VAT":
                                                                      FIELDERROR("Prepmt. VAT Calc. Type",STRSUBSTNO(Text036,"Prepmt. VAT Calc. Type"));
                                                                  END;
                                                                  "Prepayment Tax Group Code" := GLAcc."Tax Group Code";
                                                                END;

                                                                IF Type <> Type::" " THEN
                                                                  UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment %;
                                                              SVE=F”rskottsbetalning %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 110 ;   ;Prepmt. Line Amount ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Line Amount");
                                                                IF "Prepmt. Line Amount" < "Prepmt. Amt. Inv." THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text038,"Prepmt. Amt. Inv."));
                                                                IF "Prepmt. Line Amount" > "Line Amount" THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text039,"Line Amount"));
                                                                IF Quantity <> 0 THEN
                                                                  VALIDATE("Prepayment %",ROUND("Prepmt. Line Amount" /
                                                                      ("Line Amount" * (Quantity - "Quantity Invoiced") / Quantity) * 100,0.00001))
                                                                ELSE
                                                                  VALIDATE("Prepayment %",ROUND("Prepmt. Line Amount" * 100 / "Line Amount",0.00001));
                                                              END;

                                                   CaptionML=[ENU=Prepmt. Line Amount;
                                                              SVE=Radbelopp, f”rskottsbetalning];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt. Line Amount")) }
    { 111 ;   ;Prepmt. Amt. Inv.   ;Decimal       ;CaptionML=[ENU=Prepmt. Amt. Inv.;
                                                              SVE=Fakturabelopp, f”rskottsbetalning];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt. Amt. Inv.")) }
    { 112 ;   ;Prepmt. Amt. Incl. VAT;Decimal     ;CaptionML=[ENU=Prepmt. Amt. Incl. VAT;
                                                              SVE=F”rskottsbetalningsbelopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 113 ;   ;Prepayment Amount   ;Decimal       ;CaptionML=[ENU=Prepayment Amount;
                                                              SVE=F”rskottsbetalningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 114 ;   ;Prepmt. VAT Base Amt.;Decimal      ;CaptionML=[ENU=Prepmt. VAT Base Amt.;
                                                              SVE=Nettobelopp, f”rskottsbetalning];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 115 ;   ;Prepayment VAT %    ;Decimal       ;CaptionML=[ENU=Prepayment VAT %;
                                                              SVE=Moms f”r f”rskottsbetalning %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   Editable=No }
    { 116 ;   ;Prepmt. VAT Calc. Type;Option      ;CaptionML=[ENU=Prepmt. VAT Calc. Type;
                                                              SVE=Momsber„kningstyp, f”rskottsbetalning];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    SVE=Normal moms,Omv„nd EG-moms,Enbart moms,Oms„ttningsskatt];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                   Editable=No }
    { 117 ;   ;Prepayment VAT Identifier;Code10   ;CaptionML=[ENU=Prepayment VAT Identifier;
                                                              SVE=Moms-ID, f”rskottsbetalning];
                                                   Editable=No }
    { 118 ;   ;Prepayment Tax Area Code;Code20    ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Area Code;
                                                              SVE=Skatteomr†deskod, f”rskottsbetalning] }
    { 119 ;   ;Prepayment Tax Liable;Boolean      ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Liable;
                                                              SVE=Skattepliktig f”rskottsbetalning] }
    { 120 ;   ;Prepayment Tax Group Code;Code10   ;TableRelation="Tax Group";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Group Code;
                                                              SVE=Skattegruppskod, f”rskottsbetalning] }
    { 121 ;   ;Prepmt Amt to Deduct;Decimal       ;OnValidate=BEGIN
                                                                IF "Prepmt Amt to Deduct" > "Prepmt. Amt. Inv." - "Prepmt Amt Deducted" THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text039,"Prepmt. Amt. Inv." - "Prepmt Amt Deducted"));

                                                                IF "Prepmt Amt to Deduct" > "Qty. to Invoice" * "Prepmt Amt Deducted" THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text039,"Qty. to Invoice" * "Prepmt Amt Deducted"));
                                                              END;

                                                   CaptionML=[ENU=Prepmt Amt to Deduct;
                                                              SVE=F”rskottsbetalning att dra av];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt Amt to Deduct")) }
    { 122 ;   ;Prepmt Amt Deducted ;Decimal       ;CaptionML=[ENU=Prepmt Amt Deducted;
                                                              SVE=Avdragen f”rskottsbetalning];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt Amt Deducted")) }
    { 123 ;   ;Prepayment Line     ;Boolean       ;CaptionML=[ENU=Prepayment Line;
                                                              SVE=F”rskottsbetalningsrad];
                                                   Editable=No }
    { 124 ;   ;Prepmt. Amount Inv. Incl. VAT;Decimal;
                                                   CaptionML=[ENU=Prepmt. Amount Inv. Incl. VAT;
                                                              SVE=Fakturerad f”rskottsbetalning inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 129 ;   ;Prepmt. Amount Inv. (LCY);Decimal  ;CaptionML=[ENU=Prepmt. Amount Inv. (LCY);
                                                              SVE=Fakturerad f”rskottsbetalning (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 135 ;   ;Prepayment VAT Difference;Decimal  ;CaptionML=[ENU=Prepayment VAT Difference;
                                                              SVE=F”rskottsbetalning momsdifferens];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 136 ;   ;Prepmt VAT Diff. to Deduct;Decimal ;CaptionML=[ENU=Prepmt VAT Diff. to Deduct;
                                                              SVE=F”rskottsbet. momsdiff att dra av];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 137 ;   ;Prepmt VAT Diff. Deducted;Decimal  ;CaptionML=[ENU=Prepmt VAT Diff. Deducted;
                                                              SVE=F”rskottsbet. momsdiff. avdragen];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 140 ;   ;Outstanding Amt. Ex. VAT (LCY);Decimal;
                                                   CaptionML=[ENU=Outstanding Amt. Ex. VAT (LCY);
                                                              SVE=Utest†ende belopp. ex. moms (BVA)] }
    { 141 ;   ;A. Rcd. Not Inv. Ex. VAT (LCY);Decimal;
                                                   CaptionML=[ENU=A. Rcd. Not Inv. Ex. VAT (LCY);
                                                              SVE=B.post. ej fakt. ex. moms (BVA)] }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnLookup=BEGIN
                                                              ShowDimensions;
                                                            END;

                                                   CaptionML=[ENU=Dimension Set ID;
                                                              SVE=Dimensionsupps„ttnings-ID];
                                                   Editable=No }
    { 1001;   ;Job Task No.        ;Code20        ;TableRelation="Job Task"."Job Task No." WHERE (Job No.=FIELD(Job No.));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF "Job Task No." = '' THEN BEGIN
                                                                  CLEAR(JobJnlLineTemp);
                                                                  "Job Line Type" := "Job Line Type"::" ";
                                                                  UpdatePricesFromJobJnlLine;
                                                                  CreateDim(
                                                                    DimMgt.TypeToTableID3(Type),"No.",
                                                                    DATABASE::Job,"Job No.",
                                                                    DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                    0,'');
                                                                  EXIT;
                                                                END;

                                                                JobSetCurrencyFactor;
                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(TRUE);
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                                UpdateDimensionsFromJobTask;
                                                              END;

                                                   CaptionML=[ENU=Job Task No.;
                                                              SVE=Projektaktivitetsnr] }
    { 1002;   ;Job Line Type       ;Option        ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');
                                                              END;

                                                   CaptionML=[ENU=Job Line Type;
                                                              SVE=Projektradtyp];
                                                   OptionCaptionML=[ENU=" ,Schedule,Contract,Both Schedule and Contract";
                                                                    SVE=" ,Planerat,Kontrakt,B†de planerat och kontrakt"];
                                                   OptionString=[ ,Schedule,Contract,Both Schedule and Contract] }
    { 1003;   ;Job Unit Price      ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Unit Price","Job Unit Price");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Unit Price;
                                                              SVE=Projektenhetspris];
                                                   BlankZero=Yes }
    { 1004;   ;Job Total Price     ;Decimal       ;CaptionML=[ENU=Job Total Price;
                                                              SVE=Projekttotalpris];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1005;   ;Job Line Amount     ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Line Amount","Job Line Amount");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Line Amount;
                                                              SVE=Projektradbelopp];
                                                   BlankZero=Yes;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Job Currency Code" }
    { 1006;   ;Job Line Discount Amount;Decimal   ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Line Discount Amount","Job Line Discount Amount");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Line Discount Amount;
                                                              SVE=Projektradrabatt];
                                                   BlankZero=Yes;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Job Currency Code" }
    { 1007;   ;Job Line Discount % ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Line Discount %","Job Line Discount %");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Line Discount %;
                                                              SVE=Projektradrabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   BlankZero=Yes }
    { 1008;   ;Job Unit Price (LCY);Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Unit Price (LCY)","Job Unit Price (LCY)");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Unit Price (LCY);
                                                              SVE=Projektenhetspris (BVA)];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1009;   ;Job Total Price (LCY);Decimal      ;CaptionML=[ENU=Job Total Price (LCY);
                                                              SVE=Projekttotalpris (BVA)];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1010;   ;Job Line Amount (LCY);Decimal      ;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Line Amount (LCY)","Job Line Amount (LCY)");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Line Amount (LCY);
                                                              SVE=Projektradbelopp (BVA)];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1011;   ;Job Line Disc. Amount (LCY);Decimal;OnValidate=BEGIN
                                                                TESTFIELD("Receipt No.",'');

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(FALSE);
                                                                  JobJnlLineTemp.VALIDATE("Line Discount Amount (LCY)","Job Line Disc. Amount (LCY)");
                                                                  UpdatePricesFromJobJnlLine;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Job Line Disc. Amount (LCY);
                                                              SVE=Rabattbelopp f”r projektrad (BVA)];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1012;   ;Job Currency Factor ;Decimal       ;CaptionML=[ENU=Job Currency Factor;
                                                              SVE=Projektvalutafaktor];
                                                   BlankZero=Yes }
    { 1013;   ;Job Currency Code   ;Code20        ;CaptionML=[ENU=Job Currency Code;
                                                              SVE=Projektvalutakod] }
    { 1019;   ;Job Planning Line No.;Integer      ;OnValidate=VAR
                                                                JobPlanningLine@1000 : Record 11020401;
                                                              BEGIN
                                                                IF "Job Planning Line No." <> 0 THEN BEGIN
                                                                  JobPlanningLine.GET("Job No.","Job Task No.","Job Planning Line No.");
                                                                  JobPlanningLine.TESTFIELD("Job No.","Job No.");
                                                                  JobPlanningLine.TESTFIELD("Job Task No.","Job Task No.");
                                                                  CASE Type OF
                                                                    Type::"G/L Account":
                                                                      JobPlanningLine.TESTFIELD(Type,JobPlanningLine.Type::"G/L Account");
                                                                    Type::Item:
                                                                      JobPlanningLine.TESTFIELD(Type,JobPlanningLine.Type::Item);
                                                                  END;
                                                                  JobPlanningLine.TESTFIELD("No.","No.");
                                                                  JobPlanningLine.TESTFIELD("Usage Link",TRUE);
                                                                  JobPlanningLine.TESTFIELD("System-Created Entry",FALSE);
                                                                  "Job Line Type" := JobPlanningLine."Line Type" + 1;
                                                                  VALIDATE("Job Remaining Qty.",JobPlanningLine."Remaining Qty." - "Qty. to Invoice");
                                                                END ELSE
                                                                  VALIDATE("Job Remaining Qty.",0);
                                                              END;

                                                   OnLookup=VAR
                                                              JobPlanningLine@1000 : Record 11020401;
                                                            BEGIN
                                                              JobPlanningLine.SETRANGE("Job No.","Job No.");
                                                              JobPlanningLine.SETRANGE("Job Task No.","Job Task No.");
                                                              CASE Type OF
                                                                Type::"G/L Account":
                                                                  JobPlanningLine.SETRANGE(Type,JobPlanningLine.Type::"G/L Account");
                                                                Type::Item:
                                                                  JobPlanningLine.SETRANGE(Type,JobPlanningLine.Type::Item);
                                                              END;
                                                              JobPlanningLine.SETRANGE("No.","No.");
                                                              JobPlanningLine.SETRANGE("Usage Link",TRUE);
                                                              JobPlanningLine.SETRANGE("System-Created Entry",FALSE);

                                                              IF PAGE.RUNMODAL(0,JobPlanningLine) = ACTION::LookupOK THEN
                                                                VALIDATE("Job Planning Line No.",JobPlanningLine."Line No.");
                                                            END;

                                                   CaptionML=[ENU=Job Planning Line No.;
                                                              SVE=Projektplaneringsradnr];
                                                   BlankZero=Yes }
    { 1030;   ;Job Remaining Qty.  ;Decimal       ;OnValidate=VAR
                                                                JobPlanningLine@1000 : Record 11020401;
                                                              BEGIN
                                                                IF ("Job Remaining Qty." <> 0) AND ("Job Planning Line No." = 0) THEN
                                                                  ERROR(Text047,FIELDCAPTION("Job Remaining Qty."),FIELDCAPTION("Job Planning Line No."));

                                                                IF "Job Planning Line No." <> 0 THEN BEGIN
                                                                  JobPlanningLine.GET("Job No.","Job Task No.","Job Planning Line No.");
                                                                  IF JobPlanningLine.Quantity >= 0 THEN BEGIN
                                                                    IF "Job Remaining Qty." < 0 THEN
                                                                      "Job Remaining Qty." := 0;
                                                                  END ELSE BEGIN
                                                                    IF "Job Remaining Qty." > 0 THEN
                                                                      "Job Remaining Qty." := 0;
                                                                  END;
                                                                END;
                                                                "Job Remaining Qty. (Base)" := CalcBaseQty("Job Remaining Qty.");
                                                              END;

                                                   CaptionML=[ENU=Job Remaining Qty.;
                                                              SVE=Kvarst†ende projektkvantitet];
                                                   DecimalPlaces=0:5 }
    { 1031;   ;Job Remaining Qty. (Base);Decimal  ;CaptionML=[ENU=Job Remaining Qty. (Base);
                                                              SVE=Kvarst†ende projektkvantitet (bas)] }
    { 1700;   ;Deferral Code       ;Code10        ;TableRelation="Deferral Template"."Deferral Code";
                                                   OnValidate=VAR
                                                                DeferralPostDate@1000 : Date;
                                                              BEGIN
                                                                GetExfPurchDocHeader;
                                                                DeferralPostDate := ExfPurchDocHead."Posting Date";

                                                                DeferralUtilities.DeferralCodeOnValidate(
                                                                  "Deferral Code",DeferralUtilities.GetPurchDeferralDocType,'','',
                                                                  "Document Type",FORMAT("Inbound Document No."),"Line No.",
                                                                  GetDeferralAmount,DeferralPostDate,
                                                                  Description,ExfPurchDocHead."Currency Code");

                                                                IF "Deferral Code" <> '' THEN
                                                                  "Returns Deferral Start Date" :=
                                                                    DeferralUtilities.GetDeferralStartDate(DeferralUtilities.GetPurchDeferralDocType,
                                                                      "Document Type",FORMAT("Inbound Document No."),"Line No.","Deferral Code",ExfPurchDocHead."Posting Date")
                                                                ELSE
                                                                  "Returns Deferral Start Date" := 0D;
                                                              END;

                                                   CaptionML=[ENU=Deferral Code;
                                                              SVE=Periodiseringskod] }
    { 1702;   ;Returns Deferral Start Date;Date   ;OnValidate=VAR
                                                                DeferralHeader@1000 : Record 1701;
                                                                DeferralUtilities@1001 : Codeunit 1720;
                                                              BEGIN
                                                                GetExfPurchDocHeader;
                                                                IF "Returns Deferral Start Date" <> 0D THEN
                                                                  TESTFIELD("Deferral Code");

                                                                IF DeferralHeader.GET(DeferralUtilities.GetPurchDeferralDocType,'','',"Document Type",FORMAT("Inbound Document No."),"Line No.") THEN
                                                                  DeferralUtilities.CreateDeferralSchedule("Deferral Code",DeferralUtilities.GetPurchDeferralDocType,'','',
                                                                    "Document Type",FORMAT("Inbound Document No."),"Line No.",GetDeferralAmount,
                                                                    DeferralHeader."Calc. Method","Returns Deferral Start Date",
                                                                    DeferralHeader."No. of Periods",TRUE,
                                                                    DeferralHeader."Schedule Description",FALSE,
                                                                    ExfPurchDocHead."Currency Code",'');
                                                              END;

                                                   CaptionML=[ENU=Deferral Start Date;
                                                              SVE=Periodiseringsstartdatum] }
    { 5401;   ;Prod. Order No.     ;Code20        ;TableRelation="Production Order".No. WHERE (Status=CONST(Released));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Prod. Order No.;
                                                              SVE=Prod.ordernr] }
    { 5402;   ;Variant Code        ;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Variant".Code WHERE (Item No.=FIELD(No.));
                                                   OnValidate=BEGIN
                                                                IF "Variant Code" <> '' THEN
                                                                  TESTFIELD(Type,Type::Item);

                                                                IF xRec."Variant Code" <> "Variant Code" THEN BEGIN
                                                                  TESTFIELD("Qty. Rcd. Not Invoiced",0);
                                                                  TESTFIELD("Receipt No.",'');

                                                                  TESTFIELD("Return Qty. Shipped Not Invd.",0);
                                                                  TESTFIELD("Return Shipment No.",'');
                                                                END;

                                                                IF Type = Type::Item THEN
                                                                  UpdateDirectUnitCost(FIELDNO("Variant Code"));

                                                                IF (xRec."Variant Code" <> "Variant Code") AND (Quantity <> 0) THEN BEGIN
                                                                  InitItemAppl;
                                                                END;

                                                                IF JobTaskIsSet THEN BEGIN
                                                                  CreateTempJobJnlLine(TRUE);
                                                                  UpdatePricesFromJobJnlLine;
                                                                END
                                                              END;

                                                   CaptionML=[ENU=Variant Code;
                                                              SVE=Variantkod] }
    { 5403;   ;Bin Code            ;Code20        ;OnValidate=BEGIN
                                                                TESTFIELD(Type,Type::Item);
                                                                TESTFIELD("Location Code");
                                                              END;

                                                   OnLookup=VAR
                                                              WMSManagement@1100285001 : Codeunit 7302;
                                                              BinCode@1100285000 : Code[20];
                                                            BEGIN
                                                              IF (("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND (Quantity < 0)) OR
                                                                 (("Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"]) AND (Quantity >= 0))
                                                              THEN
                                                                BinCode := WMSManagement.BinContentLookUp("Location Code","No.","Variant Code",'',"Bin Code")
                                                              ELSE
                                                                BinCode := WMSManagement.BinLookUp("Location Code","No.","Variant Code",'');

                                                              IF BinCode <> '' THEN
                                                                VALIDATE("Bin Code",BinCode);
                                                            END;

                                                   CaptionML=[ENU=Bin Code;
                                                              SVE=Lagerplatskod] }
    { 5404;   ;Qty. per Unit of Measure;Decimal   ;InitValue=1;
                                                   CaptionML=[ENU=Qty. per Unit of Measure;
                                                              SVE=Antal per enhet];
                                                   DecimalPlaces=0:5 }
    { 5407;   ;Unit of Measure Code;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.))
                                                                 ELSE "Unit of Measure";
                                                   OnValidate=VAR
                                                                UnitOfMeasureTranslation@1000 : Record 5402;
                                                              BEGIN
                                                                TESTFIELD("Quantity Received",0);
                                                                TESTFIELD("Qty. Received (Base)",0);
                                                                TESTFIELD("Qty. Rcd. Not Invoiced",0);
                                                                IF "Unit of Measure Code" <> xRec."Unit of Measure Code" THEN BEGIN
                                                                  TESTFIELD("Receipt No.",'');
                                                                  TESTFIELD("Return Shipment No.",'');
                                                                END;
                                                                UpdateDirectUnitCost(FIELDNO("Unit of Measure Code"));
                                                                IF "Unit of Measure Code" = '' THEN
                                                                  "Unit of Measure" := ''
                                                                ELSE BEGIN
                                                                  UnitOfMeasure.GET("Unit of Measure Code");
                                                                  "Unit of Measure" := UnitOfMeasure.Description;
                                                                  GetExfPurchDocHeader;
                                                                  IF ExfPurchDocHead."Language Code" <> '' THEN BEGIN
                                                                    UnitOfMeasureTranslation.SETRANGE(Code,"Unit of Measure Code");
                                                                    UnitOfMeasureTranslation.SETRANGE("Language Code",ExfPurchDocHead."Language Code");
                                                                    IF UnitOfMeasureTranslation.FINDFIRST THEN
                                                                      "Unit of Measure" := UnitOfMeasureTranslation.Description;
                                                                  END;
                                                                END;

                                                                IF (Type = Type::Item) AND ("No." <> '') THEN BEGIN
                                                                  GetItem;
                                                                  "Qty. per Unit of Measure" := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Unit of Measure Code");
                                                                  "Gross Weight" := Item."Gross Weight" * "Qty. per Unit of Measure";
                                                                  "Net Weight" := Item."Net Weight" * "Qty. per Unit of Measure";
                                                                  "Unit Volume" := Item."Unit Volume" * "Qty. per Unit of Measure";
                                                                  "Units per Parcel" := ROUND(Item."Units per Parcel" / "Qty. per Unit of Measure",0.00001);
                                                                  IF "Qty. per Unit of Measure" > xRec."Qty. per Unit of Measure" THEN
                                                                    InitItemAppl;
                                                                  UpdateUOMQtyPerStockQty;
                                                                END ELSE
                                                                  "Qty. per Unit of Measure" := 1;

                                                                VALIDATE(Quantity);
                                                              END;

                                                   CaptionML=[ENU=Unit of Measure Code;
                                                              SVE=Enhetskod] }
    { 5415;   ;Quantity (Base)     ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE(Quantity,"Quantity (Base)");
                                                                UpdateDirectUnitCost(FIELDNO("Quantity (Base)"));
                                                              END;

                                                   CaptionML=[ENU=Quantity (Base);
                                                              SVE=Antal (bas)];
                                                   DecimalPlaces=0:5 }
    { 5416;   ;Outstanding Qty. (Base);Decimal    ;CaptionML=[ENU=Outstanding Qty. (Base);
                                                              SVE=Restnoterat antal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5417;   ;Qty. to Invoice (Base);Decimal     ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Invoice","Qty. to Invoice (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Invoice (Base);
                                                              SVE=Ant. att faktureras (bas)];
                                                   DecimalPlaces=0:5 }
    { 5418;   ;Qty. to Receive (Base);Decimal     ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Receive","Qty. to Receive (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Receive (Base);
                                                              SVE=Ant. att inlevereras (bas)];
                                                   DecimalPlaces=0:5 }
    { 5458;   ;Qty. Rcd. Not Invoiced (Base);Decimal;
                                                   CaptionML=[ENU=Qty. Rcd. Not Invoiced (Base);
                                                              SVE=Inlevrd. antal ej faktrd (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5460;   ;Qty. Received (Base);Decimal       ;CaptionML=[ENU=Qty. Received (Base);
                                                              SVE=Inlevererat antal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5461;   ;Qty. Invoiced (Base);Decimal       ;CaptionML=[ENU=Qty. Invoiced (Base);
                                                              SVE=Fakturerat antal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5600;   ;FA Posting Date     ;Date          ;CaptionML=[ENU=FA Posting Date;
                                                              SVE=Anl. bokf”ringsdatum] }
    { 5601;   ;FA Posting Type     ;Option        ;OnValidate=BEGIN
                                                                IF Type = Type::"Fixed Asset" THEN BEGIN
                                                                  TESTFIELD("Job No.",'');
                                                                  IF "FA Posting Type" = "FA Posting Type"::" " THEN
                                                                    "FA Posting Type" := "FA Posting Type"::"Acquisition Cost";
                                                                  GetFAPostingGroup
                                                                END ELSE BEGIN
                                                                  "Depreciation Book Code" := '';
                                                                  "FA Posting Date" := 0D;
                                                                  "Salvage Value" := 0;
                                                                  "Depr. until FA Posting Date" := FALSE;
                                                                  "Depr. Acquisition Cost" := FALSE;
                                                                  "Maintenance Code" := '';
                                                                  "Insurance No." := '';
                                                                  "Budgeted FA No." := '';
                                                                  "Duplicate in Depreciation Book" := '';
                                                                  "Use Duplication List" := FALSE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=FA Posting Type;
                                                              SVE=Anl. bokf”ringstyp];
                                                   OptionCaptionML=[ENU=" ,Acquisition Cost,Maintenance";
                                                                    SVE=" ,Anskaffningskostnad,Underh†ll"];
                                                   OptionString=[ ,Acquisition Cost,Maintenance] }
    { 5602;   ;Depreciation Book Code;Code10      ;TableRelation="Depreciation Book";
                                                   OnValidate=BEGIN
                                                                GetFAPostingGroup;
                                                              END;

                                                   CaptionML=[ENU=Depreciation Book Code;
                                                              SVE=Avskrivningsregelkod] }
    { 5603;   ;Salvage Value       ;Decimal       ;CaptionML=[ENU=Salvage Value;
                                                              SVE=teranskaffningsv„rde] }
    { 5605;   ;Depr. until FA Posting Date;Boolean;CaptionML=[ENU=Depr. until FA Posting Date;
                                                              SVE=Avskr. till anl. bokf.datum] }
    { 5606;   ;Depr. Acquisition Cost;Boolean     ;CaptionML=[ENU=Depr. Acquisition Cost;
                                                              SVE=Avskr. anskaffningskostnad] }
    { 5609;   ;Maintenance Code    ;Code10        ;TableRelation=Maintenance;
                                                   CaptionML=[ENU=Maintenance Code;
                                                              SVE=Underh†llskod] }
    { 5610;   ;Insurance No.       ;Code20        ;TableRelation=Insurance;
                                                   CaptionML=[ENU=Insurance No.;
                                                              SVE=F”rs„kringsnr] }
    { 5611;   ;Budgeted FA No.     ;Code20        ;TableRelation="Fixed Asset";
                                                   CaptionML=[ENU=Budgeted FA No.;
                                                              SVE=Budgeterat anl.nr] }
    { 5612;   ;Duplicate in Depreciation Book;Code10;
                                                   TableRelation="Depreciation Book";
                                                   CaptionML=[ENU=Duplicate in Depreciation Book;
                                                              SVE=Dubblett i avskrivningsregel] }
    { 5613;   ;Use Duplication List;Boolean       ;CaptionML=[ENU=Use Duplication List;
                                                              SVE=Anv„nd dubblettlista] }
    { 5705;   ;Cross-Reference No. ;Code20        ;OnValidate=VAR
                                                                ReturnedCrossRef@1000 : Record 5717;
                                                              BEGIN
                                                                GetExfPurchDocHeader;
                                                                PurchLineTemp.TRANSFERFIELDS(Rec);

                                                                "Buy-from Vendor No." := ExfPurchDocHead."Buy-from Vendor No.";

                                                                ReturnedCrossRef.INIT;
                                                                IF "Cross-Reference No." <> '' THEN BEGIN
                                                                  DistIntegration.ICRLookupPurchaseItem(PurchLineTemp,ReturnedCrossRef,TRUE);
                                                                  VALIDATE("No.",ReturnedCrossRef."Item No.");
                                                                  SetVendorItemNo;
                                                                  IF ReturnedCrossRef."Variant Code" <> '' THEN
                                                                    VALIDATE("Variant Code",ReturnedCrossRef."Variant Code");
                                                                  IF ReturnedCrossRef."Unit of Measure" <> '' THEN
                                                                    VALIDATE("Unit of Measure Code",ReturnedCrossRef."Unit of Measure");
                                                                  UpdateDirectUnitCost(FIELDNO("Cross-Reference No."));
                                                                END;

                                                                "Unit of Measure (Cross Ref.)" := ReturnedCrossRef."Unit of Measure";
                                                                "Cross-Reference Type" := ReturnedCrossRef."Cross-Reference Type";
                                                                "Cross-Reference Type No." := ReturnedCrossRef."Cross-Reference Type No.";
                                                                "Cross-Reference No." := ReturnedCrossRef."Cross-Reference No.";

                                                                IF ReturnedCrossRef.Description <> '' THEN
                                                                  Description := ReturnedCrossRef.Description;
                                                              END;

                                                   OnLookup=BEGIN
                                                              CrossReferenceNoLookUp;
                                                            END;

                                                   CaptionML=[ENU=Cross-Reference No.;
                                                              SVE=Tv„rreferensnr] }
    { 5706;   ;Unit of Measure (Cross Ref.);Code10;TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.));
                                                   CaptionML=[ENU=Unit of Measure (Cross Ref.);
                                                              SVE=Enhet (tv„rref.)] }
    { 5707;   ;Cross-Reference Type;Option        ;CaptionML=[ENU=Cross-Reference Type;
                                                              SVE=Tv„rreferens typ];
                                                   OptionCaptionML=[ENU=" ,Customer,Vendor,Bar Code";
                                                                    SVE=" ,Kund,Leverant”r,Streckkod"];
                                                   OptionString=[ ,Customer,Vendor,Bar Code] }
    { 5708;   ;Cross-Reference Type No.;Code30    ;CaptionML=[ENU=Cross-Reference Type No.;
                                                              SVE=Tv„rreferens typnr] }
    { 5752;   ;Completely Received ;Boolean       ;CaptionML=[ENU=Completely Received;
                                                              SVE=F„rdigt inlevererat];
                                                   Editable=No }
    { 5800;   ;Allow Item Charge Assignment;Boolean;
                                                   InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                CheckItemChargeAssgnt;
                                                              END;

                                                   CaptionML=[ENU=Allow Item Charge Assignment;
                                                              SVE=Till†t art.omkost.f”rdelning] }
    { 5801;   ;Qty. to Assign      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Charge Assign. (EX Purch)"."Qty. to Assign" WHERE (Inbound Document No.=FIELD(Inbound Document No.),
                                                                                                                            Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Qty. to Assign;
                                                              SVE=Ant. att distribuera];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5802;   ;Qty. Assigned       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Charge Assign. (EX Purch)"."Qty. Assigned" WHERE (Inbound Document No.=FIELD(Inbound Document No.),
                                                                                                                           Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Qty. Assigned;
                                                              SVE=Ant. tilldelat];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5803;   ;Return Qty. to Ship ;Decimal       ;OnValidate=BEGIN
                                                                IF "Return Qty. to Ship" = Quantity - "Return Qty. Shipped" THEN
                                                                  InitQtyToShip
                                                                ELSE BEGIN
                                                                  "Return Qty. to Ship (Base)" := CalcBaseQty("Return Qty. to Ship");
                                                                  InitQtyToInvoice;
                                                                END;
                                                                IF ("Return Qty. to Ship" * Quantity < 0) OR
                                                                   (ABS("Return Qty. to Ship") > ABS("Outstanding Quantity")) OR
                                                                   (Quantity * "Outstanding Quantity" < 0)
                                                                THEN
                                                                  ERROR(
                                                                    Text020,
                                                                    "Outstanding Quantity");
                                                                IF ("Return Qty. to Ship (Base)" * "Quantity (Base)" < 0) OR
                                                                   (ABS("Return Qty. to Ship (Base)") > ABS("Outstanding Qty. (Base)")) OR
                                                                   ("Quantity (Base)" * "Outstanding Qty. (Base)" < 0)
                                                                THEN
                                                                  ERROR(
                                                                    Text021,
                                                                    "Outstanding Qty. (Base)");

                                                                IF (CurrFieldNo <> 0) AND (Type = Type::Item) AND ("Return Qty. to Ship" > 0) THEN
                                                                  CheckApplToItemLedgEntry;
                                                              END;

                                                   CaptionML=[ENU=Return Qty. to Ship;
                                                              SVE=Levereras antal];
                                                   DecimalPlaces=0:5 }
    { 5804;   ;Return Qty. to Ship (Base);Decimal ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Return Qty. to Ship","Return Qty. to Ship (Base)");
                                                              END;

                                                   CaptionML=[ENU=Return Qty. to Ship (Base);
                                                              SVE=Ant. att levereras (bas)];
                                                   DecimalPlaces=0:5 }
    { 5805;   ;Return Qty. Shipped Not Invd.;Decimal;
                                                   CaptionML=[ENU=Return Qty. Shipped Not Invd.;
                                                              SVE=Returant. levererat ej faktrd];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5806;   ;Ret. Qty. Shpd Not Invd.(Base);Decimal;
                                                   CaptionML=[ENU=Ret. Qty. Shpd Not Invd.(Base);
                                                              SVE=Ant. levererat ej faktrd (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5807;   ;Return Shpd. Not Invd.;Decimal     ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetExfPurchDocHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF ExfPurchDocHead."Currency Code" <> '' THEN
                                                                  "Return Shpd. Not Invd. (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(0,"Job No.", // 4PS
                                                                        GetDate,"Currency Code",
                                                                        "Return Shpd. Not Invd.",ExfPurchDocHead."Currency Factor",FALSE), // 4PS
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Return Shpd. Not Invd. (LCY)" :=
                                                                    ROUND("Return Shpd. Not Invd.",Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Return Shpd. Not Invd.;
                                                              SVE=Retur levererat ej faktrd];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 5808;   ;Return Shpd. Not Invd. (LCY);Decimal;
                                                   CaptionML=[ENU=Return Shpd. Not Invd. (LCY);
                                                              SVE=Retur levrd ej faktrd (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 5809;   ;Return Qty. Shipped ;Decimal       ;CaptionML=[ENU=Return Qty. Shipped;
                                                              SVE=Returant. levererat];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5810;   ;Return Qty. Shipped (Base);Decimal ;CaptionML=[ENU=Return Qty. Shipped (Base);
                                                              SVE=Returant. levererat (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 6600;   ;Return Shipment No. ;Code20        ;CaptionML=[ENU=Return Shipment No.;
                                                              SVE=Returutleveransnr];
                                                   Editable=No }
    { 6601;   ;Return Shipment Line No.;Integer   ;CaptionML=[ENU=Return Shipment Line No.;
                                                              SVE=Returutleveransradnr];
                                                   Editable=No }
    { 6608;   ;Return Reason Code  ;Code10        ;TableRelation="Return Reason";
                                                   OnValidate=BEGIN
                                                                IF "Return Reason Code" = '' THEN
                                                                  UpdateDirectUnitCost(FIELDNO("Return Reason Code"));

                                                                IF ReturnReason.GET("Return Reason Code") THEN BEGIN
                                                                  IF ReturnReason."Default Location Code" <> '' THEN
                                                                    VALIDATE("Location Code",ReturnReason."Default Location Code");
                                                                  IF ReturnReason."Inventory Value Zero" THEN
                                                                    VALIDATE("Direct Unit Cost",0)
                                                                  ELSE
                                                                    UpdateDirectUnitCost(FIELDNO("Return Reason Code"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Return Reason Code;
                                                              SVE=Returorsakskod] }
    { 11200;  ;Auto. Acc. Group    ;Code10        ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Auto. Acc. Group") THEN
                                                                  ERROR('NOT USED');
                                                              END;

                                                   CaptionML=[ENU=Auto. Acc. Group;
                                                              SVE=Automatkonteringsmall] }
    { 80002;  ;Match Qty. Imp Inv. (Base);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line"."Quantity (Base)" WHERE (Document Type=CONST(Invoice),
                                                                                                                            Buy-from Vendor No.=FIELD(Buy-from Vendor No.),
                                                                                                                            Order No.=FIELD(Order No.),
                                                                                                                            Order Line No.=FILTER(>0),
                                                                                                                            Order Line No.=FIELD(Order Line No.)));
                                                   CaptionML=[ENU=Match Qty. Import faktura (Base);
                                                              SVE=Matchad kvanitet import faktura (bas)];
                                                   Editable=No }
    { 80003;  ;Matched Qty. Invoice (Base);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Quantity (Base)" WHERE (Document Type=CONST(Invoice),
                                                                                                            Buy-from Vendor No.=FIELD(Buy-from Vendor No.),
                                                                                                            ExFlow Order No.=FIELD(Order No.),
                                                                                                            ExFlow Order Line No.=FILTER(>0),
                                                                                                            ExFlow Order Line No.=FIELD(Order Line No.)));
                                                   CaptionML=[ENU=Matched Qty. Invoice (Base);
                                                              SVE=Matched kvantitet faktura (bas)];
                                                   Editable=No }
    { 11012040;;Purchase Action    ;Code10        ;TableRelation=IF (Document Type=CONST(Quote),
                                                                     Estimate No.=FILTER(<>'')) "Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.))
                                                                     ELSE IF (Document Type=CONST(Quote),
                                                                              Estimate No.=FILTER(='')) "Project Purchase Action".Code WHERE (Project No.=FIELD(Job No.))
                                                                              ELSE "Project Purchase Action".Code WHERE (Project No.=FIELD(Job No.),
                                                                                                                         Status=FILTER(>=Approved));
                                                   OnValidate=VAR
                                                                lvProjPurchActionRec@1100485000 : Record 11012026;
                                                                lvBudgetLine@1100485001 : Record 11012001;
                                                                lvTotAmount@1100485002 : Decimal;
                                                              BEGIN
                                                                //**4PS call C-008731, C-011804
                                                                IF (CurrFieldNo <> 0) THEN BEGIN
                                                                  PurchSetup.GET;
                                                                  IF PurchSetup."Purchase Action Auto Close" THEN BEGIN
                                                                    IF (xRec."Purchase Action" <> '') THEN
                                                                      IF ("Purchase Action" <> xRec."Purchase Action") OR ("Job No." <> xRec."Job No.") THEN BEGIN
                                                                        IF xRec."Job No." <> '' THEN BEGIN
                                                                          IF CONFIRM(Text11012020, TRUE, FIELDCAPTION(
                                                                            "Purchase Action"), xRec."Purchase Action", FIELDCAPTION("Job No."), xRec."Job No.") THEN
                                                                          BEGIN
                                                                            lvBudgetLine.SETRANGE("Project No.", xRec."Job No.");
                                                                            lvBudgetLine.SETRANGE("Purchase Action", xRec."Purchase Action");
                                                                            lvBudgetLine.SETRANGE(Advised, TRUE);
                                                                            IF lvBudgetLine.FINDSET(TRUE, FALSE) THEN
                                                                              REPEAT
                                                                                lvBudgetLine.Advised := FALSE;
                                                                                lvBudgetLine.MODIFY;
                                                                              UNTIL lvBudgetLine.NEXT = 0;
                                                                          END;
                                                                        END ELSE BEGIN
                                                                          //hier nog wat voor calculatie inbouwen?
                                                                        END;
                                                                      END;

                                                                    IF ("Purchase Action" <> '') THEN BEGIN
                                                                      IF "Job No." <> '' THEN BEGIN
                                                                        lvProjPurchActionRec.GET("Job No.", "Purchase Action");
                                                                        lvBudgetLine.RESET;
                                                                        lvBudgetLine.SETRANGE("Project No.", "Job No.");
                                                                        lvBudgetLine.SETRANGE("Purchase Action", "Purchase Action");
                                                                        lvBudgetLine.SETRANGE(Advised, FALSE);
                                                                        IF lvBudgetLine.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                          VALIDATE(Element, lvBudgetLine.Element);
                                                                          VALIDATE("Extension Contract", lvBudgetLine."Extension Contract");
                                                                          VALIDATE("Plot No.",lvBudgetLine."Plot No.");
                                                                          VALIDATE("Cost Type", lvBudgetLine."Cost Type" + 1);
                                                                          // EXF VALIDATE("Shortcut Dimension 2 Code", lvBudgetLine."Cost Object");
                                                                          ValidateShortcutDimCode(2,lvBudgetLine."Cost Object");
                                                                          VALIDATE("Unit of Measure", lvBudgetLine."Unit of Measure");
                                                                          //GetPurchHeader;
                                                                          //IF NOT PurchHeader."Amounts only" THEN
                                                                          //  VALIDATE(Quantity, 1);
                                                                          REPEAT
                                                                            lvTotAmount := lvTotAmount + lvBudgetLine."Amount (LCY)";
                                                                            lvBudgetLine.Advised := TRUE;
                                                                            lvBudgetLine.MODIFY;
                                                                          UNTIL lvBudgetLine.NEXT = 0;
                                                                          //VALIDATE("Line Amount", lvTotAmount);
                                                                          VALIDATE(Amount, lvTotAmount);
                                                                        END;
                                                                      END;
                                                                    END;

                                                                  END;

                                                                  { **
                                                                  //C-014017.sn
                                                                  IF ("Document Type" = "Document Type"::Order) AND ("Purchase Action" <> '') THEN BEGIN
                                                                    GetPurchHeader;
                                                                    IF PurchHeader."Purchase Action" = '' THEN BEGIN
                                                                      PurchHeader."Purchase Action" := "Purchase Action";
                                                                      PurchHeader.MODIFY;
                                                                    END ELSE BEGIN
                                                                      PurchLine2.RESET;
                                                                      PurchLine2.SETRANGE("Document Type", "Document Type");
                                                                      PurchLine2.SETRANGE("Document No.", "Document No.");
                                                                      PurchLine2.SETFILTER("Line No.", '<%1',"Line No.");
                                                                      PurchLine2.SETFILTER("Purchase Action", '<>%1&<>%2', '', "Purchase Action");
                                                                      IF PurchLine2.ISEMPTY THEN BEGIN
                                                                        PurchHeader."Purchase Action" := "Purchase Action";
                                                                        PurchHeader.MODIFY;
                                                                      END;
                                                                    END;
                                                                  END;
                                                                  //C-014017.en
                                                                  ** }
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Purchase Action;
                                                              SVE=Ink”ps†tg„rd];
                                                   Description=4PS }
    { 11012060;;Cost Type          ;Option        ;OnValidate=VAR
                                                                _code@1000 : Code[20];
                                                              BEGIN
                                                                //**4PS
                                                                CheckCostTypeOrder;
                                                                //IF ("Shortcut Dimension 2 Code" <> '') AND ("No." <> '') THEN
                                                                  IF ("Cost Type" <> xRec."Cost Type") AND NOT HideDialog THEN  //db, 11-02-11: M25031
                                                                    IF CONFIRM(Text11012004,TRUE) THEN BEGIN
                                                                      //VALIDATE("Shortcut Dimension 2 Code",'');
                                                                      ValidateShortcutDimCode(2,_code);
                                                                      "Item No." := '';
                                                                      "Basic Item" := '';
                                                                      "Trade Item" := '';
                                                                      Manufacturer := '';
                                                                    END ELSE BEGIN
                                                                      "Cost Type" := xRec."Cost Type";
                                                                      EXIT;
                                                                    END;

                                                                //CheckAdditionalCostService;
                                                                //IF "Cost Type" <> "Cost Type"::Material THEN
                                                                //  "Inward Processing Relief" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Cost Type;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=" ,Labor,Material,Subcontracting,Plant,Sundry";
                                                                    SVE=" ,Arbetskraft,Material,Underentreprenad,Maskin,Diverse"];
                                                   OptionString=[ ,Labor,Material,Subcontracting,Plant,Sundry];
                                                   Description=4PS }
    { 11012070;;Element            ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Job No.));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                CheckCompanyIC;
                                                                //TestStatusOpen;
                                                                //ElementFormat.FormatElem(Element,2,"Receiving Company");
                                                                ElementFormat.FormatElem(Element,2,COMPANYNAME());
                                                                IF Element <> '' THEN BEGIN
                                                                  ProjElemRec.GET("Job No.",Element);
                                                                  ProjElemRec.CheckProjectElementBlocked;  //call: 6564
                                                                END ELSE BEGIN
                                                                  ProjElemRec.INIT;
                                                                END;
                                                                Level := ProjElemRec.Level;
                                                                Chapter := ProjElemRec.Chapter;
                                                                Paragraph := ProjElemRec.Paragraph;
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              OnLookupElement(TRUE);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              SVE=Element];
                                                   Description=4PS }
    { 11012071;;Level              ;Integer       ;CaptionML=[ENU=Level;
                                                              SVE=Niv†];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012072;;Chapter            ;Code20        ;CaptionML=[ENU=Chapter;
                                                              SVE=Kapitel];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012073;;Paragraph          ;Code20        ;CaptionML=[ENU=Paragraph;
                                                              SVE=Stycke];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012080;;Extension Contract ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Job No.));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //TestStatusOpen;
                                                                IF "Extension Contract" <> '' THEN BEGIN
                                                                  CheckCompanyIC;
                                                                  ExtensionContract.GET("Job No.", "Extension Contract");
                                                                  //Call 21488
                                                                  IF ExtensionContract.Status = ExtensionContract.Status::Expired THEN
                                                                    ExtensionContract.FIELDERROR(Status);
                                                                  //
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              OnLookupExtensionContract(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Extension Contract;
                                                              SVE=ŽTA];
                                                   Description=4PS }
    { 11012085;;Plot No.           ;Code10        ;TableRelation=Plot."Plot No." WHERE (Project No.=FIELD(Job No.));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //TestStatusOpen;
                                                              END;

                                                   CaptionML=[ENU=Plot No.;
                                                              SVE=Ritningnr];
                                                   Description=4PS }
    { 11012150;;Item No.           ;Code20        ;TableRelation=Item.No.;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //IF ("Item No." <> '') THEN      //*C-028911.n  //*33895.o
                                                                //  TESTFIELD("Plant Type", '');  //*C-028911.n  //*33895.o
                                                                //IF ("Item No." <> '') AND (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN
                                                                //  FIELDERROR("Item No.", Text11012017);

                                                                IF "Item No." <> xRec."Item No." THEN BEGIN
                                                                  IF "Item No." <> '' THEN BEGIN
                                                                    CheckCostTypeCondition;  //db, 11-02-11: M25031
                                                                    //db.sn, 24-01-07: M8000
                                                                    SaveFieldNo := CurrFieldNo;
                                                                    CurrFieldNo := FIELDNO("No.");  //force update price by UpdateDirectUnitCost(FIELDNO("No."))
                                                                    ValidateItem(ItemTypeOpt::Item);
                                                                    CurrFieldNo := SaveFieldNo;
                                                                    SaveFieldNo := 0;
                                                                    //db.en, 24-01-07: M8000
                                                                    IF CurrFieldNo = FIELDNO("Item No.") THEN BEGIN
                                                                      ValidateVendor;
                                                                      IF "Vendor (Trade Item)" <> '' THEN
                                                                        CheckVendorRelation;  //db, 28-02-05: M7541
                                                                    END;
                                                                  END ELSE BEGIN
                                                                    Type := Type::"G/L Account";
                                                                    IF Type <> xRec.Type THEN
                                                                      "No." := '';
                                                                  END;
                                                                END;

                                                                IF "Item No." <> '' THEN
                                                                  ItemRec.GET("Item No.");

                                                                IF ("Plant Type" <> '') THEN  //*33895.n
                                                                  VALIDATE("Plant Type");     //*33895.n

                                                                { **
                                                                //** DP0121
                                                                IF "Item No." <> xRec."Item No." THEN
                                                                  IF (Quantity <> 0) AND NSItemExists(xRec."Item No.") THEN
                                                                    ReservePurchLine.VerifyChange(Rec,xRec);
                                                                ** }
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              SVE=Artikelnr];
                                                   Description=4PS }
    { 11012151;;Basic Item         ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //IF ("Basic Item" <> '') THEN    //*C-028911.n  //*33895.o
                                                                //  TESTFIELD("Plant Type", '');  //*C-028911.n  //*33895.o
                                                                //IF ("Basic Item" <> '') AND (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN
                                                                //  FIELDERROR("Basic Item", Text11012017);

                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  CheckCostTypeCondition;  //db, 11-02-11: M25031
                                                                  ValidateItem(ItemTypeOpt::"Basic Item");
                                                                  IF CurrFieldNo = FIELDNO("Basic Item") THEN
                                                                    ValidateVendor;
                                                                END;

                                                                IF ("Plant Type" <> '') THEN  //*33895.n
                                                                  VALIDATE("Plant Type");     //*33895.n
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              SVE=Basartikel];
                                                   Description=4PS }
    { 11012152;;Trade Item         ;Code20        ;TableRelation=IF (Vendor (Trade Item)=FILTER(<>'')) "Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"))
                                                                 ELSE IF (Vendor (Trade Item)=FILTER('')) "Trade Item"."Item Code";
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //IF ("Trade Item" <> '') THEN    //*C-028911.n  //*33895.o
                                                                //  TESTFIELD("Plant Type", '');  //*C-028911.n  //*33895.o
                                                                //IF ("Trade Item" <> '') AND (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN
                                                                //  FIELDERROR("Trade Item", Text11012017);

                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
                                                                  CheckCostTypeCondition;  //db, 11-02-11: M25031
                                                                  IF (CurrFieldNo = FIELDNO("Trade Item")) AND ("Vendor (Trade Item)" = '') THEN
                                                                    CheckRelatedVendor;
                                                                  ValidateItem(ItemTypeOpt::"Trade Item");
                                                                  //UpdateLeadTimeFields;
                                                                  CheckVendorRelation;
                                                                  //CalculateICMQuantity;
                                                                  //IF "Blanket Order No." = '' THEN
                                                                  //  StrategicPurchMgt.CheckTradeItem("Trade Item","Vendor (Trade Item)","Buy-from Vendor No.");
                                                                END;
                                                                IF ("Trade Item" <> '') THEN
                                                                  TESTFIELD("Vendor (Trade Item)");  //db, 02-09-13: C003743
                                                                IF ("Plant Type" <> '') THEN  //*33895.n
                                                                  VALIDATE("Plant Type");     //*33895.n
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              SVE=Anskaffningsartikel];
                                                   Description=4PS }
    { 11012154;;Manufacturer       ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //IF (Manufacturer <> '') THEN    //*C-028911.n  //*33895.o
                                                                //  TESTFIELD("Plant Type", '');  //*C-028911.n  //*33895.o
                                                                //IF (Manufacturer <> '') AND (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN
                                                                //  FIELDERROR(Manufacturer, Text11012017);

                                                                IF ("Plant Type" <> '') THEN  //*33895.n
                                                                  VALIDATE("Plant Type");     //*33895.n
                                                              END;

                                                   CaptionML=[ENU=Manufacturer;
                                                              SVE=Tillverkare];
                                                   Description=4PS }
    { 11012155;;Vendor (Trade Item);Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                TradeVendorRec@1100525000 : Record 11012304;
                                                                TradeItemRec@1100525001 : Record 11012317;
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                //**4PS
                                                                //IF ("Vendor (Trade Item)" <> '') THEN //*C-028911.n  //*33895.o
                                                                //  TESTFIELD("Plant Type", '');        //*C-028911.n  //*33895.o
                                                                //IF ("Vendor (Trade Item)" <> '') AND (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN
                                                                //  FIELDERROR("Vendor (Trade Item)", Text11012017);

                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  TradeVendorRec.HandleVendorValidate("Vendor (Trade Item)");
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  //db.sn, 17-12-10: M18021
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                  //db.en, 17-12-10: M18021
                                                                  CheckVendorRelation;
                                                                END;

                                                                IF ("Plant Type" <> '') THEN  //*33895.n
                                                                  VALIDATE("Plant Type");     //*33895.n
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              SVE=Leverant”r (skaffningsartikel)];
                                                   Description=4PS }
    { 11012172;;Estimate No.       ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate No.;
                                                              SVE=Kalkylnr];
                                                   Description=4PS }
    { 11012250;;Cost Component     ;Code20        ;TableRelation="Cost Component".Code;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //TestStatusOpen;
                                                                ValidateCostComponent;
                                                              END;

                                                   CaptionML=[ENU=Cost Component;
                                                              SVE=Kostnadskomponent];
                                                   Description=4PS }
    { 11012440;;Plant Location     ;Code20        ;TableRelation="Plant Location" WHERE (Depot=CONST(No));
                                                   OnValidate=VAR
                                                                PlantCostComp@1100409000 : Record 11012575;
                                                              BEGIN
                                                                //**4PS (C001519)
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  //TESTFIELD("Receiving Company", '');
                                                                  TESTFIELD("Cost Component Plant");
                                                                  PlantCostComp.GET("Cost Component Plant");
                                                                  PlantCostComp.TESTFIELD("Charge Purchase");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Plant Location;
                                                              SVE=Maskinplats];
                                                   Description=4PS }
    { 11012442;;Plant Transport Ride No.;Code20   ;TableRelation="Plant Transport Ride";
                                                   CaptionML=[ENU=Plant Transport Ride No.;
                                                              SVE=Maskinens transportk”rningsnr];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012446;;Plant Order No.    ;Code20        ;TableRelation="Plant Order";
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Plant Order No.;
                                                              SVE=Maskinordernummer];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012447;;Plant Order Line No.;Integer      ;TableRelation=IF (Plant Type=CONST(),
                                                                     Item No.=FILTER(<>'')) Table11020510.Field20 WHERE (Field10=FIELD(Plant Order No.))
                                                                     ELSE "Plant Order Line"."Line No." WHERE (Plant Order No.=FIELD(Plant Order No.));
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Plant Order Line No.;
                                                              SVE=Maskinorder, radnr];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012448;;Direct Delivery Plant;Boolean     ;CaptionML=[ENU=Direct Delivery Plant;
                                                              SVE=Direktleverans, Maskin];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012449;;Vendor Plant No.   ;Code20        ;OnValidate=VAR
                                                                lvSavePlantType@1100485000 : Code[20];
                                                              BEGIN
                                                                //**4PS
                                                                IF "Vendor Plant No." = '' THEN
                                                                  EXIT;

                                                                CheckCompanyIC;
                                                                PlantVendorRec.RESET;
                                                                PlantVendorRec.SETCURRENTKEY("Vendor No.", "Vendor Plant No.");
                                                                PlantVendorRec.SETRANGE("Vendor No.","Buy-from Vendor No.");
                                                                PlantVendorRec.SETRANGE("Vendor Plant No.", "Vendor Plant No.");
                                                                IF PlantVendorRec.FIND('-') THEN BEGIN
                                                                  lvSavePlantType := "Plant Type";
                                                                  "Plant Type" := PlantVendorRec."Plant Type";
                                                                  DeterminePlantVendorType(FALSE);
                                                                  "Plant Type" := lvSavePlantType;
                                                                  IF ((PlantVendorRec.Type = PlantVendorRec.Type::Purchase) AND (PlantVendorType = PlantVendorRec.Type::Rent)) OR
                                                                     ((PlantVendorRec.Type = PlantVendorRec.Type::Rent) AND (PlantVendorType = PlantVendorRec.Type::Purchase))
                                                                  THEN BEGIN
                                                                    IF PlantVendorRec.GET(PlantVendorRec."Plant Type", "Buy-from Vendor No.", PlantVendorType) THEN
                                                                      "Vendor Plant No." := PlantVendorRec."Vendor Plant No."
                                                                    ELSE
                                                                      "Vendor Plant No." := '';
                                                                  END;
                                                                  VALIDATE("Plant Type", PlantVendorRec."Plant Type");
                                                                END ELSE BEGIN
                                                                  IF ("Plant Type" <> '') THEN BEGIN
                                                                    DeterminePlantVendorType(FALSE);
                                                                    //* If 'Vendor Plant No' is not present and 'Plant Type' has "Vendor Plant No." then empty 'Plant Type'
                                                                    IF PlantVendorRec.GET("Plant Type", "Buy-from Vendor No.", PlantVendorType) THEN
                                                                      VALIDATE("Plant Type", '');
                                                                  END;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              CheckCompanyIC;
                                                              PlantVendorRec.RESET;
                                                              PlantVendorRec.SETCURRENTKEY("Vendor No.", "Vendor Plant No.");
                                                              PlantVendorRec.SETRANGE("Vendor No.", "Buy-from Vendor No.");
                                                              IF ("Plant Type" <> '') THEN BEGIN
                                                                DeterminePlantVendorType(FALSE);
                                                                PlantVendorRec.SETRANGE(Type, PlantVendorType);
                                                              END;
                                                              PlantVendorRec."Vendor No." := "Buy-from Vendor No.";
                                                              PlantVendorRec."Vendor Plant No." := "Vendor Plant No.";
                                                              IF PAGE.RUNMODAL(0,PlantVendorRec) = ACTION::LookupOK THEN BEGIN
                                                                IF (PlantVendorRec."Vendor No." = "Buy-from Vendor No.") THEN
                                                                  VALIDATE("Vendor Plant No.", PlantVendorRec."Vendor Plant No.");
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Vendor Plant No.;
                                                              SVE=Leverant”r Maskinnr];
                                                   Description=4PS }
    { 11012550;;Plant Type         ;Code20        ;TableRelation="Plant Type";
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                FillSystemCreatedEntry;
                                                                IF "Plant Type" = '' THEN BEGIN
                                                                  "Plant No." := '';
                                                                  "Cost Component Plant" := '';
                                                                  //"Expected Enddate Rent" := 0D;
                                                                  //"Ext. Rented Plant Invoiced to" := 0D;
                                                                  IF "Document Type" = "Document Type"::Order THEN
                                                                    DeletePurchOrderPlntRentalRate();
                                                                  EXIT;
                                                                //*C-028911.sn
                                                                END ELSE BEGIN
                                                                  //IF (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN BEGIN  //*33895.n
                                                                  IF (CheckPlantAcquisitionOrRent(PurchLine2) <> 0) THEN BEGIN  //*33895.n
                                                                    TESTFIELD("Item No.", '');
                                                                    TESTFIELD("Basic Item", '');
                                                                    TESTFIELD("Trade Item", '');
                                                                  END;  //*33895.n
                                                                //*C-028911.en
                                                                END;

                                                                CheckCompanyIC;
                                                                PlantTypeRec.GET("Plant Type");
                                                                IF "Document Type" IN ["Document Type"::Order, "Document Type"::Quote] THEN  //DP00485 (C009313)
                                                                  PlantTypeRec.TESTFIELD(Blocked, FALSE);

                                                                VALIDATE("Plant No.");
                                                                //IF "Plant No." = '' THEN                    //4PS.o
                                                                //  Description := PlantTypeRec.Description;  //4PS.o

                                                                IF ("Item No." + "Basic Item" + "Trade Item" <> '') THEN EXIT;  //*33895.n

                                                                IF ("Plant Type" <> xRec."Plant Type") OR ("Unit of Measure" = '') THEN BEGIN
                                                                  //IF (CheckPlantAcquisitionOrRent(Rec) <> 0) THEN BEGIN
                                                                  IF (CheckPlantAcquisitionOrRent(PurchLine2) <> 0) THEN BEGIN
                                                                    VALIDATE("Unit of Measure", PlantTypeRec."Unit of Measure");
                                                                    //UpdateDirectUnitCost(FIELDNO("Plant Type"));
                                                                  END;
                                                                END;

                                                                IF (CurrFieldNo <> FIELDNO("Vendor Plant No."))  THEN BEGIN
                                                                  IF ("Buy-from Vendor No." = '') THEN BEGIN
                                                                    //GetPurchHeader;
                                                                    //"Buy-from Vendor No." := PurchHeader."Buy-from Vendor No.";
                                                                  END;
                                                                  DeterminePlantVendorType(TRUE);
                                                                END;

                                                                Description := GetTranslatedPlantDesc(MAXSTRLEN(Description)); //4PS.n

                                                                IF ("Document Type" = "Document Type"::Order) AND ("Plant Type" <> xRec."Plant Type") THEN BEGIN
                                                                  DeletePurchOrderPlntRentalRate();
                                                                  //FillQtyWithPlantReorderQty();
                                                                END;

                                                                //**4PS.sn 25-03-2010
                                                                IF ("Document Type" = "Document Type"::Invoice) AND
                                                                   //("Receiving Company" <> '') AND
                                                                   ("Plant Type" <> xRec."Plant Type") AND
                                                                   (CurrFieldNo = FIELDNO("Plant Type")) THEN
                                                                BEGIN
                                                                  //"Shortcut Dimension 1 Code" := PlantTypeRec."Department Code";
                                                                  ValidateShortcutDimCode(1,PlantTypeRec."Department Code");
                                                                END;
                                                                //**4PS.en 25-03-2010
                                                                { **
                                                                CreateDim(
                                                                  DATABASE::"Plant Number", DimMgt.MakeCombinedPlantNo("Plant Type","Plant No."), //**4PS.n
                                                                  DATABASE::"Plant Type","Plant Type",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Service Order","Service Order No.", //** 4PS 09-06-2010
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Work Center","Work Center No.");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n  //*C007227.o
                                                                ** }
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              CheckCompanyIC;
                                                              PlantTypeRec.Code := "Plant Type";
                                                              IF PAGE.RUNMODAL(0,PlantTypeRec) = ACTION::LookupOK THEN
                                                                VALIDATE("Plant Type", PlantTypeRec.Code);
                                                            END;

                                                   CaptionML=[ENU=Plant Type;
                                                              SVE=Maskintyp];
                                                   Description=4PS }
    { 11012551;;Plant No.          ;Code10        ;TableRelation="Plant Number".No. WHERE (Plant Type=FIELD(Plant Type));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF "Plant No." = '' THEN BEGIN
                                                                  IF "Plant Type" <> '' THEN BEGIN
                                                                    VALIDATE("Cost Component Plant");
                                                                    //IF ("Item No." + "Basic Item" + "Trade Item" = '') THEN  //*33895.n
                                                                    //  UpdateDirectUnitCost(FIELDNO("Plant No."));
                                                                  END;
                                                                  EXIT;
                                                                END;

                                                                TESTFIELD("Plant Type");
                                                                CheckCompanyIC;

                                                                PlantNoRec.GET("Plant Type", "Plant No.");

                                                                //*33895.sn
                                                                IF ("Item No." + "Basic Item" + "Trade Item" <> '') THEN BEGIN
                                                                  VALIDATE("Cost Component Plant");
                                                                  EXIT;
                                                                END;
                                                                //*33895.en

                                                                //Description := PlantNoRec.Description; //4PS.o
                                                                Description := GetTranslatedPlantDesc(MAXSTRLEN(Description)); //4PS.n

                                                                PlantTypeRec.GET("Plant Type");
                                                                IF ("Plant No." <> xRec."Plant No.") AND (CurrFieldNo = FIELDNO("Plant No.")) THEN
                                                                  DeterminePlantVendorType(TRUE);

                                                                VALIDATE("Cost Component Plant");
                                                                //UpdateDirectUnitCost(FIELDNO("Plant No."));
                                                                IF ("Document Type" = "Document Type"::Order) AND ("Plant No." <> '') AND (xRec."Plant No." = '') THEN
                                                                  DeletePurchOrderPlntRentalRate();

                                                                { **
                                                                CreateDim(
                                                                  DATABASE::"Plant Number", DimMgt.MakeCombinedPlantNo("Plant Type","Plant No."), //**4PS.n
                                                                  DATABASE::"Plant Type","Plant Type",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Service Order","Service Order No.", //** 4PS 09-06-2010
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Work Center","Work Center No.");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n  //*C007227.o
                                                                ** }
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              CheckCompanyIC;
                                                              PlantNoRec.SETRANGE("Plant Type", "Plant Type");
                                                              PlantNoRec."Plant Type" := "Plant Type";
                                                              PlantNoRec."No." := "Plant No.";
                                                              IF PAGE.RUNMODAL(0,PlantNoRec) = ACTION::LookupOK THEN
                                                                VALIDATE("Plant No.", PlantNoRec."No.");
                                                            END;

                                                   CaptionML=[ENU=Plant No.;
                                                              SVE=Maskinnr];
                                                   Description=4PS }
    { 11012552;;Bulk               ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Type".Bulk WHERE (Code=FIELD(Plant Type)));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                // Veld heeft niet juiste waarde als "Receiving Company" gevuld is!

                                                                // really?
                                                              END;

                                                   CaptionML=[ENU=Bulk;
                                                              SVE=Bulk];
                                                   Description=4PS;
                                                   Editable=No }
    { 11012553;;Cost Component Plant;Code10       ;TableRelation="Cost Component Plant";
                                                   OnValidate=VAR
                                                                lvTypeNo@1100485000 : Integer;
                                                                lvFARel@1100485001 : Boolean;
                                                                lvModeInEx@1100485003 : Code[1];
                                                                lvVendorRec@1100525000 : Record 23;
                                                              BEGIN
                                                                //**4PS
                                                                IF "Cost Component Plant" = '' THEN BEGIN
                                                                  //"Expected Enddate Rent" := 0D;
                                                                  //"Ext. Rented Plant Invoiced to" := 0D;
                                                                  "Plant Location" := '';
                                                                  EXIT;
                                                                END;

                                                                TESTFIELD("Plant Type");

                                                                //GetPurchHeader; //4PS-JTH 26-03-2010

                                                                lvVendorRec.INIT;
                                                                IF lvVendorRec.GET("Buy-from Vendor No.") THEN;

                                                                CheckCompanyIC;
                                                                PlantSetup.GET;
                                                                CostCompPlantRec.GET("Cost Component Plant");
                                                                PlantTypeRec.GET("Plant Type");
                                                                IF ("Plant No." <> '') THEN
                                                                  PlantNoRec.GET("Plant Type", "Plant No.");
                                                                { **
                                                                lvTypeNo := CheckPlantAcquisitionOrRent(Rec);
                                                                IF (lvTypeNo <> 0) THEN BEGIN
                                                                  IF ("Plant No." = '') AND
                                                                     (NOT ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote, "Document Type"::"Blanket Order"]))
                                                                  THEN
                                                                    TESTFIELD("Plant No.");
                                                                  //* Combinatie van aanschaf/inhuur materieel en artikel op een orderregel niet toegestaan, oa. ivm prijzen en omrekenfactor
                                                                  //* voor eenheden. Zou toch volgens Han al helemaal niet moeten kunnen.
                                                                  //* -> Note: C-028911 Now combi Item-Plant never allowed  //*33895.o Combi Item-Plant only not allowed for Acq./Rent
                                                                  IF ("Item No." <> '') THEN FIELDERROR("Item No.", Text11012017);
                                                                  IF ("Basic Item" <> '') THEN FIELDERROR("Basic Item", Text11012017);
                                                                  IF ("Trade Item" <> '') THEN FIELDERROR("Trade Item", Text11012017);
                                                                  IF ("Plant No." = '') THEN BEGIN
                                                                    IF PlantTypeRec.Bulk THEN BEGIN
                                                                      IF (lvTypeNo = 1) THEN
                                                                        PlantTypeRec.TESTFIELD(External, FALSE);
                                                                      IF (lvTypeNo = 2) AND (NOT PlantSetup."Ext Bulk Plant with No. in Inv") THEN
                                                                        PlantTypeRec.TESTFIELD(External, TRUE);
                                                                    END;
                                                                  END ELSE BEGIN
                                                                    IF (lvTypeNo = 1) THEN
                                                                      PlantNoRec.TESTFIELD(External, FALSE);
                                                                    IF (lvTypeNo = 2) THEN
                                                                      PlantNoRec.TESTFIELD(External, TRUE);
                                                                  END;
                                                                  IF Quantity < 0 THEN
                                                                    FIELDERROR(Quantity, Text11012036);  //C008579.n
                                                                END;
                                                                ** }
                                                                IF (lvTypeNo = 1) THEN
                                                                  lvFARel := FixedAssetPlantRelation();
                                                                IF (lvTypeNo <> 1) OR (NOT lvFARel) THEN BEGIN
                                                                  IF ("Plant No." = '') AND (lvTypeNo <> 0) THEN
                                                                    lvModeInEx := COPYSTR('IE', lvTypeNo, 1);  //* Internal/External

                                                                  IF NOT PlantPostingSetup.GET(PlantTypeRec.PlantPostingGrp("Plant No.",COMPANYNAME(),lvModeInEx),
                                                                                        lvVendorRec."Vendor Posting Group",
                                                                                        "Cost Component Plant") THEN
                                                                    PlantPostingSetup.GET(PlantTypeRec.PlantPostingGrp("Plant No.",COMPANYNAME(),lvModeInEx),
                                                                                          '', //leveranciersboekinggroep
                                                                                          "Cost Component Plant");

                                                                  Type := Type::"G/L Account";
                                                                  "No." := PlantPostingSetup."Plant Cost Account";
                                                                  VALIDATE("No.");
                                                                END;

                                                                IF ("Item No." + "Basic Item" + "Trade Item" <> '') THEN EXIT;  //*33895.n

                                                                IF ("Cost Component Plant" <> xRec."Cost Component Plant") AND (CurrFieldNo = FIELDNO("Cost Component Plant")) THEN
                                                                  DeterminePlantVendorType(TRUE);

                                                                IF ("Cost Component Plant" <> xRec."Cost Component Plant") OR ("Unit of Measure" = '') THEN BEGIN
                                                                  IF (lvTypeNo <> 0) THEN BEGIN
                                                                    IF PurchHeader."Hours Hire Order Type" <> PurchHeader."Hours Hire Order Type"::Plant THEN
                                                                      VALIDATE("Unit of Measure", PlantTypeRec."Unit of Measure");
                                                                    //UpdateDirectUnitCost(FIELDNO("Cost Component Plant"));
                                                                  END;
                                                                END;
                                                                IF ("Document Type" = "Document Type"::Order) AND ("Cost Component Plant" <> xRec."Cost Component Plant") THEN BEGIN
                                                                  DeletePurchOrderPlntRentalRate();
                                                                  //FillQtyWithPlantReorderQty();
                                                                END;

                                                                IF (lvTypeNo <> 2) THEN BEGIN
                                                                  //"Expected Enddate Rent" := 0D;
                                                                  //"Ext. Rented Plant Invoiced to" := 0D;
                                                                END;

                                                                { **
                                                                CreateDim(
                                                                  DATABASE::"Plant Number", DimMgt.MakeCombinedPlantNo("Plant Type","Plant No."), //**4PS.n
                                                                  DATABASE::"Plant Type","Plant Type",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Service Order","Service Order No.", //** 4PS 09-06-2010
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Work Center","Work Center No.");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n  //*C007227.o
                                                                ** }

                                                                //**4PSmg.sn, 29-03-11: M25024
                                                                //*OLD 25-05-2011  Function call moved to OnValidate on form (F54 Purch. Order Subform), see additional comment on call 25024
                                                                //IF "Document Type" = "Document Type"::Order THEN
                                                                //  IF "Cost Component Plant" = PlantSetup."Cost Component Acquisition" THEN
                                                                //    FillShipToLocWithPlantDepot();
                                                                //**4PSmg.en, 29-03-11: M25024
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              CheckCompanyIC;
                                                              CostCompPlantRec.Code := "Cost Component Plant";
                                                              IF PAGE.RUNMODAL(0,CostCompPlantRec) = ACTION::LookupOK THEN
                                                                VALIDATE("Cost Component Plant", CostCompPlantRec.Code);
                                                            END;

                                                   CaptionML=[ENU=Cost Component Plant;
                                                              SVE=Kostnadsdel, Maskin];
                                                   Description=4PS }
    { 11012800;;Service Order No.  ;Code20        ;TableRelation="Service Order".No.;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                //TestStatusOpen;
                                                                IF "Service Order No." = '' THEN BEGIN

                                                                  IF "Item No." <> '' THEN BEGIN
                                                                    Type := Type::Item;
                                                                    "No." := "Item No.";
                                                                  END ELSE
                                                                    "No." := '';
                                                                END ELSE BEGIN
                                                                  TESTFIELD("Job No.", '');
                                                                  CheckCompanyIC;
                                                                  ServOrderRec.GET("Service Order No.");

                                                                //  IF ("Employee No." <> '') THEN
                                                                //    CheckServiceOrderStatus(TRUE) //Posting Hours
                                                                //  ELSE
                                                                 //   CheckServiceOrderStatus(FALSE);
                                                                //  TestStatusOpen;

                                                                  Type := Type::"G/L Account";
                                                                //  "Service Source Type" := ServOrderRec."Source Type";
                                                                //  "Service Location No." := ServOrderRec."Service Location No.";
                                                                //  "Service Contract No." := ServOrderRec."Service Contract No.";
                                                                //  "Service Order Description" := ServOrderRec.Description;

                                                                //  CheckAdditionalCostService;
                                                                //  "Base Service Order No." := ServOrderRec."Base Service Order No.";
                                                                END;
                                                                FillSystemCreatedEntry;
                                                                IF "Shortcut Dimension 2 Code" <> '' THEN
                                                                  VALIDATE("Shortcut Dimension 2 Code");
                                                                //CheckCostCompServOrderType; //** 4PS06.n

                                                                //** DP0121
                                                                //IF "Service Order No." <> xRec."Service Order No." THEN
                                                                //  IF (Quantity <> 0) AND NSItemExists(xRec."Item No.") THEN
                                                                //    ReservePurchLine.VerifyChange(Rec,xRec);
                                                                //

                                                                //** 4PS 09-06-2010 sn
                                                                CreateDim(
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Number", DimMgt.MakeCombinedPlantNo("Plant Type","Plant No."), //**4PS.n
                                                                  DATABASE::"Plant Type", "Plant Type");
                                                                //  DATABASE::Job,"Job No.",
                                                                //  DATABASE::"Responsibility Center","Responsibility Center",
                                                                //  DATABASE::"Work Center","Work Center No.");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n  //*C007227.o

                                                                //** 4PS 09-06-2010 sn
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              OnLookupServiceOrderNo(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              SVE=Serviceordernr];
                                                   Description=4PS }
    { 11012825;;Main Project No.   ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Main Project No.;
                                                              SVE=Huvudprojektnr];
                                                   Description=4PS }
    { 11128010;;Auto. Acc. Group 4PS;Code10       ;TableRelation="Automatic Acc. Header";
                                                   CaptionML=[ENU=Auto. Acc. Group;
                                                              SVE=Automatkonteringsmall];
                                                   Description=4PS }
    { 11128011;;Periodic Template Code 4PS;Code10 ;TableRelation=Table11128015.Field1;
                                                   CaptionML=[ENU=Periodic Template Code;
                                                              SVE=Periodisk mallkod];
                                                   Description=4PS }
    { 11128012;;Periodic Starting Date 4PS;Date   ;CaptionML=[ENU=Periodic Starting Date;
                                                              SVE=Periodiskt startdatum];
                                                   Description=4PS }
    { 12013589;;Inbound Document No.;Integer      ;CaptionML=[ENU=Inbound Document No.;
                                                              SVE=Ing†ende dokumentnr] }
    { 12013590;;Common Item No.    ;Code20        ;CaptionML=[ENU=Common Item No.;
                                                              SVE=Gemensamt artikelnr] }
    { 12013591;;Exflow-Created Entry;Option       ;CaptionML=[ENU=Exflow-Created Entry;
                                                              SVE=ExFlow Generad rad];
                                                   OptionCaptionML=[ENU=" ,Proposa lLine,VAT ProposalLine,Diff Line,PurchCode PropLine,Misc Amount";
                                                                    SVE=" ,F”rslagsrad,Momsf”rslagsrad,Diffrad,stdink”pskodf”rslagsrad,Till„ggsbelopp"];
                                                   OptionString=[ ,ProposalLine,VATProposalLine,DiffLine,PurchCodePropLine,MiscAmount];
                                                   Editable=No }
    { 12013600;;Receipt No. Mandatory;Boolean     ;CaptionML=[ENU=Receipt No. Mandatory;
                                                              SVE=Inleveransnr obligatoriskt] }
    { 12013601;;Approval           ;Boolean       ;OnValidate=BEGIN
                                                                ExFlow.ValidateApprovalExFPurchLine(xRec,Rec);
                                                              END;

                                                   CaptionML=[ENU=Approval;
                                                              SVE=Attest] }
    { 12013603;;First Approver     ;Code50        ;TableRelation="EX User Group".Code WHERE (Blocked=CONST(No));
                                                   OnValidate=VAR
                                                                GroupName@1100285000 : Text[100];
                                                              BEGIN
                                                                "First Approver" := ExFlow.FindUserGroup("First Approver",GroupName,FALSE);
                                                              END;

                                                   CaptionML=[ENU=First Approver;
                                                              SVE=F”rste attestant] }
    { 12013605;;Original No. (Matching);Code20    ;CaptionML=[ENU=Original No. (Matching);
                                                              SVE=Urspr. nr (Matching)] }
    { 12013606;;Order No.          ;Code20        ;OnValidate=VAR
                                                                ExFlowSetup@1100285000 : Record 12013601;
                                                              BEGIN
                                                                IF "Order No." <> xRec."Order No." THEN BEGIN
                                                                  IF (xRec."Order No." <> '') AND ("Order No." = '') THEN
                                                                    IF ("Return Shipment No." <> '') OR ("Receipt No." <> '') THEN
                                                                      IF CurrFieldNo <> 0 THEN
                                                                        IF NOT CONFIRM(EXF102,FALSE) THEN
                                                                          ERROR(EXF105);

                                                                  "Return Shipment No." := '';
                                                                  "Return Shipment Line No." := 0;
                                                                  "Receipt No." := '';
                                                                  "Receipt Line No." := 0;
                                                                  "Order Line No." := 0;
                                                                END;

                                                                ExFlowSetup.GET;
                                                                IF ExFlowSetup."Force Imported Order No. Match" AND ("Order No." <> '') THEN
                                                                  SetReceiptNoMandatory(TRUE)
                                                                ELSE
                                                                  "Receipt No. Mandatory" := FALSE;
                                                              END;

                                                   ValidateTableRelation=Yes;
                                                   TestTableRelation=Yes;
                                                   CaptionML=[ENU=Order No.;
                                                              SVE=Ordernr] }
    { 12013607;;Error Message      ;Text250       ;CaptionML=[ENU=Action Message;
                                                              SVE=tg„rdsmeddelande];
                                                   Editable=No }
    { 12013608;;Validation Error   ;Boolean       ;CaptionML=[ENU=Validation Error;
                                                              SVE=Valideringsfel];
                                                   Editable=No }
    { 12013609;;Line Amount (Import);Decimal      ;CaptionML=[ENU=Line Amount (Import);
                                                              SVE=Radbelopp (Import)] }
    { 12013611;;Invoice to Customer;Boolean       ;CaptionML=[ENU=Invoice to Customer;
                                                              SVE=Vidarefakturera till kund] }
    { 12013612;;Invoicing Amount   ;Decimal       ;CaptionML=[ENU=Invoicing Amount;
                                                              SVE=Belopp att vidarefakturera] }
    { 12013613;;Start Date for Invoicing;Date     ;CaptionML=[ENU=Start Date for Invoicing;
                                                              SVE=Startdatum f”r fakturering] }
    { 12013614;;Invoicing Code     ;Code10        ;TableRelation="EX Invoicing Code";
                                                   CaptionML=[ENU=Invoicing Code;
                                                              SVE=Vidarefakturingskod] }
    { 12013615;;Total Inv. Amt. PO ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("EX Document Line"."Order Unit Cost" WHERE (Order No.=FIELD(Order No.)));
                                                   CaptionML=[ENU=Total Invoiced Amount for Purchase Order;
                                                              SVE=Totalt fakturerat belopp f”r ink”psorder];
                                                   Editable=No }
    { 12013645;;PO Matched Document;Boolean       ;CaptionML=[ENU=Matched against Purchase Order;
                                                              SVE=Kopplat mot ink”psorder] }
    { 12013659;;Applied Template Rule;Code20      ;TableRelation="Template Rule".Code;
                                                   CaptionML=[ENU=Applied Template Rule;
                                                              SVE=Till„mpad attestregel];
                                                   Editable=No }
    { 12013660;;Template Rule      ;Code20        ;TableRelation="Template Rule".Code;
                                                   CaptionML=[ENU=Template Rule;
                                                              SVE=Attestregel] }
    { 12013661;;Direct Unit Cost (Import);Decimal ;OnValidate=BEGIN
                                                                VALIDATE("Line Discount %");
                                                              END;

                                                   CaptionML=[ENU=Direct Unit Cost (Import);
                                                              SVE=Ink”pspris (Import)];
                                                   Editable=No;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 12013662;;Description (Import);Text100      ;CaptionML=[ENU=Description (Import);
                                                              SVE=Beskrivning (Import)] }
    { 12013663;;Quantity (Import)  ;Decimal       ;CaptionML=[ENU=Quantity (Import);
                                                              SVE=Antal (Import)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 12013664;;Line Discount % (Import);Decimal  ;CaptionML=[ENU=Line Discount % (Import);
                                                              SVE=Radrabatt % (Import)] }
    { 12013665;;Unit of Measure (Import);Text10   ;CaptionML=[ENU=Unit of Measure (Import);
                                                              SVE=Enhet (Import)] }
    { 12013667;;Order Line No.     ;Integer       ;TableRelation="Purchase Line"."Line No." WHERE (Document Type=FILTER(Order|Return Order),
                                                                                                   Document No.=FIELD(Order No.),
                                                                                                   Type=FILTER(G/L Account|Item|Fixed Asset|'Charge (Item)'));
                                                   OnValidate=VAR
                                                                PurchOrderHeader@1100285004 : Record 38;
                                                                PurchOrderLine@1100285000 : Record 39;
                                                                ExFlowSetup@1100285001 : Record 12013601;
                                                              BEGIN
                                                                IF ("Order Line No." <> 0) AND ((CurrFieldNo = FIELDNO("Order Line No.")) OR ForceUpdateOrderLineNo)THEN BEGIN
                                                                  GetExfPurchDocHeader;
                                                                  IF (CurrFieldNo = 0) AND (NOT TempExfPurchDocLine.ISEMPTY) THEN
                                                                    "Document Type" := TempExfPurchDocLine."Document Type"
                                                                  ELSE
                                                                    "Document Type" := ExfPurchDocHead."Document Type";

                                                                  IF "Document Type" = "Document Type"::Invoice THEN
                                                                    PurchOrderLine.GET(PurchOrderLine."Document Type"::Order,"Order No.","Order Line No.")
                                                                  ELSE
                                                                    IF "Document Type" = "Document Type"::"Credit Memo" THEN
                                                                      PurchOrderLine.GET(PurchOrderLine."Document Type"::"Return Order","Order No.","Order Line No.");

                                                                  VALIDATE(Type, PurchOrderLine.Type);
                                                                  VALIDATE("No.", PurchOrderLine."No.");
                                                                  "Check Order Line (OCR)" := TRUE;

                                                                  IF "OCR Imported Line" THEN
                                                                    RecreateImportLine(Rec);

                                                                  ExFlowSetup.GET;
                                                                  IF (ExFlowSetup."Order Applies-to" <> ExFlowSetup."Order Applies-to"::"Order not used") THEN BEGIN
                                                                    IF ("Order No. (Import)" <> '') THEN
                                                                      "Outstanding Quantity (Order)" := "Quantity (Matching)"
                                                                    ELSE
                                                                      IF ("Outstanding Quantity (Order)" = 0) AND (CurrFieldNo = FIELDNO("Order Line No.")) THEN
                                                                        "Outstanding Quantity (Order)" := Quantity;
                                                                  END;

                                                                  IF ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Purch Order Lines" THEN BEGIN
                                                                    "Shortcut Dimension 1 Code" := PurchOrderLine."Shortcut Dimension 1 Code";
                                                                    "Shortcut Dimension 2 Code" := PurchOrderLine."Shortcut Dimension 2 Code";
                                                                    "Dimension Set ID" := PurchOrderLine."Dimension Set ID";

                                                                    "Job No." := PurchOrderLine."Job No.";
                                                                    "Job Task No." := PurchOrderLine."Job Task No.";
                                                                    PurchOrderHeader.GET(PurchOrderLine."Document Type",PurchOrderLine."Document No.");
                                                                    "Purchaser Code" := PurchOrderHeader."Purchaser Code";
                                                                  END;
                                                                END
                                                                ELSE BEGIN
                                                                  IF ("Order Line No." = 0) OR (CurrFieldNo <> 0) THEN BEGIN
                                                                    "Return Shipment No." := '';
                                                                    "Return Shipment Line No." := 0;
                                                                    "Receipt No." := '';
                                                                    "Receipt Line No." := 0;
                                                                    "Order Line No." := 0;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Order Line No.;
                                                              SVE=Orderradnr] }
    { 12013670;;Dimension 1 (Import);Code20       ;CaptionML=[ENU=Dimension 1 (Import);
                                                              SVE=Dimension 1 (Import)] }
    { 12013671;;Dimension 2 (Import);Code20       ;CaptionML=[ENU=Dimension 2 (Import);
                                                              SVE=Dimension 2 (Import)] }
    { 12013680;;Quantity Received (Order);Decimal ;CaptionML=[ENU=Quantity Received (Order);
                                                              SVE=Inlevererat antal (Order)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 12013681;;Quantity Invoiced (Order);Decimal ;CaptionML=[ENU=Quantity Invoiced (Order);
                                                              SVE=Fakturerat antal (Order)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 12013682;;Direct Unit Cost (Order);Decimal  ;CaptionML=[ENU=Direct Unit Cost (Order);
                                                              SVE=Ink”pspris (Order)];
                                                   Editable=No;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 12013683;;Line Discount % (Order);Decimal   ;CaptionML=[ENU=Line Discount % (Order);
                                                              SVE=Radrabatt % (Order)];
                                                   Editable=No }
    { 12013684;;Test Unit Costs    ;Boolean       ;InitValue=No;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo <> 0 THEN BEGIN
                                                                  IF NOT "Test Unit Costs" THEN
                                                                    "Price Check Inactivated" := TRUE
                                                                  ELSE
                                                                    "Price Check Inactivated" := FALSE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Test Unit Costs;
                                                              SVE=Testa ink”pspris] }
    { 12013685;;Outstanding Quantity (Order);Decimal;
                                                   CaptionML=[ENU=Outstanding Quantity (Order);
                                                              SVE=Utest†ende antal (Order)];
                                                   DecimalPlaces=0:5 }
    { 12013686;;Order Matching Method;Option      ;CaptionML=[ENU=Order Matching Method;
                                                              SVE=Order matchningsmetod];
                                                   OptionCaptionML=[ENU=None,Single Line,Item Number,Line Amount,Quantity and Unit price,Quantity;
                                                                    SVE=Ingen,Ensam rad,Artikelnummer,Radbelopp,Antal och enhetspris,Antal];
                                                   OptionString=None,Single Line,Item Number,Line Amount,Quantity and Unit price,Quantity;
                                                   Editable=No }
    { 12013701;;Job No. (Import)   ;Code20        ;OnValidate=VAR
                                                                ExfValidatePurchDoc@1100285000 : Codeunit 12013594;
                                                              BEGIN
                                                                //348824
                                                                IF "Job No. (Import)" <> '' THEN
                                                                  VALIDATE("Job No.", ExfValidatePurchDoc.ConvertJobLineNo(Rec,"Pay-to Vendor No."));
                                                              END;

                                                   CaptionML=[ENU=Job No. (Import);
                                                              SVE=Projekt Nr. (Import)] }
    { 12013702;;Order No. (Import) ;Code20        ;OnValidate=VAR
                                                                ExFlowSetup@1100285000 : Record 12013601;
                                                              BEGIN
                                                                ExFlowSetup.GET;
                                                                IF ExFlowSetup."Force Imported Order No. Match" AND ("Order No. (Import)" <> '') THEN
                                                                  SetReceiptNoMandatory(TRUE)
                                                                ELSE
                                                                  "Receipt No. Mandatory" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Order No. (Import);
                                                              SVE=Ordernr. (Import)] }
    { 12013703;;Check Order Line (OCR);Boolean    ;CaptionML=[ENU=Check Order Line (OCR);
                                                              SVE=Kontrollera order rad (OCR)] }
    { 12013704;;Approver Comment   ;Text180       ;CaptionML=[ENU=Approver Comment;
                                                              SVE=Attestant kommentar] }
    { 12013705;;Purchaser Code     ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   OnValidate=BEGIN
                                                                IF "Purchaser Code" <> '' THEN
                                                                  CreateDim(
                                                                    DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                    DimMgt.TypeToTableID3(Type),"No.",
                                                                    DATABASE::Job,"Job No.",
                                                                    0,'');
                                                              END;

                                                   CaptionML=[ENU=Purchaser Code;
                                                              SVE=Ink”parkod] }
    { 12013706;;Original No. (Import);Code100     ;CaptionML=[ENU=Original No. (Import);
                                                              SVE=Urpsrungsnr. (Import)] }
    { 12013707;;OCR Imported Line  ;Boolean       ;CaptionML=[ENU=OCR Imported Line;
                                                              SVE=OCR importerad rad] }
    { 12013708;;OCR Line is Text Only;Boolean     ;CaptionML=[ENU=OCR Line is Text Only;
                                                              SVE=OCR rad „r bara text] }
    { 12013709;;Total Amount Lines ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line".Amount WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013710;;Total Amount Incl. VAT Lines;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line"."Amount Including VAT" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount Including VAT;
                                                              SVE=Belopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013711;;Total Amount Header;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Exflow Purch. Document Header"."Document Amount" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013712;;Total Amount Incl. VAT Header;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Exflow Purch. Document Header"."Document Amount Including VAT" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount Including VAT;
                                                              SVE=Belopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013713;;Total VAT Amount Header;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Exflow Purch. Document Header"."Document Amount VAT" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=VAT Amount;
                                                              SVE=Momsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12057070;;Direct Unit Cost (Matching);Decimal;
                                                   CaptionML=[ENU=Direct Unit Cost (Matching);
                                                              SVE=Ink”pspris (Matchning)];
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 12057071;;Quantity (Matching);Decimal       ;CaptionML=[ENU=Quantity (Matching);
                                                              SVE=Antal (Matchning)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 12057072;;Potential UOM Mismatch;Boolean    ;CaptionML=[ENU=Potential unit of measure mismatch;
                                                              SVE=M”jlig enhetskonflikt];
                                                   Editable=No }
    { 12057073;;Receipt Date       ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Purch. Rcpt. Line"."Posting Date" WHERE (Document No.=FIELD(Receipt No.),
                                                                                                                Line No.=FIELD(Receipt Line No.)));
                                                   CaptionML=[ENU=Receipt Date;
                                                              SVE=Inleveransdatum];
                                                   Editable=No }
    { 12057074;;Accept Potential UOM Mismatch;Boolean;
                                                   CaptionML=[ENU=Accept Potential unit of measure mismatch;
                                                              SVE=Acceptera m”jlig enhetskonflikt] }
    { 12057080;;Line manually changed;Boolean     ;CaptionML=[ENU=Line has manually changed;
                                                              SVE=Raden har manuellt „ndrats] }
    { 12057081;;Line matched against order;Boolean;CaptionML=[ENU=Line matched against order;
                                                              SVE=Raden matchad mot order];
                                                   Editable=No }
    { 12057082;;OCR Line No.       ;Integer       ;CaptionML=[ENU=OCR Line No.;
                                                              SVE=OCR radnummer];
                                                   Editable=No }
    { 12057083;;Temp Line Matching Handled;Boolean;CaptionML=[ENU=Handled (in session);
                                                              SVE=Hanterad (i session)];
                                                   Editable=No }
    { 12057084;;Manually Unmatched ;Boolean       ;CaptionML=[ENU=Manually Unmatched;
                                                              SVE=Manuellt omatchad] }
    { 12057085;;Matching Comment   ;Text100       ;OnValidate=BEGIN
                                                                IF CurrFieldNo <> 0 THEN BEGIN
                                                                  IF "Matching Comment" = '' THEN
                                                                    "Manual Matching Comment" := FALSE
                                                                  ELSE
                                                                    "Manual Matching Comment" := TRUE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Matching Note;
                                                              SVE=Matchningskommentar] }
    { 12057086;;Manual Matching Comment;Boolean   ;CaptionML=[ENU=Manual Matching Comment;
                                                              SVE=Manuell matchingkommentar] }
    { 12057162;;PO Matching E-Mails;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("ExFlow Email Log" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=No. of E-mail Reminders Sent (Document Tot.);
                                                              SVE=Antal skickede e-postp†minnelser (Dokument tot.)];
                                                   Editable=No }
    { 12057163;;Temp Line Recipts Missing;Boolean ;CaptionML=[ENU=Temp Line Receipts Missing;
                                                              SVE=Temp Radinleveranser saknas];
                                                   Description=Temp;
                                                   Editable=No }
    { 12057164;;Price Check Inactivated;Boolean   ;CaptionML=[ENU=Price Check Inactivated;
                                                              SVE=Priskontroll inaktiverad] }
    { 99000750;;Routing No.        ;Code20        ;TableRelation="Routing Header";
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Routing No.;
                                                              SVE=Operationsf”ljdsnr] }
    { 99000751;;Operation No.      ;Code10        ;TableRelation="Prod. Order Routing Line"."Operation No." WHERE (Status=CONST(Released),
                                                                                                                   Prod. Order No.=FIELD(Prod. Order No.),
                                                                                                                   Routing No.=FIELD(Routing No.));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Operation No.;
                                                              SVE=Operationsnr] }
    { 99000752;;Work Center No.    ;Code20        ;TableRelation="Work Center";
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Work Center No.;
                                                              SVE=Produktionsgruppsnr] }
    { 99000753;;Finished           ;Boolean       ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Finished;
                                                              SVE=Avslutad] }
    { 99000754;;Prod. Order Line No.;Integer      ;TableRelation="Prod. Order Line"."Line No." WHERE (Status=FILTER(Released..),
                                                                                                      Prod. Order No.=FIELD(Prod. Order No.));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Prod. Order Line No.;
                                                              SVE=Prod.orderradnr] }
    { 99000755;;Overhead Rate      ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Indirect Cost %");
                                                              END;

                                                   CaptionML=[ENU=Overhead Rate;
                                                              SVE=Omkostnad];
                                                   DecimalPlaces=0:5 }
    { 99000756;;MPS Order          ;Boolean       ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=MPS Order;
                                                              SVE=Prod.prog.order] }
    { 99000757;;Planning Flexibility;Option       ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Planning Flexibility;
                                                              SVE=Planeringsflexibilitet];
                                                   OptionCaptionML=[ENU=Unlimited,None;
                                                                    SVE=Obegr„nsad,Ingen];
                                                   OptionString=Unlimited,None }
    { 99000758;;Safety Lead Time   ;DateFormula   ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Safety Lead Time;
                                                              SVE=S„kerhetsledtid] }
    { 99000759;;Routing Reference No.;Integer     ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type", "Document Type"::Order);
                                                              END;

                                                   CaptionML=[ENU=Routing Reference No.;
                                                              SVE=Oper.f”ljd referensnr] }
  }
  KEYS
  {
    {    ;Inbound Document No.,Line No.           ;SumIndexFields=Amount,Amount Including VAT,VAT Base Amount,Line Amount,Prepmt. Amt. Inv.,Prepmt. Amt. Incl. VAT;
                                                   Clustered=Yes }
    {    ;Attached to Line No.                     }
    {    ;Inbound Document No.,No.                 }
    {    ;Inbound Document No.,Vendor Item No.     }
    {    ;Inbound Document No.,Common Item No.     }
    {    ;No.                                      }
    {    ;Order No.,Receipt No.                    }
    {    ;Receipt No.,Receipt Line No.             }
    {    ;Outstanding Quantity (Order)            ;MaintainSQLIndex=No }
    {    ;Exflow-Created Entry,Type               ;SumIndexFields=Amount }
    {    ;Inbound Document No.,OCR Line No.        }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ExfPurchDocHead@1100285000 : Record 12013587;
      ExfPurchDocLine2@1100285036 : Record 12013588;
      TempExfPurchDocLine@1100285038 : TEMPORARY Record 12013588;
      PurchHeaderTemp@1100285012 : TEMPORARY Record 38;
      PurchLineTemp@1100285013 : TEMPORARY Record 39;
      GLAcc@1100285040 : Record 15;
      Item@1100285004 : Record 27;
      Currency@1100285003 : Record 4;
      CurrExchRate@1100285009 : Record 330;
      ItemTranslation@1100285042 : Record 30;
      SKU@1100285010 : Record 5700;
      ItemVend@1100285015 : Record 99;
      VATPostingSetup@1100285025 : Record 325;
      StdTxt@1100285039 : Record 7;
      FA@1100285044 : Record 5600;
      FASetup@1100285045 : Record 5603;
      FADeprBook@1100285046 : Record 5612;
      GenBusPostingGrp@1100285052 : Record 250;
      GenProdPostingGrp@1100285051 : Record 251;
      UnitOfMeasure@1100285053 : Record 204;
      JobJnlLineTemp@1100285002 : TEMPORARY Record 11072008;
      DocLine@1100285059 : Record 12013609;
      GLSetup@1100285047 : Record 98;
      ReturnReason@1100285034 : Record 6635;
      ItemCharge@1100285008 : Record 5800;
      Location@1100285070 : Record 14;
      DimMgt@1100285001 : Codeunit 408;
      PurchPriceCalcMgt@1100285014 : Codeunit 7010;
      SalesTaxCalculate@1100285029 : Codeunit 398;
      UOMMgt@1100285054 : Codeunit 5402;
      DistIntegration@1100285055 : Codeunit 5702;
      ExFlow@1100285056 : Codeunit 12013601;
      Text000@1100285037 : TextConst 'ENU=You cannot rename a %1.;SVE=Du kan inte byta namn p† %1.';
      Text002@1100285041 : TextConst 'ENU=Prices including VAT cannot be calculated when %1 is %2.;SVE=Priser inklusive moms kan inte ber„knas n„r %1 „r %2.';
      Text003@1100285043 : TextConst 'ENU=You cannot purchase resources.;SVE=Du kan inte k”pa in resurser.';
      Text004@1100285048 : TextConst 'ENU=must not be less than %1;SVE=f†r inte vara mindre „n %1';
      Text006@1100285021 : TextConst 'ENU=You cannot invoice more than %1 units.;SVE=Du kan inte fakturera mer „n %1 stycken.';
      Text007@1100285022 : TextConst 'ENU=You cannot invoice more than %1 base units.;SVE=Du kan inte fakturera mer „n %1 basenheter.';
      Text010@1100285005 : TextConst 'ENU=You cannot change %1 when %2 is %3.;SVE=Du kan inte „ndra %1 n„r %2 „r %3.';
      ExFlowSEMgt@1100285065 : Codeunit 12013598;
      DeferralUtilities@1100285057 : Codeunit 1720;
      UnitCostCurrency@1100285006 : Decimal;
      UpdateFromVAT@1100285011 : Boolean;
      Text011@1100285049 : TextConst 'ENU=" must be 0 when %1 is %2";SVE=" m†ste vara 0 n„r %1 „r %2"';
      Text012@1100285050 : TextConst 'ENU="must not be specified when %1 = %2";SVE="ska inte specificeras n„r %1 = %2"';
      Text020@1100285032 : TextConst 'ENU=You cannot return more than %1 units.;SVE=Du kan inte returnera mer „n %1 stycken.';
      Text021@1100285033 : TextConst 'ENU=You cannot return more than %1 base units.;SVE=Du kan inte returnera mer „n %1 (bas) stycken.';
      Text022@1100285063 : TextConst 'ENU=You cannot change %1, if item charge is already posted.;SVE=Du kan inte „ndra %1 om artikelomkostnaden redan „r bokf”rd.';
      Text029@1100285018 : TextConst 'ENU=must be positive.;SVE=m†ste vara positivt.';
      Text030@1100285017 : TextConst 'ENU=must be negative.;SVE=m†ste vara negativt.';
      Text032@1100285062 : TextConst 'ENU=%1 must not be greater than %2.;SVE=%1 f†r inte vara st”rre „n %2.';
      Text035@1100285020 : TextConst 'ENU=%1 units for %2 %3 have already been returned or transferred. Therefore, only %4 units can be returned.;SVE=%1 enheter f”r %2 %3 har redan returnerats eller ”verf”rts. D„rf”r g†r det bara att returnera %4 enheter.';
      Text036@1100285026 : TextConst 'ENU=You must cancel the existing approval for this document to be able to change the %1 field.;SVE=Du m†ste avbryta det befintliga godk„nnandet f”r det h„r dokumentet om du vill „ndra f„ltet %1.';
      Text037@1100285028 : TextConst 'ENU=cannot be %1.;SVE=kan inte vara %1.';
      Text038@1100285030 : TextConst 'ENU=cannot be less than %1.;SVE=f†r inte vara mindre „n %1.';
      Text039@1100285031 : TextConst 'ENU=cannot be more than %1.;SVE=f†r inte vara st”rre „n %1.';
      Text040@1100285066 : TextConst 'ENU=You must use form %1 to enter %2, if item tracking is used.;SVE=Du m†ste anv„nda formul„ret %1 f”r att ange %2 om artikelsp†rning anv„nds.';
      Text042@1100285019 : TextConst 'ENU=You cannot return more than the %1 units that you have received for %2 %3.;SVE=Du kan inte returnera fler „n de %1 enheter som du har mottagit f”r %2 %3.';
      Text043@1100285027 : TextConst 'ENU=must be positive when %1 is not 0.;SVE=m†ste vara positivt n„r %1 „r skilt fr†n 0.';
      StatusCheckSuspended@1100285035 : Boolean;
      Text047@1100285071 : TextConst 'ENU=%1 can only be set when %2 is set.;SVE=%1 kan endast st„llas in n„r %2 har st„llts in.';
      Text049@1100285069 : TextConst 'ENU=You have changed one or more dimensions on the %1, which is already shipped. When you post the line with the changed dimension to General Ledger, amounts on the Inventory Interim account will be out of balance when reported per dimension.\\Do you want to keep the changed dimension?;SVE=Du har „ndrat en eller flera dimensioner i %1, som redan levererats. N„r du bokf”r raden med den „ndrade dimensionen i redovisningen kommer summorna p† kontot f”r interimlager inte att st„mma n„r de rapporteras per dimension.\\Vill du beh†lla den „ndrade dimensionen?';
      Text050@1100285068 : TextConst 'ENU=Cancelled.;SVE=Avbruten.';
      EXF102@1100285058 : TextConst 'ENU=If Order No. is empty all connections to Recipt will be removed and ordermatching will be inactivated. Proceed?;SVE=Om du t”mmer Ordernummer s† kommer kopplingar mot inleveransrader tas bort samt ordermatchning inaktiveras. Forts„tta?';
      ItemChargeAssgntPurch@1100285060 : Record 12013594;
      DoNoUpdateVAT@1100285016 : Boolean;
      GLSetupRead@1100285007 : Boolean;
      EXF105@1100285067 : TextConst 'ENU=Operation aborted.;SVE=Funktionen avbryten.';
      ForceUpdateOrderLineNo@1100285061 : Boolean;
      EXF106@1100285023 : TextConst 'ENU=You may not distrubute charges manually when automatic distribution is activate in ExFlow Setup.;SVE=Du kan inte distribuera omkostnader manuellt n„r automatisk distribution „r aktiverad i ExFlowinst„llningar.';
      "* 4PS *"@1025 : Integer;
      PurchSetup@1024 : Record 312;
      PurchHeader@1023 : Record 38;
      PurchLine2@1021 : Record 39;
      ICProjSetupRec@1020 : Record 315;
      ProjElemRec@1019 : Record 11012010;
      ProjTypeRec@1018 : Record 11012009;
      ExtensionContract@1017 : Record 11012004;
      PlantSetup@1016 : Record 11012550;
      PlantTypeRec@1015 : Record 11012551;
      PlantNoRec@1014 : Record 11012552;
      CostCompPlantRec@1013 : Record 11012575;
      PlantPostingSetup@1012 : Record 11012570;
      InvtSetup@1011 : Record 313;
      ItemRec@1010 : Record 27;
      ProjRec@1008 : Record 11072003;
      PlantVendorRec@1007 : Record 11012596;
      PlantVendorType@1006 : Option;
      ElementFormat@1005 : Codeunit 11012022;
      ValidateCu@1004 : Codeunit 11012033;
      HideDialog@1002 : Boolean;
      SaveFieldNo@1001 : Integer;
      ItemTypeOpt@1000 : 'Item,Basic Item,Trade Item,Trade Vendor';
      "** 4PS **"@1043 : TextConst;
      Text11012020@1042 : TextConst 'ENU=Reopen %1 %2 of %3 %4 ?;SVE=Vill du ”ppna %1 %2 av %3 %4 igen?';
      Text11012017@1041 : TextConst 'ENU=not allowed for acquisition/rent of plant;SVE=till†ts inte f”r anskaffning/hyra av Maskin';
      Text11012000@1040 : TextConst 'ENU=does not match that of the Cost Object;SVE=matchar inte uppgiften f”r kostnadsobjekt';
      Text11012001@1039 : TextConst 'ENU=%1 %2 is not available at %3.;SVE=%1 %2 „r inte tillg„nglig vid %3.';
      Text11012002@1038 : TextConst 'ENU=Record attached to Receipt %1 line %2, quantity is outside the range %3 ... %4, continue ?;SVE=Posten „r bifogad till mallen %1 rad %2, antalet „r utanf”r intervallet %3 ... %4. Forts„tta?';
      Text11012003@1037 : TextConst 'ENU=%1 %2 has %3 %4.;SVE=%1 %2 har %3 %4.';
      Text11012004@1036 : TextConst 'ENU=Change Cost Type ?;SVE=Žndra kostnadstyp?';
      Text11012005@1035 : TextConst 'ENU=%1 should not be larger then %2;SVE=%1 f†r inte vara st”rre „n %2';
      Text11012008@1034 : TextConst 'ENU=You cannot invoice more than %1.;SVE=Du kan inte fakturera mer „n %1.';
      Text11012009@1033 : TextConst 'ENU=You cannot receive more than %1.;SVE=Du kan inte erh†lla mer „n %1.';
      Text11012010@1032 : TextConst 'ENU=Record attached to Receipt %1 line %2, amount is larger then open amount %3, continue ?;SVE=Posten „r bifogad till mallen %1 rad %2, beloppet „r st”rre „n det ”ppna beloppet %3. Vill du forts„tta?';
      Text11012011@1031 : TextConst 'ENU=Record attached to Receipt %1 line %2, amount is larger then invoiced amount %3, continue ?;SVE=Posten „r bifogad till mallen %1 rad %2, beloppet „r st”rre „n det fakturerade beloppet %3. Vill du forts„tta?';
      Text11012036@1030 : TextConst 'ENU=may not be negative for purchase or rent of Plant';
      DimVal2Rec@1003 : Record 349;
      Dim1@1022 : Code[20];
      Dim2@1009 : Code[20];
      DimVal1Rec@1100285502 : Record 349;
      ServOrderRec@1100285501 : Record 11012823;
      ServTypeRec@1100285500 : Record 11012814;

    LOCAL PROCEDURE GetExfPurchDocHeader@1();
    BEGIN
      TESTFIELD("Inbound Document No.");
      IF ("Document Type" <> ExfPurchDocHead."Document Type") OR
         ("Inbound Document No." <> ExfPurchDocHead."Inbound Document No.") THEN
      BEGIN
        ExfPurchDocHead.GET("Inbound Document No.");
        IF ExfPurchDocHead."Currency Code" = '' THEN
          Currency.InitRoundingPrecision
        ELSE BEGIN
          ExfPurchDocHead.TESTFIELD("Currency Factor");
          Currency.GET(ExfPurchDocHead."Currency Code");
          Currency.TESTFIELD("Amount Rounding Precision");
        END;
      END;
    END;

    PROCEDURE SetExfPurchDocHeader@12(NewExfPurchDocHead@1000 : Record 12013587);
    BEGIN
      ExfPurchDocHead := NewExfPurchDocHead;

      IF ExfPurchDocHead."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE BEGIN
        ExfPurchDocHead.TESTFIELD("Currency Factor");
        Currency.GET(ExfPurchDocHead."Currency Code");
        Currency.TESTFIELD("Amount Rounding Precision");
      END;
    END;

    LOCAL PROCEDURE GetItem@4();
    BEGIN
      TESTFIELD("No.");
      IF Item."No." <> "No." THEN
        Item.GET("No.");
    END;

    LOCAL PROCEDURE UpdateDirectUnitCost@2(CalledByFieldNo@1000 : Integer);
    BEGIN
      IF (CurrFieldNo <> 0) AND ("Prod. Order No." <> '') THEN
        UpdateAmounts;

      IF ((CalledByFieldNo <> CurrFieldNo) AND (CurrFieldNo <> 0)) OR
         ("Prod. Order No." <> '')
      THEN
        EXIT;

      IF ("Direct Unit Cost (Import)" <> 0) OR ("Direct Unit Cost (Order)" <> 0) THEN BEGIN
        VALIDATE("Direct Unit Cost");
        EXIT;
      END;

      IF Type = Type::Item THEN BEGIN
        GetExfPurchDocHeader;
        PurchHeaderTemp.TRANSFERFIELDS(ExfPurchDocHead);
        PurchLineTemp.TRANSFERFIELDS(Rec);
        PurchPriceCalcMgt.FindPurchLinePrice(PurchHeaderTemp,PurchLineTemp,CalledByFieldNo);
        PurchPriceCalcMgt.FindPurchLineLineDisc(PurchHeaderTemp,PurchLineTemp);
        VALIDATE("Direct Unit Cost",PurchLineTemp."Direct Unit Cost");

        IF CalledByFieldNo IN [FIELDNO("No."),FIELDNO("Variant Code"),FIELDNO("Location Code")] THEN
        SetVendorItemNo;
      END;
    END;

    PROCEDURE UpdateUnitCost@5();
    VAR
      DiscountAmountPerQty@1000 : Decimal;
    BEGIN
      GetExfPurchDocHeader;
      GetGLSetup;
      IF Quantity = 0 THEN
        DiscountAmountPerQty := 0
      ELSE
        DiscountAmountPerQty :=
          ROUND(("Line Discount Amount" + "Inv. Discount Amount") / Quantity,
            GLSetup."Unit-Amount Rounding Precision");

      IF "VAT Calculation Type" = "VAT Calculation Type"::"Full VAT" THEN
        "Unit Cost" := 0
      ELSE
        IF ExfPurchDocHead."Prices Including VAT" THEN
          "Unit Cost" :=
            ("Direct Unit Cost" - DiscountAmountPerQty) * (1 + "Indirect Cost %" / 100) / (1 + "VAT %" / 100) +
            GetOverheadRateFCY - - "VAT Difference"
        ELSE
          "Unit Cost" :=
            ("Direct Unit Cost" - DiscountAmountPerQty) * (1 + "Indirect Cost %" / 100) +
            GetOverheadRateFCY;

      IF ExfPurchDocHead."Currency Code" <> '' THEN BEGIN
        ExfPurchDocHead.TESTFIELD("Currency Factor");
        "Unit Cost (LCY)" :=
          CurrExchRate.ExchangeAmtFCYToLCY(0,"Job No.", // 4PS
            GetDate,"Currency Code",
            "Unit Cost",ExfPurchDocHead."Currency Factor",FALSE); // 4PS
      END ELSE
        "Unit Cost (LCY)" := "Unit Cost";

      IF (Type = Type::Item) THEN BEGIN
        GetItem;
        IF Item."Costing Method" = Item."Costing Method"::Standard THEN BEGIN
          IF GetSKU THEN
            "Unit Cost (LCY)" := SKU."Unit Cost" * "Qty. per Unit of Measure"
          ELSE
            "Unit Cost (LCY)" := Item."Unit Cost" * "Qty. per Unit of Measure";
        END;
      END;

      "Unit Cost (LCY)" := ROUND("Unit Cost (LCY)",GLSetup."Unit-Amount Rounding Precision");
      IF ExfPurchDocHead."Currency Code" <> '' THEN
        Currency.TESTFIELD("Unit-Amount Rounding Precision");
      "Unit Cost" := ROUND("Unit Cost",Currency."Unit-Amount Rounding Precision");

      IF JobTaskIsSet AND NOT UpdateFromVAT THEN BEGIN
        CreateTempJobJnlLine(FALSE);
        JobJnlLineTemp.VALIDATE("Unit Cost (LCY)","Unit Cost (LCY)");
        UpdatePricesFromJobJnlLine;
      END;
    END;

    PROCEDURE UpdateAmounts@3();
    VAR
      VATBaseAmount@1100285000 : Decimal;
      LineAmountChanged@1100285001 : Boolean;
      PrePaymentLineAmountEntered@1100285002 : Boolean;
      RemLineAmountToInvoice@1100285003 : Decimal;
    BEGIN
      IF Type = Type::" " THEN
        EXIT;

      GetExfPurchDocHeader;
      VATBaseAmount := "VAT Base Amount";

      IF "Line Amount" <> xRec."Line Amount" THEN BEGIN
        "VAT Difference" := 0;
        LineAmountChanged := TRUE;
      END;

      IF "Line Amount" <> ROUND(Quantity * "Direct Unit Cost",Currency."Amount Rounding Precision") - "Line Discount Amount" THEN BEGIN
        "Line Amount" :=
          ROUND(Quantity * "Direct Unit Cost",Currency."Amount Rounding Precision") - "Line Discount Amount";
        "VAT Difference" := 0;
        LineAmountChanged := TRUE;
      END;

      IF NOT "Prepayment Line" THEN BEGIN
        IF "Prepayment %" <> 0 THEN BEGIN
          IF Quantity < 0 THEN
            FIELDERROR(Quantity,STRSUBSTNO(Text043,FIELDCAPTION("Prepayment %")));
          IF "Direct Unit Cost" < 0 THEN
            FIELDERROR("Direct Unit Cost",STRSUBSTNO(Text043,FIELDCAPTION("Prepayment %")));
        END;
        IF  ExfPurchDocHead."Document Type" <>  ExfPurchDocHead."Document Type"::Invoice THEN BEGIN
          "Prepayment VAT Difference" := 0;
          IF NOT PrePaymentLineAmountEntered THEN
            "Prepmt. Line Amount" := ROUND("Line Amount" * "Prepayment %" / 100,Currency."Amount Rounding Precision");
          IF "Prepmt. Line Amount" < "Prepmt. Amt. Inv." THEN
            FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text037,"Prepmt. Amt. Inv."));
          PrePaymentLineAmountEntered := FALSE;
          IF "Prepmt. Line Amount" <> 0 THEN BEGIN
            RemLineAmountToInvoice :=
              ROUND("Line Amount" * (Quantity - "Quantity Invoiced") / Quantity,Currency."Amount Rounding Precision");
            IF RemLineAmountToInvoice < ("Prepmt. Line Amount" - "Prepmt Amt Deducted") THEN
              FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text039,RemLineAmountToInvoice + "Prepmt Amt Deducted"));
          END;
        END ELSE
          IF (CurrFieldNo <> 0) AND ("Line Amount" <> xRec."Line Amount") AND
             ("Prepmt. Amt. Inv." <> 0) AND ("Prepayment %" = 100)
          THEN BEGIN
            IF "Line Amount" < xRec."Line Amount" THEN
              FIELDERROR("Line Amount",STRSUBSTNO(Text038,xRec."Line Amount"));
            FIELDERROR("Line Amount",STRSUBSTNO(Text039,xRec."Line Amount"));
          END;
      END;

      UpdateVATAmounts;

      IF VATBaseAmount <> "VAT Base Amount" THEN
        LineAmountChanged := TRUE;

      IF LineAmountChanged THEN BEGIN
        UpdateDeferralAmounts;
        LineAmountChanged := FALSE;
      END;

      InitOutstandingAmount;

      IF Type = Type::"Charge (Item)" THEN
        UpdateItemChargeAssgnt;
    END;

    PROCEDURE UpdateVATAmounts@38();
    VAR
      ExfPurchDocLine2@1000 : Record 12013588;
      TotalLineAmount@1005 : Decimal;
      TotalInvDiscAmount@1004 : Decimal;
      TotalAmount@1001 : Decimal;
      TotalAmountInclVAT@1002 : Decimal;
      TotalQuantityBase@1003 : Decimal;
    BEGIN
      // For performance reasons when deleting lines or importing lines, the VAT calculation takes a lot of time to perform
      IF DoNoUpdateVAT THEN
        EXIT;

      ExfPurchDocLine2.SETRANGE("Inbound Document No.","Inbound Document No.");
      ExfPurchDocLine2.SETFILTER("Line No.",'<>%1',"Line No.");
      IF "Line Amount" = 0 THEN
        IF xRec."Line Amount" >= 0 THEN
          ExfPurchDocLine2.SETFILTER(Amount,'>%1',0)
        ELSE
          ExfPurchDocLine2.SETFILTER(Amount,'<%1',0)
      ELSE
        IF "Line Amount" > 0 THEN
          ExfPurchDocLine2.SETFILTER(Amount,'>%1',0)
        ELSE
          ExfPurchDocLine2.SETFILTER(Amount,'<%1',0);
      ExfPurchDocLine2.SETRANGE("VAT Identifier","VAT Identifier");
      ExfPurchDocLine2.SETRANGE("Tax Group Code","Tax Group Code");

      IF "Line Amount" = "Inv. Discount Amount" THEN BEGIN
        Amount := 0;
        "VAT Base Amount" := 0;
        "Amount Including VAT" := 0;
      END ELSE BEGIN
        TotalLineAmount := 0;
        TotalInvDiscAmount := 0;
        TotalAmount := 0;
        TotalAmountInclVAT := 0;
        TotalQuantityBase := 0;
        IF ("VAT Calculation Type" = "VAT Calculation Type"::"Sales Tax") OR
           (("VAT Calculation Type" IN
             ["VAT Calculation Type"::"Normal VAT","VAT Calculation Type"::"Reverse Charge VAT"]) AND ("VAT %" <> 0))
        THEN
          IF ExfPurchDocLine2.FINDSET THEN
            REPEAT
              TotalLineAmount := TotalLineAmount + ExfPurchDocLine2."Line Amount";
              TotalInvDiscAmount := TotalInvDiscAmount + ExfPurchDocLine2."Inv. Discount Amount";
              TotalAmount := TotalAmount + ExfPurchDocLine2.Amount;
              TotalAmountInclVAT := TotalAmountInclVAT + ExfPurchDocLine2."Amount Including VAT";
              TotalQuantityBase := TotalQuantityBase + ExfPurchDocLine2."Quantity (Base)";
            UNTIL ExfPurchDocLine2.NEXT = 0;

        IF ExfPurchDocHead."Prices Including VAT" THEN
          CASE "VAT Calculation Type" OF
            "VAT Calculation Type"::"Normal VAT",
            "VAT Calculation Type"::"Reverse Charge VAT":
              BEGIN
                Amount :=
                  ROUND(
                    (TotalLineAmount - TotalInvDiscAmount + "Line Amount" - "Inv. Discount Amount") / (1 + "VAT %" / 100),
                    Currency."Amount Rounding Precision") -
                  TotalAmount;
                "VAT Base Amount" :=
                  ROUND(
                    Amount * (1 - ExfPurchDocHead."VAT Base Discount %" / 100),
                    Currency."Amount Rounding Precision");
                "Amount Including VAT" :=
                  TotalLineAmount + "Line Amount" -
                  ROUND(
                    (TotalAmount + Amount) * (ExfPurchDocHead."VAT Base Discount %" / 100) * "VAT %" / 100,
                    Currency."Amount Rounding Precision",Currency.VATRoundingDirection) -
                  TotalAmountInclVAT - TotalInvDiscAmount;
              END;
            "VAT Calculation Type"::"Full VAT":
              BEGIN
                Amount := 0;
                "VAT Base Amount" := 0;
              END;
            "VAT Calculation Type"::"Sales Tax":
              BEGIN
                ExfPurchDocHead.TESTFIELD("VAT Base Discount %",0);
                "Amount Including VAT" :=
                  ROUND("Line Amount" - "Inv. Discount Amount",Currency."Amount Rounding Precision");
                IF "Use Tax" THEN
                  Amount := "Amount Including VAT"
                ELSE
                  Amount :=
                    ROUND(
                      SalesTaxCalculate.ReverseCalculateTax(
                        "Tax Area Code","Tax Group Code","Tax Liable",ExfPurchDocHead."Posting Date",
                        TotalAmountInclVAT + "Amount Including VAT",TotalQuantityBase + "Quantity (Base)",
                        ExfPurchDocHead."Currency Factor"),
                      Currency."Amount Rounding Precision") -
                    TotalAmount;
                "VAT Base Amount" := Amount;
                IF "VAT Base Amount" <> 0 THEN
                  "VAT %" :=
                    ROUND(100 * ("Amount Including VAT" - "VAT Base Amount") / "VAT Base Amount",0.00001)
                ELSE
                  "VAT %" := 0;
              END;
          END
        ELSE
          CASE "VAT Calculation Type" OF
            "VAT Calculation Type"::"Normal VAT",
            "VAT Calculation Type"::"Reverse Charge VAT":
              BEGIN
                Amount := ROUND("Line Amount" - "Inv. Discount Amount",Currency."Amount Rounding Precision");
                "VAT Base Amount" :=
                  ROUND(Amount * (1 - ExfPurchDocHead."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                "Amount Including VAT" :=
                  TotalAmount + Amount +
                  ROUND(
                    (TotalAmount + Amount) * (1 - ExfPurchDocHead."VAT Base Discount %" / 100) * "VAT %" / 100,
                    Currency."Amount Rounding Precision",Currency.VATRoundingDirection) -
                  TotalAmountInclVAT;
              END;
            "VAT Calculation Type"::"Full VAT":
              BEGIN
                Amount := 0;
                "VAT Base Amount" := 0;
                "Amount Including VAT" := "Line Amount" - "Inv. Discount Amount";
              END;
            "VAT Calculation Type"::"Sales Tax":
              BEGIN
                Amount := ROUND("Line Amount" - "Inv. Discount Amount",Currency."Amount Rounding Precision");
                "VAT Base Amount" := Amount;
                IF "Use Tax" THEN
                  "Amount Including VAT" := Amount
                ELSE
                  "Amount Including VAT" :=
                    TotalAmount + Amount +
                    ROUND(
                      SalesTaxCalculate.CalculateTax(
                        "Tax Area Code","Tax Group Code","Tax Liable",ExfPurchDocHead."Posting Date",
                        (TotalAmount + Amount),(TotalQuantityBase + "Quantity (Base)"),
                        ExfPurchDocHead."Currency Factor"),
                      Currency."Amount Rounding Precision") -
                    TotalAmountInclVAT;
                IF "VAT Base Amount" <> 0 THEN
                  "VAT %" :=
                    ROUND(100 * ("Amount Including VAT" - "VAT Base Amount") / "VAT Base Amount",0.00001)
                ELSE
                  "VAT %" := 0;
              END;
          END;
      END;
    END;

    PROCEDURE GetDate@28() : Date;
    BEGIN
      IF ExfPurchDocHead."Posting Date" <> 0D THEN
        EXIT(ExfPurchDocHead."Posting Date");
      EXIT(WORKDATE);
    END;

    PROCEDURE Signed@20(Value@1000 : Decimal) : Decimal;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Quote,
        "Document Type"::Order,
        "Document Type"::Invoice,
        "Document Type"::"Blanket Order":
          EXIT(Value);
        "Document Type"::"Return Order",
        "Document Type"::"Credit Memo":
          EXIT(-Value);
      END;
    END;

    PROCEDURE ShowDimensions@25();
    BEGIN
      "Dimension Set ID" :=
        DimMgt.EditDimensionSet("Dimension Set ID",STRSUBSTNO('%1 %2 %3',"Document Type",FORMAT("Inbound Document No."),"Line No."));
      VerifyItemLineDim;
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
    END;

    PROCEDURE CreateDim@26(Type1@1000 : Integer;No1@1001 : Code[20];Type2@1002 : Integer;No2@1003 : Code[20];Type3@1004 : Integer;No3@1005 : Code[20];Type4@1006 : Integer;No4@1007 : Code[20]);
    VAR
      SourceCodeSetup@1008 : Record 242;
      TableID@1009 : ARRAY [10] OF Integer;
      No@1010 : ARRAY [10] OF Code[20];
    BEGIN
      SourceCodeSetup.GET;
      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;
      TableID[4] := Type4;
      No[4] := No4;
      "Shortcut Dimension 1 Code" := '';
      "Shortcut Dimension 2 Code" := '';
      GetExfPurchDocHeader;
      "Dimension Set ID" :=
        DimMgt.GetDefaultDimID(
          TableID,No,SourceCodeSetup.Purchases,"Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",
          ExfPurchDocHead."Dimension Set ID",DATABASE::Vendor);
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
    END;

    PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    VAR
      ExFWorkFlowMgt@1100285000 : Codeunit 12013593;
    BEGIN
      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");

      "Line manually changed" := TRUE;
      ExFWorkFlowMgt.CreateProposals(Rec,TRUE,TRUE,TRUE,TRUE);
    END;

    PROCEDURE LookupShortcutDimCode@30(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      DimMgt.LookupDimValueCode(FieldNumber,ShortcutDimCode);
      ValidateShortcutDimCode(FieldNumber,ShortcutDimCode);
    END;

    PROCEDURE ShowShortcutDimCode@27(VAR ShortcutDimCode@1000 : ARRAY [8] OF Code[20]);
    BEGIN
      DimMgt.GetShortcutDimensions("Dimension Set ID",ShortcutDimCode);
    END;

    LOCAL PROCEDURE GetSKU@5806() : Boolean;
    BEGIN
      TESTFIELD("No.");
      IF (SKU."Location Code" = "Location Code") AND
         (SKU."Item No." = "No.") AND
         (SKU."Variant Code" = "Variant Code")
      THEN
        EXIT(TRUE);
      IF SKU.GET("Location Code","No.","Variant Code") THEN
        EXIT(TRUE)
      ELSE
        EXIT(FALSE);
    END;

    LOCAL PROCEDURE GetFieldCaption@31(FieldNumber@1000 : Integer) : Text[100];
    VAR
      Field@1001 : Record 2000000041;
    BEGIN
      Field.GET(DATABASE::"Exflow Purchase Document Line",FieldNumber);
      EXIT(Field."Field Caption");
    END;

    LOCAL PROCEDURE GetCaptionClass@34(FieldNumber@1000 : Integer) : Text[80];
    BEGIN
      ExfPurchDocHead.RESET;
      ExfPurchDocHead.SETRANGE("Inbound Document No.","Inbound Document No.");
      IF NOT ExfPurchDocHead.FINDFIRST THEN BEGIN
        ExfPurchDocHead."Inbound Document No." := 0;
        ExfPurchDocHead.INIT;
      END;
      IF ExfPurchDocHead."Prices Including VAT" THEN
        EXIT('2,1,' + GetFieldCaption(FieldNumber))
      ELSE
        EXIT('2,0,' + GetFieldCaption(FieldNumber));
    END;

    PROCEDURE UpdatePricesFromJobJnlLine@69();
    BEGIN
      "Job Unit Price" := JobJnlLineTemp."Unit Price";
      "Job Total Price" := JobJnlLineTemp."Total Price";
      "Job Unit Price (LCY)" := JobJnlLineTemp."Unit Price (LCY)";
      "Job Total Price (LCY)" := JobJnlLineTemp."Total Price (LCY)";
      "Job Line Amount (LCY)" := JobJnlLineTemp."Line Amount (LCY)";
      "Job Line Disc. Amount (LCY)" := JobJnlLineTemp."Line Discount Amount (LCY)";
      "Job Line Amount" := JobJnlLineTemp."Line Amount";
      "Job Line Discount %" := JobJnlLineTemp."Line Discount %";
      "Job Line Discount Amount" := JobJnlLineTemp."Line Discount Amount";
    END;

    PROCEDURE JobSetCurrencyFactor@54();
    BEGIN
      GetExfPurchDocHeader;
      CLEAR(JobJnlLineTemp);
      JobJnlLineTemp.VALIDATE("Job No.","Job No.");
      JobJnlLineTemp.VALIDATE("Job Task No.","Job Task No.");
      JobJnlLineTemp.VALIDATE("Posting Date",ExfPurchDocHead."Posting Date");
      "Job Currency Factor" := JobJnlLineTemp."Currency Factor";
    END;

    PROCEDURE JobTaskIsSet@61() : Boolean;
    BEGIN
      EXIT(("Job No." <> '') AND ("Job Task No." <> '') AND (Type IN [Type::"G/L Account",Type::Item]));
    END;

    PROCEDURE CreateTempJobJnlLine@55(GetPrices@1001 : Boolean);
    BEGIN
      GetExfPurchDocHeader;
      CLEAR(JobJnlLineTemp);
      JobJnlLineTemp.DontCheckStdCost;
      JobJnlLineTemp.VALIDATE("Job No.","Job No.");
      JobJnlLineTemp.VALIDATE("Job Task No.","Job Task No.");
      JobJnlLineTemp.VALIDATE("Posting Date",ExfPurchDocHead."Posting Date");
      JobJnlLineTemp.SetCurrencyFactor("Job Currency Factor");
      IF Type = Type::"G/L Account" THEN
        JobJnlLineTemp.VALIDATE(Type,JobJnlLineTemp.Type::"G/L Account")
      ELSE
        JobJnlLineTemp.VALIDATE(Type,JobJnlLineTemp.Type::Item);
      JobJnlLineTemp.VALIDATE("No.","No.");
      JobJnlLineTemp.VALIDATE("Variant Code","Variant Code");
      JobJnlLineTemp.VALIDATE("Unit of Measure Code","Unit of Measure Code");
      JobJnlLineTemp.VALIDATE(Quantity,Quantity);

      IF NOT GetPrices THEN BEGIN
        IF xRec.FIND THEN BEGIN
          JobJnlLineTemp."Unit Cost (LCY)" := xRec."Unit Cost (LCY)";
          JobJnlLineTemp."Unit Price" := xRec."Job Unit Price";
          JobJnlLineTemp."Line Amount" := xRec."Job Line Amount";
          JobJnlLineTemp."Line Discount %" := xRec."Job Line Discount %";
          JobJnlLineTemp."Line Discount Amount" := xRec."Job Line Discount Amount";
        END ELSE BEGIN
          JobJnlLineTemp."Unit Cost (LCY)" := "Unit Cost (LCY)";
          JobJnlLineTemp."Unit Price" := "Job Unit Price";
          JobJnlLineTemp."Line Amount" := "Job Line Amount";
          JobJnlLineTemp."Line Discount %" := "Job Line Discount %";
          JobJnlLineTemp."Line Discount Amount" := "Job Line Discount Amount";
        END;
        JobJnlLineTemp.VALIDATE("Unit Price");
      END ELSE BEGIN
        JobJnlLineTemp.VALIDATE("Unit Cost (LCY)","Unit Cost (LCY)");
      END;
    END;

    LOCAL PROCEDURE GetGLSetup@45();
    BEGIN
      IF NOT GLSetupRead THEN
        GLSetup.GET;
      GLSetupRead := TRUE;
    END;

    LOCAL PROCEDURE GetLocation@7300(LocationCode@1000 : Code[10]);
    BEGIN
      IF LocationCode = '' THEN
        CLEAR(Location)
      ELSE
        IF Location.Code <> LocationCode THEN
          Location.GET(LocationCode);
    END;

    LOCAL PROCEDURE InitItemAppl@46();
    BEGIN
      "Appl.-to Item Entry" := 0;
    END;

    PROCEDURE SetVendorItemNo@64();
    BEGIN
      GetItem;
      ItemVend.INIT;
      ItemVend."Vendor No." := "Buy-from Vendor No.";
      ItemVend."Variant Code" := "Variant Code";
      Item.FindItemVend(ItemVend,"Location Code");
      VALIDATE("Vendor Item No.",ItemVend."Vendor Item No.");
    END;

    LOCAL PROCEDURE CheckApplToItemLedgEntry@53() : Code[10];
    VAR
      ItemLedgEntry@1000 : Record 32;
      ApplyRec@1005 : Record 339;
      ItemTrackingLines@1100285000 : Page 6510;
      ReturnedQty@1003 : Decimal;
      RemainingtobeReturnedQty@1004 : Decimal;
    BEGIN
      IF "Appl.-to Item Entry" = 0 THEN
        EXIT;

      IF "Receipt No." <> '' THEN
        EXIT;

      TESTFIELD(Type,Type::Item);
      TESTFIELD(Quantity);
      IF Signed(Quantity) > 0 THEN
        TESTFIELD("Prod. Order No.",'');
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
        IF Quantity < 0 THEN
          FIELDERROR(Quantity,Text029);
      END ELSE BEGIN
        IF Quantity > 0 THEN
          FIELDERROR(Quantity,Text030);
      END;
      ItemLedgEntry.GET("Appl.-to Item Entry");
      ItemLedgEntry.TESTFIELD(Positive,TRUE);
      IF (ItemLedgEntry."Lot No." <> '') OR (ItemLedgEntry."Serial No." <> '') THEN
        ERROR(Text040,ItemTrackingLines.CAPTION,FIELDCAPTION("Appl.-to Item Entry"));

      ItemLedgEntry.TESTFIELD("Item No.","No.");
      ItemLedgEntry.TESTFIELD("Variant Code","Variant Code");

      // Track qty in both alternative and base UOM for better error checking and reporting
      IF ABS("Quantity (Base)") > ItemLedgEntry.Quantity THEN
        ERROR(
          Text042,
          ItemLedgEntry.Quantity,ItemLedgEntry.FIELDCAPTION("Document No."),
          ItemLedgEntry."Document No.");

      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        IF ABS("Outstanding Qty. (Base)") > ItemLedgEntry."Remaining Quantity" THEN BEGIN
          ReturnedQty := ApplyRec.Returned(ItemLedgEntry."Entry No.");
          RemainingtobeReturnedQty := ItemLedgEntry.Quantity - ReturnedQty;
          IF NOT ("Qty. per Unit of Measure" = 0) THEN BEGIN
            ReturnedQty := ROUND(ReturnedQty / "Qty. per Unit of Measure",0.00001);
            RemainingtobeReturnedQty := ROUND(RemainingtobeReturnedQty / "Qty. per Unit of Measure",0.00001);
          END;

          IF ((("Qty. per Unit of Measure" = 0) AND (RemainingtobeReturnedQty < ABS("Outstanding Qty. (Base)"))) OR
              (("Qty. per Unit of Measure" <> 0) AND (RemainingtobeReturnedQty < ABS("Outstanding Quantity"))))
          THEN
            ERROR(
              Text035,
              ReturnedQty,ItemLedgEntry.FIELDCAPTION("Document No."),
              ItemLedgEntry."Document No.",RemainingtobeReturnedQty);
        END;

      EXIT(ItemLedgEntry."Location Code");
    END;

    LOCAL PROCEDURE SelectItemEntry@7();
    VAR
      ItemLedgEntry@1001 : Record 32;
    BEGIN
      ItemLedgEntry.SETCURRENTKEY("Item No.",Open);
      ItemLedgEntry.SETRANGE("Item No.","No.");
      ItemLedgEntry.SETRANGE(Open,TRUE);
      ItemLedgEntry.SETRANGE(Positive,TRUE);
      IF "Location Code" <> '' THEN
        ItemLedgEntry.SETRANGE("Location Code","Location Code");
      ItemLedgEntry.SETRANGE("Variant Code","Variant Code");

      IF PAGE.RUNMODAL(PAGE::"Item Ledger Entries",ItemLedgEntry) = ACTION::LookupOK THEN
        VALIDATE("Appl.-to Item Entry",ItemLedgEntry."Entry No.");
    END;

    PROCEDURE InitQtyToReceive@15();
    BEGIN
      "Qty. to Receive" := "Outstanding Quantity";
      "Qty. to Receive (Base)" := "Outstanding Qty. (Base)";

      InitQtyToInvoice;
    END;

    PROCEDURE InitQtyToShip@5803();
    BEGIN
      "Return Qty. to Ship" := "Outstanding Quantity";
      "Return Qty. to Ship (Base)" := "Outstanding Qty. (Base)";

      InitQtyToInvoice;
    END;

    PROCEDURE InitQtyToInvoice@13();
    BEGIN
      "Qty. to Invoice" := MaxQtyToInvoice;
      "Qty. to Invoice (Base)" := MaxQtyToInvoiceBase;
      "VAT Difference" := 0;
      CalcInvDiscToInvoice;
      IF ExfPurchDocHead."Document Type" <> ExfPurchDocHead."Document Type"::Invoice THEN
        CalcPrepaymentToDeduct;
    END;

    PROCEDURE MaxQtyToInvoice@18() : Decimal;
    BEGIN
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        EXIT("Return Qty. Shipped" + "Return Qty. to Ship" - "Quantity Invoiced");

      EXIT("Quantity Received" + "Qty. to Receive" - "Quantity Invoiced");
    END;

    PROCEDURE MaxQtyToInvoiceBase@17() : Decimal;
    BEGIN
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        EXIT("Return Qty. Shipped (Base)" + "Return Qty. to Ship (Base)" - "Qty. Invoiced (Base)");

      EXIT("Qty. Received (Base)" + "Qty. to Receive (Base)" - "Qty. Invoiced (Base)");
    END;

    PROCEDURE CalcInvDiscToInvoice@33();
    VAR
      OldInvDiscAmtToInv@1000 : Decimal;
    BEGIN
      GetExfPurchDocHeader;
      OldInvDiscAmtToInv := "Inv. Disc. Amount to Invoice";
      IF Quantity = 0 THEN
        VALIDATE("Inv. Disc. Amount to Invoice",0)
      ELSE
        VALIDATE(
          "Inv. Disc. Amount to Invoice",
          ROUND(
            "Inv. Discount Amount" * "Qty. to Invoice" / Quantity,
            Currency."Amount Rounding Precision"));

      IF OldInvDiscAmtToInv <> "Inv. Disc. Amount to Invoice" THEN BEGIN
          "Amount Including VAT" := "Amount Including VAT" - "VAT Difference";
        "VAT Difference" := 0;
      END;
    END;

    PROCEDURE CalcPrepaymentToDeduct@59();
    BEGIN
      IF (Quantity - "Quantity Invoiced") <> 0 THEN BEGIN
        GetExfPurchDocHeader;
        IF ExfPurchDocHead."Prices Including VAT" THEN
          "Prepmt Amt to Deduct" :=
            ROUND(
              ROUND(
                ROUND(
                  ROUND("Direct Unit Cost" * "Qty. to Invoice",Currency."Amount Rounding Precision") *
                  (1 - ("Line Discount %" / 100)),Currency."Amount Rounding Precision") *
                ("Prepayment %" / 100) / (1 + ("VAT %" / 100)),Currency."Amount Rounding Precision") *
              (1 + ("VAT %" / 100)),Currency."Amount Rounding Precision")
        ELSE
          "Prepmt Amt to Deduct" :=
            ROUND(
              ROUND(
                ROUND("Direct Unit Cost" * "Qty. to Invoice",Currency."Amount Rounding Precision") *
                (1 - ("Line Discount %" / 100)),Currency."Amount Rounding Precision") *
              "Prepayment %" / 100,Currency."Amount Rounding Precision")
      END ELSE
        "Prepmt Amt to Deduct" := 0
    END;

    LOCAL PROCEDURE CalcBaseQty@14(Qty@1000 : Decimal) : Decimal;
    BEGIN
      IF "Prod. Order No." = '' THEN
        TESTFIELD("Qty. per Unit of Measure");
      EXIT(ROUND(Qty * "Qty. per Unit of Measure",0.00001));
    END;

    PROCEDURE InitOutstanding@16();
    BEGIN
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
        "Outstanding Quantity" := Quantity - "Return Qty. Shipped";
        "Outstanding Qty. (Base)" := "Quantity (Base)" - "Return Qty. Shipped (Base)";
        "Return Qty. Shipped Not Invd." := "Return Qty. Shipped" - "Quantity Invoiced";
        "Ret. Qty. Shpd Not Invd.(Base)" := "Return Qty. Shipped (Base)" - "Qty. Invoiced (Base)";
      END ELSE BEGIN
        "Outstanding Quantity" := Quantity - "Quantity Received";
        "Outstanding Qty. (Base)" := "Quantity (Base)" - "Qty. Received (Base)";
        "Qty. Rcd. Not Invoiced" := "Quantity Received" - "Quantity Invoiced";
        "Qty. Rcd. Not Invoiced (Base)" := "Qty. Received (Base)" - "Qty. Invoiced (Base)";
      END;
      "Completely Received" := (Quantity <> 0) AND ("Outstanding Quantity" = 0);
      InitOutstandingAmount;
    END;

    PROCEDURE InitOutstandingAmount@19();
    VAR
      AmountInclVAT@1000 : Decimal;
    BEGIN
      IF Quantity = 0 THEN BEGIN
        "Outstanding Amount" := 0;
        "Outstanding Amount (LCY)" := 0;
        "Amt. Rcd. Not Invoiced" := 0;
        "Amt. Rcd. Not Invoiced (LCY)" := 0;
        "Return Shpd. Not Invd." := 0;
        "Return Shpd. Not Invd. (LCY)" := 0;
      END ELSE BEGIN
        GetExfPurchDocHeader;
          AmountInclVAT := "Amount Including VAT";
          IF ExfPurchDocHead."Prices Including VAT" THEN
            AmountInclVAT := "Line Amount" - "Inv. Discount Amount"
          ELSE
            IF "VAT Calculation Type" = "VAT Calculation Type"::"Sales Tax" THEN BEGIN
              IF "Use Tax" THEN
                AmountInclVAT := "Line Amount" - "Inv. Discount Amount"
              ELSE
                AmountInclVAT :=
                  "Line Amount" - "Inv. Discount Amount" +
                  ROUND(
                    SalesTaxCalculate.CalculateTax(
                      "Tax Area Code","Tax Group Code","Tax Liable",ExfPurchDocHead."Posting Date",
                      "Line Amount" - "Inv. Discount Amount","Quantity (Base)",ExfPurchDocHead."Currency Factor"),
                    Currency."Amount Rounding Precision")
            END ELSE
              AmountInclVAT :=
                ROUND(
                  ("Line Amount" - "Inv. Discount Amount") *
                  (1 + "VAT %" / 100 * (1 - ExfPurchDocHead."VAT Base Discount %" / 100)),
                  Currency."Amount Rounding Precision");
        VALIDATE(
          "Outstanding Amount",
          ROUND(
            AmountInclVAT * "Outstanding Quantity" / Quantity,
            Currency."Amount Rounding Precision"));
        IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
          VALIDATE(
            "Return Shpd. Not Invd.",
            ROUND(
              AmountInclVAT * "Return Qty. Shipped Not Invd." / Quantity,
              Currency."Amount Rounding Precision"))
        ELSE
          VALIDATE(
            "Amt. Rcd. Not Invoiced",
            ROUND(
              AmountInclVAT * "Qty. Rcd. Not Invoiced" / Quantity,
              Currency."Amount Rounding Precision"));
      END;
    END;

    PROCEDURE SuspendStatusCheck@42(Suspend@1000 : Boolean);
    BEGIN
      StatusCheckSuspended := Suspend;
    END;

    PROCEDURE SetDoNoUpdateVAT@1100285004(_DoNoUpdateVAT@1100285000 : Boolean);
    BEGIN
      DoNoUpdateVAT := _DoNoUpdateVAT;
    END;

    PROCEDURE ItemExists@52(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      Item2@1001 : Record 27;
    BEGIN
      IF Type = Type::Item THEN
        IF NOT Item2.GET(ItemNo) THEN
          EXIT(FALSE);
      EXIT(TRUE);
    END;

    PROCEDURE GetItemTranslation@44();
    BEGIN
      GetExfPurchDocHeader;
      IF ItemTranslation.GET("No.","Variant Code",ExfPurchDocHead."Language Code") THEN BEGIN
        Description := ItemTranslation.Description;
        "Description 2" := ItemTranslation."Description 2";
      END;
    END;

    LOCAL PROCEDURE GetFAPostingGroup@10();
    VAR
      LocalGLAcc@1000 : Record 15;
      FAPostingGr@1001 : Record 5606;
    BEGIN
      IF (Type <> Type::"Fixed Asset") OR ("No." = '') THEN
        EXIT;
      IF "Depreciation Book Code" = '' THEN BEGIN
        FASetup.GET;
        "Depreciation Book Code" := FASetup."Default Depr. Book";
        IF NOT FADeprBook.GET("No.","Depreciation Book Code") THEN
          "Depreciation Book Code" := '';
        IF "Depreciation Book Code" = '' THEN
          EXIT;
      END;
      IF "FA Posting Type" = "FA Posting Type"::" " THEN
        "FA Posting Type" := "FA Posting Type"::"Acquisition Cost";
      FADeprBook.GET("No.","Depreciation Book Code");
      FADeprBook.TESTFIELD("FA Posting Group");
      FAPostingGr.GET(FADeprBook."FA Posting Group");
      IF "FA Posting Type" = "FA Posting Type"::"Acquisition Cost" THEN BEGIN
        FAPostingGr.TESTFIELD("Acquisition Cost Account");
        LocalGLAcc.GET(FAPostingGr."Acquisition Cost Account");
      END ELSE BEGIN
        FAPostingGr.TESTFIELD("Maintenance Expense Account");
        LocalGLAcc.GET(FAPostingGr."Maintenance Expense Account");
      END;
      LocalGLAcc.CheckGLAcc;
      LocalGLAcc.TESTFIELD("Gen. Prod. Posting Group");
      "Posting Group" := FADeprBook."FA Posting Group";
      "Gen. Prod. Posting Group" := LocalGLAcc."Gen. Prod. Posting Group";
      "Tax Group Code" := LocalGLAcc."Tax Group Code";
      VALIDATE("VAT Prod. Posting Group",LocalGLAcc."VAT Prod. Posting Group");
    END;

    LOCAL PROCEDURE UpdatePrePaymentAmounts@65();
    VAR
      ReceiptLine@1000 : Record 121;
      PurchOrderLine@1001 : Record 39;
    BEGIN
      IF NOT ReceiptLine.GET("Receipt No.","Receipt Line No.") THEN BEGIN
        "Prepmt Amt to Deduct" := 0;
        "Prepmt VAT Diff. to Deduct" := 0;
      END ELSE BEGIN
        IF PurchOrderLine.GET(PurchOrderLine."Document Type"::Order,ReceiptLine."Order No.",ReceiptLine."Order Line No.") THEN BEGIN
          "Prepmt Amt to Deduct" :=
            ROUND((PurchOrderLine."Prepmt. Amt. Inv." - PurchOrderLine."Prepmt Amt Deducted") *
                   Quantity / (PurchOrderLine.Quantity - PurchOrderLine."Quantity Invoiced"),Currency."Amount Rounding Precision");
          "Prepmt VAT Diff. to Deduct" := "Prepayment VAT Difference" - "Prepmt VAT Diff. Deducted";
        END ELSE BEGIN
          "Prepmt Amt to Deduct" := 0;
          "Prepmt VAT Diff. to Deduct" := 0;
        END
      END;

      GetExfPurchDocHeader;
      IF ExfPurchDocHead."Prices Including VAT" THEN BEGIN
        "Prepmt. Line Amount" := ROUND("Prepmt Amt to Deduct" * (1 + ("Prepayment VAT %" / 100)),Currency."Amount Rounding Precision");
        "Prepmt. Amt. Incl. VAT" := "Prepmt. Line Amount";
      END ELSE BEGIN
        "Prepmt. Line Amount" := "Prepmt Amt to Deduct";
        "Prepmt. Amt. Incl. VAT" := ROUND("Prepmt Amt to Deduct" * (1 + ("Prepayment VAT %" / 100)),Currency."Amount Rounding Precision"
      );
      END;
      "Prepmt. Amt. Inv." := "Prepmt. Line Amount";
      "Prepayment Amount" := "Prepmt Amt to Deduct";
      "Prepmt. VAT Base Amt." := "Prepmt Amt to Deduct";
      "Prepmt. Amount Inv. Incl. VAT" := "Prepmt. Line Amount";
      "Prepmt Amt Deducted" := 0;
    END;

    PROCEDURE UpdateUOMQtyPerStockQty@9();
    BEGIN
      GetItem;
      "Unit Cost (LCY)" := Item."Unit Cost" * "Qty. per Unit of Measure";
      GetExfPurchDocHeader;
      IF ExfPurchDocHead."Currency Code" <> '' THEN
        "Unit Cost" :=
          CurrExchRate.ExchangeAmtLCYToFCY(0,"Job No.", // 4PS
            GetDate,ExfPurchDocHead."Currency Code",
            "Unit Cost (LCY)",ExfPurchDocHead."Currency Factor",FALSE) // 4PS
      ELSE
        "Unit Cost" := "Unit Cost (LCY)";
      UpdateDirectUnitCost(FIELDNO("Unit of Measure Code"));
    END;

    PROCEDURE CrossReferenceNoLookUp@51();
    VAR
      ItemCrossReference@1000 : Record 5717;
    BEGIN
      IF Type = Type::Item THEN BEGIN
        GetExfPurchDocHeader;
        ItemCrossReference.RESET;
        ItemCrossReference.SETCURRENTKEY("Cross-Reference Type","Cross-Reference Type No.");
        ItemCrossReference.SETFILTER(
          "Cross-Reference Type",'%1|%2',
          ItemCrossReference."Cross-Reference Type"::Vendor,
          ItemCrossReference."Cross-Reference Type"::" ");
        ItemCrossReference.SETFILTER("Cross-Reference Type No.",'%1|%2',ExfPurchDocHead."Buy-from Vendor No.",'');
        IF PAGE.RUNMODAL(PAGE::"Cross Reference List",ItemCrossReference) = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cross-Reference No.",ItemCrossReference."Cross-Reference No.");
          VALIDATE("Direct Unit Cost");
        END;
      END;
    END;

    PROCEDURE UpdateVATOnLines@32(QtyType@1000 : 'General,Invoicing,Shipping';VAR PurchHeader@1001 : Record 12013587;VAR PurchLine@1002 : Record 12013588;VAR VATAmountLine@1003 : Record 290);
    VAR
      TempVATAmountLineRemainder@1004 : TEMPORARY Record 290;
      Currency@1005 : Record 4;
      NewAmount@1006 : Decimal;
      NewAmountIncludingVAT@1007 : Decimal;
      NewVATBaseAmount@1008 : Decimal;
      VATAmount@1009 : Decimal;
      VATDifference@1010 : Decimal;
      InvDiscAmount@1011 : Decimal;
      LineAmountToInvoice@1012 : Decimal;
      LineAmountToInvoiceDiscounted@1013 : Decimal;
    BEGIN
      IF QtyType = QtyType::Shipping THEN
        EXIT;
      IF PurchHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(PurchHeader."Currency Code");

      TempVATAmountLineRemainder.DELETEALL;

      WITH PurchLine DO BEGIN
        SETRANGE("Inbound Document No.",PurchHeader."Inbound Document No.");
        LOCKTABLE;
        IF FINDSET THEN
          REPEAT
            IF NOT ZeroAmountLine(QtyType) THEN BEGIN
              VATAmountLine.GET("VAT Identifier","VAT Calculation Type","Tax Group Code","Use Tax","Line Amount" >= 0);
              IF VATAmountLine.Modified THEN BEGIN
                IF NOT TempVATAmountLineRemainder.GET(
                     "VAT Identifier","VAT Calculation Type","Tax Group Code","Use Tax","Line Amount" >= 0)
                THEN BEGIN
                  TempVATAmountLineRemainder := VATAmountLine;
                  TempVATAmountLineRemainder.INIT;
                  TempVATAmountLineRemainder.INSERT;
                END;

                IF QtyType = QtyType::General THEN
                  LineAmountToInvoice := "Line Amount"
                ELSE
                  LineAmountToInvoice :=
                    ROUND("Line Amount" * "Qty. to Invoice" / Quantity,Currency."Amount Rounding Precision");

                IF "Allow Invoice Disc." THEN BEGIN
                  IF VATAmountLine."Inv. Disc. Base Amount" = 0 THEN
                    InvDiscAmount := 0
                  ELSE BEGIN
                    IF QtyType = QtyType::General THEN
                      LineAmountToInvoice := "Line Amount"
                    ELSE
                      LineAmountToInvoice :=
                        ROUND("Line Amount" * "Qty. to Invoice" / Quantity,Currency."Amount Rounding Precision");
                    LineAmountToInvoiceDiscounted :=
                      VATAmountLine."Invoice Discount Amount" * LineAmountToInvoice /
                      VATAmountLine."Inv. Disc. Base Amount";
                    TempVATAmountLineRemainder."Invoice Discount Amount" :=
                      TempVATAmountLineRemainder."Invoice Discount Amount" + LineAmountToInvoiceDiscounted;
                    InvDiscAmount :=
                      ROUND(
                        TempVATAmountLineRemainder."Invoice Discount Amount",Currency."Amount Rounding Precision");
                    LineAmountToInvoiceDiscounted := ROUND(LineAmountToInvoiceDiscounted,Currency."Amount Rounding Precision");
                    IF (InvDiscAmount < 0) AND (LineAmountToInvoiceDiscounted = 0) THEN
                      InvDiscAmount := 0;
                    TempVATAmountLineRemainder."Invoice Discount Amount" :=
                      TempVATAmountLineRemainder."Invoice Discount Amount" - InvDiscAmount;
                  END;

                  IF QtyType = QtyType::General THEN BEGIN
                    "Inv. Discount Amount" := InvDiscAmount;
                    CalcInvDiscToInvoice;
                  END ELSE
                    "Inv. Disc. Amount to Invoice" := InvDiscAmount;
                END ELSE
                  InvDiscAmount := 0;
                IF QtyType = QtyType::General THEN
                  IF PurchHeader."Prices Including VAT" THEN BEGIN
                    IF (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount" = 0) OR
                       ("Line Amount" = 0)
                    THEN BEGIN
                      VATAmount := 0;
                      NewAmountIncludingVAT := 0;
                    END ELSE BEGIN
                      VATAmount :=
                        TempVATAmountLineRemainder."VAT Amount" +
                        VATAmountLine."VAT Amount" *
                        ("Line Amount" - "Inv. Discount Amount") /
                        (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount");
                      NewAmountIncludingVAT :=
                        TempVATAmountLineRemainder."Amount Including VAT" +
                        VATAmountLine."Amount Including VAT" *
                        ("Line Amount" - "Inv. Discount Amount") /
                        (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount");
                    END;
                    NewAmount :=
                      ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision") -
                      ROUND(VATAmount,Currency."Amount Rounding Precision");
                    NewVATBaseAmount :=
                      ROUND(
                        NewAmount * (1 - PurchHeader."VAT Base Discount %" / 100),
                        Currency."Amount Rounding Precision");
                  END ELSE BEGIN
                    IF "VAT Calculation Type" = "VAT Calculation Type"::"Full VAT" THEN BEGIN
                      VATAmount := "Line Amount" - "Inv. Discount Amount";
                      NewAmount := 0;
                      NewVATBaseAmount := 0;
                    END ELSE BEGIN
                      NewAmount := "Line Amount" - "Inv. Discount Amount";
                      NewVATBaseAmount :=
                        ROUND(
                          NewAmount * (1 - PurchHeader."VAT Base Discount %" / 100),
                          Currency."Amount Rounding Precision");
                      IF VATAmountLine."VAT Base" = 0 THEN
                        VATAmount := 0
                      ELSE
                        VATAmount :=
                          TempVATAmountLineRemainder."VAT Amount" +
                          VATAmountLine."VAT Amount" * NewAmount / VATAmountLine."VAT Base";
                    END;
                    NewAmountIncludingVAT := NewAmount + ROUND(VATAmount,Currency."Amount Rounding Precision");
                  END
                ELSE BEGIN
                  IF (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount") = 0 THEN
                    VATDifference := 0
                  ELSE
                      VATDifference :=
                        TempVATAmountLineRemainder."VAT Difference" +
                        VATAmountLine."VAT Difference" * (LineAmountToInvoice - InvDiscAmount) /
                        (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount");
                  IF LineAmountToInvoice = 0 THEN
                    "VAT Difference" := 0
                  ELSE
                    "VAT Difference" := ROUND(VATDifference,Currency."Amount Rounding Precision");
                END;

                IF (QtyType = QtyType::General) THEN BEGIN
                  Amount := NewAmount;
                  "Amount Including VAT" := ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision");
                  "VAT Base Amount" := NewVATBaseAmount;
                END;
                InitOutstanding;
                IF NOT ((Type = Type::"Charge (Item)") AND ("Quantity Invoiced" <> "Qty. Assigned")) THEN BEGIN
                  SetUpdateFromVAT(TRUE);
                  UpdateUnitCost;
                END;
                IF Type = Type::"Charge (Item)" THEN
                  UpdateItemChargeAssgnt;
                MODIFY;

                TempVATAmountLineRemainder."Amount Including VAT" :=
                  NewAmountIncludingVAT - ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision");
                TempVATAmountLineRemainder."VAT Amount" := VATAmount - NewAmountIncludingVAT + NewAmount;
                TempVATAmountLineRemainder."VAT Difference" := VATDifference - "VAT Difference";
                TempVATAmountLineRemainder.MODIFY;
              END;
            END;
          UNTIL NEXT = 0;
      END;
    END;

    PROCEDURE ZeroAmountLine@66(QtyType@1000 : 'General,Invoicing,Shipping') : Boolean;
    BEGIN
      IF Type = Type::" " THEN
        EXIT(TRUE);
      IF Quantity = 0 THEN
        EXIT(TRUE);
      IF ("Direct Unit Cost" = 0) OR ("Line Discount %" = 100) THEN
        EXIT(TRUE);
      IF QtyType = QtyType::Invoicing THEN
        IF "Qty. to Invoice" = 0 THEN
          EXIT(TRUE);
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE VerifyItemLineDim@73();
    BEGIN
      IF ("Dimension Set ID" <> xRec."Dimension Set ID") AND (Type = Type::Item) THEN
        IF ("Qty. Rcd. Not Invoiced" <> 0) OR ("Return Qty. Shipped Not Invd." <> 0) THEN
          IF NOT CONFIRM(Text049,TRUE,TABLECAPTION) THEN
            ERROR(Text050);
    END;

    PROCEDURE SetUpdateFromVAT@58(UpdateFromVAT2@1000 : Boolean);
    BEGIN
      UpdateFromVAT := UpdateFromVAT2;
    END;

    PROCEDURE CalcVATAmountLines@24(QtyType@1000 : 'General,Invoicing,Shipping';VAR PurchHeader@1001 : Record 12013587;VAR PurchLine@1002 : Record 12013588;VAR VATAmountLine@1003 : Record 290);
    VAR
      PrevVatAmountLine@1007 : Record 290;
      Currency@1004 : Record 4;
      SalesTaxCalculate@1005 : Codeunit 398;
      QtyToHandle@1006 : Decimal;
      RoundingLineInserted@1010 : Boolean;
      TotalVATAmount@1011 : Decimal;
    BEGIN
      IF PurchHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(PurchHeader."Currency Code");

      VATAmountLine.DELETEALL;

      WITH PurchLine DO BEGIN
        SETRANGE("Inbound Document No.",PurchHeader."Inbound Document No.");
        IF FINDSET THEN
          REPEAT
            IF NOT ZeroAmountLine(QtyType) THEN BEGIN
              IF (Type = Type::"G/L Account") AND NOT "Prepayment Line" THEN
                RoundingLineInserted := ("No." = GetVPGInvRoundAcc(PurchHeader)) OR RoundingLineInserted;
              IF "VAT Calculation Type" IN
                 ["VAT Calculation Type"::"Reverse Charge VAT","VAT Calculation Type"::"Sales Tax"]
              THEN
                "VAT %" := 0;
              IF NOT VATAmountLine.GET(
                   "VAT Identifier","VAT Calculation Type","Tax Group Code","Use Tax","Line Amount" >= 0)
              THEN BEGIN
                VATAmountLine.INIT;
                VATAmountLine."VAT Identifier" := "VAT Identifier";
                VATAmountLine."VAT Calculation Type" := "VAT Calculation Type";
                VATAmountLine."Tax Group Code" := "Tax Group Code";
                VATAmountLine."Use Tax" := "Use Tax";
                VATAmountLine."VAT %" := "VAT %";
                VATAmountLine.Modified := TRUE;
                VATAmountLine.Positive := "Line Amount" >= 0;
                VATAmountLine.INSERT;
              END;
              CASE QtyType OF
                QtyType::General:
                  BEGIN
                    VATAmountLine.Quantity := VATAmountLine.Quantity + "Quantity (Base)";
                    VATAmountLine."Line Amount" := VATAmountLine."Line Amount" + "Line Amount";
                    IF "Allow Invoice Disc." THEN
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" + "Line Amount";
                    VATAmountLine."Invoice Discount Amount" :=
                      VATAmountLine."Invoice Discount Amount" + "Inv. Discount Amount";
                    VATAmountLine."VAT Difference" := VATAmountLine."VAT Difference" + "VAT Difference";
                    IF "Prepayment Line" THEN
                      VATAmountLine."Includes Prepayment" := TRUE;
                    VATAmountLine.MODIFY;
                  END;
                QtyType::Invoicing:
                  BEGIN
                    CASE TRUE OF
                      ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
                      (NOT PurchHeader.Receive) AND PurchHeader.Invoice AND (NOT "Prepayment Line"):
                        BEGIN
                          IF "Receipt No." = '' THEN BEGIN
                            QtyToHandle := GetAbsMin("Qty. to Invoice","Qty. Rcd. Not Invoiced");
                            VATAmountLine.Quantity :=
                              VATAmountLine.Quantity + GetAbsMin("Qty. to Invoice (Base)","Qty. Rcd. Not Invoiced (Base)");
                          END ELSE BEGIN
                            QtyToHandle := "Qty. to Invoice";
                            VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Invoice (Base)";
                          END;
                        END;
                      ("Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"]) AND
                      PurchHeader.Invoice:
                        BEGIN
                          IF "Return Shipment No." = '' THEN BEGIN
                            QtyToHandle := GetAbsMin("Qty. to Invoice","Return Qty. Shipped Not Invd.");
                            VATAmountLine.Quantity :=
                              VATAmountLine.Quantity + GetAbsMin("Qty. to Invoice (Base)","Ret. Qty. Shpd Not Invd.(Base)");
                          END ELSE BEGIN
                            QtyToHandle := "Qty. to Invoice";
                            VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Invoice (Base)";
                          END;
                        END;
                      ELSE
                        BEGIN
                        QtyToHandle := "Qty. to Invoice";
                        VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Invoice (Base)";
                      END;
                    END;
                    VATAmountLine."Line Amount" :=
                      VATAmountLine."Line Amount" + GetLineAmountToHandle(QtyToHandle);
                    IF "Allow Invoice Disc." THEN
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" + GetLineAmountToHandle(QtyToHandle);
                    IF PurchHeader."Invoice Discount Calculation" <> PurchHeader."Invoice Discount Calculation"::Amount THEN
                      VATAmountLine."Invoice Discount Amount" :=
                        VATAmountLine."Invoice Discount Amount" +
                        ROUND("Inv. Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision")
                    ELSE
                      VATAmountLine."Invoice Discount Amount" :=
                        VATAmountLine."Invoice Discount Amount" + "Inv. Disc. Amount to Invoice";
                    VATAmountLine."VAT Difference" := VATAmountLine."VAT Difference" + "VAT Difference";
                    IF "Prepayment Line" THEN
                      VATAmountLine."Includes Prepayment" := TRUE;
                    VATAmountLine.MODIFY;
                  END;
                QtyType::Shipping:
                  BEGIN
                    IF "Document Type" IN
                       ["Document Type"::"Return Order","Document Type"::"Credit Memo"]
                    THEN BEGIN
                      QtyToHandle := "Return Qty. to Ship";
                      VATAmountLine.Quantity := VATAmountLine.Quantity + "Return Qty. to Ship (Base)";
                    END ELSE BEGIN
                      QtyToHandle := "Qty. to Receive";
                      VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Receive (Base)";
                    END;
                    VATAmountLine."Line Amount" :=
                      VATAmountLine."Line Amount" + GetLineAmountToHandle(QtyToHandle);
                    IF "Allow Invoice Disc." THEN
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" + GetLineAmountToHandle(QtyToHandle);
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" +
                        (ROUND(QtyToHandle * "Direct Unit Cost" - ("Line Discount Amount" * QtyToHandle / Quantity),
                        Currency."Amount Rounding Precision"));
                    VATAmountLine."Invoice Discount Amount" :=
                      VATAmountLine."Invoice Discount Amount" +
                      ROUND("Inv. Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision");
                    VATAmountLine."VAT Difference" := VATAmountLine."VAT Difference" + "VAT Difference";
                    IF "Prepayment Line" THEN
                      VATAmountLine."Includes Prepayment" := TRUE;
                    VATAmountLine.MODIFY;
                  END;
              END;
              TotalVATAmount := TotalVATAmount + "Amount Including VAT" - Amount;
            END;
          UNTIL NEXT = 0;
      END;

      WITH VATAmountLine DO
        IF FINDSET THEN
          REPEAT
            IF (PrevVatAmountLine."VAT Identifier" <> "VAT Identifier") OR
               (PrevVatAmountLine."VAT Calculation Type" <> "VAT Calculation Type") OR
               (PrevVatAmountLine."Tax Group Code" <> "Tax Group Code") OR
               (PrevVatAmountLine."Use Tax" <> "Use Tax")
            THEN
              PrevVatAmountLine.INIT;
            IF PurchHeader."Prices Including VAT" THEN BEGIN
              CASE "VAT Calculation Type" OF
                "VAT Calculation Type"::"Normal VAT",
                "VAT Calculation Type"::"Reverse Charge VAT":
                  BEGIN
                    "VAT Base" :=
                      ROUND(
                        ("Line Amount" - "Invoice Discount Amount") / (1 + "VAT %" / 100),
                        Currency."Amount Rounding Precision") - "VAT Difference";
                    "VAT Amount" :=
                      "VAT Difference" +
                      ROUND(
                        PrevVatAmountLine."VAT Amount" +
                        ("Line Amount" - "Invoice Discount Amount" - "VAT Base" - "VAT Difference") *
                        (1 - PurchHeader."VAT Base Discount %" / 100),
                        Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    "Amount Including VAT" := "VAT Base" + "VAT Amount";
                    IF Positive THEN
                      PrevVatAmountLine.INIT
                    ELSE BEGIN
                      PrevVatAmountLine := VATAmountLine;
                      PrevVatAmountLine."VAT Amount" :=
                        ("Line Amount" - "Invoice Discount Amount" - "VAT Base" - "VAT Difference") *
                        (1 - PurchHeader."VAT Base Discount %" / 100);
                      PrevVatAmountLine."VAT Amount" :=
                        PrevVatAmountLine."VAT Amount" -
                        ROUND(PrevVatAmountLine."VAT Amount",Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    END;
                  END;
                "VAT Calculation Type"::"Full VAT":
                  BEGIN
                    "VAT Base" := 0;
                    "VAT Amount" := "VAT Difference" + "Line Amount" - "Invoice Discount Amount";
                    "Amount Including VAT" := "VAT Amount";
                  END;
                "VAT Calculation Type"::"Sales Tax":
                  BEGIN
                    "Amount Including VAT" := "Line Amount" - "Invoice Discount Amount";
                    IF "Use Tax" THEN
                      "VAT Base" := "Amount Including VAT"
                    ELSE
                      "VAT Base" :=
                        ROUND(
                          SalesTaxCalculate.ReverseCalculateTax(
                            PurchHeader."Tax Area Code","Tax Group Code",PurchHeader."Tax Liable",
                            PurchHeader."Posting Date","Amount Including VAT",Quantity,PurchHeader."Currency Factor"),
                          Currency."Amount Rounding Precision");
                    "VAT Amount" := "VAT Difference" + "Amount Including VAT" - "VAT Base";
                    IF "VAT Base" = 0 THEN
                      "VAT %" := 0
                    ELSE
                      "VAT %" := ROUND(100 * "VAT Amount" / "VAT Base",0.00001);
                  END;
              END;
            END ELSE BEGIN
              CASE "VAT Calculation Type" OF
                "VAT Calculation Type"::"Normal VAT",
                "VAT Calculation Type"::"Reverse Charge VAT":
                  BEGIN
                    "VAT Base" := "Line Amount" - "Invoice Discount Amount";
                    "VAT Amount" :=
                      "VAT Difference" +
                      ROUND(
                        PrevVatAmountLine."VAT Amount" +
                        "VAT Base" * "VAT %" / 100 * (1 - PurchHeader."VAT Base Discount %" / 100),
                        Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    "Amount Including VAT" := "Line Amount" - "Invoice Discount Amount" + "VAT Amount";
                    IF Positive THEN
                      PrevVatAmountLine.INIT
                    ELSE BEGIN
                      PrevVatAmountLine := VATAmountLine;
                      PrevVatAmountLine."VAT Amount" :=
                        "VAT Base" * "VAT %" / 100 * (1 - PurchHeader."VAT Base Discount %" / 100);
                      PrevVatAmountLine."VAT Amount" :=
                        PrevVatAmountLine."VAT Amount" -
                        ROUND(PrevVatAmountLine."VAT Amount",Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    END;
                  END;
                "VAT Calculation Type"::"Full VAT":
                  BEGIN
                    "VAT Base" := 0;
                    "VAT Amount" := "VAT Difference" + "Line Amount" - "Invoice Discount Amount";
                    "Amount Including VAT" := "VAT Amount";
                  END;
                "VAT Calculation Type"::"Sales Tax":
                  BEGIN
                    "VAT Base" := "Line Amount" - "Invoice Discount Amount";
                    IF "Use Tax" THEN
                      "VAT Amount" := 0
                    ELSE
                      "VAT Amount" :=
                        SalesTaxCalculate.CalculateTax(
                          PurchHeader."Tax Area Code","Tax Group Code",PurchHeader."Tax Liable",
                          PurchHeader."Posting Date","VAT Base",Quantity,PurchHeader."Currency Factor");
                    IF "VAT Base" = 0 THEN
                      "VAT %" := 0
                    ELSE
                      "VAT %" := ROUND(100 * "VAT Amount" / "VAT Base",0.00001);
                    "VAT Amount" :=
                      "VAT Difference" +
                      ROUND("VAT Amount",Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    "Amount Including VAT" := "VAT Base" + "VAT Amount";
                  END;
              END;
            END;
            IF RoundingLineInserted THEN
              TotalVATAmount := TotalVATAmount - "VAT Amount";
            "Calculated VAT Amount" := "VAT Amount" - "VAT Difference";
            MODIFY;
          UNTIL NEXT = 0;

      IF RoundingLineInserted AND (TotalVATAmount <> 0) THEN
        IF VATAmountLine.GET(PurchLine."VAT Identifier",PurchLine."VAT Calculation Type",
             PurchLine."Tax Group Code",PurchLine."Use Tax",PurchLine."Line Amount" >= 0)
        THEN BEGIN
          VATAmountLine."VAT Amount" := VATAmountLine."VAT Amount" + TotalVATAmount;
          VATAmountLine."Amount Including VAT" := VATAmountLine."Amount Including VAT" + TotalVATAmount;
          VATAmountLine."Calculated VAT Amount" := VATAmountLine."Calculated VAT Amount" + TotalVATAmount;
          VATAmountLine.MODIFY;
        END;
    END;

    PROCEDURE GetDeferralAmount@105() DeferralAmount : Decimal;
    BEGIN
      IF "VAT Base Amount" <> 0 THEN
        DeferralAmount := "VAT Base Amount"
      ELSE
        DeferralAmount := "Line Amount" - "Inv. Discount Amount";
    END;

    LOCAL PROCEDURE UpdateDeferralAmounts@104();
    VAR
      DeferralPostDate@1000 : Date;
      AdjustStartDate@1001 : Boolean;
    BEGIN
      GetExfPurchDocHeader;
      DeferralPostDate := ExfPurchDocHead."Posting Date";
      AdjustStartDate := TRUE;
      IF "Deferral Code" <> '' THEN BEGIN
        IF "Returns Deferral Start Date" = 0D THEN
          "Returns Deferral Start Date" := ExfPurchDocHead."Posting Date";
        DeferralPostDate := "Returns Deferral Start Date";
        AdjustStartDate := FALSE;
      END;

      DeferralUtilities.RemoveOrSetDeferralSchedule(
        "Deferral Code",DeferralUtilities.GetPurchDeferralDocType,'','',
        "Document Type",FORMAT("Inbound Document No."),"Line No.",
        GetDeferralAmount,DeferralPostDate,Description,ExfPurchDocHead."Currency Code",AdjustStartDate);
    END;

    PROCEDURE ShowDeferrals@108(PostingDate@1000 : Date;CurrencyCode@1001 : Code[10]) : Boolean;
    BEGIN
      EXIT(DeferralUtilities.OpenLineScheduleEdit(
          "Deferral Code",DeferralUtilities.GetPurchDeferralDocType,'','',
          "Document Type",FORMAT("Inbound Document No."),"Line No.",
          GetDeferralAmount,PostingDate,Description,CurrencyCode));
    END;

    LOCAL PROCEDURE InitDeferralCode@112();
    BEGIN
      IF "Document Type" IN
         ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::"Credit Memo","Document Type"::"Return Order"]
      THEN
        CASE Type OF
          Type::"G/L Account":
            VALIDATE("Deferral Code",GLAcc."Default Deferral Template Code");
          Type::Item:
            VALIDATE("Deferral Code",Item."Default Deferral Template Code");
        END;
    END;

    PROCEDURE DefaultDeferralCode@110();
    BEGIN
      CASE Type OF
        Type::"G/L Account":
          BEGIN
            GLAcc.GET("No.");
            InitDeferralCode;
          END;
        Type::Item:
          BEGIN
            GetItem;
            InitDeferralCode;
          END;
      END;
    END;

    LOCAL PROCEDURE GetAbsMin@56(QtyToHandle@1000 : Decimal;QtyHandled@1001 : Decimal) : Decimal;
    BEGIN
      IF ABS(QtyHandled) < ABS(QtyToHandle) THEN
        EXIT(QtyHandled)
      ELSE
        EXIT(QtyToHandle);
    END;

    PROCEDURE ExflowVATLineExist@1100285001() : Boolean;
    VAR
      ExfPurchDocLine2@1100285000 : Record 12013588;
    BEGIN
      ExfPurchDocLine2.SETRANGE("Inbound Document No.","Inbound Document No.");
      ExfPurchDocLine2.SETRANGE("Exflow-Created Entry", "Exflow-Created Entry"::VATProposalLine);
      IF NOT ExfPurchDocLine2.ISEMPTY THEN
        EXIT(TRUE)
      ELSE
        EXIT(FALSE);
    END;

    PROCEDURE CopyImportFieldsFromTempTable@1100285002(FromTable@1100285000 : Record 12013588);
    BEGIN
      // Approval
      "Template Rule" := FromTable."Template Rule";
      "First Approver" := FromTable."First Approver";

      // Order
      "Order No." := FromTable."Order No.";
      "Quantity Received (Order)" := FromTable."Quantity Received (Order)";
      "Quantity Invoiced (Order)" := FromTable."Quantity Invoiced (Order)";
      "Direct Unit Cost (Order)" := FromTable."Direct Unit Cost (Order)";
      "Line Discount % (Order)":= FromTable."Line Discount % (Order)";

      // OCR
      "Original No. (Matching)" := FromTable."Original No. (Matching)";

      "OCR Line No." := FromTable."OCR Line No.";
      "Order Line No." := FromTable."Order Line No.";
      "Original No. (Import)" := FromTable."Original No. (Import)";
      "Line Amount (Import)" := FromTable."Line Amount (Import)";
      "Direct Unit Cost (Import)" := FromTable."Direct Unit Cost (Import)";
      "Description (Import)" := FromTable."Description (Import)";
      "Quantity (Import)" := FromTable."Quantity (Import)";
      "Line Discount % (Import)" := FromTable."Line Discount % (Import)";
      "Unit of Measure (Import)" := FromTable."Unit of Measure (Import)";
      "Outstanding Quantity (Order)" := FromTable."Outstanding Quantity (Order)";
      "Order No. (Import)" := FromTable."Order No. (Import)";
      "Job No. (Import)" := FromTable."Job No. (Import)";
      "Check Order Line (OCR)" := FromTable."Check Order Line (OCR)";

      "Direct Unit Cost (Matching)" := FromTable."Direct Unit Cost (Matching)";
      "Quantity (Matching)" := FromTable."Quantity (Matching)";

      "OCR Imported Line" := FromTable."OCR Imported Line";
      "Exflow-Created Entry" := FromTable."Exflow-Created Entry";
      "OCR Line is Text Only" := FromTable."OCR Line is Text Only";

      "Dimension 1 (Import)" := FromTable."Dimension 1 (Import)";
      "Dimension 2 (Import)" := FromTable."Dimension 2 (Import)";
      "Order Matching Method" := FromTable."Order Matching Method";
      "Matching Comment" := FromTable."Matching Comment";
      "Price Check Inactivated" := FromTable."Price Check Inactivated";
    END;

    PROCEDURE IsLineVATLine@1100285003(ExPurchDocLine@1100285000 : Record 12013588) : Boolean;
    VAR
      VATPostingSetup@1100285001 : Record 325;
    BEGIN
      IF ExPurchDocLine."Exflow-Created Entry" = ExPurchDocLine."Exflow-Created Entry"::VATProposalLine THEN
        EXIT(TRUE);

      IF ExPurchDocLine."Exflow-Created Entry" = ExPurchDocLine."Exflow-Created Entry"::" " THEN BEGIN
        VATPostingSetup.SETRANGE("VAT Bus. Posting Group", ExPurchDocLine."VAT Bus. Posting Group");
        VATPostingSetup.SETRANGE("VAT Prod. Posting Group", ExPurchDocLine."VAT Prod. Posting Group");
        IF VATPostingSetup.FINDFIRST THEN
          IF VATPostingSetup."VAT Calculation Type" = VATPostingSetup."VAT Calculation Type"::"Full VAT" THEN
            EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    PROCEDURE OrderNoLookup@1100285007();
    VAR
      PurchHeader@1100285001 : Record 38;
      PurchLine@1100285002 : Record 39;
      PurchaseList@1100285000 : Page 53;
    BEGIN
      GetExfPurchDocHeader;
      "Pay-to Vendor No." := ExfPurchDocHead."Pay-to Vendor No.";

      PurchHeader.RESET;
      CASE ExfPurchDocHead."Document Type" OF
        ExfPurchDocHead."Document Type"::Invoice:
          PurchHeader.SETRANGE("Document Type", PurchHeader."Document Type"::Order);
        ExfPurchDocHead."Document Type"::"Credit Memo":
          PurchHeader.SETRANGE("Document Type", PurchHeader."Document Type"::"Return Order");
      END;

      PurchHeader.SETRANGE("Currency Code", "Currency Code");
      PurchHeader.SETRANGE("Pay-to Vendor No.", "Pay-to Vendor No.");
      PurchHeader.SETRANGE("Buy-from Vendor No.", "Buy-from Vendor No.");
      IF "Order No." <> '' THEN BEGIN
        PurchHeader.SETRANGE("No.","Order No.");
        IF PurchHeader.FINDFIRST THEN
          PurchaseList.SETRECORD(PurchHeader);
        PurchHeader.SETRANGE("No.");
      END;

      IF PurchHeader.FINDSET THEN BEGIN
        REPEAT
          PurchLine.SETRANGE("Document Type",PurchHeader."Document Type");
          PurchLine.SETRANGE("Document No.",PurchHeader."No.");
          PurchLine.SETRANGE("Fully Matched", FALSE);
          IF NOT PurchLine.ISEMPTY THEN
            PurchHeader.MARK(TRUE);
        UNTIL PurchHeader.NEXT = 0;

        PurchHeader.MARKEDONLY(TRUE);
      END;

      PurchaseList.SETTABLEVIEW(PurchHeader);
      PurchaseList.LOOKUPMODE := TRUE;
      IF PurchaseList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        PurchaseList.GETRECORD(PurchHeader);
        VALIDATE("Order No.", PurchHeader."No.");
      END;
    END;

    LOCAL PROCEDURE GetOverheadRateFCY@40() : Decimal;
    VAR
      QtyPerUOM@1000 : Decimal;
    BEGIN
      IF "Prod. Order No." = '' THEN
        QtyPerUOM := "Qty. per Unit of Measure"
      ELSE BEGIN
        GetItem;
        QtyPerUOM := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Unit of Measure Code");
      END;

      EXIT(
        CurrExchRate.ExchangeAmtLCYToFCY(0,"Job No.", // 4PS
          GetDate,"Currency Code","Overhead Rate" * QtyPerUOM,ExfPurchDocHead."Currency Factor",FALSE)); // 4PS
    END;

    PROCEDURE ShowItemChargeAssgnt@5801();
    VAR
      ItemChargeAssgnts@1000 : Page 12013595;
      AssignItemChargePurch@1001 : Codeunit 12013597;
      ItemChargeAssgntLineAmt@1002 : Decimal;
      ExfPurchDocLine@1100285000 : Record 12013588;
      ExFlowSetup@1100285001 : Record 12013601;
    BEGIN
      ExFlowSetup.GET;
      IF ExFlowSetup."Automatic Item Charge Assignt." <> ExFlowSetup."Automatic Item Charge Assignt."::None THEN BEGIN
        ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
        ExfPurchDocLine.SETRANGE(Type,ExfPurchDocLine.Type);
        IF NOT ExfPurchDocLine.ISEMPTY THEN
          ERROR(EXF106);
      END;

      GET("Inbound Document No.","Line No.");
      TESTFIELD(Type,Type::"Charge (Item)");
      TESTFIELD("No.");
      TESTFIELD(Quantity);

      GetExfPurchDocHeader;
      IF ExfPurchDocHead."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(ExfPurchDocHead."Currency Code");
      IF ("Inv. Discount Amount" = 0) AND
         ("Line Discount Amount" = 0) AND
         (NOT ExfPurchDocHead."Prices Including VAT")
      THEN
        ItemChargeAssgntLineAmt := "Line Amount"
      ELSE
        IF ExfPurchDocHead."Prices Including VAT" THEN
          ItemChargeAssgntLineAmt :=
            ROUND(("Line Amount" - "Inv. Discount Amount") / (1 + "VAT %" / 100),
              Currency."Amount Rounding Precision")
        ELSE
          ItemChargeAssgntLineAmt := "Line Amount" - "Inv. Discount Amount";

      ItemChargeAssgntPurch.RESET;
      ItemChargeAssgntPurch.SETRANGE("Inbound Document No.", "Inbound Document No.");
      ItemChargeAssgntPurch.SETRANGE("Document Line No.","Line No.");
      ItemChargeAssgntPurch.SETRANGE("Item Charge No.","No.");
      IF NOT ItemChargeAssgntPurch.FINDLAST THEN BEGIN
        ItemChargeAssgntPurch."Document Type" := "Document Type";
        ItemChargeAssgntPurch."Inbound Document No." := "Inbound Document No.";
        ItemChargeAssgntPurch."Document Line No." := "Line No.";
        ItemChargeAssgntPurch."Item Charge No." := "No.";
        GetExfPurchDocHeader;
        ItemChargeAssgntPurch."Unit Cost" :=
          ROUND(ItemChargeAssgntLineAmt / Quantity,
            Currency."Unit-Amount Rounding Precision");
      END;

      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        AssignItemChargePurch.CreateDocChargeAssgnt(ItemChargeAssgntPurch,"Return Shipment No.")
      ELSE
        AssignItemChargePurch.CreateDocChargeAssgnt(ItemChargeAssgntPurch,"Receipt No.");
      CLEAR(AssignItemChargePurch);
      COMMIT;

      ItemChargeAssgnts.Initialize(Rec,ItemChargeAssgntLineAmt);
      ItemChargeAssgnts.RUNMODAL;
      CALCFIELDS("Qty. to Assign");
    END;

    PROCEDURE UpdateItemChargeAssgnt@5807();
    VAR
      ShareOfVAT@1000 : Decimal;
    BEGIN
      CALCFIELDS("Qty. Assigned","Qty. to Assign");
      IF ABS("Quantity Invoiced") > ABS(("Qty. Assigned" + "Qty. to Assign")) THEN
        ERROR(Text032,FIELDCAPTION("Quantity Invoiced"),FIELDCAPTION("Qty. Assigned"),FIELDCAPTION("Qty. to Assign"));

      ItemChargeAssgntPurch.RESET;
      ItemChargeAssgntPurch.SETRANGE("Inbound Document No.","Inbound Document No.");
      ItemChargeAssgntPurch.SETRANGE("Document Line No.","Line No.");
      IF (CurrFieldNo <> 0) AND ("Unit Cost" <> xRec."Unit Cost") THEN BEGIN
        ItemChargeAssgntPurch.SETFILTER("Qty. Assigned",'<>0');
        IF ItemChargeAssgntPurch.FINDFIRST THEN
          ERROR(Text022,
            FIELDCAPTION("Unit Cost"));
        ItemChargeAssgntPurch.SETRANGE("Qty. Assigned");
      END;

      IF (CurrFieldNo <> 0) AND (Quantity <> xRec.Quantity) THEN BEGIN
        ItemChargeAssgntPurch.SETFILTER("Qty. Assigned",'<>0');
        IF ItemChargeAssgntPurch.FINDFIRST THEN
          ERROR(Text022,
            FIELDCAPTION(Quantity));
        ItemChargeAssgntPurch.SETRANGE("Qty. Assigned");
      END;

      IF Quantity = 0 THEN
        EXIT;

      IF ItemChargeAssgntPurch.FINDSET THEN BEGIN
        GetExfPurchDocHeader;
        REPEAT
          ShareOfVAT := 1;
          IF ExfPurchDocHead."Prices Including VAT" THEN
            ShareOfVAT := 1 + "VAT %" / 100;
          IF Quantity <> 0 THEN
            IF ItemChargeAssgntPurch."Unit Cost" <> ROUND(
                 ("Line Amount" - "Inv. Discount Amount") / Quantity / ShareOfVAT,
                 Currency."Unit-Amount Rounding Precision")
            THEN BEGIN
              ItemChargeAssgntPurch."Unit Cost" :=
                ROUND(
                  ("Line Amount" - "Inv. Discount Amount") / Quantity / ShareOfVAT,
                  Currency."Unit-Amount Rounding Precision");
              ItemChargeAssgntPurch.VALIDATE("Qty. to Assign");
              ItemChargeAssgntPurch.MODIFY;
            END;
        UNTIL ItemChargeAssgntPurch.NEXT = 0;
        CALCFIELDS("Qty. to Assign");
      END;
    END;

    LOCAL PROCEDURE DeleteItemChargeAssgnt@5802(DocType@1000 : Option;DocNo@1001 : Integer;DocLineNo@1002 : Integer);
    BEGIN
      ItemChargeAssgntPurch.SETCURRENTKEY(
        "Applies-to Doc. Type","Applies-to Doc. No.","Applies-to Doc. Line No.");
      ItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Type",DocType);
      ItemChargeAssgntPurch.SETRANGE("Applies-to Doc. No.",FORMAT(DocNo));
      ItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Line No.",DocLineNo);
      IF NOT ItemChargeAssgntPurch.ISEMPTY THEN
        ItemChargeAssgntPurch.DELETEALL(TRUE);
    END;

    LOCAL PROCEDURE DeleteChargeChargeAssgnt@5804(DocNo@1001 : Integer;DocLineNo@1002 : Integer);
    BEGIN
      IF "Quantity Invoiced" <> 0 THEN BEGIN
        CALCFIELDS("Qty. Assigned");
        TESTFIELD("Qty. Assigned","Quantity Invoiced");
      END;
      ItemChargeAssgntPurch.RESET;
      ItemChargeAssgntPurch.SETRANGE("Inbound Document No.",DocNo);
      ItemChargeAssgntPurch.SETRANGE("Document Line No.",DocLineNo);
      IF NOT ItemChargeAssgntPurch.ISEMPTY THEN
        ItemChargeAssgntPurch.DELETEALL;
    END;

    PROCEDURE CheckItemChargeAssgnt@5800();
    VAR
      ItemChargeAssgntPurch@1000 : Record 12013594;
    BEGIN
      ItemChargeAssgntPurch.SETCURRENTKEY(
        "Applies-to Doc. Type","Applies-to Doc. No.","Applies-to Doc. Line No.");
      ItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Type","Document Type");
      ItemChargeAssgntPurch.SETRANGE("Applies-to Doc. No.",FORMAT("Inbound Document No."));
      ItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Line No.","Line No.");
      ItemChargeAssgntPurch.SETRANGE("Inbound Document No.","Inbound Document No.");
      IF ItemChargeAssgntPurch.FINDSET THEN BEGIN
        TESTFIELD("Allow Item Charge Assignment");
        REPEAT
          ItemChargeAssgntPurch.TESTFIELD("Qty. to Assign",0);
        UNTIL ItemChargeAssgntPurch.NEXT = 0;
      END;
    END;

    PROCEDURE GetVPGInvRoundAcc@72(PurchHeader@1100285001 : Record 12013587) : Code[20];
    VAR
      Vendor@1000 : Record 23;
      VendorPostingGroup@1001 : Record 93;
      PurchSetup@1002 : Record 312;
      ExFlowSetup@1100285000 : Record 12013601;
    BEGIN
      PurchSetup.GET;
      ExFlowSetup.GET;
      IF PurchSetup."Invoice Rounding" OR ExFlowSetup."Invoice Rounding" THEN
        IF Vendor.GET(PurchHeader."Pay-to Vendor No.") THEN
          VendorPostingGroup.GET(Vendor."Vendor Posting Group");

      EXIT(VendorPostingGroup."Invoice Rounding Account");
    END;

    PROCEDURE GetLineAmountToHandle@117(QtyToHandle@1002 : Decimal) : Decimal;
    VAR
      LineAmount@1001 : Decimal;
      LineDiscAmount@1000 : Decimal;
    BEGIN
      GetExfPurchDocHeader;
      LineAmount := ROUND(QtyToHandle * "Direct Unit Cost",Currency."Amount Rounding Precision");
      LineDiscAmount := ROUND("Line Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision");
      EXIT(LineAmount - LineDiscAmount);
    END;

    PROCEDURE SetReceiptNoMandatory@1100285000(ReceiptNoMandatory@1100285001 : Boolean);
    VAR
      ExFlowSetup@1100285002 : Record 12013601;
    BEGIN
      ExFlowSetup.GET;
      IF (ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"First Order then Receipt") OR
         (ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Order not used") THEN
        EXIT;

      IF ExFlowSetup."Receipt No. Mand. Item" AND (Type = Type::Item) THEN
        "Receipt No. Mandatory" := ReceiptNoMandatory;
      IF ExFlowSetup."Receipt No. Mand. G/L" AND (Type = Type::"G/L Account") THEN
        "Receipt No. Mandatory" := ReceiptNoMandatory;
      IF ExFlowSetup."Receipt No. Mand. Fixed Asset" AND (Type = Type::"Fixed Asset") THEN
        "Receipt No. Mandatory" := ReceiptNoMandatory;
      IF ExFlowSetup."Receipt No. Mand. Charge Item" AND (Type = Type::"Charge (Item)") THEN
        "Receipt No. Mandatory" := ReceiptNoMandatory;

      IF "Receipt No. Mandatory" AND ("Order No." = '') AND ("Exflow-Created Entry" <> "Exflow-Created Entry"::DiffLine) THEN BEGIN
        GetExfPurchDocHeader;
        "Order No." := ExfPurchDocHead."Order No.";
      END;
    END;

    PROCEDURE GetReceipt@1100285006();
    VAR
      ExFlowSetup@1100285000 : Record 12013601;
    BEGIN
      ExFlowSetup.GET;
      IF ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Receipts Lines" THEN
        CODEUNIT.RUN(CODEUNIT::"Exflow-Get Receipt",Rec)
      ELSE
        IF (ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Purch Order Lines") OR
           (ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"First Order then Receipt") THEN
          CODEUNIT.RUN(CODEUNIT::"Exflow-Get Purchase Order",Rec);
    END;

    PROCEDURE GetReturnShipment@1100285005();
    VAR
      ExFlowSetup@1100285000 : Record 12013601;
    BEGIN
      ExFlowSetup.GET;
      IF ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Receipts Lines" THEN
        CODEUNIT.RUN(CODEUNIT::"Exflow-Get Return Shipments",Rec)
      ELSE
        IF (ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Purch Order Lines") OR
           (ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"First Order then Receipt") THEN
          CODEUNIT.RUN(CODEUNIT::"Exflow-Get Purchase Ret. Order",Rec);
    END;

    PROCEDURE IsServiceItem@77() : Boolean;
    BEGIN
      IF Type <> Type::Item THEN
        EXIT(FALSE);
      IF "No." = '' THEN
        EXIT(FALSE);
      GetItem;
      EXIT(Item.Type = Item.Type::Service);
    END;

    PROCEDURE IsLineModified@1100285064(ExPurchLine@1100285001 : Record 12013588;xExPurchLine@1100285000 : Record 12013588) : Boolean;
    VAR
      RecRef@1100285002 : RecordRef;
      FldRef@1100285003 : FieldRef;
      xRecRef@1100285005 : RecordRef;
      xFldRef@1100285004 : FieldRef;
      TempValue@1100285006 : Decimal;
      xTempValue@1100285007 : Decimal;
    BEGIN
      RecRef.GETTABLE(ExPurchLine);
      xRecRef.GETTABLE(xExPurchLine);

      // Type
      FldRef := RecRef.FIELD(5);
      xFldRef := xRecRef.FIELD(5);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // No.
      FldRef := RecRef.FIELD(6);
      xFldRef := xRecRef.FIELD(6);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Description
      FldRef := RecRef.FIELD(11);
      xFldRef := xRecRef.FIELD(11);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Description 2
      FldRef := RecRef.FIELD(12);
      xFldRef := xRecRef.FIELD(12);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Accept Potential UOM Mismatch
      FldRef := RecRef.FIELD(12057074);
      xFldRef := xRecRef.FIELD(12057074);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Test Unit Cost
      FldRef := RecRef.FIELD(12013684);
      xFldRef := xRecRef.FIELD(12013684);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Order Line No
      FldRef := RecRef.FIELD(12013667);
      xFldRef := xRecRef.FIELD(12013667);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Invoice to customer
      FldRef := RecRef.FIELD(12013611);
      xFldRef := xRecRef.FIELD(12013611);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Quantity
      FldRef := RecRef.FIELD(15);
      xFldRef := xRecRef.FIELD(15);
      IF ExPurchLine."Document Type" = ExPurchLine."Document Type"::Order THEN BEGIN
        TempValue := 0;
        xTempValue := 0;
        IF EVALUATE(TempValue,FORMAT(FldRef.VALUE)) THEN;
        IF EVALUATE(xTempValue,FORMAT(xFldRef.VALUE)) THEN;

        IF TempValue > xTempValue THEN
          EXIT(TRUE);
      END
      ELSE
        IF FldRef.VALUE <> xFldRef.VALUE THEN
          EXIT(TRUE);

      // Line Amount
      FldRef := RecRef.FIELD(103);
      xFldRef := xRecRef.FIELD(103);
      IF ExPurchLine."Document Type" = ExPurchLine."Document Type"::Order THEN BEGIN
        TempValue := 0;
        xTempValue := 0;
        IF EVALUATE(TempValue,FORMAT(FldRef.VALUE)) THEN;
        IF EVALUATE(xTempValue,FORMAT(xFldRef.VALUE)) THEN;

        IF TempValue > xTempValue THEN
          EXIT(TRUE);
      END
      ELSE
        IF FldRef.VALUE <> xFldRef.VALUE THEN
          EXIT(TRUE);

      // VAT prod posting group
      FldRef := RecRef.FIELD(90);
      xFldRef := xRecRef.FIELD(90);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // First approver
      FldRef := RecRef.FIELD(12013603);
      xFldRef := xRecRef.FIELD(12013603);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);

      // Template rule
      FldRef := RecRef.FIELD(12013660);
      xFldRef := xRecRef.FIELD(12013660);
      IF FldRef.VALUE <> xFldRef.VALUE THEN
        EXIT(TRUE);
    END;

    PROCEDURE ClearFields@1100285008();
    BEGIN
      "Outstanding Qty. (Base)" := 0;
      "Outstanding Quantity" := 0;
      "Quantity Received" := 0;
      "Qty. Received (Base)" := 0;
      "Quantity Invoiced" := 0;
      "Qty. Invoiced (Base)" := 0;
      "Return Qty. Shipped" := 0;
      "Return Qty. Shipped (Base)" := 0;
      "Qty. Rcd. Not Invoiced" := 0;
    END;

    PROCEDURE RecreateImportLine@1100285020(VAR pvarrecExfDocLine@1100285000 : Record 12013588);
    VAR
      ItemUOM@1100285001 : Record 5404;
      UOM@1100285002 : Record 204;
      TempUnitCost@1100285003 : Decimal;
    BEGIN
      IF pvarrecExfDocLine."Description (Import)" <> '' THEN BEGIN
        pvarrecExfDocLine.Description := COPYSTR(pvarrecExfDocLine."Description (Import)",1,MAXSTRLEN(pvarrecExfDocLine.Description));
        pvarrecExfDocLine."Description 2" := COPYSTR(pvarrecExfDocLine."Description (Import)",
                                                      MAXSTRLEN(pvarrecExfDocLine.Description)+1,
                                                      MAXSTRLEN(pvarrecExfDocLine."Description 2"));
      END;

      IF pvarrecExfDocLine."Quantity (Matching)" <> 0 THEN
        pvarrecExfDocLine.VALIDATE(Quantity,pvarrecExfDocLine."Quantity (Matching)");

      IF pvarrecExfDocLine.Quantity = 0 THEN
        pvarrecExfDocLine.VALIDATE(Quantity, 1);

      IF pvarrecExfDocLine."Unit of Measure (Import)" <> '' THEN BEGIN
        CASE pvarrecExfDocLine.Type OF
          pvarrecExfDocLine.Type::Item:
            IF ItemUOM.GET(pvarrecExfDocLine."No.",pvarrecExfDocLine."Unit of Measure (Import)") THEN
              pvarrecExfDocLine.VALIDATE("Unit of Measure Code", pvarrecExfDocLine."Unit of Measure (Import)");
          ELSE
            IF UOM.GET(pvarrecExfDocLine."Unit of Measure (Import)") THEN
              pvarrecExfDocLine.VALIDATE("Unit of Measure Code", pvarrecExfDocLine."Unit of Measure (Import)");
        END;
      END;

      IF pvarrecExfDocLine."Line Discount % (Import)" <> 0 THEN
        pvarrecExfDocLine."Line Discount %" := pvarrecExfDocLine."Line Discount % (Import)";

      IF pvarrecExfDocLine."Direct Unit Cost (Matching)" <> 0 THEN
        pvarrecExfDocLine.VALIDATE("Direct Unit Cost",pvarrecExfDocLine."Direct Unit Cost (Matching)");

      IF pvarrecExfDocLine."Line Amount (Import)" <> 0 THEN BEGIN
        // Handles when one import line was split and matched against multiple receipt lines

        IF pvarrecExfDocLine."Quantity (Import)" <> 0 THEN
          TempUnitCost := pvarrecExfDocLine."Line Amount (Import)" / pvarrecExfDocLine."Quantity (Import)"
        ELSE
          TempUnitCost := pvarrecExfDocLine."Line Amount (Import)";

        pvarrecExfDocLine.VALIDATE("Direct Unit Cost", TempUnitCost);
      END;
    END;

    PROCEDURE SetForceUpdateOrderLineNo@1100285009();
    BEGIN
      ForceUpdateOrderLineNo := TRUE;
    END;

    LOCAL PROCEDURE UpdateDimensionsFromJobTask@60();
    VAR
      DimSetArrID@1000 : ARRAY [10] OF Integer;
      DimValue1@1001 : Code[20];
      DimValue2@1002 : Code[20];
    BEGIN
      DimSetArrID[1] := "Dimension Set ID";
      DimSetArrID[2] := DimMgt.CreateDimSetFromJobTaskDim("Job No.","Job Task No.",DimValue1,DimValue2);
      "Dimension Set ID" := DimMgt.GetCombinedDimensionSetID(DimSetArrID,DimValue1,DimValue2);
      "Shortcut Dimension 1 Code" := DimValue1;
      "Shortcut Dimension 2 Code" := DimValue2;
    END;

    PROCEDURE "*** 4PS ***"@8();
    BEGIN
    END;

    PROCEDURE CheckCostTypeOrder@1100485008();
    VAR
      lvPurchLineRec@1100485000 : Record 39;
      lvPurchLineRec2@1100485001 : Record 39;
      lvText000@1100485002 : TextConst 'ENU=Only 1 Cost Type per Order allowed according to %1.;SVE=Endast en kostnadstyp per order till†ts enligt %1.';
    BEGIN
      { **
      //**4PS
      IF "Document Type" <> "Document Type"::Order THEN EXIT;
      IF "Cost Type" = "Cost Type"::" " THEN EXIT;
      PurchSetup.GET;
      IF NOT PurchSetup."Create Order by Cost Type" THEN EXIT;
      GetPurchHeader;
      //IF PurchHeader."Borrow from" THEN EXIT;
      IF PurchHeader."Hours Hire Order Type" <> PurchHeader."Hours Hire Order Type"::" " THEN EXIT;

      lvPurchLineRec.SETRANGE("Document Type", "Document Type");
      lvPurchLineRec.SETRANGE("Document No.", "Document No.");
      lvPurchLineRec.SETFILTER("Line No.", '<>%1', "Line No.");
      lvPurchLineRec.SETFILTER("Cost Type", '<>%1', "Cost Type"::" ");
      IF lvPurchLineRec.FINDFIRST THEN BEGIN
        lvPurchLineRec2.COPY(lvPurchLineRec);
        lvPurchLineRec2.SETFILTER("Cost Type", '%1..%2|%3..%4',
          "Cost Type"::Labor, lvPurchLineRec."Cost Type" - 1,
          lvPurchLineRec."Cost Type" + 1, "Cost Type"::Sundry);
        IF lvPurchLineRec2.FINDFIRST THEN BEGIN
          IF lvPurchLineRec2."Cost Type" <> lvPurchLineRec."Cost Type" THEN
            ERROR(lvText000, PurchSetup.TABLECAPTION);
        END ELSE BEGIN
          IF "Cost Type" <> lvPurchLineRec."Cost Type" THEN
            ERROR(lvText000, PurchSetup.TABLECAPTION);
        END;
      END;
      ** }
    END;

    PROCEDURE CheckCompanyIC@6510();
    VAR
      lvCompName@1210190000 : Text[50];
    BEGIN
      //**4PS
      //IF "Receiving Company" <> '' THEN
      //  lvCompName := "Receiving Company"
      //ELSE
        lvCompName := COMPANYNAME;
      { *
      GLAcc.CHANGECOMPANY(lvCompName);
      ProjRec.CHANGECOMPANY(lvCompName);
      DimVal1Rec.CHANGECOMPANY(lvCompName);
      DimVal2Rec.CHANGECOMPANY(lvCompName);
      ICProjSetupRec.CHANGECOMPANY(lvCompName);
      ProjTypeRec.CHANGECOMPANY(lvCompName);
      ProjElemRec.CHANGECOMPANY(lvCompName);
      ExtensionContract.CHANGECOMPANY(lvCompName);
      PlantSetup.CHANGECOMPANY(lvCompName);
      PlantTypeRec.CHANGECOMPANY(lvCompName);
      PlantNoRec.CHANGECOMPANY(lvCompName);
      CostCompPlantRec.CHANGECOMPANY(lvCompName);
      PlantPostingSetup.CHANGECOMPANY(lvCompName);
      PlantVendorRec.CHANGECOMPANY(lvCompName);
      ServTypeRec.CHANGECOMPANY(lvCompName);
      ServOrderRec.CHANGECOMPANY(lvCompName);
      * }
      ICProjSetupRec.GET;
    END;

    PROCEDURE OnLookupElement@1100525008(iEditable@1100525000 : Boolean);
    BEGIN
      //**4PS
      CheckCompanyIC;
      ProjElemRec."Project No." := "Job No.";
      ProjElemRec.Element := Element;
      ProjElemRec.SETRANGE("Project No.", "Job No.");
      IF NOT iEditable THEN
        PAGE.RUNMODAL(0, ProjElemRec)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, ProjElemRec) = ACTION::LookupOK THEN
          VALIDATE(Element, ProjElemRec.Element);
      END;
    END;

    PROCEDURE OnLookupExtensionContract@1100525007(iEditable@1100525000 : Boolean);
    BEGIN
      //**4PS
      CheckCompanyIC;
      ExtensionContract."Project No." := "Job No.";
      ExtensionContract."Contract No." := "Extension Contract";
      ExtensionContract.SETRANGE("Project No.", "Job No.");
      IF NOT iEditable THEN
        PAGE.RUNMODAL(0, ExtensionContract)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, ExtensionContract) = ACTION::LookupOK THEN
          VALIDATE("Extension Contract", ExtensionContract."Contract No.");
      END;
    END;

    PROCEDURE CheckPlantAcquisitionOrRent@1100485001(IPurchLineRec@1100485000 : Record 39) : Integer;
    BEGIN
      //**4PS
      WITH IPurchLineRec DO BEGIN
        IF ("Plant Type" <> '') AND ("Cost Component Plant" <> '') THEN BEGIN
          CheckCompanyIC;
          PlantSetup.GET;
          IF ("Cost Component Plant" = PlantSetup."Cost Component Acquisition") THEN
            EXIT(1);  //* Acquisition
          IF ("Cost Component Plant" = PlantSetup."Cost Component Rent") THEN
            EXIT(2);  //* Rent
        END;

        EXIT(0);
      END;
    END;

    PROCEDURE CheckCostTypeCondition@1100525029();
    BEGIN
      { **
      //db, 11-02-11: M25031
      //lvOrigField := CurrFieldNo; //call 26946
      //CurrFieldNo := FIELDNO("Cost Type");  //force check additional cost (service) //call 26946
      HideDialog := TRUE;  //skip question on validate Cost Type
      IF (xRec."Document No." = '') THEN BEGIN
        //toolsbug: xRec not set on lookup
        //xRec."Service Order No." := "Service Order No.";
        xRec."Cost Type" := "Cost Type";
      END;
      IF ("Item No." <> '') OR ("Basic Item" <> '') OR ("Trade Item" <> '') THEN //call 26684
        VALIDATE("Cost Type", "Cost Type"::Material);
      HideDialog := FALSE;
      // CurrFieldNo := lvOrigField; //call 26946
      ** }
    END;

    PROCEDURE ValidateVendor@6506();
    VAR
      lvVendorRec@1210190000 : Record 23;
      lvTradeItemRec@1100485000 : Record 11012317;
      OrigTradeItemRec@1210190001 : Record 11012317;
      RecFound@1100485001 : Boolean;
    BEGIN
      //**4PS
      IF ("Basic Item" = '') AND ("Trade Item" = '') THEN EXIT;
      IF ("Vendor (Trade Item)" <> '') AND (CurrFieldNo <> FIELDNO("Item No.") ) THEN EXIT;

      lvVendorRec.GET(PurchHeader."Buy-from Vendor No.");
      IF lvVendorRec."Vendor (Trade Item)" = '' THEN EXIT;
      IF lvVendorRec."Vendor (Trade Item)" = "Vendor (Trade Item)" THEN EXIT;

      IF ("Basic Item" <> '') AND ("Trade Item" = '') THEN BEGIN
        xRec."Vendor (Trade Item)" := '';
        VALIDATE("Vendor (Trade Item)", lvVendorRec."Vendor (Trade Item)");
        IF "Trade Item" = '' THEN BEGIN
          "Vendor (Trade Item)" := '';
        END;
      END ELSE BEGIN
        IF ("Vendor (Trade Item)" <> '') AND ("Trade Item" <> '') THEN BEGIN
          //db.sn, 07-06-11: M23000
          IF OrigTradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
            "Trade Item" := '';
            "Vendor (Trade Item)" := '';
            RecFound := FALSE;

            lvTradeItemRec.SETRANGE(Vendor, lvVendorRec."Vendor (Trade Item)");
            lvTradeItemRec.SETRANGE(Expired, FALSE);
            IF OrigTradeItemRec."GTIN Code (Item)" <> '' THEN BEGIN
              lvTradeItemRec.SETCURRENTKEY("GTIN Code (Item)");
              lvTradeItemRec.SETRANGE("GTIN Code (Item)", OrigTradeItemRec."GTIN Code (Item)");
              IF lvTradeItemRec.FINDFIRST THEN
                RecFound := TRUE;
            END;
            IF NOT RecFound THEN BEGIN
              IF (OrigTradeItemRec."Product Code" <> '') AND (OrigTradeItemRec.Manufacturer <> '') THEN BEGIN
                lvTradeItemRec.SETCURRENTKEY("Product Code", Manufacturer);
                lvTradeItemRec.SETRANGE("GTIN Code (Item)");
                lvTradeItemRec.SETRANGE("Product Code", OrigTradeItemRec."Product Code");
                lvTradeItemRec.SETRANGE(Manufacturer,  OrigTradeItemRec.Manufacturer);
                IF lvTradeItemRec.FINDFIRST THEN
                  RecFound := TRUE;
              END;
            END;
            IF RecFound THEN BEGIN
              xRec."Vendor (Trade Item)" := '';
              xRec."Trade Item" := '';
              "Trade Item" := '';
              VALIDATE("Vendor (Trade Item)", lvVendorRec."Vendor (Trade Item)");
              VALIDATE("Trade Item", lvTradeItemRec."Item Code");
            END;
          END;
          //db.en, 07-06-11: M23000
        END;
      END;
    END;

    PROCEDURE ValidateItem@1210190029(LTypeArtOpt@1210190001 : 'Item,Basic Item,Trade Item');
    VAR
      DummyDat@1210190002 : Date;
      DummyCode@1210190004 : Code[20];
      DummyTxt@1210190005 : Text[50];
      SaveBasicItem@1210190025 : Code[20];
      SaveTradeItem@1210190006 : Code[20];
      SaveManufacturer@1210190008 : Code[20];
      SaveVendor@1210190009 : Code[20];
      SaveUnit@1210190012 : Code[10];
      SaveDesc@1210190007 : Text[50];
      SaveDesc2@1210190010 : Text[50];
      SaveCostObject@1210190011 : Code[20];
      SaveCostComp@1210190015 : Code[20];
      BasicItemRec@1210190013 : Record 11012316;
      TradeItemRec@1210190014 : Record 11012317;
      lvPurchUnit@1210190016 : Code[20];
      lvFactor@1210190017 : Decimal;
      SaveFactor@1100485000 : Decimal;
      SaveQuan@1100485001 : Decimal;
      lvText000@1100485002 : TextConst 'ENU=Trade Item %1 is expired: Vendor %2 suggested %3 as alternative Item.;SVE=Anskaffningsartikeln %1 har f”rfallit: Leverant”r %2 f”reslog %3 som alternativ artikel.';
      lvRefDate@1100485003 : Date;
      lvDiscRef1@1100485004 : Code[20];
      lvDiscRef2@1100485005 : Code[20];
      WMSManagement@1210190000 : Codeunit 7302;
      SwitchTradeItem@1210190003 : Boolean;
      LTypeArtOpt2@1100409000 : 'Item,Basic Item,Trade Item';
    BEGIN
      //**4PS
      //GetPurchHeader;
      { **
      "Buy-from Vendor No." := PurchHeader."Buy-from Vendor No.";
      "Pay-to Vendor No." := PurchHeader."Pay-to Vendor No.";
      "Currency Code" := PurchHeader."Currency Code";

      SaveUnit := "Unit of Measure Code";
      SaveFactor := "Qty. per Unit of Measure";
      SaveQuan := Quantity;
      ** }
      //db.sn, 27-06-11: M27297
      IF LTypeArtOpt = LTypeArtOpt::"Trade Item" THEN BEGIN
        { **
        IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") OR
           ("Trade Item" <> xRec."Trade Item") THEN BEGIN
          IF TradeItemRec.GET(xRec."Vendor (Trade Item)", xRec."Trade Item") THEN BEGIN
            IF "Unit of Measure Code" = TradeItemRec."Packaging Unit" THEN BEGIN
              Quantity := Quantity * TradeItemRec."Qty. per Unit of Measure";
              "Unit of Measure Code" := TradeItemRec."Application Unit";
              "Qty. per Unit of Measure" := 1;
              xRec."Qty. per Unit of Measure" := 1;
              SaveUnit := "Unit of Measure Code";
              SaveFactor := "Qty. per Unit of Measure";
              SaveQuan := Quantity;
            END;
          END;
        END;
        ** }
      END ELSE BEGIN
        ValidateCu.SetVendor(PurchHeader."Buy-from Vendor No.");  //db, 25-03-13: 32565
      END;
      //db.en, 27-06-11: M27297

      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
      ValidateCu.SetLanguageCode(PurchHeader."Language Code");  //db, 20-12-11: M29573

      //GetDim2(Dim2Value);
      ValidateCu.ValidateItem(LTypeArtOpt,"Trade Item","Item No.",Manufacturer,"Vendor (Trade Item)",
        "Basic Item","Shortcut Dimension 2 Code",Description,"Unit of Measure Code","Direct Unit Cost",
        "Line Discount %",DummyDat,"Direct Unit Cost",Description,"Cost Component",
        lvDiscRef1,lvDiscRef2,lvRefDate,'');
      //CheckCostCompServOrderType;

      IF "Item No." = '' THEN BEGIN
        Type := Type::"G/L Account";
        IF Type <> xRec.Type THEN
          "No." := '';
      END;

      //IF ("Job No." = '') AND ("Service Order No." = '') AND ("Item No." <> '') AND ("Item No." <> "No.") THEN BEGIN
      IF ("Job No." = '') AND ("Item No." <> '') AND ("Item No." <> "No.") THEN BEGIN
        InvtSetup.GET;  //db, 11-08-11: M22691
        SaveBasicItem := "Basic Item";
        SaveManufacturer := Manufacturer;
        SaveTradeItem := "Trade Item";
        SaveVendor := "Vendor (Trade Item)";
        //db.sn, 20-12-11: M31760
        SaveDesc := Description;
        //SaveDesc2 := "Description 2";
        SaveCostObject := "Shortcut Dimension 2 Code";
        SaveCostComp := "Cost Component";
        //db.en, 20-12-11: M31760
        Type := Type::Item;
        //SkipExpired := TRUE;  //db, 08-12-10: M18694
        VALIDATE("No.", "Item No.");  //beware of recursion between validate triggers
        //If trade-item selected with basic-item and variant of trade-item with same basic-item is
        //copied as inventory-item: do not reset chosen trade-item by validate of item
        //SkipExpired := FALSE;  //db, 08-12-10: M18694
        IF ("Vendor (Trade Item)" + "Trade Item") <> (SaveVendor + SaveTradeItem) THEN
          SwitchTradeItem := TRUE;  //db, 11-08-11: M22691
        "Basic Item" := SaveBasicItem;
        Manufacturer := SaveManufacturer;
        "Trade Item" := SaveTradeItem;
        "Vendor (Trade Item)" := SaveVendor;
        //db.sn, 20-12-11: M31760
        IF InvtSetup."Item Info Trade Item Leading" THEN BEGIN
          Description := SaveDesc;
          //"Description 2" := SaveDesc2;
          //"Shortcut Dimension 2 Code" := SaveCostObject;
          ValidateShortcutDimCode(2,SaveCostObject);
          "Cost Component" := SaveCostComp;
        END;
        //db.en, 20-12-11: M31760
        SaveUnit := "Unit of Measure";
        //SaveFactor := "Qty. per Unit of Measure";
        SaveQuan := Quantity;
        IF SwitchTradeItem AND InvtSetup."Price Info Trade Item Leading" THEN BEGIN  //db, 11-08-11: M22691
          //ValidateCu.ValidateItem(LTypeArtOpt,"Trade Item",DummyCode,Manufacturer,"Vendor (Trade Item)",
          //  "Basic Item",DummyCode,DummyTxt,"Unit of Measure Code","Direct Unit Cost",
          //  "Discount % (Item)",DummyDat,"Unit Price (LCY)",DummyTxt,DummyCode,
          //  lvDiscRef1,lvDiscRef2,lvRefDate,'');  //db, 20-12-11: M31760 (use DummyTxt for Description)
          //C002758.sn
          IF ("Trade Item" + "Basic Item" <> '') THEN BEGIN
            LTypeArtOpt2 := LTypeArtOpt;  //db, 14-12-12: 32565
            IF ("Basic Item" <> '') AND (LTypeArtOpt = LTypeArtOpt::Item) THEN
              LTypeArtOpt2 := LTypeArtOpt::"Basic Item";
            IF ("Trade Item" <> '') AND (LTypeArtOpt = LTypeArtOpt::Item) THEN
              LTypeArtOpt2 := LTypeArtOpt::"Trade Item";
            ValidateCu.ValidateItem(LTypeArtOpt2,"Trade Item",DummyCode,Manufacturer,"Vendor (Trade Item)",
              "Basic Item",DummyCode,DummyTxt,"Unit of Measure Code","Direct Unit Cost",
              "Line Discount %",DummyDat,"Direct Unit Cost",DummyTxt,DummyCode,
              lvDiscRef1,lvDiscRef2,lvRefDate,'');  //db, 20-12-11: M31760 (use DummyTxt for Description)
          END;
          //C002758.en
        END;
        //db.sn, 29-06-11: M26303
        //IF ("Trade Item" <> '') AND (NOT InvtSetup."Price Info Trade Item Leading") THEN
        //  xRec."Qty. per Unit of Measure" := "Qty. per Unit of Measure";
        //db.en, 29-06-11: M26303
      END;

      //db.sn, 10-06-09: M14553
      //IF ("Item No." <> '') AND ("Basic Item" + "Trade Item" = '') THEN
      //  UpdateDirectUnitCost(CurrFieldNo);
      //db.en, 10-06-09: M14553

      //UpdateUnitCost;
      "Cost Type" := "Cost Type"::Material;
      VALIDATE("Shortcut Dimension 2 Code");

      IF LTypeArtOpt <> LTypeArtOpt::Item THEN BEGIN
        IF PurchHeader."Currency Factor" <> 0 THEN
          "Direct Unit Cost" := "Direct Unit Cost" * PurchHeader."Currency Factor";
      END;

      lvPurchUnit := "Unit of Measure";
      IF "Trade Item" <> '' THEN BEGIN
        IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN TradeItemRec.INIT;
        IF TradeItemRec.Expired THEN BEGIN  //db, 15-04-08: M10268
          IF TradeItemRec."Item Code (Successor)" = '' THEN BEGIN
            //IF SkipExpired = FALSE THEN  //db, 08-12-10: M18694
              TradeItemRec.TESTFIELD(Expired,FALSE);
          END ELSE BEGIN
            TradeItemRec.CALCFIELDS("Vendor Name");
            //IF SkipExpired = FALSE THEN  //db, 08-12-10: M18694
              ERROR(lvText000, "Trade Item", TradeItemRec."Vendor Name", TradeItemRec."Item Code (Successor)");
          END;
        END;
        IF TradeItemRec."Packaging Unit" <> '' THEN BEGIN
          lvPurchUnit := TradeItemRec."Packaging Unit";
          lvFactor := TradeItemRec."Qty. per Unit of Measure";
        END;
        //"Tariff No." := TradeItemRec."CBS Code";
        //"Net Weight":= TradeItemRec.GetNetWeight("Unit of Measure Code");
      END ELSE BEGIN
        IF "Basic Item" <> '' THEN BEGIN
          IF NOT BasicItemRec.GET(Manufacturer, "Basic Item") THEN BasicItemRec.INIT;
          BasicItemRec.TESTFIELD(Expired,FALSE);
          IF BasicItemRec."Packaging Unit" <> '' THEN BEGIN
            lvPurchUnit := BasicItemRec."Packaging Unit";
            lvFactor := BasicItemRec."Qty. per Unit of Measure";
          END;
          //IF ItemRec.GET("Item No.") THEN             //CALL C008507 new
          //  "Tariff No." := ItemRec."Tariff No.";     //CALL C008507 new
        END ELSE BEGIN
          IF "Item No." <> '' THEN BEGIN
            IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
            IF ItemRec."Purch. Unit of Measure" <> lvPurchUnit THEN BEGIN
              lvPurchUnit := ItemRec."Purch. Unit of Measure";
              lvFactor := UOMMgt.GetQtyPerUnitOfMeasure(ItemRec,lvPurchUnit);
            END;
          END;
          //"Tariff No." := ItemRec."Tariff No.";
        END;
      END;
      { **
      IF ItemRec.GET("Item No.") THEN BEGIN
        CheckIfItemIsBlocked(ItemRec);
        //VALIDATE(Text, ItemRec.Text);
        ValidateShelf;
        GetHeader(EXDoc); // Exflow
        ItemVend.INIT;
        ItemVend."Vendor No." := EXDoc."Vendor No."; //"Buy-from Vendor No.";
        //ItemVend."Variant Code" := "Variant Code";
        //ItemRec.FindItemVend(ItemVend,"Location Code");  //db, 19-02-09: Item->ItemRec
        ItemRec.FindItemVend(ItemVend,'');  //db, 19-02-09: Item->ItemRec
        IF ItemVend."Vendor Item No." <> '' THEN
          "Vendor Item No." := ItemVend."Vendor Item No."
        ELSE
          IF ("Buy-from Vendor No." = ItemRec."Vendor No.") THEN //kzwerver, 120619, n, #W007424
            "Vendor Item No." := ItemRec."Vendor Item No.";
      END;

      IF "Trade Item" <> '' THEN
        "Vendor Item No." := "Trade Item";  //db, 06-05-09: M15266
      ** }

      { **
      IF lvFactor = 0 THEN lvFactor := 1;
      IF SaveFactor = 0 THEN SaveFactor := 1;
      IF (lvPurchUnit = SaveUnit) AND (SaveFactor <> lvFactor) THEN BEGIN
        Quantity := ROUND(SaveQuan * SaveFactor / lvFactor, 1, '>');
        "Qty. per Unit of Measure" := ("Qty. per Unit of Measure" / SaveFactor) * lvFactor;
      END ELSE BEGIN
        IF lvPurchUnit <> SaveUnit THEN BEGIN
          Quantity := ROUND(SaveQuan * SaveFactor / lvFactor, 1, '>');
          "Qty. per Unit of Measure" := "Qty. per Unit of Measure" / SaveFactor;
        END;
        IF lvPurchUnit <> "Unit of Measure" THEN BEGIN
          IF lvPurchUnit = SaveUnit THEN
            Quantity := Quantity / SaveFactor
          ELSE
            "Qty. per Unit of Measure" := "Qty. per Unit of Measure" * lvFactor;
        END;
      END;

      IF ("Qty. per Unit of Measure" <> xRec."Qty. per Unit of Measure") THEN BEGIN  //db, 08-04-10: M18570
        xRec."Qty. per Unit of Measure" := "Qty. per Unit of Measure";
        "Direct Unit Cost" := "Direct Unit Cost" * "Qty. per Unit of Measure";
        "Unit Cost (LCY)" := "Unit Cost (LCY)" * "Qty. per Unit of Measure";
        "Unit Price (LCY)" := "Unit Price (LCY)" * "Qty. per Unit of Measure";
      END;
      ** }

      //VALIDATE("Unit of Measure Code", lvPurchUnit);
      VALIDATE("Unit of Measure", lvPurchUnit);
      VALIDATE("Line Discount %");  //db, 31-05-07: M9531

      //IF NOT CreateFromReqLine THEN  //db, 19-10-12: C000939
      //  CheckDeliveryTime(FIELDNO("Item No."));

      { **
      //db.sn, 10-05-11: M26790
      IF ("Location Code" <> '') AND ("Item No." = '') THEN BEGIN
        GetLocation("Location Code");
        IF Location."Bin Mandatory" AND NOT Location."Directed Put-away and Pick" THEN
          "Bin Code" := WMSManagement.GetDefaultBinLocation(
            "Job No.","Service Order No.","Location Code","Item No.","Variant Code",TRUE);
      END;
      //db.en, 10-05-11: M26790
      ** }
    END;

    PROCEDURE GetReferenceData@1100485022(VAR lvRefDate@1100485000 : Date;VAR lvDiscRef1@1100485001 : Code[20];VAR lvDiscRef2@1100485002 : Code[20]);
    BEGIN
      //**4PS
      //IF "Service Order No." <>'' THEN BEGIN
      IF FALSE THEN BEGIN
        //ServOrderRec.CHANGECOMPANY("Receiving Company");
        //ServOrderRec.GET("Service Order No.");
        //lvRefDate := ValidateCu.GetRefDateServOrder(ServOrderRec);
      //  lvDiscRef1 := ServOrderRec."Purch Discount Term Group 1";
      //  lvDiscRef2 := ServOrderRec."Purch Discount Term Group 2";
      END ELSE BEGIN
        IF "Job No." <>'' THEN BEGIN
          //ProjRec.CHANGECOMPANY("Receiving Company");
          ProjRec.GET("Job No.");
          lvRefDate := ValidateCu.GetRefDateProject(ProjRec);
          lvDiscRef1 := ProjRec."Purch Discount Term Group 1";
          lvDiscRef2 := ProjRec."Purch Discount Term Group 2";
        END;
      END;
    END;

    LOCAL PROCEDURE CheckIfItemIsBlocked@1100528303(Item@1100528300 : Record 27);
    BEGIN
      //**4PS.n
      IF "Document Type" IN ["Document Type"::Quote, "Document Type"::Order, "Document Type"::"Blanket Order"] THEN
        Item.TESTFIELD("Purchase Blocked OLD",FALSE);

      Item.TESTFIELD(Blocked,FALSE);
    END;

    PROCEDURE CheckVendorRelation@1210190014();
    VAR
      VendorRelationRec@1210190000 : Record 11012313;
      VendorRec@1210190001 : Record 23;
      VendorRec2@1100525000 : Record 23;
    BEGIN
      { **
      //**4PS
      VendorRelationRec.RESET;
      IF VendorRelationRec.GET("Vendor (Trade Item)") THEN BEGIN
        PurchHeader.GET("Document Type", "Document No.");
        //kkleermaker.sn, 110719, M27966
        IF PurchHeader."Document Type" = PurchHeader."Document Type"::Invoice THEN
          EXIT; // For invoices this check is not relevant.
        //kkleermaker.en, 110719, M27966
        IF VendorRelationRec."Vendor (Purchase)" <> PurchHeader."Buy-from Vendor No." THEN BEGIN
          PurchHeader.TESTFIELD("Buy-from Vendor No.");  //db, 13-01-11
          VendorRec.GET(PurchHeader."Buy-from Vendor No.");
          IF VendorRec."Main Vendor" = '' THEN
            VendorRec."Main Vendor" := VendorRec."No.";
          IF VendorRec."Main Vendor" <> VendorRelationRec."Vendor (Purchase)" THEN BEGIN
            //db.sn, 25-11-10: M18286
            VendorRec2.GET(VendorRelationRec."Vendor (Purchase)");
            IF VendorRec2."Main Vendor" = '' THEN
              VendorRec2."Main Vendor" := VendorRec2."No.";
            IF VendorRec."Main Vendor" <> VendorRec2."Main Vendor" THEN BEGIN
            //db.en, 25-11-10: M18286
              IF "Trade Item" <> '' THEN
                MESSAGE(Text11012001,FIELDCAPTION("Trade Item"),"Trade Item",PurchHeader."Buy-from Vendor Name")
              ELSE
                IF "Basic Item" <> '' THEN
                  MESSAGE(Text11012001,FIELDCAPTION("Basic Item"),"Basic Item",PurchHeader."Buy-from Vendor Name")
                ELSE
                  IF "Item No." <> '' THEN
                    MESSAGE(Text11012001,FIELDCAPTION("Item No."),"Item No.",PurchHeader."Buy-from Vendor Name");
            END;
          END;
        END;
      END;
      ** }
    END;

    PROCEDURE NSItemExists@1100528601(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      Item2@1001 : Record 27;
    BEGIN
      //**4PS DP00121
      IF Type = Type::"G/L Account" THEN
        IF Item2.GET(ItemNo) THEN
          EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE CheckRelatedVendor@1100485005();
    VAR
      VendorRelationRec@1100485000 : Record 11012313;
      TradeItemRec@1100485001 : Record 11012317;
      InventorySetup@1210190000 : Record 313;
    BEGIN
      { **
      //**4PS
      GetPurchHeader;
      InventorySetup.GET; //mg, 11-10-11: M29687
      VendorRelationRec.SETCURRENTKEY("Vendor (Purchase)");
      VendorRelationRec.SETRANGE("Vendor (Purchase)", PurchHeader."Buy-from Vendor No.");
      IF InventorySetup."Vendor Filter" = InventorySetup."Vendor Filter"::Hard THEN
        VendorRelationRec.SETRANGE("Display Trade Items", TRUE); //mg, 11-10-11: M29687
      IF VendorRelationRec.FIND('-') THEN BEGIN
        REPEAT
         IF TradeItemRec.GET(VendorRelationRec.Code, "Trade Item") THEN BEGIN  //db, 26-02-09
           "Vendor (Trade Item)" := VendorRelationRec.Code;
           EXIT;
         END;
        UNTIL VendorRelationRec.NEXT = 0;
      END;
      ** }
    END;

    PROCEDURE ValidateCostComponent@1100525020();
    VAR
      CostCompRec@1100525000 : Record 11012012;
      CostCompRec2@1100525001 : Record 11012012;
    BEGIN
      //**4PS
      IF CurrFieldNo <> FIELDNO("Cost Component") THEN EXIT;  //db, 18-03-10: T4642

      IF CostCompRec.GET("Cost Component") THEN BEGIN
        //db.sn, 06-12-10: M24263
        IF CostCompRec."Additional Cost (Service)" THEN BEGIN
          CostCompRec2.SETRANGE("Cost Component (Add.Cost)", "Cost Component");
          IF NOT CostCompRec2.FINDFIRST THEN EXIT;
        END ELSE BEGIN
          IF CostCompRec."Cost Component (Add.Cost)" = '' THEN EXIT;
        END;
        //db.en, 06-12-10: M24263
        //"Additional Cost (Service)" := CostCompRec."Additional Cost (Service)";
      END;
    END;

    PROCEDURE DeterminePlantVendorType@1100485025(IFillVendorPlantNo@1100485001 : Boolean);
    VAR
      lvInversePlantVendorType@1100485002 : Option;
      lvTypeNo@1100485000 : Integer;
    BEGIN
      { **
      //**4PS
      PurchLine2.GET("Document Type","Document No.","Line No."); // Exflow
      //lvTypeNo := CheckPlantAcquisitionOrRent(Rec);
      lvTypeNo := CheckPlantAcquisitionOrRent(PurchLine2);
      PlantVendorType := PlantVendorRec.Type::Purchase;
      CASE lvTypeNo OF
        0:
          IF ("Cost Component Plant" = '') AND ("Plant Type" <> '') THEN BEGIN
            PlantTypeRec.GET("Plant Type");
            IF ("Plant No." <> '') THEN
              PlantNoRec.GET("Plant Type", "Plant No.");
            IF (("Plant No." <> '') AND PlantNoRec.External) OR (("Plant No." = '') AND PlantTypeRec.External) THEN
              PlantVendorType := PlantVendorRec.Type::Rent;
          END;
        2:
          PlantVendorType := PlantVendorRec.Type::Rent;
      END;

      IF (NOT IFillVendorPlantNo) OR ("Plant Type" = '') THEN
        EXIT;

      IF PlantVendorType = PlantVendorRec.Type::Purchase THEN
        lvInversePlantVendorType := PlantVendorRec.Type::Rent
      ELSE
        lvInversePlantVendorType := PlantVendorRec.Type::Purchase;

      GetHeader(EXDoc);
      //IF PlantVendorRec.GET("Plant Type", "Buy-from Vendor No.", PlantVendorType) THEN
      IF PlantVendorRec.GET("Plant Type",EXDoc."Vendor No.", PlantVendorType) THEN
        "Vendor Plant No." := PlantVendorRec."Vendor Plant No."
      ELSE
        //IF PlantVendorRec.GET("Plant Type", "Buy-from Vendor No.", lvInversePlantVendorType) THEN
        IF PlantVendorRec.GET("Plant Type",EXDoc."Vendor No.", lvInversePlantVendorType) THEN
          "Vendor Plant No." := '';
      ** }
    END;

    PROCEDURE FillSystemCreatedEntry@1210190007();
    BEGIN
      //**4PS
      { **
      "System-Created Entry" :=
        ("Service Order No." <> '') OR
        ("Job No." <> '') OR
        ("Plant Type" <> '');
      ** }

      CASE CurrFieldNo OF
        //FIELDNO("Service Order No."):
        //  TESTFIELD("Plant Type",'');
        FIELDNO("Job No."):
          TESTFIELD("Plant Type",'');
        FIELDNO("Plant Type"):
          BEGIN
            TESTFIELD("Job No.",'');
            //TESTFIELD("Service Order No.",'');
          END;
      END;
    END;

    PROCEDURE DeletePurchOrderPlntRentalRate@1100485028();
    VAR
      lvPurchOrderRentalRateRec@1100485000 : Record 11020513;
    BEGIN
      { **
      //**4PS
      IF ("Document Type" <> "Document Type"::Order) THEN
        EXIT;

      IF (lvPurchOrderRentalRateRec.READPERMISSION) THEN BEGIN
        lvPurchOrderRentalRateRec.SETRANGE("Purchase Order No.", "Document No.");
        lvPurchOrderRentalRateRec.SETRANGE("Purch. Order Line No.", "Line No.");
        lvPurchOrderRentalRateRec.DELETEALL;
      END;
      ** }
    END;

    PROCEDURE GetTranslatedPlantDesc@1100485017(MaxLen@1100529000 : Integer) : Text[50];
    VAR
      lvPlantNoRec@1100485000 : Record 11012552;
      lvPlantTransRec@1100485001 : Record 11012542;
      lvVendRec@1100485002 : Record 23;
      lvPlantTypeRec@1100485003 : Record 11012551;
    BEGIN
      //**4PS
      //* Haal de vertaalde materieel omschrijving op met de volgende prioriteit:
      //* 1 Materieelnummer omschrijving in taal leverancier
      //* 2 Materieelsoort omschrijving in taal leverancier
      //* 3 Materieelnumer omschrijving van materieelnummerkaart
      { **
      IF "Receiving Company" <> '' THEN BEGIN
        lvPlantTypeRec.CHANGECOMPANY("Receiving Company");
        lvPlantNoRec.CHANGECOMPANY("Receiving Company");
        lvPlantTransRec.CHANGECOMPANY("Receiving Company");
      END;
      ** }
      IF ("Plant Type" <> '') AND ("Buy-from Vendor No." <> '') THEN BEGIN
        IF lvVendRec.GET("Buy-from Vendor No.") THEN BEGIN
          IF lvVendRec."Language Code" <> '' THEN BEGIN
            //IF lvPlantTransRec.GET("Plant Type","Plant No.",lvVendRec."Language Code") THEN BEGIN  //DP00241.o (27089)
            //  lvDescription := lvPlantTransRec.Translation;
            //DP00241.sn (27089)
            IF lvPlantTransRec.GET(lvPlantTransRec.Type::PlantType,"Plant Type","Plant No.",lvVendRec."Language Code") THEN BEGIN
              IF lvPlantTransRec.Translation <> '' THEN
                EXIT(COPYSTR(lvPlantTransRec.Translation, 1, MaxLen));
            END;
            //DP00241.en
            //IF lvPlantTransRec.GET("Plant Type",'',lvVendRec."Language Code") THEN BEGIN  //DP00241.o (27089)
            //  lvDescription := lvPlantTransRec.Translation;
            //DP00241.sn (27089)
            IF lvPlantTransRec.GET(lvPlantTransRec.Type::PlantNo,"Plant Type",'',lvVendRec."Language Code") THEN BEGIN
              IF lvPlantTransRec.Translation <> '' THEN
                EXIT(COPYSTR(lvPlantTransRec.Translation, 1, MaxLen));
            END;
            //DP00241.en
          END;
        END;
      END;
      IF "Plant No." <> '' THEN BEGIN
        IF lvPlantNoRec.GET("Plant Type", "Plant No.") THEN
          EXIT(lvPlantNoRec.Description);
      END;
      IF lvPlantTypeRec.GET("Plant Type") THEN
        EXIT(lvPlantTypeRec.Description);
      EXIT('');
    END;

    PROCEDURE FixedAssetPlantRelation@1210190010() : Boolean;
    VAR
      lvPlantSetup@1210190000 : Record 11012550;
      lvPlantTypeRec@1100485000 : Record 11012551;
      lvPlantNumberRec@1210190001 : Record 11012552;
      lvCreateFAOnReceipt@1100525000 : Boolean;
    BEGIN
      //**4PS
      //IF (("Plant Type" = '') OR ("Cost Component Plant" = '') OR ("Receiving Company" <> '')) OR
      IF (("Plant Type" = '') OR ("Cost Component Plant" = '')) OR
         (("Plant No." = '') AND
          (NOT ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote, "Document Type"::"Blanket Order"])))
      THEN
        EXIT(FALSE);

      lvPlantTypeRec.GET("Plant Type");
      IF (lvPlantTypeRec."Rental Type" <> lvPlantTypeRec."Rental Type"::Rental) OR
         (NOT lvPlantTypeRec."Integration Fixed Assets")
      THEN
        EXIT(FALSE);

      lvPlantSetup.GET;
      IF NOT lvPlantSetup."Integration Fixed Assets" THEN
        EXIT(FALSE);
      IF lvPlantSetup."Cost Component Acquisition" <> "Cost Component Plant" THEN
        EXIT(FALSE);

      IF ("Plant No." <> '') AND ("Document Type" = "Document Type"::Order) THEN BEGIN
        lvPlantNumberRec.GET("Plant Type", "Plant No.");
        IF (NOT lvPlantTypeRec.Bulk) AND
           (NOT lvPlantNumberRec.Posted) AND (NOT lvPlantNumberRec.External) AND
           (lvPlantNumberRec."Fixed Asset" = '') //AND (lvPlantNumberRec."Purchase Order No." = "Document No.")
        THEN
         lvCreateFAOnReceipt := TRUE;
      END;

      IF ("Plant No." = '') OR (lvCreateFAOnReceipt) THEN BEGIN
        VALIDATE(Type,Type::"Fixed Asset");
        VALIDATE("No.", '');
      END ELSE BEGIN
        lvPlantNumberRec.GET("Plant Type", "Plant No.");
        lvPlantNumberRec.TESTFIELD("Fixed Asset");
        VALIDATE(Type, Type::"Fixed Asset");
        VALIDATE("No.", lvPlantNumberRec."Fixed Asset");
      END;
      EXIT(TRUE);
    END;

    PROCEDURE ReleaseRetention@1100528501() : Boolean;
    VAR
      VendPostingGrp@1100528500 : Record 93;
    BEGIN
      //**4PS
      { **
      GetPurchHeader;
      IF ("Document Type" = "Document Type"::Quote) AND
         (PurchHeader."Vendor Posting Group" = '') AND
         (PurchHeader."Buy-from Vendor No." = '')
      THEN
        EXIT(FALSE);  //* If Quote for a relation
      PurchHeader.TESTFIELD("Vendor Posting Group");
      VendPostingGrp.GET(PurchHeader."Vendor Posting Group");

      EXIT(
        ("No." = VendPostingGrp."Retention Suspense Acc.") AND
        (VendPostingGrp."Retention Suspense Acc." <> ''));
      ** }
      EXIT(FALSE);
    END;

    PROCEDURE CheckProjectStatus@1100485002(Posting@1100485000 : Boolean);
    VAR
      lvBlockingCodeRec@1100485001 : Record 11012027;
    BEGIN
      //**4PS
      IF "Job No." = '' THEN
        EXIT;

      CheckCompanyIC;
      ProjRec.GET("Job No.");

      IF (("Document Type" = "Document Type"::Order) OR
          ("Document Type" = "Document Type"::Invoice)) AND
         (ProjRec."Blocking Code" <> '') AND
         ((ProjRec."Project Status" = ProjRec."Project Status"::"Technical Finished") OR
          (ProjRec."Project Status" = ProjRec."Project Status"::"Administrative Finished") OR
          ((ProjRec."Project Status" = ProjRec."Project Status"::Finished) AND ICProjSetupRec."Provisions at Closure")
         ) THEN
      BEGIN
        IF "Document Type" = "Document Type"::Order THEN
          IF NOT Posting THEN
            lvBlockingCodeRec.Switch := lvBlockingCodeRec.Switch::"Purchase Order"
          ELSE
            lvBlockingCodeRec.Switch := lvBlockingCodeRec.Switch::"Purchase Receipt";
        IF "Document Type" = "Document Type"::Invoice THEN
          lvBlockingCodeRec.Switch := lvBlockingCodeRec.Switch::"Purchase Invoice";
        lvBlockingCodeRec.CheckBlocked(ProjRec."Blocking Code", lvBlockingCodeRec.Switch, ProjRec, TRUE);
      END ELSE BEGIN
        IF ICProjSetupRec."Provisions at Closure" THEN
          ProjRec.CheckProjectStatus(-1)
        ELSE
          ProjRec.CheckProjectStatus(1);
      END;
      { **
      IF NOT ICProjSetupRec."Post in Estim. Status allowed" THEN //call C001038
        IF ("Employee No." = '') AND
           ((ProjRec."Project Status" < ProjRec."Project Status"::Preparation) AND ("Document Type" > "Document Type"::Quote)) OR
           ((ProjRec."Project Status" > ProjRec."Project Status"::Production) AND ("Document Type" < "Document Type"::Order))
        THEN
          ERROR(Text11012003,ProjRec.TABLECAPTION,"Job No.",ProjRec.FIELDCAPTION("Project Status"),ProjRec."Project Status");
      //Hours of external employees must be accepted even though status is Preparation
      ** }
    END;

    PROCEDURE CreateDim4PS@6(Type1@1000 : Integer;No1@1001 : Code[40];Type2@1002 : Integer;No2@1003 : Code[40];Type3@1004 : Integer;No3@1005 : Code[40];Type4@1006 : Integer;No4@1007 : Code[40];Type5@1100485001 : Integer;No5@1100485000 : Code[40];Type6@1100525001 : Integer;No6@1100525000 : Code[40];Type7@1100525003 : Integer;No7@1100525002 : Code[40]);
    VAR
      SourceCodeSetup@1008 : Record 242;
      TableID@1009 : ARRAY [10] OF Integer;
      No@1010 : ARRAY [10] OF Code[40];
      i@1210190000 : Integer;
    BEGIN
      SourceCodeSetup.GET;
      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;
      TableID[4] := Type4;
      No[4] := No4;

      //**4PS.sn
      TableID[5] := Type5;
      No[5] := No5;
      TableID[6] := Type6;
      No[6] := No6;
      TableID[7] := Type7;  //** 4PS 09-06-2010
      No[7] := No7;         //** 4PS 09-06-2010
      //TableID[8] := Type8;  //*C007227.o
      //No[8] := No8;         //*C007227.o

      //*33895.sn
      IF ("Plant Type" <> '') AND ("Item No." + "Basic Item" + "Trade Item" <> '') THEN BEGIN
        //IF CheckPlantAcquisitionOrRent(Rec) = 0 THEN BEGIN
          FOR i := 1 TO ARRAYLEN(TableID) DO BEGIN
            IF TableID[i] IN [DATABASE::"Plant Type", DATABASE::"Plant Number"] THEN BEGIN
              TableID[i] := 0;
              No[i] := '';
            END;
          END;
        //END;
      END;
      //*33895.en
      Dim1 := "Shortcut Dimension 1 Code";
      Dim2 := "Shortcut Dimension 2 Code";
      //DimMgt.SetCompany("Receiving Company"); //**4PS.n
      //**4PS.en

      { **
      //"Shortcut Dimension 1 Code" := ''; //**4PS.o Must be kept for Department Authorization
      "Shortcut Dimension 2 Code" := '';
      IF (CurrFieldNo = 0) OR ((Dim1 = '') AND (Dim2 = '')) THEN BEGIN //**4PS.n
        GetPurchHeader;
        "Dimension Set ID" :=
          DimMgt.GetDefaultDimID(
            TableID,No,SourceCodeSetup.Purchases,"Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",
            PurchHeader."Dimension Set ID",DATABASE::Vendor);
      END; //**4PS.n
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
      ** }
      //**4PS.sn
      IF (Dim1 <> '') AND ("Shortcut Dimension 1 Code" = '') THEN BEGIN
        "Shortcut Dimension 1 Code" := Dim1;
        ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
      END;

      IF (Dim2 <> '') AND
         (("Shortcut Dimension 2 Code" = '') OR
          (PurchHeader."Hours Hire Order Type" > 0) OR //call 23330
          (CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")))
      THEN BEGIN
        "Shortcut Dimension 2 Code" := Dim2;
        ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
      END;
      IF ("Shortcut Dimension 2 Code" <> '') THEN BEGIN
        //DimVal2Rec.CHANGECOMPANY("Receiving Company");
        DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimVal2Rec, FALSE, "Job No.");
        IF "Cost Type" <> DimVal2Rec."Cost Type" + 1 THEN BEGIN //call 26946
          HideDialog := TRUE;
          VALIDATE("Cost Type", DimVal2Rec."Cost Type" + 1);
          HideDialog := FALSE;
        END;
      END;
    END;

    PROCEDURE OnLookupDim1Code@1100525009(iEditable@1100525000 : Boolean);
    BEGIN
      //**4PS
      CheckCompanyIC;
      DimVal1Rec.Code := "Shortcut Dimension 1 Code";
      DimVal1Rec.SETRANGE("Global Dimension No.",1);
      IF NOT iEditable THEN
        PAGE.RUNMODAL(0, DimVal1Rec)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, DimVal1Rec) = ACTION::LookupOK THEN
          VALIDATE("Shortcut Dimension 1 Code", DimVal1Rec.Code);
      END;
    END;

    PROCEDURE OnLookupDim2Code@1100525010(iEditable@1100525000 : Boolean);
    VAR
      PurchLine@1210190000 : Record 12013588;
    BEGIN
      //**4PS
      CheckCompanyIC;
      //**4PS DP00387 DimVal2 is replaced by DimVal2Rec --> in concordence with the Validate Trigger
      DimVal2Rec.Code := "Shortcut Dimension 2 Code";   //**4PS DP00387 DimVal2 changed into DimVal2Rec
      DimVal2Rec.SETRANGE("Global Dimension No.",2);   //**4PS DP00387 changed
      IF "Cost Type" <> "Cost Type"::" " THEN
        DimVal2Rec.SETRANGE("Cost Type", "Cost Type"-1)    //**4PS DP00387 changed
      ELSE
        DimVal2Rec.SETFILTER("Cost Type", '<%1', DimVal2Rec."Cost Type"::Revenue);//**4PS DP00387 changed
      IF "Job No." <> '' THEN
        DimVal2Rec.SETRANGE("Project Filter","Job No.");    //**4PS DP00387 changed
      //IF "Receiving Company" <> '' THEN
      //  DimVal2Rec.SETRANGE("Company Filter", "Receiving Company");  //**4PS DP00387 changed

      IF NOT iEditable THEN
        PAGE.RUNMODAL(PAGE::"Cost Object List", DimVal2Rec)        //**4PS DP00387 changed
      ELSE BEGIN
        xRec."Shortcut Dimension 2 Code" := "Shortcut Dimension 2 Code"; //call 26684
        xRec."Job No." := "Job No."; //call 26684
        IF PAGE.RUNMODAL(PAGE::"Cost Object List", DimVal2Rec) = ACTION::LookupOK THEN BEGIN    //**4PS DP00387 changed
          IF NOT PurchLine.GET("Inbound Document No.", "Line No.") THEN
            xRec."Cost Type" := "Cost Type"::" ";  //db, 11-02-11: M25031
          VALIDATE("Shortcut Dimension 2 Code", DimVal2Rec.Code);          //**4PS DP00387 changed
        END;
      END;
    END;

    PROCEDURE OnLookupServiceOrderNo@1100525011(iEditable@1100525000 : Boolean);
    BEGIN
      //**4PS
      CheckCompanyIC;
      ServOrderRec."No." := "Service Order No.";
      IF NOT iEditable THEN
        PAGE.RUNMODAL(0, ServOrderRec)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, ServOrderRec) = ACTION::LookupOK THEN BEGIN
          xRec."Service Order No." := '';  //db, 07-06-10: M19676
          VALIDATE("Service Order No.", ServOrderRec."No.");
        END;
      END;
    END;

    BEGIN
    END.
  }
}

