OBJECT Table 11012055 Advice Order Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    OnInsert=VAR
               MobileItemUsage@1100528100 : Record 11229872;
               ServiceProcessManagement@1100528600 : Codeunit 11012883;
               RecRef@1100528601 : RecordRef;
             BEGIN
               CheckBlocked;
               CheckRecordType(0);
               GetDepartment;
               PurchSetup.GET;
               IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::Company THEN
                 "Price Agreement" := TRUE
               ELSE
                 "Price Agreement" := FALSE;
               "Purchase Route Reference" := '';
               "Shipping Detail Line" := 0;
               "Created by Employee No." := '';
               "Created by Employee Company" := '';
               "Created by Work Order No." := '';
               VALIDATE("Created by", USERID);
               "Date Created" := TODAY;
               "Modified by" := USERID;
               "Last Date Modified" := TODAY;

               VALIDATE("Cost Component");
               StrategicPurchMgt.FindContractForAdviceOrder(Rec);
               CheckEntityNo;

               IF FPSLicenseManagement.LicenseAndReadPermissionForTable(MobileItemUsage) THEN
                 MobileItemUsage.CreateModifyFromAdvOrdLine(Rec);

               IF ServiceProcessManagement.AssignDefaultValues(Rec, '', RecRef) THEN
                 RecRef.SETTABLE(Rec);
               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, TRUE);
             END;

    OnModify=VAR
               MobileItemUsage@1100528100 : Record 11229872;
               ServiceProcessManagement@1100528600 : Codeunit 11012883;
               PreferenceLocation@1100285100 : Record 11020353;
             BEGIN
               CheckBlocked;
               CheckRecordType(1);
               GetDepartment;
               "Modified by" := USERID;
               "Last Date Modified" := TODAY;
               StrategicPurchMgt.FindContractForAdviceOrder(Rec);
               VALIDATE("Supplying Company Inventory");
               CheckEntityNo;

               IF FPSLicenseManagement.LicenseAndReadPermissionForTable(MobileItemUsage) THEN
                 MobileItemUsage.CreateModifyFromAdvOrdLine(Rec);

               IF xRec."Additional Cost (Service)" = "Additional Cost (Service)" THEN
                 CheckAdditionalCostService;

               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, FALSE);

               //200408 ORANGO.EE
               IF "Transaction (Secondary)" = "Transaction (Secondary)"::Purchase THEN BEGIN
                 "Order Date" := TODAY;
                 PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::Job);
                 PreferenceLocation.SETRANGE("No.", "Project No.");
                 PreferenceLocation.SETFILTER(Priority,'%1', 1);
                 IF PreferenceLocation.FINDSET THEN
                   Deliver := Deliver::Location;
                   "Ship To Location" := PreferenceLocation."Location Code";
               END;
               //<<
             END;

    OnDelete=VAR
               PurchaseLineDetail@1210190000 : Record 11020660;
               AdviceLine@1210190001 : Record 11012055;
               MobileItemUsage@1100528100 : Record 11229872;
               BudgetLine@1100285100 : Record 11012001;
             BEGIN
               IF (PurchaseLineDetail.GET(PurchaseLineDetail."Line Type"::"Advice Order",
                 PurchaseLineDetail."Record Type"::Project, "Project No.", "Yard No.", "System No.",
                 "Entity Type", "Entity No.", "Service Order No.", '', "Line No."))
               THEN
                 PurchaseLineDetail.DELETE;

               IF "Line No." <> 0 THEN BEGIN   //when Line No.=0 Navision will be closed; possible error as a result of import
                 IF ("Source Type" = "Source Type"::"Recipe Header") AND (Recipe <> '') THEN BEGIN
                   AdviceLine.SETRANGE("Record Type", "Record Type");
                   AdviceLine.SETFILTER("Project No.", "Project No.");
                   AdviceLine.SETFILTER("Service Order No.", "Service Order No.");
                   AdviceLine.SETFILTER("G/L Account", "G/L Account");  //DP01378
                   AdviceLine.SETRANGE("Attached to Line No.","Line No.");
                   AdviceLine.DELETEALL(TRUE);
                 END;
               END;

               DeleteCommentLine();
               DeleteDocumentLinks;

               IF FPSLicenseManagement.LicenseAndReadPermissionForTable(MobileItemUsage) THEN
                 MobileItemUsage.DeleteFromAdvOrdLine(Rec);

               //200408 ORANGO.EE >>
               BudgetLine.SETRANGE("Project No.", Rec."Project No.");
               BudgetLine.SETRANGE("Item No.", Rec."Item No.");
               IF BudgetLine.FINDSET THEN REPEAT
                 BudgetLine.Advised := FALSE;
                 BudgetLine.MODIFY;
               UNTIL BudgetLine.NEXT = 0;
               //<<
             END;

    CaptionML=[ENU=Advice Order Line;
               NOR=Bestillingsunderlagsrad;
               SVE=Best„llningsunderlagsrad];
    PasteIsValid=No;
    LookupPageID=Page11012122;
    DrillDownPageID=Page11012122;
  }
  FIELDS
  {
    { 1   ;   ;Project No.         ;Code20        ;TableRelation=IF (Record Type=CONST(Project)) Job;
                                                   OnValidate=VAR
                                                                lvJobRec@1100525000 : Record 11072003;
                                                              BEGIN
                                                                StrategicPurchMgt.FindContractForAdviceOrder(Rec);
                                                                IF "Project No." <> '' THEN BEGIN
                                                                  lvJobRec.GET("Project No.");
                                                                  "Main Project No." := lvJobRec."Main Project";
                                                                END;
                                                                ClearEditableAssemYardNoFields;

                                                                IF ("Project No." <> xRec."Project No.") THEN BEGIN
                                                                  FillDefaultFscType();
                                                                  "Plant Location" := '';
                                                                  FillDefaultPlantCompany;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 2   ;   ;Element             ;Code20        ;TableRelation=IF (Record Type=CONST(Project)) "Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                ElementFormat.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN BEGIN
                                                                  ProjElemRec.GET("Project No.",Element);
                                                                  ProjElemRec.CheckProjectElementBlocked;
                                                                END;
                                                                CheckStatusAndElementMandatory;

                                                                EvaluateStartDate("Receipt Date");
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 3   ;   ;Extension Contract  ;Code10        ;TableRelation=IF (Record Type=CONST(Project)) "Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                IF "Extension Contract" <> '' THEN BEGIN
                                                                  ExtensionContract.GET("Project No.", "Extension Contract");
                                                                  IF ExtensionContract.Status = ExtensionContract.Status::Expired THEN
                                                                    ExtensionContract.FIELDERROR(Status);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=ŽTA] }
    { 5   ;   ;Line No.            ;Integer       ;OnValidate=BEGIN
                                                                IF "Line No." = 0 THEN
                                                                  "Line No." := GetLineNo;
                                                              END;

                                                   CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 10  ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=VAR
                                                                Item@1100527550 : Record 27;
                                                                PreferenceLocation@1100285100 : Record 11020353;
                                                              BEGIN
                                                                IF "Item No." <> '' THEN BEGIN
                                                                  TESTFIELD("Plant Type", '');
                                                                  CheckItemInPlantCompany;
                                                                END;
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                                  IF CurrFieldNo = FIELDNO("Item No.") THEN  //prevent other vendor choice at indirect validation
                                                                    ValidateVendor;
                                                                END;
                                                                IF "Item No." <> xRec."Item No." THEN BEGIN
                                                                  "Variant Code" := '';
                                                                  "Item Category Code" := '';
                                                                  VALIDATE("Supplying Company Inventory", ItemRec.GetSupplyingCompanyInventory("Item No."));
                                                                END;
                                                                IF Item.GET("Item No.") THEN
                                                                  "Item Category Code" := Item."Item Category Code";
                                                                StrategicPurchMgt.FindContractForAdviceOrder(Rec);
                                                                SetLocationCode;

                                                                //>> ORANGO.LP 4PSSE CER GAP 13
                                                                SetSecondaryTransaction(Item);
                                                                //<< ORANGO.LP 4PSSE CER GAP 13

                                                                //200325 ORANGO.EE >>
                                                                PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::Job);
                                                                PreferenceLocation.SETRANGE("No.", "Project No.");
                                                                PreferenceLocation.SETFILTER(Priority,'%1', 1);
                                                                IF PreferenceLocation.FINDSET THEN
                                                                  "Home Location" := PreferenceLocation."Location Code";
                                                                //<<
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              NOR=Artikkelnr;
                                                              SVE=Artikelnr] }
    { 11  ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                IF "Basic Item" <> '' THEN
                                                                  TESTFIELD("Plant Type", '');
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::"Basic Item");
                                                                  IF CurrFieldNo = FIELDNO("Basic Item") THEN  //prevent other vendor choice at indirect validation
                                                                    ValidateVendor;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              NOR=Fabrikantartikkel;
                                                              SVE=Basartikel] }
    { 12  ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              NOR=Fabrikant;
                                                              SVE=Tillverkare] }
    { 13  ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                IF "Trade Item" <> '' THEN BEGIN
                                                                  TESTFIELD("Plant Type", '');
                                                                  IF Transaction = Transaction::Plant THEN
                                                                    FIELDERROR(Transaction, STRSUBSTNO(Text012, Transaction));
                                                                END;
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN
                                                                  ValidateItem(ItemTypeOpt::"Trade Item");
                                                                StrategicPurchMgt.FindContractForAdviceOrder(Rec);
                                                                OperationCodebyItem.CheckItemOperationCode("Vendor (Trade Item)", "Trade Item", "Item Operation Code");
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              NOR=Katalogartikkel;
                                                              SVE=Anskaffningsartikel] }
    { 14  ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                TradeVendorRec@1100525000 : Record 11012304;
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  TradeVendorRec.HandleVendorValidate("Vendor (Trade Item)");
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                  CheckVendorRelation(FIELDNO("Vendor (Trade Item)"));
                                                                END;
                                                                OperationCodebyItem.CheckItemOperationCode("Vendor (Trade Item)", "Trade Item", "Item Operation Code");
                                                                CALCFIELDS("Vendor Name (Trade Item)");
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              NOR=Leverand›r (katalogartikkel);
                                                              SVE=Leverant”r (skaffningsartikel)] }
    { 16  ;   ;Vendor              ;Code20        ;TableRelation=IF (Subcontracting Activity=FILTER(='')) Vendor.No.
                                                                 ELSE IF (Subcontracting Activity=FILTER(<>'')) "Subcontracting Activity Price"."Subcontractor No." WHERE (Subcontracting Activity=FIELD(Subcontracting Activity));
                                                   OnValidate=BEGIN
                                                                IF "Subcontracting Activity" <> '' THEN
                                                                  GetSubcontractorActivity(FIELDNO(Vendor));  //DP01958a

                                                                CheckVendorRelation(FIELDNO(Vendor));
                                                                IF CurrFieldNo = FIELDNO(Vendor) THEN
                                                                  CheckVendorPricePerQuantity;  //C045045

                                                                IF Vendor <> '' THEN BEGIN
                                                                  Vend.GET(Vendor);
                                                                  CheckVendBlocked;
                                                                  IF (CurrFieldNo <> 0) AND
                                                                     ("Cost Object" = '') AND ("Item No." = '') AND ("Basic Item" = '') AND ("Trade Item" = '') THEN
                                                                    IF Vend."Subcontractor Type" <> Vend."Subcontractor Type"::" " THEN
                                                                      "Cost Type" := "Cost Type"::Subcontracting;
                                                                  IF (Vendor <> xRec.Vendor) AND ("Plant Type" <> '') AND (Transaction = Transaction::Purchase) THEN
                                                                    GetPlantPurchaseOrRentRate();  //C021779.n
                                                                END ELSE BEGIN
                                                                  IF xRec.Vendor <> '' THEN BEGIN
                                                                    IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN BEGIN
                                                                      ProcessOpenStatus;
                                                                      CheckMessageOpenAdvice;
                                                                    END;
                                                                  END;
                                                                END;

                                                                CALCFIELDS("Vendor Name");

                                                                StrategicPurchMgt.FindContractForAdviceOrder(Rec);

                                                                GetDefaultOrderAddress;
                                                              END;

                                                   CaptionML=[ENU=Vendor;
                                                              NOR=Leverand›r;
                                                              SVE=Leverant”r] }
    { 17  ;   ;Vendor Name (Trade Item);Text100   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("ETIM Vendor - Central Mgt".Name WHERE (Code=FIELD("Vendor (Trade Item)")));
                                                   CaptionML=[ENU=Vendor Name (Trade Item);
                                                              NOR=Leverand›rsnavn (katalogartikkel);
                                                              SVE=Leverant”rsnamn (skaffningsartikel)];
                                                   Editable=No }
    { 18  ;   ;Vendor Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=[ENU=Vendor Name;
                                                              NOR=Leverand›rsnavn;
                                                              SVE=Leverant”rsnamn];
                                                   Editable=No }
    { 19  ;   ;Manufacturer Name   ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("ETIM Vendor - Central Mgt".Name WHERE (Code=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Manufacturer Name;
                                                              NOR=Fabrikantens navn;
                                                              SVE=Tillverkarens namn];
                                                   Editable=No }
    { 20  ;   ;Quantity (Budget)   ;Decimal       ;CaptionML=[ENU=Quantity (Budget);
                                                              NOR=Antall (Budsjett);
                                                              SVE=Antal (budget)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 21  ;   ;Quantity (Advice)   ;Decimal       ;OnValidate=BEGIN
                                                                IF "Quantity (Advice)" > "Quantity (Budget)" - "Quantity (Processed)" THEN
                                                                  IF "Quantity (Budget)" <> 0 THEN
                                                                    IF CurrFieldNo <> 0 THEN
                                                                      MESSAGE(Text000);

                                                                IF CurrFieldNo = FIELDNO("Quantity (Advice)") THEN BEGIN
                                                                  CheckRecipeTotals;
                                                                  CheckBomLines;  //DP02339
                                                                  CheckVendorPricePerQuantity;  //C045045
                                                                  IF "Price Agreement" THEN
                                                                    VALIDATE("Price (LCY)", xRec."Price (LCY)");
                                                                END;

                                                                IF "Quantity (Advice)" <> xRec."Quantity (Advice)" THEN BEGIN
                                                                  GetStatusOnProcess(FALSE);
                                                                  //db.sn, 24-05-16: C018776
                                                                  IF (CurrFieldNo = FIELDNO("Quantity (Advice)")) AND
                                                                     ("Quantity (Advice)" <= 0) AND ("Quantity (Budget)" >= "Quantity (Processed)") THEN  //DP01402
                                                                    ProcessOpenStatus;
                                                                  //db.en, 24-05-16: C018776
                                                                END;

                                                                IF "Quantity (Advice)" <> 0 THEN BEGIN
                                                                  IF xRec."Quantity (Advice)" = 0 THEN
                                                                    VALIDATE("Order Date", TODAY);
                                                                END;
                                                                CheckMessageOpenAdvice;
                                                                GetDefaultTransaction;
                                                                CalculateTotal;

                                                                //>> ORANGO.LP 4PSSE CER GAP 13
                                                                SetSecondaryTransaction(ItemRec);
                                                                //<< ORANGO.LP 4PSSE CER GAP 13
                                                              END;

                                                   CaptionML=[ENU=Quantity (Advice);
                                                              NOR=Antall (Underlag);
                                                              SVE=Antal (underlag)];
                                                   DecimalPlaces=0:5 }
    { 22  ;   ;Quantity (Processed);Decimal       ;CaptionML=[ENU=Quantity (Processed);
                                                              NOR=Antall (behandlede);
                                                              SVE=Antal (behandlade)];
                                                   DecimalPlaces=0:5;
                                                   Editable=Yes }
    { 25  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN
                                                                  ValidateUnitOfMeasure("Unit of Measure");
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=Enhet;
                                                              SVE=Enhet] }
    { 26  ;   ;Description         ;Text100       ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 27  ;   ;Price (LCY)         ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886

                                                                CalculateDiscount;
                                                                CalculateTotal;
                                                              END;

                                                   CaptionML=[ENU=Price (LCY);
                                                              SVE=Pris (BVA)];
                                                   Description=DP00884;
                                                   AutoFormatType=2 }
    { 30  ;   ;Transaction         ;Option        ;OnValidate=VAR
                                                                ProjectElement@1210190000 : Record 11012010;
                                                              BEGIN
                                                                IF Transaction <> xRec.Transaction THEN BEGIN
                                                                  IF ("Plant Type" <> '') AND ("Plant Company" <> '') THEN
                                                                    TESTFIELD(Transaction, Transaction::Plant);
                                                                  "Location Code" := '';
                                                                  "Bin Code" := '';
                                                                  "Order Date" := 0D;
                                                                  IF (Element <> '') THEN BEGIN
                                                                    IF (ProjectElement.GET("Project No.", Element)) THEN
                                                                      "Receipt Date" := ProjectElement."Starting Date";
                                                                  END;
                                                                  VALIDATE("Delivery Period", '');
                                                                  IF Transaction = Transaction::Inventory THEN BEGIN
                                                                    GetDefaultTransaction;
                                                                  END;
                                                                  //C021779.sn
                                                                  IF (xRec.Transaction = Transaction::Purchase) AND (Transaction = Transaction::Plant) THEN BEGIN
                                                                    IF "Plant Type" <> '' THEN BEGIN
                                                                      "Price (LCY)" := 0;
                                                                      "Gross Price (LCY)" := 0;
                                                                      "Discount %" := 0;
                                                                      VALIDATE("Price (LCY)");
                                                                    END;
                                                                  END;
                                                                  IF Transaction = Transaction::Purchase THEN BEGIN
                                                                    IF "Plant Type" <> '' THEN BEGIN
                                                                      FillPlantPurchOrRentPrefVendor();
                                                                      GetPlantPurchaseOrRentRate();
                                                                    END;
                                                                  END;
                                                                  //C021779.en
                                                                END;
                                                                IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN BEGIN
                                                                  IF TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
                                                                    IF TradeItemRec.Expired THEN
                                                                      IF TradeItemRec."Item Code (Successor)" = '' THEN
                                                                        TradeItemRec.TESTFIELD(Expired,FALSE);
                                                                  END;
                                                                  IF ItemRec.GET("Item No.") THEN BEGIN
                                                                    ItemRec.TESTFIELD("Advice Blocked",FALSE);
                                                                    ItemRec.TESTFIELD(Blocked,FALSE);
                                                                    ItemRec.TESTFIELD("Purchasing Blocked",FALSE);
                                                                  END;
                                                                END;

                                                                IF (Transaction = Transaction::Inventory) THEN BEGIN
                                                                  IF ItemRec.GET("Item No.") THEN BEGIN
                                                                    ItemRec.TESTFIELD("Advice Blocked",FALSE);
                                                                    ItemRec.TESTFIELD(Blocked,FALSE);
                                                                    ItemRec.TESTFIELD("Inventory Blocked",FALSE);
                                                                  END;
                                                                END;

                                                                SetLocationCode;

                                                                VALIDATE("Delivery Period", '');

                                                                CheckVendBlocked;
                                                              END;

                                                   CaptionML=[ENU=Transaction;
                                                              NOR=Transaksjon;
                                                              SVE=Transaktion];
                                                   OptionCaptionML=[ENU=Purchase,Inventory,Plant,Requisition;
                                                                    SVE=Ink”p,Lager,Maskin,Rekvisition];
                                                   OptionString=Purchase,Inventory,Plant,Requisition }
    { 31  ;   ;Deliver             ;Option        ;OnValidate=BEGIN
                                                                CASE Deliver OF
                                                                  Deliver::"Service Location":
                                                                    TESTFIELD("Record Type", "Record Type"::ServOrder);
                                                                  Deliver::"Project Location":
                                                                    TESTFIELD("Record Type", "Record Type"::Project);
                                                                END;

                                                                IF NOT ValidateShipToLocation(FALSE) THEN
                                                                  IF Deliver <> xRec.Deliver THEN
                                                                    GetDefaultShipToLocation;
                                                              END;

                                                   CaptionML=[ENU=Deliver;
                                                              NOR=Lever;
                                                              SVE=Leverera];
                                                   OptionCaptionML=[ENU=" ,Location,Project Location,Service Location,Contact Address,,,,Order Address";
                                                                    SVE=" ,Lagerst„lle,Etablering,Serviceplats,Kontaktadress,,,,Order adress"];
                                                   OptionString=[ ,Location,Project Location,Service Location,Contact Address,,,,Order Address] }
    { 32  ;   ;Processed           ;Boolean       ;OnValidate=BEGIN
                                                                IF NOT xRec.Processed AND Processed THEN
                                                                  ChangeStatusAttachedLine();
                                                              END;

                                                   CaptionML=[ENU=Processed;
                                                              NOR=Behandlede;
                                                              SVE=Behandlades];
                                                   Editable=No }
    { 35  ;   ;Process Status      ;Option        ;OnValidate=VAR
                                                                ApprovalManagement4PSConstr@1100528200 : Codeunit 11125349;
                                                                ApprovalsMgmt@1100528201 : Codeunit 1535;
                                                              BEGIN
                                                                //Option: Open,Partly Processed,Released,Cancelled,Processed,On Hold,Pending Approval
                                                                //If Current status: Pending Approval --> Then change only possible to Release or to Open by Workflow
                                                                //IF Open And Approvals WorkFlow Enabled Then Change only to On Hold/Cancelled/Pending Approval possible.
                                                                //Change to Pending Approval only by Workflow.

                                                                CheckStatusAndElementMandatory;
                                                                IF ("Process Status" = "Process Status"::Released) OR ("Process Status" = "Process Status"::"Pending Approval") THEN
                                                                  CheckVendBlocked;


                                                                IF (NOT ApprovalManagement4PSConstr.IsAdviceOrderLineApprovalsWorkflowEnabled(Rec)) AND
                                                                   (NOT ApprovalsMgmt.HasOpenOrPendingApprovalEntries(RECORDID)) THEN BEGIN
                                                                  IF ("Process Status" = "Process Status"::"Pending Approval") AND
                                                                     (xRec."Process Status" <> "Process Status"::"Pending Approval") THEN
                                                                    ERROR(Text018);
                                                                END;

                                                                IF ApprovalsMgmt.HasOpenOrPendingApprovalEntries(RECORDID) THEN BEGIN
                                                                  IF (xRec."Process Status" = "Process Status"::"Pending Approval") THEN BEGIN
                                                                    IF "Process Status" <> "Process Status"::"Pending Approval" THEN
                                                                      ERROR(Text018);
                                                                  END;
                                                                END;

                                                                IF ApprovalManagement4PSConstr.IsAdviceOrderLineApprovalsWorkflowEnabled(Rec) THEN BEGIN
                                                                  IF (xRec."Process Status" = "Process Status"::Open) OR (xRec."Process Status" = Rec."Process Status"::"Partly Processed") THEN
                                                                    IF NOT ("Process Status" IN ["Process Status"::"On Hold", "Process Status"::Cancelled]) THEN
                                                                      ERROR(Text017);

                                                                  IF (xRec."Process Status" IN ["Process Status"::"On Hold", "Process Status"::Cancelled, "Process Status"::Processed]) THEN
                                                                    IF NOT ("Process Status" IN ["Process Status"::Open, "Process Status"::"Partly Processed","Process Status"::"On Hold", "Process Status"::Cancelled]) THEN
                                                                      ERROR(Text017);
                                                                END;

                                                                IF ("Process Status" = "Process Status"::Open) AND
                                                                   ("Quantity (Processed)" <> 0 )
                                                                THEN
                                                                  "Process Status" := "Process Status"::"Partly Processed";

                                                                IF ("Process Status" = "Process Status"::Processed) THEN
                                                                  IF ("Quantity (Budget)" = 0) AND ("Quantity (Processed)" = 0) THEN
                                                                    ProcessOpenStatus;

                                                                IF "Process Status" IN ["Process Status"::Open, "Process Status"::"Pending Approval", "Process Status"::Cancelled]
                                                                THEN BEGIN
                                                                  "Consented Date-Time" := 0DT;
                                                                END;

                                                                IF ("Process Status" = "Process Status"::Open) THEN
                                                                  Processed := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Process Status;
                                                              NOR=Prosess status;
                                                              SVE=Processtatus];
                                                   OptionCaptionML=ENU=Open,Partly Processed,Released,Cancelled,Processed,On Hold,Pending Approval;
                                                   OptionString=Open,Partly Processed,Released,Cancelled,Processed,On Hold,Pending Approval }
    { 40  ;   ;Receipt Date        ;Date          ;OnValidate=VAR
                                                                MinimumReceiptDate@1100528804 : Date;
                                                                CompInfoRec@1100528803 : Record 79;
                                                                DateFormula@1100528800 : DateFormula;
                                                                NonWorkDate@1100528802 : Boolean;
                                                                dummyDesc@1100528801 : Text[30];
                                                              BEGIN
                                                                PurchSetup.GET;
                                                                CompInfoRec.GET;
                                                                IF (PurchSetup."Allow Nonworking Receipt Date") AND ("Delivery Period" <> '') THEN BEGIN
                                                                  EVALUATE(DateFormula,"Delivery Period");
                                                                  MinimumReceiptDate := CALCDATE(DateFormula, "Order Date");
                                                                  NonWorkDate := CalendarMgmt.CheckDateStatus(CompInfoRec."Base Calendar Code", "Receipt Date", dummyDesc);
                                                                  IF NonWorkDate = TRUE THEN BEGIN
                                                                    IF "Receipt Date" < MinimumReceiptDate THEN
                                                                      BalanceDatesAndDeliveryPeriod(FIELDNO("Receipt Date"))
                                                                    ELSE
                                                                      MESSAGE(Text014)
                                                                  END ELSE
                                                                    BalanceDatesAndDeliveryPeriod(FIELDNO("Receipt Date"));
                                                                END ELSE
                                                                  BalanceDatesAndDeliveryPeriod(FIELDNO("Receipt Date"));
                                                              END;

                                                   CaptionML=[ENU=Receipt Date;
                                                              NOR=Kvitteringsdato;
                                                              SVE=Inleveransdatum] }
    { 41  ;   ;Delivery Period     ;Code20        ;OnValidate=BEGIN
                                                                BalanceDatesAndDeliveryPeriod(FIELDNO("Delivery Period"));
                                                              END;

                                                   CaptionML=[ENU=Delivery Period;
                                                              NOR=Leveranseperiode;
                                                              SVE=Leveransperiod] }
    { 42  ;   ;Order Date          ;Date          ;OnValidate=BEGIN
                                                                BalanceDatesAndDeliveryPeriod(FIELDNO("Order Date"));
                                                              END;

                                                   CaptionML=[ENU=Order Date;
                                                              NOR=Ordredato;
                                                              SVE=Orderdatum] }
    { 45  ;   ;Requested Receipt Date;Date        ;CaptionML=[ENU=Requested Receipt Date;
                                                              NOR=nsket mottaksdato;
                                                              SVE=Beg„rt inleveransdatum] }
    { 50  ;   ;Location Code       ;Code10        ;TableRelation=Location.Code WHERE (Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                Item@1100285100 : Record 27;
                                                              BEGIN
                                                                CheckLocationBlocked("Location Code");

                                                                IF (Transaction = Transaction::Inventory) AND
                                                                   ("Supplying Company Inventory" = '')
                                                                THEN BEGIN
                                                                  InventorySetup.GET;
                                                                  IF InventorySetup."Location Mandatory" THEN
                                                                    LocRec.GET("Location Code");
                                                                END;

                                                                CheckInventoryOnLocation;
                                                                VALIDATE("Delivery Period", '');

                                                                IF (Transaction = Transaction::Inventory) THEN
                                                                  IF ("Location Code" <> xRec."Location Code") AND ("Location Code" <> '') THEN
                                                                    GetDefaultBin("Location Code","Bin Code","Bin Code (Project Inventory)");

                                                                //>> ORANGO.LP 4PSSE CER GAP 13
                                                                IF Item.GET("Item No.") THEN
                                                                  SetSecondaryTransaction(Item);
                                                                //<< ORANGO.LP 4PSSE CER GAP 13
                                                              END;

                                                   CaptionML=[ENU=Location Code;
                                                              NOR=Plasseringkode;
                                                              SVE=Lagerst„llekod] }
    { 55  ;   ;Ship To Location    ;Code20        ;TableRelation=IF (Deliver=CONST(Project Location)) "Project Location".Code WHERE (Project No.=FIELD(Project No.))
                                                                 ELSE IF (Deliver=CONST(Location)) Location.Code
                                                                 ELSE IF (Deliver=CONST(Service Location)) "Service Order Location".Code WHERE (Service Order No.=FIELD(Service Order No.))
                                                                 ELSE IF (Deliver=CONST(Contact Address)) Contact.No.
                                                                 ELSE IF (Deliver=CONST(Order Address)) "Order Address".Code WHERE (Vendor No.=FIELD(Vendor));
                                                   OnValidate=BEGIN
                                                                ValidateShipToLocation(TRUE);

                                                                IF Deliver = Deliver::Location THEN
                                                                  IF ("Ship To Location" <> xRec."Ship To Location") AND ("Ship To Location" <> '') THEN
                                                                    GetDefaultBin("Ship To Location", "Bin Code", "Bin Code (Project Inventory)");
                                                              END;

                                                   CaptionML=[ENU=Ship To Location;
                                                              NOR=Lever til lokasjon;
                                                              SVE=Leverera till lagerst„lle] }
    { 60  ;   ;Cost Object         ;Code20        ;TableRelation=IF (Cost Type=CONST(Material)) "Dimension Value".Code WHERE (Cost Type=FILTER(Material),
                                                                                                                              Global Dimension No.=CONST(2),
                                                                                                                              Project Filter=FIELD(Project No.))
                                                                                                                              ELSE IF (Cost Type=CONST(Subcontracting)) "Dimension Value".Code WHERE (Cost Type=FILTER(Subcontracting),
                                                                                                                                                                                                      Global Dimension No.=CONST(2),
                                                                                                                                                                                                      Project Filter=FIELD(Project No.))
                                                                                                                                                                                                      ELSE IF (Cost Type=CONST(Plant)) "Dimension Value".Code WHERE (Cost Type=FILTER(Plant),
                                                                                                                                                                                                                                                                     Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                                     Project Filter=FIELD(Project No.))
                                                                                                                                                                                                                                                                     ELSE IF (Cost Type=CONST(Sundry)) "Dimension Value".Code WHERE (Cost Type=FILTER(Sundry),
                                                                                                                                                                                                                                                                                                                                     Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                                                                                                     Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                lvText000@1100485001 : TextConst 'ENU=Copy Data from new Cost Object?\\;NOR=Kopier data fra nytt Kostnadsobjekt?\\;SVE=Kopiera data fr†n nytt kostnadsobjekt?\\';
                                                                lvText001@1100485000 : TextConst 'ENU=Empty fields only will be updated. Existing data will not be overruled.;NOR=Kun tomme felt vil oppdateres. Eksisterende data vil ikke bli overstyrt.;SVE=Endast tomma f„lt kommer att uppdateras. Befintliga data kommer inte att †sidos„ttas.';
                                                              BEGIN
                                                                IF "Cost Object" <> '' THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2,"Cost Object",DimValRec,TRUE,'');
                                                                  DimValRec.TESTFIELD(Blocked, FALSE);
                                                                END;

                                                                IF ("Cost Object" <> '') AND ("Item No." + "Trade Item" + "Basic Item" = '') THEN BEGIN
                                                                  IF xRec."Cost Object" = '' THEN
                                                                    GetDefaultsCostObject()
                                                                  ELSE
                                                                    IF "Cost Object" <> xRec."Cost Object" THEN
                                                                      IF CONFIRM(lvText000 + lvText001) THEN
                                                                        GetDefaultsCostObject();
                                                                  IF "Cost Type" = "Cost Type"::Material THEN
                                                                    VALIDATE("Delivery Period", '');
                                                                END;

                                                                IF (CurrFieldNo = FIELDNO("Cost Object")) THEN
                                                                  SetCostComponent;

                                                                IF ("Cost Object" <> xRec."Cost Object") AND ("FSC Type Code" = '') THEN
                                                                  FillDefaultFscType();
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              NOR=Kostnadsobjekt;
                                                              SVE=Kostnadsobjekt];
                                                   NotBlank=Yes;
                                                   CaptionClass='1,1,2' }
    { 61  ;   ;Cost Type           ;Option        ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Cost Type") THEN BEGIN
                                                                  CheckAdditionalCostService;
                                                                  CheckDeliveryPeriod;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Cost Type;
                                                              NOR=Kostnadstype;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=Material,Subcontracting,Plant,Sundry;
                                                                    NOR=Materiale,Underentrepen›r,Maskin,Diverse;
                                                                    SVE=Material,underentreprenad,Maskin,diverse];
                                                   OptionString=Material,Subcontracting,Plant,Sundry }
    { 70  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              NOR=Beskrivelse 2;
                                                              SVE=Beskrivning 2] }
    { 80  ;   ;Purchase Action     ;Code10        ;TableRelation="Project Purchase Action".Code WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Purchase Action;
                                                              NOR=Innkj›pshandling;
                                                              SVE=Ink”ps†tg„rd] }
    { 81  ;   ;Purchase Phase      ;Code10        ;CaptionML=[ENU=Purchase Phase;
                                                              NOR=Innkj›psfase;
                                                              SVE=Ink”psfas];
                                                   Numeric=Yes }
    { 82  ;   ;Shelf No. (Item)    ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item."Shelf No." WHERE (No.=FIELD(Item No.)));
                                                   CaptionML=[ENU=Shelf No. (Item);
                                                              NOR=Hyllenr. (artikkel);
                                                              SVE=Hyllnr (artikel)];
                                                   Editable=No }
    { 83  ;   ;Sort Shelf          ;Code20        ;CaptionML=[ENU=Sort Shelf;
                                                              NOR=Sorter hylle;
                                                              SVE=Sortera hylla] }
    { 84  ;   ;Sort Location       ;Code50        ;CaptionML=[ENU=Sort Location;
                                                              NOR=Sorter lokasjon;
                                                              SVE=Sortera lagerst„lle];
                                                   Description=Project+Deliver+Ship to Location }
    { 85  ;   ;Shelf No. (SKU)     ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Stockkeeping Unit"."Shelf No." WHERE (Item No.=FIELD(Item No.),
                                                                                                             Location Code=FIELD(Location Code)));
                                                   CaptionML=[ENU=Shelf No. (SKU);
                                                              NOR=Hyllenr (LFE);
                                                              SVE=Hyllnr (lagerst„llsenhet)];
                                                   Editable=No }
    { 90  ;   ;Negotiation recommended;Boolean    ;CaptionML=[ENU=Negotiation recommended;
                                                              NOR=Forhandling anbefales;
                                                              SVE=F”rhandling rekommenderas] }
    { 100 ;   ;External Text       ;Text250       ;OnValidate=BEGIN
                                                                "External Text Block" := "External Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=External Text;
                                                              NOR=Ekstern Tekst;
                                                              SVE=Extern text] }
    { 101 ;   ;External Text Block ;Boolean       ;CaptionML=[ENU=External Text Block;
                                                              NOR=Ekstern Tekstblokk;
                                                              SVE=Externt textblock];
                                                   Editable=No }
    { 110 ;   ;Description Project ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Description Project;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 111 ;   ;Description Element ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Element)));
                                                   CaptionML=[ENU=Description Element;
                                                              NOR=Beskrivelse, element;
                                                              SVE=Beskrivning, element];
                                                   Editable=No }
    { 112 ;   ;Description Extension;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Extension Contract".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                              Contract No.=FIELD(Extension Contract)));
                                                   CaptionML=[ENU=Description Extension Contract;
                                                              NOR=ETA-beskrivelse;
                                                              SVE=ŽTA-beskrivning];
                                                   Editable=No }
    { 115 ;   ;Project Status      ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Project Status" WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Status;
                                                              NOR=Prosjektstatus;
                                                              SVE=Projekt- status];
                                                   OptionCaptionML=[ENU=Estimation,Preparation,Production,Technical Finished,Administrative Finished,Finished,Archive,Archived;
                                                                    NOR=Kalkulering,Forberedelse,Produksjon,Teknisk ferdig,Administrativt ferdig,Ferdig,Arkiv,Arkivert;
                                                                    SVE=Kalkyl,F”rberedelse,Produktion,Tekniskt f„rdig,Administrativt f„rdig,F„rdig,Arkiv,Arkiverad];
                                                   OptionString=Estimation,Preparation,Production,Technical Finished,Administrative Finished,Finished,Archive,Archived;
                                                   Editable=No }
    { 140 ;   ;Created by          ;Code50        ;TableRelation=User."User Name";
                                                   OnValidate=VAR
                                                                UserSetup@1100525000 : Record 91;
                                                              BEGIN
                                                                IF UserSetup.GET("Created by") THEN
                                                                  "Created by Employee No." := UserSetup."Employee No.";
                                                              END;

                                                   OnLookup=VAR
                                                              UserMgt@1210190000 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Created by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Created by;
                                                              NOR=Opprettet av;
                                                              SVE=Skapad av];
                                                   Editable=No }
    { 150 ;   ;Date Created        ;Date          ;CaptionML=[ENU=Date Created;
                                                              NOR=Opprettet;
                                                              SVE=Skapat datum];
                                                   Editable=No }
    { 160 ;   ;Modified by         ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserMgt@1210190000 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Modified by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=Žndrad av];
                                                   Editable=No }
    { 170 ;   ;Last Date Modified  ;Date          ;CaptionML=[ENU=Last Date Modified;
                                                              NOR=Endret den;
                                                              SVE=Uppdateringsdatum];
                                                   Editable=No }
    { 180 ;   ;Purchaser Code      ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=Purchaser Code;
                                                              NOR=Innkj›perkode;
                                                              SVE=Ink”parkod] }
    { 190 ;   ;Purchase Route Reference;Code20    ;OnLookup=VAR
                                                              lvRouteRefMgtCU@1210190000 : Codeunit 11012045;
                                                            BEGIN
                                                              lvRouteRefMgtCU.ShowReferenceList("Purchase Route Reference");
                                                            END;

                                                   CaptionML=[ENU=Purchase Route Reference;
                                                              NOR=Referanse for Innkj›psrute;
                                                              SVE=Referens f”r ink”psf”ljd];
                                                   Editable=No }
    { 200 ;   ;Ask for Quote       ;Boolean       ;CaptionML=[ENU=Ask for Quote;
                                                              NOR=Be om tilbud;
                                                              SVE=Beg„r offert] }
    { 210 ;   ;Price Agreement     ;Boolean       ;OnValidate=BEGIN
                                                                PurchSetup.GET;
                                                                IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::" " THEN
                                                                  TESTFIELD("Price Agreement", FALSE);
                                                                IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::Company THEN
                                                                  TESTFIELD("Price Agreement", TRUE);
                                                              END;

                                                   CaptionML=[ENU=Price Agreement;
                                                              NOR=Prisavtale;
                                                              SVE=Prisavtal] }
    { 220 ;   ;Gross Price (LCY)   ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Gross Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Gross Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886

                                                                CalculateNetPrice;
                                                              END;

                                                   CaptionML=[ENU=Gross Price (LCY);
                                                              NOR=Bruttopris (NOK);
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   AutoFormatType=2 }
    { 230 ;   ;Discount %          ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNetPrice;
                                                              END;

                                                   CaptionML=[ENU=Discount %;
                                                              NOR=Rabatt-%;
                                                              SVE=Rabatt %];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 240 ;   ;Item Type           ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Type" WHERE (Product Code=FIELD(Basic Item),
                                                                                                      Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Type;
                                                              NOR=Artikkeltype;
                                                              SVE=Artikeltyp];
                                                   Editable=No }
    { 241 ;   ;Item Brand          ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Brand" WHERE (Product Code=FIELD(Basic Item),
                                                                                                       Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Brand;
                                                              NOR=Artikkelens Varemerke;
                                                              SVE=Artikelns varum„rke];
                                                   Editable=No }
    { 242 ;   ;Item Series         ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Series" WHERE (Product Code=FIELD(Basic Item),
                                                                                                        Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Series;
                                                              NOR=Artikkelserier;
                                                              SVE=Artikelserier];
                                                   Editable=No }
    { 250 ;   ;Amount (LCY)        ;Decimal       ;CaptionML=[ENU=Amount (LCY);
                                                              NOR=Bel›p (NOK);
                                                              SVE=Belopp (BVA)];
                                                   Description=DP00884;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 260 ;   ;Alternative Vendor OLD;Code15      ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=ENU=Alternative Vendor OLD }
    { 270 ;   ;Alternative Item OLD;Code20        ;CaptionML=ENU=Alternative Item OLD }
    { 280 ;   ;Alternative Price (LCY) OLD;Decimal;CaptionML=ENU=Alternative Price (LCY) OLD;
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 290 ;   ;Sales Price (LCY)   ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Sales Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Sales Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Sales Price (LCY);
                                                              NOR=Totalt i salgspris;
                                                              SVE=Totalt i f”rs„ljningspris];
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   AutoFormatType=2 }
    { 300 ;   ;ICK Order           ;Code20        ;CaptionML=[ENU=ICK Order;
                                                              NOR=ICK-ordre;
                                                              SVE=ICK-order];
                                                   Editable=No }
    { 310 ;   ;Bin Code            ;Code20        ;OnValidate=VAR
                                                                WMSManagement@1001 : Codeunit 7302;
                                                                LocCode@1100526201 : Code[20];
                                                              BEGIN
                                                                LocCode := SetLocationForBin;
                                                                IF "Bin Code" <> '' THEN
                                                                  WMSManagement.FindBin(LocCode,"Bin Code","Variant Code");
                                                              END;

                                                   OnLookup=VAR
                                                              WMSManagement@1002 : Codeunit 7302;
                                                              LocCode@1100526200 : Code[10];
                                                              BinCode@1000 : Code[20];
                                                            BEGIN
                                                              LocCode := SetLocationForBin;
                                                              BinCode := WMSManagement.BinLookUpSpecific(LocCode,"Item No.","Variant Code",'',"Project No.","Service Order No.","Bin Code");
                                                              IF BinCode <> '' THEN
                                                                VALIDATE("Bin Code",BinCode);
                                                            END;

                                                   CaptionML=[ENU=Bin Code;
                                                              NOR=Lagerplasseringskode;
                                                              SVE=Lagerplatskod] }
    { 320 ;   ;Bin Code (Project Inventory);Code20;OnValidate=VAR
                                                                WMSManagement@1001 : Codeunit 7302;
                                                                Location@1100526200 : Record 14;
                                                                PrefBin@1100525000 : Record 11020629;
                                                                LocCode@1210190000 : Code[10];
                                                              BEGIN
                                                                LocCode := SetLocationForBin;
                                                                IF "Bin Code (Project Inventory)" <> '' THEN
                                                                  WMSManagement.FindBin(LocCode,"Bin Code (Project Inventory)","Variant Code");
                                                                IF Transaction = Transaction::Inventory THEN
                                                                  TESTFIELD("Location Code")
                                                                ELSE
                                                                  TESTFIELD(Deliver, Deliver::Location);
                                                                IF "Bin Code (Project Inventory)" <> '' THEN BEGIN
                                                                  Location.GET(LocCode);
                                                                  Location.TESTFIELD("Bin Mandatory");
                                                                END;

                                                                PrefBin.CheckBinLocationBinding("Project No.",'',LocCode,"Bin Code (Project Inventory)");
                                                              END;

                                                   OnLookup=VAR
                                                              WMSManagement@1002 : Codeunit 7302;
                                                              LocCode@1210190000 : Code[10];
                                                              BinCode@1000 : Code[20];
                                                            BEGIN
                                                              LocCode := SetLocationForBin;
                                                              BinCode := WMSManagement.BinLookUpSpecific(LocCode,"Item No.","Variant Code",'',"Project No.","Service Order No.","Bin Code (Project Inventory)");
                                                              IF BinCode <> '' THEN
                                                                VALIDATE("Bin Code (Project Inventory)",BinCode);
                                                            END;

                                                   CaptionML=[ENU=Bin Code (Project Inventory);
                                                              NOR=Lagerplasseringskode (Prosjektlager);
                                                              SVE=Lagerplatskod (projektlager)] }
    { 350 ;   ;Variant Code        ;Code10        ;TableRelation="Item Variant".Code WHERE (Item No.=FIELD(Item No.));
                                                   OnValidate=BEGIN
                                                                IF "Variant Code" <> '' THEN
                                                                  TESTFIELD("Item No.");
                                                              END;

                                                   CaptionML=[ENU=Variant Code;
                                                              NOR=Variantkode;
                                                              SVE=Variantkod] }
    { 360 ;   ;FSC Type Code       ;Code10        ;TableRelation="FSC Type";
                                                   CaptionML=[ENU=FSC Type Code;
                                                              NOR=FSC Typekode;
                                                              SVE=FSC typkod] }
    { 400 ;   ;Tender Paragraph    ;Text20        ;TableRelation="Project Tender Paragraph"."Tender Paragraph" WHERE (Project No.=FIELD(Project No.),
                                                                                                                      Level=CONST(Tender Paragraph));
                                                   OnValidate=BEGIN
                                                                GWWMgtCU.FormatTenderElement("Tender Paragraph");
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph;
                                                              NOR=Tilbudsavsnitt;
                                                              SVE=Anbudsstycke];
                                                   Description=DP01676 }
    { 405 ;   ;Description Tender Paragraph;Text100;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Tender Paragraph".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Tender Paragraph=FIELD(Tender Paragraph)));
                                                   CaptionML=[ENU=Description Tender Paragraph;
                                                              NOR=Beskrivelse, tilbudsavsnitt;
                                                              SVE=Beskrivning, anbudsparagraf];
                                                   Editable=No }
    { 406 ;   ;Tender Paragraph Text;Text80       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Tender Paragraph Text".Text WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Tender Paragraph=FIELD(Tender Paragraph)));
                                                   CaptionML=[ENU=Tender Paragraph Text;
                                                              NOR=Tilbudsavsnitttekst;
                                                              SVE=Anbudsstycketext];
                                                   Editable=No }
    { 410 ;   ;Tender Paragraph Part;Text20       ;TableRelation="Project Tender Paragraph Part"."Tender Paragraph Part" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                Tender Paragraph=FIELD(Tender Paragraph));
                                                   OnValidate=BEGIN
                                                                GWWMgtCU.FormatTenderElementPart("Tender Paragraph Part");
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph Part;
                                                              NOR=Tilbudsavsnittdel;
                                                              SVE=Anbudsstyckedel];
                                                   Description=DP01676 }
    { 415 ;   ;Descr Tender Paragraph Part;Text100;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Tender Paragraph Part".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                                         Tender Paragraph=FIELD(Tender Paragraph),
                                                                                                                         Tender Paragraph Part=FIELD(Tender Paragraph Part)));
                                                   CaptionML=[ENU=Description Tender Paragraph Part;
                                                              NOR=Beskrivelse, tilbudsavsnittdel;
                                                              SVE=Beskrivning, anbudsparagrafdel];
                                                   Editable=No }
    { 500 ;   ;Recipe Group        ;Code10        ;TableRelation="Recipe Group".No.;
                                                   CaptionML=[ENU=Recipe Group;
                                                              NOR=Maltype;
                                                              SVE=Malltyp];
                                                   Description=DP01090 }
    { 510 ;   ;Recipe              ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Recipe Group));
                                                   CaptionML=[ENU=Recipe;
                                                              NOR=Mal;
                                                              SVE=Mall];
                                                   Description=DP01090 }
    { 520 ;   ;Source Type         ;Option        ;CaptionML=[ENU=Source Type;
                                                              NOR=Kildetype;
                                                              SVE=Ursprungstyp];
                                                   OptionCaptionML=[ENU=" ,Recipe Header,Recipe Line,BOM Header,BOM Line";
                                                                    NOR=" ,Maltittel,Malrad,Stykklistetittel,Stykklisterad";
                                                                    SVE=" ,Mallrubrik,Mallrad,Strukturrubrik,Strukturrad"];
                                                   OptionString=[ ,Recipe Header,Recipe Line,BOM Header,BOM Line] }
    { 530 ;   ;Attached to Line No.;Integer       ;TableRelation=IF (Record Type=CONST(Project)) "Advice Order Line"."Line No." WHERE (Record Type=CONST(Project),
                                                                                                                                       Project No.=FIELD(Project No.))
                                                                                                                                       ELSE IF (Record Type=CONST(ServOrder)) "Advice Order Line"."Line No." WHERE (Record Type=CONST(ServOrder),
                                                                                                                                                                                                                    Service Order No.=FIELD(Service Order No.));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              NOR=Knyttet til linjenr.;
                                                              SVE=Bifogad till radnr];
                                                   Editable=No }
    { 560 ;   ;Part of Line        ;Integer       ;TableRelation=IF (Record Type=CONST(Project)) "Advice Order Line"."Line No." WHERE (Record Type=CONST(Project),
                                                                                                                                       Project No.=FIELD(Project No.))
                                                                                                                                       ELSE IF (Record Type=CONST(ServOrder)) "Advice Order Line"."Line No." WHERE (Record Type=CONST(ServOrder),
                                                                                                                                                                                                                    Service Order No.=FIELD(Service Order No.));
                                                   OnValidate=BEGIN
                                                                DetermineBOMLevel("Part of Line","Level BOM");
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Part of Line;
                                                              SVE=Del av rad] }
    { 565 ;   ;Original Quantity   ;Decimal       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Original Quantity;
                                                              SVE=Ursprungligt antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 570 ;   ;Level BOM           ;Integer       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Level BOM;
                                                              SVE=Niv†struktur];
                                                   Description=Level after exploding BOM-Item;
                                                   Editable=No }
    { 575 ;   ;BOM Item No.        ;Code20        ;TableRelation=Item;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=BOM Item No.;
                                                              SVE=Strukturartikelnr];
                                                   Description=Original Item before exploding BOM }
    { 600 ;   ;Sort Purchase       ;Code150       ;OnValidate=BEGIN
                                                                //DP00884: field enlarged due to extra criteria (100->150)
                                                              END;

                                                   CaptionML=[ENU=Sort Purchase;
                                                              NOR=Sorter Innkj›p;
                                                              SVE=Sortera ink”p];
                                                   Description=DP00137;
                                                   Editable=No }
    { 700 ;   ;Subcontracting Activity;Code10     ;TableRelation="Subcontracting Activity".Code;
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO("Subcontracting Activity"));  //DP01958a
                                                              END;

                                                   CaptionML=ENU=Subcontracting Activity;
                                                   Description=DP01492-2 }
    { 800 ;   ;Record Type         ;Option        ;CaptionML=[ENU=Record Type;
                                                              NOR=Posttype;
                                                              SVE=Posttyp];
                                                   OptionCaptionML=[ENU=Project,Service Order,G/L Account;
                                                                    NOR=Prosjekt,Serviceordre,Finanskonto;
                                                                    SVE=Projekt,Serviceorder,Redovisningskonto];
                                                   OptionString=Project,ServOrder,G/L Account;
                                                   Description=DP01378;
                                                   Editable=No }
    { 810 ;   ;Service Order No.   ;Code20        ;TableRelation=IF (Record Type=CONST(ServOrder)) "Service Order";
                                                   OnValidate=VAR
                                                                ServiceOrder@1100525000 : Record 11012823;
                                                              BEGIN
                                                                IF "Service Order No." <> '' THEN
                                                                  ServiceOrder.GET("Service Order No.");
                                                                "Base Service Order No." := ServiceOrder."Base Service Order No.";
                                                                "Purchaser Code" := GetDefaultPurchaser('', "Service Order No.");
                                                                IF "Service Order No." <> xRec."Service Order No." THEN BEGIN
                                                                  "Plant Location" := '';
                                                                  FillDefaultPlantCompany;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr.;
                                                              SVE=Serviceordernr] }
    { 811 ;   ;Description Service Order;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Description WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Description Service Order;
                                                              NOR=Serviceordrebeskrivelse;
                                                              SVE=Serviceorderbeskrivning];
                                                   Editable=No }
    { 815 ;   ;Service Order Status;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Status WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Service Order Status;
                                                              NOR=Serviceordrestatus;
                                                              SVE=Serviceorderstatus];
                                                   OptionCaptionML=[ENU=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                                    NOR=pne,,Under behandling,Teknisk ferdig,Administrativt ferdig,Ferdig,Avbrutt;
                                                                    SVE=™ppna,,Under behandling,Tekniskt f„rdig,Administrativt f„rdig,F„rdig,Avbrutet];
                                                   OptionString=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                   Editable=No }
    { 840 ;   ;Shipping Detail Line;Integer       ;CaptionML=[ENU=Shipping Detail Line;
                                                              NOR=Forsendelsesdetaljrad;
                                                              SVE=Leveransdetaljrad] }
    { 850 ;   ;Service Contract No.;Code20        ;TableRelation=IF (Record Type=CONST(ServOrder)) Service-Contract;
                                                   OnValidate=BEGIN
                                                                StrategicPurchMgt.FindContractForAdviceOrder(Rec);
                                                              END;

                                                   CaptionML=[ENU=Service Contract No.;
                                                              NOR=Servicekontraktnr;
                                                              SVE=Servicekontraktnr];
                                                   Editable=No }
    { 851 ;   ;Service Contract Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Contract.Description WHERE (No.=FIELD(Service Contract No.)));
                                                   CaptionML=[ENU=Service Contract Description;
                                                              SVE=Servicekontraktsbeskrivning];
                                                   Description=C044123;
                                                   Editable=No }
    { 855 ;   ;Service Location No.;Code20        ;TableRelation=IF (Record Type=CONST(ServOrder)) "Service Location".No.;
                                                   CaptionML=[ENU=Service Location No.;
                                                              SVE=Serviceplatsnr];
                                                   Description=C044123;
                                                   Editable=No }
    { 856 ;   ;Service Location Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location".Description WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Service Location Description;
                                                              SVE=Serviceplatsbeskrivning];
                                                   Description=C044123;
                                                   Editable=No }
    { 860 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Global dimensjon 1 - kode;
                                                              SVE=Global dimension 1 kod];
                                                   CaptionClass='1,1,1' }
    { 870 ;   ;Additional Cost (Service);Boolean  ;OnValidate=BEGIN
                                                                ValidateAdditionalCost;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Service);
                                                              NOR=Tilleggskoster (service);
                                                              SVE=Till„ggskostnader (service)] }
    { 871 ;   ;Add. Cost Changed Manually;Boolean ;CaptionML=ENU=Add. Cost Changed Manually }
    { 880 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   OnValidate=BEGIN
                                                                ValidateCostComponent;
                                                                IF CurrFieldNo <> FIELDNO("Cost Component") THEN BEGIN
                                                                  CostCompRec.CheckDefaultCostComponent("Service Order No.", "Cost Component", '', "Cost Type"+1,
                                                                    "Additional Cost (Service)");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadskomponent] }
    { 890 ;   ;Scheme Code         ;Code15        ;CaptionML=[ENU=Scheme Code;
                                                              NOR=Plankode;
                                                              SVE=Plankod] }
    { 900 ;   ;E-Plan Item         ;Code50        ;TableRelation="E-Plan Item".No.;
                                                   CaptionML=[ENU=E-Plan Item;
                                                              NOR=E-Plan-artikkel;
                                                              SVE=E-Plan-artikel];
                                                   Editable=No }
    { 910 ;   ;Comments for Logistics;Text50      ;CaptionML=[ENU=Comments for Logistics;
                                                              NOR=Kommentarer for logistikk;
                                                              SVE=Kommentarer f”r logistik] }
    { 920 ;   ;Plot No.            ;Code10        ;TableRelation=Plot."Plot No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Plot No.;
                                                              NOR=Tegningnr;
                                                              SVE=Ritningnr] }
    { 940 ;   ;Open Approval Entry ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Approval Entry" WHERE (Table ID=CONST(11012055),
                                                                                             Document Line No.=FIELD(Line No.),
                                                                                             Project No.=FIELD(Project No.),
                                                                                             Service Order No.=FIELD(Service Order No.),
                                                                                             Status=FILTER(Open|Created)));
                                                   CaptionML=[ENU=Open Approval Entry;
                                                              SVE=Godk„nnanderader];
                                                   Editable=No }
    { 950 ;   ;OLDConsent Lines Serv. Avail;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("Approval Entry" WHERE (Table ID=CONST(11012055),
                                                                                             Document Line No.=FIELD(Line No.),
                                                                                             Project No.=FIELD(Project No.),
                                                                                             Service Order No.=FIELD(Service Order No.),
                                                                                             Status=FILTER(Open|Created)));
                                                   CaptionML=[ENU=Consent Lines Service Available;
                                                              NOR=Attestrader, Servicetilgjengelighet;
                                                              SVE=Godk„nnanderader, servicetillg„nglighet];
                                                   Editable=No }
    { 955 ;   ;Yard No.            ;Code20        ;TableRelation=IF (Record Type=CONST(Project)) "Assembly Yard Number Object"."Yard No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Yard No.;
                                                              NOR=Plassnr;
                                                              SVE=Platsnr];
                                                   Description=Engineering }
    { 960 ;   ;Entity Type         ;Option        ;OnValidate=BEGIN
                                                                ValidateEntityType;
                                                              END;

                                                   CaptionML=[ENU=Entity Type;
                                                              NOR=Enhetstype;
                                                              SVE=Enhetstyp];
                                                   OptionCaptionML=[ENU=None,Cable,Device,Extra Need,Cable Transit,,,,,Position;
                                                                    NOR=Ingen,Kabel,Enhet,Ekstra behov,Kabeloverf›ring,,,,,Posisjon;
                                                                    SVE=Ingen,Kabel,Anordning,Extra behov,Kabel”verf”ring,,,,,Position];
                                                   OptionString=None,Cable,Device,ExtraNeed,CableTransit,,,,,Position;
                                                   Description=Engineering }
    { 970 ;   ;System No.          ;Code20        ;TableRelation=IF (Record Type=CONST(Project)) "Assembly Yard Number Object"."System No." WHERE (Project No.=FIELD(Project No.),
                                                                                                                                                   Yard No.=FIELD(Yard No.),
                                                                                                                                                   Entity Type=FIELD(Entity Type));
                                                   CaptionML=[ENU=System No.;
                                                              NOR=Systemnr;
                                                              SVE=Systemnr];
                                                   Description=Engineering }
    { 980 ;   ;Entity No.          ;Code20        ;TableRelation=IF (Record Type=CONST(Project)) "Assembly Yard Number Object"."Entity No." WHERE (Project No.=FIELD(Project No.),
                                                                                                                                                   Yard No.=FIELD(Yard No.),
                                                                                                                                                   Entity Type=FIELD(Entity Type),
                                                                                                                                                   System No.=FIELD(System No.));
                                                   OnValidate=BEGIN
                                                                SetElementNo;
                                                              END;

                                                   CaptionML=[ENU=Entity No.;
                                                              NOR=Enhetsnr;
                                                              SVE=Enhetsnr];
                                                   Description=Engineering }
    { 990 ;   ;Cable Transit Pos.  ;Option        ;CaptionML=[ENU=Cable Transit Postion;
                                                              NOR=Kabeloverf›ringsposisjon;
                                                              SVE=Kabel”verf”ringsposition];
                                                   OptionCaptionML=[ENU=" ,From Side,To Side";
                                                                    NOR=" ,Fra side,Til side";
                                                                    SVE=" ,Fr†n sida,Till sida"];
                                                   OptionString=[ ,From,To];
                                                   Description=Engineering;
                                                   Editable=No }
    { 1000;   ;Contract Type       ;Option        ;CaptionML=[ENU=Contract Type;
                                                              NOR=Kontraktstype;
                                                              SVE=Kontraktstyp];
                                                   OptionCaptionML=[ENU=No Contract,Contract,Contract with Discount Terms,General Blanket Order,Project Blanket Order,Service Blanket Order;
                                                                    NOR=Ingen kontrakt,Kontrakt,Kontrakt med Rabattvilk†r,Generell rammeordre,Prosjektrammeordre,Servicerammeordre;
                                                                    SVE=Inget kontrakt,Kontrakt,Kontrakt med rabattvillkor,Allm„n avropsorder,Projektavropsorder,Serviceavropsorder];
                                                   OptionString=No Contract,Contract,Contract with Discount Terms,General Blanket Order,Project Blanket Order,Service Blanket Order;
                                                   Editable=No }
    { 1002;   ;Process Status Filter;Option       ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Process Status Filter;
                                                              NOR=Prosesstatusfilter;
                                                              SVE=Processtatusfilter];
                                                   OptionCaptionML=[ENU=Open,Partly Processed,Released,Cancelled,Processed;
                                                                    NOR=pen,delvis behandlet,Frigitt,Avbrutt,Behandlet;
                                                                    SVE=™ppen,Delvis behandlad,Sl„ppt,Avbruten,Behandlad];
                                                   OptionString=Open,Partly Processed,Released,Cancelled,Processed }
    { 1010;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Main Project No.;
                                                              NOR=Hovedprosjektnr.;
                                                              SVE=Huvudprojektnr];
                                                   Editable=No }
    { 1020;   ;Created by Employee No.;Code20     ;TableRelation=IF (Created by Employee Company=FILTER('')) Employee;
                                                   CaptionML=[ENU=Created by Employee No.;
                                                              NOR=Opprettet av ansatt nr.;
                                                              SVE=Skapat av anst„lld nr];
                                                   Description=(Mobile);
                                                   Editable=No }
    { 1021;   ;Created by Employee Company;Text30 ;TableRelation=Company;
                                                   CaptionML=[ENU=Created by Employee Company;
                                                              SVE=Skapat av anst„lld f”retag];
                                                   Description=Mobile;
                                                   Editable=No }
    { 1022;   ;Created by Work Order No.;Code20   ;TableRelation="Work Order";
                                                   CaptionML=ENU=Created by Work Order No.;
                                                   Description=Mobile;
                                                   Editable=No }
    { 1025;   ;Purchase by Field Service;Boolean  ;CaptionML=ENU=Purchase by Field Service }
    { 1030;   ;Decentral Created   ;Boolean       ;CaptionML=[ENU=Decentral Created;
                                                              NOR=Perifer er opprettet;
                                                              SVE=Perifer „r skapad];
                                                   Editable=No }
    { 1035;   ;Decentral Created Guid;Text32      ;CaptionML=ENU=Decentral Created Guid }
    { 1040;   ;Base Service Order No.;Code20      ;TableRelation="Service Order".No.;
                                                   CaptionML=[ENU=Base Service Order No.;
                                                              NOR=Baseserviceordrenr;
                                                              SVE=Basserviceordernr];
                                                   Editable=No }
    { 1050;   ;Order Address Code  ;Code10        ;TableRelation="Order Address".Code WHERE (Vendor No.=FIELD(Vendor));
                                                   CaptionML=[ENU=Order Address Code;
                                                              NOR=Bestillingsadressekode;
                                                              SVE=Ink”psadresskod] }
    { 1200;   ;Glazing Service Call No.;Code20    ;TableRelation="Glazing Service Call";
                                                   CaptionML=[ENU=Glazing Service Call No.;
                                                              NOR=Servicesamtalenr. for Innglassing;
                                                              SVE=Servicesamtalsnr f”r inglasning];
                                                   Editable=No }
    { 1210;   ;Glazing Service Call Line No.;Integer;
                                                   TableRelation="Glazing Service Call Line"."Line No." WHERE (Glazing Service Call No.=FIELD(Glazing Service Call No.));
                                                   CaptionML=[ENU=Glazing Service Call Line No.;
                                                              NOR=Servicesamtalsradnr. for Innglassing;
                                                              SVE=Servicesamtalsradnr f”r inglasning];
                                                   Editable=No }
    { 1215;   ;Plant Company       ;Text30        ;TableRelation=Company;
                                                   OnValidate=VAR
                                                                PlantMgtCompany@1100525001 : Record 11020586;
                                                                TmpPlantMgtCompany@1100525002 : TEMPORARY Record 11020586;
                                                              BEGIN
                                                                IF "Plant Company" = COMPANYNAME THEN
                                                                  "Plant Company" := '';
                                                                IF "Plant Company" <> '' THEN BEGIN
                                                                  PlantMgtCompany.GET("Plant Company");
                                                                  CASE "Record Type" OF
                                                                    "Record Type"::Project:
                                                                      BEGIN
                                                                        TESTFIELD("Project No.");
                                                                        IF PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', FALSE) = 0 THEN
                                                                          ERROR(Text008, FIELDCAPTION("Plant Location"),
                                                                            FIELDCAPTION("Project No."), "Project No.", FIELDCAPTION("Plant Company"), "Plant Company");
                                                                      END;
                                                                    "Record Type"::ServOrder:
                                                                      BEGIN
                                                                        TESTFIELD("Service Order No.");
                                                                        IF PlantMgtCompany.GetPlantCompaniesForService("Service Order No.", TmpPlantMgtCompany, '', FALSE) = 0 THEN
                                                                          ERROR(Text008, FIELDCAPTION("Plant Location"),
                                                                            FIELDCAPTION("Service Order No."), "Service Order No.", FIELDCAPTION("Plant Company"), "Plant Company");
                                                                      END;
                                                                  ELSE
                                                                    FIELDERROR("Record Type");
                                                                  END;
                                                                END;
                                                                IF "Plant Company" <> xRec."Plant Company" THEN BEGIN
                                                                  "Plant Location" := '';
                                                                  "Plant Type" := '';
                                                                END;
                                                                IF "Plant Location" = '' THEN
                                                                  FillDefaultPlantLocation;
                                                                IF ("Plant Type" <> '') AND ("Plant Company" <> '') AND (Transaction <> Transaction::Plant) THEN
                                                                  Transaction := Transaction::Plant;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantCompany;
                                                            END;

                                                   CaptionML=[ENU=Plant Company;
                                                              NOR=Maskinselskap;
                                                              SVE=Maskinf”retag];
                                                   Description=Only used for Transaction is "Plant" (for Plant Request) }
    { 1220;   ;Plant Type          ;Code20        ;TableRelation=IF (Plant Company=FILTER('')) "Plant Type";
                                                   OnValidate=VAR
                                                                PlantType@1210190000 : Record 11012551;
                                                              BEGIN
                                                                IF "Plant Type" = '' THEN
                                                                  EXIT;
                                                                IF "Plant Company" <> '' THEN
                                                                  PlantType.CHANGECOMPANY("Plant Company");
                                                                PlantType.GET("Plant Type");
                                                                IF ("Plant Type" <> xRec."Plant Type") OR (Description = '') THEN BEGIN
                                                                  Description := PlantType.Description;
                                                                  "Unit of Measure" := PlantType."Unit of Measure";
                                                                  "Cost Object" := PlantType."Cost Object";
                                                                  "Cost Type" := "Cost Type"::Plant;
                                                                  "Item No." := '';
                                                                  "Basic Item" := '';
                                                                  Manufacturer := '';
                                                                  "Trade Item" := '';
                                                                  "Vendor (Trade Item)" := '';
                                                                  "Price (LCY)" := 0;
                                                                  "Gross Price (LCY)" := 0;
                                                                  "Discount %" := 0;
                                                                  IF (xRec."Plant Type" = '') OR
                                                                    ((Transaction <> Transaction::Plant) AND (Transaction <> Transaction::Purchase)) OR
                                                                    ((Transaction = Transaction::Purchase) AND ("Plant Company" <> ''))
                                                                  THEN
                                                                    VALIDATE(Transaction, Transaction::Plant);
                                                                  IF Transaction <> Transaction::Purchase THEN BEGIN
                                                                    Vendor := '';
                                                                    VALIDATE("Price (LCY)");
                                                                  END ELSE BEGIN
                                                                    FillPlantPurchOrRentPrefVendor();
                                                                    GetPlantPurchaseOrRentRate();
                                                                  END;
                                                                  OperationCodebyItem.CheckItemOperationCode("Vendor (Trade Item)", "Trade Item", "Item Operation Code");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantType;
                                                            END;

                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp];
                                                   Description=Only used for Transaction is "Plant" (for Plant Request) }
    { 1230;   ;Plant Location      ;Code20        ;TableRelation=IF (Plant Company=FILTER('')) "Plant Location";
                                                   OnValidate=VAR
                                                                PlantLocation@1210190000 : Record 11012554;
                                                                PlantMgtCompany@1100529000 : Record 11020586;
                                                              BEGIN
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  IF "Plant Company" = '' THEN
                                                                    PlantMgtCompany.GET(COMPANYNAME)
                                                                  ELSE
                                                                    PlantLocation.CHANGECOMPANY("Plant Company");
                                                                  PlantLocation.GET("Plant Location");
                                                                  CASE "Record Type" OF
                                                                    "Record Type"::Project:
                                                                      BEGIN
                                                                        TESTFIELD("Project No.");
                                                                        IF PlantLocation."Project No." <> '' THEN
                                                                          PlantLocation.TESTFIELD("Project No.", "Project No.")
                                                                        ELSE BEGIN
                                                                          PlantLocation.TESTFIELD("Customer No.");
                                                                          PlantLocation.TESTFIELD("Service Order No.", '');
                                                                          PlantLocation.TESTFIELD("Employee No.", '');
                                                                          PlantLocation.TESTFIELD("Plant Type", '');
                                                                        END;
                                                                      END;
                                                                    "Record Type"::ServOrder:
                                                                      BEGIN
                                                                        TESTFIELD("Service Order No.");
                                                                        IF PlantLocation."Service Order No." <> '' THEN
                                                                          PlantLocation.TESTFIELD("Service Order No.", "Service Order No.")
                                                                        ELSE BEGIN
                                                                          PlantLocation.TESTFIELD("Customer No.");
                                                                          PlantLocation.TESTFIELD("Project No.", '');
                                                                          PlantLocation.TESTFIELD("Employee No.", '');
                                                                          PlantLocation.TESTFIELD("Plant Type", '');
                                                                        END;
                                                                      END;
                                                                  ELSE
                                                                    FIELDERROR("Record Type");
                                                                  END;
                                                                  PlantLocation.TESTFIELD(Depot, FALSE);
                                                                  IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
                                                                    PlantLocation.TESTFIELD("Company Name", '')
                                                                  ELSE
                                                                    PlantLocation.TESTFIELD("Company Name", COMPANYNAME);
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantLocation;
                                                            END;

                                                   CaptionML=[ENU=Plant Location;
                                                              NOR=Maskinplassering;
                                                              SVE=Maskinutplacering];
                                                   Description=Only used for Transaction is "Plant" (for Plant Request) }
    { 1240;   ;Expected return on  ;Date          ;CaptionML=ENU=Expected return on (Plant) }
    { 1250;   ;Logistics on Component Level;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item."Logistics on Component Level" WHERE (No.=FIELD(Item No.)));
                                                   CaptionML=[ENU=Logistics on Component Level;
                                                              NOR=Logistikk p† komponentniv†;
                                                              SVE=Logistik p† komponentniv†];
                                                   Editable=No }
    { 1260;   ;Item Category Code  ;Code20        ;TableRelation="Item Category";
                                                   CaptionML=[ENU=Item Category Code;
                                                              NOR=Varekategorikode;
                                                              SVE=Artikelkategorikod] }
    { 1270;   ;Project Planning Activity No.;Code30;
                                                   TableRelation="Project Planning Activity".No. WHERE (Project No.=FIELD(Project No.),
                                                                                                        Type=CONST(Activity));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Project Plan. Act. Description");
                                                              END;

                                                   CaptionML=[ENU=Project Planning Activity No.;
                                                              NOR=Aktivitetsnummer for prosjektplanlegging;
                                                              SVE=Projektplaneringsaktivitetsnr] }
    { 1271;   ;Project Plan. Act. Description;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Planning Activity".Description WHERE (No.=FIELD(Project Planning Activity No.)));
                                                   CaptionML=[ENU=Project Planning Activity Description;
                                                              NOR=Beskrivelse av prosjektplanleggingsaktivitet;
                                                              SVE=Beskrivning av projektplaneringsaktivitet];
                                                   Editable=No }
    { 1280;   ;Supplying Company Inventory;Text30 ;TableRelation=Company;
                                                   OnValidate=BEGIN
                                                                IF ("Supplying Company Inventory" = COMPANYNAME) OR
                                                                   ("Cost Type" <> "Cost Type"::Material) OR
                                                                   ("Item No." = '') OR
                                                                   (Transaction = Transaction::Plant)
                                                                THEN
                                                                  "Supplying Company Inventory" := '';

                                                                IF ("Supplying Company Inventory" <> xRec."Supplying Company Inventory") AND ("Supplying Company Inventory" <> '') THEN BEGIN  //C048800
                                                                  "Location Code" := '';
                                                                  "Bin Code" := '';
                                                                  "Bin Code (Project Inventory)" := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Supplying Company Inventory;
                                                              NOR=Leverende selskap Lager;
                                                              SVE=Levererande f”retag lager] }
    { 1290;   ;Delivery Time       ;Time          ;CaptionML=[ENU=Delivery Time;
                                                              NOR=Leveransetid;
                                                              SVE=Leveranstid] }
    { 1300;   ;Vendor No. (Item Card);Code20      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item."Vendor No." WHERE (No.=FIELD(Item No.)));
                                                   TableRelation=Vendor;
                                                   CaptionML=ENU=Vendor No. (Item Card);
                                                   Editable=No }
    { 1310;   ;Vendor Item No. (Item Card);Text20 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item."Vendor Item No." WHERE (No.=FIELD(Item No.)));
                                                   CaptionML=ENU=Vendor Item No. (Item Card);
                                                   Editable=No }
    { 1320;   ;Work Order No.      ;Code20        ;TableRelation="Work Order";
                                                   OnValidate=VAR
                                                                WorkOrder@1100528600 : Record 11229279;
                                                                Resource@1100528601 : Record 11229278;
                                                              BEGIN
                                                                TESTFIELD("Cost Type", "Cost Type"::Subcontracting);
                                                                WorkOrder.GET("Work Order No.");
                                                                WorkOrder.TESTFIELD("Resource No.");
                                                                Resource.GET(WorkOrder."Resource No.");
                                                                Resource.TESTFIELD(Type, Resource.Type::Subcontractor);
                                                                IF Resource."Source No." <> Vendor THEN
                                                                  MESSAGE(Text015, Vendor, Resource."Source No.", Resource.TABLECAPTION);
                                                                EvaluateStartDate("Receipt Date");
                                                              END;

                                                   CaptionML=[ENU=Work Order No.;
                                                              SVE=Serviceordernr];
                                                   Editable=No }
    { 1330;   ;Price History 0 Exists;Boolean     ;CaptionML=ENU=Price History 0 Exists;
                                                   Editable=No }
    { 1340;   ;Consented Date-Time ;DateTime      ;CaptionML=[ENU=Consented Date-Time;
                                                              SVE=Godk„nd Datum-Tid];
                                                   Editable=No }
    { 1350;   ;Project Object No.  ;Code20        ;TableRelation="Project Object";
                                                   CaptionML=ENU=Project Object No. }
    { 1360;   ;G/L Account         ;Code20        ;TableRelation="G/L Account";
                                                   CaptionML=[ENU=G/L Account;
                                                              NOR=Hovedbokskonto;
                                                              SVE=Redovisningskonto];
                                                   Description=DP01378 }
    { 1370;   ;Item Operation Code ;Code20        ;TableRelation="Operation Code by Item"."Item Operation Code" WHERE (Vendor (Trade Item)=FIELD("Vendor (Trade Item)"),
                                                                                                                       Item Code=FIELD(Trade Item));
                                                   CaptionML=ENU=Item Operation Code }
    { 1380;   ;Item Operation Source Line No.;Integer;
                                                   CaptionML=ENU=Item Operation Source Line No.;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1400;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                CheckCurrencyAgreement;
                                                                IF "Currency Agreement" THEN BEGIN  //C054524
                                                                  VALIDATE("Gross Price (FCY)");
                                                                  "Gross Price (LCY)" := ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);
                                                                END ELSE BEGIN
                                                                  VALIDATE("Gross Price (LCY)");
                                                                  "Gross Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Gross Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);
                                                                END;
                                                                CalculateTotal;
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod];
                                                   Description=DP00884 }
    { 1401;   ;Currency Agreement  ;Boolean       ;CaptionML=[ENU=Currency Agreement;
                                                              SVE=Valuta avtal];
                                                   Description=DP00884 }
    { 1410;   ;Price (FCY)         ;Decimal       ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Price;
                                                              NOR=Pris;
                                                              SVE=Pris];
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   AutoFormatType=2 }
    { 1420;   ;Gross Price (FCY)   ;Decimal       ;OnValidate=VAR
                                                                SaveGrossPrice@1100525000 : Decimal;
                                                              BEGIN
                                                                //C026956.sn
                                                                //SetSkipValidateFCY(TRUE);
                                                                SaveGrossPrice := "Gross Price (FCY)";
                                                                VALIDATE("Gross Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                                IF CurrFieldNo = FIELDNO("Gross Price (FCY)") THEN
                                                                  "Gross Price (FCY)" := SaveGrossPrice;  //function CalculateDiscount cleared input on validate GrossPrice
                                                                //C026956.en
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              NOR=Bruttopris;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   AutoFormatType=2 }
    { 1430;   ;Alternative Price (FCY) OLD;Decimal;CaptionML=ENU=Alternative Price OLD;
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 1440;   ;Sales Price (FCY)   ;Decimal       ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Sales Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Sales Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Sales Price;
                                                              NOR=Salgspris;
                                                              SVE=F”rs„ljningspris];
                                                   BlankZero=Yes;
                                                   Description=DP00884;
                                                   AutoFormatType=2 }
    { 1450;   ;Amount (FCY)        ;Decimal       ;CaptionML=[ENU=Amount;
                                                              NOR=Bel›p;
                                                              SVE=Belopp];
                                                   Description=DP00884;
                                                   Editable=No }
    { 1480;   ;Plant Request No.   ;Code20        ;CaptionML=[ENU=Plant Request No.;
                                                              NOR=Maskinforesp›rsel Nr.;
                                                              SVE=Maskinf”rfr†gan nr];
                                                   Editable=No }
    { 1500;No ;Reserved Breman start;Code20       ;CaptionML=;
                                                   Description=RESERVED }
    { 1515;No ;Reserved Breman end ;Code20        ;CaptionML=;
                                                   Description=RESERVED }
    { 1520;   ;Original Vendor (Trade Item);Code15;CaptionML=ENU=Original Vendor (Trade Item);
                                                   Editable=No }
    { 1530;   ;SUP Recording Line No.;Integer     ;TableRelation="SUP Recording Line"."Line No." WHERE (Service Order No.=FIELD(Service Order No.));
                                                   CaptionML=ENU=SUP Recording Line No.;
                                                   Editable=No }
    { 11128000;;System No. Assembly Order;Text30  ;CaptionML=[ENU=System No. Assembly Order;
                                                              SVE=Systemnr monteringsorder] }
    { 11128001;;Transaction (Secondary);Option    ;OnValidate=BEGIN
                                                                // ORANGO.LP 4PSSE CER GAP 13
                                                                IF "Transaction (Secondary)" = "Transaction (Secondary)"::Purchase THEN
                                                                  VALIDATE(Transaction, Transaction::Purchase)
                                                                ELSE
                                                                  VALIDATE(Transaction, Transaction::Plant);
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Transaction (Secondary);
                                                              SVE=Transaktion (sekund„r)];
                                                   OptionCaptionML=[ENU=Purchase,Inventory,Assembly,Transfer;
                                                                    SVE=Ink”p,Lager,Montering,™verf”ring];
                                                   OptionString=Purchase,Inventory,Assembly,Transfer }
    { 11128002;;Blocked Item       ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item.Blocked WHERE (No.=FIELD(Item No.)));
                                                   CaptionML=[ENU=Blocked Item;
                                                              SVE=Sp„rrad artikel];
                                                   Editable=No }
    { 11128003;;Transfer From Location;Code20     ;TableRelation=Location;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Transfer From Location;
                                                              SVE=™verf”r fr†n lager] }
    { 11128004;;Home Location      ;Code20        ;TableRelation=Location;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Home Location;
                                                              SVE=Eget lager] }
    { 11128005;;Assembly Order No. ;Code20        ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Assembly Order No.;
                                                              SVE=Monteringsordernr];
                                                   Editable=No }
    { 11128006;;Pick Order No.     ;Code20        ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Pick Order No.;
                                                              SVE=Plockordernr];
                                                   Editable=No }
    { 11128007;;Transfer Order No. ;Code20        ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Transfer Order No.;
                                                              SVE=™verf”ringsordernr];
                                                   Editable=No }
    { 11128008;;Rapid Order        ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Rapid Order;
                                                              SVE=Snabborder] }
    { 11128009;;Document Sent By   ;Option        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Document Sent By;
                                                   OptionCaptionML=ENU=Manually,E-mail,File;
                                                   OptionString=Manually,E-mail,File }
  }
  KEYS
  {
    {    ;Record Type,Project No.,Service Order No.,G/L Account,Line No.;
                                                   Clustered=Yes }
    {    ;Project No.,Element,Extension Contract,Item No.,Manufacturer,Basic Item,Vendor (Trade Item),Trade Item }
    {    ;Project No.,Service Order No.,Deliver,Ship To Location,Sort Location,Sort Shelf }
    {    ;Item No.,Manufacturer,Basic Item,Vendor (Trade Item),Trade Item,Project No.,Element,Extension Contract }
    {    ;Processed,Item No.,Manufacturer,Basic Item,Vendor (Trade Item),Trade Item,Project No.,Element,Extension Contract }
    {    ;Purchase Route Reference                 }
    {    ;Receipt Date                             }
    {    ;Item No.,Location Code,Process Status,Receipt Date;
                                                   SumIndexFields=Quantity (Advice) }
    {    ;Base Service Order No.                   }
    {    ;Project No.,Plant Location,Receipt Date  }
    {    ;Item No.,Description 2,Project No.,Service Order No. }
    {    ;Sort Purchase                            }
    {    ;Service Order No.                        }
    {    ;Project No.,Element,Item No.,Transaction,Processed,Yard No.,Entity Type,System No.,Entity No. }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@11012012 : TextConst 'ENU=Proposal is greater then budget;NOR=Forslaget er st›rre enn budsjettet;SVE=F”rslaget „r st”rre „n budgeten';
      Text001@1100525010 : TextConst 'ENU=%1 ''%2'' has %3 ''%4''. Material Requirement can''t be generated.;NOR=%1 ''%2'' har %3 ''%4''. Materialbehov kan ikke genereres.;SVE=%1 ''%2'' har %3 ''%4''. Materialbehov kan inte genereras.';
      Text002@1100525011 : TextConst 'ENU=Material Requirement is already present for %1 ''%2''. This will be deleted first.\Continue?;NOR=Materialbehov finnes allerede for %1 ''%2''. Dette vil fjernes f›rst.\Vil du fortsette?;SVE=Materialbehov finns redan f”r %1 ''%2''. Detta kommer att tas bort f”rst.\Vill du forts„tta?';
      Text003@11012015 : TextConst 'ENU=%1 not filled.;NOR=%1 er ikke fylt ut.;SVE=%1 har inte fyllts i.';
      InventorySetup@1100525007 : Record 313;
      AdviceRec@11012000 : Record 11012055;
      ProjRec@1210190003 : Record 11072003;
      ItemRec@11012001 : Record 27;
      BasicItemRec@11012002 : Record 11012316;
      TradeItemRec@11012003 : Record 11012317;
      CostCompRec@1100525004 : Record 11012012;
      ServLocRec@1210190012 : Record 11012801;
      ServContrRec@1210190013 : Record 11012812;
      ServOrderRec@1100485000 : Record 11012823;
      ServOrderLocRec@1100525006 : Record 11071688;
      ProjElemRec@11012006 : Record 11012010;
      LocRec@11012010 : Record 14;
      ProjLocRec@11012011 : Record 11012011;
      DimValRec@1210190008 : Record 349;
      PurchSetup@1210190009 : Record 312;
      ExtensionContract@1210190002 : Record 11012004;
      OperationCodebyItem@1100529600 : Record 11229436;
      DimMgt@1210190007 : Codeunit 408;
      ElementFormat@1210190005 : Codeunit 11012022;
      ValidateCu@1210190004 : Codeunit 11012033;
      gFrom4PSMobile@1100525000 : Boolean;
      ItemTypeOpt@1210190006 : 'Item,Basic Item,Trade Item,Trade Vendor';
      Text005@1210190010 : TextConst 'ENU=Inventory Stock sufficient for Item %1, but not present on Location %2;NOR=Lagerbeholdning tilstrekkelig for artikkel %1, men finnes ikke p† lokasjon %2;SVE=Lager tillr„ckligt f”r artikel %1, men finns inte p† plats %2';
      UserCode@1210190011 : Code[50];
      CalendarMgmt@1100485013 : Codeunit 7600;
      CalChange@1100485015 : Record 11072016;
      StrategicPurchMgt@1100525001 : Codeunit 11020211;
      GWWMgtCU@1100525003 : Codeunit 11012163;
      Vend@1100525005 : Record 23;
      DPA_Management@1100000999 : Codeunit 11012783;
      Text006@1100529001 : TextConst 'ENU="''%1'' niet present in %2 ''%3'' "';
      Text007@1100525012 : TextConst 'ENU=%1 Material Requirement lines generated.;NOR=%1 Materialbehovsrader er generert.;SVE=%1 materialbehovsrader har genererats.';
      Text008@1100529000 : TextConst 'ENU=There is no %1 of %2 ''%3'' present in %4 ''%5''.';
      Text009@1100525013 : TextConst 'ENU=Total Amount value 0, nothing to divide;NOR=Totalbel›psverdi 0, ingenting † dele;SVE=Totalbeloppsv„rde 0, inget att dela';
      Text010@1100525009 : TextConst 'ENU=Agreed Amount value 0 not allowed;NOR=Et avtalt bel›p kan ikke ha verdien 0;SVE=Ett avtalat belopp kan inte ha v„rdet 0';
      Text011@1100525015 : TextConst 'ENU=Advice Order Line is reopend;NOR=Bestillingsunderlagsraden er gjen†pnet;SVE=Best„llningsunderlagsraden har ”ppnats p† nytt';
      CalledFromCompressingLines@1100526100 : Boolean;
      Text012@1210190001 : TextConst 'ENU=can not be %1;NOR=kan ikke v‘re %1.;SVE=kan inte vara %1.';
      Text013@1100525016 : TextConst 'ENU=First select lines.;NOR=Velg rader f›rst.;SVE=V„lj f”rst rader.';
      Text014@1100528800 : TextConst 'ENU=Receipt Date is a free day;NOR=Kvitteringsdato er en fridag';
      Text015@1100528600 : TextConst 'ENU=Vendor (%1) doesn''t match Subcontractor (%2) om %3';
      SkipValidateFCY@1100525002 : Boolean;
      ProjectCurrencyExchangeRate@1100525008 : Record 11020628;
      RecalcReceiptDate@1100525014 : Boolean;
      GLAccount@1100528900 : Record 15;
      Text017@1100528201 : TextConst 'ENU=This document can only be released when the approval process is complete.;NOR=Dette dokumentet kan f›rst frigis n†r godkjenningsprosessen er fullf›rt.;SVE=Det h„r dokumentet kan inte sl„ppas f”rr„n godk„nnandeprocessen har slutf”rts.';
      CheckVendorPrice@1100528500 : Boolean;
      Text018@1100528200 : TextConst 'ENU=The Process Status can only be modified when the approval process is complete.';
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      CheckField@1100525017 : Boolean;

    PROCEDURE InitRecord@1100485009();
    VAR
      ProjSetup@1100525000 : Record 315;
      Job@1100527650 : Record 11072003;
    BEGIN
      ProjSetup.GET;
      CLEAR(xRec.Deliver);
      "Purchaser Code" := GetDefaultPurchaser("Project No.", "Service Order No.");
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        IF ProjRec.GET("Project No.") THEN BEGIN
          CASE ProjRec.Deliver OF
            ProjRec.Deliver::Location:
              VALIDATE(Deliver, Deliver::Location);
            ProjRec.Deliver::"Project Location":
              VALIDATE(Deliver, Deliver::"Project Location");
          END;
        END;
      END;
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        IF ServOrderRec.GET("Service Order No.") THEN BEGIN
          IF NOT ServLocRec.GET(ServOrderRec."Service Location No.") THEN ServLocRec.INIT;
          IF (ServOrderRec."Service Location No." = '') OR
             (ServLocRec."Ship To Location" = '' ) THEN BEGIN
            IF ProjSetup.Deliver = ProjSetup.Deliver::Location THEN
              ServLocRec.Deliver := ServLocRec.Deliver::Location;
          END;
          CASE ServLocRec.Deliver OF
            ServLocRec.Deliver::Location:
              VALIDATE(Deliver, Deliver::Location);
            ServLocRec.Deliver::"Service Loc. Ship-to Address":
              VALIDATE(Deliver, Deliver::"Service Location");
          END;
        END;
      END;
      FillDefaultPlantCompany;
      "Process Status" := "Process Status"::Open;
      Processed := FALSE;

      IF Job.GET("Project No.") THEN BEGIN
        IF Job."Assembly Project" THEN
          "Entity Type" := ProjSetup."Default Entity Type";
      END;
    END;

    PROCEDURE ValidateItem@31(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item');
    VAR
      DummyDat@11012001 : Date;
      lvRefDate@1100485004 : Date;
      lvDiscRef1@1100485003 : Code[20];
      lvDiscRef2@1100485002 : Code[20];
      lvRefPrio@1100525002 : Code[10];
      lvDiscType@1100525001 : 'Purchase,Sales';
      lvLanguage@1100525000 : Code[10];
    BEGIN
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        ProjRec.GET("Project No.");
        IF NOT "Currency Agreement" THEN
          "Currency Code" := ProjRec."Currency Code";
        lvLanguage := ProjRec."Language Code";
        lvRefPrio := ValidateCu.GetRefPrioProject(ProjRec, lvDiscType::Purchase);
      END;
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        ServOrderRec.GET("Service Order No.");
        IF NOT ServLocRec.GET(ServOrderRec."Service Location No.") THEN ServLocRec.INIT;
        lvLanguage := ServLocRec."Language Code";
        IF NOT ServContrRec.GET(ServOrderRec."Service Contract No.") THEN ServContrRec.INIT;
        IF lvLanguage = '' THEN lvLanguage := ServContrRec."Language Code";
        lvRefPrio := ValidateCu.GetRefPrioServContract(ServContrRec, lvDiscType::Purchase);
      END;
      ValidateCu.SetLanguageCode(lvLanguage);
      ValidateCu.SetVendor(Vendor);
      ValidateCu.SetQuantity("Quantity (Advice)");
      ValidateCu.ValidateItem(LTypeArtOpt,"Trade Item","Item No.",Manufacturer,"Vendor (Trade Item)",
                              "Basic Item","Cost Object",Description,"Unit of Measure","Price (LCY)",
                              "Discount %",DummyDat,"Gross Price (LCY)","Description 2","Cost Component",
                              lvDiscRef1,lvDiscRef2,lvRefDate,lvRefPrio);

      IF LTypeArtOpt = LTypeArtOpt::"Trade Item" THEN
        "Price History 0 Exists" := ValidateCu.PriceHistory0Exists("Trade Item", "Vendor (Trade Item)", lvRefDate)
      ELSE
        "Price History 0 Exists" := FALSE;

      VALIDATE("Cost Type", "Cost Type"::Material);
      VALIDATE("Cost Component");

      CheckSetupTransaction;  //C054043
      CheckItemExpired;  //C054043

      IF "Item No." <> '' THEN BEGIN
        CheckItemTransaction;  //C054043
        CheckItemBlocked;  //C054043
        GetDefaultTransaction;
        IF ItemRec.GET("Item No.") THEN BEGIN
          VALIDATE("External Text", ItemRec.Text);
          VALIDATE("Supplying Company Inventory", ItemRec.GetSupplyingCompanyInventory("Item No."));  //C051313
        END;
      END;

      VALIDATE("Gross Price (LCY)");  //DP00884 (calculate FCY-fields)
      CalculateTotal;

      IF (CheckVendorPrice = FALSE) THEN  //C045045
        VALIDATE(Vendor, PreferredVendor);
      //C028162.sn
      //db, 29-12-16: when changing item, recalculate delivery;
      //- first: OrderDate+DeliveryPeriod (by validate both fields)
      //- second: ReceiptDate-DeliveryPeriod (by EvaluateStartDate)
      RecalcReceiptDate := TRUE;
      "Order Date" := TODAY;
      xRec."Receipt Date" := 0D;
      //C028162.en
      VALIDATE("Delivery Period", '');
      RecalcReceiptDate := FALSE;
      xRec."Order Date" := 0D;
      IF "Order Date" = 0D THEN
        "Order Date" := TODAY;
      VALIDATE("Order Date");

      EvaluateStartDate("Receipt Date");
    END;

    PROCEDURE ValidateVendor@6506();
    VAR
      VendorRec@1210190000 : Record 23;
      lvVendor@1100485000 : Code[20];
      SaveItem@1100525004 : Code[20];
      SaveManufacturer@1100525003 : Code[20];
      SaveBasicItem@1100525002 : Code[20];
      SaveVendor@1100525001 : Code[20];
      SaveTradeItem@1100525000 : Code[20];
      SaveDesc@1100525005 : Text[100];
    BEGIN
      IF ("Basic Item" = '') THEN EXIT;

      lvVendor := '';
      IF ItemRec.GET("Item No.") THEN
        lvVendor := ItemRec."Vendor No.";

      IF "Record Type" = "Record Type"::Project THEN BEGIN
        ProjRec.GET("Project No.");
        IF ProjRec."Project Supplier" <> '' THEN
          lvVendor := ProjRec."Project Supplier";
      END;

      IF NOT VendorRec.GET(lvVendor) THEN VendorRec.INIT;
      lvVendor := VendorRec."Vendor (Trade Item)";

      SaveItem := "Item No.";
      SaveManufacturer := Manufacturer;
      SaveBasicItem := "Basic Item";
      SaveVendor := "Vendor (Trade Item)";
      SaveTradeItem := "Trade Item";
      SaveDesc := Description;

      IF lvVendor = '' THEN EXIT;
      IF lvVendor = SaveVendor THEN
        IF SaveTradeItem <> '' THEN
          EXIT;

      xRec."Vendor (Trade Item)" := '';
      VALIDATE("Vendor (Trade Item)", lvVendor);

      IF (SaveItem <> "Item No.") THEN BEGIN
        "Item No." := SaveItem;
        Description := SaveDesc;
        IF "Item No." <> '' THEN
          ValidateItem(ItemTypeOpt::Item);
      END;

      IF (SaveManufacturer <> Manufacturer) OR (SaveBasicItem <> "Basic Item") THEN BEGIN
        Manufacturer := SaveManufacturer;
        "Basic Item" := SaveBasicItem;
        Description := SaveDesc;
        IF "Basic Item" <> '' THEN
          ValidateItem(ItemTypeOpt::"Basic Item");
      END;

      IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
        "Vendor (Trade Item)" := SaveVendor;
        "Trade Item" := SaveTradeItem;
        Description := SaveDesc;
        IF "Trade Item" <> '' THEN
          ValidateItem(ItemTypeOpt::"Trade Item");
      END;

      OperationCodebyItem.CheckItemOperationCode("Vendor (Trade Item)", "Trade Item", "Item Operation Code");
    END;

    PROCEDURE PreferredVendor@13() : Code[20];
    VAR
      VendorRelationRec@11012001 : Record 11012313;
    BEGIN
      IF "Trade Item" <> '' THEN BEGIN
        IF VendorRelationRec.GET("Vendor (Trade Item)") THEN
          EXIT(VendorRelationRec."Vendor (Purchase)");
      END;

      IF "Item No." <> '' THEN BEGIN
        IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
        EXIT(ItemRec."Vendor No.");
      END;

      EXIT('');
    END;

    PROCEDURE CheckDeliver@1210190002();
    VAR
      LocRec@11012001 : Record 14;
      ProjLocRec@11012002 : Record 11012011;
    BEGIN
      CASE Deliver OF
        Deliver::" ":
          TESTFIELD("Ship To Location", '');
        Deliver::Location:
          BEGIN
            TESTFIELD("Ship To Location");
            LocRec.GET("Ship To Location");
          END;
        Deliver::"Project Location":
          BEGIN
            TESTFIELD("Ship To Location");
            ProjLocRec.GET("Project No.", "Ship To Location");
          END;
        Deliver::"Service Location":
          BEGIN
            IF "Ship To Location" <> '' THEN
              ServOrderLocRec.GET("Service Order No.", "Ship To Location");
          END;
      END;
    END;

    PROCEDURE GetDefaultTransaction@4();
    VAR
      ProjSetup@1100528901 : Record 315;
      Item@11012000 : Record 27;
      Location@1100528900 : Record 14;
      PreferenceLocation@1100525000 : Record 11020353;
      LocationFound@1100525001 : Boolean;
      InventoryPrefLoc@1100525002 : Decimal;
      InventoryLoc@1100525003 : Decimal;
    BEGIN
      //C054034: redesign
      //db, 28-10-19: check on ProjSetup."Advice Order Inv. Neg. Inv." removed; field not used anymore

      IF Transaction = Transaction::Plant THEN EXIT;
      IF "Record Type" = "Record Type"::"G/L Account" THEN EXIT;

      ProjSetup.GET;
      IF (Transaction = Transaction::Purchase) OR (Transaction = Transaction::Requisition) THEN BEGIN
        CheckVendBlocked;
        CheckItemBlocked;
        CheckItemExpired;
        IF Transaction = ProjSetup."Advice Order Purch.Transaction" THEN EXIT;
      END;

      IF ("Item No." <> '') THEN BEGIN
        Item.GET("Item No.");
        Item.SETRANGE("Project Filter","Project No.");
        IF Item."Advice Order allways" IN [Item."Advice Order allways"::"Not Set",Item."Advice Order allways"::Inventory] THEN BEGIN
        //When transaction is Inventory then location will be filled
        //When transaction is not forced set to Purchase, transaction may be set to Inventory and Location wil be filled if item is in stock..
          PreferenceLocation.SETRANGE(Type,"Record Type");
          CASE "Record Type" OF
            "Record Type"::Project: PreferenceLocation.SETRANGE("No.","Project No.");
            "Record Type"::ServOrder: PreferenceLocation.SETRANGE("No.","Service Order No.");
          END;
          PreferenceLocation.SETCURRENTKEY(Priority);
          IF PreferenceLocation.FINDSET THEN BEGIN
            REPEAT
              InventoryLoc := GetInventory(PreferenceLocation."Location Code",Item,FALSE);
              InventoryPrefLoc += InventoryLoc;
              IF (InventoryLoc >= "Quantity (Advice)") AND (InventoryLoc > 0) THEN BEGIN
                LocationFound := TRUE;
                "Location Code" := PreferenceLocation."Location Code";
                Transaction := Transaction::Inventory;
              END;
            UNTIL (PreferenceLocation.NEXT = 0) OR LocationFound;
            IF NOT LocationFound THEN BEGIN
              IF (InventoryPrefLoc >= "Quantity (Advice)") AND (InventoryPrefLoc > 0) THEN
                Transaction := Transaction::Inventory
              ELSE BEGIN
                InventoryLoc := GetInventory("Location Code",Item,FALSE);
                IF (InventoryLoc >= "Quantity (Advice)") AND (InventoryLoc > 0) THEN
                  Transaction := Transaction::Inventory;
              END;
            END;
          END ELSE BEGIN
            IF ("Location Code" <> '') THEN BEGIN  //try current location first
              Item.SETRANGE("Location Filter", "Location Code");
              Item.CALCFIELDS(Inventory);
              IF (Item.Inventory >= "Quantity (Advice)") AND (Item.Inventory > 0) THEN BEGIN
                LocationFound := TRUE;
                Transaction := Transaction::Inventory;
              END;
              Item.SETRANGE("Location Filter");  //clear filter used by GetInventory
            END;
            IF NOT LocationFound THEN BEGIN
              Location.SETRANGE("Use As In-Transit",FALSE);
              Location.SETRANGE("Service Car",FALSE);
              IF Location.FINDSET THEN BEGIN
                REPEAT
                  InventoryLoc := GetInventory(Location.Code,Item,FALSE);
                  IF (InventoryLoc >= "Quantity (Advice)") AND (InventoryLoc > 0) THEN BEGIN
                    LocationFound := TRUE;
                    "Location Code" := Location.Code;
                    Transaction := Transaction::Inventory;
                  END;
                UNTIL (Location.NEXT = 0) OR LocationFound;
              END;
            END;
            IF NOT LocationFound THEN BEGIN
              InventoryLoc := GetInventory('',Item,TRUE);  //check inventory on all locations
              IF (InventoryLoc >= "Quantity (Advice)") AND (InventoryLoc > 0) THEN BEGIN
                LocationFound := TRUE;
                "Location Code" := '';
                Transaction := Transaction::Inventory;
              END;
            END;
            IF (Item."Advice Order allways" = Item."Advice Order allways"::"Not Set") AND
               NOT LocationFound AND
               (CurrFieldNo <> FIELDNO(Transaction))
            THEN
              Transaction := ProjSetup."Advice Order Purch.Transaction";
          END;
        END;

        IF NOT LocationFound THEN BEGIN
          IF (Deliver = Deliver::Location) AND ("Ship To Location" <> '') THEN BEGIN
            //"Location Code" := "Ship To Location";
          END ELSE BEGIN
            "Location Code" := '';
            "Bin Code" := '';
          END;
        END;
        IF ("Location Code" <> xRec."Location Code") AND ("Location Code" <> '') THEN BEGIN
          GetDefaultBin("Location Code", "Bin Code", "Bin Code (Project Inventory)");
        END;
      END;
      CheckVendBlocked;
      IF Transaction <> xRec.Transaction THEN
        VALIDATE("Delivery Period", '');
    END;

    PROCEDURE GetDefaultPurchaser@1210190000(IProjectNo@1210190001 : Code[20];ServiceOrderNo@1100529600 : Code[20]) : Code[10];
    VAR
      lvProjRec@1210190000 : Record 11072003;
      ServiceOrder@1100529601 : Record 11012823;
      DimValue@1100529602 : Record 349;
    BEGIN
      IF IProjectNo <> '' THEN BEGIN
        IF NOT lvProjRec.GET(IProjectNo) THEN
          CLEAR(lvProjRec);

        EXIT(lvProjRec."Purchaser Code");
      END;

      IF ServiceOrderNo <> '' THEN
        IF ServiceOrder.GET(ServiceOrderNo) THEN BEGIN
          DimMgt.GetDimValueRec(1, ServiceOrder."Global Dimension 1 Code", DimValue, FALSE, '');
          EXIT(DimValue."Purchaser (Service)");
        END;
    END;

    PROCEDURE CheckInventoryOnLocation@1210190006();
    VAR
      Item@1100528900 : Record 27;
    BEGIN
      IF (Transaction <> Transaction::Inventory) THEN
        EXIT;

      IF ("Location Code" = '') THEN BEGIN
        InventorySetup.GET;
        IF InventorySetup."Location Mandatory" THEN
          EXIT;
      END;

      IF Item.GET("Item No.") THEN BEGIN
        Item.SETRANGE("Location Filter", "Location Code");  //C054043: setfilter on local variable (Item)
        Item.CALCFIELDS(Inventory);
        IF Item.Inventory < "Quantity (Advice)" THEN BEGIN
          Item.SETRANGE("Location Filter");
          Item.CALCFIELDS(Inventory);
          IF Item.Inventory >= "Quantity (Advice)" THEN
            MESSAGE(Text005, "Item No.", "Location Code");
        END;
      END;
    END;

    PROCEDURE CheckBlocked@1210190003();
    BEGIN
      IF "Record Type" <> "Record Type"::Project THEN EXIT;

      ProjRec.GET("Project No.");
      ProjRec.TestBlocked;
    END;

    PROCEDURE CheckItemUnitConversion@1210190008(VAR MainNewRec@1210190006 : Record 11012055;MainOldRec@1210190007 : Record 11012055);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
    BEGIN
      WITH MainNewRec DO BEGIN
        UnitFactorOld := 1;
        UnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            "Quantity (Advice)","Unit of Measure",UnitFactorNew);
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              "Quantity (Advice)","Unit of Measure",UnitFactorNew);
          END ELSE BEGIN
            IF "Item No." <> '' THEN BEGIN
              ItemRec.GET("Item No.");
              UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, MainOldRec."Unit of Measure");
              UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, "Unit of Measure");
              UnitFactor := UnitFactorOld;
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                "Quantity (Advice)","Unit of Measure",UnitFactor);
            END;
          END;
        END;
        IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
          IF UnitFactorNew <> UnitFactorOld THEN BEGIN
            IF "Gross Price (LCY)" <> 0 THEN
              VALIDATE("Gross Price (LCY)", ("Gross Price (LCY)" * UnitFactorNew / UnitFactorOld))
            ELSE
              VALIDATE("Price (LCY)", ("Price (LCY)" * UnitFactorNew / UnitFactorOld));
          END;
        END;
      END;
    END;

    PROCEDURE HandleLookupUnit@1210190004();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";
        VALIDATE("Unit of Measure", lvUnit);
      END;
    END;

    PROCEDURE CalculateNetPrice@1210190005();
    BEGIN
      //DP00884
      "Price (LCY)" := "Gross Price (LCY)" - (("Gross Price (LCY)"/100) * "Discount %");
      "Price (FCY)" := "Gross Price (FCY)" - (("Gross Price (FCY)"/100) * "Discount %");
      CalculateTotal;
    END;

    PROCEDURE CalculateDiscount@1100525024();
    BEGIN
      //DP00884
      IF "Gross Price (LCY)" <> 0 THEN BEGIN
        IF ("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Discount %" = 0) THEN BEGIN
          "Gross Price (LCY)" := "Price (LCY)";
          "Gross Price (FCY)" := "Price (FCY)";
        END ELSE BEGIN
          "Discount %" := (("Gross Price (LCY)" - "Price (LCY)") / "Gross Price (LCY)") * 100;
        END;
      END ELSE BEGIN
        IF "Discount %" <> 100 THEN BEGIN
          "Gross Price (LCY)" := "Price (LCY)" / ((100 - "Discount %") / 100);
          "Gross Price (FCY)" := "Price (FCY)" / ((100 - "Discount %") / 100);
        END ELSE BEGIN
          "Gross Price (LCY)" := "Price (LCY)";
          "Gross Price (FCY)" := "Price (FCY)";
        END;
      END;
    END;

    PROCEDURE CheckRecordType@1100485000(lvAction@1100485000 : Integer);
    VAR
      ProjSetup@1100528000 : Record 315;
      BlockingCode@1100528001 : Record 11012027;
    BEGIN
      IF "Record Type" = "Record Type"::"G/L Account" THEN BEGIN
        //DP01378.sn
        TESTFIELD("Project No.", '');
        TESTFIELD("Service Order No.", '');
        IF (Transaction = Transaction::Inventory) OR (Transaction = Transaction::Plant) THEN
          FIELDERROR(Transaction, STRSUBSTNO(Text012, Transaction));
        GLAccount.GET("G/L Account");
        //DP01378.en
      END;
      //
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        //DP01378.sn
        TESTFIELD("Project No.", '');
        TESTFIELD("G/L Account", '');
        //DP01378.en
        ServOrderRec.GET("Service Order No.");
        IF NOT gFrom4PSMobile THEN
          ServOrderRec.CheckStatus(2)
        ELSE
          ServOrderRec.CheckStatus(1);  //* For 4PS-Mobile 'Technical Finished' must be possible (JH)
        "Service Contract No." := ServOrderRec."Service Contract No.";
        "Service Location No." := ServOrderRec."Service Location No.";  //C044123
        IF lvAction = 0 THEN BEGIN
          CurrFieldNo := FIELDNO("Service Order No.");
          CheckAdditionalCostService;
        END;
      END;
      //
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        //DP01378.sn
        TESTFIELD("Service Order No.", '');
        TESTFIELD("G/L Account", '');
        //DP01378.en
        ProjSetup.GET;
        ProjRec.GET("Project No.");
        IF NOT "Currency Agreement" THEN
          "Currency Code" := ProjRec."Currency Code";  //DP00884
        IF (ProjRec."Blocking Code" <> '') AND
           ((ProjRec."Project Status" = ProjRec."Project Status"::"Technical Finished") OR
            (ProjRec."Project Status" = ProjRec."Project Status"::"Administrative Finished") OR
            ((ProjRec."Project Status" = ProjRec."Project Status"::Finished) AND ProjSetup."Provisions at Closure") )
        THEN
          BlockingCode.CheckBlocked(ProjRec."Blocking Code", BlockingCode.Switch::"Purchase Order", ProjRec, TRUE);
        IF ProjSetup."Provisions at Closure" THEN
          ProjRec.CheckProjectStatus(-1)
        ELSE
          ProjRec.CheckProjectStatus(1);
      END;
    END;

    PROCEDURE ReceivedPurchaseQuantity@1100485001(Company@1100525000 : Text[30]) ReceivedQuan : Decimal;
    VAR
      PurchLineRec@1100485000 : Record 39;
    BEGIN
      ReceivedQuan := 0;
      IF "Purchase Route Reference" = '' THEN EXIT(0);

      IF Company <> '' THEN
        PurchLineRec.CHANGECOMPANY(Company);
      PurchLineRec.SETCURRENTKEY("Document Type", "Purchase Route Reference");
      PurchLineRec.SETRANGE("Document Type", PurchLineRec."Document Type"::Order);
      PurchLineRec.SETRANGE("Purchase Route Reference", "Purchase Route Reference");
      IF PurchLineRec.FINDSET THEN BEGIN
        REPEAT
          IF PurchLineRec."Unit of Measure Code" = "Unit of Measure" THEN
            ReceivedQuan := ReceivedQuan + PurchLineRec."Quantity Received"
          ELSE
            ReceivedQuan := ReceivedQuan + PurchLineRec."Quantity Received" * PurchLineRec."Qty. per Unit of Measure";
        UNTIL PurchLineRec.NEXT = 0;
      END;

      EXIT (ReceivedQuan);
    END;

    PROCEDURE GetStatusOnProcess@1100485002(ResetQuantity@1210190000 : Boolean);
    VAR
      ForceClose@1100528900 : Boolean;
    BEGIN
      //function also called from codeunit 11012041
      IF ResetQuantity THEN BEGIN
        IF ("Quantity (Advice)" < 0) THEN ForceClose := TRUE;  //DP01402
        "Quantity (Processed)" := "Quantity (Processed)" + "Quantity (Advice)";
        "Quantity (Advice)" := 0;
        //DP01402.sn
        IF ("Quantity (Budget)" = 0) AND ("Quantity (Advice)" = 0) THEN BEGIN
          IF ForceClose THEN BEGIN
            ProcessCloseStatus;
            EXIT;
          END;
        END;
        //DP01402.en
      END;
      IF ("Quantity (Processed)" < "Quantity (Budget)") OR ("Quantity (Advice)" > 0)
      THEN
        ProcessOpenStatus
      ELSE
        ProcessCloseStatus;
    END;

    PROCEDURE ProcessOpenStatus@1210190015();
    BEGIN
      VALIDATE(Processed, FALSE);
      IF "Quantity (Processed)" <> 0 THEN
        "Process Status" := "Process Status"::"Partly Processed"
      ELSE
        "Process Status" := "Process Status"::Open;
    END;

    PROCEDURE ProcessCloseStatus@1210190016();
    BEGIN
      VALIDATE(Processed, TRUE);
      "Process Status" := "Process Status"::Processed;
    END;

    PROCEDURE ChangeStatusAttachedLine@1210190012();
    VAR
      AdviceOrderLine@1210190000 : Record 11012055;
    BEGIN
      IF "Source Type" IN ["Source Type"::"Recipe Line", "Source Type"::"BOM Line"] THEN BEGIN
        AdviceOrderLine.SETRANGE("Record Type", "Record Type");
        AdviceOrderLine.SETRANGE("Project No.", "Project No.");
        AdviceOrderLine.SETRANGE("Service Order No.", "Service Order No.");
        AdviceOrderLine.SETRANGE("G/L Account", "G/L Account");  //DP01378
        AdviceOrderLine.SETRANGE("Source Type", "Source Type");
        AdviceOrderLine.SETRANGE("Attached to Line No.", "Attached to Line No.");
        AdviceOrderLine.SETFILTER("Line No.", '<>%1', "Line No.");
        AdviceOrderLine.SETFILTER("Process Status", '..%1|%2', AdviceOrderLine."Process Status"::Released, AdviceOrderLine."Process Status"::"On Hold");
        AdviceOrderLine.SETRANGE(Processed, FALSE);
        IF AdviceOrderLine.ISEMPTY THEN BEGIN
          IF AdviceOrderLine.GET("Record Type", "Project No.", "Service Order No.", "G/L Account", "Attached to Line No.") THEN BEGIN  //DP01378
            IF NOT AdviceOrderLine.Processed AND
               ((("Source Type" = "Source Type"::"Recipe Line") AND
                (AdviceOrderLine."Source Type" = AdviceOrderLine."Source Type"::"Recipe Header")) OR
                (("Source Type" = "Source Type"::"BOM Line") AND
                 (AdviceOrderLine."Source Type" = AdviceOrderLine."Source Type"::"BOM Header"))) THEN
            AdviceOrderLine.VALIDATE(Processed, TRUE);
            AdviceOrderLine."Process Status" := "Process Status"::Processed;
            AdviceOrderLine."Quantity (Processed)" += AdviceOrderLine."Quantity (Advice)";
            AdviceOrderLine."Quantity (Advice)" := 0;
            AdviceOrderLine.MODIFY(TRUE);
          END;
        END;
      END;
    END;

    PROCEDURE GetDepartment@1100485003();
    BEGIN
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        ProjRec.GET("Project No.");
        "Global Dimension 1 Code" := ProjRec."Global Dimension 1 Code";
      END;
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        ServOrderRec.GET("Service Order No.");
        IF "Additional Cost (Service)" = TRUE THEN
          VALIDATE("Global Dimension 1 Code", ServOrderRec."Department Code (Other)")
        ELSE
          VALIDATE("Global Dimension 1 Code", ServOrderRec."Global Dimension 1 Code");
      END;
    END;

    PROCEDURE GetItemSpecifications@1100485006();
    BEGIN
      IF ItemRec.GET("Item No.") THEN BEGIN
        "Item Series" := ItemRec."Item Series";
        "Item Type" := ItemRec."Item Type";
        "Item Brand" := ItemRec."Item Brand";
      END;
    END;

    PROCEDURE CheckVendorRelation@1100485004(CalledBy@1100525000 : Integer);
    VAR
      VendorRec@1100485001 : Record 23;
      VendorRelationRec@1100485000 : Record 11012313;
    BEGIN
      IF CalledBy = FIELDNO("Vendor (Trade Item)") THEN
        IF "Vendor (Trade Item)" <> '' THEN
          IF VendorRelationRec.GET("Vendor (Trade Item)") THEN
            IF VendorRelationRec."Vendor (Purchase)" <> '' THEN
              VALIDATE(Vendor, VendorRelationRec."Vendor (Purchase)"); //Validate to check vendor is blocked

      IF CalledBy = FIELDNO(Vendor) THEN
        IF Vendor <> '' THEN
          IF VendorRec.GET(Vendor) THEN
            IF VendorRec."Vendor (Trade Item)" <> '' THEN
              IF "Trade Item" = '' THEN
                "Vendor (Trade Item)" := VendorRec."Vendor (Trade Item)";
    END;

    PROCEDURE GetDefaultsCostObject@3();
    BEGIN
      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE,'');

      IF Description = '' THEN
        Description := DimValRec.Name;
      IF "Unit of Measure" = '' THEN
        "Unit of Measure" := DimValRec."Unit of Measure";
      IF "Cost Component" = '' THEN
        "Cost Component" := DimValRec."Cost Component";

      CheckDeliveryPeriod;
    END;

    PROCEDURE GetReferenceData@1100485008(VAR lvRefDate@1100485002 : Date;VAR lvDiscRef1@1100485001 : Code[20];VAR lvDiscRef2@1100485000 : Code[20]);
    BEGIN
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        ProjRec.GET("Project No.");
        lvRefDate := ValidateCu.GetRefDateProject(ProjRec);
        lvDiscRef1 := ProjRec."Purch Discount Term Group 1";
        lvDiscRef2 := ProjRec."Purch Discount Term Group 2";
      END;
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        ServOrderRec.GET("Service Order No.");
        lvRefDate := ValidateCu.GetRefDateServOrder(ServOrderRec);
        lvDiscRef1 := ServOrderRec."Purch Discount Term Group 1";
        lvDiscRef2 := ServOrderRec."Purch Discount Term Group 2";
      END;
    END;

    PROCEDURE GetVendorPrice@1100525002(iVendor@1100525000 : Code[20];iPrice@1100525004 : Decimal;VAR oCurrency@1100525002 : Code[20]) oPrice : Decimal;
    VAR
      VendorRec@1100525003 : Record 23;
      CurrExchRate@1100525006 : Record 330;
      CurrFactor@1100525005 : Decimal;
      lvText000@1100525001 : TextConst 'ENU=%1 not found;NOR=%1 ikke funnet;SVE=%1 hittades inte';
      RefDate@1100525007 : Date;
    BEGIN
      oCurrency := '';
      IF VendorRec.GET(iVendor) THEN BEGIN
        oCurrency := VendorRec."Currency Code";
        //DP00884.sn
        RefDate := WORKDATE;
        //Type: 0=General, 1=Project, 2=Estimate
        IF ProjRec.GET("Project No.") THEN BEGIN
          IF ProjRec."Reference Date (Currency)" <> 0D THEN
            RefDate := ProjRec."Reference Date (Currency)";
          CurrFactor := CurrExchRate.ExchangeRate(1, "Project No.", RefDate, oCurrency, FALSE);
        END ELSE BEGIN
          CurrFactor := CurrExchRate.ExchangeRate(0, '', RefDate, oCurrency, FALSE);
        END;
        //DP00884.en
        IF CurrFactor = 0 THEN
          ERROR(lvText000, CurrExchRate.TABLECAPTION);
      END;
      IF oCurrency = '' THEN
        oPrice := iPrice
      ELSE
        oPrice := iPrice * CurrFactor;

      EXIT(oPrice);
    END;

    PROCEDURE ConvertVendorPrice@1100525006(iVendor@1100525000 : Code[20];iPrice@1100525004 : Decimal) oPrice : Decimal;
    VAR
      GLSetup@1100525007 : Record 98;
      VendorRec@1100525003 : Record 23;
      CurrExchRate@1100525006 : Record 330;
      CurrFactor@1100525005 : Decimal;
      lvText000@1100525001 : TextConst 'ENU=%1 not found;NOR=%1 ikke funnet;SVE=%1 hittades inte';
      CurrencyCode@1100525002 : Code[20];
      RefDate@1100525008 : Date;
    BEGIN
      IF VendorRec.GET(iVendor) THEN BEGIN
        CurrencyCode := VendorRec."Currency Code";
        //DP00884.sn
        RefDate := WORKDATE;
        //Type: 0=General, 1=Project, 2=Estimate
        IF ProjRec.GET("Project No.") THEN BEGIN
          IF ProjRec."Reference Date (Currency)" <> 0D THEN
            RefDate := ProjRec."Reference Date (Currency)";
          CurrFactor := CurrExchRate.ExchangeRate(1, "Project No.", RefDate, CurrencyCode, FALSE);
        END ELSE BEGIN
          CurrFactor := CurrExchRate.ExchangeRate(0, '', RefDate, CurrencyCode, FALSE);
        END;
        //DP00884.en
        IF CurrFactor = 0 THEN
          ERROR(lvText000, CurrExchRate.TABLECAPTION);
      END;

      GLSetup.GET;
      IF CurrencyCode = '' THEN
        oPrice := iPrice
      ELSE
        oPrice := ROUND(iPrice / CurrFactor, GLSetup."Unit-Amount Rounding Precision");

      EXIT(oPrice);
    END;

    PROCEDURE InventoryPrefLocations@1100525004() Inventory : Decimal;
    VAR
      PreferenceLocation@1100525000 : Record 11020353;
      Item@1100525001 : Record 27;
    BEGIN
      IF ("Supplying Company Inventory" <> '') THEN BEGIN
        Item.CHANGECOMPANY("Supplying Company Inventory");
        PreferenceLocation.CHANGECOMPANY("Supplying Company Inventory");
      END;

      IF NOT Item.GET("Item No.") THEN
        EXIT;

      PreferenceLocation.SETRANGE(Type,"Record Type");
      CASE "Record Type" OF
        "Record Type"::Project:
          BEGIN
            PreferenceLocation.SETRANGE("No.","Project No.");
            Item.SETRANGE("Project Filter","Project No.");
          END;
        "Record Type"::ServOrder: PreferenceLocation.SETRANGE("No.","Service Order No.");
      END;
      IF PreferenceLocation.FINDSET THEN
        REPEAT
          Inventory += GetInventory(PreferenceLocation."Location Code",Item,FALSE);
        UNTIL PreferenceLocation.NEXT = 0;
    END;

    PROCEDURE GetInventory@1100525003(Location@1100525000 : Code[10];VAR Item@1100525002 : Record 27;AllLocations@1100525001 : Boolean) Inventory : Decimal;
    VAR
      ItemAvailFormsMgt@1100525005 : Codeunit 353;
    BEGIN
      ItemAvailFormsMgt.SetCalledFromAdviceOrder;
      ItemAvailFormsMgt.SetCompany("Supplying Company Inventory");
      EXIT(ItemAvailFormsMgt.GetInventory(Location,Item,AllLocations,"Receipt Date"));
    END;

    PROCEDURE SetFrom4PSMobile@1100525007();
    BEGIN
      gFrom4PSMobile := TRUE;
    END;

    PROCEDURE SetLocationCode@1100525008();
    VAR
      Item@1100525000 : Record 27;
      PrefLocation@1100525001 : Record 11020353;
    BEGIN
      IF ("Item No." = '') OR
         ((Transaction <> Transaction::Purchase) AND (Transaction <> Transaction::Requisition)) OR
         ("Location Code" <> '') THEN
        EXIT;

      IF Item.GET("Item No.") THEN
        IF Item."Blanket Order Plan Item" THEN BEGIN
          CASE "Record Type" OF
            "Record Type"::Project:
              BEGIN
                PrefLocation.SETRANGE(Type,PrefLocation.Type::Job);
                PrefLocation.SETRANGE("No.","Project No.");
              END;
            "Record Type"::ServOrder:
              BEGIN
                PrefLocation.SETRANGE(Type,PrefLocation.Type::"Service Order");
                PrefLocation.SETRANGE("No.","Service Order No.");
              END;
          END;
          PrefLocation.SETCURRENTKEY(Priority);
          IF PrefLocation.FINDFIRST THEN
            "Location Code" := PrefLocation."Location Code";
        END;

      IF ("Location Code" <> xRec."Location Code") AND ("Location Code" <> '') THEN
        GetDefaultBin("Location Code", "Bin Code", "Bin Code (Project Inventory)");
    END;

    PROCEDURE CheckAdditionalCostService@1100525017();
    BEGIN
      IF "Service Order No." = '' THEN EXIT;
      IF NOT ServOrderRec.GET("Service Order No.") THEN EXIT;

      IF NOT "Add. Cost Changed Manually" THEN
        "Additional Cost (Service)" :=
          ServOrderRec.GetAdditionalCostService("Service Order No.","Cost Object","Cost Type"+2,'', Rec);
      IF ("Service Order No." <> xRec."Service Order No.") OR
         ("Additional Cost (Service)" <> xRec."Additional Cost (Service)")
      THEN BEGIN
        IF "Additional Cost (Service)" THEN
          VALIDATE("Global Dimension 1 Code", ServOrderRec."Department Code (Other)")
        ELSE
          VALIDATE("Global Dimension 1 Code", ServOrderRec."Global Dimension 1 Code");
      END;

      IF (CurrFieldNo = FIELDNO("Service Order No.")) OR (CurrFieldNo = FIELDNO("Cost Type")) THEN BEGIN
        IF ("Service Order No." <> xRec."Service Order No.") OR
           ("Cost Type" <> xRec."Cost Type") THEN BEGIN
          VALIDATE("Cost Component");
        END;
      END;
    END;

    PROCEDURE GetDeliverableQuantity@1100525009() : Decimal;
    VAR
      OrigQuan@1100525000 : Decimal;
      NextQuan@1100525001 : Decimal;
      UnitFactor@1100525002 : Decimal;
      NextFactor@1100525003 : Decimal;
      ItemUnitRec@1100525004 : Record 5404;
    BEGIN
      OrigQuan := "Quantity (Advice)";

      IF (OrigQuan <= 0) THEN
        EXIT(OrigQuan);

      IF ("Trade Item" = '') THEN BEGIN
        IF ItemRec.GET("Item No.") THEN BEGIN
          IF ItemUnitRec.GET("Item No.", "Unit of Measure") THEN BEGIN
            EXIT(OrigQuan * ItemUnitRec."Qty. per Unit of Measure");
          END;
        END;
        EXIT(OrigQuan);
      END;

      IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN
        EXIT(OrigQuan);

      IF TradeItemRec."Application Unit Quantity" = 0 THEN
        TradeItemRec."Application Unit Quantity" := 1;
      IF TradeItemRec."Minimum Order Quantity" = 0 THEN
        TradeItemRec."Minimum Order Quantity" := 1;
      IF TradeItemRec."Lot Size Quantity" = 0 THEN
        TradeItemRec."Lot Size Quantity" := 1;
      UnitFactor := TradeItemRec."Application Unit Quantity" * TradeItemRec."Minimum Order Quantity";
      IF TradeItemRec."Application Unit Quantity" = 1 THEN
        NextFactor := TradeItemRec."Lot Size Quantity"
      ELSE
        NextFactor := UnitFactor;

      IF UnitFactor > 1 THEN BEGIN
        NextQuan := UnitFactor;
        IF OrigQuan <= NextQuan THEN
          EXIT( NextQuan);
        REPEAT
          NextQuan := NextQuan + NextFactor;
        UNTIL NextQuan >= OrigQuan;
        EXIT( NextQuan);
      END;

      EXIT( ROUND(OrigQuan, TradeItemRec."Lot Size Quantity", '>'));
    END;

    PROCEDURE ValidateAdditionalCost@1100525011();
    VAR
      CostCompRec@1100525001 : Record 11012012;
      SaveCostComp@1100525000 : Text[30];
    BEGIN
      SaveCostComp := "Cost Component";
      IF CurrFieldNo = FIELDNO("Additional Cost (Service)") THEN
        "Add. Cost Changed Manually" := TRUE;
      TESTFIELD("Service Order No.");
      VALIDATE("Service Order No.");
      IF CurrFieldNo <> FIELDNO("Additional Cost (Service)") THEN EXIT;

      IF CostCompRec.GET(SaveCostComp) THEN BEGIN
         "Cost Component" := SaveCostComp;
         IF ("Additional Cost (Service)" = TRUE) THEN BEGIN
           IF (CostCompRec."Cost Component (Add.Cost)" <> '') THEN
             "Cost Component" := CostCompRec."Cost Component (Add.Cost)";
         END ELSE BEGIN
           CostCompRec.SETRANGE("Cost Component (Add.Cost)", SaveCostComp);
           IF CostCompRec.FINDSET THEN BEGIN
             REPEAT
               IF (CostCompRec."Cost Component (Add.Cost)" = SaveCostComp) THEN
                 "Cost Component" := CostCompRec.Code;
             UNTIL CostCompRec.NEXT = 0;
           END;
         END;
      END;
    END;

    PROCEDURE ValidateCostComponent@1100525010();
    VAR
      CostCompRec@1100525000 : Record 11012012;
      CostCompRec2@1100525001 : Record 11012012;
    BEGIN
      IF CurrFieldNo <> FIELDNO("Cost Component") THEN EXIT;

      IF CostCompRec.GET("Cost Component") THEN BEGIN
        IF CostCompRec."Additional Cost (Service)" THEN BEGIN
          CostCompRec2.SETRANGE("Cost Component (Add.Cost)", "Cost Component");
          IF NOT CostCompRec2.FINDFIRST THEN EXIT;
        END ELSE BEGIN
          IF CostCompRec."Cost Component (Add.Cost)" = '' THEN EXIT;
        END;
        "Additional Cost (Service)" := CostCompRec."Additional Cost (Service)";
      END;
    END;

    PROCEDURE CalculateTotal@1100525012();
    VAR
      GLSetup@1100525000 : Record 98;
    BEGIN
      GLSetup.GET;
      "Amount (LCY)" := ROUND(("Quantity (Advice)" * "Price (LCY)"), GLSetup."Amount Rounding Precision");
      "Amount (FCY)" := ROUND(("Quantity (Advice)" * "Price (FCY)"), GLSetup."Amount Rounding Precision");  //DP00884
    END;

    PROCEDURE GetDeliveryPeriodLocation@1100525014(ILocation@1100525000 : Code[10]) retValue : Text[30];
    VAR
      Location@1100525001 : Record 14;
      InventorySetup@1100525002 : Record 313;
    BEGIN
      IF ILocation <> '' THEN
        IF Location.GET(ILocation) THEN
          retValue := FORMAT(Location."Outbound Whse. Handling Time");

      IF retValue = '' THEN BEGIN
        InventorySetup.GET;
        retValue := FORMAT(InventorySetup."Outbound Whse. Handling Time");
      END;
    END;

    PROCEDURE CheckVendBlocked@1100525018();
    BEGIN
      IF Vendor = '' THEN
        EXIT;

      IF Vendor <> Vend."No." THEN
        Vend.GET(Vendor);

      Vend.CheckBlockedVendOnDocs(Vend,FALSE);
      IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN
        Vend.TESTFIELD("Block Purchase Order",FALSE);
    END;

    PROCEDURE GetDefaultOrderAddress@1100525013();
    VAR
      OrderAddress@1100525000 : Record 224;
    BEGIN
      OrderAddress.SETRANGE("Vendor No.", Vendor);
      OrderAddress.SETRANGE("Default Order Address",TRUE);
      IF OrderAddress.FINDFIRST THEN
        "Order Address Code" := OrderAddress.Code;

      IF NOT OrderAddress.GET(Vendor, "Order Address Code") THEN
        "Order Address Code" := '';
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012055) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012055');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Advice Order Line", "Global Dimension 1 Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Global Dimension 1 Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Global Dimension 1 Code");
    END;

    PROCEDURE LookupItemData@1210190001(VAR ZoomType@1210190000 : Integer;ItemCode@1100525001 : Code[20];VendorCode@1100525000 : Code[20]);
    VAR
      ItemFrm@1210190003 : Page 31;
      BasicItemFrm@1210190002 : Page 11012333;
      TradeItemFrm@1210190001 : Page 11012334;
      lvRefDate@1100485002 : Date;
      lvDiscRef1@1100485001 : Code[20];
      lvDiscRef2@1100485000 : Code[20];
      GabiVendorRec@1210190004 : Record 11012304;
      ProjSetup@1100525002 : Record 315;
    BEGIN
      //function removed from codeunit 11012041 due to problem with CurrFieldNo
      ProjSetup.GET;

      IF ZoomType = 0 THEN BEGIN
        CurrFieldNo := FIELDNO("Vendor (Trade Item)");
        IF "Basic Item" = '' THEN BEGIN
          GabiVendorRec.SETCURRENTKEY(Code);
          GabiVendorRec.Code := "Vendor (Trade Item)";
          IF PAGE.RUNMODAL(PAGE::"ETIM Vendor List", GabiVendorRec) = ACTION::LookupOK THEN BEGIN
            IF (NOT ProjSetup."Released AdvOrder not editable") OR
               ((ProjSetup."Released AdvOrder not editable") AND
                ("Process Status" < "Process Status"::Released))
            THEN
              VALIDATE("Vendor (Trade Item)", GabiVendorRec.Code);
          END;
        END ELSE BEGIN
          ZoomType := 3;
        END;
      END;

      IF ZoomType = 1 THEN BEGIN
        CurrFieldNo := FIELDNO("Item No.");
        CLEAR(ItemFrm);
        ItemFrm.LOOKUPMODE(TRUE);
        ItemFrm.DetermineInterface(DATABASE::"Advice Order Line",
          "Project No.",Element,"Extension Contract","Service Order No.",
          "Record Type",'','',"Line No.",'','');
        ItemRec.SETRANGE("Location Filter", "Location Code");
        IF ItemRec.GET("Item No.") THEN
          ItemFrm.SETRECORD(ItemRec);
        IF ItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          ItemFrm.GETRECORD(ItemRec);
          IF (NOT ProjSetup."Released AdvOrder not editable") OR
             ((ProjSetup."Released AdvOrder not editable") AND
              ("Process Status" < "Process Status"::Released))
          THEN
            VALIDATE("Item No.", ItemRec."No.");
        END ELSE BEGIN
          IF ItemFrm.CheckMultiCopy THEN
            ZoomType := -1;
        END;
      END;

      IF ZoomType = 2 THEN BEGIN
        CurrFieldNo := FIELDNO("Basic Item");
        CLEAR(BasicItemFrm);
        BasicItemFrm.LOOKUPMODE(TRUE);
        BasicItemFrm.SetSelection(DATABASE::"Advice Order Line",
          "Project No.",Element,"Extension Contract","Service Order No.",
          "Record Type",'','',"Line No.",'','');

        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
        BasicItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);

        BasicItemRec.InitLookup(BasicItemRec, "Basic Item", Manufacturer);
        BasicItemFrm.SETRECORD(BasicItemRec);

        IF BasicItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          BasicItemFrm.GETRECORD(BasicItemRec);
          Manufacturer := BasicItemRec.Manufacturer;
          IF (NOT ProjSetup."Released AdvOrder not editable") OR
             ((ProjSetup."Released AdvOrder not editable") AND
              ("Process Status" < "Process Status"::Released))
          THEN
            VALIDATE("Basic Item", BasicItemRec."Product Code");
        END ELSE BEGIN
          IF BasicItemFrm.CheckMultiCopy THEN
            ZoomType := -1;
        END;
      END;

      IF ZoomType = 3 THEN BEGIN
        CurrFieldNo := FIELDNO("Trade Item");
        CLEAR(TradeItemFrm);
        TradeItemFrm.LOOKUPMODE(TRUE);
        TradeItemFrm.SetSelection(DATABASE::"Advice Order Line",
          "Project No.",Element,"Extension Contract","Service Order No.",
          "Record Type",'','',"Line No.",'','',
          "Vendor (Trade Item)", "Trade Item", Manufacturer, "Basic Item", ItemCode, VendorCode);

        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
        TradeItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);

        TradeItemRec.InitLookup(TradeItemRec, "Basic Item", Manufacturer, "Trade Item", "Vendor (Trade Item)");
        TradeItemFrm.SETRECORD(TradeItemRec);

        IF TradeItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          TradeItemFrm.GETRECORD(TradeItemRec);
          Manufacturer := TradeItemRec.Manufacturer;
          "Basic Item" := TradeItemRec."Product Code";
          "Vendor (Trade Item)" := TradeItemRec.Vendor;
          VALIDATE("Trade Item", TradeItemRec."Item Code");
          CheckVendorRelation(FIELDNO("Vendor (Trade Item)"));
        END ELSE BEGIN
          IF TradeItemFrm.CheckMultiCopy THEN
            ZoomType := -1;
        END;
      END;
    END;

    PROCEDURE AssistEditItemData@1100528300(VAR ZoomType@1210190000 : Integer);
    VAR
      WebshopItemMgt@1100528300 : Codeunit 11012306;
      RecRef@1100528301 : RecordRef;
    BEGIN
      IF ZoomType = 3 THEN BEGIN
        RecRef.GETTABLE(Rec);
        WebshopItemMgt.RunModalDialogForMultipleItems("Vendor (Trade Item)", "Trade Item", RecRef);
        ZoomType := -1;
      END;
    END;

    PROCEDURE CheckDeliveryPeriod@1100525015();
    BEGIN
      IF ("Item No." + "Basic Item" + "Trade Item" <> '') THEN EXIT;
      IF ("Delivery Period" <> '') OR ("Order Date" <> 0D) OR ("Receipt Date" <> 0D) THEN EXIT;

      EvaluateStartDate("Receipt Date");
    END;

    PROCEDURE EvaluateStartDate@1100525005(iReceiptDate@1100525001 : Date);
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      //function removed from codeunit 11012041 due to problem with CurrFieldNo
      //UseStartDateProjElem (form-option 11012104, call 31907) disabled: default JobSetup copied to each Project.
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        IF NOT ProjRec.GET("Project No.") THEN
          ProjRec.INIT;
        IF ProjRec."Use Starting Date ProjectElem" THEN BEGIN
          IF NOT ProjElemRec.GET("Project No.", Element) THEN
            ProjElemRec.INIT;
          IF (ProjRec."Starting Date" > 0D) THEN BEGIN
            IF "Cost Type" = "Cost Type"::Subcontracting THEN
              iReceiptDate := ProjRec."Starting Date"
            ELSE
              iReceiptDate := ProjRec."Starting Date" - 1;
          END;
          IF (ProjElemRec."Starting Date" > 0D) THEN BEGIN
            IF "Cost Type" = "Cost Type"::Subcontracting THEN
              iReceiptDate := ProjElemRec."Starting Date"
            ELSE
              iReceiptDate := ProjElemRec."Starting Date" - 1;
          END;
        END;
      END;
      //
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        IF ServOrderRec."No." <> "Service Order No." THEN
          ServOrderRec.GET("Service Order No.");
        IF NOT WorkOrder.GET("Work Order No.") THEN
          WorkOrder.INIT;
        IF ServOrderRec."Starting Date" > 0D THEN BEGIN
          IF "Cost Type" = "Cost Type"::Subcontracting THEN
            iReceiptDate := ServOrderRec."Starting Date"
          ELSE
            iReceiptDate := ServOrderRec."Starting Date" -1;
        END;
        IF DT2DATE(WorkOrder."Starting Date/Time") > 0D THEN BEGIN
          IF "Cost Type" = "Cost Type"::Subcontracting THEN
            iReceiptDate := DT2DATE(WorkOrder."Starting Date/Time")
          ELSE
            iReceiptDate := DT2DATE(WorkOrder."Starting Date/Time") - 1;
        END;
      END;
      IF iReceiptDate < TODAY THEN
        iReceiptDate := TODAY;
      IF iReceiptDate <> "Receipt Date" THEN
        VALIDATE("Receipt Date", iReceiptDate);
    END;

    PROCEDURE SetLocationForBin@1100526201() LocCode : Code[20];
    BEGIN
      IF Transaction = Transaction::Inventory THEN
        LocCode := "Location Code";
      IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN
        LocCode := "Ship To Location";
    END;

    PROCEDURE GetDefaultBin@1100526200(iLoc@1100526202 : Code[20];VAR varBin1@1210190000 : Code[20];VAR varBin2@1210190001 : Code[20]);
    VAR
      Location@1100526204 : Record 14;
      Bin@1210190002 : Record 7354;
      WMSManagement@1100526203 : Codeunit 7302;
    BEGIN
      Location.GET(iLoc);
      IF Location."Bin Mandatory" AND NOT Location."Directed Put-away and Pick" THEN BEGIN
        IF (Transaction = Transaction::Inventory) THEN
          varBin1 := WMSManagement.GetDefaultBinLocation(
            "Project No.","Service Order No.","Location Code","Item No.","Variant Code",FALSE);
        IF DoGetDefaultProjBin(varBin2) THEN
          varBin2 := WMSManagement.GetDefaultBinLocation(
            "Project No.","Service Order No.","Location Code","Item No.","Variant Code",TRUE);
      END;

      IF NOT Bin.GET(iLoc, varBin1) THEN
        varBin1 := '';
      IF NOT Bin.GET(iLoc, varBin2) THEN
        varBin2 := '';
    END;

    PROCEDURE FieldIsEditable@1100526202(iField@1100526200 : Integer) : Boolean;
    BEGIN
      CASE iField OF
        FIELDNO("Location Code"):
          BEGIN
            IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN BEGIN
              IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
              EXIT(ItemRec."Blanket Order Plan Item");  //assumed to be processed by blanket order, controled by location
            END;
          END;
        FIELDNO("Bin Code"):
          BEGIN
            IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN
              EXIT(Deliver = Deliver::Location);
          END;
      END;

      EXIT(TRUE);
    END;

    PROCEDURE GenerateAdvOrderToMatReqLines@1100525016(ProjectNoFilter@1100525000 : Text[250]);
    VAR
      Job@1100525001 : Record 11072003;
      AdviceOrderLine@1100525002 : Record 11012055;
      ProjectMaterialReqLine@1100525003 : Record 11012526;
      NoOfLinesGenerated@1210190000 : Integer;
    BEGIN
      //Checks are done upfront, because the input is a filter and not a single project number
      Job.SETFILTER("No.", '%1', ProjectNoFilter);
      IF Job.FINDSET THEN
        REPEAT
          IF Job."Project Status" >= Job."Project Status"::"Technical Finished" THEN BEGIN
            MESSAGE(Text001, Job.FIELDCAPTION(Job."No."), Job."No.", Job.FIELDCAPTION("Project Status"), Job."Project Status");
            EXIT;
          END;
          ProjectMaterialReqLine.SETRANGE("Project No.", Job."No.");
          ProjectMaterialReqLine.SETRANGE(Origin, ProjectMaterialReqLine.Origin::"Advice Order");
          IF (ProjectMaterialReqLine.COUNT > 0) THEN BEGIN
            IF (NOT CONFIRM(Text002, FALSE, Job.FIELDCAPTION("No."), Job."No.")) THEN
              EXIT;
          END;
          DeleteMatReqLines(Job."No.");
        UNTIL (Job.NEXT = 0);

      AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::Project);
      AdviceOrderLine.SETFILTER("Project No.", '%1', ProjectNoFilter);
      AdviceOrderLine.SETFILTER("Process Status", '%1|%2',
        AdviceOrderLine."Process Status"::Released, AdviceOrderLine."Process Status"::Processed);
      IF AdviceOrderLine.FINDSET THEN REPEAT
        GenerateAdvOrderToMatReqLine(AdviceOrderLine);
        NoOfLinesGenerated += 1;
      UNTIL (AdviceOrderLine.NEXT = 0);
      MESSAGE(Text007, NoOfLinesGenerated);
    END;

    LOCAL PROCEDURE GenerateAdvOrderToMatReqLine@1100525019(AdviceOrderLine@1100525000 : Record 11012055);
    VAR
      ProjectMaterialReqLine@1100525001 : Record 11012526;
    BEGIN
      ProjectMaterialReqLine.INIT;

      ProjectMaterialReqLine."Project No." := AdviceOrderLine."Project No.";
      ProjectMaterialReqLine.Element := AdviceOrderLine.Element;
      ProjectMaterialReqLine."Yard No." := AdviceOrderLine."Yard No.";
      ProjectMaterialReqLine."Entity Type" := AdviceOrderLine."Entity Type";
      ProjectMaterialReqLine."System No." := AdviceOrderLine."System No.";
      ProjectMaterialReqLine."Entity No." := AdviceOrderLine."Entity No.";
      ProjectMaterialReqLine.Origin := ProjectMaterialReqLine.Origin::"Advice Order";
      ProjectMaterialReqLine."Cable Transit Pos." := AdviceOrderLine."Cable Transit Pos.";
      ProjectMaterialReqLine."Item No." := AdviceOrderLine."Item No.";
      ProjectMaterialReqLine."Basic Item" := AdviceOrderLine."Basic Item";
      ProjectMaterialReqLine."Trade Item" := AdviceOrderLine."Trade Item";
      ProjectMaterialReqLine."Vendor (Trade Item)" := AdviceOrderLine."Vendor (Trade Item)";
      ProjectMaterialReqLine.Manufacturer := AdviceOrderLine.Manufacturer;
      ProjectMaterialReqLine.Description := AdviceOrderLine.Description;
      ProjectMaterialReqLine.Description2 := AdviceOrderLine."Description 2";
      ProjectMaterialReqLine."Variant Code" := AdviceOrderLine."Variant Code";
      ProjectMaterialReqLine."Item Category Code" := AdviceRec."Item Category Code";
      ProjectMaterialReqLine.Quantity :=  AdviceOrderLine."Quantity (Advice)";
      IF (AdviceOrderLine."Process Status" = AdviceOrderLine."Process Status"::Processed) THEN
        ProjectMaterialReqLine.Quantity :=  AdviceOrderLine."Quantity (Processed)";
      ProjectMaterialReqLine."Unit of Measure" := AdviceOrderLine."Unit of Measure";
      ProjectMaterialReqLine."Cost Object" := AdviceOrderLine."Cost Object";
      ProjectMaterialReqLine."Delivery Date" := AdviceOrderLine."Receipt Date";
      ProjectMaterialReqLine."Unique Traceable" := TRUE;
      ProjectMaterialReqLine."Exclude Logistics" := FALSE;
      ProjectMaterialReqLine."Item Operation Code" := AdviceOrderLine."Item Operation Code";
      ProjectMaterialReqLine."Location Code" := AdviceOrderLine."Location Code";
      ProjectMaterialReqLine."Bin Code" := AdviceOrderLine."Bin Code";

      ProjectMaterialReqLine.INSERT(TRUE);
    END;

    LOCAL PROCEDURE DeleteMatReqLines@1100525020(ProjectNo@1100525000 : Code[20]);
    VAR
      ProjectMaterialReqLine@1100525001 : Record 11012526;
    BEGIN
      ProjectMaterialReqLine.SETRANGE("Project No.", ProjectNo);
      ProjectMaterialReqLine.SETRANGE(Origin, ProjectMaterialReqLine.Origin::"Advice Order");
      ProjectMaterialReqLine.DELETEALL;
    END;

    PROCEDURE CheckStatusAndElementMandatory@1100525021();
    VAR
      PlantSetup@1210190000 : Record 11012550;
      PlantLocation@1210190001 : Record 11012554;
      CheckElementMandatory@1210190002 : Boolean;
    BEGIN
      IF ("Process Status" = "Process Status"::Released) OR ("Process Status" = "Process Status"::"Pending Approval") THEN BEGIN
        IF ("Record Type" = "Record Type"::Project) AND
           (Element = '') THEN
        BEGIN
          IF "Plant Location" <> '' THEN BEGIN
            IF "Plant Company" <> '' THEN BEGIN
              PlantSetup.CHANGECOMPANY("Plant Company");
              PlantLocation.CHANGECOMPANY("Plant Company");
            END;
            PlantSetup.GET;
            IF PlantSetup."Plant - Element Mandatory" THEN BEGIN
              PlantLocation.GET("Plant Location");
              IF PlantLocation."Project No." = "Project No." THEN
                CheckElementMandatory := TRUE;
            END;
          END ELSE
            CheckElementMandatory := TRUE;
          IF CheckElementMandatory THEN
            IF ProjRec.GET("Project No.") THEN
              IF ProjRec."Posting Element Mandatory" THEN
                FIELDERROR(Element);
        END;

        IF ((Transaction = Transaction::Purchase) OR (Transaction = Transaction::Requisition)) AND
           (Vendor = '')
        THEN
          FIELDERROR(Vendor);

        IF ("Quantity (Advice)" = 0) THEN
          FIELDERROR("Quantity (Advice)");

        IF ("Cost Object" = '') THEN
          FIELDERROR("Cost Object");
      END;
    END;

    PROCEDURE DivideAgreedAmount@1100530000(VAR IAdviceOrderLine@1100525000 : Record 11012055);
    VAR
      AdviceOrderLine@1100530000 : Record 11012055;
      AdviceOrderAgreedAmountForm@1100530003 : Page 11124962;
      GeneralLedgerSetup@1100530006 : Record 98;
      TotalAmount@1100530001 : Decimal;
      AgreedAmount@1100530002 : Decimal;
      LineAmount@1100530004 : Decimal;
      LinePrice@1100530005 : Decimal;
    BEGIN
      GeneralLedgerSetup.GET;

      AdviceOrderLine.COPY(IAdviceOrderLine);
      IF NOT AdviceOrderLine.FINDSET THEN
        ERROR(Text013);

      AdviceOrderLine.SETFILTER("Amount (LCY)", '<>%1', 0);
      AdviceOrderLine.SETFILTER("Quantity (Advice)", '<>%1', 0);
      REPEAT
        TotalAmount += AdviceOrderLine."Amount (LCY)";
      UNTIL AdviceOrderLine.NEXT = 0;

      IF TotalAmount = 0 THEN
        ERROR(Text009);

      AdviceOrderAgreedAmountForm.SetDefaults(TotalAmount);
      IF AdviceOrderAgreedAmountForm.RUNMODAL <> ACTION::OK THEN
        EXIT;

      AdviceOrderAgreedAmountForm.GetDefaults(AgreedAmount);

      IF AgreedAmount = 0 THEN
        ERROR(Text010);

      PurchSetup.GET;
      AdviceOrderLine.FINDSET(TRUE);
      REPEAT
        LineAmount := AdviceOrderLine."Amount (LCY)" * (1 + (AgreedAmount - TotalAmount) / TotalAmount);
        LinePrice := ROUND(LineAmount / AdviceOrderLine."Quantity (Advice)", GeneralLedgerSetup."Unit-Amount Rounding Precision");
        AdviceOrderLine.VALIDATE("Price (LCY)", LinePrice);
        IF PurchSetup."Price Agreement" <> PurchSetup."Price Agreement"::" " THEN
          AdviceOrderLine.VALIDATE("Price Agreement", TRUE);
        AdviceOrderLine.MODIFY;
      UNTIL AdviceOrderLine.NEXT = 0;

      AdviceOrderLine.FINDSET;
      TotalAmount := 0;
      REPEAT
        TotalAmount += AdviceOrderLine."Amount (LCY)";
      UNTIL AdviceOrderLine.NEXT = 0;

      IF TotalAmount <> AgreedAmount THEN BEGIN
        AdviceOrderLine.VALIDATE("Price (LCY)", AdviceOrderLine."Price (LCY)" + (AgreedAmount - TotalAmount) / AdviceOrderLine."Quantity (Advice)");
        AdviceOrderLine.MODIFY();
      END;

      IAdviceOrderLine.CLEARMARKS;
    END;

    PROCEDURE SetCalledFromCompressingLines@1100526102(CalledFromFlag@1100526100 : Boolean);
    BEGIN
      CalledFromCompressingLines := CalledFromFlag;
    END;

    PROCEDURE HasDocumentLinks@1210190007() : Boolean;
    VAR
      DocumentLink@1100528400 : Record 11012747;
      DocumentLinkMgt@1100525000 : Codeunit 11012401;
      RecRef@1100525001 : RecordRef;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DocumentLink) THEN
        EXIT(FALSE);

      RecRef.GETTABLE(Rec);
      EXIT(DocumentLinkMgt.EntityHasDocumentLinks(RecRef));
    END;

    PROCEDURE CheckRecipeTotals@1210190009();
    VAR
      AdviceOrderLine@1210190000 : Record 11012055;
      OldQuan@1210190001 : Decimal;
      NewQuan@1210190002 : Decimal;
    BEGIN
      IF "Source Type" <> "Source Type"::"Recipe Header" THEN EXIT;

      //DP02339.sn
      OldQuan := xRec."Quantity (Advice)";
      NewQuan := "Quantity (Advice)";
      //DP02339.en

      //C057070.sn
      AdviceOrderLine.SETRANGE("Record Type", "Record Type");
      AdviceOrderLine.SETRANGE("Project No.", "Project No.");
      AdviceOrderLine.SETRANGE("Service Order No.", "Service Order No.");
      AdviceOrderLine.SETRANGE("G/L Account", "G/L Account");
      //C057070.en
      AdviceOrderLine.SETRANGE("Source Type", AdviceOrderLine."Source Type"::"Recipe Line");
      AdviceOrderLine.SETRANGE("Recipe Group", "Recipe Group");
      AdviceOrderLine.SETRANGE(Recipe, Recipe);
      AdviceOrderLine.SETRANGE("Attached to Line No.", "Line No.");
      IF AdviceOrderLine.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF OldQuan = 0 THEN
            AdviceOrderLine.VALIDATE("Quantity (Advice)", AdviceOrderLine."Original Quantity" * NewQuan)  //DP02339
          ELSE
            AdviceOrderLine.VALIDATE("Quantity (Advice)", AdviceOrderLine."Quantity (Advice)" * NewQuan / OldQuan);
          AdviceOrderLine.MODIFY(TRUE);
        UNTIL AdviceOrderLine.NEXT = 0;
      END;
    END;

    PROCEDURE CheckBomLines@1100529400();
    VAR
      AdviceOrderLine@1210190000 : Record 11012055;
      OldQuan@1210190001 : Decimal;
      NewQuan@1210190002 : Decimal;
    BEGIN
      IF ("BOM Item No." = '') THEN EXIT;
      IF ("Level BOM" <> 0) THEN EXIT;

      //DP02339.sn
      OldQuan := xRec."Quantity (Advice)";
      NewQuan := "Quantity (Advice)";
      //DP02339.en

      //C057070.sn
      AdviceOrderLine.SETRANGE("Record Type", "Record Type");
      AdviceOrderLine.SETRANGE("Project No.", "Project No.");
      AdviceOrderLine.SETRANGE("Service Order No.", "Service Order No.");
      AdviceOrderLine.SETRANGE("G/L Account", "G/L Account");
      //C057070.en
      AdviceOrderLine.SETRANGE("BOM Item No.", "BOM Item No.");
      AdviceOrderLine.SETRANGE("Part of Line", "Line No.");
      IF AdviceOrderLine.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF OldQuan = 0 THEN
            AdviceOrderLine."Quantity (Advice)" := AdviceOrderLine."Original Quantity" * NewQuan  //DP02339
          ELSE
            AdviceOrderLine."Quantity (Advice)" := AdviceOrderLine."Quantity (Advice)" * NewQuan / OldQuan;
          AdviceOrderLine.MODIFY(TRUE);
        UNTIL AdviceOrderLine.NEXT = 0;
      END;
    END;

    PROCEDURE SetCostComponent@1210190013();
    VAR
      DimensionValue@1210190000 : Record 349;
    BEGIN
      DimensionValue.SETCURRENTKEY(Code, "Global Dimension No.");
      DimensionValue.SETRANGE(Code, "Cost Object");
      DimensionValue.SETRANGE("Global Dimension No.", 2);
      IF (DimensionValue.FINDSET) THEN
        VALIDATE("Cost Component", DimensionValue."Cost Component");
    END;

    PROCEDURE DeleteCommentLine@1100529800();
    VAR
      CommentLine@1100529800 : Record 11020634;
      RecRef@1100529801 : RecordRef;
    BEGIN
      RecRef.GETTABLE(Rec);
      CommentLine.RESET;
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::"Advice Order");
      CommentLine.SETFILTER("Record ID", FORMAT(RecRef.RECORDID()));
      CommentLine.DELETEALL(TRUE);
    END;

    PROCEDURE CommentLineExist@1210190011() : Boolean;
    VAR
      RecRef@1210190000 : RecordRef;
      CommentLine@1210190001 : Record 11020634;
    BEGIN
      RecRef.GETTABLE(Rec);
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::"Advice Order");
      CommentLine.SETFILTER("Record ID", FORMAT(RecRef.RECORDID()));
      IF NOT CommentLine.ISEMPTY THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE DeleteDocumentLinks@1100528400();
    VAR
      DocumentLink@1100528402 : Record 11012747;
      DocumentLinkMgt@1100528400 : Codeunit 11012401;
      RecRef@1100528401 : RecordRef;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DocumentLink) THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DocumentLinkMgt.DeleteDocumentLinksFromObject(RecRef);
    END;

    LOCAL PROCEDURE ClearEditableAssemYardNoFields@1100528405();
    BEGIN
      IF "Project No." <> xRec."Project No." THEN BEGIN
        "Entity Type" := "Entity Type"::None;
        "Entity No." := '';
      END;
    END;

    LOCAL PROCEDURE ValidateEntityType@1100528408();
    VAR
      Job@1100528400 : Record 11072003;
    BEGIN
      IF "Entity Type" <> "Entity Type" ::None THEN BEGIN
        Job.GET("Project No.");
        Job.TESTFIELD("Assembly Project", TRUE);
      END;

      IF "Entity Type" <> xRec."Entity Type" THEN
        "Entity No." := '';
    END;

    PROCEDURE CheckMessageOpenAdvice@1210190014();
    VAR
      ProjSetup@1210190000 : Record 315;
    BEGIN
      ProjSetup.GET;
      IF NOT ProjSetup."Message after Reopen Adv Order" THEN EXIT;

      IF ("Process Status" = "Process Status"::Open) AND
         (xRec."Process Status" <> "Process Status"::Open) THEN
        MESSAGE(Text011);
    END;

    PROCEDURE BalanceDatesAndDeliveryPeriod@1210190018(FromFieldNo@1210190000 : Integer);
    VAR
      FieldToCalculate@1210190001 : 'None,ReceiptDate,OrderDate';
    BEGIN
      CASE FromFieldNo OF
        FIELDNO("Order Date"):
          BEGIN
            IF ("Order Date" <> 0D) AND ("Order Date" < TODAY) THEN
              "Order Date" := TODAY;
            FieldToCalculate := FieldToCalculate::ReceiptDate;
          END;
        FIELDNO("Delivery Period"):
          BEGIN
            IF ("Delivery Period" = '') AND (CurrFieldNo <> FIELDNO("Delivery Period")) THEN BEGIN
              //get default period if validate forced by functional switch, but allow empty field
              IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN
                "Delivery Period" := ValidateCu.GetDeliveryTimeItem("Item No.", Manufacturer, "Basic Item", "Vendor (Trade Item)",
                  "Trade Item", 0, '', Vendor)
              ELSE
                "Delivery Period" := GetDeliveryPeriodLocation("Location Code");
            END;
            //validation
            IF "Delivery Period" <> '' THEN
              FieldToCalculate := FieldToCalculate::OrderDate;
            IF RecalcReceiptDate THEN
              FieldToCalculate := FieldToCalculate::ReceiptDate;
          END;
        FIELDNO("Receipt Date"):
          BEGIN
            IF ("Receipt Date" <> 0D) AND ("Receipt Date" < TODAY) THEN
              "Receipt Date" := TODAY;
            IF "Receipt Date" <> xRec."Receipt Date" THEN
              FieldToCalculate := FieldToCalculate::OrderDate;
          END;
      END;

      CASE FieldToCalculate OF
        FieldToCalculate::ReceiptDate:
          BEGIN
            IF "Delivery Period" = '' THEN
              "Receipt Date" := "Order Date"
            ELSE
              "Receipt Date" := CalendarMgmt.CalcDateBOC(
                 '+' + "Delivery Period", "Order Date",
                 CalChange."Source Type"::Vendor, Vendor, '',
                 CalChange."Source Type"::Location, "Location Code", '', FALSE);
          END;
        FieldToCalculate::OrderDate:
          BEGIN
            IF "Delivery Period" = '' THEN
              "Order Date" := "Receipt Date"
            ELSE
              "Order Date" := CalendarMgmt.CalcDateBOC(
                 '-' + "Delivery Period", "Receipt Date",
                 CalChange."Source Type"::Vendor, Vendor, '',
                 CalChange."Source Type"::Location, "Location Code", '', FALSE);
            VALIDATE("Order Date");
          END;
      END;
    END;

    PROCEDURE FillDefaultFscType@1100529000();
    BEGIN
      IF ("Cost Object" = '') OR ("Project No."= '') THEN
        EXIT;
      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, FALSE, '');
      IF NOT DimValRec."FSC Applicable" THEN
        EXIT;
      IF NOT ProjRec.GET("Project No.") THEN
        EXIT;
      IF ProjRec."FSC Type Code" <> '' THEN
        "FSC Type Code" :=  ProjRec."FSC Type Code";
    END;

    LOCAL PROCEDURE CheckEntityNo@1100528401();
    VAR
      JobsSetup@1100528400 : Record 315;
    BEGIN
      IF "Entity Type" = "Entity Type"::None THEN
        EXIT;

      IF JobsSetup.GET AND
         JobsSetup."Entity No. Mandatory"
      THEN
        TESTFIELD("Entity No.");
    END;

    PROCEDURE QtyReservedInventory@1100525026() : Decimal;
    VAR
      ItemJnlLine@1100525000 : Record 83;
      TotalQty@1100525001 : Decimal;
    BEGIN
      //DP00629
      IF AdvOrderLineLinkWithInventory() THEN BEGIN
        SetLinkToItemJnlLines(ItemJnlLine);
        IF ItemJnlLine.FINDSET THEN BEGIN
          REPEAT
            TotalQty := TotalQty + ItemJnlLine.Quantity;
          UNTIL ItemJnlLine.NEXT = 0;
        END;
      END;
      EXIT(TotalQty);
    END;

    PROCEDURE QtyDeliveredInventory@1100525028() : Decimal;
    VAR
      ItemLedgEntry@1100525000 : Record 32;
      TotalQty@1100525001 : Decimal;
    BEGIN
      //DP00629
      IF AdvOrderLineLinkWithInventory THEN BEGIN
        SetLinkToItemLedgEntries(ItemLedgEntry);
        IF ItemLedgEntry.FINDSET THEN BEGIN
          REPEAT
            TotalQty := TotalQty + -ItemLedgEntry.Quantity;
          UNTIL ItemLedgEntry.NEXT = 0;
        END;
      END;
      EXIT(TotalQty);
    END;

    PROCEDURE DrilDownReservedInventory@1100525031();
    VAR
      ItemJnlLine@1100525000 : Record 83;
    BEGIN
      //DP00629
      IF AdvOrderLineLinkWithInventory() THEN BEGIN
        SetLinkToItemJnlLines(ItemJnlLine);
        PAGE.RUNMODAL(0, ItemJnlLine);
      END;
    END;

    PROCEDURE DrillDownDeliveredInventory@1100525032();
    VAR
      ItemLedgEntry@1100525000 : Record 32;
    BEGIN
      //DP00629
      IF AdvOrderLineLinkWithInventory() THEN BEGIN
        SetLinkToItemLedgEntries(ItemLedgEntry);
        PAGE.RUNMODAL(0, ItemLedgEntry);
      END;
    END;

    LOCAL PROCEDURE AdvOrderLineLinkWithInventory@1100525033() : Boolean;
    BEGIN
      //DP00629
      EXIT(
        (Transaction = Transaction::Inventory) AND
        ("Item No." <> '') AND
        ("Purchase Route Reference" <> ''));
    END;

    LOCAL PROCEDURE SetLinkToItemJnlLines@1100525034(VAR ItemJnlLine@1100525000 : Record 83);
    BEGIN
      //DP00629
      ItemJnlLine.RESET;
      ItemJnlLine.SETCURRENTKEY("Item No.");
      ItemJnlLine.SETRANGE("Item No.", "Item No.");
      ItemJnlLine.SETRANGE("Purchase Route Reference", "Purchase Route Reference");
      CASE "Record Type" OF
        "Record Type"::Project:
          ItemJnlLine.SETRANGE("Job No.", "Project No.");
        "Record Type"::ServOrder:
          ItemJnlLine.SETRANGE("Service Order No.", "Service Order No.");
      END;
    END;

    LOCAL PROCEDURE SetLinkToItemLedgEntries@1100525035(VAR ItemLedgEntry@1100525000 : Record 32);
    BEGIN
      //DP00629
      ItemLedgEntry.RESET;
      ItemLedgEntry.SETCURRENTKEY("Item No.");
      ItemLedgEntry.SETRANGE("Item No.", "Item No.");
      ItemLedgEntry.SETRANGE("Purchase Route Reference", "Purchase Route Reference");
      CASE "Record Type" OF
        "Record Type"::Project:
          ItemLedgEntry.SETRANGE("Job No.", "Project No.");
        "Record Type"::ServOrder:
          ItemLedgEntry.SETRANGE("Service Order No.", "Service Order No.");
      END;
    END;

    LOCAL PROCEDURE ValidateShipToLocation@1100528000(GiveMessage@1100528000 : Boolean) ShipToLocIsValid : Boolean;
    VAR
      OrderAddress@1100528001 : Record 224;
    BEGIN
      //C019936
      ShipToLocIsValid := TRUE;
      CASE Deliver OF
        Deliver::" ":
          BEGIN
            IF "Ship To Location" <> '' THEN
              IF GiveMessage THEN
                ERROR(Text003, FIELDCAPTION(Deliver))
              ELSE
                ShipToLocIsValid := FALSE;
          END;
        Deliver::Location:
          BEGIN
            IF "Ship To Location" = '' THEN
              IF GiveMessage THEN
                ERROR(Text003, FIELDCAPTION("Ship To Location"))
              ELSE
                ShipToLocIsValid := FALSE
            ELSE
              IF GiveMessage THEN
                LocRec.GET("Ship To Location")
              ELSE
                ShipToLocIsValid := LocRec.GET("Ship To Location");
          END;
        Deliver::"Project Location":
          BEGIN
            IF "Ship To Location" = '' THEN
              IF GiveMessage THEN
                ERROR(Text003, FIELDCAPTION("Ship To Location"))
              ELSE
                ShipToLocIsValid := FALSE
            ELSE
              IF GiveMessage THEN
                ProjLocRec.GET("Project No.", "Ship To Location")
              ELSE
                ShipToLocIsValid := ProjLocRec.GET("Project No.", "Ship To Location");
          END;
        Deliver::"Service Location":  //C029620
          BEGIN
            IF NOT ServOrderRec.GET("Service Order No.") THEN
              ServOrderRec.INIT;
            IF ("Ship To Location" <> '') OR //Empty allowed
               ServOrderRec.ServiceLocationHasDefaultShipToAddress
            THEN
              IF GiveMessage THEN
                ServOrderLocRec.GET("Service Order No.", "Ship To Location")
              ELSE
                ShipToLocIsValid := ServOrderLocRec.GET("Service Order No.", "Ship To Location");
          END;
        Deliver::"Order Address":
          BEGIN
            IF GiveMessage THEN
              OrderAddress.GET(Vendor, "Ship To Location")
            ELSE
              ShipToLocIsValid := OrderAddress.GET(Vendor, "Ship To Location");
          END;
      END;
    END;

    LOCAL PROCEDURE GetDefaultShipToLocation@1100528004();
    VAR
      ProjSetup@1100528000 : Record 315;
    BEGIN
      //C019936
      "Ship To Location" := '';

      CASE Deliver OF
        Deliver::Location:
          BEGIN
            IF "Record Type" = "Record Type"::Project THEN BEGIN
              ProjRec.GET("Project No.");
              IF ProjRec.Deliver = ProjRec.Deliver::Location THEN
                "Ship To Location" := ProjRec."Ship To Location";
            END;
            IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
              ServOrderRec.GET("Service Order No.");
              IF NOT ServLocRec.GET(ServOrderRec."Service Location No.") THEN
                ServLocRec.INIT;
              IF ServLocRec.Deliver = ServLocRec.Deliver::Location THEN
                "Ship To Location" := ServLocRec."Ship To Location";
              IF ServLocRec."Ship To Location" = '' THEN BEGIN
                ProjSetup.GET;
                IF ProjSetup.Deliver = ProjSetup.Deliver::Location THEN
                  "Ship To Location" := ProjSetup."Ship To Location";
              END;
            END;
          END;
        Deliver::"Service Location":
          IF ServOrderRec.GET("Service Order No.") THEN
            "Ship To Location" := ServOrderRec.GetDefaultServiceOrderLocationCode;
        Deliver::"Project Location":
          BEGIN
            ProjRec.GET("Project No.");
            IF ProjRec.Deliver = ProjRec.Deliver::"Project Location" THEN BEGIN
              IF ProjRec."Ship To Location" <> '' THEN
                "Ship To Location" := ProjRec."Ship To Location"
              ELSE BEGIN
                ProjLocRec.RESET;
                ProjLocRec.SETRANGE("Project No.", "Project No.");
                IF ProjLocRec.FINDFIRST THEN
                  IF ProjLocRec.NEXT = 0 THEN
                    "Ship To Location" := ProjLocRec.Code;
              END;
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE DoGetDefaultProjBin@1100528001(ProjBin@1100528000 : Code[20]) : Boolean;
    BEGIN
      //C019936
      IF (ProjBin = '') OR
         ("Project No." <> xRec."Project No.") OR
         ("Item No." <> xRec."Item No.") OR
         ("Variant Code" <> xRec."Variant Code") THEN
        EXIT(TRUE);

      IF (Transaction = Transaction::Inventory) AND (xRec.Transaction = xRec.Transaction::Purchase) AND
         ("Location Code" = xRec."Ship To Location") THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE LookupItemVendor@1100528402(VendorIsEditable@1100528401 : Boolean);
    VAR
      ItemVendor@1100528400 : Record 99;
    BEGIN
      ItemVendor.SETRANGE("Item No.", "Item No.");
      ItemVendor."Item No." := "Item No.";
      ItemVendor."Vendor No." := Vendor;
      IF PAGE.RUNMODAL(0, ItemVendor) = ACTION::LookupOK THEN BEGIN
        IF VendorIsEditable THEN BEGIN
          VALIDATE(Vendor, ItemVendor."Vendor No.");
          //C049836.sn
          IF ItemVendor."Source Type" = ItemVendor."Source Type"::"Trade Item" THEN BEGIN
            "Vendor (Trade Item)" := ItemVendor."Vendor (Trade Item)";
            VALIDATE("Trade Item", ItemVendor."Vendor Item No.");
            "Item No." := ItemVendor."Item No.";
          END;
          //C049836.en
        END;
      END;
    END;

    LOCAL PROCEDURE FillPlantPurchOrRentPrefVendor@1100525027();
    VAR
      PlantType@1100525001 : Record 11012551;
      PlantVendor@1100525000 : Record 11012596;
      Vend@1100529000 : Record 23;
    BEGIN
      //C021779
      IF ("Plant Type" = '') OR (Transaction <> Transaction::Purchase) THEN
        EXIT;
      IF "Plant Company" <> '' THEN BEGIN
        PlantType.CHANGECOMPANY("Plant Company");
        PlantVendor.CHANGECOMPANY("Plant Company");
      END;
      IF NOT PlantType.GET("Plant Type") THEN
        EXIT;
      PlantVendor.SETRANGE("Plant Type", "Plant Type");
      IF PlantType.External THEN
        PlantVendor.SETRANGE(Type, PlantVendor.Type::Rent)
      ELSE
        PlantVendor.SETRANGE(Type, PlantVendor.Type::Purchase);
      PlantVendor.SETRANGE("Preferred Vendor", TRUE);
      PlantVendor.SETFILTER("Vendor No.", '<>%1', '');
      IF PlantVendor.FINDFIRST THEN BEGIN
        IF PlantVendor."Vendor No." <> Vendor THEN BEGIN
          IF Vend.GET(PlantVendor."Vendor No.") THEN BEGIN
            Vendor := PlantVendor."Vendor No.";
            VALIDATE(Vendor);
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE GetPlantPurchaseOrRentRate@1100525022();
    VAR
      PlantType@1100525003 : Record 11012551;
      PurchHead@1100525001 : Record 38;
      PurchLine@1100525002 : Record 39;
      PurchPriceCalcMgt@1100525000 : Codeunit 7010;
      TypeNo@1100525004 : Integer;
    BEGIN
      //C021779
      IF ("Plant Type" = '') OR (Transaction <> Transaction::Purchase) OR (Vendor = '') THEN
        EXIT;
      IF NOT PlantType.GET("Plant Type") THEN
        EXIT;
      IF PlantType.External THEN
        TypeNo := 2   // Rent
      ELSE
        TypeNo := 1;  // Purchase

      IF "Unit of Measure" <> PlantType."Unit of Measure" THEN
        "Unit of Measure" := PlantType."Unit of Measure";

      PurchHead.INIT;
      PurchHead."Document Type" := PurchHead."Document Type"::Order;
      PurchHead."Buy-from Vendor No."  := Vendor;
      PurchHead."Pay-to Vendor No."  := Vendor;
      PurchHead."Currency Code" := '';
      PurchHead."Prices Including VAT" := FALSE;
      IF "Order Date" = 0D THEN
        PurchHead."Order Date" := TODAY
      ELSE
        PurchHead."Order Date" := "Order Date";

      PurchLine.INIT;
      PurchLine."Document Type" := PurchHead."Document Type";
      PurchLine."Buy-from Vendor No."  := Vendor;
      PurchLine."Pay-to Vendor No."  := Vendor;
      PurchLine."Plant Type" := "Plant Type";
      PurchLine."Plant No." := '';
      PurchLine."Receiving Company" := "Plant Company";
      PurchLine.Quantity := "Quantity (Advice)";
      PurchLine."Qty. per Unit of Measure" := 1;
      PurchLine."Unit of Measure Code" := "Unit of Measure";
      PurchLine."Direct Unit Cost" := 0;
      PurchLine."Line Discount %" := 0;

      "Price (LCY)" := 0;
      IF PurchPriceCalcMgt.FindPurchLinePricePlant(PurchHead, PurchLine, 0, -TypeNo) > 0 THEN BEGIN // Neg. TypeMo
        "Price (LCY)" := PurchLine."Direct Unit Cost";
        IF PurchPriceCalcMgt.FindPurchLineLineDiscPlant(PurchHead, PurchLine, TypeNo) > 0 THEN
          "Price (LCY)" := "Price (LCY)" - (PurchLine."Line Discount %" / 100 * "Price (LCY)");
      END;
      VALIDATE("Price (LCY)");
    END;

    LOCAL PROCEDURE CheckCurrencyAgreement@1100525025();
    BEGIN
      IF "Currency Code" = '' THEN  BEGIN
        "Currency Agreement" := FALSE;
      END ELSE BEGIN
        ProjRec.GET("Project No.");
        IF CurrFieldNo = FIELDNO("Currency Code") THEN //C054524
          "Currency Agreement" := ("Currency Code" <> ProjRec."Currency Code");
      END;
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      //DP00884
      SkipValidateFCY := ISkipValidateFCY;
    END;

    PROCEDURE ValidateUnitOfMeasure@1100528403(UnitOfMeasureCode@1100528400 : Code[10]);
    BEGIN
      "Unit of Measure" := UnitOfMeasureCode;
      IF "Unit of Measure" <>  xRec."Unit of Measure" THEN
        CheckItemUnitConversion(Rec, xRec);
    END;

    PROCEDURE ApprovalEntriesExist@1100528200() : Boolean;
    VAR
      ApprovalsMgmt@1100528200 : Codeunit 1535;
    BEGIN
      EXIT(ApprovalsMgmt.HasOpenOrPendingApprovalEntries(RECORDID));
    END;

    PROCEDURE EditLineDetails@1100528900(PageEditable@1100529602 : Boolean) NeedUpdate : Boolean;
    VAR
      PurchaseLineDetail@1210190000 : Record 11020660;
      QuantityOld@1100529600 : Decimal;
      QuantityNew@1100529601 : Decimal;
    BEGIN
      PurchSetup.GET;
      IF PurchSetup."Calc Qty (Adv) Based On Detail" THEN
        QuantityOld := PurchaseLineDetail.GetCalculatedQuantity(PurchaseLineDetail."Line Type"::"Advice Order",
          "Record Type", "Project No.", "Yard No.", "System No.",
          "Entity Type", "Entity No.", "Service Order No.", '', "Line No.");
      PurchaseLineDetail.ShowCard(PurchaseLineDetail."Line Type"::"Advice Order",
        "Record Type", "Project No.", "Yard No.", "System No.",
        "Entity Type", "Entity No.", "Service Order No.", '', "Line No.", PageEditable);
      IF PurchSetup."Calc Qty (Adv) Based On Detail" THEN BEGIN
        QuantityNew := PurchaseLineDetail.GetCalculatedQuantity(PurchaseLineDetail."Line Type"::"Advice Order",
          "Record Type", "Project No.", "Yard No.", "System No.",
          "Entity Type", "Entity No.", "Service Order No.", '', "Line No.");
        IF QuantityOld <> QuantityNew THEN BEGIN
          VALIDATE("Quantity (Advice)", QuantityNew);
          MODIFY(TRUE);
          EXIT(TRUE);
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE EditCommentLines@1100528901();
    VAR
      CommentLine@1100529800 : Record 11020634;
      RecRef@1100529801 : RecordRef;
      RID@1100529802 : RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      RID := RecRef.RECORDID();
      CommentLine.EditCommentLines(2, RID);
    END;

    PROCEDURE CheckLocationBlocked@1100527000(ILocationCode@1100527000 : Code[10]);
    VAR
      Location@1100527001 : Record 14;
    BEGIN
      IF Location.GET(ILocationCode) THEN
        Location.TESTFIELD(Blocked,FALSE);
    END;

    PROCEDURE CheckItemInPlantCompany@1100529005();
    VAR
      Item@1100529000 : Record 27;
    BEGIN
      IF (Transaction = Transaction::Plant) AND ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) AND ("Item No." <> '') AND ("Plant Type" = '') THEN BEGIN
        //Must also be present in the plant company, so in both companies (current+plant company)
        Item.CHANGECOMPANY("Plant Company");
        IF NOT Item.GET("Item No.") THEN
          FIELDERROR("Item No.", STRSUBSTNO(Text006, "Item No.", FIELDCAPTION("Plant Company"), "Plant Company"));
      END;
    END;

    PROCEDURE AdviceOrderFieldsEditable@1100529004() : Boolean;
    VAR
      JobsSetup@1100529000 : Record 315;
    BEGIN
      JobsSetup.GET;
      IF JobsSetup."Released AdvOrder not editable" THEN
        EXIT("Process Status" < "Process Status"::Released)
      ELSE
        EXIT("Process Status" <> "Process Status"::"Pending Approval");
    END;

    PROCEDURE AdviceOrderProcessStatusEditable@1100528201() : Boolean;
    BEGIN
      CASE "Process Status" OF
        "Process Status"::Open,
        "Process Status"::"Partly Processed",
        "Process Status"::Released,
        "Process Status"::Cancelled,
        "Process Status"::"On Hold":
          BEGIN
            EXIT(TRUE);
          END;
        "Process Status"::Processed,
        "Process Status"::"Pending Approval":
          BEGIN
            EXIT(FALSE);
          END;
      END;
    END;

    LOCAL PROCEDURE FillDefaultPlantCompany@1100529007();
    VAR
      PlantMgtCompany@1100529000 : Record 11020586;
      TmpPlantMgtCompany@1100529001 : TEMPORARY Record 11020586;
      NoOfPlantCompanies@1100529002 : Integer;
    BEGIN
      CASE "Record Type" OF
        "Record Type"::Project:
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', TRUE);
        "Record Type"::ServOrder:
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForService("Service Order No.", TmpPlantMgtCompany, '', TRUE);
      END;
      CASE TRUE OF
        NoOfPlantCompanies = 0:
          VALIDATE("Plant Company", '');
        NoOfPlantCompanies = 1:
          BEGIN
            TmpPlantMgtCompany.FINDFIRST;
            IF TmpPlantMgtCompany."Plant Company" = COMPANYNAME THEN
              VALIDATE("Plant Company", '')
            ELSE
              VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
          END;
        NoOfPlantCompanies > 1:
          BEGIN
            TmpPlantMgtCompany.SETRANGE(Default, TRUE);
            IF NOT TmpPlantMgtCompany.FINDFIRST THEN
              VALIDATE("Plant Company", '')
            ELSE BEGIN
              IF TmpPlantMgtCompany."Plant Company" = COMPANYNAME THEN
                VALIDATE("Plant Company", '')
              ELSE
                VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE FillDefaultPlantLocation@1100529009();
    VAR
      PlantLocation@1100529000 : Record 11012554;
      PlantLocCompany@1100529001 : Text;
    BEGIN
      IF ("Record Type" = "Record Type"::Project) AND ("Project No." <> '') OR
         ("Record Type" = "Record Type"::ServOrder) AND ("Service Order No." <> '')
      THEN BEGIN
        PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.");
        IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
          PlantLocCompany := COMPANYNAME;
          PlantLocation.CHANGECOMPANY("Plant Company");
        END;
        PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
        PlantLocation.SETRANGE("Company Name", PlantLocCompany);
        IF "Record Type" = "Record Type"::Project THEN BEGIN
          PlantLocation.SETRANGE("Project No.", "Project No.");
          PlantLocation.SETRANGE( "Service Order No.", '');
        END;
        IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
          PlantLocation.SETRANGE("Project No.", '');
          PlantLocation.SETRANGE( "Service Order No.", "Service Order No.");
        END;
        IF PlantLocation.FINDFIRST THEN BEGIN
          IF PlantLocation.NEXT = 0 THEN
            VALIDATE("Plant Location", PlantLocation.Code);
        END;
      END;
    END;

    PROCEDURE LookupPlantCompany@1100529002();
    VAR
      PlantMgtCompany@1100525001 : Record 11020586;
      TmpPlantMgtCompany@1100525002 : TEMPORARY Record 11020586;
      EditableMode@1100529000 : Boolean;
      NoOfPlantCompanies@1100525000 : Integer;
    BEGIN
      EditableMode := AdviceOrderFieldsEditable;
      PlantMgtCompany.GetPlantCompany(TRUE, NoOfPlantCompanies, '');
      CASE "Record Type" OF
        "Record Type"::Project:
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', FALSE);
        "Record Type"::ServOrder:
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForService("Service Order No.", TmpPlantMgtCompany, '', FALSE);
      ELSE
        FIELDERROR("Record Type");
      END;

      IF NoOfPlantCompanies = 0 THEN BEGIN
        PlantMgtCompany."Plant Company" := "Plant Company";
        IF PlantMgtCompany."Plant Company" = '' THEN
          PlantMgtCompany."Plant Company" := COMPANYNAME;
        PAGE.RUNMODAL(0, PlantMgtCompany);
      END ELSE BEGIN
        TmpPlantMgtCompany."Plant Company" := "Plant Company";
        IF TmpPlantMgtCompany."Plant Company" = '' THEN
          TmpPlantMgtCompany."Plant Company" := COMPANYNAME;
        IF NOT EditableMode THEN
          PAGE.RUNMODAL(0, TmpPlantMgtCompany)
        ELSE BEGIN
          IF PAGE.RUNMODAL(0, TmpPlantMgtCompany) = ACTION::LookupOK THEN BEGIN
            xRec := Rec;
            IF TmpPlantMgtCompany."Plant Company" <> "Plant Company" THEN
              VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
          END;
        END;
      END;
    END;

    PROCEDURE LookupPlantLocation@1100529001();
    VAR
      PlantLocation@1100525001 : Record 11012554;
      EditableMode@1100529000 : Boolean;
      PlantLocCompany@1100525000 : Text;
    BEGIN
      EditableMode := AdviceOrderFieldsEditable;
      CASE "Record Type" OF
        "Record Type"::Project:
          TESTFIELD("Project No.");
        "Record Type"::ServOrder:
          TESTFIELD("Service Order No.");
      ELSE
        FIELDERROR("Record Type");
      END;

      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantLocCompany := COMPANYNAME;
        PlantLocation.CHANGECOMPANY("Plant Company");
      END;
      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.FILTERGROUP(9);
      PlantLocation.SETRANGE(Depot, FALSE);
      PlantLocation.SETRANGE("Company Name", PlantLocCompany);
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        PlantLocation.SETRANGE("Project No.", "Project No.");
        PlantLocation.SETRANGE( "Service Order No.", '');
      END;
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        PlantLocation.SETRANGE("Project No.", '');
        PlantLocation.SETRANGE( "Service Order No.", "Service Order No.");
      END;
      PlantLocation.FILTERGROUP(0);
      PlantLocation.SETRANGE(Code, "Plant Location");
      IF NOT PlantLocation.FINDFIRST THEN BEGIN
        PlantLocation."Company Name" := PlantLocCompany;
        PlantLocation."Project No." := "Project No.";
        PlantLocation."Service Order No." := "Service Order No.";
      END;
      PlantLocation.SETRANGE(Code);
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, PlantLocation)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN BEGIN
          IF PlantLocation.Code <> "Plant Location" THEN
            VALIDATE("Plant Location", PlantLocation.Code);
        END;
      END;
    END;

    PROCEDURE LookupPlantLocationWithAssistEdit@1100525023();
    VAR
      PlantLocation@1100525001 : Record 11012554;
      EditableMode@1100529000 : Boolean;
      PlantLocCompany@1100525000 : Text;
    BEGIN
      // Lookup via AssistEdit: Show Plant Locations that are related to a customer
      EditableMode := AdviceOrderFieldsEditable;
      CASE "Record Type" OF
        "Record Type"::Project:
          TESTFIELD("Project No.");
        "Record Type"::ServOrder:
          TESTFIELD("Service Order No.");
      ELSE
        FIELDERROR("Record Type");
      END;

      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantLocCompany := COMPANYNAME;
        PlantLocation.CHANGECOMPANY("Plant Company");
      END;
      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.FILTERGROUP(9);
      PlantLocation.SETRANGE(Depot, FALSE);
      PlantLocation.SETRANGE("Company Name", PlantLocCompany);
      PlantLocation.SETRANGE("Project No.", '');
      PlantLocation.SETRANGE( "Service Order No.", '');
      PlantLocation.SETRANGE("Employee No.", '');
      PlantLocation.SETRANGE("Plant Type", '');
      PlantLocation.SETFILTER("Customer No.", '<>%1', '');
      PlantLocation.FILTERGROUP(0);
      PlantLocation.SETRANGE(Code, "Plant Location");
      IF NOT PlantLocation.FINDFIRST THEN BEGIN
        PlantLocation."Company Name" := PlantLocCompany;
        PlantLocation."Project No." := '';
        PlantLocation."Service Order No." := '';
      END;
      PlantLocation.SETRANGE(Code);
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, PlantLocation)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN BEGIN
          IF PlantLocation.Code <> "Plant Location" THEN
            VALIDATE("Plant Location", PlantLocation.Code);
        END;
      END;
    END;

    PROCEDURE LookupPlantType@1100529003();
    VAR
      PlantType@1100525001 : Record 11012551;
      EditableMode@1100529000 : Boolean;
    BEGIN
      EditableMode := AdviceOrderFieldsEditable;
      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
        PlantType.CHANGECOMPANY("Plant Company");
      PlantType.Code := "Plant Type";
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, PlantType)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN BEGIN
          xRec := Rec;
          IF PlantType.Code <> "Plant Type" THEN
            VALIDATE("Plant Type", PlantType.Code);
        END;
      END;
    END;

    LOCAL PROCEDURE GetSubcontractorActivity@1100529900(CalledBy@1100528900 : Integer);
    VAR
      SubcontractingActivityPrice@1100529900 : Record 11229373;
    BEGIN
      //DP01492-2
      VALIDATE(Processed, FALSE);
      TESTFIELD("Cost Type", "Cost Type"::Subcontracting);
      SubcontractingActivityPrice.SETRANGE("Subcontracting Activity", "Subcontracting Activity");
      IF CalledBy = FIELDNO("Subcontracting Activity") THEN  //DP01958a
        SubcontractingActivityPrice.SETRANGE("Preferred Subcontractor", TRUE)
      ELSE
        SubcontractingActivityPrice.SETRANGE("Subcontractor No.", Vendor);
      IF SubcontractingActivityPrice.FINDFIRST THEN BEGIN
        VALIDATE("Price (LCY)", SubcontractingActivityPrice.GetPrice("Order Date"));
        IF CalledBy = FIELDNO("Subcontracting Activity") THEN BEGIN  //DP01958a
          SubcontractingActivityPrice.CALCFIELDS("Activity Description");
          Description := SubcontractingActivityPrice."Activity Description";
        END;
        "Unit of Measure" := SubcontractingActivityPrice."Unit of Measure";
        "Cost Object" := SubcontractingActivityPrice."Cost Object";
        Vendor := SubcontractingActivityPrice."Subcontractor No.";
      END;
    END;

    PROCEDURE PurchaseDetailDescription@1100527400() : Text;
    VAR
      PurchaseLineDetail@1100527400 : Record 11020660;
      PurchaseLineDetailLineType@1100527401 : Option;
    BEGIN
      //**4PS
      CASE TRUE OF
        "Project No." <> '':
          PurchaseLineDetailLineType := PurchaseLineDetail."Record Type"::Project;
        "Service Order No." <> '':
          PurchaseLineDetailLineType := PurchaseLineDetail."Record Type"::ServOrder;
        ELSE
          EXIT('');
      END;
      IF PurchaseLineDetail.GET(
        PurchaseLineDetail."Line Type"::"Advice Order", PurchaseLineDetailLineType, "Project No.",
        "Yard No.", "System No.", "Entity Type", "Entity No.", "Service Order No.", '', "Line No.")
      THEN
        EXIT(PurchaseLineDetail.DetailDescription);
    END;

    PROCEDURE InsertServiceOrderObjectMaterialInventoryItem@1100525029(ServiceOrderNo@1100525000 : Code[20];ObjectMaterialInventory@1100525001 : Record 11071712);
    BEGIN
      INIT;
      InitRecord;
      "Line No." := GetLineNo;
      "Service Order No." := ServiceOrderNo;
      "Item No." := ObjectMaterialInventory."Item No.";
      Manufacturer := ObjectMaterialInventory.Manufacturer;
      "Basic Item" := ObjectMaterialInventory."Basic Item";
      "Vendor (Trade Item)" := ObjectMaterialInventory."Vendor (Trade Item)";
      "Trade Item" := ObjectMaterialInventory."Trade Item";
      Description := ObjectMaterialInventory.Description;
      "Unit of Measure" := ObjectMaterialInventory."Unit of Measure";
      INSERT(TRUE);
    END;

    LOCAL PROCEDURE GetLineNo@1100525030() : Integer;
    BEGIN
      //force check additional cost for default cost type material
      xRec."Cost Type":= -1;
      CurrFieldNo := FIELDNO("Cost Type");
      VALIDATE("Cost Type");
      AdviceRec.RESET;
      //DP01378.sn
      AdviceRec.SETCURRENTKEY("Record Type", "Project No.", "Service Order No.", "G/L Account", "Line No.");
      AdviceRec.SETRANGE("Record Type", "Record Type");
      IF "Record Type" = "Record Type"::Project THEN BEGIN
        AdviceRec.SETRANGE("Project No.", "Project No.");
        AdviceRec.SETFILTER("Service Order No.", '%1', '');
        AdviceRec.SETFILTER("G/L Account", '%1', '');
      END;
      IF "Record Type" = "Record Type"::ServOrder THEN BEGIN
        AdviceRec.SETRANGE("Service Order No.", "Service Order No.");
        AdviceRec.SETFILTER("Project No.", '%1', '');
        AdviceRec.SETFILTER("G/L Account", '%1', '');
      END;
      IF "Record Type" = "Record Type"::"G/L Account" THEN BEGIN
        AdviceRec.SETRANGE("G/L Account", "G/L Account");
        AdviceRec.SETFILTER("Project No.", '%1', '');
        AdviceRec.SETFILTER("Service Order No.", '%1', '');
      END;
      //DP01378.en
      IF AdviceRec.FINDLAST THEN
        EXIT(AdviceRec."Line No." - (AdviceRec."Line No." MOD 10000) + 10000)
      ELSE
        EXIT(10000);
    END;

    LOCAL PROCEDURE CheckVendorPricePerQuantity@1100525036();
    VAR
      AdviceOrderLine@1100525000 : Record 11012055;
      GrossPrice@1100525001 : Decimal;
      DiscountPerc@1100525002 : Decimal;
      CostPrice@1100525003 : Decimal;
    BEGIN
      //C045045
      IF "Item No." = '' THEN EXIT;
      IF "Trade Item" <> '' THEN BEGIN
        InventorySetup.GET;
        IF (InventorySetup."Price Info Trade Item Leading" = TRUE) THEN EXIT;
      END;
      //
      AdviceOrderLine := Rec;
      CheckVendorPrice := TRUE;
      ValidateItem(ItemTypeOpt::Item);
      CheckVendorPrice := FALSE;
      GrossPrice:= "Gross Price (LCY)";
      DiscountPerc := "Discount %";
      CostPrice:= "Price (LCY)";
      Rec := AdviceOrderLine;
      //
      "Gross Price (LCY)" := GrossPrice;
      "Discount %" := DiscountPerc;
      "Price (LCY)" := CostPrice;
      VALIDATE("Gross Price (LCY)");
      CalculateTotal;
    END;

    PROCEDURE FindLowestPriceTradeItems@1100528404();
    VAR
      TempAlternativeTradeItem@1100528400 : TEMPORARY Record 11012744;
      SourceRecRef@1100528402 : RecordRef;
      LineNo@1100528401 : Integer;
    BEGIN
      IF FINDSET THEN
        REPEAT
          LineNo := LineNo + 10000;
          IF "Process Status" = "Process Status"::Open THEN
            TempAlternativeTradeItem.CreateAlternativeTradeItem(
              LineNo, "Trade Item", "Unit of Measure", "Vendor (Trade Item)",
              "Quantity (Advice)", "Currency Code", "Price (LCY)", "Price (FCY)",
              "Amount (LCY)", "Amount (FCY)", RECORDID, FALSE);
        UNTIL NEXT = 0;

      IF PAGE.RUNMODAL(PAGE::"Alternative Trade Items", TempAlternativeTradeItem) = ACTION::LookupOK THEN BEGIN
        IF TempAlternativeTradeItem.FINDSET THEN
          REPEAT
            SourceRecRef.GET(TempAlternativeTradeItem."Source Record ID");
            SourceRecRef.SETTABLE(Rec);
            IF ("Trade Item" <> TempAlternativeTradeItem."Item Code") OR
               ("Vendor (Trade Item)" <> TempAlternativeTradeItem.Vendor)
            THEN BEGIN
              VALIDATE("Trade Item", '');
              IF "Vendor (Trade Item)" <> TempAlternativeTradeItem.Vendor THEN
                VALIDATE("Original Vendor (Trade Item)", "Vendor (Trade Item)");
              VALIDATE("Vendor (Trade Item)", TempAlternativeTradeItem.Vendor);
              VALIDATE("Trade Item", TempAlternativeTradeItem."Item Code");
              MODIFY(TRUE);
            END;
          UNTIL TempAlternativeTradeItem.NEXT = 0;
      END;
    END;

    PROCEDURE SetCheckField@1100525038(CheckBlock@1100525000 : Boolean);
    BEGIN
      CheckField := CheckBlock;
    END;

    LOCAL PROCEDURE SetElementNo@1100527650();
    VAR
      AssemblyYardNumberObject@1100527650 : Record 11020596;
    BEGIN
      IF AssemblyYardNumberObject.GET("Project No.","Yard No.","Entity Type","System No.","Entity No.") THEN
        IF AssemblyYardNumberObject."Element No." <> '' THEN
          VALIDATE(Element, AssemblyYardNumberObject."Element No.");
    END;

    PROCEDURE DetermineBOMLevel@1100528902(LineNo@1100525000 : Integer;VAR BOMLevel@1100525002 : Integer);
    VAR
      AdviceOrderLine@1100525001 : Record 11012055;
    BEGIN
      AdviceOrderLine.SETRANGE("Record Type","Record Type");
      AdviceOrderLine.SETRANGE("Project No.","Project No.");
      AdviceOrderLine.SETRANGE("Service Order No.","Service Order No.");
      AdviceOrderLine.SETRANGE("G/L Account","G/L Account");
      AdviceOrderLine.SETRANGE("Line No.",LineNo);
      IF AdviceOrderLine.FINDFIRST THEN
        BOMLevel := AdviceOrderLine."Level BOM" + 1;
    END;

    LOCAL PROCEDURE CheckItemExpired@1100528903();
    VAR
      lvText000@1100528900 : TextConst 'ENU=Trade Item %1 is expired: Vendor %2 suggested %3 as alternative Item.;SVE=Anskaffningsartikeln %1 har f”rfallit: Leverant”r %2 f”reslog %3 som alternativ artikel.';
    BEGIN
      //C054043
      IF "Trade Item" <> '' THEN BEGIN
        TradeItemRec.GET("Vendor (Trade Item)", "Trade Item");
        IF TradeItemRec.Expired THEN BEGIN
          IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN BEGIN
            IF TradeItemRec."Item Code (Successor)" <> '' THEN BEGIN
              TradeItemRec.CALCFIELDS("Vendor Name");
              ERROR(lvText000, "Trade Item", TradeItemRec."Vendor Name", TradeItemRec."Item Code (Successor)");
            END;
            TradeItemRec.TESTFIELD(Expired,FALSE);
          END;
        END;
      END ELSE BEGIN
        IF "Basic Item" <> '' THEN BEGIN
          BasicItemRec.GET(Manufacturer, "Basic Item");
          IF Transaction IN [Transaction::Purchase, Transaction::Requisition] THEN
            BasicItemRec.TESTFIELD(Expired,FALSE);
        END;
      END;
    END;

    LOCAL PROCEDURE CheckItemBlocked@1100528906();
    BEGIN
      //C054043
      IF NOT ItemRec.GET("Item No.") THEN EXIT;
      IF NOT CheckField THEN BEGIN
        IF (Transaction IN [Transaction::Purchase,Transaction::Requisition]) THEN
          ItemRec.TESTFIELD("Purchasing Blocked",FALSE);
        IF (Transaction = Transaction::Inventory) THEN
          ItemRec.TESTFIELD("Inventory Blocked",FALSE);
      END;
      ItemRec.TESTFIELD(Blocked,FALSE);
      ItemRec.TESTFIELD("Advice Blocked",FALSE);
    END;

    LOCAL PROCEDURE CheckItemTransaction@1100528904();
    BEGIN
      //C054043
      IF NOT ItemRec.GET("Item No.") THEN EXIT;
      IF (ItemRec."Replenishment System" = ItemRec."Replenishment System"::"Prod. Order") OR
         (ItemRec."Replenishment System" = ItemRec."Replenishment System"::Assembly) THEN BEGIN
        Transaction := Transaction::Inventory;
      END ELSE BEGIN
        CASE ItemRec."Advice Order allways" OF
          ItemRec."Advice Order allways"::Inventory: Transaction := Transaction::Inventory;
          ItemRec."Advice Order allways"::Purchase: Transaction := Transaction::Purchase;
          ItemRec."Advice Order allways"::Requisition: Transaction := Transaction::Requisition;
          ItemRec."Advice Order allways"::Plant: Transaction := Transaction::Plant;
          ItemRec."Advice Order allways"::"Not Set": CheckSetupTransaction;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckSetupTransaction@1100528905();
    VAR
      ProjSetup@1100528900 : Record 315;
    BEGIN
      //C054043
      ProjSetup.GET;
      IF ProjSetup."Advice Order Transaction" = ProjSetup."Advice Order Transaction"::Inventory THEN BEGIN //option: Inventory,Purchase
        Transaction := Transaction::Inventory;
      END ELSE BEGIN
        IF ProjSetup."Advice Order Purch.Transaction" = ProjSetup."Advice Order Purch.Transaction"::Requisition THEN  //option: Purchase,,,Requisition
          Transaction := Transaction::Requisition
        ELSE
          Transaction := Transaction::Purchase;
      END;
      IF ("Trade Item" <> '') AND ("Item No." = '') THEN
        Transaction := ProjSetup."Advice Order Purch.Transaction";
    END;

    LOCAL PROCEDURE "*** 4PSSE ***"@111280000();
    BEGIN
    END;

    LOCAL PROCEDURE SetSecondaryTransaction@111280001(Item@111280002 : Record 27);
    VAR
      SecondaryTransactionSelected@111280001 : Boolean;
      PrefLocactionInvQty@111280000 : Decimal;
      TransferableInventory@111280004 : Decimal;
    BEGIN
      // ORANGO.LP 4PSSE CER GAP 13
      TransferableInventory := 0;

      IF Item."No." <> '' THEN BEGIN
        PrefLocactionInvQty := InventoryPrefLocations();
        SecondaryTransactionSelected := FALSE;

        // Assembly
        Item.CALCFIELDS("Assembly BOM");
        IF Item."Assembly BOM" THEN BEGIN
          VALIDATE(Transaction, Transaction::Plant);
          VALIDATE("Transaction (Secondary)", "Transaction (Secondary)"::Assembly);
          VALIDATE(Deliver, Deliver::" ");
          VALIDATE("Ship To Location", '');
          SecondaryTransactionSelected := TRUE;
        END;

        // Inventory
        IF NOT SecondaryTransactionSelected THEN BEGIN
          IF PrefLocactionInvQty >= "Quantity (Advice)" THEN BEGIN
            VALIDATE(Transaction, Transaction::Plant);
            VALIDATE("Transaction (Secondary)", "Transaction (Secondary)"::Inventory);
            VALIDATE(Deliver, Deliver::" ");
            VALIDATE("Ship To Location", '');
            SecondaryTransactionSelected := TRUE;
          END;
        END;

        // Transfer
        IF NOT SecondaryTransactionSelected THEN BEGIN
          TransferableInventory := GetTransferableInventory();

          IF (PrefLocactionInvQty < "Quantity (Advice)") AND (TransferableInventory >= "Quantity (Advice)") THEN BEGIN
            VALIDATE(Transaction, Transaction::Plant);
            VALIDATE("Transaction (Secondary)", "Transaction (Secondary)"::Transfer);
            VALIDATE(Deliver, Deliver::" ");
            VALIDATE("Ship To Location", '');
            SecondaryTransactionSelected := TRUE;
          END;
        END;

        // Purchase
        IF NOT SecondaryTransactionSelected THEN BEGIN
          VALIDATE(Transaction, Transaction::Purchase);
          VALIDATE("Transaction (Secondary)", "Transaction (Secondary)"::Purchase);
          IF "Home Location" <> '' THEN BEGIN
            VALIDATE(Deliver, Deliver::Location);
            VALIDATE("Ship To Location", "Home Location");
          END;
          SecondaryTransactionSelected := TRUE;
        END;
      END;
    END;

    PROCEDURE GetTransferableInventory@111280002() : Decimal;
    VAR
      StockkeepingUnit@111280001 : Record 5700;
      TransferableInventory@111280003 : Decimal;
    BEGIN
      // ORANGO.LP 4PSSE CER GAP 13
      StockkeepingUnit.SETRANGE("Item No.", "Item No.");
      StockkeepingUnit.SETRANGE("Variant Code", "Variant Code");
      IF StockkeepingUnit.FINDSET THEN
      REPEAT
          TransferableInventory += StockkeepingUnit.GetTransferableQuantity();
      UNTIL StockkeepingUnit.NEXT = 0;
      EXIT(TransferableInventory);
    END;

    BEGIN
    {
      120131, kzwerver: The key below is used in report 11012654 Advice Orders by Company (Msquared)
        Item No.,Description 2,Project No.,Service Order No.

      DP00886: db, 11-03-16
      - local functions for ExchangeAmt (introduced by DP00884) moved to ProjectCurrencyExchangeRate.

      C033988, db, 27-12-16: PastIsValid=Yes
      DP01378: "Record Type"::"G/L Account" introduced (Primary key changed)
      C057248: db, 03-09-19: PasteIsValid=NO

      190827 ORANGO.LP CER GAP 14 New field "System No. Assembly Order"
      191121 ORANGO.LP 4PSSE CER GAP 13 New fields:
                        - "Transaction (Secondary)"
                        - "Rapid Order"
                        - "Blocked Item"
                        - "Transfer From Location"
                        - "Home Location"
                        - "Assembly Order No."
                        - "Pick Order No."
                        - "Transfer Order No."
    }
    END.
  }
}

