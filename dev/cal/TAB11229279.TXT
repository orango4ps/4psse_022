OBJECT Table 11229279 Work Order
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    DataPerCompany=No;
    DataCaptionFields=No.,Source No.,Description;
    OnInsert=VAR
               WorkOrderPlanningSetup@1100525000 : Record 11229277;
               NoSeriesMgt@1100525001 : Codeunit 396;
               ServiceProcessManagement@1100528600 : Codeunit 11012883;
               RecRef@1100528601 : RecordRef;
             BEGIN
               TESTFIELD("Source Company", COMPANYNAME);
               CheckResourceRequestStartingEndingDate;
               WorkOrderPlanningSetup.GET;
               IF "No." = '' THEN BEGIN
                 WorkOrderPlanningSetup.TESTFIELD("Work Order Nos.");
                 NoSeriesMgt.InitSeries(WorkOrderPlanningSetup."Work Order Nos.", xRec."No. Series", 0D, "No.", "No. Series");
               END;
               "Actual Field Service Status" := '';
               GetDefaultResouceGroup;
               GetInitialReferencePoint();
               "Export to FSA" := FALSE;
               "Date/Time Export to FSA" := 0DT;
               "Export Item Usage to FSA":= FALSE;
               "Created on":= CURRENTDATETIME;
               "Created by" := USERID;
               "Target Company" := COMPANYNAME;
               UpdateModifiedOnAndBy;
               UpdateServiceOrder('I');

               InsertWorkOrderRefPoint;//C016653

               InsertProjectElementResource;
               UpdateAdditionalInfoRequestWorkorder('I');
               AddLinkedResources('I');
               CreateDefaultTransportCost(Rec, 'I');
               CALCFIELDS("Link WO to WO Leading Resource");
               IF "Leading Resource" THEN
                 LinkWorkOrdersToWOLeadingResource;

               IF ServiceProcessManagement.AssignDefaultValues(Rec, '', RecRef) THEN
                 RecRef.SETTABLE(Rec);
               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, TRUE);
               UpdateCoordinatesOfServiceOrder;
               CheckSignatureMandatory;
             END;

    OnModify=VAR
               xWorkOrder@1100528700 : Record 11229279;
               ServiceOrderStatusMail@1100529400 : Codeunit 11012816;
               ServiceProcessManagement@1100528600 : Codeunit 11012883;
             BEGIN
               TESTFIELD("Source Company", COMPANYNAME);
               CheckResourceRequestStartingEndingDate;
               UpdateModifiedOnAndBy;
               IF NOT xWorkOrder.GET("No.") THEN
                 xWorkOrder.INIT;
               UpdateRefPointWO(xWorkOrder);
               UpdateDeletedWorkOrderCache(xWorkOrder, 'M');
               UpdateAdditionalInfoRequestWorkorder('M');
               AddLinkedResources('M');
               CreateDefaultTransportCost(Rec, 'M');
               InsertProjectElementResource;
               UpdateLinkedWOs;
               UpdateServiceOrder('M');

               IF ("Source Type" = "Source Type"::ServiceOrder) AND ("Source Company" = COMPANYNAME) THEN
                 IF "Expected Dates Modified on" <> xRec."Expected Dates Modified on" THEN BEGIN
                   MODIFY;
                   ServiceOrderStatusMail.SetMailAction(3);
                   ServiceOrderStatusMail.WorkOrderMail("No.");
                 END;
               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, FALSE);
             END;

    OnDelete=VAR
               WorkOrderSignature@1100525000 : Record 11229280;
               WorkOrderRefPoint@1100527000 : Record 11229282;
               WorkOrder@1100528600 : Record 11229279;
               MobileDecentralWorkOrder@1100527001 : Record 11125649;
               Company@1100409000 : Record 2000000006;
               xWorkOrder@1100528700 : Record 11229279;
               DebriefLogbook4PSMobile@1100528605 : Record 11012677;
               DebriefWorkOrderMobile@1100528607 : Record 11012679;
               DebriefBudgetLineMobile@1100528608 : Record 11012680;
               DebriefCostPlusEntryMob@1100528609 : Record 11012681;
               DebriefAdviceOrderLineMob@1100528610 : Record 11012682;
               DebriefFSStatusMobile@1100528611 : Record 11012683;
               DebriefTextMobile@1100528612 : Record 11012684;
               DebriefHourAccountingMob@1100528613 : Record 11012685;
               MobileDecentralObject@1100528601 : Record 11012688;
               DebriefText@1100528616 : Record 11012886;
               DebriefReceivedMessage@1100528617 : Record 11020444;
               DebriefInspectionLinesMob@1100528618 : Record 11020447;
               DebriefObjSpecLinesMob@1100528619 : Record 11020448;
               DebriefWorkOrderTextsMob@1100528620 : Record 11020449;
               DebriefRestockItemMob@1100528623 : Record 11125645;
               DebriefPlanningMob@1100528624 : Record 11125646;
               DebriefCreatePurchOrdMob@1100528626 : Record 11125648;
               DebriefWUPProductionMob@1100528627 : Record 11125650;
               DebriefServOrdObjMob@1100528628 : Record 11125652;
               WorkOrderText@1100528630 : Record 11229284;
               DebriefCreateRestPOMob@1100528631 : Record 11229869;
               DebriefAdvOrdLnTextMob@1100528634 : Record 11229870;
               FieldServiceWorksheet@1100528635 : Record 11125878;
               TransportCostRequestWO@1100529000 : Record 11124913;
               ReferencePeriod@1100528500 : Record 11020272;
               WorkOrderInspectionLine@1100526000 : Record 11072558;
             BEGIN
               IF NOT xWorkOrder.GET("No.") THEN
                 xWorkOrder.INIT;
               IF Company.GET("Source Company") THEN BEGIN
                 TESTFIELD("Source Company", COMPANYNAME);
                 TestIfDeletionIsAllowed;

                 UpdateDeletedWorkOrderCache(xWorkOrder, 'D');
                 IF NOT gOnDeleteSource THEN BEGIN
                   UpdateServiceOrder('D');
                 END;
               END;

               WorkOrderSignature.SETRANGE("Work Order No.", "No.");
               WorkOrderSignature.DELETEALL;

               ReferencePeriod.SETCURRENTKEY(Type,"Document No.");
               ReferencePeriod.SETRANGE(Type, ReferencePeriod.Type::WorkOrder);
               ReferencePeriod.SETRANGE("Document No.","No.");
               ReferencePeriod.DELETEALL(TRUE);

               WorkOrderRefPoint.SETRANGE("Work Order No.", "No.");
               WorkOrderRefPoint.DELETEALL;

               WorkOrder.SETRANGE("Related Work Order No.", "No.");
               IF WorkOrder.FINDSET THEN
                 REPEAT
                   WorkOrder.VALIDATE("Schedule Relation", WorkOrder."Schedule Relation"::" ");
                   WorkOrder.MODIFY;
                 UNTIL WorkOrder.NEXT = 0;

               MobileDecentralWorkOrder.SETCURRENTKEY("Work Order No.");
               MobileDecentralWorkOrder.SETRANGE("Work Order No.", "No.");
               MobileDecentralWorkOrder.DELETEALL;

               DebriefLogbook4PSMobile.SETRANGE("Work Order No.", "No.");
               DebriefLogbook4PSMobile.DELETEALL(TRUE);

               DebriefWorkOrderMobile.SETRANGE("Work Order No.", "No.");
               DebriefWorkOrderMobile.DELETEALL(TRUE);

               DebriefBudgetLineMobile.SETRANGE("Work Order No.", "No.");
               DebriefBudgetLineMobile.DELETEALL(TRUE);

               DebriefCostPlusEntryMob.SETRANGE("Work Order No.", "No.");
               DebriefCostPlusEntryMob.DELETEALL(TRUE);

               DebriefAdviceOrderLineMob.SETRANGE("Work Order No.", "No.");
               DebriefAdviceOrderLineMob.DELETEALL(TRUE);

               DebriefFSStatusMobile.SETRANGE("Work Order No.", "No.");
               DebriefFSStatusMobile.DELETEALL(TRUE);

               DebriefTextMobile.SETRANGE("Work Order No.", "No.");
               DebriefTextMobile.DELETEALL(TRUE);

               DebriefHourAccountingMob.SETRANGE("Work Order No.", "No.");
               DebriefHourAccountingMob.DELETEALL(TRUE);

               MobileDecentralObject.SETRANGE("Work Order No.", "No.");
               MobileDecentralObject.DELETEALL(TRUE);

               DebriefText.SETRANGE("Work Order No.", "No.");
               DebriefText.DELETEALL(TRUE);

               DebriefReceivedMessage.SETRANGE("Work Order No.", "No.");
               DebriefReceivedMessage.DELETEALL(TRUE);

               DebriefInspectionLinesMob.SETRANGE("Work Order No.", "No.");
               DebriefInspectionLinesMob.DELETEALL(TRUE);

               DebriefObjSpecLinesMob.SETRANGE("Work Order No.", "No.");
               DebriefObjSpecLinesMob.DELETEALL(TRUE);

               DebriefWorkOrderTextsMob.SETRANGE("Work Order No.", "No.");
               DebriefWorkOrderTextsMob.DELETEALL(TRUE);

               DebriefRestockItemMob.SETRANGE("Work Order No.", "No.");
               DebriefRestockItemMob.DELETEALL(TRUE);

               DebriefPlanningMob.SETRANGE("Work Order No.", "No.");
               DebriefPlanningMob.DELETEALL(TRUE);

               DebriefCreatePurchOrdMob.SETRANGE("Work Order No.", "No.");
               DebriefCreatePurchOrdMob.DELETEALL(TRUE);

               DebriefWUPProductionMob.SETRANGE("Work Order No.", "No.");
               DebriefWUPProductionMob.DELETEALL(TRUE);

               DebriefServOrdObjMob.SETRANGE("Work Order No.", "No.");
               DebriefServOrdObjMob.DELETEALL(TRUE);

               WorkOrderText.SETRANGE("Table Name", WorkOrderText."Table Name"::"Work Order");
               WorkOrderText.SETRANGE("No.", "No.");
               WorkOrderText.DELETEALL(TRUE);

               DebriefCreateRestPOMob.SETRANGE("Work Order No.", "No.");
               DebriefCreateRestPOMob.DELETEALL(TRUE);

               DebriefAdvOrdLnTextMob.SETRANGE("Work Order No.", "No.");
               DebriefAdvOrdLnTextMob.DELETEALL(TRUE);

               FieldServiceWorksheet.SETRANGE("Work Order No.", "No.");
               FieldServiceWorksheet.MODIFYALL("Work Order No.", '');

               UpdateAdditionalInfoRequestWorkorder('D');

               TransportCostRequestWO.SETCURRENTKEY("Work Order No.", "Line No.");
               TransportCostRequestWO.SETRANGE("Work Order No.", "No.");
               TransportCostRequestWO.DELETEALL;

               WorkOrderInspectionLine.SETRANGE("Work Order No.", "No.");
               WorkOrderInspectionLine.DELETEALL;
             END;

    OnRename=BEGIN
               TESTFIELD("Actual Field Service Status", '');
               "Modified on" := CURRENTDATETIME;
             END;

    CaptionML=[ENU=Work Order;
               NOR=Arbeidsordre;
               SVE=Arbetsorder];
    PasteIsValid=No;
    LookupPageID=Page11229286;
    DrillDownPageID=Page11229286;
  }
  FIELDS
  {
    { 10  ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                TESTFIELD("Source Company", COMPANYNAME);
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  WorkOrderPlanningSetup.GET;
                                                                  NoSeriesMgt.TestManual(WorkOrderPlanningSetup."Work Order Nos.");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr;
                                                              SVE=Nr] }
    { 20  ;   ;Source Company      ;Text30        ;TableRelation=Company;
                                                   OnValidate=BEGIN
                                                                IF "Source Company" <> xRec."Source Company" THEN
                                                                  "Source No." := '';
                                                              END;

                                                   CaptionML=[ENU=Source Company;
                                                              SVE=K„llf”retag];
                                                   NotBlank=Yes }
    { 30  ;   ;Source Type         ;Option        ;OnValidate=BEGIN
                                                                IF "Source Type" <> xRec."Source Type" THEN BEGIN
                                                                  "Source No." := '';
                                                                  IF "Source Type" = "Source Type"::Request THEN
                                                                    "Resource No." := '';
                                                                  IF NOT CheckResourceSchedule(FALSE) THEN
                                                                    "Resource No." := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Source Type;
                                                              NOR=Kildetype;
                                                              SVE=Ursprungstyp];
                                                   OptionCaptionML=ENU=,Service Order,,,,,,,,,,Project,,,,,,,,,,Request;
                                                   OptionString=,ServiceOrder,,,,,,,,,,Project,,,,,,,,,,Request;
                                                   NotBlank=Yes }
    { 40  ;   ;Source No.          ;Code20        ;OnValidate=BEGIN
                                                                IF "Source No." <> '' THEN
                                                                  ValidateSourceNo();
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupSourceNo(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Source No.;
                                                              NOR=Kildenr.;
                                                              SVE=Ursprungsnr];
                                                   NotBlank=Yes }
    { 50  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 60  ;   ;Starting Date/Time  ;DateTime      ;OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                TESTFIELD("Source Company", COMPANYNAME);
                                                                IF "Starting Date/Time" = 0DT THEN
                                                                  "Ending Date/Time" := 0DT;
                                                                IF ("Starting Date/Time" >= "Ending Date/Time") AND ("Ending Date/Time" <> 0DT) AND (CurrFieldNo = FIELDNO("Starting Date/Time")) THEN
                                                                  "Ending Date/Time" := 0DT;   // Needed for webservice GWP
                                                                CheckEndAfterStart(FIELDNO("Starting Date/Time"));
                                                                CheckPlanPeriod();
                                                                ReinitReferencePoint;
                                                                UpdateDateTimeForAdviceOrder;
                                                              END;

                                                   CaptionML=[ENU=Starting Date/Time;
                                                              SVE=Startdatum/tid] }
    { 65  ;   ;Ending Date/Time    ;DateTime      ;OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                TESTFIELD("Source Company", COMPANYNAME);
                                                                IF "Ending Date/Time" <> 0DT THEN
                                                                  TESTFIELD("Starting Date/Time");
                                                                CheckEndAfterStart(FIELDNO("Ending Date/Time"));
                                                                CheckPlanPeriod();
                                                                ReinitReferencePoint;
                                                              END;

                                                   CaptionML=[ENU=Ending Date/Time;
                                                              SVE=Slutdatum/tid] }
    { 70  ;   ;First Possible Start.Date/Time;DateTime;
                                                   OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                IF "First Possible Start.Date/Time" = 0DT THEN
                                                                  "Last Possible Ending Date/Time" := 0DT;
                                                                IF ("First Possible Start.Date/Time" >= "Last Possible Ending Date/Time") AND ("Last Possible Ending Date/Time" <> 0DT) AND
                                                                   (CurrFieldNo = FIELDNO("First Possible Start.Date/Time"))
                                                                THEN
                                                                  "Last Possible Ending Date/Time" := 0DT;   // Needed for webservice GWP
                                                                CheckEndAfterStart(FIELDNO("First Possible Start.Date/Time"));
                                                                CheckPlanPeriod();
                                                              END;

                                                   CaptionML=[ENU=First Possible Starting Date/Time;
                                                              SVE=F”rsta m”jliga startdatum/tid] }
    { 75  ;   ;Last Possible Ending Date/Time;DateTime;
                                                   OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                IF "Last Possible Ending Date/Time" <> 0DT THEN
                                                                  TESTFIELD("First Possible Start.Date/Time");
                                                                CheckEndAfterStart(FIELDNO("Last Possible Ending Date/Time"));
                                                                CheckPlanPeriod();
                                                              END;

                                                   CaptionML=[ENU=Last Possible Ending Date/Time;
                                                              SVE=Senast m”jlig slutdatum/tid] }
    { 80  ;   ;Expected Hours      ;Decimal       ;OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                              END;

                                                   CaptionML=[ENU=Expected Hours;
                                                              NOR=Forventede timer;
                                                              SVE=F”rv„ntade timmar];
                                                   DecimalPlaces=0:5 }
    { 90  ;   ;Duration Time       ;Decimal       ;OnValidate=BEGIN
                                                                IF "Duration Time" < 0 THEN
                                                                  FIELDERROR("Duration Time");
                                                                CheckPlanDataFSA();
                                                              END;

                                                   CaptionML=[ENU=Duration Time;
                                                              NOR=Varighet;
                                                              SVE=L”ptid];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0 }
    { 100 ;   ;Plan during Clock Time;Boolean     ;OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                              END;

                                                   CaptionML=[ENU=Plan during Clock Time;
                                                              NOR=Plan i l›pet av klokketid;
                                                              SVE=Plan under klocktid] }
    { 105 ;   ;Plan in Weekend     ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Plan in Weekend }
    { 110 ;   ;Actual Field Service Status;Text30 ;TableRelation="Field Service Code".Code WHERE (Type=CONST(Status));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Source Company", COMPANYNAME);
                                                                IF NOT ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Subcontractor, "Resource Type"::Plant]) THEN
                                                                  FIELDERROR("Resource Type");
                                                                CALCFIELDS("Actual Field Serv. Status Desc");
                                                              END;

                                                   CaptionML=[ENU=Actual Field Service Status;
                                                              SVE=Verklig f„ltservice status];
                                                   Editable=No }
    { 111 ;   ;Actual Field Serv. Status Desc;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Field Service Code".Description WHERE (Type=CONST(Status),
                                                                                                              Code=FIELD(Actual Field Service Status)));
                                                   CaptionML=[ENU=Actual Field Service Status Description;
                                                              SVE=Verklig f„ltservice statusbeskr];
                                                   Editable=No }
    { 120 ;   ;Resource No.        ;Code20        ;TableRelation=IF (Source Type=CONST(Project)) "Resource (WOP)" WHERE (Type=FIELD(Resource Type),
                                                                                                                         Schedule=FILTER(Project|Both))
                                                                                                                         ELSE IF (Source Type=CONST(ServiceOrder)) "Resource (WOP)" WHERE (Type=FIELD(Resource Type),
                                                                                                                                                                                           Schedule=FILTER(ServiceOrder|Both))
                                                                                                                                                                                           ELSE IF (Source Type=CONST(Request)) "Resource (WOP)" WHERE (Type=FIELD(Resource Type));
                                                   OnValidate=VAR
                                                                ResourceMgtWorkOrderPlan@1100528600 : Codeunit 11229277;
                                                              BEGIN
                                                                IF NOT GUIALLOWED AND (CurrFieldNo = 0) THEN //Call from GWP
                                                                  CurrFieldNo := FIELDNO("Resource No.");
                                                                CheckPlanDataFSA;
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup("Resource No.");
                                                                IF (xRec."Resource No." <> '') AND (xRec."Resource No." <> "Resource No.") THEN BEGIN
                                                                  "Actual Field Service Status" := '';
                                                                  VALIDATE("Export to FSA", FALSE);
                                                                END;
                                                                CALCFIELDS("Resource Name", "Resource Company");
                                                                DetermineLeadingResource;
                                                                CheckResourceSchedule(TRUE);
                                                                UpdateAdviceOrder;
                                                                IF "Operates Plant (WO)" <> '' THEN
                                                                  VALIDATE("Operates Plant (WO)");

                                                                CALCFIELDS("Link WO to WO Leading Resource");
                                                                IF "Link WO to WO Leading Resource" THEN
                                                                  UpdateLinkToWOLeadingResource;
                                                                IF "Resource Type" = "Resource Type"::Plant THEN
                                                                  TestIfPlantInventoryLocationIsUnique;
                                                              END;

                                                   CaptionML=[ENU=Resource No.;
                                                              NOR=Ressursnr.;
                                                              SVE=Resursnr] }
    { 130 ;   ;Resource Name       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Resource No.)));
                                                   CaptionML=[ENU=Resource Name;
                                                              NOR=Ressursnavn;
                                                              SVE=Resursnamn];
                                                   Editable=No }
    { 140 ;   ;Resource Company    ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Company WHERE (No.=FIELD(Resource No.)));
                                                   TableRelation=Company;
                                                   CaptionML=[ENU=Resource Company;
                                                              SVE=F”retag resurs];
                                                   Editable=No }
    { 150 ;   ;Resource Type       ;Option        ;OnValidate=VAR
                                                                AdviceOrderLine@1100528500 : Record 11012055;
                                                              BEGIN
                                                                IF xRec."Resource Type" <> "Resource Type" THEN BEGIN
                                                                  "Resource Group No." := '';
                                                                  VALIDATE("Resource No.", '');
                                                                  "Operates Plant (WO)" := '';
                                                                  CALCFIELDS("Resource Name", "Resource Company");
                                                                  IF xRec."Resource Type" = "Resource Type"::Subcontractor THEN BEGIN
                                                                    AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
                                                                    AdviceOrderLine.SETRANGE("Service Order No.", "Source No.");
                                                                    AdviceOrderLine.SETRANGE("Work Order No.", "No.");
                                                                    IF AdviceOrderLine.FINDFIRST THEN
                                                                      IF AdviceOrderLine."Process Status" = AdviceOrderLine."Process Status"::Open THEN
                                                                        AdviceOrderLine.DELETE(TRUE);
                                                                  END;
                                                                END;
                                                                GetDefaultResouceGroup;
                                                              END;

                                                   CaptionML=[ENU=Resource Type;
                                                              NOR=Ressurstype;
                                                              SVE=Resurstyp];
                                                   OptionCaptionML=[ENU=" ,Employee,Subcontractor,Plant";
                                                                    SVE=" ,Anst„lld,Underentrepren”r,Maskin"];
                                                   OptionString=[ ,Employee,Subcontractor,Plant];
                                                   Description=Must be normal field, because needed for anonymous order (Resource No. empty) }
    { 155 ;   ;Resource Group No.  ;Code20        ;TableRelation=IF (Resource Type=CONST(Plant)) "Resource Group (WOP)" WHERE (Type=CONST(Plant))
                                                                 ELSE "Resource Group (WOP)" WHERE (Type=CONST(Discipline));
                                                   OnValidate=VAR
                                                                ResourceGroup@1100529000 : Record 11229384;
                                                                ResourceMgtWorkOrderPlan@1100529001 : Codeunit 11229277;
                                                              BEGIN
                                                                IF "Resource Group No." <> '' THEN BEGIN
                                                                  IF NOT ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Plant, "Resource Type"::Subcontractor]) THEN
                                                                    FIELDERROR("Resource Type");
                                                                  ResourceGroup.GET("Resource Group No.");
                                                                  IF "Resource Type" <> "Resource Type"::Plant THEN
                                                                    ResourceGroup.TESTFIELD(Company, COMPANYNAME);  // (Resource Group of) Disciplines must be present in current company
                                                                  ResourceMgtWorkOrderPlan.TestResourceGroupWithinCompanyPlanGroup("Resource Group No.");
                                                                END;
                                                                CALCFIELDS("Resource Group Name", "Resource Group Company");
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupResourceGroup(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Resource Group No.;
                                                              NOR=Ressursgruppenr.;
                                                              SVE=Gruppnr];
                                                   Description=Requested Resource Group, for Request-Customer this will be invoiced }
    { 156 ;   ;Resource Group Name ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource Group (WOP)".Name WHERE (No.=FIELD(Resource Group No.)));
                                                   CaptionML=ENU=Resource Group Name;
                                                   Editable=No }
    { 157 ;   ;Resource Group Company;Text30      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Company WHERE (No.=FIELD(Resource Group No.)));
                                                   TableRelation=Company;
                                                   CaptionML=ENU=Resource Group Company;
                                                   Editable=No }
    { 160 ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr-serie;
                                                              SVE=Nr-serier];
                                                   Editable=No }
    { 170 ;   ;Project Planning Activity No.;Code30;
                                                   OnValidate=VAR
                                                                ProjPlanActivity@1100525000 : Record 11012431;
                                                              BEGIN
                                                                IF "Source Type" <> "Source Type"::Project THEN
                                                                  TESTFIELD("Project Planning Activity No.", '')
                                                                ELSE BEGIN
                                                                  IF "Project Planning Activity No." <> '' THEN BEGIN
                                                                    TESTFIELD("Source Company");
                                                                    TESTFIELD("Source No.");
                                                                    ProjPlanActivity.CHANGECOMPANY("Source Company");
                                                                    ProjPlanActivity.GET("Project Planning Activity No.");
                                                                    ProjPlanActivity.TESTFIELD("Project No.", "Source No.");
                                                                    ProjPlanActivity.TESTFIELD(Type, ProjPlanActivity.Type::Activity);
                                                                    Description := COPYSTR(ProjPlanActivity.Description, 1, MAXSTRLEN(Description));
                                                                    VALIDATE("Starting Date/Time", ProjPlanActivity."Starting Date");
                                                                  END;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjPlanActivity@1100525000 : Record 11012431;
                                                            BEGIN
                                                              TESTFIELD("Source Type", "Source Type"::Project);
                                                              TESTFIELD("Source Company");
                                                              TESTFIELD("Source No.");
                                                              ProjPlanActivity.CHANGECOMPANY("Source Company");
                                                              ProjPlanActivity.SETCURRENTKEY("Project No.", Code);
                                                              ProjPlanActivity.SETRANGE("Project No.", "Source No.");
                                                              ProjPlanActivity.SETRANGE(Type, ProjPlanActivity.Type::Activity);
                                                              IF "Project Planning Activity No." <> '' THEN
                                                                IF ProjPlanActivity.GET("Project Planning Activity No.") THEN;
                                                              IF PAGE.RUNMODAL(0, ProjPlanActivity) = ACTION::LookupOK THEN
                                                                VALIDATE("Project Planning Activity No.", ProjPlanActivity."No.");
                                                            END;

                                                   CaptionML=[ENU=Project Planning Activity No.;
                                                              NOR=Aktivitetsnummer for prosjektplanlegging;
                                                              SVE=Projektplaneringsaktivitetsnr] }
    { 200 ;   ;Export to FSA       ;Boolean       ;OnValidate=BEGIN
                                                                IF (("Source Type" = "Source Type"::ServiceOrder) OR ("Source Type" = "Source Type"::Project)) THEN BEGIN
                                                                  ValidateExportToFSA;
                                                                  UpdateOnExportToFSA;
                                                                END ELSE IF ("Source Type" = "Source Type"::Request) THEN
                                                                  ValidateExportToCCA;
                                                              END;

                                                   CaptionML=[ENU=Export to Field Service;
                                                              NOR=Eksporter til Feltservice;
                                                              SVE=Exportera till f„ltservice] }
    { 205 ;   ;Active in FSA       ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)"."Active in FSA" WHERE (No.=FIELD(Resource No.)));
                                                   CaptionML=[ENU=Active in Field Service;
                                                              SVE=Aktiv f„ltservice];
                                                   Editable=No }
    { 210 ;   ;Date/Time Export to FSA;DateTime   ;CaptionML=[ENU=Date/Time Export to Field Service;
                                                              NOR=Dato/tid, Eksporter til Feltservice;
                                                              SVE=Datum/tid, export till f„ltservice];
                                                   Editable=No }
    { 220 ;   ;Signer              ;Text50        ;OnValidate=BEGIN
                                                                TESTFIELD("Resource Type", "Resource Type"::Employee);
                                                              END;

                                                   CaptionML=[ENU=Signer;
                                                              NOR=Underskriver;
                                                              SVE=Undertecknare] }
    { 225 ;   ;Signature Mandatory ;Boolean       ;OnValidate=BEGIN
                                                                TESTFIELD("Resource Type", "Resource Type"::Employee);
                                                              END;

                                                   CaptionML=[ENU=Signature Mandatory;
                                                              SVE=Signatur kr„vs] }
    { 230 ;   ;Actual Reference Point;Integer     ;TableRelation="Reference Point" WHERE (Apply=CONST(ServOrder));
                                                   OnValidate=VAR
                                                                ReferencePoint@1100528600 : Record 11020271;
                                                                ResourceWOP@1100528601 : Record 11229278;
                                                              BEGIN
                                                                "Actual Ref. Point Set Manually" := CurrFieldNo = FIELDNO("Actual Reference Point");
                                                                IF "Actual Ref. Point Set Manually" AND ("Actual Reference Point" = 0) THEN BEGIN
                                                                  IF ReferencePoint.GET("Actual Reference Point") THEN BEGIN
                                                                    IF ReferencePoint.Apply <> ReferencePoint.Apply::ServOrder THEN
                                                                      ERROR(Text030, "Actual Reference Point");
                                                                  END ELSE
                                                                    ERROR(Text030, "Actual Reference Point");
                                                                END;
                                                                IF ("Actual Reference Point" <> 0) AND "Actual Ref. Point Set Manually" AND ("Date/Time Export to FSA" = 0DT) AND
                                                                   ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Subcontractor, "Resource Type"::Plant])
                                                                THEN BEGIN
                                                                  IF ResourceWOP.GET("Resource No.") THEN
                                                                    ResourceWOP.TESTFIELD("Link WO to WO Leading Resource", FALSE);
                                                                  ReferencePoint.GET("Actual Reference Point");
                                                                  IF ReferencePoint."Triggered by Field Service" <> '' THEN
                                                                    VALIDATE("Actual Field Service Status", ReferencePoint."Triggered by Field Service");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Actual Reference Point;
                                                              NOR=Faktisk referansepunkt;
                                                              SVE=Verklig referenspunkt] }
    { 240 ;   ;Actual Reference Point Desc.;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Reference Point".Description WHERE (No.=FIELD(Actual Reference Point)));
                                                   CaptionML=[ENU=Actual Reference Point Description;
                                                              NOR=Faktisk referansepunkt, beskrivelse;
                                                              SVE=Verklig referenspunktsbeskrivning];
                                                   Editable=No }
    { 250 ;   ;Schedule Relation   ;Option        ;OnValidate=BEGIN
                                                                IF "Schedule Relation" = "Schedule Relation"::" " THEN
                                                                  "Related Work Order No." := '';
                                                                IF ("Source Type" = "Source Type"::Request) AND (NOT ("Schedule Relation" IN ["Schedule Relation"::" ", "Schedule Relation"::"Start-Start"])) THEN
                                                                  FIELDERROR("Schedule Relation");  // (Temporary) only Start-Start is supported in GRP
                                                              END;

                                                   CaptionML=[ENU=Schedule Relation;
                                                              NOR=Tidsplan, relasjon;
                                                              SVE=Planering, relation];
                                                   OptionCaptionML=[ENU=" ,Start-Start,,End-Start";
                                                                    SVE=" ,Start-Start,,Slut-Start"];
                                                   OptionString=[ ,Start-Start,,End-Start] }
    { 260 ;   ;Related Work Order No.;Code20      ;TableRelation="Work Order";
                                                   OnValidate=VAR
                                                                RelatedWorkOrder@1100529000 : Record 11229279;
                                                              BEGIN
                                                                TestRecursiveness;
                                                                IF "Related Work Order No." <> '' THEN BEGIN
                                                                  IF "Related Work Order No." = "No." THEN
                                                                    FIELDERROR("Related Work Order No.");
                                                                  IF "Source Type" = "Source Type"::Request THEN BEGIN
                                                                    RelatedWorkOrder.GET("Related Work Order No.");
                                                                    RelatedWorkOrder.TESTFIELD("Source Type", "Source Type");
                                                                    RelatedWorkOrder.TESTFIELD("Source No.", "Source No.");
                                                                    "Schedule Relation" := "Schedule Relation"::"Start-Start";
                                                                  END;
                                                                  TESTFIELD("Schedule Relation");
                                                                  IF "Resource Type" = "Resource Type"::Plant THEN
                                                                    TestIfPlantInventoryLocationIsUnique;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupRelatedWorkOrder(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Related Work Order No.;
                                                              SVE=Relaterad arbetsorder nr] }
    { 270 ;   ;Modified on         ;DateTime      ;CaptionML=[ENU=Modified On;
                                                              NOR=Endret den;
                                                              SVE=Žndrad den];
                                                   Editable=No }
    { 275 ;   ;Modified by         ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190001 : Code[50];
                                                              UserMgt@1210190000 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Modified by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=Žndrad av];
                                                   Editable=No }
    { 280 ;   ;Export Item Usage to FSA;Boolean   ;CaptionML=[ENU=Export Item Usage to Field Service;
                                                              SVE=Exportera artikelf”rbrukning till FS];
                                                   Editable=No }
    { 285 ;   ;Item Used Exported On;DateTime     ;CaptionML=ENU=Item Usage Exported On;
                                                   Editable=No }
    { 290 ;   ;Target Company      ;Text30        ;TableRelation=Company;
                                                   OnValidate=VAR
                                                                CompanyPlanGroup@1100528600 : Record 11229300;
                                                              BEGIN
                                                                IF "Target Company" <> '' THEN BEGIN
                                                                  ValidateTargetCompany();
                                                                  IF NOT CompanyPlanGroup.BelongsCompanyToCurrentCompanyPlanGroup("Target Company") THEN
                                                                    ERROR(Text022, "Target Company");
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              Company@1100528600 : Record 2000000006;
                                                              CompanyPlanGroup@1100528601 : Record 11229300;
                                                              CompanyPlanGroupLine@1100528603 : Record 11229301;
                                                              PlanGroupCode@1100528602 : Code[10];
                                                            BEGIN
                                                              PlanGroupCode := CompanyPlanGroup.GetCurrentCompanyPlanGroupCode;
                                                              IF PlanGroupCode <> '' THEN BEGIN
                                                                CompanyPlanGroupLine.SETRANGE("Group Code", PlanGroupCode);
                                                                IF CompanyPlanGroupLine.FINDSET THEN BEGIN
                                                                  REPEAT
                                                                    Company.Name := CompanyPlanGroupLine."Company Name";
                                                                    Company.MARK(TRUE);
                                                                  UNTIL CompanyPlanGroupLine.NEXT = 0;
                                                                  Company.MARKEDONLY(TRUE);
                                                                END;
                                                              END;
                                                              IF PAGE.RUNMODAL(PAGE::Companies, Company) = ACTION::LookupOK THEN
                                                                VALIDATE("Target Company", Company.Name);
                                                            END;

                                                   CaptionML=[ENU=Target Company;
                                                              SVE=M†lf”retag] }
    { 300 ;   ;Work Order Text     ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Work Order Text" WHERE (Table Name=CONST(Work Order),
                                                                                              No.=FIELD(No.)));
                                                   CaptionML=[ENU=Work Order Text;
                                                              SVE=Text arbetsorder];
                                                   Editable=No }
    { 310 ;   ;Expected Starting Date;Date        ;OnValidate=BEGIN
                                                                TestExpectedDateTimes;
                                                                VALIDATE("Expected Dates Modified on", CREATEDATETIME(TODAY, TIME));
                                                                VALIDATE("Expected Starting Datetime", CREATEDATETIME("Expected Starting Date", "Expected Starting Time"));
                                                              END;

                                                   CaptionML=[ENU=Expected Starting Date;
                                                              NOR=Forventet startdato;
                                                              SVE=F”rv„ntat startdatum] }
    { 320 ;   ;Expected Starting Time;Time        ;OnValidate=BEGIN
                                                                TestExpectedDateTimes;
                                                                VALIDATE("Expected Dates Modified on", CREATEDATETIME(TODAY, TIME));
                                                                VALIDATE("Expected Starting Datetime", CREATEDATETIME("Expected Starting Date", "Expected Starting Time"));
                                                              END;

                                                   CaptionML=ENU=Expected Starting Time }
    { 330 ;   ;Expected Ending Date;Date          ;OnValidate=BEGIN
                                                                TestExpectedDateTimes;
                                                                VALIDATE("Expected Dates Modified on", CREATEDATETIME(TODAY, TIME));
                                                                VALIDATE("Expected Ending Datetime", CREATEDATETIME("Expected Ending Date", "Expected Ending Time"));
                                                              END;

                                                   CaptionML=[ENU=Expected Ending Date;
                                                              NOR=Forventet Sluttdato;
                                                              SVE=F”rv„ntat slutdatum] }
    { 340 ;   ;Expected Ending Time;Time          ;OnValidate=BEGIN
                                                                TestExpectedDateTimes;
                                                                VALIDATE("Expected Dates Modified on", CREATEDATETIME(TODAY, TIME));
                                                                VALIDATE("Expected Ending Datetime", CREATEDATETIME("Expected Ending Date", "Expected Ending Time"));
                                                              END;

                                                   CaptionML=[ENU=Expected Ending Time;
                                                              SVE=F”rv„ntat sluttid] }
    { 350 ;   ;Expected Dates Modified on;DateTime;CaptionML=[ENU=Expected Dates Modified on;
                                                              NOR=Forventede datoer modifisert den;
                                                              SVE=F”rv„ntade datum „ndrade den];
                                                   Editable=No }
    { 360 ;   ;Publish on Subcontr. Portal;Boolean;OnValidate=VAR
                                                                CTRLSetup@1100528300 : Record 11125686;
                                                                SubcontPortSetup@1100528600 : Record 11126402;
                                                                ResourceWOP@1100528601 : Record 11229278;
                                                                SubcontrPortLocation@1100528603 : Record 11126403;
                                                                ServiceOrder@1100528604 : Record 11012823;
                                                                SubcontPortVendor@1100528605 : Record 11126400;
                                                              BEGIN
                                                                TESTFIELD("Source Company", COMPANYNAME);
                                                                IF "Publish on Subcontr. Portal" THEN BEGIN
                                                                  IF (NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(CTRLSetup)) THEN
                                                                    CTRLSetup.Active := FALSE
                                                                  ELSE BEGIN
                                                                    IF (CTRLSetup.ISEMPTY) THEN
                                                                      CTRLSetup.Active := FALSE
                                                                    ELSE
                                                                      CTRLSetup.GET;
                                                                  END;
                                                                  IF (NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(SubcontPortSetup)) THEN
                                                                    SubcontPortSetup."Subcontracting Portal Active" := FALSE
                                                                  ELSE BEGIN
                                                                    IF (SubcontPortSetup.ISEMPTY) THEN
                                                                      SubcontPortSetup."Subcontracting Portal Active" := FALSE
                                                                    ELSE
                                                                      SubcontPortSetup.GET('1');
                                                                  END;
                                                                  IF (NOT SubcontPortSetup."Subcontracting Portal Active") AND (NOT CTRLSetup.Active) THEN
                                                                    ERROR(CtrlOrSubContrActiveTxt, SubcontPortSetup.TABLECAPTION,
                                                                      SubcontPortSetup.FIELDCAPTION("Subcontracting Portal Active"), CTRLSetup.TABLECAPTION,
                                                                      CTRLSetup.FIELDCAPTION(Active));

                                                                  TESTFIELD("Resource No.");
                                                                  TESTFIELD("Resource Type", "Resource Type"::Subcontractor);
                                                                  ResourceWOP.GET("Resource No.");
                                                                  ResourceWOP.TESTFIELD(Company, "Source Company");

                                                                  InsertSubcontrPortLocation;
                                                                  GetPublishOnSubcontrPort;
                                                                  GetPublishInControl;

                                                                  IF ServiceOrder.GET("Source No.") THEN BEGIN
                                                                    SubcontrPortLocation.SETRANGE("Vendor No.", ResourceWOP.GetVendorNo);
                                                                    IF NOT SubcontrPortLocation.ISEMPTY AND (ServiceOrder."Service Location No." <> '') THEN
                                                                      IF NOT SubcontrPortLocation.GET(ResourceWOP.GetVendorNo, '', ServiceOrder."Service Location No.") THEN
                                                                        ERROR(Text010, TABLECAPTION, "No.", SubcontPortVendor.TABLECAPTION, ResourceWOP.GetVendorNo);
                                                                  END;
                                                                  CreateSubcontrPurchaseOrder;
                                                                END ELSE
                                                                  DeleteSubcontrPortLocation;
                                                              END;

                                                   CaptionML=[ENU=Publish Work Orders;
                                                              NOR=Publiser p† underentrepen›rportal;
                                                              SVE=Visa p† UE portal] }
    { 370 ;   ;Project Element     ;Code20        ;OnValidate=VAR
                                                                JobsSetup@1100529601 : Record 315;
                                                                ProjectElement@1100528600 : Record 11012010;
                                                                ProjectElementManagement@1100528601 : Codeunit 11012285;
                                                                RequestLinkedToProject@1100527202 : Boolean;
                                                                ProjectNo@1100527201 : Code[20];
                                                                ProjectElementCompany@1100529600 : Text[30];
                                                              BEGIN
                                                                IF "Source Type" = "Source Type"::Project THEN
                                                                  ProjectNo := "Source No.";
                                                                ProjectElementCompany := "Source Company";
                                                                IF ("Source Type" = "Source Type"::Request) AND ("Project Element" <> '') THEN
                                                                  RequestLinkedToProject := RequestIsLinkedToProject(ProjectNo, ProjectElementCompany);
                                                                IF ("Source Type" <> "Source Type"::Project) AND (NOT RequestLinkedToProject) THEN
                                                                  TESTFIELD("Project Element", '')
                                                                ELSE BEGIN
                                                                  JobsSetup.GET;
                                                                  IF "Project Element" <> '' THEN BEGIN
                                                                    ProjectElementManagement.TestProjectElementPlanFunctionality;
                                                                    TESTFIELD("Source Company");
                                                                    TESTFIELD("Source No.");
                                                                    ProjectElement.CHANGECOMPANY(ProjectElementCompany);
                                                                    ProjectElement.GET(ProjectNo, "Project Element");
                                                                    Description := COPYSTR(ProjectElement.Description, 1, MAXSTRLEN(Description));
                                                                    IF "Source Type" <> "Source Type"::Request THEN BEGIN
                                                                      VALIDATE("Starting Date/Time", CREATEDATETIME(ProjectElement."Starting Date", ProjectElement."Starting Time"));
                                                                      VALIDATE("Ending Date/Time", CREATEDATETIME(ProjectElement."Ending Date", ProjectElement."Ending Time"));
                                                                      IF ProjectElement."Estimated Hours" <> 0 THEN BEGIN
                                                                        VALIDATE("Expected Hours", ProjectElement."Estimated Hours");
                                                                        VALIDATE("Duration Time", ProjectElement."Estimated Hours");
                                                                      END ELSE BEGIN
                                                                        VALIDATE("Expected Hours", JobsSetup."Expected Hours");
                                                                        VALIDATE("Duration Time", JobsSetup."Expected Hours");
                                                                      END;
                                                                    END;
                                                                  END ELSE BEGIN
                                                                    VALIDATE("Expected Hours", JobsSetup."Expected Hours");
                                                                    VALIDATE("Duration Time", JobsSetup."Expected Hours");
                                                                  END;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectElement@1100528600 : Record 11012010;
                                                              ProjectNo@1100527200 : Code[20];
                                                              ProjectElementCompany@1100529600 : Text[30];
                                                            BEGIN
                                                              ProjectElementCompany := "Source Company";
                                                              IF "Source Type" = "Source Type"::Request THEN BEGIN
                                                                IF NOT RequestIsLinkedToProject(ProjectNo, ProjectElementCompany) THEN
                                                                  EXIT;
                                                              END ELSE BEGIN
                                                                TESTFIELD("Source Type", "Source Type"::Project);
                                                                ProjectNo := "Source No.";
                                                              END;
                                                              TESTFIELD("Source Company");
                                                              TESTFIELD("Source No.");
                                                              ProjectElement.CHANGECOMPANY(ProjectElementCompany);
                                                              ProjectElement.SETRANGE("Project No.", ProjectNo);
                                                              IF "Project Element" <> '' THEN
                                                                IF ProjectElement.GET(ProjectNo, "Project Element") THEN;
                                                              IF PAGE.RUNMODAL(0, ProjectElement) = ACTION::LookupOK THEN
                                                                VALIDATE("Project Element", ProjectElement.Element);
                                                            END;

                                                   CaptionML=[ENU=Project Element;
                                                              NOR=Prosjektelement;
                                                              SVE=Projektelement] }
    { 375 ;   ;Extension Contract  ;Code10        ;OnValidate=VAR
                                                                ExtensionContract@1100528700 : Record 11012004;
                                                              BEGIN
                                                                IF "Source Type" <> "Source Type"::Project THEN
                                                                  TESTFIELD("Extension Contract", '');

                                                                IF "Extension Contract" <> '' THEN BEGIN
                                                                  TESTFIELD("Source Company");
                                                                  TESTFIELD("Source No.");
                                                                  ExtensionContract.CHANGECOMPANY("Source Company");
                                                                  ExtensionContract.GET("Source No.", "Extension Contract");
                                                                  Description := COPYSTR(ExtensionContract.Description, 1, MAXSTRLEN(Description));
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ExtensionContract@1100528700 : Record 11012004;
                                                            BEGIN
                                                              TESTFIELD("Source Type", "Source Type"::Project);
                                                              TESTFIELD("Source Company");
                                                              TESTFIELD("Source No.");
                                                              ExtensionContract.CHANGECOMPANY("Source Company");
                                                              ExtensionContract.SETRANGE("Project No.", "Source No.");
                                                              IF "Extension Contract" <> '' THEN
                                                                IF ExtensionContract.GET("Source No.", "Extension Contract") THEN;
                                                              IF PAGE.RUNMODAL(0, ExtensionContract) = ACTION::LookupOK THEN
                                                                VALIDATE("Extension Contract", ExtensionContract."Contract No.");
                                                            END;

                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=ŽTA] }
    { 380 ;   ;Date/Time Export Work Sheet;DateTime;
                                                   CaptionML=[ENU=Date/Time Export Work Sheet;
                                                              NOR=Dato/tid eksportarbeidsark;
                                                              SVE=Datum/tid f”r kalkylbladsexport];
                                                   Editable=No }
    { 390 ;   ;WO Finished (Field Service);Boolean;CaptionML=[ENU=Work Order Finished (Field Service);
                                                              SVE=Arbetsorder avslutad (F„ltservice)];
                                                   Editable=No }
    { 400 ;   ;Fld Srv Status Reason Desc.;Text50 ;CaptionML=ENU=Field Service Status Reason Description;
                                                   Editable=No }
    { 410 ;   ;Leading Resource    ;Boolean       ;OnValidate=VAR
                                                                WorkOrder@1100528600 : Record 11229279;
                                                                ResourceWOP@1100528601 : Record 11229278;
                                                              BEGIN
                                                                IF "Leading Resource" THEN BEGIN
                                                                  TESTFIELD("Resource Type", "Resource Type"::Employee);
                                                                  TESTFIELD("Resource No.");
                                                                  ResourceWOP.GET("Resource No.");
                                                                  ResourceWOP.TESTFIELD("Link WO to WO Leading Resource", FALSE);
                                                                  WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
                                                                  WorkOrder.SETRANGE("Source Company", "Source Company");
                                                                  WorkOrder.SETRANGE("Source Type", "Source Type");
                                                                  WorkOrder.SETRANGE("Source No.", "Source No.");
                                                                  WorkOrder.SETRANGE("Leading Resource", TRUE);
                                                                  WorkOrder.SETFILTER("No.", '<>%1', "No.");
                                                                  IF NOT WorkOrder.ISEMPTY THEN
                                                                    WorkOrder.MODIFYALL("Leading Resource", FALSE);
                                                                  LinkWorkOrdersToWOLeadingResource;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Leading Resource;
                                                              SVE=Verkst„llande resurs] }
    { 420 ;   ;Actual Ref. Point Set Manually;Boolean;
                                                   CaptionML=ENU=Actual Ref. Point Set Manually;
                                                   Editable=No }
    { 430 ;   ;Global Dimension 2 Code;Code20     ;OnValidate=VAR
                                                                DimensionValue@1100528400 : Record 349;
                                                              BEGIN
                                                                IF "Global Dimension 2 Code" <> '' THEN BEGIN
                                                                  SetFilterOnDimension2ValueInSourceCompany(DimensionValue);
                                                                  DimensionValue.FINDFIRST;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              DimensionValue@1100528400 : Record 349;
                                                            BEGIN
                                                              SetFilterOnDimension2ValueInSourceCompany(DimensionValue);
                                                              IF DimensionValue.FINDFIRST THEN;
                                                              DimensionValue.SETRANGE(Code);
                                                              IF PAGE.RUNMODAL(0, DimensionValue) = ACTION::LookupOK THEN
                                                                VALIDATE("Global Dimension 2 Code", DimensionValue.Code);
                                                            END;

                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              NOR=Global Dimensjon 2-kode;
                                                              SVE=Global dimension 2 kod];
                                                   CaptionClass='1,1,2' }
    { 440 ;   ;Created on          ;DateTime      ;CaptionML=[ENU=Created on;
                                                              NOR=Opprettet den;
                                                              SVE=Skapades];
                                                   Editable=No }
    { 450 ;   ;Created by          ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190000 : Code[50];
                                                              UserMgt@1210190001 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Created by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Created by;
                                                              NOR=Opprettet av;
                                                              SVE=Skapad av];
                                                   Editable=No }
    { 460 ;   ;Operates Plant (WO) ;Code20        ;TableRelation=IF (Resource Type=CONST(Employee)) "Work Order" WHERE (Resource Type=CONST(Plant),
                                                                                                                        Source No.=FIELD(Source No.),
                                                                                                                        Source Company=FIELD(Source Company));
                                                   OnValidate=VAR
                                                                PlantWorkOrder@1100529000 : Record 11229279;
                                                              BEGIN
                                                                IF "Operates Plant (WO)" <> '' THEN BEGIN
                                                                  IF NOT ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Subcontractor]) THEN
                                                                    FIELDERROR("Resource Type");
                                                                  IF "Source Type" = "Source Type"::Request THEN BEGIN
                                                                    PlantWorkOrder.GET("Operates Plant (WO)");
                                                                    PlantWorkOrder.TESTFIELD("Source Type", "Source Type");
                                                                    PlantWorkOrder.TESTFIELD("Source No.", "Source No.");
                                                                    PlantWorkOrder.TESTFIELD("Source Company", "Source Company");
                                                                    UpdateAdditionalInfoHoursOnOperatesPlantWO("Operates Plant (WO)");
                                                                  END;
                                                                END;
                                                                IF (xRec."Operates Plant (WO)" <> '') AND (xRec."Operates Plant (WO)" <> "Operates Plant (WO)" ) THEN
                                                                  UpdateAdditionalInfoHoursOnOperatesPlantWO(xRec."Operates Plant (WO)");
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupOperatesPlantWO;
                                                            END;

                                                   CaptionML=ENU=Opereates Plant (WO) }
    { 470 ;   ;Finished            ;Boolean       ;OnValidate=VAR
                                                                ResourceRequest@1100529001 : Record 11124901;
                                                                ResourceRequestStatusMgt@1100529000 : Codeunit 11124901;
                                                              BEGIN
                                                                IF "Source Type" = "Source Type"::Request THEN BEGIN
                                                                  IF Finished THEN
                                                                    ResourceRequestStatusMgt.CheckFinishWorkOrder_Request(Rec)
                                                                  ELSE BEGIN
                                                                    IF ResourceRequest.GET(Rec."Source No.") THEN
                                                                      ResourceRequest.TESTFIELD(Status, ResourceRequest.Status::Open);
                                                                    IF "Hour Acc. Created" THEN
                                                                      MESSAGE(Text020, TABLECAPTION, "No.");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Finished;
                                                              NOR=Avsluttet;
                                                              SVE=Avslutad];
                                                   Description=Only used for Resource Requests }
    { 480 ;   ;Hour Acc. Created   ;Boolean       ;CaptionML=ENU=Hour Acc. Created;
                                                   Description=Only used for Resource Requests;
                                                   Editable=Yes }
    { 490 ;   ;Assigned to         ;Code20        ;OnValidate=VAR
                                                                Employee@1100528600 : Record 5200;
                                                              BEGIN
                                                                IF "Assigned to" <> '' THEN BEGIN
                                                                  Employee.CHANGECOMPANY("Source Company");
                                                                  Employee.GET("Assigned to");
                                                                  "Name Assigned to" := Employee."Full Name";
                                                                END ELSE
                                                                  "Name Assigned to" := '';
                                                              END;

                                                   OnLookup=VAR
                                                              Employee@1100528600 : Record 5200;
                                                            BEGIN
                                                              Employee.CHANGECOMPANY("Source Company");
                                                              IF "Assigned to" <> '' THEN
                                                                Employee.GET("Assigned to");
                                                              IF PAGE.RUNMODAL(0, Employee) = ACTION::LookupOK THEN
                                                                VALIDATE("Assigned to", Employee."No.");
                                                            END;

                                                   CaptionML=[ENU=Assigned to;
                                                              NOR=Tilordnet;
                                                              SVE=Tilldelat till] }
    { 500 ;   ;Name Assigned to    ;Text100       ;CaptionML=[ENU=Name Assigned to;
                                                              NOR=Navn tilordnet til;
                                                              SVE=Namn tilldelat till];
                                                   Editable=No }
    { 510 ;   ;Firm Planned        ;Boolean       ;OnValidate=BEGIN
                                                                IF xRec."Firm Planned" <> "Firm Planned" THEN BEGIN
                                                                  IF NOT "Firm Planned" THEN BEGIN
                                                                    IF NOT CONFIRM(Text023) THEN
                                                                      ERROR('');
                                                                  END ELSE
                                                                    CheckFirmPlannedPlanDates;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Firm Planned;
                                                              NOR=Fast planlagt;
                                                              SVE=Fast planerad] }
    { 520 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Global dimensjon 1 kode;
                                                              SVE=Global dimension 1 kod];
                                                   Editable=No;
                                                   CaptionClass='1,1,1' }
    { 530 ;   ;Service Contract No.;Code20        ;TableRelation=Service-Contract.No.;
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Service Contract No.;
                                                              NOR=Servicekontraktnr;
                                                              SVE=Servicekontraktnr];
                                                   Editable=No }
    { 540 ;   ;Order Manager       ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Order Manager;
                                                              NOR=Ordreleder;
                                                              SVE=Orderchef];
                                                   Editable=No }
    { 550 ;   ;Link WO to WO Leading Resource;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)"."Link WO to WO Leading Resource" WHERE (No.=FIELD(Resource No.)));
                                                   CaptionML=ENU=Link WO to Leading Resource;
                                                   Editable=No }
    { 560 ;   ;Eventtype in Resource Planning;Code10;
                                                   TableRelation="Event Type".Code;
                                                   CaptionML=ENU=Event Type in Resource Planning }
    { 570 ;   ;Closing Date        ;Date          ;CaptionML=[ENU=Closing Date;
                                                              NOR=Sluttdato;
                                                              SVE=Avslutsdatum] }
    { 580 ;   ;Address             ;Text100       ;CaptionML=[ENU=Address;
                                                              NOR=Adresse;
                                                              SVE=Adress];
                                                   Editable=No }
    { 590 ;   ;Post Code           ;Code20        ;CaptionML=[ENU=Post Code;
                                                              NOR=Postnr.;
                                                              SVE=Postnr];
                                                   Editable=No }
    { 600 ;   ;City                ;Text30        ;CaptionML=[ENU=City;
                                                              NOR=Poststed;
                                                              SVE=Summa inklusive moms];
                                                   Editable=No }
    { 610 ;   ;Customer No.        ;Code20        ;CaptionML=[ENU=Customer No.;
                                                              NOR=Kundenr.;
                                                              SVE=Kundnr];
                                                   Editable=No }
    { 620 ;   ;Customer Name       ;Text100       ;CaptionML=[ENU=Customer Name;
                                                              NOR=Kundnavn;
                                                              SVE=Betalarens namn];
                                                   Editable=No }
    { 630 ;   ;Plot No.            ;Code20        ;TableRelation=IF (Source Type=CONST(Project)) Plot."Plot No." WHERE (Project No.=FIELD(Source No.));
                                                   CaptionML=[ENU=Plot No.;
                                                              SVE=Ritningnr] }
    { 640 ;   ;Expected Starting Datetime;DateTime;CaptionML=ENU=Expected Starting Date Time;
                                                   Editable=No }
    { 650 ;   ;Expected Ending Datetime;DateTime  ;CaptionML=ENU=Expected End Date Time;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Source Company,Source Type,Source No.    }
    {    ;Resource No.,Export to FSA               }
    {    ;Source Type,Source No.                   }
    {    ;Related Work Order No.                   }
    {    ;Resource No.,Starting Date/Time,Ending Date/Time }
    {    ;Source No.,Source Company,No.            }
    {    ;Resource No.,Ending Date/Time            }
    {    ;Source Company,Source Type,Starting Date/Time,Resource Type,Resource No.,Source No. }
    {    ;Source Company,Source Type,Ending Date/Time,Resource Type,Resource No.,Source No. }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      WorkOrderPlanningSetup@1100525000 : Record 11229277;
      NoSeriesMgt@1100525001 : Codeunit 396;
      CtrlOrSubContrActiveTxt@1100528300 : TextConst 'ENU=%1 %2 or %3 %4 must be active.';
      Text001@1100525004 : TextConst 'ENU=(%1) must be greater than %2 (%3)';
      Text002@1100525003 : TextConst 'ENU=may not be modified due to choosen blockade by actual Reference Point';
      AdviceOrderManagement@1100409003 : Codeunit 11012041;
      gDateTimeRefPointRegistr@1100527000 : DateTime;
      gOnDeleteSource@1100527005 : Boolean;
      gCollectivePublishSubcPortalRun@1100409000 : Boolean;
      gSkipCreatPurchOrder@1100409002 : Boolean;
      gSkipAddLinkedResources@1100529000 : Boolean;
      Text004@1100525005 : TextConst 'ENU=''%1'' with %2 ''%3'' not allowed forr %4 ''%5''';
      Text005@1100528600 : TextConst 'ENU=Deleting not Allowed. %1 in use in table %2.';
      Text007@1100528601 : TextConst 'ENU=%1 must be within %2 en %3';
      Text008@1100528603 : TextConst 'ENU=%1 cannot precede %2';
      Text009@1100528602 : TextConst 'ENU=%1 must be before %2';
      Text010@1100528604 : TextConst 'ENU=%1 %2 cannot be published on Subcontractors Portal, because the service location is not visible for %3 %4.;NOR=%1 %2 kan ikke publiserer p† underleverand›rs portal fordi tjenesten er ikke synlig for %3 %4';
      Text012@1100528605 : TextConst 'ENU=Actueel Reference Point is blocked for export of Work Order %1 to Field Service.';
      Text014@1100525006 : TextConst 'ENU=Assignment not accepted: the result would be a never ending chain of Work Orders';
      Text015@1100528607 : TextConst 'ENU=Work Order %1 cannot be modified due to limitations on Actual Reference Point';
      Text016@1100528609 : TextConst 'ENU="%1 cannot be %2 in %3 "';
      Text017@1100528608 : TextConst 'ENU=Work Order %1 is not part of Company Plan Group %2';
      Text018@1100528610 : TextConst 'ENU=%1 %2 of company %3 has status %4, creating or changing work order not allowed';
      Text020@1100529002 : TextConst 'ENU=Hour Accounting of %1 ''%2'' is already created, this may need to be adjusted manually';
      Text021@1100528000 : TextConst 'ENU=You can only export work orders of source type %1 or %2 to a FSA user.';
      Text022@1100528606 : TextConst 'ENU=Company %1 not part of current plan group';
      Text023@1100528611 : TextConst 'ENU=Work Order is Firm Planned, continue?';
      Text024@1100528612 : TextConst 'ENU=must occur before %1;NOR=m† inntreffe f›r %1;SVE=m†ste intr„ffa f”re %1';
      Text025@1100528613 : TextConst 'ENU=must occur between %1 and %2;NOR=M† inntreffe mellom %1 og %2;SVE=m†ste intr„ffa mellan %1 och %2';
      Text026@1100528614 : TextConst 'ENU=Work Order %1 is Firm Planned, changes not allowed';
      Text027@1100528615 : TextConst 'ENU=Work Order %1 already contains an Inventory Location.';
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      Text028@1100526200 : TextConst 'ENU=You can only export work orders of source type %1 to an active app user.';
      SkipCheckOnBlockModifyDuringRemoval@1100528400 : Boolean;
      ReferencePointModifiedByEmployee@1100526000 : Code[20];
      SkipOnModifyServiceOrders@1100525002 : Boolean;
      Text030@1100527450 : TextConst 'ENU=The field Actual Reference Point of table Work Order contains a value (%1) that cannot be found in the related table (Reference Point).';
      Text031@1100527350 : TextConst 'ENU=Starting Time;SVE=Starttid';
      Text032@1100527351 : TextConst 'ENU=Ending Time;SVE=Sluttid';
      Text033@1100527352 : TextConst 'ENU=First Possible Starting Time;SVE=F”rsta m”jliga starttid';
      Text034@1100527353 : TextConst 'ENU=Last Possible Ending Time;SVE=Senast m”jliga sluttid';
      Text035@1100527354 : TextConst 'ENU=must occur after %1';
      Text036@1100527355 : TextConst 'ENU=Starting Date;SVE=Startdatum';
      Text037@1100527356 : TextConst 'ENU=First Possible Starting Date;SVE=F”rsta m”jliga startdatum';
      Text038@1100527357 : TextConst 'ENU=Last Possible Ending Date;SVE=Senast m”jliga slutdatum';
      Text039@1100527358 : TextConst 'ENU=Ending Date;SVE=Slutdatum';

    PROCEDURE AssistEdit@2(OldWorkOrder@11012000 : Record 11229279) : Boolean;
    VAR
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      WITH WorkOrder DO BEGIN
        WorkOrder := Rec;
        WorkOrderPlanningSetup.GET;
        WorkOrderPlanningSetup.TESTFIELD("Work Order Nos.");
        IF NoSeriesMgt.SelectSeries(WorkOrderPlanningSetup."Work Order Nos.",WorkOrder."No. Series","No. Series") THEN BEGIN
          NoSeriesMgt.SetSeries("No.");
          Rec := WorkOrder;
          EXIT(TRUE);
        END;
      END;
    END;

    PROCEDURE ValidateSourceNo@1100525000();
    VAR
      ServOrder@1100525000 : Record 11012823;
      Proj@1100525001 : Record 11072003;
      ResourceRequest@1100529000 : Record 11124901;
      Employee@1100528600 : Record 5200;
    BEGIN
      TESTFIELD("Source Company");
      CASE "Source Type" OF
        "Source Type"::ServiceOrder:
          BEGIN
            ServOrder.CHANGECOMPANY("Source Company");
            ServOrder.GET("Source No.");
            Description := COPYSTR(ServOrder.Description, 1, MAXSTRLEN(Description));

            //>>4PSSE,180925,Feature #19381
            IF STRLEN(Description)+5 < MAXSTRLEN(Description) THEN
              Description := Description + ' ';
            IF STRLEN(Description)+5 > MAXSTRLEN(Description) THEN
              Description := COPYSTR(Description,1,MAXSTRLEN(Description)-5);
            IF STRLEN(ServOrder."No.") > 5 THEN
              Description := Description + COPYSTR(ServOrder."No.",STRLEN(ServOrder."No.") -(5-1))
            ELSE
              Description := Description + ServOrder."No.";
            //<<

            IF ServOrder."Starting Date" <> 0D THEN
              "Starting Date/Time" := DATI2VARIANT(ServOrder."Starting Date", ServOrder."Starting Time")
            ELSE
              "Starting Date/Time" := 0DT;
            IF ServOrder."Ending Date" <> 0D THEN
              "Ending Date/Time" := DATI2VARIANT(ServOrder."Ending Date", ServOrder."Ending Time")
            ELSE
              "Ending Date/Time" := 0DT;
            IF "Starting Date/Time" = "Ending Date/Time" THEN
              "Ending Date/Time" := 0DT;
            IF ServOrder."First Possible Starting Date" <> 0D THEN
              "First Possible Start.Date/Time" :=
                DATI2VARIANT(ServOrder."First Possible Starting Date", ServOrder."First Possible Starting Time")
            ELSE
              "First Possible Start.Date/Time" := 0DT;
            IF ServOrder."Last Possible Ending Date" <> 0D THEN
              "Last Possible Ending Date/Time" :=
                DATI2VARIANT(ServOrder."Last Possible Ending Date", ServOrder."Last Possible Ending Time")
            ELSE
              "Last Possible Ending Date/Time" := 0DT;
            "Expected Hours" := ServOrder."Expected Hours";
            "Duration Time" := ServOrder."Duration Time";
            "Assigned to" := ServOrder."Assigned to";
            VALIDATE("Firm Planned", ServOrder."Firm Planned");
            DetermineExtraField(ServOrder);
          END;
        "Source Type"::Project:
          BEGIN
            Proj.CHANGECOMPANY("Source Company");
            Proj.GET("Source No.");
            Description := COPYSTR(Proj.Description, 1, MAXSTRLEN(Description));
            "Assigned to" := GetJobAssignedTo(Proj);
            DetermineExtraField(Proj);
          END;
        "Source Type"::Request:
          BEGIN
            ResourceRequest.CHANGECOMPANY("Source Company");
            ResourceRequest.GET("Source No.");
            Description := COPYSTR(ResourceRequest.Description, 1, MAXSTRLEN(Description));
            DetermineExtraField(ResourceRequest);
          END;
        ELSE
          FIELDERROR("Source Type");
      END;
      Employee.CHANGECOMPANY("Source Company");
      IF Employee.GET("Assigned to") THEN
        "Name Assigned to" := Employee."Full Name";
      "Signature Mandatory" := GetSignatureMandatory;
    END;

    PROCEDURE LookupSourceNo@1100525002(EditableMode@1100525002 : Boolean);
    VAR
      ServOrder@1100525001 : Record 11012823;
      Proj@1100525000 : Record 11072003;
      ResourceRequest@1100529000 : Record 11124901;
    BEGIN
      TESTFIELD("Source Company");
      CASE "Source Type" OF
        "Source Type"::ServiceOrder:
          BEGIN
            ServOrder.CHANGECOMPANY("Source Company");
            ServOrder."No." := "Source No.";
            IF NOT EditableMode THEN
              PAGE.RUNMODAL(0, ServOrder)
            ELSE BEGIN
              IF PAGE.RUNMODAL(0, ServOrder) = ACTION::LookupOK THEN BEGIN
                IF ServOrder."No." <> "Source No."  THEN
                  VALIDATE("Source No.", ServOrder."No.");
              END;
            END;
          END;
        "Source Type"::Project:
          BEGIN
            Proj.CHANGECOMPANY("Source Company");
            Proj."No." := "Source No.";
            IF NOT EditableMode THEN
              PAGE.RUNMODAL(0, Proj)
            ELSE BEGIN
              IF PAGE.RUNMODAL(0, Proj) = ACTION::LookupOK THEN BEGIN
                IF  Proj."No." <> "Source No." THEN
                  VALIDATE("Source No.", Proj."No.");
              END;
            END;
          END;
        "Source Type"::Request:
          BEGIN
            ResourceRequest.CHANGECOMPANY("Source Company");
            ResourceRequest."No." := "Source No.";
            IF NOT EditableMode THEN
              PAGE.RUNMODAL(0, ResourceRequest)
            ELSE BEGIN
              IF PAGE.RUNMODAL(0, ResourceRequest) = ACTION::LookupOK THEN BEGIN
                IF  ResourceRequest."No." <> "Source No." THEN
                  VALIDATE("Source No.", ResourceRequest."No.");
              END;
            END;
          END;
      END;
    END;

    PROCEDURE LookupRelatedWorkOrder@1100527003(EditableMode@1100527000 : Boolean);
    VAR
      WorkOrder@1100527001 : Record 11229279;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder."Source Company" := "Source Company";
      WorkOrder."Source Type" := "Source Type";
      WorkOrder."Source No." := "Source No.";
      WorkOrder."No." := "Related Work Order No.";
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, WorkOrder)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, WorkOrder) = ACTION::LookupOK THEN BEGIN
          IF (WorkOrder."No." <> "Related Work Order No.") AND (WorkOrder."No." <> "No.") THEN
            VALIDATE("Related Work Order No.", WorkOrder."No.");
        END;
      END;
    END;

    PROCEDURE GetSourceNoDescription@1100525001() : Text[100];
    VAR
      ServOrder@1100525000 : Record 11012823;
      Proj@1100525001 : Record 11072003;
      ResourceRequest@1100529000 : Record 11124901;
    BEGIN
      IF ("Source Company" <> '') AND ("Source No." <> '') THEN BEGIN
        CASE "Source Type" OF
          "Source Type"::ServiceOrder:
            BEGIN
              ServOrder.CHANGECOMPANY("Source Company");
              IF ServOrder.GET("Source No.") THEN
                EXIT(ServOrder.Description);
            END;
          "Source Type"::Project:
            BEGIN
              Proj.CHANGECOMPANY("Source Company");
              IF Proj.GET("Source No.") THEN
                EXIT(Proj.Description);
            END;
          "Source Type"::Request:
            BEGIN
              ResourceRequest.CHANGECOMPANY("Source Company");
              IF ResourceRequest.GET("Source No.") THEN
                EXIT(ResourceRequest.Description);
            END;
        END;
      END;
      EXIT('');
    END;

    PROCEDURE SetFiltersOnSource@1100525004(SourceCompany@1100527000 : Text[30];SourceType@1100525001 : Option;SourceNo@1100525000 : Code[20];VAR WorkOrder@1100525002 : Record 11229279);
    BEGIN
      FILTERGROUP(FilterGroupSourceFilter);
      IF SourceCompany = '' THEN
        SourceCompany := COMPANYNAME;
      SETRANGE("Source Company", SourceCompany);
      SETRANGE("Source Type", SourceType);
      SETRANGE("Source No.", SourceNo);
      FILTERGROUP(0);
    END;

    PROCEDURE InitRecordOnNew@1100525003(SourceType@1100525000 : Option;SourceNo@1100525001 : Code[20];ResourceType@1100525002 : Option;ProjectElement@1100528300 : Code[20]);
    BEGIN
      "Source Company" := COMPANYNAME;
      IF SourceType >= 0 THEN BEGIN
        "Source Type" := SourceType;
        VALIDATE("Source No.", SourceNo);
      END;
      IF "Resource Type" = 0 THEN
        "Resource Type" := ResourceType;
      IF (SourceType = 11) OR (SourceType = 21) THEN //11=Project 21=Resource Request
        VALIDATE("Project Element", ProjectElement);
    END;

    PROCEDURE DetermineSourceNoFromFilter@1100525005() : Code[20];
    VAR
      SourceNoFilter@1100525001 : Text[1024];
    BEGIN
      FILTERGROUP(FilterGroupSourceFilter);
      SourceNoFilter := GETFILTER("Source No.");
      FILTERGROUP(0);
      IF (SourceNoFilter <> '') AND (STRLEN(SourceNoFilter) <= MAXSTRLEN("Source No.")) THEN
        EXIT(SourceNoFilter);
      EXIT('');
    END;

    PROCEDURE FilterGroupSourceFilter@1100525006() : Integer;
    BEGIN
      EXIT(2);
      // Note: Filtergroup 0/5.. (platformbug acc. to Peter), problem with New in Card. Because filters empty Source No.
      //       can not be determined. Therefore tried/used filtergroup 2, that works.
    END;

    PROCEDURE HasSignature@1100525007() : Boolean;
    VAR
      WorkOrderSignature@1100525000 : Record 11229280;
    BEGIN
      IF "No." <> '' THEN BEGIN
        IF WorkOrderSignature.GET("No.") THEN
          EXIT(WorkOrderSignature.Signature.COUNT > 0);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetInitialReferencePoint@1100525008();
    VAR
      ReferencePoint@1100525000 : Record 11020271;
    BEGIN
      ReferencePoint.CHANGECOMPANY("Source Company");
      ReferencePoint.SETRANGE(Apply, ReferencePoint.Apply::ServOrder);
      ReferencePoint.SETRANGE("Triggered by Status ServOrder", ReferencePoint."Triggered by Status ServOrder"::Open);
      IF ReferencePoint.FINDFIRST THEN
        "Actual Reference Point" := ReferencePoint."No.";
    END;

    LOCAL PROCEDURE GetExportReferencePoint@1100525012();
    VAR
      MobileSetup@1100525000 : Record 11012676;
    BEGIN
      IF MobileSetup.GET THEN BEGIN
        MobileSetup.TESTFIELD("Ref. Point Sending SO");
        "Actual Reference Point" := MobileSetup."Ref. Point Sending SO";
      END;
    END;

    PROCEDURE CheckEndAfterStart@1100527002(CurrFieldNo@1100527000 : Integer);
    BEGIN
      CASE CurrFieldNo OF
        FIELDNO("Starting Date/Time"),
        FIELDNO("Ending Date/Time"):
          BEGIN
            IF ("Ending Date/Time" <> 0DT) AND ("Ending Date/Time" <= "Starting Date/Time") THEN
              FIELDERROR("Ending Date/Time", STRSUBSTNO(Text001,
                "Ending Date/Time", FIELDCAPTION("Starting Date/Time"), "Starting Date/Time"));
          END;
        FIELDNO("First Possible Start.Date/Time"),
        FIELDNO("Last Possible Ending Date/Time"):
          BEGIN
            IF ("Last Possible Ending Date/Time" <> 0DT) AND ("Last Possible Ending Date/Time" <= "First Possible Start.Date/Time") THEN
              FIELDERROR("Last Possible Ending Date/Time", STRSUBSTNO(Text001,
                "Last Possible Ending Date/Time", FIELDCAPTION("First Possible Start.Date/Time"), "First Possible Start.Date/Time"));
          END;
      END;
    END;

    PROCEDURE CheckPlanDataFSA@1100485032();
    BEGIN
      IF "Actual Reference Point" = 0 THEN
        EXIT;
      IF CurrFieldNo = 0 THEN
        EXIT;
      CASE CurrFieldNo OF
        FIELDNO("Starting Date/Time"):
          IF "Starting Date/Time" = xRec."Starting Date/Time" THEN
            EXIT;
        FIELDNO("Ending Date/Time"):
          IF "Ending Date/Time" = xRec."Ending Date/Time" THEN
            EXIT;
        FIELDNO("First Possible Start.Date/Time"):
          IF "First Possible Start.Date/Time" = xRec."First Possible Start.Date/Time" THEN
            EXIT;
        FIELDNO("Last Possible Ending Date/Time"):
          IF "Last Possible Ending Date/Time" = xRec."Last Possible Ending Date/Time" THEN
            EXIT;
        FIELDNO("Expected Hours"):
          IF "Expected Hours" = xRec."Expected Hours" THEN
            EXIT;
        FIELDNO("Duration Time"):
          IF "Duration Time" = xRec."Duration Time" THEN
            EXIT;
        FIELDNO("Plan during Clock Time"):
          IF "Plan during Clock Time" = xRec."Plan during Clock Time" THEN
            EXIT;
        FIELDNO("Resource No."):
          IF "Resource No." = xRec."Resource No." THEN
            EXIT;
        FIELDNO("Export to FSA"):
          IF "Export to FSA" = xRec."Export to FSA" THEN
            EXIT;
      END;

      IF CheckReferencePoint(FALSE) THEN
        EXIT;

      CASE CurrFieldNo OF
        FIELDNO("Starting Date/Time"):
          FIELDERROR("Starting Date/Time", Text002);
        FIELDNO("First Possible Start.Date/Time"):
          FIELDERROR("First Possible Start.Date/Time", Text002);
        FIELDNO("Last Possible Ending Date/Time"):
          FIELDERROR("Last Possible Ending Date/Time", Text002);
        FIELDNO("Expected Hours"):
          FIELDERROR("Expected Hours", Text002);
        FIELDNO("Duration Time"):
          FIELDERROR("Duration Time", Text002);
        FIELDNO("Plan during Clock Time"):
          FIELDERROR("Plan during Clock Time", Text002);
        FIELDNO("Resource No."):
          FIELDERROR("Resource No.", Text002);
        FIELDNO("Export to FSA"):
          FIELDERROR("Export to FSA", Text002);
      END;
    END;

    LOCAL PROCEDURE CheckReferencePoint@1100528302(ExportToFsa@1100528301 : Boolean) : Boolean;
    VAR
      ReferencePoint@1100528300 : Record 11020271;
    BEGIN
      ReferencePoint.CHANGECOMPANY("Source Company");
      IF NOT ReferencePoint.GET("Actual Reference Point") THEN
        EXIT(TRUE);
      IF ((CurrFieldNo = FIELDNO("Export to FSA")) OR ExportToFsa) AND "Export to FSA" AND ReferencePoint."Skip Export to FSA" THEN
        ERROR(Text012, "No.");
      IF NOT ReferencePoint."Block Modify Service Order" THEN
        EXIT(TRUE);
    END;

    PROCEDURE CheckResourceSchedule@1100525011(ErrorMode@1100525001 : Boolean) : Boolean;
    VAR
      Resource@1100525000 : Record 11229278;
    BEGIN
      IF "Resource No." = '' THEN
        EXIT(TRUE);
      Resource.GET("Resource No.");
      IF (("Source Type" = "Source Type"::ServiceOrder) AND
          (Resource.Schedule IN [Resource.Schedule::ServiceOrder, Resource.Schedule::Both])) OR
         (("Source Type" = "Source Type"::Project) AND
          (Resource.Schedule IN [Resource.Schedule::Project, Resource.Schedule::Both])) OR
         (("Source Type" = "Source Type"::Request))
      THEN
        EXIT(TRUE);

      IF ErrorMode THEN BEGIN
        FIELDERROR("Resource No.", STRSUBSTNO(Text004,
          "Resource No.", Resource.FIELDCAPTION(Schedule), Resource.Schedule, FIELDCAPTION("Source Type"),  "Source Type"));
      END;
      EXIT(FALSE);
    END;

    PROCEDURE DuplicateWorkorder@1100525009(ICopyResource@1100528600 : Boolean) : Code[20];
    VAR
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      TESTFIELD("No.");
      WorkOrder := Rec;
      WorkOrder."No." := '';
      WorkOrder."Export to FSA" := FALSE;
      WorkOrder."Publish on Subcontr. Portal" := FALSE;
      WorkOrder."WO Finished (Field Service)" := FALSE;
      WorkOrder."Leading Resource" := FALSE;
      IF NOT ICopyResource THEN
        WorkOrder.VALIDATE("Resource No.", '');
      WorkOrder."Fld Srv Status Reason Desc." := '';
      WorkOrder.INSERT(TRUE);
      EXIT(WorkOrder."No.");
    END;

    PROCEDURE RepeatWorkorder@1100528601();
    VAR
      RepeatWorkOrderPAGE@1100528600 : Page 11229294;
    BEGIN
      RepeatWorkOrderPAGE.SetOriginalWorkOrder(Rec);
      RepeatWorkOrderPAGE.StdDialogRunModal;
    END;

    PROCEDURE SetOnDeleteSource@1100527011();
    BEGIN
      gOnDeleteSource := TRUE;
    END;

    PROCEDURE SetDateTimeRefPointRegistr@1100527005(DateTimeRefPointRegistration@1100527000 : DateTime);
    BEGIN
      gDateTimeRefPointRegistr := DateTimeRefPointRegistration;
    END;

    PROCEDURE SetReferencePointModifiedByEmployee@1100527006(Employee@1100527000 : Code[20]);
    BEGIN
      ReferencePointModifiedByEmployee := Employee;
    END;

    LOCAL PROCEDURE UpdateRefPointWO@1100527000(xWorkOrder@1100528502 : Record 11229279);
    VAR
      RefPoint@1100527000 : Record 11020271;
      WorkOrderRefPoint@1100485000 : Record 11229282;
      ProgressPhase@1100528500 : Record 11020251;
      ReferencePeriod@1100528501 : Record 11020272;
      ChangeLogSubscriberGRP@1100529101 : Codeunit 11124903;
      InstallationManagement@1100529100 : Codeunit 11012268;
      DateTimeReg@1100527002 : DateTime;
      RefPointNumber@1100409000 : Integer;
      OldActualReferencePointFilter@1100528600 : Text;
    BEGIN
      IF ("Actual Field Service Status" = xWorkOrder."Actual Field Service Status") AND
         ("Actual Reference Point" = xWorkOrder."Actual Reference Point" )
      THEN //C016653
        EXIT;
      TESTFIELD("Source Company", COMPANYNAME);

      IF ("Actual Field Service Status" <> '') AND ("Actual Field Service Status" <> xWorkOrder."Actual Field Service Status") THEN BEGIN
        RefPoint.RESET;
        RefPoint.SETRANGE(Apply, RefPoint.Apply::ServOrder);
        RefPoint.SETRANGE("Triggered by Field Service", "Actual Field Service Status");
        IF NOT RefPoint.FINDFIRST THEN  //* FS-trigger may occur only once, so only read first
          EXIT;
        RefPointNumber := RefPoint."No."; //C016653
      END ELSE BEGIN
        IF "Actual Reference Point" = xWorkOrder."Actual Reference Point" THEN
          EXIT;
        IF NOT RefPoint.GET("Actual Reference Point") THEN
          EXIT;
        RefPointNumber := RefPoint."No.";  //C016653
      END;

      IF gDateTimeRefPointRegistr <> 0DT THEN
        DateTimeReg := gDateTimeRefPointRegistr
      ELSE
        DateTimeReg := CURRENTDATETIME;
      IF WorkOrderRefPoint.GET("No.", DateTimeReg) THEN BEGIN
        WorkOrderRefPoint.SETRANGE("Work Order No.", "No.");
        REPEAT
          // Can be 2 with in the same debrief message with the same time (sec).
          DateTimeReg := DateTimeReg + 1;  //Add 1 msec
        UNTIL NOT WorkOrderRefPoint.GET("No.", DateTimeReg);
      END;

      MODIFY;

      WorkOrderRefPoint.INIT;
      WorkOrderRefPoint."Work Order No." := "No.";
      WorkOrderRefPoint."Date/Time Registrated" := DateTimeReg;
      WorkOrderRefPoint."Reference Point" := RefPointNumber;//C016653
      WorkOrderRefPoint."Field Service Status" := "Actual Field Service Status";
      IF "Actual Ref. Point Set Manually" THEN
        WorkOrderRefPoint.Manually := TRUE;

      WorkOrderRefPoint.INSERT(TRUE);

      OldActualReferencePointFilter := GETFILTER("Actual Reference Point");
      SETRANGE("Actual Reference Point");
      FIND('=');

      WorkOrderRefPoint.RESET;
      WorkOrderRefPoint.SETRANGE("Work Order No.", "No.");
      IF WorkOrderRefPoint.FINDLAST THEN
        IF NOT RefPoint."N/A for Actual Reference Point" THEN
          "Actual Reference Point" := WorkOrderRefPoint."Reference Point";

      IF RefPoint.IsOrderFinished THEN
        "WO Finished (Field Service)" := TRUE;
      IF "Actual Ref. Point Set Manually" THEN
        "Actual Ref. Point Set Manually" := FALSE;
      MODIFY;

      ProgressPhase.CopyRefPeriod(ReferencePeriod.Type::WorkOrder,'',"No.");
      ProgressPhase.CheckProgressWithoutScheme(ReferencePeriod.Type::WorkOrder,"No.",0,VARIANT2DATE(DateTimeReg),VARIANT2TIME(DateTimeReg),"Actual Reference Point");

      IF OldActualReferencePointFilter <> '' THEN
        SETFILTER("Actual Reference Point", OldActualReferencePointFilter);

      UpdateRefPointSO(RefPoint, DateTimeReg);

      UpdateRefPointWOsLinkedToWOLeadingResource;
      UpdateRefPointRelatedWOs;
      IF InstallationManagement.LicensePermissionForTableData(DATABASE::"Resource Planning Setup") THEN
        ChangeLogSubscriberGRP.UpdateWorkorderChangeLog("No.");
    END;

    LOCAL PROCEDURE UpdateRefPointSO@1100527004(RefPoint@1100527005 : Record 11020271;DateTimeReg@1100527007 : DateTime);
    VAR
      ServOrder@1100527003 : Record 11012823;
      RelatedWorkOrder@1100527000 : Record 11229279;
      DocRefPoint@1100527006 : Record 11020296;
      ProgPhase@1100527004 : Record 11020251;
      WorkOrderPlanningSetup@1100409000 : Record 11229277;
      WorkOrderInfoManagement@1100528600 : Codeunit 11229278;
      DateReg@1100527009 : Date;
      TimeReg@1100527010 : Time;
      UpdateSO@1100527002 : Boolean;
      ActRefPoint@1100527008 : Integer;
      MaxFieldServiceStatus@1100527001 : Text[30];
      CompareMode@1100525000 : Text[2];
    BEGIN
      IF ("Source Type" <> "Source Type"::ServiceOrder) OR ("Source No." = '') THEN
        EXIT;

      IF NOT ServOrder.GET("Source No.") THEN
        EXIT;

      IF (ServOrder."Actual Reference Point (Gantt)" = RefPoint."No.") AND (RefPoint."No." <> 65) THEN // T007336.n
        EXIT;                                                             // T007336.n

      IF "Actual Field Service Status" <> '' THEN BEGIN
        RelatedWorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
        RelatedWorkOrder.SETRANGE("Source Company", "Source Company");
        RelatedWorkOrder.SETRANGE("Source Type", "Source Type");
        RelatedWorkOrder.SETRANGE("Source No.", "Source No.");
        RelatedWorkOrder.SETFILTER("No.", '<>%1', "No.");
        IF RelatedWorkOrder.FINDSET THEN BEGIN
          REPEAT
            IF CompareFieldServiceStatusr1And2(RelatedWorkOrder."Actual Field Service Status", MaxFieldServiceStatus, '>') THEN
              MaxFieldServiceStatus := RelatedWorkOrder."Actual Field Service Status";
          UNTIL RelatedWorkOrder.NEXT = 0;
        END;
        CompareMode := '>';
        IF "Actual Field Service Status" IN ['20', '30', '40', '90', '100'] THEN
          CompareMode := '>=';
        IF ("Actual Field Service Status" IN ['45', '50', '60']) AND
          (RefPoint."For Multiple Work Orders" = RefPoint."For Multiple Work Orders"::"All Work Orders") THEN
          CompareMode := '>=';
        IF NOT ("Actual Field Service Status" IN ['65', '70']) THEN
          IF NOT CompareFieldServiceStatusr1And2("Actual Field Service Status", MaxFieldServiceStatus, CompareMode) THEN
            EXIT;

        CASE "Actual Field Service Status" OF
          '20':  // Received in Mobile
            BEGIN
              IF RefPoint."For Multiple Work Orders" = RefPoint."For Multiple Work Orders"::"First Work Order" THEN
                UpdateSO := TRUE
              ELSE BEGIN
                RelatedWorkOrder.SETRANGE("Active in FSA", TRUE);
                RelatedWorkOrder.SETFILTER("Actual Field Service Status", '<>%1&<>%2', '20', '25');
                IF RelatedWorkOrder.ISEMPTY THEN
                  UpdateSO := TRUE
                ELSE BEGIN
                  RelatedWorkOrder.SETRANGE("Active in FSA");
                  RelatedWorkOrder.SETRANGE("Resource Type", RelatedWorkOrder."Resource Type"::Subcontractor);
                  IF RelatedWorkOrder.ISEMPTY THEN
                    UpdateSO := TRUE;
                END;
              END;
            END;
          '25':  // Resended and received in Mobile
            EXIT; // No update in SO
          '30':  // Declined
            BEGIN
              IF RefPoint."For Multiple Work Orders" = RefPoint."For Multiple Work Orders"::"First Work Order" THEN
                UpdateSO := TRUE
              ELSE BEGIN
                RelatedWorkOrder.SETFILTER("Actual Field Service Status", '<>%1', '30');
                IF RelatedWorkOrder.ISEMPTY THEN
                  UpdateSO := TRUE;
              END;
            END;
          '40',  // Accepted
          '45',  // Decentral created
          '50',  // Start Travel
          '60':  // Start Work (In Process)
            IF RefPoint."For Multiple Work Orders" IN [0,RefPoint."For Multiple Work Orders"::"First Work Order"] THEN
              UpdateSO := TRUE
            ELSE BEGIN
              RelatedWorkOrder.SETFILTER("Actual Field Service Status", '<%1',"Actual Field Service Status");
              IF RelatedWorkOrder.ISEMPTY THEN
                UpdateSO := TRUE;
            END;
          '65':  // Ready, follow up needed
            BEGIN
              WorkOrderPlanningSetup.GET;
              IF "Actual Reference Point" <> WorkOrderPlanningSetup."Ref. Point Next Work Order" THEN
                IF RefPoint."For Multiple Work Orders" IN [0,RefPoint."For Multiple Work Orders"::"First Work Order"] THEN
                  UpdateSO := TRUE
                ELSE BEGIN
                  RelatedWorkOrder.SETFILTER("Actual Field Service Status", '<%1',"Actual Field Service Status");
                  IF RelatedWorkOrder.ISEMPTY THEN
                    UpdateSO := TRUE;
                END;
            END;
          '70':  // Ready (Technical Finished)
            BEGIN
              WorkOrderPlanningSetup.GET;
              IF RefPoint."For Multiple Work Orders" = RefPoint."For Multiple Work Orders"::"First Work Order" THEN
                UpdateSO := TRUE
              ELSE BEGIN
                RelatedWorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
                RelatedWorkOrder.SETFILTER("Actual Reference Point",'<>%1&<>%2',RefPoint."No.",WorkOrderPlanningSetup."Ref. Point Next Work Order");
                IF RelatedWorkOrder.ISEMPTY THEN BEGIN
                  RelatedWorkOrder.SETRANGE("WO Finished (Field Service)");
                  RelatedWorkOrder.SETFILTER("Actual Reference Point", '<>%1&<>%2&<>%3',
                    RefPoint."No.",WorkOrderPlanningSetup."Ref. Point Next Work Order",WorkOrderInfoManagement.GetRefPointNoOfFieldServiceFinished);
                  IF RelatedWorkOrder.ISEMPTY THEN
                    UpdateSO := TRUE;
                END;
              END;
            END;
          '90':  // On Hold
            EXIT;
          '100':  // Completed (Ready)
            BEGIN
              IF RefPoint."For Multiple Work Orders" = RefPoint."For Multiple Work Orders"::"First Work Order" THEN
                UpdateSO := TRUE
              ELSE BEGIN
                RelatedWorkOrder.SETFILTER("Actual Field Service Status", '<>%1&<>%2', '100', '500');
                IF RelatedWorkOrder.ISEMPTY THEN
                  UpdateSO := TRUE
                ELSE BEGIN
                  UpdateSO := TRUE;
                  RelatedWorkOrder.FINDSET;
                  REPEAT
                    IF RelatedWorkOrder."Actual Reference Point" <> 67 THEN BEGIN
                      UpdateSO := FALSE;
                      BREAK;
                    END;
                  UNTIL RelatedWorkOrder.NEXT = 0;
                END;
              END;
            END;
          '500':  // Already Completed (error resended while already completed)
            EXIT; // No update in SO
          ELSE
            EXIT;
        END;
      END ELSE BEGIN
        CASE RefPoint."Triggered by Status ServOrder" OF
          RefPoint."Triggered by Status ServOrder"::"In Process":
            UpdateSO := TRUE;
          RefPoint."Triggered by Status ServOrder"::"Technical Finished":
            BEGIN
              IF RefPoint."For Multiple Work Orders" = RefPoint."For Multiple Work Orders"::"First Work Order" THEN
                UpdateSO := TRUE
              ELSE BEGIN
                RelatedWorkOrder.SETFILTER("Actual Reference Point", GetReferencePointFilterBySOStatus(RefPoint."Triggered by Status ServOrder"::"Technical Finished", '<>', '&'));
                IF RelatedWorkOrder.ISEMPTY THEN
                  UpdateSO := TRUE;
              END;
            END;
        END;
      END;
      IF NOT UpdateSO THEN
        EXIT;

      DocRefPoint.SetModifiedByEmployee(ReferencePointModifiedByEmployee);
      DocRefPoint.InsertDocRefPointWithNo(DocRefPoint.Type::ServOrder, ServOrder."No.", RefPoint."No.", DT2DATE(DateTimeReg), DT2TIME(DateTimeReg));
      ActRefPoint := DocRefPoint.GetNewActRefPoint;
      ServOrder.GET("Source No.");
      IF (ActRefPoint > 0) AND (ActRefPoint <> ServOrder."Actual Reference Point (Gantt)") THEN BEGIN
        ServOrder."Actual Reference Point (Gantt)" := ActRefPoint;
        ServOrder.MODIFY(FALSE);
      END;
      IF (RefPoint."Triggered by Status ServOrder" > 0) AND (ServOrder.Status <= ServOrder.Status::"Technical Finished") THEN BEGIN
        ServOrder.VALIDATE(Status, RefPoint."Triggered by Status ServOrder" - 1);
        ServOrder.SetSkipUpdateDocRefPoint(TRUE);
        ServOrder.MODIFY(TRUE);
        DateReg := VARIANT2DATE(DateTimeReg);
        TimeReg := VARIANT2TIME(DateTimeReg);
        ProgPhase.CheckProgressScheme(
          ProgPhase.Type::ServOrder, ServOrder."Progress Scheme",
          ServOrder."No.", ServOrder.Status, DateReg, TimeReg);
        ServOrder.SetSkipUpdateDocRefPoint(FALSE);
      END;
      ServOrder.UpdateServiceOrderFinished;
      ServOrder.UpdateNextDeadline;
      ServOrder.MODIFY(FALSE);
    END;

    PROCEDURE CompareFieldServiceStatusr1And2@1100527007(FSStatus1@1100527000 : Text[30];FSStatus2@1100527001 : Text[30];CompareMode@1100525000 : Text[2]) : Boolean;
    BEGIN
      IF STRLEN(FSStatus1) <> STRLEN(FSStatus2) THEN BEGIN
        IF STRLEN(FSStatus1) < STRLEN(FSStatus2) THEN
          FSStatus1 := COPYSTR('0000000000',1, STRLEN(FSStatus2) - STRLEN(FSStatus1)) + FSStatus1
        ELSE
          FSStatus2 := COPYSTR('0000000000',1, STRLEN(FSStatus1) - STRLEN(FSStatus2)) + FSStatus2;
      END;
      CASE CompareMode OF
        '>':
          EXIT(FSStatus1 > FSStatus2);
        '<':
          EXIT(FSStatus1 < FSStatus2);
        '>=':
          EXIT(FSStatus1 >= FSStatus2);
        '<=':
           EXIT(FSStatus1 <= FSStatus2);
        '=':
          EXIT(FSStatus1 = FSStatus2);
      END;

      EXIT(FALSE);
    END;

    PROCEDURE UpdateDeletedWorkOrderCache@1100529002(xWorkOrder@1100528700 : Record 11229279;UpdateMode@1100529001 : Code[1]);
    VAR
      DeletedWorkOrderCache@1100529002 : Record 11229281;
    BEGIN
      IF xWorkOrder."Resource No." = '' THEN
        EXIT;
      xWorkOrder.CALCFIELDS("Active in FSA");
      IF (NOT xWorkOrder."Active in FSA") THEN
        EXIT;

      IF (UpdateMode = 'D')  OR
         ((UpdateMode = 'M') AND ("Resource No." <> xWorkOrder."Resource No.")) OR
         ((UpdateMode = 'M') AND IsWorkOrderReplannedSameResource(xWorkOrder))
      THEN BEGIN
        DeletedWorkOrderCache."Resource No." := xWorkOrder."Resource No.";
        DeletedWorkOrderCache."Work Order No." := "No.";
        IF DeletedWorkOrderCache.INSERT THEN;
        // When the order is deleted, or the resource (employee) is removed from the order,
        // then the order may still exist in Mobile for the resource (empl). The DeletedWorkOrderCache
        // is used to delete these orders.

      END;

      IF (UpdateMode = 'M') AND ("Resource No." <> '') AND NOT IsWorkOrderReplannedSameResource(xWorkOrder) THEN BEGIN
        CALCFIELDS("Active in FSA");
        IF ("Resource Type" = "Resource Type"::Employee) AND ("Active in FSA") AND ("Export to FSA") THEN BEGIN
          //delete cache when current resoruce was deleted form this order before, but cache still exists when exporting to FSA again to same resource (tablet)
          IF DeletedWorkOrderCache.GET("Resource No.","No.") THEN BEGIN
            DeletedWorkOrderCache.DELETE(TRUE);
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE IsWorkOrderReplannedSameResource@1100528634(xWorkOrder@1100528601 : Record 11229279) : Boolean;
    VAR
      WorkOrderPlanningSetup@1100528600 : Record 11229277;
    BEGIN
      WorkOrderPlanningSetup.GET;
      IF NOT WorkOrderPlanningSetup."Reinit Ref. Point after Replan" THEN
        EXIT(FALSE);
      IF (xWorkOrder."Starting Date/Time" <> "Starting Date/Time") OR (xWorkOrder."Ending Date/Time" <> "Ending Date/Time") THEN
        EXIT(TRUE);
    END;

    PROCEDURE UpdateServiceOrder@1100527001(UpdateMode@1100527002 : Code[1]);
    VAR
      WorkOrder@1100527000 : Record 11229279;
      ServOrder@1100527001 : Record 11012823;
      ResourceWOP@1100409001 : Record 11229278;
      LimitBudgetManagement@1100528601 : Codeunit 11012878;
      StartDateTime@1100527003 : DateTime;
      EndDateTime@1100527004 : DateTime;
      DurationTime@1100528608 : Decimal;
      NewStartDate@1100527005 : Date;
      NewEndDate@1100527006 : Date;
      NewStartTime@1100527007 : Time;
      NewEndTime@1100527008 : Time;
      NewDurationTime@1100528607 : Decimal;
      CommonResourceNo@1100409000 : Code[20];
      LeadingResourceNo@1100528600 : Code[20];
      FirmPlanned@1100528611 : Boolean;
      DifferentResourceNo@1100409002 : Boolean;
      DifferentDurationTime@1100528609 : Boolean;
      DifferentFirmPlanned@1100528610 : Boolean;
      LimitBudgetExceeded@1100528606 : Boolean;
      LimitBudgetHoursExceedance@1100528602 : Decimal;
      LimitBudgetLaborExceedance@1100528603 : Decimal;
      LimitBudgetMaterialExceedance@1100528604 : Decimal;
      LimitBudgetTotalExceedance@1100528605 : Decimal;
      CUFunc@1101285000 : Codeunit 11128007;
    BEGIN
      IF ("No." = '') OR ("Source Type" <> "Source Type"::ServiceOrder) OR ("Source No." = '') OR ("Source Company" = '') THEN
        EXIT;
      TESTFIELD("Source Company", COMPANYNAME);

      StartDateTime := 0DT;
      EndDateTime := 0DT;
      IF (UpdateMode <> 'D') THEN BEGIN
        StartDateTime := "Starting Date/Time";
        EndDateTime := "Ending Date/Time";
        CommonResourceNo := "Resource No.";
        DurationTime := "Duration Time";
        FirmPlanned := "Firm Planned";
        IF "Leading Resource" THEN
          LeadingResourceNo := "Resource No.";
      END;

      //Read related work orders
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      IF WorkOrder.FINDSET THEN BEGIN
        REPEAT
          IF (WorkOrder."Starting Date/Time" <> 0DT) AND ((StartDateTime = 0DT) OR (WorkOrder."Starting Date/Time" < StartDateTime)) THEN
            StartDateTime := WorkOrder."Starting Date/Time";
          IF (WorkOrder."Ending Date/Time" <> 0DT) AND (WorkOrder."Ending Date/Time" > EndDateTime) THEN
            EndDateTime := WorkOrder."Ending Date/Time";
          IF CommonResourceNo = '' THEN
            CommonResourceNo := WorkOrder."Resource No.";
          IF (WorkOrder."Resource No." <> '') AND (CommonResourceNo <> WorkOrder."Resource No.") THEN
            DifferentResourceNo := TRUE;
          IF WorkOrder."Leading Resource" THEN
            LeadingResourceNo := WorkOrder."Resource No.";
          IF (WorkOrder."Duration Time" > 0) AND (DurationTime = 0) THEN
            DurationTime := WorkOrder."Duration Time";
          IF (WorkOrder."Duration Time" > 0) AND (DurationTime <> WorkOrder."Duration Time") THEN
            DifferentDurationTime := TRUE;
          IF FirmPlanned <> WorkOrder."Firm Planned" THEN
            DifferentFirmPlanned := TRUE;
        UNTIL WorkOrder.NEXT = 0;
      END;
      IF DifferentResourceNo THEN
        CommonResourceNo := LeadingResourceNo;
      IF DifferentDurationTime THEN
        DurationTime := 0;

      NewStartDate := VARIANT2DATE(StartDateTime);
      NewStartTime := VARIANT2TIME(StartDateTime);
      NewEndDate := VARIANT2DATE(EndDateTime);
      NewEndTime := VARIANT2TIME(EndDateTime);
      NewDurationTime := DurationTime;

      IF NewStartTime = 000000T THEN
        CLEAR(NewStartTime);

      ServOrder.CHANGECOMPANY("Source Company");
      IF ServOrder.GET("Source No.") THEN BEGIN
        IF ServOrder.Status = ServOrder.Status::Finished THEN
          IF (UpdateMode = 'I') OR (UpdateMode = 'M') THEN
            ERROR(Text018, ServOrder.TABLECAPTION, ServOrder."No.", "Source Company", ServOrder.Status)
          ELSE
            EXIT;
        IF UpdateMode <> 'D' THEN
          IF ServOrder.Status >= ServOrder.Status::"Administrative Finished" THEN
            ERROR(Text018, ServOrder.TABLECAPTION, ServOrder."No.", "Source Company", ServOrder.Status);
        IF (ServOrder."Starting Date" <> NewStartDate) OR (ServOrder."Starting Time" <> NewStartTime) OR
           (ServOrder."Ending Date" <> NewEndDate) OR (ServOrder."Ending Time" <> NewEndTime) OR DifferentResourceNo OR
           (CommonResourceNo <> '') OR (NewDurationTime <> 0) OR NOT DifferentFirmPlanned
        THEN BEGIN
          ServOrder."Starting Date" := NewStartDate;
          ServOrder."Starting Time" := NewStartTime;
          IF CheckReferencePoint(FALSE) OR ((NOT CheckReferencePoint(FALSE)) AND (NOT CheckNumberOfWorkOrders)) THEN BEGIN
            ServOrder."Ending Date" := NewEndDate;
            ServOrder."Ending Time" := NewEndTime;
          END;
          ServOrder.CheckPlanPeriod;

          IF NewDurationTime <> 0 THEN
            ServOrder."Duration Time" := NewDurationTime;
          IF CommonResourceNo <> '' THEN BEGIN
            ResourceWOP.GET(CommonResourceNo);
            CASE ResourceWOP.Type OF
              ResourceWOP.Type::Employee:
                ServOrder."Employee No." := CommonResourceNo;
              ResourceWOP.Type::Subcontractor:
                ServOrder.Subcontractor := CommonResourceNo;
            END;
          END ELSE BEGIN
            ServOrder."Employee No." := '';
            ServOrder.Subcontractor := '';
          END;
          IF NOT DifferentFirmPlanned AND (FirmPlanned <> ServOrder."Firm Planned") THEN
            ServOrder."Firm Planned" := FirmPlanned;
          //<< ITERO.SB 160105
          IF ServOrder."Employee No." <> '' THEN BEGIN
            CUFunc.SOEmployee(ServOrder,ServOrder."Employee No.");
          END;
          //>> ITERO.SB 160105

          IF UpdateMode <> 'D' THEN
            ServOrder.MODIFY
          ELSE BEGIN
            ServOrder.SetSkipStatusCheck(WorkOrder.ISEMPTY);
            ServOrder.MODIFY(NOT SkipOnModifyServiceOrders);
          END;
        END;
        LimitBudgetExceeded := LimitBudgetManagement.IsServiceOrderLimitBudgetExceeded(
          ServOrder, FALSE, LimitBudgetHoursExceedance, LimitBudgetLaborExceedance, LimitBudgetMaterialExceedance, LimitBudgetTotalExceedance);
        IF LimitBudgetExceeded <> ServOrder."Limit Budget Exceedance" THEN BEGIN
          ServOrder.VALIDATE("Limit Budget Exceedance", LimitBudgetExceeded);
          ServOrder.MODIFY(UpdateMode = 'D');
        END;
      END;
    END;

    PROCEDURE GetURLForCardOfSource@1100525010() : Text;
    VAR
      ServiceOrder@1100525001 : Record 11012823;
      Job@1100525002 : Record 11072003;
      PageNo@1100525000 : Integer;
    BEGIN
      CASE "Source Type" OF
        "Source Type"::ServiceOrder:
        BEGIN
          ServiceOrder.CHANGECOMPANY("Source Company");
          IF ServiceOrder.GET("Source No.") THEN
            PageNo := ServiceOrder.GetServiceOrderCard();
          EXIT(STRSUBSTNO('%1&mode=edit',GETURL(CLIENTTYPE::Windows, "Source Company",OBJECTTYPE::Page, PageNo, ServiceOrder)));
        END;
        "Source Type"::Project:
        BEGIN
          Job.CHANGECOMPANY("Source Company");
          IF Job.GET("Source No.") THEN
            PageNo := PAGE::"Job Card";
          EXIT(STRSUBSTNO('%1&mode=edit',GETURL(CLIENTTYPE::Windows, "Source Company",OBJECTTYPE::Page, PageNo, Job)));
        END;
        ELSE
          ERROR('GetURLForServiceOrder does not support Source Type %1', "Source Type");
      END;
    END;

    PROCEDURE UpdateAdviceOrder@1100528617();
    VAR
      ServiceSetup@1100528600 : Record 11012800;
      AdviceOrderLine@1100528601 : Record 11012055;
      Resource@1100528602 : Record 11229278;
      ServiceContract@1100528605 : Record 11012812;
      ServiceOrder@1100528606 : Record 11012823;
      OldSubcontractor@1100528603 : Code[20];
      NewSubcontractor@1100528604 : Code[20];
      CreateAdvPurchOrderSubc@1100528607 : Boolean;
    BEGIN
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT;
      IF NOT Resource.GET("Resource No.") THEN
        EXIT;
      IF Resource.Type <> Resource.Type::Subcontractor THEN
        EXIT;
      IF Resource.Company <> COMPANYNAME THEN
        EXIT;
      IF Resource."Source No." = '' THEN
        EXIT;
      ServiceSetup.GET;
      IF ServiceOrder.GET("Source No.") THEN BEGIN
        ServiceOrder.CALCFIELDS("Price Book Code");
        IF (ServiceOrder."Price Book Code" <> '') AND ServiceSetup."Advice Orders by Unit Price" THEN
          EXIT;
        CASE ServiceOrder."Source Type" OF
          ServiceOrder."Source Type"::Call:
            CreateAdvPurchOrderSubc := ServiceSetup."Create Adv./Purch. Subc. Call";
          ServiceOrder."Source Type"::Contract:
            CreateAdvPurchOrderSubc := ServiceSetup."Create Adv./Purch. Subc. Con.";
          ServiceOrder."Source Type"::Direct:
            CreateAdvPurchOrderSubc := ServiceSetup."Create Adv./Purch. Subc. Dir.";
        END;
        IF ServiceContract.GET(ServiceOrder."Service Contract No.") THEN
          CASE ServiceOrder."Source Type" OF
            ServiceOrder."Source Type"::Call:
              CASE ServiceContract."Create Adv./Purch. Subc. Call" OF
                ServiceContract."Create Adv./Purch. Subc. Call"::Yes:
                  CreateAdvPurchOrderSubc := TRUE;
                ServiceContract."Create Adv./Purch. Subc. Call"::No:
                  CreateAdvPurchOrderSubc := FALSE;
              END;
            ServiceOrder."Source Type"::Contract:
              CASE ServiceContract."Create Adv./Purch. Subc. Con." OF
                ServiceContract."Create Adv./Purch. Subc. Con."::Yes:
                  CreateAdvPurchOrderSubc := TRUE;
                ServiceContract."Create Adv./Purch. Subc. Con."::No:
                  CreateAdvPurchOrderSubc := FALSE;
              END;
            ServiceOrder."Source Type"::Direct:
              CASE ServiceContract."Create Adv./Purch. Subc. Dir." OF
                ServiceContract."Create Adv./Purch. Subc. Dir."::Yes:
                  CreateAdvPurchOrderSubc := TRUE;
                ServiceContract."Create Adv./Purch. Subc. Dir."::No:
                  CreateAdvPurchOrderSubc := FALSE;
              END;
          END;
      END;
      IF NOT CreateAdvPurchOrderSubc THEN
        EXIT;

      ServiceSetup.TESTFIELD("Cost Object Subcontracting");
      NewSubcontractor := Resource."Source No.";

      AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
      AdviceOrderLine.SETRANGE("Service Order No.", "Source No.");
      AdviceOrderLine.SETRANGE("Work Order No.", "No.");
      AdviceOrderLine.SETRANGE("Cost Object", ServiceSetup."Cost Object Subcontracting");
      IF NOT AdviceOrderLine.ISEMPTY THEN
        IF Resource.GET(xRec."Resource No.") THEN
          IF Resource.Type = Resource.Type::Subcontractor THEN
            OldSubcontractor := Resource."Source No.";

      IF CurrFieldNo = FIELDNO("Resource No.") THEN
        IF (OldSubcontractor <> '') AND (OldSubcontractor <> NewSubcontractor) THEN BEGIN
          AdviceOrderLine.SETRANGE(Processed, FALSE);
          AdviceOrderLine.MODIFYALL(Vendor, NewSubcontractor, TRUE);
        END;

      IF OldSubcontractor = '' THEN BEGIN
        AdviceOrderLine.RESET;
        AdviceOrderLine.INIT;
        AdviceOrderLine.VALIDATE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
        AdviceOrderLine.VALIDATE("Service Order No.", "Source No.");
        AdviceOrderLine.VALIDATE("Line No.", 0);
        AdviceOrderLine.INSERT(TRUE);

        AdviceOrderLine.VALIDATE("Cost Type", AdviceOrderLine."Cost Type"::Subcontracting);
        AdviceOrderLine.VALIDATE("Cost Object", ServiceSetup."Cost Object Subcontracting");
        AdviceOrderLine.VALIDATE(Vendor, NewSubcontractor);
        AdviceOrderLine.VALIDATE("Quantity (Advice)", 1);
        AdviceOrderLine.VALIDATE(Description, Description);
        AdviceOrderLine."Work Order No." := "No.";
        AdviceOrderLine.EvaluateStartDate(AdviceOrderLine."Receipt Date");
        AdviceOrderLine.MODIFY(TRUE);
      END;
    END;

    PROCEDURE TestIfDeletionIsAllowed@1100528600();
    VAR
      MessageText@1100528600 : Text;
    BEGIN
      IF NOT CanBeRemoved(MessageText) THEN
        ERROR(MessageText);
    END;

    PROCEDURE IsModificationAllowed@1100528609() : Boolean;
    VAR
      ReferencePoint@1100528600 : Record 11020271;
    BEGIN
      ReferencePoint.CHANGECOMPANY("Source Company");
      IF NOT ReferencePoint.GET("Actual Reference Point") THEN
        ReferencePoint.INIT;
      EXIT(NOT ReferencePoint."Block Modify Service Order");
    END;

    PROCEDURE TestIfModificationIsAllowed@1100528608();
    BEGIN
      IF NOT IsModificationAllowed THEN
        ERROR(Text015, "No.");
    END;

    LOCAL PROCEDURE InsertWorkOrderRefPoint@1100409005();
    VAR
      WorkOrderRefPoint@1100409001 : Record 11229282;
      ProgressPhase@1100528500 : Record 11020251;
      ReferencePeriod@1100528501 : Record 11020272;
      DateTimeReg@1100409000 : DateTime;
    BEGIN
      IF gDateTimeRefPointRegistr <> 0DT THEN
        DateTimeReg := gDateTimeRefPointRegistr
      ELSE
        DateTimeReg := CURRENTDATETIME;

      WorkOrderRefPoint.INIT;
      WorkOrderRefPoint."Work Order No." := "No.";
      WorkOrderRefPoint."Date/Time Registrated" := DateTimeReg;
      WorkOrderRefPoint."Reference Point" := "Actual Reference Point";
      WorkOrderRefPoint."Field Service Status" := "Actual Field Service Status";
      WorkOrderRefPoint.INSERT(TRUE);

      ProgressPhase.CheckProgressWithoutScheme(ReferencePeriod.Type::WorkOrder,"No.",0,VARIANT2DATE(DateTimeReg),VARIANT2TIME(DateTimeReg),"Actual Reference Point");
    END;

    PROCEDURE TestExpectedDateTimes@1100528602();
    BEGIN
      IF ("First Possible Start.Date/Time" = 0DT) AND ("Last Possible Ending Date/Time" = 0DT) THEN
        EXIT;
      IF ("Expected Starting Date" = 0D) AND ("Expected Ending Date" = 0D) THEN
        EXIT;

      IF ("Expected Starting Date" <> 0D) AND
         (("Expected Starting Date" < DT2DATE("First Possible Start.Date/Time")) OR
          ("Expected Starting Date" > DT2DATE("Last Possible Ending Date/Time")))
      THEN
        ERROR(Text007, FIELDCAPTION("Expected Starting Date"),
          FIELDCAPTION("First Possible Start.Date/Time"), FIELDCAPTION("Last Possible Ending Date/Time"));

      IF ("Expected Ending Date" <> 0D) AND
         (("Expected Ending Date" < DT2DATE("First Possible Start.Date/Time")) OR
          ("Expected Ending Date" > DT2DATE("Last Possible Ending Date/Time")))
      THEN
        ERROR(Text007, FIELDCAPTION("Expected Ending Date"),
          FIELDCAPTION("First Possible Start.Date/Time"), FIELDCAPTION("Last Possible Ending Date/Time"));

      IF ("Expected Starting Date" <> 0D) AND
         ("Expected Starting Time" <> 0T) AND
         (DT2TIME("First Possible Start.Date/Time") <> 0T) AND
         ("Expected Starting Date" = DT2DATE("First Possible Start.Date/Time")) AND
         ("Expected Starting Time" < DT2TIME("First Possible Start.Date/Time"))
      THEN
        ERROR(Text008, FIELDCAPTION("Expected Starting Time"), FIELDCAPTION("First Possible Start.Date/Time"));

      IF ("Expected Ending Date" <> 0D) AND
         ("Expected Ending Time" <> 0T) AND
         (DT2TIME("Last Possible Ending Date/Time") <> 0T) AND
         ("Expected Ending Date" = DT2DATE("Last Possible Ending Date/Time")) AND
         ("Expected Ending Time" > DT2TIME("Last Possible Ending Date/Time"))
      THEN
        ERROR(Text009, FIELDCAPTION("Expected Ending Time"), FIELDCAPTION("Last Possible Ending Date/Time"));
    END;

    LOCAL PROCEDURE GetReferencePointFilterBySOStatus@1100409001(IServiceOrderStatus@1100409000 : 'Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled';ICompareSigns@1100409001 : Text;IConcatChar@1100528600 : Text) ReferencePointFilter : Text;
    VAR
      ReferencePoint@1100409002 : Record 11020271;
    BEGIN
      ReferencePoint.SETFILTER(Apply, '%1|%2', ReferencePoint.Apply::Common, ReferencePoint.Apply::ServOrder);
      ReferencePoint.SETRANGE("Triggered by Status ServOrder", IServiceOrderStatus);
      IF ReferencePoint.FINDSET THEN
        REPEAT
          IF ReferencePointFilter <> '' THEN
            ReferencePointFilter := ReferencePointFilter + IConcatChar;
          ReferencePointFilter := ReferencePointFilter + ICompareSigns + FORMAT(ReferencePoint."No.");
        UNTIL ReferencePoint.NEXT = 0;
    END;

    PROCEDURE GetSignatureMandatory@1100409007() : Boolean;
    VAR
      ServiceOrder@1100528700 : Record 11012823;
      SignatureSetupMob@1100409000 : Record 11229866;
      JobsSetup@1100525000 : Record 315;
    BEGIN
      IF NOT JobsSetup.IsFSAActive THEN
        EXIT(FALSE);

      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT(FALSE);

      IF "Source No." = '' THEN
        EXIT(FALSE);

      ServiceOrder.CHANGECOMPANY("Source Company");
      ServiceOrder.GET("Source No.");

      SignatureSetupMob.CHANGECOMPANY("Source Company");
      SignatureSetupMob.SETRANGE("Source Type", ServiceOrder."Source Type");
      SignatureSetupMob.SETRANGE(Decentral, ServiceOrder."Decentral Created");
      IF SignatureSetupMob.FINDFIRST THEN
        EXIT(SignatureSetupMob."Signature Mandatory");
      EXIT(TRUE); // default
    END;

    PROCEDURE GetPublishOnSubcontrPort@1100528603();
    VAR
      SubcontPortSetup@1100528600 : Record 11126402;
      ReferencePoint@1100528601 : Record 11020271;
    BEGIN
      SubcontPortSetup.CHANGECOMPANY("Source Company");
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(SubcontPortSetup) THEN
        EXIT;
      IF (NOT SubcontPortSetup.GET('1')) THEN
        EXIT;
      IF SubcontPortSetup."Ref. Point Sending WO" <> 0 THEN BEGIN
        ReferencePoint.CHANGECOMPANY("Source Company");
        IF NOT ReferencePoint.GET(SubcontPortSetup."Ref. Point Sending WO") THEN
          ReferencePoint.INIT;
        "Actual Reference Point" := SubcontPortSetup."Ref. Point Sending WO";
        "Actual Field Service Status" := ReferencePoint."Triggered by Field Service";
      END;
    END;

    PROCEDURE GetPublishInControl@1100528305();
    VAR
      CTRLSetup@1100528600 : Record 11125686;
      ReferencePoint@1100528601 : Record 11020271;
    BEGIN
      CTRLSetup.CHANGECOMPANY("Source Company");
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(CTRLSetup) THEN
        EXIT;
      CTRLSetup.GET;
      IF (CTRLSetup."Reference Point WO sent" <> 0) THEN BEGIN
        ReferencePoint.CHANGECOMPANY("Source Company");
        IF (NOT ReferencePoint.GET(CTRLSetup."Reference Point WO sent")) THEN
          ReferencePoint.INIT;
        "Actual Reference Point" := CTRLSetup."Reference Point WO sent";
        "Actual Field Service Status" := ReferencePoint."Triggered by Field Service";
      END;
    END;

    PROCEDURE CollPublishOnSubcontrPortal@1100525044();
    VAR
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      IF ("Resource Type" = "Resource Type"::Subcontractor) AND ("Resource No." <> '') THEN
        WorkOrder.SETRANGE("Resource No.", "Resource No.");
      REPORT.RUNMODAL(REPORT::"Publish WO on Subcontr. Portal",TRUE, FALSE, WorkOrder);
    END;

    LOCAL PROCEDURE CreateSubcontrPurchaseOrder@1100528621();
    VAR
      Vendor@1100528604 : Record 23;
      AdviceOrderLine@1100528602 : Record 11012055;
      TmpAdviceOrderLine@1100528605 : TEMPORARY Record 11012055;
      PurchaseLine@1100528603 : Record 39;
      PurchaseHeader@1100528601 : Record 38;
      ResourceWOP@1100528607 : Record 11229278;
      JobsSetup@1100409000 : Record 315;
    BEGIN
      IF "Resource No." = '' THEN
        EXIT;
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT;
      IF "Source Company" <> COMPANYNAME THEN
        EXIT;
      IF gCollectivePublishSubcPortalRun AND gSkipCreatPurchOrder THEN
        EXIT;
      IF NOT ResourceWOP.GET("Resource No.") THEN
        EXIT;
      IF ResourceWOP.Company <> COMPANYNAME THEN
        EXIT;
      IF NOT Vendor.GET(ResourceWOP."Source No.") THEN
        EXIT;

      AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
      AdviceOrderLine.SETRANGE(Vendor, Vendor."No.");
      AdviceOrderLine.SETRANGE("Project No.", '');
      AdviceOrderLine.SETRANGE("Service Order No.", "Source No.");
      AdviceOrderLine.SETRANGE(Transaction, AdviceOrderLine.Transaction::Purchase);
      AdviceOrderLine.SETFILTER("Quantity (Advice)", '<>0');
      JobsSetup.GET;
      IF JobsSetup."Release Advice Order Mandatory" THEN
        AdviceOrderLine.SETRANGE("Process Status", AdviceOrderLine."Process Status"::Released)
      ELSE
        AdviceOrderLine.SETFILTER("Process Status", '<%1', AdviceOrderLine."Process Status"::Cancelled);
      IF AdviceOrderLine.FINDSET THEN BEGIN
        MODIFY(TRUE); //C026742.n
        IF Vendor."Direct Post Order ICM" THEN
          REPEAT
            TmpAdviceOrderLine := AdviceOrderLine;
            TmpAdviceOrderLine.INSERT;
          UNTIL AdviceOrderLine.NEXT = 0;
        COMMIT; // Next process has a runmodal
        IF gCollectivePublishSubcPortalRun THEN
          AdviceOrderManagement.SetCollectiveRun();  //AdviceOrderManagement must be a global!
        AdviceOrderManagement.ProcessPurchase(AdviceOrderLine, FALSE, FALSE);

        IF TmpAdviceOrderLine.FINDSET THEN BEGIN
          REPEAT
            AdviceOrderLine.GET(
              TmpAdviceOrderLine."Record Type", TmpAdviceOrderLine."Project No.",
              TmpAdviceOrderLine."Service Order No.", '', TmpAdviceOrderLine."Line No.");  //DP01378

            IF AdviceOrderLine."Purchase Route Reference" <> '' THEN BEGIN
              PurchaseLine.SETCURRENTKEY("Document Type", "Purchase Route Reference");
              PurchaseLine.SETRANGE("Document Type", PurchaseLine."Document Type"::Order);
              PurchaseLine.SETRANGE("Purchase Route Reference", AdviceOrderLine."Purchase Route Reference");
              IF PurchaseLine.FINDSET THEN
                REPEAT
                  IF PurchaseHeader.GET(PurchaseLine."Document Type", PurchaseLine."Document No.") THEN
                    PurchaseHeader.MARK(TRUE);
                UNTIL PurchaseLine.NEXT = 0;
            END;
          UNTIL TmpAdviceOrderLine.NEXT = 0;
          PurchaseHeader.MARKEDONLY(TRUE);
          PurchaseHeader.DirectPosting;
        END;
      END;
    END;

    PROCEDURE CanPublishOnSubcontrPortal@1100528604() : Boolean;
    VAR
      SubcontPortSetup@1100528600 : Record 11126402;
      ResourceWOP@1100528601 : Record 11229278;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(SubcontPortSetup) THEN
        EXIT(FALSE);
      IF NOT SubcontPortSetup.GET('1') THEN
        EXIT(FALSE);
      IF NOT SubcontPortSetup."Subcontracting Portal Active" THEN
        EXIT(FALSE);
      IF "Resource No." = '' THEN
        EXIT(FALSE);
      IF "Resource Type" <> "Resource Type"::Subcontractor THEN
        EXIT(FALSE);
      IF NOT ResourceWOP.GET("Resource No.") THEN
        EXIT(FALSE);
      IF ResourceWOP.Company <> COMPANYNAME THEN
        EXIT(FALSE);
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE InsertSubcontrPortLocation@1100528606();
    VAR
      SubcontrPortLocation@1100528601 : Record 11126403;
      ServiceOrder@1100528600 : Record 11012823;
      ResourceWOP@1100528602 : Record 11229278;
    BEGIN
      IF NOT AutomaticUpdateApplies THEN
        EXIT;
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT;
      IF "Source No." = '' THEN
        EXIT;
      IF "Source Company" <> COMPANYNAME THEN
        EXIT;
      IF NOT ResourceWOP.GET("Resource No.") THEN
        EXIT;
      IF ResourceWOP.Company <> COMPANYNAME THEN
        EXIT;
      ServiceOrder.GET("Source No.");
      IF SubcontrPortLocation.GET(ResourceWOP.GetVendorNo, '', ServiceOrder."Service Location No.") THEN
        EXIT;
      IF NOT ResourceWOP.GET("Resource No.") THEN
        ResourceWOP.INIT;
      SubcontrPortLocation."Vendor No." := ResourceWOP.GetVendorNo;
      SubcontrPortLocation.Login := '';
      SubcontrPortLocation."Service Location No." := ServiceOrder."Service Location No.";
      SubcontrPortLocation.INSERT(TRUE);
    END;

    LOCAL PROCEDURE DeleteSubcontrPortLocation@1100528605() : Boolean;
    VAR
      SubcontrPortLocation@1100528601 : Record 11126403;
      ServiceOrder@1100409000 : Record 11012823;
      ResourceWOP@1100528600 : Record 11229278;
      WorkOrder@1100528602 : Record 11229279;
      LocationFoundElseWhere@1100528603 : Boolean;
      ServiceLocationNo@1100528604 : Code[20];
    BEGIN
      IF NOT AutomaticUpdateApplies THEN
        EXIT;
      IF "Resource No." = '' THEN
        EXIT;
      IF "Source Company" <> COMPANYNAME THEN
        EXIT;
      IF NOT ResourceWOP.GET("Resource No.") THEN
        EXIT;
      IF ResourceWOP.Company <> COMPANYNAME THEN
        EXIT;
      ServiceOrder.GET("Source No.");
      ServiceLocationNo := ServiceOrder."Service Location No.";
      IF ServiceLocationNo = '' THEN
        EXIT;
      IF NOT SubcontrPortLocation.GET(ResourceWOP.GetVendorNo, '', ServiceLocationNo) THEN
        EXIT;
      WorkOrder.SETCURRENTKEY("Resource No.");
      WorkOrder.SETRANGE("Resource No.", "Resource No.");
      WorkOrder.SETRANGE("Publish on Subcontr. Portal", TRUE);
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      IF WorkOrder.FINDSET THEN
        REPEAT
          IF NOT ServiceOrder.GET(WorkOrder."Source No.") THEN
            ServiceOrder.INIT;
          IF ServiceOrder."Service Location No." = ServiceLocationNo THEN
            LocationFoundElseWhere := TRUE;
        UNTIL (WorkOrder.NEXT = 0) OR LocationFoundElseWhere;

      IF NOT LocationFoundElseWhere THEN BEGIN
        SubcontrPortLocation.SETRECFILTER;
        SubcontrPortLocation.SETRANGE(Login);
        SubcontrPortLocation.DELETE(FALSE);
      END;
    END;

    LOCAL PROCEDURE AutomaticUpdateApplies@1100528610() : Boolean;
    VAR
      SubcontPortSetup@1100528600 : Record 11126402;
      ServiceOrder@1100528601 : Record 11012823;
    BEGIN
      IF (NOT SubcontPortSetup.GET('1')) THEN
        EXIT(FALSE);
      IF NOT SubcontPortSetup."Automatically Update Locations" THEN
        EXIT(FALSE);
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT(FALSE);
      IF "Source Company" <> COMPANYNAME THEN
        EXIT(FALSE);
      IF NOT ServiceOrder.GET("Source No.") THEN
        EXIT(FALSE);
      IF ServiceOrder."Service Location No." = '' THEN
        EXIT(FALSE);
      EXIT(TRUE);
    END;

    [External]
    PROCEDURE CreateNextWorkOrder@1100409000() : Code[20];
    VAR
      WorkOrderPlanningSetup@1100409000 : Record 11229277;
      ReferencePoint@1100409002 : Record 11020271;
      ServiceOrder@1100528600 : Record 11012823;
      NextWorkOrderNo@1100409001 : Code[20];
      WorkOrder@1100527300 : Record 11229279;
    BEGIN
      ReferencePoint.SETRANGE("Triggered by Field Service", '65');
      ReferencePoint.SETRANGE(Apply, ReferencePoint.Apply::ServOrder);
      ReferencePoint.FINDFIRST;
      TESTFIELD("Actual Reference Point", ReferencePoint."No.");

      IF "Source Type" = "Source Type"::ServiceOrder THEN BEGIN
        ServiceOrder.CHANGECOMPANY("Source Company");
        ServiceOrder.GET("Source No.");
      END;
      CALCFIELDS("Active in FSA"); // C046479.n
      IF (NOT "Active in FSA") AND (ServiceOrder.Subcontractor = '') THEN
        TESTFIELD("WO Finished (Field Service)", TRUE);

      WorkOrderPlanningSetup.GET;
      WorkOrderPlanningSetup.TESTFIELD("Ref. Point Next Work Order");

      NextWorkOrderNo := DuplicateWorkorder(WorkOrderPlanningSetup."Copy Res. to Next Work Order");

      WorkOrder.GET(NextWorkOrderNo);
      WorkOrder.UpdateLinkToWOLeadingResource;
      WorkOrder.MODIFY;

      VALIDATE("Actual Reference Point", WorkOrderPlanningSetup."Ref. Point Next Work Order");
      MODIFY(TRUE);

      IF "Source Type" = "Source Type"::ServiceOrder THEN BEGIN
        ServiceOrder.CHANGECOMPANY("Source Company");
        IF ServiceOrder.GET("Source No.") THEN BEGIN
          ServiceOrder."SO Finished (Field Service)" := FALSE;
          ServiceOrder.MODIFY;
        END;
      END;

      EXIT(NextWorkOrderNo);
    END;

    [TryFunction]
    [External]
    PROCEDURE CreateNextWorkOrderGRP@1100529102();
    VAR
      ReferencePoint@1100529100 : Record 11020271;
      ServiceOrder@1100528500 : Record 11012823;
    BEGIN
      ReferencePoint.SETRANGE("Triggered by Field Service", '65');
      ReferencePoint.SETRANGE(Apply, ReferencePoint.Apply::ServOrder);
      ReferencePoint.FINDFIRST;
      TESTFIELD("Actual Reference Point", ReferencePoint."No.");

      IF "Source Type" = "Source Type"::ServiceOrder THEN BEGIN
        ServiceOrder.CHANGECOMPANY("Source Company");
        ServiceOrder.GET("Source No.");
      END;
      IF (NOT "Active in FSA") AND (ServiceOrder.Subcontractor = '') THEN
        TESTFIELD("WO Finished (Field Service)", TRUE);

      WorkOrderPlanningSetup.GET;
      WorkOrderPlanningSetup.TESTFIELD("Ref. Point Next Work Order");
    END;

    PROCEDURE SetCollectivePublishSubcPortalRun@1100409002(SkipCreatPurchOrder@1100409000 : Boolean);
    BEGIN
      gCollectivePublishSubcPortalRun := TRUE;
      gSkipCreatPurchOrder := SkipCreatPurchOrder;
    END;

    PROCEDURE FieldServiceStatusReasonDescription@1100525013() : Text;
    VAR
      WorkOrderReferencePoint@1100525000 : Record 11229282;
    BEGIN
      // DP00816
      WorkOrderReferencePoint.SETRANGE("Work Order No.", "No.");
      WorkOrderReferencePoint.SETRANGE("Field Service Status", "Actual Field Service Status");
      IF WorkOrderReferencePoint.FINDLAST THEN
        EXIT(WorkOrderReferencePoint."Fld Srv Status Reason Desc.");
    END;

    LOCAL PROCEDURE TestRecursiveness@1100525014();
    VAR
      WorkOrder@1100525001 : Record 11229279;
      RelatedWorkOrderNo@1100525000 : Code[20];
    BEGIN
      RelatedWorkOrderNo := "Related Work Order No.";
      WHILE RelatedWorkOrderNo <> '' DO BEGIN
        IF RelatedWorkOrderNo = "No." THEN
          ERROR(Text014);
        IF NOT WorkOrder.GET(RelatedWorkOrderNo) THEN
          EXIT;
        RelatedWorkOrderNo := WorkOrder."Related Work Order No.";
      END;
    END;

    LOCAL PROCEDURE DetermineLeadingResource@1100528607();
    VAR
      WorkOrder@1100528600 : Record 11229279;
      ResourceWOP@1100528601 : Record 11229278;
    BEGIN
      IF NOT ResourceWOP.GET("Resource No.") THEN
        ResourceWOP.INIT;
      IF ("Resource Type" <> "Resource Type"::Employee) OR ("Resource No." = '') OR ResourceWOP."Link WO to WO Leading Resource"THEN BEGIN
        "Leading Resource" := FALSE;
        EXIT;
      END;
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Employee);
      WorkOrder.SETRANGE("Link WO to WO Leading Resource", FALSE);
      IF WorkOrder.FINDSET THEN BEGIN
        IF (WorkOrder.NEXT = 0) AND (WorkOrder."No." = "No.") THEN
          VALIDATE("Leading Resource", "Resource No." <> '');
      END ELSE
        VALIDATE("Leading Resource", "Resource No." <> '');
    END;

    LOCAL PROCEDURE UpdateSOObjectSpecificationLines@1100528700();
    VAR
      ObjectSpecificationMgt@1100528701 : Codeunit 11012848;
      MobileSetup@1100528705 : Record 11012676;
      ServiceOrderObject@1100528702 : Record 11071724;
      ServiceOrderObjSpecLine@1100528704 : Record 11071782;
      WorkOrder@1100528703 : Record 11229279;
    BEGIN
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT;

      MobileSetup.GET;
      IF NOT MobileSetup."Refr. Insp. and Spec before Ex" THEN
        EXIT;

      ServiceOrderObjSpecLine.SETRANGE("Service Order No.", "Source No.");
      ServiceOrderObjSpecLine.SETFILTER("New Value", '<>%1', '');
      IF NOT ServiceOrderObjSpecLine.ISEMPTY THEN
        EXIT;

      ServiceOrderObjSpecLine.RESET;
      ServiceOrderObjSpecLine.SETRANGE("Service Order No.", "Source No.");
      ServiceOrderObjSpecLine.SETFILTER(Status, '<>%1', ServiceOrderObjSpecLine.Status::" ");
      IF NOT ServiceOrderObjSpecLine.ISEMPTY THEN
        EXIT;

      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETFILTER("Date/Time Export to FSA", '<>%1', 0DT);
      IF NOT WorkOrder.ISEMPTY THEN
        EXIT;

      ServiceOrderObject.SETRANGE("Service Order No.", "Source No.");
      IF ServiceOrderObject.FINDSET THEN
        REPEAT
          ObjectSpecificationMgt.DeleteSOSpecificationLines(ServiceOrderObject."Service Order No.", ServiceOrderObject."Object No.");
          ObjectSpecificationMgt.CreateSOSpecificationLines(ServiceOrderObject."Service Order No.", ServiceOrderObject."Object No.");
        UNTIL ServiceOrderObject.NEXT = 0;
    END;

    LOCAL PROCEDURE UpdateSOObjectInspectionLines@1100528701();
    VAR
      ServiceInspectionManagement@1100528705 : Codeunit 11012844;
      ServiceOrder@1100528000 : Record 11012823;
      MobileSetup@1100528703 : Record 11012676;
      ServiceOrderObject@1100528702 : Record 11071724;
      WorkOrder@1100528700 : Record 11229279;
    BEGIN
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT;

      ServiceOrder.GET("Source No.");
      IF ServiceOrder."Source Type" = ServiceOrder."Source Type"::Direct THEN
        EXIT;

      MobileSetup.GET;
      IF NOT MobileSetup."Refr. Insp. and Spec before Ex" THEN
        EXIT;

      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETFILTER("Date/Time Export to FSA", '<>%1', 0DT);
      IF NOT WorkOrder.ISEMPTY THEN
        EXIT;

      ServiceOrderObject.SETRANGE("Service Order No.", "Source No.");
      IF ServiceOrderObject.FINDSET THEN
        REPEAT
          ServiceInspectionManagement.DeleteSOInspectionLines(ServiceOrderObject."Service Order No.", ServiceOrderObject."Object No.",
            ServiceOrderObject."Maintenance Scheme");
          ServiceInspectionManagement.CreateSOInspectionLines(ServiceOrderObject."Service Order No.", ServiceOrderObject."Service Contract No.",
            ServiceOrderObject."Object No.", ServiceOrderObject."Maintenance Scheme", ServiceOrderObject.Code);
        UNTIL ServiceOrderObject.NEXT = 0;
    END;

    PROCEDURE CanBeRemoved@1100528611(VAR OMessageText@1100528619 : Text) : Boolean;
    VAR
      ReferencePoint@1100528618 : Record 11020271;
      DebriefLogbook4PSMobile@1100528600 : Record 11012677;
      DebriefWorkOrderMobile@1100528601 : Record 11012679;
      DebriefBudgetLineMobile@1100528602 : Record 11012680;
      DebriefCostPlusEntryMob@1100528603 : Record 11012681;
      DebriefAdviceOrderLineMob@1100528604 : Record 11012682;
      DebriefFSStatusMobile@1100528605 : Record 11012683;
      DebriefTextMobile@1100528606 : Record 11012684;
      DebriefHourAccountingMob@1100528607 : Record 11012685;
      DebriefInspectionLinesMob@1100528609 : Record 11020447;
      DebriefObjSpecLinesMob@1100528610 : Record 11020448;
      DebriefWorkOrderTextsMob@1100528611 : Record 11020449;
      DebriefMapsItem@1100528000 : Record 11072380;
      DebriefRelatedWorkOrder@1100528001 : Record 11072381;
      DebriefRestockItemMob@1100528612 : Record 11125645;
      DebriefPlanningMob@1100528613 : Record 11125646;
      DebriefCreatePurchOrdMob@1100528614 : Record 11125648;
      DebriefWUPProductionMob@1100528615 : Record 11125650;
      DebriefServOrdObjMob@1100528616 : Record 11125652;
      DebriefItemJournalLine@1100528002 : Record 11126699;
      DebriefPurchaseOrder@1100528003 : Record 11126701;
      DebriefPurchaseOrderLine@1100528004 : Record 11126702;
      DebriefPurchaseReceiptLine@1100528005 : Record 11126704;
      DebriefCondMeasLine@1100528006 : Record 11126705;
      DebriefPostGeneral@1100528007 : Record 11126706;
      DebriefCreateRestPOMob@1100528617 : Record 11229869;
      AdviceOrderLine@1100528621 : Record 11012055;
      PurchaseLineExtension@1100528622 : Record 11020644;
      SUPRecordingLine@1100528623 : Record 11071772;
      RecRef@1100528620 : RecordRef;
    BEGIN
      IF NOT SkipCheckOnBlockModifyDuringRemoval THEN
        IF "Actual Reference Point" <> 0 THEN
          IF ReferencePoint.GET("Actual Reference Point") THEN
            IF ReferencePoint."Block Modify Service Order" THEN BEGIN
              RecRef.GETTABLE(ReferencePoint);
              OMessageText := GetTestFieldErrorMessage(RecRef, ReferencePoint.FIELDNO("Block Modify Service Order"));
              EXIT(FALSE);
            END;

      IF NOT SkipCheckOnBlockModifyDuringRemoval THEN BEGIN
        DebriefLogbook4PSMobile.SETRANGE("Work Order No.", "No.");
        DebriefLogbook4PSMobile.SETFILTER("No. of Errors", '<>%1', 0);
        IF DebriefLogbook4PSMobile.FINDFIRST THEN BEGIN
          RecRef.GETTABLE(DebriefLogbook4PSMobile);
          OMessageText := GetTestFieldErrorMessage(RecRef, DebriefLogbook4PSMobile.FIELDNO("No. of Errors"));
          EXIT(FALSE);
        END;
      END;

      DebriefWorkOrderMobile.SETRANGE("Work Order No.", "No.");
      DebriefWorkOrderMobile.SETFILTER(Status, '<>%1', DebriefWorkOrderMobile.Status::Processed);
      IF DebriefWorkOrderMobile.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefWorkOrderMobile);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefWorkOrderMobile.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefBudgetLineMobile.SETRANGE("Work Order No.", "No.");
      DebriefBudgetLineMobile.SETFILTER(Status, '<>%1', DebriefBudgetLineMobile.Status::Processed);
      IF DebriefBudgetLineMobile.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefBudgetLineMobile);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefBudgetLineMobile.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefCostPlusEntryMob.SETRANGE("Work Order No.", "No.");
      DebriefCostPlusEntryMob.SETFILTER(Status, '<>%1', DebriefCostPlusEntryMob.Status::Processed);
      IF DebriefCostPlusEntryMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefCostPlusEntryMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefCostPlusEntryMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefAdviceOrderLineMob.SETRANGE("Work Order No.", "No.");
      DebriefAdviceOrderLineMob.SETFILTER(Status, '<>%1', DebriefAdviceOrderLineMob.Status::Processed);
      IF DebriefAdviceOrderLineMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefAdviceOrderLineMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefAdviceOrderLineMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefFSStatusMobile.SETRANGE("Work Order No.", "No.");
      DebriefFSStatusMobile.SETFILTER(Status, '<>%1', DebriefFSStatusMobile.Status::Processed);
      IF DebriefFSStatusMobile.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefFSStatusMobile);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefFSStatusMobile.FIELDNO(Status));
        EXIT(FALSE);
      END;

      IF NOT SkipCheckOnBlockModifyDuringRemoval THEN BEGIN
        DebriefTextMobile.SETRANGE("Work Order No.", "No.");
        DebriefTextMobile.SETFILTER(Status, '<>%1', DebriefTextMobile.Status::Processed);
        IF DebriefTextMobile.FINDFIRST THEN BEGIN
          RecRef.GETTABLE(DebriefTextMobile);
          OMessageText := GetTestFieldErrorMessage(RecRef, DebriefTextMobile.FIELDNO(Status));
          EXIT(FALSE);
        END;
      END;

      DebriefHourAccountingMob.SETRANGE("Work Order No.", "No.");
      DebriefHourAccountingMob.SETFILTER(Status, '<>%1', DebriefHourAccountingMob.Status::Processed);
      IF DebriefHourAccountingMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefHourAccountingMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefHourAccountingMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefInspectionLinesMob.SETRANGE("Work Order No.", "No.");
      DebriefInspectionLinesMob.SETFILTER(Status, '<>%1', DebriefInspectionLinesMob.Status::Processed);
      IF DebriefInspectionLinesMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefInspectionLinesMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefInspectionLinesMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefObjSpecLinesMob.SETRANGE("Work Order No.", "No.");
      DebriefObjSpecLinesMob.SETFILTER(Status, '<>%1', DebriefObjSpecLinesMob.Status::Processed);
      IF DebriefObjSpecLinesMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefObjSpecLinesMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefObjSpecLinesMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefWorkOrderTextsMob.SETRANGE("Work Order No.", "No.");
      DebriefWorkOrderTextsMob.SETFILTER(Status, '<>%1', DebriefWorkOrderTextsMob.Status::Processed);
      IF DebriefWorkOrderTextsMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefWorkOrderTextsMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefWorkOrderTextsMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefMapsItem.SETRANGE("Work Order No.", "No.");
      DebriefMapsItem.SETFILTER(Status, '<>%1', DebriefMapsItem.Status::Processed);
      IF DebriefMapsItem.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefMapsItem);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefMapsItem.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefRelatedWorkOrder.SETRANGE("Work Order No.", "No.");
      DebriefRelatedWorkOrder.SETFILTER(Status, '<>%1', DebriefRelatedWorkOrder.Status::Processed);
      IF DebriefRelatedWorkOrder.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefRelatedWorkOrder);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefRelatedWorkOrder.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefRestockItemMob.SETRANGE("Work Order No.", "No.");
      DebriefRestockItemMob.SETFILTER(Status, '<>%1', DebriefRestockItemMob.Status::Processed);
      IF DebriefRestockItemMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefRestockItemMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefRestockItemMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefPlanningMob.SETRANGE("Work Order No.", "No.");
      DebriefPlanningMob.SETFILTER(Status, '<>%1', DebriefPlanningMob.Status::Processed);
      IF DebriefPlanningMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefPlanningMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefPlanningMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefCreatePurchOrdMob.SETRANGE("Work Order No.", "No.");
      DebriefCreatePurchOrdMob.SETFILTER(Status, '<>%1', DebriefCreatePurchOrdMob.Status::Processed);
      IF DebriefCreatePurchOrdMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefCreatePurchOrdMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefCreatePurchOrdMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefWUPProductionMob.SETRANGE("Work Order No.", "No.");
      DebriefWUPProductionMob.SETFILTER(Status, '<>%1', DebriefWUPProductionMob.Status::Processed);
      IF DebriefWUPProductionMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefWUPProductionMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefWUPProductionMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefServOrdObjMob.SETRANGE("Work Order No.", "No.");
      DebriefServOrdObjMob.SETFILTER(Status, '<>%1', DebriefServOrdObjMob.Status::Processed);
      IF DebriefServOrdObjMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefServOrdObjMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefServOrdObjMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefItemJournalLine.SETRANGE("Work Order No.", "No.");
      DebriefItemJournalLine.SETFILTER(Status, '<>%1', DebriefItemJournalLine.Status::Processed);
      IF DebriefItemJournalLine.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefItemJournalLine);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefItemJournalLine.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefPurchaseOrder.SETRANGE("Work Order No.", "No.");
      DebriefPurchaseOrder.SETFILTER(Status, '<>%1', DebriefPurchaseOrder.Status::Processed);
      IF DebriefPurchaseOrder.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefPurchaseOrder);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefPurchaseOrder.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefPurchaseOrderLine.SETRANGE("Work Order No.", "No.");
      DebriefPurchaseOrderLine.SETFILTER(Status, '<>%1', DebriefPurchaseOrderLine.Status::Processed);
      IF DebriefPurchaseOrderLine.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefPurchaseOrderLine);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefPurchaseOrderLine.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefPurchaseReceiptLine.SETRANGE("Work Order No.", "No.");
      DebriefPurchaseReceiptLine.SETFILTER(Status, '<>%1', DebriefPurchaseReceiptLine.Status::Processed);
      IF DebriefPurchaseReceiptLine.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefPurchaseReceiptLine);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefPurchaseReceiptLine.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefCondMeasLine.SETRANGE("Work Order No.", "No.");
      DebriefCondMeasLine.SETFILTER(Status, '<>%1', DebriefCondMeasLine.Status::Processed);
      IF DebriefCondMeasLine.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefCondMeasLine);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefCondMeasLine.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefPostGeneral.SETRANGE("Work Order No.", "No.");
      DebriefPostGeneral.SETFILTER(Status, '<>%1', DebriefPostGeneral.Status::Processed);
      IF DebriefPostGeneral.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefPostGeneral);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefPostGeneral.FIELDNO(Status));
        EXIT(FALSE);
      END;

      DebriefCreateRestPOMob.SETRANGE("Work Order No.", "No.");
      DebriefCreateRestPOMob.SETFILTER(Status, '<>%1', DebriefCreateRestPOMob.Status::Processed);
      IF DebriefCreateRestPOMob.FINDFIRST THEN BEGIN
        RecRef.GETTABLE(DebriefCreateRestPOMob);
        OMessageText := GetTestFieldErrorMessage(RecRef, DebriefCreateRestPOMob.FIELDNO(Status));
        EXIT(FALSE);
      END;

      IF NOT SkipCheckOnBlockModifyDuringRemoval THEN
        CASE "Source Type" OF
          "Source Type"::ServiceOrder:
            BEGIN
              AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
              AdviceOrderLine.SETRANGE("Service Order No.", "Source No.");
              AdviceOrderLine.SETRANGE("Work Order No.", "No.");
              IF NOT AdviceOrderLine.ISEMPTY THEN BEGIN
                OMessageText := STRSUBSTNO(Text005, TABLECAPTION, AdviceOrderLine.TABLECAPTION);
                EXIT(FALSE);
              END;

              PurchaseLineExtension.SETRANGE("Work Order No.", "No.");
              IF NOT PurchaseLineExtension.ISEMPTY THEN BEGIN
                OMessageText := STRSUBSTNO(Text005, TABLECAPTION, PurchaseLineExtension.TABLECAPTION);
                EXIT(FALSE);
              END;

              SUPRecordingLine.SETRANGE("Service Order No.", "Source No.");
              SUPRecordingLine.SETRANGE("Work Order No.", "No.");
              IF NOT SUPRecordingLine.ISEMPTY THEN BEGIN
                OMessageText := STRSUBSTNO(Text005, TABLECAPTION, SUPRecordingLine.TABLECAPTION);
                EXIT(FALSE);
              END;
            END;
          "Source Type"::Project:
            BEGIN
              AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::Project);
              AdviceOrderLine.SETRANGE("Service Order No.", "Source No.");
              AdviceOrderLine.SETRANGE("Work Order No.", "No.");
              IF NOT AdviceOrderLine.ISEMPTY THEN
                OMessageText := STRSUBSTNO(Text005, TABLECAPTION, AdviceOrderLine.TABLECAPTION);

              PurchaseLineExtension.SETRANGE("Work Order No.", "No.");
              IF NOT PurchaseLineExtension.ISEMPTY THEN
                OMessageText := STRSUBSTNO(Text005, TABLECAPTION, PurchaseLineExtension.TABLECAPTION);
            END;
        END;

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetTestFieldErrorMessage@1100528612(IRecRef@1100528600 : RecordRef;IFieldNo@1100528605 : Integer) MessageText : Text;
    VAR
      KeyRef@1100528601 : KeyRef;
      FieldRef@1100528604 : FieldRef;
      i@1100528602 : Integer;
    BEGIN
      FieldRef := IRecRef.FIELD(IFieldNo);
      MessageText := STRSUBSTNO(Text016, FieldRef.CAPTION, FieldRef.VALUE, IRecRef.CAPTION);
      KeyRef := IRecRef.KEYINDEX(1);
      FOR i := 1 TO KeyRef.FIELDCOUNT DO BEGIN
        FieldRef := KeyRef.FIELDINDEX(i);
        IF i > 1 THEN
          MessageText := MessageText + ', ';
        MessageText := MessageText + STRSUBSTNO('%1=''%2''', FieldRef.CAPTION, FieldRef.VALUE);
      END;
    END;

    PROCEDURE SetCompanyPlanGroupFilters@1100528613();
    VAR
      CompanyPlanGroup@1100528604 : Record 11229300;
      CompanyPlanGroupLine@1100528601 : Record 11229301;
      CurrentCompanyPlanGroup@1100528600 : Code[10];
      CompanyFilter@1100528602 : Text;
    BEGIN
      CurrentCompanyPlanGroup := CompanyPlanGroup.GetCurrentCompanyPlanGroupCode;
      CompanyPlanGroupLine.SETRANGE("Group Code", CurrentCompanyPlanGroup);
      IF CompanyPlanGroupLine.ISEMPTY THEN
        EXIT;
      IF CompanyPlanGroupLine.FINDSET THEN
        REPEAT
          IF CompanyFilter <> '' THEN
            CompanyFilter += '|';
          CompanyFilter += '''' + CompanyPlanGroupLine."Company Name" + '''';
        UNTIL CompanyPlanGroupLine.NEXT = 0;
      FILTERGROUP(7);
      SETFILTER("Source Company", CompanyFilter);
      FILTERGROUP(0);
    END;

    PROCEDURE IsWorkOrderWithinCompanyPlanGroup@1100528615() : Boolean;
    VAR
      CompanyPlanGroup@1100528600 : Record 11229300;
      CompanyPlanGroupLine@1100528602 : Record 11229301;
      CompanyPlanGroupCode@1100528603 : Code[20];
    BEGIN
      CompanyPlanGroupCode := CompanyPlanGroup.GetCurrentCompanyPlanGroupCode;
      IF CompanyPlanGroupCode = '' THEN
        EXIT(TRUE);
      CompanyPlanGroupLine.SETRANGE("Group Code", CompanyPlanGroupCode);
      IF CompanyPlanGroupLine.ISEMPTY THEN
        EXIT(TRUE);
      CompanyPlanGroupLine.SETRANGE("Company Name", "Source Company");
      EXIT(NOT CompanyPlanGroupLine.ISEMPTY);
    END;

    PROCEDURE TestWorkOrderWithinCompanyPlanGroup@1100528614();
    VAR
      CompanyPlanGroup@1100528600 : Record 11229300;
    BEGIN
      IF NOT IsWorkOrderWithinCompanyPlanGroup THEN
        ERROR(Text017, "No.", CompanyPlanGroup.GetCurrentCompanyPlanGroupCode);
    END;

    LOCAL PROCEDURE SetFilterOnDimension2ValueInSourceCompany@1100528407(VAR DimensionValue@1100528400 : Record 349);
    BEGIN
      TESTFIELD("Source Company");
      DimensionValue.CHANGECOMPANY("Source Company");
      DimensionValue.SETRANGE("Global Dimension No.", 2);
      DimensionValue.SETFILTER(
        "Cost Type", '%1|%2|%3', DimensionValue."Cost Type"::Labor,
        DimensionValue."Cost Type"::Plant, DimensionValue."Cost Type"::Sundry);
      DimensionValue.SETRANGE(Code, "Global Dimension 2 Code");
    END;

    PROCEDURE ShowSourceCard@1100528616();
    VAR
      Job@1100528601 : Record 11072003;
      ServiceOrder@1100528600 : Record 11012823;
      ResourceRequest@1100529000 : Record 11124901;
    BEGIN
      TESTFIELD("Source Company", COMPANYNAME);
      CASE "Source Type" OF
        "Source Type"::Project:
          BEGIN
            Job.GET("Source No.");
            PAGE.RUN(PAGE::"Job Card", Job);
          END;
        "Source Type"::ServiceOrder:
          BEGIN
            ServiceOrder.GET("Source No.");
            ServiceOrder.ShowServiceOrderCard;
          END;
        "Source Type"::Request:
          BEGIN
            ResourceRequest.GET("Source No.");
            PAGE.RUN(PAGE::"Resource Request", ResourceRequest);
          END;
      END;
    END;

    PROCEDURE InsertProjectElementResource@1100528300();
    VAR
      ProjectElementResource@1100528301 : Record 11229886;
      ProjectElementManagement@1100528300 : Codeunit 11012285;
    BEGIN
      IF (NOT ProjectElementManagement.UseProjectElementPlanFunctionality) THEN
        EXIT;
      IF ("Source Type" <> "Source Type"::Project) OR ("Source No." = '') OR ("Project Element" = '') OR ("Resource No." = '') THEN
        EXIT;
      IF ("Source Company" <> COMPANYNAME) THEN
        ProjectElementResource.CHANGECOMPANY("Source Company");
      IF (ProjectElementResource.GET("Source No.", "Project Element", "Resource No.")) THEN
        EXIT;

      ProjectElementResource."Project No." := "Source No.";
      ProjectElementResource.Element := "Project Element";
      ProjectElementResource."Resource No." := "Resource No.";
      ProjectElementResource.INSERT(TRUE);
    END;

    LOCAL PROCEDURE ValidateExportToFSA@1100528100();
    VAR
      Resource@1100528103 : Record 11229278;
      ServiceOrder@1100528102 : Record 11012823;
      Job@1100528101 : Record 11072003;
      MandatoryFields@1100528100 : Record 11125651;
      FieldServiceAppSetup@1100528500 : Record 11126700;
      ValidationMode@1100528104 : ',WebService,UserInput';
    BEGIN
      // Do not use .MODIFY .INSERT or .DELETE in this function otherwise ExportFromGRPtoFSA will fail!
      IF GUIALLOWED THEN
        ValidationMode := ValidationMode::UserInput
      ELSE
        ValidationMode := ValidationMode::WebService;

      IF "Export to FSA" THEN BEGIN
        TESTFIELD("Resource Type", "Resource Type"::Employee);
        TESTFIELD("Resource No.");
        Resource.GET("Resource No.");
        Resource.TESTFIELD("Active in FSA", TRUE);

        IF ("Schedule Relation" = "Schedule Relation"::"Start-Start") AND
            ("Related Work Order No." <> '') THEN
        BEGIN
          FieldServiceAppSetup.GET;
          IF FieldServiceAppSetup."No Export to FSA if WO related" THEN
            IF GUIALLOWED AND (CurrFieldNo = FIELDNO("Export to FSA")) THEN
              FieldServiceAppSetup.TESTFIELD("No Export to FSA if WO related",FALSE)
            ELSE BEGIN
              "Export to FSA" := FALSE;
              EXIT;
            END;
        END;

        IF (("Source Type" <> "Source Type"::ServiceOrder) AND ("Source Type" <> "Source Type"::Project)) THEN
          IF Resource.IsFSAUser THEN
            ERROR(Text021, "Source Type"::ServiceOrder,"Source Type"::Project);
        Resource.CheckIfValidFSALicenseForResource(ValidationMode);
        CheckPlanDataFSA;
        CheckReferencePoint(TRUE);
        CASE "Source Type" OF
          "Source Type"::ServiceOrder : BEGIN
            ServiceOrder.CHANGECOMPANY("Source Company");
            ServiceOrder.GET("Source No.");
            MandatoryFields.CheckMandatoryFieldsServiceOrder(ServiceOrder, Rec, "Source Company");
            IF ServiceOrder."Price Book Type" <> ServiceOrder."Price Book Type"::None THEN
              IF ServiceOrder.ProductionRecordingIsUsed THEN
                ServiceOrder.TESTFIELD("Unit Price Status", ServiceOrder."Unit Price Status"::"Production Recording");
          END;
          "Source Type"::Project : BEGIN
            Job.CHANGECOMPANY("Source Company");
            Job.GET("Source No.");
            MandatoryFields.CheckMandatoryFieldsProject(Job, Rec, "Source Company");
          END;
        END;
        "Export Item Usage to FSA" := TRUE;
        "Actual Field Service Status" := '';
        GetExportReferencePoint();  // 15
      END ELSE
        GetInitialReferencePoint();  // 10
    END;

    LOCAL PROCEDURE UpdateOnExportToFSA@1100529105();
    VAR
      ServiceOrder@1100528102 : Record 11012823;
    BEGIN
      IF "Export to FSA" THEN BEGIN
        IF "Source Type" = "Source Type"::ServiceOrder THEN BEGIN
          ServiceOrder.CHANGECOMPANY("Source Company");
          ServiceOrder.GET("Source No.");
          ServiceOrder.UpdateLongitudeLatitudeInExtensionTable;
          ServiceOrder.AddLatLngToServiceLocation;
          ServiceOrder.AddLatLngToServiceObjects;
          UpdateSOObjectSpecificationLines;
          UpdateSOObjectInspectionLines;
        END;
      END;
    END;

    [TryFunction]
    [External]
    PROCEDURE ExportFromGRPtoFSA@1100528303();
    BEGIN
      // Try Function for batch export from GRP
      IF (("Source Type" = "Source Type"::ServiceOrder) OR ("Source Type" = "Source Type"::Project)) THEN BEGIN
        ValidateExportToFSA;
      END ELSE IF ("Source Type" = "Source Type"::Request) THEN
        ValidateExportToCCA;
    END;

    PROCEDURE UpdateModifiedOnAndBy@1100528618();
    VAR
      ChangeLogSubscriberGRP@1100529101 : Codeunit 11124903;
      InstallationManagement@1100529100 : Codeunit 11012268;
    BEGIN
      "Modified on" := CURRENTDATETIME;
      "Modified by" := USERID;
      IF InstallationManagement.LicensePermissionForTableData(DATABASE::"Resource Planning Setup") THEN
        ChangeLogSubscriberGRP.UpdateWorkorderChangeLog("No.");
    END;

    PROCEDURE AddLinkedResources@1100529000(UpdateMode@1100529002 : Code[1]);
    VAR
      LinkedResource@1100529000 : Record 11229324;
      WorkOrder@1100529001 : Record 11229279;
      AdditionalInfoRequestWO@1100529003 : Record 11124915;
      TmpTable1@1100528300 : TEMPORARY Record 11020579;
      TmpTable2@1100528301 : TEMPORARY Record 11020579;
      prevWorkOrder@1100527650 : Record 11229279;
      RecalcHoursMainPlantWO@1100528302 : Boolean;
    BEGIN
      IF gSkipAddLinkedResources OR ("Resource No." = '') THEN
        EXIT;
      IF NOT prevWorkOrder.GET("No.") THEN
        prevWorkOrder."Resource No." := '';
      IF (UpdateMode = 'I') OR ((UpdateMode = 'M') AND ("Resource No." <> prevWorkOrder."Resource No.")) THEN BEGIN
        LinkedResource.SETRANGE("Main Resource No.", "Resource No.");
        IF LinkedResource.FINDSET THEN BEGIN
          IF "Resource Type" = "Resource Type"::Plant THEN BEGIN
            TmpTable1."Key Code1" := "Resource No.";
            TmpTable1.Code1 := "No.";
            TmpTable1.INSERT;
          END;
          WorkOrder.SetSkipAddLinkedResources(TRUE);
          REPEAT
            LinkedResource.CALCFIELDS("Resource Type");
            WorkOrder.TRANSFERFIELDS(Rec, FALSE);
            WorkOrder."No." := '';
            WorkOrder."Resource Type" := LinkedResource."Resource Type";
            WorkOrder."Resource Group No." := '';;
            WorkOrder.VALIDATE("Resource No.", LinkedResource."Resource No.");
            WorkOrder."Related Work Order No." := "No.";
            WorkOrder."Schedule Relation" := WorkOrder."Schedule Relation"::"Start-Start";
            WorkOrder."Leading Resource" := FALSE;
            WorkOrder.INSERT(TRUE);
            IF "Source Type" = "Source Type"::Request THEN BEGIN
              AdditionalInfoRequestWO.CHANGECOMPANY(WorkOrder."Source Company");
              IF AdditionalInfoRequestWO.GET(WorkOrder."No.") THEN BEGIN
                AdditionalInfoRequestWO.Chargeable := LinkedResource."Chargeable (default)";
                AdditionalInfoRequestWO.MODIFY;
              END;
            END;
            IF LinkedResource."Resource Type" = LinkedResource."Resource Type"::Plant THEN BEGIN
              TmpTable1."Key Code1" := LinkedResource."Resource No.";
              TmpTable1.Code1 := WorkOrder."No.";
              TmpTable1.INSERT;
            END;
            IF (LinkedResource."Operates Plant" <> '') AND
               (LinkedResource."Resource Type" IN [LinkedResource."Resource Type"::Employee, LinkedResource."Resource Type"::Subcontractor])
            THEN BEGIN
              TmpTable2."Key Code1" := WorkOrder."No.";
              TmpTable2.Code1 := LinkedResource."Operates Plant";
              TmpTable2.INSERT;
            END;
          UNTIL LinkedResource.NEXT = 0;
          WorkOrder.SetSkipAddLinkedResources(FALSE);
          IF TmpTable2.FINDSET THEN BEGIN
            REPEAT
              TmpTable1.SETRANGE("Key Code1", TmpTable2.Code1);
              IF TmpTable1.FINDFIRST THEN BEGIN
                IF WorkOrder.GET(TmpTable2."Key Code1") THEN BEGIN
                  WorkOrder."Operates Plant (WO)" := TmpTable1.Code1;
                  WorkOrder.MODIFY(FALSE);
                  IF ("Resource Type" = "Resource Type"::Plant) AND (TmpTable1.Code1 = "No.") THEN
                    RecalcHoursMainPlantWO := TRUE;
                END;
              END;
            UNTIL TmpTable2.NEXT = 0;
            IF RecalcHoursMainPlantWO AND ("Source Type" = "Source Type"::Request) THEN BEGIN
              IF AdditionalInfoRequestWO.GET("No.") THEN BEGIN
                AdditionalInfoRequestWO."Planned Hours" := AdditionalInfoRequestWO.CalculateNumberOfPlannedHours(Rec, AdditionalInfoRequestWO."Calulate Pause", FALSE, Rec);
                AdditionalInfoRequestWO.MODIFY;
              END;
            END;
          END;
        END;
      END;
    END;

    [External]
    PROCEDURE SetSkipAddLinkedResources@1100529001(Skip@1100529000 : Boolean);
    BEGIN
      gSkipAddLinkedResources := Skip;
    END;

    [External]
    PROCEDURE UpdateAdditionalInfoRequestWorkorder@1100529003(UpdateMode@1100529000 : Code[1]);
    VAR
      AdditionalInfoRequestWO@1100529001 : Record 11124915;
      xRecWorkorder@1100528300 : Record 11229279;
    BEGIN
      IF "Source Type" = "Source Type"::Request THEN BEGIN
        TESTFIELD("Source Company", COMPANYNAME);
        IF UpdateMode <> 'I' THEN BEGIN
          IF NOT xRecWorkorder.GET("No.") THEN
            xRecWorkorder.INIT;
        END;
        AdditionalInfoRequestWO.UpdateAdditionalInfoRequestFromWorkorder(UpdateMode, Rec, xRecWorkorder);
      END;
    END;

    LOCAL PROCEDURE UpdateAdditionalInfoHoursOnOperatesPlantWO@1100528301(OperatesPlantWO@1100528301 : Code[20]);
    VAR
      WorkOrder@1100528302 : Record 11229279;
      AdditionalInfoRequestWO@1100528300 : Record 11124915;
    BEGIN
      IF (OperatesPlantWO <> '') AND ("Source Type" = "Source Type"::Request) THEN BEGIN
        IF WorkOrder.GET(OperatesPlantWO) THEN BEGIN
          IF AdditionalInfoRequestWO.GET(OperatesPlantWO) THEN BEGIN
            AdditionalInfoRequestWO."Planned Hours" := AdditionalInfoRequestWO.CalculateNumberOfPlannedHours(WorkOrder, AdditionalInfoRequestWO."Calulate Pause", TRUE, Rec);
            AdditionalInfoRequestWO.MODIFY;
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckResourceRequestStartingEndingDate@1100529004();
    BEGIN
      IF ("Source Type" = "Source Type"::Request) AND (("Resource No." <> '') OR ("Resource Group No." <> '')) THEN BEGIN
        TESTFIELD("Starting Date/Time");
        TESTFIELD("Ending Date/Time");
      END;
    END;

    PROCEDURE LookupResourceGroup@1100529006(EditableMode@1100529003 : Boolean);
    VAR
      ResourceGroup@1100529000 : Record 11229384;
    BEGIN
      IF NOT ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Plant, "Resource Type"::Subcontractor]) THEN
        EXIT;
      IF EditableMode THEN BEGIN
        IF Finished OR "WO Finished (Field Service)" THEN
          EditableMode := FALSE;
      END;
      ResourceGroup.FILTERGROUP(2);
      IF "Resource Type" = "Resource Type"::Plant THEN
        ResourceGroup.SETRANGE(Type, ResourceGroup.Type::Plant)
      ELSE
        ResourceGroup.SETRANGE(Type, ResourceGroup.Type::Discipline);
      ResourceGroup.FILTERGROUP(0);
      ResourceGroup.SETRANGE("No.", "Resource Group No.");
      IF (NOT ResourceGroup.FINDFIRST) OR ("Resource Group No." = '') THEN BEGIN
        ResourceGroup."No." := '';
        ResourceGroup.Company := COMPANYNAME;
        IF "Resource Type" = "Resource Type"::Plant THEN
          ResourceGroup.Type := ResourceGroup.Type::Plant
        ELSE
          ResourceGroup.Type := ResourceGroup.Type::Discipline;
      END;
      ResourceGroup.SETRANGE("No.");

      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, ResourceGroup)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, ResourceGroup) = ACTION::LookupOK THEN
          VALIDATE("Resource Group No.", ResourceGroup."No.");
      END;
    END;

    PROCEDURE LookupResourceOfResourceGroup@1100529007(EditableMode@1100529001 : Boolean);
    VAR
      Resource@1100529000 : Record 11229278;
      ResourceGroup@1100529002 : Record 11229384;
    BEGIN
      IF (NOT ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Plant, "Resource Type"::Subcontractor])) THEN
        EXIT;
      IF EditableMode THEN BEGIN
        IF Finished OR "WO Finished (Field Service)" THEN
          EditableMode := FALSE;
      END;
      IF "Resource Group No." <> '' THEN BEGIN
        IF NOT ResourceGroup.GET("Resource Group No.") THEN
          ResourceGroup.INIT;
      END;
      CASE "Resource Type" OF
        "Resource Type"::Employee,
        "Resource Type"::Subcontractor:
          BEGIN
            Resource.FILTERGROUP(2);
            IF "Resource Type" = "Resource Type"::Subcontractor THEN
              Resource.SETRANGE(Type, Resource.Type::Subcontractor)
            ELSE
              Resource.SETRANGE(Type, Resource.Type::Employee);
            Resource.FILTERGROUP(0);
            IF "Resource Group No." <> '' THEN BEGIN
              Resource.SETRANGE("Discipline Filter", ResourceGroup."Source No.");
              Resource.SETRANGE("Discipline Exist", TRUE);
            END;
          END;
        "Resource Type"::Plant:
          BEGIN
            Resource.FILTERGROUP(2);
            Resource.SETRANGE(Type, Resource.Type::Plant);
            Resource.FILTERGROUP(0);
            IF "Resource Group No." <> '' THEN
              Resource.SETRANGE("Source No.", ResourceGroup."Source No.");
          END;
      END;
      Resource."No." := "Resource No.";
      IF (NOT Resource.GET("Resource No.")) OR ("Resource No." = '') THEN BEGIN
        Resource."No." := '';
        Resource.Company := COMPANYNAME;
        CASE "Resource Type" OF
          "Resource Type"::Employee:
            Resource.Type := Resource.Type::Employee;
          "Resource Type"::Subcontractor:
            Resource.Type := Resource.Type::Subcontractor;
          "Resource Type"::Plant:
            BEGIN
              Resource.Type := Resource.Type::Plant;
              IF ("Resource No." = '') AND ("Resource Group No." <> '') THEN
                Resource.Company := ResourceGroup.Company;
            END;
        END;
      END;
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, Resource)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, Resource) = ACTION::LookupOK THEN
          VALIDATE("Resource No.", Resource."No.");
      END;
    END;

    PROCEDURE LookupOperatesPlantWO@1100529008();
    VAR
      PlantWorkOrder@1100529000 : Record 11229279;
    BEGIN
      IF NOT ("Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Subcontractor]) THEN
        FIELDERROR("Resource Type");
      PlantWorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      PlantWorkOrder.FILTERGROUP(9);
      PlantWorkOrder.SETRANGE("Source Company", "Source Company");
      PlantWorkOrder.SETRANGE("Source Type", "Source Type");
      PlantWorkOrder.SETRANGE("Source No.", "Source No.");
      PlantWorkOrder.SETRANGE("Resource Type", "Resource Type"::Plant);
      PlantWorkOrder.FILTERGROUP(0);
      PlantWorkOrder."No." := "Operates Plant (WO)";
      IF Finished OR "WO Finished (Field Service)" THEN
        PAGE.RUNMODAL(0, PlantWorkOrder)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantWorkOrder) = ACTION::LookupOK THEN
          VALIDATE("Operates Plant (WO)", PlantWorkOrder."No.");
      END;
    END;

    PROCEDURE UpdateDateTimeExportWorkSheet@1100525050();
    BEGIN
      "Date/Time Export Work Sheet" := CURRENTDATETIME;
      MODIFY;
    END;

    PROCEDURE GetJobAssignedTo@1100528619(IJob@1100528600 : Record 11072003) : Code[20];
    BEGIN
      WorkOrderPlanningSetup.GET;
      CASE WorkOrderPlanningSetup."Assign To (Job)" OF
        WorkOrderPlanningSetup."Assign To (Job)"::"Project Manager":
          EXIT(IJob."Project Manager");
        WorkOrderPlanningSetup."Assign To (Job)"::"Project Engineer":
          EXIT(IJob."Project Engineer");
        WorkOrderPlanningSetup."Assign To (Job)"::"Site Manager":
          EXIT(IJob."Site Manager");
      END;
    END;

    PROCEDURE UpdateWorkOrderDurationTime@1100528620();
    VAR
      SUPRecordingLine@1100528602 : Record 11071772;
      ServiceOrder@1100528601 : Record 11012823;
      ServiceUnitPriceManagement@1100528603 : Codeunit 11012846;
      Hours@1100528604 : Decimal;
      Quantity@1100528606 : Decimal;
    BEGIN
      IF "Source Type" <> "Source Type"::ServiceOrder THEN
        EXIT;
      TESTFIELD("Source Company", COMPANYNAME);
      IF NOT ServiceOrder.GET("Source No.") THEN
        EXIT;
      SUPRecordingLine.SETCURRENTKEY("Work Order No.");
      SUPRecordingLine.SETRANGE("Work Order No.", "No.");
      IF SUPRecordingLine.FINDSET THEN BEGIN
        REPEAT
          SUPRecordingLine.CALCFIELDS("Unit Price Status");
          CASE SUPRecordingLine."Unit Price Status" OF
            SUPRecordingLine."Unit Price Status"::"Pre-Recording":
              Quantity := SUPRecordingLine."Pre-Recording Quantity";
            SUPRecordingLine."Unit Price Status"::Recording:
              Quantity := SUPRecordingLine."Recording Quantity";
          END;
          Hours +=
            ServiceUnitPriceManagement.GetUnitPriceHours(SUPRecordingLine."Price Book Code", SUPRecordingLine."Index Date", SUPRecordingLine."Unit Price Code") *
            Quantity;
        UNTIL SUPRecordingLine.NEXT = 0;
        VALIDATE("Expected Hours", Hours);
        VALIDATE("Duration Time", Hours);
      END;
    END;

    LOCAL PROCEDURE CheckFirmPlannedPlanDates@1100528738();
    VAR
      ReferencePoint@1100528600 : Record 11020271;
    BEGIN
      IF NOT "Firm Planned" THEN
        EXIT;
      IF ("First Possible Start.Date/Time" <> 0DT) OR ("Last Possible Ending Date/Time" <> 0DT) THEN BEGIN
        IF "Starting Date/Time" < "First Possible Start.Date/Time" THEN
          FIELDERROR("First Possible Start.Date/Time", STRSUBSTNO(Text024, FIELDCAPTION("Starting Date/Time")));
        IF "Starting Date/Time" > "Last Possible Ending Date/Time" THEN
          FIELDERROR("Starting Date/Time", STRSUBSTNO(Text024, FIELDCAPTION("Last Possible Ending Date/Time")));

        IF ("Starting Date/Time" <> 0DT) AND (("Starting Date/Time" < "First Possible Start.Date/Time") OR ("Starting Date/Time" > "Last Possible Ending Date/Time")) THEN
          FIELDERROR("Starting Date/Time", STRSUBSTNO(Text025, FIELDCAPTION("First Possible Start.Date/Time"), FIELDCAPTION("Last Possible Ending Date/Time")));
        IF ("Ending Date/Time" <> 0DT) AND (("Ending Date/Time" < "First Possible Start.Date/Time") OR ("Ending Date/Time" > "Last Possible Ending Date/Time")) THEN
          FIELDERROR("Ending Date/Time", STRSUBSTNO(Text025, FIELDCAPTION("First Possible Start.Date/Time"), FIELDCAPTION("Last Possible Ending Date/Time")));

        IF "Ending Date/Time" > "Last Possible Ending Date/Time" THEN
          FIELDERROR("Ending Date/Time", STRSUBSTNO(Text024, FIELDCAPTION("Last Possible Ending Date/Time")));
      END ELSE BEGIN
        IF "Actual Reference Point" <> 0 THEN
          ReferencePoint.GET("Actual Reference Point");
        IF ((xRec."Starting Date/Time" <> 0DT) AND (xRec."Starting Date/Time" <> "Starting Date/Time") AND NOT ReferencePoint."Update WO Starting Time") OR
           ((xRec."Ending Date/Time" <> 0DT) AND (xRec."Ending Date/Time" <> "Ending Date/Time") AND NOT ReferencePoint."Update WO Starting Time" AND NOT ReferencePoint."Update WO Ending Time")
        THEN
          ERROR(Text026, "No.");
      END;
    END;

    LOCAL PROCEDURE ValidateTargetCompany@1100528622();
    VAR
      Company@1100528601 : Record 2000000006;
    BEGIN
      Company.SETFILTER(Name, '@' + "Target Company");
      IF Company.FINDFIRST THEN BEGIN
        "Target Company" := Company.Name;
        EXIT;
      END;
      Company.SETFILTER(Name, '@' + "Target Company" + '*');
      IF Company.FINDFIRST THEN
        "Target Company" := Company.Name;
    END;

    [External]
    PROCEDURE GetOverlapWorkOrderNo@1100529100() : Code[20];
    VAR
      WorkOrder@1100529100 : Record 11229279;
    BEGIN
      //GRP GWP
      IF "Resource No." = '' THEN
        EXIT;
      WorkOrder.RESET;
      WorkOrder.SETCURRENTKEY("Resource No.","Ending Date/Time");
      WorkOrder.SETRANGE("Resource No.", "Resource No.");
      WorkOrder.SETFILTER("Ending Date/Time", '>%1', "Starting Date/Time");
      WorkOrder.SETFILTER("Starting Date/Time", '<%1', "Ending Date/Time");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      IF WorkOrder.FINDFIRST THEN
        EXIT(WorkOrder."No.");
    END;

    [External]
    PROCEDURE CheckEmployeeAbsence@1100525015() : Boolean;
    VAR
      EmployeeAbsence@1100525000 : Record 5207;
      EmployeeNo@1100525002 : Code[20];
      FromDateTime@1100529101 : DateTime;
      ToDateTime@1100529100 : DateTime;
      EmployeeCompany@1100529102 : Text;
    BEGIN
      IF ("Resource No." = '') OR ("Resource Type" <> "Resource Type"::Employee) THEN
        EXIT(FALSE);
      IF NOT GetEmployeeFromResource(EmployeeNo, EmployeeCompany) THEN
        EXIT(FALSE);
      EmployeeAbsence.CHANGECOMPANY(EmployeeCompany);
      EmployeeAbsence.SETRANGE("Employee No.", EmployeeNo);
      EmployeeAbsence.SETFILTER("To Date", '>= %1', DT2DATE("Starting Date/Time"));
      EmployeeAbsence.SETFILTER("From Date", '<= %1', DT2DATE("Ending Date/Time"));
      EmployeeAbsence.SETRANGE(Plannable, FALSE);
      IF EmployeeAbsence.FINDSET THEN BEGIN
        REPEAT
          FromDateTime := CREATEDATETIME(EmployeeAbsence."From Date", EmployeeAbsence."From Time");
          IF (EmployeeAbsence."From Time" = 0T) AND (EmployeeAbsence."Until Time" = 0T) THEN
            ToDateTime := CREATEDATETIME(EmployeeAbsence."To Date" + 1, EmployeeAbsence."Until Time")
          ELSE
            ToDateTime := CREATEDATETIME(EmployeeAbsence."To Date", EmployeeAbsence."Until Time");
          IF (ToDateTime > "Starting Date/Time") AND (FromDateTime < "Ending Date/Time") THEN
            EXIT(TRUE);
        UNTIL EmployeeAbsence.NEXT = 0;
      END;
      EXIT(FALSE);
    END;

    [External]
    PROCEDURE CheckPlantAbsence@1100529103() : Boolean;
    VAR
      PlantAbsence@1100525000 : Record 11126143;
      PlantType@1100525002 : Code[20];
      PlantNo@1100529103 : Code[10];
      FromDateTime@1100529101 : DateTime;
      ToDateTime@1100529100 : DateTime;
      PlantCompany@1100529102 : Text;
    BEGIN
      IF ("Resource No." = '') OR ("Resource Type" <> "Resource Type"::Plant) THEN
        EXIT(FALSE);
      IF NOT GetPlantFromResource(PlantType, PlantNo, PlantCompany) THEN
        EXIT(FALSE);
      PlantAbsence.CHANGECOMPANY(PlantCompany);
      PlantAbsence.SETRANGE("Plant Type", PlantType);
      PlantAbsence.SETRANGE("Plant No.", PlantNo);
      PlantAbsence.SETFILTER("To Date", '>= %1', DT2DATE("Starting Date/Time"));
      PlantAbsence.SETFILTER("From Date", '<= %1', DT2DATE("Ending Date/Time"));
      PlantAbsence.SETRANGE(Plannable, FALSE);
      IF PlantAbsence.FINDSET THEN BEGIN
        REPEAT
          FromDateTime := CREATEDATETIME(PlantAbsence."From Date", PlantAbsence."From Time");
          IF (PlantAbsence."From Time" = 0T) AND (PlantAbsence."Until Time" = 0T) THEN
            ToDateTime := CREATEDATETIME(PlantAbsence."To Date" + 1, PlantAbsence."Until Time")
          ELSE
            ToDateTime := CREATEDATETIME(PlantAbsence."To Date", PlantAbsence."Until Time");
          IF (ToDateTime > "Starting Date/Time") AND (FromDateTime < "Ending Date/Time") THEN
            EXIT(TRUE);
        UNTIL PlantAbsence.NEXT = 0;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetEmployeeFromResource@1100529101(VAR EmployeeNo@1100525001 : Code[20];VAR EmployeeCompany@1100529100 : Text) : Boolean;
    VAR
      ResourceWOP@1100525002 : Record 11229278;
    BEGIN
      IF ResourceWOP.GET("Resource No.") THEN BEGIN
        IF (ResourceWOP.Type = ResourceWOP.Type::Employee) THEN BEGIN
          EmployeeNo := ResourceWOP."Source No.";
          EmployeeCompany := ResourceWOP.Company;
          EXIT(TRUE);
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetPlantFromResource@1100529104(VAR PlantType@1100525001 : Code[20];VAR PlantNo@1100529101 : Code[10];VAR PlantCompany@1100529100 : Text) : Boolean;
    VAR
      ResourceWOP@1100525002 : Record 11229278;
    BEGIN
      IF ResourceWOP.GET("Resource No.") THEN BEGIN
        IF (ResourceWOP.Type = ResourceWOP.Type::Plant) THEN BEGIN
          PlantType := ResourceWOP."Source No.";
          PlantNo := ResourceWOP."Source No. 2";
          PlantCompany := ResourceWOP.Company;
          EXIT(TRUE);
        END;
      END;
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE UpdateRefPointWOsLinkedToWOLeadingResource@1100528623();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      IF NOT "Leading Resource" THEN
        EXIT;

      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETRANGE("Link WO to WO Leading Resource", TRUE);
      UpdateRefPointInOtherWOs(WorkOrder,FALSE);
    END;

    LOCAL PROCEDURE UpdateRefPointRelatedWOs@1100528503();
    BEGIN
      IF ("Resource Type" <> "Resource Type"::Employee) OR ("Resource No." = '') THEN
        EXIT;

      CALCFIELDS("Active in FSA");
      IF NOT "Active in FSA" THEN
        EXIT;

      UpdateRefPointRelatedWOsNotActiveInFSA;
      UpdateRefPointRelatedWOsActiveInFSA;
    END;

    LOCAL PROCEDURE UpdateRefPointRelatedWOsNotActiveInFSA@1100525016();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      WorkOrder.SETFILTER("Resource Type", '%1|%2', WorkOrder."Resource Type"::Employee, WorkOrder."Resource Type"::Plant);
      WorkOrder.SETFILTER("Resource No.", '<>%1', '');
      WorkOrder.SETRANGE("Active in FSA", FALSE);
      WorkOrder.SETRANGE("Schedule Relation", "Schedule Relation"::"Start-Start");
      WorkOrder.SETRANGE("Link WO to WO Leading Resource", FALSE);
      IF "Related Work Order No." <> '' THEN BEGIN
        WorkOrder.SETFILTER("No.", '<>%1', "No.");
        WorkOrder.SETRANGE("Related Work Order No.", "Related Work Order No.");
        UpdateRefPointInOtherWOs(WorkOrder,FALSE);
        IF "Related Work Order No." <> "No." THEN BEGIN
          WorkOrder.SETRANGE("Related Work Order No.");
          WorkOrder.SETRANGE("Schedule Relation");
          WorkOrder.SETRANGE("No.", "Related Work Order No.");
          UpdateRefPointInOtherWOs(WorkOrder,FALSE);
        END;
      END ELSE BEGIN
        WorkOrder.SETFILTER("No.", '<>%1', "No.");
        WorkOrder.SETRANGE("Related Work Order No.", "No.");
        UpdateRefPointInOtherWOs(WorkOrder,FALSE);
      END;
    END;

    LOCAL PROCEDURE UpdateRefPointRelatedWOsActiveInFSA@1100528502();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      //Resource is Active in FSA, Workorder not
      WorkOrder.SETFILTER("Resource Type", '%1|%2', WorkOrder."Resource Type"::Employee, WorkOrder."Resource Type"::Plant);
      WorkOrder.SETFILTER("Resource No.", '<>%1', '');
      WorkOrder.SETRANGE("Active in FSA",TRUE);
      WorkOrder.SETRANGE("Schedule Relation", "Schedule Relation"::"Start-Start");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETRANGE("Related Work Order No.", "No.");
      UpdateRefPointInOtherWOs(WorkOrder,TRUE);
    END;

    LOCAL PROCEDURE UpdateRefPointInOtherWOs@1100525018(VAR WorkOrder@1100525000 : Record 11229279;SkipIndepent@1100528501 : Boolean);
    VAR
      SkipWorkOrder@1100528502 : Boolean;
      ModifyWorkOrder@1100528503 : Boolean;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      IF WorkOrder.FINDSET(TRUE) THEN
        REPEAT
          IF SkipIndepent THEN
            SkipWorkOrder := WorkOrder."Export to FSA" OR (WorkOrder."Date/Time Export to FSA" <> 0DT)
          ELSE
            SkipWorkOrder := FALSE;
          IF NOT SkipWorkOrder THEN BEGIN
            ModifyWorkOrder := FALSE;
            IF WorkOrder."Actual Reference Point" <> "Actual Reference Point" THEN BEGIN
              ModifyWorkOrder := TRUE;
              WorkOrder.VALIDATE("Actual Reference Point", "Actual Reference Point");
            END;
            IF WorkOrder."Actual Field Service Status" <> "Actual Field Service Status" THEN BEGIN
              ModifyWorkOrder := TRUE;
              WorkOrder.VALIDATE("Actual Field Service Status", "Actual Field Service Status");
            END;
            IF ModifyWorkOrder THEN BEGIN
              WorkOrder.SetDateTimeRefPointRegistr(gDateTimeRefPointRegistr);
              WorkOrder.MODIFY(TRUE);
            END;
          END;
        UNTIL WorkOrder.NEXT = 0;
    END;

    LOCAL PROCEDURE LinkWorkOrdersToWOLeadingResource@1100528624();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      IF NOT "Leading Resource" THEN
        EXIT;
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETRANGE("Link WO to WO Leading Resource", TRUE);
      IF WorkOrder.FINDSET(TRUE) THEN
        REPEAT
          WorkOrder.VALIDATE("Starting Date/Time", 0DT);
          WorkOrder.VALIDATE("First Possible Start.Date/Time", 0DT);
          WorkOrder.VALIDATE("Starting Date/Time", "Starting Date/Time");
          WorkOrder.VALIDATE("Ending Date/Time", "Ending Date/Time");
          WorkOrder.VALIDATE("Duration Time", "Duration Time");
          WorkOrder.VALIDATE("First Possible Start.Date/Time", "First Possible Start.Date/Time");
          WorkOrder.VALIDATE("Last Possible Ending Date/Time", "Last Possible Ending Date/Time");
          WorkOrder.VALIDATE("Firm Planned", "Firm Planned");
          WorkOrder.VALIDATE("Schedule Relation", WorkOrder."Schedule Relation"::"Start-Start");
          WorkOrder."Related Work Order No." := "No.";
          WorkOrder.MODIFY(TRUE);
        UNTIL WorkOrder.NEXT = 0;
    END;

    PROCEDURE UpdateLinkToWOLeadingResource@1100528628();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      CALCFIELDS("Link WO to WO Leading Resource");
      IF NOT "Link WO to WO Leading Resource" THEN
        EXIT;
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.SETRANGE("Leading Resource", TRUE);
      IF WorkOrder.FINDFIRST THEN BEGIN
        VALIDATE("First Possible Start.Date/Time", 0DT);
        VALIDATE("Starting Date/Time", 0DT);
        VALIDATE("Starting Date/Time", WorkOrder."Starting Date/Time");
        VALIDATE("Ending Date/Time", WorkOrder."Ending Date/Time");
        VALIDATE("Duration Time", WorkOrder."Duration Time");
        VALIDATE("First Possible Start.Date/Time", WorkOrder."First Possible Start.Date/Time");
        VALIDATE("Last Possible Ending Date/Time", WorkOrder."Last Possible Ending Date/Time");
        VALIDATE("Firm Planned", WorkOrder."Firm Planned");
        VALIDATE("Schedule Relation", "Schedule Relation"::"Start-Start");
        VALIDATE("Related Work Order No.", WorkOrder."No.");
      END;
    END;

    PROCEDURE UpdateLinkedWOs@1100528626();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      MODIFY(); //it is needed to fix changes of current main WO

      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      WorkOrder.VALIDATE("Schedule Relation", WorkOrder."Schedule Relation"::"Start-Start");
      WorkOrder.SETRANGE("Related Work Order No.", "No.");
      IF WorkOrder.FINDSET(TRUE) THEN
        REPEAT
          WorkOrder."Starting Date/Time" := "Starting Date/Time";
          WorkOrder."Ending Date/Time" := "Ending Date/Time";
          WorkOrder."Duration Time" := "Duration Time";
          WorkOrder."First Possible Start.Date/Time" := "First Possible Start.Date/Time";
          WorkOrder."Last Possible Ending Date/Time" := "Last Possible Ending Date/Time";
          WorkOrder."Firm Planned" := "Firm Planned";
          WorkOrder."Plan during Clock Time" := "Plan during Clock Time";
          WorkOrder.UpdateAdditionalInfoRequestWorkorder('M');
          WorkOrder.MODIFY(FALSE);
        UNTIL WorkOrder.NEXT = 0;
    END;

    PROCEDURE CollChangeResourceOnWOs@1100528625(VAR IWorkOrders@1100528600 : Record 11229279;IResourceType@1100528601 : Option;IResourceNo@1100528602 : Code[20]);
    VAR
      WorkOrder@1100528603 : Record 11229279;
    BEGIN
      WorkOrder.COPY(IWorkOrders);
      IF WorkOrder.FINDSET(TRUE, TRUE) THEN
        REPEAT
          WorkOrder.VALIDATE("Resource Type", IResourceType);
          WorkOrder.VALIDATE("Resource No.", IResourceNo);
          WorkOrder.MODIFY(TRUE);
        UNTIL WorkOrder.NEXT = 0;
    END;

    PROCEDURE FillSeparateDateAndTimeFields@1100528401(VAR FirstPossibleStartingDate@1100528400 : Date;VAR FirstPossibleStartingTime@1100528401 : Time;VAR LastPossibleEndingDate@1100528402 : Date;VAR LastPossibleEndingTime@1100528403 : Time;VAR StartingDate@1100528404 : Date;VAR StartingTime@1100528405 : Time;VAR EndingDate@1100528406 : Date;VAR EndingTime@1100528407 : Time);
    BEGIN
      FirstPossibleStartingDate := DT2DATE("First Possible Start.Date/Time");
      FirstPossibleStartingTime := DT2TIME("First Possible Start.Date/Time");
      LastPossibleEndingDate := DT2DATE("Last Possible Ending Date/Time");
      LastPossibleEndingTime := DT2TIME("Last Possible Ending Date/Time");
      StartingDate := DT2DATE("Starting Date/Time");
      StartingTime := DT2TIME("Starting Date/Time");
      EndingDate := DT2DATE("Ending Date/Time");
      EndingTime := DT2TIME("Ending Date/Time");
    END;

    PROCEDURE ValidateSeparateDateAndTimeFields@1100528400(ValidationField@1100528600 : 'FirstPossibleStartingDateTime,FirstPossibleStartingDate,FirstPossibleStartingTime,LastPossibleEndingDateTime,LastPossibleEndingDate,LastPossibleEndingTime,StartingDateTime,StartingDate,StartingTime,EndingDateTime,EndingDate,EndingTime';VAR FirstPossibleStartingDate@1100528407 : Date;VAR FirstPossibleStartingTime@1100528406 : Time;VAR LastPossibleEndingDate@1100528405 : Date;VAR LastPossibleEndingTime@1100528404 : Time;VAR StartingDate@1100528403 : Date;VAR StartingTime@1100528402 : Time;VAR EndingDate@1100528401 : Date;VAR EndingTime@1100528400 : Time);
    VAR
      FirstPossibleStartingDateTime@1100528601 : DateTime;
      LastPossibleEndingDateTime@1100528602 : DateTime;
      StartingDateTime@1100528603 : DateTime;
      EndingDateTime@1100528604 : DateTime;
    BEGIN
      CASE ValidationField OF
        ValidationField::FirstPossibleStartingDateTime:
          FillSeparateDateAndTimeFields(
            FirstPossibleStartingDate, FirstPossibleStartingTime, LastPossibleEndingDate,
            LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
        ValidationField::FirstPossibleStartingDate:
          IF FirstPossibleStartingDate = 0D THEN BEGIN
            VALIDATE("First Possible Start.Date/Time", 0DT);
            ValidateSeparateDateAndTimeFields(
              ValidationField::FirstPossibleStartingDateTime, FirstPossibleStartingDate, FirstPossibleStartingTime,
              LastPossibleEndingDate, LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
          END ELSE BEGIN
            FirstPossibleStartingDateTime := CREATEDATETIME(FirstPossibleStartingDate, FirstPossibleStartingTime);
            VALIDATE("First Possible Start.Date/Time", FirstPossibleStartingDateTime)
          END;
        ValidationField::FirstPossibleStartingTime:
          VALIDATE("First Possible Start.Date/Time", CREATEDATETIME(FirstPossibleStartingDate, FirstPossibleStartingTime));
        ValidationField::LastPossibleEndingDateTime:
          FillSeparateDateAndTimeFields(
            FirstPossibleStartingDate, FirstPossibleStartingTime, LastPossibleEndingDate,
            LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
        ValidationField::LastPossibleEndingDate:
          IF LastPossibleEndingDate = 0D THEN BEGIN
            VALIDATE("Last Possible Ending Date/Time", 0DT);
            ValidateSeparateDateAndTimeFields(
              ValidationField::LastPossibleEndingDateTime, FirstPossibleStartingDate, FirstPossibleStartingTime,
              LastPossibleEndingDate, LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
          END ELSE BEGIN
            LastPossibleEndingDateTime := CREATEDATETIME(LastPossibleEndingDate, LastPossibleEndingTime);
            IF LastPossibleEndingDateTime >= "First Possible Start.Date/Time" THEN
              VALIDATE("Last Possible Ending Date/Time", LastPossibleEndingDateTime);
          END;
        ValidationField::LastPossibleEndingTime:
          BEGIN
            IF (LastPossibleEndingDate = 0D) AND
               ("First Possible Start.Date/Time" <> 0DT) AND
               (LastPossibleEndingTime > FirstPossibleStartingTime)
            THEN
              LastPossibleEndingDate := FirstPossibleStartingDate;
            VALIDATE("Last Possible Ending Date/Time", CREATEDATETIME(LastPossibleEndingDate, LastPossibleEndingTime));
          END;
        ValidationField::StartingDateTime:
          FillSeparateDateAndTimeFields(
            FirstPossibleStartingDate, FirstPossibleStartingTime, LastPossibleEndingDate,
            LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
        ValidationField::StartingDate:
          IF StartingDate = 0D THEN BEGIN
            VALIDATE("Starting Date/Time", 0DT);
            ValidateSeparateDateAndTimeFields(
              ValidationField::StartingDateTime, FirstPossibleStartingDate, FirstPossibleStartingTime,
              LastPossibleEndingDate, LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
          END ELSE BEGIN
            StartingDateTime := CREATEDATETIME(StartingDate, StartingTime);
            VALIDATE("Starting Date/Time", StartingDateTime)
          END;
        ValidationField::StartingTime:
          VALIDATE("Starting Date/Time", CREATEDATETIME(StartingDate, StartingTime));
        ValidationField::EndingDateTime:
          FillSeparateDateAndTimeFields(
            FirstPossibleStartingDate, FirstPossibleStartingTime, LastPossibleEndingDate,
            LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
        ValidationField::EndingDate:
          IF EndingDate = 0D THEN BEGIN
            VALIDATE("Ending Date/Time", 0DT);
            ValidateSeparateDateAndTimeFields(
              ValidationField::EndingDateTime, FirstPossibleStartingDate, FirstPossibleStartingTime,
              LastPossibleEndingDate, LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);
          END ELSE BEGIN
            EndingDateTime := CREATEDATETIME(EndingDate, EndingTime);
            VALIDATE("Ending Date/Time", EndingDateTime);
          END;
        ValidationField::EndingTime:
          BEGIN
            IF (EndingDate = 0D) AND
               ("Starting Date/Time" <> 0DT) AND
               (EndingTime > StartingTime)
            THEN
              EndingDate := StartingDate;
            VALIDATE("Ending Date/Time", CREATEDATETIME(EndingDate, EndingTime));
          END;
      END;
    END;

    LOCAL PROCEDURE GetDefaultResouceGroup@1100528304();
    VAR
      ResourcePlanningSetup@1100528300 : Record 11124900;
      InstallationManagement@1100528301 : Codeunit 11012268;
    BEGIN
      IF "Resource Group No." = '' THEN BEGIN
        IF InstallationManagement.LicensePermissionForTableData(DATABASE::"Resource Planning Setup") THEN BEGIN
          IF ResourcePlanningSetup.GET THEN BEGIN
            IF "Resource Type" = "Resource Type"::Plant THEN
              "Resource Group No." := ResourcePlanningSetup."Default ResourceGroup Plant";
            IF "Resource Type" IN ["Resource Type"::Employee, "Resource Type"::Subcontractor] THEN
              "Resource Group No." := ResourcePlanningSetup."Default ResourceGrp Discipline";
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE UpdateCoordinatesOfServiceOrder@1100525017();
    VAR
      ServiceOrder@1100525000 : Record 11012823;
    BEGIN
      IF "Source Type" = "Source Type"::ServiceOrder THEN
        IF ServiceOrder.GET("Source No.") THEN
          ServiceOrder.UpdateLongitudeLatitudeInExtensionTable;
    END;

    PROCEDURE RequestIsLinkedToProject@1100527201(VAR ProjectNo@1100527201 : Code[20];VAR ProjectElementCompany@1100529600 : Text[30]) : Boolean;
    VAR
      ResourceRequest@1100527200 : Record 11124901;
    BEGIN
      ProjectNo := '';
      IF ("Source Type" = "Source Type"::Request) AND ("Source Company" <> '') AND ("Source No." <> '') THEN BEGIN
        ResourceRequest.CHANGECOMPANY("Source Company");
        IF ResourceRequest.GET("Source No.") THEN BEGIN
          IF (ResourceRequest."Source Type" = ResourceRequest."Source Type"::Project) AND (ResourceRequest."Source No." <> '') THEN BEGIN
            IF ResourceRequest."Receiving Company" <> '' THEN
              ProjectElementCompany := ResourceRequest."Receiving Company";
            ProjectNo := ResourceRequest."Source No.";
            EXIT(TRUE);
          END;
        END;
      END;
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE CreateDefaultTransportCost@1100529011(WorkOrder@1100529004 : Record 11229279;UpdateMode@1100529003 : Code[1]);
    VAR
      ResourceRequest@1100529002 : Record 11124901;
      OldWorkOrder@1100529006 : Record 11229279;
      StndTransportCostResourceRequest@1100529000 : Record 11124912;
      TmpTransportResource@1100529005 : TEMPORARY Record 11229278;
      CreateTransportWO@1100529001 : Boolean;
    BEGIN
      IF (NOT (UpdateMode IN ['I', 'M'])) OR
         (WorkOrder."No." = '') OR (WorkOrder."Source Type" <> WorkOrder."Source Type"::Request) OR
         (WorkOrder."Source No." = '') OR (WorkOrder."Source Company" <> COMPANYNAME) OR WorkOrder.Finished
      THEN
        EXIT;
      IF NOT ResourceRequest.GET(WorkOrder."Source No.") THEN
        EXIT;
      IF ResourceRequest.Status >= ResourceRequest.Status::Finished THEN
        EXIT;

      IF UpdateMode = 'M' THEN BEGIN
        IF NOT OldWorkOrder.GET(WorkOrder."No.") THEN
          OldWorkOrder.INIT;
        CheckDeleteTransportCostOnResourceChange(WorkOrder, OldWorkOrder);
      END;
      IF ((UpdateMode = 'I') OR ((UpdateMode = 'M') AND (WorkOrder."Resource No." <> OldWorkOrder."Resource No."))) AND
         (WorkOrder."Resource Type" = "Resource Type"::Plant) AND (WorkOrder."Resource No." <> '')
      THEN BEGIN
        IF ResourceRequest."Source Type" = ResourceRequest."Source Type"::Customer THEN BEGIN
          StndTransportCostResourceRequest.SETRANGE(Level, StndTransportCostResourceRequest.Level::"CustomerAddress-Resource");
          StndTransportCostResourceRequest.SETRANGE("Customer No.", ResourceRequest."Source No.");
          StndTransportCostResourceRequest.SETRANGE("Address Code", ResourceRequest."Address Code");
        END ELSE BEGIN
          StndTransportCostResourceRequest.SETRANGE(Level, StndTransportCostResourceRequest.Level::"PlantLocation-Resource");
          StndTransportCostResourceRequest.SETRANGE("Plant Location", ResourceRequest."Plant Location");
        END;
        StndTransportCostResourceRequest.SETRANGE("Resource No.", WorkOrder."Resource No.");
        IF StndTransportCostResourceRequest.ISEMPTY THEN BEGIN
          StndTransportCostResourceRequest.SETRANGE(Level, StndTransportCostResourceRequest.Level::Resource);
          StndTransportCostResourceRequest.SETRANGE("Customer No.");
          StndTransportCostResourceRequest.SETRANGE("Address Code");
          StndTransportCostResourceRequest.SETRANGE("Plant Location");
        END;
        IF StndTransportCostResourceRequest.FINDSET THEN BEGIN
          REPEAT
            CreateTransportWO := FALSE;
            IF (StndTransportCostResourceRequest."Transport Type" = StndTransportCostResourceRequest."Transport Type"::Transport) AND
               (StndTransportCostResourceRequest."Transport Resource No." <> '')
            THEN BEGIN
              IF NOT TmpTransportResource.GET(StndTransportCostResourceRequest."Transport Resource No.") THEN BEGIN
                CreateTransportWO := TRUE;
                TmpTransportResource."No." := StndTransportCostResourceRequest."Transport Resource No.";
                TmpTransportResource.INSERT;
              END;
            END;
            InsertTransportCost(WorkOrder, StndTransportCostResourceRequest, CreateTransportWO);
          UNTIL StndTransportCostResourceRequest.NEXT = 0;
          TmpTransportResource.DELETEALL;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckDeleteTransportCostOnResourceChange@1100529013(NewWorkOrder@1100529000 : Record 11229279;OldWorkOrder@1100529001 : Record 11229279);
    VAR
      WorkOrder@1100529002 : Record 11229279;
      TransportCostRequestWO@1100529003 : Record 11124913;
    BEGIN
      IF (OldWorkOrder."Resource No." = '') OR (OldWorkOrder."Resource No." = NewWorkOrder."Resource No.") THEN
        EXIT;
      TransportCostRequestWO.SETRANGE("Request No.", NewWorkOrder."Source No.");
      TransportCostRequestWO.SETRANGE("Work Order No.", NewWorkOrder."No.");
      TransportCostRequestWO.SETRANGE("Created for Resource No.", OldWorkOrder."Resource No.");
      IF TransportCostRequestWO.FINDSET(TRUE) THEN BEGIN
        REPEAT
          IF TransportCostRequestWO."Created Transport Work Order" <> '' THEN BEGIN
            IF WorkOrder.GET(TransportCostRequestWO."Created Transport Work Order") THEN BEGIN
              IF (NOT WorkOrder.Finished) AND (WorkOrder."Resource Type" = "Resource Type"::Plant) AND (WorkOrder."Resource No." <> '') THEN
                WorkOrder.DELETE(TRUE);
            END;
          END;
          TransportCostRequestWO.DELETE(TRUE);
        UNTIL TransportCostRequestWO.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE InsertTransportCost@1100529017(WorkOrder@1100529002 : Record 11229279;StndTransportCostResourceRequest@1100529000 : Record 11124912;CreateTransportWO@1100529004 : Boolean);
    VAR
      TransportCostRequestWO@1100529001 : Record 11124913;
      TransportWorkOrderNo@1100529003 : Code[20];
    BEGIN
      TransportCostRequestWO.INIT;
      TransportCostRequestWO."Request No." := WorkOrder."Source No.";
      TransportCostRequestWO."Work Order No." := WorkOrder."No.";
      TransportCostRequestWO."Line No." := 0;
      TransportCostRequestWO."Cost Object" := StndTransportCostResourceRequest."Cost Object";
      TransportCostRequestWO.Description := StndTransportCostResourceRequest.Description;
      TransportCostRequestWO.Quantity := StndTransportCostResourceRequest.Quantity;
      TransportCostRequestWO."Unit of Measure" := StndTransportCostResourceRequest."Unit of Measure";
      TransportCostRequestWO."Unit Price" := StndTransportCostResourceRequest."Unit Price";
      TransportCostRequestWO.Amount := StndTransportCostResourceRequest.Amount;
      TransportCostRequestWO.INSERT(TRUE);
      IF (StndTransportCostResourceRequest."Transport Type" = StndTransportCostResourceRequest."Transport Type"::Transport) AND
         (StndTransportCostResourceRequest."Transport Resource No." <> '') AND CreateTransportWO
      THEN
        TransportWorkOrderNo := InsertTransportWorkorder(WorkOrder, StndTransportCostResourceRequest."Transport Resource No.");
      TransportCostRequestWO."Created for Resource No." := "Resource No.";
      TransportCostRequestWO."Created Transport Work Order" := TransportWorkOrderNo;
      TransportCostRequestWO.MODIFY;
    END;

    LOCAL PROCEDURE InsertTransportWorkorder@1100529018(WorkOrder@1100529000 : Record 11229279;TransportResourceNo@1100529002 : Code[20]) : Code[20];
    VAR
      TransportWorkOrder@1100529001 : Record 11229279;
      Resource@1100529003 : Record 11229278;
      ResourceGroup@1100529004 : Record 11229384;
      ResourceGroupNo@1100529005 : Code[20];
    BEGIN
      IF TransportResourceNo = '' THEN
        EXIT;
      IF NOT Resource.GET(TransportResourceNo) THEN
        EXIT;
      IF Resource.Type <> Resource.Type::Plant THEN
        EXIT;
      ResourceGroup.SETCURRENTKEY(Type, Company, "Source No.");
      ResourceGroup.SETRANGE(Type, ResourceGroup.Type::Plant);
      ResourceGroup.SETRANGE(Company, Resource.Company);
      ResourceGroup.SETRANGE("Source No.", Resource."Source No.");
      IF ResourceGroup.FINDFIRST THEN
        ResourceGroupNo := ResourceGroup."No.";

      TransportWorkOrder.INIT;
      TransportWorkOrder.SetSkipAddLinkedResources(TRUE);
      TransportWorkOrder."No." := '';
      TransportWorkOrder."Source Company" := WorkOrder."Source Company";
      TransportWorkOrder.VALIDATE("Source Type", WorkOrder."Source Type");
      TransportWorkOrder.VALIDATE("Source No.", WorkOrder."Source No.");
      TransportWorkOrder."Ending Date/Time" := 0DT;
      TransportWorkOrder.VALIDATE("Starting Date/Time", WorkOrder."Starting Date/Time");
      TransportWorkOrder.VALIDATE("Ending Date/Time", WorkOrder."Ending Date/Time");
      TransportWorkOrder.VALIDATE("Resource Type", Resource.Type);
      TransportWorkOrder.VALIDATE("Resource No.", TransportResourceNo);
      TransportWorkOrder."Resource Group No." := ResourceGroupNo;
      TransportWorkOrder."Schedule Relation" := WorkOrder."Schedule Relation"::"Start-Start";
      IF WorkOrder."Related Work Order No." <> '' THEN
        TransportWorkOrder."Related Work Order No." := WorkOrder."Related Work Order No."
      ELSE
        TransportWorkOrder."Related Work Order No." := WorkOrder."No.";
      TransportWorkOrder.Description := WorkOrder.Description;
      TransportWorkOrder."Eventtype in Resource Planning" := WorkOrder."Eventtype in Resource Planning";
      TransportWorkOrder.INSERT(TRUE);
      EXIT(TransportWorkOrder."No.");
    END;

    PROCEDURE GetWorkorderNumberOfTransportCostLines@1100529009() : Integer;
    VAR
      TransportCostRequestWO@1100529000 : Record 11124913;
    BEGIN
      IF ("No." = '') OR ("Source Type" <> "Source Type"::Request) THEN
        EXIT(0);
      TransportCostRequestWO.SETCURRENTKEY("Work Order No.", "Line No.");
      TransportCostRequestWO.SETRANGE("Work Order No.", "No.");
      EXIT(TransportCostRequestWO.COUNT);
    END;

    PROCEDURE ShowWorkorderTransportCost@1100529010();
    VAR
      TransportCostRequestWO@1100529001 : Record 11124913;
    BEGIN
      IF ("No." = '') OR ("Source Type" <> "Source Type"::Request) THEN
        EXIT;
      TESTFIELD("Resource Type", "Resource Type"::Plant);
      TransportCostRequestWO.FILTERGROUP(2);
      TransportCostRequestWO.SETRANGE("Request No.", "Source No.");
      TransportCostRequestWO.SETRANGE("Work Order No.", "No.");
      TransportCostRequestWO.FILTERGROUP(0);
      TransportCostRequestWO."Request No." := "Source No.";
      PAGE.RUNMODAL(PAGE::"Transport Cost Request WO", TransportCostRequestWO);
    END;

    LOCAL PROCEDURE TestIfPlantInventoryLocationIsUnique@1100528627();
    VAR
      WorkOrder@1100528602 : Record 11229279;
      PlantNumber@1100528600 : Record 11012552;
      ResourceWOP@1100528601 : Record 11229278;
      FoundLocation@1100528603 : Code[10];
    BEGIN
      IF "Resource Type" <> "Resource Type"::Plant THEN
        EXIT;
      IF "Related Work Order No." = '' THEN
        EXIT;
      IF "Schedule Relation" <> "Schedule Relation"::"Start-Start" THEN
        EXIT;
      IF "Resource No." = '' THEN
        EXIT;
      IF NOT ResourceWOP.GET("Resource No.") THEN
        EXIT;
      IF ResourceWOP.Company <> PlantNumber.CURRENTCOMPANY THEN
        PlantNumber.CHANGECOMPANY(ResourceWOP.Company);
      IF PlantNumber.GET(ResourceWOP."Source No.", ResourceWOP."Source No. 2") THEN
        FoundLocation := PlantNumber.Location;
      IF FoundLocation = '' THEN
        EXIT;

      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      WorkOrder.SETRANGE("Related Work Order No.", "Related Work Order No.");
      WorkOrder.SETRANGE("Resource Type", "Resource Type");
      WorkOrder.SETRANGE("Schedule Relation", WorkOrder."Schedule Relation"::"Start-Start");
      WorkOrder.SETFILTER("No.", '<>%1', "No.");
      IF WorkOrder.FINDSET THEN
        REPEAT
          IF ResourceWOP.GET(WorkOrder."Resource No.") THEN BEGIN
            IF ResourceWOP.Company <> PlantNumber.CURRENTCOMPANY THEN
              PlantNumber.CHANGECOMPANY(ResourceWOP.Company);
            IF PlantNumber.GET(ResourceWOP."Source No.", ResourceWOP."Source No. 2") THEN
              IF (PlantNumber.Location <> '') AND (PlantNumber.Location <> FoundLocation) THEN
                ERROR(Text027, "No.");
          END;
        UNTIL WorkOrder.NEXT = 0;
    END;

    LOCAL PROCEDURE CheckSignatureMandatory@1100527202();
    VAR
      ResourceRequest@1100527200 : Record 11124901;
    BEGIN
      IF "Source Type" = "Source Type"::Request THEN
        IF ResourceRequest.GET("Source No.") THEN
          IF ResourceRequest."Source Type" = ResourceRequest."Source Type"::Customer THEN
            "Signature Mandatory" := TRUE;
    END;

    PROCEDURE DetermineCustomerNameByNo@1100528629();
    VAR
      Customer@1100528600 : Record 18;
    BEGIN
      "Customer Name" := '';
      IF "Customer No." = '' THEN
        EXIT;
      IF "Source Company" <> COMPANYNAME THEN
        Customer.CHANGECOMPANY("Source Company");
      IF Customer.GET("Customer No.") THEN
        "Customer Name" := Customer.Name;
    END;

    PROCEDURE DetermineExtraField@1100528630(ISource@1100528601 : Variant);
    VAR
      ServiceOrder@1100528602 : Record 11012823;
      Job@1100528603 : Record 11072003;
      ResourceRequest@1100528604 : Record 11124901;
      RecRef@1100528600 : RecordRef;
    BEGIN
      IF ISource.ISRECORD THEN
        RecRef.GETTABLE(ISource);
      CASE RecRef.NUMBER OF
        DATABASE::"Service Order":
          BEGIN
            RecRef.SETTABLE(ServiceOrder);
            "Global Dimension 1 Code" := ServiceOrder."Global Dimension 1 Code";
            "Service Contract No." := ServiceOrder."Service Contract No.";
            "Order Manager" := ServiceOrder."Order Manager";
            "Closing Date" := ServiceOrder."Closing Date";
            Address := ServiceOrder.Address;
            "Post Code" := ServiceOrder."Post Code";
            City := ServiceOrder.City;
            "Customer No." := ServiceOrder."Customer No.";
            DetermineCustomerNameByNo();
          END;
        DATABASE::Job:
          BEGIN
            RecRef.SETTABLE(Job);
            "Global Dimension 1 Code" := Job."Global Dimension 1 Code";
            Address := Job.Address;
            "Post Code" := Job."Post Code";
            City := Job.City;
            "Customer No." := Job."Bill-to Customer No.";
            DetermineCustomerNameByNo();
          END;
        DATABASE::"Resource Request":
          BEGIN
            RecRef.SETTABLE(ResourceRequest);
            Address := ResourceRequest.Address;
            "Post Code" := ResourceRequest."Post Code";
            City := ResourceRequest.City;
            IF ResourceRequest."Source No." <> '' THEN
              CASE ResourceRequest."Source Type" OF
                ResourceRequest."Source Type"::Customer:
                  "Customer No." := "Source No.";
                ResourceRequest."Source Type"::Project:
                  BEGIN
                    Job.CHANGECOMPANY("Source Company");
                    IF Job.GET(ResourceRequest."Source No.") THEN BEGIN
                      "Global Dimension 1 Code" := Job."Global Dimension 1 Code";
                      "Customer No." := Job."Bill-to Customer No.";
                    END;
                  END;
                ResourceRequest."Source Type"::ServiceOrder:
                  BEGIN
                    ServiceOrder.CHANGECOMPANY("Source Company");
                    IF ServiceOrder.GET(ResourceRequest."Source No.") THEN BEGIN
                      "Global Dimension 1 Code" := ServiceOrder."Global Dimension 1 Code";
                      "Service Contract No." := ServiceOrder."Service Contract No.";
                      "Order Manager" := ServiceOrder."Order Manager";
                      "Closing Date" := ServiceOrder."Closing Date";
                      "Customer No." := ServiceOrder."Customer No.";
                    END;
                  END;
              END;
            DetermineCustomerNameByNo();
          END;
      END;
    END;

    PROCEDURE GetNoOfDocumentsLinked@1100528631() : Integer;
    VAR
      DocumentLink@1100528600 : Record 11012747;
    BEGIN
      DocumentLink.SETCURRENTKEY("Record ID");
      DocumentLink.SETFILTER("Record ID", STRSUBSTNO('''%1''', RECORDID));
      DocumentLink.SETRANGE("Table No.", DATABASE::"Work Order");
      DocumentLink.SETRANGE("Internal Company", COMPANYNAME);
      EXIT(DocumentLink.COUNT);
    END;

    PROCEDURE DrillDownOnNoOfDocumentsLinked@1100528632();
    VAR
      DocumentFilters@1100528600 : Codeunit 11012432;
      RecRef@1100528601 : RecordRef;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentFilters.CreateTempFilterAndExecute1(RecRef, '', FALSE, FALSE);
    END;

    LOCAL PROCEDURE ReinitReferencePoint@1100528638();
    VAR
      WorkOrderPlanningSetup@1100528600 : Record 11229277;
    BEGIN
      WorkOrderPlanningSetup.GET;
      IF NOT WorkOrderPlanningSetup."Reinit Ref. Point after Replan" THEN
        EXIT;
      IF ((xRec."Starting Date/Time" <> 0DT) AND (xRec."Starting Date/Time" <> "Starting Date/Time")) OR
         ((xRec."Ending Date/Time" <> 0DT) AND (xRec."Ending Date/Time" <> "Ending Date/Time"))
      THEN BEGIN
        "Actual Field Service Status" := '';
        VALIDATE("Export to FSA", FALSE);
      END;
    END;

    LOCAL PROCEDURE ValidateExportToCCA@1100526200();
    VAR
      Resource@1100528103 : Record 11229278;
      AppUser@1100526201 : Record 11130031;
      CCAAppSetup@1100526000 : Record 11128520;
      AppUserSetupGAP@1100526001 : Record 11124976;
      CCAUserSetupGAP@1100526002 : Record 11124978;
    BEGIN
      // Do not use .MODIFY .INSERT or .DELETE in this function otherwise ExportFromGRPtoFSA will fail!
      IF "Export to FSA" THEN BEGIN
        TESTFIELD("Resource Type", "Resource Type"::Employee);
        TESTFIELD("Resource No.");
        CCAAppSetup.GET;
        IF CCAAppSetup."Use Generic User Management" THEN BEGIN
          AppUserSetupGAP.SETRANGE("Resource No.", "Resource No.");
          IF AppUserSetupGAP.FINDFIRST THEN BEGIN
            CCAUserSetupGAP.SETRANGE(Username,AppUserSetupGAP.Username);
            IF CCAUserSetupGAP.ISEMPTY THEN
              ERROR(Text028, "Source Type"::Request)
            ELSE IF  CCAUserSetupGAP.Active = CCAUserSetupGAP.Active::No THEN
              ERROR(Text028, "Source Type"::Request);
          END;
        END ELSE BEGIN
          Resource.GET("Resource No.");
          Resource.TESTFIELD("Active in CCA", TRUE);
          AppUser.SETRANGE("Resource No.", Resource."No.");
          AppUser.SETRANGE(Active, TRUE);
          IF NOT AppUser.FINDFIRST THEN
            ERROR(Text028, "Source Type"::Request);
        END;
        CheckPlanDataFSA;
        CheckReferencePoint(TRUE);
        "Actual Field Service Status" := '';
        GetExportReferencePoint();  // 15
      END ELSE
        GetInitialReferencePoint();  // 10
    END;

    PROCEDURE SetSkipCheckOnBlockModifyDuringRemoval@1100528402();
    BEGIN
      SkipCheckOnBlockModifyDuringRemoval := TRUE;
    END;

    PROCEDURE SetSkipOnModifyServiceOrders@1100525019();
    BEGIN
      SkipOnModifyServiceOrders := TRUE;
    END;

    LOCAL PROCEDURE UpdateDateTimeForAdviceOrder@1100528500();
    VAR
      AdviceOrderLine@1100528500 : Record 11012055;
      iReceiptDate@1100525000 : Date;
    BEGIN
      AdviceOrderLine.SETRANGE("Service Order No.", "Source No.");
      AdviceOrderLine.SETRANGE("Work Order No.", "No.");
      IF AdviceOrderLine.FINDFIRST THEN BEGIN
        IF DT2DATE("Starting Date/Time") > 0D THEN
          IF AdviceOrderLine."Cost Type" = AdviceOrderLine."Cost Type"::Subcontracting THEN
            iReceiptDate := DT2DATE("Starting Date/Time")
          ELSE
            iReceiptDate := DT2DATE("Starting Date/Time") - 1;
        IF iReceiptDate < TODAY THEN
          iReceiptDate := TODAY;
        IF iReceiptDate <> AdviceOrderLine."Receipt Date" THEN
          AdviceOrderLine.VALIDATE("Receipt Date", iReceiptDate);
        AdviceOrderLine.MODIFY(TRUE);
      END;
    END;

    PROCEDURE ShowReferencePeriods@1100528501();
    VAR
      ReferencePeriodsService@1100528500 : Page 11020670;
    BEGIN
      TESTFIELD("No.");

      ReferencePeriodsService.SetWorkOrderNo("No.");
      ReferencePeriodsService.RUNMODAL;
    END;

    LOCAL PROCEDURE CheckNumberOfWorkOrders@1100527350() : Boolean;
    VAR
      WorkOrder@1100527350 : Record 11229279;
    BEGIN
      WorkOrder.SETRANGE("Source Company", "Source Company");
      WorkOrder.SETRANGE("Source Type", "Source Type");
      WorkOrder.SETRANGE("Source No.", "Source No.");
      IF WorkOrder.COUNT > 1 THEN
        EXIT(TRUE)
      ELSE
        EXIT(FALSE);
    END;

    LOCAL PROCEDURE CheckPlanPeriod@1100527356();
    VAR
      DateTimeNotification1@1100527350 : Notification;
      FirstPossibleStartingDate@1100527358 : Date;
      FirstPossibleStartingTime@1100527357 : Time;
      LastPossibleEndingDate@1100527356 : Date;
      LastPossibleEndingTime@1100527355 : Time;
      StartingDate@1100527354 : Date;
      StartingTime@1100527353 : Time;
      EndingDate@1100527352 : Date;
      EndingTime@1100527351 : Time;
      DateTimeNotification2@1100527359 : Notification;
    BEGIN
      FillSeparateDateAndTimeFields(FirstPossibleStartingDate, FirstPossibleStartingTime, LastPossibleEndingDate,
                                    LastPossibleEndingTime, StartingDate, StartingTime, EndingDate, EndingTime);

      DateTimeNotification1.ID := '00000000-0000-0000-0000-000000000001';
      DateTimeNotification2.ID := '00000000-0000-0000-0000-000000000002';

      IF ((StartingDate < FirstPossibleStartingDate) AND (StartingDate <> 0D) AND (FirstPossibleStartingDate <> 0D)) OR
         ((StartingDate > LastPossibleEndingDate) AND (StartingDate <> 0D) AND (LastPossibleEndingDate <> 0D)) THEN
        DateTimeNotification1.MESSAGE(Text036 + ' ' + STRSUBSTNO(Text025, Text037, Text038))
      ELSE BEGIN
        IF (StartingDate = FirstPossibleStartingDate) AND (StartingTime < FirstPossibleStartingTime) AND
           (StartingTime <> 0T) AND (FirstPossibleStartingTime <> 0T) THEN
          DateTimeNotification1.MESSAGE(Text031 + ' ' + STRSUBSTNO(Text035, Text033))
        ELSE
          DateTimeNotification1.RECALL;
      END;

      IF DateTimeNotification1.MESSAGE <> '' THEN
        DateTimeNotification1.SEND;

      IF ((EndingDate > LastPossibleEndingDate) AND (LastPossibleEndingDate <> 0D) AND (EndingDate <> 0D)) OR
         ((EndingDate < FirstPossibleStartingDate) AND (EndingDate <> 0D) AND (FirstPossibleStartingDate <> 0D)) THEN
        DateTimeNotification2.MESSAGE(Text039 + ' ' + STRSUBSTNO(Text025, Text037, Text038))
      ELSE BEGIN
        IF (EndingDate = LastPossibleEndingDate) AND (EndingTime > LastPossibleEndingTime) AND
           (EndingTime <> 0T) AND (LastPossibleEndingTime <> 0T) THEN
          DateTimeNotification2.MESSAGE(Text032 + ' ' + STRSUBSTNO(Text024, Text034))
        ELSE
          DateTimeNotification2.RECALL;
      END;

      IF DateTimeNotification2.MESSAGE <> '' THEN
        DateTimeNotification2.SEND;

      IF (StartingDate = 0D) AND (EndingDate = 0D) THEN BEGIN
        DateTimeNotification1.RECALL;
        DateTimeNotification2.RECALL;
      END;
    END;

    PROCEDURE CheckPlanningIsBlocked@1100527351(ValidationField2@1100527350 : 'FirstPossibleStartingDateTime,FirstPossibleStartingDate,FirstPossibleStartingTime,LastPossibleEndingDateTime,LastPossibleEndingDate,LastPossibleEndingTime,StartingDateTime,StartingDate,StartingTime,EndingDateTime,EndingDate,EndingTime';VAR FirstPossibleStartingDate@1100527366 : Date;VAR FirstPossibleStartingTime@1100527357 : Time;VAR LastPossibleEndingDate@1100527356 : Date;VAR LastPossibleEndingTime@1100527355 : Time;VAR StartingDate@1100527354 : Date;VAR StartingTime@1100527353 : Time);
    VAR
      FirstPossibleStartingDate2@1100527365 : Date;
      FirstPossibleStartingTime2@1100527364 : Time;
      LastPossibleEndingDate2@1100527363 : Date;
      LastPossibleEndingTime2@1100527362 : Time;
      StartingDate2@1100527361 : Date;
      StartingTime2@1100527360 : Time;
      EndingDate2@1100527359 : Date;
      EndingTime2@1100527358 : Time;
    BEGIN
      IF "Actual Reference Point" = 0 THEN
        EXIT;
      FillSeparateDateAndTimeFields(FirstPossibleStartingDate2, FirstPossibleStartingTime2, LastPossibleEndingDate2,
            LastPossibleEndingTime2, StartingDate2, StartingTime2, EndingDate2, EndingTime2);

      CASE ValidationField2 OF
        ValidationField2::FirstPossibleStartingDate:
          IF FirstPossibleStartingDate = FirstPossibleStartingDate2 THEN
            EXIT;
        ValidationField2::FirstPossibleStartingTime:
          IF FirstPossibleStartingTime = FirstPossibleStartingTime2 THEN
            EXIT;
        ValidationField2::LastPossibleEndingDate:
          IF LastPossibleEndingDate = LastPossibleEndingDate2 THEN
            EXIT;
        ValidationField2::LastPossibleEndingTime:
          IF LastPossibleEndingTime = LastPossibleEndingTime2 THEN
            EXIT;
        ValidationField2::StartingDate:
          IF StartingDate = StartingDate2 THEN
            EXIT;
        ValidationField2::StartingTime:
          IF StartingTime = StartingTime2 THEN
            EXIT;
      END;

      IF CheckReferencePoint(FALSE) THEN
        EXIT;

      CASE ValidationField2 OF
        ValidationField2::FirstPossibleStartingDate:
          ERROR(Text037 + ' ' + Text002);
        ValidationField2::FirstPossibleStartingTime:
          ERROR(Text033 + ' ' + Text002);
        ValidationField2::LastPossibleEndingDate:
          ERROR(Text038 + ' ' + Text002);
        ValidationField2::LastPossibleEndingTime:
          ERROR(Text034 + ' ' + Text002);
        ValidationField2::StartingDate:
          ERROR(Text036 + ' ' + Text002);
        ValidationField2::StartingTime:
          ERROR(Text031 + ' ' + Text002);
      END;
    END;

    BEGIN
    {
      160105 ITERO.SB Added function to fill order manager and assigned to
      180924 ORANGO.DL Feature #19381, add last 5char of ServiceOrderNo to Workorder-description
    }
    END.
  }
}

