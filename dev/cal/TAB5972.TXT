OBJECT Table 5972 Contract/Service Discount
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Contract Type,Contract No.;
    OnInsert=BEGIN
               TESTFIELD("Contract No.");
               IF "Contract Type" = "Contract Type"::Contract THEN BEGIN
                 VerifyContractOpen;
                 ServMgtSetup.GET;
                 IF ServMgtSetup."Register Contract Changes" THEN
                   ContractChangeLog.LogContractChange(
                     "Contract No.",2,STRSUBSTNO('%1 %2 %3',Type,"No.",FIELDCAPTION("No.")),1,
                     '',FORMAT("No."),'',0);
               END;
             END;

    OnModify=BEGIN
               IF "Contract Type" = "Contract Type"::Contract THEN BEGIN
                 VerifyContractOpen;
                 ServMgtSetup.GET;
                 IF "Discount %" <> xRec."Discount %" THEN
                   IF ServMgtSetup."Register Contract Changes" THEN
                     ContractChangeLog.LogContractChange(
                       "Contract No.",2,STRSUBSTNO('%1 %2 %3',Type,"No.",FIELDCAPTION("Discount %")),0,
                       FORMAT(xRec."Discount %"),FORMAT("Discount %"),'',0);
               END;
             END;

    OnDelete=BEGIN
               IF "Contract Type" = "Contract Type"::Contract THEN BEGIN
                 VerifyContractOpen;
                 ServMgtSetup.GET;
                 IF ServMgtSetup."Register Contract Changes" THEN
                   ContractChangeLog.LogContractChange(
                     "Contract No.",2,STRSUBSTNO('%1 %2 %3',Type,"No.",FIELDCAPTION("No.")),2,
                     FORMAT("No."),'','',0);
               END;
             END;

    OnRename=BEGIN
               ERROR(Text000);
             END;

    CaptionML=[ENU=Contract/Service Discount;
               NOR=Kontrakt-/servicerabatt];
    LookupPageID=Page6058;
  }
  FIELDS
  {
    { 1   ;   ;Contract Type       ;Option        ;CaptionML=[ENU=Contract Type;
                                                              NOR=Kontrakttype;
                                                              SVE=Kontraktstyp];
                                                   OptionCaptionML=[ENU=Quote,Contract,Template;
                                                                    NOR=Tilbud,Kontrakt,Mal];
                                                   OptionString=Quote,Contract,Template }
    { 2   ;   ;Contract No.        ;Code20        ;TableRelation=IF (Contract Type=CONST(Template)) "Service Contract Template".No.
                                                                 ELSE IF (Contract Type=CONST(Contract)) "Service Contract Header"."Contract No." WHERE (Contract Type=CONST(Contract))
                                                                 ELSE IF (Contract Type=CONST(Quote)) "Service Contract Header"."Contract No." WHERE (Contract Type=CONST(Quote));
                                                   CaptionML=[ENU=Contract No.;
                                                              NOR=Kontraktnr.;
                                                              SVE=Kontraktsnr] }
    { 4   ;   ;Type                ;Option        ;CaptionML=[ENU=Type;
                                                              NOR=Type;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=[ENU=Service Item Group,Resource Group,Cost;
                                                                    NOR=Servicevaregruppe,Ressursgruppe,Kost];
                                                   OptionString=Service Item Group,Resource Group,Cost }
    { 5   ;   ;No.                 ;Code20        ;TableRelation=IF (Type=CONST(Service Item Group)) "Service Item Group".Code
                                                                 ELSE IF (Type=CONST(Resource Group)) "Resource Group".No.
                                                                 ELSE IF (Type=CONST(Cost)) "Service Cost".Code;
                                                   TestTableRelation=Yes;
                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr.;
                                                              SVE=Nr] }
    { 6   ;   ;Starting Date       ;Date          ;CaptionML=[ENU=Starting Date;
                                                              NOR=Startdato;
                                                              SVE=Startdatum] }
    { 7   ;   ;Discount %          ;Decimal       ;CaptionML=[ENU=Discount %;
                                                              NOR=Rabatt-%;
                                                              SVE=Rabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
  }
  KEYS
  {
    {    ;Contract Type,Contract No.,Type,No.,Starting Date;
                                                   Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=You cannot rename the record.;NOR=Du kan ikke gi posten et nytt navn.';
      ContractChangeLog@1001 : Record 5967;
      ServMgtSetup@1002 : Record 5911;

    LOCAL PROCEDURE VerifyContractOpen@1();
    VAR
      ServiceContractHeader@1000 : Record 5965;
    BEGIN
      ServiceContractHeader.GET("Contract Type","Contract No.");
      ServiceContractHeader.TESTFIELD("Change Status",ServiceContractHeader."Change Status"::Open);
    END;

    BEGIN
    END.
  }
}

