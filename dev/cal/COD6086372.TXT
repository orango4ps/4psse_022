OBJECT Codeunit 6086372 EM Workflow Setup
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=EMW19.00.00.2.50;
  }
  PROPERTIES
  {
    EventSubscriberInstance=Static-Automatic;
    OnRun=VAR
            WorkflowSetup@1160040000 : Codeunit 1502;
          BEGIN
            DeleteExistingTemplates;
            WorkflowSetup.InitWorkflow;
            InitWorkflow;
          END;

  }
  CODE
  {
    VAR
      ApprovalRequestCanceledMsg@1010 : TextConst 'DEU=Die Genehmigungsanforderung fÅr den Datensatz wurde storniert.;ENU=The approval request for the record has been canceled.;NLD=Het goedkeuringsverzoek voor het record is geannuleerd.;NOR=Godkjenningsforespõrselen for posten er annullert.;SVE=GodkÑnnandebegÑran fîr posten har avbrutits.';
      ExpMgmtCategoryDescTxt@1001 : TextConst 'DEU=Continia Expense Management;ENU=Continia Expense Management;NLD=Continia Expense Management';
      InvalidEventCondErr@1011 : TextConst 'DEU=Es sind keine Ereignisbedingungen angegeben.;ENU=No event conditions are specified.;NLD=Er zijn geen eventcondities opgegeven.;NOR=Ingen vilkÜr for hendelse er angitt.;SVE=Inga hÑndelsevillkor har angetts.';
      PendingApprovalsCondnTxt@1013 : TextConst 'DEU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Approval Entry"">%1</DataItem></DataItems></ReportParameters>";ENU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Approval Entry"">%1</DataItem></DataItems></ReportParameters>";NLD="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Approval Entry"">%1</DataItem></DataItems></ReportParameters>";NOR="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Approval Entry"">%1</DataItem></DataItems></ReportParameters>";SVE="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Approval Entry"">%1</DataItem></DataItems></ReportParameters>"';
      ExpenseTypeCondnTxt@1012 : TextConst 'DEU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Expense"">%1</DataItem></DataItems></ReportParameters>";ENU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Expense"">%1</DataItem></DataItems></ReportParameters>";NLD="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Expense"">%1</DataItem></DataItems></ReportParameters>"';
      MileageTypeCondnTxt@1005 : TextConst 'DEU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Mileage"">%1</DataItem></DataItems></ReportParameters>";ENU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Mileage"">%1</DataItem></DataItems></ReportParameters>";NLD="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Mileage"">%1</DataItem></DataItems></ReportParameters>"';
      SettlementTypeCondnTxt@1000 : TextConst 'DEU=Kilometerleistung Ablehnung Workflow erzwingen;ENU="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Settlement"">%1</DataItem></DataItems></ReportParameters>";NLD="<?xml version=""1.0"" encoding=""utf-8"" standalone=""yes""?><ReportParameters><DataItems><DataItem name=""Settlement"">%1</DataItem></DataItems></ReportParameters>"';
      ExpenseApprWorkflowDescTxt@1002 : TextConst 'DEU=Kostenposition Genehmigung Workflow;ENU=Expense Approval Workflow;NLD=Uitgavegoedkeuringsworkflow';
      WorkflowEventHandling@1008 : Codeunit 1520;
      EMWorkflowEventHandling@1019 : Codeunit 6086370;
      EMWorkflowResponseHandling@1020 : Codeunit 6086371;
      DCWorkflowEventHandling@1014 : Codeunit 6085785;
      DCWorkflowResponseHandling@1015 : Codeunit 6085786;
      WorkflowResponseHandling@1009 : Codeunit 1521;
      BlankDateFormula@1007 : DateFormula;
      ExpenseForceApprWorkflowDescTxt@1017 : TextConst 'DEU=Kostenposition Genehmigung Workflow erzwingen;ENU=Expense Force Approval Workflow;NLD=Uitgave geforceerde goedkeuringsworkflow';
      MileageApprWorkflowDescTxt@1004 : TextConst 'DEU=Kilometerleistung Genehmigung Workflow;ENU=Mileage Approval Workflow;NLD=Kilometragegoedkeuringsworkflow';
      MileageForceApprWorkflowDescTxt@1003 : TextConst 'DEU=Kilometerleistung Genehmigung Workflow erzwingen;ENU=Mileage Force Approval Workflow;NLD=Kilometrage geforceerde goedkeuringsworkflow';
      SettlementApprWorkflowDescTxt@1016 : TextConst 'DEU=Ausgleichsgenehmigungsworkflow;ENU=Settlement Approval Workflow;NLD=Afrekeninggoedkeuringsworkflow';
      SettlementForceApprWorkflowDescTxt@1006 : TextConst 'DEU=Asugleich erzwungener Genehmigungsworkflow;ENU=Settlement Force Approval Workflow;NLD=Afrekening geforceerde goedkeuringsworkflow';

    PROCEDURE InitWorkflow@23();
    BEGIN
      InsertWorkflowCategories;
      InsertWorkflowTemplates;
    END;

    LOCAL PROCEDURE InsertEntryPointEventStep@51(Workflow@1000 : Record 1501;FunctionName@1001 : Code[128]) : Integer;
    VAR
      WorkflowStep@1003 : Record 1502;
    BEGIN
      InsertStep(WorkflowStep,Workflow.Code,WorkflowStep.Type::"Event",FunctionName);
      WorkflowStep.VALIDATE("Entry Point",TRUE);
      WorkflowStep.MODIFY(TRUE);
      EXIT(WorkflowStep.ID);
    END;

    PROCEDURE InsertWorkflowCategories@126();
    BEGIN
      InsertWorkflowCategory('CONTINIAEM',ExpMgmtCategoryDescTxt);
    END;

    LOCAL PROCEDURE InsertWorkflowCategory@118(Code@1000 : Code[20];Description@1001 : Text[100]);
    VAR
      WorkflowCategory@1002 : Record 1508;
    BEGIN
      WorkflowCategory.INIT;
      WorkflowCategory.Code := Code;
      WorkflowCategory.Description := Description;
      IF WorkflowCategory.INSERT THEN;
    END;

    LOCAL PROCEDURE InsertWorkflowTemplates@24();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      InsertTableRelations;

      Workflow.SETRANGE(Template,TRUE);
      IF Workflow.ISEMPTY THEN
        EXIT;

      InsertExpenseApprovalWorkflowTemplate;
      InsertExpenseForceApprovalWorkflowTemplate;

      InsertMileageApprovalWorkflowTemplate;
      InsertMileageForceApprovalWorkflowTemplate;

      InsertSettlementApprovalWorkflowTemplate;
      InsertSettlementForceApprovalWorkflowTemplate;
    END;

    LOCAL PROCEDURE InsertExpenseApprovalWorkflowTemplate@2();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      IF NOT InsertWorkflowTemplate(Workflow,'EW',ExpenseApprWorkflowDescTxt,'CONTINIAEM') THEN
        EXIT;
      InsertExpenseApprovalWorkflowDetails(Workflow);
      MarkWorkflowAsTemplate(Workflow);
    END;

    LOCAL PROCEDURE InsertExpenseForceApprovalWorkflowTemplate@6();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      IF NOT InsertWorkflowTemplate(Workflow,'EFAW',ExpenseForceApprWorkflowDescTxt,'CONTINIAEM') THEN
        EXIT;
      InsertExpenseForceApprovalWorkflowDetails(Workflow);
      MarkWorkflowAsTemplate(Workflow);
    END;

    LOCAL PROCEDURE InsertMileageApprovalWorkflowTemplate@17();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      IF NOT InsertWorkflowTemplate(Workflow,'MW',MileageApprWorkflowDescTxt,'CONTINIAEM') THEN
        EXIT;
      InsertMileageApprovalWorkflowDetails(Workflow);
      MarkWorkflowAsTemplate(Workflow);
    END;

    LOCAL PROCEDURE InsertMileageForceApprovalWorkflowTemplate@16();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      IF NOT InsertWorkflowTemplate(Workflow,'MFAW',MileageForceApprWorkflowDescTxt,'CONTINIAEM') THEN
        EXIT;
      InsertMileageForceApprovalWorkflowDetails(Workflow);
      MarkWorkflowAsTemplate(Workflow);
    END;

    LOCAL PROCEDURE InsertSettlementApprovalWorkflowTemplate@10();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      IF NOT InsertWorkflowTemplate(Workflow,'SW',SettlementApprWorkflowDescTxt,'CONTINIAEM') THEN
        EXIT;
      InsertSettlementApprovalWorkflowDetails(Workflow);
      MarkWorkflowAsTemplate(Workflow);
    END;

    LOCAL PROCEDURE InsertSettlementForceApprovalWorkflowTemplate@1();
    VAR
      Workflow@1000 : Record 1501;
    BEGIN
      IF NOT InsertWorkflowTemplate(Workflow,'SFAW',SettlementForceApprWorkflowDescTxt,'CONTINIAEM') THEN
        EXIT;
      InsertSettlementForceApprovalWorkflowDetails(Workflow);
      MarkWorkflowAsTemplate(Workflow);
    END;

    LOCAL PROCEDURE InsertWorkflowTemplate@52(VAR Workflow@1003 : Record 1501;WorkflowCode@1001 : Code[17];WorkflowDescription@1002 : Text[100];CategoryCode@1000 : Code[20]) : Boolean;
    BEGIN
      Workflow.INIT;
      Workflow.Code := GetWorkflowTemplateCode(WorkflowCode);
      Workflow.Description := WorkflowDescription;
      Workflow.Category := CategoryCode;
      Workflow.Enabled := FALSE;
      EXIT(Workflow.INSERT);
    END;

    LOCAL PROCEDURE InsertExpenseApprovalWorkflowDetails@91(VAR Workflow@1001 : Record 1501);
    VAR
      Expense@1000 : Record 6086320;
      WorkflowStepArgument@1003 : Record 1523;
    BEGIN
      PopulateWorkflowStepArgument(WorkflowStepArgument,
        WorkflowStepArgument."Approver Type"::Approver,WorkflowStepArgument."Approver Limit Type"::"Approver Chain",
        0,'',BlankDateFormula,TRUE);

      InsertExpenseApprovalWorkflowSteps(Workflow,
        BuildExpenseTypeConditions(Expense.Status::Open),
        EMWorkflowEventHandling.RunWorkflowOnSendExpenseForApprovalCode,
        BuildExpenseTypeConditions(Expense.Status::"Pending Approval"),
        EMWorkflowEventHandling.RunWorkflowOnCancelExpenseApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnSendBackApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnApproveAndDelegateRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnDelegateWithoutApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnDelegateAndSendBackRequestCode,
        WorkflowStepArgument,TRUE);
    END;

    LOCAL PROCEDURE InsertExpenseForceApprovalWorkflowDetails@8(VAR Workflow@1001 : Record 1501);
    VAR
      Expense@1000 : Record 6086320;
    BEGIN
      InsertExpenseForceApprovalWorkflowSteps(Workflow);
    END;

    PROCEDURE InsertExpenseApprovalWorkflowSteps@7(Workflow@1003 : Record 1501;DocSendForApprovalConditionString@1006 : Text;DocSendForApprovalEventCode@1001 : Code[128];DocCanceledConditionString@1009 : Text;DocCanceledEventCode@1004 : Code[128];DocSendBackEventCode@1007 : Code[128];DocDelegatedWithApprovalEventCode@1021 : Code[128];DocDelegatedWithoutApprovalEventCode@1024 : Code[128];DocDelegatedAndSendBackEventCode@1027 : Code[128];WorkflowStepArgument@1000 : Record 1523;ShowConfirmationMessage@1019 : Boolean);
    VAR
      SentForApprovalEventID@1010 : Integer;
      SetStatusToPendingApprovalResponseID@1002 : Integer;
      CreateApprovalRequestResponseID@1012 : Integer;
      SendApprovalRequestResponseID@1013 : Integer;
      "-- Pending Approvals : 0"@1045 : Integer;
      OnAllRequestsApprovedEventID@1014 : Integer;
      OnAfterApproveResponseID@1047 : Integer;
      "-- Pending Approvals > 0"@1046 : Integer;
      OnRequestApprovedEventID@1016 : Integer;
      OnAfterApproveResponseID2@1048 : Integer;
      SendApprovalRequestResponseID2@1017 : Integer;
      OnRequestRejectedEventID@1018 : Integer;
      RejectAllApprovalsResponseID@1020 : Integer;
      "-- Send Back"@1030 : Integer;
      OnSendBackEventID@1028 : Integer;
      SendBackResponseID@1029 : Integer;
      OpenApprovalCommentsResponseID@1031 : Integer;
      ReturnToInitialStateID1@1032 : Integer;
      "-- DelegateAndSendBack"@1033 : Integer;
      OnDelegateAndSendBackEventID@1034 : Integer;
      DelegateAndSendBackRepsponseID@1036 : Integer;
      ReturnToInitialStateID2@1037 : Integer;
      "-- Cancel Request"@1035 : Integer;
      OnRequestCanceledEventID@1022 : Integer;
      CancelAllApprovalsResponseID@1023 : Integer;
      "-- Approve And Delegate"@1038 : Integer;
      OnApproveAndDelegateEventID@1039 : Integer;
      ApproveAndDelegateResponseID@1040 : Integer;
      SendApprovalRequestResponseID4@1041 : Integer;
      ReturnToInitialStateID3@1042 : Integer;
      "-- Delegate Without Approval"@1043 : Integer;
      OnRequestDelegatedEventID@1025 : Integer;
      SentApprovalRequestResponseID3@1026 : Integer;
      ReturnToInitialStateID4@1044 : Integer;
      RestrictRecordUsageResponseID@1005 : Integer;
      AllowRecordUsageResponseID@1008 : Integer;
      OpenDocumentResponceID@1011 : Integer;
      ShowMessageResponseID@1015 : Integer;
    BEGIN
      SentForApprovalEventID := InsertEntryPointEventStep(Workflow,DocSendForApprovalEventCode);
      InsertEventArgument(SentForApprovalEventID,DocSendForApprovalConditionString);
        RestrictRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.RestrictRecordUsageCode,SentForApprovalEventID);
        SetStatusToPendingApprovalResponseID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.SetExpenseStatusToPendingApprovalCode,RestrictRecordUsageResponseID);
        CreateApprovalRequestResponseID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.CreateApprovalRequestEMCode,SetStatusToPendingApprovalResponseID);
        InsertApprovalArgument(CreateApprovalRequestResponseID,
          WorkflowStepArgument."Approver Type",WorkflowStepArgument."Approver Limit Type",
          WorkflowStepArgument."Workflow User Group Code",WorkflowStepArgument."Due Date Formula",ShowConfirmationMessage);
        SendApprovalRequestResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,CreateApprovalRequestResponseID);
        InsertNotificationArgument(SendApprovalRequestResponseID,'',0,'');

      OnAllRequestsApprovedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnApproveApprovalRequestCode,SendApprovalRequestResponseID);
      InsertEventArgument(OnAllRequestsApprovedEventID,BuildNoPendingApprovalsConditions);
        AllowRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.AllowRecordUsageCode,OnAllRequestsApprovedEventID);
        InsertResponseStep(Workflow,EMWorkflowResponseHandling.SetExpenseStatusToApprovedCode,AllowRecordUsageResponseID);

      OnRequestApprovedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnApproveApprovalRequestCode,SendApprovalRequestResponseID);
      InsertEventArgument(OnRequestApprovedEventID,BuildPendingApprovalsConditions);
        SendApprovalRequestResponseID2 := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,OnRequestApprovedEventID);
        SetNextStep(Workflow,SendApprovalRequestResponseID2,SendApprovalRequestResponseID);

      OnRequestRejectedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnRejectApprovalRequestCode,SendApprovalRequestResponseID);
        RejectAllApprovalsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.RejectAllApprovalRequestsCode,OnRequestRejectedEventID);
        InsertNotificationArgument(RejectAllApprovalsResponseID,'',WorkflowStepArgument."Link Target Page",'');

      OnSendBackEventID := InsertEventStep(Workflow,DocSendBackEventCode,SendApprovalRequestResponseID);
        SendBackResponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.SendBackApprovalRequestDCCode,OnSendBackEventID);
        OpenApprovalCommentsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.GetApprovalCommentCode,SendBackResponseID);
        ReturnToInitialStateID1 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,OpenApprovalCommentsResponseID);

      OnDelegateAndSendBackEventID := InsertEventStep(Workflow,DocDelegatedAndSendBackEventCode,SendApprovalRequestResponseID);
        DelegateAndSendBackRepsponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.DelegateAndSendBackRequestCode,OnDelegateAndSendBackEventID);
        ReturnToInitialStateID2 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,DelegateAndSendBackRepsponseID);

      OnRequestCanceledEventID := InsertEventStep(Workflow,DocCanceledEventCode,SendApprovalRequestResponseID);
        InsertEventArgument(OnRequestCanceledEventID,DocCanceledConditionString);
        CancelAllApprovalsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.CancelAllApprovalRequestsCode,OnRequestCanceledEventID);
        InsertNotificationArgument(CancelAllApprovalsResponseID,'',WorkflowStepArgument."Link Target Page",'');
        AllowRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.AllowRecordUsageCode,CancelAllApprovalsResponseID);
        OpenDocumentResponceID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.OpenExpenseCode,AllowRecordUsageResponseID);
        // ShowMessageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.ShowMessageCode,OpenDocumentResponceID);
        // InsertMessageArgument(ShowMessageResponseID,ApprovalRequestCanceledMsg);

      OnApproveAndDelegateEventID := InsertEventStep(Workflow,DocDelegatedWithApprovalEventCode,SendApprovalRequestResponseID);
        ApproveAndDelegateResponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ApproveAndDelegateRequestCode,OnApproveAndDelegateEventID);
        SendApprovalRequestResponseID4 := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,ApproveAndDelegateResponseID);
        ReturnToInitialStateID3 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,SendApprovalRequestResponseID4);

      OnRequestDelegatedEventID := InsertEventStep(Workflow,DCWorkflowEventHandling.RunWorkflowOnDelegateWithoutApprovalRequestCode,SendApprovalRequestResponseID);
        SentApprovalRequestResponseID3 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.DelegateWithoutApprovalRequestCode,OnRequestDelegatedEventID);
        ReturnToInitialStateID4 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,SentApprovalRequestResponseID3);
    END;

    PROCEDURE InsertExpenseForceApprovalWorkflowSteps@9(Workflow@1003 : Record 1501);
    VAR
      ForceApprovalEventID@1000 : Integer;
      ForceApprovalResponseID@1001 : InStream;
    BEGIN
      ForceApprovalEventID := InsertEntryPointEventStep(Workflow,EMWorkflowEventHandling.RunWorkflowOnExpenseForceApproveApprovalRequestCode);
      InsertResponseStep(Workflow,EMWorkflowResponseHandling.ForceApproveApprovalRequestEMCode,ForceApprovalEventID);
    END;

    LOCAL PROCEDURE InsertMileageApprovalWorkflowDetails@35(VAR Workflow@1001 : Record 1501);
    VAR
      Mileage@1000 : Record 6086338;
      WorkflowStepArgument@1003 : Record 1523;
    BEGIN
      PopulateWorkflowStepArgument(WorkflowStepArgument,
        WorkflowStepArgument."Approver Type"::Approver,WorkflowStepArgument."Approver Limit Type"::"Approver Chain",
        0,'',BlankDateFormula,TRUE);

      InsertMileageApprovalWorkflowSteps(Workflow,
        BuildMileageTypeConditions(Mileage.Status::Open),
        EMWorkflowEventHandling.RunWorkflowOnSendMileageForApprovalCode,
        BuildMileageTypeConditions(Mileage.Status::"Pending Approval"),
        EMWorkflowEventHandling.RunWorkflowOnCancelMileageApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnSendBackApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnApproveAndDelegateRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnDelegateWithoutApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnDelegateAndSendBackRequestCode,
        WorkflowStepArgument,TRUE);
    END;

    LOCAL PROCEDURE InsertMileageForceApprovalWorkflowDetails@33(VAR Workflow@1001 : Record 1501);
    VAR
      Expense@1000 : Record 6086320;
    BEGIN
      InsertMileageForceApprovalWorkflowSteps(Workflow);
    END;

    PROCEDURE InsertMileageApprovalWorkflowSteps@31(Workflow@1003 : Record 1501;DocSendForApprovalConditionString@1006 : Text;DocSendForApprovalEventCode@1001 : Code[128];DocCanceledConditionString@1009 : Text;DocCanceledEventCode@1004 : Code[128];DocSendBackEventCode@1007 : Code[128];DocDelegatedWithApprovalEventCode@1021 : Code[128];DocDelegatedWithoutApprovalEventCode@1024 : Code[128];DocDelegatedAndSendBackEventCode@1027 : Code[128];WorkflowStepArgument@1000 : Record 1523;ShowConfirmationMessage@1019 : Boolean);
    VAR
      SentForApprovalEventID@1010 : Integer;
      SetStatusToPendingApprovalResponseID@1002 : Integer;
      CreateApprovalRequestResponseID@1012 : Integer;
      SendApprovalRequestResponseID@1013 : Integer;
      "-- Pending Approvals : 0"@1045 : Integer;
      OnAllRequestsApprovedEventID@1014 : Integer;
      OnAfterApproveResponseID@1047 : Integer;
      "-- Pending Approvals > 0"@1046 : Integer;
      OnRequestApprovedEventID@1016 : Integer;
      OnAfterApproveResponseID2@1048 : Integer;
      SendApprovalRequestResponseID2@1017 : Integer;
      OnRequestRejectedEventID@1018 : Integer;
      RejectAllApprovalsResponseID@1020 : Integer;
      "-- Send Back"@1030 : Integer;
      OnSendBackEventID@1028 : Integer;
      SendBackResponseID@1029 : Integer;
      OpenApprovalCommentsResponseID@1031 : Integer;
      ReturnToInitialStateID1@1032 : Integer;
      "-- DelegateAndSendBack"@1033 : Integer;
      OnDelegateAndSendBackEventID@1034 : Integer;
      DelegateAndSendBackRepsponseID@1036 : Integer;
      ReturnToInitialStateID2@1037 : Integer;
      "-- Cancel Request"@1035 : Integer;
      OnRequestCanceledEventID@1022 : Integer;
      CancelAllApprovalsResponseID@1023 : Integer;
      "-- Approve And Delegate"@1038 : Integer;
      OnApproveAndDelegateEventID@1039 : Integer;
      ApproveAndDelegateResponseID@1040 : Integer;
      SendApprovalRequestResponseID4@1041 : Integer;
      ReturnToInitialStateID3@1042 : Integer;
      "-- Delegate Without Approval"@1043 : Integer;
      OnRequestDelegatedEventID@1025 : Integer;
      SentApprovalRequestResponseID3@1026 : Integer;
      ReturnToInitialStateID4@1044 : Integer;
      RestrictRecordUsageResponseID@1005 : Integer;
      AllowRecordUsageResponseID@1008 : Integer;
      OpenDocumentResponceID@1011 : Integer;
      ShowMessageResponseID@1015 : Integer;
    BEGIN
      SentForApprovalEventID := InsertEntryPointEventStep(Workflow,DocSendForApprovalEventCode);
      InsertEventArgument(SentForApprovalEventID,DocSendForApprovalConditionString);
        RestrictRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.RestrictRecordUsageCode,SentForApprovalEventID);
        SetStatusToPendingApprovalResponseID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.SetMileageStatusToPendingApprovalCode,RestrictRecordUsageResponseID);
        CreateApprovalRequestResponseID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.CreateApprovalRequestEMCode,SetStatusToPendingApprovalResponseID);
        InsertApprovalArgument(CreateApprovalRequestResponseID,
          WorkflowStepArgument."Approver Type",WorkflowStepArgument."Approver Limit Type",
          WorkflowStepArgument."Workflow User Group Code",WorkflowStepArgument."Due Date Formula",ShowConfirmationMessage);
        SendApprovalRequestResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,CreateApprovalRequestResponseID);
        InsertNotificationArgument(SendApprovalRequestResponseID,'',0,'');

      OnAllRequestsApprovedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnApproveApprovalRequestCode,SendApprovalRequestResponseID);
      InsertEventArgument(OnAllRequestsApprovedEventID,BuildNoPendingApprovalsConditions);
        AllowRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.AllowRecordUsageCode,OnAllRequestsApprovedEventID);
        InsertResponseStep(Workflow,EMWorkflowResponseHandling.SetMileageStatusToApprovedCode,AllowRecordUsageResponseID);

      OnRequestApprovedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnApproveApprovalRequestCode,SendApprovalRequestResponseID);
      InsertEventArgument(OnRequestApprovedEventID,BuildPendingApprovalsConditions);
        SendApprovalRequestResponseID2 := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,OnRequestApprovedEventID);
        SetNextStep(Workflow,SendApprovalRequestResponseID2,SendApprovalRequestResponseID);

      OnRequestRejectedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnRejectApprovalRequestCode,SendApprovalRequestResponseID);
        RejectAllApprovalsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.RejectAllApprovalRequestsCode,OnRequestRejectedEventID);
        InsertNotificationArgument(RejectAllApprovalsResponseID,'',WorkflowStepArgument."Link Target Page",'');

      OnSendBackEventID := InsertEventStep(Workflow,DocSendBackEventCode,SendApprovalRequestResponseID);
        SendBackResponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.SendBackApprovalRequestDCCode,OnSendBackEventID);
        OpenApprovalCommentsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.GetApprovalCommentCode,SendBackResponseID);
        ReturnToInitialStateID1 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,OpenApprovalCommentsResponseID);

      OnDelegateAndSendBackEventID := InsertEventStep(Workflow,DocDelegatedAndSendBackEventCode,SendApprovalRequestResponseID);
        DelegateAndSendBackRepsponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.DelegateAndSendBackRequestCode,OnDelegateAndSendBackEventID);
        ReturnToInitialStateID2 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,DelegateAndSendBackRepsponseID);

      OnRequestCanceledEventID := InsertEventStep(Workflow,DocCanceledEventCode,SendApprovalRequestResponseID);
        InsertEventArgument(OnRequestCanceledEventID,DocCanceledConditionString);
        CancelAllApprovalsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.CancelAllApprovalRequestsCode,OnRequestCanceledEventID);
        InsertNotificationArgument(CancelAllApprovalsResponseID,'',WorkflowStepArgument."Link Target Page",'');
        AllowRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.AllowRecordUsageCode,CancelAllApprovalsResponseID);
        OpenDocumentResponceID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.OpenMileageCode,AllowRecordUsageResponseID);

      OnApproveAndDelegateEventID := InsertEventStep(Workflow,DocDelegatedWithApprovalEventCode,SendApprovalRequestResponseID);
        ApproveAndDelegateResponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ApproveAndDelegateRequestCode,OnApproveAndDelegateEventID);
        SendApprovalRequestResponseID4 := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,ApproveAndDelegateResponseID);
        ReturnToInitialStateID3 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,SendApprovalRequestResponseID4);

      OnRequestDelegatedEventID := InsertEventStep(Workflow,DCWorkflowEventHandling.RunWorkflowOnDelegateWithoutApprovalRequestCode,SendApprovalRequestResponseID);
        SentApprovalRequestResponseID3 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.DelegateWithoutApprovalRequestCode,OnRequestDelegatedEventID);
        ReturnToInitialStateID4 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,SentApprovalRequestResponseID3);
    END;

    PROCEDURE InsertMileageForceApprovalWorkflowSteps@29(Workflow@1003 : Record 1501);
    VAR
      ForceApprovalEventID@1000 : Integer;
      ForceApprovalResponseID@1001 : InStream;
    BEGIN
      ForceApprovalEventID := InsertEntryPointEventStep(Workflow,EMWorkflowEventHandling.RunWorkflowOnMileageForceApproveApprovalRequestCode);
      InsertResponseStep(Workflow,EMWorkflowResponseHandling.ForceApproveApprovalRequestEMCode,ForceApprovalEventID);
    END;

    LOCAL PROCEDURE InsertSettlementApprovalWorkflowDetails@21(VAR Workflow@1001 : Record 1501);
    VAR
      ExpHeader@1000 : Record 6086339;
      WorkflowStepArgument@1003 : Record 1523;
    BEGIN
      PopulateWorkflowStepArgument(WorkflowStepArgument,
        WorkflowStepArgument."Approver Type"::Approver,WorkflowStepArgument."Approver Limit Type"::"Approver Chain",
        0,'',BlankDateFormula,TRUE);

      InsertSettlementApprovalWorkflowSteps(Workflow,
        BuildSettlementTypeConditions(ExpHeader.Status::Open),
        EMWorkflowEventHandling.RunWorkflowOnSendSettlementForApprovalCode,
        BuildSettlementTypeConditions(ExpHeader.Status::"Pending Approval"),
        EMWorkflowEventHandling.RunWorkflowOnCancelSettlementApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnSendBackApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnApproveAndDelegateRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnDelegateWithoutApprovalRequestCode,
        DCWorkflowEventHandling.RunWorkflowOnDelegateAndSendBackRequestCode,
        WorkflowStepArgument,TRUE);
    END;

    LOCAL PROCEDURE InsertSettlementForceApprovalWorkflowDetails@20(VAR Workflow@1001 : Record 1501);
    VAR
      Expense@1000 : Record 6086320;
    BEGIN
      InsertSettlementForceApprovalWorkflowSteps(Workflow);
    END;

    PROCEDURE InsertSettlementApprovalWorkflowSteps@15(Workflow@1003 : Record 1501;DocSendForApprovalConditionString@1006 : Text;DocSendForApprovalEventCode@1001 : Code[128];DocCanceledConditionString@1009 : Text;DocCanceledEventCode@1004 : Code[128];DocSendBackEventCode@1007 : Code[128];DocDelegatedWithApprovalEventCode@1021 : Code[128];DocDelegatedWithoutApprovalEventCode@1024 : Code[128];DocDelegatedAndSendBackEventCode@1027 : Code[128];WorkflowStepArgument@1000 : Record 1523;ShowConfirmationMessage@1019 : Boolean);
    VAR
      SentForApprovalEventID@1010 : Integer;
      SetStatusToPendingApprovalResponseID@1002 : Integer;
      CreateApprovalRequestResponseID@1012 : Integer;
      SendApprovalRequestResponseID@1013 : Integer;
      "-- Pending Approvals : 0"@1045 : Integer;
      OnAllRequestsApprovedEventID@1014 : Integer;
      OnAfterApproveResponseID@1047 : Integer;
      "-- Pending Approvals > 0"@1046 : Integer;
      OnRequestApprovedEventID@1016 : Integer;
      OnAfterApproveResponseID2@1048 : Integer;
      SendApprovalRequestResponseID2@1017 : Integer;
      OnRequestRejectedEventID@1018 : Integer;
      RejectAllApprovalsResponseID@1020 : Integer;
      "-- Send Back"@1030 : Integer;
      OnSendBackEventID@1028 : Integer;
      SendBackResponseID@1029 : Integer;
      OpenApprovalCommentsResponseID@1031 : Integer;
      ReturnToInitialStateID1@1032 : Integer;
      "-- DelegateAndSendBack"@1033 : Integer;
      OnDelegateAndSendBackEventID@1034 : Integer;
      DelegateAndSendBackRepsponseID@1036 : Integer;
      ReturnToInitialStateID2@1037 : Integer;
      "-- Cancel Request"@1035 : Integer;
      OnRequestCanceledEventID@1022 : Integer;
      CancelAllApprovalsResponseID@1023 : Integer;
      "-- Approve And Delegate"@1038 : Integer;
      OnApproveAndDelegateEventID@1039 : Integer;
      ApproveAndDelegateResponseID@1040 : Integer;
      SendApprovalRequestResponseID4@1041 : Integer;
      ReturnToInitialStateID3@1042 : Integer;
      "-- Delegate Without Approval"@1043 : Integer;
      OnRequestDelegatedEventID@1025 : Integer;
      SentApprovalRequestResponseID3@1026 : Integer;
      ReturnToInitialStateID4@1044 : Integer;
      RestrictRecordUsageResponseID@1005 : Integer;
      AllowRecordUsageResponseID@1008 : Integer;
      OpenDocumentResponceID@1011 : Integer;
      ShowMessageResponseID@1015 : Integer;
    BEGIN
      SentForApprovalEventID := InsertEntryPointEventStep(Workflow,DocSendForApprovalEventCode);
      InsertEventArgument(SentForApprovalEventID,DocSendForApprovalConditionString);
        RestrictRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.RestrictRecordUsageCode,SentForApprovalEventID);
        SetStatusToPendingApprovalResponseID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.SetSettlementStatusToPendingApprovalCode,RestrictRecordUsageResponseID);
        CreateApprovalRequestResponseID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.CreateApprovalRequestEMCode,SetStatusToPendingApprovalResponseID);
        InsertApprovalArgument(CreateApprovalRequestResponseID,
          WorkflowStepArgument."Approver Type",WorkflowStepArgument."Approver Limit Type",
          WorkflowStepArgument."Workflow User Group Code",WorkflowStepArgument."Due Date Formula",ShowConfirmationMessage);
        SendApprovalRequestResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,CreateApprovalRequestResponseID);
        InsertNotificationArgument(SendApprovalRequestResponseID,'',0,'');

      OnAllRequestsApprovedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnApproveApprovalRequestCode,SendApprovalRequestResponseID);
      InsertEventArgument(OnAllRequestsApprovedEventID,BuildNoPendingApprovalsConditions);
        AllowRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.AllowRecordUsageCode,OnAllRequestsApprovedEventID);
        InsertResponseStep(Workflow,EMWorkflowResponseHandling.SetSettlementStatusToApprovedCode,AllowRecordUsageResponseID);

      OnRequestApprovedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnApproveApprovalRequestCode,SendApprovalRequestResponseID);
      InsertEventArgument(OnRequestApprovedEventID,BuildPendingApprovalsConditions);
        SendApprovalRequestResponseID2 := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,OnRequestApprovedEventID);
        SetNextStep(Workflow,SendApprovalRequestResponseID2,SendApprovalRequestResponseID);

      OnRequestRejectedEventID := InsertEventStep(Workflow,WorkflowEventHandling.RunWorkflowOnRejectApprovalRequestCode,SendApprovalRequestResponseID);
        RejectAllApprovalsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.RejectAllApprovalRequestsCode,OnRequestRejectedEventID);
        InsertNotificationArgument(RejectAllApprovalsResponseID,'',WorkflowStepArgument."Link Target Page",'');

      OnSendBackEventID := InsertEventStep(Workflow,DocSendBackEventCode,SendApprovalRequestResponseID);
        SendBackResponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.SendBackApprovalRequestDCCode,OnSendBackEventID);
        OpenApprovalCommentsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.GetApprovalCommentCode,SendBackResponseID);
        ReturnToInitialStateID1 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,OpenApprovalCommentsResponseID);

      OnDelegateAndSendBackEventID := InsertEventStep(Workflow,DocDelegatedAndSendBackEventCode,SendApprovalRequestResponseID);
        DelegateAndSendBackRepsponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.DelegateAndSendBackRequestCode,OnDelegateAndSendBackEventID);
        ReturnToInitialStateID2 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,DelegateAndSendBackRepsponseID);

      OnRequestCanceledEventID := InsertEventStep(Workflow,DocCanceledEventCode,SendApprovalRequestResponseID);
        InsertEventArgument(OnRequestCanceledEventID,DocCanceledConditionString);
        CancelAllApprovalsResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.CancelAllApprovalRequestsCode,OnRequestCanceledEventID);
        InsertNotificationArgument(CancelAllApprovalsResponseID,'',WorkflowStepArgument."Link Target Page",'');
        AllowRecordUsageResponseID := InsertResponseStep(Workflow,WorkflowResponseHandling.AllowRecordUsageCode,CancelAllApprovalsResponseID);
        OpenDocumentResponceID := InsertResponseStep(Workflow,EMWorkflowResponseHandling.OpenSettlementCode,AllowRecordUsageResponseID);

      OnApproveAndDelegateEventID := InsertEventStep(Workflow,DocDelegatedWithApprovalEventCode,SendApprovalRequestResponseID);
        ApproveAndDelegateResponseID := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ApproveAndDelegateRequestCode,OnApproveAndDelegateEventID);
        SendApprovalRequestResponseID4 := InsertResponseStep(Workflow,WorkflowResponseHandling.SendApprovalRequestForApprovalCode,ApproveAndDelegateResponseID);
        ReturnToInitialStateID3 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,SendApprovalRequestResponseID4);

      OnRequestDelegatedEventID := InsertEventStep(Workflow,DCWorkflowEventHandling.RunWorkflowOnDelegateWithoutApprovalRequestCode,SendApprovalRequestResponseID);
        SentApprovalRequestResponseID3 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.DelegateWithoutApprovalRequestCode,OnRequestDelegatedEventID);
        ReturnToInitialStateID4 := InsertResponseStep(Workflow,DCWorkflowResponseHandling.ReturnToInitialStateCode,SentApprovalRequestResponseID3);
    END;

    PROCEDURE InsertSettlementForceApprovalWorkflowSteps@14(Workflow@1003 : Record 1501);
    VAR
      ForceApprovalEventID@1000 : Integer;
      ForceApprovalResponseID@1001 : InStream;
    BEGIN
      ForceApprovalEventID := InsertEntryPointEventStep(Workflow,EMWorkflowEventHandling.RunWorkflowOnSettlementForceApproveApprovalRequestCode);
      InsertResponseStep(Workflow,EMWorkflowResponseHandling.ForceApproveApprovalRequestEMCode,ForceApprovalEventID);
    END;

    LOCAL PROCEDURE InsertApprovalArgument@44(WorkflowStepID@1000 : Integer;ApproverType@1009 : Option;ApproverLimitType@1010 : Option;WorkflowUserGroupCode@1002 : Code[20];DueDateFormula@1003 : DateFormula;ShowConfirmationMessage@1004 : Boolean);
    VAR
      WorkflowStepArgument@1001 : Record 1523;
    BEGIN
      InsertStepArgument(WorkflowStepArgument,WorkflowStepID);

      WorkflowStepArgument."Approver Type" := ApproverType;
      WorkflowStepArgument."Approver Limit Type" := ApproverLimitType;
      WorkflowStepArgument."Workflow User Group Code" := WorkflowUserGroupCode;
      WorkflowStepArgument."Due Date Formula" := DueDateFormula;
      WorkflowStepArgument."Show Confirmation Message" := ShowConfirmationMessage;
      WorkflowStepArgument.MODIFY(TRUE);
    END;

    LOCAL PROCEDURE InsertEventStep@12(Workflow@1000 : Record 1501;FunctionName@1001 : Code[128];PreviousStepID@1002 : Integer) : Integer;
    VAR
      WorkflowStep@1003 : Record 1502;
    BEGIN
      InsertStep(WorkflowStep,Workflow.Code,WorkflowStep.Type::"Event",FunctionName);
      WorkflowStep."Sequence No." := GetSequenceNumber(Workflow,PreviousStepID);
      WorkflowStep.VALIDATE("Previous Workflow Step ID",PreviousStepID);
      WorkflowStep.MODIFY(TRUE);
      EXIT(WorkflowStep.ID);
    END;

    LOCAL PROCEDURE InsertEventArgument@41(WorkflowStepID@1000 : Integer;EventConditions@1008 : Text);
    VAR
      WorkflowStep@1001 : Record 1502;
      WorkflowStepArgument@1002 : Record 1523;
    BEGIN
      IF EventConditions = '' THEN
        ERROR(InvalidEventCondErr);

      WorkflowStepArgument.Type := WorkflowStepArgument.Type::"Event";
      WorkflowStepArgument.INSERT(TRUE);
      WorkflowStepArgument.SetEventFilters(EventConditions);

      WorkflowStep.SETRANGE(ID,WorkflowStepID);
      WorkflowStep.FINDFIRST;
      WorkflowStep.Argument := WorkflowStepArgument.ID;
      WorkflowStep.MODIFY(TRUE);
    END;

    LOCAL PROCEDURE InsertNotificationArgument@42(WorkflowStepID@1000 : Integer;NotifUserID@1004 : Code[50];LinkTargetPage@1007 : Integer;CustomLink@1003 : Text[250]);
    VAR
      WorkflowStepArgument@1001 : Record 1523;
    BEGIN
      InsertStepArgument(WorkflowStepArgument,WorkflowStepID);

      WorkflowStepArgument."Notification User ID" := NotifUserID;
      WorkflowStepArgument."Link Target Page" := LinkTargetPage;
      WorkflowStepArgument."Custom Link" := CustomLink;
      WorkflowStepArgument.MODIFY(TRUE);
    END;

    LOCAL PROCEDURE InsertResponseStep@13(Workflow@1001 : Record 1501;FunctionName@1000 : Code[128];PreviousStepID@1002 : Integer) : Integer;
    VAR
      WorkflowStep@1003 : Record 1502;
    BEGIN
      InsertStep(WorkflowStep,Workflow.Code,WorkflowStep.Type::Response,FunctionName);
      WorkflowStep."Sequence No." := GetSequenceNumber(Workflow,PreviousStepID);
      WorkflowStep.VALIDATE("Previous Workflow Step ID",PreviousStepID);
      WorkflowStep.MODIFY(TRUE);
      EXIT(WorkflowStep.ID);
    END;

    LOCAL PROCEDURE InsertStep@30(VAR WorkflowStep@1000 : Record 1502;WorkflowCode@1001 : Code[20];StepType@1003 : Option;FunctionName@1002 : Code[128]);
    BEGIN
      WITH WorkflowStep DO BEGIN
        VALIDATE("Workflow Code",WorkflowCode);
        VALIDATE(Type,StepType);
        VALIDATE("Function Name",FunctionName);
        INSERT(TRUE);
      END;
    END;

    LOCAL PROCEDURE InsertStepArgument@19(VAR WorkflowStepArgument@1003 : Record 1523;WorkflowStepID@1000 : Integer);
    VAR
      WorkflowStep@1002 : Record 1502;
    BEGIN
      WorkflowStep.SETRANGE(ID,WorkflowStepID);
      WorkflowStep.FINDFIRST;

      IF WorkflowStepArgument.GET(WorkflowStep.Argument) THEN
        EXIT;

      WorkflowStepArgument.Type := WorkflowStepArgument.Type::Response;
      WorkflowStepArgument.VALIDATE("Response Function Name",WorkflowStep."Function Name");
      WorkflowStepArgument.INSERT(TRUE);

      WorkflowStep.Argument := WorkflowStepArgument.ID;
      WorkflowStep.MODIFY(TRUE);
    END;

    LOCAL PROCEDURE SetNextStep@34(Workflow@1003 : Record 1501;WorkflowStepID@1001 : Integer;NextStepID@1000 : Integer);
    VAR
      WorkflowStep@1002 : Record 1502;
    BEGIN
      WorkflowStep.GET(Workflow.Code,WorkflowStepID);
      WorkflowStep.VALIDATE("Next Workflow Step ID",NextStepID);
      WorkflowStep.MODIFY(TRUE);
    END;

    LOCAL PROCEDURE PopulateWorkflowStepArgument@5(VAR WorkflowStepArgument@1005 : Record 1523;ApproverType@1004 : Option;ApproverLimitType@1003 : Option;ApprovalEntriesPage@1002 : Integer;WorkflowUserGroupCode@1001 : Code[20];DueDateFormula@1000 : DateFormula;ShowConfirmationMessage@1006 : Boolean);
    BEGIN
      WorkflowStepArgument.INIT;
      WorkflowStepArgument.Type := WorkflowStepArgument.Type::Response;
      WorkflowStepArgument."Approver Type" := ApproverType;
      WorkflowStepArgument."Approver Limit Type" := ApproverLimitType;
      WorkflowStepArgument."Workflow User Group Code" := WorkflowUserGroupCode;
      WorkflowStepArgument."Due Date Formula" := DueDateFormula;
      WorkflowStepArgument."Link Target Page" := ApprovalEntriesPage;
      WorkflowStepArgument."Show Confirmation Message" := ShowConfirmationMessage;
    END;

    PROCEDURE BuildExpenseTypeConditions@64(Status@1003 : Option) : Text;
    VAR
      Expense@1000 : Record 6086320;
    BEGIN
      Expense.SETRANGE(Status,Status);
      EXIT(STRSUBSTNO(ExpenseTypeCondnTxt,Encode(Expense.GETVIEW(FALSE))));
    END;

    PROCEDURE BuildMileageTypeConditions@18(Status@1003 : Option) : Text;
    VAR
      Mileage@1000 : Record 6086338;
    BEGIN
      Mileage.SETRANGE(Status,Status);
      EXIT(STRSUBSTNO(MileageTypeCondnTxt,Encode(Mileage.GETVIEW(FALSE))));
    END;

    PROCEDURE BuildSettlementTypeConditions@25(Status@1003 : Option) : Text;
    VAR
      ExpHeader@1000 : Record 6086339;
    BEGIN
      ExpHeader.SETRANGE(Status,Status);
      EXIT(STRSUBSTNO(SettlementTypeCondnTxt,Encode(ExpHeader.GETVIEW(FALSE))));
    END;

    LOCAL PROCEDURE BuildNoPendingApprovalsConditions@56() : Text;
    VAR
      ApprovalEntry@1000 : Record 454;
    BEGIN
      ApprovalEntry.SETRANGE("Pending Approvals",0);
      EXIT(STRSUBSTNO(PendingApprovalsCondnTxt,Encode(ApprovalEntry.GETVIEW(FALSE))));
    END;

    LOCAL PROCEDURE BuildPendingApprovalsConditions@61() : Text;
    VAR
      ApprovalEntry@1000 : Record 454;
    BEGIN
      ApprovalEntry.SETFILTER("Pending Approvals",'>%1',0);
      EXIT(STRSUBSTNO(PendingApprovalsCondnTxt,Encode(ApprovalEntry.GETVIEW(FALSE))));
    END;

    LOCAL PROCEDURE MarkWorkflowAsTemplate@74(VAR Workflow@1000 : Record 1501);
    BEGIN
      Workflow.VALIDATE(Template,TRUE);
      Workflow.MODIFY(TRUE);
    END;

    LOCAL PROCEDURE Encode@93(Text@1001 : Text) : Text;
    VAR
      XMLDOMManagement@1000 : Codeunit 6224;
    BEGIN
      EXIT(XMLDOMManagement.XMLEscape(Text));
    END;

    LOCAL PROCEDURE GetSequenceNumber@22(Workflow@1001 : Record 1501;PreviousStepID@1002 : Integer) : Integer;
    VAR
      WorkflowStep@1000 : Record 1502;
    BEGIN
      WorkflowStep.SETRANGE("Workflow Code",Workflow.Code);
      WorkflowStep.SETRANGE("Previous Workflow Step ID",PreviousStepID);
      IF WorkflowStep.FINDLAST THEN
        EXIT(WorkflowStep."Sequence No." + 1);
    END;

    PROCEDURE GetWorkflowTemplateCode@84(WorkflowCode@1000 : Code[17]) : Code[20];
    BEGIN
      EXIT('EM-' + WorkflowCode);
    END;

    LOCAL PROCEDURE DeleteExistingTemplates@4();
    VAR
      Workflow@1002 : Record 1501;
      WorkflowStep@1001 : Record 1502;
      WorkflowStepArgument@1000 : Record 1523;
    BEGIN
      Workflow.SETRANGE(Template,TRUE);
      Workflow.SETRANGE(Category,'CONTINIAEM');
      IF Workflow.FINDSET THEN
        REPEAT
          WorkflowStep.SETRANGE("Workflow Code",Workflow.Code);
          IF WorkflowStep.FINDSET THEN
            REPEAT
              WorkflowStepArgument.SETRANGE(ID,WorkflowStep.Argument);
              WorkflowStepArgument.DELETEALL;
            UNTIL WorkflowStep.NEXT = 0;

          WorkflowStep.DELETEALL;

        UNTIL Workflow.NEXT = 0;

      Workflow.DELETEALL;
    END;

    LOCAL PROCEDURE InsertTableRelations@3();
    VAR
      WorkFlowSetup@1000 : Codeunit 1502;
      ApprovalEntry@1001 : Record 454;
    BEGIN
      WorkFlowSetup.InsertTableRelation(DATABASE::Expense,0,
        DATABASE::"Approval Entry",ApprovalEntry.FIELDNO("Record ID to Approve"));
      WorkFlowSetup.InsertTableRelation(DATABASE::Mileage,0,
        DATABASE::"Approval Entry",ApprovalEntry.FIELDNO("Record ID to Approve"));
      WorkFlowSetup.InsertTableRelation(DATABASE::"Expense Header",0,
        DATABASE::"Approval Entry",ApprovalEntry.FIELDNO("Record ID to Approve"));
    END;

    [EventSubscriber(Page,1500,OnOpenPageEvent,"",Skip,Skip)]
    LOCAL PROCEDURE WorkflowsOnOpenPage@101();
    BEGIN
      InitWorkflow;
    END;

    [EventSubscriber(Page,1505,OnOpenPageEvent,"",Skip,Skip)]
    LOCAL PROCEDURE WorkflowTemplatesOnOpenPage@102(VAR Rec@1000 : Record 1500);
    BEGIN
      InitWorkflow;
    END;

    BEGIN
    END.
  }
}

