OBJECT Table 11124901 Resource Request
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               IF "No." = '' THEN BEGIN
                 ResourcePlanningSetup.GET;
                 ResourcePlanningSetup.TESTFIELD("Request Nos.");
                 NoSeriesMgt.InitSeries(ResourcePlanningSetup."Request Nos.",xRec."No. Series",0D,"No.","No. Series");
               END;
               IF "Request Type" = '' THEN
                 FillDefaultRequestType;
               "Created on" := CURRENTDATETIME;
               "Created by" := USERID;
               FillApplicant;
             END;

    OnModify=BEGIN
               TESTFIELD(Status, Status::Open);
               UpdateWorkordersAndAdditionalInfo(Rec);
               UpdateWorkorderChangeLog;
             END;

    OnDelete=VAR
               AdditionalInfoRequestWO@1100529002 : Record 11124915;
               WorkOrder@1100529000 : Record 11229279;
               ResourceRequestTextLine@1100529001 : Record 11124902;
               ResourceReqCollectiveList@1100529004 : Record 11124904;
               ResourceRequestItemLine@1100528300 : Record 11124908;
               TransportCostRequestWO@1100529005 : Record 11124913;
               CollectiveListNo@1100529003 : Code[20];
             BEGIN
               IF (Status <> Status::Open) AND ("Source Type" = "Source Type"::Customer) THEN BEGIN
                 CollectiveListNo := GetCollectiveListNo("No.");
                 IF CollectiveListNo = '' THEN
                   ERROR(Text001, TABLECAPTION, "No.")
                 ELSE BEGIN
                   IF ResourceReqCollectiveList.GET(CollectiveListNo) THEN BEGIN
                     IF (ResourceReqCollectiveList."Invoice No." = '') OR
                        (ResourceReqCollectiveList."Invoice Status" <> ResourceReqCollectiveList."Invoice Status"::Posted)
                     THEN
                       ERROR(Text001, TABLECAPTION, "No.");
                   END;
                 END;
               END;

               AdditionalInfoRequestWO.SETCURRENTKEY("Request No.","Work Order No.");
               AdditionalInfoRequestWO.SETRANGE("Request No.", "No.");
               AdditionalInfoRequestWO.DELETEALL(FALSE);

               WorkOrder.SETCURRENTKEY("Source No.","Source Company","No.");
               WorkOrder.SETRANGE("Source No.", "No.");
               WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::Request);
               WorkOrder.SETRANGE("Source Company", COMPANYNAME);
               WorkOrder.DELETEALL(TRUE);

               ResourceRequestTextLine.SETRANGE("Request No.", "No.");
               ResourceRequestTextLine.DELETEALL;

               ResourceRequestItemLine.SETRANGE("Request No.", "No.");
               ResourceRequestItemLine.DELETEALL;

               TransportCostRequestWO.SETRANGE("Request No.", "No.");
               TransportCostRequestWO.DELETEALL;

               DeleteRequestPlantLocations;
             END;

    CaptionML=ENU=Resource Request;
    LookupPageID=Page11126887;
    DrillDownPageID=Page11126887;
  }
  FIELDS
  {
    { 10  ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                ResourcePlanningSetup.GET;
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  NoSeriesMgt.TestManual(ResourcePlanningSetup."Request Nos.");
                                                                  "No. Series" := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr.;
                                                              SVE=Nr] }
    { 20  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 30  ;   ;Type                ;Option        ;OnValidate=BEGIN
                                                                IF Type <> xRec.Type THEN
                                                                  FillDefaultRequestType;
                                                                IF Type <> Type::Transport THEN BEGIN
                                                                  "Load Address" := '';
                                                                  "Load Address 2" := '';
                                                                  "Load Address Post Code" := '';
                                                                  "Load Address City" := '';
                                                                  "Unload Address" := '';
                                                                  "Unload Address 2" := '';
                                                                  "Unload Address Post Code" := '';
                                                                  "Unload Address City" := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Type;
                                                              NOR=Radtype;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=ENU=Task,Transport,,Rental;
                                                   OptionString=Task,Transport,,Rental }
    { 35  ;   ;Sub Type            ;Code10        ;TableRelation=IF (Type=CONST(Task)) "Resource Request Subtype".Code WHERE (Task=CONST(Yes))
                                                                 ELSE IF (Type=CONST(Transport)) "Resource Request Subtype".Code WHERE (Transport=CONST(Yes))
                                                                 ELSE IF (Type=CONST(Rental)) "Resource Request Subtype".Code WHERE (Rental=CONST(Yes));
                                                   CaptionML=ENU=Sub Type }
    { 40  ;   ;Source Type         ;Option        ;OnValidate=BEGIN
                                                                IF "Source Type" <> xRec."Source Type" THEN BEGIN
                                                                  IF "Source Type" = "Source Type"::Customer THEN
                                                                    IF "Receiving Company" = COMPANYNAME THEN
                                                                      "Receiving Company" := ''
                                                                    ELSE
                                                                      TESTFIELD("Receiving Company", '');
                                                                  "Source No." := '';
                                                                  "Project Element" := '';
                                                                  "Address Code" := '';
                                                                  "Plant Location" := '';
                                                                  DeleteRequestPlantLocations;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Source Type;
                                                              NOR=Kildetype;
                                                              SVE=Ursprungstyp];
                                                   OptionCaptionML=ENU=Project,Service Order,Customer;
                                                   OptionString=Project,ServiceOrder,Customer }
    { 45  ;   ;Source No.          ;Code20        ;TableRelation=IF (Source Type=CONST(Project)) Job
                                                                 ELSE IF (Source Type=CONST(ServiceOrder)) "Service Order"
                                                                 ELSE IF (Source Type=CONST(Customer)) Customer;
                                                   OnValidate=VAR
                                                                ServiceOrder@1100525000 : Record 11012823;
                                                                Job@1100525001 : Record 11072003;
                                                              BEGIN
                                                                IF "Source No." <> '' THEN
                                                                  CASE "Source Type" OF
                                                                    "Source Type"::ServiceOrder:
                                                                      BEGIN
                                                                        ServiceOrder.CHANGECOMPANY(GetReceivingCompany);
                                                                        ServiceOrder.GET("Source No.");
                                                                        IF (ServiceOrder.Status <> ServiceOrder.Status::Open) AND
                                                                           (ServiceOrder.Status <> ServiceOrder.Status::"In Process") AND
                                                                           (ServiceOrder.Status <> ServiceOrder.Status::"Technical Finished")
                                                                        THEN
                                                                          ERROR(Text002, ServiceOrder.TABLECAPTION, ServiceOrder.FIELDCAPTION(Status), ServiceOrder.Status);
                                                                        Territory := ServiceOrder."Territory Code";
                                                                      END;
                                                                    "Source Type"::Project:
                                                                      BEGIN
                                                                        Job.CHANGECOMPANY(GetReceivingCompany);
                                                                        Job.GET("Source No.");
                                                                        IF (Job."Project Status" <> Job."Project Status"::Estimation) AND
                                                                           (Job."Project Status" <> Job."Project Status"::Preparation) AND
                                                                           (Job."Project Status" <> Job."Project Status"::Production) AND
                                                                           (Job."Project Status" <> Job."Project Status"::"Technical Finished")
                                                                        THEN
                                                                          ERROR(Text002, Job.TABLECAPTION, Job.FIELDCAPTION("Project Status"), Job."Project Status");
                                                                        Territory := Job."Territory Code";
                                                                      END;
                                                                  END;

                                                                IF "Source No." <> xRec."Source No." THEN BEGIN
                                                                  "Project Element" := '';
                                                                  "Address Code" := '';
                                                                  "Plant Location" := '';
                                                                  DeleteRequestPlantLocations;
                                                                  FillDefaultAddress;
                                                                  FillDefaultPlantLocation;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Source No.;
                                                              NOR=Kildenr.;
                                                              SVE=Ursprungsnr] }
    { 50  ;   ;Address             ;Text100       ;OnValidate=BEGIN
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   CaptionML=[ENU=Address;
                                                              NOR=Adresse;
                                                              SVE=Adress] }
    { 51  ;   ;Address 2           ;Text50        ;CaptionML=[ENU=Address 2;
                                                              NOR=Adresse 2;
                                                              SVE=Adress 2] }
    { 60  ;   ;Post Code           ;Code20        ;TableRelation="Post Code";
                                                   OnValidate=VAR
                                                                PostCode@1100529000 : Record 225;
                                                                DummyCode@1100529002 : Code[10];
                                                                Dummy@1100529001 : Text;
                                                              BEGIN
                                                                PostCode.ValidatePostCode(City,"Post Code",Dummy,DummyCode,(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Post Code;
                                                              NOR=Postnr;
                                                              SVE=Postnr] }
    { 70  ;   ;City                ;Text30        ;TableRelation="Post Code".City;
                                                   OnValidate=VAR
                                                                PostCode@1100529000 : Record 225;
                                                                DummyCode@1100529002 : Code[10];
                                                                Dummy@1100529001 : Text;
                                                              BEGIN
                                                                PostCode.ValidateCity(City,"Post Code",Dummy,DummyCode,(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=City;
                                                              NOR=Sted;
                                                              SVE=Summa inklusive moms] }
    { 80  ;   ;Address Code        ;Code10        ;TableRelation=IF (Source Type=CONST(Customer)) "Ship-to Address".Code WHERE (Customer No.=FIELD(Source No.));
                                                   OnValidate=VAR
                                                                ShiptoAddress@1100528300 : Record 222;
                                                              BEGIN
                                                                IF "Address Code" <> '' THEN BEGIN
                                                                  TESTFIELD("Source Type", "Source Type"::Customer);
                                                                  TESTFIELD("Source No.");
                                                                END;
                                                                IF ("Address Code" <> xRec."Address Code") THEN BEGIN
                                                                  IF "Address Code" = '' THEN
                                                                    FillDefaultAddress
                                                                  ELSE BEGIN
                                                                    ShiptoAddress.GET("Source No.","Address Code");
                                                                    Address := ShiptoAddress.Address;
                                                                    "Address 2" := ShiptoAddress."Address 2";
                                                                    "Post Code" := ShiptoAddress."Post Code";
                                                                    City := ShiptoAddress.City;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Address Code;
                                                              NOR=Adressekode;
                                                              SVE=Adresskod] }
    { 90  ;   ;Status              ;Option        ;CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=ENU=Open,,,,,,,,,,Finished;
                                                   OptionString=Open,,,,,,,,,,Finished;
                                                   Editable=No }
    { 100 ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr-serie;
                                                              SVE=Nr-serie];
                                                   Editable=No }
    { 110 ;   ;Load Address        ;Text100       ;OnValidate=BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Load Address", '');
                                                              END;

                                                   CaptionML=ENU=Load Address }
    { 111 ;   ;Load Address 2      ;Text50        ;OnValidate=BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Load Address 2", '');
                                                              END;

                                                   CaptionML=ENU=Load Address 2 }
    { 112 ;   ;Load Address Post Code;Code20      ;TableRelation="Post Code";
                                                   OnValidate=VAR
                                                                PostCode@1100529000 : Record 225;
                                                                DummyCode@1100529002 : Code[10];
                                                                Dummy@1100529001 : Text;
                                                              BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Load Address Post Code", '');
                                                                PostCode.ValidatePostCode("Load Address City","Load Address Post Code",Dummy,DummyCode,(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Load Address Post Code }
    { 113 ;   ;Load Address City   ;Text30        ;TableRelation="Post Code".City;
                                                   OnValidate=VAR
                                                                PostCode@1100529000 : Record 225;
                                                                DummyCode@1100529002 : Code[10];
                                                                Dummy@1100529001 : Text;
                                                              BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Load Address City", '');
                                                                PostCode.ValidateCity("Load Address City","Load Address Post Code",Dummy,DummyCode,(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Load Address City }
    { 120 ;   ;Unload Address      ;Text100       ;OnValidate=BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Unload Address", '');
                                                              END;

                                                   CaptionML=ENU=Unload Address }
    { 121 ;   ;Unload Address 2    ;Text50        ;OnValidate=BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Unload Address 2", '');
                                                              END;

                                                   CaptionML=ENU=Unload Address 2 }
    { 122 ;   ;Unload Address Post Code;Code20    ;TableRelation="Post Code";
                                                   OnValidate=VAR
                                                                PostCode@1100529000 : Record 225;
                                                                DummyCode@1100529002 : Code[10];
                                                                Dummy@1100529001 : Text;
                                                              BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Unload Address Post Code", '');
                                                                PostCode.ValidatePostCode("Unload Address City","Unload Address Post Code",Dummy,DummyCode,(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Unload Address Post Code }
    { 123 ;   ;Unload Address City ;Text30        ;TableRelation="Post Code".City;
                                                   OnValidate=VAR
                                                                PostCode@1100529000 : Record 225;
                                                                DummyCode@1100529002 : Code[10];
                                                                Dummy@1100529001 : Text;
                                                              BEGIN
                                                                IF Type <> Type::Transport THEN
                                                                  TESTFIELD("Unload Address City", '');
                                                                PostCode.ValidateCity("Unload Address City","Unload Address Post Code",Dummy,DummyCode,(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Unload Address City }
    { 140 ;   ;Plant Location      ;Code20        ;TableRelation="Plant Location";
                                                   OnValidate=VAR
                                                                PlantLocation@1100529000 : Record 11012554;
                                                              BEGIN
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  IF NOT ("Source Type" IN ["Source Type"::Project, "Source Type"::ServiceOrder]) THEN
                                                                    TESTFIELD("Plant Location", '');
                                                                  TESTFIELD("Source No.");
                                                                  PlantLocation.GET("Plant Location");
                                                                  CASE "Source Type" OF
                                                                    "Source Type"::Project:
                                                                      PlantLocation.TESTFIELD("Project No.", "Source No.");
                                                                    "Source Type"::ServiceOrder:
                                                                      PlantLocation.TESTFIELD("Service Order No.", "Source No.");
                                                                  END;
                                                                  CheckReceivingCompany(
                                                                    PlantLocation."Company Name", PlantLocation.CURRENTCOMPANY,
                                                                    PlantLocation.FIELDCAPTION("Company Name"), PlantLocation.TABLECAPTION, PlantLocation.Code);
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              PlantLocation@1100529000 : Record 11012554;
                                                            BEGIN
                                                              IF (NOT ("Source Type" IN ["Source Type"::Project, "Source Type"::ServiceOrder])) OR ("Source No." = '') THEN
                                                                EXIT;
                                                              PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
                                                              PlantLocation.FILTERGROUP(9);
                                                              PlantLocation.SetFilterOnCompanyName("Receiving Company", CURRENTCOMPANY);
                                                              CASE "Source Type" OF
                                                                "Source Type"::Project:
                                                                  PlantLocation.SETRANGE("Project No.", "Source No.");
                                                                "Source Type"::ServiceOrder:
                                                                  BEGIN
                                                                    PlantLocation.SETRANGE("Project No.", '');
                                                                    PlantLocation.SETRANGE("Service Order No.", "Source No.");
                                                                  END;
                                                              END;
                                                              PlantLocation.FILTERGROUP(0);
                                                              IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN
                                                                VALIDATE("Plant Location", PlantLocation.Code);
                                                            END;

                                                   CaptionML=[ENU=Plant Location;
                                                              NOR=Maskinplassering;
                                                              SVE=Maskinutplacering] }
    { 150 ;   ;Request Type        ;Code10        ;TableRelation="Resource Request Type";
                                                   CaptionML=ENU=Request Type }
    { 160 ;   ;Reference           ;Text20        ;CaptionML=[ENU=Reference;
                                                              NOR=Referanse;
                                                              SVE=Referens] }
    { 170 ;   ;Item Lines          ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Resource Request Item Line" WHERE (Request No.=FIELD(No.)));
                                                   CaptionML=ENU=Item Lines;
                                                   Editable=No }
    { 220 ;   ;Territory           ;Code10        ;TableRelation=Territory;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Territory;
                                                              SVE=Territory] }
    { 230 ;   ;Created on          ;DateTime      ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Created on;
                                                              SVE=Skapades];
                                                   Editable=No }
    { 240 ;   ;Created by          ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Created by;
                                                              SVE=Skapad av];
                                                   Editable=No }
    { 250 ;   ;Applicant           ;Text50        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Applicant }
    { 260 ;   ;Applicant Phone     ;Text50        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Applicant Phone }
    { 270 ;   ;Contact Person      ;Text100       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Contact Person;
                                                              SVE=Kontaktperson] }
    { 280 ;   ;Contact Person Phone;Text30        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Contact Person Phone }
    { 290 ;   ;Receiving Company   ;Text30        ;TableRelation=Company;
                                                   OnValidate=BEGIN
                                                                IF "Receiving Company" = COMPANYNAME THEN
                                                                  "Receiving Company" := '';
                                                                IF ("Receiving Company" <> '') AND ("Source Type" = "Source Type"::Customer) THEN
                                                                  FIELDERROR("Source Type");
                                                                IF ("Receiving Company" <> xRec."Receiving Company") AND ("Source No." <> '') THEN BEGIN
                                                                  "Source No." := '';
                                                                  "Address Code" := '';
                                                                  "Plant Location" := '';
                                                                  DeleteRequestPlantLocations;
                                                                END;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Receiving Company;
                                                              SVE=Mottagningsf”retag] }
    { 300 ;   ;Project Element     ;Code20        ;OnValidate=VAR
                                                                ProjectElementManagement@1100528601 : Codeunit 11012285;
                                                              BEGIN
                                                                IF "Source Type" <> "Source Type"::Project THEN
                                                                  EXIT;

                                                                ProjectElementManagement.TestProjectElementPlanFunctionality;
                                                                TESTFIELD("Source No.");
                                                                IF GetNoOfWorkOrders("No.") > 0 THEN
                                                                  IF CONFIRM(Text003) THEN BEGIN
                                                                    MODIFY;
                                                                    UpdateWorkOrderProjectElement;
                                                                  END;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectElement@1100528600 : Record 11012010;
                                                              ProjectNo@1100527200 : Code[20];
                                                            BEGIN
                                                              TESTFIELD("Source Type", "Source Type"::Project);
                                                              TESTFIELD("Source No.");
                                                              ProjectElement.SETRANGE("Project No.", "Source No.");
                                                              IF "Project Element" <> '' THEN
                                                                IF ProjectElement.GET(ProjectNo, "Project Element") THEN;
                                                              IF PAGE.RUNMODAL(0, ProjectElement) = ACTION::LookupOK THEN
                                                                VALIDATE("Project Element", ProjectElement.Element);
                                                            END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Project Element;
                                                              SVE=Projektelement] }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Source Type,Source No.                   }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ResourcePlanningSetup@1100529000 : Record 11124900;
      NoSeriesMgt@1100529001 : Codeunit 396;
      Text001@1100529002 : TextConst 'ENU=%1 ''%2'' not yet (completely) invoiced, deleted not allowed';
      Text002@1100525000 : TextConst 'ENU=%1 %2 %3 not allowed.';
      Text003@1100529170 : TextConst 'ENU=Do You Want to Change the Project Element on the Work Order(s)?';
      Text004@1100529600 : TextConst 'ENU=Create %1 for %2 %3?';
      Text005@1100529601 : TextConst 'ENU=, %1 %2?';
      Text006@1100529602 : TextConst 'ENU=%1 must be %2 in %3.';
      Text007@1100529603 : TextConst 'ENU=%1 or ''''';
      Text008@1100529606 : TextConst 'ENU=%1 %2, Company %3';

    [External]
    PROCEDURE AssistEdit@2(XRecResourceRequest@11012000 : Record 11124901) : Boolean;
    VAR
      ResourceRequest@1100485000 : Record 11124901;
    BEGIN
      WITH ResourceRequest DO BEGIN
        ResourceRequest := Rec;
        ResourcePlanningSetup.GET;
        ResourcePlanningSetup.TESTFIELD("Request Nos.");
        IF NoSeriesMgt.SelectSeries(ResourcePlanningSetup."Request Nos.",XRecResourceRequest."No. Series","No. Series") THEN BEGIN
          NoSeriesMgt.SetSeries("No.");
          Rec := ResourceRequest;
          EXIT(TRUE);
        END;
      END;
    END;

    LOCAL PROCEDURE FillDefaultRequestType@1100529010();
    BEGIN
      ResourcePlanningSetup.GET;
      CASE Type OF
        Type::Task:
          IF ResourcePlanningSetup."Request Type Task" <> '' THEN
            "Request Type" := ResourcePlanningSetup."Request Type Task";
        Type::Transport:
          IF ResourcePlanningSetup."Request Type Transport" <> '' THEN
            "Request Type" := ResourcePlanningSetup."Request Type Transport";
        Type::Rental:
          IF ResourcePlanningSetup."Request Type Rental" <> '' THEN
            "Request Type" := ResourcePlanningSetup."Request Type Rental";
      END;
    END;

    LOCAL PROCEDURE FillDefaultAddress@1100529000();
    VAR
      Project@1100529000 : Record 11072003;
      ServiceOrder@1100529001 : Record 11012823;
      Customer@1100529002 : Record 18;
    BEGIN
      IF "Source No." = '' THEN
        EXIT;
      CASE "Source Type" OF
        "Source Type"::Project:
          BEGIN
            Project.CHANGECOMPANY(GetReceivingCompany);
            Project.GET("Source No.");
            Address := Project.Address;
            "Address 2" := Project."Address 2";
            "Post Code" := Project."Post Code";
            City := Project.City;
          END;
        "Source Type"::ServiceOrder:
          BEGIN
            ServiceOrder.CHANGECOMPANY(GetReceivingCompany);
            ServiceOrder.GET("Source No.");
            Address := ServiceOrder.Address;
            "Address 2" := ServiceOrder."Address 2";
            "Post Code" := ServiceOrder."Post Code";
            City := ServiceOrder.City;
          END;
        "Source Type"::Customer:
          BEGIN
            // Customers in current company only
            Customer.GET("Source No.");
            Address := Customer.Address;
            "Address 2" := Customer."Address 2";
            "Post Code" := Customer."Post Code";
            City := Customer.City;
          END;
      END;
      UpdateExtraWorkOrderFields;
    END;

    LOCAL PROCEDURE FillDefaultPlantLocation@1100529008();
    VAR
      PlantLocation@1100529000 : Record 11012554;
    BEGIN
      IF NOT ("Source Type" IN ["Source Type"::Project, "Source Type"::ServiceOrder]) THEN
        EXIT;
      IF "Source No." = '' THEN
        EXIT;

      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.FILTERGROUP(9);
      PlantLocation.SetFilterOnCompanyName("Receiving Company", CURRENTCOMPANY);
      CASE "Source Type" OF
        "Source Type"::Project:
          PlantLocation.SETRANGE("Project No.", "Source No.");
        "Source Type"::ServiceOrder:
          BEGIN
            PlantLocation.SETRANGE("Project No.", '');
            PlantLocation.SETRANGE("Service Order No.", "Source No.");
          END;
      END;
      PlantLocation.FILTERGROUP(0);

      IF PlantLocation.ISEMPTY THEN
        CreatePlantLocation
      ELSE
        IF PlantLocation.COUNT = 1 THEN BEGIN
          PlantLocation.FINDFIRST;
          "Plant Location" := PlantLocation.Code;
        END;
    END;

    LOCAL PROCEDURE FillApplicant@1100525001();
    VAR
      UserSetup@1100525000 : Record 91;
      Employee@1100525001 : Record 5200;
    BEGIN
      IF UserSetup.GET("Created by") THEN
        IF UserSetup."Employee No." <> '' THEN
          IF Employee.GET(UserSetup."Employee No.") THEN BEGIN
            Applicant := Employee."Full Name";
            "Applicant Phone" := Employee."Company Mobile Phone No.";
          END;
    END;

    [External]
    PROCEDURE GetSourceDescription@1100529001(Descr2@1100529003 : Boolean) : Text;
    VAR
      Project@1100529000 : Record 11072003;
      ServiceOrder@1100529001 : Record 11012823;
      Customer@1100529002 : Record 18;
    BEGIN
      IF "Source No." <> '' THEN BEGIN
        CASE "Source Type" OF
          "Source Type"::Project:
            BEGIN
              Project.CHANGECOMPANY(GetReceivingCompany);
              IF Project.GET("Source No.") THEN
                IF NOT Descr2 THEN
                  EXIT(Project.Description)
                ELSE
                  EXIT(Project."Description 2");
            END;
          "Source Type"::ServiceOrder:
            BEGIN
              ServiceOrder.CHANGECOMPANY(GetReceivingCompany);
              IF ServiceOrder.GET("Source No.") THEN
                IF NOT Descr2 THEN
                  EXIT(ServiceOrder.Description)
                ELSE
                  EXIT(ServiceOrder."Description 2");
            END;
          "Source Type"::Customer:
            IF Customer.GET("Source No.") THEN
              IF NOT Descr2 THEN
                EXIT(Customer.Name)
              ELSE
                EXIT(Customer."Name 2");
        END;
      END;
      EXIT('');
    END;

    [External]
    PROCEDURE GetNoOfWorkOrders@1100525021(RequestNo@1100525000 : Code[20]) : Integer;
    VAR
      WorkOrder@1100525001 : Record 11229279;
    BEGIN
      IF RequestNo = '' THEN
        EXIT(0);
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::Request);
      WorkOrder.SETRANGE("Source No.", RequestNo);
      EXIT(WorkOrder.COUNT);
    END;

    [External]
    PROCEDURE GetNoOfInvoiceAgreements@1100529004(RequestNo@1100525000 : Code[20]) : Integer;
    VAR
      AdditionalInfoRequestWO@1100525001 : Record 11124915;
      ResourceRequest@1100529000 : Record 11124901;
    BEGIN
      IF (RequestNo = '') OR (NOT ResourceRequest.GET(RequestNo)) THEN
        EXIT(0);
      IF ResourceRequest."Source Type" <> ResourceRequest."Source Type"::Customer THEN
        EXIT(0);
      AdditionalInfoRequestWO.SETCURRENTKEY("Request No.", "Work Order No.");
      AdditionalInfoRequestWO.SETRANGE("Request No.", RequestNo);
      EXIT(AdditionalInfoRequestWO.COUNT);
    END;

    [External]
    PROCEDURE GetCollectiveListNo@1100529005(RequestNo@1100525000 : Code[20]) : Code[20];
    VAR
      ResourceRequest@1100528300 : Record 11124901;
      AdditionalInfoRequestWO@1100525001 : Record 11124915;
      ResourceRequestItemLine@1100529000 : Record 11124908;
      TransportCostRequestWO@1100529001 : Record 11124913;
    BEGIN
      IF (RequestNo = '') OR (NOT ResourceRequest.GET(RequestNo)) THEN
        EXIT('');
      IF ResourceRequest."Source Type" <> ResourceRequest."Source Type"::Customer THEN
        EXIT('');
      AdditionalInfoRequestWO.SETCURRENTKEY("Request No.", "Work Order No.");
      AdditionalInfoRequestWO.SETRANGE("Request No.", RequestNo);
      AdditionalInfoRequestWO.SETFILTER("Collective List No.", '<>%1', '');
      IF AdditionalInfoRequestWO.FINDFIRST THEN
        EXIT(AdditionalInfoRequestWO."Collective List No.");
      ResourceRequestItemLine.SETRANGE("Request No.", RequestNo);
      ResourceRequestItemLine.SETFILTER("Collective List No.", '<>%1', '');
      IF ResourceRequestItemLine.FINDFIRST THEN
        EXIT(ResourceRequestItemLine."Collective List No.");
      TransportCostRequestWO.SETRANGE("Request No.", RequestNo);
      TransportCostRequestWO.SETFILTER("Collective List No.", '<>%1', '');
      IF TransportCostRequestWO.FINDFIRST THEN
        EXIT(TransportCostRequestWO."Collective List No.");
      EXIT('');
    END;

    LOCAL PROCEDURE UpdateWorkordersAndAdditionalInfo@1100529002(ResourceRequest@1100529002 : Record 11124901);
    VAR
      WorkOrder@1100529000 : Record 11229279;
      xResourceRequest@1100529001 : Record 11124901;
      AdditionalInfoRequestWO@1100529003 : Record 11124915;
    BEGIN
      IF NOT xResourceRequest.GET(ResourceRequest."No.") THEN
        EXIT;
      IF (ResourceRequest.Description <> xResourceRequest.Description) AND (ResourceRequest.Description <> '') THEN BEGIN
        WorkOrder.SETCURRENTKEY("Source No.","Source Company","No.");
        WorkOrder.SETRANGE("Source No.", ResourceRequest."No.");
        WorkOrder.SETRANGE("Source Company", COMPANYNAME);
        WorkOrder.SETFILTER(Description, '%1|%2', xResourceRequest.Description, '');
        WorkOrder.MODIFYALL(Description, ResourceRequest.Description, TRUE);
      END;
      AdditionalInfoRequestWO.SETCURRENTKEY("Request No.","Work Order No.");
      AdditionalInfoRequestWO.SETRANGE("Request No.", ResourceRequest."No.");
      IF AdditionalInfoRequestWO.FINDSET(TRUE,FALSE) THEN BEGIN
        REPEAT
          IF CheckAddressModified(FIELDNO(Address), ResourceRequest, xResourceRequest, AdditionalInfoRequestWO) THEN BEGIN
            AdditionalInfoRequestWO.Address := ResourceRequest.Address;
            AdditionalInfoRequestWO."Address 2" := ResourceRequest."Address 2";
            AdditionalInfoRequestWO."Post Code" := ResourceRequest."Post Code";
            AdditionalInfoRequestWO.City := ResourceRequest.City;
          END;
          IF CheckAddressModified(FIELDNO("Load Address"), ResourceRequest, xResourceRequest, AdditionalInfoRequestWO) THEN BEGIN
            AdditionalInfoRequestWO."Load Address" := ResourceRequest."Load Address";
            AdditionalInfoRequestWO."Load Address 2" := ResourceRequest."Load Address 2";
            AdditionalInfoRequestWO."Load Address Post Code" := ResourceRequest."Load Address Post Code";
            AdditionalInfoRequestWO."Load Address City" := ResourceRequest."Load Address City";
          END;
          IF CheckAddressModified(FIELDNO("Unload Address"), ResourceRequest, xResourceRequest, AdditionalInfoRequestWO) THEN BEGIN
            AdditionalInfoRequestWO."Unload Address" := ResourceRequest."Unload Address";
            AdditionalInfoRequestWO."Unload Address 2" := ResourceRequest."Unload Address 2";
            AdditionalInfoRequestWO."Unload Address Post Code" := ResourceRequest."Unload Address Post Code";
            AdditionalInfoRequestWO."Unload Address City" := ResourceRequest."Unload Address City";
          END;
          AdditionalInfoRequestWO.MODIFY(TRUE);
        UNTIL AdditionalInfoRequestWO.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE UpdateWorkorderChangeLog@1100529006();
    VAR
      WorkOrder@1100529000 : Record 11229279;
      ChangeLogSubscriberGRP@1100529001 : Codeunit 11124903;
    BEGIN
      // Check on request-fields modified that are exported to the events(WO's) of the planning tool
      IF Type <> xRec.Type THEN BEGIN
        WorkOrder.SETCURRENTKEY("Source No.","Source Company","No.");
        WorkOrder.SETRANGE("Source No.", "No.");
        WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::Request);
        WorkOrder.SETRANGE("Source Company", COMPANYNAME);
        IF WorkOrder.FINDSET THEN BEGIN
          REPEAT
            ChangeLogSubscriberGRP.UpdateWorkorderChangeLog(WorkOrder."No.");
          UNTIL WorkOrder.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE CheckAddressModified@1100529003(AddressFieldNo@1100529002 : Integer;ResourceRequest@1100529000 : Record 11124901;xResourceRequest@1100529001 : Record 11124901;AdditionalInfoRequestWO@1100529003 : Record 11124915) : Boolean;
    BEGIN
      IF ((ResourceRequest.Type <> ResourceRequest.Type::Transport) AND (xResourceRequest.Type = ResourceRequest.Type::Transport)) OR
         ((ResourceRequest.Type = ResourceRequest.Type::Transport) AND (xResourceRequest.Type <> ResourceRequest.Type::Transport))
      THEN
        EXIT(TRUE);
      CASE AddressFieldNo OF
        FIELDNO(Address):
          EXIT(
            ((ResourceRequest.Address <> xResourceRequest.Address) OR
            (ResourceRequest."Address 2" <> xResourceRequest."Address 2") OR
            (ResourceRequest."Post Code" <> xResourceRequest."Post Code") OR
            (ResourceRequest.City <> xResourceRequest.City)) AND
            (((AdditionalInfoRequestWO.Address = xResourceRequest.Address) AND
              (AdditionalInfoRequestWO."Address 2" = xResourceRequest."Address 2") AND
              (AdditionalInfoRequestWO."Post Code" = xResourceRequest."Post Code") AND
              (AdditionalInfoRequestWO.City = xResourceRequest.City)) OR
            ((AdditionalInfoRequestWO.Address = '') AND (AdditionalInfoRequestWO."Address 2" = '') AND
             (AdditionalInfoRequestWO."Post Code" = '') AND (AdditionalInfoRequestWO.City = ''))));
        FIELDNO("Load Address"):
          EXIT(
            ((ResourceRequest."Load Address" <> xResourceRequest."Load Address") OR
            (ResourceRequest."Load Address 2" <> xResourceRequest."Load Address 2") OR
            (ResourceRequest."Load Address Post Code" <> xResourceRequest."Load Address Post Code") OR
            (ResourceRequest."Load Address City" <> xResourceRequest."Load Address City")) AND
            (((AdditionalInfoRequestWO."Load Address" = xResourceRequest."Load Address") AND
              (AdditionalInfoRequestWO."Load Address 2" = xResourceRequest."Load Address 2") AND
              (AdditionalInfoRequestWO."Post Code" = xResourceRequest."Load Address Post Code") AND
              (AdditionalInfoRequestWO."Load Address Post Code" = xResourceRequest."Load Address City")) OR
            ((AdditionalInfoRequestWO."Load Address" = '') AND (AdditionalInfoRequestWO."Load Address 2" = '') AND
             (AdditionalInfoRequestWO."Load Address Post Code" = '') AND (AdditionalInfoRequestWO."Load Address City" = ''))));
        FIELDNO("Unload Address"):
          EXIT(
            ((ResourceRequest."Unload Address" <> xResourceRequest."Unload Address") OR
            (ResourceRequest."Unload Address 2" <> xResourceRequest."Unload Address 2") OR
            (ResourceRequest."Unload Address Post Code" <> xResourceRequest."Unload Address Post Code") OR
            (ResourceRequest."Unload Address City" <> xResourceRequest."Unload Address City")) AND
            (((AdditionalInfoRequestWO."Unload Address" = xResourceRequest."Unload Address") AND
              (AdditionalInfoRequestWO."Unload Address 2" = xResourceRequest."Unload Address 2") AND
              (AdditionalInfoRequestWO."Unload Address Post Code" = xResourceRequest."Unload Address Post Code") AND
              (AdditionalInfoRequestWO."Unload Address City" = xResourceRequest."Unload Address City")) OR
            ((AdditionalInfoRequestWO."Unload Address" = '') AND (AdditionalInfoRequestWO."Unload Address 2" = '') AND
             (AdditionalInfoRequestWO."Unload Address Post Code" = '') AND (AdditionalInfoRequestWO."Unload Address City" = ''))));
      END;
      EXIT(FALSE);
    END;

    [External]
    PROCEDURE ShowRequestWorkOrders@1100525022(RequestNo@1100525000 : Code[20]);
    VAR
      WorkOrder@1100528600 : Record 11229279;
      WorkOrders@1100529000 : Page 11229284;
    BEGIN
      IF RequestNo = '' THEN
        EXIT;
      WorkOrders.SetSelections(WorkOrder."Source Type"::Request, RequestNo, '');
      WorkOrders.RUNMODAL;
    END;

    [External]
    PROCEDURE ShowRequestInvoiceAgreements@1100529007(RequestNo@1100525000 : Code[20]);
    VAR
      AdditionalInfoRequestWO@1100528600 : Record 11124915;
      ResourceRequest@1100529000 : Record 11124901;
    BEGIN
      IF (RequestNo = '') OR (NOT ResourceRequest.GET(RequestNo)) THEN
        EXIT;
      ResourceRequest.TESTFIELD("Source Type", ResourceRequest."Source Type"::Customer);
      AdditionalInfoRequestWO.SETCURRENTKEY("Request No.", "Work Order No.");
      AdditionalInfoRequestWO.FILTERGROUP(9);
      AdditionalInfoRequestWO.SETRANGE("Request No.", RequestNo);
      AdditionalInfoRequestWO.FILTERGROUP(0);
      AdditionalInfoRequestWO."Request No." := RequestNo;
      PAGE.RUNMODAL(PAGE::"Request Inv. Agreements (Cust)", AdditionalInfoRequestWO)
    END;

    [External]
    PROCEDURE ShowRequestCollectiveList@1100529009(RequestNo@1100525000 : Code[20]);
    VAR
      ResourceReqCollectiveList@1100528600 : Record 11124904;
      CollectiveListNo@1100529001 : Code[20];
    BEGIN
      CollectiveListNo := GetCollectiveListNo(RequestNo);
      IF CollectiveListNo = '' THEN
        EXIT;
      ResourceReqCollectiveList.FILTERGROUP(9);
      ResourceReqCollectiveList.SETRANGE("No.", CollectiveListNo);
      ResourceReqCollectiveList.FILTERGROUP(0);
      PAGE.RUNMODAL(PAGE::"Resourc Req. Collective-List", ResourceReqCollectiveList)
    END;

    [External]
    PROCEDURE ShowRequestItems@1100528300(ResourceRequest@1100528300 : Record 11124901);
    VAR
      ResourceRequestItemLine@1100528302 : Record 11124908;
      ResourceRequestItems@1100528301 : Page 11126900;
    BEGIN
      ResourceRequestItemLine.FILTERGROUP(2);
      ResourceRequestItemLine.SETRANGE("Request No.", ResourceRequest."No.");
      ResourceRequestItemLine.FILTERGROUP(0);
      ResourceRequestItems.SETTABLEVIEW(ResourceRequestItemLine);
      ResourceRequestItems.EDITABLE(Status = Status::Open);
      ResourceRequestItems.RUNMODAL;
    END;

    [External]
    PROCEDURE NumberOfPurchaseOrder@1100529011(ResourceRequest@1100529000 : Record 11124901) : Integer;
    VAR
      TmpPurchaseOrder@1100529003 : TEMPORARY Record 38;
    BEGIN
      BuildTmpPurchaseOrders(ResourceRequest."No.", TmpPurchaseOrder);
      EXIT(TmpPurchaseOrder.COUNT);
    END;

    [External]
    PROCEDURE ShowPurchaseOrders@1100529012(ResourceRequest@1100529000 : Record 11124901);
    VAR
      TmpPurchaseOrder@1100529001 : TEMPORARY Record 38;
    BEGIN
      BuildTmpPurchaseOrders(ResourceRequest."No.", TmpPurchaseOrder);
      IF TmpPurchaseOrder.FINDFIRST THEN
        PAGE.RUNMODAL(PAGE::"Purchase Order List", TmpPurchaseOrder);
    END;

    LOCAL PROCEDURE BuildTmpPurchaseOrders@1100529013(RequestNo@1100529000 : Code[20];VAR TmpPurchaseOrder@1100529004 : TEMPORARY Record 38);
    VAR
      AdditionalInfoRequestWO@1100529003 : Record 11124915;
      PurchaseOrder@1100529002 : Record 38;
    BEGIN
      AdditionalInfoRequestWO.SETCURRENTKEY("Request No.", "Work Order No.");
      AdditionalInfoRequestWO.SETRANGE("Request No.", RequestNo);
      AdditionalInfoRequestWO.SETFILTER("Purchase Order No", '<>%1', '');
      IF AdditionalInfoRequestWO.FINDSET THEN BEGIN
        REPEAT
          IF NOT TmpPurchaseOrder.GET(PurchaseOrder."Document Type"::Order, AdditionalInfoRequestWO."Purchase Order No") THEN BEGIN
            IF PurchaseOrder.GET(PurchaseOrder."Document Type"::Order, AdditionalInfoRequestWO."Purchase Order No") THEN BEGIN
              TmpPurchaseOrder := PurchaseOrder;
              TmpPurchaseOrder.INSERT;
            END;
          END;
        UNTIL AdditionalInfoRequestWO.NEXT = 0;
      END;
    END;

    [External]
    PROCEDURE GetRequestNumberOfTransportCostLines@1100529015() : Integer;
    VAR
      TransportCostRequestWO@1100529000 : Record 11124913;
    BEGIN
      IF "No." = '' THEN
        EXIT(0);
      TransportCostRequestWO.SETRANGE("Request No.", "No.");
      EXIT(TransportCostRequestWO.COUNT);
    END;

    [External]
    PROCEDURE ShowRequestTransportCost@1100529014();
    VAR
      TransportCostRequestWO@1100529001 : Record 11124913;
    BEGIN
      IF "No." = '' THEN
        EXIT;
      TransportCostRequestWO.FILTERGROUP(2);
      TransportCostRequestWO.SETRANGE("Request No.", "No.");
      TransportCostRequestWO.FILTERGROUP(0);
      TransportCostRequestWO."Request No." := "No.";
      PAGE.RUNMODAL(PAGE::"Transport Cost Request WO", TransportCostRequestWO);
    END;

    LOCAL PROCEDURE DeleteRequestPlantLocations@1100528500();
    VAR
      ResourceReqPlantLocation@1100528500 : Record 11124914;
    BEGIN
      ResourceReqPlantLocation.SETRANGE("Request No.", "No.");
      ResourceReqPlantLocation.DELETEALL;
    END;

    [External]
    PROCEDURE CreateAndDisplayResourceRequest@1100527600(OfficeAddinContext@1100527600 : Record 1600);
    BEGIN
      INIT;
      INSERT(TRUE);
      COMMIT;
      PAGE.RUN(PAGE::"Resource Request", Rec);
    END;

    LOCAL PROCEDURE UpdateExtraWorkOrderFields@1100528666();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::Request);
      WorkOrder.SETRANGE("Source No.", "No.");
      IF WorkOrder.FINDSET THEN
        REPEAT
          WorkOrder.DetermineExtraField(Rec);
          WorkOrder.MODIFY(FALSE);
        UNTIL WorkOrder.NEXT = 0;
    END;

    LOCAL PROCEDURE UpdateWorkOrderProjectElement@1100529170();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::Request);
      WorkOrder.SETRANGE("Source No.", "No.");
      IF WorkOrder.FINDSET THEN
        REPEAT
          WorkOrder.VALIDATE("Project Element", "Project Element");
          WorkOrder.MODIFY(FALSE);
        UNTIL WorkOrder.NEXT = 0;
    END;

    [External]
    PROCEDURE LookupSourceNo@1100529600();
    VAR
      ServiceOrder@1100529601 : Record 11012823;
      Job@1100529603 : Record 11072003;
      Customer@1100529604 : Record 18;
      PageNo@1100529602 : Integer;
    BEGIN
      CASE "Source Type" OF
        "Source Type"::ServiceOrder:
          BEGIN
            ServiceOrder.CHANGECOMPANY(GetReceivingCompany);
            ServiceOrder.FILTERGROUP(9);
            ServiceOrder.SETFILTER(Status, '= %1|%2|%3', ServiceOrder.Status::Open, ServiceOrder.Status::"In Process", ServiceOrder.Status::"Technical Finished");
            ServiceOrder.FILTERGROUP(0);
            IF "Source No." <> '' THEN
              IF ServiceOrder.GET("Source No.") THEN;
            IF PAGE.RUNMODAL(PAGE::"Service-Order List", ServiceOrder) = ACTION::LookupOK THEN
              VALIDATE("Source No.", ServiceOrder."No.");
          END;

        "Source Type"::Project:
          BEGIN
            Job.CHANGECOMPANY(GetReceivingCompany);
            Job.FILTERGROUP(9);
            Job.SETFILTER("Project Status", '= %1|%2|%3|%4', Job."Project Status"::Estimation, Job."Project Status"::Preparation,
              Job."Project Status"::Production, Job."Project Status"::"Technical Finished");
            Job.FILTERGROUP(0);
            IF "Source No." <> '' THEN
              IF Job.GET("Source No.") THEN;
            IF RefersToOtherCompany THEN
              PageNo := PAGE::"Job List IC";
            IF PAGE.RUNMODAL(PageNo, Job) = ACTION::LookupOK THEN
              VALIDATE("Source No.", Job."No.");
          END;

        "Source Type"::Customer:
          BEGIN
            IF "Source No." <> '' THEN
              IF Customer.GET("Source No.") THEN;
            IF PAGE.RUNMODAL(PAGE::"Customer List", Customer) = ACTION::LookupOK THEN
              VALIDATE("Source No.", Customer."No.");
          END;
      END;
    END;

    LOCAL PROCEDURE RefersToOtherCompany@1100525032() : Boolean;
    BEGIN
      EXIT(("Receiving Company" <> '') AND ("Receiving Company" <> COMPANYNAME));
    END;

    [External]
    PROCEDURE GetReceivingCompany@1100529602() : Text[30];
    BEGIN
      IF "Receiving Company" <> '' THEN
        EXIT("Receiving Company");
      EXIT(CURRENTCOMPANY);
    END;

    LOCAL PROCEDURE CreatePlantLocation@1100529603();
    VAR
      PlantLocation@1100529600 : Record 11012554;
      Project@1100529603 : Record 11072003;
      ServiceOrder@1100529604 : Record 11012823;
      ConfirmationTxt@1100529602 : Text;
    BEGIN
      IF NOT GUIALLOWED THEN
        EXIT;

      IF "Source Type" = "Source Type"::Project THEN
        ConfirmationTxt := STRSUBSTNO(Text004, PlantLocation.TABLECAPTION, PlantLocation.FIELDCAPTION("Project No."), "Source No.")
      ELSE
        ConfirmationTxt := STRSUBSTNO(Text004, PlantLocation.TABLECAPTION, PlantLocation.FIELDCAPTION("Service Order No."), "Source No.");
      IF ("Receiving Company" <> '') AND ("Receiving Company" <> COMPANYNAME) THEN
        ConfirmationTxt :=
          COPYSTR(ConfirmationTxt, 1, STRLEN(ConfirmationTxt) - 1) +
          STRSUBSTNO(Text005, PlantLocation.FIELDCAPTION("Company Name"), "Receiving Company");
      IF NOT CONFIRM(ConfirmationTxt) THEN
        EXIT;

      CASE "Source Type" OF
        "Source Type"::Project:
          BEGIN
            Project.CHANGECOMPANY(GetReceivingCompany);
            Project.GET("Source No.");
            "Plant Location" := Project.CreatePlantLocation(Project, CURRENTCOMPANY, FALSE);
          END;
        "Source Type"::ServiceOrder:
          BEGIN
            ServiceOrder.CHANGECOMPANY(GetReceivingCompany);
            ServiceOrder.GET("Source No.");
            "Plant Location" := ServiceOrder.CreatePlantLocation(ServiceOrder, CURRENTCOMPANY);
          END;
      END;
    END;

    [External]
    PROCEDURE CheckResRequestReceivCompany@1100529601(LocCompanyName@1100529600 : Text[30];LocCurrCompanyName@1100529602 : Text[30]);
    VAR
      LocReceivingCompanyName@1100529601 : Text[30];
    BEGIN
      IF CompareReceivingCompany(LocCompanyName, LocCurrCompanyName, LocReceivingCompanyName) THEN
        EXIT;
      ShowErrorReceivingCompany(CURRENTCOMPANY, LocCompanyName, FIELDCAPTION("Receiving Company"), TABLECAPTION, "No.");
    END;

    [External]
    PROCEDURE CheckReceivingCompany@1100529604(LocCompanyName@1100529600 : Text[30];LocCurrCompanyName@1100529602 : Text[30];LocFieldCaption@1100529606 : Text;LocTableCaption@1100529605 : Text;LocTableKeys@1100529604 : Text);
    VAR
      LocReceivingCompanyName@1100529601 : Text[30];
    BEGIN
      IF CompareReceivingCompany(LocCompanyName, LocCurrCompanyName, LocReceivingCompanyName) THEN
        EXIT;
      ShowErrorReceivingCompany(LocCurrCompanyName, LocReceivingCompanyName, LocFieldCaption, LocTableCaption, LocTableKeys);
    END;

    LOCAL PROCEDURE CompareReceivingCompany@1100529608(VAR LocCompanyName@1100529600 : Text[30];VAR LocCurrCompanyName@1100529602 : Text[30];VAR LocReceivingCompanyName@1100529601 : Text[30]) : Boolean;
    BEGIN
      IF LocCurrCompanyName = '' THEN
        LocCurrCompanyName := COMPANYNAME;
      IF LocCompanyName = '' THEN
        LocCompanyName := LocCurrCompanyName;
      LocReceivingCompanyName := GetReceivingCompany;
      EXIT(LocReceivingCompanyName = LocCompanyName);
    END;

    LOCAL PROCEDURE ShowErrorReceivingCompany@1100529606(LocCurrCompanyName@1100529601 : Text[30];LocReceivingCompanyName@1100529602 : Text[30];LocFieldCaption@1100529603 : Text;LocTableCaption@1100529606 : Text;LocTableKeys@1100529607 : Text);
    VAR
      CompanyTxt@1100529604 : Text;
      RecordTxt@1100529605 : Text;
    BEGIN
      IF LocReceivingCompanyName = LocCurrCompanyName THEN
        CompanyTxt := STRSUBSTNO(Text007, LocReceivingCompanyName)
      ELSE
        CompanyTxt := LocReceivingCompanyName;

      IF (LocCurrCompanyName = '') OR (LocCurrCompanyName = COMPANYNAME) THEN
        RecordTxt := STRSUBSTNO('%1 %2', LocTableCaption, LocTableKeys)
      ELSE
        RecordTxt := STRSUBSTNO(Text008, LocTableCaption, LocTableKeys, LocCurrCompanyName);

      ERROR(Text006, LocFieldCaption, CompanyTxt, RecordTxt);
    END;

    [External]
    PROCEDURE SetFilterOnReceivingCompany@1100529605(LocCompanyName@1100529600 : Text[30];LocCurrCompanyName@1100529602 : Text[30]);
    BEGIN
      IF LocCompanyName = '' THEN
        IF LocCurrCompanyName = '' THEN
          LocCompanyName := COMPANYNAME
        ELSE
          LocCompanyName := LocCurrCompanyName;

      IF LocCompanyName = CURRENTCOMPANY THEN
        SETFILTER("Receiving Company", '%1|%2', LocCompanyName, '')
      ELSE
        SETRANGE("Receiving Company", LocCompanyName);
    END;

    BEGIN
    END.
  }
}

