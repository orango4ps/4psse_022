OBJECT Table 11072040 Segment Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.03,4PS14.00 (5077);
  }
  PROPERTIES
  {
    OnDelete=VAR
               SegLine@1001 : Record 11072040;
               SegmentCriteriaLine@1002 : Record 11072048;
               SegmentHistory@1003 : Record 11072041;
               SegInteractLanguage@1005 : Record 5104;
               Task@1000 : Record 5080;
             BEGIN
               CampaignTargetGrMgt.DeleteSegfromTargetGr(Rec);

               SegInteractLanguage.RESET;
               SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
               SegInteractLanguage.SETRANGE("Segment Line No.","Line No.");
               SegInteractLanguage.DELETEALL(TRUE);
               GET("Segment No.","Line No.");

               SegLine.SETRANGE("Segment No.","Segment No.");
               SegLine.SETFILTER("Line No.",'<>%1',"Line No.");
               IF SegLine.ISEMPTY THEN BEGIN
                 IF SegHeader.GET("Segment No.") THEN
                   SegHeader.CALCFIELDS("No. of Criteria Actions");
                 IF SegHeader."No. of Criteria Actions" > 1 THEN
                   IF CONFIRM(Text006,TRUE) THEN BEGIN
                     SegmentCriteriaLine.SETRANGE("Segment No.","Segment No.");
                     SegmentCriteriaLine.DELETEALL;
                     SegmentHistory.SETRANGE("Segment No.","Segment No.");
                     // SegmentHistory.DELETEALL;  //**4PS.o
                     SegmentHistory.DELETEALL(TRUE);  //**4PS.n
                   END;
               END;
               IF "Contact No." <> '' THEN BEGIN
                 SegLine.SETRANGE("Contact No.","Contact No.");
                 IF SegLine.ISEMPTY THEN BEGIN
                   Task.SETRANGE("Segment No.","Segment No.");
                   Task.SETRANGE("Contact No.","Contact No.");
                   Task.MODIFYALL("Segment No.",'');
                 END;
               END;
             END;

    CaptionML=[DEU=Segmentszeile;
               ENU=Segment Line;
               NLD=Segmentregel;
               NOR=Segmentrad;
               SVE=Segmentrad];
  }
  FIELDS
  {
    { 1   ;   ;Segment No.         ;Code20        ;TableRelation="Segment Header";
                                                   CaptionML=[DEU=Segmentnr.;
                                                              ENU=Segment No.;
                                                              NLD=Segmentnr.;
                                                              NOR=Segmentnr.;
                                                              SVE=Segmentnr] }
    { 2   ;   ;Line No.            ;Integer       ;CaptionML=[DEU=Zeilennr.;
                                                              ENU=Line No.;
                                                              NLD=Regelnr.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 3   ;   ;Contact No.         ;Code20        ;TableRelation=Contact WHERE (Blocked=CONST(No));
                                                   OnValidate=VAR
                                                                SegInteractLanguage@1000 : Record 5104;
                                                                Attachment@1001 : Record 11072030;
                                                                InteractTmpl@1002 : Record 11072032;
                                                              BEGIN
                                                                InitLine;

                                                                IF Cont.GET("Contact No.") THEN BEGIN
                                                                  "Language Code" := FindLanguage("Interaction Template Code",Cont."Language Code");
                                                                  "Contact Company No." := Cont."Company No.";
                                                                  "Contact Alt. Address Code" := Cont.ActiveAltAddress(Date);
                                                                  IF SegHeader.GET("Segment No.") THEN BEGIN
                                                                    IF SegHeader."Salesperson Code" = '' THEN
                                                                      "Salesperson Code" := Cont."Salesperson Code"
                                                                    ELSE
                                                                      "Salesperson Code" := SegHeader."Salesperson Code";
                                                                    IF SegHeader."Ignore Contact Corres. Type" AND
                                                                       (SegHeader."Correspondence Type (Default)" <> SegHeader."Correspondence Type (Default)"::" ")
                                                                    THEN
                                                                      "Correspondence Type" := SegHeader."Correspondence Type (Default)"
                                                                    ELSE
                                                                      IF InteractTmpl.GET(SegHeader."Interaction Template Code") AND
                                                                         (InteractTmpl."Ignore Contact Corres. Type" OR
                                                                          ((InteractTmpl."Ignore Contact Corres. Type" = FALSE) AND
                                                                           (Cont."Correspondence Type" = Cont."Correspondence Type"::" ")))
                                                                      THEN
                                                                        "Correspondence Type" := InteractTmpl."Correspondence Type (Default)"
                                                                      ELSE
                                                                        "Correspondence Type" := Cont."Correspondence Type";
                                                                  END ELSE
                                                                    IF NOT Salesperson.GET(GETFILTER("Salesperson Code")) THEN
                                                                      "Salesperson Code" := Cont."Salesperson Code";
                                                                END ELSE BEGIN
                                                                  "Contact Company No." := '';
                                                                  "Contact Alt. Address Code" := '';
                                                                  IF SegHeader.GET("Segment No.") THEN
                                                                    "Salesperson Code" := SegHeader."Salesperson Code"
                                                                  ELSE BEGIN
                                                                    "Salesperson Code" := '';
                                                                    "Language Code" := '';
                                                                  END;
                                                                END;
                                                                CALCFIELDS("Contact Name","Contact Company Name");

                                                                IF "Segment No." <> '' THEN BEGIN
                                                                  IF UniqueAttachmentExists THEN BEGIN
                                                                    MODIFY;
                                                                    SegInteractLanguage.RESET;
                                                                    SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
                                                                    SegInteractLanguage.SETRANGE("Segment Line No.","Line No.");
                                                                    SegInteractLanguage.DELETEALL(TRUE);
                                                                    GET("Segment No.","Line No.");
                                                                  END;

                                                                  "Language Code" := FindLanguage("Interaction Template Code","Language Code");
                                                                  IF SegInteractLanguage.GET("Segment No.",0,"Language Code") THEN BEGIN
                                                                    IF Attachment.GET(SegInteractLanguage."Attachment No.") THEN
                                                                      "Attachment No." := SegInteractLanguage."Attachment No.";
                                                                    Subject := SegInteractLanguage.Subject;
                                                                  END;
                                                                END;

                                                                IF xRec."Contact No." <> "Contact No." THEN
                                                                BEGIN //**4PS.n
                                                                  SetCampaignTargetGroup;
                                                                //**4PS.sn
                                                                  FillContactaltAddresscode;
                                                                END;
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[DEU=Kontaktnr.;
                                                              ENU=Contact No.;
                                                              NLD=Relatienr.;
                                                              NOR=Kontaktnr;
                                                              SVE=Kontaktnr] }
    { 4   ;   ;Campaign No.        ;Code20        ;TableRelation=Campaign;
                                                   OnValidate=BEGIN
                                                                IF xRec."Campaign No." <> "Campaign No." THEN
                                                                  SetCampaignTargetGroup;
                                                              END;

                                                   CaptionML=[DEU=Kampagnennr.;
                                                              ENU=Campaign No.;
                                                              NLD=Campagnenr.;
                                                              NOR=Kampanjenr.;
                                                              SVE=Kampanjnr] }
    { 5   ;   ;Salesperson Code    ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[DEU=VerkÑufercode;
                                                              ENU=Salesperson Code;
                                                              NLD=Verkoper;
                                                              NOR=Selgerkode;
                                                              SVE=SÑljarkod] }
    { 6   ;   ;Correspondence Type ;Option        ;OnValidate=VAR
                                                                Attachment@1000 : Record 11072030;
                                                                ErrorText@1001 : Text[80];
                                                              BEGIN
                                                                IF NOT Attachment.GET("Attachment No.") THEN
                                                                  EXIT;

                                                                ErrorText := Attachment.CheckCorrespondenceType("Correspondence Type");
                                                                IF ErrorText <> '' THEN
                                                                  ERROR(
                                                                    STRSUBSTNO('%1%2',
                                                                      STRSUBSTNO(Text000,FIELDCAPTION("Correspondence Type"),"Correspondence Type",TABLECAPTION,"Line No."),
                                                                      ErrorText));
                                                              END;

                                                   CaptionML=[DEU=Korrespondenzart;
                                                              ENU=Correspondence Type;
                                                              NLD=Correspondentietype;
                                                              NOR=Korrespondansetype;
                                                              SVE=Korrespondenstyp];
                                                   OptionCaptionML=[DEU=" ,Ausdruck,E-Mail,Fax";
                                                                    ENU=" ,Hard Copy,Email,Fax";
                                                                    NLD=" ,Afdruk,E-mail,Fax";
                                                                    NOR=" ,Brev,E-post,Faks";
                                                                    SVE=" ,Utskrift,E-post,Fax"];
                                                   OptionString=[ ,Hard Copy,Email,Fax] }
    { 7   ;   ;Interaction Template Code;Code10   ;TableRelation="Interaction Template";
                                                   OnValidate=VAR
                                                                SegInteractLanguage@1001 : Record 5104;
                                                                InteractTemplLanguage@1002 : Record 5103;
                                                                InteractTmpl@1003 : Record 11072032;
                                                              BEGIN
                                                                TESTFIELD("Contact No.");
                                                                Cont.GET("Contact No.");
                                                                "Attachment No." := 0;
                                                                "Language Code" := '';
                                                                Subject := '';
                                                                "Correspondence Type" := "Correspondence Type"::" ";
                                                                "Interaction Group Code" := '';
                                                                "Cost (LCY)" := 0;
                                                                "Duration (Min.)" := 0;
                                                                "Information Flow" := "Information Flow"::" ";
                                                                "Initiated By" := "Initiated By"::" ";
                                                                "Campaign Target" := FALSE;
                                                                "Campaign Response" := FALSE;
                                                                "Correspondence Type" := "Correspondence Type"::" ";
                                                                IF (GETFILTER("Campaign No.") = '') AND (InteractTmpl."Campaign No." <> '') THEN
                                                                  "Campaign No." := '';
                                                                MODIFY;

                                                                IF "Segment No." <> '' THEN BEGIN
                                                                  SegInteractLanguage.RESET;
                                                                  SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
                                                                  SegInteractLanguage.SETRANGE("Segment Line No.","Line No.");
                                                                  SegInteractLanguage.DELETEALL(TRUE);
                                                                  GET("Segment No.","Line No.");
                                                                  IF "Interaction Template Code" <> '' THEN BEGIN
                                                                    SegHeader.GET("Segment No.");
                                                                    IF "Interaction Template Code" <> SegHeader."Interaction Template Code" THEN BEGIN
                                                                      SegHeader.CreateSegInteractions("Interaction Template Code","Segment No.","Line No.");
                                                                      "Language Code" := FindLanguage("Interaction Template Code",Cont."Language Code");
                                                                      IF SegInteractLanguage.GET("Segment No.","Line No.","Language Code") THEN
                                                                        "Attachment No." := SegInteractLanguage."Attachment No.";
                                                                    END ELSE BEGIN
                                                                      "Language Code" := FindLanguage("Interaction Template Code",Cont."Language Code");
                                                                      IF SegInteractLanguage.GET("Segment No.",0,"Language Code") THEN
                                                                        "Attachment No." := SegInteractLanguage."Attachment No.";
                                                                    END;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  "Language Code" := FindLanguage("Interaction Template Code",Cont."Language Code");
                                                                  IF InteractTemplLanguage.GET("Interaction Template Code","Language Code") THEN
                                                                    "Attachment No." := InteractTemplLanguage."Attachment No.";
                                                                END;

                                                                IF InteractTmpl.GET("Interaction Template Code") THEN BEGIN
                                                                  "Interaction Group Code" := InteractTmpl."Interaction Group Code";
                                                                  IF Description = '' THEN
                                                                    Description := InteractTmpl.Description;
                                                                  "Cost (LCY)" := InteractTmpl."Unit Cost (LCY)";
                                                                  "Duration (Min.)" := InteractTmpl."Unit Duration (Min.)";
                                                                  "Information Flow" := InteractTmpl."Information Flow";
                                                                  "Initiated By" := InteractTmpl."Initiated By";
                                                                  "Campaign Target" := InteractTmpl."Campaign Target";
                                                                  "Campaign Response" := InteractTmpl."Campaign Response";

                                                                  CASE TRUE OF
                                                                    SegHeader."Ignore Contact Corres. Type" AND
                                                                    (SegHeader."Correspondence Type (Default)" <> SegHeader."Correspondence Type (Default)"::" "):
                                                                      "Correspondence Type" := SegHeader."Correspondence Type (Default)";
                                                                    InteractTmpl."Ignore Contact Corres. Type" OR
                                                                    ((InteractTmpl."Ignore Contact Corres. Type" = FALSE) AND
                                                                     (Cont."Correspondence Type" = Cont."Correspondence Type"::" ") AND
                                                                     (InteractTmpl."Correspondence Type (Default)" <> InteractTmpl."Correspondence Type (Default)"::" ")):
                                                                      "Correspondence Type" := InteractTmpl."Correspondence Type (Default)";
                                                                    ELSE
                                                                      IF Cont."Correspondence Type" <> Cont."Correspondence Type"::" " THEN
                                                                        "Correspondence Type" := Cont."Correspondence Type"
                                                                      ELSE
                                                                        "Correspondence Type" := xRec."Correspondence Type";
                                                                  END;
                                                                  IF SegHeader."Campaign No." <> '' THEN
                                                                    "Campaign No." := SegHeader."Campaign No."
                                                                  ELSE
                                                                    IF (GETFILTER("Campaign No.") = '') AND (InteractTmpl."Campaign No." <> '') THEN
                                                                      "Campaign No." := InteractTmpl."Campaign No.";
                                                                END;
                                                                IF Campaign.GET("Campaign No.") THEN
                                                                  "Campaign Description" := Campaign.Description;

                                                                MODIFY;
                                                              END;

                                                   CaptionML=[DEU=AktivitÑtenvorlagencode;
                                                              ENU=Interaction Template Code;
                                                              NLD=Interactiesjablooncode;
                                                              NOR=Interaksjonsmalkode;
                                                              SVE=Interaktionsmallkod] }
    { 8   ;   ;Cost (LCY)          ;Decimal       ;CaptionML=[DEU=Einstandsbetrag (MW);
                                                              ENU=Cost (LCY);
                                                              NLD=Kosten (LV);
                                                              NOR=Kostnad (NOK);
                                                              SVE=Kostnad (BVA)];
                                                   MinValue=0;
                                                   AutoFormatType=1 }
    { 9   ;   ;Duration (Min.)     ;Decimal       ;CaptionML=[DEU=Dauer (Min.);
                                                              ENU=Duration (Min.);
                                                              NLD=Duur (Min.);
                                                              NOR=Varighet (Min.);
                                                              SVE=Varaktighet (Min.)];
                                                   DecimalPlaces=0:0;
                                                   MinValue=0 }
    { 10  ;   ;Attachment No.      ;Integer       ;TableRelation=Attachment;
                                                   CaptionML=[DEU=Dateianhangsnr.;
                                                              ENU=Attachment No.;
                                                              NLD=Bijlagenr.;
                                                              NOR=Vedleggsnr.;
                                                              SVE=Bilagenr] }
    { 11  ;   ;Campaign Response   ;Boolean       ;CaptionML=[DEU=Kampagnenreaktion;
                                                              ENU=Campaign Response;
                                                              NLD=Campagnerespons;
                                                              NOR=Kampanjerepons;
                                                              SVE=Kampanjsvar] }
    { 12  ;   ;Contact Name        ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact No.),
                                                                                          Type=CONST(Person)));
                                                   CaptionML=[DEU=Kontaktname;
                                                              ENU=Contact Name;
                                                              NLD=Relatienaam;
                                                              NOR=Kontaktnavn;
                                                              SVE=Kontaktnamn];
                                                   Editable=No }
    { 13  ;   ;Information Flow    ;Option        ;CaptionML=[DEU=Informationsfluss;
                                                              ENU=Information Flow;
                                                              NLD=Informatiestroom;
                                                              NOR=Informasjonsflyt;
                                                              SVE=Informationsflîde];
                                                   OptionCaptionML=[DEU=" ,Ausgehend,Eingehend";
                                                                    ENU=" ,Outbound,Inbound";
                                                                    NLD=" ,Uitgaand,Inkomend";
                                                                    NOR=" ,UtgÜende,Innkommende";
                                                                    SVE=" ,AvgÜende,Ankommande"];
                                                   OptionString=[ ,Outbound,Inbound];
                                                   BlankZero=Yes }
    { 14  ;   ;Initiated By        ;Option        ;CaptionML=[DEU=Veranlasst durch;
                                                              ENU=Initiated By;
                                                              NLD=Gestart door;
                                                              NOR=Initiert av;
                                                              SVE=Initierat av];
                                                   OptionCaptionML=[DEU=" ,Wir,Sie";
                                                                    ENU=" ,Us,Them";
                                                                    NLD=" ,Wij,Zij";
                                                                    NOR=" ,Oss,Dem";
                                                                    SVE=" ,Internt,Externt"];
                                                   OptionString=[ ,Us,Them];
                                                   BlankZero=Yes }
    { 15  ;   ;Contact Alt. Address Code;Code10   ;TableRelation="Contact Alt. Address".Code WHERE (Contact No.=FIELD(Contact No.));
                                                   CaptionML=[DEU=Alt. Kontaktadresscode;
                                                              ENU=Contact Alt. Address Code;
                                                              NLD=Contact alt. adrescode;
                                                              NOR=Kontaktens alt. adresse - kode;
                                                              SVE=Kontakt alt. adresskod] }
    { 16  ;   ;Evaluation          ;Option        ;CaptionML=[DEU=Bewertung;
                                                              ENU=Evaluation;
                                                              NLD=Evaluatie;
                                                              NOR=Evaluering;
                                                              SVE=UtvÑrdering];
                                                   OptionCaptionML=[DEU=" ,Sehr positiv,Positiv,Neutral,Negativ,Sehr negativ";
                                                                    ENU=" ,Very Positive,Positive,Neutral,Negative,Very Negative";
                                                                    NLD=" ,Zeer positief,Positief,Neutraal,Negatief,Zeer negatief";
                                                                    NOR=" ,Veldig positiv,Positiv,Nõytral,Negativ,Veldig Negativ";
                                                                    SVE=" ,Mycket positiv,Positiv,Neutral,Negativ,Mycket negativ"];
                                                   OptionString=[ ,Very Positive,Positive,Neutral,Negative,Very Negative] }
    { 17  ;   ;Campaign Target     ;Boolean       ;OnValidate=BEGIN
                                                                IF xRec."Campaign Target" <> "Campaign Target" THEN
                                                                  SetCampaignTargetGroup;
                                                              END;

                                                   CaptionML=[DEU=Kampagnenziel;
                                                              ENU=Campaign Target;
                                                              NLD=Campagnedoel;
                                                              NOR=KampanjemÜl;
                                                              SVE=KampanjmÜl] }
    { 18  ;   ;Contact Company Name;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact Company No.),
                                                                                          Type=CONST(Company)));
                                                   CaptionML=[DEU=Name Kontaktunternehmen;
                                                              ENU=Contact Company Name;
                                                              NLD=Bedrijfsnaam relatie;
                                                              NOR=Kontaktselskap navn;
                                                              SVE=Kontaktfîretag namn];
                                                   Editable=No }
    { 19  ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   OnValidate=VAR
                                                                SegInteractLanguage@1002 : Record 5104;
                                                                InteractTemplLanguage@1001 : Record 5103;
                                                              BEGIN
                                                                TESTFIELD("Interaction Template Code");

                                                                IF "Language Code" = xRec."Language Code" THEN
                                                                  EXIT;

                                                                IF SegHeader.GET("Segment No.") THEN BEGIN
                                                                  IF NOT UniqueAttachmentExists THEN BEGIN
                                                                    IF SegInteractLanguage.GET("Segment No.",0,"Language Code") THEN BEGIN
                                                                      "Attachment No." := SegInteractLanguage."Attachment No.";
                                                                      Subject := SegInteractLanguage.Subject;
                                                                    END ELSE BEGIN
                                                                      "Attachment No." := 0;
                                                                      Subject := '';
                                                                    END;
                                                                  END ELSE
                                                                    IF SegInteractLanguage.GET("Segment No.","Line No.","Language Code") THEN BEGIN
                                                                      "Attachment No." := SegInteractLanguage."Attachment No.";
                                                                      Subject := SegInteractLanguage.Subject;
                                                                    END ELSE BEGIN
                                                                      "Attachment No." := 0;
                                                                      Subject := '';
                                                                    END;
                                                                  MODIFY;
                                                                END ELSE BEGIN
                                                                  InteractTemplLanguage.GET("Interaction Template Code","Language Code");
                                                                  SetInteractionAttachment;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LanguageCodeOnLookup;
                                                            END;

                                                   CaptionML=[DEU=Sprachcode;
                                                              ENU=Language Code;
                                                              NLD=Taal;
                                                              NOR=SprÜkkode;
                                                              SVE=SprÜkkod] }
    { 22  ;   ;Description         ;Text100       ;CaptionML=[DEU=Beschreibung;
                                                              ENU=Description;
                                                              NLD=Omschrijving;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 23  ;   ;Date                ;Date          ;OnValidate=BEGIN
                                                                IF Cont.GET("Contact No.") THEN
                                                                  IF "Contact Alt. Address Code" = Cont.ActiveAltAddress(xRec.Date) THEN
                                                                    "Contact Alt. Address Code" := Cont.ActiveAltAddress(Date);
                                                              END;

                                                   CaptionML=[DEU=Datum;
                                                              ENU=Date;
                                                              NLD=Datum;
                                                              NOR=Dato;
                                                              SVE=Datum] }
    { 24  ;   ;Time of Interaction ;Time          ;CaptionML=[DEU=Uhrzeit;
                                                              ENU=Time of Interaction;
                                                              NLD=Interactietijd;
                                                              NOR=Tid for Interaksjon;
                                                              SVE=InteraktionsupplÑggning] }
    { 25  ;   ;Attempt Failed      ;Boolean       ;CaptionML=[DEU=Nicht erreicht;
                                                              ENU=Attempt Failed;
                                                              NLD=Poging mislukt;
                                                              NOR=Forsõket mislyktes;
                                                              SVE=Fîrsîket misslyckades] }
    { 26  ;   ;To-do No.           ;Code20        ;TableRelation=To-do;
                                                   CaptionML=[DEU=Aufgabennr.;
                                                              ENU=Task No.;
                                                              NLD=Taaknr.;
                                                              NOR=Oppgavenr.;
                                                              SVE=Uppgiftsnr.] }
    { 27  ;   ;Contact Company No. ;Code20        ;TableRelation=Contact WHERE (Type=CONST(Company),
                                                                                Blocked=CONST(No));
                                                   CaptionML=[DEU=Kontaktunternehmensnummer;
                                                              ENU=Contact Company No.;
                                                              NLD=Bedrijfsnr. relatie;
                                                              NOR=Kontakt selskapsnr.;
                                                              SVE=Kontaktfîretag nr] }
    { 28  ;   ;Campaign Entry No.  ;Integer       ;TableRelation="Campaign Entry";
                                                   CaptionML=[DEU=Kampagnenposten Lfd. Nr.;
                                                              ENU=Campaign Entry No.;
                                                              NLD=Campagnepostnr.;
                                                              NOR=Kampanjetranaksjonsnr.;
                                                              SVE=Kampanjlîpnr];
                                                   Editable=No }
    { 29  ;   ;Interaction Group Code;Code10      ;TableRelation="Interaction Group";
                                                   CaptionML=[DEU=AktivitÑtengruppencode;
                                                              ENU=Interaction Group Code;
                                                              NLD=Interactiegroepscode;
                                                              NOR=Interaksjonsgruppekode;
                                                              SVE=Interaktionsgruppkod] }
    { 31  ;   ;Document Type       ;Option        ;CaptionML=[DEU=Belegart;
                                                              ENU=Document Type;
                                                              NLD=Documenttype;
                                                              NOR=Bilagstype;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=[DEU=" ,Angebot,Rahmenauftrag,Auftragsbest.,VK-Rech.,VK-Liefersch.,VK-Gutschr.,Kontoausz.,Mahnung,Serv.-Auftr. erst.,Serv.-Auftr. buchen,Anfrage,Rahmenbestellung,Bestellung,EK-Rech.,EK-Liefersch.,EK-Gutschr.,Deckblatt";
                                                                    ENU=" ,Sales Qte.,Sales Blnkt. Ord,Sales Ord. Cnfrmn.,Sales Inv.,Sales Shpt. Note,Sales Cr. Memo,Sales Stmnt.,Sales Rmdr.,Serv. Ord. Create,Serv. Ord. Post,Purch.Qte.,Purch. Blnkt. Ord.,Purch. Ord.,Purch. Inv.,Purch. Rcpt.,Purch. Cr. Memo,Cover Sheet";
                                                                    NLD=" ,Verk.-offerte,Verk.-afroepcontract,Verk.-orderbevestiging,Verk.-factuur,Verk.-verzendbon,Verk.-creditnota,Verk.-afschrift,Verk.-aanmaning,Serviceorder maken,Serviceorder boeken,Ink.-offerte,Ink.-afroepcontract,Ink.-order,Ink.-factuur,Ink.-ontvangst,Ink.-creditnota,Contactkaart";
                                                                    NOR=" ,Salgstilbud,Salgsrammeordre,Salgsordrebekreftelse,Salgsfaktura,Salgsforsendelse,Salgskreditnota,Salgsrapport,Salgsbet.pÜm.,Opprette serv.ordre,Bokfõr serv.ordre,Innkjõpstilbud,Innkjõpsrammeordre,Innkjõpsordre,Innkjõpsfaktura,Innkjõpsmottak,Inkj. kreditnota,Fõlgebrev";
                                                                    SVE=" ,Offert,Avropsorder,OrderbekrÑftelse,Fîrs.faktura,Leverans,Fîrs.kreditnota,Rapport,Bet.pÜm.,Skapa serv.order,Bokfîr serv.order,Inkîpsoffert,Ink. avropsorder,Inkîpsorder,Inkîpsfaktura,Inleverans,Ink. kreditnota,Meddelande"];
                                                   OptionString=[ ,Sales Qte.,Sales Blnkt. Ord,Sales Ord. Cnfrmn.,Sales Inv.,Sales Shpt. Note,Sales Cr. Memo,Sales Stmnt.,Sales Rmdr.,Serv. Ord. Create,Serv. Ord. Post,Purch.Qte.,Purch. Blnkt. Ord.,Purch. Ord.,Purch. Inv.,Purch. Rcpt.,Purch. Cr. Memo,Cover Sheet];
                                                   Description=4PS: Raam  -> Afroep }
    { 32  ;   ;Document No.        ;Code20        ;TestTableRelation=No;
                                                   CaptionML=[DEU=Belegnr.;
                                                              ENU=Document No.;
                                                              NLD=Documentnr.;
                                                              NOR=Bilagsnr.;
                                                              SVE=Dokumentnr] }
    { 33  ;   ;Send Word Doc. As Attmt.;Boolean   ;CaptionML=[DEU=Word-Dokument als Anh. senden;
                                                              ENU=Send Word Doc. As Attmt.;
                                                              NLD=Word-doc. als bijlage verzenden;
                                                              NOR=Send Word-dok. som vedlegg;
                                                              SVE=Skicka Word-dok. som bilaga] }
    { 34  ;   ;Contact Via         ;Text80        ;CaptionML=[DEU=Kontaktieren Åber;
                                                              ENU=Contact Via;
                                                              NLD=Contact opnemen via;
                                                              NOR=Kontakt via;
                                                              SVE=Kontakt via] }
    { 35  ;   ;Version No.         ;Integer       ;CaptionML=[DEU=Versionsnr.;
                                                              ENU=Version No.;
                                                              NLD=Versienr.;
                                                              NOR=Versjonsnr.;
                                                              SVE=Versionsnr] }
    { 36  ;   ;Doc. No. Occurrence ;Integer       ;CaptionML=[DEU=Belegnr.-HÑufigkeit;
                                                              ENU=Doc. No. Occurrence;
                                                              NLD=Aantal voorkomens doc.-nr.;
                                                              NOR=Dokumentnr. Forekomst;
                                                              SVE=Dok.nr fîrekomst] }
    { 37  ;   ;Subject             ;Text100       ;CaptionML=[DEU=Betreff;
                                                              ENU=Subject;
                                                              NLD=Onderwerp;
                                                              NOR=Emne;
                                                              SVE=AngÜende] }
    { 44  ;   ;Opportunity No.     ;Code20        ;TableRelation=Opportunity;
                                                   CaptionML=[DEU=Verkaufschancennr.;
                                                              ENU=Opportunity No.;
                                                              NLD=Opportunitynr.;
                                                              NOR=Salgsmulighetsnr.;
                                                              SVE=AffÑrsmîjlighetsnr] }
    { 9501;   ;Wizard Step         ;Option        ;CaptionML=[DEU=Assistentenschritt;
                                                              ENU=Wizard Step;
                                                              NLD=Wizardstap;
                                                              NOR=Trinn i veiviser;
                                                              SVE=Guidesteg];
                                                   OptionCaptionML=[DEU=" ,1,2,3,4,5,6";
                                                                    ENU=" ,1,2,3,4,5,6";
                                                                    NLD=" ,1,2,3,4,5,6";
                                                                    NOR=" ,1,2,3,4,5,6";
                                                                    SVE=" ,1,2,3,4,5,6"];
                                                   OptionString=[ ,1,2,3,4,5,6];
                                                   Editable=No }
    { 9502;   ;Wizard Contact Name ;Text100       ;CaptionML=[DEU=Assistent fÅr Kontaktname;
                                                              ENU=Wizard Contact Name;
                                                              NLD=Naam contactpersoon wizard;
                                                              NOR=Kontaktnavn for veiviser;
                                                              SVE=Kontaktnamn, guide] }
    { 9503;   ;Opportunity Description;Text100    ;CaptionML=[DEU=Verkaufschancenbeschreibung;
                                                              ENU=Opportunity Description;
                                                              NLD=Opportunityomschrijving;
                                                              NOR=Beskrivelse av salgsmulighet;
                                                              SVE=Beskrivning av affÑrsmîjlighet] }
    { 9504;   ;Campaign Description;Text100       ;CaptionML=[DEU=Kampagnenbeschreibung;
                                                              ENU=Campaign Description;
                                                              NLD=Campagneomschrijving;
                                                              NOR=Kampanjebeskrivelse;
                                                              SVE=Kampanjbeskrivning] }
    { 9505;   ;Interaction Successful;Boolean     ;CaptionML=[DEU=Interaktion erfolgreich;
                                                              ENU=Interaction Successful;
                                                              NLD=Interactie geslaagd;
                                                              NOR=Interaksjonen var vellykket;
                                                              SVE=Interaktionen har slutfîrts] }
    { 9506;   ;Dial Contact        ;Boolean       ;CaptionML=[DEU=Kontakt anrufen;
                                                              ENU=Dial Contact;
                                                              NLD=Contact opbellen;
                                                              NOR=Ring kontakt;
                                                              SVE=Ring kontaktperson] }
    { 9507;   ;Mail Contact        ;Boolean       ;CaptionML=[DEU=Kontakt anschreiben;
                                                              ENU=Mail Contact;
                                                              NLD=Contact e-mailen;
                                                              NOR=Send e-post til kontakt;
                                                              SVE=Skicka e-post till kontaktperson] }
    { 11012000;;Optional Mergefield 1;Text80      ;CaptionML=[DEU=ZusÑtzl. Seriendruckfeld 1;
                                                              ENU=Optional Mergefield 1;
                                                              NLD=Extra samenvoegveld 1;
                                                              NOR=Valgfritt flettefelt 1;
                                                              SVE=Valfritt kopplingsfÑlt 1] }
    { 11012001;;Optional Mergefield 2;Text80      ;CaptionML=[DEU=ZusÑtzl. Seriendruckfeld 2;
                                                              ENU=Optional Mergefield 2;
                                                              NLD=Extra samenvoegveld 2;
                                                              NOR=Valgfritt Koblingsfelt 2;
                                                              SVE=Valfritt kopplingsfÑlt 2] }
    { 11012002;;Optional Mergefield 3;Text80      ;CaptionML=[DEU=ZusÑtzl. Seriendruckfeld 3;
                                                              ENU=Optional Mergefield 3;
                                                              NLD=Extra samenvoegveld 3;
                                                              NOR=Valgfritt Koblingsfelt 3;
                                                              SVE=Valfritt kopplingsfÑlt 3] }
    { 11012003;;Optional Mergefield 4;Text80      ;CaptionML=[DEU=ZusÑtzl. Seriendruckfeld 4;
                                                              ENU=Optional Mergefield 4;
                                                              NLD=Extra samenvoegveld 4;
                                                              NOR=Valgfritt Koblingsfelt 4;
                                                              SVE=Valfritt kopplingsfÑlt 4] }
    { 11012004;;Optional Mergefield 5;Text80      ;CaptionML=[DEU=ZusÑtzl. Seriendruckfeld 5;
                                                              ENU=Optional Mergefield 5;
                                                              NLD=Extra samenvoegveld 5;
                                                              NOR=Valgfritt Koblingsfelt 5;
                                                              SVE=Valfritt kopplingsfÑlt 5] }
    { 11012010;;Phone Call Result Code;Code20     ;TableRelation="Phonecall Result";
                                                   CaptionML=[DEU=Anrufergebnis;
                                                              ENU=Phone Call Result Code;
                                                              NLD=Belresultaat;
                                                              NOR=Resultatkode for telefonsamtale;
                                                              SVE=Resultatkod fîr telefonsamtal] }
    { 11012020;;Customer No.       ;Code20        ;TableRelation=Customer;
                                                   CaptionML=[DEU=Debitorennr.;
                                                              ENU=Customer No.;
                                                              NLD=Klantnr.;
                                                              NOR=Kundenr.;
                                                              SVE=Kundnr] }
    { 11012917;;Project No.        ;Code20        ;TableRelation=Job;
                                                   CaptionML=[DEU=Projektnr.;
                                                              ENU=Project No.;
                                                              NLD=Projectnr.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr];
                                                   Editable=No }
    { 11012918;;Plot No.           ;Code10        ;TableRelation=Plot."Plot No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[DEU=Baunr.;
                                                              ENU=Plot No.;
                                                              NLD=Bouwnummer;
                                                              NOR=Tegningnr;
                                                              SVE=Ritningnr];
                                                   Editable=No }
    { 11012919;;Project Description;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[DEU=Projektbeschreibung;
                                                              ENU=Project Description;
                                                              NLD=Project omschrijving;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 11012920;;House Model        ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Plot."House Model" WHERE (Project No.=FIELD(Project No.),
                                                                                                Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[DEU=Wohnungsmodell;
                                                              ENU=House Model;
                                                              NLD=Woningmodel;
                                                              NOR=Husmodell;
                                                              SVE=Husmodell];
                                                   Editable=No }
    { 11012921;;Delivery No.       ;Code20        ;TableRelation=Delivery."Delivery No." WHERE (Project No.=FIELD(Project No.),
                                                                                                Plot No.=FIELD(Plot No.));
                                                   CaptionML=[DEU=öbergabenr.;
                                                              ENU=Delivery No.;
                                                              NLD=Oplevernr.;
                                                              NOR=Leveransenr.;
                                                              SVE=Leveransnr];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Segment No.,Line No.                    ;MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Segment No.,Campaign No.,Date            }
    {    ;Contact No.,Segment No.                  }
    {    ;Campaign No.                             }
    {    ;Campaign No.,Contact Company No.,Campaign Target }
    {    ;Segment No.,Contact Company No.          }
    {    ;Segment No.,Project No.,Plot No.         }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'DEU="Die %1 = %2 kann fÅr %3 %4 nicht angegeben werden.\";ENU="%1 = %2 can not be specified for %3 %4.\";NLD="%1 = %2 kan niet opgegeven worden voor %3 %4.\";NOR="%1 = %2 kan ikke spesifiseres for %3 %4.\";SVE="%1 = %2 kan inte specificeras fîr %3 %4.\"';
      Text001@1001 : TextConst 'DEU=öbernommen;ENU=Inherited;NLD=Overgenomen;NOR=Arvet;SVE=érvd';
      Text002@1002 : TextConst 'DEU=Einmalig;ENU=Unique;NLD=Uniek;NOR=Unik;SVE=Unik';
      SegHeader@1006 : Record 11072039;
      Cont@1007 : Record 5050;
      Salesperson@1008 : Record 13;
      Campaign@1013 : Record 11072034;
      InteractTmpl@1003 : Record 11072032;
      Attachment@1005 : Record 11072030;
      TempAttachment@1004 : TEMPORARY Record 11072030;
      InterLogEntryCommentLine@1017 : Record 11072067;
      TempInterLogEntryCommentLine@1018 : TEMPORARY Record 11072067;
      OptionalMergeFieldRec@1210190001 : Record 11012145;
      ContactAltAdressRec@1100485000 : Record 5051;
      AttachmentManagement@1010 : Codeunit 11072021;
      ClientTypeManagement@1077 : Codeunit 4030;
      Text005@1023 : TextConst 'DEU=Sie mÅssen das Feld %1 ausfÅllen.;ENU=You must fill in the %1 field.;NLD=U moet het veld %1 invullen.;NOR=Du mÜ fylle ut feltet %1.;SVE=Du mÜste fylla i fÑltet %1.';
      Text004@1012 : TextConst 'DEU=Das Programm hat den Import des Dateianhangs auf Ihren Befehl abgebrochen.;ENU=The program has stopped importing the attachment at your request.;NLD=Het programma is gestopt met het importeren van de verzochte bijlage.;NOR=Programmet har stoppet importen av vedleggene etter din forespõrsel.;SVE=Programmet har stoppat importen av bilagan pÜ din begÑran.';
      Text006@1011 : TextConst 'DEU=Das Segment ist nun leer.\Mîchten Sie die Anzahl der Kriterienaktionen zurÅcksetzen?;ENU=Your Segment is now empty.\Do you want to reset number of criteria actions?;NLD=Uw segment is nu leeg.\Wilt u het aantal criteria wissen?;NOR=Segmentet er nÜ tomt.\Vil du nullstille antall kriteriumshandlinger?;SVE=Segmentet Ñr nu tomt.\Vill du ÜterstÑlla antal kriteriumÜtgÑrder?';
      CampaignTargetGrMgt@1014 : Codeunit 7030;
      Mail@1020 : Codeunit 397;
      ResumedAttachmentNo@1015 : Integer;
      Text007@1016 : TextConst 'DEU=Mîchten Sie diese AktivitÑt spÑter abschlie·en?;ENU=Do you want to finish this interaction later?;NLD=Wilt u deze interactie later afmaken?;NOR=Vil du fullfõre denne interaksjonen senere?;SVE=Vill du avsluta interaktionen senare?';
      Text008@1022 : TextConst 'DEU=Sie mÅssen eine AktivitÑtenvorlage mit einem Anhang verwenden.;ENU=You must select an interaction template with an attachment.;NLD=Selecteer een interactiesjabloon met een bijlage.;NOR=Du mÜ velge en interaksjonsmal med et bilag.;SVE=Du mÜste vÑlja en interaktionsmall med en bilaga.';
      Text009@1025 : TextConst 'DEU=WÑhlen Sie einen Kontakt fÅr die Interaktion aus.;ENU=You must select a contact to interact with.;NLD=U moet een contact selecteren voor interactie.;NOR=Du mÜ velge en kontakt som du skal kommunisere med.;SVE=Du mÜste vÑlja en kontakt som du ska kommunicera med.';
      Text013@1024 : TextConst 'DEU=Sie mÅssen die Telefonnr. eingeben.;ENU=You must fill in the phone number.;NLD=Voer het telefoonnummer in.;NOR=Du mÜ fylle ut telefonnummer;SVE=Du mÜste fylla i telefonnr.';
      Text024@1032 : TextConst '@@@="%1=Correspondence Type";DEU=''%1'' kann nicht auf ''%2'' festgelegt werden.;ENU="%1 = %2 cannot be specified.";NLD="%1 = %2 kan niet worden opgegeven.";NOR="%1=%2 kan ikke spesifiseres";SVE="Det gÜr inte att specificera %1=%2."';
      Text025@1033 : TextConst '@@@=%2 - product name;DEU=Die E-Mail konnte aufgrund des folgenden Fehlers nicht gesendet werden: %1.\Hinweis: Falls Sie %2 als Administrator ausfÅhren, mÅssen Sie auch Outlook als Administrator ausfÅhren.;ENU=The email could not be sent because of the following error: %1.\Note: if you run %2 as administrator, you must run Outlook as administrator as well.;NLD=Het e-mailbericht kan niet worden verzonden door de volgende fout: %1.\Opmerking: als u %2 als beheerder uitvoert, moet u Outlook ook als beheerder uitvoeren.;NOR=E-posten kunne ikke sendes pÜ grunn av fõlgende feil: %1.\Obs!  Hvis du kjõrer %2 som administrator, mÜ du kjõre Outlook som administrator ogsÜ.;SVE=Det gick inte att skicka e-postmeddelandet pÜ grund av fîljande fel: %1.\Obs! Om du kîr %2 som administratîr mÜste du Ñven kîra Outlook som administratîr.';
      Text11012000@1210190003 : TextConst 'DEU=Seriendruckfeld;ENU=Merge Field;NLD=Samenvoegveld;NOR=Flett felt;SVE=Koppla fÑlt';
      Text11012001@1100525000 : TextConst 'DEU=Das Feld %1 muss fÅr Aufgaben ausgefÅllt werden, die einem Team zugewiesen sind.;ENU=The %1 field must be filled in for to-dos assigned to a team.;NLD=Het veld %1 moet zijn ingevuld voor taken die aan een team zijn toegewezen.;NOR=Feltet %1 mÜ fylles ut for oppgaver som er tilordnet et team.;SVE=FÑltet %1 mÜste fyllas i fîr uppgifter som har tilldelats ett team.';

    [External]
    PROCEDURE InitLine@1();
    BEGIN
      IF NOT SegHeader.GET("Segment No.") THEN
        EXIT;

      Description := SegHeader.Description;
      "Campaign No." := SegHeader."Campaign No.";
      "Salesperson Code" := SegHeader."Salesperson Code";
      "Correspondence Type" := SegHeader."Correspondence Type (Default)";
      "Interaction Template Code" := SegHeader."Interaction Template Code";
      "Interaction Group Code" := SegHeader."Interaction Group Code";
      "Cost (LCY)" := SegHeader."Unit Cost (LCY)";
      "Duration (Min.)" := SegHeader."Unit Duration (Min.)";
      "Attachment No." := SegHeader."Attachment No.";
      Date := SegHeader.Date;
      "Campaign Target" := SegHeader."Campaign Target";
      "Information Flow" := SegHeader."Information Flow";
      "Initiated By" := SegHeader."Initiated By";
      "Campaign Response" := SegHeader."Campaign Response";
      "Send Word Doc. As Attmt." := SegHeader."Send Word Docs. as Attmt.";

      //**4PS.sn
      "Optional Mergefield 1" := SegHeader."Optional Mergefield 1";
      "Optional Mergefield 2" := SegHeader."Optional Mergefield 2";
      "Optional Mergefield 3" := SegHeader."Optional Mergefield 3";
      "Optional Mergefield 4" := SegHeader."Optional Mergefield 4";
      "Optional Mergefield 5" := SegHeader."Optional Mergefield 5";
      //**4PS.en

      CLEAR(Evaluation);
      OnAfterInitLine(Rec,SegHeader);
    END;

    [External]
    PROCEDURE AttachmentText@5() : Text[30];
    BEGIN
      IF AttachmentInherited THEN
        EXIT(Text001);

      IF "Attachment No." <> 0 THEN
        EXIT(Text002);

      EXIT('');
    END;

    [Internal]
    PROCEDURE MaintainAttachment@9();
    VAR
      Cont@1000 : Record 5050;
      SalutationFormula@1001 : Record 5069;
    BEGIN
      TESTFIELD("Interaction Template Code");

      Cont.GET("Contact No.");
      IF SalutationFormula.GET(Cont."Salutation Code","Language Code",0) THEN;
      IF SalutationFormula.GET(Cont."Salutation Code","Language Code",1) THEN;

      IF "Attachment No." <> 0 THEN
        OpenAttachment
      ELSE
        CreateAttachment;
    END;

    [Internal]
    PROCEDURE CreateAttachment@8();
    VAR
      SegInteractLanguage@1003 : Record 5104;
    BEGIN
      IF NOT SegInteractLanguage.GET("Segment No.","Line No.","Language Code") THEN BEGIN
        SegInteractLanguage.INIT;
        SegInteractLanguage."Segment No." := "Segment No.";
        SegInteractLanguage."Segment Line No." := "Line No.";
        SegInteractLanguage."Language Code" := "Language Code";
        SegInteractLanguage.Description := Description;
        SegInteractLanguage.Subject := Subject;
      END;

      SegInteractLanguage.CreateAttachment;
    END;

    [Internal]
    PROCEDURE OpenAttachment@2();
    VAR
      Attachment@1004 : Record 11072030;
      Attachment2@1003 : Record 11072030;
      SegInteractLanguage@1002 : Record 5104;
      NewAttachmentNo@1000 : Integer;
    BEGIN
      IF "Attachment No." = 0 THEN
        EXIT;

      Attachment.GET("Attachment No.");
      Attachment2 := Attachment;
      Attachment2."Interaction Template Code" := "Interaction Template Code";  //**4PS.n
      Attachment2.SetTemplateCode("Interaction Template Code"); //**4PS.n

      Attachment2.ShowAttachment(Rec,"Segment No." + ' ' + Description,FALSE,TRUE);

      IF AttachmentInherited THEN BEGIN
        NewAttachmentNo := Attachment2."No.";
        IF (Attachment."Last Date Modified" <> Attachment2."Last Date Modified") OR
           (Attachment."Last Time Modified" <> Attachment2."Last Time Modified")
        THEN BEGIN
          SegInteractLanguage.INIT;
          SegInteractLanguage."Segment No." := "Segment No.";
          SegInteractLanguage."Segment Line No." := "Line No.";
          SegInteractLanguage."Language Code" := "Language Code";
          SegInteractLanguage.Description := Description;
          SegInteractLanguage.Subject := Subject;
          SegInteractLanguage."Attachment No." := NewAttachmentNo;
          SegInteractLanguage.INSERT(TRUE);
          GET("Segment No.","Line No.");
          "Attachment No." := NewAttachmentNo;
          MODIFY;
        END;
      END
    END;

    [Internal]
    PROCEDURE ImportAttachment@3();
    VAR
      SegInteractLanguage@1003 : Record 5104;
    BEGIN
      IF NOT SegInteractLanguage.GET("Segment No.","Line No.","Language Code") THEN BEGIN
        SegInteractLanguage.INIT;
        SegInteractLanguage."Segment No." := "Segment No.";
        SegInteractLanguage."Segment Line No." := "Line No.";
        SegInteractLanguage."Language Code" := "Language Code";
        SegInteractLanguage.Description := Description;
        SegInteractLanguage.INSERT(TRUE);
      END;
      SegInteractLanguage.ImportAttachment;
    END;

    [Internal]
    PROCEDURE ExportAttachment@4();
    VAR
      SegInteractLanguage@1000 : Record 5104;
    BEGIN
      IF UniqueAttachmentExists THEN BEGIN
        IF SegInteractLanguage.GET("Segment No.","Line No.","Language Code") THEN
          IF SegInteractLanguage."Attachment No." <> 0 THEN
            SegInteractLanguage.ExportAttachment;
      END ELSE
        IF SegInteractLanguage.GET("Segment No.",0,"Language Code") THEN
          IF SegInteractLanguage."Attachment No." <> 0 THEN
            SegInteractLanguage.ExportAttachment;
    END;

    [External]
    PROCEDURE RemoveAttachment@7();
    VAR
      SegInteractLanguage@1002 : Record 5104;
    BEGIN
      IF SegInteractLanguage.GET("Segment No.","Line No.","Language Code") THEN BEGIN
        SegInteractLanguage.DELETE(TRUE);
        GET("Segment No.","Line No.");
      END;
      "Attachment No." := 0;
    END;

    [External]
    PROCEDURE CreatePhoneCall@21();
    VAR
      TempSegmentLine@1000 : TEMPORARY Record 11072040;
    BEGIN
      Cont.GET("Contact No.");
      TempSegmentLine."Contact No." := Cont."No.";
      TempSegmentLine."Contact Via" := Cont."Phone No.";
      TempSegmentLine."Contact Company No." := Cont."Company No.";
      TempSegmentLine."Salesperson Code" := "Salesperson Code"; //**4PS.n
      TempSegmentLine."To-do No." := "To-do No.";
      TempSegmentLine."Salesperson Code" := "Salesperson Code";
      IF "Contact Alt. Address Code" <> '' THEN
        TempSegmentLine."Contact Alt. Address Code" := "Contact Alt. Address Code";
      IF "Campaign No." <> '' THEN
        TempSegmentLine."Campaign No." := "Campaign No.";

      TempSegmentLine."Campaign Target" := "Campaign Target";
      TempSegmentLine."Campaign Response" := "Campaign Response";
      TempSegmentLine.SETRANGE("Contact No.",TempSegmentLine."Contact No.");
      TempSegmentLine.SETRANGE("Campaign No.",TempSegmentLine."Campaign No.");

      TempSegmentLine.StartWizard2;
    END;

    LOCAL PROCEDURE FindLanguage@10(InteractTmplCode@1001 : Code[10];ContactLanguageCode@1000 : Code[10]) Language@1005 : Code[10];
    VAR
      SegInteractLanguage@1004 : Record 5104;
      InteractTemplLanguage@1003 : Record 5103;
      InteractTmpl@1002 : Record 11072032;
    BEGIN
      IF SegHeader.GET("Segment No.") THEN BEGIN
        IF NOT UniqueAttachmentExists AND
           ("Interaction Template Code" = SegHeader."Interaction Template Code")
        THEN BEGIN
          IF SegInteractLanguage.GET("Segment No.",0,ContactLanguageCode) THEN
            Language := ContactLanguageCode
          ELSE
            Language := SegHeader."Language Code (Default)";
        END ELSE
          IF SegInteractLanguage.GET("Segment No.","Line No.",ContactLanguageCode) THEN
            Language := ContactLanguageCode
          ELSE BEGIN
            InteractTmpl.GET(InteractTmplCode);
            IF SegInteractLanguage.GET("Segment No.","Line No.",InteractTmpl."Language Code (Default)") THEN
              Language := InteractTmpl."Language Code (Default)"
            ELSE BEGIN
              SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
              SegInteractLanguage.SETRANGE("Segment Line No.","Line No.");
              IF SegInteractLanguage.FINDFIRST THEN
                Language := SegInteractLanguage."Language Code";
            END;
          END;
      END ELSE BEGIN  // Create Interaction:
        IF InteractTemplLanguage.GET(InteractTmplCode,ContactLanguageCode) THEN
          Language := ContactLanguageCode
        ELSE
          IF InteractTmpl.GET(InteractTmplCode) THEN
            Language := InteractTmpl."Language Code (Default)";
      END;
    END;

    [External]
    PROCEDURE AttachmentInherited@12() : Boolean;
    VAR
      SegInteractLanguage@1000 : Record 5104;
    BEGIN
      IF "Attachment No." = 0 THEN
        EXIT(FALSE);
      IF NOT SegHeader.GET("Segment No.") THEN
        EXIT(FALSE);
      IF "Interaction Template Code" = '' THEN
        EXIT(FALSE);

      SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
      SegInteractLanguage.SETRANGE("Segment Line No.","Line No.");
      SegInteractLanguage.SETRANGE("Language Code","Language Code");
      SegInteractLanguage.SETRANGE("Attachment No.","Attachment No.");
      IF NOT SegInteractLanguage.ISEMPTY THEN
        EXIT(FALSE);

      SegInteractLanguage.SETRANGE("Segment Line No.",0);
      EXIT(NOT SegInteractLanguage.ISEMPTY);
    END;

    [External]
    PROCEDURE SetInteractionAttachment@13();
    VAR
      Attachment@1001 : Record 11072030;
      InteractTemplLanguage@1000 : Record 5103;
    BEGIN
      IF InteractTemplLanguage.GET("Interaction Template Code","Language Code") THEN BEGIN
        IF Attachment.GET(InteractTemplLanguage."Attachment No.") THEN
          "Attachment No." := InteractTemplLanguage."Attachment No."
        ELSE
          "Attachment No." := 0;
      END;
      MODIFY;
    END;

    LOCAL PROCEDURE UniqueAttachmentExists@14() : Boolean;
    VAR
      SegInteractLanguage@1000 : Record 5104;
    BEGIN
      IF "Line No." <> 0 THEN BEGIN
        SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
        SegInteractLanguage.SETRANGE("Segment Line No.","Line No.");
        EXIT(NOT SegInteractLanguage.ISEMPTY);
      END;
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE SetCampaignTargetGroup@15();
    BEGIN
      IF Campaign.GET(xRec."Campaign No.") THEN BEGIN
        Campaign.CALCFIELDS(Activated);
        IF Campaign.Activated THEN
          CampaignTargetGrMgt.DeleteSegfromTargetGr(xRec);
      END;

      IF Campaign.GET("Campaign No.") THEN BEGIN
        Campaign.CALCFIELDS(Activated);
        IF Campaign.Activated THEN
          CampaignTargetGrMgt.AddSegLinetoTargetGr(Rec);
      END;
    END;

    [External]
    PROCEDURE CopyFromInteractLogEntry@52(VAR InteractLogEntry@1001 : Record 11072027);
    BEGIN
      "Line No." := InteractLogEntry."Entry No.";
      "Contact No." := InteractLogEntry."Contact No.";
      "Contact Company No." := InteractLogEntry."Contact Company No.";
      Date := InteractLogEntry.Date;
      Description := InteractLogEntry.Description;
      "Information Flow" := InteractLogEntry."Information Flow";
      "Initiated By" := InteractLogEntry."Initiated By";
      "Attachment No." := InteractLogEntry."Attachment No.";
      "Cost (LCY)" := InteractLogEntry."Cost (LCY)";
      "Duration (Min.)" := InteractLogEntry."Duration (Min.)";
      "Interaction Group Code" := InteractLogEntry."Interaction Group Code";
      "Interaction Template Code" := InteractLogEntry."Interaction Template Code";
      "Language Code" := InteractLogEntry."Interaction Language Code";
      Subject := InteractLogEntry.Subject;
      "Campaign No." := InteractLogEntry."Campaign No.";
      "Campaign Entry No." := InteractLogEntry."Campaign Entry No.";
      "Campaign Response" := InteractLogEntry."Campaign Response";
      "Campaign Target" := InteractLogEntry."Campaign Target";
      "Segment No." := InteractLogEntry."Segment No.";
      Evaluation := InteractLogEntry.Evaluation;
      "Time of Interaction" := InteractLogEntry."Time of Interaction";
      "Attempt Failed" := InteractLogEntry."Attempt Failed";
      "To-do No." := InteractLogEntry."To-do No.";
      "Salesperson Code" := InteractLogEntry."Salesperson Code";
      "Correspondence Type" := InteractLogEntry."Correspondence Type";
      "Contact Alt. Address Code" := InteractLogEntry."Contact Alt. Address Code";
      "Document Type" := InteractLogEntry."Document Type";
      "Document No." := InteractLogEntry."Document No.";
      "Doc. No. Occurrence" := InteractLogEntry."Doc. No. Occurrence";
      "Version No." := InteractLogEntry."Version No.";
      "Send Word Doc. As Attmt." := InteractLogEntry."Send Word Docs. as Attmt.";
      "Contact Via" := InteractLogEntry."Contact Via";
      "Opportunity No." := InteractLogEntry."Opportunity No.";

      OnAfterCopyFromInteractionLogEntry(Rec,InteractLogEntry);
    END;

    [Internal]
    PROCEDURE CreateInteractionFromContact@38(VAR Contact@1000 : Record 5050);
    BEGIN
      DELETEALL;
      INIT;
      IF Contact.Type = Contact.Type::Person THEN
        SETRANGE("Contact Company No.",Contact."Company No.");
      SETRANGE("Contact No.",Contact."No.");
      VALIDATE("Contact No.",Contact."No.");

      "Salesperson Code" := FindSalespersonByUserEmail;
      IF "Salesperson Code" = '' THEN
        "Salesperson Code" := Contact."Salesperson Code";

      OnCreateInteractionFromContactOnBeforeStartWizard(Rec,Contact);

      StartWizard;
    END;

    [External]
    PROCEDURE CreateInteractionFromSalesperson@39(VAR Salesperson@1000 : Record 13);
    BEGIN
      DELETEALL;
      INIT;
      VALIDATE("Salesperson Code",Salesperson.Code);
      SETRANGE("Salesperson Code",Salesperson.Code);

      OnCreateInteractionFromSalespersonOnBeforeStartWizard(Rec,Salesperson);

      StartWizard;
    END;

    [External]
    PROCEDURE CreateInteractionFromInteractLogEntry@42(VAR InteractionLogEntry@1000 : Record 11072027);
    VAR
      Cont@1005 : Record 5050;
      Salesperson@1004 : Record 13;
      Campaign@1003 : Record 11072034;
      Task@1002 : Record 5080;
      Opportunity@1001 : Record 5092;
    BEGIN
      IF Task.GET(InteractionLogEntry.GETFILTER("To-do No.")) THEN BEGIN
        CreateFromTask(Task);
        SETRANGE("To-do No.","To-do No.");
      END ELSE BEGIN
        IF Cont.GET(InteractionLogEntry.GETFILTER("Contact Company No.")) THEN BEGIN
          VALIDATE("Contact No.",Cont."Company No.");
          SETRANGE("Contact No.","Contact No.");
        END;
        IF Cont.GET(InteractionLogEntry.GETFILTER("Contact No.")) THEN BEGIN
          VALIDATE("Contact No.",Cont."No.");
          SETRANGE("Contact No.","Contact No.");
        END;
        IF Salesperson.GET(InteractionLogEntry.GETFILTER("Salesperson Code")) THEN BEGIN
          "Salesperson Code" := Salesperson.Code;
          SETRANGE("Salesperson Code","Salesperson Code");
        END;
        IF Campaign.GET(InteractionLogEntry.GETFILTER("Campaign No.")) THEN BEGIN
          "Campaign No." := Campaign."No.";
          SETRANGE("Campaign No.","Campaign No.");
        END;
        IF Opportunity.GET(InteractionLogEntry.GETFILTER("Opportunity No.")) THEN BEGIN
          "Opportunity No." := Opportunity."No.";
          SETRANGE("Opportunity No.","Opportunity No.");
        END;
      END;

      OnCreateInteractionFromInteractLogEntryOnBeforeStartWizard(Rec,InteractionLogEntry);

      StartWizard;
    END;

    [External]
    PROCEDURE CreateInteractionFromTask@43(VAR Task@1000 : Record 5080);
    BEGIN
      INIT;
      CreateFromTask(Task);
      "To-do No." := Task."Organizer To-do No."; //**4PS.n
      SETRANGE("To-do No.","To-do No.");

      OnCreateInteractionFromTaskOnBeforeStartWizard(Rec,Task);

      StartWizard;
    END;

    [External]
    PROCEDURE CreateInteractionFromOpp@129(VAR Opportunity@1000 : Record 5092);
    VAR
      Contact@1001 : Record 5050;
      Salesperson@1002 : Record 13;
      Campaign@1003 : Record 11072034;
    BEGIN
      INIT;
      IF Contact.GET(Opportunity."Contact Company No.") THEN BEGIN
        Contact.CheckIfPrivacyBlockedGeneric;
        VALIDATE("Contact No.",Contact."Company No.");
        SETRANGE("Contact No.","Contact No.");
      END;
      IF Contact.GET(Opportunity."Contact No.") THEN BEGIN
        Contact.CheckIfPrivacyBlockedGeneric;
        VALIDATE("Contact No.",Contact."No.");
        SETRANGE("Contact No.","Contact No.");
      END;
      IF Salesperson.GET(Opportunity."Salesperson Code") THEN BEGIN
        VALIDATE("Salesperson Code",Salesperson.Code);
        SETRANGE("Salesperson Code","Salesperson Code");
      END;
      IF Campaign.GET(Opportunity."Campaign No.") THEN BEGIN
        VALIDATE("Campaign No.",Campaign."No.");
        SETRANGE("Campaign No.","Campaign No.");
      END;
      VALIDATE("Opportunity No.",Opportunity."No.");
      SETRANGE("Opportunity No.","Opportunity No.");

      OnCreateInteractionFromOppOnBeforeStartWizard(Rec,Opportunity);

      StartWizard;
    END;

    [External]
    PROCEDURE CreateOpportunity@32() : Code[20];
    VAR
      Opportunity@1000 : Record 5092;
    BEGIN
      Opportunity.CreateFromSegmentLine(Rec);
      EXIT(Opportunity."No.");
    END;

    LOCAL PROCEDURE CreateFromTask@37(Task@1000 : Record 5080);
    BEGIN
      "To-do No." := Task."No.";
      VALIDATE("Contact No.",Task."Contact No.");
      "Salesperson Code" := Task."Salesperson Code";
      "Campaign No." := Task."Campaign No.";
      "Opportunity No." := Task."Opportunity No.";

      OnAfterCreateFromTask(Rec,Task);
    END;

    LOCAL PROCEDURE GetContactName@41() : Text[100];
    VAR
      Cont@1000 : Record 5050;
    BEGIN
      IF Cont.GET("Contact No.") THEN
        EXIT(Cont.Name);
      IF Cont.GET("Contact Company No.") THEN
        EXIT(Cont.Name);
    END;

    [External]
    PROCEDURE StartWizard@33();
    VAR
      Opp@1000 : Record 5092;
      RelationshipPerformanceMgt@1001 : Codeunit 783;
    BEGIN
      OnBeforeStartWizard(Rec);

      IF Campaign.GET("Campaign No.") THEN
        "Campaign Description" := Campaign.Description;
      IF Opp.GET("Opportunity No.") THEN
        "Opportunity Description" := Opp.Description;
      "Wizard Contact Name" := GetContactName;
      "Wizard Step" := "Wizard Step"::"1";
      "Interaction Successful" := TRUE;
      VALIDATE(Date,WORKDATE);
      "Time of Interaction" := DT2TIME(ROUNDDATETIME(CURRENTDATETIME + 1000,60000,'>'));
      INSERT;

      IF PAGE.RUNMODAL(PAGE::"Create Interaction",Rec,"Interaction Template Code") = ACTION::OK THEN;
      IF "Wizard Step" = "Wizard Step"::"6" THEN
        RelationshipPerformanceMgt.SendCreateOpportunityNotification(Rec);
    END;

    [External]
    PROCEDURE CheckStatus@16();
    VAR
      InteractTmpl@1000 : Record 11072032;
      Attachment@1001 : Record 11072030;
      SalutationFormula@1002 : Record 5069;
      IsHandled@1003 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCheckStatus(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF "Contact No." = '' THEN
      //ERROR(Text009); //**4PS.o
        ErrorMessage(FIELDCAPTION("Contact No.")); //**4PS.n
      IF "Interaction Template Code" = '' THEN
        ErrorMessage(FIELDCAPTION("Interaction Template Code"));
      IF "Salesperson Code" = '' THEN
        ErrorMessage(FIELDCAPTION("Salesperson Code"));
      IF Date = 0D THEN
        ErrorMessage(FIELDCAPTION(Date));
      IF Description = '' THEN
        ErrorMessage(FIELDCAPTION(Description));

      InteractTmpl.GET("Interaction Template Code");
      IF InteractTmpl."Wizard Action" = InteractTmpl."Wizard Action"::Open THEN
        IF "Attachment No." = 0 THEN
          ErrorMessage(Attachment.TABLECAPTION);

      Cont.GET("Contact No.");
      IF SalutationFormula.GET(Cont."Salutation Code","Language Code",0) THEN;
      IF SalutationFormula.GET(Cont."Salutation Code","Language Code",1) THEN;

      IF TempAttachment.FINDFIRST THEN
        TempAttachment.CALCFIELDS("Attachment File");
      IF ("Correspondence Type" = "Correspondence Type"::Email) AND
         NOT TempAttachment."Attachment File".HASVALUE
      THEN
        ERROR(Text008);

      OnAfterCheckStatus(Rec);
    END;

    [Internal]
    PROCEDURE FinishWizard@18(IsFinish@1000 : Boolean);
    VAR
      InteractionLogEntry@1003 : Record 11072027;
      SegManagement@1002 : Codeunit 5051;
      WordManagement@1008 : Codeunit 11072023;
      WordApplicationHandler@1007 : Codeunit 5068;
      send@1001 : Boolean;
      Flag@1102601000 : Boolean;
      HTMLAttachment@1006 : Boolean;
      HTMLContentBodyText@1004 : Text;
      CustomLayoutCode@1005 : Code[20];
    BEGIN
      HTMLAttachment := IsHTMLAttachment;
      Flag := FALSE;
      IF IsFinish THEN
        Flag := TRUE
      ELSE
        Flag := CONFIRM(Text007);

      IF Flag THEN BEGIN
        CheckStatus;

        IF "Opportunity No." = '' THEN
          "Wizard Step" := "Wizard Step"::"6";

        IF NOT HTMLAttachment THEN BEGIN
          CLEAR(WordManagement);
          WordManagement.Activate(WordApplicationHandler,5077);
          HandleTrigger;
        END;

        "Attempt Failed" := NOT "Interaction Successful";
        Subject := Description;
        IF NOT HTMLAttachment THEN
          ProcessPostponedAttachment;
        send := (IsFinish AND ("Correspondence Type" <> "Correspondence Type"::" "));
        IF send AND HTMLAttachment THEN BEGIN
          TempAttachment.ReadHTMLCustomLayoutAttachment(HTMLContentBodyText,CustomLayoutCode);
          AttachmentManagement.GenerateHTMLContent(TempAttachment,Rec);
        END;
        SegManagement.LogInteraction(Rec,TempAttachment,TempInterLogEntryCommentLine,send,NOT IsFinish);
        InteractionLogEntry.FINDLAST;
        IF send AND (InteractionLogEntry."Delivery Status" = InteractionLogEntry."Delivery Status"::Error) THEN BEGIN
          IF HTMLAttachment THEN BEGIN
            CLEAR(TempAttachment);
            LoadTempAttachment(FALSE);
            TempAttachment.WriteHTMLCustomLayoutAttachment(HTMLContentBodyText,CustomLayoutCode);
            COMMIT;
          END;
          IF NOT (ClientTypeManagement.GetCurrentClientType IN [CLIENTTYPE::Web,CLIENTTYPE::Tablet,CLIENTTYPE::Phone]) THEN
            IF Mail.GetErrorDesc <> '' THEN
              ERROR(Text025,Mail.GetErrorDesc,PRODUCTNAME.FULL);
        END;
        WordManagement.Deactivate(5077);
      END;

      OnAfterFinishWizard(Rec,InteractionLogEntry,IsFinish,Flag);
    END;

    LOCAL PROCEDURE ErrorMessage@17(FieldName@1000 : Text[1024]);
    BEGIN
      ERROR(Text005,FieldName);
    END;

    [External]
    PROCEDURE ValidateCorrespondenceType@47();
    VAR
      ErrorText@1000 : Text[80];
    BEGIN
      IF "Correspondence Type" <> "Correspondence Type"::" " THEN
        IF TempAttachment.FINDFIRST THEN BEGIN
          ErrorText := TempAttachment.CheckCorrespondenceType("Correspondence Type");
          IF ErrorText <> '' THEN
            ERROR(
              Text024 + ErrorText,
              FIELDCAPTION("Correspondence Type"),"Correspondence Type");
        END;
    END;

    LOCAL PROCEDURE HandleTrigger@20();
    VAR
      TempBlob@1005 : Record 99008535;
      FileMgt@1003 : Codeunit 419;
      ImportedFileName@1000 : Text;
    BEGIN
      InteractTmpl.GET("Interaction Template Code");

      CASE InteractTmpl."Wizard Action" OF
        InteractTmpl."Wizard Action"::" ":
          IF "Attachment No." <> 0 THEN BEGIN
            LoadTempAttachment(FALSE);
            Subject := Description;
            TempAttachment.RunAttachment(Rec,Description,TRUE,FALSE,FALSE);
          END;
        InteractTmpl."Wizard Action"::Open:
          BEGIN
            TESTFIELD("Attachment No.");
            LoadTempAttachment(FALSE);
            Subject := Description;
            TempAttachment.ShowAttachment(Rec,Description,TRUE,FALSE);
          END;
        InteractTmpl."Wizard Action"::Import:
          BEGIN
            ImportedFileName := FileMgt.BLOBImport(TempBlob,ImportedFileName);
            IF ImportedFileName = '' THEN
              MESSAGE(Text004)
            ELSE BEGIN
              TempAttachment.DELETEALL;
              TempAttachment."Attachment File" := TempBlob.Blob;
              TempAttachment."File Extension" := COPYSTR(FileMgt.GetExtension(ImportedFileName),1,250);
              TempAttachment.INSERT;
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE LoadTempAttachment@22(ForceReload@1000 : Boolean);
    BEGIN
      IF NOT ForceReload AND TempAttachment."Attachment File".HASVALUE THEN
        EXIT;
      Attachment.GET("Attachment No.");
      Attachment.CALCFIELDS("Attachment File");
      TempAttachment.DELETEALL;
      TempAttachment.WizEmbeddAttachment(Attachment);
      TempAttachment."No." := 0;
      TempAttachment."Read Only" := FALSE;
      IF Attachment.IsHTML THEN
        TempAttachment."File Extension" := Attachment."File Extension";
      TempAttachment.INSERT;
    END;

    [External]
    PROCEDURE LoadContentBodyTextFromCustomLayoutAttachment@6() : Text;
    VAR
      ContentBodyText@1001 : Text;
      CustomLayoutCode@1000 : Code[20];
    BEGIN
      TempAttachment.ReadHTMLCustomLayoutAttachment(ContentBodyText,CustomLayoutCode);
      EXIT(ContentBodyText);
    END;

    [External]
    PROCEDURE UpdateContentBodyTextInCustomLayoutAttachment@28(NewContentBodyText@1007 : Text);
    VAR
      OldContentBodyText@1000 : Text;
      CustomLayoutCode@1001 : Code[20];
    BEGIN
      TempAttachment.FIND;
      TempAttachment.ReadHTMLCustomLayoutAttachment(OldContentBodyText,CustomLayoutCode);
      TempAttachment.WriteHTMLCustomLayoutAttachment(NewContentBodyText,CustomLayoutCode);
    END;

    LOCAL PROCEDURE ProcessPostponedAttachment@19();
    BEGIN
      IF "Attachment No." <> 0 THEN BEGIN
        LoadTempAttachment(FALSE);
        IF "Line No." <> 0 THEN
          "Attachment No." := ResumedAttachmentNo;
      END ELSE
        IF Attachment.GET(ResumedAttachmentNo) THEN
          Attachment.RemoveAttachment(FALSE);
    END;

    [Internal]
    PROCEDURE LoadAttachment@24(ForceReload@1000 : Boolean);
    BEGIN
      IF "Line No." <> 0 THEN BEGIN
        InterLogEntryCommentLine.SETRANGE("Entry No.","Line No.");
        IF InterLogEntryCommentLine.FIND('-') THEN
          REPEAT
            TempInterLogEntryCommentLine.INIT;
            TempInterLogEntryCommentLine.TRANSFERFIELDS(InterLogEntryCommentLine,FALSE);
            TempInterLogEntryCommentLine."Line No." := InterLogEntryCommentLine."Line No.";
            TempInterLogEntryCommentLine.INSERT;
          UNTIL InterLogEntryCommentLine.NEXT = 0;
        ResumedAttachmentNo := "Attachment No.";
      END;
      IF "Attachment No." <> 0 THEN
        LoadTempAttachment(ForceReload)
      ELSE BEGIN
        TempAttachment.DELETEALL;
        CLEAR(TempAttachment);
      END;
    END;

    [External]
    PROCEDURE MakePhoneCallFromContact@45(VAR Cont@1000 : Record 5050;Task@1001 : Record 5080;TableNo@1005 : Integer;PhoneNo@1003 : Text[30];ContAltAddrCode@1002 : Code[10]);
    BEGIN
      INIT;
      IF Cont.Type = Cont.Type::Person THEN
        SETRANGE("Contact No.",Cont."No.")
      ELSE
        SETRANGE("Contact Company No.",Cont."Company No.");
      IF PhoneNo <> '' THEN
        "Contact Via" := PhoneNo
      ELSE
        "Contact Via" := Cont."Phone No.";
      VALIDATE("Contact No.",Cont."No.");
      "Contact Name" := Cont.Name;
      VALIDATE(Date,TODAY);
      IF ContAltAddrCode <> '' THEN
        "Contact Alt. Address Code" := ContAltAddrCode;
      IF TableNo = DATABASE::"To-do" THEN
        "To-do No." := Task."No.";
      StartWizard2;
    END;

    [External]
    PROCEDURE StartWizard2@34();
    VAR
      InteractionTmplSetup@1000 : Record 5122;
      Campaign@1001 : Record 11072034;
    BEGIN
      OnBeforeStartWizard2(Rec);

      InteractionTmplSetup.GET;
      InteractionTmplSetup.TESTFIELD("Outg. Calls");

      "Wizard Step" := "Wizard Step"::"1";
      IF Date = 0D THEN
        Date := TODAY;
      "Time of Interaction" := TIME;
      "Interaction Successful" := TRUE;
      //"Dial Contact" := TRUE; //**4PS.o

      IF Campaign.GET(GETFILTER("Campaign No.")) THEN
        "Campaign Description" := Campaign.Description;
      "Wizard Contact Name" := GetContactName;

      INSERT;
      VALIDATE("Interaction Template Code",InteractionTmplSetup."Outg. Calls");
      IF PAGE.RUNMODAL(PAGE::"Make Phone Call",Rec,"Contact Via") = ACTION::OK THEN;
    END;

    [External]
    PROCEDURE CheckPhoneCallStatus@25();
    BEGIN
      IF "Wizard Step" = "Wizard Step"::"1" THEN BEGIN
        IF "Dial Contact" AND ("Contact Via" = '') THEN
          ERROR(Text013);
        IF Date = 0D THEN
          ErrorMessage(FIELDCAPTION(Date));
        IF Description = '' THEN
          ErrorMessage(FIELDCAPTION(Description));
        IF "Salesperson Code" = '' THEN
          ErrorMessage(FIELDCAPTION("Salesperson Code"));
      END;
    END;

    [Internal]
    PROCEDURE LogPhoneCall@23();
    VAR
      TempAttachment@1000 : TEMPORARY Record 11072030;
      SegLine@1001 : Record 11072040;
      SegManagement@1002 : Codeunit 5051;
    BEGIN
      "Attempt Failed" := NOT "Interaction Successful";

      SegManagement.LogInteraction(Rec,TempAttachment,TempInterLogEntryCommentLine,FALSE,FALSE);

      IF SegLine.GET("Segment No.","Line No.") THEN BEGIN
        SegLine.LOCKTABLE;
        SegLine."Contact Via" := "Contact Via";
        SegLine."Wizard Step" := SegLine."Wizard Step"::" ";
        SegLine.MODIFY;
      END;
    END;

    [External]
    PROCEDURE ShowComment@27();
    BEGIN
      PAGE.RUNMODAL(PAGE::"Inter. Log Entry Comment Sheet",TempInterLogEntryCommentLine);
    END;

    [External]
    PROCEDURE SetComments@53(VAR InterLogEntryCommentLine@1001 : Record 11072067);
    BEGIN
      TempInterLogEntryCommentLine.DELETEALL;

      IF InterLogEntryCommentLine.FINDSET THEN
        REPEAT
          TempInterLogEntryCommentLine := InterLogEntryCommentLine;
          TempInterLogEntryCommentLine.INSERT;
        UNTIL InterLogEntryCommentLine.NEXT = 0;
    END;

    [External]
    PROCEDURE IsHTMLAttachment@26() : Boolean;
    BEGIN
      IF NOT TempAttachment.FIND THEN
        EXIT(FALSE);
      EXIT(TempAttachment.IsHTML);
    END;

    [Internal]
    PROCEDURE PreviewHTMLContent@30();
    BEGIN
      TempAttachment.FIND;
      TempAttachment.ShowAttachment(Rec,'',TRUE,FALSE);
    END;

    [External]
    PROCEDURE LanguageCodeOnLookup@31();
    VAR
      SegInteractLanguage@1001 : Record 5104;
      InteractionTmplLanguage@1000 : Record 5103;
    BEGIN
      TESTFIELD("Interaction Template Code");

      IF SegHeader.GET("Segment No.") THEN BEGIN
        SegInteractLanguage.SETRANGE("Segment No.","Segment No.");
        IF UniqueAttachmentExists OR
           ("Interaction Template Code" <> SegHeader."Interaction Template Code")
        THEN
          SegInteractLanguage.SETRANGE("Segment Line No.","Line No.")
        ELSE
          SegInteractLanguage.SETRANGE("Segment Line No.",0);

        IF PAGE.RUNMODAL(0,SegInteractLanguage) = ACTION::LookupOK THEN BEGIN
          GET("Segment No.","Line No.");
          "Language Code" := SegInteractLanguage."Language Code";
          "Attachment No." := SegInteractLanguage."Attachment No.";
          Subject := SegInteractLanguage.Subject;
          MODIFY;
        END ELSE
          GET("Segment No.","Line No.");
      END ELSE BEGIN  // Create Interaction
        InteractionTmplLanguage.SETRANGE("Interaction Template Code","Interaction Template Code");
        IF PAGE.RUNMODAL(0,InteractionTmplLanguage) = ACTION::LookupOK THEN BEGIN
          "Language Code" := InteractionTmplLanguage."Language Code";
          MODIFY;
        END;
        SetInteractionAttachment;
      END;
    END;

    [External]
    PROCEDURE FilterContactCompanyOpportunities@29(VAR Opportunity@1000 : Record 5092);
    BEGIN
      Opportunity.RESET;
      Opportunity.SETRANGE(Closed,FALSE);
      IF "Salesperson Code" <> '' THEN
        Opportunity.SETRANGE("Salesperson Code","Salesperson Code");
      Opportunity.SETFILTER("Contact Company No.","Contact Company No.");
      IF "Opportunity No." <> '' THEN BEGIN
        Opportunity.SETRANGE("No.","Opportunity No.");
        IF Opportunity.FINDFIRST THEN;
        Opportunity.SETRANGE("No.");
      END;
    END;

    LOCAL PROCEDURE FindSalespersonByUserEmail@35() : Code[20];
    VAR
      User@1002 : Record 2000000120;
      Salesperson@1003 : Record 13;
      Email@1001 : Text[250];
    BEGIN
      User.SETRANGE("User Name",USERID);
      IF User.FINDFIRST THEN
        Email := User."Authentication Email";

      IF Email <> '' THEN BEGIN
        Salesperson.SETRANGE("E-Mail",Email);
        IF Salesperson.COUNT = 1 THEN BEGIN
          Salesperson.FINDFIRST;
          "Salesperson Code" := Salesperson.Code;
        END;
      END;
      EXIT("Salesperson Code");
    END;

    [External]
    PROCEDURE ExportODataFields@36();
    VAR
      TenantWebService@1001 : Record 2000000168;
      ODataFieldsExport@1002 : Page 6713;
      RecRef@1000 : RecordRef;
    BEGIN
      TenantWebService.SETRANGE("Object Type",TenantWebService."Object Type"::Query);
      TenantWebService.SETRANGE("Object ID",QUERY::"Segment Lines");
      TenantWebService.FINDFIRST;

      RecRef.OPEN(DATABASE::"Segment Line");
      RecRef.SETVIEW(GETVIEW);

      ODataFieldsExport.SetExportData(TenantWebService,RecRef);
      ODataFieldsExport.RUNMODAL;
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCheckStatus@58(VAR SegmentLine@1000 : Record 11072040);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCopyFromInteractionLogEntry@11(VAR SegmentLine@1000 : Record 11072040;InteractionLogEntry@1001 : Record 11072027);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateFromTask@40(VAR SegmentLine@1000 : Record 11072040;Task@1001 : Record 5080);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitLine@46(VAR SegmentLine@1000 : Record 11072040;SegmentHeader@1001 : Record 11072039);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterFinishWizard@44(VAR SegmentLine@1000 : Record 11072040;InteractionLogEntry@1001 : Record 11072027;IsFinish@1002 : Boolean;Flag@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCheckStatus@57(VAR SegmentLine@1000 : Record 11072040;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeStartWizard@49(VAR SegmentLine@1000 : Record 11072040);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeStartWizard2@50(VAR SegmentLine@1000 : Record 11072040);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateInteractionFromContactOnBeforeStartWizard@48(VAR SegmentLine@1000 : Record 11072040;VAR Contact@1001 : Record 5050);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateInteractionFromSalespersonOnBeforeStartWizard@51(VAR SegmentLine@1000 : Record 11072040;SalespersonPurchaser@1001 : Record 13);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateInteractionFromInteractLogEntryOnBeforeStartWizard@54(VAR SegmentLine@1000 : Record 11072040;InteractionLogEntry@1001 : Record 11072027);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateInteractionFromTaskOnBeforeStartWizard@55(VAR SegmentLine@1000 : Record 11072040;Task@1001 : Record 5080);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateInteractionFromOppOnBeforeStartWizard@56(VAR SegmentLine@1000 : Record 11072040;Opportunity@1001 : Record 5092);
    BEGIN
    END;

    PROCEDURE GetCaptionClass@1210190000(FieldNumber@1210190009 : Integer;MergeFieldNumber@1210190002 : Integer) : Text[80];
    VAR
      lOptionalMergeFieldRec@1210190008 : Record 11012145;
      lField@1210190006 : Record 2000000041;
      SegmentHeader@1100528401 : Record 11072039;
      CaptionTxt@1210190007 : Text[78];
      InteractionTemplateCode@1100528400 : Code[10];
    BEGIN
      //**4PS
      lField.GET(DATABASE::"Segment Line",FieldNumber);

      CaptionTxt := lField."Field Caption";
      IF "Segment No." <> '' THEN
        IF SegmentHeader.GET("Segment No.") THEN
          InteractionTemplateCode := SegmentHeader."Interaction Template Code";

      IF lOptionalMergeFieldRec.GET(InteractionTemplateCode, MergeFieldNumber) THEN
        IF lOptionalMergeFieldRec."Merge Field Name" <> '' THEN
          CaptionTxt := STRSUBSTNO(
            Text11012000  + ' ' + lOptionalMergeFieldRec."Merge Field Name", 1, MAXSTRLEN(CaptionTxt));

      EXIT('11012000,' + CaptionTxt);
    END;

    PROCEDURE OptionalMergeFieldEditable@1210190004(MergeFieldNo@1210190001 : Integer) : Boolean;
    BEGIN
      //**4PS
      IF "Interaction Template Code" = '' THEN
        EXIT(FALSE);

      IF NOT OptionalMergeFieldRec.GET("Interaction Template Code", MergeFieldNo) THEN
        EXIT(FALSE);

      IF OptionalMergeFieldRec."Merge Field Name" = '' THEN
        EXIT(FALSE);

      EXIT(OptionalMergeFieldRec.Table = OptionalMergeFieldRec.Table::" ");
    END;

    PROCEDURE ShowMergeFieldValue@1210190005(FieldValue@1210190001 : Text[80];MergeFieldNo@1210190002 : Integer) : Text[80];
    BEGIN
      //**4PS
      IF "Interaction Template Code" = '' THEN
        EXIT('');

      IF NOT OptionalMergeFieldRec.GET("Interaction Template Code", MergeFieldNo) THEN
        EXIT('');

      IF OptionalMergeFieldRec."Merge Field Name" = '' THEN
        EXIT('');

      IF OptionalMergeFieldRec.Table = OptionalMergeFieldRec.Table::" " THEN
        EXIT(FieldValue);

      EXIT(OptionalMergeFieldRec.GetFixedMergeFieldValue(Rec));
    END;

    PROCEDURE FillContactaltAddresscode@1100485000();
    BEGIN
      //**4PS
      ContactAltAdressRec.RESET;
      ContactAltAdressRec.SETRANGE("Contact No.","Contact No.");
      ContactAltAdressRec.SETRANGE(ContactAltAdressRec."Segment Default",TRUE);
      IF ContactAltAdressRec.FINDFIRST THEN
        "Contact Alt. Address Code" := ContactAltAdressRec.Code;
    END;

    PROCEDURE CreateCallUsingCallCenterPage@1100525000();
    VAR
      TempSegmentLine@1000 : TEMPORARY Record 11072040;
    BEGIN
      //**4PS
      Cont.GET("Contact No.");
      TempSegmentLine."Contact No." := Cont."No.";
      TempSegmentLine."Contact Via" := Cont."Phone No.";
      TempSegmentLine."Contact Company No." := Cont."Company No.";
      TempSegmentLine."Salesperson Code" := "Salesperson Code";
      TempSegmentLine."To-do No." := "To-do No.";
      IF "Contact Alt. Address Code" <> '' THEN
        TempSegmentLine."Contact Alt. Address Code" := "Contact Alt. Address Code";
      IF "Campaign No." <> '' THEN
        TempSegmentLine."Campaign No." := "Campaign No.";

      TempSegmentLine."Campaign Target" := "Campaign Target";
      TempSegmentLine."Campaign Response" := "Campaign Response";
      TempSegmentLine.SETRANGE("Contact No.",TempSegmentLine."Contact No.");
      TempSegmentLine.SETRANGE("Campaign No.",TempSegmentLine."Campaign No.");

      TempSegmentLine.StartWizardCallCenterPage;
    END;

    PROCEDURE StartWizardCallCenterPage@1100525003();
    VAR
      InteractionTmplSetup@1000 : Record 5122;
      Campaign@1001 : Record 11072034;
      UserSetup@1100525000 : Record 91;
      Customer@1100525001 : Record 18;
      ContactBusinessRelation@1100525002 : Record 5054;
    BEGIN
      //**4PS
      InteractionTmplSetup.GET;
      InteractionTmplSetup.TESTFIELD(InteractionTmplSetup."Outg. Calls");

      "Wizard Step" := "Wizard Step"::"1";
      IF Date = 0D THEN
        Date := TODAY;
      "Time of Interaction" := TIME;
      "Interaction Successful" := TRUE;

      IF Campaign.GET(GETFILTER("Campaign No.")) THEN
        "Campaign Description" := Campaign.Description;
      "Wizard Contact Name" := GetContactName;

      IF UserSetup.GET(USERID) THEN BEGIN;
        IF UserSetup.Salesperson <> '' THEN BEGIN;
          "Salesperson Code" := UserSetup.Salesperson;
        END;
      END;

      ContactBusinessRelation.SETCURRENTKEY("Link to Table", "Contact No.");
      ContactBusinessRelation.SETRANGE("Link to Table",ContactBusinessRelation."Link to Table"::Customer);
      ContactBusinessRelation.SETRANGE("Contact No.","Contact Company No.");
      IF ContactBusinessRelation.FIND('-') THEN BEGIN;
        IF Customer.GET(ContactBusinessRelation."No.") THEN BEGIN;
          "Customer No." := Customer."No.";
        END;
      END;

      INSERT;
      VALIDATE("Interaction Template Code",InteractionTmplSetup."Outg. Calls");
      PAGE.RUNMODAL(PAGE::"Call Center Page",Rec,"Contact Via");
    END;

    PROCEDURE CheckStatusCallCenterPage@1100525002();
    BEGIN
      //**4PS
      IF "Dial Contact" AND ("Contact Via" = '') THEN
        ERROR(Text013);
      IF Date = 0D THEN
        ErrorMessage(FIELDCAPTION(Date));
      IF "Salesperson Code" = '' THEN
        ErrorMessage(FIELDCAPTION("Salesperson Code"));
    END;

    PROCEDURE FinishWizardCallCenterPage@1100525001() : Boolean;
    VAR
      SegManagement@1002 : Codeunit 5051;
      TempAttachment@1000 : TEMPORARY Record 11072030;
      SegLine@1001 : Record 11072040;
    BEGIN
      //**4PS
      "Attempt Failed" := NOT "Interaction Successful";

      IF Description = '' THEN BEGIN;
        IF TempInterLogEntryCommentLine.FINDFIRST THEN BEGIN;
          Description := COPYSTR(TempInterLogEntryCommentLine.Comment, 1, MAXSTRLEN(Description));
        END ELSE BEGIN;
          ErrorMessage(FIELDCAPTION(Description));
        END;
      END;

      SegManagement.LogInteraction(Rec,TempAttachment,TempInterLogEntryCommentLine,FALSE,FALSE);

      IF SegLine.GET("Segment No.","Line No.") THEN BEGIN
        SegLine.LOCKTABLE;
        SegLine."Contact Via" := "Contact Via";
        SegLine."Wizard Step" := SegLine."Wizard Step"::" ";
        SegLine.MODIFY;
      END;
    END;

    PROCEDURE CloseToDo@1100525004();
    VAR
      ToDo@1100525000 : Record 5080;
    BEGIN
      //**4PS
      IF NOT ToDo.GET("To-do No.") THEN EXIT;
      ToDo.Closed := TRUE;
      ToDo."Date Closed" := TODAY;
      ToDo.Status := ToDo.Status::Completed;
      IF NOT ToDo.Canceled THEN BEGIN;
        IF (ToDo."Team Code" <> '') AND (ToDo."Completed By" = '') THEN
          ERROR(STRSUBSTNO(Text11012001, ToDo.FIELDCAPTION("Completed By")));
      END;
      IF ToDo.Recurring THEN ToDo.CreateRecurringTask;
      ToDo.MODIFY(TRUE);
    END;

    PROCEDURE ShowTodos@1100485006();
    VAR
      Todo@1100528700 : Record 5080;
    BEGIN
      //**4PS
      Todo.SETRANGE("Segment No.", "Segment No.");
      Todo.SETRANGE("Contact No.", "Contact No.");
      Todo.SETRANGE("System To-do Type", Todo."System To-do Type"::Organizer);
      PAGE.RUNMODAL(PAGE::"Task List", Todo);
    END;

    PROCEDURE UpdateOptionalMergefieldValues@1100528400(VAR OptionalMergefieldValue@1100528400 : ARRAY [5] OF Text[80]);
    BEGIN
      //**4PS
      OptionalMergefieldValue[1] := ShowMergeFieldValue("Optional Mergefield 1", 1);
      OptionalMergefieldValue[2] := ShowMergeFieldValue("Optional Mergefield 2", 2);
      OptionalMergefieldValue[3] := ShowMergeFieldValue("Optional Mergefield 3", 3);
      OptionalMergefieldValue[4] := ShowMergeFieldValue("Optional Mergefield 4", 4);
      OptionalMergefieldValue[5] := ShowMergeFieldValue("Optional Mergefield 5", 5);
    END;

    PROCEDURE GetComments@1100525005(VAR InterLogEntryCommentLine@1100525000 : Record 11072067);
    BEGIN
      //**4PS
      InterLogEntryCommentLine.DELETEALL;
      IF TempInterLogEntryCommentLine.FIND('-') THEN
        REPEAT
          InterLogEntryCommentLine := TempInterLogEntryCommentLine;
          InterLogEntryCommentLine.INSERT;
        UNTIL TempInterLogEntryCommentLine.NEXT = 0;
    END;

    BEGIN
    END.
  }
}

