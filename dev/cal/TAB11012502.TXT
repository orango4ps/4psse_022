OBJECT Table 11012502 Option
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnInsert=VAR
               SummarySheetLineRec@1100485001 : Record 11012064;
               ProjectElement@1100529400 : Record 11012010;
             BEGIN
               JobSetup.GET;
               "Input by" := USERID;
               "Input Date" := TODAY;
               "Modified by" := '';
               "Last Date Modified" := 0D;
               "Version Date" := WORKDATE;
               CLEAR(Status);
               "Order Date" := 0D;
               "Contract Date" := 0D;
               "Installments Generated" := FALSE;
               "Generation Date" := 0D;
               IF "Offering Date" <> 0D THEN
                 "End Open Offer Term"  := CALCDATE("Offering Term", "Offering Date");
               "Expired was Order" := FALSE;
               ProjRec.INIT;
               IF "Project No." <> '' THEN BEGIN
                 ProjRec.GET("Project No.");
                 ProjRec.CheckProjectStatus(0);
                 "Main Project No." := ProjRec."Main Project";
                 IF "Plot No." <> '' THEN BEGIN
                   PlotRec.GET("Project No.", "Plot No.");
                   PlotRec.TESTFIELD("Plot No. Fixed", FALSE);
                   Principal := PlotRec."Principal Options";
                 END;
               END ELSE
                 "Main Project No." := '';

               SetClosingDate;
               CheckUpdateOptionCrossList(Rec);
               CopyStandardOptionSurcharges;

               IF ProjRec."Summary Sheet Option" <> '' THEN BEGIN   //34128.c
                 SummarySheetLineRec.CopyTemplate2(ProjRec."Summary Sheet Option",
                   "Project No.", '', "Plot No.",  "House Model", "Main Group", Group, "Sub Group", Option);
                 SummarySheetLineRec.SETRANGE("Project No.", "Project No.");
                 SummarySheetLineRec.SETFILTER("Contract No.", '%1', '');
                 SummarySheetLineRec.SETRANGE("Plot No.", "Plot No.");
                 SummarySheetLineRec.SETRANGE("House Model", "House Model");
                 SummarySheetLineRec.SETRANGE("Main Group", "Main Group");
                 SummarySheetLineRec.SETRANGE(Group, Group);
                 SummarySheetLineRec.SETRANGE("Sub Group", "Sub Group");
                 SummarySheetLineRec.SETRANGE(Option, Option);
                 IF SummarySheetLineRec.FIND('-') THEN BEGIN
                   IF (SummarySheetLineRec.Element <> '') THEN BEGIN //#T007308.n
                     IF NOT ProjectElement.GET("Project No.",SummarySheetLineRec.Element) THEN
                       SummarySheetLineRec.FIELDERROR(SummarySheetLineRec.Element,
                         STRSUBSTNO(Text004, ProjectElement.TABLECAPTION + ' ' + "Project No." + ' - ' + SummarySheetLineRec.Element));
                   END;
                   SummarySheetLineRec.ReCalcOptionSummaryLines;
                   SummarySheetLineRec.UpdateOptBudgetLines;
                 END;
               END;
             END;

    OnModify=BEGIN
               IF "Plot No." <> '' THEN BEGIN
                 PlotRec.GET("Project No.", "Plot No.");
                 PlotRec.TESTFIELD("Plot No. Fixed", FALSE);
               END;
               "Modified by" := USERID;
               "Last Date Modified" := TODAY;

               IF (Status >= Status::Order) AND ("Plot No." <> '') THEN
                 IF (Status = Status::Expired) AND ("Last Date Printed on Opt.List" = 0D) THEN
                   //To prevent that options of which status never was higher then order and which are expired,
                   //will come on the meter cupboard list.
                   EXIT
                 ELSE BEGIN
                   "Last Mod. Date Def.Option" := TODAY;
                   "Last Modification Time Option" := TIME;
                   "(Re)Print Option List" := TRUE;
                 END;

               IF "Offering Date" <> 0D THEN
                 "End Open Offer Term" := CALCDATE("Offering Term", "Offering Date")
               ELSE
                 "End Open Offer Term" := 0D;

               CheckUpdateOptionCrossList(Rec);
             END;

    OnDelete=VAR
               lvProjInstallmentRec@1210190005 : Record 11012018;
               lvPrincipalOptNoRec@1210190006 : Record 11012517;
               lvOptionBudgetSummaryRec@1210190001 : Record 11012064;
               lvOptionBudgetRec@1210190004 : Record 11012503;
               lvOptionSurchargesRec@1210190003 : Record 11012512;
               lvOptionTextRec@1210190002 : Record 11012511;
             BEGIN
               IF NOT SkipCheckDelete THEN BEGIN
                 IF Status IN [Status::Order,Status::Invoice] THEN
                   ERROR(Text010,"Main Group",Group,"Sub Group",Option,Status);
                 IF "Project No." <> '' THEN BEGIN
                   IF ProjRec.GET("Project No.") THEN
                     ProjRec.CheckProjectStatus(0);
                 END;
                 IF "Plot No." <> '' THEN BEGIN
                   PlotRec.GET("Project No.", "Plot No.");
                   PlotRec.TESTFIELD("Plot No. Fixed", FALSE);
                 END;
               END;

               CheckDeleteOptionCrossList(Rec);
               CheckDeleteDocumentLinks(Rec);


               IF ("Project No." <> '') AND ("Plot No." <> '') AND ("Installments Generated") THEN BEGIN
                 //CALCFIELDS(Principal);
                 lvProjInstallmentRec.SETRANGE("Project No.", "Project No.");
                 lvProjInstallmentRec.SETRANGE(Principal, Principal);
                 lvProjInstallmentRec.SETRANGE("Plot No.", "Plot No.");
                 lvProjInstallmentRec.SETRANGE("Main Group", "Main Group");
                 lvProjInstallmentRec.SETRANGE(Group, Group);
                 lvProjInstallmentRec.SETRANGE("Sub Group", "Sub Group");
                 lvProjInstallmentRec.SETRANGE(Option, Option);
                 lvProjInstallmentRec.DELETEALL(TRUE);
                 //db, 12-10-07 (extra read action as a result of sql-problem: previous action rewrite this table
                 GET("Project No.", "Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
               END;

               IF ("Project No." = '') AND ("Plot No." = '') THEN BEGIN
                 lvPrincipalOptNoRec.SETRANGE("House Model", "House Model");
                 lvPrincipalOptNoRec.SETRANGE("Main Group", "Main Group");
                 lvPrincipalOptNoRec.SETRANGE(Group, Group);
                 lvPrincipalOptNoRec.SETRANGE("Sub Group", "Sub Group");
                 lvPrincipalOptNoRec.SETRANGE(Option, Option);
                 lvPrincipalOptNoRec.DELETEALL;
               END;

               lvOptionBudgetSummaryRec.SETRANGE("Contract No.", '');
               lvOptionBudgetSummaryRec.SETRANGE("Project No.", "Project No.");
               lvOptionBudgetSummaryRec.SETRANGE("Plot No.", "Plot No.");
               lvOptionBudgetSummaryRec.SETRANGE("House Model", "House Model");
               lvOptionBudgetSummaryRec.SETRANGE("Main Group", "Main Group");
               lvOptionBudgetSummaryRec.SETRANGE(Group, Group);
               lvOptionBudgetSummaryRec.SETRANGE("Sub Group", "Sub Group");
               lvOptionBudgetSummaryRec.SETRANGE(Option, Option);
               lvOptionBudgetSummaryRec.DELETEALL;

               lvOptionBudgetRec.SETRANGE("Project No.", "Project No.");
               lvOptionBudgetRec.SETRANGE("Plot No.", "Plot No.");
               lvOptionBudgetRec.SETRANGE("House Model", "House Model");
               lvOptionBudgetRec.SETRANGE("Main Group", "Main Group");
               lvOptionBudgetRec.SETRANGE(Group, Group);
               lvOptionBudgetRec.SETRANGE("Sub Group", "Sub Group");
               lvOptionBudgetRec.SETRANGE(Option, Option);
               lvOptionBudgetRec.DELETEALL;

               lvOptionSurchargesRec.SETRANGE("Project No.", "Project No.");
               lvOptionSurchargesRec.SETRANGE("Plot No.", "Plot No.");
               lvOptionSurchargesRec.SETRANGE("House Model", "House Model");
               lvOptionSurchargesRec.SETRANGE("Main Group", "Main Group");
               lvOptionSurchargesRec.SETRANGE(Group, Group);
               lvOptionSurchargesRec.SETRANGE("Sub Group", "Sub Group");
               lvOptionSurchargesRec.SETRANGE(Option, Option);
               lvOptionSurchargesRec.DELETEALL;

               lvOptionTextRec.SETRANGE(Table, lvOptionTextRec.Table::Option);
               lvOptionTextRec.SETRANGE("Project No.", "Project No.");
               lvOptionTextRec.SETRANGE("House Model", "House Model");
               lvOptionTextRec.SETRANGE("Option Main Group", "Main Group");
               lvOptionTextRec.SETRANGE("Option Sub Group", "Sub Group");
               lvOptionTextRec.SETRANGE("Option Group", Group);
               lvOptionTextRec.SETRANGE("Plot No.", "Plot No.");
               lvOptionTextRec.SETRANGE(Option, Option);
               lvOptionTextRec.DELETEALL;

               CheckDeleteOptionCrossListLine(Rec);
               UpdateWorkBudgetOnChanges(Rec, TRUE, FALSE);  //*First delete option budget and surcharges !
             END;

    OnRename=VAR
               lvOptionBudgetRec@1210190002 : Record 11012503;
               lvOptionBudgetRec2@1210190006 : Record 11012503;
               lvOptionBudgetSummaryRec@1210190003 : Record 11012064;
               lvOptionBudgetSummaryRec2@1210190007 : Record 11012064;
               lvOptionSurchargesRec@1210190001 : Record 11012512;
               lvOptionSurchargesRec2@1210190004 : Record 11012512;
               lvOptionTextRec@1210190000 : Record 11012511;
               lvOptionTextRec2@1210190005 : Record 11012511;
             BEGIN
               IF ((Status IN [Status::Order, Status::Invoice])) AND ("Plot No." <> '')  THEN  //* ia regarding to project budget
                 FIELDERROR(Status, STRSUBSTNO(Text000, Status));

               IF CheckOnOptionCrossListLine(xRec) THEN  //* C-013170
                 ERROR(Text011);

               lvOptionBudgetRec.SETRANGE("Project No.", xRec."Project No.");
               lvOptionBudgetRec.SETRANGE("Plot No.", xRec."Plot No.");
               lvOptionBudgetRec.SETRANGE("House Model", xRec."House Model");
               lvOptionBudgetRec.SETRANGE("Main Group", xRec."Main Group");
               lvOptionBudgetRec.SETRANGE(Group, xRec.Group);
               lvOptionBudgetRec.SETRANGE("Sub Group", xRec."Sub Group");
               lvOptionBudgetRec.SETRANGE(Option, xRec.Option);
               IF lvOptionBudgetRec.FINDSET(TRUE, FALSE) THEN BEGIN
                 REPEAT
                   lvOptionBudgetRec2 := lvOptionBudgetRec;
                   lvOptionBudgetRec2."Project No." := "Project No.";
                   lvOptionBudgetRec2."Plot No." := "Plot No.";
                   lvOptionBudgetRec2."House Model" := "House Model";
                   lvOptionBudgetRec2."Main Group" := "Main Group";
                   lvOptionBudgetRec2.Group := Group;
                   lvOptionBudgetRec2."Sub Group" := "Sub Group";
                   lvOptionBudgetRec2.Option := Option;
                   lvOptionBudgetRec2.INSERT;
                   lvOptionBudgetRec.DELETE;
                 UNTIL lvOptionBudgetRec.NEXT = 0;
               END;

               lvOptionBudgetSummaryRec.SETRANGE("Project No.", xRec."Project No.");
               lvOptionBudgetSummaryRec.SETRANGE("Plot No.", xRec."Plot No.");
               lvOptionBudgetSummaryRec.SETRANGE("House Model", xRec."House Model");
               lvOptionBudgetSummaryRec.SETRANGE("Main Group", xRec."Main Group");
               lvOptionBudgetSummaryRec.SETRANGE(Group, xRec.Group);
               lvOptionBudgetSummaryRec.SETRANGE("Sub Group", xRec."Sub Group");
               lvOptionBudgetSummaryRec.SETRANGE(Option, xRec.Option);
               IF lvOptionBudgetSummaryRec.FIND('-') THEN BEGIN
                 REPEAT
                   lvOptionBudgetSummaryRec2 := lvOptionBudgetSummaryRec;
                   lvOptionBudgetSummaryRec2."Project No." := "Project No.";
                   lvOptionBudgetSummaryRec2."Plot No." := "Plot No.";
                   lvOptionBudgetSummaryRec2."House Model" := "House Model";
                   lvOptionBudgetSummaryRec2."Main Group" := "Main Group";
                   lvOptionBudgetSummaryRec2.Group := Group;
                   lvOptionBudgetSummaryRec2."Sub Group" := "Sub Group";
                   lvOptionBudgetSummaryRec2.Option := Option;
                   lvOptionBudgetSummaryRec2.INSERT;
                   lvOptionBudgetSummaryRec.DELETE;
                 UNTIL lvOptionBudgetSummaryRec.NEXT = 0;
               END;

               lvOptionSurchargesRec.SETRANGE("Project No.", xRec."Project No.");
               lvOptionSurchargesRec.SETRANGE("Plot No.", xRec."Plot No.");
               lvOptionSurchargesRec.SETRANGE("House Model", xRec."House Model");
               lvOptionSurchargesRec.SETRANGE("Main Group", xRec."Main Group");
               lvOptionSurchargesRec.SETRANGE(Group, xRec.Group);
               lvOptionSurchargesRec.SETRANGE("Sub Group", xRec."Sub Group");
               lvOptionSurchargesRec.SETRANGE(Option, xRec.Option);
               IF lvOptionSurchargesRec.FIND('-') THEN BEGIN
                 REPEAT
                   lvOptionSurchargesRec2 := lvOptionSurchargesRec;
                   lvOptionSurchargesRec2."Project No." := "Project No.";
                   lvOptionSurchargesRec2."Plot No." := "Plot No.";
                   lvOptionSurchargesRec2."House Model" := "House Model";
                   lvOptionSurchargesRec2."Main Group" := "Main Group";
                   lvOptionSurchargesRec2.Group := Group;
                   lvOptionSurchargesRec2."Sub Group" := "Sub Group";
                   lvOptionSurchargesRec2.Option := Option;
                   lvOptionSurchargesRec2.INSERT;
                   lvOptionSurchargesRec.DELETE;
                 UNTIL lvOptionSurchargesRec.NEXT = 0;
               END;

               lvOptionTextRec.SETRANGE(Table, lvOptionTextRec.Table::Option);
               lvOptionTextRec.SETRANGE("Project No.", xRec."Project No.");
               lvOptionTextRec.SETRANGE("House Model", xRec."House Model");
               lvOptionTextRec.SETRANGE("Option Main Group", xRec."Main Group");
               lvOptionTextRec.SETRANGE("Option Sub Group", xRec."Sub Group");
               lvOptionTextRec.SETRANGE("Option Group", xRec.Group);
               lvOptionTextRec.SETRANGE("Plot No.", xRec."Plot No.");
               lvOptionTextRec.SETRANGE(Option, xRec.Option);
               IF lvOptionTextRec.FIND('-') THEN BEGIN
                 REPEAT
                   lvOptionTextRec2 := lvOptionTextRec;
                   lvOptionTextRec2."Project No." := "Project No.";
                   lvOptionTextRec2."House Model" := "House Model";
                   lvOptionTextRec2."Option Main Group" := "Main Group";
                   lvOptionTextRec2."Option Sub Group" := "Sub Group";
                   lvOptionTextRec2."Option Group" := Group;
                   lvOptionTextRec2."Plot No." := "Plot No.";
                   lvOptionTextRec2.Option := Option;
                   lvOptionTextRec2.INSERT;
                   lvOptionTextRec.DELETE;
                 UNTIL lvOptionTextRec.NEXT = 0;
               END;
             END;

    CaptionML=[ENU=Option;
               NOR=Alternativ;
               SVE=Alternativ];
    PasteIsValid=No;
    LookupPageID=Page11012508;
    DrillDownPageID=Page11012508;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 11  ;   ;Project Description ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 20  ;   ;Option              ;Code20        ;TableRelation=Option.Option WHERE (Project No.=FIELD(Project No.),
                                                                                      Plot No.=FIELD(Plot No.),
                                                                                      House Model=FIELD(House Model),
                                                                                      Main Group=FIELD(Main Group),
                                                                                      Group=FIELD(Group),
                                                                                      Sub Group=FIELD(Sub Group));
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Option;
                                                              NOR=Alternativ;
                                                              SVE=Alternativ];
                                                   NotBlank=Yes }
    { 30  ;   ;Plot No.            ;Code10        ;TableRelation=Plot."Plot No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Plot No.;
                                                              NOR=Tegningnr;
                                                              SVE=Ritningnr] }
    { 31  ;   ;Principal           ;Code20        ;TableRelation="Project Principal".Principal WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Principal Name");
                                                              END;

                                                   CaptionML=[ENU=Principal;
                                                              NOR=Oppdragsgiver;
                                                              SVE=Uppdragsgivare];
                                                   Editable=Yes }
    { 32  ;   ;House Model         ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                lModelRec@1100485000 : Record 11012501;
                                                                lPlotNo@1100485001 : Record 11012500;
                                                              BEGIN
                                                                IF "Plot No." <> '' THEN BEGIN
                                                                  IF lPlotNo.GET("Project No.","Plot No.") THEN BEGIN
                                                                    "VAT Bus. Posting Group" := lPlotNo."VAT Bus. Posting Group";
                                                                    "VAT Prod. Posting Group" := lPlotNo."VAT Prod. Posting Group";
                                                                  END;
                                                                END ELSE BEGIN
                                                                  IF lModelRec.GET("Project No.","House Model") THEN BEGIN
                                                                    "VAT Bus. Posting Group" := lModelRec."VAT Bus. Posting Group";
                                                                    "VAT Prod. Posting Group" := lModelRec."VAT Prod. Posting Group";
                                                                  END;
                                                                END;
                                                                IF (NOT Modular) AND lModelRec.GET("Project No.","House Model") THEN
                                                                  IF CheckIfGeneratingInstallmentsIsAllowed(FALSE) THEN
                                                                    VALIDATE("Installment Scheme", lModelRec."Installment Scheme Options");
                                                              END;

                                                   CaptionML=[ENU=House Model;
                                                              NOR=Husmodell;
                                                              SVE=Husmodell];
                                                   NotBlank=Yes }
    { 35  ;   ;Principal Name      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Principal)));
                                                   CaptionML=[ENU=Principal Name;
                                                              NOR=Oppdragsgivers navn;
                                                              SVE=Uppdragsgivarens namn];
                                                   Editable=No }
    { 40  ;   ;Description         ;Text100       ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 50  ;   ;Quantities          ;Boolean       ;OnValidate=BEGIN
                                                                IF (NOT Quantities) AND (Quantity <> 1) THEN
                                                                  VALIDATE(Quantity, 1);
                                                              END;

                                                   CaptionML=[ENU=Quantities;
                                                              NOR=Antall;
                                                              SVE=Antal] }
    { 60  ;   ;Quantity            ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                IF (Status >= Status::Order) AND ("Plot No." <> '') THEN
                                                                  ERROR(Text009,Status);  //* Do not delete this test,  has consequences for project budget (note: test already exist).

                                                                DetermineTotal(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal] }
    { 70  ;   ;Computed Sales Price Incl. VAT;Decimal;
                                                   CaptionML=[ENU=Computed Sales Price Incl. VAT;
                                                              NOR=Estimert salgspris inkl. mva.;
                                                              SVE=Ber„knat f”rs„ljningspris inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 80  ;   ;Sales Amount incl. VAT;Decimal     ;OnValidate=BEGIN
                                                                IF Quantity = 0 THEN
                                                                  "Sales Price incl. VAT" := "Sales Amount incl. VAT"
                                                                ELSE
                                                                  "Sales Price incl. VAT" := "Sales Amount incl. VAT" / Quantity;
                                                                VALIDATE("Sales Price incl. VAT");
                                                              END;

                                                   CaptionML=[ENU=Sales Amount incl. VAT;
                                                              NOR=Salgsbel›p inkl. moms;
                                                              SVE=F”rs„ljningsbelopp inkl. moms];
                                                   AutoFormatType=1 }
    { 90  ;   ;Option No. External ;Code20        ;CaptionML=[ENU=Option No. External;
                                                              NOR=Eksternt Alternativnr.;
                                                              SVE=Externt alternativnr] }
    { 110 ;   ;Mandatory           ;Boolean       ;CaptionML=[ENU=Mandatory;
                                                              NOR=Obligatorisk;
                                                              SVE=Obligatoriskt] }
    { 120 ;   ;Valid from          ;Date          ;CaptionML=[ENU=Valid from;
                                                              NOR=Gyldig fra;
                                                              SVE=Giltigt fr†n] }
    { 130 ;   ;Valid Until         ;Date          ;CaptionML=[ENU=Valid until;
                                                              NOR=Gyldig til;
                                                              SVE=Giltig till] }
    { 140 ;   ;Input by            ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Input by;
                                                              NOR=Input av;
                                                              SVE=Inmatat av];
                                                   Editable=No }
    { 150 ;   ;Input Date          ;Date          ;CaptionML=[ENU=Input Date;
                                                              NOR=Input Dato;
                                                              SVE=Inmatat den];
                                                   Editable=No }
    { 160 ;   ;Status              ;Option        ;OnValidate=BEGIN
                                                                IF NOT SkipStatusWarning THEN
                                                                  IF (CurrFieldNo = FIELDNO(Status)) AND "Installments Generated" AND
                                                                     (xRec.Status = Status::Invoice) AND (xRec.Status <> Status)
                                                                  THEN
                                                                    MESSAGE(Text013);

                                                                IF "Plot No." = '' THEN BEGIN
                                                                  "Order Date" := 0D;
                                                                  "Expired was Order" := FALSE;
                                                                END ELSE BEGIN
                                                                  IF Status IN [Status::Order, Status::Invoice] THEN BEGIN
                                                                    IF ("Order Date" = 0D) OR (NOT (xRec.Status IN [Status::Order, Status::Invoice])) THEN
                                                                      "Order Date" := TODAY;
                                                                    "Expired was Order" := FALSE;
                                                                    IF Modular THEN
                                                                      TestIfPlotInstallmentsAreNotGenerated;
                                                                  END ELSE BEGIN
                                                                    "Order Date" := 0D;
                                                                    IF (xRec.Status IN [Status::Order, Status::Invoice]) THEN
                                                                      "Expired was Order" := TRUE;
                                                                    IF Status = Status::Expired THEN BEGIN
                                                                      IF CheckDeleteInstallmOnExpired() THEN
                                                                        "Installments Generated" := FALSE;
                                                                      IF Modular AND PlotInstallmentsHaveBeenGenerated THEN BEGIN
                                                                        UpdateWorkBudgetOnChanges(xRec, FALSE, TRUE);
                                                                        CreateCreditInstallmentForModularOption;
                                                                      END;
                                                                    END;
                                                                  END;
                                                                  IF Modular AND (xRec.Status = xRec.Status::Expired) AND (xRec.Status <> Status) THEN BEGIN
                                                                    TestIfPlotInstallmentsAreNotGenerated;
                                                                    "Generate Installments" := FALSE;
                                                                    "Installment Scheme" := '';
                                                                  END;
                                                                  IF Modular AND (xRec.Status = xRec.Status::Order) AND (xRec.Status <> Status) AND (Status <> Status::Expired) THEN
                                                                    TestIfPlotInstallmentsAreNotGenerated;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=[ENU=Applied,Offered,Order,Chargeable,Expired;
                                                                    NOR=Anvendt,Tilbudt,Ordre,Avgiftspliktig,Forfalt;
                                                                    SVE=Till„mpat,Anbud,Order,Avgiftsbel„ggs,F”rfallit];
                                                   OptionString=Applied,Offered,Order,Invoice,Expired }
    { 165 ;   ;Order Date          ;Date          ;OnValidate=BEGIN
                                                                IF "Plot No." <> '' THEN BEGIN
                                                                  IF Status IN [Status::Order, Status::Invoice] THEN
                                                                    TESTFIELD("Order Date")
                                                                  ELSE
                                                                    TESTFIELD("Order Date", 0D);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Order Date;
                                                              NOR=Bestillingsdato;
                                                              SVE=Orderdatum] }
    { 170 ;   ;Contract Amount     ;Decimal       ;OnValidate=BEGIN
                                                                IF ("Contract Amount" <> xRec."Contract Amount") AND "Installments Generated" THEN
                                                                  MESSAGE(Text006);
                                                                "Contract Amount - Net Amount" := "Contract Amount" - "Net Amount";
                                                              END;

                                                   CaptionML=[ENU=Contract Amount;
                                                              NOR=Kontraktsbel›p;
                                                              SVE=Kontraktsbelopp];
                                                   AutoFormatType=1 }
    { 175 ;   ;Contract Amount - Net Amount;Decimal;
                                                   CaptionML=ENU=Contract Amount - Net Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 180 ;   ;Offered Amount      ;Decimal       ;CaptionML=[ENU=Offered Amount;
                                                              NOR=Tilbudt bel›p;
                                                              SVE=Anbudsbelopp];
                                                   AutoFormatType=1 }
    { 190 ;   ;Offering Date       ;Date          ;OnValidate=BEGIN
                                                                IF "Offering Date" <> 0D THEN
                                                                  "End Open Offer Term" := CALCDATE("Offering Term", "Offering Date")
                                                                ELSE
                                                                  "End Open Offer Term" := 0D;
                                                              END;

                                                   CaptionML=[ENU=Offering Date;
                                                              NOR=Tilbudsdato;
                                                              SVE=Anbudsdatum] }
    { 195 ;   ;Offering Term       ;DateFormula   ;OnValidate=BEGIN
                                                                IF "Offering Date" <> 0D THEN
                                                                  "End Open Offer Term" := CALCDATE("Offering Term", "Offering Date")
                                                                ELSE
                                                                  "End Open Offer Term" := 0D;
                                                              END;

                                                   CaptionML=[ENU=Offering Term;
                                                              NOR=Tilbudsvilk†r;
                                                              SVE=Anbudsvillkor] }
    { 200 ;   ;Contract Date       ;Date          ;CaptionML=[ENU=Contract Date;
                                                              NOR=Kontraktsdato;
                                                              SVE=Kontraktdatum] }
    { 210 ;   ;Generate Installments;Boolean      ;OnValidate=BEGIN
                                                                IF "Generate Installments" THEN
                                                                  CheckIfGeneratingInstallmentsIsAllowed(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Generate Installments;
                                                              NOR=Generer avdrag;
                                                              SVE=Generera avbetalningar] }
    { 220 ;   ;Installment Scheme  ;Code10        ;TableRelation="Installment Scheme".Code;
                                                   OnValidate=BEGIN
                                                                IF "Installment Scheme" <> '' THEN
                                                                  CheckIfGeneratingInstallmentsIsAllowed(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Installment Scheme;
                                                              NOR=Betalingsplan;
                                                              SVE=Betalplan] }
    { 240 ;   ;Installments Generated;Boolean     ;InitValue=No;
                                                   CaptionML=[ENU=Installments Generated;
                                                              NOR=Genererte avdrag;
                                                              SVE=Genererade avbetalningar];
                                                   Editable=No }
    { 250 ;   ;Generation Date     ;Date          ;CaptionML=[ENU=Generation Date;
                                                              NOR=Genereringsdato;
                                                              SVE=Genererandedatum];
                                                   Editable=No }
    { 260 ;   ;Version Date        ;Date          ;CaptionML=[ENU=Version Date;
                                                              NOR=Versjonsdato;
                                                              SVE=Versionsdatum] }
    { 270 ;   ;Modified by         ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=Žndrad av];
                                                   Editable=No }
    { 280 ;   ;Last Date Modified  ;Date          ;CaptionML=[ENU=Last Date Modified;
                                                              NOR=Oppdateringsdato;
                                                              SVE=Uppdateringsdatum];
                                                   Editable=No }
    { 281 ;   ;Standard House Type ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FILTER(''));
                                                   CaptionML=[ENU=Standard House Type;
                                                              NOR=Standardhustype;
                                                              SVE=Standardhustyp] }
    { 282 ;   ;Project House Type  ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Project House Type;
                                                              NOR=Prosjekthustype;
                                                              SVE=Projekthustyp] }
    { 283 ;   ;Frequency           ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count(Option WHERE (Project No.=FIELD(Project No.),
                                                                                   Option=FIELD(Option),
                                                                                   Plot No.=FILTER(<>''),
                                                                                   Status=FILTER(Order..Invoice)));
                                                   CaptionML=[ENU=Frequency;
                                                              NOR=Forekomst;
                                                              SVE=Frekvens];
                                                   Editable=No }
    { 310 ;   ;Total Quantity      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum(Option.Quantity WHERE (Project No.=FIELD(Project No.),
                                                                                          Option=FIELD(Option),
                                                                                          Plot No.=FILTER(<>''),
                                                                                          Status=FILTER(Order..Invoice)));
                                                   CaptionML=[ENU=Total Quantity;
                                                              NOR=Totalt antall;
                                                              SVE=Totalt antal];
                                                   Editable=No }
    { 320 ;   ;Group               ;Code20        ;TableRelation="Option Group".Code WHERE (Project No.=FIELD(Project No.),
                                                                                            Plot No.=FIELD(Plot No.));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Group Description");
                                                              END;

                                                   CaptionML=[ENU=Group;
                                                              NOR=Gruppe;
                                                              SVE=Grupp];
                                                   NotBlank=Yes }
    { 325 ;   ;Main Group          ;Code20        ;TableRelation="Option Main Group".Code WHERE (Project No.=FIELD(Project No.),
                                                                                                 Plot No.=FIELD(Plot No.));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Main Group Description");
                                                              END;

                                                   CaptionML=[ENU=Main Group;
                                                              NOR=Hovedgruppe;
                                                              SVE=Huvudgrupp];
                                                   NotBlank=Yes }
    { 330 ;   ;Sub Group           ;Code20        ;TableRelation="Option Sub Group".Code WHERE (Project No.=FIELD(Project No.),
                                                                                                Plot No.=FIELD(Plot No.));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Sub Group Description");
                                                              END;

                                                   CaptionML=[ENU=Sub Group;
                                                              NOR=Undergruppe;
                                                              SVE=Undergrupp];
                                                   NotBlank=Yes }
    { 340 ;   ;Unit Cost           ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Option Budget".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                                 Plot No.=FIELD(Plot No.),
                                                                                                 House Model=FIELD(House Model),
                                                                                                 Main Group=FIELD(Main Group),
                                                                                                 Group=FIELD(Group),
                                                                                                 Sub Group=FIELD(Sub Group),
                                                                                                 Option=FIELD(Option)));
                                                   CaptionML=[ENU=Unit Cost;
                                                              NOR=Enhetskost;
                                                              SVE=Styckkostnad];
                                                   DecimalPlaces=2:2;
                                                   Editable=No }
    { 341 ;   ;Unit Cost Excl. Summary Budget;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Option Budget".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                                 Plot No.=FIELD(Plot No.),
                                                                                                 House Model=FIELD(House Model),
                                                                                                 Main Group=FIELD(Main Group),
                                                                                                 Group=FIELD(Group),
                                                                                                 Sub Group=FIELD(Sub Group),
                                                                                                 Option=FIELD(Option),
                                                                                                 Budget Summary Line=CONST(No)));
                                                   CaptionML=ENU=Unit Cost Excl. Summary Budget;
                                                   DecimalPlaces=2:2;
                                                   Editable=No }
    { 345 ;   ;Surcharges          ;Decimal       ;FieldClass=FlowField;
                                                   InitValue=0;
                                                   CalcFormula=Sum("Option Surcharge"."Surcharge Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                                House Model=FIELD(House Model),
                                                                                                                Main Group=FIELD(Main Group),
                                                                                                                Group=FIELD(Group),
                                                                                                                Sub Group=FIELD(Sub Group),
                                                                                                                Plot No.=FIELD(Plot No.),
                                                                                                                Option=FIELD(Option)));
                                                   CaptionML=[ENU=Surcharges;
                                                              NOR=Tilleggsgebyrer;
                                                              SVE=Till„ggsavgifter];
                                                   DecimalPlaces=2:2;
                                                   Editable=No }
    { 350 ;   ;Summary Sheet       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Option Budget".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                                 Plot No.=FIELD(Plot No.),
                                                                                                 House Model=FIELD(House Model),
                                                                                                 Main Group=FIELD(Main Group),
                                                                                                 Group=FIELD(Group),
                                                                                                 Sub Group=FIELD(Sub Group),
                                                                                                 Option=FIELD(Option),
                                                                                                 Budget Summary Line=CONST(Yes)));
                                                   CaptionML=[ENU=Summary Sheet;
                                                              NOR=Sammendragsark;
                                                              SVE=Summeringsark];
                                                   Editable=No }
    { 380 ;   ;Net Price           ;Decimal       ;CaptionML=[ENU=Net Price;
                                                              NOR=Nettopris;
                                                              SVE=Nettopris];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 385 ;   ;Net Amount          ;Decimal       ;CaptionML=[ENU=Net Amount;
                                                              NOR=Nettobel›p;
                                                              SVE=Nettobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 390 ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group".Code;
                                                   OnValidate=BEGIN
                                                                //C008351.sn
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                //C008351.en
                                                                BuyerMgtCU.BmDetermineVAT(Rec);
                                                                BuyerMgtCU.BmDetermineSalesPrice(Rec);
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Moms produktbokf›ringsmal;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 391 ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group".Code;
                                                   OnValidate=BEGIN
                                                                //C008351.sn
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                //C008351.en
                                                                BuyerMgtCU.BmDetermineVAT(Rec);
                                                                BuyerMgtCU.BmDetermineSalesPrice(Rec);
                                                              END;

                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              NOR=Mva-bokf›ringsgruppe - firma;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 395 ;   ;VAT Percentage      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("VAT Posting Setup"."VAT %" WHERE (VAT Bus. Posting Group=FIELD(VAT Bus. Posting Group),
                                                                                                         VAT Prod. Posting Group=FIELD(VAT Prod. Posting Group),
                                                                                                         VAT Calculation Type=FILTER(<>Reverse Charge VAT)));
                                                   CaptionML=[ENU=VAT Percentage;
                                                              NOR=Mva.-sats;
                                                              SVE=Momsprocentsats];
                                                   Editable=No }
    { 400 ;   ;Computed VAT Amount ;Decimal       ;CaptionML=[ENU=Computed VAT Amount;
                                                              NOR=Estimert mva.-bel›p;
                                                              SVE=Ber„knat momsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 420 ;   ;Group Description   ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Option Group".Description WHERE (Code=FIELD(Group),
                                                                                                        Project No.=FIELD(Project No.),
                                                                                                        Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[ENU=Group Description;
                                                              NOR=Gruppebeskrivelse;
                                                              SVE=Gruppbeskrivning];
                                                   Editable=No }
    { 430 ;   ;Sub Group Description;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Option Sub Group".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                            Code=FIELD(Sub Group),
                                                                                                            Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[ENU=Sub Group Description;
                                                              NOR=Undergruppebeskrivelse;
                                                              SVE=Undergruppsbeskrivning];
                                                   Editable=No }
    { 432 ;   ;Main Group Description;Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Option Main Group".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                             Code=FIELD(Main Group),
                                                                                                             Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[ENU=Main Group Description;
                                                              NOR=Hovedgruppesbeskrivelse;
                                                              SVE=Huvudgruppsbeskrivning];
                                                   Editable=No }
    { 433 ;   ;House Model Description;Text50     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("House Model".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                       Model=FIELD(House Model)));
                                                   CaptionML=[ENU=House Model Description;
                                                              NOR=Husmodellbeskrivelse;
                                                              SVE=Husmodellbeskrivning];
                                                   Editable=No }
    { 435 ;   ;Group Status        ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Option Group".Status WHERE (Project No.=FIELD(Project No.),
                                                                                                   Code=FIELD(Group),
                                                                                                   Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[ENU=Group Status;
                                                              NOR=Gruppestatus;
                                                              SVE=Gruppstatus];
                                                   OptionCaptionML=[ENU=Provisional,Definitive;
                                                                    NOR=Provisorisk,Definitiv;
                                                                    SVE=Prelimin„r,Definitiv];
                                                   OptionString=Provisional,Definitive;
                                                   Editable=No }
    { 440 ;   ;VAT Amount          ;Decimal       ;OnValidate=BEGIN
                                                                //C008351.sn
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                //C008351.en
                                                              END;

                                                   CaptionML=[ENU=VAT Amount;
                                                              NOR=Mva-bel›p;
                                                              SVE=Momsbelopp];
                                                   Description=Per unit;
                                                   Editable=No }
    { 445 ;   ;Sales Price excl. VAT;Decimal      ;OnValidate=BEGIN
                                                                //C008351.sn
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                //C008351.en
                                                                CALCFIELDS("VAT Percentage");
                                                                "VAT Amount" := ROUND("Sales Price excl. VAT" * "VAT Percentage" / 100);
                                                                VALIDATE("Sales Price incl. VAT", "Sales Price excl. VAT" + "VAT Amount");
                                                              END;

                                                   CaptionML=[ENU=Sales Price excl. VAT;
                                                              NOR=Salgspris Ekskludert Moms;
                                                              SVE=F”rs„ljningspris exkl. moms];
                                                   AutoFormatType=1 }
    { 450 ;   ;Sales Price incl. VAT;Decimal      ;OnValidate=BEGIN
                                                                OnValidateSalesPriceInclVAT(FALSE);
                                                              END;

                                                   CaptionML=[ENU=Sales Price incl. VAT;
                                                              NOR=Salgspris Inkludert Moms;
                                                              SVE=Ber„knat f”rs„ljningspris inkl. moms];
                                                   AutoFormatType=1 }
    { 460 ;   ;Fixed Sales Price   ;Boolean       ;CaptionML=[ENU=Fixed Sales Price;
                                                              NOR=Fast salgspris;
                                                              SVE=Fast f”rs„ljningspris] }
    { 470 ;   ;Hours               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Option=FIELD(Option)));
                                                   CaptionML=[ENU=Hours;
                                                              NOR="Timer ";
                                                              SVE=Timmar];
                                                   Editable=No }
    { 480 ;   ;Labor               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Option=FIELD(Option),
                                                                                                       Cost Type=CONST(Labor)));
                                                   CaptionML=[ENU=Labor;
                                                              NOR=Arbeidskraft;
                                                              SVE=Arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 490 ;   ;Material            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Option=FIELD(Option),
                                                                                                       Cost Type=CONST(Material)));
                                                   CaptionML=[ENU=Material;
                                                              NOR=Materialee;
                                                              SVE=Material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 500 ;   ;Subcontracting      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Option=FIELD(Option),
                                                                                                       Cost Type=CONST(Subcontracting)));
                                                   CaptionML=[ENU=Subcontracting;
                                                              NOR=Underentrepen›r;
                                                              SVE=Underentreprenad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 510 ;   ;Plant               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Option=FIELD(Option),
                                                                                                       Cost Type=CONST(Plant)));
                                                   CaptionML=[ENU=Plant;
                                                              NOR=Maskin;
                                                              SVE=Maskin];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 520 ;   ;Sundry              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Option=FIELD(Option),
                                                                                                       Cost Type=CONST(Sundry)));
                                                   CaptionML=[ENU=Sundry;
                                                              NOR=Diverse;
                                                              SVE=Diverse];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 530 ;   ;Total               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Option=FIELD(Option)));
                                                   CaptionML=[ENU=Total;
                                                              NOR=Totalt;
                                                              SVE=Totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 540 ;   ;Last Date Printed on Opt.List;Date ;CaptionML=[ENU=Last Printed on Option List;
                                                              NOR=Sist skrevet ut p† Alternativliste;
                                                              SVE=Skrevs senast ut p† alternativlista];
                                                   Editable=No }
    { 550 ;   ;Last Time Printed on Opt.List;Time ;CaptionML=[ENU=Last Time Printed on Opt.List;
                                                              NOR=Sist gang skrevet ut p† Alternativliste;
                                                              SVE=Skrevs senast ut p† alt.lista];
                                                   Editable=No }
    { 560 ;   ;Last Mod. Date Def.Option;Date     ;CaptionML=[ENU=Last Mod. Date Def.Option;
                                                              NOR=Siste Endringsdato for Standardalternativ;
                                                              SVE=Senast „ndr. Datum def.alternativ];
                                                   Editable=No }
    { 570 ;   ;Last Modification Time Option;Time ;CaptionML=[ENU=Last Modification Time Option;
                                                              NOR=Siste Endring av Tidsalternativ;
                                                              SVE=Senaste „ndrIngen av tidsalternativ];
                                                   Editable=No }
    { 580 ;   ;(Re)Print Option List;Boolean      ;OnValidate=BEGIN
                                                                TESTFIELD("(Re)Print Option List", FALSE); //field can only be set from TRUE to FALSE
                                                              END;

                                                   CaptionML=[ENU=(Re)Print Option List;
                                                              NOR=Skriv ut Alternativlisten (p† nytt);
                                                              SVE=Skriv ut alternativlistan (igen)] }
    { 590 ;   ;Expired was Order   ;Boolean       ;CaptionML=[ENU=Expired was Order;
                                                              NOR=Utg†tt Ordre;
                                                              SVE=Utg†ngen order];
                                                   Editable=No }
    { 600 ;   ;End Open Offer Term ;Date          ;CaptionML=[ENU=End Open Offer Term;
                                                              NOR=Avslutt pne tilbudsvilk†r;
                                                              SVE=Slut p† ”ppna anbudsvillkor];
                                                   Editable=No }
    { 620 ;   ;Budget Changed by Integration;Boolean;
                                                   CaptionML=[ENU=Budget Changed by Integration;
                                                              NOR=Budsjett Endret av Integrasjon;
                                                              SVE=Budget „ndrad genom integration] }
    { 621 ;   ;Transaction Date Out;DateTime      ;CaptionML=[ENU=Transaction Date Out;
                                                              NOR=Transaksjonsdato ut;
                                                              SVE=Transaktionsdatum ut] }
    { 622 ;   ;Transaction Date In ;DateTime      ;CaptionML=[ENU=Transaction Date In;
                                                              NOR=Transaksjonsdato inn;
                                                              SVE=Transaktionsdatum in] }
    { 630 ;   ;Sales Text          ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Buyer Management Text" WHERE (Table=FILTER(Option),
                                                                                                    Text Type=FILTER(Sales),
                                                                                                    Project No.=FIELD(Project No.),
                                                                                                    House Model=FIELD(House Model),
                                                                                                    Option Main Group=FIELD(Main Group),
                                                                                                    Option Group=FIELD(Group),
                                                                                                    Option Sub Group=FIELD(Sub Group),
                                                                                                    Plot No.=FIELD(Plot No.),
                                                                                                    Option=FIELD(Option)));
                                                   CaptionML=[ENU=Sales Text;
                                                              NOR=Salgstekst;
                                                              SVE=F”rs„ljningstext];
                                                   Editable=No }
    { 635 ;   ;Internal Text       ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Buyer Management Text" WHERE (Table=FILTER(Option),
                                                                                                    Text Type=FILTER(Internal),
                                                                                                    Project No.=FIELD(Project No.),
                                                                                                    House Model=FIELD(House Model),
                                                                                                    Option Main Group=FIELD(Main Group),
                                                                                                    Option Group=FIELD(Group),
                                                                                                    Option Sub Group=FIELD(Sub Group),
                                                                                                    Plot No.=FIELD(Plot No.),
                                                                                                    Option=FIELD(Option)));
                                                   CaptionML=[ENU=Internal Text;
                                                              NOR=Intern tekst;
                                                              SVE=Intern text];
                                                   Editable=No }
    { 640 ;   ;Technical Text      ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Buyer Management Text" WHERE (Table=FILTER(Option),
                                                                                                    Text Type=FILTER(Technical),
                                                                                                    Project No.=FIELD(Project No.),
                                                                                                    House Model=FIELD(House Model),
                                                                                                    Option Main Group=FIELD(Main Group),
                                                                                                    Option Group=FIELD(Group),
                                                                                                    Option Sub Group=FIELD(Sub Group),
                                                                                                    Plot No.=FIELD(Plot No.),
                                                                                                    Option=FIELD(Option)));
                                                   CaptionML=[ENU=Technical Text;
                                                              NOR=Teknisk tekst;
                                                              SVE=Teknisk text];
                                                   Editable=No }
    { 650 ;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Main Project No.;
                                                              NOR=Hovedprosjektnr.;
                                                              SVE=Huvudprojektnr] }
    { 660 ;   ;Picture             ;Text100       ;OnLookup=VAR
                                                              FileMgt@1100525000 : Codeunit 419;
                                                              DirectoryName@1100525001 : Text;
                                                              ShortFileName@1100525002 : Text;
                                                            BEGIN
                                                              IF Picture ='' THEN
                                                                FileMgt.SelectFile('', DirectoryName, ShortFileName ,Picture)
                                                              ELSE BEGIN
                                                                IF NOT CONFIRM(Text012,FALSE) THEN
                                                                  HYPERLINK(Picture)
                                                                ELSE
                                                                  Picture := '';
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Picture;
                                                              NOR=Bilde;
                                                              SVE=Bild] }
    { 670 ;   ;Developers Discount Percentage;Decimal;
                                                   OnValidate=BEGIN
                                                                IF "Developers Discount Percentage" <> 0 THEN
                                                                  TESTFIELD("Contractor Surcharge %", 0);
                                                                //C008351.sn
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                //C008351.en
                                                                //C-015208
                                                                BuyerMgtCU.BmDetermineVAT(Rec);
                                                                BuyerMgtCU.BmDetermineSalesPrice(Rec);
                                                              END;

                                                   CaptionML=[ENU=Developers Discount (%);
                                                              NOR=Utviklers Rabatt (%);
                                                              SVE=Utvecklarrabatt (%)] }
    { 680 ;   ;Sales Price incl. VAT (Buyer);Decimal;
                                                   OnValidate=BEGIN
                                                                //C008351.sn
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                //C008351.en
                                                                //C-015208
                                                                VALIDATE("Sales Price incl. VAT", ROUND("Sales Price incl. VAT (Buyer)" * InverseBuyerFactor));
                                                              END;

                                                   CaptionML=[ENU=Sales Price incl. VAT (Buyer);
                                                              NOR=Salgspris inkl. Moms (Kj›per);
                                                              SVE=F”rs„ljningspris inkl. moms (k”pare)];
                                                   AutoFormatType=1 }
    { 690 ;   ;Closing Date        ;Date          ;OnValidate=VAR
                                                                Plot@1210190000 : Record 11012500;
                                                              BEGIN
                                                                //kzwerver, 110808, n, #26039
                                                                IF (Plot.GET("Project No.", "Plot No.")) THEN BEGIN
                                                                  IF ((Plot."Options Closing Date" <> 0D) AND
                                                                    (Plot."Options Closing Date" < "Closing Date"))
                                                                  THEN
                                                                    "Closing Date" := 0D;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Closing Date;
                                                              NOR=Sluttdato;
                                                              SVE=Avslutsdatum] }
    { 700 ;   ;URL                 ;Text80        ;ExtendedDatatype=URL;
                                                   CaptionML=[ENU=URL;
                                                              NOR=URL;
                                                              SVE=URL] }
    { 710 ;   ;MMR Invoiced        ;Boolean       ;CaptionML=ENU=MMR Invoiced }
    { 720 ;   ;Change Processed on ;Date          ;CaptionML=ENU=Change Processed on }
    { 730 ;   ;Unit of Measure Code;Code10        ;TableRelation="Unit of Measure";
                                                   CaptionML=[ENU=Unit of Measure Code;
                                                              NOR=M†leenhetskode;
                                                              SVE=Enhetskod] }
    { 740 ;   ;Modular             ;Boolean       ;OnValidate=VAR
                                                                Plot@1100528600 : Record 11012500;
                                                              BEGIN
                                                                IF xRec.Modular <> Modular THEN BEGIN
                                                                  IF ("Project No." <> '') AND ("Plot No." <> '') THEN BEGIN
                                                                    Plot.GET("Project No.", "Plot No.");
                                                                    Plot.TESTFIELD("Installments Generated", FALSE);
                                                                    IF Modular THEN BEGIN
                                                                      TESTFIELD("Generate Installments", FALSE);
                                                                      TESTFIELD("Installment Scheme", '');
                                                                      TESTFIELD("Installments Generated", FALSE);
                                                                    END;
                                                                  END;
                                                                  IF ("House Model" <> '') AND Modular THEN BEGIN
                                                                    TESTFIELD("Generate Installments", FALSE);
                                                                    TESTFIELD("Installment Scheme", '');
                                                                    TESTFIELD("Installments Generated", FALSE);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Modular }
    { 750 ;   ;Contract Am.- Net Am.Trans.;Boolean;CaptionML=ENU=Contract Amount - Net Amount Transferred }
    { 760 ;   ;Contractor Surcharge %;Decimal     ;OnValidate=BEGIN
                                                                IF "Contractor Surcharge %" <> 0 THEN
                                                                  TESTFIELD("Developers Discount Percentage", 0);
                                                                IF CurrFieldNo > 0 THEN
                                                                  TESTFIELD("Fixed Sales Price", FALSE);
                                                                "Sales Price incl. VAT (Buyer)" := ROUND("Sales Price incl. VAT" * BuyerFactor);
                                                                "Sales Price excl. VAT (Buyer)" := ROUND("Sales Price excl. VAT" * BuyerFactor);
                                                              END;

                                                   CaptionML=ENU=Contractor Surcharge %;
                                                   DecimalPlaces=2:15 }
    { 770 ;   ;Sales Price excl. VAT (Buyer);Decimal;
                                                   OnValidate=BEGIN
                                                                "Sales Price excl. VAT" := ROUND("Sales Price excl. VAT (Buyer)" * InverseBuyerFactor);
                                                                CALCFIELDS("VAT Percentage");
                                                                "VAT Amount" := ROUND("Sales Price excl. VAT" * "VAT Percentage" / 100);
                                                                VALIDATE("Sales Price incl. VAT", "Sales Price excl. VAT" + "VAT Amount");
                                                              END;

                                                   CaptionML=ENU=Sales Price excl. VAT (Buyer);
                                                   AutoFormatType=1 }
  }
  KEYS
  {
    {    ;Project No.,Plot No.,House Model,Main Group,Group,Sub Group,Option;
                                                   SumIndexFields=Sales Amount incl. VAT,Contract Amount,Offered Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Project No.,Option,Plot No.,Status,House Model,Main Group,Group,Sub Group;
                                                   SumIndexFields=Quantity }
    {    ;Project No.,Plot No.,Group,Sub Group,Contract Date }
    {    ;Project No.,Plot No.,Last Mod. Date Def.Option,Last Modification Time Option }
    {    ;Project No.,House Model,Main Group,Group,Sub Group,Option,Plot No. }
    {    ;Main Project No.,Project No.,Plot No.,Status,Order Date;
                                                   SumIndexFields=Contract Amount }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1210190003 : TextConst 'ENU=is ''%1'', rename not allowed;NOR=Er ''%1'', ikke tillatt † gi nytt navn;SVE=„r ''%1'', att ge nytt namn „r inte till†tet';
      Text001@1100485001 : TextConst 'ENU=may not be deleted, there is still an Option Cross List present;NOR=kan ikke fjernes, det finnes fortsatt en Alternativ Avkrysningsliste;SVE=kan inte tas bort, det finns fortfarande en alternativkorslista';
      Text004@1100529400 : TextConst 'ENU=(%1) does not exist';
      Text005@1100525002 : TextConst 'ENU="Project Installments are already (partly) invoiced. Credit them manually.\Plot No. %1, Group %2-%3-%4, Option %5. ";NOR=Prosjektavdrag er allerede (delvis) fakturert. Krediter dem manuelt.\Tegningnr %1, Gruppe %2-%3-%4, Alternativ %5.;SVE="Projektavbetalningar har redan (delvis) fakturerats. Kreditera dem manuellt.\Ritningnr %1, grupp %2-%3-%4, alternativ %5. "';
      Text006@11012014 : TextConst 'ENU=Project Installments generated. Change them manually.;NOR=Prosjektavdrag er Generert. Endre dem manuelt.;SVE=Projektavbetalningar har genererats. Žndra dem manuellt.';
      Text007@11012015 : TextConst 'ENU=Update Contract Amount and Offering Amount ?;NOR=Oppdater Kontraktsbel›p og tilbudsbel›p?;SVE=Uppdatera kontraktsbelopp och anbudsbelopp?';
      Text008@11012016 : TextConst 'ENU="Contract Amount and Offering Amount not updated, Status = Invoicing Allowed.";NOR="Kontraktsbel›p og tilbudsbel›p er ikke oppdatert, status = Fakturering Tillatt.";SVE="Kontraktsbelopp och anbudsbelopp har inte uppdaterats, status = fakturering „r till†ten."';
      JobSetup@1100485000 : Record 315;
      ProjRec@1100485004 : Record 11072003;
      PlotRec@1100485002 : Record 11012500;
      BuyerMgtCU@1210190002 : Codeunit 11012500;
      Text009@1210190000 : TextConst 'ENU=The status is %1, you can''t change the quantity;NOR=Status er %1, du kan ikke endre antallet;SVE=Status „r %1, du kan inte „ndra antalet';
      Text010@1100485003 : TextConst 'ENU=You cannot remove Option %1,%2,%3,%4 with status %5.;NOR=Du kan ikke fjerne Alternativ %1,%2,%3,%4 med status %5.;SVE=Du kan inte ta bort alternativ %1,%2,%3,%4 med status %5.';
      SkipCheckDelete@1100485005 : Boolean;
      Text011@1100525000 : TextConst 'ENU=Rename option not allowed, option is present on the Option Cross List.;NOR= navngi alternativ p† nytt er ikke tillatt, alternativet finnes p† Alternativ Avkrysningsliste.;SVE=Att namnge alternativ p† nytt „r inte till†tet, alternativet finns p† alternativkorslistan.';
      Text012@1100525001 : TextConst 'ENU=Delete Link (Cause No Show Picture);NOR=Fjern Link (pga. ingen visningsbilde);SVE=Ta bort l„nk (pga. ingen visningsbild)';
      Text013@1100529600 : TextConst 'ENU=Warning, installment is already generated.';
      SkipStatusWarning@1100529601 : Boolean;

    PROCEDURE DetermineTotal@1(UserInteractionAllowed@1100485000 : Boolean);
    BEGIN
      JobSetup.GET;

      IF (NOT "Fixed Sales Price") OR (CurrFieldNo = 0) THEN BEGIN  //C003752.n
        BuyerMgtCU.BmCalculateVat(Rec);
        "Sales Price excl. VAT" := "Sales Price incl. VAT" - "VAT Amount";
        IF "Developers Discount Percentage" = 100 THEN BEGIN
          "Sales Price incl. VAT (Buyer)" := 0;
          "Sales Price excl. VAT (Buyer)" := 0;
        END ELSE BEGIN
          "Sales Price incl. VAT (Buyer)" := ROUND("Sales Price incl. VAT" * BuyerFactor);
          "Sales Price excl. VAT (Buyer)" := ROUND("Sales Price excl. VAT" * BuyerFactor);
        END;

        "Sales Amount incl. VAT" := ROUND(Quantity * "Sales Price incl. VAT");
      //C003752.sn
      END ELSE BEGIN
        "Sales Amount incl. VAT" := ROUND(Quantity * "Sales Price incl. VAT");
        //"VAT Amount" := "Sales Amount incl. VAT" - ROUND(Quantity * "Sales Price excl. VAT");  //C028450.o
        "VAT Amount" := ROUND("Sales Price incl. VAT" - "Sales Price excl. VAT");  //C028450.n
      END;
      //C003752.en
      "Net Amount" := Quantity * "Net Price";

      IF "Plot No." = '' THEN BEGIN
        VALIDATE("Contract Amount", ROUND(Quantity * "Sales Price excl. VAT"));
        "Offered Amount" := ROUND(Quantity * "Sales Price excl. VAT");
        "Contract Amount - Net Amount" := "Contract Amount" - "Net Amount";
      END ELSE BEGIN
        IF UserInteractionAllowed AND GUIALLOWED THEN
          IF NOT JobSetup."Update Contract and Offer Amt." THEN
            IF NOT CONFIRM(Text007) THEN BEGIN
              "Contract Amount - Net Amount" := "Contract Amount" - "Net Amount";
              EXIT;
            END;
        IF Status = Status::Invoice THEN BEGIN
          IF UserInteractionAllowed AND GUIALLOWED THEN
            MESSAGE(Text008);
        END ELSE BEGIN
          VALIDATE("Contract Amount", ROUND(Quantity * "Sales Price excl. VAT"));
          "Contract Amount - Net Amount" := "Contract Amount" - "Net Amount";
          "Offered Amount" := ROUND(Quantity * "Sales Price excl. VAT");
        END;
      END;
    END;

    PROCEDURE CheckUpdateBudgetOnStatChange@1210190000(IStatusOld@1210190000 : Option;IStatusNew@1210190001 : Option) : Boolean;
    BEGIN
      IF (NOT (IStatusOld IN [Status::Order, Status::Invoice])) AND (IStatusNew IN [Status::Order, Status::Invoice]) THEN
        EXIT(TRUE);
    END;

    PROCEDURE CheckDeleteBudgetOnStatChange@1210190001(IStatusOld@1210190001 : Option;IStatusNew@1210190000 : Option) : Boolean;
    BEGIN
      IF (IStatusOld IN [Status::Order, Status::Invoice]) AND (NOT (IStatusNew IN [Status::Order, Status::Invoice])) THEN
        EXIT(TRUE);
    END;

    PROCEDURE UpdateWorkBudgetOnChanges@1210190003(IOptionRec@1210190000 : Record 11012502;IOnDeleteOptionMode@1210190004 : Boolean;IOnResetOptionStatusMode@1210190005 : Boolean);
    VAR
      lvProjRec@1210190003 : Record 11072003;
      lvOptionRec@1210190001 : Record 11012502;
      lvCopyOptBudgToBudgetRpt@1210190002 : Report 11012500;
    BEGIN
      //* i.a. at changing option status or when something will be changed in option budget/surcharges.
      //**4PS - Call: C-005410.sn
      JobSetup.GET();
      IF JobSetup."Company Type" = JobSetup."Company Type"::"Development Company" THEN
        EXIT;
      //**4PS - Call: C-005410.en
      IF JobSetup."Batch update budg from option" THEN
        EXIT;
      WITH IOptionRec DO BEGIN
        IF (NOT (Status IN [Status::Order, Status::Invoice])) OR ("Plot No." = '')  THEN
          EXIT;

        lvProjRec.SETRANGE("No.", "Project No.");
        lvCopyOptBudgToBudgetRpt.SETTABLEVIEW(lvProjRec);
        lvOptionRec.SETRANGE("Plot No.", "Plot No.");
        lvOptionRec.SETRANGE("House Model", "House Model");
        lvOptionRec.SETRANGE("Main Group", "Main Group");
        lvOptionRec.SETRANGE(Group, Group);
        lvOptionRec.SETRANGE("Sub Group", "Sub Group");
        lvOptionRec.SETRANGE(Option, Option);
        lvCopyOptBudgToBudgetRpt.SETTABLEVIEW(lvOptionRec);
        lvCopyOptBudgToBudgetRpt.USEREQUESTPAGE(FALSE);
        IF IOnDeleteOptionMode THEN BEGIN
          lvCopyOptBudgToBudgetRpt.SetOnDeletePlotOptionRun(
            "Project No.", "Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
        END ELSE BEGIN
          IF IOnResetOptionStatusMode THEN
            lvCopyOptBudgToBudgetRpt.SetOnResetOptionStatusRun(
              "Project No.", "Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
        END;
        lvCopyOptBudgToBudgetRpt.RUNMODAL;
      END;
    END;

    PROCEDURE CheckUpdateOptionCrossList@1210190002(IOptionRec@1210190003 : Record 11012502);
    VAR
      lvProjOptionRec@1210190002 : Record 11012502;
      lvCrossListRec@1210190001 : Record 11012515;
      lvCrossListLineRec@1210190000 : Record 11012516;
    BEGIN
      WITH IOptionRec DO BEGIN
        //* Only Plot Options in the Cross List
        IF "Plot No." = '' THEN
          EXIT;

        //* Only when the Cross List of the option is present
        IF NOT lvCrossListRec.GET("Project No.", "House Model", "Main Group", Group, "Sub Group", Option) THEN
          EXIT;

        //* Only Plot Option that are present on project level are allowed in the Cross List (so not plot specific options)
        IF NOT lvProjOptionRec.GET("Project No.", '', "House Model", "Main Group", Group, "Sub Group", Option) THEN
          EXIT;

        //* Only when the plot option is not already present on the Cross List
        IF lvCrossListLineRec.GET("Project No.", "House Model", "Main Group", Group, "Sub Group", Option, "Plot No.") THEN BEGIN
          IF (IOptionRec.Quantity = 0) OR (IOptionRec.Status = IOptionRec.Status::Expired) THEN BEGIN
            lvCrossListLineRec.DELETE(FALSE);
            lvCrossListLineRec.SetModifiedInHeader();
          END ELSE BEGIN
            IF (IOptionRec.Quantity <> lvCrossListLineRec.Quantity) THEN BEGIN
              lvCrossListLineRec.Quantity := IOptionRec.Quantity;
              lvCrossListLineRec.MODIFY(FALSE);  //* FALSE, no check on option status
              lvCrossListLineRec.SetModifiedInHeader();
            END;
          END;
        END ELSE BEGIN
          IF IOptionRec.Quantity <> 0 THEN BEGIN
            lvCrossListLineRec.INIT;
            lvCrossListLineRec."Project No." := "Project No.";
            lvCrossListLineRec."House Model" := "House Model";
            lvCrossListLineRec."Main Group" := "Main Group";
            lvCrossListLineRec.Group := Group;
            lvCrossListLineRec."Sub Group" := "Sub Group";
            lvCrossListLineRec.Option := Option;
            lvCrossListLineRec."Plot No." := "Plot No.";
            lvCrossListLineRec.Quantity := IOptionRec.Quantity;
            lvCrossListLineRec.INSERT(FALSE);
            lvCrossListLineRec.SetModifiedInHeader();
          END;
        END;
      END;
    END;

    PROCEDURE CheckDeleteOptionCrossList@1100485000(IOptionRec@1210190003 : Record 11012502);
    VAR
      lvCrossListRec@1100485000 : Record 11012515;
      lvCrossListLineRec@1210190000 : Record 11012516;
    BEGIN
      WITH IOptionRec DO BEGIN
        //* Only Cross List for Project Options
        IF ("Project No." = '') OR ("Plot No." <> '') THEN
          EXIT;

        //* Delete when Cross List has no lines, delete option not allowed
        IF lvCrossListRec.GET("Project No.", "House Model", "Main Group", Group, "Sub Group", Option) THEN BEGIN
          lvCrossListLineRec.SETRANGE("Project No.", "Project No.");
          lvCrossListLineRec.SETRANGE("House Model", "House Model");
          lvCrossListLineRec.SETRANGE("Main Group", "Main Group");
          lvCrossListLineRec.SETRANGE(Group, Group);
          lvCrossListLineRec.SETRANGE("Sub Group", "Sub Group");
          lvCrossListLineRec.SETRANGE(Option, Option);
          IF lvCrossListLineRec.FIND('-') THEN
            FIELDERROR(Option, Text001);
          lvCrossListRec.DELETE;
        END;
      END;
    END;

    PROCEDURE CheckDeleteOptionCrossListLine@1210190004(IOptionRec@1210190003 : Record 11012502);
    VAR
      lvCrossListLineRec@1210190000 : Record 11012516;
    BEGIN
      WITH IOptionRec DO BEGIN
        //* Only Plot Options in the Cross List
        IF "Plot No." = '' THEN
          EXIT;

        //* Only when the plot option is already present on the Cross List
        IF lvCrossListLineRec.GET("Project No.", "House Model", "Main Group", Group, "Sub Group", Option, "Plot No.") THEN
          lvCrossListLineRec.DELETE(TRUE);
      END;
    END;

    LOCAL PROCEDURE CheckDeleteDocumentLinks@1100527800(Option@1100527800 : Record 11012502);
    VAR
      DocumentLink@1100527801 : Record 11012747;
    BEGIN
      DocumentLink.SETRANGE("Record ID",Option.RECORDID);
      DocumentLink.DELETEALL;
    END;

    PROCEDURE CheckOnOptionCrossListLine@1100525000(IOptionRec@1210190003 : Record 11012502) : Boolean;
    VAR
      lvCrossListLineRec@1210190000 : Record 11012516;
    BEGIN
      WITH IOptionRec DO BEGIN
        //* Only Plot Options in the Cross List
        IF "Plot No." <> '' THEN BEGIN
          IF lvCrossListLineRec.GET("Project No.", "House Model", "Main Group", Group, "Sub Group", Option, "Plot No.") THEN
            EXIT(TRUE);
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE CopyStandardOptionSurcharges@1100485001();
    VAR
      lvStdSurchargeRec@1210190000 : Record 11012512;
      lvOptSurchargeRec@1210190003 : Record 11012512;
      lvBuyerMgtCU@1210190002 : Codeunit 11012500;
      lvNextLineNo@1210190001 : Integer;
    BEGIN
      lvStdSurchargeRec.SETRANGE("Project No.",'');
      lvStdSurchargeRec.SETRANGE("House Model",'');
      lvStdSurchargeRec.SETRANGE("Main Group",'');
      lvStdSurchargeRec.SETRANGE(Group,'');
      lvStdSurchargeRec.SETRANGE("Sub Group",'');
      lvStdSurchargeRec.SETRANGE("Plot No.",'');
      lvStdSurchargeRec.SETRANGE(Option,'');
      IF lvStdSurchargeRec.FIND('-') THEN BEGIN
        lvOptSurchargeRec.SETRANGE("Project No.","Project No.");
        lvOptSurchargeRec.SETRANGE("Plot No.","Plot No.");
        lvOptSurchargeRec.SETRANGE("House Model","House Model");
        lvOptSurchargeRec.SETRANGE("Main Group","Main Group");
        lvOptSurchargeRec.SETRANGE(Group,Group);
        lvOptSurchargeRec.SETRANGE("Sub Group","Sub Group");
        lvOptSurchargeRec.SETRANGE(Option,Option);
        lvNextLineNo := 10000;
        IF lvOptSurchargeRec.FIND('+') THEN
          lvNextLineNo := lvNextLineNo + lvOptSurchargeRec."Line No.";

        REPEAT
          lvOptSurchargeRec := lvStdSurchargeRec;
          lvOptSurchargeRec."Project No." := "Project No.";
          lvOptSurchargeRec."Plot No." := "Plot No.";
          lvOptSurchargeRec."House Model" := "House Model";
          lvOptSurchargeRec."Main Group" := "Main Group";
          lvOptSurchargeRec.Group := Group;
          lvOptSurchargeRec."Sub Group" := "Sub Group";
          lvOptSurchargeRec.Option := Option;
          lvOptSurchargeRec."Line No." := lvNextLineNo;
          lvOptSurchargeRec."Surcharge Amount" := 0;
          lvOptSurchargeRec.INSERT(FALSE);
          lvNextLineNo := lvNextLineNo + 10000;
        UNTIL lvStdSurchargeRec.NEXT = 0;
        lvBuyerMgtCU.BmCalcSurchargesUpdateOption(
          "Project No.","Plot No.","House Model","Main Group",Group,"Sub Group",Option,FALSE,lvOptSurchargeRec);
      END;
    END;

    PROCEDURE UpdateOptQuoteStatus@1100528700(IOptionRec@1100485001 : Record 11012502);
    VAR
      lvOptQuoteLineRec@1100485000 : Record 11012514;
    BEGIN
      WITH lvOptQuoteLineRec DO BEGIN
        SETCURRENTKEY("Project No.","Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
        SETRANGE("Project No.", IOptionRec."Project No.");
        SETRANGE("Plot No.", IOptionRec."Plot No.");
        SETRANGE("House Model", IOptionRec."House Model");
        SETRANGE("Main Group", IOptionRec."Main Group");
        SETRANGE(Group, IOptionRec.Group);
        SETRANGE("Sub Group", IOptionRec."Sub Group");
        SETRANGE(Option, IOptionRec.Option);
        SETFILTER(Status, '<>%1', IOptionRec.Status);
        IF FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            Status := IOptionRec.Status;
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END;
    END;

    PROCEDURE ShowDocuments@1100485003();
    VAR
      RecRef@1100525000 : RecordRef;
      DocumentFilters@1100525001 : Codeunit 11012432;
    BEGIN
      IF Option = '' THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DocumentFilters.CreateTempFilterAndExecute1(RecRef, '', FALSE, TRUE);
    END;

    PROCEDURE SetSkipCheckDelete@1100485002();
    BEGIN
      SkipCheckDelete := TRUE;
    END;

    PROCEDURE CheckDeleteInstallmOnExpired@1100525002() : Boolean;
    VAR
      lvProjInstallmRec@1100525000 : Record 11012018;
    BEGIN
      lvProjInstallmRec.SETRANGE("Project No.", "Project No.");
      lvProjInstallmRec.SETRANGE(Principal, Principal);
      lvProjInstallmRec.SETRANGE("Plot No.", "Plot No.");
      lvProjInstallmRec.SETRANGE("Main Group", "Main Group");
      lvProjInstallmRec.SETRANGE(Group, Group);
      lvProjInstallmRec.SETRANGE("Sub Group", "Sub Group");
      lvProjInstallmRec.SETRANGE(Option, Option);
      IF lvProjInstallmRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvProjInstallmRec.CALCFIELDS("Invoiced Price (LCY)", "Invoice in Process (LCY)", "Credit Memo in Process (LCY)");
          IF (lvProjInstallmRec."Invoiced Price (LCY)" <> 0) OR
             (lvProjInstallmRec."Invoice in Process (LCY)" <> 0) OR (lvProjInstallmRec."Credit Memo in Process (LCY)" <> 0)
          THEN BEGIN
            MESSAGE(Text005, "Plot No.", "Main Group", Group, "Sub Group", Option);
            EXIT(FALSE);
          END;
        UNTIL lvProjInstallmRec.NEXT = 0;
        lvProjInstallmRec.DELETEALL;  //* Delete all if not yet invoiced, else delete none
      END;
      EXIT(TRUE);
    END;

    PROCEDURE SetClosingDate@1210190005();
    VAR
      Plot@1210190002 : Record 11012500;
      OptionMainGroup@1100525000 : Record 11012509;
      OptionGroup@1210190000 : Record 11012504;
      OptionSubGroup@1210190001 : Record 11012505;
    BEGIN
      //kzwerver, 110808, n, #26039
      IF ("Closing Date" <> 0D) THEN
        EXIT;

      IF ((OptionSubGroup.GET("Project No.", "Plot No.", "Sub Group")) AND (OptionSubGroup."Closing Date" <> 0D)) THEN
        VALIDATE("Closing Date", OptionSubGroup."Closing Date");

      IF ("Closing Date" = 0D) THEN BEGIN
        IF ((OptionGroup.GET("Project No.", "Plot No.", Group)) AND (OptionGroup."Closing Date" <> 0D)) THEN
          VALIDATE("Closing Date", OptionGroup."Closing Date");
      END;

      IF ("Closing Date" = 0D) THEN BEGIN
        IF ((OptionMainGroup.GET("Project No.", "Plot No.", "Main Group")) AND (OptionMainGroup."Closing Date" <> 0D)) THEN
          VALIDATE("Closing Date", OptionMainGroup."Closing Date");
      END;

      IF ("Closing Date" = 0D) THEN BEGIN
        IF (Plot.GET("Project No.", "Plot No.")) THEN
          "Closing Date" := Plot."Options Closing Date";
      END;
    END;

    PROCEDURE CopyOptionText@1100528300(TextTypeFrom@1100528302 : 'Sales,Technical,Internal';TextTypeTo@1100528303 : 'Sales,Technical,Internal');
    VAR
      BuyerManagementTextFrom@1100528300 : Record 11012511;
      BuyerManagementTextTo@1100528301 : Record 11012511;
      LastTextLineNo@1100528304 : Integer;
    BEGIN
      IF (TextTypeFrom = TextTypeTo) THEN
        EXIT;
      CALCFIELDS("Internal Text", "Sales Text", "Technical Text");
      CASE TRUE OF
        (TextTypeFrom = TextTypeFrom::Internal) AND (NOT "Internal Text"),
        (TextTypeFrom = TextTypeFrom::Sales) AND (NOT "Sales Text"),
        (TextTypeFrom = TextTypeFrom::Technical) AND (NOT "Technical Text"):
          EXIT;
      END;
      BuyerManagementTextFrom.SETRANGE(Table, BuyerManagementTextFrom.Table::Option);
      BuyerManagementTextFrom.SETRANGE("Text Type", TextTypeFrom);
      BuyerManagementTextFrom.SETRANGE("Project No.", "Project No.");
      BuyerManagementTextFrom.SETRANGE("House Model", "House Model");
      BuyerManagementTextFrom.SETRANGE("Option Main Group", "Main Group");
      BuyerManagementTextFrom.SETRANGE("Option Sub Group", "Sub Group");
      BuyerManagementTextFrom.SETRANGE("Option Group", Group);
      BuyerManagementTextFrom.SETRANGE("Plot No.", "Plot No.");
      BuyerManagementTextFrom.SETRANGE(Option, Option);
      BuyerManagementTextFrom.SETRANGE("Quote No.", '');
      BuyerManagementTextFrom.SETRANGE("Quote Line No.", 0);
      IF (NOT BuyerManagementTextFrom.FINDSET) THEN
        EXIT;

      BuyerManagementTextTo.COPYFILTERS(BuyerManagementTextFrom);
      BuyerManagementTextTo.SETRANGE("Text Type", TextTypeTo);
      IF (BuyerManagementTextTo.FINDLAST) THEN
        LastTextLineNo := BuyerManagementTextTo."Text Line No."
      ELSE
        LastTextLineNo := 0;
      BuyerManagementTextTo.RESET;

      REPEAT
        LastTextLineNo += 10000;
        BuyerManagementTextTo.COPY(BuyerManagementTextFrom);
        BuyerManagementTextTo."Text Type" := TextTypeTo;
        BuyerManagementTextTo."Text Line No." := LastTextLineNo;
        BuyerManagementTextTo.INSERT(TRUE);
      UNTIL (BuyerManagementTextFrom.NEXT = 0);
    END;

    LOCAL PROCEDURE PlotInstallmentsHaveBeenGenerated@1100528602() : Boolean;
    VAR
      Plot@1100528600 : Record 11012500;
    BEGIN
      IF "Project No." = '' THEN
        EXIT;
      Plot.GET("Project No.", "Plot No.");
      EXIT(Plot."Installments Generated");
    END;

    LOCAL PROCEDURE TestIfPlotInstallmentsAreNotGenerated@1100528600();
    VAR
      Plot@1100528600 : Record 11012500;
    BEGIN
      IF "Project No." = '' THEN
        EXIT;
      Plot.GET("Project No.", "Plot No.");
      Plot.TESTFIELD("Installments Generated", FALSE);
    END;

    LOCAL PROCEDURE CreateCreditInstallmentForModularOption@1100528601();
    VAR
      GenerateProjectInstallments@1100528602 : Codeunit 11012007;
      AddModularOptionDataPAGE@1100528600 : Page 11130305;
    BEGIN
      TESTFIELD(Modular);
      MODIFY(TRUE);
      COMMIT;
      IF AddModularOptionDataPAGE.RUNMODAL = ACTION::OK THEN BEGIN
        "Installment Scheme" := AddModularOptionDataPAGE.GetInstallmentScheme();
        TESTFIELD("Installment Scheme");
        "Generate Installments" := TRUE;
        MODIFY(TRUE);
        GenerateProjectInstallments.FromExpiredModularOption("Project No.", "Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
      END;
    END;

    PROCEDURE SetSkipStatusWarning@1100529600(NewSkipStatusWarning@1100529600 : Boolean);
    BEGIN
      SkipStatusWarning := NewSkipStatusWarning;
    END;

    PROCEDURE OnValidateSalesPriceInclVAT@1100528402(HeaderStatusChange@1100528400 : Boolean);
    BEGIN
      IF CurrFieldNo > 0 THEN
        TESTFIELD("Fixed Sales Price", FALSE);
      DetermineTotal(NOT HeaderStatusChange);
    END;

    PROCEDURE BuyerFactor@1100528400() : Decimal;
    BEGIN
      IF "Developers Discount Percentage" = 100 THEN
        FIELDERROR("Developers Discount Percentage");

      EXIT(
        (100 / (100 - "Developers Discount Percentage")) *
        ((100 + "Contractor Surcharge %") / 100));
    END;

    PROCEDURE InverseBuyerFactor@1100528401() : Decimal;
    BEGIN
      IF "Contractor Surcharge %" = -100 THEN
        FIELDERROR("Contractor Surcharge %");

      EXIT(
        ((100 - "Developers Discount Percentage") / 100) *
        (100 / (100 + "Contractor Surcharge %")));
    END;

    LOCAL PROCEDURE CheckIfGeneratingInstallmentsIsAllowed@1100528403(GiveError@1100528401 : Boolean) : Boolean;
    VAR
      OptionQuoteHeader@1100528400 : Record 11012513;
    BEGIN
      IF Modular THEN
        IF GiveError THEN
          TESTFIELD(Modular, FALSE)
        ELSE
          EXIT(FALSE);

      OptionQuoteHeader.SETRANGE("Project No.", "Project No.");
      OptionQuoteHeader.SETRANGE("Plot No.", "Plot No.");

      OptionQuoteHeader.SETRANGE("Generate Installments", TRUE);
      IF OptionQuoteHeader.FINDFIRST THEN
        IF GiveError THEN
          OptionQuoteHeader.TESTFIELD("Generate Installments", FALSE)
        ELSE
          EXIT(FALSE);

      OptionQuoteHeader.SETRANGE("Generate Installments");
      OptionQuoteHeader.SETFILTER("Installment Scheme", '<>%1', '');
      IF OptionQuoteHeader.FINDFIRST THEN
        IF GiveError THEN
          OptionQuoteHeader.TESTFIELD("Installment Scheme", '')
        ELSE
          EXIT(FALSE);

      OptionQuoteHeader.SETRANGE("Installment Scheme");
      OptionQuoteHeader.SETRANGE("Installments Generated", TRUE);
      IF OptionQuoteHeader.FINDFIRST THEN
        IF GiveError THEN
          OptionQuoteHeader.TESTFIELD("Installments Generated", FALSE)
        ELSE
          EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE UpdateSalesPrices@1100528407(PercentageToIncrease@1100528401 : Decimal;RoundUpSlsPriceExclVAT@1100528402 : Boolean;RoundSlsPriceInclVATBuyer@1100528400 : Boolean;RoundSlsPriceExclVATBuyer@1100528403 : Boolean);
    BEGIN
      "Sales Price incl. VAT" := ROUND((100 + PercentageToIncrease) * "Sales Price incl. VAT" / 100);
      VALIDATE("Sales Price incl. VAT");
      IF RoundUpSlsPriceExclVAT THEN
        RoundUpSalesPriceExclVAT;
      IF RoundSlsPriceInclVATBuyer THEN
        RoundSalesPriceInclVATBuyer;
      IF RoundSlsPriceExclVATBuyer THEN
        RoundSalesPriceExclVATBuyer;
      MODIFY(TRUE);
    END;

    LOCAL PROCEDURE RoundUpSalesPriceExclVAT@1100528406();
    BEGIN
      "Sales Price excl. VAT" := ROUND("Sales Price excl. VAT", 1, '>');
      VALIDATE("Sales Price excl. VAT");
    END;

    LOCAL PROCEDURE RoundSalesPriceInclVATBuyer@1100528404();
    BEGIN
      TESTFIELD("Developers Discount Percentage", 0);
      IF "Sales Price incl. VAT" = 0 THEN
        VALIDATE("Sales Price incl. VAT (Buyer)", 0)
      ELSE BEGIN
        "Sales Price incl. VAT (Buyer)" := ROUND("Sales Price incl. VAT (Buyer)", 1);
        "Contractor Surcharge %" := BuyerMgtCU.CalculateContractorSurchargePercentage(
          "Sales Price incl. VAT", "Sales Price incl. VAT (Buyer)", 15);
        VALIDATE("Sales Price incl. VAT (Buyer)");
      END;
    END;

    LOCAL PROCEDURE RoundSalesPriceExclVATBuyer@1100528405();
    BEGIN
      TESTFIELD("Developers Discount Percentage", 0);
      IF "Sales Price excl. VAT" = 0 THEN
        VALIDATE("Sales Price excl. VAT (Buyer)", 0)
      ELSE BEGIN
        "Sales Price excl. VAT (Buyer)" := ROUND("Sales Price excl. VAT (Buyer)", 1);
        "Contractor Surcharge %" := BuyerMgtCU.CalculateContractorSurchargePercentage(
          "Sales Price excl. VAT", "Sales Price excl. VAT (Buyer)", 15);
        VALIDATE("Sales Price excl. VAT (Buyer)");
      END;
    END;

    BEGIN
    END.
  }
}

