OBJECT Page 11012066 Approve Purchase Invoices
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    Permissions=TableData 122=rimd;
    CaptionML=[DEU=Einkaufsrechnungen genehmigen;
               ENU=Approve Purchase Invoices;
               NLD=Inkoopfacturen goedkeuren;
               NOR=Godkjenn innkjõpsfakturaer;
               SVE=GodkÑnn inkîpsfakturor];
    InsertAllowed=No;
    DeleteAllowed=No;
    SourceTable=Table122;
    SourceTableView=WHERE(Invoice Approved=CONST(No));
    PageType=Document;
    RefreshOnActivate=Yes;
    PromotedActionCategoriesML=[DEU=Neu, Verarbeiten, Bericht, Belege mailen, Genehmigung;
                                ENU=New,Process,Report,Mail Documents,Approval;
                                NLD=Nieuw,Proces,Lijst,Documenten mailen,Goedkeuring];
    OnInit=BEGIN
             "Ext. Document IDEditable" := TRUE;
             "Ext. Document IDVisible" := TRUE;
             "Remain On HoldEditable" := TRUE;
           END;

    OnOpenPage=VAR
                 JnlSelected@1210190000 : Boolean;
               BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**4PS Generated Code.en01

                 IF ApprJnlTemplate <> '' THEN BEGIN
                   FILTERGROUP(2);
                   SETRANGE("Journal Template", ApprJnlTemplate);
                   FILTERGROUP(0);
                   JnlSelected := TRUE;
                 END ELSE

                 PurchSetup.GET;
                 IF PurchSetup."Scanning Application Purch.Inv" <> PurchSetup."Scanning Application Purch.Inv"::Other THEN BEGIN
                   "Ext. Document IDEditable" := FALSE;
                   "Ext. Document IDVisible" := FALSE;
                 END;

                 "On HoldEditable" := PurchSetup."On Hold Maintainable";

                 RemainOnHoldEditable := "Remain On HoldEditable"; //This might be changed bij user
               END;

    OnAfterGetRecord=VAR
                       lVendLedgEntryRec@1100485000 : Record 25;
                       lvTmpDummyErrorRec@1100485002 : TEMPORARY Record 11012052;
                       lvWKACalcCU@1100485001 : Codeunit 11012020;
                     BEGIN
                       "Remain On HoldEditable" := (RemainOnHoldEditable AND ("On Hold" <> ''));

                       IF gFromReference THEN BEGIN
                         gFromReference := FALSE;
                         CurrPage.ApprovalLines.PAGE.InitSelectionFromReference(gApprLineNo);
                       END;

                       gWKAPresent := FALSE;
                       IF "Subcontracting Invoice" THEN BEGIN
                         lVendLedgEntryRec.SETCURRENTKEY("Document No.");
                         lVendLedgEntryRec.SETRANGE("Document Type",lVendLedgEntryRec."Document Type"::Invoice);
                         lVendLedgEntryRec.SETRANGE("Document No.","No.");
                         lVendLedgEntryRec.SETRANGE("Vendor No.","Buy-from Vendor No.");
                         IF lVendLedgEntryRec.FINDFIRST THEN
                           gWKAPresent := lvWKACalcCU.CheckExternal(lVendLedgEntryRec, lvTmpDummyErrorRec);
                       END;
                     END;

    OnNewRecord=BEGIN
                  //**4PS Generated Code. Do Not Change.sn02
                  DPA_SetDefaultDepartment;
                  //**4PS Generated Code.en02
                END;

    OnInsertRecord=VAR
                     xRecRef@1100000999 : RecordRef;
                   BEGIN
                     //**4PS Generated Code. Do Not Change.sn05
                     xRecRef.GETTABLE(xRec);
                     DPA_SetDefaultDpmtFromNoSeries(xRecRef);
                     //**4PS Generated Code.en05
                   END;

    OnAfterGetCurrRecord=VAR
                           RecRef@1100528700 : RecordRef;
                         BEGIN
                           RecRef.GETTABLE(Rec);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetRecordReference(RecRef);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetByCompany(TRUE);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetDepartmentCode('');
                           SetControlAppearance;
                           ShowWorkflowStatus := CurrPage.WorkflowStatus.PAGE.SetFilterOnWorkflowRecord(RECORDID);

                           FillDocumentViewerFactbox;
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 114     ;1   ;ActionGroup;
                      CaptionML=[DEU=R&echnung;
                                 ENU=&Invoice;
                                 NLD=&Factuur;
                                 NOR=Fa&ktura;
                                 SVE=Fa&ktura] }
      { 116     ;2   ;Action    ;
                      ShortCutKey=F7;
                      CaptionML=[DEU=Statistik;
                                 ENU=Statistics;
                                 NLD=Statistiek;
                                 NOR=Statistikk;
                                 SVE=Statistik];
                      RunObject=Page 400;
                      RunPageLink=No.=FIELD(No.);
                      Promoted=Yes;
                      Image=Statistics;
                      PromotedCategory=Process }
      { 117     ;2   ;Action    ;
                      CaptionML=[DEU=Be&merkungen;
                                 ENU=Co&mments;
                                 NLD=Op&merkingen;
                                 NOR=Ko&mmentarer;
                                 SVE=Ko&mmentarer];
                      RunObject=Page 66;
                      RunPageLink=Document Type=CONST(Posted Invoice),
                                  No.=FIELD(No.);
                      Image=ViewComments }
      { 1000000000;2 ;Action    ;
                      CaptionML=[DEU=Dimensionen;
                                 ENU=Dimensions;
                                 NLD=Dimensies;
                                 NOR=Dimensjoner;
                                 SVE=Dimensioner];
                      Image=Dimensions;
                      OnAction=BEGIN
                                 ShowDimensions;
                               END;
                                }
      { 1100485006;2 ;Action    ;
                      ShortCutKey=Shift+Ctrl+S;
                      CaptionML=[DEU=Gescannter Beleg;
                                 ENU=Scanned Document;
                                 NLD=Gescand document;
                                 NOR=Skannet Dokument;
                                 SVE=Skannade dokument];
                      Image=Document;
                      OnAction=BEGIN
                                 IF "Order Type (SiB)" = "Order Type (SiB)"::Invoice THEN
                                   PurchSetup.OpenExternalDocumentSiB("Ext. Document ID")  //db, 16-09-14
                                 ELSE
                                   PurchSetup.ShowScannedDocument(2,"No.","Buy-from Vendor No.","Ext. Document ID");
                               END;
                                }
      { 1100528703;2 ;Action    ;
                      CaptionML=[DEU=Belege;
                                 ENU=Documents;
                                 NLD=Documenten;
                                 NOR=Dokument;
                                 SVE=Dokument];
                      Image=Documents;
                      OnAction=VAR
                                 RecRef@1100528700 : RecordRef;
                                 DocumentFilters@1100528701 : Codeunit 11012432;
                               BEGIN
                                 RecRef.GETTABLE(Rec);
                                 DocumentFilters.CreateTempFilterAndExecute1(RecRef, "Shortcut Dimension 1 Code", FALSE, TRUE);
                               END;
                                }
      { 1210190012;2 ;Action    ;
                      CaptionML=[DEU=ICF-Spezifikationen;
                                 ENU=ICF Specifications;
                                 NLD=ICF specificaties;
                                 NOR=ICF-spesifikasjoner;
                                 SVE=ICF-specifikationer];
                      Image=SetupList;
                      OnAction=BEGIN
                                 ShowICFInvoiceLines;
                               END;
                                }
      { 1100528206;2 ;ActionGroup;
                      CaptionML=[DEU=&Genehmigung;
                                 ENU=&Approval;
                                 NLD=&Goedkeuring;
                                 SVE=&GodkÑnnanden];
                      Image=BOMLedger }
      { 1100528203;3 ;Action    ;
                      CaptionML=[DEU=Genehmigungsposten;
                                 ENU=Approval Entries;
                                 NLD=Goedkeuringsposten;
                                 NOR=Godkjenningstransaksjoner;
                                 SVE=GodkÑnnandetransaktioner];
                      RunObject=Page 658;
                      RunPageView=WHERE(Table ID=CONST(122));
                      RunPageLink=Document No.=FIELD(No.);
                      Image=BOMLedger }
      { 1100528204;3 ;Action    ;
                      CaptionML=[DEU=Genehmigungskommentare;
                                 ENU=Approval Comments;
                                 NLD=Goedkeurings opmerkingen;
                                 NOR=Godkjenningsmerknader;
                                 SVE=GodkÑnnandekommentarer];
                      OnAction=VAR
                                 ApprovalEntry@1100527001 : Record 454;
                                 ApprovalCommentLine@1100527000 : Record 455;
                               BEGIN
                                 //**4PS
                                 IF OpenApprovalEntriesExist THEN BEGIN
                                   ApprovalManagement4PSConstr.FilterApprovalEntryOpen(DATABASE::"Purch. Inv. Header", 2, "No.", ApprovalEntry, FALSE);
                                   ApprovalCommentLine.SETRANGE("Table ID", DATABASE::"Purch. Inv. Header");
                                   ApprovalCommentLine.SETRANGE("Record ID to Approve", RECORDID);
                                   ApprovalCommentLine."Workflow Step Instance ID" := ApprovalEntry."Workflow Step Instance ID";
                                   ApprovalManagement4PSConstr.DrillDownApprovalCommentsHdr(ApprovalEntry,ApprovalCommentLine);
                                 END;
                               END;
                                }
      { 1100528201;3 ;Action    ;
                      CaptionML=[DEU=Gebuchte GenehmigungseintrÑge;
                                 ENU=Posted Approval Entries;
                                 NLD=Geboekte goedkeuringsposten;
                                 NOR=Bokfõrte godkjenningsposter;
                                 SVE=Bokfîrda godkÑnnandetransaktioner];
                      RunObject=Page 659;
                      RunPageView=WHERE(Table ID=CONST(122));
                      RunPageLink=Document No.=FIELD(No.);
                      Image=BOMLedger }
      { 1100528202;3 ;Action    ;
                      CaptionML=[DEU=Gebuchte Genehmigungskommentare;
                                 ENU=Posted Approval Comments;
                                 NLD=Geboekte goedkeurings opmerkingen;
                                 NOR=Bokfõrte godkjenningsmerknader;
                                 SVE=Bokfîrda godkÑnnandekommentarer];
                      RunObject=Page 661;
                      RunPageView=WHERE(Table ID=CONST(122));
                      RunPageLink=Document No.=FIELD(No.) }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 118     ;1   ;Action    ;
                      CaptionML=[DEU=&Navigate;
                                 ENU=&Navigate;
                                 NLD=&Navigeren;
                                 NOR=&Naviger;
                                 SVE=Anal&ysera];
                      Promoted=Yes;
                      Image=Navigate;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 Navigate;
                               END;
                                }
      { 1100529900;1 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=D&rucken;
                                 ENU=&Print;
                                 NLD=&Afdrukken;
                                 NOR=Skriv &ut;
                                 SVE=Skriv &ut];
                      Promoted=Yes;
                      Image=Print;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 PurchInvHeader@1100529900 : Record 122;
                               BEGIN
                                 CurrPage.SETSELECTIONFILTER(PurchInvHeader);
                                 PurchInvHeader.PrintRecords(TRUE);
                               END;
                                }
      { 1100528405;1 ;ActionGroup;
                      CaptionML=[DEU=Freigeben;
                                 ENU=Release;
                                 NLD=Vrijgeven;
                                 NOR=Frigi;
                                 SVE=SlÑppa];
                      Image=Release }
      { 1100528404;2 ;Action    ;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=[DEU=&Freigeben;
                                 ENU=Re&lease;
                                 NLD=&Vrijgeven;
                                 NOR=&Frigi;
                                 SVE=&SlÑpp];
                      Promoted=Yes;
                      Image=ReleaseDoc;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 Release;
                               END;
                                }
      { 1100528403;2 ;Action    ;
                      CaptionML=[DEU=Stat&us zurÅcksetzen;
                                 ENU=Re&open;
                                 NLD=Opnieu&w openen;
                                 NOR=&GjenÜpne;
                                 SVE=&ôppna igen];
                      Image=ReOpen;
                      OnAction=BEGIN
                                 Reopen;
                               END;
                                }
      { 1100528413;1 ;ActionGroup;
                      CaptionML=[DEU=Genehmigung;
                                 ENU=Approval;
                                 NLD=Goedkeuring;
                                 NOR=Godkjenning;
                                 SVE=GodkÑnnande] }
      { 1100528412;2 ;Action    ;
                      Name=Approve;
                      CaptionML=[DEU=Genehmigen;
                                 ENU=Approve;
                                 NLD=Goedkeuren;
                                 NOR=Godkjenn;
                                 SVE=GodkÑnn];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Approve;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                                 ApprovalEntry@1100528200 : Record 454;
                               BEGIN
                                 ApprovalsMgmt.ApproveRecordApprovalRequest(RECORDID);

                                 IF NOT ApprovalsMgmt.FindOpenApprovalEntryForCurrUser(ApprovalEntry,RECORDID) THEN
                                   MARK(FALSE);
                                 CurrPage.UPDATE(FALSE);
                                 IF NOT FIND('=><') THEN
                                   CurrPage.CLOSE;
                               END;
                                }
      { 1100528411;2 ;Action    ;
                      Name=Reject;
                      CaptionML=[DEU=Ablehnen;
                                 ENU=Reject;
                                 NLD=Weigeren;
                                 NOR=Avvis;
                                 SVE=Avvisa];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Reject;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.RejectRecordApprovalRequest(RECORDID);
                               END;
                                }
      { 1100528410;2 ;Action    ;
                      Name=Delegate;
                      CaptionML=[DEU=Delegieren;
                                 ENU=Delegate;
                                 NLD=Delegeren;
                                 NOR=Deleger;
                                 SVE=Delegera];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      Image=Delegate;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.DelegateRecordApprovalRequest(RECORDID);
                               END;
                                }
      { 1100528409;2 ;Action    ;
                      Name=Comment;
                      CaptionML=[DEU=Bemerkungen;
                                 ENU=Comments;
                                 NLD=Opmerkingen;
                                 NOR=Merknader;
                                 SVE=Kommentarer];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      Image=ViewComments;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalEntry@1100525001 : Record 454;
                                 ApprovalCommentLine@1100525000 : Record 455;
                               BEGIN
                                 //**4PS.sn
                                 IF OpenApprovalEntriesExist THEN BEGIN
                                   ApprovalManagement4PSConstr.FilterApprovalEntryOpen(DATABASE::"Purch. Inv. Header", 2, "No.", ApprovalEntry, FALSE);
                                   ApprovalCommentLine.SETRANGE("Table ID", DATABASE::"Purch. Inv. Header");
                                   ApprovalCommentLine.SETRANGE("Document No.", "No.");
                                   ApprovalCommentLine.SETRANGE("Record ID to Approve", RECORDID);
                                   ApprovalCommentLine."Workflow Step Instance ID" := ApprovalEntry."Workflow Step Instance ID";
                                   ApprovalManagement4PSConstr.DrillDownApprovalCommentsHdr(ApprovalEntry,ApprovalCommentLine);
                                 END;
                                 //**4PS.sn
                               END;
                                }
      { 1100525014;2 ;Action    ;
                      CaptionML=[DEU=&Gesperrt;
                                 ENU=&On Hold;
                                 NLD=Afwachten;
                                 SVE=S&toppad];
                      Promoted=Yes;
                      Visible=FALSE;
                      PromotedIsBig=Yes;
                      Image=Lock;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsBridge4PSConstruct@1100525000 : Codeunit 11125348;
                               BEGIN
                                 ApprovalsBridge4PSConstruct.OnHold(Rec);
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100528408;1 ;ActionGroup;
                      CaptionML=[DEU=Genehmigungsanforderung;
                                 ENU=Request Approval;
                                 NLD=Goedkeuring aanvragen;
                                 NOR=Be om godkjenning;
                                 SVE=BegÑr godkÑnnande];
                      Image=Action }
      { 1100528400;2 ;Action    ;
                      Name=SendApprovalRequest;
                      CaptionML=[DEU=&Genehmigungsanforderung senden;
                                 ENU=Send A&pproval Request;
                                 NLD=G&oedkeuringsaanvraag verzenden;
                                 NOR=&Send godkjenningsforespõrsel;
                                 SVE=Skicka godk&ÑnnandebegÑran];
                      Enabled=NOT OpenApprovalEntriesExist;
                      Image=SendApprovalRequest;
                      OnAction=VAR
                                 ApprovalManagement4PSConstr@1100528400 : Codeunit 11125349;
                                 ApprovalsBridge4PSConstruct@1100528401 : Codeunit 11125348;
                               BEGIN
                                 ApprovalManagement4PSConstr.CheckPostedPurchaseInvoiceApprovalsWorkflowEnabled(Rec);
                                   ApprovalsBridge4PSConstruct.OnSendPostedPurchaseInvoiceForApproval(Rec);
                               END;
                                }
      { 1100528406;2 ;Action    ;
                      Name=CancelApprovalRequest;
                      CaptionML=[DEU=&Genehmigungsanforderung stornieren;
                                 ENU=Cancel Approval Re&quest;
                                 NLD=&Goedkeuringsaanvraag annuleren;
                                 NOR=&Annuller godkjenningsforespõrsel;
                                 SVE=Annullera &godkÑnnandebegÑran];
                      Enabled=CanCancelApprovalForRecord;
                      Image=Cancel;
                      OnAction=VAR
                                 ApprovalsBridge4PSConstruct@1100528400 : Codeunit 11125348;
                               BEGIN
                                 ApprovalsBridge4PSConstruct.OnCancelPostedPurchaseInvoiceApprovalRequest(Rec);
                               END;
                                }
      { 1210190008;1 ;ActionGroup;
                      CaptionML=[DEU=F&unktion;
                                 ENU=F&unctions;
                                 NLD=F&uncties;
                                 NOR=Fu&nksjon;
                                 SVE=Fu&nktion] }
      { 1100525006;2 ;ActionGroup;
                      CaptionML=[DEU=Abrufen;
                                 ENU=Get;
                                 NLD=Ophalen;
                                 NOR=Hent;
                                 SVE=HÑmta];
                      Image=Import }
      { 1210190014;3 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=VerteilungsschlÅssel &abrufen;
                                 ENU=Get Allo&cation;
                                 NLD=Verdeel&sleutel ophalen;
                                 NOR=Hent Allo&kering;
                                 SVE=HÑmta till&delning];
                      Image=Import;
                      OnAction=VAR
                                 GetAllocation@1210190000 : Codeunit 11012048;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 GetAllocation.PurchaseInvoiceApproval(Rec);
                               END;
                                }
      { 1210190015;3 ;Action    ;
                      ShortCutKey=Ctrl+F11;
                      Ellipsis=Yes;
                      CaptionML=[DEU=&Wareneingangszeilen abrufen;
                                 ENU=&Get Receipt Lines;
                                 NLD=Ontva&ngstregels ophalen;
                                 NOR=&Hente Kvitteringsrader;
                                 SVE=HÑmta inl&everans];
                      Image=Import;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 CurrPage.ApprovalLines.PAGE.GetReceipt;
                               END;
                                }
      { 1100485092;3 ;Action    ;
                      CaptionML=[DEU=&Mietposten Werkzeug abrufen;
                                 ENU=Get Plant Rent Entries;
                                 NLD=In&huurposten materieel ophalen;
                                 NOR=Hente Transaksjoner for maskinutleie;
                                 SVE=HÑmta transaktioner fîr Maskinsuthyrning];
                      Image=Import;
                      OnAction=VAR
                                 GetPlantRentEntries@1100525000 : Report 11012589;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 TESTFIELD("No.");
                                 TESTFIELD("Buy-from Vendor No.");

                                 IF "DMS Status" > "DMS Status"::"Awaiting Line Entry" THEN
                                   FIELDERROR("DMS Status");

                                 GetPlantRentEntries.SetSelections("No.", DATABASE::"Purch. Inv. Header", FALSE, SavePeriodPlantRentEntries);
                                 GetPlantRentEntries.RUNMODAL;
                                 SavePeriodPlantRentEntries := TRUE;
                               END;
                                }
      { 1100485003;3 ;Action    ;
                      CaptionML=[DEU=Importieren MTC Rechnungsspezifizierung;
                                 ENU=Import MTC Invoice Specification;
                                 NLD=MTC Factuurspecificatie importeren;
                                 NOR=Importer MTC-fakturaspesifikasjon;
                                 SVE=Importera MTC-fakturaspecifikation];
                      Image=Import;
                      OnAction=VAR
                                 ImportMTCInvoiceSpec@1100525501 : XMLport 11012017;
                                 InStream@1100528500 : InStream;
                                 FromFile@1100528501 : Text;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);

                                 UPLOADINTOSTREAM(Text002, '', '', FromFile, InStream);

                                 ImportMTCInvoiceSpec.SETSOURCE(InStream);
                                 ImportMTCInvoiceSpec.SetPurchInvHeaderApproval(Rec, "Journal Template");
                                 ImportMTCInvoiceSpec.IMPORT;
                               END;
                                }
      { 1100525016;3 ;Action    ;
                      CaptionML=[DEU=Abzugsposten abrufen;
                                 ENU=Get Retention Ledger Entry;
                                 NLD=Inhoudingspost ophalen];
                      Image=Import;
                      OnAction=VAR
                                 ReleaseRetentionLines@1100525000 : Codeunit 11012258;
                               BEGIN
                                 //DP01406
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 ReleaseRetentionLines.GetRetentionLinePurchInvoiceApproval(Rec);
                               END;
                                }
      { 1100485012;2 ;Action    ;
                      CaptionML=[DEU=&Erstellen Rechnungszeilen fÅr Teilprojekte;
                                 ENU=Create Invoice Lines for Sub Projects;
                                 NLD=&Aanmaken factuurregels voor deelprojecten;
                                 NOR=Opprette Fakturarader for Underprosjekt;
                                 SVE=Skapa fakturarader fîr underprojekt];
                      Image=Split;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 DistrPurchLinesOverSubProjects(Rec);
                               END;
                                }
      { 1100485010;2 ;Action    ;
                      CaptionML=[DEU=Verteilen Rechnungsbetrag Åber Rechnungszeilen;
                                 ENU=Distribute Invoice Amount over Invoice Lines;
                                 NLD=Verdeel factuurbedrag over factuurregels;
                                 NOR=Distribuere Fakturabelõp over Fakturarader;
                                 SVE=Distribuera fakturabelopp îver fakturarader];
                      Image=Split;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 DistributeAmountOverLines;
                               END;
                                }
      { 1100525012;2 ;Action    ;
                      ShortCutKey=Shift+Ctrl+W;
                      CaptionML=[DEU=DMS Arbeitsvorgang starten;
                                 ENU=Start DMS Workflow;
                                 NLD=DMS workflow starten;
                                 NOR=Start DMS-Arbeidsflyt;
                                 SVE=Starta DMS-arbetsflîde];
                      Image=StepInto;
                      OnAction=VAR
                                 ScanApplicationsSetup@1100528400 : Record 11012134;
                               BEGIN
                                 CODEUNIT.RUN(CODEUNIT::"Purch. Inv. Start DMS WF", Rec);
                                 IF ScanApplicationsSetup.GET THEN
                                   IF ScanApplicationsSetup."Close Inv. Form Automatically" THEN
                                     CurrPage.CLOSE;
                               END;
                                }
      { 1210190013;2 ;Action    ;
                      CaptionML=[DEU=Abwickeln ohne DMS-Arbeitsvorgang;
                                 ENU=By-Pass DMS Workflow;
                                 NLD=Zonder DMS-workflow afhandelen;
                                 NOR=ForbigÜ DMS-arbeidsflyt;
                                 SVE=èsidosÑtt DMS-arbetsflîde];
                      RunObject=Codeunit 11012211;
                      Image=StepOver }
      { 1100525002;2 ;Action    ;
                      CaptionML=[DEU=Batch-Start DMS-Workflow;
                                 ENU=Batch Start DMS Workflow;
                                 NLD=Batch DMS workflow starten;
                                 NOR=0];
                      RunObject=Report 11012495;
                      Image=StepInto }
      { 1100525015;2 ;Action    ;
                      CaptionML=[DEU=Abzugszeile erstellen;
                                 ENU=Generate Retention Line;
                                 NLD=Inhoudingsregel genereren];
                      Image=Import;
                      OnAction=VAR
                                 InvoiceApprovalLine@1100525000 : Record 11012032;
                               BEGIN
                                 InvoiceApprovalLine.GenerateRetentionLine(Rec); //DP01406
                               END;
                                }
      { 1100525008;1 ;ActionGroup;
                      CaptionML=[DEU=Fremdarbeit;
                                 ENU=Subcontracting;
                                 NLD=Onderaanneming;
                                 NOR=Underentrepenõr;
                                 SVE=Underentreprenad];
                      Image=SubcontractingWorksheet }
      { 126     ;2   ;Action    ;
                      CaptionML=[DEU=&WKA-Daten;
                                 ENU=&WKA Data;
                                 NLD=&WKA gegevens;
                                 NOR=&WKA-data;
                                 SVE=&WKA-data];
                      Promoted=No;
                      Image=SubcontractingWorksheet;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 VendLegEntry@1210190001 : Record 25;
                               BEGIN
                                 VendLegEntry.SETCURRENTKEY("Document No.");
                                 RelatedPurchOrderNoOnAfterVali;
                                 VendLegEntry.SETRANGE("Vendor No.", "Buy-from Vendor No.");
                                 VendLegEntry.SETRANGE("Document No.", "No.");
                                 PAGE.RUNMODAL(PAGE::"WKA Data", VendLegEntry);
                                 CurrPage.UPDATE();
                               END;
                                }
      { 1100528402;2 ;Action    ;
                      CaptionML=[DEU=Stunden Subunternehmung hinzufÅgen;
                                 ENU=Create Subcontracting Hours;
                                 NLD=Onderaanneming uren toevoegen;
                                 NOR=Opprette Underkontraktstimer;
                                 SVE=Skapa underentreprenadstimmar];
                      Image=SubcontractingWorksheet;
                      OnAction=VAR
                                 SubcontractingHoursInvoice@1100528301 : Record 11020694;
                               BEGIN
                                 //**4PS.n
                                 SubcontractingHoursInvoice.RunPageFromPurchInvHeader(Rec);
                               END;
                                }
      { 120     ;1   ;ActionGroup;
                      CaptionML=[DEU=Bu&chung;
                                 ENU=P&osting;
                                 NLD=B&oeken;
                                 NOR=B&okfõring;
                                 SVE=B&okfîring] }
      { 122     ;2   ;Action    ;
                      CaptionML=[DEU=&Testbericht mit öberprÅfungen;
                                 ENU=&Checklist;
                                 NLD=&Controlelijst met checks;
                                 NOR=&Kontrolliste;
                                 SVE=&Kontrollista];
                      RunObject=Report 11012064;
                      Image=CheckList }
      { 1210190004;2 ;Action    ;
                      ShortCutKey=F9;
                      CaptionML=[DEU=Buchen;
                                 ENU=Post;
                                 NLD=Boeken;
                                 NOR=Bokfõr;
                                 SVE=Bokfîr];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Post;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 IF NOT CONFIRM(Text000) THEN
                                   EXIT;

                                 CurrPage.ApprovalLines.PAGE.Post(FALSE,FALSE);  //print=false; batch=false
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1210190005;2 ;Action    ;
                      ShortCutKey=Shift+F9;
                      CaptionML=[DEU=Buchen und drucken;
                                 ENU=Post and Print;
                                 NLD=Boeken en afdrukken;
                                 NOR=Bokfõr og skriv ut;
                                 SVE=Bokfîr och skriv ut];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=PostPrint;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 IF NOT CONFIRM(Text001) THEN
                                   EXIT;

                                 CurrPage.ApprovalLines.PAGE.Post(TRUE,FALSE);  //print=true; batch=false
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 123     ;2   ;Action    ;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=[DEU=&Stapelbuchen;
                                 ENU=Post &Batch;
                                 NLD=B&atch-boeken;
                                 NOR=Bokfõr b&atch-jobb;
                                 SVE=Bokfîr b&atch-jobb];
                      Image=PostBatch;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 CurrPage.ApprovalLines.PAGE.Post(FALSE,TRUE);  //print=false; batch=true
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 124     ;2   ;Action    ;
                      ShortCutKey=Shift+F11;
                      CaptionML=[DEU=Stapelbuchen und drucken;
                                 ENU=Post Batch and Print;
                                 NLD=Batch-boeken en af&drukken;
                                 NOR=Bokfõr Batch og Skriv ut;
                                 SVE=Bokfîr batch och skriv ut];
                      Image=PostBatch;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 CurrPage.ApprovalLines.PAGE.Post(TRUE,TRUE);  //print=true; batch=true
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1100409001;1 ;ActionGroup;
                      CaptionML=[DEU=Belege e-mailen;
                                 ENU=Mail Documents;
                                 NLD=Documenten mailen;
                                 NOR=Send dokumenter;
                                 SVE=E-postdokument];
                      ActionContainerType=NewDocumentItems }
      { 1100409000;2 ;Action    ;
                      CaptionML=[DEU=Einkauf von Kreditor;
                                 ENU=Buy-from Vendor;
                                 NLD=Leverancier;
                                 NOR=Innkjõpsleverandõr;
                                 SVE=Inkîpsleverantîr];
                      Promoted=Yes;
                      Image=MailAttachment;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Contact@1100409002 : Record 5050;
                                 Vendor@1100409001 : Record 23;
                                 DocumentTemplate@1100409000 : Record 11012401;
                               BEGIN
                                 TESTFIELD("Buy-from Vendor No.");
                                 IF Contact.GetContactByVendor("Buy-from Vendor No.", Contact, TRUE) THEN BEGIN
                                   Vendor.GET("Buy-from Vendor No.");
                                   EditDocuments(STRSUBSTNO('%1', DocumentTemplate.Type::Invoice), Contact."No.", '', TRUE, Vendor."E-Mail");
                                 END;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                CaptionML=[DEU=Allgemein;
                           ENU=General;
                           NLD=Algemeen;
                           NOR=Generell;
                           SVE=AllmÑnt] }

    { 2   ;2   ;Field     ;
                SourceExpr="No.";
                Editable=FALSE }

    { 6   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor No.";
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor Name";
                Editable=FALSE }

    { 10  ;2   ;Field     ;
                SourceExpr="Buy-from Address";
                Importance=Additional;
                Editable=FALSE }

    { 17  ;2   ;Field     ;
                SourceExpr="Buy-from Post Code";
                Importance=Additional;
                Editable=FALSE }

    { 12  ;2   ;Field     ;
                SourceExpr="Buy-from City";
                Importance=Additional;
                Editable=FALSE }

    { 13  ;2   ;Field     ;
                SourceExpr="Buy-from Contact";
                Editable=FALSE }

    { 1210190009;2;Field  ;
                SourceExpr="Pre-Assigned No.";
                Editable=FALSE }

    { 21  ;2   ;Field     ;
                SourceExpr="Vendor Invoice No.";
                Editable=FALSE }

    { 1100485009;2;Field  ;
                SourceExpr="Ext. Document ID";
                Visible="Ext. Document IDVisible";
                Editable="Ext. Document IDEditable" }

    { 23  ;2   ;Field     ;
                SourceExpr="Subcontracting Invoice";
                Editable=FALSE }

    { 1100485000;2;Field  ;
                CaptionML=[DEU=WKA-Daten ausgefÅllt;
                           ENU=WKA Data present;
                           NLD=WKA gegevens ingevuld;
                           NOR=WKA-data tilstede;
                           SVE=WKA-data finns];
                SourceExpr=gWKAPresent;
                Editable=FALSE }

    { 1210190002;2;Field  ;
                SourceExpr="Amounts only" }

    { 1100525001;2;Field  ;
                SourceExpr="Open Approval Entry" }

    { 15  ;2   ;Field     ;
                SourceExpr="Posting Date";
                Editable=FALSE }

    { 19  ;2   ;Field     ;
                SourceExpr="Document Date";
                Editable=FALSE }

    { 1100528207;2;Field  ;
                SourceExpr="Approval Code" }

    { 1100528415;2;Field  ;
                CaptionML=[DEU=Genehmigung durch Benutzer;
                           ENU=Approval by User;
                           NLD=Goedkeuring door gebruiker;
                           SVE=GodkÑnnande av anvÑndare];
                SourceExpr=ApprovalManagement4PSConstr.GetNextApprover(RECORDID,0);
                Editable=FALSE }

    { 1100528414;2;Field  ;
                CaptionML=[DEU=Genehmigung durch Benutzername;
                           ENU=Approval by User Name;
                           NLD=Goedkeuring door gebruikersnaam;
                           SVE=GodkÑnnande av anvÑndarnamn];
                SourceExpr=ApprovalManagement4PSConstr.GetNextApproverName(RECORDID,0);
                Editable=FALSE }

    { 33  ;2   ;Field     ;
                SourceExpr="On Hold";
                Editable="On HoldEditable";
                OnValidate=BEGIN
                             OnHoldOnAfterValidate;
                           END;
                            }

    { 31  ;2   ;Field     ;
                SourceExpr="Approvement Initials";
                Editable=FALSE }

    { 35  ;2   ;Field     ;
                SourceExpr="Remain On Hold";
                Editable="Remain On HoldEditable" }

    { 1210190021;2;Field  ;
                SourceExpr="Purchaser Code" }

    { 1210190000;2;Field  ;
                SourceExpr="Job No.";
                OnValidate=BEGIN
                             JobNoOnAfterValidate;
                           END;
                            }

    { 1100485013;2;Field  ;
                SourceExpr="Service Order No.";
                OnValidate=BEGIN
                             ServiceOrderNoOnAfterValidate;
                           END;
                            }

    { 1210190006;2;Field  ;
                SourceExpr="Related Purch. Order No.";
                OnValidate=BEGIN
                             RelatedPurchOrderNoOnAfterVali;
                           END;

                OnLookup=VAR
                           OldRelatedOrderNo@1100525000 : Code[20];
                         BEGIN
                           OldRelatedOrderNo := "Related Purch. Order No.";
                           LookupRelatedOrder;
                           IF ("Related Purch. Order No." <> '') AND ("Related Purch. Order No." <> OldRelatedOrderNo) THEN
                             ValidateRelatedPurchOrder;
                         END;
                          }

    { 1100528407;2;Field  ;
                CaptionML=[DEU=Genehmigungszeilen offener Auftrag;
                           ENU=Open Order Consent Lines;
                           NLD=Open orderfiatteringsregels;
                           SVE=ôppna order godkÑnnanderader];
                SourceExpr=RelatedOrderHasOpenConsentLines;
                Editable=FALSE }

    { 1100528401;2;Field  ;
                SourceExpr="Status (Approval)" }

    { 113 ;1   ;Part      ;
                Name=ApprovalLines;
                SubPageLink=Journal Template Name=FIELD(Journal Template),
                            Document Type=CONST(Purchase Invoice),
                            Document No.=FIELD(No.);
                PagePartID=Page11012067 }

    { 1905885101;1;Group  ;
                CaptionML=[DEU=Fakturierung;
                           ENU=Invoicing;
                           NLD=Facturering;
                           NOR=Fakturering;
                           SVE=Fakturering] }

    { 37  ;2   ;Field     ;
                SourceExpr="Pay-to Vendor No.";
                Importance=Promoted;
                Editable=FALSE }

    { 39  ;2   ;Field     ;
                SourceExpr="Pay-to Name";
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                SourceExpr="Pay-to Address";
                Editable=FALSE }

    { 43  ;2   ;Field     ;
                SourceExpr="Pay-to Address 2";
                Editable=FALSE }

    { 60  ;2   ;Field     ;
                SourceExpr="Pay-to Post Code";
                Editable=FALSE }

    { 45  ;2   ;Field     ;
                SourceExpr="Pay-to City";
                Editable=FALSE }

    { 46  ;2   ;Field     ;
                SourceExpr="Pay-to Contact";
                Editable=FALSE }

    { 66  ;2   ;Field     ;
                SourceExpr="Your Reference";
                Editable=FALSE }

    { 1100525003;2;Field  ;
                SourceExpr="Journal Template";
                OnValidate=BEGIN
                             JournalTemplateOnAfterValidate;
                           END;
                            }

    { 56  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 1 Code";
                Editable=FALSE;
                OnValidate=BEGIN
                             //**4PS Generated Code. Do Not Change.sn03
                             DPA_ChkDepartmentCodeAllowed(DPA_IsHardFilter);
                             //**4PS Generated Code.en03
                           END;
                            }

    { 58  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 2 Code";
                Editable=FALSE }

    { 48  ;2   ;Field     ;
                SourceExpr="Payment Terms Code";
                Importance=Promoted;
                Editable=FALSE }

    { 50  ;2   ;Field     ;
                SourceExpr="Due Date";
                Editable=FALSE }

    { 52  ;2   ;Field     ;
                SourceExpr="Payment Discount %";
                Editable=FALSE }

    { 54  ;2   ;Field     ;
                SourceExpr="Pmt. Discount Date";
                Editable=FALSE }

    { 1100525007;2;Field  ;
                SourceExpr="Reason Code";
                Editable=FALSE }

    { 1906801201;1;Group  ;
                CaptionML=[DEU=Lieferung;
                           ENU=Shipping;
                           NLD=Ontvangst;
                           NOR=Forsendelse;
                           SVE=Leverans] }

    { 70  ;2   ;Field     ;
                SourceExpr="Ship-to Name";
                Editable=FALSE }

    { 72  ;2   ;Field     ;
                SourceExpr="Ship-to Address";
                Editable=FALSE }

    { 74  ;2   ;Field     ;
                SourceExpr="Ship-to Address 2";
                Editable=FALSE }

    { 85  ;2   ;Field     ;
                SourceExpr="Ship-to Post Code";
                Editable=FALSE }

    { 76  ;2   ;Field     ;
                SourceExpr="Ship-to City";
                Editable=FALSE }

    { 77  ;2   ;Field     ;
                SourceExpr="Ship-to Contact";
                Editable=FALSE }

    { 83  ;2   ;Field     ;
                SourceExpr="Location Code";
                Importance=Promoted;
                Editable=FALSE }

    { 79  ;2   ;Field     ;
                SourceExpr="Shipment Method Code";
                Editable=FALSE }

    { 81  ;2   ;Field     ;
                SourceExpr="Expected Receipt Date";
                Editable=FALSE }

    { 1907468901;1;Group  ;
                CaptionML=[DEU=Au·enhandel;
                           ENU=Foreign Trade;
                           NLD=Buitenlandse handel;
                           NOR=Utenrikshandel;
                           SVE=Utlandshandel] }

    { 87  ;2   ;Field     ;
                SourceExpr="Currency Code";
                Importance=Promoted;
                OnAssistEdit=BEGIN
                               ChangeExchangeRate.SetParameter("Currency Code","Currency Factor","Posting Date");
                               ChangeExchangeRate.SetAdditionalParameters(1, "Job No.", FALSE); //**4PS.n
                               ChangeExchangeRate.EDITABLE(FALSE);
                               IF ChangeExchangeRate.RUNMODAL = ACTION::OK THEN BEGIN
                                 "Currency Factor" := ChangeExchangeRate.GetParameter;
                                 MODIFY;
                               END;
                               CLEAR(ChangeExchangeRate);
                             END;
                              }

    { 1905403901;1;Group  ;
                CaptionML=[DEU=Fremdarbeit;
                           ENU=Subcontracting;
                           NLD=Onderaanneming;
                           NOR=Underentrepenõr;
                           SVE=Underentreprenad] }

    { 89  ;2   ;Field     ;
                SourceExpr="Payment Agreement";
                Editable=FALSE }

    { 91  ;2   ;Field     ;
                SourceExpr="Actual Effective Date";
                Editable=FALSE }

    { 93  ;2   ;Field     ;
                SourceExpr="Actual End Date";
                Editable=FALSE }

    { 95  ;2   ;Field     ;
                SourceExpr="Number of Hours";
                Editable=FALSE }

    { 97  ;2   ;Field     ;
                SourceExpr="Avg. Wage Rate";
                Editable=FALSE }

    { 99  ;2   ;Field     ;
                SourceExpr="Labor Amount";
                Editable=FALSE }

    { 101 ;2   ;Field     ;
                SourceExpr="Contribution Percentage Labor";
                Editable=FALSE }

    { 1210190018;2;Field  ;
                SourceExpr="Contribution Percentage Total";
                Editable=FALSE }

    { 1100528200;2;Field  ;
                SourceExpr="Fixed B Amount per Hour";
                Editable=FALSE }

    { 111 ;2   ;Field     ;
                SourceExpr="Pay To Tax Authority";
                Visible=FALSE;
                Editable=FALSE }

    { 103 ;2   ;Field     ;
                SourceExpr="Wage Charge (to B Account)";
                Importance=Standard;
                Editable=FALSE }

    { 105 ;2   ;Field     ;
                SourceExpr="Wage Charge (to Tax Authority)";
                Importance=Standard;
                Visible=FALSE;
                Editable=FALSE }

    { 1100529601;2;Field  ;
                SourceExpr="Pay VAT Amt. on B-Acc. Vendor";
                Editable=FALSE }

    { 1100525013;2;Field  ;
                SourceExpr="Subcontract No." }

    { 109 ;2   ;Field     ;
                SourceExpr=Text;
                Editable=FALSE;
                MultiLine=Yes }

    { 1903447101;1;Group  ;
                CaptionML=[DEU=DMS;
                           ENU=DMS;
                           NLD=DMS;
                           NOR=DMS;
                           SVE=DMS] }

    { 1100525005;2;Field  ;
                SourceExpr="DMS Status";
                Importance=Promoted }

    { 1100525009;2;Field  ;
                SourceExpr="DMS Status Text" }

    { 1210190001;0;Container;
                ContainerType=FactBoxArea }

    { 1100528205;1;Part   ;
                Name=CaptureUI;
                CaptionML=[DEU=DC-Beleg;
                           ENU=DC Document;
                           NLD=DC Document];
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page11126596;
                Visible=FALSE }

    { 1100528701;1;Part   ;
                Name=RegisterExternalDocumentFB;
                PagePartID=Page11125053;
                PartType=Page }

    { 1100525011;1;Part   ;
                SubPageLink=No.=FIELD(Buy-from Vendor No.);
                PagePartID=Page9093;
                Visible=FALSE;
                PartType=Page }

    { 1100525000;1;Part   ;
                SubPageLink=No.=FIELD(Pay-to Vendor No.);
                PagePartID=Page9094;
                Visible=False;
                PartType=Page }

    { 1210190007;1;Part   ;
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page11130312;
                PartType=Page }

    { 1210190003;1;Part   ;
                SubPageLink=Journal Template Name=FIELD(Journal Template Name),
                            Document Type=CONST(Purchase Invoice),
                            Document No.=FIELD(Document No.),
                            Line No.=FIELD(Line No.);
                PagePartID=Page11130117;
                ProviderID=113;
                PartType=Page }

    { 1100528418;1;Part   ;
                SubPageLink=Table ID=CONST(122),
                            Document No.=FIELD(No.);
                PagePartID=Page9103;
                Visible=OpenApprovalEntriesExistForCurrUser;
                PartType=Page }

    { 1100528417;1;Part   ;
                SubPageLink=Table ID=CONST(122),
                            Document No.=FIELD(No.);
                PagePartID=Page9092;
                Visible=FALSE;
                PartType=Page }

    { 1100528416;1;Part   ;
                Name=WorkflowStatus;
                PagePartID=Page1528;
                Visible=ShowWorkflowStatus;
                Enabled=FALSE;
                Editable=FALSE;
                PartType=Page;
                ShowFilter=No }

    { 1100525004;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 1100525010;1;Part   ;
                PartType=System;
                SystemPartID=Notes }

    { 1100528500;1;Part   ;
                SubPageLink=Document No.=FIELD(No.);
                PagePartID=Page9104;
                Visible=FALSE;
                PartType=Page }

    { 1100528100;1;Part   ;
                Name=DocumentViewerDocument;
                CaptionML=[DEU=Document Viewer Belege;
                           ENU=Document Viewer Documents;
                           NLD=Document Viewer documenten];
                PagePartID=Page11129746;
                Visible=FALSE;
                PartType=Page }

    { 1100528101;1;Part   ;
                Name=DocumentViewer;
                CaptionML=[DEU=Document Viewer;
                           ENU=Document Viewer;
                           NLD=Document Viewer];
                SubPageLink=Source Type=FIELD(Source Type),
                            No.=FIELD(No.),
                            Description=FIELD(Description);
                PagePartID=Page11129745;
                ProviderID=1100528100;
                Visible=FALSE;
                PartType=Page }

  }
  CODE
  {
    VAR
      Text000@1100485000 : TextConst 'DEU=Rechnungsgenehmigungen buchen ?;ENU=Post Invoice Approvals ?;NLD=Factuur goedkeuringen boeken ?;NOR=Vil du bokfõre fakturagodkjenninger?;SVE=Vill du bokfîra fakturagodkÑnnanden?';
      Text001@11012006 : TextConst 'DEU=Rechnungsgenehmigungen buchen und drucken?;ENU=Post and Print Invoice Approvals ?;NLD=Factuur goedkeuringen boeken en printen ?;NOR=Vil du Bokfõre og Skrive ut fakturagodkjenninger?;SVE=Vill du bokfîra och skriva ut fakturagodkÑnnanden?';
      PurchSetup@1100485003 : Record 312;
      InvoiceApprovalLine@1100485004 : Record 11012032;
      ChangeExchangeRate@11012001 : Page 511;
      RemainOnHoldEditable@11012004 : Boolean;
      gFromReference@1210190002 : Boolean;
      gApprLineNo@1210190001 : Integer;
      gWKAPresent@1100485001 : Boolean;
      SavePeriodPlantRentEntries@1100485002 : Boolean;
      Text11012001@1100485005 : TextConst 'DEU=Zu verteilender Betrag ist grîsser als die Summe aller Zeilen;ENU=Amount to Distribute is greater than sum of all lines.;NLD=Te verdelen bedrag is groter dan de som van alle regels;NOR=Belõpet som skal distribueres er stõrre enn summen av alle rader.;SVE=Beloppet som ska distribueras Ñr stîrre Ñn summan av alla rader.';
      DPA_IsHardFilter@1100000999 : Boolean;
      ApprJnlTemplate@1100529000 : Code[10];
      "Ext. Document IDVisible"@19068947 : Boolean INDATASET;
      "Remain On HoldEditable"@19040163 : Boolean INDATASET;
      "Ext. Document IDEditable"@19001168 : Boolean INDATASET;
      "On HoldEditable"@1100525001 : Boolean INDATASET;
      OpenApprovalEntriesExist@1100528402 : Boolean;
      OpenApprovalEntriesExistForCurrUser@1100528401 : Boolean;
      ApprovalManagement4PSConstr@1100528400 : Codeunit 11125349;
      ShowWorkflowStatus@1100528403 : Boolean;
      CanCancelApprovalForRecord@1100527300 : Boolean;
      Text002@1100528500 : TextConst 'DEU=AuswÑhlen Datei...;ENU=Select File...;NLD=Selecteer bestand...';

    PROCEDURE SetFilter@1(JournTempl@11012000 : Code[10]);
    BEGIN
    END;

    PROCEDURE InitSelectionFromReference@1210190002(IApprLineNo@1210190000 : Integer);
    BEGIN
      gFromReference := TRUE;
      gApprLineNo := IApprLineNo;
    END;

    PROCEDURE ShowICFInvoiceLines@1210190000();
    VAR
      ICFLineRec@1210190000 : Record 11012327;
    BEGIN
      ICFLineRec.RESET;
      ICFLineRec.SETRANGE(Vendor, "Pay-to Vendor No.");
      ICFLineRec.SETRANGE("Invoice No.", "Pre-Assigned No.");
      ICFLineRec.FINDFIRST;
      PAGE.RUNMODAL(PAGE::"ICF Invoices", ICFLineRec);
    END;

    PROCEDURE DistributeAmountOverLines@1100485002();
    VAR
      TotalLineAmount@1100485001 : Decimal;
    BEGIN
      IF "DMS Status" > "DMS Status"::"Awaiting Line Entry" THEN
        FIELDERROR("DMS Status");

      TESTFIELD("Amounts only",TRUE);
      CALCFIELDS(Amount);

      InvoiceApprovalLine.SETRANGE("Document No.", "No.");
      InvoiceApprovalLine.SETFILTER(Amount, '<>%1', 0);
      IF InvoiceApprovalLine.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          TotalLineAmount := TotalLineAmount + InvoiceApprovalLine.Amount;
        UNTIL InvoiceApprovalLine.NEXT = 0;

        IF TotalLineAmount < Amount THEN
          ERROR(Text11012001);
      END;

      IF TotalLineAmount > 0 THEN
        IF InvoiceApprovalLine.FINDSET(TRUE, FALSE) THEN
          REPEAT
            InvoiceApprovalLine.VALIDATE(InvoiceApprovalLine.Amount,
              Amount * (InvoiceApprovalLine.Amount/TotalLineAmount));
            InvoiceApprovalLine.MODIFY;
          UNTIL InvoiceApprovalLine.NEXT = 0;
    END;

    PROCEDURE DistrPurchLinesOverSubProjects@1100485003(PurchaseInvHeader@1100485000 : Record 122);
    VAR
      InvApprovalLine@1100485004 : Record 11012032;
      MaxLine@1100485002 : Integer;
      Job@1100485003 : Record 11072003;
    BEGIN
      PurchaseInvHeader.TESTFIELD("Amounts only", TRUE);

      IF PurchaseInvHeader."DMS Status" > PurchaseInvHeader."DMS Status"::"Awaiting Line Entry" THEN
        PurchaseInvHeader.FIELDERROR("DMS Status");

      MaxLine := 0;

      InvApprovalLine.SETRANGE("Journal Template Name", PurchaseInvHeader."Journal Template");
      InvApprovalLine.SETRANGE("Document Type", InvApprovalLine."Document Type"::"Purchase Invoice");
      InvApprovalLine.SETRANGE("Document No.", PurchaseInvHeader."No.");
      IF InvApprovalLine.FINDLAST THEN
        MaxLine := InvApprovalLine."Line No.";
      InvApprovalLine.SETRANGE("Receiving Company", '');
      InvApprovalLine.SETFILTER("Project No.", '<>%1', '');
      IF InvApprovalLine.FINDSET(TRUE, FALSE) THEN
        REPEAT
          Job.GET(InvApprovalLine."Project No.");
          IF (Job."Single/Main/Sub Project" = Job."Single/Main/Sub Project"::"Main Project") THEN
            IF GenerateInvApprovalLines(
              PurchaseInvHeader, Job."No.", InvApprovalLine."Shortcut Dimension 2 Code", MaxLine,
              InvApprovalLine.Amount)
            THEN
              InvApprovalLine.DELETE(TRUE);
        UNTIL InvApprovalLine.NEXT = 0;
    END;

    LOCAL PROCEDURE GenerateInvApprovalLines@1100498000(PurchaseInvHeader@1100498000 : Record 122;JobNo@1100485003 : Code[20];ShortCutDimension2@1100485004 : Code[20];VAR PurchaseLineNo@1100485005 : Integer;LineAmount@1100485006 : Decimal) : Boolean;
    VAR
      InvApprovalLine@1100498001 : Record 11012032;
      BudgetLine@1100498002 : Record 11012001;
      Job@1100498003 : Record 11072003;
      TotalAmount@1100485000 : Decimal;
    BEGIN
      TotalAmount := 0;

      Job.RESET;
      Job.SETCURRENTKEY("Main Project");
      Job.SETRANGE("Main Project", JobNo);
      Job.SETRANGE("Single/Main/Sub Project", Job."Single/Main/Sub Project"::"Sub Project");
      Job.SETFILTER("Project Status", '<%1', Job."Project Status"::"Administrative Finished");
      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",ShortCutDimension2);
          BudgetLine.CALCSUMS("Amount (LCY)");
          TotalAmount := TotalAmount + BudgetLine."Amount (LCY)";
        UNTIL Job.NEXT = 0;
      IF TotalAmount = 0 THEN
        EXIT(FALSE);

      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",ShortCutDimension2);
          BudgetLine.CALCSUMS("Amount (LCY)");

          PurchaseLineNo := PurchaseLineNo + 10000;
          InvApprovalLine.INIT;
          InvApprovalLine."Journal Template Name" := PurchaseInvHeader."Journal Template";
          InvApprovalLine.VALIDATE("Document Type", InvApprovalLine."Document Type"::"Purchase Invoice");
          InvApprovalLine.VALIDATE("Document No.",PurchaseInvHeader."No.");
          InvApprovalLine.VALIDATE("Line No." ,PurchaseLineNo);
          InvApprovalLine.Description := Job.Description;
          InvApprovalLine.INSERT(TRUE);
          InvApprovalLine.VALIDATE("Project No.", Job."No.");
          InvApprovalLine.VALIDATE("Shortcut Dimension 2 Code", ShortCutDimension2);
          InvApprovalLine.VALIDATE("Buy-from Vendor No.", PurchaseInvHeader."Buy-from Vendor No.");
          InvApprovalLine.VALIDATE(Amount,LineAmount * (BudgetLine."Amount (LCY)" / TotalAmount));
          InvApprovalLine.MODIFY(TRUE);
        UNTIL Job.NEXT = 0;

      EXIT(TRUE);
    END;

    PROCEDURE ValidateRelatedPurchOrder@1100525000();
    BEGIN
      CurrPage.UPDATE;
      IF GetReceiptsRelatedOrderAutomat(Rec) THEN BEGIN
        GET("No.");
        CurrPage.UPDATE;
      END;
    END;

    PROCEDURE UpdateControls@1100525001();
    BEGIN
      "Remain On HoldEditable" := (RemainOnHoldEditable AND ("On Hold" <> ''));
      CurrPage.EDITABLE(
        ("DMS Status" < "DMS Status"::"Start Workflow") OR
        ("DMS Status" = "DMS Status"::Rejected) OR
        ("DMS Status" = "DMS Status"::Approved));
    END;

    PROCEDURE SetJournalTemplate@1100529000(JnlTemplate@1100529000 : Code[10]);
    BEGIN
      ApprJnlTemplate := JnlTemplate;
    END;

    LOCAL PROCEDURE OnHoldOnAfterValidate@19064521();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE JobNoOnAfterValidate@19070084();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE RelatedPurchOrderNoOnAfterVali@19002847();
    BEGIN
      ValidateRelatedPurchOrder;
    END;

    LOCAL PROCEDURE ServiceOrderNoOnAfterValidate@19042308();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE JournalTemplateOnAfterValidate@19059050();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE SetControlAppearance@5();
    VAR
      ApprovalsMgmt@1000 : Codeunit 1535;
    BEGIN
      OpenApprovalEntriesExist := ApprovalsMgmt.HasOpenApprovalEntries(RECORDID);
      OpenApprovalEntriesExistForCurrUser := ApprovalsMgmt.HasOpenApprovalEntriesForCurrentUser(RECORDID);
      CanCancelApprovalForRecord := ApprovalsMgmt.CanCancelApprovalForRecord(RECORDID);
    END;

    LOCAL PROCEDURE FillDocumentViewerFactbox@1100528100();
    VAR
      DocumentLinkManagement@1100528100 : Codeunit 11012401;
      DocumentProperties@1100528101 : Record 11012746;
      DocumentAttachmentMgt@1100528102 : Codeunit 6085602;
      TempDocument@1100528103 : Record 6085756;
      EmptyRecID@1100528104 : RecordID;
      DocumentViewerTempDoc@1100528105 : Record 11072460;
    BEGIN
      CurrPage.DocumentViewerDocument.PAGE.ResetPage;
      DocumentLinkManagement.GetDocuments(DocumentProperties, RECORDID.GETRECORD);
      DocumentProperties.MARKEDONLY(TRUE);
      CurrPage.DocumentViewerDocument.PAGE.SetExternal4PSDocuments(DocumentProperties);

      CASE PurchSetup."Scanning Application Purch.Inv" OF
        PurchSetup."Scanning Application Purch.Inv"::"Document Capture":
          BEGIN
            DocumentAttachmentMgt.CreateTempDocumentList(TempDocument, EmptyRecID, DATABASE::"Purch. Inv. Header", 0, "No.", 0, TRUE);
            CurrPage.DocumentViewerDocument.PAGE.SetDocumentCaptureDocuments(TempDocument);
            IF "Ext. Document ID" <> '' THEN BEGIN
              CurrPage.DocumentViewerDocument.PAGE.SetSelectedDocument(DocumentViewerTempDoc."Source Type"::DocumentCapture, "Ext. Document ID");
            END ELSE
              CurrPage.DocumentViewerDocument.PAGE.SetSelectedDocument(DocumentViewerTempDoc."Source Type"::DocumentCapture, '');
          END;
        PurchSetup."Scanning Application Purch.Inv"::Whitevision:
          BEGIN
            CurrPage.DocumentViewerDocument.PAGE.SetWhiteVisionDocumentUsingPurchInvHeader(Rec);
            CurrPage.DocumentViewerDocument.PAGE.SetSelectedDocument(DocumentViewerTempDoc."Source Type"::WhiteVision, '');
          END;
      END;

      CurrPage.DocumentViewer.PAGE.SetEmailSubject("No.");
    END;

    BEGIN
    {
      4PS MVOS 20100810: Check permission Journal Template before posting.
    }
    END.
  }
}

