OBJECT Page 11125039 Purchase Quote Line List
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=[DEU=Einkaufsanfragezeilenliste;
               ENU=Purchase Quote Line List;
               NLD=Inkoopofferteregel overzicht;
               NOR=Innkj›pstilbud radliste;
               SVE=Ink”psoffert radlista];
    SourceTable=Table39;
    PageType=List;
    OnInit=BEGIN
             "Balance Excl. VATVisible" := TRUE;
             "Balance Incl. VATVisible" := TRUE;
             "Outstanding QuantityVisible" := TRUE;
             "Unit of MeasureVisible" := TRUE;
             QuantityVisible := TRUE;
             DescriptionVisible := TRUE;
             ShortcutDimension2CodeVisible := TRUE;
             "Cost TypeVisible" := TRUE;
             "Vendor (Trade Item)Visible" := TRUE;
             ManufacturerVisible := TRUE;
             "Trade ItemVisible" := TRUE;
             "Basic ItemVisible" := TRUE;
           END;

    OnOpenPage=VAR
                 FPSLicenseManagement@1100527400 : Codeunit 11229289;
               BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**4PS Generated Code.en01

                 IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(ItemSetup) THEN BEGIN
                   "Basic ItemVisible" := (FALSE);
                   "Trade ItemVisible" := (FALSE);
                   ManufacturerVisible := (FALSE);
                   "Vendor (Trade Item)Visible" := (FALSE);
                 END;
               END;

    OnAfterGetRecord=BEGIN
                       CalculateBalances;
                       PurchaseLineExtension.GetPurchLineExtension("Document Type", "Document No.", "Line No.");
                     END;

    OnNewRecord=BEGIN
                  //**4PS Generated Code. Do Not Change.sn02
                  DPA_SetDefaultDepartment;
                  //**4PS Generated Code.en02
                END;

  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                GroupType=Repeater }

    { 2   ;2   ;Field     ;
                SourceExpr="Document No." }

    { 4   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor No." }

    { 6   ;2   ;Field     ;
                Name=Name;
                CaptionML=[DEU=Name;
                           ENU=Name;
                           NLD=Naam;
                           NOR=Navn;
                           SVE=Namn];
                SourceExpr="Vendor Name" }

    { 1210190000;2;Field  ;
                SourceExpr="Service Order No.";
                Visible=FALSE }

    { 1210190002;2;Field  ;
                SourceExpr="Service Location No.";
                Visible=FALSE }

    { 1210190008;2;Field  ;
                SourceExpr="Service Contract No.";
                Visible=FALSE }

    { 1210190010;2;Field  ;
                SourceExpr="Job No.";
                Visible=FALSE }

    { 1100526104;2;Field  ;
                CaptionML=[DEU=Speicherznr.;
                           ENU=Yard No.;
                           NLD=Werfnr.;
                           NOR=Plassnr;
                           SVE=Platsnr];
                SourceExpr=PurchaseLineExtension."Yard No.";
                Visible=FALSE;
                Editable=FALSE }

    { 1100526102;2;Field  ;
                CaptionML=[DEU=Systemnr.;
                           ENU=System No.;
                           NLD=Systeemnr.;
                           NOR=Systemnr;
                           SVE=Systemnr];
                SourceExpr=PurchaseLineExtension."System No.";
                Visible=FALSE;
                Editable=FALSE }

    { 1100526100;2;Field  ;
                CaptionML=[DEU=Entit„tstyp;
                           ENU=Entity Type;
                           NLD=Entiteit type;
                           NOR=Enhetstype;
                           SVE=Enhetstyp];
                SourceExpr="Entity Type";
                Visible=FALSE;
                Editable=FALSE }

    { 1100526106;2;Field  ;
                CaptionML=[DEU=Einheitsnr.;
                           ENU=Entity No.;
                           NLD=Entiteitnr.;
                           NOR=Enhetsnr;
                           SVE=Enhetsnr];
                SourceExpr=PurchaseLineExtension."Entity No.";
                Visible=FALSE;
                Editable=FALSE }

    { 1100485006;2;Field  ;
                SourceExpr="Plot No.";
                Visible=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr=Element;
                Visible=FALSE }

    { 10  ;2   ;Field     ;
                SourceExpr="Extension Contract";
                Visible=FALSE }

    { 12  ;2   ;Field     ;
                SourceExpr="Cost Type";
                Visible="Cost TypeVisible" }

    { 1100485010;2;Field  ;
                SourceExpr="Item No." }

    { 1210190030;2;Field  ;
                SourceExpr="Item Category Code";
                Visible=FALSE }

    { 1210190024;2;Field  ;
                SourceExpr="Variant Code";
                Visible=FALSE }

    { 1100485012;2;Field  ;
                SourceExpr=Manufacturer;
                Visible=ManufacturerVisible }

    { 1100485014;2;Field  ;
                SourceExpr="Basic Item";
                Visible="Basic ItemVisible" }

    { 1100485016;2;Field  ;
                SourceExpr="Vendor (Trade Item)";
                Visible="Vendor (Trade Item)Visible" }

    { 1100485018;2;Field  ;
                SourceExpr="Trade Item";
                Visible="Trade ItemVisible" }

    { 1210190018;2;Field  ;
                SourceExpr=Type;
                Visible=FALSE }

    { 1210190020;2;Field  ;
                SourceExpr="No.";
                Visible=FALSE }

    { 1210190016;2;Field  ;
                SourceExpr="Shortcut Dimension 1 Code";
                Visible=FALSE;
                OnValidate=BEGIN
                             //**4PS Generated Code. Do Not Change.sn03
                             DPA_ChkDepartmentCodeAllowed(DPA_IsHardFilter);
                             //**4PS Generated Code.en03
                           END;
                            }

    { 14  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 2 Code";
                Visible=ShortcutDimension2CodeVisible }

    { 16  ;2   ;Field     ;
                SourceExpr=Description;
                Visible=DescriptionVisible }

    { 1100525000;2;Field  ;
                SourceExpr="Description 2" }

    { 18  ;2   ;Field     ;
                SourceExpr=Quantity;
                Visible=QuantityVisible }

    { 20  ;2   ;Field     ;
                SourceExpr="Unit of Measure";
                Visible="Unit of MeasureVisible" }

    { 1210190022;2;Field  ;
                SourceExpr="Currency Code";
                Visible=FALSE }

    { 1210190012;2;Field  ;
                SourceExpr="Line Amount";
                Visible="Line AmountVisible" }

    { 1210190014;2;Field  ;
                SourceExpr="Amount (LCY)";
                Visible="Amount (LCY)Visible" }

    { 22  ;2   ;Field     ;
                SourceExpr="Outstanding Quantity";
                Visible="Outstanding QuantityVisible" }

    { 1210190026;2;Field  ;
                SourceExpr="Outst. Amount exc. VAT (LCY)";
                Visible=FALSE }

    { 1100525002;2;Field  ;
                SourceExpr="Outstanding Amount";
                Visible=FALSE }

    { 1210190032;2;Field  ;
                SourceExpr="Order Date";
                Visible=FALSE }

    { 28  ;2   ;Field     ;
                SourceExpr="Expected Receipt Date";
                Visible="Expected Receipt DateVisible" }

    { 30  ;2   ;Field     ;
                SourceExpr="Purchase Action";
                Visible="Purchase ActionVisible" }

    { 32  ;2   ;Field     ;
                SourceExpr="Purchase Phase";
                Visible="Purchase PhaseVisible" }

    { 1100485002;2;Field  ;
                SourceExpr="Balance Excl. VAT";
                Visible="Balance Excl. VATVisible";
                OnDrillDown=BEGIN
                              DrilldownBalances();
                            END;
                             }

    { 1100485000;2;Field  ;
                SourceExpr="Balance Incl. VAT";
                Visible="Balance Incl. VATVisible";
                OnDrillDown=BEGIN
                              DrilldownBalances();
                            END;
                             }

    { 34  ;2   ;Field     ;
                SourceExpr="Location Code";
                Visible="Location CodeVisible" }

  }
  CODE
  {
    VAR
      PurchaseLineExtension@1100526100 : Record 11020644;
      ItemSetup@1100525000 : Record 11012300;
      CopyMgt@1100485003 : Codeunit 11012068;
      g_table@1100485004 : Integer;
      gProj@1100485002 : Code[20];
      gServOrder@1100485001 : Code[20];
      gServContr@1100485000 : Code[20];
      g_code1@1100485005 : Code[20];
      g_code2@1100485006 : Code[20];
      g_code3@1100485007 : Code[20];
      g_code4@1100485008 : Code[20];
      DPA_IsHardFilter@1100000999 : Boolean;
      "Basic ItemVisible"@19042756 : Boolean INDATASET;
      "Trade ItemVisible"@19042429 : Boolean INDATASET;
      ManufacturerVisible@19015155 : Boolean INDATASET;
      "Vendor (Trade Item)Visible"@19043796 : Boolean INDATASET;
      "Cost TypeVisible"@19074774 : Boolean INDATASET;
      ShortcutDimension2CodeVisible@19058851 : Boolean INDATASET;
      DescriptionVisible@19064706 : Boolean INDATASET;
      QuantityVisible@19058433 : Boolean INDATASET;
      "Unit of MeasureVisible"@19022597 : Boolean INDATASET;
      "Outstanding QuantityVisible"@19048235 : Boolean INDATASET;
      "Expected Receipt DateVisible"@19074269 : Boolean INDATASET;
      "Purchase ActionVisible"@19039042 : Boolean INDATASET;
      "Purchase PhaseVisible"@19057610 : Boolean INDATASET;
      "Location CodeVisible"@19020483 : Boolean INDATASET;
      "Line AmountVisible"@19001985 : Boolean INDATASET;
      "Amount (LCY)Visible"@19065844 : Boolean INDATASET;
      "Balance Incl. VATVisible"@19073331 : Boolean INDATASET;
      "Balance Excl. VATVisible"@19070590 : Boolean INDATASET;

    PROCEDURE "Vendor Name"@1() : Text[30];
    VAR
      VendorRec@11012000 : Record 23;
    BEGIN
      IF VendorRec.GET("Buy-from Vendor No.") THEN
        EXIT(VendorRec.Name)
      ELSE
        EXIT('');
    END;

    PROCEDURE ShowPurchaseOrder@1210190001();
    VAR
      PurchOrder@1210190000 : Record 38;
    BEGIN
      PurchOrder.SETRANGE("Document Type","Document Type");
      PurchOrder.SETRANGE("No.","Document No.");
      IF PurchOrder.FINDFIRST THEN
        PurchOrder.SETRECFILTER;
      IF "Document Type" = "Document Type"::Quote THEN
        PAGE.RUNMODAL(PAGE::"Purchase Quote", PurchOrder);
      IF "Document Type" = "Document Type"::Order THEN
        PAGE.RUNMODAL(PAGE::"Purchase Order", PurchOrder);
      IF "Document Type" = "Document Type"::"Blanket Order" THEN
        PAGE.RUNMODAL(PAGE::"Blanket Purchase Order", PurchOrder);
      IF "Document Type" = "Document Type"::Invoice THEN
        PAGE.RUNMODAL(PAGE::"Purchase Invoice", PurchOrder);
      IF "Document Type" = "Document Type"::"Credit Memo" THEN
        PAGE.RUNMODAL(PAGE::"Purchase Credit Memo", PurchOrder);
    END;

    PROCEDURE CheckCompress@1210190000(lvProj@1210190001 : Code[20];lvServOrder@1210190003 : Code[20];lvServContr@1210190004 : Code[20];lvMark@1210190000 : Boolean;g_table@1100485001 : Integer;OnlyNotCreatedAsCostPlusEntry@1210190002 : Boolean);
    VAR
      lvTmpPurchOrderRec@1100485000 : TEMPORARY Record 38;
    BEGIN
      gProj := lvProj;
      gServOrder := lvServOrder;
      gServContr := lvServContr;

      CLEARMARKS;
      IF lvMark THEN BEGIN
        lvTmpPurchOrderRec.DELETEALL;
        IF lvProj <> '' THEN
          SETRANGE("Job No.", lvProj);
        IF lvServContr <> '' THEN
          SETRANGE("Service Contract No.", lvServContr);
        IF lvServOrder <> '' THEN
          SETRANGE("Service Order No.", lvServOrder);
        IF FINDSET THEN BEGIN
          REPEAT
            IF NOT lvTmpPurchOrderRec.GET("Document Type", "Document No.") THEN BEGIN
              lvTmpPurchOrderRec."Document Type" := "Document Type";
              lvTmpPurchOrderRec."No." := "Document No.";
              lvTmpPurchOrderRec.INSERT;
              MARK := TRUE;
            END;
          UNTIL NEXT = 0;
          Rec := xRec;
        END;
      END;
      MARKEDONLY(lvMark);

      IF g_table <> 0 THEN BEGIN
        SETRANGE("Outstanding-Rcd/Not Invoiced", TRUE);
        SETRANGE("Removal Contribution", FALSE);
        IF OnlyNotCreatedAsCostPlusEntry THEN
          SETRANGE("Cost Plus Entry Created", FALSE)
        ELSE
          SETRANGE("Cost Plus Entry Created");
      END;

      "Cost TypeVisible" := (NOT lvMark);
      ShortcutDimension2CodeVisible := (NOT lvMark);
      DescriptionVisible := (NOT lvMark);
      QuantityVisible := (NOT lvMark);
      "Unit of MeasureVisible" := (NOT lvMark);
      "Outstanding QuantityVisible" := (NOT lvMark);
      "Expected Receipt DateVisible" := (NOT lvMark);
      "Purchase ActionVisible" := (NOT lvMark);
      "Purchase PhaseVisible" := (NOT lvMark);
      "Location CodeVisible" := (NOT lvMark);
      "Line AmountVisible" := (NOT lvMark);
      "Amount (LCY)Visible" := (NOT lvMark);
      "Balance Incl. VATVisible" := (lvMark);
      "Balance Excl. VATVisible" := (lvMark);
    END;

    PROCEDURE CopyLines@1210190004();
    BEGIN
      CopyMgt.SetSelectionObligation(g_table, g_code1, g_code2, g_code3, g_code4);
      CopyMgt.CopyPurchObligations(Rec);
      CurrPage.CLOSE;
    END;

    PROCEDURE SetSelection@1100485000(l_table@1100485003 : Integer;l_code1@1100485004 : Code[20];l_code2@1100485000 : Code[20];l_code3@1100485001 : Code[20];l_code4@1100485002 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
    END;

    PROCEDURE CalculateBalances@1100485090();
    VAR
      lvPurchLineRec@1100485000 : Record 39;
      lvProj@1100485003 : Code[20];
      lvServOrder@1100485002 : Code[20];
      lvServContr@1100485001 : Code[20];
    BEGIN
      lvProj := gProj;
      lvServOrder := gServOrder;
      lvServContr := gServContr;

      lvPurchLineRec.SETRANGE("Document Type", "Document Type");
      lvPurchLineRec.SETRANGE("Document No.", "Document No.");
      IF (lvProj <> '') THEN BEGIN
        lvPurchLineRec.SETFILTER("Job No.", '<>%1', lvProj);
        IF NOT lvPurchLineRec.FINDFIRST THEN
          lvProj := '';
        lvPurchLineRec.SETRANGE("Job No.");  //* Reset filter
      END;
      IF (lvServOrder <> '') THEN BEGIN
        lvPurchLineRec.SETFILTER("Service Order No.", '<>%1', lvServOrder);
        IF NOT lvPurchLineRec.FINDFIRST THEN
          lvServOrder := '';
        lvPurchLineRec.SETRANGE("Service Order No.");  //* Reset filter
      END;
      IF (lvServContr <> '') THEN BEGIN
        lvPurchLineRec.SETFILTER("Service Contract No.", lvServContr);
        IF NOT lvPurchLineRec.FINDFIRST THEN
          lvServContr := '';
        lvPurchLineRec.SETRANGE("Service Contract No.");  //* Reset filter
      END;

      IF (lvProj = '') AND (lvServOrder = '') AND (lvServContr = '') THEN
        CALCFIELDS("Balance Incl. VAT", "Balance Excl. VAT")
      ELSE BEGIN
        "Balance Incl. VAT" := 0;
        "Balance Excl. VAT" := 0;
        lvPurchLineRec.RESET;
        lvPurchLineRec.SETRANGE("Document Type", "Document Type");
        lvPurchLineRec.SETRANGE("Document No.", "Document No.");
        IF lvProj <> '' THEN
          lvPurchLineRec.SETRANGE("Job No.", lvProj);
        IF lvServContr <> '' THEN
          lvPurchLineRec.SETRANGE("Service Contract No.", lvServContr);
        IF lvServOrder <> '' THEN
          lvPurchLineRec.SETRANGE("Service Order No.", lvServOrder);
        IF lvPurchLineRec.FINDSET THEN BEGIN
          REPEAT
            "Balance Incl. VAT" := "Balance Incl. VAT" + lvPurchLineRec."Amount Including VAT";
            "Balance Excl. VAT" := "Balance Excl. VAT" + lvPurchLineRec.Amount;
          UNTIL lvPurchLineRec.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE DrilldownBalances@1100485001();
    VAR
      lvPurchLineRec@1100485000 : Record 39;
    BEGIN
      lvPurchLineRec.SETRANGE("Document Type", "Document Type");
      lvPurchLineRec.SETRANGE("Document No.", "Document No.");
      IF gProj <> '' THEN
        lvPurchLineRec.SETRANGE("Job No.", gProj);
      IF gServContr <> '' THEN
        lvPurchLineRec.SETRANGE("Service Contract No.", gServContr);
      IF gServOrder <> '' THEN
        lvPurchLineRec.SETRANGE("Service Order No.", gServOrder);
      PAGE.RUNMODAL(0, lvPurchLineRec);
    END;

    PROCEDURE EditLineDetails@1210190008();
    VAR
      PurchaseLineDetail@1210190000 : Record 11020660;
    BEGIN
      //**4PS  //kzwerver, 110606, n, #27784
      PurchaseLineDetail.ShowCard(PurchaseLineDetail."Line Type"::"Purchase Order",
        PurchaseLineDetail."Record Type"::Project, "Job No.", PurchaseLineExtension."Yard No.",
        PurchaseLineExtension."System No.", "Entity Type", PurchaseLineExtension."Entity No.", '', "Document No.", "Line No.",
        TRUE);
    END;

    BEGIN
    END.
  }
}

