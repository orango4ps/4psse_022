OBJECT Page 6085600 Document List With Image
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=DCW17.00.00.5.00.07;
  }
  PROPERTIES
  {
    CaptionML=[DEU=Belegjournal;
               ENU=Document Journal;
               NLD=Documentdagboek];
    InsertAllowed=No;
    SourceTable=Table6085590;
    PageType=Worksheet;
    PromotedActionCategoriesML=[DEU=0, Prozess, 2, Beleg, Vorlage, Kreditor, Debitor;
                                ENU=0,Process,2,Document,Template,Vendor,Customer;
                                NLD=0,Verwerken,2,Document,Sjabloon,Leverancier,Klant];
    OnOpenPage=VAR
                 DocStatusCodes@1160040004 : Record 6085779;
                 ContiniaCompanySetup@1160040006 : Record 6192773;
                 UpgradeMgt@1160040000 : Codeunit 6085606;
                 CODC@1160040001 : Codeunit 6085617;
                 DocumentCaptureMgt@6085574 : Codeunit 6085603;
               BEGIN
                 UpgradeMgt.CheckDataVersion;

                 CODC.IsCompanyActive(FALSE);

                 FILTERGROUP := 2;
                 IF GETFILTER("Document Category Code") <> '' THEN
                   CurrentDocCategory := GETRANGEMAX("Document Category Code");

                 IF GETFILTER(Status) <> '' THEN
                   StatusFilter := GETRANGEMAX(Status);
                 FILTERGROUP := 0;

                 SetSourceNoNameVisibility;

                 IsUsingPurchOrders := PurchDocMgt.GetIsUsingPurchOrders;

                 UpdateList;

                 ShowStatusCode := NOT DocStatusCodes.ISEMPTY;
                 ShowMoveToCompany := DocumentCaptureMgt.DiffCompaniesWithDC;
                 ShowNavigate := Status <> Status::Open;
                 ShowEventNotifier := NOT WebClientMgt.IsWebClient;

                 Channel := CREATEGUID;
                 IF WebClientMgt.IsWebClient THEN
                   MessageBusSocket := MessageBusSocket.MessageBusSocket(Channel)
                 ELSE
                   EventNotifierSource.ADDTEXT(Channel);

                 CurrPage.CaptureUI.PAGE.SetConfig(CurrPage.Header.PAGE.CAPTION,'',Channel);
               END;

    OnClosePage=BEGIN
                  TempFileStorage.Clear;
                END;

    OnAfterGetRecord=VAR
                       EmptyGuid@6085573 : GUID;
                     BEGIN
                       UpdateSearchTexts;
                       HasOrderCrMemo := (PurchDocMgt.GetNoOfPurchOrders(Rec) <> 0) OR (PurchDocMgt.GetNoOfPurchReturnOrders(Rec) <> 0);
                       ShowIncomingEmail := "E-Mail GUID" <> EmptyGuid;
                       StatusIsOpen := Status = Status::Open;
                       StatusIsRegistered := Status = Status::Registered;
                       StatusIsRejected := Status = Status::Rejected;
                     END;

    OnAfterGetCurrRecord=BEGIN
                           UpdateSearchTexts;
                           ShowVendorCard := HasSourceID AND (GetSourceTableNo = DATABASE::Vendor);
                         END;

    ActionList=ACTIONS
    {
      { 1000000028;  ;ActionContainer;
                      Name=ActionItems;
                      CaptionML=;
                      ActionContainerType=ActionItems }
      { 1000000026;1 ;ActionGroup;
                      Name=Functions;
                      CaptionML=[DEU=F&unktion;
                                 ENU=F&unctions;
                                 NLD=F&uncties] }
      { 6085576 ;2   ;Action    ;
                      Name=Document Card;
                      ShortCutKey=Shift+Ctrl+E;
                      CaptionML=[DEU=&Belegkarte;
                                 ENU=&Document Card;
                                 NLD=&Documentkaart];
                      RunObject=Page 6085594;
                      RunPageView=SORTING(No.);
                      RunPageLink=No.=FIELD(No.);
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=EditLines;
                      PromotedCategory=Category4 }
      { 161024022;2  ;Action    ;
                      Name=Recognize Fields;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=[DEU=&Felder erkennen;
                                 ENU=&Recognize Fields;
                                 NLD=Herken &velden];
                      Promoted=Yes;
                      Enabled=HasDocuments AND StatusIsOpen;
                      PromotedIsBig=Yes;
                      Image=SuggestVendorBills;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Documents@161024013 : Record 6085590;
                                 Document@161024014 : Record 6085590;
                                 CaptureEngine@1000000000 : Codeunit 6085575;
                                 SourceNo@1000000002 : Code[200];
                               BEGIN
                                 CurrPage.SETSELECTIONFILTER(Documents);
                                 IF Documents.COUNT > 1 THEN BEGIN
                                   IF NOT CONFIRM(Text001,TRUE,Documents.COUNT) THEN
                                     ERROR('');

                                   IF Documents.FINDSET THEN
                                     REPEAT
                                       Document := Documents;
                                       CaptureEngine.CaptureDocument(Document);
                                       COMMIT;
                                     UNTIL Documents.NEXT = 0;
                                 END ELSE BEGIN
                                   SourceNo := GetSourceID;
                                   CaptureEngine.CaptureDocument(Rec);

                                   IF (GetSourceID = '') THEN
                                     EXIT;

                                   IF (GetSourceID = SourceNo) AND ("Template No." = '') THEN BEGIN
                                     COMMIT;
                                     VALIDATE("Template No.",GetDefaultTemplate(TRUE));
                                     MODIFY(TRUE);
                                     CaptureEngine.CaptureDocument(Rec);
                                   END;
                                 END;

                                 CurrPage.Header.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Header page
                                 CurrPage.Comments.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Comments page
                                 CurrPage.UPDATE(FALSE); // This will restore the dropped relationship

                                 EnableFields;

                                 CurrPage.CaptureUI.PAGE.RedrawValues;
                                 CurrPage.CaptureUI.PAGE.SetSendAllPendingCommands(TRUE);

                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 161024016;2  ;Action    ;
                      Name=Match Lines;
                      ShortCutKey=Ctrl+M;
                      CaptionML=[DEU=&Zeilen abgleichen;
                                 ENU=&Match Lines;
                                 NLD=&Match regels];
                      Promoted=Yes;
                      Visible=ShowMatchLines;
                      Enabled=HasTemplate AND HasDocuments AND StatusIsOpen;
                      PromotedIsBig=Yes;
                      Image=Splitlines;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Template@1000000001 : Record 6085579;
                               BEGIN
                                 TestSourceNoAndTemplNo;

                                 TestStatus;

                                 Template.GET("Template No.");
                                 Template.TESTFIELD("Codeunit ID: Show Match");
                                 CODEUNIT.RUN(Template."Codeunit ID: Show Match",Rec);
                                 FIND('=');
                                 ValidateDocument;
                               END;
                                }
      { 161024018;2  ;Action    ;
                      Name=Validate;
                      ShortCutKey=F7;
                      CaptionML=[DEU=&Validieren;
                                 ENU=&Validate;
                                 NLD=&Valideer];
                      Enabled=HasDocuments AND StatusIsOpen;
                      Image=CheckRulesSyntax;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 ValidateDocument;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 6085591 ;2   ;Action    ;
                      Name=Navigate;
                      CaptionML=[DEU=&Navigate;
                                 ENU=&Navigate;
                                 NLD=&Navigeren];
                      Promoted=Yes;
                      Visible=ShowNavigate;
                      Enabled=HasDocuments;
                      PromotedIsBig=Yes;
                      Image=MakeOrder;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 ShowRegisteredDoc;
                               END;
                                }
      { 161024017;2  ;Action    ;
                      Name=Create/Select Template;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Vorlage Er&stellen/auswÑhlen;
                                 ENU=Crea&te/Select Template;
                                 NLD=Maak/Selecteer sjabloon];
                      Enabled=HasDocuments AND StatusIsOpen;
                      Image=ApplyTemplate;
                      OnAction=VAR
                                 Template@161024014 : Record 6085579;
                                 CaptureEngine@161024013 : Codeunit 6085575;
                                 NewTemplateNo@161024012 : Code[20];
                               BEGIN
                                 TestStatus;

                                 NewTemplateNo := Template.CreateNew("Document Category Code","Source Record ID Tree ID",FALSE);
                                 IF (NewTemplateNo <> '') THEN BEGIN
                                   VALIDATE("Template No.",NewTemplateNo);
                                   MODIFY(TRUE);

                                   CaptureEngine.CaptureDocument(Rec);
                                   EnableFields;

                                   CurrPage.Header.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Header page
                                   CurrPage.Comments.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Comments page
                                   CurrPage.UPDATE(FALSE); // This will restore the dropped relationship

                                   EnableFields;

                                   CurrPage.CaptureUI.PAGE.RedrawValues;
                                   CurrPage.CaptureUI.PAGE.SetSendAllPendingCommands(TRUE);
                                 END;
                               END;
                                }
      { 6085582 ;2   ;Action    ;
                      Name=Move to Company;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Zu &Unternehmen verschieben;
                                 ENU=Move to &Company;
                                 NLD=Verplaats naar bedrijf];
                      Promoted=Yes;
                      Visible=ShowMoveToCompany;
                      Enabled=HasDocuments AND StatusIsOpen;
                      Image=Export;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Documents@161024012 : Record 6085590;
                               BEGIN
                                 CurrPage.SETSELECTIONFILTER(Documents);
                                 CODEUNIT.RUN(CODEUNIT::"Doc. - Move to Company",Documents);
                               END;
                                }
      { 6085593 ;2   ;Action    ;
                      Name=Split and Merge;
                      CaptionML=[DEU=Trennen und ZusammenfÅhren;
                                 ENU=Split and Merge;
                                 NLD=Splitsen en Samenvoegen];
                      Promoted=Yes;
                      Enabled=HasDocuments AND StatusIsOpen;
                      Image=Documents;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 SplitAndMerge@1160040001 : Page 6085607;
                               BEGIN
                                 SplitAndMerge.SetParam(CurrentDocCategory,Rec);
                                 IF WebClientMgt.IsWebClient THEN
                                   SplitAndMerge.RUN
                                 ELSE BEGIN
                                   SplitAndMerge.RUNMODAL;
                                   CurrPage.UPDATE(FALSE);
                                   IF FIND('=') THEN
                                     CurrPage.CaptureUI.PAGE.UpdatePage;
                                 END;
                               END;
                                }
      { 6085577 ;2   ;Action    ;
                      Name=Template Card;
                      ShortCutKey=Ctrl+S;
                      CaptionML=[DEU=&Vorlagenkarte;
                                 ENU=&Template Card;
                                 NLD=&Sjabloonkaart];
                      RunObject=Page 6085584;
                      RunPageView=SORTING(No.);
                      RunPageLink=No.=FIELD(Template No.),
                                  Category Code=FIELD(Document Category Code);
                      Promoted=Yes;
                      Enabled=HasTemplate AND HasDocuments;
                      PromotedIsBig=Yes;
                      Image=Edit;
                      PromotedCategory=Category5 }
      { 6085581 ;2   ;Action    ;
                      Name=Add Template Field;
                      CaptionML=[DEU=&Vorlagenfeld hinzufÅgen;
                                 ENU=&Add Template Field;
                                 NLD=Sjabloonveld &toevoegen];
                      Promoted=Yes;
                      Enabled=HasTemplate AND HasDocuments AND StatusIsOpen;
                      Image=Post;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 Template@161024012 : Record 6085579;
                               BEGIN
                                 IF Template.GET("Template No.") THEN
                                   IF Template.ManuallyAddTemplField THEN BEGIN
                                     CurrPage.Header.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Header page
                                     CurrPage.Comments.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Comments page
                                     CurrPage.UPDATE(FALSE); // This will restore the dropped relationship

                                     EnableFields;

                                     CurrPage.CaptureUI.PAGE.RedrawValues;
                                     CurrPage.CaptureUI.PAGE.SetSendAllPendingCommands(TRUE);

                                     CurrPage.UPDATE(FALSE);
                                   END;
                               END;
                                }
      { 1160040000;2 ;Action    ;
                      Name=Remove Template Field;
                      CaptionML=[DEU=Lîsche Vorlagenfeld;
                                 ENU=&Remove Template Field;
                                 NLD=Verwijder sjabloonveld];
                      Promoted=Yes;
                      Enabled=HasTemplate AND HasDocuments AND StatusIsOpen;
                      Image=Delete;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 Template@1160040000 : Record 6085579;
                               BEGIN
                                 IF Template.GET("Template No.") THEN
                                   IF Template.ManuallyRemoveTemplField THEN BEGIN
                                     CurrPage.Header.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Header page
                                     CurrPage.Comments.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Comments page
                                     CurrPage.UPDATE(FALSE); // This will restore the dropped relationship

                                     EnableFields;

                                     CurrPage.CaptureUI.PAGE.RedrawValues;
                                     CurrPage.CaptureUI.PAGE.SetSendAllPendingCommands(TRUE);

                                     CurrPage.UPDATE(FALSE);
                                   END;
                               END;
                                }
      { 6085575 ;2   ;Action    ;
                      Name=Translations;
                      ShortCutKey=Ctrl+T;
                      CaptionML=[DEU=&öbersetzungen;
                                 ENU=&Translations;
                                 NLD=Vertalingen];
                      Promoted=Yes;
                      Enabled=HasTemplate AND HasDocuments AND StatusIsOpen;
                      Image=Track;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 Template@1000000001 : Record 6085579;
                               BEGIN
                                 Template.GET("Template No.");
                                 Template.TESTFIELD("Codeunit ID: Transl. (Doc)");
                                 CODEUNIT.RUN(Template."Codeunit ID: Transl. (Doc)",Rec);
                               END;
                                }
      { 6085590 ;1   ;ActionGroup;
                      Name=Vendor;
                      CaptionML=[DEU=Kreditor;
                                 ENU=Vendor;
                                 NLD=Leverancier] }
      { 6085589 ;2   ;Action    ;
                      Name=Vendor Card;
                      CaptionML=[DEU=Kreditorenkarte;
                                 ENU=Vendor Card;
                                 NLD=Leverancier];
                      Promoted=Yes;
                      Visible=IsVendor AND ShowVendorCard;
                      Enabled=HasDocuments;
                      PromotedIsBig=Yes;
                      Image=Vendor;
                      PromotedCategory=Category6;
                      OnAction=VAR
                                 Vendor@1160040000 : Record 23;
                               BEGIN
                                 Vendor.GET(GetSourceID);
                                 PAGE.RUN(PAGE::"Vendor Card",Vendor);
                               END;
                                }
      { 6085587 ;2   ;Action    ;
                      Name=Create Vendor;
                      CaptionML=[DEU=&PDF-Datei anzeigen;
                                 ENU=Create Vendor;
                                 NLD=Maak leverancier];
                      Promoted=Yes;
                      Visible=IsVendor AND NOT ShowVendorCard;
                      Enabled=HasDocuments;
                      PromotedIsBig=Yes;
                      Image=Vendor;
                      PromotedCategory=Category6;
                      OnAction=VAR
                                 Vendor@1160040000 : Record 23;
                               BEGIN
                                 SetAndCreateNewVendor;
                               END;
                                }
      { 6085588 ;2   ;Action    ;
                      Name=Unposted Documents;
                      CaptionML=[DEU=&Nicht gebuchte Belege;
                                 ENU=&Unposted Documents;
                                 NLD=&Niet Geboekte Documenten];
                      Promoted=Yes;
                      Visible=IsVendor;
                      Enabled=HasSourceID AND HasDocuments;
                      Image=Invoice;
                      PromotedCategory=Category6;
                      OnAction=VAR
                                 PurchHeader@1160040000 : Record 38;
                               BEGIN
                                 PurchHeader.SETRANGE("Pay-to Vendor No.",GetSourceID);
                                 PAGE.RUN(PAGE::"DC Purchase Documents",PurchHeader);
                               END;
                                }
      { 6085586 ;2   ;Action    ;
                      Name=Ledger Entries;
                      CaptionML=[DEU=&Posten;
                                 ENU=Ledger E&ntries;
                                 NLD=Poste&n];
                      Promoted=Yes;
                      Visible=IsVendor;
                      Enabled=HasSourceID AND HasDocuments;
                      Image=VendorLedger;
                      PromotedCategory=Category6;
                      OnAction=VAR
                                 VendLedgEntry@1160040000 : Record 25;
                               BEGIN
                                 VendLedgEntry.SETCURRENTKEY("Vendor No.");
                                 VendLedgEntry.SETRANGE("Vendor No.",GetSourceID);
                                 PAGE.RUN(PAGE::"Vendor Ledger Entries",VendLedgEntry);
                               END;
                                }
      { 6085585 ;1   ;ActionGroup;
                      Name=Customer;
                      CaptionML=[DEU=Debitor;
                                 ENU=Customer;
                                 NLD=Klant] }
      { 6085584 ;2   ;Action    ;
                      Name=Customer Card;
                      CaptionML=[DEU=Debitoren&karte;
                                 ENU=&Customer Card;
                                 NLD=&Klantkaart];
                      Promoted=Yes;
                      Visible=IsCustomer;
                      Enabled=HasDocuments;
                      PromotedIsBig=Yes;
                      Image=Customer;
                      PromotedCategory=Category7;
                      OnAction=VAR
                                 Cust@1160040000 : Record 18;
                               BEGIN
                                 IF HasSourceID THEN BEGIN
                                   Cust.GET(GetSourceID);
                                   PAGE.RUN(PAGE::"Customer Card",Cust);
                                 END ELSE
                                   SetAndCreateNewCustomer;
                               END;
                                }
      { 6085580 ;2   ;Action    ;
                      Name=Ledger EntriesAction;
                      CaptionML=[DEU=&Posten;
                                 ENU=Ledger E&ntries;
                                 NLD=Poste&n];
                      Promoted=Yes;
                      Visible=IsCustomer;
                      Enabled=HasSourceID AND HasDocuments;
                      Image=VendorLedger;
                      PromotedCategory=Category7;
                      OnAction=VAR
                                 CustLedgEntry@1160040000 : Record 21;
                               BEGIN
                                 CustLedgEntry.SETCURRENTKEY("Customer No.");
                                 CustLedgEntry.SETRANGE("Customer No.",GetSourceID);
                                 PAGE.RUN(PAGE::"Customer Ledger Entries",CustLedgEntry);
                               END;
                                }
      { 1000000022;1 ;ActionGroup;
                      Name=RegisterGroup;
                      CaptionML=[DEU=&Journal;
                                 ENU=&Register;
                                 NLD=Regisratie] }
      { 1000000020;2 ;Action    ;
                      Name=Register;
                      ShortCutKey=F9;
                      CaptionML=[DEU=&Journal;
                                 ENU=&Register;
                                 NLD=Registreren];
                      Promoted=Yes;
                      Enabled=HasDocuments AND StatusIsOpen;
                      PromotedIsBig=Yes;
                      Image=Approve;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 Template@1000000001 : Record 6085579;
                                 Doc@6085573 : Record 6085590;
                               BEGIN
                                 Doc := Rec;
                                 Doc.RegisterYN;
                                 CurrPage.UPDATE(FALSE);

                                 IF ISEMPTY THEN
                                   CurrPage.CaptureUI.PAGE.ClearImage;
                               END;
                                }
      { 1000000029;2 ;Action    ;
                      Name=Reject;
                      CaptionML=[DEU=Abl&ehnen;
                                 ENU=Re&ject;
                                 NLD=Afwijzen];
                      Promoted=Yes;
                      Enabled=HasDocuments AND StatusIsOpen;
                      PromotedIsBig=Yes;
                      Image=Reject;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 Doc@6085573 : Record 6085590;
                               BEGIN
                                 Doc := Rec;
                                 Doc.Reject;
                                 CurrPage.UPDATE(FALSE);

                                 IF ISEMPTY THEN
                                   CurrPage.CaptureUI.PAGE.ClearImage;
                               END;
                                }
      { 6085573 ;2   ;Action    ;
                      Name=Reopen;
                      CaptionML=[DEU=Stat&us zurÅcksetzen;
                                 ENU=Re&open;
                                 NLD=Opnieu&w openen];
                      Promoted=Yes;
                      Enabled=HasDocuments AND (StatusIsRegistered OR StatusIsRejected);
                      PromotedIsBig=Yes;
                      Image=ReOpen;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 Doc@6085573 : Record 6085590;
                               BEGIN
                                 Doc := Rec;
                                 Doc.Reopen;
                                 CurrPage.UPDATE(FALSE);

                                 IF ISEMPTY THEN
                                   CurrPage.CaptureUI.PAGE.ClearImage;
                               END;
                                }
      { 6085578 ;2   ;Action    ;
                      Name=RegisterBatch;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Batch registrieren;
                                 ENU=Register Batch;
                                 NLD=Batch registreren];
                      Promoted=Yes;
                      Enabled=HasDocuments AND StatusIsOpen;
                      Image=PostBatch;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 Document@161024012 : Record 6085590;
                               BEGIN
                                 Document.COPY(Rec);
                                 Document.MARKEDONLY(TRUE);
                                 IF Document.ISEMPTY THEN BEGIN
                                   CurrPage.SETSELECTIONFILTER(Document);
                                   IF Document.COUNT < 2 THEN BEGIN
                                     Document.MARKEDONLY(FALSE);
                                     Document.COPYFILTERS(Rec);
                                   END;
                                 END;

                                 IF NOT CONFIRM(Text002,TRUE,Document.COUNT) THEN
                                   EXIT;

                                 REPORT.RUNMODAL(REPORT::"Batch Register Documents",FALSE,FALSE,Document);
                                 CurrPage.UPDATE(FALSE);

                                 IF ISEMPTY THEN
                                   CurrPage.CaptureUI.PAGE.ClearImage;
                               END;
                                }
      { 6085579 ;2   ;Action    ;
                      Name=Filter;
                      CaptionML=[DEU=&Filter;
                                 ENU=&Filter;
                                 NLD=&Filter];
                      Promoted=Yes;
                      Visible=NOT IsSourceNoNameVisible;
                      Enabled=HasDocuments;
                      Image=FilterLines;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 FilterSourceRecPage@6085573 : Page 6085609;
                                 NewSourceRecTreeId@6085574 : Integer;
                               BEGIN
                                 IF "Document Category Code" <> '' THEN BEGIN
                                   FilterSourceRecPage.SetValues("Document Category Code","Source Record ID Tree ID");
                                   FilterSourceRecPage.LOOKUPMODE(TRUE);
                                   IF FilterSourceRecPage.RUNMODAL = ACTION::LookupOK THEN
                                     FilterSourceRecPage.GetValues(NewSourceRecTreeId);
                                 END;

                                 IF NewSourceRecTreeId <> 0 THEN
                                   SETRANGE("Source Record ID Tree ID",NewSourceRecTreeId)
                                 ELSE
                                   SETRANGE("Source Record ID Tree ID");
                               END;
                                }
      { 1160040005;1 ;ActionGroup;
                      Name=Document;
                      CaptionML=[DEU=Beleg;
                                 ENU=Document;
                                 NLD=Document];
                      ActionContainerType=NewDocumentItems }
      { 1160040007;2 ;Action    ;
                      Name=CommentsAction;
                      CaptionML=[DEU=Be&merkungen;
                                 ENU=Co&mments;
                                 NLD=Op&merkingen];
                      Promoted=Yes;
                      Enabled=HasDocuments;
                      Image=ViewComments;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 DocumentCommentLine@6085573 : Record 6085577;
                               BEGIN
                                 DocumentCommentLine.FILTERGROUP(4);
                                 DocumentCommentLine.SETRANGE("Table ID",DATABASE::"DC Document");
                                 DocumentCommentLine.SETRANGE("No.","No.");
                                 DocumentCommentLine.FILTERGROUP(0);
                                 PAGE.RUN(PAGE::"Document Comment Sheet",DocumentCommentLine);
                               END;
                                }
      { 1160040004;2 ;Action    ;
                      Name=PDF File;
                      ShortCutKey=Shift+Ctrl+P;
                      CaptionML=[DEU=&PDF-Datei;
                                 ENU=&PDF File;
                                 NLD=&PDF-bestand];
                      Promoted=Yes;
                      Enabled=HasDocuments;
                      PromotedIsBig=Yes;
                      Image=SendAsPDF;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Document@1000000000 : Record 6085590;
                               BEGIN
                                 OpenPdfFile;
                               END;
                                }
      { 1160040003;2 ;Action    ;
                      Name=Incoming E-Mail;
                      CaptionML=[DEU=Abl&ehnen;
                                 ENU=Incoming E-Mail;
                                 NLD=Inkomende e-mail];
                      Promoted=Yes;
                      Visible=ShowIncomingEmail;
                      Enabled=HasDocuments;
                      PromotedIsBig=Yes;
                      Image=Email;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 OpenEMailFile;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1000000000;;Container;
                Name=ContentArea;
                ContainerType=ContentArea }

    { 1000000016;1;Group  ;
                Name=Group1;
                CaptionML=[ENU="";
                           NLD=""];
                GroupType=Group }

    { 1000000017;2;Field  ;
                Name=CurrentDocCategory;
                CaptionML=[DEU=Beleg Kategorie;
                           ENU=Document Category;
                           NLD=Documentcategorie];
                SourceExpr=CurrentDocCategory;
                OnValidate=BEGIN
                             UpdateList;
                             EnableFields;
                             SetSourceNoNameVisibility;
                           END;

                OnLookup=VAR
                           DocCat@1000000000 : Record 6085575;
                         BEGIN
                           IF DocCat.GET(CurrentDocCategory) THEN;
                           IF PAGE.RUNMODAL(0,DocCat) = ACTION::LookupOK THEN BEGIN
                             Text := DocCat.Code;
                             EXIT(TRUE);
                           END;
                         END;
                          }

    { 1000000018;2;Field  ;
                Name=StatusFilter;
                CaptionML=[DEU=Statusfilter;
                           ENU=Status Filter;
                           NLD=Statusfilter];
                OptionCaptionML=[DEU=Offen,Registriert,Abgelehnt,Alle;
                                 ENU=Open,Registered,Rejected,All;
                                 NLD=Open,Geregistreerd,Geweigerd,Alles];
                SourceExpr=StatusFilter;
                OnValidate=BEGIN
                             UpdateList;
                             SetSourceNoNameVisibility;
                           END;
                            }

    { 6085601;2;Group     ;
                Name=Group20;
                CaptionML=[ENU="";
                           NLD=""];
                Visible=ShowEventNotifier;
                GroupType=Group }

    { 1000000021;3;Field  ;
                Name=EventNotifier;
                SourceExpr=EventNotifierSource;
                ControlAddIn=[Akeyto.DocumentCapture.Dynamics.Nav.EventNotifier;PublicKeyToken=0c53e51c0afe7001];
                OnControlAddIn=BEGIN
                                 IF Index = 0 THEN
                                   HandleSimpleCommand(CaptureAddinLib.BigTextToText(Data))
                               END;
                                }

    { 1000000001;1;Group  ;
                Name=Group2;
                GroupType=Repeater }

    { 1000000002;2;Field  ;
                Name=No.;
                SourceExpr="No.";
                Editable=FALSE }

    { 1000000003;2;Field  ;
                Name=OK;
                SourceExpr=OK }

    { 6085592;2;Field     ;
                Name=Match Status;
                SourceExpr="Match Status";
                Visible=FALSE }

    { 1000000004;2;Field  ;
                Name=Document Category Code;
                SourceExpr="Document Category Code";
                Visible=FALSE;
                Enabled=AllowEdit;
                OnValidate=BEGIN
                             CurrPage.UPDATE(TRUE);
                           END;
                            }

    { 1000000006;2;Field  ;
                Name=SourceID;
                CaptionML=;
                SourceExpr=SourceID;
                CaptionClass=GetSourceIDCaption;
                Visible=NOT IsSourceNoNameVisible;
                Enabled=AllowEdit;
                OnValidate=BEGIN
                             OnSourceRecordNoValidate(SourceID);
                           END;

                OnLookup=BEGIN
                           OnSourceRecordNoLookup(Text);
                         END;
                          }

    { 1000000034;2;Field  ;
                Name=Control1000000034;
                CaptionML=;
                SourceExpr=GetSourceName;
                CaptionClass=GetSourceNameCaption;
                Visible=NOT IsSourceNoNameVisible }

    { 6085574;2;Field     ;
                Name=Source Record No.;
                SourceExpr="Source Record No.";
                CaptionClass=GetSourceIDCaption;
                Visible=IsSourceNoNameVisible;
                OnValidate=BEGIN
                             OnSourceRecordNoValidate("Source Record No.");
                           END;

                OnLookup=BEGIN
                           OnSourceRecordNoLookup(Text);
                         END;
                          }

    { 6085583;2;Field     ;
                Name=Source Record Name;
                SourceExpr="Source Record Name";
                CaptionClass=GetSourceNameCaption;
                Visible=IsSourceNoNameVisible;
                Editable=FALSE }

    { 1000000007;2;Field  ;
                Name=Template No.;
                SourceExpr="Template No.";
                Enabled=AllowEdit;
                OnValidate=VAR
                             CaptureEngine@161024013 : Codeunit 6085575;
                           BEGIN
                             CurrPage.SAVERECORD;
                             IF "Template No." <> '' THEN BEGIN
                               COMMIT;
                               CaptureEngine.CaptureDocument(Rec);
                             END;
                             EnableFields;

                             CurrPage.UPDATE(FALSE);
                           END;
                            }

    { 1000000008;2;Field  ;
                Name=Template Description;
                SourceExpr="Template Description";
                Visible=FALSE;
                Editable=FALSE }

    { 2000000000;2;Field  ;
                Name=TemplSearchText;
                CaptionML=[DEU=Suchtext;
                           ENU=Search Text;
                           NLD=Zoektekst];
                SourceExpr=TemplSearchText;
                Editable=SearchTextEditable;
                OnValidate=VAR
                             Template@1000000000 : Record 6085579;
                           BEGIN
                             IF Template.GET("Template No.") THEN BEGIN
                               Template."Search Text" := COPYSTR(TemplSearchText,1,MAXSTRLEN(Template."Search Text"));
                               Template.MODIFY(TRUE);

                               CurrPage.UPDATE(FALSE);
                             END;
                           END;

                OnDrillDown=VAR
                              Template@6085573 : Record 6085579;
                            BEGIN
                              IF Template.GET("Template No.") THEN BEGIN
                                Template.DrillDownSearchTexts;
                                CurrPage.UPDATE(FALSE);
                              END;
                            END;
                             }

    { 1160040002;2;Field  ;
                Name=Status Code;
                SourceExpr="Status Code";
                Visible=ShowStatusCode }

    { 1160040001;2;Field  ;
                Name=Control1161140001;
                CaptionML=[DEU=Bestellung/Reklamation;
                           ENU=Order/Return Order;
                           NLD=Order/retourorder];
                ToolTipML=[DEU=Dieses Feld zeigt an, ob ein oder mehrere AuftrÑge oder Reklamationen fÅr diesen Kreditor erstellt worden sind.;
                           ENU=This field indicate if there are one or more orders or return orders created for this vendor;
                           NLD=Dit veld geeft aan of er ÇÇn of meerdere orders of retourorders voor deze leveranciers zijn aangemaakt.];
                SourceExpr=HasOrderCrMemo;
                Visible=IsUsingPurchOrders;
                Editable=FALSE }

    { 161024012;2;Field   ;
                Name=Control161024012;
                CaptionML=[DEU=Anz. der Bestellungen;
                           ENU=No. of Purch. Orders;
                           NLD=Aantal inkooporders];
                BlankZero=Yes;
                SourceExpr=PurchDocMgt.GetNoOfPurchOrders(Rec);
                Visible=FALSE;
                OnDrillDown=BEGIN
                              PurchDocMgt.LookupNoOfPurchOrders(Rec);
                            END;
                             }

    { 161024013;2;Field   ;
                Name=Control161024013;
                CaptionML=[DEU=Anz. der BestellungsrÅckgabeauftrÑge;
                           ENU=No. of Purch. Return Orders;
                           NLD=Aantal retourinkooporders];
                BlankZero=Yes;
                SourceExpr=PurchDocMgt.GetNoOfPurchReturnOrders(Rec);
                Visible=FALSE;
                OnDrillDown=BEGIN
                              PurchDocMgt.LookupNoOfPurchReturnOrders(Rec);
                            END;
                             }

    { 6085594;2;Field     ;
                Name=Document Status Text;
                SourceExpr="Document Status Text";
                Visible=FALSE;
                Editable=FALSE }

    { 1000000009;2;Field  ;
                Name=Description;
                SourceExpr=Description;
                Visible=FALSE;
                Enabled=AllowEdit }

    { 1000000010;2;Field  ;
                Name=Status;
                SourceExpr=Status;
                Visible=FALSE;
                Editable=FALSE }

    { 1000000011;2;Field  ;
                Name=No. of Pages;
                SourceExpr="No. of Pages" }

    { 6085596;2;Field     ;
                SourceExpr="Imported by";
                Visible=FALSE }

    { 6085595;2;Field     ;
                SourceExpr="Imported Date-Time";
                Visible=FALSE }

    { 1000000014;1;Part   ;
                Name=Header;
                CaptionML=[DEU=Dokumentenkopf;
                           ENU=Document Header;
                           NLD=Document Header];
                SubPageView=SORTING(Document No.,Sort Order);
                SubPageLink=Document No.=FIELD(No.);
                PagePartID=Page6085595;
                ShowFilter=No }

    { 1000000033;1;Part   ;
                Name=Comments;
                CaptionML=[DEU=Bemerkungen;
                           ENU=Comments;
                           NLD=Opmerkingen];
                SubPageView=SORTING(Document No.,Comment Type)
                            ORDER(Descending);
                SubPageLink=Document No.=FIELD(No.);
                PagePartID=Page6085599;
                Enabled=FALSE;
                ShowFilter=No }

    { 1000000013;;Container;
                Name=FactBoxArea;
                ContainerType=FactBoxArea }

    { 1000000012;1;Part   ;
                Name=CaptureUI;
                CaptionML=[DEU=Beleg;
                           ENU=Document;
                           NLD=Document];
                SubPageView=SORTING(No.);
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page6085593 }

  }
  CODE
  {
    VAR
      DCSetup@1000000013 : Record 6085573;
      CaptureAddinLib@1000000011 : Codeunit 6085660;
      WebClientMgt@6085573 : Codeunit 6085662;
      PurchDocMgt@161024012 : Codeunit 6085709;
      TempFileStorage@1000 : Codeunit 6085665;
      MessageBusSocket@1001 : DotNet "'Continia.DocumentCapture.Dynamics.Nav.MessageBus, Version=5.0.0.0, Culture=neutral, PublicKeyToken=0c53e51c0afe7001'.Continia.DocumentCapture.Dynamics.Nav.MessageBus.MessageBusSocket" WITHEVENTS;
      SourceID@161024015 : Text[250];
      EventNotifierSource@1000000008 : BigText;
      CurrentDocCategory@1000000017 : Code[20];
      Channel@1002 : Code[50];
      StatusFilter@1000000016 : 'Open,Registered,Rejected,All';
      TemplSearchText@1000000019 : Text[200];
      AllowEdit@1000000005 : Boolean INDATASET;
      Text001@161024014 : TextConst 'DEU=Mîchten Sie die Felder auf %1 Dokument(en) erkennen?;ENU=Do you want to recognize fields on %1 documents?;NLD=Wilt u velden op %1 documenten laten herkennen?';
      IsVendor@1160040000 : Boolean INDATASET;
      IsCustomer@1160040001 : Boolean INDATASET;
      Text002@1160040002 : TextConst 'DEU=Mîchten Sie %1 Dokument(e) registrieren?;ENU=Do you want to register %1 document(s)?;NLD=Wilt u %1 document(en) registreren?';
      HasOrderCrMemo@1160040343 : Boolean;
      IsUsingPurchOrders@1160044004 : Boolean INDATASET;
      ShowMatchLines@1160040105 : Boolean INDATASET;
      ShowStatusCode@1200040015 : Boolean INDATASET;
      HasTemplate@1160040003 : Boolean INDATASET;
      HasSourceID@1160040004 : Boolean INDATASET;
      SourceIDText@1160040006 : TextConst 'DEU=Herkunfts-ID;ENU=Source ID;NLD=Bron-id';
      SourceNameText@1160040005 : TextConst 'DEU=Herkunftsname;ENU=Source Name;NLD=Bronnaam';
      IsSourceNoNameVisible@6085574 : Boolean INDATASET;
      ShowMoveToCompany@1160040007 : Boolean INDATASET;
      ShowNavigate@1160040008 : Boolean INDATASET;
      ShowIncomingEmail@6085575 : Boolean INDATASET;
      ShowVendorCard@6085578 : Boolean INDATASET;
      HasDocuments@6085576 : Boolean INDATASET;
      StatusIsOpen@6085577 : Boolean INDATASET;
      StatusIsRegistered@6085579 : Boolean INDATASET;
      TotalSearchTextsTxt@6085580 : TextConst 'DEU=(%1 Texte gesamt);ENU=(%1 texts in total);NLD=(%1 teksten in totaal)';
      StatusIsRejected@6085582 : Boolean INDATASET;
      SearchTextEditable@6085581 : Boolean INDATASET;
      ShowEventNotifier@6085583 : Boolean;

    LOCAL PROCEDURE EnableFields@1000000017();
    BEGIN
      AllowEdit := Status = Status::Open;
      IsVendor := GetSourceTableNo = DATABASE::Vendor;
      IsCustomer := GetSourceTableNo = DATABASE::Customer;
    END;

    LOCAL PROCEDURE HandleSimpleCommand@1000000006(Command@1000000000 : Text[1024]);
    BEGIN
      CASE Command OF
        'UPDATEDOCUMENT',
        'UPDATEHEADER':
          BEGIN
            FIND('=');
            ValidateDocument;
            CurrPage.Header.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Header page
            CurrPage.Comments.PAGE.UpdatePage; //RTC will drop the relationship between this page and the Comments page
            CurrPage.UPDATE(FALSE); // This will restore the dropped relationship
          END;
      END;
    END;

    LOCAL PROCEDURE UpdateSearchTexts@3();
    VAR
      Template@1000 : Record 6085579;
      TemplateSearchText@6085573 : Record 6085588;
    BEGIN
      EnableFields;

      SetManual(TRUE);
      SourceID := GetSourceID;
      HasTemplate := "Template No." <> '';
      HasSourceID := SourceID <> '';

      IF NOT Template.GET("Template No.") THEN BEGIN
        TemplSearchText := '';
        SearchTextEditable := FALSE;
        CLEAR(Template)
      END ELSE BEGIN
        SearchTextEditable := AllowEdit;
        TemplSearchText := Template."Search Text";
        TemplateSearchText.SETRANGE("Template No.","Template No.");
        IF NOT TemplateSearchText.ISEMPTY THEN BEGIN
          SearchTextEditable := FALSE;
          TemplateSearchText.FINDFIRST;
          TemplSearchText := TemplateSearchText."Search Text" + ' ' + STRSUBSTNO(TotalSearchTextsTxt,TemplateSearchText.COUNT);
        END;
      END;

      UpdateStatusText;
    END;

    PROCEDURE UpdateList@6085575();
    VAR
      DocCat@6085573 : Record 6085575;
      Template@6085574 : Record 6085579;
    BEGIN
      FILTERGROUP := 2;

      IF StatusFilter <> StatusFilter::All THEN BEGIN
        IF CURRENTKEY = FIELDCAPTION("No.") THEN
          SETCURRENTKEY("Document Category Code",Status);

        SETRANGE(Status,StatusFilter);
      END ELSE BEGIN
        IF CURRENTKEY = STRSUBSTNO('%1,%2',FIELDCAPTION("Document Category Code"),FIELDCAPTION(Status)) THEN
          SETCURRENTKEY("No.");

        SETRANGE(Status);
      END;

      ShowNavigate := StatusFilter <> StatusFilter::Open;

      IF CurrentDocCategory <> '' THEN
        SETRANGE("Document Category Code",CurrentDocCategory)
      ELSE
        SETRANGE("Document Category Code");

      FILTERGROUP := 0;

      ShowMatchLines := TRUE;
      IF CurrentDocCategory <> '' THEN
        IF DocCat.GET(CurrentDocCategory) THEN BEGIN
          IF DocCat."Destination Header Table No." = DATABASE::"Purchase Header" THEN
            ShowMatchLines := IsUsingPurchOrders
          ELSE BEGIN
            Template.SETCURRENTKEY("Category Code",Type);
            Template.SETRANGE("Category Code",CurrentDocCategory);
            Template.SETFILTER("Codeunit ID: Show Match",'<>%1',0);
            ShowMatchLines := NOT Template.ISEMPTY;
          END;
        END;
      HasDocuments := NOT ISEMPTY;
      CurrPage.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE GetSourceIDCaption@1160040001() Caption : Text[250];
    VAR
      DocCat@1160040001 : Record 6085575;
      AllObjWithCaption@1160040000 : Record 2000000058;
      RecIDMgt@1160040002 : Codeunit 6085604;
    BEGIN
      Caption := SourceIDText;
      IF DocCat.GET(CurrentDocCategory) THEN
        IF DocCat."Source Table No." <> 0 THEN
          Caption := RecIDMgt.GetObjectCaption(AllObjWithCaption."Object Type"::Table,DocCat."Source Table No.");
    END;

    LOCAL PROCEDURE GetSourceNameCaption@1160040002() Caption : Text[250];
    VAR
      DocCat@1160040002 : Record 6085575;
      AllObjWithCaption@1160040001 : Record 2000000058;
      RecIDMgt@1160040000 : Codeunit 6085604;
    BEGIN
      Caption := SourceNameText;
      IF DocCat.GET(CurrentDocCategory) THEN
        IF (DocCat."Source Table No." <> 0) AND (DocCat."Source Field No. (Name)" <> 0) THEN
          Caption := RecIDMgt.GetFieldCaption(DocCat."Source Table No.",DocCat."Source Field No. (Name)");
    END;

    LOCAL PROCEDURE SetSourceNoNameVisibility@6085573();
    VAR
      DocCat@6085573 : Record 6085575;
      Document@6085574 : Record 6085590;
      RecIDMgt@6085575 : Codeunit 6085604;
    BEGIN
      IF DocCat.GET(CurrentDocCategory) THEN BEGIN
        IsSourceNoNameVisible := (DocCat."Source Table No." <> 0) AND (RecIDMgt.GetFieldCountInKey(DocCat."Source Table No.",1) = 1);
        EXIT;
      END;

      FILTERGROUP(2);
      Rec.COPYFILTER(Status,Document.Status);
      FILTERGROUP(0);

      IsSourceNoNameVisible := FALSE;
      DocCat.SETRANGE("Source Table No.",0);
      IF DocCat.FINDSET THEN
        REPEAT
          Document.SETCURRENTKEY("Document Category Code",Status);
          Document.SETRANGE("Document Category Code",DocCat.Code);
          IF NOT Document.ISEMPTY THEN
            EXIT;
        UNTIL DocCat.NEXT = 0;

      IsSourceNoNameVisible := TRUE;
    END;

    LOCAL PROCEDURE OnSourceRecordNoValidate@6085574(SourceRecordNo@6085573 : Text[250]);
    VAR
      CaptureEngine@6085574 : Codeunit 6085575;
    BEGIN
      SetManual(TRUE);
      SetSourceID(SourceRecordNo);

      IF "Template No." = '' THEN
        ValidateDocument
      ELSE BEGIN
        COMMIT;
        CaptureEngine.CaptureDocument(Rec);
      END;

      EnableFields;
      CurrPage.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE OnSourceRecordNoLookup@6085597(VAR Text@6085575 : Text);
    VAR
      RecIDMgt@6085574 : Codeunit 6085604;
      CaptureEngine@6085573 : Codeunit 6085575;
    BEGIN
      IF NOT RecIDMgt.LookupRecordID("Document Category Code",Text) THEN
        EXIT;

      SetManual(TRUE);
      SetSourceID(Text);

      IF "Template No." = '' THEN
        ValidateDocument
      ELSE BEGIN
        COMMIT;
        CaptureEngine.CaptureDocument(Rec);
      END;

      EnableFields;
      CurrPage.UPDATE(FALSE);
    END;

    EVENT MessageBusSocket@1001::OnMessageReceived@11(type@1001 : Integer;message@1000 : Text);
    BEGIN
      IF (type = 0) THEN
        HandleSimpleCommand(message);
    END;

    BEGIN
    END.
  }
}

