OBJECT Report 81678 Aged Accounts Receivab Excel
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PSSE,RFC-045;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Aged Accounts Receivable;
               NOR=Aldersford. saldoliste - kunde;
               SVE=èldersanalys av kundfordringar];
    ProcessingOnly=Yes;
    OnInitReport=BEGIN
                   // 151123 ITERO.KP >>
                   EndingDate := TODAY;
                   AgingBy := AgingBy::"Due Date";
                   HeadingType := HeadingType::"Number of Days";
                   // 151123 ITERO.KP <<
                   //160511 ITERO.PP START
                   CompanyInfo.GET;
                   //160511 ITERO.PP SLUT
                 END;

    OnPreReport=VAR
                  "**4PSSE**"@1100285502 : Integer;
                  TEMPDimValueChains@1100285501 : TEMPORARY Record 11128020;
                  First@1100285500 : Boolean;
                BEGIN
                  Window.OPEN(ProcessingText);
                  PrintDetails := TRUE;
                  PrintToExcel := TRUE;
                  CustFilter := Customer.GETFILTERS;

                  GLSetup.GET;

                  CalcDates;
                  CreateHeadings;


                  IF PrintToExcel THEN
                    MakeExcelInfo;

                  PageGroupNo := 1;
                  NextPageGroupNo := 1;
                  CustFilterCheck := (CustFilter <> 'No.');

                  //+++4PSSE
                  //*** Filters on cost center from dimension filter ***
                  FilterCostCenter := '';
                  DimensionFilter := '';

                  IF DimensionCode = GLSetup."Shortcut Dimension 1 Code" THEN BEGIN

                    FilterCostCenter := DimensionValueCode;

                  END ELSE BEGIN

                    IF DimensionValueCode <> '' THEN
                      TEMPDimValueChains.getSourceDimensions(DimensionCode, DimensionValueCode, GLSetup."Shortcut Dimension 1 Code", TEMPDimValueChains);

                    First := TRUE;
                    IF TEMPDimValueChains.FINDSET(FALSE) THEN REPEAT

                      IF First THEN BEGIN
                        FilterCostCenter := TEMPDimValueChains."Start Dimension Value Code";
                        First := FALSE
                      END ELSE
                        FilterCostCenter += '|' + TEMPDimValueChains."Start Dimension Value Code";
                    UNTIL TEMPDimValueChains.NEXT = 0;

                  END;

                  IF FilterCostCenter <> '' THEN
                    DimensionFilter := DimensionCode + ': ' + DimensionValueCode
                  ELSE
                    DimensionFilter := '';
                  //---4PSSE

                  // ITERO.KP >>
                  UseProjectFilter := FALSE;
                  ProjFilter := Job.GETFILTERS;
                  IF Job.GETFILTERS <> '' THEN BEGIN
                    TmpProject.DELETEALL;
                    Project.COPYFILTERS(Job);
                    IF Project.FIND('-') THEN REPEAT
                      TmpProject.INIT;
                      TmpProject.TRANSFERFIELDS(Project);
                      TmpProject.INSERT;
                    UNTIL Project.NEXT = 0;
                    UseProjectFilter := TRUE;
                  END;
                  // ITERO.KP <<
                END;

    OnPostReport=BEGIN

                   Window.CLOSE;
                   IF PrintToExcel THEN
                     CreateExcelbook;
                 END;

  }
  DATASET
  {
    { 1000000003;;DataItem;                  ;
               DataItemTable=Table11072003;
               DataItemTableView=SORTING(No.);
               MaxIteration=0;
               OnPreDataItem=BEGIN
                               CurrReport.SKIP;
                             END;

               ReqFilterFields=No.,Project Status,Project Manager }

    { 6836;    ;DataItem;Customer            ;
               DataItemTable=Table18;
               OnPreDataItem=BEGIN
                               DPA_SetFilters(CurrReport.OBJECTID(FALSE)); //**4PS.n
                             END;

               OnAfterGetRecord=BEGIN
                                  TempCurrency.RESET;
                                  TempCurrency.DELETEALL;
                                  TempCustLedgEntry.RESET;
                                  TempCustLedgEntry.DELETEALL;
                                END;

               ReqFilterFields=No. }

    { 3   ;1   ;Column  ;TodayFormatted      ;
               SourceExpr=FORMAT(TODAY,0,4) }

    { 4   ;1   ;Column  ;CompanyName         ;
               SourceExpr=CompanyInfo.Name }

    { 108 ;1   ;Column  ;FormatEndingDate    ;
               SourceExpr=STRSUBSTNO(Text006,FORMAT(EndingDate,0,4)) }

    { 110 ;1   ;Column  ;PostingDate         ;
               SourceExpr=STRSUBSTNO(Text007,SELECTSTR(AgingBy + 1,Text009)) }

    { 128 ;1   ;Column  ;PrintAmountInLCY    ;
               SourceExpr=PrintAmountInLCY }

    { 1   ;1   ;Column  ;TableCaptnCustFilter;
               SourceExpr=TABLECAPTION + ': ' + CustFilter }

    { 1100525000;1;Column;DPA_GetFiltersFltrGrp0;
               SourceExpr=DPA_GetFiltersFltrGrp(0) }

    { 1100525001;1;Column;DPA_GetFiltersFltrGrp7;
               SourceExpr=DPA_GetFiltersFltrGrp(7) }

    { 129 ;1   ;Column  ;CustFilter          ;
               SourceExpr=CustFilter }

    { 130 ;1   ;Column  ;AgingByDueDate      ;
               SourceExpr=AgingBy = AgingBy::"Due Date" }

    { 57  ;1   ;Column  ;AgedbyDocumnetDate  ;
               SourceExpr=STRSUBSTNO(Text004,SELECTSTR(AgingBy + 1,Text009)) }

    { 64  ;1   ;Column  ;HeaderText5         ;
               SourceExpr=HeaderText[5] }

    { 70  ;1   ;Column  ;HeaderText4         ;
               SourceExpr=HeaderText[4] }

    { 71  ;1   ;Column  ;HeaderText3         ;
               SourceExpr=HeaderText[3] }

    { 72  ;1   ;Column  ;HeaderText2         ;
               SourceExpr=HeaderText[2] }

    { 73  ;1   ;Column  ;HeaderText1         ;
               SourceExpr=HeaderText[1] }

    { 1000000002;1;Column;HeaderText6        ;
               SourceExpr=HeaderText[6] }

    { 1000000000;1;Column;HeaderText7        ;
               SourceExpr=HeaderText[7] }

    { 131 ;1   ;Column  ;PrintDetails        ;
               SourceExpr=PrintDetails }

    { 42  ;1   ;Column  ;GrandTotalCLE5RemAmt;
               SourceExpr=GrandTotalCustLedgEntry[5]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 43  ;1   ;Column  ;GrandTotalCLE4RemAmt;
               SourceExpr=GrandTotalCustLedgEntry[4]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 44  ;1   ;Column  ;GrandTotalCLE3RemAmt;
               SourceExpr=GrandTotalCustLedgEntry[3]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 45  ;1   ;Column  ;GrandTotalCLE2RemAmt;
               SourceExpr=GrandTotalCustLedgEntry[2]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 46  ;1   ;Column  ;GrandTotalCLE1RemAmt;
               SourceExpr=GrandTotalCustLedgEntry[1]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 47  ;1   ;Column  ;GrandTotalCLEAmtLCY ;
               SourceExpr=GrandTotalCustLedgEntry[1]."Amount (LCY)";
               AutoFormatType=1 }

    { 48  ;1   ;Column  ;GrandTotalCLE1CustRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[1]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 49  ;1   ;Column  ;GrandTotalCLE2CustRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[2]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 50  ;1   ;Column  ;GrandTotalCLE3CustRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[3]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 51  ;1   ;Column  ;GrandTotalCLE4CustRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[4]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 52  ;1   ;Column  ;GrandTotalCLE5CustRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[5]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 2   ;1   ;Column  ;AgedAccReceivableCptn;
               SourceExpr=AgedAccReceivableCptnLbl }

    { 6   ;1   ;Column  ;CurrReportPageNoCptn;
               SourceExpr=CurrReportPageNoCptnLbl }

    { 111 ;1   ;Column  ;AllAmtinLCYCptn     ;
               SourceExpr=AllAmtinLCYCptnLbl }

    { 54  ;1   ;Column  ;AgedOverdueAmtCptn  ;
               SourceExpr=AgedOverdueAmtCptnLbl }

    { 75  ;1   ;Column  ;CLEEndDateAmtLCYCptn;
               SourceExpr=CLEEndDateAmtLCYCptnLbl }

    { 76  ;1   ;Column  ;CLEEndDateDueDateCptn;
               SourceExpr=CLEEndDateDueDateCptnLbl }

    { 77  ;1   ;Column  ;CLEEndDateDocNoCptn ;
               SourceExpr=CLEEndDateDocNoCptnLbl }

    { 78  ;1   ;Column  ;CLEEndDatePstngDateCptn;
               SourceExpr=CLEEndDatePstngDateCptnLbl }

    { 79  ;1   ;Column  ;CLEEndDateDocTypeCptn;
               SourceExpr=CLEEndDateDocTypeCptnLbl }

    { 41  ;1   ;Column  ;OriginalAmtCptn     ;
               SourceExpr=OriginalAmtCptnLbl }

    { 55  ;1   ;Column  ;TotalLCYCptn        ;
               SourceExpr=TotalLCYCptnLbl }

    { 1100285505;1;Column;CompanyCaption     ;
               SourceExpr=CompanyCaption }

    { 1100285506;1;Column;RegionCaption      ;
               SourceExpr=RegionCaption }

    { 1100285507;1;Column;CostCenterCaption  ;
               SourceExpr=CostCenterCaption }

    { 1100285508;1;Column;ProjectNoCaption   ;
               SourceExpr=ProjectNoCaption }

    { 1100285509;1;Column;ProjectDescCaption ;
               SourceExpr=ProjectDescCaption }

    { 1100285510;1;Column;ShowWithoutTotals  ;
               SourceExpr=ShowWithoutTotals }

    { 1100285511;1;Column;DimensionFilter    ;
               SourceExpr=DimensionFilter }

    { 8503;1   ;DataItem;                    ;
               DataItemTable=Table21;
               DataItemTableView=SORTING(Customer No.,Posting Date,Currency Code);
               OnPreDataItem=BEGIN
                               SETRANGE("Posting Date",EndingDate + 1,99991231D);

                               DPA_SetFilters(CurrReport.OBJECTID(FALSE)); //**4PS.n

                               SETFILTER("Global Dimension 1 Code", FilterCostCenter); //***4PSSE
                             END;

               OnAfterGetRecord=VAR
                                  CustLedgEntry@1000 : Record 21;
                                BEGIN
                                  CustLedgEntry.SETCURRENTKEY("Closed by Entry No.");
                                  CustLedgEntry.SETRANGE("Closed by Entry No.","Entry No.");
                                  CustLedgEntry.SETRANGE("Posting Date",0D,EndingDate);
                                  IF CustLedgEntry.FINDSET(FALSE,FALSE) THEN
                                    REPEAT
                                      IF UseProjectFilter THEN BEGIN
                                        IF TmpProject.GET(CustLedgEntry."Project No.") THEN
                                          InsertTemp(CustLedgEntry);
                                      END ELSE
                                        InsertTemp(CustLedgEntry);
                                    UNTIL CustLedgEntry.NEXT = 0;

                                  IF "Closed by Entry No." <> 0 THEN BEGIN
                                    CustLedgEntry.SETRANGE("Closed by Entry No.","Closed by Entry No.");
                                    IF CustLedgEntry.FINDSET(FALSE,FALSE) THEN
                                      REPEAT
                                        IF UseProjectFilter THEN BEGIN
                                          IF TmpProject.GET(CustLedgEntry."Project No.") THEN
                                            InsertTemp(CustLedgEntry);
                                        END ELSE
                                          InsertTemp(CustLedgEntry);
                                      UNTIL CustLedgEntry.NEXT = 0;
                                  END;


                                  CustLedgEntry.RESET;
                                  CustLedgEntry.SETRANGE("Entry No.","Closed by Entry No.");
                                  CustLedgEntry.SETRANGE("Posting Date",0D,EndingDate);
                                  IF CustLedgEntry.FINDSET(FALSE,FALSE) THEN
                                    REPEAT
                                      IF UseProjectFilter THEN BEGIN
                                        IF TmpProject.GET(CustLedgEntry."Project No.") THEN
                                          InsertTemp(CustLedgEntry);
                                      END ELSE
                                        InsertTemp(CustLedgEntry);
                                    UNTIL CustLedgEntry.NEXT = 0;
                                  CurrReport.SKIP;
                                END;

               DataItemLink=Customer No.=FIELD(No.) }

    { 1473;1   ;DataItem;OpenCustLedgEntry   ;
               DataItemTable=Table21;
               DataItemTableView=SORTING(Customer No.,Open,Positive,Due Date,Currency Code);
               OnPreDataItem=BEGIN
                               IF AgingBy = AgingBy::"Posting Date" THEN BEGIN
                                 SETRANGE("Posting Date",0D,EndingDate);
                                 SETRANGE("Date Filter",0D,EndingDate);
                               END;

                               DPA_SetFilters(CurrReport.OBJECTID(FALSE)); //**4PS.n

                               SETFILTER("Global Dimension 1 Code", FilterCostCenter); //***4PSSE
                             END;

               OnAfterGetRecord=BEGIN
                                  IF AgingBy = AgingBy::"Posting Date" THEN BEGIN
                                    CALCFIELDS("Remaining Amt. (LCY)");
                                    IF "Remaining Amt. (LCY)" = 0 THEN
                                      CurrReport.SKIP;
                                  END;

                                  IF UseProjectFilter THEN BEGIN
                                    IF TmpProject.GET(OpenCustLedgEntry."Project No.") THEN
                                      InsertTemp(OpenCustLedgEntry);
                                  END ELSE
                                    InsertTemp(OpenCustLedgEntry);

                                  CurrReport.SKIP;
                                END;

               DataItemLink=Customer No.=FIELD(No.) }

    { 6523;1   ;DataItem;CurrencyLoop        ;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number)
                                 WHERE(Number=FILTER(1..));
               PrintOnlyIfDetail=Yes;
               OnPreDataItem=BEGIN
                               NumberOfCurrencies := 0;
                             END;

               OnAfterGetRecord=BEGIN
                                  CLEAR(TotalCustLedgEntry);

                                  IF Number = 1 THEN BEGIN
                                    IF NOT TempCurrency.FINDSET(FALSE,FALSE) THEN
                                      CurrReport.BREAK;
                                  END ELSE
                                    IF TempCurrency.NEXT = 0 THEN
                                      CurrReport.BREAK;

                                  IF TempCurrency.Code <> '' THEN
                                    CurrencyCode := TempCurrency.Code
                                  ELSE
                                    CurrencyCode := GLSetup."LCY Code";

                                  NumberOfCurrencies := NumberOfCurrencies + 1;
                                END;
                                 }

    { 7725;2   ;DataItem;TempCustLedgEntryLoop;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number)
                                 WHERE(Number=FILTER(1..));
               OnPreDataItem=BEGIN
                               IF NOT PrintAmountInLCY THEN
                                 TempCustLedgEntry.SETRANGE("Currency Code",TempCurrency.Code);

                               PageGroupNo := NextPageGroupNo;
                               IF NewPagePercustomer AND (NumberOfCurrencies > 0) THEN
                                 NextPageGroupNo := PageGroupNo + 1;
                             END;

               OnAfterGetRecord=VAR
                                  PeriodIndex@1001 : Integer;
                                  "**4PSSE**"@1100285501 : Integer;
                                  DimensionSetEntry@1100285500 : Record 480;
                                BEGIN
                                  IF Number = 1 THEN BEGIN
                                    IF NOT TempCustLedgEntry.FINDSET(FALSE,FALSE) THEN
                                      CurrReport.BREAK;
                                  END ELSE
                                    IF TempCustLedgEntry.NEXT = 0 THEN
                                      CurrReport.BREAK;

                                  //+++4PSSE.MK
                                  IF DimensionSetEntry.GET(TempCustLedgEntry."Dimension Set ID", GLSetup."Shortcut Dimension 8 Code") THEN BEGIN
                                    DimensionSetEntry.CALCFIELDS("Dimension Value Name");
                                    CompanyDim := DimensionSetEntry."Dimension Value Name" // DimensionSetEntry."Dimension Value Code"
                                  END ELSE
                                    CompanyDim := '';

                                  IF DimensionSetEntry.GET(TempCustLedgEntry."Dimension Set ID", GLSetup."Shortcut Dimension 5 Code") THEN BEGIN
                                    DimensionSetEntry.CALCFIELDS("Dimension Value Name");
                                    RegionDim := DimensionSetEntry."Dimension Value Name" // DimensionSetEntry."Dimension Value Code"
                                  END ELSE
                                    RegionDim := '';

                                  IF TempCustLedgEntry."Global Dimension 1 Code" <> '' THEN
                                    CostCenterDim := TempCustLedgEntry."Global Dimension 1 Code"
                                  ELSE
                                    CostCenterDim := '';

                                  ProjectNo := TempCustLedgEntry."Project No.";
                                  TempCustLedgEntry.CALCFIELDS("Project Description","Project Manager"); // ITERO.KP

                                  ProjectDesc := TempCustLedgEntry."Project Description";
                                  //---4PSSE.MK
                                  IF Employee.GET(TempCustLedgEntry."Project Manager") THEN
                                    ProjectManager := Employee."Full Name"
                                  ELSE
                                    ProjectManager := '';



                                  CustLedgEntryEndingDate := TempCustLedgEntry;
                                  DetailedCustomerLedgerEntry.SETRANGE("Cust. Ledger Entry No.",CustLedgEntryEndingDate."Entry No.");
                                  IF DetailedCustomerLedgerEntry.FINDSET(FALSE,FALSE) THEN
                                    REPEAT
                                      IF (DetailedCustomerLedgerEntry."Entry Type" =
                                          DetailedCustomerLedgerEntry."Entry Type"::"Initial Entry") AND
                                         (CustLedgEntryEndingDate."Posting Date" > EndingDate) AND
                                         (AgingBy <> AgingBy::"Posting Date")
                                      THEN BEGIN
                                        IF CustLedgEntryEndingDate."Document Date" <= EndingDate THEN
                                          DetailedCustomerLedgerEntry."Posting Date" :=
                                            CustLedgEntryEndingDate."Document Date"
                                        ELSE
                                          IF (CustLedgEntryEndingDate."Due Date" <= EndingDate) AND
                                             (AgingBy = AgingBy::"Due Date")
                                          THEN
                                            DetailedCustomerLedgerEntry."Posting Date" :=
                                              CustLedgEntryEndingDate."Due Date"
                                      END;

                                      IF (DetailedCustomerLedgerEntry."Posting Date" <= EndingDate) OR
                                         (TempCustLedgEntry.Open AND
                                          (AgingBy = AgingBy::"Due Date") AND
                                          (CustLedgEntryEndingDate."Due Date" > EndingDate) AND
                                          (CustLedgEntryEndingDate."Posting Date" <= EndingDate)) THEN BEGIN
                                        IF DetailedCustomerLedgerEntry."Entry Type" IN
                                           [DetailedCustomerLedgerEntry."Entry Type"::"Initial Entry",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Unrealized Loss",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Unrealized Gain",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Realized Loss",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Realized Gain",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Discount",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Discount (VAT Excl.)",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Discount (VAT Adjustment)",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Tolerance",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Discount Tolerance",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Tolerance (VAT Excl.)",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Tolerance (VAT Adjustment)",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Discount Tolerance (VAT Excl.)",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Payment Discount Tolerance (VAT Adjustment)",
                                            DetailedCustomerLedgerEntry."Entry Type"::"Credit Restriction"] //**4PS.n
                                        THEN BEGIN
                                          CustLedgEntryEndingDate.Amount := CustLedgEntryEndingDate.Amount + DetailedCustomerLedgerEntry.Amount;
                                          CustLedgEntryEndingDate."Amount (LCY)" :=
                                            CustLedgEntryEndingDate."Amount (LCY)" + DetailedCustomerLedgerEntry."Amount (LCY)";
                                        END;
                                        IF DetailedCustomerLedgerEntry."Posting Date" <= EndingDate THEN BEGIN
                                          CustLedgEntryEndingDate."Remaining Amount" :=
                                            CustLedgEntryEndingDate."Remaining Amount" + DetailedCustomerLedgerEntry.Amount;
                                          CustLedgEntryEndingDate."Remaining Amt. (LCY)" :=
                                            CustLedgEntryEndingDate."Remaining Amt. (LCY)" + DetailedCustomerLedgerEntry."Amount (LCY)";
                                        END;
                                      END;
                                    UNTIL DetailedCustomerLedgerEntry.NEXT = 0;

                                  IF CustLedgEntryEndingDate."Remaining Amount" = 0 THEN
                                    CurrReport.SKIP;

                                  CASE AgingBy OF
                                    AgingBy::"Due Date":
                                      PeriodIndex := GetPeriodIndex(CustLedgEntryEndingDate."Due Date");
                                    AgingBy::"Posting Date":
                                      PeriodIndex := GetPeriodIndex(CustLedgEntryEndingDate."Posting Date");
                                    AgingBy::"Document Date":
                                      BEGIN
                                        IF CustLedgEntryEndingDate."Document Date" > EndingDate THEN BEGIN
                                          CustLedgEntryEndingDate."Remaining Amount" := 0;
                                          CustLedgEntryEndingDate."Remaining Amt. (LCY)" := 0;
                                          CustLedgEntryEndingDate."Document Date" := CustLedgEntryEndingDate."Posting Date";
                                        END;
                                        PeriodIndex := GetPeriodIndex(CustLedgEntryEndingDate."Document Date");
                                      END;
                                  END;
                                  CLEAR(AgedCustLedgEntry);
                                  AgedCustLedgEntry[PeriodIndex]."Remaining Amount" := CustLedgEntryEndingDate."Remaining Amount";
                                  AgedCustLedgEntry[PeriodIndex]."Remaining Amt. (LCY)" := CustLedgEntryEndingDate."Remaining Amt. (LCY)";
                                  TotalCustLedgEntry[PeriodIndex]."Remaining Amount" += CustLedgEntryEndingDate."Remaining Amount";
                                  TotalCustLedgEntry[PeriodIndex]."Remaining Amt. (LCY)" += CustLedgEntryEndingDate."Remaining Amt. (LCY)";
                                  GrandTotalCustLedgEntry[PeriodIndex]."Remaining Amt. (LCY)" += CustLedgEntryEndingDate."Remaining Amt. (LCY)";
                                  TotalCustLedgEntry[1].Amount += CustLedgEntryEndingDate."Remaining Amount";
                                  TotalCustLedgEntry[1]."Amount (LCY)" += CustLedgEntryEndingDate."Remaining Amt. (LCY)";
                                  GrandTotalCustLedgEntry[1]."Amount (LCY)" += CustLedgEntryEndingDate."Remaining Amt. (LCY)";

                                  CommentLine.RESET;
                                  IF TempCustLedgEntry."Document Type" = TempCustLedgEntry."Document Type"::Invoice THEN
                                    CommentLine.SETRANGE("Document Type", CommentLine."Document Type"::"Posted Invoice");
                                  IF TempCustLedgEntry."Document Type" = TempCustLedgEntry."Document Type"::"Credit Memo" THEN
                                    CommentLine.SETRANGE("Document Type", CommentLine."Document Type"::"Posted Credit Memo");
                                  CommentLine.SETRANGE("No.", TempCustLedgEntry."Document No.");
                                  CommentLine.SETRANGE("Document Line No.",0);
                                  IF CommentLine.FINDLAST THEN
                                    CLEComment := CommentLine.Comment
                                  ELSE
                                    CLEComment := '';

                                  IF PrintToExcel THEN
                                    MakeExcelDataBody;
                                END;

               OnPostDataItem=BEGIN
                                IF NOT PrintAmountInLCY THEN
                                  UpdateCurrencyTotals;
                              END;
                               }

    { 80  ;3   ;Column  ;Name1_Cust          ;
               IncludeCaption=Yes;
               SourceExpr=Customer.Name }

    { 81  ;3   ;Column  ;No_Cust             ;
               IncludeCaption=Yes;
               SourceExpr=Customer."No." }

    { 58  ;3   ;Column  ;CLEEndDateRemAmtLCY ;
               SourceExpr=CustLedgEntryEndingDate."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 59  ;3   ;Column  ;AgedCLE1RemAmtLCY   ;
               SourceExpr=AgedCustLedgEntry[1]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 60  ;3   ;Column  ;AgedCLE2RemAmtLCY   ;
               SourceExpr=AgedCustLedgEntry[2]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 61  ;3   ;Column  ;AgedCLE3RemAmtLCY   ;
               SourceExpr=AgedCustLedgEntry[3]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 62  ;3   ;Column  ;AgedCLE4RemAmtLCY   ;
               SourceExpr=AgedCustLedgEntry[4]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 63  ;3   ;Column  ;AgedCLE5RemAmtLCY   ;
               SourceExpr=AgedCustLedgEntry[5]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 65  ;3   ;Column  ;CLEEndDateAmtLCY    ;
               SourceExpr=CustLedgEntryEndingDate."Amount (LCY)";
               AutoFormatType=1 }

    { 66  ;3   ;Column  ;CLEEndDueDate       ;
               SourceExpr=FORMAT(CustLedgEntryEndingDate."Due Date") }

    { 67  ;3   ;Column  ;CLEEndDateDocNo     ;
               SourceExpr=CustLedgEntryEndingDate."Document No." }

    { 68  ;3   ;Column  ;CLEDocType          ;
               SourceExpr=FORMAT(CustLedgEntryEndingDate."Document Type") }

    { 69  ;3   ;Column  ;CLEPostingDate      ;
               SourceExpr=FORMAT(CustLedgEntryEndingDate."Posting Date") }

    { 89  ;3   ;Column  ;AgedCLE5TempRemAmt  ;
               SourceExpr=AgedCustLedgEntry[5]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 90  ;3   ;Column  ;AgedCLE4TempRemAmt  ;
               SourceExpr=AgedCustLedgEntry[4]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 91  ;3   ;Column  ;AgedCLE3TempRemAmt  ;
               SourceExpr=AgedCustLedgEntry[3]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 92  ;3   ;Column  ;AgedCLE2TempRemAmt  ;
               SourceExpr=AgedCustLedgEntry[2]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 93  ;3   ;Column  ;AgedCLE1TempRemAmt  ;
               SourceExpr=AgedCustLedgEntry[1]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 94  ;3   ;Column  ;RemAmt_CLEEndDate   ;
               SourceExpr=CustLedgEntryEndingDate."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 95  ;3   ;Column  ;CLEEndDate          ;
               SourceExpr=CustLedgEntryEndingDate.Amount;
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 82  ;3   ;Column  ;Name_Cust           ;
               SourceExpr=STRSUBSTNO(Text005,Customer.Name) }

    { 83  ;3   ;Column  ;TotalCLE1AmtLCY     ;
               SourceExpr=TotalCustLedgEntry[1]."Amount (LCY)";
               AutoFormatType=1 }

    { 84  ;3   ;Column  ;TotalCLE1RemAmtLCY  ;
               SourceExpr=TotalCustLedgEntry[1]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 85  ;3   ;Column  ;TotalCLE2RemAmtLCY  ;
               SourceExpr=TotalCustLedgEntry[2]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 86  ;3   ;Column  ;TotalCLE3RemAmtLCY  ;
               SourceExpr=TotalCustLedgEntry[3]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 87  ;3   ;Column  ;TotalCLE4RemAmtLCY  ;
               SourceExpr=TotalCustLedgEntry[4]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 88  ;3   ;Column  ;TotalCLE5RemAmtLCY  ;
               SourceExpr=TotalCustLedgEntry[5]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 100 ;3   ;Column  ;CurrrencyCode       ;
               SourceExpr=CurrencyCode;
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 102 ;3   ;Column  ;TotalCLE5RemAmt     ;
               SourceExpr=TotalCustLedgEntry[5]."Remaining Amount";
               AutoFormatType=1 }

    { 103 ;3   ;Column  ;TotalCLE4RemAmt     ;
               SourceExpr=TotalCustLedgEntry[4]."Remaining Amount";
               AutoFormatType=1 }

    { 104 ;3   ;Column  ;TotalCLE3RemAmt     ;
               SourceExpr=TotalCustLedgEntry[3]."Remaining Amount";
               AutoFormatType=1 }

    { 105 ;3   ;Column  ;TotalCLE2RemAmt     ;
               SourceExpr=TotalCustLedgEntry[2]."Remaining Amount";
               AutoFormatType=1 }

    { 106 ;3   ;Column  ;TotalCLE1RemAmt     ;
               SourceExpr=TotalCustLedgEntry[1]."Remaining Amount";
               AutoFormatType=1 }

    { 107 ;3   ;Column  ;TotalCLE1Amt        ;
               SourceExpr=TotalCustLedgEntry[1].Amount;
               AutoFormatType=1 }

    { 1010;3   ;Column  ;TotalCheck          ;
               SourceExpr=CustFilterCheck }

    { 1011;3   ;Column  ;GrandTotalCLE1AmtLCY;
               SourceExpr=GrandTotalCustLedgEntry[1]."Amount (LCY)";
               AutoFormatType=1 }

    { 1021;3   ;Column  ;GrandTotalCLE5PctRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[5]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 1019;3   ;Column  ;GrandTotalCLE3PctRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[3]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 1018;3   ;Column  ;GrandTotalCLE2PctRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[2]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 1017;3   ;Column  ;GrandTotalCLE1PctRemAmtLCY;
               SourceExpr=Pct(GrandTotalCustLedgEntry[1]."Remaining Amt. (LCY)",GrandTotalCustLedgEntry[1]."Amount (LCY)") }

    { 1016;3   ;Column  ;GrandTotalCLE5RemAmtLCY;
               SourceExpr=GrandTotalCustLedgEntry[5]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 1015;3   ;Column  ;GrandTotalCLE4RemAmtLCY;
               SourceExpr=GrandTotalCustLedgEntry[4]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 1014;3   ;Column  ;GrandTotalCLE3RemAmtLCY;
               SourceExpr=GrandTotalCustLedgEntry[3]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 1013;3   ;Column  ;GrandTotalCLE2RemAmtLCY;
               SourceExpr=GrandTotalCustLedgEntry[2]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 1012;3   ;Column  ;GrandTotalCLE1RemAmtLCY;
               SourceExpr=GrandTotalCustLedgEntry[1]."Remaining Amt. (LCY)";
               AutoFormatType=1 }

    { 1100285500;3;Column;CompanyDim         ;
               SourceExpr=CompanyDim }

    { 1100285501;3;Column;RegionDim          ;
               SourceExpr=RegionDim }

    { 1100285502;3;Column;CostCenterDim      ;
               SourceExpr=CostCenterDim }

    { 1100285503;3;Column;ProjectNo          ;
               SourceExpr=ProjectNo }

    { 1100285504;3;Column;ProjectDesc        ;
               SourceExpr=ProjectDesc }

    { 1100285000;3;Column;ProjectManager     ;
               SourceExpr=ProjectManager }

    { 8052;    ;DataItem;CurrencyTotals      ;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number)
                                 WHERE(Number=FILTER(1..));
               OnAfterGetRecord=BEGIN
                                  IF Number = 1 THEN BEGIN
                                    IF NOT TempCurrency2.FINDSET(FALSE,FALSE) THEN
                                      CurrReport.BREAK;
                                  END ELSE
                                    IF TempCurrency2.NEXT = 0 THEN
                                      CurrReport.BREAK;

                                  CLEAR(AgedCustLedgEntry);
                                  TempCurrencyAmount.SETRANGE("Currency Code",TempCurrency2.Code);
                                  IF TempCurrencyAmount.FINDSET(FALSE,FALSE) THEN
                                    REPEAT
                                      IF TempCurrencyAmount.Date <> 99991231D THEN
                                        AgedCustLedgEntry[GetPeriodIndex(TempCurrencyAmount.Date)]."Remaining Amount" :=
                                          TempCurrencyAmount.Amount
                                      ELSE
                                        AgedCustLedgEntry[6]."Remaining Amount" := TempCurrencyAmount.Amount;
                                    UNTIL TempCurrencyAmount.NEXT = 0;
                                END;
                                 }

    { 132 ;1   ;Column  ;CurrNo              ;
               SourceExpr=Number = 1 }

    { 117 ;1   ;Column  ;TempCurrCode        ;
               SourceExpr=TempCurrency2.Code;
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 119 ;1   ;Column  ;AgedCLE6RemAmt      ;
               SourceExpr=AgedCustLedgEntry[6]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 120 ;1   ;Column  ;AgedCLE1RemAmt      ;
               SourceExpr=AgedCustLedgEntry[1]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 121 ;1   ;Column  ;AgedCLE2RemAmt      ;
               SourceExpr=AgedCustLedgEntry[2]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 122 ;1   ;Column  ;AgedCLE3RemAmt      ;
               SourceExpr=AgedCustLedgEntry[3]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 123 ;1   ;Column  ;AgedCLE4RemAmt      ;
               SourceExpr=AgedCustLedgEntry[4]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 124 ;1   ;Column  ;AgedCLE5RemAmt      ;
               SourceExpr=AgedCustLedgEntry[5]."Remaining Amount";
               AutoFormatType=1;
               AutoFormatExpr=CurrencyCode }

    { 125 ;1   ;Column  ;CurrSpecificationCptn;
               SourceExpr=CurrSpecificationCptnLbl }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
      OnOpenPage=BEGIN
                   PrintToExcel := FALSE;
                 END;

    }
    CONTROLS
    {
      { 4   ;0   ;Container ;
                  ContainerType=ContentArea }

      { 2   ;1   ;Group     ;
                  CaptionML=[ENU=Options;
                             NOR=Alternativer;
                             SVE=Alternativ] }

      { 1   ;2   ;Field     ;
                  Name=AgedAsOf;
                  CaptionML=[ENU=Aged As Of;
                             NOR=Aldersfordelt per;
                             SVE=èlder fr.o.m.];
                  SourceExpr=EndingDate;
                  Visible=false;
                  Editable=false }

      { 3   ;2   ;Field     ;
                  Name=Agingby;
                  CaptionML=[ENU=Aging by;
                             NOR=Aldersfordeling pÜ basis av;
                             SVE=èlder per];
                  OptionCaptionML=[ENU=Due Date,Posting Date,Document Date;
                                   NOR=Forfallsdato,Bokfõringsdato,Bilagsdato;
                                   SVE=Fîrfallodatum,Bokfîringsdatum,Dokumentdatum];
                  SourceExpr=AgingBy;
                  Visible=false;
                  Editable=false }

      { 7   ;2   ;Field     ;
                  Name=PeriodLength;
                  CaptionML=[ENU=Period Length;
                             NOR=Periodelengde;
                             SVE=Period];
                  SourceExpr=PeriodLength;
                  Visible=FALSE }

      { 9   ;2   ;Field     ;
                  Name=AmountsinLCY;
                  CaptionML=[ENU=Print Amounts in LCY;
                             NOR=Skriv ut belõp i NOK;
                             SVE=Skriv ut belopp i BVA];
                  SourceExpr=PrintAmountInLCY }

      { 11  ;2   ;Field     ;
                  CaptionML=[ENU=Print Details;
                             NOR=Skriv ut spesifikasjoner;
                             SVE=Skriv ut detaljer];
                  SourceExpr=PrintDetails;
                  Visible=FALSE }

      { 15  ;2   ;Field     ;
                  CaptionML=[ENU=Heading Type;
                             NOR=Overskriftstype;
                             SVE=Rubriktyp];
                  OptionCaptionML=[ENU=Date Interval,Number of Days;
                                   NOR=Datointervall,Antall dager;
                                   SVE=Datumintervall,Antal dagar];
                  SourceExpr=HeadingType;
                  Visible=false;
                  Editable=false }

      { 1100285500;2;Field  ;
                  CaptionML=[ENU=Dimension;
                             NOR=Dimensjon;
                             SVE=Dimension];
                  SourceExpr=DimensionCode;
                  OnLookup=VAR
                             Dimension@1100285000 : Record 348;
                           BEGIN
                             IF PAGE.RUNMODAL(0, Dimension) = ACTION::LookupOK THEN
                               DimensionCode := Dimension.Code;
                             RequestOptionsPage.UPDATE;
                           END;
                            }

      { 1100285501;2;Field  ;
                  CaptionML=[ENU=Dimension Value;
                             NOR=Dimensjonsverdi;
                             SVE=DimensionsvÑrde];
                  SourceExpr=DimensionValueCode;
                  OnLookup=VAR
                             DimensionValue@1100285000 : Record 349;
                           BEGIN
                             DimensionValue.SETRANGE("Dimension Code", DimensionCode);
                             IF PAGE.RUNMODAL(0, DimensionValue) = ACTION::LookupOK THEN
                               DimensionValueCode := DimensionValue.Code;
                             RequestOptionsPage.UPDATE;
                           END;
                            }

      { 1100285503;2;Field  ;
                  CaptionML=[ENU=Show Without Totals;
                             NOR=Vis uten totaler;
                             SVE=Visa utan totaler];
                  SourceExpr=ShowWithoutTotals;
                  Visible=FALSE }

    }
  }
  LABELS
  {
    { 74  ;BalanceCaption      ;CaptionML=[ENU=Balance;
                                           NOR=Saldo;
                                           SVE=Saldo] }
  }
  CODE
  {
    VAR
      GLSetup@1011 : Record 98;
      TempCustLedgEntry@1009 : TEMPORARY Record 21;
      CustLedgEntryEndingDate@1013 : Record 21;
      TotalCustLedgEntry@1014 : ARRAY [7] OF Record 21;
      GrandTotalCustLedgEntry@1018 : ARRAY [7] OF Record 21;
      AgedCustLedgEntry@1022 : ARRAY [8] OF Record 21;
      TempCurrency@1010 : TEMPORARY Record 4;
      TempCurrency2@1030 : TEMPORARY Record 4;
      TempCurrencyAmount@1029 : TEMPORARY Record 264;
      ExcelBuf@1033 : TEMPORARY Record 370;
      DetailedCustomerLedgerEntry@1102601000 : Record 379;
      TmpProject@1000000000 : TEMPORARY Record 11072003;
      Project@1000000003 : Record 11072003;
      Employee@1100285001 : Record 5200;
      CommentLine@1100285005 : Record 44;
      Window@1100285006 : Dialog;
      CurrencyCode@1000000014 : Code[10];
      CustFilter@1000 : Text[250];
      ProjFilter@1000000002 : Text;
      PrintAmountInLCY@1000000011 : Boolean;
      PrintDetails@1000000010 : Boolean;
      NewPagePercustomer@1027 : Boolean;
      PrintToExcel@1000000009 : Boolean;
      CustFilterCheck@1000000008 : Boolean;
      PeriodStartDate@1004 : ARRAY [7] OF Date;
      PeriodEndDate@1005 : ARRAY [7] OF Date;
      EndingDate@1000000016 : Date;
      HeaderText@1006 : ARRAY [7] OF Text[30];
      Text000@1007 : TextConst 'ENU=Not Due;NOR=Ikke forfalt;SVE=Inte fîrfallit';
      Text001@1008 : TextConst 'ENU=Before;NOR=Fõr;SVE=Fîre';
      Text002@1020 : TextConst 'ENU=days;NOR=dager;SVE=dagar';
      Text003@1021 : TextConst 'ENU=More than;NOR=Mer enn;SVE=Mer Ñn';
      Text004@1017 : TextConst 'ENU=Aged by %1;NOR=Aldersford. per %1;SVE=èlder per %1';
      Text005@1023 : TextConst 'ENU=Total for %1;NOR=Totalt for %1;SVE=Total fîr %1';
      Text006@1024 : TextConst 'ENU=Aged as of %1;NOR=Aldersfordelt per %1;SVE=èlder fr.o.m. %1';
      Text007@1025 : TextConst 'ENU=Aged by %1;NOR=Aldersford. per %1;SVE=èlder per %1';
      Text008@1026 : TextConst 'ENU=All Amounts in LCY;NOR=Alle belõp i NOK;SVE=Alla belopp i BVA';
      NumberOfCurrencies@1028 : Integer;
      Text009@1031 : TextConst 'ENU=Due Date,Posting Date,Document Date;NOR=Forfallsdato,Bokfõringsdato,Bilagsdato;SVE=Fîrfallodatum,Bokfîringsdatum,Dokumentdatum';
      Text010@1032 : TextConst 'ENU=The Date Formula %1 cannot be used. Try to restate it. E.g. 1M+CM instead of CM+1M.;NOR=Datoformelen %1 kan ikke brukes. Angi ny formel, f. eks. 1M+LM i stedet for LM+1M.;SVE=Datumformeln %1 kan inte anvÑndas. Fîrsîk starta om. Dvs. 1M+CM istÑllet fîr CM+1M.';
      PageGroupNo@1035 : Integer;
      NextPageGroupNo@1036 : Integer;
      Text011@1046 : TextConst 'ENU=Data;NOR=Data;SVE=Data';
      Text012@1045 : TextConst 'ENU=Aged Accounts Receivable;NOR=Aldersford. saldoliste - kunde;SVE=èldersanalys av kundfordringar';
      Text013@1044 : TextConst 'ENU=Company Name;NOR=Selskapsnavn;SVE=Fîretagsnamn';
      Text014@1043 : TextConst 'ENU=Report No.;NOR=Rapportnr.;SVE=Rapportnr';
      Text015@1042 : TextConst 'ENU=Report Name;NOR=Rapportnavn;SVE=Rapportnamn';
      Text016@1041 : TextConst 'ENU=User ID;NOR=Bruker-ID;SVE=AnvÑndar-ID';
      Text017@1040 : TextConst 'ENU=Date;NOR=Dato;SVE=Datum';
      Text018@1039 : TextConst 'ENU=Customer Filters;NOR=Kundefiltere;SVE=Kundfilter';
      Text019@1038 : TextConst 'ENU=Cust. Ledger Entry Filters;NOR=Filtere for kundeposter;SVE=Kundreskontrafilter';
      Text020@1100285002 : TextConst 'ENU=Project Filters;SVE=Projektfilter';
      Text021@1100285003 : TextConst 'ENU=Comment;SVE=Kommentar';
      Text032@1059 : TextConst '@@@=Negating the period length: %1 is the period length;ENU=-%1;NOR=-%1;SVE=-%1';
      ProcessingText@1100285007 : TextConst 'ENU=Processing...;SVE=Bearbeta...';
      AgedAccReceivableCptnLbl@5173 : TextConst 'ENU=Aged Accounts Receivable;NOR=Aldersford. saldoliste - kunde;SVE=èldersfîrdelad kundreskontra';
      CurrReportPageNoCptnLbl@6074 : TextConst 'ENU=Page;NOR=Side;SVE=Sida';
      AllAmtinLCYCptnLbl@8265 : TextConst 'ENU=All Amounts in LCY;NOR=Alle belõp i NOK;SVE=Alla belopp i BVA';
      AgedOverdueAmtCptnLbl@2837 : TextConst 'ENU=Aged Overdue Amounts;NOR=Aldersfordeling av forfalte belõp;SVE=èldersfîrdelat';
      CLEEndDateAmtLCYCptnLbl@3633 : TextConst 'ENU="Original Amount ";NOR=Opprinnelig belõp;SVE="Ursprungligt belopp "';
      CLEEndDateDueDateCptnLbl@1514 : TextConst 'ENU=Due Date;NOR=Forfallsdato;SVE=F¬îrfallodatum';
      CLEEndDateDocNoCptnLbl@1511 : TextConst 'ENU=Document No.;NOR=Bilagsnr.;SVE=Verifikationsnr';
      CLEEndDatePstngDateCptnLbl@4115 : TextConst 'ENU=Posting Date;NOR=Bokfõringsdato;SVE=Bokfîringsdatum';
      CLEEndDateDocTypeCptnLbl@7645 : TextConst 'ENU=Document Type;NOR=Bilagstype;SVE=Dokumenttyp';
      OriginalAmtCptnLbl@4991 : TextConst 'ENU=Currency Code;NOR=Valutakode;SVE=Valutakod';
      TotalLCYCptnLbl@4055 : TextConst 'ENU=Total (LCY);NOR=Totalt (NOK);SVE=Total (BVA)';
      CurrSpecificationCptnLbl@3382 : TextConst 'ENU=Currency Specification;NOR=Valutaspesifikasjon;SVE=Valutaspecifikation';
      HeadingType@1000000015 : 'Date Interval,Number of Days';
      AgingBy@1000000013 : 'Due Date,Posting Date,Document Date';
      PeriodLength@1000000012 : DateFormula;
      "***4PSSE***"@1100285505 : Integer;
      DimensionCode@1100285504 : Code[20];
      DimensionValueCode@1100285503 : Code[20];
      CompanyDim@1000000007 : Text;
      RegionDim@1000000006 : Text;
      CostCenterDim@1000000005 : Code[20];
      ProjectNo@1000000004 : Code[20];
      FilterCostCenter@1100285502 : Text;
      DimensionFilter@1100285500 : Text;
      ProjectDesc@1100285506 : Text[50];
      "***4PSE"@1100285501 : TextConst;
      CompanyCaption@1100285511 : TextConst 'ENU=Company;NOR=Selskap;SVE=Fîretag';
      RegionCaption@1100285512 : TextConst 'ENU=Region;NOR=Region;SVE=Region';
      CostCenterCaption@1100285513 : TextConst 'ENU=Cost Center;NOR=Kostsenter;SVE=Kostnads- stÑlle';
      ProjectNoCaption@1100285514 : TextConst 'ENU=Project No.;NOR=Prosjektnr;SVE=Projektnr';
      ProjectDescCaption@1100285515 : TextConst 'ENU=Project Description;NOR=Prosjektbeskrivelse;SVE=Projektbeskrivning';
      ProjectManager@1100285000 : Text;
      CLEComment@1100285004 : Text;
      ShowWithoutTotals@1100285516 : Boolean;
      UseProjectFilter@1000000001 : Boolean;
      BlocketForReminderLbl@1000000017 : TextConst 'ENU=Blocked For Reminder;NOR=Sperret for pÜminnelse;SVE=KravspÑrr';
      "***ITERO**"@1100285100 : Integer;
      CompanyInfo@1100285101 : Record 79;

    LOCAL PROCEDURE CalcDates@5();
    VAR
      i@1000 : Integer;
      PeriodLength2@1001 : DateFormula;
      PeriodLengths2@1000000000 : ARRAY [7] OF DateFormula;
    BEGIN

      EVALUATE(PeriodLengths2[1],'-14D');
      EVALUATE(PeriodLengths2[2],'-16D');
      EVALUATE(PeriodLengths2[3],'-30D');
      EVALUATE(PeriodLengths2[4],'-30D');
      EVALUATE(PeriodLengths2[5],'-90D');
      EVALUATE(PeriodLengths2[6],'-90D');

      IF AgingBy = AgingBy::"Due Date" THEN BEGIN
        PeriodEndDate[1] := 99991231D;
        PeriodStartDate[1] := EndingDate + 1;
      END ELSE BEGIN
        PeriodEndDate[1] := EndingDate;
        PeriodStartDate[1] := CALCDATE(PeriodLengths2[1],EndingDate + 1);
      END;

      FOR i := 2 TO ARRAYLEN(PeriodEndDate) DO BEGIN
        PeriodEndDate[i] := PeriodStartDate[i - 1] - 1;
        PeriodStartDate[i] := CALCDATE(PeriodLengths2[i-1],PeriodEndDate[i] + 1);
      END;
      PeriodStartDate[i] := 0D;



      FOR i := 1 TO ARRAYLEN(PeriodEndDate) DO
        IF PeriodEndDate[i] < PeriodStartDate[i] THEN
          ERROR(Text010,PeriodLength);
    END;

    LOCAL PROCEDURE CreateHeadings@10();
    VAR
      i@1000 : Integer;
    BEGIN
      IF AgingBy = AgingBy::"Due Date" THEN BEGIN
        HeaderText[1] := Text000;
        i := 2;
      END ELSE
        i := 1;
      WHILE i < ARRAYLEN(PeriodEndDate) DO BEGIN
        IF HeadingType = HeadingType::"Date Interval" THEN
          HeaderText[i] := STRSUBSTNO('%1..%2',PeriodStartDate[i],PeriodEndDate[i])
        ELSE
          HeaderText[i] :=
            STRSUBSTNO('%1 - %2 %3',EndingDate - PeriodEndDate[i] + 1,EndingDate - PeriodStartDate[i] + 1,Text002);
        i := i + 1;
      END;
      IF HeadingType = HeadingType::"Date Interval" THEN
        HeaderText[i] := STRSUBSTNO('%1 %2',Text001,PeriodStartDate[i - 1])
      ELSE
        HeaderText[i] := STRSUBSTNO('%1+ %2',EndingDate - PeriodStartDate[i - 1] + 2,Text002);
    END;

    LOCAL PROCEDURE InsertTemp@1(VAR CustLedgEntry@1040000 : Record 21);
    VAR
      Currency@1000 : Record 4;
    BEGIN
      WITH TempCustLedgEntry DO BEGIN
        IF GET(CustLedgEntry."Entry No.") THEN
          EXIT;
        TempCustLedgEntry := CustLedgEntry;
        INSERT;
        IF PrintAmountInLCY THEN BEGIN
          CLEAR(TempCurrency);
          TempCurrency."Amount Rounding Precision" := GLSetup."Amount Rounding Precision";
          IF TempCurrency.INSERT THEN;
          EXIT;
        END;
        IF TempCurrency.GET("Currency Code") THEN
          EXIT;
        IF "Currency Code" <> '' THEN
          Currency.GET("Currency Code")
        ELSE BEGIN
          CLEAR(Currency);
          Currency."Amount Rounding Precision" := GLSetup."Amount Rounding Precision";
        END;
        TempCurrency := Currency;
        TempCurrency.INSERT;
      END;
    END;

    LOCAL PROCEDURE GetPeriodIndex@8(Date@1040000 : Date) : Integer;
    VAR
      i@1000 : Integer;
    BEGIN
      FOR i := 1 TO ARRAYLEN(PeriodEndDate) DO
        IF Date IN [PeriodStartDate[i]..PeriodEndDate[i]] THEN
          EXIT(i);
    END;

    LOCAL PROCEDURE Pct@2(a@1000 : Decimal;b@1001 : Decimal) : Text[30];
    BEGIN
      IF b <> 0 THEN
        EXIT(FORMAT(ROUND(100 * a / b,0.1),0,'<Sign><Integer><Decimals,2>') + '%');
    END;

    LOCAL PROCEDURE UpdateCurrencyTotals@7();
    VAR
      i@1000 : Integer;
    BEGIN
      TempCurrency2.Code := CurrencyCode;
      IF TempCurrency2.INSERT THEN;
      WITH TempCurrencyAmount DO BEGIN
        FOR i := 1 TO ARRAYLEN(TotalCustLedgEntry) DO BEGIN
          "Currency Code" := CurrencyCode;
          Date := PeriodStartDate[i];
          IF FIND THEN BEGIN
            Amount := Amount + TotalCustLedgEntry[i]."Remaining Amount";
            MODIFY;
          END ELSE BEGIN
            "Currency Code" := CurrencyCode;
            Date := PeriodStartDate[i];
            Amount := TotalCustLedgEntry[i]."Remaining Amount";
            INSERT;
          END;
        END;
        "Currency Code" := CurrencyCode;
        Date := 99991231D;
        IF FIND THEN BEGIN
          Amount := Amount + TotalCustLedgEntry[1].Amount;
          MODIFY;
        END ELSE BEGIN
          "Currency Code" := CurrencyCode;
          Date := 99991231D;
          Amount := TotalCustLedgEntry[1].Amount;
          INSERT;
        END;
      END;
    END;

    PROCEDURE MakeExcelInfo@9();
    BEGIN
      ExcelBuf.SetUseInfoSheet;
      ExcelBuf.AddInfoColumn(FORMAT(Text013),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(FORMAT(CompanyInfo.Name),FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text015),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(FORMAT(Text012),FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text014),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(REPORT::"Aged Accounts Receivable",FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Number);
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text016),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(USERID,FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text017),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(TODAY,FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Date);
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text018),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(Customer.GETFILTERS,FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text019),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn("Cust. Ledger Entry".GETFILTERS,FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);

      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(Text020),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(Job.GETFILTERS,FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);

      IF PrintAmountInLCY THEN BEGIN
        ExcelBuf.NewRow;
        ExcelBuf.AddInfoColumn(FORMAT(Text008),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
        ExcelBuf.AddInfoColumn(PrintAmountInLCY,FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      END;
      ExcelBuf.NewRow;
      ExcelBuf.AddInfoColumn(FORMAT(COPYSTR(Text004,1,7)),FALSE,TRUE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddInfoColumn(FORMAT(SELECTSTR(AgingBy + 1,Text009)),FALSE,FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.ClearNewRow;
      MakeExcelDataHeader;
    END;

    LOCAL PROCEDURE MakeExcelDataHeader@6();
    BEGIN
      ExcelBuf.NewRow;
      // ITERO.KP >>
      ExcelBuf.AddColumn(CompanyCaption,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(RegionCaption,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(CostCenterCaption,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      // ITERO.KP <<
      ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Customer No."),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(Customer.FIELDCAPTION(Name),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      // ITERO.KP >>
      ExcelBuf.AddColumn(Job.FIELDCAPTION("Project Manager"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(ProjectNoCaption,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(ProjectDescCaption,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      // ITERO.KP <<
      ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Posting Date"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Document Type"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Document No."),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("External Document No."),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Due Date"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      IF NOT PrintAmountInLCY THEN BEGIN
        ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Currency Code"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
        ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Original Amount"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
        ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Remaining Amount"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      END ELSE BEGIN
        ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Original Amt. (LCY)"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
        ExcelBuf.AddColumn(TempCustLedgEntry.FIELDCAPTION("Remaining Amt. (LCY)"),FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      END;
      // ITERO.KP >>
      ExcelBuf.AddColumn(BlocketForReminderLbl,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[1],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[2],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[3],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[4],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[5],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[6],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(HeaderText[7],FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(Text021,FALSE,'',TRUE,FALSE,TRUE,'',ExcelBuf."Cell Type"::Text);
      // ITERo.KP <<
    END;

    PROCEDURE MakeExcelDataBody@4();
    BEGIN
      ExcelBuf.NewRow;

      // ITERO.KP >>
      ExcelBuf.AddColumn(CompanyDim,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(RegionDim,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(CostCenterDim,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      // ITERO.KP <<
      ExcelBuf.AddColumn(Customer."No.",FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(Customer.Name,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      // ITERO.KP >>
      ExcelBuf.AddColumn(ProjectManager,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(ProjectNo,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(ProjectDesc,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      // ITERO.KP <<
      ExcelBuf.AddColumn(TempCustLedgEntry."Posting Date",FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Date);
      ExcelBuf.AddColumn(FORMAT(TempCustLedgEntry."Document Type"),FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry."Document No.",FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry."External Document No.",FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(TempCustLedgEntry."Due Date",FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Date);
      IF PrintAmountInLCY THEN BEGIN
        ExcelBuf.AddColumn(CustLedgEntryEndingDate."Amount (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
        ExcelBuf.AddColumn(CustLedgEntryEndingDate."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      END ELSE BEGIN
        ExcelBuf.AddColumn(CurrencyCode,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
        ExcelBuf.AddColumn(CustLedgEntryEndingDate.Amount,FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
        ExcelBuf.AddColumn(CustLedgEntryEndingDate."Remaining Amount",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      END;

      // ITERO.KP >>
      ExcelBuf.AddColumn(TempCustLedgEntry."Blocked for Reminder",FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      ExcelBuf.AddColumn(AgedCustLedgEntry[1]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      ExcelBuf.AddColumn(AgedCustLedgEntry[2]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      ExcelBuf.AddColumn(AgedCustLedgEntry[3]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      ExcelBuf.AddColumn(AgedCustLedgEntry[4]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      ExcelBuf.AddColumn(AgedCustLedgEntry[5]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      ExcelBuf.AddColumn(AgedCustLedgEntry[6]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);
      ExcelBuf.AddColumn(AgedCustLedgEntry[7]."Remaining Amt. (LCY)",FALSE,'',FALSE,FALSE,FALSE,'#,##0.00',ExcelBuf."Cell Type"::Number);

      ExcelBuf.AddColumn(CLEComment,FALSE,'',FALSE,FALSE,FALSE,'',ExcelBuf."Cell Type"::Text);
      // ITERo.KP <<
    END;

    PROCEDURE CreateExcelbook@3();
    BEGIN
      //>>170808
      // ExcelBuf.CreateBookAndOpenExcel(CurrReport.OBJECTID(TRUE),Text011,Text012,COMPANYNAME,USERID);
      ExcelBuf.CreateBookAndOpenExcel('',Text011,Text012,COMPANYNAME,USERID);
      //<<170808
      ERROR('');
    END;

    PROCEDURE InitializeRequest@11(NewEndingDate@1000 : Date;NewAgingBy@1001 : Option;NewPeriodLength@1002 : DateFormula;NewPrintAmountInLCY@1003 : Boolean;NewPrintDetails@1004 : Boolean;NewHeadingType@1005 : Option;NewPagePercust@1006 : Boolean;NewPrintToExcel@1007 : Boolean);
    BEGIN
      EndingDate := NewEndingDate;
      AgingBy := NewAgingBy;
      PeriodLength := NewPeriodLength;
      PrintAmountInLCY := NewPrintAmountInLCY;
      PrintDetails := NewPrintDetails;
      HeadingType := NewHeadingType;
      NewPagePercustomer := NewPagePercust;
      PrintToExcel := NewPrintToExcel;
    END;

    BEGIN
    {
      140210 4PSSE.MK (IM REP-010) Copy of report 120 with added columns
      141203 ITERO.MK REP-100-041 Added invoice no and document type to report.
      151019 ITERO.KP Copy of Report 81613
        Processing Only - YES
        Added columns, modified code
      151123 ITERO.KP Added some code, changed some captions
      160511 ITERO.PP Company Name from table "Company Information"
      170808 ITERO.DL pure127570 report crash when calling excel
    }
    END.
  }
  RDLDATA
  {
  }
}

