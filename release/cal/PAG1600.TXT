OBJECT Page 1600 Outlook Mail Engine
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.00;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=[ENU=Outlook Mail Engine;
               NOR=Outlook E-post-motor;
               SVE=Outlook e-postmotor];
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    SourceTable=Table1600;
    DelayedInsert=No;
    PageType=Card;
    SourceTableTemporary=Yes;
    OnOpenPage=VAR
                 OfficeHost@1000 : DotNet "'Microsoft.Dynamics.Nav.ClientExtensions, Version=14.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Client.Hosts.OfficeHost" RUNONCLIENT;
               BEGIN
                 IF OfficeHost.IsAvailable THEN BEGIN
                   OfficeHost := OfficeHost.Create;
                   OfficeMgt.InitializeHost(OfficeHost,OfficeHost.HostType);
                 END;

                 GetDetailsFromFilters;
                 IF Email = 'donotreply@contoso.com' THEN
                   PAGE.RUN(PAGE::"Office Welcome Dlg")
                 ELSE
                   OfficeMgt.InitializeContext(Rec);

                 CurrPage.CLOSE;
                 OfficeMgt.CloseEnginePage;
               END;

    ActionList=ACTIONS
    {
      { 3       ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
    }
  }
  CONTROLS
  {
    { 1   ;    ;Container ;
                Name=Content;
                ContainerType=ContentArea }

    { 7   ;1   ;Group     ;
                Name=Group;
                GroupType=Repeater }

    { 2   ;2   ;Field     ;
                ExtendedDatatype=E-Mail;
                ToolTipML=[ENU=Specifies the email address of the Outlook contact.;
                           NOR=Angir e-postadressen for Outlook-kontakten.;
                           SVE=Anger Outlook-kontaktens e-postadress.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Email }

    { 5   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the display name of the Outlook contact.;
                           NOR=Angir visningsnavnet for Outlook-kontakten.;
                           SVE=Anger Outlook-kontaktens visningsnamn.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Name }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the type that the involved document belongs to.;
                           NOR=Angir typen som det involverte dokumentet tilh›rer.;
                           SVE=Anger vilken typ det ber”rda dokumentet tillh”r.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Document Type" }

    { 8   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the involved document.;
                           NOR=Angir nummeret p† det involverte dokumentet.;
                           SVE=Anger numret p† det ber”rda dokumentet.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Document No." }

  }
  CODE
  {
    VAR
      OfficeMgt@1004 : Codeunit 1630;

    LOCAL PROCEDURE GetDetailsFromFilters@1001();
    VAR
      RecRef@1001 : RecordRef;
      i@1000 : Integer;
    BEGIN
      RecRef.GETTABLE(Rec);
      FOR i := 1 TO RecRef.FIELDCOUNT DO
        ParseFilter(RecRef.FIELDINDEX(i));
      RecRef.SETTABLE(Rec);
    END;

    LOCAL PROCEDURE ParseFilter@1014(FieldRef@1003 : FieldRef);
    VAR
      FilterPrefixRegEx@1002 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.RegularExpressions.Regex";
      SingleQuoteRegEx@1001 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.RegularExpressions.Regex";
      Filter@1000 : Text;
      OptionValue@1004 : Integer;
    BEGIN
      FilterPrefixRegEx := FilterPrefixRegEx.Regex('^@\*([^\\]+)\*$');
      SingleQuoteRegEx := SingleQuoteRegEx.Regex('^''([^\\]+)''$');

      Filter := FieldRef.GETFILTER;
      Filter := FilterPrefixRegEx.Replace(Filter,'$1');
      Filter := SingleQuoteRegEx.Replace(Filter,'$1');
      IF Filter <> '' THEN BEGIN
        IF FORMAT(FieldRef.TYPE) = 'Option' THEN
          WHILE TRUE DO BEGIN
            OptionValue += 1;
            IF UPPERCASE(Filter) = UPPERCASE(SELECTSTR(OptionValue,FieldRef.OPTIONCAPTION)) THEN BEGIN
              FieldRef.VALUE := OptionValue - 1;
              EXIT;
            END;
          END
        ELSE
          FieldRef.VALUE(Filter);
      END;
    END;

    BEGIN
    END.
  }
}

