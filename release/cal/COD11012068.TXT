OBJECT Codeunit 11012068 Multiple Copy Management
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    Permissions=TableData 39=m;
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      Text001@1100485001 : TextConst 'ENU=Unknown Source Table;NOR=Ukjent Kildetabell;SVE=Ok„nd ursprungstabell';
      PurchHeaderRec@1100485037 : Record 38;
      PurchLineRec@1100485036 : Record 39;
      StdPurchRec@1100485043 : Record 174;
      ProjRec@1100485035 : Record 11072003;
      ExtRec@1100485034 : Record 11012004;
      AdjRec@1100485033 : Record 11012003;
      BudgetOptionRec@1100485032 : Record 11012503;
      BudgetLineRec@1100485031 : Record 11012001;
      AdviceRec@1100485030 : Record 11012055;
      ProjCostPlusRec@1100485029 : Record 11012019;
      EstRec@1100485028 : Record 11012151;
      NewEstLineRec@1100528900 : Record 11072072;
      NewRecipeLineRec@1100528902 : Record 11072075;
      BaseRecipeRec@1100528904 : Record 11020581;
      BaseRecipeLineRec@1100528903 : Record 11020582;
      NewPartLineRec@1100528901 : Record 11072076;
      ServOrderRec@1100485021 : Record 11012823;
      ServCostPlusRec@1100485020 : Record 11012825;
      ServiceOrderBudgetLine@1100528600 : Record 11012875;
      RcpCombRec@1100485019 : Record 11012185;
      ItemJnlLineRec@1100525002 : Record 83;
      CurrencyRec@1210190001 : Record 4;
      CurrExchRateRec@1210190000 : Record 330;
      EstimateLineRAW@1100528905 : Record 11125698;
      TempTrackingSpecification@1100528501 : TEMPORARY Record 336;
      MaintSchemeVersionLine@1100528601 : Record 11071744;
      ServSurvObjectAddAct@1100528602 : Record 11071814;
      PurchaseRequisitionLine@1100525005 : Record 11229331;
      ProjectMaterialReqLine@1100525006 : Record 11012526;
      g_int1@1100485018 : Integer;
      g_int2@1100485017 : Integer;
      g_int3@1100485039 : Integer;
      g_int4@1100525000 : Integer;
      g_table@1100485016 : Integer;
      g_code1@1100485015 : Code[20];
      g_code2@1100485014 : Code[20];
      g_code3@1100485013 : Code[20];
      g_code4@1100485012 : Code[20];
      g_code5@1100485011 : Code[20];
      g_code6@1100485010 : Code[20];
      g_code7@1100485009 : Code[20];
      g_code8@1100485008 : Code[20];
      g_code9@1100485000 : Code[20];
      g_date1@1210190002 : Date;
      g_text1@1100528400 : Text[30];
      Gap@1100485007 : Integer;
      RecipeLineGap@1100529600 : Integer;
      MarkNo@1100485006 : Integer;
      CurrLino@1100485005 : Integer;
      PrevLino@1100485004 : Integer;
      AdvicePresent@1100485003 : Boolean;
      RcpQuan@1100485038 : Decimal;
      desc1@1100485042 : Text[100];
      desc2@1100485041 : Text[100];
      Text002@1100409001 : TextConst 'ENU=Get ''Quantity/Amount to Receive'',Get ''Quantity/Amount'';NOR=Hent ''Antall/Bel›p † Motta'', Hent ''Antall/Bel›p'';SVE=H„mta ''Antal/Inlev.belopp'',H„mta ''Antal/Belopp''';
      Text010@1100525001 : TextConst 'ENU=Estimate Part        #1##########\\;NOR=Kalkyledel        #1##########\\;SVE=Kalkyldel        #1##########\\';
      Status@1100525003 : Dialog;
      ShowProgress@1100525004 : Boolean;
      Text041@1100525500 : TextConst 'ENU=First select records;NOR=Marker poster f›rst;SVE=Markera f”rst poster';
      Text042@1210190004 : TextConst 'ENU=Centrale Management Active. Changes are not allowed.;NOR=Sentral styring er aktivert. Endringer tillates ikke.;SVE=Central hantering har aktiverats. Žndringar till†ts ej.';
      CompanyRelationsCentralMgt@1210190009 : Record 11012059;
      CentralDataManagementCU@1210190008 : Codeunit 11012010;
      NavBln@1210190007 : Boolean;
      DiscBln@1210190006 : Boolean;
      DiscGroupBln@1210190010 : Boolean;
      RcpBln@1210190005 : Boolean;
      ErrorFound@1100528500 : Boolean;
      GetQtyToReceive@1100528502 : Boolean;
      SalesHeaderRec@1100528200 : Record 36;
      SalesLineRec@1100528201 : Record 37;
      RequisitionWkshName@1100528202 : Record 245;
      RequisitionLine@1100528203 : Record 246;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;

    [External]
    PROCEDURE CopyNavisionItems@1210190005(VAR MarkedRec@1210190000 : TEMPORARY Record 27);
    VAR
      PlantOrderLine@1210190001 : Record 11012557;
      PlantRequestLineSMF@1100527000 : Record 11125530;
      PlantRequestLine@1100527001 : Record 11020521;
    BEGIN
      IF NOT MarkedRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedRec.COUNT;
      CurrLino := g_int2;
      PrevLino := 0;
      Gap := 0;

      CASE g_table OF
        DATABASE::"Purchase Line":
          BEGIN
            PurchHeaderRec.GET(g_int1, g_code1);

            PurchLineRec.LOCKTABLE;
            PurchLineRec.SETRANGE("Document Type", g_int1);
            PurchLineRec.SETRANGE("Document No.", g_code1);
            IF PurchLineRec.GET(g_int1, g_code1, CurrLino) THEN BEGIN
              PurchLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF PurchLineRec.FINDLAST THEN PrevLino := PurchLineRec."Line No.";
              PurchLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PurchLineRec.FINDLAST THEN
                CurrLino := PurchLineRec."Line No.";
            END;
            REPEAT
              PurchLineRec.INIT;
              PurchLineRec."Document Type" := g_int1;
              PurchLineRec."Document No." := g_code1;
              PurchLineRec."Line No." := CurrLino + Gap;
              CurrLino := PurchLineRec."Line No.";
              PurchLineRec."System-Created Entry" := TRUE;
              PurchLineRec."Posting Date" := PurchHeaderRec."Posting Date";
              PurchLineRec.VALIDATE("Currency Code", PurchHeaderRec."Currency Code");
              PurchLineRec.VALIDATE(Type, PurchLineRec.Type::"G/L Account");
              PurchLineRec."Job No." := g_code3;
              IF PurchLineRec."Job No." = '' THEN
                PurchLineRec."Job No." := PurchHeaderRec."Ship-to Project";
              IF PurchLineRec."Job No." = '' THEN
                PurchLineRec."Job No." := PurchHeaderRec."Job No.";
              PurchLineRec.VALIDATE(Element, g_code2);
              PurchLineRec.VALIDATE("No.", DetermineGLAccount(PurchLineRec."Job No."));
              PurchLineRec.VALIDATE("Service Order No.", g_code4);
              PurchLineRec."Cost Type" := PurchLineRec."Cost Type"::Material;
              PurchLineRec.VALIDATE("Item No.", MarkedRec."No.");
              PurchLineRec.FillMainProject;
              PurchLineRec."Input by" := USERID; //DP00469
              PurchLineRec."Input Date" := TODAY; //DP00469
              PurchLineRec.INSERT;
              PurchLineRec.CreatePurchOrderControl(FALSE);
            UNTIL MarkedRec.NEXT = 0;
          END;

          DATABASE::"Purchase Requisition Line":  //DP01314
          BEGIN
            PurchaseRequisitionLine.LOCKTABLE;
            PurchaseRequisitionLine.SETRANGE("Purchase Requisition No.", g_code1);
            IF PurchaseRequisitionLine.GET(g_code1, CurrLino) THEN BEGIN
              PurchaseRequisitionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF PurchaseRequisitionLine.FINDLAST THEN PrevLino := PurchaseRequisitionLine."Line No.";
              PurchaseRequisitionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PurchaseRequisitionLine.FINDLAST THEN
                CurrLino := PurchaseRequisitionLine."Line No.";
            END;
            REPEAT
              PurchaseRequisitionLine.INIT;
              PurchaseRequisitionLine."Purchase Requisition No." := g_code1;
              PurchaseRequisitionLine."Line No." := CurrLino + Gap;
              CurrLino := PurchaseRequisitionLine."Line No.";
              IF g_code2 <> '' THEN BEGIN
                PurchaseRequisitionLine.VALIDATE("Project No.", g_code2);
                PurchaseRequisitionLine.VALIDATE("Extension Contract", g_code3);
                PurchaseRequisitionLine.VALIDATE(Element, g_code4);
              END;
              IF g_code5 <> '' THEN
                PurchaseRequisitionLine.VALIDATE("Service Order No.", g_code5);
              PurchaseRequisitionLine."Cost Type" := PurchaseRequisitionLine."Cost Type"::Material;
              PurchaseRequisitionLine.VALIDATE("Item No.", MarkedRec."No.");
              PurchaseRequisitionLine.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Item Journal Line":
          BEGIN
            ItemJnlLineRec.LOCKTABLE;
            ItemJnlLineRec.SETRANGE("Journal Template Name",g_code1);
            ItemJnlLineRec.SETRANGE("Journal Batch Name",g_code2);
            IF ItemJnlLineRec.GET(g_code1, g_code2, CurrLino) THEN BEGIN
              ItemJnlLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ItemJnlLineRec.FINDLAST THEN PrevLino := ItemJnlLineRec."Line No.";
              ItemJnlLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ItemJnlLineRec.FINDLAST THEN
                CurrLino := ItemJnlLineRec."Line No.";
            END;
            REPEAT
              ItemJnlLineRec.INIT;
              ItemJnlLineRec."Journal Template Name" := g_code1;
              ItemJnlLineRec."Journal Batch Name" := g_code2;
              ItemJnlLineRec."Line No." := CurrLino + Gap;
              CurrLino := ItemJnlLineRec."Line No.";
              ItemJnlLineRec.INSERT(TRUE);

              ItemJnlLineRec.SetUpNewLine(ItemJnlLineRec);

              ItemJnlLineRec.VALIDATE("Job No.", g_code3);
              ItemJnlLineRec.VALIDATE(Element, g_code7);
              ItemJnlLineRec."Extension Contract" := g_code8;
              ItemJnlLineRec.VALIDATE("Service Order No.", g_code4);
              ItemJnlLineRec."Entry Type" := g_int1;
              ItemJnlLineRec."Document No." := g_code5;
              ItemJnlLineRec."Posting Date" := WORKDATE;
              ItemJnlLineRec."Document Date" := WORKDATE;
              ItemJnlLineRec.VALIDATE("Item No.", MarkedRec."No.");
              ItemJnlLineRec.MODIFY(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Budget Line":
          BEGIN
            BudgetLineRec.LOCKTABLE;
            BudgetLineRec.SETRANGE("Project No.", g_code1);
            BudgetLineRec.SETRANGE("Extension Contract", g_code2);
            BudgetLineRec.SETRANGE(Adjustment, g_code3);
            BudgetLineRec.SETRANGE(Option, '');
            IF BudgetLineRec.GET(g_code1, g_code2, g_code3, '', CurrLino) THEN BEGIN
              BudgetLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BudgetLineRec.FINDLAST THEN PrevLino := BudgetLineRec."Line No.";
              BudgetLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BudgetLineRec.FINDLAST THEN
                CurrLino := BudgetLineRec."Line No.";
            END;
            REPEAT
              BudgetLineRec.INIT;
              BudgetLineRec."Project No." := g_code1;
              BudgetLineRec."Extension Contract" := g_code2;
              BudgetLineRec.Adjustment := g_code3;
              BudgetLineRec.VALIDATE(Element, g_code4);
              BudgetLineRec."Line No." := CurrLino + Gap;
              CurrLino := BudgetLineRec."Line No.";
              IF g_code1 <> '' THEN BEGIN
                ProjRec.GET(g_code1);
                BudgetLineRec."Version Date" := ProjRec."Version Date";
                BudgetLineRec."Department Code" := ProjRec."Global Dimension 1 Code";  //*31927
              END;
              IF g_code2 <> '' THEN BEGIN
                ExtRec.GET(g_code1, g_code2);
                BudgetLineRec."Version Date" := ExtRec."Version Date";
              END;
              IF g_code3 <> '' THEN BEGIN
                AdjRec.GET(g_code1, g_code3);
                BudgetLineRec."Version Date" := AdjRec."Version Date";
              END;
              BudgetLineRec."Cost Type" := BudgetLineRec."Cost Type"::Material;
              BudgetLineRec.VALIDATE("Item No.", MarkedRec."No.");
              BudgetLineRec.FillMainProject;
              BudgetLineRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Project Cost Plus Entry":
          BEGIN
            ProjCostPlusRec.LOCKTABLE;
            ProjCostPlusRec.SETRANGE("Project No.", g_code1);
            ProjCostPlusRec.SETRANGE(Principal, g_code2);
            ProjCostPlusRec.SETRANGE("Commission No.", g_code3);
            ProjCostPlusRec.SETRANGE("Settl.Sheet No.", g_code4);
            IF ProjCostPlusRec.GET(g_code1, g_code2, g_code3, g_code4, CurrLino) THEN BEGIN
              ProjCostPlusRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ProjCostPlusRec.FINDLAST THEN PrevLino := ProjCostPlusRec."Line No.";
              ProjCostPlusRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ProjCostPlusRec.FINDLAST THEN
                CurrLino := ProjCostPlusRec."Line No.";
            END;
            REPEAT
              ProjCostPlusRec.INIT;
              ProjCostPlusRec."Project No." := g_code1;
              ProjCostPlusRec.Principal := g_code2;
              ProjCostPlusRec."Commission No." := g_code3;
              ProjCostPlusRec."Settl.Sheet No." := g_code4;
              ProjCostPlusRec."Line No." := CurrLino + Gap;
              CurrLino := ProjCostPlusRec."Line No.";
              ProjCostPlusRec."Cost Type" := ProjCostPlusRec."Cost Type"::Material;
              ProjCostPlusRec.VALIDATE("Item No.", MarkedRec."No.");
              ProjCostPlusRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Option Budget":
          BEGIN
            BudgetOptionRec.LOCKTABLE;
            BudgetOptionRec.SETRANGE("Project No.", g_code1);
            BudgetOptionRec.SETRANGE("Plot No.", g_code4);
            BudgetOptionRec.SETRANGE("House Model", g_code5);
            BudgetOptionRec.SETRANGE("Main Group", g_code6);
            BudgetOptionRec.SETRANGE(Group, g_code7);
            BudgetOptionRec.SETRANGE("Sub Group", g_code8);
            BudgetOptionRec.SETRANGE(Option, g_code2);
            IF BudgetOptionRec.GET(g_code1, g_code4, g_code5, g_code6, g_code7, g_code8, g_code2, CurrLino) THEN BEGIN
              BudgetOptionRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BudgetOptionRec.FINDLAST THEN PrevLino := BudgetOptionRec."Line No.";
              BudgetOptionRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BudgetOptionRec.FINDLAST THEN
                CurrLino := BudgetOptionRec."Line No.";
            END;
            REPEAT
              BudgetOptionRec.INIT;
              BudgetOptionRec."Project No." := g_code1;
              BudgetOptionRec."Plot No." := g_code4;
              BudgetOptionRec."House Model" := g_code5;
              BudgetOptionRec."Main Group" := g_code6;
              BudgetOptionRec.Group := g_code7;
              BudgetOptionRec."Sub Group" := g_code8;
              BudgetOptionRec.Option := g_code2;
              BudgetOptionRec.VALIDATE(Element, g_code3);
              BudgetOptionRec."Line No." := CurrLino + Gap;
              CurrLino := BudgetOptionRec."Line No.";
              BudgetOptionRec."Cost Type" := BudgetOptionRec."Cost Type"::Material;
              BudgetOptionRec.VALIDATE("Item No.", MarkedRec."No.");
              BudgetOptionRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Part Line":  //DP00381
          BEGIN
            NewPartLineRec.LOCKTABLE;
            NewPartLineRec.SETRANGE("Part Group",g_code6);
            NewPartLineRec.SETRANGE(Part,g_code3);
            IF NewPartLineRec.GET(g_code6, g_code3, CurrLino) THEN BEGIN
              NewPartLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewPartLineRec.FINDLAST THEN PrevLino := NewPartLineRec."Line No.";
              NewPartLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewPartLineRec.FINDLAST THEN
                CurrLino := NewPartLineRec."Line No.";
            END;
            REPEAT
              NewPartLineRec.INIT;
              NewPartLineRec."Part Group" := g_code6;
              NewPartLineRec.Part := g_code3;
              NewPartLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewPartLineRec."Line No.";
              NewPartLineRec.VALIDATE("Item No.", MarkedRec."No.");
              NewPartLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Line":  //DP00381
          BEGIN
            EstRec.GET(g_code1);
            EstRec.TESTFIELD(Fixed, FALSE);

            NewEstLineRec.LOCKTABLE;
            NewEstLineRec.SETRANGE("Estimate No.", g_code1);
            NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
            NewEstLineRec.SETRANGE("Part Group",g_code6);
            NewEstLineRec.SETRANGE(Part,g_code3);
            IF NewEstLineRec.GET(g_code1, g_code2, g_code6, g_code3, CurrLino) THEN BEGIN
              NewEstLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewEstLineRec.FINDLAST THEN PrevLino := NewEstLineRec."Line No.";
              NewEstLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewEstLineRec.FINDLAST THEN
                CurrLino := NewEstLineRec."Line No.";
            END;
            REPEAT
              NewEstLineRec.INIT;
              NewEstLineRec."Estimate No." := g_code1;
              NewEstLineRec."Sub-Estimate No." := g_code2;
              NewEstLineRec."Part Group" := g_code6;
              NewEstLineRec.Part := g_code3;
              NewEstLineRec.InitRecord;
              NewEstLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewEstLineRec."Line No.";
              NewEstLineRec.VALIDATE("Item No.", MarkedRec."No.");
              NewEstLineRec.INSERT(TRUE);
              NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Base Recipe Line":  //DP00381
          BEGIN
            BaseRecipeRec.GET(g_code5, g_code4);
            BaseRecipeRec.TESTFIELD(Fixed, FALSE);

            //mg.sn, 06-06-12: M34512
            IF FPSLicenseManagement.LicenseAndReadPermissionForTable(CompanyRelationsCentralMgt) THEN BEGIN
              CentralDataManagementCU.ItemFormEditable(NavBln, DiscBln, DiscGroupBln, RcpBln);
              IF RcpBln THEN
                ERROR(Text042);
            END;
            //mg.en, 06-06-12: M34512

            BaseRecipeLineRec.LOCKTABLE;
            BaseRecipeLineRec.SETRANGE("Recipe Group",g_code5);
            BaseRecipeLineRec.SETRANGE(Recipe,g_code4);
            IF BaseRecipeLineRec.GET(g_code5, g_code4, CurrLino) THEN BEGIN
              BaseRecipeLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BaseRecipeLineRec.FINDLAST THEN PrevLino := BaseRecipeLineRec."Line No.";
              BaseRecipeLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BaseRecipeLineRec.FINDLAST THEN
                CurrLino := BaseRecipeLineRec."Line No.";
            END;
            REPEAT;
              BaseRecipeLineRec.INIT;
              BaseRecipeLineRec.Recipe := g_code4;
              BaseRecipeLineRec."Recipe Group" := g_code5;
              BaseRecipeLineRec."Line No." := CurrLino + Gap;
              CurrLino := BaseRecipeLineRec."Line No.";
              BaseRecipeLineRec.VALIDATE("Item No.", MarkedRec."No.");
              BaseRecipeLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Recipe Line":  //DP00381
          BEGIN
            IF g_code1 <> '' THEN BEGIN
              EstRec.GET(g_code1);
              EstRec.TESTFIELD(Fixed, FALSE);
            END;

            NewRecipeLineRec.LOCKTABLE;
            NewRecipeLineRec.SETRANGE("Estimate No.",g_code1);
            NewRecipeLineRec.SETRANGE("Sub-Estimate No.",g_code2);
            NewRecipeLineRec.SETRANGE("Part Group",g_code6);
            NewRecipeLineRec.SETRANGE(Part,g_code3);
            NewRecipeLineRec.SETRANGE("Estimate Line",g_int1);
            NewRecipeLineRec.SETRANGE("Recipe Group",g_code5);
            NewRecipeLineRec.SETRANGE(Recipe,g_code4);
            IF NewRecipeLineRec.GET(g_code1, g_code2, g_code6, g_code3, g_int1, g_code5, g_code4, CurrLino) THEN BEGIN
              NewRecipeLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewRecipeLineRec.FINDLAST THEN PrevLino := NewRecipeLineRec."Line No.";
              NewRecipeLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewRecipeLineRec.FINDLAST THEN
                CurrLino := NewRecipeLineRec."Line No.";
            END;
            REPEAT;
              NewRecipeLineRec.INIT;
              NewRecipeLineRec."Estimate No." := g_code1;
              NewRecipeLineRec."Sub-Estimate No." := g_code2;
              NewRecipeLineRec."Part Group" := g_code6;
              NewRecipeLineRec.Part := g_code3;
              NewRecipeLineRec.Recipe := g_code4;
              NewRecipeLineRec."Recipe Group" := g_code5;
              NewRecipeLineRec."Estimate Line" := g_int1;
              NewRecipeLineRec.InitRecord;
              NewRecipeLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewRecipeLineRec."Line No.";
              NewRecipeLineRec.VALIDATE("Item No.", MarkedRec."No.");
              NewRecipeLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Advice Order Line":
          BEGIN
            AdviceRec.LOCKTABLE;
            IF g_int1 <> 0 THEN BEGIN
              AdviceRec.SETRANGE("Record Type", AdviceRec."Record Type"::ServOrder);
              AdviceRec.SETRANGE("Service Order No.", g_code4);
              IF AdviceRec.GET(AdviceRec."Record Type"::ServOrder, '', g_code4, '', CurrLino) THEN  //DP01378
                AdvicePresent := TRUE
              ELSE
                AdvicePresent := FALSE;
            END ELSE BEGIN
              AdviceRec.SETRANGE("Record Type", AdviceRec."Record Type"::Project);
              AdviceRec.SETRANGE("Project No.", g_code1);
              IF AdviceRec.GET(AdviceRec."Record Type"::Project, g_code1, '', '', CurrLino) THEN  //DP01378
                AdvicePresent := TRUE
              ELSE
                AdvicePresent := FALSE;
            END;
            IF AdvicePresent = TRUE THEN BEGIN
              AdviceRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF AdviceRec.FINDLAST THEN PrevLino := AdviceRec."Line No.";
              AdviceRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF AdviceRec.FINDLAST THEN
                CurrLino := AdviceRec."Line No.";
            END;
            REPEAT
              AdviceRec.INIT;
              IF g_int1 <> 0 THEN BEGIN
                AdviceRec."Record Type" := AdviceRec."Record Type"::ServOrder;
                AdviceRec.VALIDATE("Service Order No.", g_code4);
              END ELSE BEGIN
                AdviceRec."Record Type" := AdviceRec."Record Type"::Project;
                AdviceRec."Project No." := g_code1;
                AdviceRec.Element := g_code2;
                AdviceRec."Extension Contract" := g_code3;
              END;
              AdviceRec."Line No." := CurrLino + Gap;
              CurrLino := AdviceRec."Line No.";
              AdviceRec.VALIDATE("Item No.", MarkedRec."No.");
              AdviceRec.InitRecord;  //db, 23-06-09: M15627
              AdviceRec."Purchaser Code" := AdviceRec.GetDefaultPurchaser(g_code1, g_code4);
              AdviceRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Service Order Cost Plus Entry":
          BEGIN
            ServOrderRec.GET(g_code1);

            ServCostPlusRec.LOCKTABLE;
            ServCostPlusRec.SETRANGE("Service Order No.", g_code1);
            IF ServCostPlusRec.GET(g_code1, CurrLino) THEN BEGIN
              ServCostPlusRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServCostPlusRec.FINDLAST THEN PrevLino := ServCostPlusRec."Line No.";
              ServCostPlusRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServCostPlusRec.FINDLAST THEN
                CurrLino := ServCostPlusRec."Line No.";
            END;
            REPEAT
              ServCostPlusRec.INIT;
              ServCostPlusRec.VALIDATE("Service Order No.", g_code1);
              ServCostPlusRec."Line No." := CurrLino + Gap;
              CurrLino := ServCostPlusRec."Line No.";
              ServCostPlusRec."Customer No." := ServOrderRec."Customer No.";
              ServCostPlusRec."Bill-to Customer No." := ServOrderRec."Bill-to Customer No.";
              ServCostPlusRec."Service Location No." := ServOrderRec."Service Location No.";
              ServCostPlusRec."Posting Date" := TODAY;  //db, 05-10-06 (required for discount)
              ServCostPlusRec.VALIDATE("Item No.", MarkedRec."No.");
              ServCostPlusRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Plant Order Line":  //*32459
          BEGIN
            PlantOrderLine.LOCKTABLE;
            PlantOrderLine.SETRANGE("Plant Order No.", g_code1);
            IF PlantOrderLine.GET(g_code1, CurrLino) THEN BEGIN
              PlantOrderLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF PlantOrderLine.FINDLAST THEN PrevLino := PlantOrderLine."Line No.";
              PlantOrderLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PlantOrderLine.FINDLAST THEN
                CurrLino := PlantOrderLine."Line No.";
            END;
            REPEAT
              PlantOrderLine.INIT;
              PlantOrderLine."Plant Order No." := g_code1;
              PlantOrderLine."Line No." := CurrLino + Gap;
              CurrLino := PlantOrderLine."Line No.";
              PlantOrderLine.VALIDATE(Type, PlantOrderLine.Type::Item);
              PlantOrderLine.VALIDATE("Item No.", MarkedRec."No.");
              PlantOrderLine.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Plant Request Line":
          BEGIN
            PlantRequestLine.LOCKTABLE;
            PlantRequestLine.SETRANGE("Plant Request No.", g_code1);
            IF PlantRequestLine.GET(g_code1, CurrLino) THEN BEGIN
              PlantRequestLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF PlantRequestLine.FINDLAST THEN
                PrevLino := PlantRequestLine."Line No.";
              PlantRequestLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PlantRequestLine.FINDLAST THEN
                CurrLino := PlantRequestLine."Line No.";
            END;
            REPEAT
              PlantRequestLine.INIT;
              PlantRequestLine."Plant Request No." := g_code1;
              PlantRequestLine."Line No." := CurrLino + Gap;
              CurrLino := PlantRequestLine."Line No.";
              PlantRequestLine.VALIDATE(Type, PlantRequestLine.Type::Item);
              PlantRequestLine.VALIDATE("Item No.", MarkedRec."No.");
              PlantRequestLine.VALIDATE(Element, g_code2);
              PlantRequestLine.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Plant Request Line (SMF)":
          BEGIN
            PlantRequestLineSMF.LOCKTABLE;
            PlantRequestLineSMF.SETRANGE("Request No.", g_code1);
            IF PlantRequestLineSMF.GET(g_code1, CurrLino) THEN BEGIN
              PlantRequestLineSMF.SETFILTER("Line No.", '<%1', CurrLino);
              IF PlantRequestLineSMF.FINDLAST THEN
                PrevLino := PlantRequestLineSMF."Line No.";
              PlantRequestLineSMF.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PlantRequestLineSMF.FINDLAST THEN
                CurrLino := PlantRequestLineSMF."Line No.";
            END;
            REPEAT
              PlantRequestLineSMF.INIT;
              PlantRequestLineSMF."Request No." := g_code1;
              PlantRequestLineSMF."Line No." := CurrLino + Gap;
              CurrLino := PlantRequestLineSMF."Line No.";
              PlantRequestLineSMF.VALIDATE(Type, PlantRequestLineSMF.Type::Item);
              PlantRequestLineSMF.VALIDATE("Plant/Item", MarkedRec."No.");
              PlantRequestLineSMF.VALIDATE(Element, g_code2);
              PlantRequestLineSMF.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        ELSE
          MESSAGE(Text001);
      END;

      COMMIT;
    END;

    [External]
    PROCEDURE CopyBasicItems@1210190011(VAR MarkedRec@1210190000 : TEMPORARY Record 11012316);
    BEGIN
      IF NOT MarkedRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedRec.COUNT;
      CurrLino := g_int2;
      PrevLino := 0;
      Gap := 0;

      CASE g_table OF
        DATABASE::"Purchase Line":
          BEGIN
            PurchHeaderRec.GET(g_int1, g_code1);

            PurchLineRec.LOCKTABLE;
            PurchLineRec.SETRANGE("Document Type", g_int1);
            PurchLineRec.SETRANGE("Document No.", g_code1);
            IF PurchLineRec.GET(g_int1, g_code1, CurrLino) THEN BEGIN
              PurchLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF PurchLineRec.FINDLAST THEN PrevLino := PurchLineRec."Line No.";
              PurchLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PurchLineRec.FINDLAST THEN
                CurrLino := PurchLineRec."Line No.";
            END;
            REPEAT
              PurchLineRec.INIT;
              PurchLineRec."Document Type" := g_int1;
              PurchLineRec."Document No." := g_code1;
              PurchLineRec."Line No." := CurrLino + Gap;
              CurrLino := PurchLineRec."Line No.";
              PurchLineRec."System-Created Entry" := TRUE;
              PurchLineRec."Posting Date" := PurchHeaderRec."Posting Date";
              PurchLineRec.VALIDATE("Currency Code", PurchHeaderRec."Currency Code");
              PurchLineRec.VALIDATE(Type, PurchLineRec.Type::"G/L Account");
              PurchLineRec."Job No." := g_code3;
              IF PurchLineRec."Job No." = '' THEN
                PurchLineRec."Job No." := PurchHeaderRec."Ship-to Project";
              IF PurchLineRec."Job No." = '' THEN
                PurchLineRec."Job No." := PurchHeaderRec."Job No.";
              PurchLineRec.VALIDATE(Element, g_code2);
              PurchLineRec.VALIDATE("No.", DetermineGLAccount(PurchLineRec."Job No."));
              PurchLineRec.VALIDATE("Service Order No.", g_code4);
              PurchLineRec."Cost Type" := PurchLineRec."Cost Type"::Material;
              PurchLineRec.Manufacturer := MarkedRec.Manufacturer;
              PurchLineRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              PurchLineRec.FillMainProject;
              PurchLineRec."Input by" := USERID; //DP00469
              PurchLineRec."Input Date" := TODAY; //DP00469
              PurchLineRec.INSERT;
              PurchLineRec.CreatePurchOrderControl(FALSE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Purchase Requisition Line":  //DP01314
          BEGIN
            PurchaseRequisitionLine.LOCKTABLE;
            PurchaseRequisitionLine.SETRANGE("Purchase Requisition No.", g_code1);
            IF PurchaseRequisitionLine.GET(g_code1, CurrLino) THEN BEGIN
              PurchaseRequisitionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF PurchaseRequisitionLine.FINDLAST THEN PrevLino := PurchaseRequisitionLine."Line No.";
              PurchaseRequisitionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PurchaseRequisitionLine.FINDLAST THEN
                CurrLino := PurchaseRequisitionLine."Line No.";
            END;
            REPEAT
              PurchaseRequisitionLine.INIT;
              PurchaseRequisitionLine."Purchase Requisition No." := g_code1;
              PurchaseRequisitionLine."Line No." := CurrLino + Gap;
              CurrLino := PurchaseRequisitionLine."Line No.";
              IF g_code2 <> '' THEN BEGIN
                PurchaseRequisitionLine.VALIDATE("Project No.", g_code2);
                PurchaseRequisitionLine.VALIDATE("Extension Contract", g_code3);
                PurchaseRequisitionLine.VALIDATE(Element, g_code4);
              END;
              IF g_code5 <> '' THEN
                PurchaseRequisitionLine.VALIDATE("Service Order No.", g_code5);
              PurchaseRequisitionLine."Cost Type" := PurchaseRequisitionLine."Cost Type"::Material;
              PurchaseRequisitionLine.Manufacturer := MarkedRec.Manufacturer;
              PurchaseRequisitionLine.VALIDATE("Basic Item", MarkedRec."Product Code");
              PurchaseRequisitionLine.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Standard Purchase Line":
          BEGIN
            StdPurchRec.LOCKTABLE;
            StdPurchRec.SETRANGE("Standard Purchase Code", g_code1);
            IF StdPurchRec.GET(g_code1, CurrLino) THEN BEGIN
              StdPurchRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF StdPurchRec.FINDLAST THEN PrevLino := StdPurchRec."Line No.";
              StdPurchRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF StdPurchRec.FINDLAST THEN
                CurrLino := StdPurchRec."Line No.";
            END;
            REPEAT
              StdPurchRec.INIT;
              StdPurchRec."Standard Purchase Code" := g_code1;
              StdPurchRec."Line No." := CurrLino + Gap;
              CurrLino := StdPurchRec."Line No.";
              StdPurchRec.Type := StdPurchRec.Type::Item;
              StdPurchRec.Manufacturer := MarkedRec.Manufacturer;
              StdPurchRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              StdPurchRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Budget Line":
          BEGIN
            BudgetLineRec.LOCKTABLE;
            BudgetLineRec.SETRANGE("Project No.", g_code1);
            BudgetLineRec.SETRANGE("Extension Contract", g_code2);
            BudgetLineRec.SETRANGE(Adjustment, g_code3);
            BudgetLineRec.SETRANGE(Option, '');
            IF BudgetLineRec.GET(g_code1, g_code2, g_code3, '', CurrLino) THEN BEGIN
              BudgetLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BudgetLineRec.FINDLAST THEN PrevLino := BudgetLineRec."Line No.";
              BudgetLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BudgetLineRec.FINDLAST THEN
                CurrLino := BudgetLineRec."Line No.";
            END;
            REPEAT
              BudgetLineRec.INIT;
              BudgetLineRec."Project No." := g_code1;
              BudgetLineRec."Extension Contract" := g_code2;
              BudgetLineRec.Adjustment := g_code3;
              BudgetLineRec.VALIDATE(Element, g_code4);
              BudgetLineRec."Line No." := CurrLino + Gap;
              CurrLino := BudgetLineRec."Line No.";
              IF g_code1 <> '' THEN BEGIN
                ProjRec.GET(g_code1);
                BudgetLineRec."Version Date" := ProjRec."Version Date";
                BudgetLineRec."Department Code" := ProjRec."Global Dimension 1 Code";  //*31927
              END;
              IF g_code2 <> '' THEN BEGIN
                ExtRec.GET(g_code1, g_code2);
                BudgetLineRec."Version Date" := ExtRec."Version Date";
              END;
              IF g_code3 <> '' THEN BEGIN
                AdjRec.GET(g_code1, g_code3);
                BudgetLineRec."Version Date" := AdjRec."Version Date";
              END;
              BudgetLineRec."Cost Type" := BudgetLineRec."Cost Type"::Material;
              BudgetLineRec.Manufacturer := MarkedRec.Manufacturer;
              BudgetLineRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              BudgetLineRec.FillMainProject;
              BudgetLineRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Project Cost Plus Entry":
          BEGIN
            ProjCostPlusRec.LOCKTABLE;
            ProjCostPlusRec.SETRANGE("Project No.", g_code1);
            ProjCostPlusRec.SETRANGE(Principal, g_code2);
            ProjCostPlusRec.SETRANGE("Commission No.", g_code3);
            ProjCostPlusRec.SETRANGE("Settl.Sheet No.", g_code4);
            IF ProjCostPlusRec.GET(g_code1, g_code2, g_code3, g_code4, CurrLino) THEN BEGIN
              ProjCostPlusRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ProjCostPlusRec.FINDLAST THEN PrevLino := ProjCostPlusRec."Line No.";
              ProjCostPlusRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ProjCostPlusRec.FINDLAST THEN
                CurrLino := ProjCostPlusRec."Line No.";
            END;
            REPEAT
              ProjCostPlusRec.INIT;
              ProjCostPlusRec."Project No." := g_code1;
              ProjCostPlusRec.Principal := g_code2;
              ProjCostPlusRec."Commission No." := g_code3;
              ProjCostPlusRec."Settl.Sheet No." := g_code4;
              ProjCostPlusRec."Line No." := CurrLino + Gap;
              CurrLino := ProjCostPlusRec."Line No.";
              ProjCostPlusRec."Cost Type" := ProjCostPlusRec."Cost Type"::Material;
              ProjCostPlusRec.Manufacturer := MarkedRec.Manufacturer;
              ProjCostPlusRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              ProjCostPlusRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Option Budget":
          BEGIN
            BudgetOptionRec.LOCKTABLE;
            BudgetOptionRec.SETRANGE("Project No.", g_code1);
            BudgetOptionRec.SETRANGE("Plot No.", g_code4);
            BudgetOptionRec.SETRANGE("House Model", g_code5);
            BudgetOptionRec.SETRANGE("Main Group", g_code6);
            BudgetOptionRec.SETRANGE(Group, g_code7);
            BudgetOptionRec.SETRANGE("Sub Group", g_code8);
            BudgetOptionRec.SETRANGE(Option, g_code2);
            IF BudgetOptionRec.GET(g_code1, g_code4, g_code5, g_code6, g_code7, g_code8, g_code2, CurrLino) THEN BEGIN
              BudgetOptionRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BudgetOptionRec.FINDLAST THEN PrevLino := BudgetOptionRec."Line No.";
              BudgetOptionRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BudgetOptionRec.FINDLAST THEN
                CurrLino := BudgetOptionRec."Line No.";
            END;
            REPEAT
              BudgetOptionRec.INIT;
              BudgetOptionRec."Project No." := g_code1;
              BudgetOptionRec."Plot No." := g_code4;
              BudgetOptionRec."House Model" := g_code5;
              BudgetOptionRec."Main Group" := g_code6;
              BudgetOptionRec.Group := g_code7;
              BudgetOptionRec."Sub Group" := g_code8;
              BudgetOptionRec.Option := g_code2;
              BudgetOptionRec.VALIDATE(Element, g_code3);
              BudgetOptionRec."Line No." := CurrLino + Gap;
              CurrLino := BudgetOptionRec."Line No.";
              BudgetOptionRec."Cost Type" := BudgetOptionRec."Cost Type"::Material;
              BudgetOptionRec.Manufacturer := MarkedRec.Manufacturer;
              BudgetOptionRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              BudgetOptionRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Part Line":  //DP00381
          BEGIN
            NewPartLineRec.LOCKTABLE;
            NewPartLineRec.SETRANGE("Part Group",g_code6);
            NewPartLineRec.SETRANGE(Part,g_code3);
            IF NewPartLineRec.GET(g_code6, g_code3, CurrLino) THEN BEGIN
              NewPartLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewPartLineRec.FINDLAST THEN PrevLino := NewPartLineRec."Line No.";
              NewPartLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewPartLineRec.FINDLAST THEN
                CurrLino := NewPartLineRec."Line No.";
            END;
            REPEAT
              NewPartLineRec.INIT;
              NewPartLineRec."Part Group" := g_code6;
              NewPartLineRec.Part := g_code3;
              NewPartLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewPartLineRec."Line No.";
              NewPartLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewPartLineRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              NewPartLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Line":  //DP00381
          BEGIN
            EstRec.GET(g_code1);
            EstRec.TESTFIELD(Fixed, FALSE);

            NewEstLineRec.LOCKTABLE;
            NewEstLineRec.SETRANGE("Estimate No.", g_code1);
            NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
            NewEstLineRec.SETRANGE("Part Group",g_code6);
            NewEstLineRec.SETRANGE(Part,g_code3);
            IF NewEstLineRec.GET(g_code1, g_code2, g_code6, g_code3, CurrLino) THEN BEGIN
              NewEstLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewEstLineRec.FINDLAST THEN PrevLino := NewEstLineRec."Line No.";
              NewEstLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewEstLineRec.FINDLAST THEN
                CurrLino := NewEstLineRec."Line No.";
            END;
            REPEAT
              NewEstLineRec.INIT;
              NewEstLineRec."Estimate No." := g_code1;
              NewEstLineRec."Sub-Estimate No." := g_code2;
              NewEstLineRec."Part Group" := g_code6;
              NewEstLineRec.Part := g_code3;
              NewEstLineRec.InitRecord;
              NewEstLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewEstLineRec."Line No.";
              NewEstLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewEstLineRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              NewEstLineRec.INSERT(TRUE);
              NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Base Recipe Line":  //DP00381
          BEGIN
            BaseRecipeRec.GET(g_code5, g_code4);
            BaseRecipeRec.TESTFIELD(Fixed, FALSE);

            //mg.sn, 06-06-12: M34512
            IF FPSLicenseManagement.LicenseAndReadPermissionForTable(CompanyRelationsCentralMgt) THEN BEGIN
              CentralDataManagementCU.ItemFormEditable(NavBln, DiscBln, DiscGroupBln, RcpBln);
              IF RcpBln THEN
                ERROR(Text042);
            END;
            //mg.en, 06-06-12: M34512

            BaseRecipeLineRec.LOCKTABLE;
            BaseRecipeLineRec.SETRANGE("Recipe Group",g_code5);
            BaseRecipeLineRec.SETRANGE(Recipe,g_code4);
            IF BaseRecipeLineRec.GET(g_code5, g_code4, CurrLino) THEN BEGIN
              BaseRecipeLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BaseRecipeLineRec.FINDLAST THEN PrevLino := BaseRecipeLineRec."Line No.";
              BaseRecipeLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BaseRecipeLineRec.FINDLAST THEN
                CurrLino := BaseRecipeLineRec."Line No.";
            END;
            REPEAT;
              BaseRecipeLineRec.INIT;
              BaseRecipeLineRec.Recipe := g_code4;
              BaseRecipeLineRec."Recipe Group" := g_code5;
              BaseRecipeLineRec."Line No." := CurrLino + Gap;
              CurrLino := BaseRecipeLineRec."Line No.";
              BaseRecipeLineRec.Manufacturer := MarkedRec.Manufacturer;
              BaseRecipeLineRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              BaseRecipeLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Recipe Line":  //DP00381
          BEGIN
            IF g_code1 <> '' THEN BEGIN
              EstRec.GET(g_code1);
              EstRec.TESTFIELD(Fixed, FALSE);
            END;

            NewRecipeLineRec.LOCKTABLE;
            NewRecipeLineRec.SETRANGE("Estimate No.",g_code1);
            NewRecipeLineRec.SETRANGE("Sub-Estimate No.",g_code2);
            NewRecipeLineRec.SETRANGE("Part Group",g_code6);
            NewRecipeLineRec.SETRANGE(Part,g_code3);
            NewRecipeLineRec.SETRANGE("Estimate Line",g_int1);
            NewRecipeLineRec.SETRANGE("Recipe Group",g_code5);
            NewRecipeLineRec.SETRANGE(Recipe,g_code4);
            IF NewRecipeLineRec.GET(g_code1, g_code2, g_code6, g_code3, g_int1, g_code5, g_code4, CurrLino) THEN BEGIN
              NewRecipeLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewRecipeLineRec.FINDLAST THEN PrevLino := NewRecipeLineRec."Line No.";
              NewRecipeLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewRecipeLineRec.FINDLAST THEN
                CurrLino := NewRecipeLineRec."Line No.";
            END;
            REPEAT;
              NewRecipeLineRec.INIT;
              NewRecipeLineRec."Estimate No." := g_code1;
              NewRecipeLineRec."Sub-Estimate No." := g_code2;
              NewRecipeLineRec."Part Group" := g_code6;
              NewRecipeLineRec.Part := g_code3;
              NewRecipeLineRec.Recipe := g_code4;
              NewRecipeLineRec."Recipe Group" := g_code5;
              NewRecipeLineRec."Estimate Line" := g_int1;
              NewRecipeLineRec.InitRecord;
              NewRecipeLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewRecipeLineRec."Line No.";
              NewRecipeLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewRecipeLineRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              NewRecipeLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Advice Order Line":
          BEGIN
            AdviceRec.LOCKTABLE;
            IF g_int1 <> 0 THEN BEGIN
              AdviceRec.SETRANGE("Record Type", AdviceRec."Record Type"::ServOrder);
              AdviceRec.SETRANGE("Service Order No.", g_code4);
              IF AdviceRec.GET(AdviceRec."Record Type"::ServOrder, '', g_code4, '', CurrLino) THEN  //DP01378
                AdvicePresent := TRUE
              ELSE
                AdvicePresent := FALSE;
            END ELSE BEGIN
              AdviceRec.SETRANGE("Record Type", AdviceRec."Record Type"::Project);
              AdviceRec.SETRANGE("Project No.", g_code1);
              IF AdviceRec.GET(AdviceRec."Record Type"::Project, g_code1, '', '', CurrLino) THEN  //DP01378
                AdvicePresent := TRUE
              ELSE
                AdvicePresent := FALSE;
            END;
            IF AdvicePresent = TRUE THEN BEGIN
              AdviceRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF AdviceRec.FINDLAST THEN PrevLino := AdviceRec."Line No.";
              AdviceRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF AdviceRec.FINDLAST THEN
                CurrLino := AdviceRec."Line No.";
            END;
            REPEAT
              AdviceRec.INIT;
              IF g_int1 <> 0 THEN BEGIN
                AdviceRec."Record Type" := AdviceRec."Record Type"::ServOrder;
                AdviceRec.VALIDATE("Service Order No.", g_code4);
              END ELSE BEGIN
                AdviceRec."Record Type" := AdviceRec."Record Type"::Project;
                AdviceRec."Project No." := g_code1;
                AdviceRec.Element := g_code2;
                AdviceRec."Extension Contract" := g_code3;
              END;
              AdviceRec."Line No." := CurrLino + Gap;
              CurrLino := AdviceRec."Line No.";
              AdviceRec.Manufacturer := MarkedRec.Manufacturer;
              AdviceRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              AdviceRec.InitRecord;  //db, 23-06-09: M15627
              AdviceRec."Purchaser Code" := AdviceRec.GetDefaultPurchaser(g_code1, g_code4);
              AdviceRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Service Order Cost Plus Entry":
          BEGIN
            ServOrderRec.GET(g_code1);

            ServCostPlusRec.LOCKTABLE;
            ServCostPlusRec.SETRANGE("Service Order No.", g_code1);
            IF ServCostPlusRec.GET(g_code1, CurrLino) THEN BEGIN
              ServCostPlusRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServCostPlusRec.FINDLAST THEN PrevLino := ServCostPlusRec."Line No.";
              ServCostPlusRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServCostPlusRec.FINDLAST THEN
                CurrLino := ServCostPlusRec."Line No.";
            END;
            REPEAT
              ServCostPlusRec.INIT;
              ServCostPlusRec.VALIDATE("Service Order No.", g_code1);
              ServCostPlusRec."Line No." := CurrLino + Gap;
              CurrLino := ServCostPlusRec."Line No.";
              ServCostPlusRec."Customer No." := ServOrderRec."Customer No.";
              ServCostPlusRec."Bill-to Customer No." := ServOrderRec."Bill-to Customer No.";
              ServCostPlusRec."Service Location No." := ServOrderRec."Service Location No.";
              ServCostPlusRec.Manufacturer := MarkedRec.Manufacturer;
              ServCostPlusRec."Posting Date" := TODAY;  //db, 05-10-06 (required for discount)
              ServCostPlusRec.VALIDATE("Basic Item", MarkedRec."Product Code");
              ServCostPlusRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        ELSE
          MESSAGE(Text001);
      END;

      COMMIT;
    END;

    [External]
    PROCEDURE CopyTradeItems@1210190010(VAR MarkedRec@1210190000 : TEMPORARY Record 11012317;AfterShowingWebDialog@1100528400 : Boolean);
    VAR
      MaintenanceScheme@1100525000 : Record 11071745;
      MaintenanceSchemeCode@1100525001 : Code[20];
      PackagingUnit@1100528401 : Code[10];
      TradeItem@1100529500 : Record 11012317;
      PurchaseHeader@1100527300 : Record 38;
    BEGIN
      //C031686, db, 18-11-16
      //- if function called from 2ba-Mgt (codeunit 11012306), after insert new item extra read required to avoid problem with validate Trade Item

      IF NOT MarkedRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedRec.COUNT;
      CurrLino := g_int2;
      PrevLino := 0;
      Gap := 0;

      CASE g_table OF
        DATABASE::"Purchase Line":
          BEGIN
            PurchHeaderRec.GET(g_int1, g_code1);

            PurchLineRec.LOCKTABLE;
            PurchLineRec.SETRANGE("Document Type", g_int1);
            PurchLineRec.SETRANGE("Document No.", g_code1);
            IF PurchLineRec.GET(g_int1, g_code1, CurrLino) THEN BEGIN
              PurchLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF PurchLineRec.FINDLAST THEN PrevLino := PurchLineRec."Line No.";
              PurchLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PurchLineRec.FINDLAST THEN
                CurrLino := PurchLineRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              PurchLineRec.INIT;
              PurchLineRec."Document Type" := g_int1;
              PurchLineRec."Document No." := g_code1;
              PurchLineRec."Line No." := CurrLino + Gap;
              CurrLino := PurchLineRec."Line No.";
              PurchLineRec."System-Created Entry" := TRUE;
              PurchLineRec."Posting Date" := PurchHeaderRec."Posting Date";
              PurchLineRec.VALIDATE("Currency Code", PurchHeaderRec."Currency Code");
              PurchLineRec.VALIDATE(Type, PurchLineRec.Type::"G/L Account");
              PurchLineRec."Job No." := g_code4;
              IF PurchLineRec."Job No." = '' THEN
                PurchLineRec."Job No." := PurchHeaderRec."Ship-to Project";
              IF PurchLineRec."Job No." = '' THEN
                PurchLineRec."Job No." := PurchHeaderRec."Job No.";
              PurchLineRec.VALIDATE(Element, g_code2);
              PurchLineRec.VALIDATE("No.", DetermineGLAccount(PurchLineRec."Job No."));
              PurchLineRec.VALIDATE("Service Order No.", g_code5);
              PurchLineRec."Cost Type" := PurchLineRec."Cost Type"::Material;
              PurchLineRec.Manufacturer := MarkedRec.Manufacturer;
              PurchLineRec."Basic Item" := MarkedRec."Product Code";
              PurchLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              PurchLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              PurchLineRec.FillMainProject;
              IF AfterShowingWebDialog THEN
                IF GetPackagingUnit(MarkedRec, PackagingUnit) THEN
                  PurchLineRec.VALIDATE("Unit of Measure Code", PackagingUnit);
              PurchaseHeader.GET(PurchLineRec."Document Type", PurchLineRec."Document No.");
              IF (PurchaseHeader."Purchase Order Type" = PurchaseHeader."Purchase Order Type"::"Return Order") AND (MarkedRec."Quantity Per Price" > 0) THEN
                PurchLineRec.VALIDATE(Quantity, -MarkedRec."Quantity Per Price")
              ELSE
                PurchLineRec.VALIDATE(Quantity,MarkedRec."Quantity Per Price"); //C025959 (dirty programming: misuse of existing field in tmp-table)
              PurchLineRec."Input by" := USERID; //DP00469
              PurchLineRec."Input Date" := TODAY; //DP00469
              PurchLineRec.INSERT;
              PurchLineRec.CreatePurchOrderControl(FALSE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Purchase Requisition Line":  //DP01314
          BEGIN
            PurchaseRequisitionLine.LOCKTABLE;
            PurchaseRequisitionLine.SETRANGE("Purchase Requisition No.", g_code1);
            IF PurchaseRequisitionLine.GET(g_code1, CurrLino) THEN BEGIN
              PurchaseRequisitionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF PurchaseRequisitionLine.FINDLAST THEN PrevLino := PurchaseRequisitionLine."Line No.";
              PurchaseRequisitionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PurchaseRequisitionLine.FINDLAST THEN
                CurrLino := PurchaseRequisitionLine."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              PurchaseRequisitionLine.INIT;
              PurchaseRequisitionLine."Purchase Requisition No." := g_code1;
              PurchaseRequisitionLine."Line No." := CurrLino + Gap;
              CurrLino := PurchaseRequisitionLine."Line No.";
              IF g_code2 <> '' THEN BEGIN
                PurchaseRequisitionLine.VALIDATE("Project No.", g_code2);
                PurchaseRequisitionLine.VALIDATE("Extension Contract", g_code3);
                PurchaseRequisitionLine.VALIDATE(Element, g_code4);
              END;
              IF g_code5 <> '' THEN
                PurchaseRequisitionLine.VALIDATE("Service Order No.", g_code5);
              PurchaseRequisitionLine."Cost Type" := PurchaseRequisitionLine."Cost Type"::Material;
              PurchaseRequisitionLine.Manufacturer := MarkedRec.Manufacturer;
              PurchaseRequisitionLine."Basic Item" := MarkedRec."Product Code";
              PurchaseRequisitionLine."Vendor (Trade Item)" := MarkedRec.Vendor;
              PurchaseRequisitionLine.VALIDATE("Trade Item", MarkedRec."Item Code");
              PurchaseRequisitionLine.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Standard Purchase Line":
          BEGIN
            StdPurchRec.LOCKTABLE;
            StdPurchRec.SETRANGE("Standard Purchase Code", g_code1);
            IF StdPurchRec.GET(g_code1, CurrLino) THEN BEGIN
              StdPurchRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF StdPurchRec.FINDLAST THEN PrevLino := StdPurchRec."Line No.";
              StdPurchRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF StdPurchRec.FINDLAST THEN
                CurrLino := StdPurchRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              StdPurchRec.INIT;
              StdPurchRec."Standard Purchase Code" := g_code1;
              StdPurchRec."Line No." := CurrLino + Gap;
              CurrLino := StdPurchRec."Line No.";
              StdPurchRec.Type := StdPurchRec.Type::Item;
              StdPurchRec.Manufacturer := MarkedRec.Manufacturer;
              StdPurchRec."Basic Item" := MarkedRec."Product Code";
              StdPurchRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              StdPurchRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              StdPurchRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Budget Line":
          BEGIN
            BudgetLineRec.LOCKTABLE;
            BudgetLineRec.SETRANGE("Project No.", g_code1);
            BudgetLineRec.SETRANGE("Extension Contract", g_code2);
            BudgetLineRec.SETRANGE(Adjustment, g_code3);
            BudgetLineRec.SETRANGE(Option, g_code5);
            IF BudgetLineRec.GET(g_code1, g_code2, g_code3, g_code5, CurrLino) THEN BEGIN
              BudgetLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BudgetLineRec.FINDLAST THEN PrevLino := BudgetLineRec."Line No.";
              BudgetLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BudgetLineRec.FINDLAST THEN
                CurrLino := BudgetLineRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              BudgetLineRec.INIT;
              BudgetLineRec."Project No." := g_code1;
              BudgetLineRec."Extension Contract" := g_code2;
              BudgetLineRec.Adjustment := g_code3;
              BudgetLineRec.Option := g_code5;
              BudgetLineRec.VALIDATE(Element, g_code4);
              BudgetLineRec."Line No." := CurrLino + Gap;
              CurrLino := BudgetLineRec."Line No.";
              IF g_code1 <> '' THEN BEGIN
                ProjRec.GET(g_code1);
                BudgetLineRec."Version Date" := ProjRec."Version Date";
                BudgetLineRec."Department Code" := ProjRec."Global Dimension 1 Code";  //*31927
              END;
              IF g_code2 <> '' THEN BEGIN
                ExtRec.GET(g_code1, g_code2);
                BudgetLineRec."Version Date" := ExtRec."Version Date";
              END;
              IF g_code3 <> '' THEN BEGIN
                AdjRec.GET(g_code1, g_code3);
                BudgetLineRec."Version Date" := AdjRec."Version Date";
              END;
              BudgetLineRec."Cost Type" := BudgetLineRec."Cost Type"::Material;
              BudgetLineRec.Manufacturer := MarkedRec.Manufacturer;
              BudgetLineRec."Basic Item" := MarkedRec."Product Code";
              BudgetLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              BudgetLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              BudgetLineRec.FillMainProject;
              BudgetLineRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Project Cost Plus Entry":
          BEGIN
            ProjCostPlusRec.LOCKTABLE;
            ProjCostPlusRec.SETRANGE("Project No.", g_code1);
            ProjCostPlusRec.SETRANGE(Principal, g_code2);
            ProjCostPlusRec.SETRANGE("Commission No.", g_code3);
            ProjCostPlusRec.SETRANGE("Settl.Sheet No.", g_code4);
            IF ProjCostPlusRec.GET(g_code1, g_code2, g_code3, g_code4, CurrLino) THEN BEGIN
              ProjCostPlusRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ProjCostPlusRec.FINDLAST THEN PrevLino := ProjCostPlusRec."Line No.";
              ProjCostPlusRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ProjCostPlusRec.FINDLAST THEN
                CurrLino := ProjCostPlusRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              ProjCostPlusRec.INIT;
              ProjCostPlusRec."Project No." := g_code1;
              ProjCostPlusRec.Principal := g_code2;
              ProjCostPlusRec."Commission No." := g_code3;
              ProjCostPlusRec."Settl.Sheet No." := g_code4;
              ProjCostPlusRec."Line No." := CurrLino + Gap;
              CurrLino := ProjCostPlusRec."Line No.";
              ProjCostPlusRec."Cost Type" := ProjCostPlusRec."Cost Type"::Material;
              ProjCostPlusRec.Manufacturer := MarkedRec.Manufacturer;
              ProjCostPlusRec."Basic Item" := MarkedRec."Product Code";
              ProjCostPlusRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              ProjCostPlusRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              ProjCostPlusRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Option Budget":
          BEGIN
            BudgetOptionRec.LOCKTABLE;
            BudgetOptionRec.SETRANGE("Project No.", g_code1);
            BudgetOptionRec.SETRANGE("Plot No.", g_code4);
            BudgetOptionRec.SETRANGE("House Model", g_code5);
            BudgetOptionRec.SETRANGE("Main Group", g_code6);
            BudgetOptionRec.SETRANGE(Group, g_code7);
            BudgetOptionRec.SETRANGE("Sub Group", g_code8);
            BudgetOptionRec.SETRANGE(Option, g_code2);
            IF BudgetOptionRec.GET(g_code1, g_code4, g_code5, g_code6, g_code7, g_code8, g_code2, CurrLino) THEN BEGIN
              BudgetOptionRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BudgetOptionRec.FINDLAST THEN PrevLino := BudgetOptionRec."Line No.";
              BudgetOptionRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BudgetOptionRec.FINDLAST THEN
                CurrLino := BudgetOptionRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              BudgetOptionRec.INIT;
              BudgetOptionRec."Project No." := g_code1;
              BudgetOptionRec."Plot No." := g_code4;
              BudgetOptionRec."House Model" := g_code5;
              BudgetOptionRec."Main Group" := g_code6;
              BudgetOptionRec.Group := g_code7;
              BudgetOptionRec."Sub Group" := g_code8;
              BudgetOptionRec.Option := g_code2;
              BudgetOptionRec.VALIDATE(Element, g_code3);
              BudgetOptionRec."Line No." := CurrLino + Gap;
              CurrLino := BudgetOptionRec."Line No.";
              BudgetOptionRec."Cost Type" := BudgetOptionRec."Cost Type"::Material;
              BudgetOptionRec.Manufacturer := MarkedRec.Manufacturer;
              BudgetOptionRec."Basic Item" := MarkedRec."Product Code";
              BudgetOptionRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              BudgetOptionRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              BudgetOptionRec.INSERT;
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Part Line":  //DP00381
          BEGIN
            NewPartLineRec.LOCKTABLE;
            NewPartLineRec.SETRANGE("Part Group",g_code6);
            NewPartLineRec.SETRANGE(Part,g_code3);
            IF NewPartLineRec.GET(g_code6, g_code3, CurrLino) THEN BEGIN
              NewPartLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewPartLineRec.FINDLAST THEN PrevLino := NewPartLineRec."Line No.";
              NewPartLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewPartLineRec.FINDLAST THEN
                CurrLino := NewPartLineRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              NewPartLineRec.INIT;
              NewPartLineRec."Part Group" := g_code6;
              NewPartLineRec.Part := g_code3;
              NewPartLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewPartLineRec."Line No.";
              NewPartLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewPartLineRec."Basic Item" := MarkedRec."Product Code";
              NewPartLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              NewPartLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              NewPartLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Line":  //DP00381
          BEGIN
            EstRec.GET(g_code1);
            EstRec.TESTFIELD(Fixed, FALSE);

            NewEstLineRec.LOCKTABLE;
            NewEstLineRec.SETRANGE("Estimate No.", g_code1);
            NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
            NewEstLineRec.SETRANGE("Part Group",g_code6);
            NewEstLineRec.SETRANGE(Part,g_code3);
            IF NewEstLineRec.GET(g_code1, g_code2, g_code6, g_code3, CurrLino) THEN BEGIN
              NewEstLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewEstLineRec.FINDLAST THEN PrevLino := NewEstLineRec."Line No.";
              NewEstLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewEstLineRec.FINDLAST THEN
                CurrLino := NewEstLineRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              NewEstLineRec.INIT;
              NewEstLineRec."Estimate No." := g_code1;
              NewEstLineRec."Sub-Estimate No." := g_code2;
              NewEstLineRec."Part Group" := g_code6;
              NewEstLineRec.Part := g_code3;
              NewEstLineRec.InitRecord;
              NewEstLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewEstLineRec."Line No.";
              NewEstLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewEstLineRec."Basic Item" := MarkedRec."Product Code";
              NewEstLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              NewEstLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              NewEstLineRec.INSERT(TRUE);
              NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Base Recipe Line":  //DP00381
          BEGIN
            BaseRecipeRec.GET(g_code5, g_code4);
            BaseRecipeRec.TESTFIELD(Fixed, FALSE);

            //mg.sn, 06-06-12: M34512
            IF FPSLicenseManagement.LicenseAndReadPermissionForTable(CompanyRelationsCentralMgt) THEN BEGIN
              CentralDataManagementCU.ItemFormEditable(NavBln, DiscBln, DiscGroupBln, RcpBln);
              IF RcpBln THEN
                ERROR(Text042);
            END;
            //mg.en, 06-06-12: M34512

            BaseRecipeLineRec.LOCKTABLE;
            BaseRecipeLineRec.SETRANGE("Recipe Group",g_code5);
            BaseRecipeLineRec.SETRANGE(Recipe,g_code4);
            IF BaseRecipeLineRec.GET(g_code5, g_code4, CurrLino) THEN BEGIN
              BaseRecipeLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF BaseRecipeLineRec.FINDLAST THEN PrevLino := BaseRecipeLineRec."Line No.";
              BaseRecipeLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF BaseRecipeLineRec.FINDLAST THEN
                CurrLino := BaseRecipeLineRec."Line No.";
            END;
            REPEAT;
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              BaseRecipeLineRec.INIT;
              BaseRecipeLineRec.Recipe := g_code4;
              BaseRecipeLineRec."Recipe Group" := g_code5;
              BaseRecipeLineRec."Line No." := CurrLino + Gap;
              CurrLino := BaseRecipeLineRec."Line No.";
              BaseRecipeLineRec.Manufacturer := MarkedRec.Manufacturer;
              BaseRecipeLineRec."Basic Item" := MarkedRec."Product Code";
              BaseRecipeLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              BaseRecipeLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              BaseRecipeLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Estimate Recipe Line":  //DP00381
          BEGIN
            IF g_code1 <> '' THEN BEGIN
              EstRec.GET(g_code1);
              EstRec.TESTFIELD(Fixed, FALSE);
            END;

            NewRecipeLineRec.LOCKTABLE;
            NewRecipeLineRec.SETRANGE("Estimate No.",g_code1);
            NewRecipeLineRec.SETRANGE("Sub-Estimate No.",g_code2);
            NewRecipeLineRec.SETRANGE("Part Group",g_code6);
            NewRecipeLineRec.SETRANGE(Part,g_code3);
            NewRecipeLineRec.SETRANGE("Estimate Line",g_int1);
            NewRecipeLineRec.SETRANGE("Recipe Group",g_code5);
            NewRecipeLineRec.SETRANGE(Recipe,g_code4);
            IF NewRecipeLineRec.GET(g_code1, g_code2, g_code6, g_code3, g_int1, g_code5, g_code4, CurrLino) THEN BEGIN
              NewRecipeLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewRecipeLineRec.FINDLAST THEN PrevLino := NewRecipeLineRec."Line No.";
              NewRecipeLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewRecipeLineRec.FINDLAST THEN
                CurrLino := NewRecipeLineRec."Line No.";
            END;
            REPEAT;
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              NewRecipeLineRec.INIT;
              NewRecipeLineRec."Estimate No." := g_code1;
              NewRecipeLineRec."Sub-Estimate No." := g_code2;
              NewRecipeLineRec."Part Group" := g_code6;
              NewRecipeLineRec.Part := g_code3;
              NewRecipeLineRec.Recipe := g_code4;
              NewRecipeLineRec."Recipe Group" := g_code5;
              NewRecipeLineRec."Estimate Line" := g_int1;
              NewRecipeLineRec.InitRecord;
              NewRecipeLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewRecipeLineRec."Line No.";
              NewRecipeLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewRecipeLineRec."Basic Item" := MarkedRec."Product Code";
              NewRecipeLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              NewRecipeLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              NewRecipeLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Advice Order Line":
          BEGIN
            AdviceRec.LOCKTABLE;
            IF g_int1 <> 0 THEN BEGIN
              AdviceRec.SETRANGE("Record Type", AdviceRec."Record Type"::ServOrder);
              AdviceRec.SETRANGE("Service Order No.", g_code4);
              IF AdviceRec.GET(AdviceRec."Record Type"::ServOrder, '', g_code4, '', CurrLino) THEN  //DP01378
                AdvicePresent := TRUE
              ELSE
                AdvicePresent := FALSE;
            END ELSE BEGIN
              AdviceRec.SETRANGE("Record Type", AdviceRec."Record Type"::Project);
              AdviceRec.SETRANGE("Project No.", g_code1);
              IF AdviceRec.GET(AdviceRec."Record Type"::Project, g_code1, '', '', CurrLino) THEN  //DP01378
                AdvicePresent := TRUE
              ELSE
                AdvicePresent := FALSE;
            END;
            IF AdvicePresent = TRUE THEN BEGIN
              AdviceRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF AdviceRec.FINDLAST THEN PrevLino := AdviceRec."Line No.";
              AdviceRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF AdviceRec.FINDLAST THEN
                CurrLino := AdviceRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              AdviceRec.INIT;
              IF g_int1 <> 0 THEN BEGIN
                AdviceRec."Record Type" := AdviceRec."Record Type"::ServOrder;
                AdviceRec.VALIDATE("Service Order No.", g_code4);
              END ELSE BEGIN
                AdviceRec."Record Type" := AdviceRec."Record Type"::Project;
                AdviceRec."Project No." := g_code1;
                AdviceRec.Element := g_code2;
                AdviceRec."Extension Contract" := g_code3;
              END;
              AdviceRec."Line No." := CurrLino + Gap;
              CurrLino := AdviceRec."Line No.";
              AdviceRec.Manufacturer := MarkedRec.Manufacturer;
              AdviceRec."Basic Item" := MarkedRec."Product Code";
              AdviceRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              AdviceRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              AdviceRec.InitRecord;  //db, 23-06-09: M15627
              AdviceRec."Purchaser Code" := AdviceRec.GetDefaultPurchaser(g_code1, g_code4);
              AdviceRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Service Order Cost Plus Entry":
          BEGIN
            ServOrderRec.GET(g_code1);

            ServCostPlusRec.LOCKTABLE;
            ServCostPlusRec.SETRANGE("Service Order No.", g_code1);
            IF ServCostPlusRec.GET(g_code1, CurrLino) THEN BEGIN
              ServCostPlusRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServCostPlusRec.FINDLAST THEN PrevLino := ServCostPlusRec."Line No.";
              ServCostPlusRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServCostPlusRec.FINDLAST THEN
                CurrLino := ServCostPlusRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              ServCostPlusRec.INIT;
              ServCostPlusRec.VALIDATE("Service Order No.", g_code1);
              ServCostPlusRec."Line No." := CurrLino + Gap;
              CurrLino := ServCostPlusRec."Line No.";
              ServCostPlusRec."Customer No." := ServOrderRec."Customer No.";
              ServCostPlusRec."Bill-to Customer No." := ServOrderRec."Bill-to Customer No.";
              ServCostPlusRec."Service Location No." := ServOrderRec."Service Location No.";
              ServCostPlusRec.Manufacturer := MarkedRec.Manufacturer;
              ServCostPlusRec."Basic Item" := MarkedRec."Product Code";
              ServCostPlusRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              ServCostPlusRec."Posting Date" := TODAY;  //db, 05-10-06 (required for discount)
              ServCostPlusRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              ServCostPlusRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Service Order Budget Line":
          BEGIN
            ServOrderRec.GET(g_code1);
            ServiceOrderBudgetLine.LOCKTABLE;
            ServiceOrderBudgetLine.SETRANGE("Budget Type", ServiceOrderBudgetLine."Budget Type"::Order);
            ServiceOrderBudgetLine.SETRANGE("Service Order No.", g_code1);
            ServiceOrderBudgetLine.SETRANGE("Service Contract No.", '');
            ServiceOrderBudgetLine.SETRANGE("Object No.", g_code2);
            ServiceOrderBudgetLine.SETRANGE("Maintenance Scheme", g_code3);
            IF ServiceOrderBudgetLine.GET(ServiceOrderBudgetLine."Budget Type"::Order, g_code1, '', g_code2, g_code3, CurrLino) THEN BEGIN
              ServiceOrderBudgetLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServiceOrderBudgetLine.FINDLAST THEN PrevLino := ServiceOrderBudgetLine."Line No.";
              ServiceOrderBudgetLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServiceOrderBudgetLine.FINDLAST THEN
                CurrLino := ServiceOrderBudgetLine."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              ServiceOrderBudgetLine.INIT;
              ServiceOrderBudgetLine."Budget Type" := ServiceOrderBudgetLine."Budget Type"::Order;
              ServiceOrderBudgetLine.VALIDATE("Service Order No.", g_code1);
              ServiceOrderBudgetLine."Service Contract No." := '';
              ServiceOrderBudgetLine.VALIDATE("Object No.", g_code2);
              ServiceOrderBudgetLine.VALIDATE("Maintenance Scheme", g_code3);
              ServiceOrderBudgetLine."Line No." := CurrLino + Gap;
              CurrLino := ServiceOrderBudgetLine."Line No.";
              ServiceOrderBudgetLine."Service Location No." := ServOrderRec."Service Location No.";
              ServiceOrderBudgetLine."Cost Type" := ServiceOrderBudgetLine."Cost Type"::Material;
              ServiceOrderBudgetLine.Manufacturer := MarkedRec.Manufacturer;
              ServiceOrderBudgetLine."Basic Item" := MarkedRec."Product Code";
              ServiceOrderBudgetLine."Vendor (Trade Item)" := MarkedRec.Vendor;
              ServiceOrderBudgetLine.VALIDATE("Trade Item", MarkedRec."Item Code");
              ServiceOrderBudgetLine.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Maint. Scheme Version Line":
          BEGIN
            MaintSchemeVersionLine.LOCKTABLE;
            MaintSchemeVersionLine.SETRANGE("Line Type", g_int1);
            MaintSchemeVersionLine.SETRANGE("Type Code", g_code1);
            MaintSchemeVersionLine.SETRANGE("Belongs to Scheme", g_code2);
            MaintSchemeVersionLine.SETRANGE("Index Date", g_date1);
            IF MaintSchemeVersionLine.GET(g_int1, g_code1, g_code2, g_date1, CurrLino) THEN BEGIN
              MaintSchemeVersionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF MaintSchemeVersionLine.FINDLAST THEN PrevLino := MaintSchemeVersionLine."Line No.";
              MaintSchemeVersionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF MaintSchemeVersionLine.FINDLAST THEN
                CurrLino := MaintSchemeVersionLine."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              MaintSchemeVersionLine.INIT;
              MaintSchemeVersionLine."Line Type" := g_int1;
              MaintSchemeVersionLine."Type Code" := g_code1;
              MaintSchemeVersionLine."Belongs to Scheme" := g_code2;
              MaintSchemeVersionLine."Index Date" := g_date1;
              MaintSchemeVersionLine."Line No." := CurrLino + Gap;
              CurrLino := MaintSchemeVersionLine."Line No.";
              MaintSchemeVersionLine."Cost Type" := MaintSchemeVersionLine."Cost Type"::Material;
              MaintSchemeVersionLine.Manufacturer := MarkedRec.Manufacturer;
              MaintSchemeVersionLine."Basic Item" := MarkedRec."Product Code";
              MaintSchemeVersionLine."Vendor (Trade Item)" := MarkedRec.Vendor;
              MaintSchemeVersionLine.VALIDATE("Trade Item", MarkedRec."Item Code");
              IF MaintSchemeVersionLine."Line Type" = MaintSchemeVersionLine."Line Type"::"Maintenance Scheme" THEN
                MaintenanceSchemeCode := MaintSchemeVersionLine."Type Code"
              ELSE
                MaintenanceSchemeCode := MaintSchemeVersionLine."Belongs to Scheme";
              IF NOT MaintenanceScheme.GET(MaintenanceSchemeCode) THEN
                MaintenanceScheme.INIT;
              MaintSchemeVersionLine.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Serv. Surv. Object Add. Act.":
          BEGIN
            ServSurvObjectAddAct.LOCKTABLE;
            ServSurvObjectAddAct.SETRANGE("Survey No.", g_code1);
            ServSurvObjectAddAct.SETRANGE("Location Code", g_code2);
            ServSurvObjectAddAct.SETRANGE("Seq. No.", g_int1);
            ServSurvObjectAddAct.SETRANGE("Maintenance Scheme Code", g_code3);
            IF ServSurvObjectAddAct.GET(g_code1, g_code2, g_int1, g_code3, CurrLino) THEN BEGIN
              ServSurvObjectAddAct.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServSurvObjectAddAct.FINDLAST THEN PrevLino := ServSurvObjectAddAct."Line No.";
              ServSurvObjectAddAct.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServSurvObjectAddAct.FINDLAST THEN
                CurrLino := ServSurvObjectAddAct."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              ServSurvObjectAddAct.INIT;
              ServSurvObjectAddAct."Survey No." := g_code1;
              ServSurvObjectAddAct."Location Code" := g_code2;
              ServSurvObjectAddAct."Seq. No." := g_int1;
              ServSurvObjectAddAct."Maintenance Scheme Code" := g_code3;
              ServSurvObjectAddAct."Line No." := CurrLino + Gap;
              CurrLino := ServSurvObjectAddAct."Line No.";
              ServSurvObjectAddAct."Cost Type" := ServSurvObjectAddAct."Cost Type"::Material;
              ServSurvObjectAddAct.Manufacturer := MarkedRec.Manufacturer;
              ServSurvObjectAddAct."Basic Item" := MarkedRec."Product Code";
              ServSurvObjectAddAct."Vendor (Trade Item)" := MarkedRec.Vendor;
              ServSurvObjectAddAct.VALIDATE("Trade Item", MarkedRec."Item Code");
              IF NOT MaintenanceScheme.GET(ServSurvObjectAddAct."Maintenance Scheme Code") THEN
                MaintenanceScheme.INIT;
              ServSurvObjectAddAct.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

          DATABASE::"Sales Line":
          BEGIN
            SalesHeaderRec.GET(g_int1, g_code1);

            SalesLineRec.LOCKTABLE;
            SalesLineRec.SETRANGE("Document Type", g_int1);
            SalesLineRec.SETRANGE("Document No.", g_code1);
            IF SalesLineRec.GET(g_int1, g_code1, CurrLino) THEN BEGIN
              SalesLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF SalesLineRec.FINDLAST THEN PrevLino := SalesLineRec."Line No.";
              SalesLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF SalesLineRec.FINDLAST THEN
                CurrLino := SalesLineRec."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              SalesLineRec.INIT;
              SalesLineRec."Document Type" := g_int1;
              SalesLineRec."Document No." := g_code1;
              SalesLineRec."Line No." := CurrLino + Gap;
              CurrLino := SalesLineRec."Line No.";
              SalesLineRec.InitRecord();
              SalesLineRec."System-Created Entry" := TRUE;
              SalesLineRec."Posting Date" := SalesHeaderRec."Posting Date";
              SalesLineRec.VALIDATE("Currency Code", SalesHeaderRec."Currency Code");
              SalesLineRec."Job No." := g_code4;
              IF SalesLineRec."Job No." = '' THEN
                SalesLineRec."Job No." := SalesHeaderRec."Job No.";
              SalesLineRec.VALIDATE("Job No.", SalesLineRec."Job No.");
              SalesLineRec.VALIDATE(Element, g_code2);
              IF g_code5 <> '' THEN
                SalesLineRec.VALIDATE("Service Order No.", g_code5);
              SalesLineRec.Manufacturer := MarkedRec.Manufacturer;
              SalesLineRec."Basic Item" := MarkedRec."Product Code";
              SalesLineRec."Vendor (Trade Item)" := MarkedRec.Vendor;
              SalesLineRec.VALIDATE("Trade Item", MarkedRec."Item Code");
              SalesLineRec.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

          DATABASE::"Requisition Line":
          BEGIN
            RequisitionWkshName.GET(g_code1, g_code3);

            RequisitionLine.LOCKTABLE;
            RequisitionLine.SETRANGE("Worksheet Template Name", g_code1);
            RequisitionLine.SETRANGE("Journal Batch Name", g_code3);
            IF RequisitionLine.GET(g_code1, g_code3, CurrLino) THEN BEGIN
              RequisitionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF RequisitionLine.FINDLAST THEN PrevLino := PurchLineRec."Line No.";
              RequisitionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF RequisitionLine.FINDLAST THEN
                CurrLino := RequisitionLine."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;  //C031686
              RequisitionLine.INIT;
              RequisitionLine."Worksheet Template Name" := g_code1;
              RequisitionLine."Journal Batch Name" := g_code3;
              RequisitionLine."Line No." := CurrLino + Gap;
              CurrLino := RequisitionLine."Line No.";

              RequisitionLine.VALIDATE("Project No.", g_code4);
              RequisitionLine.VALIDATE(Element, g_code2);
              IF g_code5 <> '' THEN
                RequisitionLine.VALIDATE("Service Order No.", g_code5);
              RequisitionLine."Cost Type" := RequisitionLine."Cost Type"::Material;
              RequisitionLine.Manufacturer := MarkedRec.Manufacturer;
              RequisitionLine."Basic Item" := MarkedRec."Product Code";
              RequisitionLine."Vendor (Trade Item)" := MarkedRec.Vendor;
              RequisitionLine.VALIDATE("Trade Item", MarkedRec."Item Code");
              RequisitionLine.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Project Material Req. Line":
          BEGIN
            ProjectMaterialReqLine.LOCKTABLE;
            ProjectMaterialReqLine.SETRANGE("Project No.", g_code1);
            ProjectMaterialReqLine.SETRANGE("Yard No.", g_code2);
            ProjectMaterialReqLine.SETRANGE("Entity Type", g_int1);
            ProjectMaterialReqLine.SETRANGE("System No.", g_code3);
            ProjectMaterialReqLine.SETRANGE("Entity No.", g_code4);
            IF ProjectMaterialReqLine.GET(g_code1, g_code2, g_int1, g_code3, g_code4, CurrLino) THEN BEGIN
              ProjectMaterialReqLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF ProjectMaterialReqLine.FINDLAST THEN PrevLino := ProjectMaterialReqLine."Line No.";
              ProjectMaterialReqLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ProjectMaterialReqLine.FINDLAST THEN
                CurrLino := ProjectMaterialReqLine."Line No.";
            END;
            REPEAT
              IF TradeItem.GET(MarkedRec.Vendor,MarkedRec."Item Code") THEN;
              ProjectMaterialReqLine.INIT;
              ProjectMaterialReqLine."Project No." := g_code1;
              ProjectMaterialReqLine."Yard No." := g_code2;
              ProjectMaterialReqLine."Entity Type" := g_int1;
              ProjectMaterialReqLine."System No." := g_code3;
              ProjectMaterialReqLine."Entity No." := g_code4;
              ProjectMaterialReqLine.Element := g_code5;
              ProjectMaterialReqLine."Line No." := CurrLino + Gap;
              CurrLino := ProjectMaterialReqLine."Line No.";
              ProjectMaterialReqLine.Manufacturer := MarkedRec.Manufacturer;
              ProjectMaterialReqLine."Basic Item" := MarkedRec."Product Code";
              ProjectMaterialReqLine."Vendor (Trade Item)" := MarkedRec.Vendor;
              ProjectMaterialReqLine.VALIDATE("Trade Item", MarkedRec."Item Code");
              ProjectMaterialReqLine.INSERT(TRUE);
            UNTIL MarkedRec.NEXT = 0;
          END;

        ELSE
          MESSAGE(Text001);
      END;

      COMMIT;
    END;

    LOCAL PROCEDURE GetPackagingUnit@1100528401(TradeItem@1100528400 : Record 11012317;VAR PackagingUnit@1100528402 : Code[10]) : Boolean;
    VAR
      UnitOfMeasure@1100528401 : Record 204;
    BEGIN
      IF TradeItem."Packaging Unit" = '' THEN
        EXIT;

      IF UnitOfMeasure.GET(TradeItem."Packaging Unit") THEN BEGIN
        PackagingUnit := UnitOfMeasure.Code;
        EXIT(TRUE);
      END;
    END;

    [External]
    PROCEDURE SetSelectionProgress@1100525005(iShowProgress@1100525000 : Boolean);
    BEGIN
      ShowProgress := iShowProgress;  //db, 02-07-10: M19985
    END;

    [External]
    PROCEDURE SetSelectionItem@1210190008(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@11012002 : Code[20];l_code3@11012003 : Code[20];l_code4@11012004 : Code[20];l_int1@11012005 : Integer;l_code5@11012006 : Code[20];l_code6@11012007 : Code[20];l_int2@1210190000 : Integer;l_code7@1210190002 : Code[20];l_code8@1210190001 : Code[20];l_date1@1100528600 : Date);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
      g_code5 := l_code5;
      g_code6 := l_code6;
      g_code7 := l_code7;
      g_code8 := l_code8;
      g_int1 := l_int1;
      g_int2 := l_int2;
      g_date1 := l_date1;
    END;

    [External]
    PROCEDURE SetSelectionRecipe@1210190002(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@11012002 : Code[20];l_code3@11012003 : Code[20];l_code4@11012004 : Code[20];l_code5@1210190000 : Code[20];l_code6@1210190004 : Code[20];l_code7@1210190003 : Code[20];l_code8@1210190002 : Code[20];l_code9@1210190001 : Code[20];l_int1@1100525000 : Integer);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
      g_code5 := l_code5;
      g_code6 := l_code6;
      g_code7 := l_code7;
      g_code8 := l_code8;
      g_code9 := l_code9;
      g_int1 := l_int1;  //C027336
    END;

    [External]
    PROCEDURE SetSelectionPart@1100485001(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@11012002 : Code[20];l_code3@11012003 : Code[20];l_code4@1100485000 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
    END;

    [External]
    PROCEDURE SetSelectionOperation@1100485004(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@11012002 : Code[20];l_code3@11012003 : Code[20];l_code4@11012004 : Code[20];l_int1@1100485001 : Integer;l_code5@1210190000 : Code[20];l_code6@1100485000 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
      g_int1 := l_int1;
      g_code5 := l_code5;
      g_code6 := l_code6;
    END;

    PROCEDURE SetSelectionServFeature@4(l_table@1100485000 : Integer;l_int3@1210190007 : Integer;l_code1@11012000 : Code[20];l_code2@1210190000 : Code[20];l_code3@1210190001 : Code[20];l_code4@1210190002 : Code[20];l_int1@1210190003 : Integer;l_code5@1210190004 : Code[20];l_code6@1210190005 : Code[20];l_int2@1210190006 : Integer;l_code7@1100525000 : Code[20];l_int4@1100525001 : Integer;l_code8@1100525002 : Code[20]);
    BEGIN
      g_table := l_table;
      g_int3 := l_int3-1;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
      g_code5 := l_code5;
      g_code6 := l_code6;
      g_code7 := l_code7;
      g_code8 := l_code8;
      g_int1 := l_int1;
      g_int2 := l_int2;
      g_int4 := l_int4;
    END;

    [External]
    PROCEDURE SetSelectionEntries@1100485010(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@11012002 : Code[20];l_code3@11012003 : Code[20];l_code4@11012004 : Code[20];l_int1@11012005 : Integer;l_code5@11012006 : Code[20];l_code6@11012007 : Code[20];l_int2@1210190000 : Integer);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
      g_code5 := l_code5;
      g_code6 := l_code6;
      g_int1 := l_int1;
      g_int2 := l_int2;
    END;

    [External]
    PROCEDURE SetSelectionObligation@1100485012(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@11012002 : Code[20];l_code3@11012003 : Code[20];l_code4@11012004 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
    END;

    [External]
    PROCEDURE SetSelectionObject@1100525001(l_table@11012000 : Integer;l_code1@11012001 : Code[20];l_code2@1100528600 : Code[20];l_code3@1100528601 : Code[20];l_int1@1100528602 : Integer);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionShippingOrder@1100525008(l_table@1100525008 : Integer;l_int1@1100525007 : Integer;l_code1@1100525006 : Code[20];l_int2@1100525000 : Integer;l_code2@1100529800 : Code[20]);
    BEGIN
      //mg, 22-12-10: M24679
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
      g_int2 := l_int2;
      g_code2 := l_code2; // MVOS M28943
    END;

    [External]
    PROCEDURE SetSelectionServInstallPart@1100525015(l_table@1100525002 : Integer;l_code1@1100525000 : Code[20];l_date1@1210190000 : Date);
    BEGIN
      //mg, 15-02-11: M25293
      g_table := l_table;
      g_code1 := l_code1;
      g_date1 := l_date1;
    END;

    [External]
    PROCEDURE SetSelectionEngineeringDoc@1210190003(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionEngineeringSystem@1210190012(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionEngLocation@1210190015(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionEngCable@1210190016(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionEngDevice@1210190017(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionEngExtraNeed@1210190018(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionDistCable@1210190019(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionDistDevice@1210190020(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionDistExtraNeed@1210190021(l_table@1210190000 : Integer;l_code1@1210190001 : Code[20];l_int1@1210190003 : Integer);
    BEGIN
      //mg, 19-05-11: M20072
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionServiceObjects@1100526200(l_table@1100526201 : Integer;l_code1@1100526200 : Code[20];l_code2@1100528600 : Code[20];l_int1@1100526202 : Integer);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionInspectionLines@1100528600(l_table@1100528600 : Integer;l_int1@1100528601 : Integer;l_code1@1100528602 : Code[20];l_code2@1100528603 : Code[20];l_code3@1100525001 : Code[20];l_code4@1100525002 : Code[20];l_date1@1100525000 : Date;l_int2@1100528605 : Integer);
    BEGIN
      g_table := l_table;
      g_int1 := l_int1;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_code3 := l_code3;
      g_code4 := l_code4;
      g_date1 := l_date1;
      g_int2 := l_int2;
    END;

    [External]
    PROCEDURE SetSelectionObjSpecLines@1100528602(l_table@1100528600 : Integer;l_int1@1100528601 : Integer;l_code1@1100528602 : Code[20];l_int2@1100528605 : Integer;l_int3@1100528900 : Integer);
    BEGIN
      g_table := l_table;
      g_int1 := l_int1;
      g_code1 := l_code1;
      g_int2 := l_int2;
      g_int3 := l_int3;  //DP00118
    END;

    [External]
    PROCEDURE SetSelectionComplexSpecLines@1100528300(l_table@1100528600 : Integer;l_int1@1100528601 : Integer;l_code1@1100528602 : Code[20];l_int2@1100528605 : Integer);
    BEGIN
      g_table := l_table;
      g_int1 := l_int1;
      g_code1 := l_code1;
      g_int2 := l_int2;
    END;

    [External]
    PROCEDURE SetSelectionBuildings@1100528605(l_table@1100528602 : Integer;l_code1@1100528601 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
    END;

    [External]
    PROCEDURE SetSelectionBuildingObjectRels@1100528603(l_table@1100528603 : Integer;l_code1@1100528602 : Code[20];l_code2@1100528600 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
    END;

    [External]
    PROCEDURE SetSelectionLocSpecLines@1100528608(l_table@1100528600 : Integer;l_code1@1100528601 : Code[20];l_int1@1100528602 : Integer);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_int1 := l_int1;
    END;

    [External]
    PROCEDURE SetSelectionSurveyObjectSpecLines@1100528609(l_table@1100528602 : Integer;l_code1@1100528601 : Code[20];l_code2@1100528603 : Code[10];l_int1@1100528600 : Integer;l_int2@1100528604 : Integer);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
      g_code2 := l_code2;
      g_int1 := l_int1;
      g_int2 := l_int2;
    END;

    [External]
    PROCEDURE SetSelectionResources@1100528612(l_table@1100528604 : Integer);
    BEGIN
      g_table := l_table;
    END;

    [External]
    PROCEDURE SetSelectionEmployees@1100528400(l_table@1100528400 : Integer;l_int1@1100528401 : Integer;l_int2@1100528402 : Integer;l_code1@1100528403 : Code[20];l_int3@1100528404 : Integer;l_int4@1100528406 : Integer;l_text1@1100528405 : Text[30]);
    BEGIN
      g_table := l_table;
      g_int1 := l_int1;
      g_int2 := l_int2;
      g_code1 := l_code1;
      g_int3 := l_int3;
      g_int4 := l_int4;
      g_text1 := l_text1;
    END;

    [External]
    PROCEDURE SetSelectionServiceLocations@1100527401(l_table@1100527400 : Integer;l_code1@1100527401 : Code[20]);
    BEGIN
      g_table := l_table;
      g_code1 := l_code1;
    END;

    [External]
    PROCEDURE SplitDesc@1100485013(lvDesc@1100485000 : Text[100];lvMaxLen@1100485001 : Integer);
    VAR
      sep@1210190000 : Integer;
    BEGIN
      sep := STRPOS(lvDesc, '\');
      IF sep <> 0 THEN BEGIN
        desc1 := COPYSTR(lvDesc, 1, sep-1);
        desc2 := COPYSTR(lvDesc, sep+1, STRLEN(lvDesc)-sep);
      END ELSE BEGIN
        IF STRLEN(lvDesc) > lvMaxLen THEN BEGIN
          desc1 := COPYSTR(lvDesc, 1, lvMaxLen);
          desc2 := COPYSTR(lvDesc, lvMaxLen+1, lvMaxLen);
        END ELSE BEGIN
          desc1 := lvDesc;
          desc2 := '';
        END;
      END;

      desc1 := COPYSTR(desc1, 1, lvMaxLen);
      desc2 := COPYSTR(desc2, 1, lvMaxLen);
    END;

    [External]
    PROCEDURE CheckGap@1210190007();
    BEGIN
      Gap := ROUND((CurrLino - PrevLino) / (MarkNo + 1), 1);
      IF (Gap * MarkNo) >= (CurrLino - PrevLino) THEN Gap := 0;
      CurrLino := PrevLino;
    END;

    [External]
    PROCEDURE DetermineGLAccount@1210190006(lvProj@11012000 : Code[20]) : Code[20];
    VAR
      ProjSetUp@1210190002 : Record 315;
      ProjTypeRec@1210190000 : Record 11012009;
      lDimValRec@1100485003 : Record 349;
    BEGIN
      ProjSetUp.GET;
      IF ProjRec.GET(lvProj) THEN
        IF ProjTypeRec.GET(ProjRec."Project Type") THEN BEGIN
          EXIT(ProjTypeRec.GetWipAcc(ProjRec."Project Type",
                                     lDimValRec."Cost Type"::Material,
                                     ProjRec."Project Status",
                                     ProjSetUp."Provisions at Closure",
                                     COMPANYNAME,
                                     lDimValRec."Cost Type"::Material,'',''));
        END;
      EXIT('');
    END;

    [External]
    PROCEDURE CheckItemUnitConversion@1100525003(iItem@1100525000 : Code[20];iManufacturer@1100525001 : Code[20];iBasicItem@1100525002 : Code[20];iVendor@1100525003 : Code[20];iTradeItem@1100525004 : Code[20];VAR ioQuantity@1100525007 : Decimal;iUnitNew@1100525008 : Code[20];iUnitOld@1100525009 : Code[20]);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
      ValidateCu@1100525006 : Codeunit 11012033;
      ItemTypeOpt@1100525005 : 'Item,Basic Item,Trade Item,Trade Vendor';
    BEGIN
      //db, 16-09-09: M16105 (derived from function in EstLineRec)
      UnitFactorOld := 1;
      UnitFactorNew := 1;
      IF iTradeItem <> '' THEN BEGIN
        ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
          iItem,iBasicItem,iTradeItem,iManufacturer,iVendor,ioQuantity,iUnitNew,UnitFactorNew);
      END ELSE BEGIN
        IF iBasicItem <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
            iItem,iBasicItem,iTradeItem,iManufacturer,iVendor,ioQuantity,iUnitNew,UnitFactorNew);
        END ELSE BEGIN
          IF iItem <> '' THEN BEGIN
            ItemRec.GET(iItem);
            UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, iUnitOld);
            UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, iUnitNew);
            UnitFactor := UnitFactorOld;
            ValidateCu.ValidateUnit(ItemTypeOpt::Item,
              iItem,iBasicItem,iTradeItem,iManufacturer,iVendor,ioQuantity,iUnitNew,UnitFactorNew);
          END;
        END;
      END;
      {
      IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
        VALIDATE("Gross Price", ("Gross Price" * UnitFactorNew / UnitFactorOld));
        VALIDATE(Weight,(Weight * UnitFactorNew / UnitFactorOld));
      END;
      }
    END;

    [External]
    PROCEDURE CopyObjects@1100525002(VAR gvObjectRec@1100485000 : Record 11020334);
    VAR
      lvObjectRec@1100485001 : Record 11020334;
      ServiceEstimateLine@1100528600 : Record 11071806;
      ServSurvLocationObject@1100528601 : Record 11071813;
      ServiceSurvey@1100528602 : Record 11071803;
      LastLine@1100485002 : Integer;
    BEGIN
      lvObjectRec.COPY(gvObjectRec);
      WITH lvObjectRec DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        LastLine := 0;

        CASE g_table OF
          DATABASE::"Service Survey Structure Line":
            BEGIN
              ServiceEstimateLine.LOCKTABLE;
              ServiceEstimateLine.SETRANGE("Survey No.", g_code1);
              ServiceEstimateLine.SETRANGE("Location Code", g_code2);
              ServiceEstimateLine.SETRANGE("Structure No.", g_int1);
              ServiceEstimateLine.SETRANGE(Code, g_code3);
              IF ServiceEstimateLine.FINDLAST THEN
                LastLine := ServiceEstimateLine."Line No.";

             ServiceSurvey.GET(g_code1);
              REPEAT
                ServSurvLocationObject.INIT;
                ServSurvLocationObject."Survey No." := g_code1;
                ServSurvLocationObject."Location Code" := g_code2;
                ServSurvLocationObject."Seq. No." := 0;
                ServSurvLocationObject.INSERT(TRUE);
                ServSurvLocationObject.VALIDATE("Standard Object No.", "No.");
                IF ServiceSurvey."Service Package" <> '' THEN
                  ServSurvLocationObject.VALIDATE("Service Package", ServiceSurvey."Service Package");
                ServSurvLocationObject.VALIDATE(Quantity, 1);
                ServSurvLocationObject.MODIFY(TRUE);

                LastLine += 10000;
                ServiceEstimateLine.INIT;
                ServiceEstimateLine."Survey No." := g_code1;
                ServiceEstimateLine."Location Code" := g_code2;
                ServiceEstimateLine."Structure No." := g_int1;
                ServiceEstimateLine.VALIDATE(Code, g_code3);  //DP00978: evaluate Level and Element (1+2)
                ServiceEstimateLine."Line No." := LastLine;
                ServiceEstimateLine."Object Line" := TRUE;
                ServiceEstimateLine."Seq. No." := ServSurvLocationObject."Seq. No.";
                ServiceEstimateLine.INSERT(TRUE);
              UNTIL NEXT = 0;
            END;
          DATABASE::"Serv. Surv. Location Object":
            BEGIN
              ServiceSurvey.GET(g_code1);
              REPEAT
                ServSurvLocationObject.INIT;
                ServSurvLocationObject."Survey No." := g_code1;
                ServSurvLocationObject."Location Code" := g_code2;
                ServSurvLocationObject."Seq. No." := 0;
                ServSurvLocationObject.INSERT(TRUE);
                ServSurvLocationObject.VALIDATE("Standard Object No.", "No.");
                IF ServiceSurvey."Service Package" <> '' THEN
                  ServSurvLocationObject.VALIDATE("Service Package", ServiceSurvey."Service Package");
                ServSurvLocationObject.VALIDATE(Quantity, 1);
                ServSurvLocationObject.MODIFY(TRUE);
              UNTIL NEXT = 0;
            END;
          ELSE
            MESSAGE(Text001);
        END;
      END;

      gvObjectRec.CLEARMARKS;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyBaseRecipes@1100528900(VAR gvBaseRecipe@1100485000 : Record 11020581);
    VAR
      BaseRecipe@1100485001 : Record 11020581;
      BaseRecipeLine@1100529601 : Record 11020582;
      RawElemRec@1210190000 : Record 11125679;
      CommentLineRAW@1100525000 : Record 11125684;
      EstimateLine@1100529402 : Record 11072072;
      EstimateRecipeLine@1100529401 : Record 11072075;
      SalesLine@1100529400 : Record 37;
      SalesRecipeLine@1100529403 : Record 11229789;
      LastLine@1100485002 : Integer;
      InsertLine@1100529600 : Boolean;
      EntityOption@1100525001 : Option;
    BEGIN
      //DP00381
      BaseRecipe.COPY(gvBaseRecipe);
      WITH BaseRecipe DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        //C027336.sn
        MarkNo := COUNT;
        CurrLino := g_int1;
        PrevLino := 0;
        Gap := 0;
        //C027336.en
        LastLine := 0;

        CASE g_table OF
          DATABASE::"Advice Order Line":
            BEGIN
              REPEAT
                TESTFIELD(Blocked, FALSE);
                AdviceRec.INIT;
                AdviceRec."Project No." := g_code1;
                IF g_code2 <> '' THEN   //db, 25-05-10: M19006
                  AdviceRec.VALIDATE("Service Order No.", g_code2);
                AdviceRec.Element := g_code3;
                AdviceRec."Extension Contract" := g_code4;
                IF AdviceRec."Project No." <> '' THEN
                  AdviceRec."Record Type" := AdviceRec."Record Type"::Project;
                IF AdviceRec."Service Order No." <> '' THEN
                  AdviceRec."Record Type" := AdviceRec."Record Type"::ServOrder;
                AdviceRec.InitRecord;  //db, 23-06-09: M15627
                AdviceRec."Purchaser Code" := AdviceRec.GetDefaultPurchaser(g_code1, '');
                //db.sn, 24-06-11: M15569
                AdviceRec.Recipe := "No.";
                AdviceRec."Recipe Group" := "Recipe Group";
                SplitDesc(Description, MAXSTRLEN(AdviceRec.Description));
                AdviceRec.Description := desc1;
                AdviceRec."Description 2" := desc2;
                AdviceRec."Unit of Measure" := "Unit of Measure";
                AdviceRec."Cost Type" := AdviceRec."Cost Type"::Sundry;
                AdviceRec."Source Type" := AdviceRec."Source Type"::"Recipe Header";
                AdviceRec."Quantity (Advice)" := 1;  //db, 21-12-11: avoid problem with zero-lines; with header all lines are deleted
                AdviceRec.VALIDATE("Line No.", 0);
                AdviceRec.INSERT(TRUE);
                LastLine := AdviceRec."Line No.";
                //db.en, 24-06-11: M15569
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Project Material Req. Line":  //DP01732
            BEGIN
              IF g_code3 <> '' THEN
                EVALUATE(EntityOption, g_code3);
              ProjectMaterialReqLine.LOCKTABLE;
              ProjectMaterialReqLine.SETRANGE("Project No.",g_code1);
              ProjectMaterialReqLine.SETRANGE("Yard No.",g_code2);
              ProjectMaterialReqLine.SETRANGE("Entity Type",EntityOption);
              ProjectMaterialReqLine.SETRANGE("System No.",g_code4);
              ProjectMaterialReqLine.SETRANGE("Entity No.",g_code5);
              IF ProjectMaterialReqLine.FINDLAST THEN
                LastLine := ProjectMaterialReqLine."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                LastLine := LastLine + 10000;
                ProjectMaterialReqLine.INIT;
                ProjectMaterialReqLine."Project No." := g_code1;
                ProjectMaterialReqLine."Yard No." := g_code2;
                ProjectMaterialReqLine."Entity Type" := EntityOption;
                ProjectMaterialReqLine."System No." := g_code4;
                ProjectMaterialReqLine."Entity No." := g_code5;
                ProjectMaterialReqLine."Line No." := LastLine;
                ProjectMaterialReqLine.Recipe := "No.";
                ProjectMaterialReqLine."Recipe Group" := "Recipe Group";
                ProjectMaterialReqLine."Source Type" := ProjectMaterialReqLine."Source Type"::"Recipe Header";
                ProjectMaterialReqLine.Description := Description;
                ProjectMaterialReqLine."Unit of Measure" := "Unit of Measure";
                ProjectMaterialReqLine.Element := g_code6;
                ProjectMaterialReqLine.INSERT(TRUE);
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Estimate Part Line":  //DP00381
            BEGIN
              NewPartLineRec.LOCKTABLE;
              NewPartLineRec.SETRANGE("Part Group",g_code3);
              NewPartLineRec.SETRANGE(Part,g_code4);
              IF NewPartLineRec.FINDLAST THEN
                LastLine := NewPartLineRec."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                LastLine := LastLine + 10000;
                NewPartLineRec.INIT;
                NewPartLineRec."Part Group" := g_code3;
                NewPartLineRec.Part := g_code4;
                NewPartLineRec."Line No." := LastLine;
                NewPartLineRec.Recipe := "No.";
                NewPartLineRec."Recipe Group" := "Recipe Group";
                NewPartLineRec.Description := Description;
                NewPartLineRec."Unit of Measure" := "Unit of Measure";
                NewPartLineRec."Cost Type (Price)" := NewPartLineRec."Cost Type (Price)"::" ";  //C026231
                NewPartLineRec.INSERT(TRUE);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Base Recipe Line":  //DP00381
            BEGIN
              BaseRecipeLineRec.LOCKTABLE;
              BaseRecipeLineRec.SETRANGE("Recipe Group",g_code3);
              BaseRecipeLineRec.SETRANGE(Recipe,g_code4);
              IF BaseRecipeLineRec.FINDLAST THEN
                LastLine := BaseRecipeLineRec."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                LastLine := LastLine + 10000;
                BaseRecipeLineRec.INIT;
                BaseRecipeLineRec."Recipe Group" := g_code3;
                BaseRecipeLineRec.Recipe := g_code4;
                BaseRecipeLineRec."Line No." := LastLine;
                BaseRecipeLineRec."Recipe Group (Child)" := "Recipe Group";
                BaseRecipeLineRec.VALIDATE("Recipe (Child)", "No.");  //C033781 (InitSurcharge)
                BaseRecipeLineRec.Description := Description;
                BaseRecipeLineRec."Unit of Measure" := "Unit of Measure";
                BaseRecipeLineRec."Cost Type (Price)" := BaseRecipeLineRec."Cost Type (Price)"::" ";  //C026231
                BaseRecipeLineRec.INSERT(TRUE);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Estimate Line":  //DP00381
            BEGIN
              NewEstLineRec.LOCKTABLE;
              NewEstLineRec.SETRANGE("Estimate No.", g_code1);
              NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
              NewEstLineRec.SETRANGE("Part Group",g_code3);
              NewEstLineRec.SETRANGE(Part,g_code4);
              //C027336.sn
              //IF NewEstLineRec.FINDLAST THEN
              //  LastLine := NewEstLineRec."Line No.";
              IF NewEstLineRec.GET(g_code1, g_code2, g_code3, g_code4, CurrLino) THEN BEGIN
                NewEstLineRec.SETFILTER("Line No.", '<%1', CurrLino);
                IF NewEstLineRec.FINDLAST THEN PrevLino := NewEstLineRec."Line No.";
                NewEstLineRec.SETRANGE("Line No.");
                CheckGap;
              END;
              IF Gap = 0 THEN BEGIN
                Gap := 10000;
                IF NewEstLineRec.FINDLAST THEN
                  CurrLino := NewEstLineRec."Line No.";
              END;
              //C027336.en

              REPEAT
                TESTFIELD(Blocked, FALSE);
                //LastLine := LastLine + 10000;  //C027336.o
                NewEstLineRec.INIT;
                NewEstLineRec."Estimate No." := g_code1;
                NewEstLineRec."Sub-Estimate No." := g_code2;
                NewEstLineRec."Part Group" := g_code3;
                NewEstLineRec.Part := g_code4;
                NewEstLineRec.InitRecord;
                //C027336.sn
                //NewEstLineRec."Line No." := LastLine;
                NewEstLineRec."Line No." := CurrLino + Gap;
                CurrLino := NewEstLineRec."Line No.";
                //C027336.en
                NewEstLineRec.Recipe := "No.";
                NewEstLineRec."Recipe Group" := "Recipe Group";
                NewEstLineRec.Description := Description;
                NewEstLineRec."Unit of Measure" := "Unit of Measure";
                NewEstLineRec.Manufacturer := Manufacturer;
                NewEstLineRec.CopyRecipe();
                NewEstLineRec."Cost Type (Price)" := NewEstLineRec."Cost Type (Price)"::" ";  //C026231
                NewEstLineRec.INSERT(TRUE);
                NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
                NewEstLineRec.VALIDATE("Quantity Sheet Feature", "Quantity Sheet Feature");  //DP00686
                NewEstLineRec.MODIFY;
              UNTIL NEXT = 0;
              NewEstLineRec.CheckUpdateQuantityFromRelation(
                NewEstLineRec."Estimate No.", NewEstLineRec."Sub-Estimate No.",
                NewEstLineRec."Part Group", NewEstLineRec.Part);   //DP00686
            END;

          DATABASE::"Estimate Line RAW":  //DP01676
            BEGIN
              EstimateLineRAW.LOCKTABLE;
              EstimateLineRAW.SETRANGE("Estimate No.", g_code1);
              EstimateLineRAW.SETRANGE("Tender Paragraph No.", g_code2);

              RawElemRec.SETRANGE("Estimate No.", g_code1);
              RawElemRec.SETRANGE("Tender Paragraph No.", g_code2);
              RawElemRec.SETFILTER("Construction Spec. Line No.", '00');
              IF NOT RawElemRec.FINDSET THEN
                RawElemRec.INIT;

              REPEAT
                TESTFIELD(Blocked, FALSE);
                IF EstimateLineRAW.FINDLAST THEN
                  LastLine := EstimateLineRAW."Line No.";

                EstimateLineRAW.INIT;
                EstimateLineRAW."Estimate No." := g_code1;
                EstimateLineRAW."Tender Paragraph No." := g_code2;
                EstimateLineRAW."Line No." := LastLine + 10000;
                EstimateLineRAW.INSERT(TRUE);
                EstimateLineRAW.Source := EstimateLineRAW.Source::User;  //do not used Source::Recipe
                EstimateLineRAW."Recipe Type" := EstimateLineRAW."Recipe Type"::"Recipe Header";
                EstimateLineRAW."Recipe No." := "No.";
                EstimateLineRAW."Recipe Group" := "Recipe Group";
                EstimateLineRAW.Description := Description;
                EstimateLineRAW."Unit of Measure" := "Unit of Measure";
                EstimateLineRAW.Quantity := 1;
                EstimateLineRAW.VALIDATE("Part Quantity", RawElemRec.Quantity);
                EstimateLineRAW."Appliance Type" := EstimateLineRAW."Appliance Type"::Recipe;  //DP01619
                EstimateLineRAW."Appliance Code" := EstimateLineRAW."Recipe No.";  //DP01619
                EstimateLineRAW.MODIFY;
                CommentLineRAW.CopyCommentRecipeToEstLine(EstimateLineRAW."Recipe Group", EstimateLineRAW."Recipe No.", 0, EstimateLineRAW);  //DP01086

                LastLine := EstimateLineRAW."Line No.";  //DP01619
                EstimateLineRAW.AddLineFromStandardRecipe(
                  EstimateLineRAW."Estimate No.", EstimateLineRAW."Tender Paragraph No.",
                  EstimateLineRAW."Recipe Group", EstimateLineRAW."Recipe No.",
                  EstimateLineRAW."Line No.",
                  EstimateLineRAW."Recipe Type"::"Recipe Line",
                  EstimateLineRAW."Part Quantity",
                  EstimateLineRAW.Source,
                  LastLine);  //DP01619: explode child-recipe
              UNTIL NEXT = 0;
            END;

          DATABASE::"Estimate Recipe Line":   //DP01183
            BEGIN
              REPEAT
                TESTFIELD(Blocked, FALSE);
                EstimateRecipeLine.LOCKTABLE;
                EstimateRecipeLine.SETRANGE("Estimate No.", g_code1);
                EstimateRecipeLine.SETRANGE("Sub-Estimate No.", g_code2);
                EstimateRecipeLine.SETRANGE("Part Group",g_code3);
                EstimateRecipeLine.SETRANGE(Part,g_code4);
                EstimateRecipeLine.SETRANGE("Estimate Line",g_int1);
                IF EstimateRecipeLine.FINDLAST THEN
                  LastLine := EstimateRecipeLine."Line No.";
                //
                EstimateRecipeLine.INIT;
                EstimateRecipeLine."Estimate No." := g_code1;
                EstimateRecipeLine."Sub-Estimate No." := g_code2;
                EstimateRecipeLine."Part Group" := g_code3;
                EstimateRecipeLine.Part := g_code4;
                EstimateRecipeLine."Estimate Line" := g_int1;
                EstimateRecipeLine."Recipe Group" := g_code5;
                EstimateRecipeLine.Recipe := g_code6;
                EstimateRecipeLine."Line No." := LastLine + 10000;
                LastLine := EstimateRecipeLine."Line No.";
                EstimateRecipeLine.INSERT(TRUE);
                //
                EstimateRecipeLine."Recipe Header" := TRUE;
                EstimateRecipeLine."Recipe Exploded" := FALSE;
                EstimateRecipeLine."Recipe Level" := 0;
                EstimateRecipeLine."Recipe (Child)" := "No.";
                EstimateRecipeLine."Recipe Group (Child)" := "Recipe Group";
                EstimateRecipeLine.Description := Description;
                EstimateRecipeLine."Unit of Measure" := "Unit of Measure";
                EstimateRecipeLine.Quantity := 1;
                EstimateRecipeLine.UpdateSalesQuantity;
                EstimateRecipeLine.MODIFY;
                //
                EstimateLine.GET(g_code1, g_code2, g_code3, g_code4, g_int1);
                EstimateLine.ExplodeRecipe();
              UNTIL NEXT = 0;
            END;

          DATABASE::"Sales Recipe Line":   //DP01183
            BEGIN
              REPEAT
                TESTFIELD(Blocked, FALSE);
                SalesRecipeLine.LOCKTABLE;
                IF g_code1 = 'ORDER' THEN
                  SalesRecipeLine.SETRANGE("Sales Document Type", SalesRecipeLine."Sales Document Type"::Order);
                IF g_code1 = 'QUOTE' THEN
                  SalesRecipeLine.SETRANGE("Sales Document Type", SalesRecipeLine."Sales Document Type"::Quote);
                SalesRecipeLine.SETRANGE("Sales Document No.", g_code2);
                SalesRecipeLine.SETRANGE("Sales Line No.",g_int1);
                SalesRecipeLine.SETRANGE("Recipe Group",g_code3);
                SalesRecipeLine.SETRANGE(Recipe,g_code4);
                IF SalesRecipeLine.FINDLAST THEN
                  LastLine := SalesRecipeLine."Line No.";
                //
                SalesRecipeLine.INIT;
                IF g_code1 = 'ORDER' THEN
                  SalesRecipeLine."Sales Document Type" := SalesRecipeLine."Sales Document Type"::Order;
                IF g_code1 = 'QUOTE' THEN
                  SalesRecipeLine."Sales Document Type" := SalesRecipeLine."Sales Document Type"::Quote;
                SalesRecipeLine."Sales Document No." := g_code2;
                SalesRecipeLine."Sales Line No." := g_int1;
                SalesRecipeLine."Recipe Group" := g_code3;
                SalesRecipeLine.Recipe := g_code4;
                SalesRecipeLine."Line No." := LastLine + 10000;
                LastLine := SalesRecipeLine."Line No.";
                SalesRecipeLine.INSERT(TRUE);
                //
                SalesRecipeLine."Recipe Header" := TRUE;
                SalesRecipeLine."Recipe Exploded" := FALSE;
                SalesRecipeLine."Recipe Level" := 0;
                SalesRecipeLine."Recipe (Child)" := "No.";
                SalesRecipeLine."Recipe Group (Child)" := "Recipe Group";
                SalesRecipeLine.Description := Description;
                SalesRecipeLine."Unit of Measure" := "Unit of Measure";
                SalesRecipeLine.Quantity := 1;
                SalesRecipeLine.UpdateSalesQuantity;
                SalesRecipeLine.MODIFY;
                //
                SalesLine.GET(SalesRecipeLine."Sales Document Type", SalesRecipeLine."Sales Document No.", SalesRecipeLine."Sales Line No.");
                SalesLine.ExplodeRecipe();
              UNTIL NEXT = 0;
            END;

          DATABASE::"Project Cost Plus Entry":   //DP01183
            BEGIN
              ProjCostPlusRec.LOCKTABLE;
              ProjCostPlusRec.SETRANGE("Project No.", g_code1);
              ProjCostPlusRec.SETRANGE(Principal, g_code2);
              ProjCostPlusRec.SETRANGE("Commission No.", g_code3);
              ProjCostPlusRec.SETRANGE("Settl.Sheet No.", g_code4);
              IF ProjCostPlusRec.FINDLAST THEN
                LastLine := ProjCostPlusRec."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                //
                ProjCostPlusRec.INIT;
                ProjCostPlusRec."Project No." := g_code1;
                ProjCostPlusRec.Principal := g_code2;
                ProjCostPlusRec."Commission No." := g_code3;
                ProjCostPlusRec."Settl.Sheet No." := g_code4;
                ProjCostPlusRec."Line No." := LastLine + 10000;
                LastLine := ProjCostPlusRec."Line No.";
                ProjCostPlusRec.INSERT(TRUE);
                //
                ProjCostPlusRec."Recipe Header" := TRUE;
                ProjCostPlusRec.Recipe := "No.";
                ProjCostPlusRec."Recipe Group" := "Recipe Group";
                SplitDesc(Description, MAXSTRLEN(ProjCostPlusRec.Description));
                ProjCostPlusRec.Description := desc1;
                ProjCostPlusRec."Description 2" := desc2;
                ProjCostPlusRec."Unit of Measure" := "Unit of Measure";
                ProjCostPlusRec.Quantity := 1;
                ProjCostPlusRec.MODIFY;
                //
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Service Order Cost Plus Entry":   //DP01183
            BEGIN
              ServCostPlusRec.LOCKTABLE;
              ServCostPlusRec.SETRANGE("Service Order No.", g_code1);
              IF ServCostPlusRec.FINDLAST THEN
                LastLine := ServCostPlusRec."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                //
                ServCostPlusRec.INIT;
                ServCostPlusRec.VALIDATE("Service Order No.", g_code1); //mg
                ServCostPlusRec."Line No." := LastLine + 10000;
                LastLine := ServCostPlusRec."Line No.";
                ServCostPlusRec.INSERT(TRUE);
                //
                ServCostPlusRec."Recipe Header" := TRUE;
                ServCostPlusRec.Recipe := "No.";
                ServCostPlusRec."Recipe Group" := "Recipe Group";
                SplitDesc(Description, MAXSTRLEN(ServCostPlusRec.Description));
                ServCostPlusRec.Description := desc1;
                ServCostPlusRec."Description 2" := desc2;
                ServCostPlusRec."Unit of Measure" := "Unit of Measure";
                ServCostPlusRec.Quantity := 1;
                ServCostPlusRec.MODIFY;
                //
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
              UNTIL NEXT = 0;
            END;

         DATABASE::"Service Order Budget Line":   //DP01560
            BEGIN
              ServiceOrderBudgetLine.LOCKTABLE;
              ServiceOrderBudgetLine.SETRANGE("Service Order No.", g_code1);
              ServiceOrderBudgetLine.SETRANGE("Service Contract No.", g_code2);
              ServiceOrderBudgetLine.SETRANGE("Object No.", g_code3);
              ServiceOrderBudgetLine.SETRANGE("Maintenance Scheme", g_code4);
              ServiceOrderBudgetLine.SETRANGE("Budget Type", ServiceOrderBudgetLine."Budget Type"::Order);
              IF ServiceOrderBudgetLine.FINDLAST THEN
                LastLine := ServiceOrderBudgetLine."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                //
                ServiceOrderBudgetLine.INIT;
                ServiceOrderBudgetLine."Budget Type" := ServiceOrderBudgetLine."Budget Type"::Order;
                ServiceOrderBudgetLine.VALIDATE("Service Order No.", g_code1);
                ServiceOrderBudgetLine."Service Contract No." :=  g_code2;
                ServiceOrderBudgetLine."Object No." :=  g_code3;
                ServiceOrderBudgetLine."Maintenance Scheme" := g_code4;
                ServiceOrderBudgetLine."Line No." := LastLine + 10000;
                LastLine := ServiceOrderBudgetLine."Line No.";
                ServiceOrderBudgetLine.INSERT(TRUE);
                //
                ServiceOrderBudgetLine."Source Type (Recipe/BOM)" := ServiceOrderBudgetLine."Source Type (Recipe/BOM)"::"Recipe Header";
                ServiceOrderBudgetLine.Recipe := "No.";
                ServiceOrderBudgetLine."Recipe Group" := "Recipe Group";
                SplitDesc(Description, MAXSTRLEN(ServiceOrderBudgetLine.Description));
                ServiceOrderBudgetLine.Description := desc1;
                ServiceOrderBudgetLine."Description 2" := desc2;
                ServiceOrderBudgetLine."Unit of Measure" := "Unit of Measure";
                ServiceOrderBudgetLine.Quantity := 1;
                ServiceOrderBudgetLine.MODIFY;
                //
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Recipes by Combination":
            BEGIN
              REPEAT
                TESTFIELD(Blocked, FALSE);
                RcpCombRec.INIT;
                RcpCombRec."Feature Group" := g_code1;
                RcpCombRec."Feature Cluster" := g_code2;
                RcpCombRec."Feature Combination" := g_code3;
                RcpCombRec."Sub-Estimate Level" := g_code4;
                RcpCombRec.Recipe := "No.";
                RcpCombRec."Recipe Group" := "Recipe Group";
                RcpCombRec.INSERT(TRUE);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Budget Line":
            BEGIN
              BudgetLineRec.LOCKTABLE;
              BudgetLineRec.SETRANGE("Project No.",g_code1);
              BudgetLineRec.SETRANGE("Extension Contract",g_code2);
              BudgetLineRec.SETRANGE(Adjustment,g_code3);
              BudgetLineRec.SETRANGE(Option, '');
              IF BudgetLineRec.FINDLAST THEN
                LastLine := BudgetLineRec."Line No.";

              REPEAT
                TESTFIELD(Blocked, FALSE);
                LastLine := LastLine + 10000;
                BudgetLineRec.INIT;
                BudgetLineRec."Project No." := g_code1;
                BudgetLineRec."Extension Contract" := g_code2;
                BudgetLineRec.Adjustment := g_code3;
                BudgetLineRec."Line No." := LastLine;
                BudgetLineRec.Element := g_code4;
                IF g_code1 <> '' THEN BEGIN
                  ProjRec.GET(g_code1);
                  BudgetLineRec."Version Date" := ProjRec."Version Date";
                END;
                IF g_code2 <> '' THEN BEGIN
                  ExtRec.GET(g_code1, g_code2);
                  BudgetLineRec."Version Date" := ExtRec."Version Date";
                END;
                IF g_code3 <> '' THEN BEGIN
                  AdjRec.GET(g_code1, g_code3);
                  BudgetLineRec."Version Date" := AdjRec."Version Date";
                END;
                BudgetLineRec.FillElementPhaseCodeBasedOnElement;
                BudgetLineRec.Recipe := "No.";
                BudgetLineRec."Recipe Group" := "Recipe Group";
                SplitDesc(Description, MAXSTRLEN(BudgetLineRec.Description));  //db, 17-06-10: M19845
                BudgetLineRec.Description := desc1;
                BudgetLineRec."Description 2" := desc2;
                BudgetLineRec."Unit of Measure" := "Unit of Measure";
                BudgetLineRec."Cost Type" := BudgetLineRec."Cost Type"::Sundry;
                BudgetLineRec."Source Type" := BudgetLineRec."Source Type"::"Recipe Header";
                BudgetLineRec.Quantity := 1;  //DP02339
                BudgetLineRec.INSERT(TRUE);
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
                IF RcpQuan <> 0 THEN BEGIN
                  BudgetLineRec.VALIDATE(Quantity, RcpQuan);
                  BudgetLineRec.MODIFY(TRUE);
                END;
              UNTIL NEXT = 0;
            END;

          DATABASE::"Option Budget":
            BEGIN
              BudgetOptionRec.LOCKTABLE;
              BudgetOptionRec.SETRANGE("Project No.",g_code1);
              BudgetOptionRec.SETRANGE("Plot No.",g_code2);
              BudgetOptionRec.SETRANGE("House Model",g_code6);
              BudgetOptionRec.SETRANGE("Main Group",g_code7);
              BudgetOptionRec.SETRANGE(Group,g_code8);
              BudgetOptionRec.SETRANGE("Sub Group",g_code9);
              BudgetOptionRec.SETRANGE(Option,g_code3);

              InsertLine := TRUE;
              IF g_int1 <> 0 THEN
                IF BudgetOptionRec.GET(g_code1, g_code2, g_code6, g_code7, g_code8, g_code9, g_code3, g_int1) THEN BEGIN
                  IF BudgetOptionRec.LineIsEmpty THEN
                    InsertLine := FALSE;
                  LastLine := BudgetOptionRec."Line No.";
                  PrevLino := BudgetOptionRec."Line No.";

                  BudgetOptionRec.SETFILTER("Line No.", '>%1', LastLine);
                  IF BudgetOptionRec.FINDFIRST THEN BEGIN
                    CurrLino := BudgetOptionRec."Line No.";
                    MarkNo := 0;
                    REPEAT
                      BaseRecipeLine.SETRANGE("Recipe Group", "Recipe Group");
                      BaseRecipeLine.SETRANGE(Recipe, "No.");
                      MarkNo += (BaseRecipeLine.COUNT * 2) + 1;
                    UNTIL NEXT = 0;
                    FINDSET;
                    CheckGap;
                  END;
                  BudgetOptionRec.SETRANGE("Line No.");
                  IF NOT InsertLine THEN
                    BudgetOptionRec.GET(g_code1, g_code2, g_code6, g_code7, g_code8, g_code9, g_code3, g_int1);
                END;

              IF InsertLine AND (LastLine = 0) THEN
                IF BudgetOptionRec.FINDLAST THEN
                  LastLine := BudgetOptionRec."Line No.";
              IF Gap = 0 THEN
                RecipeLineGap := 10000
              ELSE
                RecipeLineGap := Gap;

              REPEAT
                TESTFIELD(Blocked, FALSE);
                IF InsertLine THEN BEGIN
                  LastLine := LastLine + RecipeLineGap;
                  BudgetOptionRec.INIT;
                  BudgetOptionRec."Project No." := g_code1;
                  BudgetOptionRec."Plot No." := g_code2;
                  BudgetOptionRec."House Model" := g_code6;
                  BudgetOptionRec."Main Group" := g_code7;
                  BudgetOptionRec.Group := g_code8;
                  BudgetOptionRec."Sub Group" := g_code9;
                  BudgetOptionRec.Option := g_code3;
                  BudgetOptionRec."Line No." := LastLine;
                END;
                BudgetOptionRec.Element := g_code4;
                BudgetOptionRec.Recipe := "No.";
                BudgetOptionRec."Recipe Group" := "Recipe Group";
                SplitDesc(Description, MAXSTRLEN(BudgetOptionRec.Description));  //db, 17-06-10: M19845
                BudgetOptionRec.Description := desc1;
                BudgetOptionRec."Description 2" := desc2;
                BudgetOptionRec."Unit of Measure" := "Unit of Measure";
                BudgetOptionRec."Cost Type" := BudgetOptionRec."Cost Type"::Sundry;
                BudgetOptionRec."Source Type" := BudgetOptionRec."Source Type"::"Recipe Header";
                BudgetOptionRec.Quantity := 1;  //DP02339
                IF InsertLine THEN
                  BudgetOptionRec.INSERT(TRUE)
                ELSE
                  BudgetOptionRec.MODIFY(TRUE);
                CopyBaseRecipeLine("Recipe Group", "No.", LastLine, LastLine, 1);
                IF RcpQuan <> 0 THEN BEGIN
                  BudgetOptionRec.VALIDATE(Quantity, RcpQuan);
                  BudgetOptionRec.MODIFY(TRUE);
                END;
                InsertLine := TRUE;
              UNTIL NEXT = 0;
            END;
          ELSE
            MESSAGE(Text001);
        END;
      END;

      gvBaseRecipe.CLEARMARKS;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyBaseRecipeLine@1100528901(lvRcpGrp@1210190000 : Code[20];lvRcp@1210190001 : Code[20];VAR LastLine@1100485001 : Integer;HeaderLine@1100525001 : Integer;lvQuan@1100485000 : Decimal);
    VAR
      SaveRcpLineRec@1100525000 : Record 11020582;
      SurchargeQuantity@1100525002 : Decimal;
      LineProcessed@1100525003 : Boolean;
    BEGIN
      //db, 02-02-09: header line
      SaveRcpLineRec.COPY(BaseRecipeLineRec);  //db, 18-11-09: M17024

      IF RecipeLineGap = 0 THEN
        RecipeLineGap := 10000;

      BaseRecipeLineRec.RESET;
      BaseRecipeLineRec.SETRANGE("Recipe Group", lvRcpGrp);
      BaseRecipeLineRec.SETRANGE(Recipe, lvRcp);
      IF BaseRecipeLineRec.FINDSET THEN BEGIN
        REPEAT
          LineProcessed := FALSE;
          IF BaseRecipeLineRec."Recipe (Child)" <> '' THEN BEGIN
            CopyBaseRecipeLine(BaseRecipeLineRec."Recipe Group (Child)", BaseRecipeLineRec."Recipe (Child)",
              LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity);
            LineProcessed := TRUE;
          END ELSE BEGIN
            //db.sn, 20-03-15: C018810
            SurchargeQuantity := 1;
            IF BaseRecipeLineRec.Norm <> 0 THEN BEGIN
              IF BaseRecipeLineRec."Surcharge %" <> 0 THEN
                IF BaseRecipeLineRec."Surcharge Type" = BaseRecipeLineRec."Surcharge Type"::Labor THEN
                  SurchargeQuantity := BaseRecipeLineRec."Surcharge %" / 100;
              SplitBaseRecipeLine(1, LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity*SurchargeQuantity);
              LineProcessed := TRUE;
            END;
            IF BaseRecipeLineRec."Net Cost Price" <> 0 THEN BEGIN  //DP01727: required for check on CostType<>Labor
              IF BaseRecipeLineRec."Cost Type (Price)" = BaseRecipeLineRec."Cost Type (Price)"::Material THEN BEGIN
                IF BaseRecipeLineRec."Surcharge %" <> 0 THEN
                  IF BaseRecipeLineRec."Surcharge Type" = BaseRecipeLineRec."Surcharge Type"::Material THEN
                    SurchargeQuantity := BaseRecipeLineRec."Surcharge %" / 100;
                SplitBaseRecipeLine(2, LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity*SurchargeQuantity);
                LineProcessed := TRUE;
              END;
              IF BaseRecipeLineRec."Cost Type (Price)" = BaseRecipeLineRec."Cost Type (Price)"::Subcontracting THEN BEGIN
                IF BaseRecipeLineRec."Surcharge %" <> 0 THEN
                  IF BaseRecipeLineRec."Surcharge Type" = BaseRecipeLineRec."Surcharge Type"::Subcontracting THEN
                    SurchargeQuantity := BaseRecipeLineRec."Surcharge %" / 100;
                SplitBaseRecipeLine(3, LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity*SurchargeQuantity);
                LineProcessed := TRUE;
              END;
              IF BaseRecipeLineRec."Cost Type (Price)" = BaseRecipeLineRec."Cost Type (Price)"::Plant THEN BEGIN
                IF BaseRecipeLineRec."Surcharge %" <> 0 THEN
                  IF BaseRecipeLineRec."Surcharge Type" = BaseRecipeLineRec."Surcharge Type"::Plant THEN
                    SurchargeQuantity := BaseRecipeLineRec."Surcharge %" / 100;
                SplitBaseRecipeLine(4, LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity*SurchargeQuantity);
                LineProcessed := TRUE;
              END;
              IF BaseRecipeLineRec."Cost Type (Price)" = BaseRecipeLineRec."Cost Type (Price)"::Sundry THEN BEGIN
                IF BaseRecipeLineRec."Surcharge %" <> 0 THEN
                  IF BaseRecipeLineRec."Surcharge Type" = BaseRecipeLineRec."Surcharge Type"::Sundry THEN
                    SurchargeQuantity := BaseRecipeLineRec."Surcharge %" / 100;
                SplitBaseRecipeLine(5, LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity*SurchargeQuantity);
                LineProcessed := TRUE;
              END;
            END;
            //db.en, 20-03-15: C018810
            IF NOT LineProcessed THEN
              SplitBaseRecipeLine(0, LastLine, HeaderLine, lvQuan*BaseRecipeLineRec.Quantity);  //C036523
          END;
        UNTIL BaseRecipeLineRec.NEXT = 0;
      END;

      BaseRecipeLineRec.COPY(SaveRcpLineRec);  //db, 18-11-09: M17024
    END;

    [External]
    PROCEDURE SplitBaseRecipeLine@1100528902(CostTypeInt@1000000000 : Integer;VAR LastLine@1100485000 : Integer;HeaderLine@1100525001 : Integer;lvQuan@1100485002 : Decimal);
    VAR
      OptionLineRec@1210190000 : Record 11012503;
      lvAdviceRec@1100485001 : Record 11012055;
      lvBudgetLineRec@1100525000 : Record 11012001;
      lvProjCostPlusRec@1100529402 : Record 11012019;
      lvServCostPlusRec@1100529401 : Record 11012825;
      lvHourRateRec@1100529400 : Record 11012022;
      lvServiceOrderBudgetLine@1100525002 : Record 11012875;
      lvProjectMaterialReqLine@1100525003 : Record 11012526;
      RateAmount@1100528900 : Decimal;
    BEGIN
      //db, 02-02-09: header line
      CASE g_table OF
        DATABASE::"Advice Order Line":
          BEGIN
            IF CostTypeInt = 1 THEN EXIT;
            lvAdviceRec := AdviceRec;
            //db.sn, 24-06-11: M15569
            lvAdviceRec."Source Type" := lvAdviceRec."Source Type"::"Recipe Line";
            lvAdviceRec."Attached to Line No." := HeaderLine;
            //db.en, 24-06-11: M15569
            //lvAdviceRec."Quantity (Advice)" := BaseRecipeLineRec.Quantity;
            lvAdviceRec."Quantity (Advice)" := lvQuan;  //db, 18-11-09: M17024
            lvAdviceRec."Original Quantity" := lvAdviceRec."Quantity (Advice)";  //DP02339
            lvAdviceRec."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            lvAdviceRec."Cost Component" := BaseRecipeLineRec."Cost Component";
            IF BaseRecipeLineRec.Element <> '' THEN
              lvAdviceRec.Element := BaseRecipeLineRec.Element;  //db, 26-11-08: M13466

            CASE CostTypeInt OF
              2:BEGIN
                  lvAdviceRec."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
                  lvAdviceRec.Manufacturer := BaseRecipeLineRec.Manufacturer;
                  IF BaseRecipeLineRec."Trade Item" <> '' THEN
                    lvAdviceRec.VALIDATE("Trade Item", BaseRecipeLineRec."Trade Item")
                  ELSE
                    IF BaseRecipeLineRec."Basic Item" <> '' THEN
                      lvAdviceRec.VALIDATE("Basic Item", BaseRecipeLineRec."Basic Item")
                    ELSE
                      IF BaseRecipeLineRec."Item No." <> '' THEN
                        lvAdviceRec.VALIDATE("Item No.", BaseRecipeLineRec."Item No.")
                      ELSE
                        lvAdviceRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  IF BaseRecipeLineRec."Price Agreement" THEN  //C045565
                    lvAdviceRec.VALIDATE("Price (LCY)", BaseRecipeLineRec."Net Cost Price");
                  lvAdviceRec."Cost Type" := lvAdviceRec."Cost Type"::Material;
                  lvAdviceRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                  IF BaseRecipeLineRec.Vendor <> '' THEN  //db, 11-11-09: M16996
                    lvAdviceRec.Vendor := BaseRecipeLineRec.Vendor;
                  //db.sn, 18-01-11: M25004
                  lvAdviceRec."Scheme Code" := BaseRecipeLineRec."Scheme Code";
                  lvAdviceRec."Comments for Logistics" := BaseRecipeLineRec."Comments for Logistics";
                  //db.en, 18-01-11: M25004
                END;
              3:BEGIN
                  lvAdviceRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvAdviceRec."Cost Type" := lvAdviceRec."Cost Type"::Subcontracting;
                  lvAdviceRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                  lvAdviceRec.Vendor := BaseRecipeLineRec.Subcontractor;
                END;
              4:BEGIN
                  lvAdviceRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvAdviceRec."Cost Type" := lvAdviceRec."Cost Type"::Plant;
                  lvAdviceRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              5:BEGIN
                  lvAdviceRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvAdviceRec."Cost Type" := lvAdviceRec."Cost Type"::Sundry;
                  lvAdviceRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
            END;
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(lvAdviceRec.Description));
            lvAdviceRec.Description := desc1;
            lvAdviceRec."Description 2" := desc2;
            lvAdviceRec.VALIDATE("External Text", BaseRecipeLineRec."External Text");
            lvAdviceRec.VALIDATE("Line No.", 0);
            lvAdviceRec.INSERT(TRUE);
            lvAdviceRec."Price Agreement" := BaseRecipeLineRec."Price Agreement";  //C045565
            lvAdviceRec.MODIFY;
          END;

          DATABASE::"Project Material Req. Line":  //DP01732
          BEGIN
            IF CostTypeInt <> 2 THEN EXIT;
            //
            lvProjectMaterialReqLine := ProjectMaterialReqLine;
            lvProjectMaterialReqLine."Source Type" := lvProjectMaterialReqLine."Source Type"::"Recipe Line";
            lvProjectMaterialReqLine."Attached to Line No." := HeaderLine;
            lvProjectMaterialReqLine.Quantity := lvQuan;
            lvProjectMaterialReqLine."Original Quantity" := lvProjectMaterialReqLine.Quantity;  //DP02339
            lvProjectMaterialReqLine."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            lvProjectMaterialReqLine."Line No." := LastLine + 10000;
            LastLine := lvProjectMaterialReqLine."Line No.";
            //
            lvProjectMaterialReqLine."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
            lvProjectMaterialReqLine.Manufacturer := BaseRecipeLineRec.Manufacturer;
            IF BaseRecipeLineRec."Trade Item" <> '' THEN
              lvProjectMaterialReqLine.VALIDATE("Trade Item", BaseRecipeLineRec."Trade Item")
            ELSE
              IF BaseRecipeLineRec."Basic Item" <> '' THEN
                lvProjectMaterialReqLine.VALIDATE("Basic Item", BaseRecipeLineRec."Basic Item")
              ELSE
                IF BaseRecipeLineRec."Item No." <> '' THEN
                  lvProjectMaterialReqLine.VALIDATE("Item No.", BaseRecipeLineRec."Item No.");
            lvProjectMaterialReqLine."Cost Object" := BaseRecipeLineRec."Cost Object Price";
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(lvProjectMaterialReqLine.Description));
            lvProjectMaterialReqLine.Description := desc1;
            lvProjectMaterialReqLine.Description2 := desc2;
            lvProjectMaterialReqLine.VALIDATE("External Text", BaseRecipeLineRec."External Text");
            lvProjectMaterialReqLine.INSERT(TRUE);
            lvProjectMaterialReqLine."Price Agreement" := BaseRecipeLineRec."Price Agreement";  //C045565
            lvProjectMaterialReqLine.MODIFY;
          END;

          DATABASE::"Project Cost Plus Entry":  //DP01183
          BEGIN
            lvProjCostPlusRec := ProjCostPlusRec;
            lvProjCostPlusRec."Recipe Header" := FALSE;
            lvProjCostPlusRec."Attached to Recipe Line" := HeaderLine;
            lvProjCostPlusRec.Quantity := lvQuan;
            lvProjCostPlusRec."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            lvProjCostPlusRec."Cost Component" := BaseRecipeLineRec."Cost Component";

            lvProjCostPlusRec."Line No." := LastLine + 10000;
            LastLine := lvProjCostPlusRec."Line No.";
            CASE CostTypeInt OF
              1:BEGIN
                  lvProjCostPlusRec."Cost Type" := lvProjCostPlusRec."Cost Type"::Labor;
                  lvProjCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Labor";
                  lvHourRateRec.SETRANGE(Code, BaseRecipeLineRec."Rate Code");
                  IF lvHourRateRec.FINDFIRST THEN BEGIN
                    lvProjCostPlusRec.SetValidateHourRateCode(TRUE);
                    lvProjCostPlusRec.VALIDATE("Hour Rate Code", BaseRecipeLineRec."Rate Code");
                    lvProjCostPlusRec.SetValidateHourRateCode(FALSE);
                    lvProjCostPlusRec.Quantity := lvProjCostPlusRec.Quantity * BaseRecipeLineRec.Norm;  //db, 23-09-16
                  END;
                END;
              2:BEGIN
                  lvProjCostPlusRec."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
                  lvProjCostPlusRec.Manufacturer := BaseRecipeLineRec.Manufacturer;
                  IF BaseRecipeLineRec."Trade Item" <> '' THEN
                    lvProjCostPlusRec.VALIDATE("Trade Item", BaseRecipeLineRec."Trade Item")
                  ELSE
                    IF BaseRecipeLineRec."Basic Item" <> '' THEN
                      lvProjCostPlusRec.VALIDATE("Basic Item", BaseRecipeLineRec."Basic Item")
                    ELSE
                      IF BaseRecipeLineRec."Item No." <> '' THEN
                        lvProjCostPlusRec.VALIDATE("Item No.", BaseRecipeLineRec."Item No.");
                  lvProjCostPlusRec."Cost Type" := lvProjCostPlusRec."Cost Type"::Material;
                  lvProjCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              3:BEGIN
                  lvProjCostPlusRec."Cost Type" := lvProjCostPlusRec."Cost Type"::Subcontracting;
                  lvProjCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              4:BEGIN
                  lvProjCostPlusRec."Cost Type" := lvProjCostPlusRec."Cost Type"::Plant;
                  lvProjCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              5:BEGIN
                  lvProjCostPlusRec."Cost Type" := lvProjCostPlusRec."Cost Type"::Sundry;
                  lvProjCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
            END;
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(lvProjCostPlusRec.Description));
            lvProjCostPlusRec.Description := desc1;
            lvProjCostPlusRec."Description 2" := desc2;
            lvProjCostPlusRec.VALIDATE(Text, BaseRecipeLineRec."External Text");
            IF lvProjCostPlusRec."Basic Price (LCY)" = 0 THEN
              lvProjCostPlusRec.GetBasicPrice;
            lvProjCostPlusRec.VALIDATE("Surcharge %", lvProjCostPlusRec.GetSurcharge);
            lvProjCostPlusRec.INSERT(TRUE);
          END;

        DATABASE::"Service Order Cost Plus Entry":  //DP01183
          BEGIN
            lvServCostPlusRec := ServCostPlusRec;
            lvServCostPlusRec."Recipe Header" := FALSE;
            lvServCostPlusRec."Attached to Recipe Line" := HeaderLine;
            lvServCostPlusRec.Quantity := lvQuan;
            lvServCostPlusRec."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            lvServCostPlusRec."Cost Component" := BaseRecipeLineRec."Cost Component";

            lvServCostPlusRec."Line No." := LastLine + 10000;
            LastLine := lvServCostPlusRec."Line No.";
            CASE CostTypeInt OF
              1:BEGIN
                  lvServCostPlusRec."Cost Type" := lvServCostPlusRec."Cost Type"::Labor;
                  lvServCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Labor";
                  lvHourRateRec.SETRANGE(Code, BaseRecipeLineRec."Rate Code");
                  IF lvHourRateRec.FINDFIRST THEN BEGIN
                    lvServCostPlusRec.SetValidateHourRateCode(TRUE);
                    lvServCostPlusRec.VALIDATE("Hour Rate Code", BaseRecipeLineRec."Rate Code");
                    lvServCostPlusRec.SetValidateHourRateCode(FALSE);
                    lvServCostPlusRec.Quantity := lvServCostPlusRec.Quantity * BaseRecipeLineRec.Norm;  //db, 23-09-16
                  END;
                END;
              2:BEGIN
                  lvServCostPlusRec."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
                  lvServCostPlusRec.Manufacturer := BaseRecipeLineRec.Manufacturer;
                  IF BaseRecipeLineRec."Trade Item" <> '' THEN
                    lvServCostPlusRec.VALIDATE("Trade Item", BaseRecipeLineRec."Trade Item")
                  ELSE
                    IF BaseRecipeLineRec."Basic Item" <> '' THEN
                      lvServCostPlusRec.VALIDATE("Basic Item", BaseRecipeLineRec."Basic Item")
                    ELSE
                      IF BaseRecipeLineRec."Item No." <> '' THEN
                        lvServCostPlusRec.VALIDATE("Item No.", BaseRecipeLineRec."Item No.");
                  lvServCostPlusRec."Cost Type" := lvServCostPlusRec."Cost Type"::Material;
                  lvServCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              3:BEGIN
                  lvServCostPlusRec."Cost Type" := lvServCostPlusRec."Cost Type"::Subcontracting;
                  lvServCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              4:BEGIN
                  lvServCostPlusRec."Cost Type" := lvServCostPlusRec."Cost Type"::Plant;
                  lvServCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              5:BEGIN
                  lvServCostPlusRec."Cost Type" := lvServCostPlusRec."Cost Type"::Sundry;
                  lvServCostPlusRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
            END;
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(lvServCostPlusRec.Description));
            lvServCostPlusRec.Description := desc1;
            lvServCostPlusRec."Description 2" := desc2;
            lvServCostPlusRec.VALIDATE(Text, BaseRecipeLineRec."External Text");
            IF lvServCostPlusRec."Basic Price" = 0 THEN
              lvServCostPlusRec.GetBasicPrice;
            lvServCostPlusRec.VALIDATE("Surcharge %", lvServCostPlusRec.GetSurcharge);
            lvServCostPlusRec.GetDiscountPerc;
            lvServCostPlusRec.INSERT(TRUE);
          END;

        DATABASE::"Service Order Budget Line":  //DP01560
          BEGIN
            lvServiceOrderBudgetLine := ServiceOrderBudgetLine;
            lvServiceOrderBudgetLine."Source Type (Recipe/BOM)" := lvServiceOrderBudgetLine."Source Type (Recipe/BOM)"::"Recipe Line";
            lvServiceOrderBudgetLine."Attached to Line No." := HeaderLine;
            lvServiceOrderBudgetLine.Quantity := lvQuan;
            lvServiceOrderBudgetLine."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            lvServiceOrderBudgetLine."Time Quantity" := BaseRecipeLineRec."Time Quantity";
            lvServiceOrderBudgetLine."Unit of Time" := BaseRecipeLineRec."Unit of Time";
            lvServiceOrderBudgetLine."Cost Component" := BaseRecipeLineRec."Cost Component";

            lvServiceOrderBudgetLine."Line No." := LastLine + 10000;
            LastLine := lvServiceOrderBudgetLine."Line No.";

            CASE CostTypeInt OF
              1:BEGIN
                  IF BaseRecipeLineRec."Rate Type" = BaseRecipeLineRec."Rate Type"::Minuts THEN
                    IF BaseRecipeLineRec."Team Size" <> 0 THEN
                      lvServiceOrderBudgetLine.Norm := ROUND(BaseRecipeLineRec.Norm * BaseRecipeLineRec."Team Size" / 60, 0.00001)
                    ELSE
                      lvServiceOrderBudgetLine.Norm := ROUND(BaseRecipeLineRec.Norm / 60, 0.00001)
                  ELSE
                    lvServiceOrderBudgetLine.Norm := BaseRecipeLineRec.Norm;
                  //DP02324.sn
                  IF BaseRecipeLineRec."Adjustment Factor Hours" <> 0 THEN
                     lvServiceOrderBudgetLine.Norm := ROUND(lvServiceOrderBudgetLine.Norm * BaseRecipeLineRec."Adjustment Factor Hours", 0.00001);
                  //DP02324.en
                  //C062268.sn
                  RateAmount := CalculateRateAmount(BaseRecipeLineRec."Labor Cost Amount", lvServiceOrderBudgetLine.Quantity, lvServiceOrderBudgetLine.Norm);
                  lvServiceOrderBudgetLine.Rate := ABS(ROUND(RateAmount, 0.00001));
                  lvServiceOrderBudgetLine."Rate Code" := CheckRateCode(BaseRecipeLineRec."Rate Code");  //C062150
                  //C062268.en
                  lvServiceOrderBudgetLine."Cost Type" := lvServiceOrderBudgetLine."Cost Type"::Labor;
                  lvServiceOrderBudgetLine."Cost Object" := BaseRecipeLineRec."Cost Object Labor";
                END;
              2:BEGIN
                  lvServiceOrderBudgetLine."Item No." := BaseRecipeLineRec."Item No.";
                  lvServiceOrderBudgetLine."Basic Item" := BaseRecipeLineRec."Basic Item";
                  lvServiceOrderBudgetLine."Trade Item" := BaseRecipeLineRec."Trade Item";
                  lvServiceOrderBudgetLine."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
                  lvServiceOrderBudgetLine.Manufacturer := BaseRecipeLineRec.Manufacturer;
                  lvServiceOrderBudgetLine."Gross Price" := BaseRecipeLineRec."Gross Price";
                  lvServiceOrderBudgetLine."Discount %" := BaseRecipeLineRec."Purchase Discount %";
                  lvServiceOrderBudgetLine.Price := BaseRecipeLineRec."Net Cost Price";
                  lvServiceOrderBudgetLine."Cost Type" := lvServiceOrderBudgetLine."Cost Type"::Material;
                  lvServiceOrderBudgetLine."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                  lvServiceOrderBudgetLine."Scheme Code" := BaseRecipeLineRec."Scheme Code";
                  lvServiceOrderBudgetLine."Comments for Logistics" := BaseRecipeLineRec."Comments for Logistics";
                  lvServiceOrderBudgetLine.Comments := BaseRecipeLineRec.Comments;
                  lvServiceOrderBudgetLine.Supply := BaseRecipeLineRec.Supply;
                  lvServiceOrderBudgetLine."Material Sheet" := BaseRecipeLineRec."Material Sheet";
                END;
              3:BEGIN
                  lvServiceOrderBudgetLine.Price := BaseRecipeLineRec."Net Cost Price";
                  lvServiceOrderBudgetLine."Cost Type" := lvServiceOrderBudgetLine."Cost Type"::Subcontracting;
                  lvServiceOrderBudgetLine."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              4:BEGIN
                  lvServiceOrderBudgetLine.Price := BaseRecipeLineRec."Net Cost Price";
                  lvServiceOrderBudgetLine."Cost Type" := lvServiceOrderBudgetLine."Cost Type"::Plant;
                  lvServiceOrderBudgetLine."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              5:BEGIN
                  lvServiceOrderBudgetLine.Price := BaseRecipeLineRec."Net Cost Price";
                  lvServiceOrderBudgetLine."Cost Type" := lvServiceOrderBudgetLine."Cost Type"::Sundry;
                  lvServiceOrderBudgetLine."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
            END;
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(lvServiceOrderBudgetLine.Description));
            lvServiceOrderBudgetLine.Description := desc1;
            lvServiceOrderBudgetLine."Description 2" := desc2;
            lvServiceOrderBudgetLine.VALIDATE("External Text", BaseRecipeLineRec."External Text");
            lvServiceOrderBudgetLine.CalcTotals;
            lvServiceOrderBudgetLine.INSERT(TRUE);
            lvServiceOrderBudgetLine."Price Agreement" := BaseRecipeLineRec."Price Agreement";  //C045565
            lvServiceOrderBudgetLine.MODIFY;
          END;

        DATABASE::"Budget Line":
          BEGIN
            lvBudgetLineRec := BudgetLineRec;
            lvBudgetLineRec."Source Type" := lvBudgetLineRec."Source Type"::"Recipe Line";
            lvBudgetLineRec."Attached to Recipe Line" := HeaderLine;
            //lvBudgetLineRec.Quantity := BaseRecipeLineRec.Quantity;
            lvBudgetLineRec.Quantity := lvQuan;  //db, 18-11-09: M17024
            lvBudgetLineRec."Original Quantity" := lvBudgetLineRec.Quantity;  //DP02339
            lvBudgetLineRec."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            lvBudgetLineRec."Time Quantity" := BaseRecipeLineRec."Time Quantity";
            lvBudgetLineRec."Unit of Time" := BaseRecipeLineRec."Unit of Time";
            lvBudgetLineRec."Cost Component" := BaseRecipeLineRec."Cost Component";
            IF BaseRecipeLineRec.Element <> '' THEN
              lvBudgetLineRec.Element := BaseRecipeLineRec.Element;
            lvBudgetLineRec.FillElementPhaseCodeBasedOnElement;

            lvBudgetLineRec."Line No." := LastLine + 10000;
            LastLine := lvBudgetLineRec."Line No.";

            CASE CostTypeInt OF
              1:BEGIN
                  IF BaseRecipeLineRec."Rate Type" = BaseRecipeLineRec."Rate Type"::Minuts THEN
                    IF BaseRecipeLineRec."Team Size" <> 0 THEN
                      lvBudgetLineRec.Norm := ROUND(BaseRecipeLineRec.Norm * BaseRecipeLineRec."Team Size" / 60, 0.00001)
                    ELSE
                      lvBudgetLineRec.Norm := ROUND(BaseRecipeLineRec.Norm / 60, 0.00001)
                  ELSE
                    lvBudgetLineRec.Norm := BaseRecipeLineRec.Norm;
                  //DP02324.sn
                  IF BaseRecipeLineRec."Adjustment Factor Hours" <> 0 THEN
                     lvBudgetLineRec.Norm := ROUND(lvBudgetLineRec.Norm * BaseRecipeLineRec."Adjustment Factor Hours", 0.00001);
                  //DP02324.en
                  //C062268.sn
                  RateAmount := CalculateRateAmount(BaseRecipeLineRec."Labor Cost Amount", lvBudgetLineRec.Quantity, lvBudgetLineRec.Norm);
                  lvBudgetLineRec."Rate (LCY)" := ABS(ROUND(RateAmount, 0.00001));
                  lvBudgetLineRec."Rate Code" := CheckRateCode(BaseRecipeLineRec."Rate Code");  //C062150
                  //C062268.en
                  lvBudgetLineRec."Cost Type" := lvBudgetLineRec."Cost Type"::Labor;
                  lvBudgetLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Labor";
                END;
              2:BEGIN
                  lvBudgetLineRec."Item No." := BaseRecipeLineRec."Item No.";
                  lvBudgetLineRec."Basic Item" := BaseRecipeLineRec."Basic Item";
                  lvBudgetLineRec."Trade Item" := BaseRecipeLineRec."Trade Item";
                  lvBudgetLineRec."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
                  lvBudgetLineRec.Manufacturer := BaseRecipeLineRec.Manufacturer;
                  //db.sn, 20-03-15: C018810
                  lvBudgetLineRec."Gross Price (LCY)" := BaseRecipeLineRec."Gross Price";
                  lvBudgetLineRec."Discount %" := BaseRecipeLineRec."Purchase Discount %";
                  //db.en, 20-03-15: C018810
                  lvBudgetLineRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvBudgetLineRec."Cost Type" := lvBudgetLineRec."Cost Type"::Material;
                  lvBudgetLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                  //db.sn, 18-01-11: M25004
                  lvBudgetLineRec."Scheme Code" := BaseRecipeLineRec."Scheme Code";
                  lvBudgetLineRec."Comments for Logistics" := BaseRecipeLineRec."Comments for Logistics";
                  lvBudgetLineRec.Comments := BaseRecipeLineRec.Comments;
                  lvBudgetLineRec.Supply := BaseRecipeLineRec.Supply;
                  lvBudgetLineRec."Material Sheet" := BaseRecipeLineRec."Material Sheet";
                  //db.en, 18-01-11: M25004
                END;
              3:BEGIN
                  lvBudgetLineRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvBudgetLineRec."Cost Type" := lvBudgetLineRec."Cost Type"::Subcontracting;
                  lvBudgetLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              4:BEGIN
                  lvBudgetLineRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvBudgetLineRec."Cost Type" := lvBudgetLineRec."Cost Type"::Plant;
                  lvBudgetLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              5:BEGIN
                  lvBudgetLineRec."Price (LCY)" := BaseRecipeLineRec."Net Cost Price";
                  lvBudgetLineRec."Cost Type" := lvBudgetLineRec."Cost Type"::Sundry;
                  lvBudgetLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
            END;
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(lvBudgetLineRec.Description));
            lvBudgetLineRec.Description := desc1;
            lvBudgetLineRec."Description 2" := desc2;
            lvBudgetLineRec.VALIDATE("External Text", BaseRecipeLineRec."External Text");
            lvBudgetLineRec.CalcTotals;
            lvBudgetLineRec.INSERT(TRUE);
            lvBudgetLineRec."Price Agreement" := BaseRecipeLineRec."Price Agreement";  //C045565
            IF lvBudgetLineRec."Rate Code" <> '' THEN
              lvBudgetLineRec.VALIDATE("Rate Code");  //C062150: get actual rate by version date
            lvBudgetLineRec.MODIFY;
          END;

        DATABASE::"Option Budget":
          BEGIN
            OptionLineRec := BudgetOptionRec;
            OptionLineRec."Source Type" := OptionLineRec."Source Type"::"Recipe Line";
            OptionLineRec."Attached to Recipe Line" := HeaderLine;
            //OptionLineRec.Quantity := BaseRecipeLineRec.Quantity;
            OptionLineRec.Quantity := lvQuan;  //db, 18-11-09: M17024
            OptionLineRec."Original Quantity" := OptionLineRec.Quantity;  //DP02339
            OptionLineRec."Unit of Measure" := BaseRecipeLineRec."Unit of Measure";
            OptionLineRec."Time Quantity" := BaseRecipeLineRec."Time Quantity";
            OptionLineRec."Unit of Time" := BaseRecipeLineRec."Unit of Time";
            OptionLineRec."Cost Component" := BaseRecipeLineRec."Cost Component";
            IF BaseRecipeLineRec.Element <> '' THEN
              OptionLineRec.Element := BaseRecipeLineRec.Element;  //db, 26-11-08: M13466

            OptionLineRec."Line No." := LastLine + RecipeLineGap;
            LastLine := OptionLineRec."Line No.";

            CASE CostTypeInt OF
              1:BEGIN
                  IF BaseRecipeLineRec."Rate Type" = BaseRecipeLineRec."Rate Type"::Minuts THEN
                    IF BaseRecipeLineRec."Team Size" <> 0 THEN
                      OptionLineRec.Norm := ROUND(BaseRecipeLineRec.Norm * BaseRecipeLineRec."Team Size" / 60, 0.00001)
                    ELSE
                      OptionLineRec.Norm := ROUND(BaseRecipeLineRec.Norm / 60, 0.00001)
                  ELSE
                    OptionLineRec.Norm := BaseRecipeLineRec.Norm;
                  //DP02324.sn
                  IF BaseRecipeLineRec."Adjustment Factor Hours" <> 0 THEN
                     OptionLineRec.Norm := ROUND(OptionLineRec.Norm * BaseRecipeLineRec."Adjustment Factor Hours", 0.00001);
                  //DP02324.en
                  //C062268.sn
                  RateAmount := CalculateRateAmount(BaseRecipeLineRec."Labor Cost Amount", OptionLineRec.Quantity, OptionLineRec.Norm);
                  OptionLineRec.Rate := ABS(ROUND(RateAmount, 0.00001));
                  OptionLineRec."Rate Code" := CheckRateCode(BaseRecipeLineRec."Rate Code");  //C062150
                  //C062268.en
                  OptionLineRec."Cost Type" := OptionLineRec."Cost Type"::Labor;
                  OptionLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Labor";
                END;
              2:BEGIN
                  OptionLineRec."Item No." := BaseRecipeLineRec."Item No.";
                  OptionLineRec."Basic Item" := BaseRecipeLineRec."Basic Item";
                  OptionLineRec."Trade Item" := BaseRecipeLineRec."Trade Item";
                  OptionLineRec."Vendor (Trade Item)" := BaseRecipeLineRec."Vendor (Trade Item)";
                  OptionLineRec.Manufacturer := BaseRecipeLineRec.Manufacturer;
                  OptionLineRec.Price := BaseRecipeLineRec."Net Cost Price";
                  OptionLineRec."Cost Type" := OptionLineRec."Cost Type"::Material;
                  OptionLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              3:BEGIN
                  OptionLineRec.Price := BaseRecipeLineRec."Net Cost Price";
                  OptionLineRec."Cost Type" := OptionLineRec."Cost Type"::Subcontracting;
                  OptionLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              4:BEGIN
                  OptionLineRec.Price := BaseRecipeLineRec."Net Cost Price";
                  OptionLineRec."Cost Type" := OptionLineRec."Cost Type"::Plant;
                  OptionLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
              5:BEGIN
                  OptionLineRec.Price := BaseRecipeLineRec."Net Cost Price";
                  OptionLineRec."Cost Type" := OptionLineRec."Cost Type"::Sundry;
                  OptionLineRec."Cost Object" := BaseRecipeLineRec."Cost Object Price";
                END;
            END;
            //C036523: assign description after validate Item
            SplitDesc(BaseRecipeLineRec.Description, MAXSTRLEN(OptionLineRec.Description));
            OptionLineRec.Description := desc1;
            OptionLineRec."Description 2" := desc2;
            OptionLineRec.VALIDATE(Text, BaseRecipeLineRec."External Text");
            OptionLineRec.CalcTotals;
            OptionLineRec.INSERT(TRUE);
            IF OptionLineRec."Rate Code" <> '' THEN
              OptionLineRec.VALIDATE("Rate Code");  //C062150: get actual rate by version date
            OptionLineRec.MODIFY;
          END;
        ELSE
          MESSAGE(Text001);
      END;
    END;

    [External]
    PROCEDURE ReplaceRecipe@1210190001(lvAction@1210190001 : Integer);
    VAR
      OptionLineRec@1210190000 : Record 11012503;
      TmpOptionLineRec@1210190003 : TEMPORARY Record 11012503;
      RcpRec@1100485000 : Record 11020581;
    BEGIN
      OptionLineRec.RESET;
      IF lvAction = 1 THEN BEGIN
        //standard option (all)
        OptionLineRec.SETFILTER("Project No.", '%1', '');
        OptionLineRec.SETFILTER(Option, '<>%1', '');
        IF g_code4 <> '' THEN
          OptionLineRec.SETFILTER("Recipe Group", g_code4);
        IF g_code5 <> '' THEN
          OptionLineRec.SETFILTER(Recipe, g_code5);
      END;
      IF lvAction = 2 THEN BEGIN
        //project option (all)
        OptionLineRec.SETFILTER("Project No.", '<>%1', '');
        OptionLineRec.SETFILTER(Option, '<>%1', '');
        IF g_code4 <> '' THEN
          OptionLineRec.SETFILTER("Recipe Group", g_code4);
        IF g_code5 <> '' THEN
          OptionLineRec.SETFILTER(Recipe, g_code5);
      END;
      IF lvAction = 3 THEN BEGIN
        //specified option (std/prj/plot)
        IF g_code1 <> '' THEN
          OptionLineRec.SETRANGE("Project No.", g_code1)
        ELSE
          OptionLineRec.SETFILTER("Project No.", '%1', '');

        IF g_code2 <> '' THEN
          OptionLineRec.SETRANGE("Plot No.", g_code2)
        ELSE
          OptionLineRec.SETFILTER("Plot No.", '%1', '');
        IF g_code3 <> '' THEN
          OptionLineRec.SETRANGE(Option, g_code3);
        IF g_code6 <> '' THEN
          OptionLineRec.SETRANGE("House Model", g_code6);
        IF g_code7 <> '' THEN
          OptionLineRec.SETRANGE("Main Group", g_code7);
        IF g_code8 <> '' THEN
          OptionLineRec.SETRANGE(Group, g_code8);
        IF g_code9 <> '' THEN
          OptionLineRec.SETRANGE("Sub Group", g_code9);

        OptionLineRec.SETFILTER("Recipe Group", '<>%1', '');
        OptionLineRec.SETFILTER(Recipe, '<>%1', '');
      END;
      OptionLineRec.SETRANGE("Source Type", OptionLineRec."Source Type"::"Recipe Header");

      TmpOptionLineRec.RESET;
      IF OptionLineRec.FINDSET THEN BEGIN
        REPEAT
          TmpOptionLineRec := OptionLineRec;
          TmpOptionLineRec.INSERT;
        UNTIL OptionLineRec.NEXT = 0;
        OptionLineRec.DELETEALL(TRUE);
      END;

      IF TmpOptionLineRec.FIND('-') THEN BEGIN
        REPEAT
          RcpRec.GET(TmpOptionLineRec."Recipe Group", TmpOptionLineRec.Recipe);
          RcpRec.MARK := TRUE;
          RcpRec.SETRECFILTER; //To prevent that all recipes are copied in RTC.
          g_code1 := TmpOptionLineRec."Project No.";
          g_code2 := TmpOptionLineRec."Plot No.";
          g_code3 := TmpOptionLineRec.Option;
          g_code4 := TmpOptionLineRec.Element;
          g_code6 := TmpOptionLineRec."House Model";
          g_code7 := TmpOptionLineRec."Main Group";
          g_code8 := TmpOptionLineRec.Group;
          g_code9 := TmpOptionLineRec."Sub Group";
          RcpQuan := TmpOptionLineRec.Quantity;
          CopyBaseRecipes(RcpRec);  //DP00381
          RcpQuan := 0;
        UNTIL TmpOptionLineRec.NEXT = 0;
        TmpOptionLineRec.DELETEALL;
      END;

      COMMIT;
    END;

    [External]
    PROCEDURE CopyEstParts@1100528903(VAR gvPartRec@1100485000 : Record 11012169);
    VAR
      lvPartRec@1100485001 : Record 11012169;
      EstRec@1210190001 : Record 11012151;
      EstPartRec@11012000 : Record 11072073;
      StdPartRec@11012001 : Record 11012169;
      EstLineRec@1210190000 : Record 11072072;
      MarkedLevel@11012002 : Integer;
      NewPartRec@1100409002 : Record 11229768;
      NewPart@1100409001 : Code[20];
    BEGIN
      EstRec.GET(g_code1);
      EstRec.TESTFIELD(Fixed, FALSE);

      lvPartRec.COPY(gvPartRec);
      WITH lvPartRec DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        IF ShowProgress THEN  //db, 02-07-10: M19985
          Status.OPEN(Text010);  //db, 08-06-10: M19367
        REPEAT
          IF ShowProgress THEN  //db, 02-07-10: M19985
            Status.UPDATE(1,Code);  //db, 08-06-10: M19367
          //DP00686.sn
          IF NewPartRec.GET("Part Group", Code) THEN BEGIN
            NewPart := NewPartRec."New Part";
            NewPartRec.DELETE;
          END ELSE BEGIN
            NewPartRec.INIT;
            NewPart := Code;
          END;
          StdPartRec.GET("Part Group", Code);
          //DP00686.en
          IF NOT EstPartRec.GET(g_code1, g_code2, "Part Group", NewPart) THEN BEGIN  //DP00686
            EstPartRec.INIT;
            EstPartRec."Estimate No." := g_code1;
            EstPartRec."Sub-Estimate No." := g_code2;
            EstPartRec.InitSurcharge;   //C035157: inherit from SubEst before assign by validate Part
            EstPartRec."Part Group" := "Part Group";
            //DP00686.sn
            EstPartRec.VALIDATE(Part, NewPart);
            IF NewPartRec."New Part" <> '' THEN BEGIN
              EstPartRec.TESTFIELD(Level, StdPartRec.Level);
              //inherit data, normaly assigned by validate Part
              EstPartRec.InheritFromBasePart(StdPartRec);  //C035157
              EstPartRec.CopyPartText(Code, NewPart);
              EstPartRec.CopyPartQuantitySheet(Code, NewPart);
            END;
            //DP00686.en
            IF StdPartRec."Excel Estimate Template" <> '' THEN  //C052041
              EstPartRec.VALIDATE("Excel Estimate Template",StdPartRec."Excel Estimate Template");
            EstPartRec.INSERT(TRUE);
            EstLineRec.CopyPartLines(EstPartRec,NewPartLineRec,FALSE,Code,NewPart);  //DP00686
          END;

          IF NewPartRec."New Part" = '' THEN BEGIN  //db, 30-12-14: start skip copy parent-child
          IF (Level = 1) OR (Level = 2) THEN BEGIN
            StdPartRec.RESET;
            StdPartRec.SETRANGE("Part Group", "Part Group");
            IF Level = 1 THEN StdPartRec.SETRANGE(Chapter, Code);
            IF Level = 2 THEN StdPartRec.SETRANGE(Paragraph, Code);
            IF StdPartRec.FINDSET THEN BEGIN
              REPEAT
                IF ShowProgress THEN  //db, 02-07-10: M19985
                  Status.UPDATE(1,StdPartRec.Code);  //db, 08-06-10: M19367
                IF NOT EstPartRec.GET(g_code1, g_code2, StdPartRec."Part Group", StdPartRec.Code) THEN BEGIN
                  EstPartRec.INIT;
                  EstPartRec."Estimate No." := g_code1;
                  EstPartRec."Sub-Estimate No." := g_code2;
                  EstPartRec.InitSurcharge;   //C035157: inherit from SubEst before assign by validate Part
                  EstPartRec."Part Group"  := StdPartRec."Part Group";
                  EstPartRec.VALIDATE(Part, StdPartRec.Code);
                  IF StdPartRec."Excel Estimate Template" <> '' THEN  //C052041
                    EstPartRec.VALIDATE("Excel Estimate Template",StdPartRec."Excel Estimate Template");
                  EstPartRec.INSERT(TRUE);
                  EstLineRec.CopyPartLines(EstPartRec,NewPartLineRec,FALSE,'','');
                END;
              UNTIL StdPartRec.NEXT = 0;
            END;
          END;

          MarkedLevel := Level;
          REPEAT
            StdPartRec.RESET;
            StdPartRec.SETRANGE("Part Group", "Part Group");
            IF MarkedLevel = 1 THEN StdPartRec.SETRANGE(Level, 0);
            IF MarkedLevel = 2 THEN StdPartRec.SETRANGE(Code, Chapter);
            IF MarkedLevel = 3 THEN StdPartRec.SETRANGE(Code, Paragraph);
            IF StdPartRec.FINDSET THEN BEGIN
              REPEAT
                IF ShowProgress THEN  //db, 02-07-10: M19985
                  Status.UPDATE(1,StdPartRec.Code);  //db, 08-06-10: M19367
                IF NOT EstPartRec.GET(g_code1, g_code2, StdPartRec."Part Group", StdPartRec.Code) THEN BEGIN
                  EstPartRec.INIT;
                  EstPartRec."Estimate No." := g_code1;
                  EstPartRec."Sub-Estimate No." := g_code2;
                  EstPartRec."Part Group" := StdPartRec."Part Group";
                  EstPartRec.VALIDATE(Part, StdPartRec.Code);
                  IF StdPartRec."Excel Estimate Template" <> '' THEN  //C052041
                    EstPartRec.VALIDATE("Excel Estimate Template",StdPartRec."Excel Estimate Template");
                  EstPartRec.InitSurcharge;  //db, 14-11-13: DP00381
                  EstPartRec.INSERT(TRUE);
                  EstLineRec.CopyPartLines(EstPartRec,NewPartLineRec,FALSE,'','');
                END;
              UNTIL StdPartRec.NEXT = 0;
            END;
            IF MarkedLevel > 0 THEN
              MarkedLevel := MarkedLevel - 1;
          UNTIL MarkedLevel = 0;
          END;  //db, 30-12-14: end skip copy parent-child

        UNTIL NEXT = 0;
        IF ShowProgress THEN  //db, 02-07-10: M19985
          Status.CLOSE;  //db, 08-06-10: M19367
      END;

      gvPartRec.CLEARMARKS;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyEstConfigurator@1100485000();
    BEGIN
      MESSAGE('Function CopyEstConfigurator: expired');
    END;

    [External]
    PROCEDURE CopyEstPartLines@1100528904();
    BEGIN
      //function is started from form 11071702: Config. Estimate Part List  (subform 11071703)
      MESSAGE('Function CopyEstPartLines: expired');
    END;

    [External]
    PROCEDURE CopyOperations@1100485003(VAR gvOperRec@1100485000 : Record 11012166);
    VAR
      lvOperRec@1100485001 : Record 11012166;
      SubOperationBuffer@1100525000 : TEMPORARY Record 11012166;
    BEGIN
      //rtc: old function, only to be used from ClassicClient since in uses marked records
      lvOperRec.COPY(gvOperRec);
      WITH lvOperRec DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        REPEAT
          SubOperationBuffer := lvOperRec;
          SubOperationBuffer.INSERT
        UNTIL NEXT = 0;
      END;

      CopyOperationsFromBuffer(SubOperationBuffer);
    END;

    [External]
    PROCEDURE CopyOperationsFromBuffer@1100525508(VAR gvOperRec@1100485000 : Record 11012166);
    VAR
      LastLine@1100485002 : Integer;
    BEGIN
      //rtc: new copy function
      WITH gvOperRec DO BEGIN
        IF NOT FINDSET THEN
          EXIT;

        LastLine := 0;

        CASE g_table OF
          DATABASE::"Estimate Line":  //DP00381
            BEGIN
              NewEstLineRec.LOCKTABLE;
              NewEstLineRec.SETRANGE("Estimate No.", g_code1);
              NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
              NewEstLineRec.SETRANGE("Part Group",g_code3);
              NewEstLineRec.SETRANGE(Part,g_code4);
              IF NewEstLineRec.FINDLAST THEN
                LastLine := NewEstLineRec."Line No.";

              REPEAT
                LastLine := LastLine + 10000;
                NewEstLineRec.INIT;
                NewEstLineRec."Estimate No." := g_code1;
                NewEstLineRec."Sub-Estimate No." := g_code2;
                NewEstLineRec."Part Group" := g_code3;
                NewEstLineRec.Part := g_code4;
                NewEstLineRec.InitRecord;
                NewEstLineRec."Line No." := LastLine;
                NewEstLineRec.VALIDATE("Sub Operation Code", Code);
                NewEstLineRec.Description := Description;
                NewEstLineRec."Unit of Measure" := "Unit of Measure";
                NewEstLineRec.INSERT(TRUE);
                NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
              UNTIL NEXT = 0;
            END;

          DATABASE::"Base Recipe Line":  //DP00381
            BEGIN
              BaseRecipeLineRec.LOCKTABLE;
              BaseRecipeLineRec.SETRANGE("Recipe Group",g_code5);
              BaseRecipeLineRec.SETRANGE(Recipe,g_code6);
              IF BaseRecipeLineRec.FINDLAST THEN
                LastLine := BaseRecipeLineRec."Line No.";

              REPEAT
                LastLine := LastLine + 10000;
                BaseRecipeLineRec.INIT;
                BaseRecipeLineRec."Recipe Group" := g_code5;
                BaseRecipeLineRec.Recipe := g_code6;
                BaseRecipeLineRec."Line No." := LastLine;
                BaseRecipeLineRec.VALIDATE("Sub Operation Code", Code);
                BaseRecipeLineRec.Description := Description;
                BaseRecipeLineRec."Unit of Measure" := "Unit of Measure";
                BaseRecipeLineRec.INSERT(TRUE);
              UNTIL NEXT = 0;
            END;

          DATABASE::"Estimate Recipe Line":  //DP00381
            BEGIN
              NewRecipeLineRec.LOCKTABLE;
              NewRecipeLineRec.SETRANGE("Estimate No.", g_code1);
              NewRecipeLineRec.SETRANGE("Sub-Estimate No.", g_code2);
              NewRecipeLineRec.SETRANGE("Part Group",g_code3);
              NewRecipeLineRec.SETRANGE(Part,g_code4);
              NewRecipeLineRec.SETRANGE("Estimate Line",g_int1);
              NewRecipeLineRec.SETRANGE("Recipe Group",g_code5);
              NewRecipeLineRec.SETRANGE(Recipe,g_code6);
              IF NewRecipeLineRec.FINDLAST THEN
                LastLine := NewRecipeLineRec."Line No.";

              REPEAT
                LastLine := LastLine + 10000;
                NewRecipeLineRec.INIT;
                NewRecipeLineRec."Estimate No." := g_code1;
                NewRecipeLineRec."Sub-Estimate No." := g_code2;
                NewRecipeLineRec."Part Group" := g_code3;
                NewRecipeLineRec.Part := g_code4;
                NewRecipeLineRec.InitRecord;
                NewRecipeLineRec."Estimate Line" := g_int1;
                NewRecipeLineRec."Recipe Group" := g_code5;
                NewRecipeLineRec.Recipe := g_code6;
                NewRecipeLineRec."Line No." := LastLine;
                NewRecipeLineRec.VALIDATE("Sub Operation Code", Code);
                NewRecipeLineRec.Description := Description;
                NewRecipeLineRec."Unit of Measure" := "Unit of Measure";
                NewRecipeLineRec.INSERT(TRUE);
              UNTIL NEXT = 0;
            END;
          ELSE
            MESSAGE(Text001);
        END;
      END;

      COMMIT;
    END;

    [External]
    PROCEDURE CopyServEntries@1100485008(VAR MarkedRec@1100485000 : TEMPORARY Record 11012819) LinesCopied : Boolean;
    VAR
      ShippingOrderLine@1100528800 : Record 11071885;
      RecRef@1100528801 : RecordRef;
    BEGIN
      IF NOT MarkedRec.FINDSET THEN BEGIN
        MESSAGE(Text041);  //db, 01-12-14
        EXIT;
      END;

      MarkNo := MarkedRec.COUNT;
      CurrLino := g_int2;
      PrevLino := 0;
      Gap := 0;

      CASE g_table OF
        DATABASE::"Estimate Line":  //DP00381
          BEGIN
            EstRec.GET(g_code1);
            EstRec.TESTFIELD(Fixed, FALSE);

            NewEstLineRec.LOCKTABLE;
            NewEstLineRec.SETRANGE("Estimate No.", g_code1);
            NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
            NewEstLineRec.SETRANGE("Part Group",g_code6);
            NewEstLineRec.SETRANGE(Part,g_code3);
            IF NewEstLineRec.GET(g_code1, g_code2, g_code6, g_code3, CurrLino) THEN BEGIN
              NewEstLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewEstLineRec.FINDLAST THEN PrevLino := NewEstLineRec."Line No.";
              NewEstLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewEstLineRec.FINDLAST THEN
                CurrLino := NewEstLineRec."Line No.";
            END;
            REPEAT
              NewEstLineRec.INIT;
              NewEstLineRec."Estimate No." := g_code1;
              NewEstLineRec."Sub-Estimate No." := g_code2;
              NewEstLineRec."Part Group" := g_code6;
              NewEstLineRec.Part := g_code3;
              NewEstLineRec.InitRecord;
              NewEstLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewEstLineRec."Line No.";
              NewEstLineRec.Description := MarkedRec.Description;
              NewEstLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewEstLineRec."Vendor (Trade Item)" := MarkedRec."Vendor (Trade Item)";
              IF MarkedRec."Trade Item" <> '' THEN
                NewEstLineRec.VALIDATE("Trade Item", MarkedRec."Trade Item")
              ELSE
                IF MarkedRec."Basic Item" <> '' THEN
                  NewEstLineRec.VALIDATE("Basic Item", MarkedRec."Basic Item")
                ELSE
                  IF MarkedRec."Item No." <> '' THEN
                    NewEstLineRec.VALIDATE("Item No.", MarkedRec."Item No.");
              //C046405.sn
              NewEstLineRec."Cost Type (Price)" := MarkedRec."Cost Type";
              IF MarkedRec."Cost Type" = MarkedRec."Cost Type"::Labor THEN BEGIN
                NewEstLineRec.VALIDATE("Cost Object Labor", MarkedRec."Global Dimension 2 Code");
                NewEstLineRec.VALIDATE("Rate Code", EstRec."Rate Code");
                NewEstLineRec.VALIDATE(Norm, 1);
              END ELSE BEGIN
                NewEstLineRec.VALIDATE("Cost Object Price", MarkedRec."Global Dimension 2 Code");
                IF MarkedRec."Trade Item" + MarkedRec."Basic Item" + MarkedRec."Item No." = '' THEN  //C026169
                  NewEstLineRec.VALIDATE("Net Cost Price", MarkedRec."Unit Cost (LCY)");
              END;
              //C046405.en
              IF (NewEstLineRec."Unit of Measure" <> MarkedRec."Unit of Measure Code") AND
                 (NewEstLineRec."Unit of Measure" <> '') THEN BEGIN   //db, 16-09-09: M16105
                CheckItemUnitConversion(
                  MarkedRec."Item No.", MarkedRec.Manufacturer, MarkedRec."Basic Item",
                  MarkedRec."Vendor (Trade Item)", MarkedRec."Trade Item",
                  MarkedRec.Quantity, NewEstLineRec."Unit of Measure", MarkedRec."Unit of Measure Code");
              END ELSE BEGIN
                NewEstLineRec.VALIDATE("Unit of Measure", MarkedRec."Unit of Measure Code");
              END;
              NewEstLineRec.VALIDATE(Quantity, MarkedRec.Quantity);
              NewEstLineRec.INSERT(TRUE);
              LinesCopied := TRUE;
              NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
            UNTIL MarkedRec.NEXT = 0;
          END;

        DATABASE::"Shipping Order Line":
          BEGIN
            DetermineCurrLinoPrevLinoGapForShippingOrderLine;
            MarkedRec.FINDSET;
            REPEAT
              RecRef.GETTABLE(MarkedRec);
              InsertShippingOrderLine(
                RecRef,ShippingOrderLine."Source Line Type"::"Service-Ledger Entry");
              LinesCopied := TRUE;
            UNTIL MarkedRec.NEXT = 0;
          END;

        ELSE
          MESSAGE(Text001);

      END;

      COMMIT;
    END;

    [External]
    PROCEDURE CopyJobEntries@1100485009(VAR MarkedRec@1100485000 : TEMPORARY Record 11072005);
    BEGIN
      IF NOT MarkedRec.FINDSET THEN BEGIN
        MESSAGE(Text041);  //db, 01-12-14
        EXIT;
      END;

      MarkNo := MarkedRec.COUNT;
      CurrLino := g_int2;
      PrevLino := 0;
      Gap := 0;

      CASE g_table OF
        DATABASE::"Estimate Line":  //DP00381
          BEGIN
            EstRec.GET(g_code1);
            EstRec.TESTFIELD(Fixed, FALSE);

            NewEstLineRec.LOCKTABLE;
            NewEstLineRec.SETRANGE("Estimate No.", g_code1);
            NewEstLineRec.SETRANGE("Sub-Estimate No.", g_code2);
            NewEstLineRec.SETRANGE("Part Group",g_code6);
            NewEstLineRec.SETRANGE(Part,g_code3);
            IF NewEstLineRec.GET(g_code1, g_code2, g_code6, g_code3, CurrLino) THEN BEGIN
              NewEstLineRec.SETFILTER("Line No.", '<%1', CurrLino);
              IF NewEstLineRec.FINDLAST THEN PrevLino := NewEstLineRec."Line No.";
              NewEstLineRec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF NewEstLineRec.FINDLAST THEN
                CurrLino := NewEstLineRec."Line No.";
            END;
            REPEAT
              NewEstLineRec.INIT;
              NewEstLineRec."Estimate No." := g_code1;
              NewEstLineRec."Sub-Estimate No." := g_code2;
              NewEstLineRec."Part Group" := g_code6;
              NewEstLineRec.Part := g_code3;
              NewEstLineRec.InitRecord;
              NewEstLineRec."Line No." := CurrLino + Gap;
              CurrLino := NewEstLineRec."Line No.";
              NewEstLineRec.Description := MarkedRec.Description;
              NewEstLineRec.Manufacturer := MarkedRec.Manufacturer;
              NewEstLineRec."Vendor (Trade Item)" := MarkedRec."Vendor (Trade Item)";
              IF MarkedRec."Trade Item" <> '' THEN
                NewEstLineRec.VALIDATE("Trade Item", MarkedRec."Trade Item")
              ELSE
                IF MarkedRec."Basic Item" <> '' THEN
                  NewEstLineRec.VALIDATE("Basic Item", MarkedRec."Basic Item")
                ELSE
                  IF MarkedRec."Item No." <> '' THEN
                    NewEstLineRec.VALIDATE("Item No.", MarkedRec."Item No.");
              //C046405.sn
              NewEstLineRec."Cost Type (Price)" := MarkedRec."Cost Type";
              IF MarkedRec."Cost Type" = MarkedRec."Cost Type"::Labor THEN BEGIN
                NewEstLineRec.VALIDATE("Cost Object Labor", MarkedRec."Global Dimension 2 Code");
                NewEstLineRec.VALIDATE("Rate Code", EstRec."Rate Code");
                NewEstLineRec.VALIDATE(Norm, 1);
              END ELSE BEGIN
                NewEstLineRec.VALIDATE("Cost Object Price", MarkedRec."Global Dimension 2 Code");
                IF MarkedRec."Trade Item" + MarkedRec."Basic Item" + MarkedRec."Item No." = '' THEN  //C026169
                  NewEstLineRec.VALIDATE("Net Cost Price", MarkedRec."Unit Cost (LCY)");
              END;
              //C046405.en
              IF (NewEstLineRec."Unit of Measure" <> MarkedRec."Unit of Measure Code") AND
                 (NewEstLineRec."Unit of Measure" <> '') THEN BEGIN   //db, 16-09-09: M16105
                CheckItemUnitConversion(
                  MarkedRec."Item No.", MarkedRec.Manufacturer, MarkedRec."Basic Item",
                  MarkedRec."Vendor (Trade Item)", MarkedRec."Trade Item",
                  MarkedRec.Quantity, NewEstLineRec."Unit of Measure", MarkedRec."Unit of Measure Code");
              END ELSE BEGIN
                NewEstLineRec.VALIDATE("Unit of Measure", MarkedRec."Unit of Measure Code");
              END;
              NewEstLineRec.VALIDATE(Quantity, MarkedRec.Quantity);
              NewEstLineRec.INSERT(TRUE);
              NewEstLineRec.UpdateLineTotals;  //db, 23-06-14
            UNTIL MarkedRec.NEXT = 0;
          END;
        ELSE
          MESSAGE(Text001);
      END;

      COMMIT;
    END;

    [External]
    PROCEDURE CopyPurchObligations@1210190004(VAR gvPurchLineRec@1100485001 : Record 39);
    VAR
      lvPurchLineRec@1100485002 : Record 39;
      GetQtyToReceive@1100409000 : Boolean;
      lvSelect@1100409001 : Integer;
      TotQtyToInvoice@1100528500 : Decimal;
      QtyToInvoice@1100528505 : Decimal;
      TotQuanSpecified@1100528504 : Decimal;
    BEGIN
      lvPurchLineRec.COPY(gvPurchLineRec);
      WITH lvPurchLineRec DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        lvSelect := STRMENU(Text002, 2);  //db, 31-08-12: C002025
        IF lvSelect = 1 THEN GetQtyToReceive := TRUE;

        REPEAT
          //DP00121
          TotQuanSpecified := 0;
          IF PurchHeaderRec."Amounts only" THEN
            TotQtyToInvoice := 1  //db, 31-08-12: C002025
          ELSE
            IF GetQtyToReceive THEN //*C001994/5.n
              TotQtyToInvoice := "Qty. to Receive"
            ELSE
              TotQtyToInvoice := Quantity;
          GetTrackingSpecification(lvPurchLineRec,GetQtyToReceive);

          IF TempTrackingSpecification.FINDSET THEN BEGIN
            REPEAT
              IF GetQtyToReceive THEN
                QtyToInvoice := TempTrackingSpecification."Qty. to Handle (Base)"
              ELSE
                QtyToInvoice := TempTrackingSpecification."Quantity (Base)";
              IF QtyToInvoice <> 0 THEN BEGIN
                GenerateCostPlus(
                  lvPurchLineRec, QtyToInvoice,
                  TempTrackingSpecification."Serial No.",
                  TempTrackingSpecification."Lot No.");
                //db.sn, 02-01-14: C010942
                "Cost Plus Entry Created" := TRUE;
                MODIFY;
                //db.en, 02-01-14: C010942
              END;
              TotQuanSpecified := TotQuanSpecified + QtyToInvoice;
            UNTIL TempTrackingSpecification.NEXT = 0;
          END;
          IF TotQtyToInvoice <> TotQuanSpecified THEN BEGIN
            GenerateCostPlus(
              lvPurchLineRec, TotQtyToInvoice - TotQuanSpecified, '', '');
            //db.sn, 02-01-14: C010942
            "Cost Plus Entry Created" := TRUE;
            MODIFY;
            //db.en, 02-01-14: C010942
          END;
        UNTIL NEXT = 0;
      END;

      IF ErrorFound THEN BEGIN
        MESSAGE(Text001);
      END ELSE BEGIN
        //gvPurchLineRec.MODIFYALL("Cost Plus Entry Created", TRUE);  //db, 02-01-14: C010942
        gvPurchLineRec.MARKEDONLY(FALSE);
      END;
      gvPurchLineRec.CLEARMARKS;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyHourObligations@1100485011(VAR gvHourLineRec@1100485001 : Record 11012039);
    VAR
      lvHourLineRec@1100485004 : Record 11012039;
      EmplRec@1100485000 : Record 5200;
      lvText002@1100485002 : TextConst 'ENU="Hours ";NOR="Timer ";SVE=Timmar';
      lvText003@1100485003 : TextConst 'ENU="Expenses ";NOR=Kostnader;SVE=Kostnader';
      ErrorFound@1100485005 : Boolean;
    BEGIN
      lvHourLineRec.COPY(gvHourLineRec);
      WITH lvHourLineRec DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        REPEAT
          CASE g_table OF
            DATABASE::"Service Order Cost Plus Entry":
              BEGIN
                IF "Service Order No." <> '' THEN
                  g_code1 := "Service Order No.";  //is needed when navigating from form 11125118
                ServCostPlusRec.LOCKTABLE;
                ServCostPlusRec.SETRANGE("Service Order No.", g_code1);
                IF ServCostPlusRec.FINDLAST THEN
                  CurrLino := ServCostPlusRec."Line No."
                ELSE
                  CurrLino := 0;

                ServCostPlusRec.INIT;
                ServCostPlusRec.VALIDATE("Service Order No.", g_code1);
                ServCostPlusRec."Line No." := CurrLino + 10000;
                CurrLino := ServCostPlusRec."Line No.";
                ServCostPlusRec.INSERT(TRUE);

                ServCostPlusRec."Posting Date" := "Posting Date";
                ServCostPlusRec."Source Document" := "Document No.";
                IF NOT "Cost Plus Entry Created" THEN
                  ServCostPlusRec."Source Line" := "Line No.";
                ServCostPlusRec."Surcharge %" := ServCostPlusRec.GetSurcharge;
                ServCostPlusRec.VALIDATE("Employee No.","Employee No.");
                ServCostPlusRec.VALIDATE("Cost Object","Cost Object");
                ServCostPlusRec."Cost Component" := "Cost Component";
                ServCostPlusRec."Wage Component" := "Wage Component";

                EmplRec.GET(ServCostPlusRec."Employee No.");
                CASE "Component Type" OF
                  "Component Type"::Hours: ServCostPlusRec.Description := lvText002;
                  "Component Type"::Expenses: ServCostPlusRec.Description := lvText003;
                END;
                ServCostPlusRec.Description :=
                  COPYSTR(ServCostPlusRec.Description + EmplRec."Full Name", 1, MAXSTRLEN(ServCostPlusRec.Description));
                ServCostPlusRec.VALIDATE(Quantity,"Total Line");
                ServCostPlusRec."Cost Price (LCY)" := "Unit Cost (LCY)";
                ServCostPlusRec.VALIDATE("Basic Price (LCY)","Unit Cost (LCY)");
                ServCostPlusRec.MODIFY(TRUE);
              END;
            DATABASE::"Project Cost Plus Entry":
              BEGIN
                ProjCostPlusRec.LOCKTABLE;
                ProjCostPlusRec.SETRANGE("Project No.", g_code1);
                ProjCostPlusRec.SETRANGE(Principal, g_code2);
                ProjCostPlusRec.SETRANGE("Commission No.", g_code3);
                ProjCostPlusRec.SETRANGE("Settl.Sheet No.", g_code4);
                IF ProjCostPlusRec.FINDLAST THEN
                  CurrLino := ProjCostPlusRec."Line No."
                ELSE
                  CurrLino := 0;

                ProjCostPlusRec.INIT;
                ProjCostPlusRec."Project No." := g_code1;
                ProjCostPlusRec.Principal := g_code2;
                ProjCostPlusRec."Commission No." := g_code3;
                ProjCostPlusRec."Settl.Sheet No." := g_code4;
                ProjCostPlusRec."Line No." := CurrLino + 10000;
                CurrLino := ProjCostPlusRec."Line No.";
                ProjCostPlusRec.INSERT(TRUE);

                ProjCostPlusRec."Source Document" := "Document No.";
                IF NOT "Cost Plus Entry Created" THEN
                  ProjCostPlusRec."Source Line" := "Line No.";
                ProjCostPlusRec."Surcharge %" := ProjCostPlusRec.GetSurcharge;
                ProjCostPlusRec.VALIDATE("Employee No.","Employee No.");
                ProjCostPlusRec.VALIDATE("Cost Object","Cost Object");
                ProjCostPlusRec."Cost Component" := "Cost Component";
                ProjCostPlusRec."Wage Component" := "Wage Component";
                ProjCostPlusRec.Element := Element;
                ProjCostPlusRec."Extension Contract" := "Extension Contract";  //C051393

                EmplRec.GET(ProjCostPlusRec."Employee No.");
                CASE "Component Type" OF
                  "Component Type"::Hours: ProjCostPlusRec.Description := lvText002;
                  "Component Type"::Expenses: ProjCostPlusRec.Description := lvText003;
                END;
                ProjCostPlusRec.Description :=
                  COPYSTR(ProjCostPlusRec.Description + EmplRec."Full Name", 1, MAXSTRLEN(ProjCostPlusRec.Description));
                ProjCostPlusRec.VALIDATE(Quantity,"Total Line");
                ProjCostPlusRec."Cost Price (LCY)" := "Unit Cost (LCY)";
                ProjCostPlusRec.VALIDATE("Basic Price (LCY)","Unit Cost (LCY)");
                ProjCostPlusRec.MODIFY(TRUE);
              END;
            ELSE
              ErrorFound := TRUE;
          END;
        UNTIL NEXT = 0;
      END;

      IF ErrorFound THEN BEGIN
        MESSAGE(Text001);
      END ELSE BEGIN
        gvHourLineRec.MODIFYALL("Cost Plus Entry Created", TRUE);
        gvHourLineRec.MARKEDONLY(FALSE);
      END;
      gvHourLineRec.CLEARMARKS;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyPlantTypeToSalesLine@1100485014(VAR IMarkedPlantTypeRec@1100485000 : TEMPORARY Record 11012551;ISalesHeadRec@1100485001 : Record 36;ICurrLineNo@1100485003 : Integer);
    VAR
      lvSalesLineRec@1100485002 : Record 37;
    BEGIN
      //* This function is made for Sales Rental Contracts
      IF NOT IMarkedPlantTypeRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := IMarkedPlantTypeRec.COUNT;
      CurrLino := ICurrLineNo;
      PrevLino := 0;
      Gap := 0;

      lvSalesLineRec.LOCKTABLE;
      lvSalesLineRec.SETRANGE("Document Type", ISalesHeadRec."Document Type");
      lvSalesLineRec.SETRANGE("Document No.", ISalesHeadRec."No.");
      IF lvSalesLineRec.GET(ISalesHeadRec."Document Type", ISalesHeadRec."No.", CurrLino) THEN BEGIN
        lvSalesLineRec.SETFILTER("Line No.", '<%1', CurrLino);
        IF lvSalesLineRec.FINDLAST THEN
          PrevLino := lvSalesLineRec."Line No.";
        lvSalesLineRec.SETRANGE("Line No.");
        CheckGap;
      END;
      IF Gap = 0 THEN BEGIN
        Gap := 10000;
        IF lvSalesLineRec.FINDLAST THEN
          CurrLino := lvSalesLineRec."Line No.";
      END;
      lvSalesLineRec.RESET;

      REPEAT
        lvSalesLineRec.INIT;
        lvSalesLineRec."Document Type" := ISalesHeadRec."Document Type";
        lvSalesLineRec."Document No." := ISalesHeadRec."No.";
        lvSalesLineRec."Line No." := CurrLino + Gap;
        CurrLino := lvSalesLineRec."Line No.";
        lvSalesLineRec.InitRecord;
        lvSalesLineRec.VALIDATE("Plant Type", IMarkedPlantTypeRec.Code);
        lvSalesLineRec.INSERT(TRUE);
      UNTIL IMarkedPlantTypeRec.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyPlantTypeToPlantOrderLine@1100525004(VAR MarkedPlantTypeRec@1100485000 : TEMPORARY Record 11012551;PlantOrderRec@1100485001 : Record 11012556;CurrentLineNo@1100485003 : Integer);
    VAR
      PlantOrderLineRec@1100485002 : Record 11012557;
    BEGIN
      IF NOT MarkedPlantTypeRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedPlantTypeRec.COUNT;
      CurrLino := CurrentLineNo;
      PrevLino := 0;
      Gap := 0;

      PlantOrderLineRec.SETRANGE("Plant Order No.", PlantOrderRec."No.");
      IF PlantOrderLineRec.GET(PlantOrderRec."No.", CurrLino) THEN BEGIN
        PlantOrderLineRec.SETFILTER("Line No.", '<%1', CurrLino);
        IF PlantOrderLineRec.FINDLAST THEN
          PrevLino := PlantOrderLineRec."Line No.";
        PlantOrderLineRec.SETRANGE("Line No.");
        CheckGap;
      END;
      IF Gap = 0 THEN BEGIN
        Gap := 10000;
        IF PlantOrderLineRec.FINDLAST THEN
          CurrLino := PlantOrderLineRec."Line No.";
      END;
      PlantOrderLineRec.RESET;

      REPEAT
        PlantOrderLineRec.INIT;
        PlantOrderLineRec."Plant Order No." := PlantOrderRec."No.";
        PlantOrderLineRec."Line No." := CurrLino + Gap;
        CurrLino := PlantOrderLineRec."Line No.";
        PlantOrderLineRec.InitRecord;
        PlantOrderLineRec.Type := PlantOrderLineRec.Type::Plant;
        PlantOrderLineRec.VALIDATE("Plant Type", MarkedPlantTypeRec.Code);
        PlantOrderLineRec.INSERT(TRUE);
      UNTIL MarkedPlantTypeRec.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyPlantTypeToPlantRequesLine@1100525006(VAR MarkedPlantTypeRec@1100485000 : TEMPORARY Record 11012551;PlantRequestRec@1100485001 : Record 11020520;CurrentLineNo@1100485003 : Integer);
    VAR
      PlantRequestLineRec@1100485002 : Record 11020521;
    BEGIN
      IF NOT MarkedPlantTypeRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedPlantTypeRec.COUNT;
      CurrLino := CurrentLineNo;
      PrevLino := 0;
      Gap := 0;

      PlantRequestLineRec.SETRANGE("Plant Request No.", PlantRequestRec."No.");
      IF PlantRequestLineRec.GET(PlantRequestRec."No.", CurrLino) THEN BEGIN
        PlantRequestLineRec.SETFILTER("Line No.", '<%1', CurrLino);
        IF PlantRequestLineRec.FINDLAST THEN
          PrevLino := PlantRequestLineRec."Line No.";
        PlantRequestLineRec.SETRANGE("Line No.");
        CheckGap;
      END;
      IF Gap = 0 THEN BEGIN
        Gap := 10000;
        IF PlantRequestLineRec.FINDLAST THEN
          CurrLino := PlantRequestLineRec."Line No.";
      END;
      PlantRequestLineRec.RESET;

      REPEAT
        PlantRequestLineRec.INIT;
        PlantRequestLineRec."Plant Request No." := PlantRequestRec."No.";
        PlantRequestLineRec.InitRecord;
        PlantRequestLineRec."Line No." := CurrLino + Gap;
        CurrLino := PlantRequestLineRec."Line No.";
        PlantRequestLineRec.Type := PlantRequestLineRec.Type::Plant;
        PlantRequestLineRec.VALIDATE("Plant Type", MarkedPlantTypeRec.Code);
        PlantRequestLineRec.INSERT(TRUE);
      UNTIL MarkedPlantTypeRec.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyPlantTypeToPlantRequesLineSMF@1100529700(VAR MarkedPlantTypeRec@1100485000 : TEMPORARY Record 11012551;PlantRequestSMF@1100485001 : Record 11125529;CurrentLineNo@1100485003 : Integer);
    VAR
      PlantRequestLineSMF@1100485002 : Record 11125530;
    BEGIN
      IF NOT MarkedPlantTypeRec.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedPlantTypeRec.COUNT;
      CurrLino := CurrentLineNo;
      PrevLino := 0;
      Gap := 0;

      PlantRequestLineSMF.SETRANGE("Request No.", PlantRequestSMF."No.");
      IF PlantRequestLineSMF.GET(PlantRequestSMF."No.", CurrLino) THEN BEGIN
        PlantRequestLineSMF.SETFILTER("Line No.", '<%1', CurrLino);
        IF PlantRequestLineSMF.FINDLAST THEN
          PrevLino := PlantRequestLineSMF."Line No.";
        PlantRequestLineSMF.SETRANGE("Line No.");
        CheckGap;
      END;
      IF Gap = 0 THEN BEGIN
        Gap := 10000;
        IF PlantRequestLineSMF.FINDLAST THEN
          CurrLino := PlantRequestLineSMF."Line No.";
      END;
      PlantRequestLineSMF.RESET;

      REPEAT
        PlantRequestLineSMF.INIT;
        PlantRequestLineSMF."Request No." := PlantRequestSMF."No.";
        PlantRequestLineSMF.InitRecord;
        PlantRequestLineSMF."Line No." := CurrLino + Gap;
        CurrLino := PlantRequestLineSMF."Line No.";
        PlantRequestLineSMF.Type := PlantRequestLineSMF.Type::Plant;
        PlantRequestLineSMF.VALIDATE("Plant/Item", MarkedPlantTypeRec.Code);
        PlantRequestLineSMF.INSERT(TRUE);
      UNTIL MarkedPlantTypeRec.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyPlantTypeToPlantNeedLine@1100525016(VAR MarkedPlantType@1100485000 : TEMPORARY Record 11012551;PlantLocation@1100485001 : Code[20];CurrentLineNo@1100485003 : Integer);
    VAR
      PlantNeedLine@1100485002 : Record 11012579;
    BEGIN
      IF NOT MarkedPlantType.FINDSET THEN BEGIN
        MESSAGE(Text041);
        EXIT;
      END;

      MarkNo := MarkedPlantType.COUNT;
      CurrLino := CurrentLineNo;
      PrevLino := 0;
      Gap := 0;

      PlantNeedLine.SETRANGE(Location, PlantLocation);
      IF PlantNeedLine.GET(PlantLocation, CurrLino) THEN BEGIN
        PlantNeedLine.SETFILTER("Line No.", '<%1', CurrLino);
        IF PlantNeedLine.FINDLAST THEN
          PrevLino := PlantNeedLine."Line No.";
        PlantNeedLine.SETRANGE("Line No.");
        CheckGap;
      END;
      IF Gap = 0 THEN BEGIN
        Gap := 10000;
        IF PlantNeedLine.FINDLAST THEN
          CurrLino := PlantNeedLine."Line No.";
      END;
      PlantNeedLine.RESET;

      REPEAT
        PlantNeedLine.INIT;
        PlantNeedLine.Location := PlantLocation;
        PlantNeedLine."Line No." := CurrLino + Gap;
        CurrLino := PlantNeedLine."Line No.";
        PlantNeedLine.VALIDATE(Type, PlantNeedLine.Type::Plant);
        PlantNeedLine.VALIDATE("Plant Type", MarkedPlantType.Code);
        PlantNeedLine.FillDefaultFromDepot;
        PlantNeedLine.INSERT(TRUE);
      UNTIL MarkedPlantType.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyItemJournalObligations@1100525007(VAR IItemJournalLine@1100485001 : Record 83) LinesCopied : Boolean;
    VAR
      ItemJournalLine@1100485002 : Record 83;
      ErrorFound@1100485000 : Boolean;
    BEGIN
      ItemJournalLine.COPY(IItemJournalLine);
      WITH ItemJournalLine DO BEGIN
        IF NOT FINDSET THEN BEGIN
          MESSAGE(Text041);
          EXIT;
        END;

        REPEAT
          CASE g_table OF
            DATABASE::"Service Order Cost Plus Entry":
              BEGIN
                IF "Service Order No." <> '' THEN
                  g_code1 := "Service Order No.";  //is needed when navigating from form 11125118
                ServCostPlusRec.LOCKTABLE;
                ServCostPlusRec.SETRANGE("Service Order No.", g_code1);
                IF ServCostPlusRec.FINDLAST THEN
                  CurrLino := ServCostPlusRec."Line No."
                ELSE
                  CurrLino := 0;

                ServCostPlusRec.INIT;
                ServCostPlusRec.VALIDATE("Service Order No.", g_code1);
                ServCostPlusRec."Line No." := CurrLino + 10000;
                CurrLino := ServCostPlusRec."Line No.";
                ServCostPlusRec.INSERT(TRUE);
                LinesCopied := TRUE;

                ServCostPlusRec.Description := Description;

                //db, 05-07-05: set defaults for cost object without item code
                ServCostPlusRec."Cost Object" := "Shortcut Dimension 2 Code";
                ServCostPlusRec."Cost Component" := "Cost Component";
                ServCostPlusRec."Cost Price (LCY)" := "Unit Cost";
                ServCostPlusRec."Basic Price (LCY)" := "Unit Cost";
                ServCostPlusRec."Basic Price Found at" := TABLECAPTION;
                ServCostPlusRec."Sales Price (LCY)" := ServCostPlusRec."Basic Price (LCY)";
                ServCostPlusRec.VALIDATE("Surcharge %", ServCostPlusRec.GetSurcharge);
                IF "Item No." <> '' THEN
                  ServCostPlusRec.VALIDATE("Item No.", "Item No.");
                ServCostPlusRec.VALIDATE("Unit of Measure", "Unit of Measure Code");
                ServCostPlusRec.VALIDATE(Quantity, Quantity);
                // Cannot use "Document No.". Should use Journal Template Name/Journal Batch Name
      //          ServCostPlusRec."Source Document" := "Document No.";
      //          IF NOT "Cost Plus Entry Created" THEN
      //            ServCostPlusRec."Source Line" := "Line No.";
                ServCostPlusRec.MODIFY(TRUE);
                ServCostPlusRec.DetermineRemovalContribution(FALSE);
              END;
            DATABASE::"Project Cost Plus Entry":
              BEGIN
                ProjCostPlusRec.LOCKTABLE;
                ProjCostPlusRec.SETRANGE("Project No.", g_code1);
                ProjCostPlusRec.SETRANGE(Principal, g_code2);
                ProjCostPlusRec.SETRANGE("Commission No.",g_code3);
                ProjCostPlusRec.SETRANGE("Settl.Sheet No.", g_code4);
                IF ProjCostPlusRec.FINDLAST THEN
                  CurrLino := ProjCostPlusRec."Line No."
                ELSE
                  CurrLino := 0;

                ProjCostPlusRec.INIT;
                ProjCostPlusRec."Project No." := g_code1;
                ProjCostPlusRec.Principal := g_code2;
                ProjCostPlusRec."Commission No." := g_code3;
                ProjCostPlusRec."Settl.Sheet No." := g_code4;
                ProjCostPlusRec."Line No." := CurrLino + 10000;
                CurrLino := ProjCostPlusRec."Line No.";
                ProjCostPlusRec.INSERT(TRUE);
                LinesCopied := TRUE;

                ProjCostPlusRec.Element := Element;
                ProjCostPlusRec.DetermineVATProdPostingGroup;  //db, 20-08-07
                ProjCostPlusRec.Description := Description;

                //db, 05-07-05: set defaults for cost object without item code
                ProjCostPlusRec."Cost Object" := "Shortcut Dimension 2 Code";
                ProjCostPlusRec."Cost Component" := "Cost Component";
                ProjCostPlusRec."Cost Price (LCY)" := "Unit Cost";
                ProjCostPlusRec."Basic Price (LCY)" := "Unit Cost";
                ProjCostPlusRec."Sales Price (LCY)" := ProjCostPlusRec."Basic Price (LCY)";
                ProjCostPlusRec.VALIDATE("Surcharge %", ProjCostPlusRec.GetSurcharge);
                IF "Item No." <> '' THEN
                  ProjCostPlusRec.VALIDATE("Item No.", "Item No.");
                ProjCostPlusRec.VALIDATE("Unit of Measure", "Unit of Measure Code");
                ProjCostPlusRec.VALIDATE(Quantity, Quantity);
      //          ProjCostPlusRec."Source Document" := "Document No.";
      //          IF NOT "Cost Plus Entry Created" THEN
      //            ProjCostPlusRec."Source Line" := "Line No.";
                ProjCostPlusRec.MODIFY(TRUE);
                ProjCostPlusRec.DetermineRemovalContribution;
              END;
            ELSE
              ErrorFound := TRUE;
          END;
        UNTIL NEXT = 0;
      END;

      IF ErrorFound THEN BEGIN
        MESSAGE(Text001);
      END ELSE BEGIN
        ItemJournalLine.MODIFYALL("Cost Plus Entry Created", TRUE);
        ItemJournalLine.MARKEDONLY(FALSE);
      END;
      ItemJournalLine.CLEARMARKS;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyProjInventToShippingLine@1100525018(VAR MarkedLine@1100525000 : Record 11012670) LinesCopied : Boolean;
    VAR
      ShippingOrderLine@1100525001 : Record 11071885;
      RecRef@1100525003 : RecordRef;
    BEGIN
      //db, 13-07-15: C009868
      IF MarkedLine.COUNT = 0 THEN
        ERROR(Text041);

      MarkNo := MarkedLine.COUNT;
      DetermineCurrLinoPrevLinoGapForShippingOrderLine;
      MarkedLine.FINDSET;
      REPEAT
        RecRef.GETTABLE(MarkedLine);
        InsertShippingOrderLine(
          RecRef,ShippingOrderLine."Source Line Type"::"Project Inventory Entry");
        LinesCopied := TRUE;
      UNTIL MarkedLine.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopySalesLineToShippingLine@1100525011(VAR MarkedSalesLine@1100525000 : Record 37) LinesCopied : Boolean;
    VAR
      ShippingOrderLine@1100525001 : Record 11071885;
      RecRef@1100525003 : RecordRef;
    BEGIN
      IF MarkedSalesLine.COUNT = 0 THEN
        ERROR(Text041);

      MarkNo := MarkedSalesLine.COUNT;
      DetermineCurrLinoPrevLinoGapForShippingOrderLine;
      MarkedSalesLine.FINDSET;
      REPEAT
        RecRef.GETTABLE(MarkedSalesLine);
        InsertShippingOrderLine(
          RecRef,ShippingOrderLine."Source Line Type"::"Sales Order Line");
        LinesCopied := TRUE;
      UNTIL MarkedSalesLine.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyPurchLineToShippingLine@1100525010(VAR MarkedPurchaseLine@1100525000 : Record 39) LinesCopied : Boolean;
    VAR
      ShippingOrderHeader@1100528400 : Record 11020623;
      ShippingOrderLine@1100525001 : Record 11071885;
      RecRef@1100525003 : RecordRef;
      SourceLineType@1100528401 : Integer;
    BEGIN
      IF MarkedPurchaseLine.COUNT = 0 THEN
        ERROR(Text041);

      MarkNo := MarkedPurchaseLine.COUNT;
      DetermineCurrLinoPrevLinoGapForShippingOrderLine;
      IF NOT ShippingOrderHeader.GET(g_code1) THEN
        ShippingOrderHeader.INIT;
      IF ShippingOrderHeader."Source Type" = ShippingOrderHeader."Source Type"::"Service Order" THEN
        SourceLineType := ShippingOrderLine."Source Line Type"::"Purchase Order Line (Service Order)"
      ELSE
        SourceLineType := ShippingOrderLine."Source Line Type"::"Purchase Return Order Line";
      MarkedPurchaseLine.FINDSET;
      REPEAT
        RecRef.GETTABLE(MarkedPurchaseLine);
        InsertShippingOrderLine(RecRef,SourceLineType);
        LinesCopied := TRUE;
      UNTIL MarkedPurchaseLine.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyAdviceOrderLineToShippingLine@1100528403(VAR MarkedAdviceOrderLine@1100525000 : Record 11012055) LinesCopied : Boolean;
    VAR
      ShippingOrderLine@1100525001 : Record 11071885;
      RecRef@1100525003 : RecordRef;
    BEGIN
      IF MarkedAdviceOrderLine.COUNT = 0 THEN
        ERROR(Text041);

      MarkNo := MarkedAdviceOrderLine.COUNT;
      DetermineCurrLinoPrevLinoGapForShippingOrderLine;
      MarkedAdviceOrderLine.FINDSET;
      REPEAT
        RecRef.GETTABLE(MarkedAdviceOrderLine);
        InsertShippingOrderLine(
          RecRef,ShippingOrderLine."Source Line Type"::"Advice Order Line (Service Order)");
        LinesCopied := TRUE;
      UNTIL MarkedAdviceOrderLine.NEXT = 0;
      COMMIT;
    END;

    [External]
    PROCEDURE CopyItemJournalLineToShippingLine@1100528404(VAR MarkedItemJournalLine@1100525000 : Record 83) LinesCopied : Boolean;
    VAR
      ShippingOrderLine@1100525001 : Record 11071885;
      RecRef@1100525003 : RecordRef;
    BEGIN
      IF MarkedItemJournalLine.COUNT = 0 THEN
        ERROR(Text041);

      MarkNo := MarkedItemJournalLine.COUNT;
      DetermineCurrLinoPrevLinoGapForShippingOrderLine;
      MarkedItemJournalLine.FINDSET;
      REPEAT
        RecRef.GETTABLE(MarkedItemJournalLine);
        InsertShippingOrderLine(
          RecRef,ShippingOrderLine."Source Line Type"::"Item Journal Line (Service Order)");
        LinesCopied := TRUE;
      UNTIL MarkedItemJournalLine.NEXT = 0;
      COMMIT;
    END;

    LOCAL PROCEDURE DetermineCurrLinoPrevLinoGapForShippingOrderLine@1100528405();
    VAR
      ShippingOrderLine@1100528400 : Record 11071885;
    BEGIN
      CurrLino := g_int2;
      PrevLino := 0;
      Gap := 0;

      ShippingOrderLine.SETRANGE("Document No.", g_code1);
      IF ShippingOrderLine.GET(g_code1, CurrLino) THEN BEGIN
        ShippingOrderLine.SETFILTER("Line No.", '<%1', CurrLino);
        IF ShippingOrderLine.FINDLAST THEN
          PrevLino := ShippingOrderLine."Line No.";
        ShippingOrderLine.SETRANGE("Line No.");
        CheckGap;
      END;
      IF Gap = 0 THEN BEGIN
        Gap := 10000;
        IF ShippingOrderLine.FINDLAST THEN
          CurrLino := ShippingOrderLine."Line No.";
      END;
    END;

    LOCAL PROCEDURE InsertShippingOrderLine@1100528421(RecRef@1100528401 : RecordRef;SourceLineType@1100528402 : Integer);
    VAR
      ShippingOrderLine@1100528400 : Record 11071885;
    BEGIN
      ShippingOrderLine."Document No." := g_code1;
      ShippingOrderLine."Line No." := CurrLino + Gap;
      CurrLino := ShippingOrderLine."Line No.";
      ShippingOrderLine."Source Line Type" := SourceLineType;
      ShippingOrderLine.FillShipmentLine(RecRef);
      ShippingOrderLine.INSERT(TRUE);
    END;

    [External]
    PROCEDURE CopyServiceObjects@1100526201(VAR MarkedServiceObject@1100526200 : Record 11071691);
    VAR
      ContractObject@1100526201 : Record 11071702;
      ProjectBuildingObjectRel@1100528600 : Record 11071919;
      TryOutSuccessor@1100409000 : Record 11012761;
      ServiceLocStructureLine@1100528601 : Record 11071720;
      ServSurvLocationObject@1100528602 : Record 11071813;
      ServiceOrderObject@1100529600 : Record 11071724;
      LastLineNo@1100409001 : Integer;
    BEGIN
      IF MarkedServiceObject.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Contract Object":
          BEGIN
            MarkedServiceObject.FINDSET;
            REPEAT
              ContractObject.INIT;
              ContractObject.VALIDATE("Service Contract No.", g_code1);
              ContractObject."Service Object No." := '';
              ContractObject.VALIDATE("Service Object No.", MarkedServiceObject."No.");
              ContractObject.INSERT(TRUE);
            UNTIL MarkedServiceObject.NEXT = 0;
            COMMIT;
          END;
        DATABASE::"Project-Building-Object Rel.":
          BEGIN
            MarkedServiceObject.FINDSET;
            REPEAT
              ProjectBuildingObjectRel.INIT;
              ProjectBuildingObjectRel."Project No." := g_code1;
              ProjectBuildingObjectRel."Building Code" := g_code2;
              ProjectBuildingObjectRel.VALIDATE("Object No.", MarkedServiceObject."No.");
              ProjectBuildingObjectRel.INSERT(TRUE);
            UNTIL MarkedServiceObject.NEXT = 0;
            COMMIT;
          END;
        //kzwerver, 120823, sn, #T000649
        DATABASE::"Try-out Successor": BEGIN
          TryOutSuccessor.SETRANGE("Try-out No.", g_code1);
          TryOutSuccessor.SETRANGE("Try-out Quote", g_code2);
          IF (TryOutSuccessor.FINDLAST) THEN
            LastLineNo := TryOutSuccessor."Line No.";
          MarkedServiceObject.FINDSET;
          REPEAT
            LastLineNo += 10000;
            TryOutSuccessor.INIT;
            TryOutSuccessor."Try-out No." := g_code1;
            TryOutSuccessor."Try-out Quote" := g_code2;
            TryOutSuccessor."Line No." := LastLineNo;
            TryOutSuccessor.VALIDATE("Service Object No.", MarkedServiceObject."No.");
            TryOutSuccessor.INSERT(TRUE);
          UNTIL (MarkedServiceObject.NEXT = 0);
          COMMIT;
        END;
        //kzwerver, 120823, en, #T000649
        DATABASE::"Service Loc. Structure Line":
          BEGIN
            IF MarkedServiceObject.FINDSET THEN
              REPEAT
                ServiceLocStructureLine.INIT;
                ServiceLocStructureLine.VALIDATE("Service Location No.", g_code1);
                ServiceLocStructureLine.VALIDATE("Structure No.", g_int1);
                ServiceLocStructureLine.VALIDATE("No.", g_code2);
                ServiceLocStructureLine.VALIDATE("Service Object No.", MarkedServiceObject."No.");
                ServiceLocStructureLine.INSERT(TRUE);
              UNTIL MarkedServiceObject.NEXT = 0;
            COMMIT;
          END;
        DATABASE::"Serv. Surv. Location Object":
          BEGIN
            IF MarkedServiceObject.FINDSET THEN
              REPEAT
                ServSurvLocationObject.INIT;
                ServSurvLocationObject."Survey No." := g_code1;
                ServSurvLocationObject."Location Code" := g_code2;
                ServSurvLocationObject."Seq. No." := 0;
                ServSurvLocationObject.INSERT(TRUE);
                ServSurvLocationObject.VALIDATE("Existing Service Object No.", MarkedServiceObject."No.");
                ServSurvLocationObject.MODIFY(TRUE);
              UNTIL MarkedServiceObject.NEXT = 0;
          END;
        DATABASE::"Service Order Object":
          BEGIN
            IF MarkedServiceObject.FINDSET THEN
              REPEAT
                ServiceOrderObject.INIT;
                ServiceOrderObject."Service Order No." := g_code1;
                ServiceOrderObject."Maintenance Scheme" := g_code2;
                ServiceOrderObject.VALIDATE("Object No.", MarkedServiceObject."No.");
                ServiceOrderObject.INSERT(TRUE);
              UNTIL MarkedServiceObject.NEXT = 0;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyInspectionLines@1100528601(VAR MarkedBaseServiceInspLine@1100528600 : Record 11071748);
    VAR
      ServiceInspectionLine@1100528601 : Record 11071751;
    BEGIN
      IF MarkedBaseServiceInspLine.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Service Inspection Line":
          BEGIN
            MarkNo := MarkedBaseServiceInspLine.COUNT;
            CurrLino := g_int2;
            PrevLino := 0;
            Gap := 0;

            ServiceInspectionLine.SETRANGE("Inspection Type", g_int1);
            ServiceInspectionLine.SETRANGE("Service Contract No.", g_code1);
            ServiceInspectionLine.SETRANGE(Code, g_code2);
            ServiceInspectionLine.SETRANGE("Belongs to Scheme", g_code3);
            ServiceInspectionLine.SETRANGE("Belongs to Base Insp. List", g_code4);
            ServiceInspectionLine.SETRANGE("Index Date", g_date1);
            IF ServiceInspectionLine.GET(g_int1, g_code1, g_code2, g_code3, g_code4, g_date1, g_int2) THEN BEGIN
              ServiceInspectionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServiceInspectionLine.FINDLAST THEN
                PrevLino := ServiceInspectionLine."Line No.";
              ServiceInspectionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServiceInspectionLine.FINDLAST THEN
                CurrLino := ServiceInspectionLine."Line No.";
            END;

            MarkedBaseServiceInspLine.FINDSET;
            REPEAT
              ServiceInspectionLine.INIT;
              ServiceInspectionLine.VALIDATE("Inspection Type", g_int1);
              ServiceInspectionLine.VALIDATE("Service Contract No.", g_code1);
              ServiceInspectionLine.VALIDATE(Code, g_code2);
              ServiceInspectionLine.VALIDATE("Belongs to Scheme", g_code3);
              ServiceInspectionLine.VALIDATE("Belongs to Base Insp. List", g_code4);
              ServiceInspectionLine.VALIDATE("Index Date", g_date1);
              ServiceInspectionLine.VALIDATE("Line No.", CurrLino + Gap);
              CurrLino := ServiceInspectionLine."Line No.";
              ServiceInspectionLine.VALIDATE(Type, ServiceInspectionLine.Type::Line);
              ServiceInspectionLine.VALIDATE("Inspection Code", MarkedBaseServiceInspLine.Code);
              ServiceInspectionLine.VALIDATE(Description, MarkedBaseServiceInspLine.Description);
              ServiceInspectionLine.VALIDATE("Field Type", MarkedBaseServiceInspLine."Field Type");
              ServiceInspectionLine.VALIDATE("Unit Of Measure", MarkedBaseServiceInspLine."Unit Of Measure");
              ServiceInspectionLine.INSERT(TRUE);
            UNTIL MarkedBaseServiceInspLine.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyPlantInspectionLines@1100528800(VAR MarkedBasePlantInspLine@1100528600 : Record 11072679);
    VAR
      PlantInspectionLine@1100528601 : Record 11072684;
    BEGIN
      IF MarkedBasePlantInspLine.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Plant Inspection Line":
          BEGIN
            MarkNo := MarkedBasePlantInspLine.COUNT;
            CurrLino := g_int2;
            PrevLino := 0;
            Gap := 0;

            PlantInspectionLine.SETRANGE(Level, g_int1);
            PlantInspectionLine.SETRANGE("Plant Type", g_code1);
            PlantInspectionLine.SETRANGE("Plant No.", g_code2);
            PlantInspectionLine.SETRANGE("Maintenance Scheme", g_code3);
            PlantInspectionLine.SETRANGE("Base Inspection List", g_code4);
            PlantInspectionLine.SETRANGE("Index Date", g_date1);
            IF PlantInspectionLine.GET(g_int1, g_code1, g_code2, g_code3, g_code4, g_date1, g_int2) THEN BEGIN
              PlantInspectionLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF PlantInspectionLine.FINDLAST THEN
                PrevLino := PlantInspectionLine."Line No.";
              PlantInspectionLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF PlantInspectionLine.FINDLAST THEN
                CurrLino := PlantInspectionLine."Line No.";
            END;

            MarkedBasePlantInspLine.FINDSET;
            REPEAT
              PlantInspectionLine.INIT;
              PlantInspectionLine.VALIDATE(Level, g_int1);
              PlantInspectionLine.VALIDATE("Plant Type", g_code1);
              PlantInspectionLine.VALIDATE("Plant No.", g_code2);
              PlantInspectionLine.VALIDATE("Maintenance Scheme", g_code3);
              PlantInspectionLine.VALIDATE("Base Inspection List", g_code4);
              PlantInspectionLine.VALIDATE("Index Date", g_date1);
              PlantInspectionLine.VALIDATE("Line No.", CurrLino + Gap);
              CurrLino := PlantInspectionLine."Line No.";
              PlantInspectionLine.VALIDATE(Type, PlantInspectionLine.Type::Line);
              PlantInspectionLine.VALIDATE("Inspection Code", MarkedBasePlantInspLine.Code);
              PlantInspectionLine.VALIDATE(Description, MarkedBasePlantInspLine.Description);
              PlantInspectionLine.VALIDATE("Field Type", MarkedBasePlantInspLine."Field Type");
              PlantInspectionLine.VALIDATE("Unit Of Measure", MarkedBasePlantInspLine."Unit Of Measure");
              PlantInspectionLine.INSERT(TRUE);
            UNTIL MarkedBasePlantInspLine.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyObjSpecificationLines@1100528604(VAR MarkedBaseObjSpecificationLine@1100528600 : Record 11071779);
    VAR
      ObjectSpecificationLine@1100528601 : Record 11071781;
    BEGIN
      IF MarkedBaseObjSpecificationLine.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Object Specification Line",
        DATABASE::"Service Order Obj. Spec. Line":
          BEGIN
            MarkNo := MarkedBaseObjSpecificationLine.COUNT;
            CurrLino := g_int2;
            PrevLino := 0;
            Gap := 0;

            ObjectSpecificationLine.SETRANGE("Specification Type", g_int1);
            ObjectSpecificationLine.SETRANGE(Code, g_code1);
            ObjectSpecificationLine.SETRANGE("Object Line No.", g_int3);  //DP00118
            IF ObjectSpecificationLine.GET(g_int1, g_code1, g_int3, g_int2) THEN BEGIN  //DP00118
              ObjectSpecificationLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF ObjectSpecificationLine.FINDLAST THEN
                PrevLino := ObjectSpecificationLine."Line No.";
              ObjectSpecificationLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ObjectSpecificationLine.FINDLAST THEN
                CurrLino := ObjectSpecificationLine."Line No.";
            END;

            MarkedBaseObjSpecificationLine.FINDSET;
            REPEAT
              ObjectSpecificationLine.INIT;
              ObjectSpecificationLine.VALIDATE("Specification Type", g_int1);
              ObjectSpecificationLine.VALIDATE(Code, g_code1);
              ObjectSpecificationLine."Object Line No." := g_int3;  //DP00118
              ObjectSpecificationLine.VALIDATE("Line No.", CurrLino + Gap);
              CurrLino := ObjectSpecificationLine."Line No.";
              ObjectSpecificationLine.VALIDATE(Type, ObjectSpecificationLine.Type::Line);
              ObjectSpecificationLine.VALIDATE("Specification Code", MarkedBaseObjSpecificationLine.Code);
              ObjectSpecificationLine.VALIDATE(Description, MarkedBaseObjSpecificationLine.Description);
              ObjectSpecificationLine.VALIDATE("Field Type", MarkedBaseObjSpecificationLine."Field Type");
              ObjectSpecificationLine.VALIDATE("Unit Of Measure", MarkedBaseObjSpecificationLine."Unit Of Measure");
              ObjectSpecificationLine.INSERT(TRUE);
            UNTIL MarkedBaseObjSpecificationLine.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    [External]
    PROCEDURE CopySurveyObjectSpecLines@1100528611(VAR MarkedBaseObjSpecificationLine@1100528600 : Record 11071779);
    VAR
      ServiceSurveyObjectSpec@1100528601 : Record 11071972;
    BEGIN
      IF MarkedBaseObjSpecificationLine.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Service Survey Object Spec.":
          BEGIN
            MarkNo := MarkedBaseObjSpecificationLine.COUNT;
            CurrLino := g_int2;
            PrevLino := 0;
            Gap := 0;

            ServiceSurveyObjectSpec.SETRANGE("Survey No.", g_code1);
            ServiceSurveyObjectSpec.SETRANGE("Location Code", g_code2);
            ServiceSurveyObjectSpec.SETRANGE("Seq. No.", g_int1);
            IF ServiceSurveyObjectSpec.GET(g_code1, g_code2, g_int1, g_int2) THEN BEGIN
              ServiceSurveyObjectSpec.SETFILTER("Line No.", '<%1', CurrLino);
              IF ServiceSurveyObjectSpec.FINDLAST THEN
                PrevLino := ServiceSurveyObjectSpec."Line No.";
              ServiceSurveyObjectSpec.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ServiceSurveyObjectSpec.FINDLAST THEN
                CurrLino := ServiceSurveyObjectSpec."Line No.";
            END;

            MarkedBaseObjSpecificationLine.FINDSET;
            REPEAT
              ServiceSurveyObjectSpec.INIT;
              ServiceSurveyObjectSpec.VALIDATE("Survey No.", g_code1);
              ServiceSurveyObjectSpec.VALIDATE("Location Code", g_code2);
              ServiceSurveyObjectSpec.VALIDATE("Seq. No.", g_int1);
              ServiceSurveyObjectSpec.VALIDATE("Line No.", CurrLino + Gap);
              CurrLino := ServiceSurveyObjectSpec."Line No.";
              ServiceSurveyObjectSpec.VALIDATE(Type, ServiceSurveyObjectSpec.Type::Line);
              ServiceSurveyObjectSpec.VALIDATE("Specification Code", MarkedBaseObjSpecificationLine.Code);
              ServiceSurveyObjectSpec.VALIDATE(Description, MarkedBaseObjSpecificationLine.Description);
              ServiceSurveyObjectSpec.VALIDATE("Field Type", MarkedBaseObjSpecificationLine."Field Type");
              ServiceSurveyObjectSpec.VALIDATE("Unit Of Measure", MarkedBaseObjSpecificationLine."Unit Of Measure");
              ServiceSurveyObjectSpec.INSERT(TRUE);
            UNTIL MarkedBaseObjSpecificationLine.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyComplexSpecLines@1100528302(VAR MarkedBaseComplexBuildingSpec@1100528300 : Record 11071817);
    VAR
      ComplexBuildingSpecification@1100528301 : Record 11071920;
    BEGIN
      IF MarkedBaseComplexBuildingSpec.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Base Complex/Building Spec.":
          BEGIN
            MarkNo := MarkedBaseComplexBuildingSpec.COUNT;
            CurrLino := g_int2;
            PrevLino := 0;
            Gap := 0;

            ComplexBuildingSpecification.SETRANGE("Specification Type", g_int1);
            ComplexBuildingSpecification.SETRANGE(Code, g_code1);
            IF ComplexBuildingSpecification.GET(g_int1, g_code1, g_int2) THEN BEGIN
              ComplexBuildingSpecification.SETFILTER("Line No.", '<%1', CurrLino);
              IF ComplexBuildingSpecification.FINDLAST THEN
                PrevLino := ComplexBuildingSpecification."Line No.";
              ComplexBuildingSpecification.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF ComplexBuildingSpecification.FINDLAST THEN
                CurrLino := ComplexBuildingSpecification."Line No.";
            END;

            MarkedBaseComplexBuildingSpec.FINDSET;
            REPEAT
              ComplexBuildingSpecification.TRANSFERFIELDS(MarkedBaseComplexBuildingSpec);
              ComplexBuildingSpecification.VALIDATE("Specification Type", g_int1);
              ComplexBuildingSpecification.VALIDATE(Code, g_code1);
              ComplexBuildingSpecification."Line Type" := ComplexBuildingSpecification."Line Type"::Line;
              ComplexBuildingSpecification.VALIDATE("Line No.", CurrLino + Gap);
              CurrLino := ComplexBuildingSpecification."Line No.";
              ComplexBuildingSpecification.INSERT(TRUE);
            UNTIL MarkedBaseComplexBuildingSpec.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyBuildings@1100528606(VAR MarkedBuilding@1100528600 : Record 11071819);
    VAR
      ProjectBuildingRelation@1100528601 : Record 11071918;
    BEGIN
      IF MarkedBuilding.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Project-Building Relation":
          BEGIN
            IF MarkedBuilding.FINDSET THEN
              REPEAT
                ProjectBuildingRelation.INIT;
                ProjectBuildingRelation.VALIDATE("Project No.", g_code1);
                ProjectBuildingRelation.VALIDATE("Building Code", MarkedBuilding.Code);
                ProjectBuildingRelation.INSERT(TRUE);
              UNTIL MarkedBuilding.NEXT = 0;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyBuildingObjects@1100528607(VAR MarkedBuildingObject@1100528600 : Record 11071820);
    VAR
      ProjectBuildingObjectRel@1100528601 : Record 11071919;
    BEGIN
      IF MarkedBuildingObject.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Project-Building-Object Rel.":
          BEGIN
            IF MarkedBuildingObject.FINDSET THEN
              REPEAT
                ProjectBuildingObjectRel.INIT;
                ProjectBuildingObjectRel.VALIDATE("Project No.", g_code1);
                ProjectBuildingObjectRel.VALIDATE("Building Code", g_code2);
                ProjectBuildingObjectRel.VALIDATE("Object No.", MarkedBuildingObject."Object No.");
                ProjectBuildingObjectRel.INSERT(TRUE);
              UNTIL MarkedBuildingObject.NEXT = 0;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyLocSpecificationLines@1100528610(VAR MarkedBaseLocationSpecLine@1100528600 : Record 11071959);
    VAR
      LocationSpecificationLine@1100528601 : Record 11071961;
    BEGIN
      IF MarkedBaseLocationSpecLine.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Location Specification Line":
          BEGIN
            MarkNo := MarkedBaseLocationSpecLine.COUNT;
            CurrLino := g_int2;
            PrevLino := 0;
            Gap := 0;

            LocationSpecificationLine.SETRANGE("Service Location No.", g_code1);
            IF LocationSpecificationLine.GET(g_code1, g_int1) THEN BEGIN
              LocationSpecificationLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF LocationSpecificationLine.FINDLAST THEN
                PrevLino := LocationSpecificationLine."Line No.";
              LocationSpecificationLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF LocationSpecificationLine.FINDLAST THEN
                CurrLino := LocationSpecificationLine."Line No.";
            END;

            MarkedBaseLocationSpecLine.FINDSET;
            REPEAT
              LocationSpecificationLine.INIT;
              LocationSpecificationLine.VALIDATE("Service Location No.", g_code1);
              LocationSpecificationLine.VALIDATE("Line No.", CurrLino + Gap);
              CurrLino := LocationSpecificationLine."Line No.";
              LocationSpecificationLine.VALIDATE(Type, LocationSpecificationLine.Type::Line);
              LocationSpecificationLine.VALIDATE("Specification Code", MarkedBaseLocationSpecLine.Code);
              LocationSpecificationLine.VALIDATE(Description, MarkedBaseLocationSpecLine.Description);
              LocationSpecificationLine.VALIDATE("Field Type", MarkedBaseLocationSpecLine."Field Type");
              LocationSpecificationLine.VALIDATE("Unit Of Measure", MarkedBaseLocationSpecLine."Unit Of Measure");
              LocationSpecificationLine.INSERT(TRUE);
            UNTIL MarkedBaseLocationSpecLine.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyResources@1100528614(VAR MarkedResourceWOP@1100528600 : Record 11229278);
    BEGIN
      IF MarkedResourceWOP.ISEMPTY THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Collective Plan Team":
          BEGIN
          END;
      END;
    END;

    [External]
    PROCEDURE GenerateCostPlus@1100528501(PurchLine@1100528500 : Record 39;QtyToInvoice@1100528501 : Decimal;SerialNo@1100528502 : Code[40];LotNo@1100528503 : Code[20]);
    VAR
      ServiceLedgerEntry@1100528505 : Record 11012819;
      ProjLedgerEntry@1100528504 : Record 11072005;
      ProjCostPlusRec2@1100525000 : Record 11012019;
    BEGIN
      //DP00121
      CASE g_table OF
        DATABASE::"Service Order Cost Plus Entry":
          BEGIN
            //db, 10-01-11: M22696 (use same function as report 11012801)
            FillServEntryForCostPlus(PurchLine,ServiceLedgerEntry,QtyToInvoice);
            ServCostPlusRec.GenerateCostPlusFromServEntry(ServiceLedgerEntry,
              //db.sn, 07-07-11: M21954
              //FALSE,   //HistCostPriceItem
              //FALSE,   //HistCostPriceCostObject
              //db.en, 07-07-11: M21954
              TRUE,    //ConvertUnit
              FALSE,   //AutoTranslate
              SerialNo,//DP00121
              LotNo);  //DP00121
          END;
        DATABASE::"Project Cost Plus Entry":
          BEGIN
            //db, 10-01-11: M22696 (use same function as report 11012013)
            FillProjEntryForCostPlus(PurchLine,ProjLedgerEntry,QtyToInvoice);
            ProjCostPlusRec.GenerateCostPlusFromProjEntry(ProjLedgerEntry, ProjCostPlusRec2,
              g_code1, //ProjCde,
              g_code2, //CustCde,
              g_code3, //CommCde,
              g_code4, //SettlCde,
              FALSE,   //RestQuanLedgEntryAlso
              0D,      //RestQuantityStartDate
              //db.sn, 07-07-11: M21954
              //FALSE,   //HistCostPriceItem
              //FALSE,   //HistCostPriceCostObject
              //db.en, 07-07-11: M21954
              TRUE,    //ConvertUnit
              FALSE,   //AutoTranslate
              FALSE,   //SkipInsert
              SerialNo,//DP00121
              LotNo);  //DP00121
          END;
        ELSE
          ErrorFound := TRUE;
      END;
    END;

    [External]
    PROCEDURE FillServEntryForCostPlus@1100530000(VAR PurchLineRec@1100530000 : Record 39;VAR ServEntryRec@1100530002 : Record 11012819;QtyToInvoice@1100409000 : Decimal);
    VAR
      ServiceSetup@1100525000 : Record 11012800;
      UnitCost@1100409001 : Decimal;
    BEGIN
      //db, 10-01-11: M22696
      ServiceSetup.GET;
      WITH PurchLineRec DO BEGIN
        PurchHeaderRec.GET("Document Type", "Document No.");  //db, 31-08-12: C002025
        ServEntryRec.INIT;
        ServEntryRec."Entry No." := 0;  //trigger to fill Document Line for Cost Plus
        ServEntryRec."Service Order No." := PurchLineRec."Service Order No.";
        ServEntryRec.Description := Description;
        ServEntryRec."Item No." := "Item No.";
        ServEntryRec.Manufacturer := Manufacturer;
        ServEntryRec."Basic Item" := "Basic Item";
        ServEntryRec."Vendor (Trade Item)" := "Vendor (Trade Item)";
        ServEntryRec."Trade Item" := "Trade Item";
        ServEntryRec."Global Dimension 2 Code" := "Shortcut Dimension 2 Code";
        ServEntryRec."Cost Component" := "Cost Component";
        ServEntryRec."Additional Cost" := "Additional Cost (Service)";
        ServEntryRec.Quantity := QtyToInvoice; //DP00121
        ServEntryRec."Unit of Measure Code" := "Unit of Measure Code";
        //db.sn, 20-09-11: M28558
        PurchHeaderRec.GET("Document Type","Document No.");
        IF PurchHeaderRec."Currency Code" = '' THEN BEGIN
          CurrencyRec.InitRoundingPrecision;
        END ELSE BEGIN
          PurchHeaderRec.TESTFIELD("Currency Factor");
          CurrencyRec.GET(PurchHeaderRec."Currency Code");
          CurrencyRec.TESTFIELD("Amount Rounding Precision");
          ServEntryRec."Currency Code" := "Currency Code";  //DP00887
        END;
        IF PurchHeaderRec."Amounts only" AND GetQtyToReceive THEN  //db, 31-08-12: C002025
          UnitCost := "Amnt. to Receive"
        ELSE
          UnitCost := "Direct Unit Cost";
        ServEntryRec."Unit Cost (LCY)" := ROUND(CurrExchRateRec.ExchangeAmtFCYToLCY(
          1, PurchHeaderRec."Job No.", GetDate, "Currency Code",
          UnitCost, PurchHeaderRec."Currency Factor",FALSE),
          CurrencyRec."Amount Rounding Precision");
        ServEntryRec."Unit Cost" := UnitCost;
        //db.en, 20-09-11: M28558
        ServEntryRec."Document No." := "Document No.";
        ServEntryRec."Document Line No." := "Line No.";
        ServEntryRec."Posting Date" := WORKDATE;
        ServEntryRec."Wage Component" := "Wage Component";  //db, 10-08-11: M28631
      END;
    END;

    [External]
    PROCEDURE FillProjEntryForCostPlus@1100530001(VAR PurchLineRec@1100530000 : Record 39;VAR ProjEntryRec@1100530002 : Record 11072005;QtyToInvoice@1100409000 : Decimal);
    VAR
      UnitCost@1100409001 : Decimal;
    BEGIN
      //db, 10-01-11: M22696
      WITH PurchLineRec DO BEGIN
        PurchHeaderRec.GET("Document Type", "Document No.");  //db, 31-08-12: C002025
        ProjEntryRec.INIT;
        ProjEntryRec."Entry No." := 0;  //trigger to fill Document Line for Cost Plus
        ProjEntryRec."Job No." := g_code1;
        IF "Job No." = g_code1 THEN BEGIN
          ProjEntryRec.Element := Element;
          ProjEntryRec."Extension Contract":= "Extension Contract";
        END;
        ProjEntryRec.Description := Description;
        ProjEntryRec."Item No." := "Item No.";
        ProjEntryRec.Manufacturer := Manufacturer;
        ProjEntryRec."Basic Item" := "Basic Item";
        ProjEntryRec."Vendor (Trade Item)" := "Vendor (Trade Item)";
        ProjEntryRec."Trade Item" := "Trade Item";
        ProjEntryRec."Global Dimension 2 Code" := "Shortcut Dimension 2 Code";
        ProjEntryRec."Cost Component" := "Cost Component";
        ProjEntryRec.Quantity := QtyToInvoice; //DP00121
        ProjEntryRec."Unit of Measure Code" := "Unit of Measure Code";
        //db.sn, 20-09-11: M28558
        PurchHeaderRec.GET("Document Type","Document No.");
        IF PurchHeaderRec."Currency Code" = '' THEN BEGIN
          CurrencyRec.InitRoundingPrecision;
        END ELSE BEGIN
          PurchHeaderRec.TESTFIELD("Currency Factor");
          CurrencyRec.GET(PurchHeaderRec."Currency Code");
          CurrencyRec.TESTFIELD("Amount Rounding Precision");
          ProjEntryRec."Currency Code" := "Currency Code";  //DP00887
        END;
        IF PurchHeaderRec."Amounts only" AND GetQtyToReceive THEN  //db, 31-08-12: C002025
          UnitCost := "Amnt. to Receive"
        ELSE
          UnitCost := "Direct Unit Cost";
        ProjEntryRec."Unit Cost (LCY)" := ROUND(CurrExchRateRec.ExchangeAmtFCYToLCY(  //*C000504.n
          1, PurchHeaderRec."Job No.", GetDate, "Currency Code",
          UnitCost, PurchHeaderRec."Currency Factor",FALSE),
          CurrencyRec."Amount Rounding Precision");
        ProjEntryRec."Unit Cost" := UnitCost;  //*C000504.n
        //db.en, 20-09-11: M28558
        ProjEntryRec."Document No." := "Document No.";
        ProjEntryRec."Document Line No." := "Line No.";
        ProjEntryRec."Posting Date" := WORKDATE;
        ProjEntryRec."Wage Component" := "Wage Component";  //db, 10-08-11: M28631
        ProjEntryRec.Element := Element;
        ProjEntryRec."Extension Contract" := "Extension Contract";
      END;
    END;

    [External]
    PROCEDURE GetTrackingSpecification@1100528500(PurchLine@1100528500 : Record 39;GetQtyToReceive@1100528506 : Boolean);
    VAR
      ReservEntry@1100528501 : Record 337;
      NSReservEntry@1100528502 : Record 11071900;
      TrackingSpecification@1100528503 : Record 336;
      NSTrackingSpecification@1100528504 : Record 11071901;
      ItemTrackingLines@1100528505 : Page 6510;
    BEGIN
      //DP00121
      TempTrackingSpecification.RESET;
      TempTrackingSpecification.DELETEALL;

      IF PurchLine.Type = PurchLine.Type::Item THEN BEGIN
        ReservEntry.SETCURRENTKEY(
          "Source ID","Source Ref. No.","Source Type","Source Subtype",
          "Source Batch Name","Source Prod. Order Line","Reservation Status");

        ReservEntry.SETRANGE("Source ID",PurchLine."Document No.");
        ReservEntry.SETRANGE("Source Ref. No.",PurchLine."Line No.");
        ReservEntry.SETRANGE("Source Type",DATABASE::"Purchase Line");
        ReservEntry.SETRANGE("Source Subtype",PurchLine."Document Type");
        ReservEntry.SETRANGE("Source Batch Name",'');
        ReservEntry.SETRANGE("Source Prod. Order Line",0);

        ItemTrackingLines.AddReservEntriesToTempRecSet(ReservEntry,TempTrackingSpecification,FALSE,0);

        IF NOT GetQtyToReceive THEN BEGIN
          TrackingSpecification.SETCURRENTKEY(
            "Source ID","Source Type","Source Subtype",
            "Source Batch Name","Source Prod. Order Line","Source Ref. No.");

          TrackingSpecification.SETRANGE("Source ID",PurchLine."Document No.");
          TrackingSpecification.SETRANGE("Source Type",DATABASE::"Purchase Line");
          TrackingSpecification.SETRANGE("Source Subtype",PurchLine."Document Type");
          TrackingSpecification.SETRANGE("Source Batch Name",'');
          TrackingSpecification.SETRANGE("Source Prod. Order Line",0);
          TrackingSpecification.SETRANGE("Source Ref. No.",PurchLine."Line No.");
          IF TrackingSpecification.FINDSET THEN
            REPEAT
              TempTrackingSpecification := TrackingSpecification;
              TempTrackingSpecification.INSERT;
            UNTIL TrackingSpecification.NEXT = 0;
        END;
      END ELSE BEGIN
        NSReservEntry.SETCURRENTKEY(
          "Source ID","Source Ref. No.","Source Type","Source Subtype",
          "Source Batch Name","Source Prod. Order Line","Reservation Status");

        NSReservEntry.SETRANGE("Source ID",PurchLine."Document No.");
        NSReservEntry.SETRANGE("Source Ref. No.",PurchLine."Line No.");
        NSReservEntry.SETRANGE("Source Type",DATABASE::"Purchase Line");
        NSReservEntry.SETRANGE("Source Subtype",PurchLine."Document Type");
        NSReservEntry.SETRANGE("Source Batch Name",'');
        NSReservEntry.SETRANGE("Source Prod. Order Line",0);

        ItemTrackingLines.AddNSReservEntriesToTempRecSet(NSReservEntry,TempTrackingSpecification,FALSE,0);

        IF NOT GetQtyToReceive THEN BEGIN
          NSTrackingSpecification.SETCURRENTKEY(
            "Source ID","Source Type","Source Subtype",
            "Source Batch Name","Source Prod. Order Line","Source Ref. No.");

          NSTrackingSpecification.SETRANGE("Source ID",PurchLine."Document No.");
          NSTrackingSpecification.SETRANGE("Source Type",DATABASE::"Purchase Line");
          NSTrackingSpecification.SETRANGE("Source Subtype",PurchLine."Document Type");
          NSTrackingSpecification.SETRANGE("Source Batch Name",'');
          NSTrackingSpecification.SETRANGE("Source Prod. Order Line",0);
          NSTrackingSpecification.SETRANGE("Source Ref. No.",PurchLine."Line No.");
          IF NSTrackingSpecification.FINDSET THEN
            REPEAT
              TempTrackingSpecification.TRANSFERFIELDS(NSTrackingSpecification,TRUE);
              TempTrackingSpecification.INSERT;
            UNTIL NSTrackingSpecification.NEXT = 0;
        END;
      END;
    END;

    [External]
    PROCEDURE CopyEmployees@1100528402(VAR MarkedEmployee@1100528400 : Record 5200);
    VAR
      HourAccountingProjectLine@1100528402 : Record 11020225;
      HourAccountingProject@1100528401 : Record 11020224;
    BEGIN
      IF NOT MarkedEmployee.FINDSET THEN
        ERROR(Text041);

      MarkNo := MarkedEmployee.COUNT;
      CurrLino := g_int3;
      PrevLino := 0;
      Gap := 0;

      CASE g_table OF
        DATABASE::"Hour Accounting Project Line":
          BEGIN
            HourAccountingProject.GET(g_int1, g_int2, g_code1);
            HourAccountingProjectLine.LOCKTABLE;
            HourAccountingProjectLine.SETRANGE(Year, g_int1);
            HourAccountingProjectLine.SETRANGE(Week, g_int2);
            HourAccountingProjectLine.SETRANGE("Header Project No.", g_code1);
            IF HourAccountingProjectLine.GET(g_int1, g_int2, g_code1, CurrLino) THEN BEGIN
              HourAccountingProjectLine.SETFILTER("Line No.", '<%1', CurrLino);
              IF HourAccountingProjectLine.FINDLAST THEN
                PrevLino := HourAccountingProjectLine."Line No.";
              HourAccountingProjectLine.SETRANGE("Line No.");
              CheckGap;
            END;
            IF Gap = 0 THEN BEGIN
              Gap := 10000;
              IF HourAccountingProjectLine.FINDLAST THEN
                CurrLino := HourAccountingProjectLine."Line No.";
            END;
            REPEAT
              HourAccountingProjectLine.INIT;
              HourAccountingProjectLine.VALIDATE(Year, g_int1);
              HourAccountingProjectLine.VALIDATE(Week, g_int2);
              HourAccountingProjectLine.VALIDATE("Header Project No.", g_code1);
              HourAccountingProjectLine.VALIDATE(Type, g_int4);
              HourAccountingProjectLine."Line No." := CurrLino + Gap;
              CurrLino := HourAccountingProjectLine."Line No.";
              HourAccountingProjectLine.VALIDATE("Supplying Company", g_text1);
              HourAccountingProjectLine.VALIDATE("Employee No.", MarkedEmployee."No.");
              HourAccountingProjectLine.INSERT(TRUE);
            UNTIL MarkedEmployee.NEXT = 0;
          END;
      END;
    END;

    [External]
    PROCEDURE CopyServiceLocations@1100527400(VAR MarkedServiceLocation@1100527401 : Record 11012801);
    VAR
      ServiceContractLocation@1100527402 : Record 11072554;
    BEGIN
      IF NOT MarkedServiceLocation.FINDSET THEN
        ERROR(Text041);

      CASE g_table OF
        DATABASE::"Service Contract-Location":
          BEGIN
            MarkedServiceLocation.FINDSET;
            REPEAT
              ServiceContractLocation.INIT;
              ServiceContractLocation.VALIDATE("Service Contract No.", g_code1);
              ServiceContractLocation.VALIDATE("Service Location No.", MarkedServiceLocation."No.");
              ServiceContractLocation.INSERT(TRUE);
            UNTIL MarkedServiceLocation.NEXT = 0;
            COMMIT;
          END;
      END;
    END;

    LOCAL PROCEDURE CalculateRateAmount@1100528905(iAmount@1100528900 : Decimal;iQuantity@1100528901 : Decimal;iNorm@1100528902 : Decimal) RateAmount : Decimal;
    BEGIN
      //C062268+C063518
      IF iNorm * iQuantity <> 0 THEN
        RateAmount := iAmount/ (iNorm * iQuantity);
      EXIT(RateAmount);
    END;

    LOCAL PROCEDURE CheckRateCode@1100528906(iRateCode@1100528900 : Code[10]) oRateCode : Code[10];
    VAR
      EstimateSetup@1100528902 : Record 11012150;
      BudgetRate@1100528903 : Record 11012000;
    BEGIN
      //C062150
      EstimateSetup.GET;
      IF EstimateSetup."Rates Based On" <> EstimateSetup."Rates Based On"::"Budget Rate" THEN
        EXIT('');

      BudgetRate.SETRANGE(Code, iRateCode);
      IF BudgetRate.FINDFIRST THEN
        oRateCode := iRateCode;

      EXIT(oRateCode);
    END;

    BEGIN
    END.
  }
}

