OBJECT Page 11125327 Estimate Line Sales
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Estimate Line (Sales);
    InsertAllowed=No;
    DeleteAllowed=No;
    SourceTable=Table11072072;
    DataCaptionExpr=GetDataCaptionEstPart;
    DelayedInsert=No;
    PageType=List;
    AutoSplitKey=Yes;
    ShowFilter=No;
    OnInit=BEGIN
             InitEditable;
           END;

    OnOpenPage=VAR
                 FPSLicenseManagement@1100527400 : Codeunit 11229289;
               BEGIN
                 GetFilterZeroLines;
                 IF FPSLicenseManagement.LicenseAndReadPermissionForTable(ServSetup) THEN
                   ServSetup.GET;
                 CheckFiltergroup4;  //db, 12-11-19
                 ShowPartActions := EstRec.StructurePresent("Estimate No.");   //DP00909
               END;

    OnAfterGetRecord=BEGIN
                       RefQuote := RouteRefMgtCU.GetQuoteOfReference("Purchase Route Reference");
                       GetItemSpecifications;
                       DeviatingSalesQuantityBln := ("Quantity (Sales)" <> Quantity);  //C035486
                       DeviatingSalesPriceBln := ("Price Agreement (Sales)");  //C034809
                       DeviatingSalesNormBln := ("Norm Agreement (Sales)");  //C034809
                       DescriptionStyleExpr := ("Attached to Line No." <> 0) OR ("Part of Line" <> 0);  //DP01727
                       TotalRecipeSales := "Labor Recipe (Sales)" + "Material Recipe (Sales)" +
                         "Subcontracting Recipe (Sales)" + "Plant Recipe (Sales)" + "Sundry Recipe (Sales)";  //db, 13-12-19
                     END;

    OnModifyRecord=BEGIN
                     CheckEstEditable;
                     IF NOT FixedOff THEN BEGIN
                       CurrPage.UPDATE(FALSE);
                       ERROR(Text001);
                     END;
                   END;

    OnAfterGetCurrRecord=BEGIN
                           CheckEstEditable;
                           SetEditable;

                           GetPartTotals(EstPartRec, TotalPartCost, TotalPartSales, TotalPartGross);  //DP00381

                           CALCFIELDS("Quantity Model Exist");
                           IF Recipe <> '' THEN BEGIN
                             CALCFIELDS("Total Recipe");
                           END;
                         END;

    ActionList=ACTIONS
    {
      { 1100528973;  ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 1100528972;1 ;Action    ;
                      Name=Totals;
                      CaptionML=[ENU=Totals;
                                 NOR=Totaler;
                                 SVE=Totaler];
                      RunObject=Page 11125328;
                      RunPageLink=Estimate No.=FIELD(Estimate No.),
                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                  Part Group=FIELD(Part Group),
                                  Part=FIELD(Part);
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=LedgerBudget;
                      PromotedCategory=Process }
      { 1100525002;1 ;ActionGroup;
                      CaptionML=[ENU=Estimate &Part;
                                 NOR=Kalkyle &del;
                                 SVE=Kalkyl&del] }
      { 1100525001;2 ;Action    ;
                      Name=Estimate Index;
                      ShortCutKey=Ctrl+F5;
                      CaptionML=[ENU=Estimate Index;
                                 NOR=Kalkuler Index;
                                 SVE=Kalkylindex];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=BOMVersions;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 EstRec.ShowIndex("Estimate No.", "Sub-Estimate No.", "Part Group", Part, TRUE);  //DP00909
                               END;
                                }
      { 1100525000;2 ;Action    ;
                      Name=Recipe Lines;
                      ShortCutKey=Ctrl+Q;
                      CaptionML=[ENU=Recipe Lines;
                                 NOR=Malrader;
                                 SVE=Mallrader];
                      Image=GetLines;
                      OnAction=BEGIN
                                 EstimateManagementRTC.EditViewRecipeLines(Rec, TRUE);  //db, 14-03-14: testfield Recipe + ShowPage Cost/Sales
                               END;
                                }
      { 1100528501;2 ;Action    ;
                      Name=Internal Text;
                      ShortCutKey=Shift+Ctrl+I;
                      CaptionML=[ENU=&Internal Text;
                                 NOR=&Intern tekst;
                                 SVE=&Intern text];
                      Visible=FALSE;
                      Image=SNInfo;
                      OnAction=BEGIN
                                 EditText(0);
                               END;
                                }
      { 1100528500;2 ;Action    ;
                      Name=External Text;
                      ShortCutKey=Shift+Ctrl+E;
                      CaptionML=[ENU=&External Text;
                                 NOR=&Ekstern tekst;
                                 SVE=&Extern text];
                      Visible=FALSE;
                      Image=SNInfo;
                      OnAction=BEGIN
                                 EditText(1);
                               END;
                                }
      { 1100525007;1 ;ActionGroup;
                      CaptionML=[ENU=Comments;
                                 NOR=Merknader;
                                 SVE=Kommentar] }
      { 1100525006;2 ;Action    ;
                      Name=EstimateComment;
                      CaptionML=ENU=Comment Lines(estimate);
                      RunObject=Page 124;
                      RunPageLink=Table Name=CONST(Estimate),
                                  No.=FIELD(Estimate No.);
                      Image=ViewComments }
      { 1100525005;2 ;Action    ;
                      Name=SubEstimateComment;
                      CaptionML=ENU=Comment Lines(sub-estimate);
                      RunObject=Page 11124914;
                      RunPageLink=Table Name=CONST(Estimate),
                                  Estimate No.=FIELD(Estimate No.),
                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                  Part Group=FILTER(''),
                                  Part=FILTER(''),
                                  Estimate Line No.=FILTER(0);
                      Image=ViewComments }
      { 1100525004;2 ;Action    ;
                      Name=PartComment;
                      CaptionML=ENU=Comment Lines(part);
                      RunObject=Page 11124914;
                      RunPageLink=Table Name=CONST(Estimate),
                                  Estimate No.=FIELD(Estimate No.),
                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                  Part Group=FIELD(Part Group),
                                  Part=FIELD(Part),
                                  Estimate Line No.=FILTER(0);
                      Image=ViewComments }
      { 1100525003;2 ;Action    ;
                      Name=LineComment;
                      ShortCutKey=Shift+Ctrl+R;
                      CaptionML=ENU=Comment Lines(estimate line);
                      Image=ViewComments;
                      OnAction=BEGIN
                                 EditCommentLines;
                               END;
                                }
      { 1100409004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1100409006;1 ;ActionGroup;
                      CaptionML=[ENU=Functions;
                                 NOR=Funksjoner;
                                 SVE=Funktioner] }
      { 1100409005;2 ;Action    ;
                      Name=InitSalesFromCost;
                      CaptionML=ENU=Initialize Sales From Cost;
                      Image=RefreshText;
                      OnAction=BEGIN
                                 UpdateSalesFromCost;  //db, 11-04-17: use page-function instead table-function
                               END;
                                }
      { 1100525017;2 ;Action    ;
                      Name=InitFullCostPrice;
                      CaptionML=ENU=Initialize Full Cost Price;
                      Image=CalculateCost;
                      OnAction=VAR
                                 EstimateOfferAmount@1100525000 : Page 11229778;
                               BEGIN
                                 EstimateOfferAmount.CallReport(FALSE,FALSE,"Estimate No.","Sub-Estimate No.");  //db, 24-01-19
                               END;
                                }
      { 1100525016;2 ;Action    ;
                      Name=InitFullSalesPrice;
                      CaptionML=ENU=Initialize Full Sales Price;
                      Image=CalculateSalesTax;
                      OnAction=VAR
                                 EstimateOfferAmount@1100525000 : Page 11229778;
                               BEGIN
                                 EstimateOfferAmount.CallReport(TRUE,FALSE,"Estimate No.","Sub-Estimate No.");  //db, 24-01-19
                               END;
                                }
      { 1100528974;2 ;Action    ;
                      Name=ActivateFullCostPrice;
                      CaptionML=ENU=Full Cost Price (on/off);
                      Image=GetBinContent;
                      OnAction=BEGIN
                                 ActivateCheckFullCostPrice;  //C057346
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100525011;2 ;Action    ;
                      Name=Modify BOM Discount;
                      CaptionML=[ENU=Modify BOM Discount;
                                 NOR=Endre stykklisterabatt;
                                 SVE=Žndra strukturrabatt];
                      Visible=FALSE;
                      Image=CalculateDiscount;
                      OnAction=BEGIN
                                 UpgradeBOMDiscount;
                               END;
                                }
      { 1100525010;2 ;Action    ;
                      Name=Modify BOM Amount;
                      CaptionML=[ENU=Modify BOM Amount;
                                 NOR=Endre stykklistebel›p;
                                 SVE=Žndra strukturbelopp];
                      Visible=FALSE;
                      Image=ContractPayment;
                      OnAction=BEGIN
                                 UpgradeBOMAmount;
                               END;
                                }
      { 1100528906;1 ;ActionGroup;
                      CaptionML=[ENU=Navi&gation;
                                 NOR=Navi&gering;
                                 SVE=Anal&ysera] }
      { 1100528903;2 ;Action    ;
                      Name=Previous Part;
                      ShortCutKey=Shift+Ctrl+F11;
                      CaptionML=[ENU=Previous Part;
                                 NOR=Forrige del;
                                 SVE=F”reg†ende del];
                      Visible=ShowPartActions;
                      Image=PreviousRecord;
                      OnAction=BEGIN
                                 //C033558
                                 EstimateManagementRTC.FilterEstimateLinesNextPart(0, 0, Rec); //0=part, 0=previous
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1100528902;2 ;Action    ;
                      Name=Next Part;
                      ShortCutKey=Shift+Ctrl+F12;
                      CaptionML=[ENU=Next Part;
                                 NOR=Neste del;
                                 SVE=N„sta del];
                      Visible=ShowPartActions;
                      Image=NextRecord;
                      OnAction=BEGIN
                                 //C033558
                                 EstimateManagementRTC.FilterEstimateLinesNextPart(0, 1, Rec); //0=part, 1=next
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1100529905;  ;ActionContainer;
                      ActionContainerType=Reports }
      { 1100529903;1 ;Action    ;
                      Name=Estimate Reports;
                      CaptionML=ENU=Estimate Reports;
                      Image=Report;
                      OnAction=BEGIN
                                 SetFilterPrintDoc(0);
                               END;
                                }
      { 1100529902;1 ;Action    ;
                      Name=Sub-Estimate Reports;
                      CaptionML=[ENU=Sub-Estimate Reports;
                                 SVE=Delkalkyler, rapporter];
                      Image=Report;
                      OnAction=BEGIN
                                 SetFilterPrintDoc(1);
                               END;
                                }
      { 1100529901;1 ;Action    ;
                      Name=Estimate &Part Reports;
                      CaptionML=ENU=Estimate &Part Reports;
                      Image=report;
                      OnAction=BEGIN
                                 SetFilterPrintDoc(2);
                               END;
                                }
      { 1100529900;1 ;Action    ;
                      Name=Estimate &Lines Reports;
                      CaptionML=ENU=Estimate &Lines Reports;
                      Image=report;
                      OnAction=BEGIN
                                 SetFilterPrintDoc(3);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1100528901;0;Container;
                ContainerType=ContentArea }

    { 1100528900;1;Group  ;
                CaptionML=ENU=Estimate Lines (Sales);
                IndentationColumnName="Level BOM";
                IndentationControls=Description;
                GroupType=Repeater;
                FreezeColumnID=Description }

    { 1100409001;2;Field  ;
                SourceExpr="Estimate Description";
                Importance=Additional;
                Visible=FALSE }

    { 1100409000;2;Field  ;
                SourceExpr="Sub-Estimate Description";
                Importance=Additional;
                Visible=FALSE }

    { 1100409002;2;Field  ;
                SourceExpr="Part Description";
                Importance=Additional;
                Visible=FALSE }

    { 1100528904;2;Field  ;
                SourceExpr="Line No.";
                Visible=FALSE;
                Editable=FALSE }

    { 1100528905;2;Field  ;
                SourceExpr="Cost Type (Price)";
                Editable=FALSE }

    { 1100525014;2;Field  ;
                SourceExpr="Cost Type (Hours)";
                Visible=FALSE;
                Editable=FALSE }

    { 1100528915;2;Field  ;
                SourceExpr=Description;
                Editable=DescriptionEditable;
                Style=StandardAccent;
                StyleExpr=DescriptionStyleExpr }

    { 1100528914;2;Field  ;
                SourceExpr="Internal Text Block";
                Visible=FALSE }

    { 1100528913;2;Field  ;
                SourceExpr="External Text Block";
                Visible=FALSE }

    { 1100528912;2;Field  ;
                SourceExpr=Comment;
                Visible=FALSE;
                OnDrillDown=BEGIN
                              EditCommentLines;
                            END;
                             }

    { 1100528918;2;Field  ;
                SourceExpr="Time Quantity";
                Visible=FALSE;
                Editable=TimeQuantityEditable;
                OnValidate=BEGIN
                             RecalcTotals;
                           END;
                            }

    { 1100528917;2;Field  ;
                SourceExpr="Unit of Time";
                Visible=FALSE;
                Editable=UnitOfTimeEditable }

    { 1100528919;2;Field  ;
                SourceExpr="Quantity (Sales)";
                Visible=FALSE;
                Editable=QuantitySalesEditable;
                Style=Attention;
                StyleExpr=DeviatingSalesQuantityBln;
                OnValidate=BEGIN
                             RecalcTotals;
                           END;
                            }

    { 1100409003;2;Field  ;
                SourceExpr="Deviating Sales Quantity";
                Importance=Additional }

    { 1100528923;2;Field  ;
                SourceExpr="Part Quantity";
                Importance=Additional;
                Visible=FALSE;
                Editable=FALSE }

    { 1100528922;2;Field  ;
                SourceExpr="Original Quantity";
                Importance=Additional;
                Visible=FALSE;
                OnValidate=BEGIN
                             IF (xRec."Original Quantity" <> "Original Quantity") AND (xRec."Original Quantity" <> 0) THEN BEGIN
                               ChangeQuantityExplodedLines("Original Quantity" / xRec."Original Quantity");
                               CurrPage.UPDATE;
                             END;
                           END;
                            }

    { 1100528921;2;Field  ;
                SourceExpr="Part of Line";
                Importance=Additional;
                Visible=FALSE }

    { 1100528920;2;Field  ;
                SourceExpr="Unit of Measure";
                Editable=UnitOfMeasureEditable }

    { 1100528928;2;Field  ;
                SourceExpr="Ignore Part Quantity";
                Visible=FALSE;
                OnValidate=BEGIN
                             RecalcTotals;
                           END;
                            }

    { 1100528930;2;Field  ;
                SourceExpr="Rate Code";
                Editable=FALSE;
                OnValidate=BEGIN
                             RecalcTotals;
                           END;
                            }

    { 1100528932;2;Field  ;
                SourceExpr="Sales Rate" }

    { 1100528600;2;Field  ;
                SourceExpr="Sales Rate (FCY)";
                Visible=FALSE }

    { 1100528929;2;Field  ;
                SourceExpr="Norm (Sales)";
                Editable=NormSalesEditable;
                Style=Attention;
                StyleExpr=DeviatingSalesNormBln;
                OnValidate=BEGIN
                             "Norm Agreement (Sales)" := TRUE;  //DP00381
                             RecalcTotals;
                           END;

                OnLookup=BEGIN
                           OnBeforeLookup;
                           IF HandleLookupOperationNorm(TRUE) THEN BEGIN
                             CurrPage.UPDATE(FALSE);  //C027336
                           END ELSE BEGIN
                             RecalcTotals;
                           END;
                         END;
                          }

    { 1100528935;2;Field  ;
                SourceExpr="Gross Price";
                Editable=FALSE }

    { 1100528934;2;Field  ;
                SourceExpr="Sales Discount %";
                Style=Attention;
                StyleExpr=DeviatingSalesPriceBln;
                OnValidate=BEGIN
                             "Price Agreement (Sales)" := TRUE;
                             RecalcTotals;
                           END;

                OnAssistEdit=BEGIN
                               AssistEditSalesCondition;  //C015604
                             END;
                              }

    { 1100528966;2;Field  ;
                SourceExpr="Surcharge Type";
                Visible=FALSE }

    { 1100528926;2;Field  ;
                SourceExpr="Surcharge %";
                Visible=FALSE;
                OnDrillDown=VAR
                              ChrgFrm@1100485001 : Page 11229327;
                            BEGIN
                              OnBeforeLookup;
                              ChrgRec.RESET;
                              ChrgRec.SETRANGE("Estimate No.", "Estimate No.");
                              ChrgRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                              ChrgRec.SETRANGE("Part Group", "Part Group");
                              ChrgRec.SETRANGE(Part, Part);
                              ChrgRec.SETRANGE("Recipe Line", 0);
                              ChrgRec.SETRANGE("Recipe Group", '');
                              ChrgRec.SETRANGE(Recipe, '');
                              ChrgRec.SETRANGE("Surcharge Line", "Line No.");
                              ChrgFrm.SETTABLEVIEW(ChrgRec);
                              ChrgFrm.SetSelection(2);
                              ChrgFrm.RUNMODAL;

                              RecalcTotals;
                              CurrPage.UPDATE(TRUE);
                            END;
                             }

    { 1100528925;2;Field  ;
                SourceExpr="Norm Group (Sales)";
                Visible=FALSE;
                Editable=NormGroupSalesEditable }

    { 1100528924;2;Field  ;
                SourceExpr="Sub Operation Code";
                Visible=FALSE;
                Editable=SubOperationCodeEditable;
                OnValidate=BEGIN
                             ProcessSubOperation;

                             RecalcTotals;
                             IF "Sub Operation Code" <> '' THEN BEGIN
                               "Norm Agreement" := FALSE;
                               "Norm Agreement (Sales)" := FALSE;  //DP00381
                             END;
                           END;

                OnLookup=VAR
                           OperFrm@1100485001 : Page 11012178;
                           OperRec@1100485000 : Record 11012166;
                         BEGIN
                           OnBeforeLookup;
                           CLEAR(OperFrm);
                           OperFrm.LOOKUPMODE(TRUE);
                           OperFrm.SetSelection(DATABASE::"Estimate Line","Estimate No.","Sub-Estimate No.",
                             "Part Group",Part,0,'','');

                           OperRec.Code := "Sub Operation Code";
                           OperFrm.SETRECORD(OperRec);

                           IF OperFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
                             OperFrm.GETRECORD(OperRec);
                             VALIDATE("Sub Operation Code", OperRec.Code);
                             ProcessSubOperation;
                             RecalcTotals;
                           END;
                           CurrPage.UPDATE(TRUE);
                         END;
                          }

    { 1100528931;2;Field  ;
                CaptionML=[ENU=Norm (Minuts);
                           NOR=Norm (minutter);
                           SVE=Norm (minuter)];
                SourceExpr=GetMinuts(0,1);
                Visible=FALSE;
                Editable=FALSE }

    { 1100525012;2;Field  ;
                SourceExpr="Production Rate (Sales)";
                Visible=FALSE;
                Editable=NormSalesEditable }

    { 1100528933;2;Field  ;
                SourceExpr="Surcharge % Labor";
                Style=Attention;
                StyleExpr=DeviatingSalesNormBln;
                OnValidate=BEGIN
                             IF Recipe <> '' THEN RecalculateLines;  //C033781
                             "Norm Agreement (Sales)" := TRUE;  //C034809
                             RecalcTotals;
                           END;
                            }

    { 1100528938;2;Field  ;
                SourceExpr="Surcharge % Price";
                Style=Attention;
                StyleExpr=DeviatingSalesPriceBln;
                OnValidate=BEGIN
                             "Price Agreement (Sales)" := TRUE;  //C034809
                             RecalcTotals;
                           END;
                            }

    { 1100528936;2;Field  ;
                SourceExpr="Wage Component";
                Visible=FALSE;
                OnValidate=BEGIN
                             RecalcTotals;  //DP00236
                           END;
                            }

    { 1100528609;2;Field  ;
                SourceExpr="Currency Code";
                Visible=FALSE }

    { 1100525015;2;Field  ;
                SourceExpr="Currency Agreement";
                Visible=FALSE }

    { 1100528601;2;Field  ;
                SourceExpr="Gross Price (FCY)";
                Visible=FALSE;
                Editable=FALSE }

    { 1100528937;2;Field  ;
                SourceExpr="Net Sales Price";
                Style=Attention;
                StyleExpr=DeviatingSalesPriceBln;
                OnValidate=BEGIN
                             "Price Agreement (Sales)" := TRUE;
                             RecalcTotals;
                           END;
                            }

    { 1100528602;2;Field  ;
                SourceExpr="Net Sales Price (FCY)";
                Visible=FALSE;
                OnValidate=BEGIN
                             RecalcTotals;  //C050836
                           END;
                            }

    { 1100525008;2;Field  ;
                SourceExpr="Sales Condition Present";
                Visible=FALSE }

    { 1100528908;2;Field  ;
                SourceExpr="Sales Price (Recipe)";
                Visible=FALSE }

    { 1100529400;2;Field  ;
                SourceExpr="Recipe Surcharge % Material";
                Visible=FALSE;
                OnValidate=BEGIN
                             IF Recipe <> '' THEN RecalculateLines;  //C033781
                             RecalcTotals;  //DP01183
                           END;
                            }

    { 1100529401;2;Field  ;
                SourceExpr="Recipe Surcharge % Subc.";
                Visible=FALSE;
                OnValidate=BEGIN
                             IF Recipe <> '' THEN RecalculateLines;  //C033781
                             RecalcTotals;  //DP01183
                           END;
                            }

    { 1100529402;2;Field  ;
                SourceExpr="Recipe Surcharge % Plant";
                Visible=FALSE;
                OnValidate=BEGIN
                             IF Recipe <> '' THEN RecalculateLines;  //C033781
                             RecalcTotals;  //DP01183
                           END;
                            }

    { 1100529403;2;Field  ;
                SourceExpr="Recipe Surcharge % Sundry";
                Visible=FALSE;
                OnValidate=BEGIN
                             IF Recipe <> '' THEN RecalculateLines;  //C033781
                             RecalcTotals;  //DP01183
                           END;
                            }

    { 1100528971;2;Field  ;
                SourceExpr="Hours Recipe (Sales)";
                Visible=FALSE }

    { 1100528965;2;Field  ;
                SourceExpr="Labor Recipe (Sales)";
                Visible=FALSE }

    { 1100528916;2;Field  ;
                SourceExpr="Material Recipe (Sales)";
                Visible=FALSE }

    { 1100528911;2;Field  ;
                SourceExpr="Subcontracting Recipe (Sales)";
                Visible=FALSE }

    { 1100528910;2;Field  ;
                SourceExpr="Plant Recipe (Sales)";
                Visible=FALSE }

    { 1100528909;2;Field  ;
                SourceExpr="Sundry Recipe (Sales)";
                Visible=FALSE }

    { 1100528939;2;Field  ;
                CaptionML=ENU=Total Recipe (Sales);
                SourceExpr=TotalRecipeSales;
                Visible=FALSE;
                OnDrillDown=BEGIN
                              EstLineRec := Rec;
                              EstimateManagementRTC.EditViewRecipeLines(EstLineRec,TRUE);  //DP00381
                            END;
                             }

    { 1100528940;2;Field  ;
                SourceExpr="Hours (Sales)" }

    { 1100528941;2;Field  ;
                SourceExpr="Labor Sales Amount";
                Visible=FALSE }

    { 1100528603;2;Field  ;
                SourceExpr="Labor Sales Amount (FCY)";
                Visible=FALSE }

    { 1100528942;2;Field  ;
                SourceExpr="Material Sales Amount";
                Visible=FALSE }

    { 1100528604;2;Field  ;
                SourceExpr="Material Sales Amount (FCY)";
                Visible=FALSE }

    { 1100528943;2;Field  ;
                SourceExpr="Subcontracting Sales Amount";
                Visible=FALSE }

    { 1100528605;2;Field  ;
                SourceExpr="Subcontr. Sales Amount (FCY)";
                Visible=FALSE }

    { 1100528944;2;Field  ;
                SourceExpr="Plant Sales Amount";
                Visible=FALSE }

    { 1100528606;2;Field  ;
                SourceExpr="Plant Sales Amount (FCY)";
                Visible=FALSE }

    { 1100528945;2;Field  ;
                SourceExpr="Sundry Sales Amount";
                Visible=FALSE }

    { 1100528607;2;Field  ;
                SourceExpr="Sundry Sales Amount (FCY)";
                Visible=FALSE }

    { 1100528946;2;Field  ;
                SourceExpr="Sales Amount" }

    { 1100528608;2;Field  ;
                SourceExpr="Sales Amount (FCY)";
                Visible=FALSE }

    { 1100528927;2;Field  ;
                SourceExpr="Line Status" }

    { 1100528947;2;Field  ;
                SourceExpr="Cost Object Labor";
                Visible=FALSE }

    { 1100528948;2;Field  ;
                SourceExpr="Cost Object Price";
                Visible=FALSE }

    { 1100528949;2;Field  ;
                SourceExpr="Price Reference Date";
                Visible=FALSE }

    { 1100528950;2;Field  ;
                SourceExpr="Norm Agreement (Sales)";
                Visible=FALSE }

    { 1100528951;2;Field  ;
                SourceExpr="Price Agreement (Sales)";
                Visible=FALSE }

    { 1100528952;2;Field  ;
                SourceExpr="Ask for Quote";
                Visible=FALSE }

    { 1100528953;2;Field  ;
                CaptionML=[ENU=Quote No.;
                           NOR=Foresp›rselsnr.;
                           SVE=Offertnr];
                SourceExpr=RefQuote;
                Visible=FALSE;
                Editable=FALSE;
                OnLookup=VAR
                           lvPurchHeadRec@1100528900 : Record 38;
                         BEGIN
                           IF (RefQuote = '') THEN
                             EXIT;

                           IF (COPYSTR(RefQuote, 1, 1) = '<') THEN  // IF Quote No. is '<Nr.>', then more than one quote present
                             RouteRefMgtCU.ShowReferenceQuoteList("Purchase Route Reference")
                           ELSE BEGIN
                             lvPurchHeadRec.SETRANGE("Document Type", lvPurchHeadRec."Document Type"::Quote);
                             lvPurchHeadRec.SETRANGE("No.", RefQuote);
                             PAGE.RUNMODAL(PAGE::"Purchase Quote", lvPurchHeadRec);
                           END;
                         END;
                          }

    { 1100528954;2;Field  ;
                SourceExpr="Purchase Route Reference";
                Visible=FALSE }

    { 1100528955;2;Field  ;
                SourceExpr="Document No.";
                Visible=FALSE }

    { 1100528956;2;Field  ;
                SourceExpr=Vendor;
                Visible=FALSE }

    { 1100528957;2;Field  ;
                SourceExpr="Vendor Name";
                Visible=FALSE }

    { 1100528958;2;Field  ;
                SourceExpr=Subcontractor;
                Visible=FALSE;
                OnValidate=BEGIN
                             CALCFIELDS("Subcontractor Name");
                           END;
                            }

    { 1100528959;2;Field  ;
                SourceExpr="Subcontractor Name";
                Visible=FALSE }

    { 1100528960;2;Field  ;
                SourceExpr="Service Order No.";
                Visible=FALSE;
                Editable=FALSE }

    { 1100528961;2;Field  ;
                SourceExpr="Project No.";
                Visible=FALSE }

    { 1100528962;2;Field  ;
                SourceExpr=Element;
                Visible=FALSE }

    { 1100528963;2;Field  ;
                SourceExpr="Extension Contract";
                Visible=FALSE }

    { 1100528964;2;Field  ;
                SourceExpr="Project Planning Activity Code";
                Visible=FALSE }

    { 1100409007;1;Part   ;
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part Group=FIELD(Part Group),
                            Part=FIELD(Part),
                            Estimate Line=FIELD(Line No.),
                            Recipe Group=FIELD(Recipe Group),
                            Recipe=FIELD(Recipe);
                PagePartID=Page11229329;
                PartType=Page }

    { 1100525013;1;Part   ;
                CaptionML=[ENU=Estimate Part;
                           NOR=Kalkyledel;
                           SVE=Kalkyldel];
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part Group=FIELD(Part Group),
                            Part=FIELD(Part);
                PagePartID=Page11229330;
                Visible=ShowPartActions;
                Editable=FALSE;
                PartType=Page }

    { 1100528970;0;Container;
                ContainerType=FactBoxArea }

    { 1100528969;1;Part   ;
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part=FIELD(Part);
                PagePartID=Page11229313;
                PartType=Page }

    { 1100528968;1;Part   ;
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part Group=FIELD(Part Group),
                            Part=FIELD(Part),
                            Line No.=FIELD(Line No.);
                PagePartID=Page11229311;
                PartType=Page }

    { 1100528907;1;Part   ;
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part Group=FIELD(Part Group),
                            Part=FIELD(Part),
                            Line No.=FIELD(Line No.);
                PagePartID=Page11229312;
                PartType=Page }

    { 1100528967;1;Part   ;
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part Group=FIELD(Part Group),
                            Part=FIELD(Part),
                            Line No.=FIELD(Line No.);
                PagePartID=Page11229315;
                PartType=Page }

    { 1100525009;1;Part   ;
                CaptionML=ENU=Comment Lines (Estimate Line);
                SubPageLink=Estimate No.=FIELD(Estimate No.),
                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                            Part Group=FIELD(Part Group),
                            Part=FIELD(Part),
                            Estimate Line No.=FIELD(Line No.),
                            Recipe Line No.=CONST(0);
                PagePartID=Page11126553;
                PartType=Page }

  }
  CODE
  {
    VAR
      ServSetup@1100528923 : Record 11012800;
      EstRec@1100528921 : Record 11012151;
      ChrgRec@1100528920 : Record 11229771;
      EstPartRec@1100528919 : Record 11072073;
      EstLineRec@1100528918 : Record 11072072;
      RouteRefMgtCU@1100528912 : Codeunit 11012045;
      RefQuote@1100528905 : Code[20];
      TotalPartCost@1100528902 : Decimal;
      TotalPartGross@1100528901 : Decimal;
      TotalPartSales@1100528900 : Decimal;
      Text001@1100528927 : TextConst 'ENU=Changing not allowed, Estimate is fixed.;NOR=Endring er ikke tillatt, kalkylen er fast.;SVE=Žndring „r inte till†tet, kalkylen „r fast.';
      Text009@1100528925 : TextConst 'ENU=Add Line first.;NOR=Legg til rad f›rst.;SVE=L„gg till rad f”rst.';
      DescriptionEditable@1100528929 : Boolean INDATASET;
      NormGroupSalesEditable@1100528930 : Boolean INDATASET;
      RecipeGroupEditable@1100528931 : Boolean INDATASET;
      ManufacturerEditable@1100528932 : Boolean INDATASET;
      VendorTradeItemEditable@1100528934 : Boolean INDATASET;
      TradeItemEditable@1100528935 : Boolean INDATASET;
      ItemNoEditable@1100528936 : Boolean INDATASET;
      TimeQuantityEditable@1100528937 : Boolean INDATASET;
      UnitOfTimeEditable@1100528938 : Boolean INDATASET;
      QuantitySalesEditable@1100528939 : Boolean INDATASET;
      UnitOfMeasureEditable@1100528940 : Boolean INDATASET;
      LineStatusEditable@1100528941 : Boolean INDATASET;
      SubOperationCodeEditable@1100528942 : Boolean INDATASET;
      NormSalesEditable@1100528943 : Boolean INDATASET;
      RateCodeEditable@1100528944 : Boolean INDATASET;
      GrossPriceEditable@1100528945 : Boolean INDATASET;
      NetSalesPriceEditable@1100528946 : Boolean INDATASET;
      SalesDiscountPercEditable@1100528947 : Boolean INDATASET;
      CodeEditable@1100528948 : Boolean INDATASET;
      DocumentNoEditable@1100528949 : Boolean INDATASET;
      AskForQuoteEditable@1100528950 : Boolean INDATASET;
      PriceAgreementSalesEditable@1100528951 : Boolean INDATASET;
      NormAgreementSalesEditable@1100528952 : Boolean INDATASET;
      VendorEditable@1100528953 : Boolean INDATASET;
      RecipeEditable@1100528954 : Boolean INDATASET;
      PlantTypeEditable@1100528955 : Boolean INDATASET;
      BasicItemEditable@1100528956 : Boolean INDATASET;
      SurchargeTypeEditable@1100528958 : Boolean INDATASET;
      SurchargePercEditable@1100528959 : Boolean INDATASET;
      WageComponentEditable@1100528960 : Boolean INDATASET;
      EstimateManagementRTC@1100528961 : Codeunit 11130010;
      FixedOff@1100525000 : Boolean;
      SubPageEditable@1100525001 : Boolean INDATASET;
      ShowPartActions@1100525002 : Boolean INDATASET;
      DeviatingSalesQuantityBln@1100525003 : Boolean INDATASET;
      DeviatingSalesPriceBln@1100525004 : Boolean INDATASET;
      DeviatingSalesNormBln@1100525005 : Boolean INDATASET;
      DescriptionStyleExpr@1100528903 : Boolean INDATASET;
      TotalRecipeSales@1100525006 : Decimal;

    PROCEDURE CheckEstEditable@3();
    VAR
      EstRec@11012000 : Record 11012151;
    BEGIN
      IF EstRec.GET("Estimate No.") THEN
        FixedOff := NOT EstRec.Fixed;
    END;

    PROCEDURE RecalcTotals@5();
    BEGIN
      CurrPage.SAVERECORD;
      UpdateRecipeTotals; //C044592
      CheckIgnoreRecipeQuantity;
      CalculateTotals;
      CheckEstimateCharge;
      CurrPage.UPDATE(FALSE); //C027336
    END;

    PROCEDURE EditText@8(lvType@1210190000 : 'intern,extern');
    VAR
      TextFrm@11012001 : Page 11012120;
    BEGIN
      IF "Line No." = 0 THEN
        ERROR(Text009);

      TextFrm.TextType(lvType);
      TextFrm.SetSelection(DATABASE::"Estimate Line","Estimate No.","Sub-Estimate No.",
        "Part Group",Part,'','',"Line No.",0);

      TextFrm.RUNMODAL;
      CLEAR(TextFrm);
    END;

    PROCEDURE HandleZeroLines@1210190002();
    BEGIN
      SetFilterZeroLinesByUser(Rec);  //C025240
      CurrPage.UPDATE(TRUE);
    END;

    PROCEDURE GetFilterZeroLines@1210190003();
    BEGIN
      GetFilterZeroLinesByUser(Rec);  //C025240
    END;

    PROCEDURE EditCommentLines@1100525015();
    VAR
      UpdateMgt@1100525000 : Codeunit 11012229;
    BEGIN
      UpdateMgt.EditCommentLines("Estimate No.","Sub-Estimate No.","Part Group",Part,"Line No.",'','',0,0);  //DP00686
    END;

    PROCEDURE SetEditable@1100525500();
    BEGIN
      CheckEstEditable;

      SubPageEditable := FixedOff;
      RecipeGroupEditable := FixedOff;
      RecipeEditable := FixedOff;
      PlantTypeEditable := FixedOff;
      ItemNoEditable := FixedOff;
      ManufacturerEditable := FixedOff;
      BasicItemEditable := FixedOff;
      VendorTradeItemEditable := FixedOff;
      TradeItemEditable := FixedOff;
      CodeEditable := FixedOff;
      TimeQuantityEditable := FixedOff;
      QuantitySalesEditable := FixedOff;
      UnitOfMeasureEditable := FixedOff;
      SurchargeTypeEditable := FixedOff;
      SurchargePercEditable := FixedOff;
      NormGroupSalesEditable := FixedOff;
      SubOperationCodeEditable := FixedOff;
      NormSalesEditable := FixedOff;
      RateCodeEditable := FixedOff;
      WageComponentEditable := FixedOff;
      GrossPriceEditable := FixedOff;
      SalesDiscountPercEditable := FixedOff;
      NetSalesPriceEditable := FixedOff;

      IF FixedOff THEN BEGIN
        SubPageEditable := (Recipe <> '');
        RecipeGroupEditable := ("Surcharge Type" = "Surcharge Type"::" ");
        RecipeEditable := (("Basic Item" = '') AND ("Trade Item" = '') AND ("Item No." = '')
          AND ("Surcharge Type" = "Surcharge Type"::" "));
        PlantTypeEditable := ((Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" ")
          AND ("Item No." + "Basic Item" + "Trade Item" = ''));
        ItemNoEditable := ((Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" "));
        ManufacturerEditable := ((Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" "));
        BasicItemEditable := ((Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" "));
        VendorTradeItemEditable := ((Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" "));
        TradeItemEditable := ((Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" "));
        CodeEditable := (Recipe='');
        TimeQuantityEditable := ("Surcharge Type" = "Surcharge Type"::" ");
        QuantitySalesEditable := ("Surcharge Type" = "Surcharge Type"::" ");
        SurchargeTypeEditable := (Recipe + "Item No." + "Basic Item" + "Trade Item" = '');
        SurchargePercEditable := ("Surcharge Type" <> "Surcharge Type"::" ");
        NormGroupSalesEditable := (Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" ");
        SubOperationCodeEditable := (Recipe = '') AND ("Surcharge Type" = "Surcharge Type"::" ");
        NormSalesEditable := ((Recipe = '') AND ("Sub Operation Code" = '') AND
          ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> '')) OR
          ("Cost Type (Hours)"="Cost Type (Hours)"::Subcontracting) OR  //DP01676
          ("Cost Type (Hours)"="Cost Type (Hours)"::Plant);  //DP01047
        RateCodeEditable := (Recipe='') AND
          ("Cost Type (Hours)"="Cost Type (Hours)"::Labor);  //DP01047
        WageComponentEditable := ((Recipe = '') AND
          ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));
        GrossPriceEditable := (Recipe='') AND ("Surcharge Type" = "Surcharge Type"::" ");
        SalesDiscountPercEditable := (Recipe='') AND ("Surcharge Type" = "Surcharge Type"::" ");
        NetSalesPriceEditable := (Recipe='') AND ("Surcharge Type" = "Surcharge Type"::" ");
      END;
    END;

    PROCEDURE InitEditable@1100525001();
    BEGIN
      SubPageEditable := TRUE;
      RecipeGroupEditable := TRUE;
      RecipeEditable := TRUE;
      PlantTypeEditable := TRUE;
      ItemNoEditable := TRUE;
      ManufacturerEditable := TRUE;
      BasicItemEditable := TRUE;
      VendorTradeItemEditable := TRUE;
      TradeItemEditable := TRUE;
      TimeQuantityEditable := TRUE;
      UnitOfTimeEditable := TRUE;
      QuantitySalesEditable:= TRUE;
      UnitOfMeasureEditable:= TRUE;
      SurchargeTypeEditable := TRUE;
      SurchargePercEditable := TRUE;
      NormGroupSalesEditable := TRUE;
      NormSalesEditable := TRUE;
      SubOperationCodeEditable := TRUE;
      RateCodeEditable:= TRUE;
      WageComponentEditable := TRUE;
      GrossPriceEditable := TRUE;
      SalesDiscountPercEditable := TRUE;
      NetSalesPriceEditable := TRUE;
      PriceAgreementSalesEditable:= TRUE;
      NormAgreementSalesEditable:= TRUE;
      DescriptionEditable := TRUE;
      LineStatusEditable:= TRUE;
      CodeEditable := TRUE;
      DocumentNoEditable:= TRUE;
      AskForQuoteEditable:= TRUE;
      VendorEditable:= TRUE;
    END;

    PROCEDURE UpdateSalesFromCost@1100409000();
    VAR
      EstimateLine@1100525000 : Record 11072072;
      UpdateMgt@1100525001 : Codeunit 11012229;
    BEGIN
      //C035453.sn
      EstimateLine.COPY(Rec);
      CurrPage.SETSELECTIONFILTER(EstimateLine);
      //C035453.en
      //C041093.sn
      IF GETFILTER("Estimate No.") = '' THEN BEGIN
        //no filter on drilldown flowfields (Offer Amount); UpdateMgt needs filter on SubEstimate and Part to update Surcharge%
        EstimateLine.SETFILTER("Estimate No.", "Estimate No.");
        EstimateLine.SETFILTER("Sub-Estimate No.", "Sub-Estimate No.");
        EstimateLine.SETFILTER("Part Group", "Part Group");
        EstimateLine.SETFILTER(Part, Part);
      END;
      //C041093.en
      UpdateMgt.InitSalesFromCost(EstimateLine);
    END;

    PROCEDURE GetDataCaptionEstPart@1100528000() : Text[250];
    VAR
      EstimatePart@1100528000 : Record 11072073;
    BEGIN
      IF NOT EstimatePart.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN EstimatePart.INIT;
      EXIT(EstimatePart.GetDataCaption);
    END;

    PROCEDURE UpgradeBOMDiscount@1100525003();
    VAR
      EstimateLine@1100525000 : Record 11072072;
      ProcessBOMDiscount@1100525001 : Report 11012549;
    BEGIN
      EstimateLine.COPY(Rec);
      EstimateLine.SETRECFILTER;
      ProcessBOMDiscount.SetSelection(DATABASE::"Estimate Line");
      ProcessBOMDiscount.SetSelectionEstimate(EstimateLine,2);  //C028603: 1=cost, 2=sales
      ProcessBOMDiscount.SETTABLEVIEW(EstimateLine);
      ProcessBOMDiscount.RUNMODAL;
      CurrPage.UPDATE;
    END;

    PROCEDURE UpgradeBOMAmount@1100525002();
    VAR
      EstimateLine@1100525002 : Record 11072072;
      ProcessBOMAmount@1100525001 : Report 11012359;
    BEGIN
      EstimateLine.COPY(Rec);
      EstimateLine.SETRECFILTER;
      ProcessBOMAmount.SetSelection(DATABASE::"Estimate Line");
      ProcessBOMAmount.SetSelectionEstimate(EstimateLine,2);  //C028603: 1=cost, 2=sales
      ProcessBOMAmount.SETTABLEVIEW(EstimateLine);
      ProcessBOMAmount.RUNMODAL;
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE RecalculateLines@1100529400();
    BEGIN
      //C033781
      CurrPage.SAVERECORD;
      RecalculateSurcharge;
      CurrPage.UPDATE;
    END;

    PROCEDURE SetFilterPrintDoc@1100528903(lvAction@1100485000 : Integer);
    VAR
      EstPartRec@1100485002 : Record 11072073;
      PrintDoc@1100485001 : Codeunit 229;
    BEGIN
      //C037321
      EstPartRec."Estimate No." := "Estimate No.";
      EstPartRec."Sub-Estimate No." := "Sub-Estimate No.";
      EstPartRec."Part Group" := "Part Group";
      EstPartRec.Part := Part;
      PrintDoc.PrintEstimateNEW(EstPartRec, lvAction);
    END;

    LOCAL PROCEDURE OnBeforeLookup@1100527000();
    BEGIN
      xRec := Rec;  //C046148: avoid problem with CurrPage.SAVERECORD by RecalcTotals
    END;

    LOCAL PROCEDURE CheckFiltergroup4@1100525007();
    BEGIN
      //db, 12-11-19:
      //if column added or removed on SubPage (RecipeLine or CommentLine) mainpage (EstimateLine) is opened again without keyfields in filtergroup 4
      //this filter is set by codeunit 11130010 (Estimate Management RTC) and called from Estimate Part or Index
      //regular SubPageLink is ignored due to functions GetNext/PreviousPart
      FILTERGROUP(4);
      IF GETFILTER("Estimate No.") = '' THEN BEGIN
        SETFILTER("Estimate No.", "Estimate No.");
        SETFILTER("Sub-Estimate No.", "Sub-Estimate No.");
        SETFILTER("Part Group", "Part Group");
        SETFILTER(Part, Part);
      END;
      FILTERGROUP(0);
    END;

    BEGIN
    END.
  }
}

