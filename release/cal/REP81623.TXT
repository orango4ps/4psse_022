OBJECT Report 81623 Project Hours per Employee-Exc
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=REP-100-028,REP-100-031;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Project Hours per Employee;
               NOR=Prosjekt timer per ansatt;
               SVE=Projekttimmar per anst„lld];
    ProcessingOnly=Yes;
    OnPreReport=VAR
                  lvJobLedgerEntry@1100285500 : Record 11072005;
                BEGIN
                  //160415 ITERO.PEPF
                  CompanyInfo.GET;
                  //160415 ITERO.PEPF

                  IF PeriodFilter = '' THEN
                    ERROR(Text000);

                  IF (PrintPeriodName) AND (PeriodType = PeriodType::"Accounting Period") THEN
                    ERROR(Text002);

                  gReportName   := GetReportName;
                  gReportFilter := GetReportFilter;

                  //<<FIND START- & END Date
                  lvJobLedgerEntry.SETCURRENTKEY("Job No.","Posting Date");
                  lvJobLedgerEntry.SETRANGE ("Cost Type"     , lvJobLedgerEntry."Cost Type" :: Labor);
                  IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                    lvJobLedgerEntry.SETFILTER("Posting Date" , PeriodFilter);
                  END ELSE BEGIN//RFC-1057
                    lvJobLedgerEntry.SETFILTER("Execution Date" , PeriodFilter);//RFC-1057
                  END;//RFC-1057
                  IF lvJobLedgerEntry.FINDFIRST THEN BEGIN
                    IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                       gStartDate := lvJobLedgerEntry."Posting Date";
                       gEndDate   := lvJobLedgerEntry."Posting Date";
                    END ELSE BEGIN //RFC-1057
                       gStartDate := lvJobLedgerEntry."Execution Date"; //RFC-1057
                       gEndDate   := lvJobLedgerEntry."Execution Date"; //RFC-1057
                    END; //RFC-1057
                    REPEAT
                      IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                         IF lvJobLedgerEntry."Posting Date" > gEndDate THEN
                            gEndDate   := lvJobLedgerEntry."Posting Date";

                         IF lvJobLedgerEntry."Posting Date" < gStartDate THEN
                            gStartDate := lvJobLedgerEntry."Posting Date";
                      END ELSE BEGIN //RFC-1057
                         IF lvJobLedgerEntry."Execution Date" > gEndDate THEN //RFC-1057
                            gEndDate   := lvJobLedgerEntry."Execution Date"; //RFC-1057

                         IF lvJobLedgerEntry."Execution Date" < gStartDate THEN //RFC-1057
                            gStartDate := lvJobLedgerEntry."Execution Date";//RFC-1057
                      END; //RFC-1057
                    UNTIL lvJobLedgerEntry.NEXT = 0;

                  END
                  ELSE
                    CurrReport.QUIT;
                  //<<FIND START- & END Date

                  //Set Period
                  gCalendar.RESET;
                  gCalendar.SETFILTER("Period Start" , '<=%1' , gEndDate );
                  gCalendar.SETFILTER("Period End"   , '>=%1' , gStartDate);

                  CASE PeriodType OF
                  PeriodType :: Day     : gCalendar.SETRANGE ("Period Type"  , gCalendar."Period Type" :: Date);
                  PeriodType :: Week    : gCalendar.SETRANGE ("Period Type"  , gCalendar."Period Type" :: Week);
                  PeriodType :: Month   : gCalendar.SETRANGE ("Period Type"  , gCalendar."Period Type" :: Month);
                  PeriodType :: Quarter : gCalendar.SETRANGE ("Period Type"  , gCalendar."Period Type" :: Quarter);
                  PeriodType :: Year    : gCalendar.SETRANGE ("Period Type"  , gCalendar."Period Type" :: Year);
                  END; //Case

                  IF NOT gCalendar.FINDFIRST THEN
                     CurrReport.QUIT;

                  IF gCalendar.FINDLAST THEN
                     gEndDate := gCalendar."Period End";

                  IF PeriodType = PeriodType :: "Accounting Period" THEN BEGIN
                     //Find StartPeriode
                     gAccountingPeriod.RESET;
                     gAccountingPeriod.SETFILTER("Starting Date" , '>=%1|<=%2',gStartDate,gStartDate);
                     IF gAccountingPeriod.FINDFIRST THEN
                        gStartAccountingPeriod := gAccountingPeriod."Starting Date"
                      ELSE
                        gStartAccountingPeriod := 0D;
                     //SetFilter
                     gAccountingPeriod.RESET;
                     gAccountingPeriod.SETFILTER("Starting Date" , '>=%1&<=%2',gStartAccountingPeriod,gEndDate);
                     IF NOT gAccountingPeriod.FINDFIRST THEN
                        CurrReport.QUIT;

                  END;

                  //Set
                  FirstCreate       := TRUE;
                  RecordCounterMax  := 5000; // Record Limit in Memory

                  WriteExcelHeader;

                  TempWageComp.DELETEALL(FALSE);//191014
                END;

    OnPostReport=VAR
                   lvJobLedgerEntry@1100285503 : Record 11072005;
                   lvColumnNo@1100285502 : Integer;
                   lvAccountingPeriod@1100285501 : Record 50;
                   lvHours@1100285500 : Decimal;
                 BEGIN

                   //FireUp Excel
                   CreateFinalExcelWorkbook;
                 END;

    UseRequestPage=No;
  }
  DATASET
  {
    { 1100525002;;DataItem;                  ;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number)
                                 WHERE(Number=CONST(1)) }

    { 1100525001;1;Column;COMPANYNAME        ;
               SourceExpr=CompanyInfo.Name }

    { 1100525000;1;Column;REPORTNAME         ;
               SourceExpr=GetReportName }

    { 1100525005;1;Column;REPORTFILTER       ;
               SourceExpr=GetReportFilter }

    { 1100525048;1;Column;PeriodType         ;
               SourceExpr=SELECTSTR(PeriodType+1,Text001) }

    { 1100525009;1;Column;CumulationFilter   ;
               SourceExpr=STRSUBSTNO('..%1', PeriodEndDate[1]) }

    { 1100525004;0;DataItem;                 ;
               DataItemTable=Table11072003;
               PrintOnlyIfDetail=Yes;
               OnAfterGetRecord=BEGIN
                                  bNewJobRec := TRUE;
                                END;

               OnPostDataItem=VAR
                                lvJobLedgerEntry@1100285503 : Record 11072005;
                                lvColumnNo@1100285502 : Integer;
                                lvAccountingPeriod@1100285501 : Record 50;
                                lvHours@1100285500 : Decimal;
                              BEGIN
                                //Final Total
                                RowNo := RowNo + 1;


                                JobNoFilter    := Job.GETFILTER(Job."No.");
                                EmployeeFilter := "Job Ledger Entry".GETFILTER("Employee No.");

                                IF bExcelLinePresent THEN BEGIN
                                   //loop per Posting Date
                                   CLEAR(lvJobLedgerEntry);
                                   lvJobLedgerEntry.SETCURRENTKEY("Main Project No.", "Job No.", "Employee No.", "Cost Type", "Posting Date");
                                   IF EmployeeFilter <> '' THEN
                                      lvJobLedgerEntry.COPYFILTERS("Job Ledger Entry"); //kkleermaker.n, 130909, C005758
                                   IF JobNoFilter <> '' THEN
                                      lvJobLedgerEntry.SETRANGE("Job No.", Job."No.");
                                   lvJobLedgerEntry.SETRANGE("Cost Type", lvJobLedgerEntry."Cost Type"::Labor);
                                   IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                     lvJobLedgerEntry.SETRANGE("Posting Date", gStartDate, gEndDate);
                                   END ELSE BEGIN //RFC-1057
                                     lvJobLedgerEntry.SETRANGE("Execution Date", gStartDate, gEndDate);//RFC-1057
                                   END;//RFC-1057
                                   //
                                   Total := CalcTotalQuantity(lvJobLedgerEntry); //kkleermaker.n, 130909, C005758
                                   //
                                   EnterCell(RowNo, 2,FORMAT(Txt_Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
                                   //
                                   //StartPeriode and then walkthru specified Periods
                                   IF PeriodType = PeriodType :: "Accounting Period" THEN BEGIN
                                      lvColumnNo := 4;
                                      IF gAccountingPeriod.FINDFIRST THEN
                                      REPEAT
                                        lvAccountingPeriod := gAccountingPeriod;
                                        lvAccountingPeriod.RESET;
                                        IF lvAccountingPeriod.NEXT = 0 THEN BEGIN
                                          IF DateType = DateType::"Posting Date" THEN BEGIN//RFC-1057
                                            lvJobLedgerEntry.SETRANGE("Posting Date", gAccountingPeriod."Starting Date", gEndDate);
                                          END ELSE BEGIN //RFC-1057
                                            lvJobLedgerEntry.SETRANGE("Execution Date", gAccountingPeriod."Starting Date", gEndDate);//RFC-1057
                                          END;//RFC-1057
                                        END ELSE BEGIN
                                          IF DateType = DateType::"Posting Date" THEN BEGIN//RFC-1057
                                            lvJobLedgerEntry.SETRANGE("Posting Date", gAccountingPeriod."Starting Date", CALCDATE('<-1D>',lvAccountingPeriod."Starting Date"));
                                          END ELSE BEGIN //RFC-1057
                                            lvJobLedgerEntry.SETRANGE("Execution Date", gAccountingPeriod."Starting Date", CALCDATE('<-1D>',lvAccountingPeriod."Starting Date")); //RFC-1057
                                          END; //RFC-1057
                                        END;
                                       lvHours := CalcTotalQuantity(lvJobLedgerEntry);

                                        EnterCell(RowNo, lvColumnNo,FORMAT(lvHours),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                        lvColumnNo :=lvColumnNo + 1 ;

                                      UNTIL gAccountingPeriod.NEXT = 0;
                                      EnterCell(RowNo, lvColumnNo,FORMAT(Txt_Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                    END
                                   ELSE BEGIN
                                      lvColumnNo := 4;
                                      IF gCalendar.FINDFIRST THEN
                                      REPEAT
                                        IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                          lvJobLedgerEntry.SETRANGE("Posting Date", gCalendar."Period Start", gCalendar."Period End");
                                        END ELSE BEGIN //RFC-1057
                                          lvJobLedgerEntry.SETRANGE("Execution Date", gCalendar."Period Start", gCalendar."Period End"); //RFC-1057
                                        END; //RFC-1057
                                        lvHours := CalcTotalQuantity(lvJobLedgerEntry);
                                        EnterCell(RowNo, lvColumnNo,FORMAT(lvHours),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);

                                        lvColumnNo :=lvColumnNo + 1 ;
                                      UNTIL gCalendar.NEXT = 0;
                                      EnterCell(RowNo, lvColumnNo,FORMAT(Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                   END;

                                   //>>140107
                                   RecordCounterBuffer := RecordCounterBuffer + 1;
                                   IF RecordCounterBuffer > RecordCounterMax THEN BEGIN
                                      CreateExcelWorkbook;
                                      RecordCounterBuffer := 0;
                                   END;
                                   //<<140107

                                   RowNo := RowNo + 1;
                                END;
                              END;

               ReqFilterFields=No. }

    { 1100525006;1;DataItem;                 ;
               DataItemTable=Table11072005;
               DataItemTableView=SORTING(Main Project No.,Job No.,Employee No.,Cost Type,Posting Date,Employee External,Entry Type)
                                 WHERE(Cost Type=CONST(Labor),
                                       Employee No.=FILTER(<>''));
               ReqFilterHeadingML=[ENU=Employee;
                                   NOR=Ansatt;
                                   SVE=Personal];
               OnPreDataItem=BEGIN
                               TempEmployee.RESET;
                               TempEmployee.DELETEALL;
                             END;

               OnAfterGetRecord=BEGIN
                                  IF Employee.GET("Job Ledger Entry"."Employee No.") THEN BEGIN
                                    TempEmployee := Employee;
                                    IF TempEmployee.INSERT THEN;
                                  END ELSE BEGIN
                                    IF "Job Ledger Entry"."Supplying Company" <> '' THEN BEGIN
                                      Employee.CHANGECOMPANY("Job Ledger Entry"."Supplying Company");
                                      IF Employee.GET("Job Ledger Entry"."Employee No.") THEN BEGIN
                                        TempEmployee := Employee;
                                        IF TempEmployee.INSERT THEN;
                                      END ELSE BEGIN
                                        TempEmployee.INIT;
                                        TempEmployee."No." := "Job Ledger Entry"."Employee No.";
                                        TempEmployee."Last Name" := GetLastName("Job Ledger Entry".Description);
                                        IF TempEmployee.INSERT THEN;
                                      END;
                                    END;
                                  END;
                                END;

               ReqFilterFields=Employee No.;
               DataItemLink=Job No.=FIELD(No.) }

    { 1100525007;1;DataItem;EmployeeByJob    ;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number)
                                 WHERE(Number=FILTER(1..));
               OnPreDataItem=BEGIN
                               TempEmployee.RESET;
                               IF NOT TempEmployee.FINDSET THEN
                                 CurrReport.BREAK;
                             END;

               OnAfterGetRecord=VAR
                                  lvJobLedgerEntry@1100525000 : Record 11072005;
                                  lvColumnNo@1100285500 : Integer;
                                  lvAccountingPeriod@1100285501 : Record 50;
                                  lvHours@1100285502 : Decimal;
                                BEGIN
                                  IF Number > 1 THEN BEGIN
                                    IF TempEmployee.NEXT = 0 THEN
                                      CurrReport.BREAK;
                                   END;
                                  //

                                  //loop per Job / Employee / Period
                                  lvJobLedgerEntry.SETCURRENTKEY("Main Project No.", "Job No.", "Employee No.", "Cost Type", "Posting Date");
                                  lvJobLedgerEntry.COPYFILTERS("Job Ledger Entry"); //kkleermaker.n, 130909, C005758
                                  lvJobLedgerEntry.SETRANGE("Job No.", Job."No.");
                                  lvJobLedgerEntry.SETRANGE("Cost Type", lvJobLedgerEntry."Cost Type"::Labor);
                                  lvJobLedgerEntry.SETRANGE("Employee No.", TempEmployee."No.");
                                  IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                    lvJobLedgerEntry.SETRANGE("Posting Date", gStartDate, gEndDate);
                                  END ELSE BEGIN //RFC-1057
                                    lvJobLedgerEntry.SETRANGE("Execution Date", gStartDate, gEndDate); //RFC-1057
                                  END; //RFC-1057
                                  Total := CalcTotalQuantity(lvJobLedgerEntry); //kkleermaker.n, 130909, C005758

                                  IF Total = 0 THEN
                                    CurrReport.SKIP;

                                  bExcelLinePresent := TRUE;

                                  IF bNewJobRec THEN BEGIN
                                     EnterCell(RowNo, 1,FORMAT(Txt_Project),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
                                     EnterCell(RowNo, 2,FORMAT(Job."No."),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
                                     EnterCell(RowNo, 3,FORMAT(Job.Description),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
                                     RowNo := RowNo + 1;
                                     bNewJobRec := FALSE;
                                  END;

                                  EnterCell(RowNo, 1,FORMAT(TempEmployee."No.")      ,FALSE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                  EnterCell(RowNo, 2,FORMAT(TempEmployee."Last Name"),FALSE,FALSE,'','',ExcelBuf."Cell Type"::Number);

                                  //StartPeriode and then walkthru specified Periods
                                  IF PeriodType = PeriodType :: "Accounting Period" THEN BEGIN
                                     lvColumnNo := 4;
                                     IF gAccountingPeriod.FINDFIRST THEN
                                     REPEAT
                                       lvAccountingPeriod := gAccountingPeriod;
                                       lvAccountingPeriod.RESET;
                                       IF lvAccountingPeriod.NEXT = 0 THEN BEGIN
                                         IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                           lvJobLedgerEntry.SETRANGE("Posting Date", gAccountingPeriod."Starting Date", gEndDate);
                                         END ELSE BEGIN //RFC-1057
                                           lvJobLedgerEntry.SETRANGE("Execution Date", gAccountingPeriod."Starting Date", gEndDate); //RFC-1057
                                         END; //RFC-1057
                                       END ELSE BEGIN
                                         IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                           lvJobLedgerEntry.SETRANGE("Posting Date", gAccountingPeriod."Starting Date", CALCDATE('<-1D>',lvAccountingPeriod."Starting Date"));
                                         END ELSE BEGIN //RFC-1057
                                           lvJobLedgerEntry.SETRANGE("Execution Date", gAccountingPeriod."Starting Date", CALCDATE('<-1D>',lvAccountingPeriod."Starting Date"));//RFC-1057
                                         END; //RFC-1057
                                       END;
                                      lvHours := CalcTotalQuantity(lvJobLedgerEntry);

                                       EnterCell(RowNo, lvColumnNo,FORMAT(lvHours),FALSE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                       lvColumnNo :=lvColumnNo + 1 ;

                                     UNTIL gAccountingPeriod.NEXT = 0;
                                     EnterCell(RowNo, lvColumnNo,FORMAT(Txt_Total),FALSE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                   END
                                  ELSE BEGIN
                                     lvColumnNo := 4;
                                     IF gCalendar.FINDFIRST THEN
                                     REPEAT
                                       IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                         lvJobLedgerEntry.SETRANGE("Posting Date", gCalendar."Period Start", gCalendar."Period End");
                                       END ELSE BEGIN //RFC-1057
                                         lvJobLedgerEntry.SETRANGE("Execution Date", gCalendar."Period Start", gCalendar."Period End"); //RFC-1057
                                       END; //RFC-1057
                                       lvHours := CalcTotalQuantity(lvJobLedgerEntry);
                                       EnterCell(RowNo, lvColumnNo,FORMAT(lvHours),FALSE,FALSE,'','',ExcelBuf."Cell Type"::Number);

                                       lvColumnNo :=lvColumnNo + 1 ;
                                     UNTIL gCalendar.NEXT = 0;
                                     EnterCell(RowNo, lvColumnNo,FORMAT(Total),FALSE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                  END;

                                  {
                                  //>>OLD
                                  JobLedgerEntry.SETRANGE("Posting Date", 0D, PeriodEndDate[10]);
                                  TotalForSelection := CalcTotalQuantity(JobLedgerEntry); //kkleermaker.n, 130909, C005758

                                  FOR I := 1 TO 9 DO BEGIN
                                    JobLedgerEntry.SETRANGE("Posting Date", PeriodStartDate[I], PeriodEndDate[I]);
                                    Hours[I] := CalcTotalQuantity(JobLedgerEntry); //kkleermaker.n, 130909, C005758;
                                  END;
                                  //<<Old
                                  }

                                  //>>140107
                                  RecordCounterBuffer := RecordCounterBuffer + 1;
                                  IF RecordCounterBuffer > RecordCounterMax THEN BEGIN
                                     CreateExcelWorkbook;
                                     RecordCounterBuffer := 0;
                                  END;
                                  //<<140107

                                  RowNo := RowNo + 1;
                                END;

               OnPostDataItem=VAR
                                HeaderRangeTxt@1100285503 : Text[30];
                                ListRangeTxt@1100285502 : Text[30];
                                BodyRangeTxt@1100285501 : Text[30];
                                SheetRangeTxt@1100285500 : Text[30];
                                lvJobLedgerEntry@1100285507 : Record 11072005;
                                lvColumnNo@1100285506 : Integer;
                                lvAccountingPeriod@1100285505 : Record 50;
                                lvHours@1100285504 : Decimal;
                              BEGIN
                                //loop per Job / Employee
                                lvJobLedgerEntry.SETCURRENTKEY("Main Project No.", "Job No.", "Employee No.", "Cost Type", "Posting Date");
                                //lvJobLedgerEntry.COPYFILTERS("Job Ledger Entry"); //kkleermaker.n, 130909, C005758
                                lvJobLedgerEntry.SETRANGE("Job No.", Job."No.");
                                lvJobLedgerEntry.SETRANGE("Cost Type", lvJobLedgerEntry."Cost Type"::Labor);
                                IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                  lvJobLedgerEntry.SETRANGE("Posting Date", gStartDate, gEndDate);
                                END ELSE BEGIN //RFC-1057
                                  lvJobLedgerEntry.SETRANGE("Execution Date", gStartDate, gEndDate); //RFC-1057
                                END; //RFC-1057
                                Total := CalcTotalQuantity(lvJobLedgerEntry); //kkleermaker.n, 130909, C005758

                                IF Total = 0 THEN
                                  CurrReport.SKIP;

                                EnterCell(RowNo, 3,FORMAT(Txt_TotalHours),FALSE,FALSE,'','',ExcelBuf."Cell Type"::Text);

                                //StartPeriode and then walkthrough specified Periods
                                IF PeriodType = PeriodType :: "Accounting Period" THEN BEGIN
                                   lvColumnNo := 4;
                                   IF gAccountingPeriod.FINDFIRST THEN
                                   REPEAT
                                     lvAccountingPeriod := gAccountingPeriod;
                                     lvAccountingPeriod.RESET;
                                     IF lvAccountingPeriod.NEXT = 0 THEN BEGIN
                                       IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                         lvJobLedgerEntry.SETRANGE("Posting Date", gAccountingPeriod."Starting Date", gEndDate);
                                       END ELSE BEGIN //RFC-1057
                                         lvJobLedgerEntry.SETRANGE("Execution Date", gAccountingPeriod."Starting Date", gEndDate); //RFC-1057
                                       END; //RFC-1057
                                     END ELSE BEGIN
                                       IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                         lvJobLedgerEntry.SETRANGE("Posting Date", gAccountingPeriod."Starting Date", CALCDATE('<-1D>',lvAccountingPeriod."Starting Date"));
                                       END ELSE BEGIN //RFC-1057
                                         lvJobLedgerEntry.SETRANGE("Execution Date", gAccountingPeriod."Starting Date", CALCDATE('<-1D>',lvAccountingPeriod."Starting Date"));//RFC-1057
                                       END; //RFC-1057
                                     END;
                                    lvHours := CalcTotalQuantity(lvJobLedgerEntry);

                                     EnterCell(RowNo, lvColumnNo,FORMAT(lvHours),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                     lvColumnNo :=lvColumnNo + 1 ;

                                   UNTIL gAccountingPeriod.NEXT = 0;
                                   EnterCell(RowNo, lvColumnNo,FORMAT(Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                 END
                                ELSE BEGIN
                                   lvColumnNo := 4;
                                   IF gCalendar.FINDFIRST THEN
                                   REPEAT
                                     IF DateType = DateType::"Posting Date" THEN BEGIN //RFC-1057
                                       lvJobLedgerEntry.SETRANGE("Posting Date", gCalendar."Period Start", gCalendar."Period End");
                                     END ELSE BEGIN //RFC-1057
                                       lvJobLedgerEntry.SETRANGE("Execution Date", gCalendar."Period Start", gCalendar."Period End"); //RFC-1057
                                     END; //RFC-1057
                                     lvHours := CalcTotalQuantity(lvJobLedgerEntry);
                                     EnterCell(RowNo, lvColumnNo,FORMAT(lvHours),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);

                                     lvColumnNo :=lvColumnNo + 1 ;
                                   UNTIL gCalendar.NEXT = 0;
                                   EnterCell(RowNo, lvColumnNo,FORMAT(Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Number);
                                END;

                                //>>140107
                                RecordCounterBuffer := RecordCounterBuffer + 1;
                                IF RecordCounterBuffer > RecordCounterMax THEN BEGIN
                                   CreateExcelWorkbook;
                                   RecordCounterBuffer := 0;
                                END;
                                //<<140107

                                RowNo := RowNo + 1;
                              END;
                               }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
      { 1100525000;;Container;
                  ContainerType=ContentArea }

      { 1100525001;1;Group  ;
                  CaptionML=[ENU=Options;
                             NOR=Alternativer;
                             SVE=Alternativ];
                  GroupType=Group }

      { 1100525003;2;Field  ;
                  CaptionML=[ENU=Period Type;
                             NOR=Periodetype;
                             SVE=Periodtyp];
                  OptionCaptionML=[ENU=Day,Week,Month,Quarter,Year,Accounting Period;
                                   NOR=Dag,Uke,M†ned,Kvartal,r,Regnskapsperiode;
                                   SVE=Dag,Vecka,M†nad,Kvartal,r,Bokf”ringsperiod];
                  SourceExpr=PeriodType }

      { 1100525002;2;Field  ;
                  CaptionML=[ENU=Period Filter;
                             NOR=Periodefilter;
                             SVE=Periodfilter];
                  SourceExpr=PeriodFilter;
                  OnLookup=VAR
                             Day@1100525001 : Date;
                             Week@1100525002 : Integer;
                             Year@1100525003 : Integer;
                           BEGIN
                             DateSelectionManagement.GetPeriod(PeriodFilter);
                             Text := PeriodFilter;
                           END;
                            }

      { 1100525004;2;Field  ;
                  CaptionML=[ENU=Print Period Name;
                             NOR=Skriv ut periodenavn];
                  SourceExpr=PrintPeriodName }

    }
  }
  LABELS
  {
    { 1100525003;PageCaption   ;CaptionML=[ENU=Page;
                                           NOR=Side;
                                           SVE=Sida] }
    { 1100525039;TotalCaption  ;CaptionML=[ENU=Total;
                                           NOR=I alt;
                                           SVE=Totalt] }
    { 1100525040;TotalHoursCaption;
                                CaptionML=[ENU=Total Hours;
                                           NOR=Timer totalt;
                                           SVE=Timmar totalt] }
    { 1100525041;PeriodTypeCaption;
                                CaptionML=[ENU=Period Type;
                                           NOR=Periodetype;
                                           SVE=Periodtyp] }
    { 1100525038;UntilCaption  ;CaptionML=[ENU=Until;
                                           NOR=Frem til;
                                           SVE=Till] }
  }
  CODE
  {
    VAR
      DateSelectionManagement@1100525000 : Codeunit 11130005;
      PeriodManagementReports@1100525003 : Codeunit 11012016;
      PeriodFilter@1100525001 : Text;
      Text000@1100525002 : TextConst 'ENU=Select period on option tab.;NOR=Velg periode p† valgfanen;SVE=V„lj period p† alternativfliken.';
      PrintPeriodName@1100525009 : Boolean;
      PeriodName@1100525008 : ARRAY [10] OF Text[30];
      PeriodType@1100525004 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      PeriodStartDate@1100525006 : ARRAY [10] OF Date;
      PeriodEndDate@1100525005 : ARRAY [10] OF Date;
      Employee@1100525007 : Record 5200;
      TempEmployee@1100525010 : TEMPORARY Record 5200;
      Total@1100525011 : Decimal;
      TotalForSelection@1100525012 : Decimal;
      Hours@1100525014 : ARRAY [10] OF Decimal;
      Text001@1100525015 : TextConst 'ENU=Day,Week,Month,Quarter,Year,Accounting Period;NOR=Dag,Uke,M†ned,Kvartal,r,Regnskapsperiode;SVE=Dag,Vecka,M†nad,Kvartal,r,Bokf”ringsperiod';
      Text002@1100525013 : TextConst 'ENU=Print Period Names with Accounting Periods not allowed.;NOR=Print periodenavn med regnskapsperiode ikke tillatt';
      "*** Variables Itero ***"@1100285500 : Integer;
      ExcelBuf@1100285507 : TEMPORARY Record 370;
      RowNo@1100285506 : Integer;
      ColNo@1100285505 : Integer;
      FirstBodyRow@1100285504 : Integer;
      FirstBodyColumn@1100285503 : Integer;
      LastRowNo@1100285502 : Integer;
      LastColNo@1100285501 : Integer;
      gStartDate@1100285508 : Date;
      gEndDate@1100285509 : Date;
      gCalendar@1100285510 : Record 2000000007;
      gAccountingPeriod@1100285514 : Record 50;
      gDay@1100285511 : Integer;
      gMonth@1100285512 : Integer;
      gYear@1100285513 : Integer;
      gStartAccountingPeriod@1100285515 : Date;
      gEndAccountingPeriod@1100285516 : Date;
      RecordCounterBuffer@1100285517 : Integer;
      RecordCounterMax@1100285518 : Integer;
      FirstCreate@1100285519 : Boolean;
      Txt_Book@1100285520 : TextConst 'ENU=BookName;NOR=Boknavn';
      Txt_Sheet@1100285521 : TextConst 'ENU=SheetName;NOR=Arknavn';
      Txt_Titel@1100285522 : TextConst 'ENU=Project Hours per Employee;NOR=Prosjekt timer per ansatt;SVE=Projekttimmar per anst„lld';
      gReportName@1100285523 : Text;
      gReportFilter@1100285524 : Text;
      Txt_PeriodType@1100285525 : TextConst 'ENU=Period Type;NOR=Periodetype;SVE=Period typ';
      Txt_PeriodFilter@1100285526 : TextConst 'ENU=Period Filter;NOR=Periodefilter;SVE=Period filter';
      Txt_Total@1100285527 : TextConst 'SVE=Total';
      Txt_Project@1100285528 : TextConst 'ENU=Project No.;NOR=Prosjektnr;SVE=Projekt nr';
      bNewJobRec@1100285529 : Boolean;
      Txt_TotalHours@1100285530 : TextConst 'ENU=Total Hours;NOR=Timer totalt;SVE=Totalt timmar';
      bExcelLinePresent@1100285531 : Boolean;
      JobNoFilter@1100285532 : Text;
      EmployeeFilter@1100285533 : Text;
      CompanyInfo@1100285100 : Record 79;
      DateType@1000000000 : 'Posting Date,Execution Date';
      TempWageComp@1100285101 : TEMPORARY Record 11012014;

    PROCEDURE GetReportName@1100525003() : Text;
    BEGIN
      EXIT(DELSTR(CurrReport.OBJECTID, 1, STRPOS(CurrReport.OBJECTID, ' ')));
    END;

    PROCEDURE GetReportFilter@1100525000() : Text;
    BEGIN
      IF Job.GETFILTERS <> '' THEN
        EXIT(STRSUBSTNO('%1: %2', Job.TABLECAPTION, Job.GETFILTERS));
    END;

    PROCEDURE DeterminePeriods@1100525001();
    VAR
      I@1100525002 : Integer;
      DateFilter@1100525003 : Text;
      CumulationFilter@1100525005 : Text;
    BEGIN
      DateFilter := PeriodFilter;

      FOR I := 1 TO 10 DO BEGIN
        IF I = 1 THEN
          PeriodManagementReports.FindPeriod(PeriodStartDate[I], PeriodEndDate[I], CumulationFilter, DateFilter, PeriodType, '=')
        ELSE
          PeriodManagementReports.FindPeriod(PeriodStartDate[I], PeriodEndDate[I], CumulationFilter, DateFilter, PeriodType, '<=');
        PeriodManagementReports.SelectPeriodNameOrNr(PeriodType, PeriodStartDate[I], PeriodName[I]);
      END;
    END;

    LOCAL PROCEDURE GetLastName@1100485002(Description@1100485000 : Text[250]) Result : Text[30];
    BEGIN
      Result := DELCHR(Description, '<>', ' ');
      WHILE STRPOS(Result, ' ') > 0 DO BEGIN
        Result := COPYSTR(Result, STRPOS(Result, ' ') + 1);
      END;
    END;

    LOCAL PROCEDURE CalcTotalQuantity@1100528400(VAR JobLedgerEntry@1100528400 : Record 11072005) TotalQuantity : Decimal;
    VAR
      WageComponent@1100285100 : Record 11012014;
    BEGIN
      //kkleermaker, 130909, C005758
      //IF JobLedgerEntry.FINDSET THEN
      IF JobLedgerEntry.FINDFIRST THEN
        REPEAT
      //>>191014
          IF NOT TempWageComp.GET(JobLedgerEntry."Wage Component") THEN BEGIN
            WageComponent.GET(JobLedgerEntry."Wage Component");
            TempWageComp.Code := WageComponent.Code;
            TempWageComp."Component Type" := WageComponent."Component Type";
            TempWageComp.INSERT(FALSE);
          END;
          IF TempWageComp."Component Type" <> TempWageComp."Component Type"::Addition THEN
      //<<
          TotalQuantity := TotalQuantity + JobLedgerEntry.Quantity;
        UNTIL JobLedgerEntry.NEXT = 0;
    END;

    PROCEDURE "*** Functions Itero ***"@1100285501();
    BEGIN
    END;

    LOCAL PROCEDURE EnterCell@3(RowNo@1000 : Integer;ColumnNo@1001 : Integer;CellValue@1002 : Text[250];Bold@1003 : Boolean;UnderLine@1004 : Boolean;NumberFormat@1005 : Text[30];FontName@1100485000 : Text[30];CellType@1100525000 : Option);
    BEGIN
      ExcelBuf.INIT;
      ExcelBuf.VALIDATE("Row No.",RowNo);
      ExcelBuf.VALIDATE("Column No.",ColumnNo);
      ExcelBuf."Cell Value as Text" := CellValue;
      ExcelBuf.Formula := '';
      ExcelBuf.Bold := Bold;
      ExcelBuf.Underline := UnderLine;
      ExcelBuf.NumberFormat := NumberFormat;
      ExcelBuf.FontName := FontName; //**4PS.n
      ExcelBuf."Cell Type" := CellType;
      ExcelBuf.INSERT;
    END;

    LOCAL PROCEDURE EnterFilterInCell@5(Filter@1000 : Text[250];FieldName@1001 : Text[100]);
    BEGIN
      IF Filter <> '' THEN BEGIN
        RowNo := RowNo + 1;
        EnterCell(RowNo,1,FieldName,FALSE,FALSE,'@','', ExcelBuf."Cell Type"::Text);
        EnterCell(RowNo,2,Filter,FALSE,FALSE,'@','', ExcelBuf."Cell Type"::Text);
      END;
    END;

    LOCAL PROCEDURE EnterFormula@8(RowNo@1000 : Integer;ColumnNo@1001 : Integer;CellValue@1002 : Text[50];RangeName1@1003 : Text[250];RangeName2@1004 : Text[250];Bold@1005 : Boolean;UnderLine@1006 : Boolean;CellType@1100525000 : Option);
    BEGIN
      ExcelBuf.INIT;
      ExcelBuf.VALIDATE("Row No.",RowNo);
      ExcelBuf.VALIDATE("Column No.",ColumnNo);
      ExcelBuf."Cell Value as Text" := '';
      ExcelBuf.Formula := CellValue; // is converted to formula later.
      ExcelBuf.Bold := Bold;
      ExcelBuf.Underline := UnderLine;
      ExcelBuf."Cell Type" := CellType;
      ExcelBuf.INSERT;
    END;

    PROCEDURE WriteExcelHeader@1100285505();
    VAR
      lvTextHeader@1100285500 : Text;
      lvColumnNo@1100285501 : Integer;
    BEGIN
      RowNo := 1;
      EnterCell(RowNo, 1,FORMAT(Txt_Titel ),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      //EnterCell(RowNo,10,FORMAT(WORKDATE,4),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

      RowNo := 2;
      //160415 ITERO.PEPF
      //EnterCell(RowNo, 1,FORMAT(COMPANYNAME),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      EnterCell(RowNo, 1,FORMAT(CompanyInfo.Name),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      //160415 ITERO.PEPF
      //EnterCell(RowNo,10,FORMAT(USERID     ),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

      RowNo := 3;
      EnterCell(RowNo, 1,FORMAT(Txt_PeriodType),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      EnterCell(RowNo, 2,FORMAT(PeriodType   ),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      RowNo := 4;
      EnterCell(RowNo, 1,FORMAT(Txt_PeriodFilter),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      EnterCell(RowNo, 2,FORMAT(PeriodFilter    ),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

      RowNo := 7;
      EnterCell(RowNo, 1,FORMAT(TempEmployee.FIELDCAPTION("No.")      ),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      EnterCell(RowNo, 2,FORMAT(TempEmployee.FIELDCAPTION("Last Name")),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

      IF PeriodType = PeriodType :: "Accounting Period" THEN BEGIN
         lvColumnNo := 4;
         IF gAccountingPeriod.FINDFIRST THEN
         REPEAT
           RowNo := 6; //From StartDate
           EnterCell(RowNo, lvColumnNo,FORMAT(gAccountingPeriod."Starting Date",0),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

           RowNo := 7; //From EndDateDate
           EnterCell(RowNo, lvColumnNo,FORMAT(gAccountingPeriod.Name),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
           lvColumnNo :=lvColumnNo + 1 ;

         UNTIL gAccountingPeriod.NEXT = 0;
         EnterCell(RowNo, lvColumnNo,FORMAT(Txt_Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
       END
      ELSE BEGIN
         lvColumnNo := 4;
         IF gCalendar.FINDFIRST THEN
         REPEAT

           IF PrintPeriodName THEN BEGIN

              RowNo := 7; //From EndDateDate
              // >> REP-100-031
              //EnterCell(RowNo, lvColumnNo,FORMAT(gCalendar."Period Name",0,'<Year4>-<Month,2>-<Day,2>'),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
              EnterCell(RowNo, lvColumnNo,gCalendar."Period Name",TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
              // << REP-100-031
            END
           ELSE BEGIN
             RowNo := 6; //From StartDate
             EnterCell(RowNo, lvColumnNo,FORMAT(gCalendar."Period Start",0,'<Year4>-<Month,2>-<Day,2>'),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

             RowNo := 7; //From EndDateDate
             EnterCell(RowNo, lvColumnNo,FORMAT(gCalendar."Period End",0,'<Year4>-<Month,2>-<Day,2>'),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);

           END;
           lvColumnNo :=lvColumnNo + 1 ;
         UNTIL gCalendar.NEXT = 0;
         EnterCell(RowNo, lvColumnNo,FORMAT(Txt_Total),TRUE,FALSE,'','',ExcelBuf."Cell Type"::Text);
      END;

      RowNo:= 9;
    END;

    PROCEDURE CreateFinalExcelWorkbook@1000000021();
    BEGIN

      IF FirstCreate THEN
      //>>170808
      //  ExcelBuf.CreateBook(CurrReport.OBJECTID(TRUE),Txt_Sheet);
        ExcelBuf.CreateBook('',Txt_Sheet);
      //<<170808
      ExcelBuf.WriteSheet(Txt_Sheet,COMPANYNAME,USERID);
      ExcelBuf.CloseBook;
      ExcelBuf.OpenExcel;
      // ExcelBuf.GiveUserControl;
    END;

    PROCEDURE CreateExcelWorkbook@1000000016();
    BEGIN

      IF FirstCreate THEN BEGIN
      //>>170808
      //  ExcelBuf.CreateBook(CurrReport.OBJECTID(TRUE),Txt_Sheet);
        ExcelBuf.CreateBook('',Txt_Sheet);
      //<<170808
        FirstCreate := FALSE;
      END;
      ExcelBuf.WriteSheet(Txt_Sheet,COMPANYNAME,USERID);
      ExcelBuf.DELETEALL;
    END;

    PROCEDURE InitReport@1100285500(pPeriodFilter@1100285502 : Text;pPrintPeriodName@1100285501 : Boolean;pPeriodType@1100285500 : 'Day,Week,Month,Quarter,Year,Accounting Period';pJob@1100285503 : Record 11072003;pEmployee@1100285504 : Record 5200;pDateTyp@1000000000 : 'Posting Date,Execution Date');
    BEGIN
      PeriodFilter    := pPeriodFilter;
      PrintPeriodName := pPrintPeriodName;
      PeriodType      := pPeriodType;
      DateType := pDateTyp;
      Job.COPYFILTERS(pJob);
      Employee.COPYFILTERS(pEmployee);
    END;

    BEGIN
    {
      140526 ITERO.DJ added swe caption for report name

      140715 ITERO.GH IME165 Report CaptionML SE and NO added
      141001 ITERO.MK REP-100-031 Fixed problem when choosing PrintPeriodName
      160415 ITERO.PEPF company Name from table "Company Information", even in excel export
      170808 ITERO.DL pure127570 report crash when calling excel
      180806 ORANGO.PR RFC-1057 - Execution Date
      191014 ORANGO.DL RFC1252 exclude type addition
    }
    END.
  }
  RDLDATA
  {
  }
}

