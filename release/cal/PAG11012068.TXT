OBJECT Page 11012068 Approve Credit Memos
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    Permissions=TableData 124=rimd;
    CaptionML=[DEU=Gutschriften genehmigen;
               ENU=Approve Credit Memos;
               NLD=Creditnota's goedkeuren;
               NOR=Godkjenn kreditnotaer;
               SVE=Godk„nn kreditnotor];
    InsertAllowed=No;
    DeleteAllowed=No;
    SourceTable=Table124;
    SourceTableView=WHERE(Credit Memo Approved=CONST(No));
    PageType=Document;
    RefreshOnActivate=Yes;
    PromotedActionCategoriesML=[DEU=Neu, Verarbeiten, Bericht, Belege mailen, Genehmigung;
                                ENU=New,Process,Report,Mail Documents,Approval;
                                NLD=Nieuw,Proces,Lijst,Documenten mailen,Goedkeuring];
    OnInit=BEGIN
             "Ext. Document IDEditable" := TRUE;
             "Ext. Document IDVisible" := TRUE;
             DropZoneContainerVisible := TRUE;
             "Remain On HoldEditable" := TRUE;
           END;

    OnOpenPage=VAR
                 JnlSelected@1100525001 : Boolean;
               BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**4PS Generated Code.en01

                 IF ApprJnlTemplate <> '' THEN BEGIN
                   FILTERGROUP(2);
                   SETRANGE("Journal Template", ApprJnlTemplate);
                   FILTERGROUP(0);
                   JnlSelected := TRUE;
                 END ELSE

                 PurchSetup.GET;
                 IF PurchSetup."Scanning Application Purch.Inv" <> PurchSetup."Scanning Application Purch.Inv"::Other THEN BEGIN
                   "Ext. Document IDEditable" := FALSE;
                   "Ext. Document IDVisible" := FALSE;
                 END;

                 OnHoldEditable := PurchSetup."On Hold Maintainable";

                 RemainOnHoldEditable := "Remain On HoldEditable"; //This might be changed bij user
               END;

    OnAfterGetRecord=VAR
                       lVendLedgEntryRec@1100485000 : Record 25;
                       lvTmpDummyErrorRec@1100485002 : TEMPORARY Record 11012052;
                       lvWKACalcCU@1100485001 : Codeunit 11012020;
                     BEGIN
                       IF gFromReference THEN BEGIN
                         gFromReference := FALSE;
                         CurrPage.ApprovalLines.PAGE.InitSelectionFromReference(gApprLineNo);
                       END;

                       gWKAPresent := FALSE;
                       IF "Subcontractor Credit Memo" = TRUE THEN BEGIN
                         lVendLedgEntryRec.SETRANGE("Document Type",lVendLedgEntryRec."Document Type"::"Credit Memo");
                         lVendLedgEntryRec.SETRANGE("Document No.","No.");
                         lVendLedgEntryRec.SETRANGE("Vendor No.","Buy-from Vendor No.");
                         IF lVendLedgEntryRec.FIND('-') THEN
                           gWKAPresent := lvWKACalcCU.CheckExternal(lVendLedgEntryRec, lvTmpDummyErrorRec);
                       END;
                     END;

    OnNewRecord=BEGIN
                  //**4PS Generated Code. Do Not Change.sn02
                  DPA_SetDefaultDepartment;
                  //**4PS Generated Code.en02
                END;

    OnInsertRecord=VAR
                     xRecRef@1100000999 : RecordRef;
                   BEGIN
                     //**4PS Generated Code. Do Not Change.sn05
                     xRecRef.GETTABLE(xRec);
                     DPA_SetDefaultDpmtFromNoSeries(xRecRef);
                     //**4PS Generated Code.en05
                   END;

    OnAfterGetCurrRecord=VAR
                           RecRef@1100525000 : RecordRef;
                         BEGIN
                           UpdateControls;
                           RecRef.GETTABLE(Rec);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetRecordReference(RecRef);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetByCompany(TRUE);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetDepartmentCode('');
                           SetControlAppearance;
                           ShowWorkflowStatus := CurrPage.WorkflowStatus.PAGE.SetFilterOnWorkflowRecord(RECORDID);

                           FillDocumentViewerFactbox;
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 120     ;1   ;ActionGroup;
                      CaptionML=[DEU=&Gutschrift;
                                 ENU=&Cr. Memo;
                                 NLD=&Creditnota;
                                 NOR=&Kreditnota;
                                 SVE=&Kreditnota] }
      { 122     ;2   ;Action    ;
                      ShortCutKey=F7;
                      CaptionML=[DEU=Statistik;
                                 ENU=Statistics;
                                 NLD=Statistiek;
                                 NOR=Statistikk;
                                 SVE=Statistik];
                      RunObject=Page 401;
                      RunPageLink=No.=FIELD(No.);
                      Promoted=Yes;
                      Image=Statistics;
                      PromotedCategory=Process }
      { 123     ;2   ;Action    ;
                      CaptionML=[DEU=Be&merkungen;
                                 ENU=Co&mments;
                                 NLD=Op&merkingen;
                                 NOR=Ko&mmentarer;
                                 SVE=Ko&mmentarer];
                      RunObject=Page 66;
                      RunPageLink=Document Type=CONST(Posted Credit Memo),
                                  No.=FIELD(No.);
                      Image=ViewComments }
      { 1000000001;2 ;Action    ;
                      CaptionML=[DEU=Dimensionen;
                                 ENU=Dimensions;
                                 NLD=Dimensies;
                                 NOR=Dimensjoner;
                                 SVE=Dimensioner];
                      Image=Dimensions;
                      OnAction=BEGIN
                                 ShowDimensions;
                               END;
                                }
      { 1100485005;2 ;Action    ;
                      ShortCutKey=Shift+Ctrl+S;
                      CaptionML=[DEU=Gescannter Beleg;
                                 ENU=Scanned Document;
                                 NLD=Gescand document;
                                 NOR=Skannet Dokument;
                                 SVE=Skannade dokument];
                      Image=Document;
                      OnAction=VAR
                                 lvPurchSetupRec@1100485003 : Record 312;
                               BEGIN
                                 lvPurchSetupRec.GET;
                                 lvPurchSetupRec.ShowScannedDocument(3, "No.","Buy-from Vendor No.","Ext. Document ID");
                               END;
                                }
      { 1100528702;2 ;Action    ;
                      CaptionML=[DEU=Belege;
                                 ENU=Documents;
                                 NLD=Documenten;
                                 NOR=Dokumenter;
                                 SVE=Dokument];
                      Image=Documents;
                      OnAction=VAR
                                 RecRef@1100528700 : RecordRef;
                                 DocumentFilters@1100528701 : Codeunit 11012432;
                               BEGIN
                                 RecRef.GETTABLE(Rec);
                                 DocumentFilters.CreateTempFilterAndExecute1(RecRef, "Shortcut Dimension 1 Code", FALSE, TRUE);
                               END;
                                }
      { 1210190016;2 ;Action    ;
                      CaptionML=[DEU=ICF-Spezifikationen;
                                 ENU=ICF Specifications;
                                 NLD=ICF specificaties;
                                 NOR=ICF-spesifikasjoner;
                                 SVE=ICF-specifikationer];
                      Image=SetupList;
                      OnAction=BEGIN
                                 ShowICFInvoiceLines;
                               END;
                                }
      { 1100528206;2 ;ActionGroup;
                      CaptionML=[DEU=&Genehmigung;
                                 ENU=&Approval;
                                 NLD=&Goedkeuring;
                                 SVE=&Godk„nnanden];
                      Image=BOMLedger }
      { 1100528203;3 ;Action    ;
                      CaptionML=[DEU=Genehmigungsposten;
                                 ENU=Approval Entries;
                                 NLD=Goedkeuringsposten;
                                 NOR=Godkjenningstransaksjoner;
                                 SVE=Godk„nnandetransaktioner];
                      RunObject=Page 658;
                      RunPageView=WHERE(Table ID=CONST(124));
                      RunPageLink=Document No.=FIELD(No.);
                      Image=BOMLedger }
      { 1100528204;3 ;Action    ;
                      CaptionML=[DEU=Genehmigungskommentare;
                                 ENU=Approval Comments;
                                 NLD=Goedkeurings opmerkingen;
                                 NOR=Godkjenningsmerknader;
                                 SVE=Godk„nnandekommentarer];
                      OnAction=VAR
                                 ApprovalEntry@1100527001 : Record 454;
                                 ApprovalCommentLine@1100527000 : Record 455;
                               BEGIN
                                 //**4PS
                                 IF OpenApprovalEntriesExist THEN BEGIN
                                   ApprovalManagement4PSConstr.FilterApprovalEntryOpen(DATABASE::"Purch. Cr. Memo Hdr.", 3, "No.", ApprovalEntry, FALSE);
                                   ApprovalCommentLine.SETRANGE("Table ID", DATABASE::"Purch. Cr. Memo Hdr.");
                                   ApprovalCommentLine.SETRANGE("Document No.", "No.");
                                   ApprovalCommentLine.SETRANGE("Record ID to Approve", RECORDID);
                                   ApprovalCommentLine."Workflow Step Instance ID" := ApprovalEntry."Workflow Step Instance ID";
                                   ApprovalManagement4PSConstr.DrillDownApprovalCommentsHdr(ApprovalEntry,ApprovalCommentLine);
                                 END;
                               END;
                                }
      { 1100528201;3 ;Action    ;
                      CaptionML=[DEU=Gebuchte Genehmigungseintr„ge;
                                 ENU=Posted Approval Entries;
                                 NLD=Geboekte goedkeuringsposten;
                                 NOR=Bokf›rte godkjenningsposter;
                                 SVE=Bokf”rda godk„nnandetransaktioner];
                      RunObject=Page 659;
                      RunPageView=WHERE(Table ID=CONST(124));
                      RunPageLink=Document No.=FIELD(No.);
                      Image=BOMLedger }
      { 1100528202;3 ;Action    ;
                      CaptionML=[DEU=Gebuchte Genehmigungskommentare;
                                 ENU=Posted Approval Comments;
                                 NLD=Geboekte goedkeurings opmerkingen;
                                 NOR=Bokf›rte godkjenningsmerknader;
                                 SVE=Bokf”rda godk„nnandekommentarer];
                      RunObject=Page 661;
                      RunPageView=WHERE(Table ID=CONST(124));
                      RunPageLink=Document No.=FIELD(No.) }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 112     ;1   ;Action    ;
                      CaptionML=[DEU=&Navigate;
                                 ENU=&Navigate;
                                 NLD=&Navigeren;
                                 NOR=&Naviger;
                                 SVE=Anal&ysera];
                      Promoted=Yes;
                      Image=Navigate;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 Navigate;
                               END;
                                }
      { 1100529901;1 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=D&rucken;
                                 ENU=&Print;
                                 NLD=&Afdrukken;
                                 NOR=Skriv &ut;
                                 SVE=Skriv &ut];
                      Promoted=Yes;
                      Image=Print;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 PurchCrMemoHeader@1100529900 : Record 124;
                               BEGIN
                                 CurrPage.  SETSELECTIONFILTER(PurchCrMemoHeader);
                                 PurchCrMemoHeader.PrintRecords(TRUE,TRUE);
                               END;
                                }
      { 1100528404;1 ;ActionGroup;
                      CaptionML=[DEU=Freigeben;
                                 ENU=Release;
                                 NLD=Vrijgeven;
                                 NOR=Frigi;
                                 SVE=Sl„ppa];
                      Image=Release }
      { 1100528403;2 ;Action    ;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=[DEU=&Freigeben;
                                 ENU=Re&lease;
                                 NLD=&Vrijgeven;
                                 NOR=&Frigi;
                                 SVE=&Sl„pp];
                      Promoted=Yes;
                      Image=ReleaseDoc;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 Release;
                               END;
                                }
      { 1100528401;2 ;Action    ;
                      CaptionML=[DEU=Stat&us zurcksetzen;
                                 ENU=Re&open;
                                 NLD=Opnieu&w openen;
                                 NOR=&pne p† nytt;
                                 SVE=&™ppna igen];
                      Image=ReOpen;
                      OnAction=BEGIN
                                 Reopen;
                               END;
                                }
      { 1100528420;1 ;ActionGroup;
                      CaptionML=[DEU=Genehmigung;
                                 ENU=Approval;
                                 NLD=Goedkeuring;
                                 NOR=Godkjenning;
                                 SVE=Godk„nnande] }
      { 1100528419;2 ;Action    ;
                      Name=Approve;
                      CaptionML=[DEU=Genehmigen;
                                 ENU=Approve;
                                 NLD=Goedkeuren;
                                 NOR=Godkjenn;
                                 SVE=Godk„nn];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Approve;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                                 ApprovalEntry@1100528200 : Record 454;
                               BEGIN
                                 ApprovalsMgmt.ApproveRecordApprovalRequest(RECORDID);

                                 IF NOT ApprovalsMgmt.FindOpenApprovalEntryForCurrUser(ApprovalEntry,RECORDID) THEN
                                   MARK(FALSE);
                                 CurrPage.UPDATE(FALSE);
                                 IF NOT FIND('=><') THEN
                                   CurrPage.CLOSE;
                               END;
                                }
      { 1100528418;2 ;Action    ;
                      Name=Reject;
                      CaptionML=[DEU=Ablehnen;
                                 ENU=Reject;
                                 NLD=Weigeren;
                                 NOR=Avvis;
                                 SVE=Avvisa];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Reject;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.RejectRecordApprovalRequest(RECORDID)
                               END;
                                }
      { 1100528417;2 ;Action    ;
                      Name=Delegate;
                      CaptionML=[DEU=Delegieren;
                                 ENU=Delegate;
                                 NLD=Delegeren;
                                 NOR=Deleger;
                                 SVE=Delegera];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      Image=Delegate;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                               BEGIN
                                 ApprovalsMgmt.DelegateRecordApprovalRequest(RECORDID)
                               END;
                                }
      { 1100528416;2 ;Action    ;
                      Name=Comment;
                      CaptionML=[DEU=Bemerkungen;
                                 ENU=Comments;
                                 NLD=Opmerkingen;
                                 NOR=Merknader;
                                 SVE=Kommentar];
                      Promoted=Yes;
                      Enabled=OpenApprovalEntriesExistForCurrUser;
                      Image=ViewComments;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalEntry@1100525001 : Record 454;
                                 ApprovalCommentLine@1100525000 : Record 455;
                               BEGIN
                                 //**4PS
                                 IF OpenApprovalEntriesExist THEN BEGIN
                                   ApprovalManagement4PSConstr.FilterApprovalEntryOpen(DATABASE::"Purch. Cr. Memo Hdr.", 3, "No.", ApprovalEntry, FALSE);
                                   ApprovalCommentLine.SETRANGE("Table ID", DATABASE::"Purch. Cr. Memo Hdr.");
                                   ApprovalCommentLine.SETRANGE("Document No.", "No.");
                                   ApprovalCommentLine.SETRANGE("Record ID to Approve", RECORDID);
                                   ApprovalCommentLine."Workflow Step Instance ID" := ApprovalEntry."Workflow Step Instance ID";
                                   ApprovalManagement4PSConstr.DrillDownApprovalCommentsHdr(ApprovalEntry,ApprovalCommentLine);
                                 END;
                               END;
                                }
      { 1100525013;2 ;Action    ;
                      CaptionML=[DEU=&Gesperrt;
                                 ENU=&On Hold;
                                 NLD=Afwachten;
                                 SVE=S&toppad];
                      Promoted=Yes;
                      Visible=FALSE;
                      PromotedIsBig=Yes;
                      Image=Lock;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ApprovalsBridge4PSConstruct@1100525000 : Codeunit 11125348;
                               BEGIN
                                 ApprovalsBridge4PSConstruct.OnHold(Rec);
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100528415;1 ;ActionGroup;
                      CaptionML=[DEU=Genehmigungsanforderung;
                                 ENU=Request Approval;
                                 NLD=Goedkeuring aanvragen;
                                 NOR=Be om godkjenning;
                                 SVE=Beg„r godk„nnande];
                      Image=Action }
      { 1100528414;2 ;Action    ;
                      Name=SendApprovalRequest;
                      CaptionML=[DEU=&Genehmigungsanforderung senden;
                                 ENU=Send A&pproval Request;
                                 NLD=G&oedkeuringsaanvraag verzenden;
                                 NOR=&Send godkjenningsforesp›rsel;
                                 SVE=Skicka godk&„nnandebeg„ran];
                      Enabled=NOT OpenApprovalEntriesExist;
                      Image=SendApprovalRequest;
                      OnAction=VAR
                                 ApprovalManagement4PSConstr@1100528400 : Codeunit 11125349;
                                 ApprovalsBridge4PSConstruct@1100528401 : Codeunit 11125348;
                               BEGIN
                                 ApprovalManagement4PSConstr.CheckPostedPurchaseCreditMemoApprovalsWorkflowEnabled(Rec);
                                   ApprovalsBridge4PSConstruct.OnSendPostedPurchaseCreditMemoForApproval(Rec);
                               END;
                                }
      { 1100528413;2 ;Action    ;
                      Name=CancelApprovalRequest;
                      CaptionML=[DEU=&Genehmigungsanforderung stornieren;
                                 ENU=Cancel Approval Re&quest;
                                 NLD=&Goedkeuringsaanvraag annuleren;
                                 NOR=&Annuller godkjenningsforesp›rsel;
                                 SVE=Annullera &godk„nnandebeg„ran];
                      Enabled=CanCancelApprovalForRecord;
                      Image=Cancel;
                      OnAction=VAR
                                 ApprovalsBridge4PSConstruct@1100528400 : Codeunit 11125348;
                               BEGIN
                                 ApprovalsBridge4PSConstruct.OnCancelPostedPurchaseCreditMemoApprovalRequest(Rec);
                               END;
                                }
      { 1210190008;1 ;ActionGroup;
                      CaptionML=[DEU=F&unktion;
                                 ENU=F&unctions;
                                 NLD=F&uncties;
                                 NOR=Fu&nksjon;
                                 SVE=Fu&nktion] }
      { 1100525011;2 ;ActionGroup;
                      CaptionML=[DEU=Abrufen;
                                 ENU=Get;
                                 NLD=Ophalen;
                                 NOR=Hent;
                                 SVE=H„mta];
                      Image=Import }
      { 1210190009;3 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[DEU=Verteilungsschlssel &abrufen;
                                 ENU=Get Allo&cation;
                                 NLD=Verdeelsleutel op&halen;
                                 NOR=Hent Allo&kering;
                                 SVE=H„mta till&delning];
                      Image=Import;
                      OnAction=VAR
                                 GetAllocation@1210190000 : Codeunit 11012048;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 GetAllocation.PurchaseCrMemoApproval(Rec);
                               END;
                                }
      { 1210190010;3 ;Action    ;
                      ShortCutKey=Ctrl+F11;
                      Ellipsis=Yes;
                      CaptionML=[DEU=&Wareneingangszeilen abrufen;
                                 ENU=&Get Receipt Lines;
                                 NLD=O&ntvangstregels ophalen;
                                 NOR=&Hente Kvitteringsrader;
                                 SVE=H„mta inl&everans];
                      Image=GetLines;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 CurrPage.ApprovalLines.PAGE.GetReceipt;
                               END;
                                }
      { 1100485094;3 ;Action    ;
                      CaptionML=[DEU=&Mietposten Werkzeug abrufen;
                                 ENU=Get Plant Rent Entries;
                                 NLD=In&huurposten materieel ophalen;
                                 NOR=Hente Transaksjoner for maskinutleie;
                                 SVE=H„mta transaktioner f”r Maskinsuthyrning];
                      Image=GetLines;
                      OnAction=VAR
                                 GetPlantRentEntries@1100525000 : Report 11012589;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 TESTFIELD("No.");
                                 TESTFIELD("Buy-from Vendor No.");
                                 GetPlantRentEntries.SetSelections("No.", DATABASE::"Purch. Cr. Memo Hdr.", TRUE, FALSE);
                                 GetPlantRentEntries.RUNMODAL;
                               END;
                                }
      { 1100525002;2 ;Action    ;
                      CaptionML=[DEU=&Erstellen Rechnungszeilen fr Teilprojekte;
                                 ENU=Create Invoice Lines for Sub Projects;
                                 NLD=&Aanmaken factuurregels voor deelprojecten;
                                 NOR=Opprette Fakturarader for Underprosjekt;
                                 SVE=Skapa fakturarader f”r underprojekt];
                      Image=Split;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 DistrPurchLinesOverSubProjects(Rec);
                               END;
                                }
      { 1100525015;2 ;Action    ;
                      ShortCutKey=Shift+Ctrl+W;
                      CaptionML=[DEU=DMS Arbeitsvorgang starten;
                                 ENU=Start DMS Workflow;
                                 NLD=DMS workflow starten;
                                 NOR=Start DMS-Arbeidsflyt;
                                 SVE=Starta DMS-arbetsfl”de];
                      RunObject=Codeunit 11012216;
                      Image=StepInto }
      { 1210190004;2 ;Action    ;
                      CaptionML=[DEU=Abwickeln ohne DMS-Arbeitsvorgang;
                                 ENU=By-Pass DMS Workflow;
                                 NLD=Afhandelen zonder DMS-workflow;
                                 NOR=Forbig† DMS-arbeidsflyt;
                                 SVE=sidos„tt DMS-arbetsfl”de];
                      RunObject=Codeunit 11012213;
                      Image=StepOver }
      { 1100525009;1 ;ActionGroup;
                      CaptionML=[DEU=Fremdarbeit;
                                 ENU=Subcontracting;
                                 NLD=Onderaanneming;
                                 NOR=Underentrepen›r;
                                 SVE=Underentreprenad] }
      { 124     ;2   ;Action    ;
                      CaptionML=[DEU=&WKA-Daten;
                                 ENU=&WKA Data;
                                 NLD=&WKA gegevens;
                                 NOR=&WKA-data;
                                 SVE=&WKA-data];
                      RunObject=Page 11012060;
                      RunPageLink=Vendor No.=FIELD(Buy-from Vendor No.),
                                  Document No.=FIELD(No.);
                      Image=SubcontractingWorksheet;
                      PromotedCategory=Process }
      { 114     ;1   ;ActionGroup;
                      CaptionML=[DEU=Bu&chung;
                                 ENU=P&osting;
                                 NLD=B&oeken;
                                 NOR=B&okf›ring;
                                 SVE=B&okf”ring] }
      { 116     ;2   ;Action    ;
                      CaptionML=[DEU=&Testbericht mit šberprfungen;
                                 ENU=&Checklist;
                                 NLD=&Controlelijst met checks;
                                 NOR=&Kontrolliste;
                                 SVE=&Kontrollista];
                      RunObject=Report 11012065;
                      Image=CheckList }
      { 1210190002;2 ;Action    ;
                      ShortCutKey=F9;
                      CaptionML=[DEU=Buchen;
                                 ENU=Post;
                                 NLD=Boeken;
                                 NOR=Bokf›r;
                                 SVE=Bokf”r];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Post;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 IF NOT CONFIRM(Text000) THEN
                                   EXIT;

                                 CurrPage.ApprovalLines.PAGE.Post(FALSE,FALSE);  //print=false; batch=false
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1210190003;2 ;Action    ;
                      ShortCutKey=Shift+F9;
                      CaptionML=[DEU=Buchen und drucken;
                                 ENU=Post and Print;
                                 NLD=Boeken en afdrukken;
                                 NOR=Bokf›r og skriv ut;
                                 SVE=Bokf”r och skriv ut];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=PostPrint;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE); //**4PS.n

                                 IF NOT CONFIRM(Text001) THEN
                                   EXIT;

                                 CurrPage.ApprovalLines.PAGE.Post(TRUE,FALSE);  //print=true; batch=false
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 117     ;2   ;Action    ;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=[DEU=&Stapelbuchen;
                                 ENU=Post &Batch;
                                 NLD=B&atch-boeken;
                                 NOR=Bokf›r b&atch-jobb;
                                 SVE=Bokf”r b&atch-jobb];
                      Image=PostBatch;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 CurrPage.ApprovalLines.PAGE.Post(FALSE,TRUE);  //print=false; batch=true
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 118     ;2   ;Action    ;
                      ShortCutKey=Shift+F11;
                      CaptionML=[DEU=Stapelbuchen und &drucken;
                                 ENU=Batch Post and &Print;
                                 NLD=Batch boeken en af&drukken;
                                 NOR=Bokfor og &Skriv ut Batch;
                                 SVE=Batchbokf”r och &skriv ut];
                      Image=PostBatch;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 IF NOT CONFIRM(Text001) THEN
                                   EXIT;

                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 CurrPage.ApprovalLines.PAGE.Post(TRUE,TRUE);  //print=true; batch=true
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1100409001;1 ;ActionGroup;
                      CaptionML=[DEU=Belege e-mailen;
                                 ENU=Mail Documents;
                                 NLD=Documenten mailen;
                                 NOR=Send dokumenter;
                                 SVE=E-postdokument];
                      ActionContainerType=NewDocumentItems }
      { 1100409000;2 ;Action    ;
                      CaptionML=[DEU=Einkauf von Kreditor;
                                 ENU=Buy-from Vendor;
                                 NLD=Leverancier;
                                 NOR=Innkj›psleverand›r;
                                 SVE=Ink”psleverant”r];
                      Promoted=Yes;
                      Image=MailAttachment;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Contact@1100409002 : Record 5050;
                                 Vendor@1100409001 : Record 23;
                               BEGIN
                                 TESTFIELD("Buy-from Vendor No.");
                                 IF Contact.GetContactByVendor("Buy-from Vendor No.", Contact, TRUE) THEN BEGIN
                                   Vendor.GET("Buy-from Vendor No.");
                                   EditDocuments(Contact."No.", '', TRUE, Vendor."E-Mail");
                                 END;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                CaptionML=[DEU=Allgemein;
                           ENU=General;
                           NLD=Algemeen;
                           NOR=Generell;
                           SVE=Allm„nt] }

    { 2   ;2   ;Field     ;
                SourceExpr="No.";
                Editable=FALSE }

    { 6   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor No.";
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor Name";
                Editable=FALSE }

    { 10  ;2   ;Field     ;
                SourceExpr="Buy-from Address";
                Importance=Additional;
                Editable=FALSE }

    { 17  ;2   ;Field     ;
                SourceExpr="Buy-from Post Code";
                Importance=Additional;
                Editable=FALSE }

    { 12  ;2   ;Field     ;
                SourceExpr="Buy-from City";
                Importance=Additional;
                Editable=FALSE }

    { 13  ;2   ;Field     ;
                SourceExpr="Buy-from Contact";
                Editable=FALSE }

    { 1210190014;2;Field  ;
                SourceExpr="Pre-Assigned No.";
                Editable=FALSE }

    { 31  ;2   ;Field     ;
                SourceExpr="Vendor Cr. Memo No.";
                Editable=FALSE }

    { 1100485008;2;Field  ;
                SourceExpr="Ext. Document ID";
                Visible="Ext. Document IDVisible";
                Editable="Ext. Document IDEditable" }

    { 35  ;2   ;Field     ;
                SourceExpr="Subcontractor Credit Memo";
                Editable=FALSE }

    { 1100485002;2;Field  ;
                CaptionML=[DEU=WKA-Daten ausgefllt;
                           ENU=WKA Data present;
                           NLD=WKA gegevens ingevuld;
                           NOR=WKA-data tilstede;
                           SVE=WKA-data finns];
                SourceExpr=gWKAPresent;
                Editable=FALSE }

    { 1100485000;2;Field  ;
                SourceExpr="Amounts only" }

    { 1100525008;2;Field  ;
                SourceExpr="Open Approval Entry" }

    { 15  ;2   ;Field     ;
                SourceExpr="Posting Date";
                Editable=FALSE }

    { 19  ;2   ;Field     ;
                SourceExpr="Document Date";
                Editable=FALSE }

    { 1100528207;2;Field  ;
                SourceExpr="Approval Code" }

    { 1100528409;2;Field  ;
                CaptionML=[DEU=Genehmigung durch Benutzer;
                           ENU=Approval by User;
                           NLD=Goedkeuring door gebruiker;
                           SVE=Godk„nnande av anv„ndare];
                SourceExpr=ApprovalManagement4PSConstr.GetNextApprover(RECORDID,0);
                Editable=FALSE }

    { 1100528408;2;Field  ;
                CaptionML=[DEU=Genehmigung durch Benutzername;
                           ENU=Approval by User Name;
                           NLD=Goedkeuring door gebruikersnaam;
                           SVE=Godk„nnande av anv„ndarnamn];
                SourceExpr=ApprovalManagement4PSConstr.GetNextApproverName(RECORDID,0);
                Editable=FALSE }

    { 29  ;2   ;Field     ;
                SourceExpr="On Hold";
                Editable=OnHoldEditable;
                OnValidate=BEGIN
                             OnHoldOnAfterValidate;
                           END;
                            }

    { 27  ;2   ;Field     ;
                SourceExpr="Approvement Initials";
                Editable=FALSE }

    { 33  ;2   ;Field     ;
                SourceExpr="Remain On Hold";
                Editable="Remain On HoldEditable" }

    { 1210190000;2;Field  ;
                SourceExpr="Job No.";
                OnValidate=BEGIN
                             JobNoOnAfterValidate;
                           END;
                            }

    { 1210190019;2;Field  ;
                SourceExpr="Purchaser Code" }

    { 1100485009;2;Field  ;
                SourceExpr="Service Order No.";
                OnValidate=BEGIN
                             ServiceOrderNoOnAfterValidate;
                           END;
                            }

    { 1210190007;2;Field  ;
                SourceExpr="Related Purch. Order No.";
                OnValidate=BEGIN
                             RelatedPurchOrderNoOnAfterVali;
                           END;
                            }

    { 1100528406;2;Field  ;
                CaptionML=[DEU=Genehmigungszeilen offener Auftrag;
                           ENU=Open Order Consent Lines;
                           NLD=Open orderfiatteringsregels;
                           SVE=™ppna order godk„nnanderader];
                SourceExpr=RelatedOrderHasOpenConsentLines;
                Editable=FALSe }

    { 1100528402;2;Field  ;
                SourceExpr="Status (Approval)" }

    { 111 ;1   ;Part      ;
                Name=ApprovalLines;
                SubPageLink=Journal Template Name=FIELD(Journal Template),
                            Document Type=CONST(Credit Memo),
                            Document No.=FIELD(No.);
                PagePartID=Page11012067 }

    { 1905885101;1;Group  ;
                CaptionML=[DEU=Fakturierung;
                           ENU=Invoicing;
                           NLD=Facturering;
                           NOR=Fakturering;
                           SVE=Fakturering] }

    { 37  ;2   ;Field     ;
                SourceExpr="Pay-to Vendor No.";
                Importance=Promoted;
                Editable=FALSE }

    { 39  ;2   ;Field     ;
                SourceExpr="Pay-to Name";
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                SourceExpr="Pay-to Address";
                Editable=FALSE }

    { 43  ;2   ;Field     ;
                SourceExpr="Pay-to Address 2";
                Editable=FALSE }

    { 60  ;2   ;Field     ;
                SourceExpr="Pay-to Post Code";
                Editable=FALSE }

    { 45  ;2   ;Field     ;
                SourceExpr="Pay-to City";
                Editable=FALSE }

    { 46  ;2   ;Field     ;
                SourceExpr="Pay-to Contact";
                Editable=FALSE }

    { 66  ;2   ;Field     ;
                SourceExpr="Your Reference";
                Editable=FALSE }

    { 1100525006;2;Field  ;
                SourceExpr="Journal Template";
                OnValidate=BEGIN
                             JournalTemplateOnAfterValidate;
                           END;
                            }

    { 56  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 1 Code";
                Editable=FALSE;
                OnValidate=BEGIN
                             //**4PS Generated Code. Do Not Change.sn03
                             DPA_ChkDepartmentCodeAllowed(DPA_IsHardFilter);
                             //**4PS Generated Code.en03
                           END;
                            }

    { 58  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 2 Code";
                Editable=FALSE }

    { 48  ;2   ;Field     ;
                SourceExpr="Payment Terms Code";
                Importance=Promoted;
                Editable=FALSE }

    { 50  ;2   ;Field     ;
                SourceExpr="Due Date";
                Editable=FALSE }

    { 52  ;2   ;Field     ;
                SourceExpr="Payment Discount %";
                Editable=FALSE }

    { 54  ;2   ;Field     ;
                SourceExpr="Pmt. Discount Date";
                Editable=FALSE }

    { 1100525004;2;Field  ;
                SourceExpr="Reason Code";
                Editable=FALSE }

    { 1906801201;1;Group  ;
                CaptionML=[DEU=Lieferung;
                           ENU=Shipping;
                           NLD=Ontvangst;
                           NOR=Levering;
                           SVE=Leverans] }

    { 68  ;2   ;Field     ;
                SourceExpr="Ship-to Name";
                Editable=FALSE }

    { 70  ;2   ;Field     ;
                SourceExpr="Ship-to Address";
                Editable=FALSE }

    { 72  ;2   ;Field     ;
                SourceExpr="Ship-to Address 2";
                Editable=FALSE }

    { 83  ;2   ;Field     ;
                SourceExpr="Ship-to Post Code";
                Editable=FALSE }

    { 74  ;2   ;Field     ;
                SourceExpr="Ship-to City";
                Editable=FALSE }

    { 75  ;2   ;Field     ;
                SourceExpr="Ship-to Contact";
                Editable=FALSE }

    { 81  ;2   ;Field     ;
                SourceExpr="Location Code";
                Importance=Promoted;
                Editable=FALSE }

    { 77  ;2   ;Field     ;
                SourceExpr="Shipment Method Code";
                Editable=FALSE }

    { 79  ;2   ;Field     ;
                SourceExpr="Expected Receipt Date";
                Editable=FALSE }

    { 1907468901;1;Group  ;
                CaptionML=[DEU=Auáenhandel;
                           ENU=Foreign Trade;
                           NLD=Buitenlandse handel;
                           NOR=Utenlandsk Handel;
                           SVE=Utlandshandel] }

    { 85  ;2   ;Field     ;
                SourceExpr="Currency Code";
                OnAssistEdit=BEGIN
                               ChangeExchangeRate.SetParameter("Currency Code","Currency Factor","Posting Date");
                               ChangeExchangeRate.SetAdditionalParameters(1, "Job No.", FALSE); //**4PS.n
                               ChangeExchangeRate.EDITABLE(FALSE);
                               IF ChangeExchangeRate.RUNMODAL = ACTION::OK THEN BEGIN
                                 "Currency Factor" := ChangeExchangeRate.GetParameter;
                                 MODIFY;
                               END;
                               CLEAR(ChangeExchangeRate);
                             END;
                              }

    { 1905403901;1;Group  ;
                CaptionML=[DEU=Fremdarbeit;
                           ENU=Subcontracting;
                           NLD=Onderaanneming;
                           NOR=Underentrepen›r;
                           SVE=Underentreprenad] }

    { 87  ;2   ;Field     ;
                SourceExpr="Payment Agreement";
                Editable=FALSE }

    { 89  ;2   ;Field     ;
                SourceExpr="Actual Effective Date";
                Editable=FALSE }

    { 91  ;2   ;Field     ;
                SourceExpr="Actual End Date";
                Editable=FALSE }

    { 93  ;2   ;Field     ;
                SourceExpr="Number of Hours";
                Editable=FALSE }

    { 95  ;2   ;Field     ;
                SourceExpr="Avg. Wage Rate";
                Editable=FALSE }

    { 97  ;2   ;Field     ;
                SourceExpr="Labor Amount";
                Editable=FALSE }

    { 99  ;2   ;Field     ;
                SourceExpr="Contribution Percentage Labor";
                Editable=FALSE }

    { 1210190005;2;Field  ;
                SourceExpr="Contribution Percentage Total";
                Editable=FALSE }

    { 1100528200;2;Field  ;
                SourceExpr="Fixed B Amount per Hour";
                Editable=FALSE }

    { 109 ;2   ;Field     ;
                SourceExpr="Pay To Tax Authority";
                Visible=FALSE;
                Editable=FALSE }

    { 101 ;2   ;Field     ;
                SourceExpr="Wage Charge (to B Account)";
                Editable=FALSE }

    { 103 ;2   ;Field     ;
                SourceExpr="Wage Charge (to Tax Authority)";
                Visible=FALSE;
                Editable=FALSE }

    { 1100529601;2;Field  ;
                SourceExpr="Pay VAT Amt. on B-Acc. Vendor";
                Editable=FALSE }

    { 107 ;2   ;Field     ;
                SourceExpr=Text;
                Editable=FALSE;
                MultiLine=Yes }

    { 1903447101;1;Group  ;
                CaptionML=[DEU=DMS;
                           ENU=DMS;
                           NLD=DMS;
                           NOR=DMS;
                           SVE=DMS] }

    { 1100525010;2;Field  ;
                SourceExpr="DMS Status";
                Importance=Promoted }

    { 1100525012;2;Field  ;
                SourceExpr="DMS Status Text" }

    { 1210190001;0;Container;
                ContainerType=FactBoxArea }

    { 1100528205;1;Part   ;
                Name=CaptureUI;
                CaptionML=[DEU=DC-Beleg;
                           ENU=DC Document;
                           NLD=DC Document];
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page11126597;
                Visible=FALSE }

    { 1100529900;1;Part   ;
                Name=RegisterExternalDocumentFB;
                PagePartID=Page11125053;
                PartType=Page }

    { 1100525003;1;Part   ;
                SubPageLink=No.=FIELD(Buy-from Vendor No.);
                PagePartID=Page9093;
                Visible=FALSE;
                PartType=Page }

    { 1100525000;1;Part   ;
                SubPageLink=No.=FIELD(Pay-to Vendor No.);
                PagePartID=Page9094;
                Visible=TRUE;
                PartType=Page }

    { 1210190006;1;Part   ;
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page11130313;
                PartType=Page }

    { 1100525007;1;Part   ;
                SubPageLink=Journal Template Name=FIELD(Journal Template Name),
                            Document Type=CONST(Credit Memo),
                            Document No.=FIELD(Document No.),
                            Line No.=FIELD(Line No.);
                PagePartID=Page11130117;
                ProviderID=111;
                PartType=Page }

    { 1100528412;1;Part   ;
                SubPageLink=Table ID=CONST(124),
                            Document No.=FIELD(No.);
                PagePartID=Page9103;
                Visible=OpenApprovalEntriesExistForCurrUser;
                PartType=Page }

    { 1100528411;1;Part   ;
                SubPageLink=Table ID=CONST(124),
                            Document No.=FIELD(No.);
                PagePartID=Page9092;
                Visible=FALSE;
                PartType=Page }

    { 1100528410;1;Part   ;
                Name=WorkflowStatus;
                PagePartID=Page1528;
                Visible=ShowWorkflowStatus;
                Enabled=FALSE;
                Editable=FALSE;
                PartType=Page;
                ShowFilter=No }

    { 1100525005;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 1100525001;1;Part   ;
                PartType=System;
                SystemPartID=Notes }

    { 1100528500;1;Part   ;
                SubPageLink=Document No.=FIELD(No.);
                PagePartID=Page9104;
                Visible=FALSE;
                PartType=Page }

    { 1100528101;1;Part   ;
                Name=DocumentViewerDocument;
                CaptionML=[DEU=Document Viewer Belege;
                           ENU=Document Viewer Documents;
                           NLD=Document Viewer documenten];
                PagePartID=Page11129746;
                Visible=FALSE;
                PartType=Page }

    { 1100528100;1;Part   ;
                Name=DocumentViewer;
                CaptionML=[DEU=Document Viewer;
                           ENU=Document Viewer;
                           NLD=Document Viewer];
                SubPageLink=Source Type=FIELD(Source Type),
                            No.=FIELD(No.),
                            Description=FIELD(Description);
                PagePartID=Page11129745;
                ProviderID=1100528101;
                Visible=FALSE;
                PartType=Page }

  }
  CODE
  {
    VAR
      Text000@11012004 : TextConst 'DEU=Gutschriftgenehmigungen buchen?;ENU=Post Credit Memo Approvals ?;NLD=Creditnota goedkeuringen boeken ?;NOR=Vil du bokf›re godkjenninger av kreditnotaer?;SVE=Vill du bokf”ra godk„nnanden av kreditnotor?';
      Text001@11012005 : TextConst 'DEU=Gutschriftgenehmigungen buchen und drucken?;ENU=Post and Print Credit Memo Approvals ?;NLD=Creditnota goedkeuringen boeken en printen ?;NOR=Vil du bokf›re og skrive ut godkjenning av kreditnotaer?;SVE=Vill du bokf”ra och skriva ut godk„nnande av kreditnotor?';
      PurchSetup@1100485001 : Record 312;
      ChangeExchangeRate@11012001 : Page 511;
      gFromReference@1210190001 : Boolean;
      gApprLineNo@1210190000 : Integer;
      gWKAPresent@1100485000 : Boolean;
      RemainOnHoldEditable@1100525000 : Boolean;
      DPA_IsHardFilter@1100000999 : Boolean;
      ApprJnlTemplate@1100529000 : Code[10];
      DropZoneContainerVisible@19006404 : Boolean INDATASET;
      "Ext. Document IDVisible"@19068947 : Boolean INDATASET;
      "Remain On HoldEditable"@19040163 : Boolean INDATASET;
      "Ext. Document IDEditable"@19001168 : Boolean INDATASET;
      OnHoldEditable@1100525001 : Boolean INDATASET;
      OpenApprovalEntriesExist@1100528403 : Boolean;
      OpenApprovalEntriesExistForCurrUser@1100528402 : Boolean;
      ApprovalManagement4PSConstr@1100528401 : Codeunit 11125349;
      ShowWorkflowStatus@1100528400 : Boolean;
      CanCancelApprovalForRecord@1100527300 : Boolean;

    PROCEDURE SetFilter@1(JournTempl@11012000 : Code[10]);
    BEGIN
    END;

    PROCEDURE InitSelectionFromReference@1210190002(IApprLineNo@1210190000 : Integer);
    BEGIN
      gFromReference := TRUE;
      gApprLineNo := IApprLineNo;
    END;

    PROCEDURE ShowICFInvoiceLines@1210190000();
    VAR
      ICFLineRec@1210190000 : Record 11012327;
    BEGIN
      ICFLineRec.RESET;
      ICFLineRec.SETRANGE(Vendor, "Pay-to Vendor No.");
      ICFLineRec.SETRANGE("Invoice No.", "Pre-Assigned No.");
      IF ICFLineRec.FIND('-') THEN
        PAGE.RUNMODAL(PAGE::"ICF Invoices", ICFLineRec);
    END;

    PROCEDURE DistrPurchLinesOverSubProjects@1100485003(PurchCrMemoHeader@1100485000 : Record 124);
    VAR
      InvApprovalLine@1100485004 : Record 11012032;
      MaxLine@1100485002 : Integer;
      Job@1100485003 : Record 11072003;
    BEGIN
      IF "DMS Status" > "DMS Status"::"Awaiting Line Entry" THEN
        FIELDERROR("DMS Status");

      PurchCrMemoHeader.TESTFIELD("Amounts only", TRUE);
      MaxLine := 0;

      InvApprovalLine.SETRANGE("Journal Template Name", PurchCrMemoHeader."Journal Template");
      InvApprovalLine.SETRANGE("Document Type", InvApprovalLine."Document Type"::"Credit Memo");
      InvApprovalLine.SETRANGE("Document No.", PurchCrMemoHeader."No.");
      IF InvApprovalLine.FINDLAST THEN
        MaxLine := InvApprovalLine."Line No.";
      InvApprovalLine.SETRANGE("Receiving Company", '');
      InvApprovalLine.SETFILTER("Project No.", '<>%1', '');
      IF InvApprovalLine.FINDSET(TRUE, FALSE) THEN
        REPEAT
          Job.GET(InvApprovalLine."Project No.");
          IF (Job."Single/Main/Sub Project" = Job."Single/Main/Sub Project"::"Main Project") THEN
            IF GenerateInvApprovalLines(
              PurchCrMemoHeader, Job."No.", InvApprovalLine."Shortcut Dimension 2 Code", MaxLine,
              InvApprovalLine.Amount)
            THEN
              InvApprovalLine.DELETE(TRUE);
        UNTIL InvApprovalLine.NEXT = 0;
    END;

    LOCAL PROCEDURE GenerateInvApprovalLines@1100498000(PurchCrMemoHeader@1100525000 : Record 124;JobNo@1100485003 : Code[20];ShortCutDimension2@1100485004 : Code[20];VAR PurchaseLineNo@1100485005 : Integer;LineAmount@1100485006 : Decimal) : Boolean;
    VAR
      InvApprovalLine@1100498001 : Record 11012032;
      BudgetLine@1100498002 : Record 11012001;
      Job@1100498003 : Record 11072003;
      TotalAmount@1100485000 : Decimal;
    BEGIN
      TotalAmount := 0;

      Job.RESET;
      Job.SETCURRENTKEY("Main Project");
      Job.SETRANGE("Main Project", JobNo);
      Job.SETRANGE("Single/Main/Sub Project", Job."Single/Main/Sub Project"::"Sub Project");
      Job.SETFILTER("Project Status", '<%1', Job."Project Status"::"Administrative Finished");
      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",ShortCutDimension2);
          BudgetLine.CALCSUMS("Amount (LCY)");
          TotalAmount := TotalAmount + BudgetLine."Amount (LCY)";
        UNTIL Job.NEXT = 0;
      IF TotalAmount = 0 THEN
        EXIT(FALSE);

      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",ShortCutDimension2);
          BudgetLine.CALCSUMS("Amount (LCY)");

          PurchaseLineNo := PurchaseLineNo + 10000;
          InvApprovalLine.INIT;
          InvApprovalLine."Journal Template Name" := PurchCrMemoHeader."Journal Template";
          InvApprovalLine.VALIDATE("Document Type", InvApprovalLine."Document Type"::"Credit Memo");
          InvApprovalLine.VALIDATE("Document No.",PurchCrMemoHeader."No.");
          InvApprovalLine.VALIDATE("Line No." ,PurchaseLineNo);
          InvApprovalLine.Description := Job.Description;
          InvApprovalLine.INSERT(TRUE);
          InvApprovalLine.VALIDATE("Project No.", Job."No.");
          InvApprovalLine.VALIDATE("Shortcut Dimension 2 Code", ShortCutDimension2);
          InvApprovalLine.VALIDATE("Buy-from Vendor No.", PurchCrMemoHeader."Buy-from Vendor No.");
          InvApprovalLine.VALIDATE(Amount,LineAmount * (BudgetLine."Amount (LCY)" / TotalAmount));
          InvApprovalLine.MODIFY(TRUE);
        UNTIL Job.NEXT = 0;

      EXIT(TRUE);
    END;

    PROCEDURE UpdateControls@1210190001();
    BEGIN
      RemainOnHoldEditable := (RemainOnHoldEditable AND ("On Hold" <> ''));
      CurrPage.EDITABLE(
        ("DMS Status" < "DMS Status"::"Start Workflow") OR
        ("DMS Status" = "DMS Status"::Rejected) OR
        ("DMS Status" = "DMS Status"::Approved));
    END;

    PROCEDURE SetJournalTemplate@1100529000(JnlTemplate@1100529000 : Code[10]);
    BEGIN
      ApprJnlTemplate := JnlTemplate;
    END;

    LOCAL PROCEDURE OnHoldOnAfterValidate@19064521();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE JobNoOnAfterValidate@19070084();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE RelatedPurchOrderNoOnAfterVali@19002847();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE ServiceOrderNoOnAfterValidate@19042308();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE JournalTemplateOnAfterValidate@19059050();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE SetControlAppearance@5();
    VAR
      ApprovalsMgmt@1000 : Codeunit 1535;
    BEGIN
      OpenApprovalEntriesExist := ApprovalsMgmt.HasOpenApprovalEntries(RECORDID);
      OpenApprovalEntriesExistForCurrUser := ApprovalsMgmt.HasOpenApprovalEntriesForCurrentUser(RECORDID);
      CanCancelApprovalForRecord := ApprovalsMgmt.CanCancelApprovalForRecord(RECORDID);
    END;

    LOCAL PROCEDURE FillDocumentViewerFactbox@1100528100();
    VAR
      DocumentLinkManagement@1100528100 : Codeunit 11012401;
      DocumentProperties@1100528101 : Record 11012746;
      DocumentAttachmentMgt@1100528102 : Codeunit 6085602;
      TempDocument@1100528103 : Record 6085756;
      EmptyRecID@1100528104 : RecordID;
      DocumentViewerTempDoc@1100528105 : Record 11072460;
    BEGIN
      CurrPage.DocumentViewerDocument.PAGE.ResetPage;
      DocumentLinkManagement.GetDocuments(DocumentProperties, RECORDID.GETRECORD);
      DocumentProperties.MARKEDONLY(TRUE);
      CurrPage.DocumentViewerDocument.PAGE.SetExternal4PSDocuments(DocumentProperties);

      CASE PurchSetup."Scanning Application Purch.Inv" OF
        PurchSetup."Scanning Application Purch.Inv"::"Document Capture":
          BEGIN
            DocumentAttachmentMgt.CreateTempDocumentList(TempDocument, EmptyRecID, DATABASE::"Purch. Cr. Memo Hdr.", 0, "No.", 0, TRUE);
            CurrPage.DocumentViewerDocument.PAGE.SetDocumentCaptureDocuments(TempDocument);
            IF "Ext. Document ID" <> '' THEN BEGIN
              CurrPage.DocumentViewerDocument.PAGE.SetSelectedDocument(DocumentViewerTempDoc."Source Type"::DocumentCapture, "Ext. Document ID");
            END ELSE
              CurrPage.DocumentViewerDocument.PAGE.SetSelectedDocument(DocumentViewerTempDoc."Source Type"::DocumentCapture, '');
          END;
        PurchSetup."Scanning Application Purch.Inv"::Whitevision:
          BEGIN
            CurrPage.DocumentViewerDocument.PAGE.SetWhiteVisionDocumentUsingPurchCrMemoHdr(Rec);
            CurrPage.DocumentViewerDocument.PAGE.SetSelectedDocument(DocumentViewerTempDoc."Source Type"::WhiteVision, '');
          END;
      END;

      CurrPage.DocumentViewer.PAGE.SetEmailSubject("No.");
    END;

    BEGIN
    {
      4PS MVOS 20100810: Check permission Journal Template before posting.
    }
    END.
  }
}

