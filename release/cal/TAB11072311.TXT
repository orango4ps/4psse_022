OBJECT Table 11072311 SC Control by Period
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               "Last Updated at" := CURRENTDATETIME;
               DetermineValues;
             END;

    OnDelete=VAR
               ServiceContractCtrlBudget@1100528602 : Record 11071759;
               SCControlbyPeriodDetail@1100529900 : Record 11072552;
               ServiceOrder@1100529601 : Record 11012823;
             BEGIN
               CASE "Line Type" OF
                 "Line Type"::Period:
                   BEGIN
                     ServiceContractCtrlBudget.SETCURRENTKEY("Service Control Method");
                     ServiceContractCtrlBudget.SETRANGE("Service Control Method", ServiceContractCtrlBudget."Service Control Method"::"Real-Time");
                     ServiceContractCtrlBudget.SETRANGE("Service Contract No.", "Service Contract No.");
                     ServiceContractCtrlBudget.DELETEALL(TRUE);
                   END;
                 "Line Type"::"Service Order":
                   BEGIN
                     ServiceOrder.SETRANGE("Base Service Order No.", "Service Order No.");
                     IF ServiceOrder.ISEMPTY THEN
                       DeleteServOrderRelatedTables("Service Order No.")
                     ELSE BEGIN
                       ServiceOrder.FINDSET;
                       REPEAT
                         DeleteServOrderRelatedTables(ServiceOrder."No.");
                       UNTIL ServiceOrder.NEXT = 0;
                     END;
                   END;
               END;
               SCControlbyPeriodDetail.SETRANGE("Entry No.", "Entry No.");
               SCControlbyPeriodDetail.DELETEALL(TRUE);
             END;

    CaptionML=[ENU=Service Contract Control by Period;
               SVE=Serviceplatskontroll];
  }
  FIELDS
  {
    { 10  ;   ;Entry No.           ;Integer       ;CaptionML=[ENU=Entry No.;
                                                              NOR=Lõpenr.;
                                                              SVE=Lîpnr];
                                                   NotBlank=Yes }
    { 20  ;   ;Service Contract No.;Code20        ;TableRelation=Service-Contract;
                                                   OnValidate=VAR
                                                                ServiceContract@1100528600 : Record 11012812;
                                                              BEGIN
                                                                IF "Service Contract No." <> '' THEN
                                                                  IF ServiceContract.GET("Service Contract No.") THEN BEGIN
                                                                    VALIDATE("Contract Manager", ServiceContract."Contract Manager");
                                                                    VALIDATE("Customer No.", ServiceContract."Customer No.");
                                                                    VALIDATE("Contract Group", ServiceContract."Contract Group");
                                                                    "Global Dimension 1 Code" := ServiceContract."Global Dimension 1 Code";
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Service Contract No.;
                                                              NOR=Servicekontraktnr;
                                                              SVE=Servicekontraktnr];
                                                   Editable=No }
    { 25  ;   ;Service Contract Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Contract.Description WHERE (No.=FIELD(Service Contract No.)));
                                                   CaptionML=[ENU=Service Contract Description;
                                                              NOR=Servicekontraktsbeskrivelse;
                                                              SVE=Servicekontraktsbeskrivning] }
    { 30  ;   ;Control Period Code ;Code10        ;TableRelation=IF (Service Contract No.=FILTER(<>'')) "Service-Contract Ctrl. Period".Code WHERE (Service Contract No.=FIELD(Service Contract No.))
                                                                 ELSE IF (Service Contract No.=CONST('')) "Service Control Period".Code;
                                                   OnValidate=VAR
                                                                ServiceControlPeriod@1100528601 : Record 11071755;
                                                                ServiceContractCtrlPeriod@1100528600 : Record 11071746;
                                                              BEGIN
                                                                IF "Service Contract No." = '' THEN BEGIN
                                                                  IF ServiceControlPeriod.GET("Control Period Code") THEN BEGIN
                                                                    "Starting Date" := ServiceControlPeriod."Starting Date";
                                                                    "Ending Date" := ServiceControlPeriod."Ending Date";
                                                                    "Closed Period" := ServiceControlPeriod."Date Finished" <> 0D;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  IF ServiceContractCtrlPeriod.GET("Service Contract No.", "Control Period Code") THEN BEGIN
                                                                    "Starting Date" := ServiceContractCtrlPeriod."Starting Date";
                                                                    "Ending Date" := ServiceContractCtrlPeriod."Ending Date";
                                                                    "Closed Period" := ServiceContractCtrlPeriod."Date Finished" <> 0D;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Control Period Code;
                                                              NOR=Kontrollperiodekode;
                                                              SVE=Kontrollperiodskod];
                                                   Editable=No }
    { 40  ;   ;Starting Date       ;Date          ;CaptionML=[ENU=Starting Date;
                                                              NOR=Startdato;
                                                              SVE=Startdatum];
                                                   Editable=No }
    { 50  ;   ;Ending Date         ;Date          ;CaptionML=[ENU=Ending Date;
                                                              NOR=Sluttdato;
                                                              SVE=Slutdatum];
                                                   Editable=No }
    { 60  ;   ;Service Category    ;Code10        ;OnValidate=VAR
                                                                ServiceCategory@1100529600 : Record 11071985;
                                                              BEGIN
                                                                IF "Service Category" <> '' THEN BEGIN
                                                                  ServiceCategory.GET("Service Contract No.", "Service Category");
                                                                  "Exclude SOs From Est. Result" := ServiceCategory."Exclude SOs From Est. Result";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Service Category;
                                                              SVE=Servicekategori] }
    { 70  ;   ;Source Type         ;Option        ;CaptionML=[ENU=Source Type;
                                                              NOR=Kildetype;
                                                              SVE=Ursprungstyp];
                                                   OptionCaptionML=[ENU=Call,Contract,Direct,Estimate,,,Modification,Replacement;
                                                                    NOR=Samtale,Kontrakt,Direkte,Kalkyle,,,Endring,Erstatning;
                                                                    SVE=Samtal,Kontrakt,Direkt,Kalkyl,,,éndring,ErsÑttning];
                                                   OptionString=Call,Contract,Direct,Estimate,,,Modification,Replacement;
                                                   Editable=No }
    { 80  ;   ;Service Order No.   ;Code20        ;TableRelation="Service Order";
                                                   OnValidate=VAR
                                                                ServiceOrder@1100528600 : Record 11012823;
                                                              BEGIN
                                                                IF "Service Contract No." = '' THEN
                                                                  IF ServiceOrder.GET("Service Order No.") THEN BEGIN
                                                                    VALIDATE("Customer No.", ServiceOrder."Customer No.");
                                                                    "Global Dimension 1 Code" := ServiceOrder."Global Dimension 1 Code";
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr.;
                                                              SVE=Serviceordernr];
                                                   Editable=No }
    { 90  ;   ;Line Type           ;Option        ;CaptionML=[ENU=Line Type;
                                                              NOR=Radtype;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=ENU=,Period,Service Category,Source Type,Service Order;
                                                   OptionString=,Period,Service Category,Source Type,Service Order }
    { 100 ;   ;Indentation         ;Integer       ;CaptionML=ENU=Ident Value;
                                                   Editable=No }
    { 110 ;   ;Total Budget Revenue;Decimal       ;CaptionML=ENU=Total Budget Revenue;
                                                   Editable=No }
    { 120 ;   ;Paid Amount         ;Decimal       ;CaptionML=ENU=Paid Amount;
                                                   Editable=No }
    { 130 ;   ;Closed Revenue      ;Decimal       ;CaptionML=ENU=Closed Revenue;
                                                   Editable=No }
    { 140 ;   ;Contract Financing Balance;Decimal ;CaptionML=ENU=Contract Financing Balance;
                                                   Editable=No }
    { 170 ;   ;Revenue Amount      ;Decimal       ;CaptionML=ENU=Revenue Amount;
                                                   Editable=No }
    { 180 ;   ;SO Description      ;Text50        ;CaptionML=[ENU=Service Order Description;
                                                              NOR=Serviceordre Beskrivelse;
                                                              SVE=Serviceorder beskrivning];
                                                   Editable=No }
    { 190 ;   ;SO Status           ;Option        ;CaptionML=[ENU=Service Order Status;
                                                              NOR=Serviceordrestatus;
                                                              SVE=Serviceorderstatus];
                                                   OptionCaptionML=[ENU=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                                    NOR=èpne,,Under behandling,Teknisk ferdig,Administrativt ferdig,Ferdig,Avbrutt;
                                                                    SVE=ôppna,,Under behandling,Tekniskt fÑrdig,Administrativt fÑrdig,FÑrdig,Avbrutet];
                                                   OptionString=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                   Editable=No }
    { 200 ;   ;Actual Cost         ;Decimal       ;CaptionML=[ENU=Actual Cost;
                                                              NOR=Faktisk kost;
                                                              SVE=Faktisk kostnad];
                                                   Editable=No }
    { 220 ;   ;Open (Purchase)     ;Decimal       ;CaptionML=[ENU=Open (Purchase);
                                                              NOR=èpne innkjõp;
                                                              SVE=ôppna inkîp];
                                                   Editable=No }
    { 230 ;   ;Total Cost          ;Decimal       ;OnValidate=BEGIN
                                                                Available := "Budget Cost" - "Total Cost";
                                                              END;

                                                   CaptionML=[ENU=Total Cost;
                                                              NOR=Total kost;
                                                              SVE=Totalkostnad];
                                                   Editable=No }
    { 240 ;   ;Result              ;Decimal       ;CaptionML=[ENU=Result;
                                                              NOR=Resultat;
                                                              SVE=Resultat];
                                                   Editable=No }
    { 250 ;   ;Budget Cost         ;Decimal       ;OnValidate=BEGIN
                                                                Available := "Budget Cost" - "Total Cost";
                                                                "Budget Costs Incl. Deviation" := "Budget Cost" + "Deviation From Budget";
                                                                IF NOT "Exclude SOs From Est. Result" THEN
                                                                  "Precalc. Res. Incl. Deviation" := "Total Budget Revenue" - "Budget Cost" - "Deviation From Budget";
                                                              END;

                                                   CaptionML=[ENU=Budget Cost;
                                                              NOR=Budsjett Kostnad;
                                                              SVE=Budgeterad kostnad];
                                                   Editable=No }
    { 260 ;   ;Budget Cost (Original);Decimal     ;CaptionML=ENU=Budget Cost (Original);
                                                   Editable=No }
    { 300 ;   ;Contract Manager    ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=Contract Manager;
                                                              NOR=Kontraktleder;
                                                              SVE=Kontrakthanterare];
                                                   Editable=No }
    { 305 ;   ;Contract Manager Name;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Contract Manager)));
                                                   CaptionML=[ENU=Contract Manager Name;
                                                              NOR=Kontraktleders navn;
                                                              SVE=Kontraktschefsnamn];
                                                   Editable=No }
    { 310 ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   CaptionML=[ENU=Customer No.;
                                                              NOR=Kundenr;
                                                              SVE=Kundnr];
                                                   Editable=No }
    { 315 ;   ;Customer Name       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Customer No.)));
                                                   CaptionML=[ENU=Customer Name;
                                                              NOR=Kundnavn;
                                                              SVE=Kundnamn];
                                                   Editable=No }
    { 320 ;   ;Contract Group      ;Code20        ;TableRelation="Service Contract Group";
                                                   CaptionML=[ENU=Contract Group;
                                                              NOR=Kontraktgruppe;
                                                              SVE=Kontraktsgrupp];
                                                   Editable=No }
    { 325 ;   ;Contract Group Description;Text50  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Contract Group".Description WHERE (Code=FIELD(Contract Group)));
                                                   CaptionML=[ENU=Contract Group Description;
                                                              NOR=Beskrivelse av Kontraktgruppe;
                                                              SVE=Kontraktgruppsbeskrivning];
                                                   Editable=No }
    { 330 ;   ;Open Ovh. Surch. Soft (Purch.);Decimal;
                                                   CaptionML=[ENU=Open Ovh. Surch. Soft Commitments (Purchase);
                                                              NOR=èpen overheadkost, lõpende engasjementer (Innkjõp);
                                                              SVE=ôppen overheadkostnad, lîpande Ütaganden (inkîp)];
                                                   Editable=No }
    { 340 ;   ;Received/Not Invoiced;Decimal      ;CaptionML=[ENU=Received/Not Invoiced;
                                                              NOR=Mottatt/ikke fakturert;
                                                              SVE=Mottaget/inte fakturerat];
                                                   Editable=No }
    { 350 ;   ;Open Ovh. Surch. Firm (Purch.);Decimal;
                                                   CaptionML=[ENU=Open Ovh. Surch. Firm Commitments (Purchase);
                                                              NOR=èpen overheadkost, faste Forpliktelser (Innkjõp);
                                                              SVE=ôppen overheadkostnad, fasta Ütaganden (inkîp)];
                                                   Editable=No }
    { 360 ;   ;Open (Inventory)    ;Decimal       ;CaptionML=[ENU=Open (Inventory);
                                                              NOR=èpne (lager);
                                                              SVE=ôppna (lager)];
                                                   Editable=No }
    { 370 ;   ;Open Ovh. Surch. (Inventory);Decimal;
                                                   CaptionML=[ENU=Open Ovh. Surch. (Inventory);
                                                              NOR=èpen overheadkost (lager);
                                                              SVE=ôppen overheadkostnad (lager)];
                                                   Editable=No }
    { 380 ;   ;Open Amount (Hours) ;Decimal       ;CaptionML=[ENU=Open Amount (Hours);
                                                              NOR=èpne belõp (Timer);
                                                              SVE=ôppna belopp (timmar)];
                                                   Editable=No }
    { 390 ;   ;Open Ovh. Surch. (Hours);Decimal   ;CaptionML=[ENU=Open Ovh. Surch. (Hours);
                                                              NOR=èpen tilleggsgebyr for overhead (Timer);
                                                              SVE=ôppen overheadkostnad (timmar)];
                                                   Editable=No }
    { 400 ;   ;Total Cost (Additional);Decimal    ;CaptionML=ENU=Total Cost (Additional);
                                                   Editable=No }
    { 410 ;   ;Available           ;Decimal       ;CaptionML=[ENU=Available;
                                                              NOR=Disponibelt;
                                                              SVE=Disponibelt];
                                                   Editable=No }
    { 420 ;   ;Budget Hours        ;Decimal       ;CaptionML=[ENU=Budget Hours;
                                                              NOR=Budsjett (Timer);
                                                              SVE=Budget (timmar)];
                                                   Editable=No }
    { 430 ;   ;Actual Hours        ;Decimal       ;CaptionML=[ENU=Actual Hours;
                                                              NOR=Reelle timer;
                                                              SVE=Verkliga timmar];
                                                   Editable=No }
    { 440 ;   ;Open Hours          ;Decimal       ;CaptionML=[ENU=Open Hours;
                                                              NOR=èpne timer;
                                                              SVE=ôppna timmar];
                                                   Editable=No }
    { 450 ;   ;Total Hours         ;Decimal       ;CaptionML=[ENU=Total Hours;
                                                              NOR=Timer totalt;
                                                              SVE=Timmar totalt];
                                                   Editable=No }
    { 460 ;   ;Total Hours (Additional);Decimal   ;CaptionML=ENU=Total Hours (Additional);
                                                   Editable=No }
    { 470 ;   ;Allowed Hours       ;Decimal       ;CaptionML=[ENU=Allowed Hours;
                                                              NOR=Tillatte timer;
                                                              SVE=TillÜtna timmar];
                                                   Editable=No }
    { 480 ;   ;Result Hours        ;Decimal       ;CaptionML=[ENU=Result Hours;
                                                              NOR=Resultattimer;
                                                              SVE=Resultattimmar];
                                                   Editable=No }
    { 490 ;   ;Budget Revenue (Contract);Decimal  ;CaptionML=ENU=Budget Revenue (Contract);
                                                   Editable=No }
    { 500 ;   ;Budget Revenue (Order);Decimal     ;CaptionML=ENU=Budget Revenue (Order);
                                                   Editable=No }
    { 510 ;   ;Revenue Amount (Additional);Decimal;CaptionML=ENU=Revenue Amount (Additional);
                                                   Editable=No }
    { 520 ;   ;Allowed Cost        ;Decimal       ;CaptionML=[ENU=Allowed Cost;
                                                              SVE=TillÜten];
                                                   Editable=No }
    { 530 ;   ;Prognosis Total Cost;Decimal       ;CaptionML=[ENU=Prognosis Total Cost;
                                                              NOR=Prognose for totale kostnader;
                                                              SVE=Prognos totala kostnader];
                                                   Editable=No }
    { 540 ;   ;Prognosis Total Revenue;Decimal    ;CaptionML=[ENU=Prognosis Total Revenue;
                                                              NOR=Prognose totalresultat;
                                                              SVE=Prognos totala intÑkter];
                                                   Editable=No }
    { 550 ;   ;Prognosis Financial Result;Decimal ;CaptionML=[ENU=Prognosis Financial Result;
                                                              NOR=Resultatprognose, finans;
                                                              SVE=Prognos finansiellt resultat];
                                                   Editable=No }
    { 560 ;   ;Prognosis Date      ;Date          ;CaptionML=[ENU=Prognosis Date;
                                                              NOR=Prognosedato;
                                                              SVE=Prognosdatum];
                                                   Editable=No }
    { 570 ;   ;Last Updated at     ;DateTime      ;CaptionML=ENU=Last Updated at;
                                                   Editable=No }
    { 580 ;   ;Closed Period       ;Boolean       ;CaptionML=[ENU=Closed Period;
                                                              NOR=Lukket periode;
                                                              SVE=StÑngd period];
                                                   Editable=No }
    { 590 ;   ;Contract Amount     ;Decimal       ;CaptionML=[ENU=Contract Amount;
                                                              NOR=Kontraktsbelõp;
                                                              SVE=Kontraktsbelopp];
                                                   Editable=No }
    { 600 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              SVE=Global dimension 1 kod];
                                                   Editable=No;
                                                   CaptionClass='1,1,1' }
    { 610 ;   ;Zero Line           ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Zero Line;
                                                              SVE=Nollrad] }
    { 620 ;   ;Closed Cost         ;Decimal       ;CaptionML=[ENU=Closed Cost;
                                                              SVE=Upparbetad kostnad];
                                                   Editable=No }
    { 630 ;   ;Precalc. Result vs Budget;Decimal  ;CaptionML=ENU=Pre-calculation Result vs Budget;
                                                   Editable=No }
    { 640 ;   ;Precalc. Result vs Total Cost;Decimal;
                                                   CaptionML=ENU=Budget Revenue vs Total Cost;
                                                   Editable=No }
    { 650 ;   ;Precalc. Result vs Budget %;Decimal;CaptionML=ENU=Pre-calculation Result vs Budget %;
                                                   Editable=No }
    { 660 ;   ;Precalc. Result vs Total Cst %;Decimal;
                                                   CaptionML=ENU=Pre-calculation Result vs Total Cost %;
                                                   Editable=No }
    { 670 ;   ;Result %            ;Decimal       ;CaptionML=[ENU=Result %;
                                                              SVE=Resultat (%)];
                                                   Editable=No }
    { 680 ;   ;Prognosis Financial Result %;Decimal;
                                                   CaptionML=[ENU=Prognosis Financial Result %;
                                                              SVE=Prognos finansiellt resultat %];
                                                   Editable=No }
    { 690 ;   ;Purchase            ;Decimal       ;CaptionML=[ENU=Purchase;
                                                              SVE=Inkîp] }
    { 700 ;   ;Result Compl. Costs and Rev.;Decimal;
                                                   CaptionML=ENU=Result Completed Costs and Revenues;
                                                   Editable=No }
    { 710 ;   ;Deviation From Budget;Decimal      ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Deviation From Budget;
                                                   Editable=No }
    { 720 ;   ;Lower Level Progn. Total Cost;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Lower Level Prognosis Total Cost;
                                                   Editable=No }
    { 730 ;   ;Calc. Prognosis Total Cost;Decimal ;CaptionML=[ENU=Calculated Prognosis Total Cost;
                                                              SVE=BerÑknad prognos fîr totalkostnader];
                                                   Editable=No }
    { 740 ;   ;Total Cost (WIP) on Bal. Sheet;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Total Cost (WIP) on Balance Sheet;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 750 ;   ;Total Rev. (WIP) on Bal. Sheet;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Total Revenue (WIP) on Balance Sheet;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 760 ;   ;Total Cost (WIP) on P&L;Decimal    ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Total Cost (WIP) on P&L;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 770 ;   ;Total Revenue (WIP) on P&L;Decimal ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Total Revenue (WIP) on P&L;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 780 ;   ;Posted Preclosure Result;Decimal   ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Posted Preclosure Result;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 790 ;   ;Posted Provision Loss;Decimal      ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Posted Provision Loss;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 800 ;   ;Contr. Fin. Bal. Without Clos.;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Contract Financing Balance Without Closing Entries;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 810 ;   ;Control Details     ;Option        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Control Details;
                                                   OptionCaptionML=ENU=Source Type,Cost Object;
                                                   OptionString=Source Type,Cost Object;
                                                   Editable=No }
    { 820 ;   ;Budget Costs Incl. Deviation;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Budget Costs Including Deviation;
                                                   Editable=No }
    { 830 ;   ;Precalc. Res. Incl. Deviation;Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Precalc. Result Including Deviation;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 840 ;   ;Exclude SOs From Est. Result;Boolean;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Exclude Service Orders From Estimated Result;
                                                   Editable=No }
    { 850 ;   ;Result closed revenue %;Decimal    ;CaptionML=ENU=Result closed revenue %;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Entry No.                               ;Clustered=Yes }
    {    ;Service Contract No.                     }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text001@1100528602 : TextConst 'ENU=Period;NOR=Periode;SVE=Period';
      Text002@1100528603 : TextConst 'ENU=Amounts Source Type Level';
      Text003@1100528604 : TextConst 'ENU=Drill down only available on Service Order level';
      Text004@1100528605 : TextConst 'ENU=Prognosis %1 not found';
      Text005@1100528606 : TextConst 'ENU=No Prognosis Present';
      Text006@1100528607 : TextConst 'ENU=Contract;NOR=Contract;SVE="Kontrakt     "';
      TotalBudgetRevenueContract@1100528500 : Decimal;

    LOCAL PROCEDURE DetermineIndentation@1100528606();
    VAR
      Indentations@1100529600 : ',Period,Service Category,Source Type,Service Order';
    BEGIN
      CASE "Line Type" OF
        "Line Type"::Period:
          Indentation := Indentations::Period;
        "Line Type"::"Service Category":
          Indentation := Indentations::"Service Category";
        "Line Type"::"Source Type":
          Indentation := Indentations::"Source Type";
        "Line Type"::"Service Order":
          Indentation := Indentations::"Service Order";
      END;
    END;

    LOCAL PROCEDURE DetermineValues@1100528603();
    VAR
      ServiceOrder@1100528600 : Record 11012823;
      ServiceContract@1100528602 : Record 11012812;
      SCBudgetCallsRelease@1100528605 : Record 11071699;
      ServiceCategory@1100529600 : Record 11071985;
      SCControlbyPeriodMgt@1100528601 : Codeunit 11012885;
      ServicePrognosisManagement@1100528604 : Codeunit 11012884;
      Factor@1100528603 : Decimal;
      ReleasePercentage@1100528606 : Decimal;
    BEGIN
      DetermineIndentation;
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        ServiceContract.INIT;
      CASE "Line Type" OF
        "Line Type"::Period:
          BEGIN
            ServiceCategory.SETFILTER("Service Contract No.", '<>%1&%2', '', "Service Contract No.");
            IF ServiceCategory.FINDFIRST THEN BEGIN
              "Exclude SOs From Est. Result" := ServiceCategory."Exclude SOs From Est. Result";
              ServiceCategory.SETRANGE("Exclude SOs From Est. Result", NOT ServiceCategory."Exclude SOs From Est. Result");
              IF NOT ServiceCategory.ISEMPTY THEN
                "Exclude SOs From Est. Result" := TRUE;
            END;
          END;
        "Line Type"::"Service Category":;
        "Line Type"::"Source Type":;
        "Line Type"::"Service Order":
          BEGIN
            IF "Service Order No." <> '' THEN BEGIN
              ServiceOrder.GET("Service Order No.");
              VALIDATE("Budget Cost", SCControlbyPeriodMgt.GetSOBudget("Service Order No.", 0));
              SCControlbyPeriodMgt.GenerateControlBudgetLines("Service Order No.");
              "Budget Hours" := SCControlbyPeriodMgt.GetSOBudgetHours("Service Order No.", 0);
              "Actual Cost" := SCControlbyPeriodMgt.GetSOActualCost("Service Order No.", 0, '');
              "Open (Purchase)" := SCControlbyPeriodMgt.GetSOOpenPurchase("Service Order No.", 0, '');
              "Open Ovh. Surch. Soft (Purch.)" := SCControlbyPeriodMgt.GetOpenPurchaseSurcharge("Service Order No.", 0, '');
              "Received/Not Invoiced" := SCControlbyPeriodMgt.GetSOReceivedNotInvoiced("Service Order No.", 0, '');
              "Open Ovh. Surch. Firm (Purch.)" := SCControlbyPeriodMgt.GetSOReceivedNotInvoicedSurcharge("Service Order No.", 0, '');
              "Open (Inventory)" := SCControlbyPeriodMgt.GetSOOpenInventoryAmount("Service Order No.", 0, '');
              "Open Ovh. Surch. (Inventory)" := SCControlbyPeriodMgt.GetSOOpenInventorySurchargeAmount("Service Order No.", 0, '');
              "Open Amount (Hours)" := SCControlbyPeriodMgt.GetSOOpenHoursAmount("Service Order No.", 0, '');
              "Open Ovh. Surch. (Hours)" := SCControlbyPeriodMgt.GetSOOpenHoursAmountSurcharge("Service Order No.", 0, '');
              VALIDATE("Total Cost",
                "Actual Cost" + "Open (Purchase)" + "Open Ovh. Surch. Soft (Purch.)" + "Received/Not Invoiced" +
                "Open Ovh. Surch. Firm (Purch.)" + "Open (Inventory)" + "Open Ovh. Surch. (Inventory)" +
                "Open Amount (Hours)" + "Open Ovh. Surch. (Hours)");
              "Total Cost (Additional)" :=
                SCControlbyPeriodMgt.GetSOActualCost("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOOpenPurchase("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetOpenPurchaseSurcharge("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOReceivedNotInvoiced("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOReceivedNotInvoicedSurcharge("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOOpenInventoryAmount("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOOpenInventorySurchargeAmount("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOOpenHoursAmount("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOOpenHoursAmountSurcharge("Service Order No.", 2, '');

              "Actual Hours" := SCControlbyPeriodMgt.GetSOActualHours("Service Order No.", 0, '');
              "Open Hours" := SCControlbyPeriodMgt.GetSOOpenHours("Service Order No.", 0, '');
              "Total Hours" := "Actual Hours" + "Open Hours";
              "Total Hours (Additional)" :=
                SCControlbyPeriodMgt.GetSOActualHours("Service Order No.", 2, '') +
                SCControlbyPeriodMgt.GetSOOpenHours("Service Order No.", 2, '');
              "Allowed Hours" := SCControlbyPeriodMgt.GetSOAllowedHours("Service Order No.", 0);
              "Result Hours" := "Allowed Hours" - "Total Hours";
              SCControlbyPeriodMgt.GenerateSOControlCostRevLines("Service Order No.");
              "Budget Revenue (Order)" := SCControlbyPeriodMgt.GetSOBudgetRevenue("Service Order No.", 0, '');
              "Total Budget Revenue" := "Budget Revenue (Order)";
              IF (ServiceContract."Budget Based on" = ServiceContract."Budget Based on"::Category) OR
                 (("Source Type" <> "Source Type"::Contract) AND (ServiceContract."Budget Based on" = ServiceContract."Budget Based on"::"Category + Maintenance Scheme"))
              THEN BEGIN
                ConsumeServiceCategoryBudget;
                ConsumeServiceCategorySCCtrlBudget;
              END;

              "Revenue Amount" := SCControlbyPeriodMgt.GetSORevenue("Service Order No.", 0, '');
              "Revenue Amount (Additional)" := SCControlbyPeriodMgt.GetSORevenue("Service Order No.", 2, '');
              "Contract Financing Balance" := "Revenue Amount" - "Actual Cost";

              "Allowed Cost" := SCControlbyPeriodMgt.GetSOAllowedCost("Service Order No.", 0);
              Result := "Allowed Cost" - "Total Cost";

              "SO Status" := ServiceOrder.Status;
              "SO Description" := ServiceOrder.Description;
              "Closed Revenue" := SCControlbyPeriodMgt.GetSOClosedRevenue("Service Order No.", 0, '');
              "Closed Cost" := SCControlbyPeriodMgt.GetSOClosedCost("Service Order No.", 0, '');
              Purchase := SCControlbyPeriodMgt.GetSOPurchaseAmount("Service Order No.", '');
              SCControlbyPeriodMgt.GetTotalCostBalanceSheetOrPL("Service Contract No.", "Service Category", "Service Order No.", "Source Type",
                "Starting Date", "Ending Date", '', "Total Cost (WIP) on Bal. Sheet", "Total Rev. (WIP) on Bal. Sheet", "Total Cost (WIP) on P&L", "Total Revenue (WIP) on P&L");
            END ELSE BEGIN
              IF ServiceContract."Control Details" = ServiceContract."Control Details"::"Cost Type/Cost Object" THEN
                SCControlbyPeriodMgt.SetCalculateCostTypeAmounts(TRUE, TRUE);
              "Budget Cost" :=
                SCControlbyPeriodMgt.GetMaintenanceBudgetAndRevenue(
                  "Service Contract No.", "Control Period Code", "Starting Date", "Ending Date", "Service Category", "Source Type",
                  "Line Type", '', "Revenue Amount", "Budget Hours", "Budget Revenue (Order)");
              Available := "Budget Cost";
              SCControlbyPeriodMgt.GetTotalCostBalanceSheetOrPL("Service Contract No.", "Service Category", "Service Order No.", "Source Type",
                "Starting Date", "Ending Date", '', "Total Cost (WIP) on Bal. Sheet", "Total Rev. (WIP) on Bal. Sheet", "Total Cost (WIP) on P&L", "Total Revenue (WIP) on P&L");
              IF "Source Type" IN ["Source Type"::Call, "Source Type"::Contract] THEN BEGIN
                IF NOT ServiceContract.GET("Service Contract No.") THEN
                  ServiceContract.INIT;
                IF "Service Category" <> '' THEN
                  Factor := ServiceContract.GetCategoryDivisionPercentageShareCalls("Service Category", "Ending Date") / 100
                ELSE
                  Factor := ServiceContract.GetPercentageShareCalls("Ending Date") / 100;
                IF "Source Type" = "Source Type"::Contract THEN
                  Factor := 1 - Factor;
                IF Factor <> 0 THEN BEGIN
                  "Budget Revenue (Contract)" :=
                    GetBudgetRevenueContract(ServiceContract) * Factor;
                  "Paid Amount" :=
                    SCControlbyPeriodMgt.GetPaidAmount(
                      0, "Service Contract No.", "Starting Date", "Ending Date", "Service Category", '', 0, '') * Factor;
                  "Closed Revenue" :=
                    SCControlbyPeriodMgt.GetSCClosedRevenue(
                      "Service Contract No.", "Starting Date", "Ending Date", "Service Category", 0, '') * Factor;
                  "Closed Cost" :=
                    SCControlbyPeriodMgt.GetSCClosedCost(
                      "Service Contract No.", "Starting Date", "Ending Date", "Service Category", 0, '') * Factor;
                END;
                IF "Source Type" = "Source Type"::Call THEN BEGIN
                  ReleasePercentage := SCBudgetCallsRelease.CalcTotalReleasePerc("Service Contract No.", "Starting Date", WORKDATE, "Ending Date");
                  "Allowed Cost" := "Budget Cost" * ReleasePercentage / 100;
                  "Allowed Hours" := "Budget Hours" * ReleasePercentage / 100;
                END;
                "Contract Financing Balance" := "Revenue Amount";
              END;
              IF ServiceContract."Control Details" = ServiceContract."Control Details"::"Cost Type/Cost Object" THEN
                SCControlbyPeriodMgt.GetCompressedSCControlByPeriodDetail(Rec, ReleasePercentage);
              RoundAmounts;
              "Total Budget Revenue" := "Budget Revenue (Order)" + "Budget Revenue (Contract)";
            END;
          END;
      END;
      "Contract Amount" := SCControlbyPeriodMgt.GetSCAmount("Service Contract No.", "Starting Date", "Ending Date");
      "Contr. Fin. Bal. Without Clos." := "Contract Financing Balance" - ("Closed Revenue" - "Closed Cost");
      ServicePrognosisManagement.GetPrognosisValues(
        "Line Type", "Service Contract No.", "Control Period Code", "Service Category", "Source Type", "Service Order No.", "Global Dimension 1 Code", WORKDATE,
        "Prognosis Date", "Calc. Prognosis Total Cost", "Prognosis Total Cost", "Prognosis Total Revenue", "Deviation From Budget", "Lower Level Progn. Total Cost");
      "Budget Costs Incl. Deviation" := "Budget Cost" + "Deviation From Budget";
      "Prognosis Financial Result" := "Prognosis Total Revenue" - "Prognosis Total Cost";
      IF NOT "Exclude SOs From Est. Result" THEN BEGIN
        "Precalc. Result vs Budget" := "Total Budget Revenue" - "Budget Cost";
        "Precalc. Res. Incl. Deviation" := "Total Budget Revenue" - "Budget Cost" - "Deviation From Budget";
      END;
      "Precalc. Result vs Total Cost" := "Total Budget Revenue" - "Total Cost";
      IF "Total Budget Revenue" <> 0 THEN
        "Precalc. Result vs Budget %" := ("Precalc. Result vs Budget" / "Total Budget Revenue") * 100;
      IF "Total Budget Revenue" <> 0 THEN
        "Precalc. Result vs Total Cst %" := ("Precalc. Result vs Total Cost" / "Total Budget Revenue") * 100;
      IF "Allowed Cost" <> 0 THEN
       "Result %" := (("Allowed Cost" - "Total Cost") / "Allowed Cost") * 100;
      IF "Prognosis Total Revenue" <> 0 THEN
        "Prognosis Financial Result %" := (("Prognosis Total Revenue" - "Prognosis Total Cost") / "Prognosis Total Revenue") * 100;
      "Result Compl. Costs and Rev." := "Closed Revenue" - "Closed Cost";
      SCControlbyPeriodMgt.GetPreclosureResultValues("Service Contract No.", "Control Period Code", "Service Category", "Service Order No.",
        "Global Dimension 1 Code", "Line Type", "Source Type", "Posted Preclosure Result", "Posted Provision Loss");
      "Zero Line" := DetermineZeroLine;
      IF "Closed Revenue" <> 0 THEN
        "Result closed revenue %" := "Result Compl. Costs and Rev." / "Closed Revenue" * 100;
    END;

    PROCEDURE DetermineTotals@1100528608();
    VAR
      ServiceContract@1100528602 : Record 11012812;
      SCControlbyPeriod@1100528600 : Record 11072311;
      LowerLevelLineType@1100528601 : Option;
    BEGIN
      IF NOT ("Line Type" IN ["Line Type"::Period, "Line Type"::"Service Category", "Line Type"::"Source Type"]) THEN
        EXIT;
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        ServiceContract.INIT;
      CASE "Line Type" OF
        "Line Type"::Period:
          IF ServiceContract."Budget Based on" = ServiceContract."Budget Based on"::"Maintenance Scheme" THEN
            LowerLevelLineType := "Line Type"::"Source Type"
          ELSE
            LowerLevelLineType := "Line Type"::"Service Category";
        "Line Type"::"Service Category":
          LowerLevelLineType := "Line Type"::"Source Type";
        "Line Type"::"Source Type":
          LowerLevelLineType := "Line Type"::"Service Order";
      END;
      SCControlbyPeriod.SETRANGE("Service Contract No.", "Service Contract No.");
      IF "Service Contract No." = '' THEN
        SCControlbyPeriod.SETRANGE("Global Dimension 1 Code", "Global Dimension 1 Code");
      SCControlbyPeriod.SETRANGE("Control Period Code", "Control Period Code");
      IF "Line Type" IN ["Line Type"::"Service Category", "Line Type"::"Source Type"] THEN
        SCControlbyPeriod.SETRANGE("Service Category", "Service Category");
      IF "Line Type" IN ["Line Type"::"Source Type"] THEN
        SCControlbyPeriod.SETRANGE("Source Type", "Source Type");
      SCControlbyPeriod.SETRANGE("Line Type", LowerLevelLineType);
      SCControlbyPeriod.CALCSUMS(
        "Budget Cost", "Actual Cost", "Open (Purchase)", "Open Ovh. Surch. Soft (Purch.)", "Received/Not Invoiced",
        "Open Ovh. Surch. Firm (Purch.)", "Open (Inventory)", "Open Ovh. Surch. (Inventory)", "Open Amount (Hours)",
        "Open Ovh. Surch. (Hours)", "Total Cost", "Total Cost (Additional)", Available, "Budget Hours", "Actual Hours",
        "Open Hours", "Total Hours", "Total Hours (Additional)", "Allowed Hours", "Result Hours");
      SCControlbyPeriod.CALCSUMS(
        "Budget Revenue (Contract)", "Budget Revenue (Order)", "Total Budget Revenue", "Revenue Amount", "Revenue Amount (Additional)",
        "Contract Financing Balance", "Allowed Cost", Result, "Closed Revenue", "Closed Cost", Purchase,
        "Precalc. Result vs Budget", "Precalc. Result vs Total Cost", "Result Compl. Costs and Rev.", "Contr. Fin. Bal. Without Clos.");
      SCControlbyPeriod.CALCSUMS("Total Cost (WIP) on Bal. Sheet", "Total Rev. (WIP) on Bal. Sheet", "Total Cost (WIP) on P&L", "Total Revenue (WIP) on P&L",
        "Precalc. Res. Incl. Deviation");

      "Budget Cost" := SCControlbyPeriod."Budget Cost";
      "Actual Cost" := SCControlbyPeriod."Actual Cost";
      "Open (Purchase)" := SCControlbyPeriod."Open (Purchase)";
      "Open Ovh. Surch. Soft (Purch.)" := SCControlbyPeriod."Open Ovh. Surch. Soft (Purch.)";
      "Received/Not Invoiced" := SCControlbyPeriod."Received/Not Invoiced";
      "Open Ovh. Surch. Firm (Purch.)" := SCControlbyPeriod."Open Ovh. Surch. Firm (Purch.)";
      "Open (Inventory)" := SCControlbyPeriod."Open (Inventory)";
      "Open Ovh. Surch. (Inventory)" := SCControlbyPeriod."Open Ovh. Surch. (Inventory)";
      "Open Amount (Hours)" := SCControlbyPeriod."Open Amount (Hours)";
      "Open Ovh. Surch. (Hours)" := SCControlbyPeriod."Open Ovh. Surch. (Hours)";
      "Total Cost" := SCControlbyPeriod."Total Cost";
      "Total Cost (Additional)" := SCControlbyPeriod."Total Cost (Additional)";
      Available := SCControlbyPeriod.Available;

      "Budget Hours" := SCControlbyPeriod."Budget Hours";
      "Actual Hours" := SCControlbyPeriod."Actual Hours";
      "Open Hours" := SCControlbyPeriod."Open Hours";
      "Total Hours" := SCControlbyPeriod."Total Hours";
      "Total Hours (Additional)" := SCControlbyPeriod."Total Hours (Additional)";
      "Allowed Hours" := SCControlbyPeriod."Allowed Hours";
      "Result Hours" := SCControlbyPeriod."Result Hours";

      "Budget Revenue (Contract)" := SCControlbyPeriod."Budget Revenue (Contract)";
      "Budget Revenue (Order)" := SCControlbyPeriod."Budget Revenue (Order)";
      "Total Budget Revenue" := SCControlbyPeriod."Total Budget Revenue";
      "Revenue Amount" := SCControlbyPeriod."Revenue Amount";
      "Revenue Amount (Additional)" := SCControlbyPeriod."Revenue Amount (Additional)";
      "Contract Financing Balance" := SCControlbyPeriod."Contract Financing Balance";
      "Contr. Fin. Bal. Without Clos." := SCControlbyPeriod."Contr. Fin. Bal. Without Clos.";
      "Allowed Cost" := SCControlbyPeriod."Allowed Cost";
      Result := SCControlbyPeriod.Result;

      "Paid Amount" := SCControlbyPeriod."Paid Amount";
      "Closed Revenue" := SCControlbyPeriod."Closed Revenue";
      "Closed Cost" := SCControlbyPeriod."Closed Cost";
      "Result Compl. Costs and Rev." := SCControlbyPeriod."Result Compl. Costs and Rev.";
      Purchase := SCControlbyPeriod.Purchase;

      "Total Cost (WIP) on Bal. Sheet" := SCControlbyPeriod."Total Cost (WIP) on Bal. Sheet";
      "Total Rev. (WIP) on Bal. Sheet" := SCControlbyPeriod."Total Rev. (WIP) on Bal. Sheet";
      "Total Cost (WIP) on P&L" := SCControlbyPeriod."Total Cost (WIP) on P&L";
      "Total Revenue (WIP) on P&L" := SCControlbyPeriod."Total Revenue (WIP) on P&L";

      SCControlbyPeriod.SETRANGE("Zero Line", FALSE);
      "Zero Line" := DetermineZeroLine AND SCControlbyPeriod.ISEMPTY;

      IF (NOT "Exclude SOs From Est. Result") OR ("Line Type" = "Line Type"::Period) THEN BEGIN
        "Precalc. Result vs Budget" := SCControlbyPeriod."Precalc. Result vs Budget";
        IF ("Deviation From Budget" = 0) OR
           (("Line Type" = "Line Type"::Period) AND "Exclude SOs From Est. Result")
        THEN
          "Precalc. Res. Incl. Deviation" := SCControlbyPeriod."Precalc. Res. Incl. Deviation"
        ELSE
          "Precalc. Res. Incl. Deviation" := "Total Budget Revenue" - "Budget Cost" - "Deviation From Budget";
      END;

      "Precalc. Result vs Total Cost" := SCControlbyPeriod."Precalc. Result vs Total Cost";
      IF "Total Budget Revenue" <> 0 THEN
        "Precalc. Result vs Budget %" := ("Precalc. Result vs Budget" / "Total Budget Revenue") * 100;
      IF "Total Budget Revenue" <> 0 THEN
        "Precalc. Result vs Total Cst %" := ("Precalc. Result vs Total Cost" / "Total Budget Revenue") * 100;
      IF "Allowed Cost" <> 0 THEN
       "Result %" := (("Allowed Cost" - "Total Cost") / "Allowed Cost") * 100;
      "Budget Costs Incl. Deviation" := "Budget Cost" + "Deviation From Budget";
      IF "Closed Revenue" <> 0 THEN
        "Result closed revenue %" := "Result Compl. Costs and Rev." / "Closed Revenue" * 100;
    END;

    PROCEDURE GetLineLevelDescription@1100528600() LevelDescription : Text;
    VAR
      CaptionManagement@1100529600 : Codeunit 42;
    BEGIN
      CASE "Line Type" OF
        "Line Type"::Period:
          BEGIN
            IF "Service Contract No." <> '' THEN
              LevelDescription := STRSUBSTNO('%1: %2, ', Text006, "Service Contract No.")
            ELSE
              IF "Global Dimension 1 Code" <> '' THEN
                LevelDescription := STRSUBSTNO('%1: %2, ', CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE, '1,1,1'), "Global Dimension 1 Code");
            LevelDescription += STRSUBSTNO('%1: %2 - %3', Text001, "Starting Date", "Ending Date");
          END;
        "Line Type"::"Service Category":
          LevelDescription := STRSUBSTNO('%1: %2', FIELDCAPTION("Service Category"), "Service Category");
        "Line Type"::"Source Type":
          LevelDescription := STRSUBSTNO('%1: %2', FIELDCAPTION("Source Type"), "Source Type");
        "Line Type"::"Service Order":
          BEGIN
            IF "Service Order No." <> '' THEN
              LevelDescription := STRSUBSTNO('%1: %2', FIELDCAPTION("Service Order No."), "Service Order No.")
            ELSE
              LevelDescription := Text002;
          END;
      END;
    END;

    PROCEDURE ShowCard@1100528601();
    VAR
      ServiceOrder@1100528601 : Record 11012823;
    BEGIN
      IF CanDrillDownOnServiceOrder THEN BEGIN
        ServiceOrder.GET("Service Order No.");
        ServiceOrder.ActivateServOrderCard;
      END;
    END;

    PROCEDURE CanDrillDownOnServiceOrder@1100528602() : Boolean;
    BEGIN
      IF ("Line Type" = "Line Type"::"Service Order") AND ("Service Order No." <> '') THEN
        EXIT(TRUE)
      ELSE
        MESSAGE(Text003);
    END;

    PROCEDURE ShowServicePrognosisCard@1100528604();
    VAR
      ServicePrognosis@1100528601 : Record 11072309;
      ServicePrognosisManagement@1100528603 : Codeunit 11012884;
      ServicePrognosisPage@1100528602 : Page 11126799;
    BEGIN
      IF "Prognosis Date" = 0D THEN
        ERROR(Text005);
      IF ServicePrognosisManagement.GetServicePrognosis("Prognosis Date", "Service Contract No.", ServicePrognosis) THEN BEGIN
        ServicePrognosisPage.SetServiceContractFilter("Service Contract No.");
        ServicePrognosisPage.SETRECORD(ServicePrognosis);
        ServicePrognosisPage.RUN;
      END ELSE
        ERROR(Text004, "Prognosis Date");
    END;

    LOCAL PROCEDURE ConsumeServiceCategoryBudget@1100528605();
    VAR
      SCControlbyPeriod@1100528600 : Record 11072311;
    BEGIN
      IF "Service Contract No." = '' THEN
        EXIT;
      IF "Service Category" = '' THEN
        EXIT;
      IF "Line Type" <> "Line Type"::"Service Order" THEN
        EXIT;
      SCControlbyPeriod.SETRANGE("Service Contract No.", "Service Contract No.");
      SCControlbyPeriod.SETRANGE("Control Period Code", "Control Period Code");
      SCControlbyPeriod.SETRANGE("Service Category", "Service Category");
      SCControlbyPeriod.SETRANGE("Source Type", "Source Type");
      SCControlbyPeriod.SETRANGE("Line Type", SCControlbyPeriod."Line Type"::"Service Order");
      SCControlbyPeriod.SETRANGE("Service Order No.", '');
      IF SCControlbyPeriod.FINDFIRST THEN BEGIN
        SCControlbyPeriod.VALIDATE("Budget Cost", SCControlbyPeriod."Budget Cost" - "Budget Cost");
        SCControlbyPeriod.VALIDATE("Budget Hours", SCControlbyPeriod."Budget Hours" - "Budget Hours");
        SCControlbyPeriod.VALIDATE("Budget Revenue (Order)", SCControlbyPeriod."Budget Revenue (Order)" - "Budget Revenue (Order)");
        IF SCControlbyPeriod."Budget Cost" < 0 THEN
          SCControlbyPeriod.VALIDATE("Budget Cost", 0);
        IF SCControlbyPeriod."Budget Hours" < 0 THEN
          SCControlbyPeriod.VALIDATE("Budget Hours", 0);
        IF SCControlbyPeriod."Budget Revenue (Order)" < 0 THEN
          SCControlbyPeriod.VALIDATE("Budget Revenue (Order)", 0);
        SCControlbyPeriod."Total Budget Revenue" := SCControlbyPeriod."Budget Revenue (Order)" + SCControlbyPeriod."Budget Revenue (Contract)";
        SCControlbyPeriod."Zero Line" := SCControlbyPeriod.DetermineZeroLine;
        SCControlbyPeriod."Budget Costs Incl. Deviation" := SCControlbyPeriod."Budget Cost" + SCControlbyPeriod."Deviation From Budget";
        IF NOT SCControlbyPeriod."Exclude SOs From Est. Result" THEN
          SCControlbyPeriod."Precalc. Res. Incl. Deviation" := SCControlbyPeriod."Total Budget Revenue" - SCControlbyPeriod."Budget Cost" - SCControlbyPeriod."Deviation From Budget";
        SCControlbyPeriod.MODIFY;
      END;
    END;

    LOCAL PROCEDURE ConsumeServiceCategorySCCtrlBudget@1100528607();
    VAR
      ServiceContractCtrlBudget@1100528600 : Record 11071759;
    BEGIN
      IF "Service Contract No." = '' THEN
        EXIT;
      IF "Service Category" = '' THEN
        EXIT;
      IF "Line Type" <> "Line Type"::"Service Order" THEN
        EXIT;
      IF "Service Order No." = '' THEN
        EXIT;
      ServiceContractCtrlBudget.SETCURRENTKEY("Service Control Method");
      ServiceContractCtrlBudget.SETRANGE("Service Control Method", ServiceContractCtrlBudget."Service Control Method"::"Real-Time");
      ServiceContractCtrlBudget.SETRANGE("Service Contract No.", "Service Contract No.");
      ServiceContractCtrlBudget.SETRANGE("Service Category", "Service Category");
      ServiceContractCtrlBudget.SETRANGE("Service Order No.", '');
      ServiceContractCtrlBudget.SETRANGE("Service Object No.", '');
      ServiceContractCtrlBudget.SETRANGE("Reference Date", "Starting Date", "Ending Date");
      CASE "Source Type" OF
        "Source Type"::Contract:
          ServiceContractCtrlBudget.SETRANGE("Budget Type", ServiceContractCtrlBudget."Budget Type"::Budget);
        "Source Type"::Call:
          ServiceContractCtrlBudget.SETRANGE("Budget Type", ServiceContractCtrlBudget."Budget Type"::"Budget Calls");
      ELSE
        EXIT;
      END;
      IF ServiceContractCtrlBudget.FINDFIRST THEN BEGIN
        ServiceContractCtrlBudget.Amount -= "Budget Cost";
        IF ServiceContractCtrlBudget.Amount < 0 THEN
          ServiceContractCtrlBudget.Amount := 0;
        ServiceContractCtrlBudget.Hours -= "Budget Hours";
        IF ServiceContractCtrlBudget.Hours < 0 THEN
          ServiceContractCtrlBudget.Hours := 0;
        ServiceContractCtrlBudget.MODIFY;
      END;
    END;

    PROCEDURE DetermineZeroLine@1100529905() : Boolean;
    BEGIN
      IF ("Budget Cost" = 0) AND ("Budget Hours" = 0) AND ("Total Cost" = 0) AND ("Total Cost (Additional)" = 0) AND ("Total Hours" = 0) AND ("Total Hours (Additional)" = 0) AND
         ("Result Hours" = 0) AND ("Total Budget Revenue" = 0) AND ("Revenue Amount (Additional)" = 0) AND ("Contract Financing Balance" = 0) AND ("Allowed Cost" = 0) AND
         ("Allowed Hours" = 0) AND (Result = 0) AND ("Paid Amount" = 0) AND ("Closed Revenue" = 0) AND ("Closed Cost" = 0) AND ("Contr. Fin. Bal. Without Clos." = 0) AND
         ("Budget Costs Incl. Deviation" = 0) AND ("Precalc. Res. Incl. Deviation" = 0) AND ("Budget Revenue (Order)" = 0) AND ("Budget Revenue (Contract)" = 0) AND (Purchase = 0)
      THEN
        EXIT(TRUE)
      ELSE
        EXIT(FALSE);
    END;

    PROCEDURE SetMultiLevelFilter@1100529903(SCControlByPeriod@1100529905 : Record 11072311);
    BEGIN
      SETRANGE("Service Contract No.", SCControlByPeriod."Service Contract No.");
      IF SCControlByPeriod."Service Contract No." = '' THEN
        SETRANGE("Global Dimension 1 Code", SCControlByPeriod."Global Dimension 1 Code");
      SETRANGE("Starting Date", SCControlByPeriod."Starting Date");
      SETRANGE("Ending Date", SCControlByPeriod."Ending Date");
      IF SCControlByPeriod."Line Type" <> "Line Type"::Period THEN BEGIN
        SETRANGE("Service Category",SCControlByPeriod."Service Category");
        IF SCControlByPeriod."Line Type" <> "Line Type"::"Service Category" THEN BEGIN
          SETRANGE("Source Type",SCControlByPeriod."Source Type");
          IF SCControlByPeriod."Line Type" <> "Line Type"::"Source Type" THEN
            SETRANGE("Service Order No.",SCControlByPeriod."Service Order No.");
        END;
      END;
    END;

    LOCAL PROCEDURE DeleteServOrderRelatedTables@1100529600(ServiceOrderNo@1100529600 : Code[20]);
    VAR
      ServiceOrderCtrlCostRev@1100529602 : Record 11071756;
      ServiceOrderControlBudget@1100529603 : Record 11071757;
    BEGIN
      ServiceOrderCtrlCostRev.SETCURRENTKEY("Service Order No.", "Service Control Method");
      ServiceOrderCtrlCostRev.SETRANGE("Service Order No.", ServiceOrderNo);
      ServiceOrderCtrlCostRev.SETRANGE("Service Control Method", ServiceOrderCtrlCostRev."Service Control Method"::"Real-Time");
      ServiceOrderCtrlCostRev.DELETEALL(TRUE);

      ServiceOrderControlBudget.SETCURRENTKEY("Service Order No.", "Service Control Method");
      ServiceOrderControlBudget.SETRANGE("Service Order No.", ServiceOrderNo);
      ServiceOrderControlBudget.SETRANGE("Service Control Method", ServiceOrderControlBudget."Service Control Method"::"Real-Time");
      ServiceOrderControlBudget.DELETEALL(TRUE);
    END;

    LOCAL PROCEDURE GetBudgetRevenueContract@1100528500(ServiceContract@1100528500 : Record 11012812) BudgetRevenueContract : Decimal;
    VAR
      SCControlbyPeriodMgt@1100528501 : Codeunit 11012885;
      DivisionPercentage@1100528502 : Decimal;
    BEGIN
      IF "Service Category" <> '' THEN
        BudgetRevenueContract :=
          SCControlbyPeriodMgt.GetSCBudgetRevenue(
            "Service Contract No.", "Starting Date", "Ending Date", "Service Category");

      ServiceContract.SetCheckOtherServiceCategories(TRUE);
      DivisionPercentage := ServiceContract.GetCategoryDivisionPercentage("Service Category", "Starting Date");
      BudgetRevenueContract += TotalBudgetRevenueContract * DivisionPercentage / 100;
    END;

    PROCEDURE SetTotalBudgetRevenueContract@1100528502(NewTotalBudgetRevenueContract@1100528500 : Decimal);
    BEGIN
      TotalBudgetRevenueContract := NewTotalBudgetRevenueContract;
    END;

    LOCAL PROCEDURE RoundAmounts@1100529602();
    VAR
      GLSetup@1100529600 : Record 98;
    BEGIN
      IF DetermineZeroLine THEN
        EXIT;

      GLSetup.GET;
      "Budget Cost" := ROUND("Budget Cost", GLSetup."Amount Rounding Precision");
      "Revenue Amount" := ROUND("Revenue Amount", GLSetup."Amount Rounding Precision");
      "Budget Hours" := ROUND("Budget Hours", GLSetup."Amount Rounding Precision");
      "Budget Revenue (Order)" := ROUND("Budget Revenue (Order)", GLSetup."Amount Rounding Precision");
      Available := ROUND(Available, GLSetup."Amount Rounding Precision");
      "Budget Revenue (Contract)" :=  ROUND("Budget Revenue (Contract)", GLSetup."Amount Rounding Precision");
      "Paid Amount" := ROUND("Paid Amount", GLSetup."Amount Rounding Precision");
      "Closed Revenue" := ROUND("Closed Revenue", GLSetup."Amount Rounding Precision");
      "Closed Cost" := ROUND("Closed Cost", GLSetup."Amount Rounding Precision");
      "Allowed Cost" := ROUND("Allowed Cost", GLSetup."Amount Rounding Precision");
      "Allowed Hours" := ROUND("Allowed Hours", GLSetup."Amount Rounding Precision");
      "Contract Financing Balance" := ROUND("Contract Financing Balance", GLSetup."Amount Rounding Precision");
    END;

    BEGIN
    END.
  }
}

