OBJECT Page 233 Apply Vendor Entries
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.04,4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Apply Vendor Entries;
               NOR=Utlign levrd.poster;
               SVE=Koppla leverantîrstrans.];
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    SourceTable=Table25;
    DataCaptionFields=Vendor No.;
    PageType=Worksheet;
    PromotedActionCategoriesML=[ENU=New,Process,Report,Line,Entry;
                                NOR=Ny,Prosess,Rapport,Linje,Oppfõring;
                                SVE=Ny,Process,Rapport,Rad,Transaktion];
    ShowFilter=Yes;
    OnInit=BEGIN
             AppliesToIDVisible := TRUE;
           END;

    OnOpenPage=VAR
                 OfficeMgt@1000 : Codeunit 1630;
               BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**4PS Generated Code.en01
                 IF CalcType = CalcType::Direct THEN BEGIN
                   Vend.GET("Vendor No.");
                   ApplnCurrencyCode := Vend."Currency Code";
                   FindApplyingEntry;
                 END;

                 PurchSetup.GET;
                 VendNameVisible := PurchSetup."Copy Vendor Name to Entries";

                 AppliesToIDVisible := ApplnType <> ApplnType::"Applies-to Doc. No.";

                 GLSetup.GET;

                 IF CalcType = CalcType::GenJnlLine THEN
                   CalcApplnAmount;
                 PostingDone := FALSE;
                 IsOfficeAddin := OfficeMgt.IsAvailable;
               END;

    OnAfterGetRecord=BEGIN
                       StyleTxt := SetStyle;
                     END;

    OnNewRecord=BEGIN
                  //**4PS Generated Code. Do Not Change.sn02
                  DPA_SetDefaultDepartment;
                  //**4PS Generated Code.en02
                END;

    OnInsertRecord=VAR
                     xRecRef@1100000999 : RecordRef;
                   BEGIN
                     //**4PS Generated Code. Do Not Change.sn05
                     xRecRef.GETTABLE(xRec);
                     DPA_SetDefaultDpmtFromNoSeries(xRecRef);
                     //**4PS Generated Code.en05
                   END;

    OnModifyRecord=BEGIN
                     CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",Rec);
                     IF "Applies-to ID" <> xRec."Applies-to ID" THEN
                       CalcApplnAmount;
                     EXIT(FALSE);
                   END;

    OnQueryClosePage=VAR
                       RaiseError@1001 : Boolean;
                     BEGIN
                       IF CloseAction = ACTION::LookupOK THEN
                         LookupOKOnPush;
                       IF ApplnType = ApplnType::"Applies-to Doc. No." THEN BEGIN
                         IF OK THEN BEGIN
                           RaiseError := ApplyingVendLedgEntry."Posting Date" < "Posting Date";
                           OnBeforeEarlierPostingDateError(ApplyingVendLedgEntry,Rec,RaiseError,CalcType);
                           IF RaiseError THEN BEGIN
                             OK := FALSE;
                             ERROR(
                               EarlierPostingDateErr,ApplyingVendLedgEntry."Document Type",ApplyingVendLedgEntry."Document No.",
                               "Document Type","Document No.");
                           END;
                         END;
                         IF OK THEN BEGIN
                           IF "Amount to Apply" = 0 THEN
                             "Amount to Apply" := "Remaining Amount";
                           IF "Entry No." <> 0 THEN //**4PS.n call 30959
                             CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",Rec);
                         END;
                       END;

                       IF CheckActionPerformed THEN BEGIN
                         Rec := ApplyingVendLedgEntry;
                         "Applying Entry" := FALSE;
                         IF AppliesToID = '' THEN BEGIN
                           "Applies-to ID" := '';
                           "Amount to Apply" := 0;
                         END;
                         IF "Entry No." <> 0 THEN //**4PS.n call C000148
                           CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",Rec);
                       END;
                     END;

    OnAfterGetCurrRecord=BEGIN
                           IF ApplnType = ApplnType::"Applies-to Doc. No." THEN
                             CalcApplnAmount;
                           HasDocumentAttachment := HasPostedDocAttachment;
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 37      ;1   ;ActionGroup;
                      CaptionML=[ENU=Ent&ry;
                                 NOR=Po&st;
                                 SVE=Trans&aktion];
                      Image=Entry }
      { 31      ;2   ;Action    ;
                      CaptionML=[ENU=Applied E&ntries;
                                 NOR=Utlignede &poster;
                                 SVE=&Kopplade transaktioner];
                      ToolTipML=[ENU=View the ledger entries that have been applied to this record.;
                                 NOR=Vis postene som har blitt brukt for denne posten.;
                                 SVE=Visa transaktionerna som har tillÑmpats pÜ denna post.];
                      ApplicationArea=#Basic,#Suite;
                      RunObject=Page 62;
                      RunPageOnRec=Yes;
                      Promoted=Yes;
                      Image=Approve;
                      PromotedCategory=Category5 }
      { 57      ;2   ;Action    ;
                      AccessByPermission=TableData 348=R;
                      ShortCutKey=Shift+Ctrl+D;
                      CaptionML=[ENU=Dimensions;
                                 NOR=Dimensjoner;
                                 SVE=Dimensioner];
                      ToolTipML=[ENU=View or edit dimensions, such as area, project, or department, that you can assign to sales and purchase documents to distribute costs and analyze transaction history.;
                                 NOR=Vis eller rediger dimensjoner, for eksempel omrÜde, prosjekt eller avdeling, som du kan tilordne til salgs- og kjõpsdokumenter for Ü distribuere kostnader og analysere transaksjonshistorikk.;
                                 SVE=Visa eller redigera mÜtt, till exempel omrÜde, projekt eller avdelning, som du kan tilldela till fîrsÑljnings- och inkîpsdokument fîr att fîrdela kostnader och analysera transaktionshistorik.];
                      ApplicationArea=#Dimensions;
                      Promoted=Yes;
                      Image=Dimensions;
                      PromotedCategory=Category5;
                      OnAction=BEGIN
                                 ShowDimensions;
                               END;
                                }
      { 63      ;2   ;Action    ;
                      ShortCutKey=Ctrl+F7;
                      CaptionML=[ENU=Detailed &Ledger Entries;
                                 NOR=Detaljerte &poster;
                                 SVE=Detaljerad &reskontra];
                      ToolTipML=[ENU=View a summary of the all posted entries and adjustments related to a specific vendor ledger entry.;
                                 NOR=Vis et sammendrag av alle bokfõrte poster og justeringer som er knyttet til en bestemt leverandõrpost.;
                                 SVE=Visa en îversikt av alla bokfîrda transaktioner och justeringar som rîr en viss leverantîrsreskontratransaktion.];
                      ApplicationArea=#Basic,#Suite;
                      RunObject=Page 574;
                      RunPageView=SORTING(Vendor Ledger Entry No.,Posting Date);
                      RunPageLink=Vendor Ledger Entry No.=FIELD(Entry No.);
                      Promoted=Yes;
                      Image=View;
                      PromotedCategory=Category5 }
      { 17      ;2   ;Action    ;
                      Name=Navigate;
                      CaptionML=[ENU=&Navigate;
                                 NOR=&Naviger;
                                 SVE=Anal&ysera];
                      ToolTipML=[ENU=Find all entries and documents that exist for the document number and posting date on the selected entry or document.;
                                 NOR=Finn alle oppfõringer og dokumenter som finnes for dokumentnummeret og bokfõringsdatoen i den valgte oppfõringen eller dokumentet.;
                                 SVE=Sîk efter alla transaktioner och dokument som existerar fîr dokumentnumret och bokfîringsdatumet fîr den valda transaktionen eller det valda dokumentet.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Visible=NOT IsOfficeAddin;
                      Image=Navigate;
                      PromotedCategory=Category5;
                      OnAction=BEGIN
                                 Navigate.SetDoc("Posting Date","Document No.");
                                 Navigate.RUN;
                               END;
                                }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 15      ;1   ;ActionGroup;
                      CaptionML=[ENU=&Application;
                                 NOR=U&tligning;
                                 SVE=&Koppling];
                      Image=Apply }
      { 13      ;2   ;Action    ;
                      Name=ActionSetAppliesToID;
                      ShortCutKey=Shift+F11;
                      CaptionML=[ENU=Set Applies-to ID;
                                 NOR=Angi utlignings-ID;
                                 SVE=Koppla till ID];
                      ToolTipML=[ENU=Set the Applies-to ID field on the posted entry to automatically be filled in with the document number of the entry in the journal.;
                                 NOR=Setter Utlignings-ID i den bokfõrte posten ti automatisk utfylling med postens bilagsnummer i kladden.;
                                 SVE=StÑll in fÑltet Koppla till ID pÜ den bokfîrda transaktionen fîr automatisk ifyllning med transaktionens verifikationsnummer i journalen.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=SelectLineToApply;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 IF (CalcType = CalcType::GenJnlLine) AND (ApplnType = ApplnType::"Applies-to Doc. No.") THEN
                                   ERROR(CannotSetAppliesToIDErr);

                                 SetVendApplId(FALSE);
                               END;
                                }
      { 11      ;2   ;Action    ;
                      Name=ActionPostApplication;
                      ShortCutKey=F9;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Post Application;
                                 NOR=Etterutligne;
                                 SVE=Bokfîr kopplade trans.];
                      ToolTipML=[ENU=Define the document number of the ledger entry to use to perform the application. In addition, you specify the Posting Date for the application.;
                                 NOR=Definerer bilagsnummeret i posten som skal brukes til Ü utfõre utligningen. I tillegg kan du angi bokfõringsdatoen for utligningen.;
                                 SVE=Definiera verifikationsnummer pÜ transaktionen som anvÑnds fîr att utfîra kopplingen. Dessutom anges kopplingens bokfîringsdatum.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=PostApplication;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 PostDirectApplication(FALSE);
                               END;
                                }
      { 9       ;2   ;Action    ;
                      Name=Preview;
                      CaptionML=[ENU=Preview Posting;
                                 NOR=ForhÜndsvis bokfõring;
                                 SVE=Fîrhandsgranska bokfîring];
                      ToolTipML=[ENU=Review the different types of entries that will be created when you post the document or journal.;
                                 NOR=Se gjennom de ulike typene poster som blir opprettet nÜr du bokfõrer dokumentet eller kladden.;
                                 SVE=Granska de olika typer av transaktioner som skapas nÑr du bokfîr dokumentet eller journalen.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=ViewPostedOrder;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 PostDirectApplication(TRUE);
                               END;
                                }
      { 7       ;2   ;Separator ;
                      CaptionML=[ENU=-;
                                 NOR=-;
                                 SVE=-] }
      { 5       ;2   ;Action    ;
                      CaptionML=[ENU=Show Only Selected Entries to Be Applied;
                                 NOR=Vis bare utvalgte poster som skal utlignes;
                                 SVE=Visa endast valda transaktioner som ska kopplas];
                      ToolTipML=[ENU=View the selected ledger entries that will be applied to the specified record.;
                                 NOR=Viser de valgte finanspostene som utlignes mot den angitte posten.;
                                 SVE=Visa valda transaktioner som kopplas till den angivna posten.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=ShowSelected;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ShowAppliedEntries := NOT ShowAppliedEntries;
                                 IF ShowAppliedEntries THEN
                                   IF CalcType = CalcType::GenJnlLine THEN
                                     SETRANGE("Applies-to ID",GenJnlLine."Applies-to ID")
                                   ELSE BEGIN
                                     VendEntryApplID := USERID;
                                     IF VendEntryApplID = '' THEN
                                       VendEntryApplID := '***';
                                     SETRANGE("Applies-to ID",VendEntryApplID);
                                   END
                                 ELSE
                                   SETRANGE("Applies-to ID");
                               END;
                                }
      { 25      ;1   ;Action    ;
                      Name=ShowPostedDocument;
                      CaptionML=[ENU=Show Posted Document;
                                 NOR=Vis bokfõrt dokument;
                                 SVE=Visa bokfîrt dokument];
                      ToolTipML=[ENU=Show details for the posted payment, invoice, or credit memo.;
                                 NOR=Vis detaljer for den bokfõrte betalingen, fakturaen eller kreditnotaen.;
                                 SVE=Visa detaljer om den bokfîrda betalningen, fakturan eller kreditnotan.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Document;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 ShowDoc
                               END;
                                }
      { 23      ;1   ;Action    ;
                      Name=ShowDocumentAttachment;
                      CaptionML=[ENU=Show Document Attachment;
                                 NOR=Vis dokumentvedlegg;
                                 SVE=Visa dokumentbilaga];
                      ToolTipML=[ENU=View documents or images that are attached to the posted invoice or credit memo.;
                                 NOR=Vis dokumenter eller bilder som er knyttet til den bokfõrte fakturaen eller kreditnotaen.;
                                 SVE=Visa dokument eller bilder som Ñr kopplade till den bokfîrda fakturan eller kreditnotan.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Enabled=HasDocumentAttachment;
                      PromotedIsBig=Yes;
                      Image=Attach;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 ShowPostedDocAttachment;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 70  ;1   ;Group     ;
                CaptionML=[ENU=General;
                           NOR=Generelt;
                           SVE=AllmÑnt] }

    { 73  ;2   ;Field     ;
                CaptionML=[ENU=Posting Date;
                           NOR=Bokfõringsdato;
                           SVE=Bokfîringsdatum];
                ToolTipML=[ENU=Specifies the posting date of the entry to be applied.;
                           NOR=Angir bokfõringsdatoen for posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens bokfîringsdatum.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry."Posting Date";
                Editable=FALSE }

    { 75  ;2   ;Field     ;
                CaptionML=[ENU=Document Type;
                           NOR=Bilagstype;
                           SVE=Dokumenttyp];
                ToolTipML=[ENU=Specifies the document type of the entry to be applied.;
                           NOR=Angir dokumenttypen for posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens dokumenttyp.];
                OptionCaptionML=[ENU=" ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund";
                                 NOR=" ,Betaling,Faktura,Kreditnota,Rentenota,Purring,Refusjon";
                                 SVE=" ,Betalning,Faktura,Kreditnota,RÑntefaktura,BetalningspÜminnelse,èterbetalning"];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry."Document Type";
                Editable=FALSE }

    { 77  ;2   ;Field     ;
                CaptionML=[ENU=Document No.;
                           NOR=Bilagsnr.;
                           SVE=Dokumentnr];
                ToolTipML=[ENU=Specifies the document number of the entry to be applied.;
                           NOR=Angir bilagsnummeret for posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens dokumentnummer.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry."Document No.";
                Editable=FALSE }

    { 71  ;2   ;Field     ;
                Name=ApplyingVendorNo;
                CaptionML=[ENU=Vendor No.;
                           NOR=Leverandõrnr.;
                           SVE=Leverantîrsnr];
                ToolTipML=[ENU=Specifies the vendor number of the entry to be applied.;
                           NOR=Angir leverandõrnummeret for posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens leverantîr.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry."Vendor No.";
                Visible=FALSE;
                Editable=FALSE }

    { 28  ;2   ;Field     ;
                Name=ApplyingVendorName;
                CaptionML=[ENU=Vendor Name;
                           NOR=Leverandõrnavn;
                           SVE=Leverantîrsnamn];
                ToolTipML=[ENU=Specifies the vendor name of the entry to be applied.;
                           NOR=Angir leverandõrnummeret for oppfõringen som skal brukes.;
                           SVE=Anger den kopplade transaktionens leverantîrsnamn.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry."Vendor Name";
                Visible=VendNameVisible;
                Editable=FALSE }

    { 85  ;2   ;Field     ;
                Name=ApplyingDescription;
                CaptionML=[ENU=Description;
                           NOR=Beskrivelse;
                           SVE=Beskrivning];
                ToolTipML=[ENU=Specifies the description of the entry to be applied.;
                           NOR=Angir beskrivelsen for posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens beskrivning.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry.Description;
                Visible=FALSE;
                Editable=FALSE }

    { 79  ;2   ;Field     ;
                CaptionML=[ENU=Currency Code;
                           NOR=Valutakode;
                           SVE=Valutakod];
                ToolTipML=[ENU=Specifies the code for the currency that amounts are shown in.;
                           NOR=Angir koden for valutaen som belõpene vises i.;
                           SVE=Anger i vilken valuta beloppen visas.];
                ApplicationArea=#Suite;
                SourceExpr=ApplyingVendLedgEntry."Currency Code";
                Editable=FALSE }

    { 81  ;2   ;Field     ;
                CaptionML=[ENU=Amount;
                           NOR=Belõp;
                           SVE=Belopp];
                ToolTipML=[ENU=Specifies the amount on the entry to be applied.;
                           NOR=Angir belõpet pÜ posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens belopp.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry.Amount;
                Editable=FALSE }

    { 83  ;2   ;Field     ;
                CaptionML=[ENU=Remaining Amount;
                           NOR=Restbelõp;
                           SVE=èterstÜende belopp];
                ToolTipML=[ENU=Specifies the amount on the entry to be applied.;
                           NOR=Angir belõpet pÜ posten som skal utlignes.;
                           SVE=Anger den kopplade transaktionens belopp.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingVendLedgEntry."Remaining Amount";
                Editable=FALSE }

    { 1   ;1   ;Group     ;
                GroupType=Repeater }

    { 22  ;2   ;Field     ;
                Name=AppliesToID;
                ToolTipML=[ENU=Specifies the ID of entries that will be applied to when you choose the Apply Entries action.;
                           NOR=Angir ID-en for postene som blir utlignet nÜr du velger handlingen Utlign poster.;
                           SVE=Anger id-numret fîr transaktioner som kommer att tillÑmpas nÑr du vÑljer ÜtgÑrden Koppla transaktioner.];
                ApplicationArea=#All;
                SourceExpr="Applies-to ID";
                Visible=AppliesToIDVisible;
                OnValidate=BEGIN
                             IF (CalcType = CalcType::GenJnlLine) AND (ApplnType = ApplnType::"Applies-to Doc. No.") THEN
                               ERROR(CannotSetAppliesToIDErr);

                             SetVendApplId(TRUE);

                             CurrPage.UPDATE(FALSE);
                           END;
                            }

    { 2   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the vendor entry's posting date.;
                           NOR=Angir leverandõrpostens bokfõringsdato.;
                           SVE=Anger leverantîrstransaktionens bokfîringsdatum.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Posting Date";
                Editable=FALSE }

    { 4   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the document type that the vendor entry belongs to.;
                           NOR=Angir dokumenttypen som leverandõrposten tilhõrer.;
                           SVE=Anger dokumenttypen som leverantîrstransaktionen hîr till.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Document Type";
                Editable=FALSE;
                StyleExpr=StyleTxt }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the vendor entry's document number.;
                           NOR=Angir leverandõrpostens dokumentnummer.;
                           SVE=Anger leverantîrstransaktionens verifikationsnummer.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Document No.";
                Editable=FALSE;
                StyleExpr=StyleTxt }

    { 38  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies a document number that refers to the customer's or vendor's numbering system.;
                           NOR=Angir et dokumentnummer som henviser til kundens eller leverandõrens nummereringssystem.;
                           SVE=Anger ett dokumentnummer som refererar till kundens eller leverantîrens nummersystem.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="External Document No." }

    { 8   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the vendor account that the entry is linked to.;
                           NOR=Angir nummeret pÜ leverandõrkontoen som er knyttet til posten.;
                           SVE=Anger leverantîrskontonumret som transaktionen Ñr kopplad till.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Vendor No.";
                Editable=FALSE }

    { 27  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the name of the vendor account that the entry is linked to.;
                           NOR=Angir nummeret pÜ leverandõrkontoen som er knyttet til oppfõringen.;
                           SVE=Anger leverantîrsnamnet som transaktionen Ñr kopplad till.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Vendor Name";
                Visible=VendNameVisible;
                Editable=FALSE }

    { 1100485000;2;Field  ;
                DrillDown=No;
                SourceExpr="Actual Vendor Name";
                Visible=FALSE }

    { 10  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies a description of the vendor entry.;
                           NOR=Angir en beskrivelse av leverandõrposten.;
                           SVE=En beskrivning av leverantîrstransaktionen.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Description;
                Editable=FALSE }

    { 39  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the currency code for the amount on the line.;
                           NOR=Angir valutakoden for belõpet pÜ linjen.;
                           SVE=Anger valutakoden fîr beloppet pÜ raden.];
                ApplicationArea=#Suite;
                SourceExpr="Currency Code" }

    { 61  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount of the original entry.;
                           NOR=Angir belõpet for den opprinnelige posten.;
                           SVE=Anger den ursprungliga transaktionens belopp.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Original Amount";
                Visible=FALSE;
                Editable=FALSE }

    { 12  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount of the entry.;
                           NOR=Angir belõpet for posten.;
                           SVE=Anger transaktionsbeloppet.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Amount;
                Visible=FALSE;
                Editable=FALSE }

    { 19  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the total of the ledger entries that represent debits.;
                           NOR=Angir summen for postene som representerer debet.;
                           SVE=Anger summan av transaktionerna som representerar debet.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Debit Amount";
                Visible=FALSE }

    { 21  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the total of the ledger entries that represent credits.;
                           NOR=Angir summen for postene som representerer kredit.;
                           SVE=Anger summan av transaktionerna som representerar krediter.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Credit Amount";
                Visible=FALSE }

    { 14  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount that remains to be applied to before the entry is totally applied to.;
                           NOR=Angir belõpet som gjenstÜr Ü bli utlignet, fõr posten utlignes helt.;
                           SVE=Anger beloppet som ÜterstÜr att anvÑnda innan transaktionen Ñr helt anvÑnd.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Remaining Amount";
                Editable=FALSE }

    { 1005;2   ;Field     ;
                SourceExpr="Remaining Amt. (LCY)";
                Visible=FALSE }

    { 33  ;2   ;Field     ;
                CaptionML=[ENU=Appln. Remaining Amount;
                           NOR=Utlign restbelõp;
                           SVE=Koppling Üterst. belopp];
                ToolTipML=[ENU=Specifies the amount that remains to be applied to before the entry is totally applied to.;
                           NOR=Angir belõpet som gjenstÜr Ü bli utlignet, fõr posten utlignes helt.;
                           SVE=Anger beloppet som ÜterstÜr att anvÑnda innan transaktionen Ñr helt anvÑnd.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=CalcApplnRemainingAmount("Remaining Amount");
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode }

    { 90  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount to apply.;
                           NOR=Angir belõpet som skal utlignes.;
                           SVE=Anger belopp att koppla.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Amount to Apply";
                OnValidate=BEGIN
                             CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",Rec);

                             IF (xRec."Amount to Apply" = 0) OR ("Amount to Apply" = 0) AND
                                ((ApplnType = ApplnType::"Applies-to ID") OR (CalcType = CalcType::Direct))
                             THEN
                               SetVendApplId(FALSE);
                             GET("Entry No.");
                             AmountToApplyOnAfterValidate;
                           END;
                            }

    { 92  ;2   ;Field     ;
                Name=ApplnAmountToApply;
                CaptionML=[ENU=Appln. Amount to Apply;
                           NOR=Belõp som skal utlignes;
                           SVE=Belopp att koppla];
                ToolTipML=[ENU=Specifies the amount to apply.;
                           NOR=Angir belõpet som skal utlignes.;
                           SVE=Anger belopp att koppla.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=CalcApplnAmountToApply("Amount to Apply");
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode }

    { 16  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the due date on the entry.;
                           NOR=Angir forfallsdatoen pÜ posten.;
                           SVE=Anger transaktionens fîrfallodatum.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Due Date";
                StyleExpr=StyleTxt }

    { 18  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the date on which the amount in the entry must be paid for a payment discount to be granted.;
                           NOR=Angir datoen da belõpet i posten mÜ vëre betalt for at det kan oppnÜs kontantrabatt.;
                           SVE=Anger datumet dÜ transaktionens belopp mÜste vara betalt fîr att kassarabatten pÜ ordern ska gÑlla.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Pmt. Discount Date";
                OnValidate=BEGIN
                             RecalcApplnAmount;
                           END;
                            }

    { 66  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the latest date the amount in the entry must be paid in order for payment discount tolerance to be granted.;
                           NOR=Angir den seneste datoen da belõpet i posten mÜ vëre betalt for at det kan oppnÜs kontantrabatt.;
                           SVE=Anger det sista datumet dÜ transaktionens belopp mÜste vara betalt fîr att kassarabattoleransen ska gÑlla.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Pmt. Disc. Tolerance Date" }

    { 3   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the payment of the purchase invoice.;
                           NOR=Angir betalingen for kjõpsfakturaen.;
                           SVE=Anger betalningen av inkîpsfakturan.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Payment Reference" }

    { 20  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the discount that you can obtain if the entry is applied to before the payment discount date.;
                           NOR=Angir rabatten som du kan oppnÜ hvis posten blir utlignet fõr kontantrabattdatoen.;
                           SVE=Anger den rabatt som du kan fÜ om transaktionen anvÑnds fîre datumet fîr kassarabatt.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Original Pmt. Disc. Possible";
                Visible=FALSE }

    { 64  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the remaining payment discount which can be received if the payment is made before the payment discount date.;
                           NOR=Angir resterende kontantrabatt som kan mottas hvis betalingen foretas fõr kontantrabattdatoen.;
                           SVE=Anger den ÜterstÜende kassarabatt som kan erhÜllas om betalningen gîrs fîre kassarabattsdatumet.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Remaining Pmt. Disc. Possible";
                OnValidate=BEGIN
                             RecalcApplnAmount;
                           END;
                            }

    { 51  ;2   ;Field     ;
                CaptionML=[ENU=Appln. Pmt. Disc. Possible;
                           NOR=Mulig utlign.kont.rabatt;
                           SVE=Kopp. erbjudet kassarab.belopp];
                ToolTipML=[ENU=Specifies the discount that you can obtain if the entry is applied to before the payment discount date.;
                           NOR=Angir rabatten som du kan oppnÜ hvis posten blir utlignet fõr kontantrabattdatoen.;
                           SVE=Anger den rabatt som du kan fÜ om transaktionen anvÑnds fîre datumet fîr kassarabatt.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=CalcApplnRemainingAmount("Remaining Pmt. Disc. Possible");
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode }

    { 68  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the maximum tolerated amount the entry can differ from the amount on the invoice or credit memo.;
                           NOR=Angir det maksimalt tillatte belõpet som posten kan avvike fra belõpet pÜ fakturaen eller kreditnotaen.;
                           SVE=Anger det hîgsta tolererade beloppet som posten fÜr avvika frÜn beloppet pÜ fakturan eller kreditnotan.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Max. Payment Tolerance" }

    { 24  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies whether the amount on the entry has been fully paid or there is still a remaining amount that must be applied to.;
                           NOR=Angir om posten er helt utlignet, eller om det stadig gjenstÜr Ü utligne et belõp.;
                           SVE=Anger om postens belopp har betalats eller om det ÜterstÜr ett belopp som mÜste betalas.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Open;
                Editable=FALSE }

    { 26  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies if the entry to be applied is positive.;
                           NOR=Angir om posten som skal utlignes er positiv.;
                           SVE=Anger om transaktionen som kopplas Ñr positiv.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Positive;
                Editable=FALSE }

    { 56  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the code for the global dimension that is linked to the record or entry for analysis purposes. Two global dimensions, typically for the company's most important activities, are available on all cards, documents, reports, and lists.;
                           NOR=Angir koden for den globale dimensjonen som er koblet til posten eller oppfõringen for analyse. To globale dimensjoner, vanligvis for selskapets viktigste aktiviteter, er tilgjengelige pÜ alle kort, dokumenter, rapporter og lister.;
                           SVE=Anger koden fîr den globala dimension som Ñr kopplad till posten eller transaktionen fîr analys. TvÜ globala dimensioner, vanligtvis fîr fîretagets viktigaste aktiviteter, finns pÜ alla kort, dokument, rapporter och listor.];
                ApplicationArea=#Dimensions;
                SourceExpr="Global Dimension 1 Code";
                OnValidate=BEGIN
                             //**4PS Generated Code. Do Not Change.sn03
                             DPA_ChkDepartmentCodeAllowed(DPA_IsHardFilter);
                             //**4PS Generated Code.en03
                           END;
                            }

    { 59  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the code for the global dimension that is linked to the record or entry for analysis purposes. Two global dimensions, typically for the company's most important activities, are available on all cards, documents, reports, and lists.;
                           NOR=Angir koden for den globale dimensjonen som er koblet til posten eller oppfõringen for analyse. To globale dimensjoner, vanligvis for selskapets viktigste aktiviteter, er tilgjengelige pÜ alle kort, dokumenter, rapporter og lister.;
                           SVE=Anger koden fîr den globala dimension som Ñr kopplad till posten eller transaktionen fîr analys. TvÜ globala dimensioner, vanligtvis fîr fîretagets viktigaste aktiviteter, finns pÜ alla kort, dokument, rapporter och listor.];
                ApplicationArea=#Dimensions;
                SourceExpr="Global Dimension 2 Code" }

    { 41  ;1   ;Group      }

    { 1903222401;2;Group  ;
                GroupType=FixedLayout }

    { 1903866701;3;Group  ;
                CaptionML=[ENU=Appln. Currency;
                           NOR=Utlign. valuta;
                           SVE=Koppling valuta] }

    { 49  ;4   ;Field     ;
                ToolTipML=[ENU=Specifies the currency code that the amount will be applied in, in case of different currencies.;
                           NOR=Angir valutakoden som belõpet skal utlignes i, i tilfelle forskjellige valutaer.;
                           SVE=Anger valutakoden som beloppet kopplas till i hÑndelse av olika valutor.];
                ApplicationArea=#Suite;
                SourceExpr=ApplnCurrencyCode;
                TableRelation=Currency;
                Editable=FALSE;
                ShowCaption=No }

    { 1900545201;3;Group  ;
                CaptionML=[ENU=Amount to Apply;
                           NOR=Belõp som skal utlignes;
                           SVE=Belopp att koppla] }

    { 45  ;4   ;Field     ;
                Name=AmountToApply;
                CaptionML=[ENU=Amount to Apply;
                           NOR=Belõp som skal utlignes;
                           SVE=Belopp att koppla];
                ToolTipML=[ENU=Specifies the sum of the amounts on all the selected vendor ledger entries that will be applied by the entry shown in the Available Amount field. The amount is in the currency represented by the code in the Currency Code field.;
                           NOR=Angir summen av belõpene for alle valgte leverandõrposter som skal utlignes av posten i Disponibelt belõp-feltet. Belõpet er i valutaen angitt av koden i Valutakode-feltet.;
                           SVE=Anger summan av beloppen fîr alla valda leverantîrsreskontratransaktioner som kopplas till transaktionen som visas i fÑltet Disponibelt belopp. Beloppet Ñr i valutan som representeras av koden i fÑltet Valutakod.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=AppliedAmount;
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode;
                Editable=FALSE }

    { 1903099901;3;Group  ;
                CaptionML=[ENU=Pmt. Disc. Amount;
                           NOR=Betalingsrabattbelõp;
                           SVE=Kassarabattbelopp] }

    { 94  ;4   ;Field     ;
                Name=PmtDiscountAmount;
                CaptionML=[ENU=Pmt. Disc. Amount;
                           NOR=Betalingsrabattbelõp;
                           SVE=Kassarabattbelopp];
                ToolTipML=[ENU=Specifies the sum of the payment discount amounts granted on all the selected vendor ledger entries that will be applied by the entry shown in the Available Amount field. The amount is in the currency represented by the code in the Currency Code field.;
                           NOR=Angir summen av kontantrabattbelõpene som er gitt for alle valgte leverandõrposter som skal utlignes av posten i Disponibelt belõp-feltet. Belõpet er i valutaen angitt av koden i Valutakode-feltet.;
                           SVE=Anger summan av beloppen fîr beviljade kassarabatter pÜ alla valda leverantîrsreskontratransaktioner som kopplas till transaktionen som visas i fÑltet Disponibelt belopp. Beloppet Ñr i valutan som representeras av koden i fÑltet Valutakod.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=-PmtDiscAmount;
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode;
                Editable=FALSE }

    { 1901652301;3;Group  ;
                CaptionML=[ENU=Rounding;
                           NOR=Avrunding;
                           SVE=Avrundning] }

    { 53  ;4   ;Field     ;
                CaptionML=[ENU=Rounding;
                           NOR=Avrunding;
                           SVE=Avrundning];
                ToolTipML=[ENU=Specifies the rounding difference when you apply entries in different currencies to one another. The amount is in the currency represented by the code in the Currency Code field.;
                           NOR=Angir avrundingsdifferansen nÜr du utligner poster i forskjellige valutaer mot hverandre. Belõpet er i valutaen angitt av koden i Valutakode-feltet.;
                           SVE=Anger avrundningsdifferensen nÑr du kopplar transaktioner i olika valutor till varandra. Beloppet Ñr i valutan som representeras av koden i fÑltet Valutakod.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplnRounding;
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode;
                Editable=FALSE }

    { 1901992701;3;Group  ;
                CaptionML=[ENU=Applied Amount;
                           NOR=Utlignet belõp;
                           SVE=Kopplat belopp] }

    { 98  ;4   ;Field     ;
                Name=AppliedAmount;
                CaptionML=[ENU=Applied Amount;
                           NOR=Utlignet belõp;
                           SVE=Kopplat belopp];
                ToolTipML=[ENU=Specifies the sum of the amounts in the Amount to Apply field, Pmt. Disc. Amount field, and the Rounding. The amount is in the currency represented by the code in the Currency Code field.;
                           NOR=Angir summen av belõpene i feltene Belõp som skal utlignes, Betalingsrabattbelõp og Avrunding. Belõpet er i valutaen angitt av koden i Valutakode-feltet.;
                           SVE=Anger summan av beloppen i fÑlten Belopp att koppla, Kassarabattbelopp och Avrundning. Beloppet visas i valutan som motsvaras av koden i fÑltet Valutakod.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=AppliedAmount + (-PmtDiscAmount) + ApplnRounding;
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode;
                Editable=FALSE }

    { 1900295601;3;Group  ;
                CaptionML=[ENU=Available Amount;
                           NOR=Disponibelt belõp;
                           SVE=Disponibelt belopp] }

    { 47  ;4   ;Field     ;
                CaptionML=[ENU=Available Amount;
                           NOR=Disponibelt belõp;
                           SVE=Disponibelt belopp];
                ToolTipML=[ENU=Specifies the amount of the journal entry, purchase credit memo, or current vendor ledger entry that you have selected as the applying entry.;
                           NOR=Angir belõpet for kladdeposten, kjõpskreditnotaen eller den gjeldende leverandõrposten du har valgt som utligningspost.;
                           SVE=Anger beloppet fîr journaltransaktionen, inkîpskreditnotan eller den aktuella leverantîrsreskontratransaktionen som du har valt som kopplingstransaktion.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplyingAmount;
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode;
                Editable=FALSE }

    { 1901652401;3;Group  ;
                CaptionML=[ENU=Balance;
                           NOR=Saldo;
                           SVE=Saldo] }

    { 43  ;4   ;Field     ;
                Name=ControlBalance;
                CaptionML=[ENU=Balance;
                           NOR=Saldo;
                           SVE=Saldo];
                ToolTipML=[ENU=Specifies any extra amount that will remain after the application.;
                           NOR=Angir det eventuelle overskytende belõpet etter at utligningen er gjennomfõrt.;
                           SVE=Anger eventuella extra belopp som stÜr kvar efter kopplingen.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=AppliedAmount + (-PmtDiscAmount) + ApplyingAmount + ApplnRounding;
                AutoFormatType=1;
                AutoFormatExpr=ApplnCurrencyCode;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      ApplyingVendLedgEntry@1033 : TEMPORARY Record 25;
      AppliedVendLedgEntry@1001 : Record 25;
      Currency@1002 : Record 4;
      CurrExchRate@1003 : Record 330;
      GenJnlLine@1004 : Record 81;
      GenJnlLine2@1005 : Record 81;
      PurchHeader@1006 : Record 38;
      Vend@1007 : Record 23;
      VendLedgEntry@1008 : Record 25;
      GLSetup@1009 : Record 98;
      PurchSetup@1047 : Record 312;
      TotalPurchLine@1010 : Record 39;
      TotalPurchLineLCY@1011 : Record 39;
      VendEntrySetApplID@1013 : Codeunit 111;
      GenJnlApply@1014 : Codeunit 225;
      PurchPost@1015 : Codeunit 90;
      PaymentToleranceMgt@1037 : Codeunit 426;
      Navigate@1012 : Page 344;
      GenJnlLineApply@1016 : Boolean;
      AppliedAmount@1017 : Decimal;
      ApplyingAmount@1018 : Decimal;
      PmtDiscAmount@1040 : Decimal;
      ApplnDate@1019 : Date;
      ApplnCurrencyCode@1020 : Code[10];
      ApplnRoundingPrecision@1021 : Decimal;
      ApplnRounding@1022 : Decimal;
      ApplnType@1023 : ' ,Applies-to Doc. No.,Applies-to ID';
      AmountRoundingPrecision@1024 : Decimal;
      VATAmount@1025 : Decimal;
      VATAmountText@1026 : Text[30];
      StyleTxt@1031 : Text;
      CalcType@1027 : 'Direct,GenJnlLine,PurchHeader';
      VendEntryApplID@1029 : Code[50];
      AppliesToID@1042 : Code[50];
      ValidExchRate@1030 : Boolean;
      DifferentCurrenciesInAppln@1032 : Boolean;
      Text002@1036 : TextConst 'ENU=You must select an applying entry before you can post the application.;NOR=Du mÜ velge en utligningspost fõr du kan bokfõre utligningen.;SVE=Du mÜste vÑlja en kopplingstransaktion innan du kan bokfîra kopplingen.';
      Text003@1035 : TextConst 'ENU=You must post the application from the window where you entered the applying entry.;NOR=Du mÜ bokfõre utligningen fra vinduet der du angav utligningsposten.;SVE=Du mÜste bokfîra kopplingen i det fînster dÑr du registrerade kopplingstransaktionen.';
      CannotSetAppliesToIDErr@1038 : TextConst 'ENU=You cannot set Applies-to ID while selecting Applies-to Doc. No.;NOR=Du kan ikke angi utlignings-ID nÜr du velger utligningsbilagsnummer.;SVE=Du fÜr inte ange Koppla till ID nÑr du vÑljer Kopplas till ver.nr.';
      ShowAppliedEntries@1039 : Boolean;
      OK@1028 : Boolean;
      EarlierPostingDateErr@1034 : TextConst 'ENU=You cannot apply and post an entry to an entry with an earlier posting date.\\Instead, post the document of type %1 with the number %2 and then apply it to the document of type %3 with the number %4.;NOR=Du kan ikke utligne og bokfõre en post mot en post med en tidligere bokfõringsdato.\\I stedet mÜ du bokfõre dokumentet av typen %1 med nummeret %2 og deretter utligne det mot dokumentet av typen %3 med nummeret %4.;SVE=Det gÜr inte att koppla och bokfîra en transaktion till en transaktion med ett tidigare bokfîringsdatum.\\Bokfîr i stÑllet dokumentet av typen %1 med numret %2 och koppla det till dokumentet av typen %3 med numret %4.';
      PostingDone@1000 : Boolean;
      AppliesToIDVisible@19043506 : Boolean INDATASET;
      DPA_IsHardFilter@1100000999 : Boolean;
      ActionPerformed@1104 : Boolean;
      Text012@1043 : TextConst 'ENU=The application was successfully posted.;NOR=Utligningen ble bokfõrt pÜ riktig mÜte.;SVE=Kopplingen Ñr bokfîrd.';
      Text013@1044 : TextConst 'ENU=The %1 entered must not be before the %1 on the %2.;NOR=%1 som er angitt, kan ikke komme fõr %1 pÜ %2.;SVE=Det angivna %1 fÜr inte vara fîre %1 pÜ %2.';
      Text019@1045 : TextConst 'ENU=Post application process has been canceled.;NOR=Etterutligningsprosessen er avbrutt.;SVE=Processen Bokfîr kopplade trans. har avbrutits.';
      IsOfficeAddin@1041 : Boolean;
      HasDocumentAttachment@1046 : Boolean;
      VendNameVisible@1048 : Boolean;

    [External]
    PROCEDURE SetGenJnlLine@1(NewGenJnlLine@1000 : Record 81;ApplnTypeSelect@1001 : Integer);
    BEGIN
      GenJnlLine := NewGenJnlLine;
      GenJnlLineApply := TRUE;

      IF GenJnlLine."Account Type" = GenJnlLine."Account Type"::Vendor THEN
        ApplyingAmount := GenJnlLine.Amount;
      IF GenJnlLine."Bal. Account Type" = GenJnlLine."Bal. Account Type"::Vendor THEN
        ApplyingAmount := -GenJnlLine.Amount;
      ApplnDate := GenJnlLine."Posting Date";
      ApplnCurrencyCode := GenJnlLine."Currency Code";
      CalcType := CalcType::GenJnlLine;

      CASE ApplnTypeSelect OF
        GenJnlLine.FIELDNO("Applies-to Doc. No."):
          ApplnType := ApplnType::"Applies-to Doc. No.";
        GenJnlLine.FIELDNO("Applies-to ID"):
          ApplnType := ApplnType::"Applies-to ID";
      END;

      SetApplyingVendLedgEntry;
    END;

    [External]
    PROCEDURE SetPurch@2(NewPurchHeader@1000 : Record 38;VAR NewVendLedgEntry@1001 : Record 25;ApplnTypeSelect@1002 : Integer);
    BEGIN
      PurchHeader := NewPurchHeader;
      COPYFILTERS(NewVendLedgEntry);

      PurchPost.SumPurchLines(
        PurchHeader,0,TotalPurchLine,TotalPurchLineLCY,
        VATAmount,VATAmountText);

      CASE PurchHeader."Document Type" OF
        PurchHeader."Document Type"::"Return Order",
        PurchHeader."Document Type"::"Credit Memo":
          ApplyingAmount := TotalPurchLine."Amount Including VAT"
        ELSE
          ApplyingAmount := -TotalPurchLine."Amount Including VAT";
      END;

      ApplnDate := PurchHeader."Posting Date";
      ApplnCurrencyCode := PurchHeader."Currency Code";
      CalcType := CalcType::PurchHeader;

      CASE ApplnTypeSelect OF
        PurchHeader.FIELDNO("Applies-to Doc. No."):
          ApplnType := ApplnType::"Applies-to Doc. No.";
        PurchHeader.FIELDNO("Applies-to ID"):
          ApplnType := ApplnType::"Applies-to ID";
      END;

      SetApplyingVendLedgEntry;
    END;

    [External]
    PROCEDURE SetVendLedgEntry@13(NewVendLedgEntry@1000 : Record 25);
    BEGIN
      Rec := NewVendLedgEntry;
    END;

    [External]
    PROCEDURE SetApplyingVendLedgEntry@9();
    VAR
      Vendor@1001 : Record 23;
    BEGIN
      OnBeforeSetApplyingVendLedgEntry(ApplyingVendLedgEntry,GenJnlLine);

      CASE CalcType OF
        CalcType::PurchHeader:
          BEGIN
            ApplyingVendLedgEntry."Posting Date" := PurchHeader."Posting Date";
            IF PurchHeader."Document Type" = PurchHeader."Document Type"::"Return Order" THEN
              ApplyingVendLedgEntry."Document Type" := PurchHeader."Document Type"::"Credit Memo"
            ELSE
              ApplyingVendLedgEntry."Document Type" := PurchHeader."Document Type";
            ApplyingVendLedgEntry."Document No." := PurchHeader."No.";
            ApplyingVendLedgEntry."Vendor No." := PurchHeader."Pay-to Vendor No.";
            ApplyingVendLedgEntry.Description := PurchHeader."Posting Description";
            ApplyingVendLedgEntry."Currency Code" := PurchHeader."Currency Code";
            IF ApplyingVendLedgEntry."Document Type" = ApplyingVendLedgEntry."Document Type"::"Credit Memo" THEN  BEGIN
              ApplyingVendLedgEntry.Amount := TotalPurchLine."Amount Including VAT";
              ApplyingVendLedgEntry."Remaining Amount" := TotalPurchLine."Amount Including VAT";
            END ELSE BEGIN
              ApplyingVendLedgEntry.Amount := -TotalPurchLine."Amount Including VAT";
              ApplyingVendLedgEntry."Remaining Amount" := -TotalPurchLine."Amount Including VAT";
            END;
            CalcApplnAmount;
          END;
        CalcType::Direct:
          BEGIN
            IF "Applying Entry" THEN BEGIN
              IF ApplyingVendLedgEntry."Entry No." <> 0 THEN
                VendLedgEntry := ApplyingVendLedgEntry;
              CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",Rec);
              IF "Applies-to ID" = '' THEN
                SetVendApplId(FALSE);
              CALCFIELDS(Amount);
              ApplyingVendLedgEntry := Rec;
              IF VendLedgEntry."Entry No." <> 0 THEN BEGIN
                Rec := VendLedgEntry;
                "Applying Entry" := FALSE;
                SetVendApplId(FALSE);
              END;
              SETFILTER("Entry No.",'<> %1',ApplyingVendLedgEntry."Entry No.");
              ApplyingAmount := ApplyingVendLedgEntry."Remaining Amount";
              ApplnDate := ApplyingVendLedgEntry."Posting Date";
              ApplnCurrencyCode := ApplyingVendLedgEntry."Currency Code";
            END;
            CalcApplnAmount;
          END;
        CalcType::GenJnlLine:
          BEGIN
            ApplyingVendLedgEntry."Posting Date" := GenJnlLine."Posting Date";
            ApplyingVendLedgEntry."Document Type" := GenJnlLine."Document Type";
            ApplyingVendLedgEntry."Document No." := GenJnlLine."Document No.";
            IF GenJnlLine."Bal. Account Type" = GenJnlLine."Bal. Account Type"::Vendor THEN BEGIN
              ApplyingVendLedgEntry."Vendor No." := GenJnlLine."Bal. Account No.";
              Vendor.GET(ApplyingVendLedgEntry."Vendor No.");
              ApplyingVendLedgEntry.Description := Vendor.Name;
            END ELSE BEGIN
              ApplyingVendLedgEntry."Vendor No." := GenJnlLine."Account No.";
              ApplyingVendLedgEntry.Description := GenJnlLine.Description;
            END;
            ApplyingVendLedgEntry."Currency Code" := GenJnlLine."Currency Code";
            ApplyingVendLedgEntry.Amount := GenJnlLine.Amount;
            ApplyingVendLedgEntry."Remaining Amount" := GenJnlLine.Amount;
            CalcApplnAmount;
          END;
      END;
    END;

    [External]
    PROCEDURE SetVendApplId@10(CurrentRec@1000 : Boolean);
    VAR
      RaiseError@1001 : Boolean;
    BEGIN
      IF CalcType = CalcType::GenJnlLine THEN BEGIN
        RaiseError := ApplyingVendLedgEntry."Posting Date" < "Posting Date";
        OnBeforeEarlierPostingDateError(ApplyingVendLedgEntry,Rec,RaiseError,CalcType);
        IF RaiseError THEN
          ERROR(
            EarlierPostingDateErr,ApplyingVendLedgEntry."Document Type",ApplyingVendLedgEntry."Document No.",
            "Document Type","Document No.");
      END;

      IF ApplyingVendLedgEntry."Entry No." <> 0 THEN
        GenJnlApply.CheckAgainstApplnCurrency(
          ApplnCurrencyCode,"Currency Code",GenJnlLine."Account Type"::Vendor,TRUE);

      VendLedgEntry.COPY(Rec);
      IF CurrentRec THEN
        VendLedgEntry.SETRECFILTER
      ELSE
        CurrPage.SETSELECTIONFILTER(VendLedgEntry);
      IF GenJnlLineApply THEN
        VendEntrySetApplID.SetApplId(VendLedgEntry,ApplyingVendLedgEntry,GenJnlLine."Applies-to ID")
      ELSE
        VendEntrySetApplID.SetApplId(VendLedgEntry,ApplyingVendLedgEntry,PurchHeader."Applies-to ID");

      ActionPerformed := VendLedgEntry."Applies-to ID" <> '';
      CalcApplnAmount;
    END;

    LOCAL PROCEDURE CalcApplnAmount@7();
    BEGIN
      OnBeforeCalcApplnAmount(Rec,GenJnlLine);

      AppliedAmount := 0;
      PmtDiscAmount := 0;
      DifferentCurrenciesInAppln := FALSE;

      CASE CalcType OF
        CalcType::Direct:
          BEGIN
            FindAmountRounding;
            VendEntryApplID := USERID;
            IF VendEntryApplID = '' THEN
              VendEntryApplID := '***';

            VendLedgEntry := ApplyingVendLedgEntry;

            AppliedVendLedgEntry.SETCURRENTKEY("Vendor No.",Open,Positive);
            AppliedVendLedgEntry.SETRANGE("Vendor No.","Vendor No.");
            AppliedVendLedgEntry.SETRANGE(Open,TRUE);
            IF AppliesToID = '' THEN
              AppliedVendLedgEntry.SETRANGE("Applies-to ID",VendEntryApplID)
            ELSE
              AppliedVendLedgEntry.SETRANGE("Applies-to ID",AppliesToID);

            IF ApplyingVendLedgEntry."Entry No." <> 0 THEN BEGIN
              VendLedgEntry.CALCFIELDS("Remaining Amount");
              AppliedVendLedgEntry.SETFILTER("Entry No.",'<>%1',VendLedgEntry."Entry No.");
            END;

            HandleChosenEntries(0,VendLedgEntry."Remaining Amount",VendLedgEntry."Currency Code",VendLedgEntry."Posting Date");
          END;
        CalcType::GenJnlLine:
          BEGIN
            FindAmountRounding;
            IF GenJnlLine."Bal. Account Type" = GenJnlLine."Bal. Account Type"::Vendor THEN
              CODEUNIT.RUN(CODEUNIT::"Exchange Acc. G/L Journal Line",GenJnlLine);

            CASE ApplnType OF
              ApplnType::"Applies-to Doc. No.":
                BEGIN
                  AppliedVendLedgEntry := Rec;
                  WITH AppliedVendLedgEntry DO BEGIN
                    CALCFIELDS("Remaining Amount");
                    IF "Currency Code" <> ApplnCurrencyCode THEN BEGIN
                      "Remaining Amount" :=
                        CurrExchRate.ExchangeAmtFCYToFCY(
      //                  ApplnDate,"Currency Code",ApplnCurrencyCode,"Remaining Amount"); //**4PS.o
                          ApplnDate,"Currency Code",ApplnCurrencyCode,"Remaining Amount",FALSE); //**4PS.n
                      "Remaining Pmt. Disc. Possible" :=
                        CurrExchRate.ExchangeAmtFCYToFCY(
      //                  ApplnDate,"Currency Code",ApplnCurrencyCode,"Remaining Pmt. Disc. Possible"); //**4PS.o
                          ApplnDate,"Currency Code",ApplnCurrencyCode,"Remaining Pmt. Disc. Possible",FALSE); //**4PS.n
                      //**4PS.sn
                      "Remain. Pmt. Disc. Possible 2" :=
                        CurrExchRate.ExchangeAmtFCYToFCY(
                          ApplnDate,"Currency Code",ApplnCurrencyCode,"Remain. Pmt. Disc. Possible 2",FALSE);
                      "Remain. Pmt. Disc. Possible 3" :=
                        CurrExchRate.ExchangeAmtFCYToFCY(
                          ApplnDate,"Currency Code",ApplnCurrencyCode,"Remain. Pmt. Disc. Possible 3",FALSE);
                      //**4PS.en
                      "Amount to Apply" :=
                        CurrExchRate.ExchangeAmtFCYToFCY(
      //                  ApplnDate,"Currency Code",ApplnCurrencyCode,"Amount to Apply"); //**4PS.o
                          ApplnDate,"Currency Code",ApplnCurrencyCode,"Amount to Apply",FALSE); //**4PS.n
                    END;

                    IF "Amount to Apply" <> 0 THEN
                      AppliedAmount := ROUND("Amount to Apply",AmountRoundingPrecision)
                    ELSE
                      AppliedAmount := ROUND("Remaining Amount",AmountRoundingPrecision);

                    IF PaymentToleranceMgt.CheckCalcPmtDiscGenJnlVend(
                         //GenJnlLine,AppliedVendLedgEntry,0,FALSE) AND //**4PS.o
                         GenJnlLine,AppliedVendLedgEntry,0,FALSE,0) AND //**4PS.n
                       ((ABS(GenJnlLine.Amount) + ApplnRoundingPrecision >=
                         ABS(AppliedAmount - "Remaining Pmt. Disc. Possible")) OR
                        (GenJnlLine.Amount = 0))
                    THEN
                      PmtDiscAmount := "Remaining Pmt. Disc. Possible"
                    //**4PS.sn
                    ELSE
                      IF PaymentToleranceMgt.CheckCalcPmtDiscGenJnlVend(
                         GenJnlLine,AppliedVendLedgEntry,0,FALSE,1) AND
                         ((ABS(GenJnlLine.Amount) + ApplnRoundingPrecision >=
                         ABS(AppliedAmount - "Remain. Pmt. Disc. Possible 2")) OR
                         (GenJnlLine.Amount = 0))
                      THEN
                        PmtDiscAmount := "Remain. Pmt. Disc. Possible 2"
                      ELSE
                        IF PaymentToleranceMgt.CheckCalcPmtDiscGenJnlVend(
                           GenJnlLine,AppliedVendLedgEntry,0,FALSE,2) AND
                           ((ABS(GenJnlLine.Amount) + ApplnRoundingPrecision >=
                           ABS(AppliedAmount - "Remain. Pmt. Disc. Possible 3")) OR
                           (GenJnlLine.Amount = 0))
                        THEN
                          PmtDiscAmount := "Remain. Pmt. Disc. Possible 3";
                    //**4PS.en

                    IF NOT DifferentCurrenciesInAppln THEN
                      DifferentCurrenciesInAppln := ApplnCurrencyCode <> "Currency Code";
                  END;
                  CheckRounding;
                END;
              ApplnType::"Applies-to ID":
                BEGIN
                  GenJnlLine2 := GenJnlLine;
                  AppliedVendLedgEntry.SETCURRENTKEY("Vendor No.",Open,Positive);
                  AppliedVendLedgEntry.SETRANGE("Vendor No.",GenJnlLine."Account No.");
                  AppliedVendLedgEntry.SETRANGE(Open,TRUE);
                  AppliedVendLedgEntry.SETRANGE("Applies-to ID",GenJnlLine."Applies-to ID");

                  HandleChosenEntries(1,GenJnlLine2.Amount,GenJnlLine2."Currency Code",GenJnlLine2."Posting Date");
                END;
            END;
          END;
        CalcType::PurchHeader:
          BEGIN
            FindAmountRounding;

            CASE ApplnType OF
              ApplnType::"Applies-to Doc. No.":
                BEGIN
                  AppliedVendLedgEntry := Rec;
                  WITH AppliedVendLedgEntry DO BEGIN
                    CALCFIELDS("Remaining Amount");

                    IF "Currency Code" <> ApplnCurrencyCode THEN
                      "Remaining Amount" :=
                        CurrExchRate.ExchangeAmtFCYToFCY(
      //                  ApplnDate,"Currency Code",ApplnCurrencyCode,"Remaining Amount"); //**4PS.o
                          ApplnDate,"Currency Code",ApplnCurrencyCode,"Remaining Amount",FALSE); //**4PS.n

                    AppliedAmount := AppliedAmount + ROUND("Remaining Amount",AmountRoundingPrecision);

                    IF NOT DifferentCurrenciesInAppln THEN
                      DifferentCurrenciesInAppln := ApplnCurrencyCode <> "Currency Code";
                  END;
                  CheckRounding;
                END;
              ApplnType::"Applies-to ID":
                WITH VendLedgEntry DO BEGIN
                  AppliedVendLedgEntry.SETCURRENTKEY("Vendor No.",Open,Positive);
                  AppliedVendLedgEntry.SETRANGE("Vendor No.",PurchHeader."Pay-to Vendor No.");
                  AppliedVendLedgEntry.SETRANGE(Open,TRUE);
                  AppliedVendLedgEntry.SETRANGE("Applies-to ID",PurchHeader."Applies-to ID");

                  HandleChosenEntries(2,ApplyingAmount,ApplnCurrencyCode,ApplnDate);
                END;
            END;
          END;
      END;

      OnAfterCalcApplnAmount(Rec,AppliedAmount,ApplyingAmount);
    END;

    LOCAL PROCEDURE CalcApplnRemainingAmount@4(Amount@1000 : Decimal) : Decimal;
    VAR
      ApplnRemainingAmount@1001 : Decimal;
    BEGIN
      ValidExchRate := TRUE;
      IF ApplnCurrencyCode = "Currency Code" THEN
        EXIT(Amount);

      IF ApplnDate = 0D THEN
        ApplnDate := "Posting Date";
      ApplnRemainingAmount :=
        CurrExchRate.ApplnExchangeAmtFCYToFCY(
      //  ApplnDate,"Currency Code",ApplnCurrencyCode,Amount,ValidExchRate); //**4PS.o
          ApplnDate,"Currency Code",ApplnCurrencyCode,Amount,ValidExchRate,FALSE); //**4PS.n

      OnAfterCalcApplnRemainingAmount(Rec,ApplnRemainingAmount);
      EXIT(ApplnRemainingAmount);
    END;

    LOCAL PROCEDURE CalcApplnAmountToApply@11(AmountToApply@1000 : Decimal) : Decimal;
    VAR
      ApplnAmountToApply@1001 : Decimal;
    BEGIN
      ValidExchRate := TRUE;

      IF ApplnCurrencyCode = "Currency Code" THEN
        EXIT(AmountToApply);

      IF ApplnDate = 0D THEN
        ApplnDate := "Posting Date";
      ApplnAmountToApply :=
        CurrExchRate.ApplnExchangeAmtFCYToFCY(
        //ApplnDate,"Currency Code",ApplnCurrencyCode,AmounttoApply,ValidExchRate); //**4PS.o
          ApplnDate,"Currency Code",ApplnCurrencyCode,AmountToApply,ValidExchRate,FALSE); //**4PS.n

      OnAfterCalcApplnAmountToApply(Rec,AmountToApply);
      EXIT(ApplnAmountToApply);
    END;

    LOCAL PROCEDURE FindAmountRounding@6();
    BEGIN
      IF ApplnCurrencyCode = '' THEN BEGIN
        Currency.INIT;
        Currency.Code := '';
        Currency.InitRoundingPrecision;
      END ELSE
        IF ApplnCurrencyCode <> Currency.Code THEN
          Currency.GET(ApplnCurrencyCode);

      AmountRoundingPrecision := Currency."Amount Rounding Precision";
    END;

    [External]
    PROCEDURE CheckRounding@3();
    BEGIN
      ApplnRounding := 0;

      CASE CalcType OF
        CalcType::PurchHeader:
          EXIT;
        CalcType::GenJnlLine:
          IF (GenJnlLine."Document Type" <> GenJnlLine."Document Type"::Payment) AND
             (GenJnlLine."Document Type" <> GenJnlLine."Document Type"::Refund)
          THEN
            EXIT;
      END;

      IF ApplnCurrencyCode = '' THEN
        ApplnRoundingPrecision := GLSetup."Appln. Rounding Precision"
      ELSE BEGIN
        IF ApplnCurrencyCode <> "Currency Code" THEN
          Currency.GET(ApplnCurrencyCode);
        ApplnRoundingPrecision := Currency."Appln. Rounding Precision";
      END;

      IF (ABS((AppliedAmount - PmtDiscAmount) + ApplyingAmount) <= ApplnRoundingPrecision) AND DifferentCurrenciesInAppln THEN
        ApplnRounding := -((AppliedAmount - PmtDiscAmount) + ApplyingAmount);
    END;

    [External]
    PROCEDURE GetVendLedgEntry@5(VAR VendLedgEntry@1000 : Record 25);
    BEGIN
      VendLedgEntry := Rec;
    END;

    LOCAL PROCEDURE FindApplyingEntry@12();
    BEGIN
      IF CalcType = CalcType::Direct THEN BEGIN
        VendEntryApplID := USERID;
        IF VendEntryApplID = '' THEN
          VendEntryApplID := '***';

        VendLedgEntry.SETCURRENTKEY("Vendor No.","Applies-to ID",Open);
        VendLedgEntry.SETRANGE("Vendor No.","Vendor No.");
        IF AppliesToID = '' THEN
          VendLedgEntry.SETRANGE("Applies-to ID",VendEntryApplID)
        ELSE
          VendLedgEntry.SETRANGE("Applies-to ID",AppliesToID);
        VendLedgEntry.SETRANGE(Open,TRUE);
        VendLedgEntry.SETRANGE("Applying Entry",TRUE);
        IF VendLedgEntry.FINDFIRST THEN BEGIN
          VendLedgEntry.CALCFIELDS(Amount,"Remaining Amount");
          ApplyingVendLedgEntry := VendLedgEntry;
          SETFILTER("Entry No.",'<>%1',VendLedgEntry."Entry No.");
          ApplyingAmount := VendLedgEntry."Remaining Amount";
          ApplnDate := VendLedgEntry."Posting Date";
          ApplnCurrencyCode := VendLedgEntry."Currency Code";
        END;
        CalcApplnAmount;
      END;
    END;

    LOCAL PROCEDURE HandleChosenEntries@8(Type@1000 : 'Direct,GenJnlLine,PurchHeader';CurrentAmount@1001 : Decimal;CurrencyCode@1002 : Code[10];PostingDate@1003 : Date);
    VAR
      TempAppliedVendLedgEntry@1004 : TEMPORARY Record 25;
      PossiblePmtdisc@1007 : Decimal;
      OldPmtdisc@1008 : Decimal;
      CorrectionAmount@1009 : Decimal;
      RemainingAmountExclDiscounts@1012 : Decimal;
      CanUseDisc@1005 : Boolean;
      FromZeroGenJnl@1010 : Boolean;
      IsHandled@1006 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeHandledChosenEntries(Type,CurrentAmount,CurrencyCode,PostingDate,AppliedVendLedgEntry,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF NOT AppliedVendLedgEntry.FINDSET(FALSE,FALSE) THEN
        EXIT;

      REPEAT
        TempAppliedVendLedgEntry := AppliedVendLedgEntry;
        TempAppliedVendLedgEntry.INSERT;
      UNTIL AppliedVendLedgEntry.NEXT = 0;

      FromZeroGenJnl := (CurrentAmount = 0) AND (Type = Type::GenJnlLine);

      REPEAT
        IF NOT FromZeroGenJnl THEN
          TempAppliedVendLedgEntry.SETRANGE(Positive,CurrentAmount < 0);
        IF TempAppliedVendLedgEntry.FINDFIRST THEN BEGIN
          ExchangeAmountsOnLedgerEntry(Type,CurrencyCode,TempAppliedVendLedgEntry,PostingDate);

          CASE Type OF
            Type::Direct:
              //CanUseDisc := PaymentToleranceMgt.CheckCalcPmtDiscVend(VendLedgEntry,TempAppliedVendLedgEntry,0,FALSE,FALSE); //**4PS.o
              CanUseDisc := PaymentToleranceMgt.CheckCalcPmtDiscVend(VendLedgEntry,TempAppliedVendLedgEntry,0,FALSE,FALSE,0); //**4PS.n
            Type::GenJnlLine:
              //CanUseDisc := PaymentToleranceMgt.CheckCalcPmtDiscGenJnlVend(GenJnlLine2,TempAppliedVendLedgEntry,0,FALSE); //**4PS.o
              CanUseDisc := PaymentToleranceMgt.CheckCalcPmtDiscGenJnlVend(GenJnlLine2,TempAppliedVendLedgEntry,0,FALSE,0) //**4PS.n
            ELSE
              CanUseDisc := FALSE;
          END;

          IF CanUseDisc AND
             (ABS(TempAppliedVendLedgEntry."Amount to Apply") >=
              ABS(TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible"))
          THEN
            IF ABS(CurrentAmount) >
               ABS(TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible")
            THEN BEGIN
              PmtDiscAmount += TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
              CurrentAmount += TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
            END ELSE
              IF ABS(CurrentAmount) =
                 ABS(TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible")
              THEN BEGIN
                PmtDiscAmount += TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible" ;
                CurrentAmount +=
                  TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
                AppliedAmount += CorrectionAmount;
              END ELSE
                IF FromZeroGenJnl THEN BEGIN
                  PmtDiscAmount += TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
                  CurrentAmount +=
                    TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
                END ELSE BEGIN
                  PossiblePmtdisc := TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
                  RemainingAmountExclDiscounts :=
                    TempAppliedVendLedgEntry."Remaining Amount" - PossiblePmtdisc - TempAppliedVendLedgEntry."Max. Payment Tolerance";
                  IF ABS(CurrentAmount) + ABS(CalcOppositeEntriesAmount(TempAppliedVendLedgEntry)) >=
                     ABS(RemainingAmountExclDiscounts)
                  THEN BEGIN
                    PmtDiscAmount += PossiblePmtdisc;
                    AppliedAmount += CorrectionAmount;
                  END;
                  CurrentAmount +=
                    TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Remaining Pmt. Disc. Possible";
                END
          ELSE BEGIN
            IF ((CurrentAmount + TempAppliedVendLedgEntry."Amount to Apply") * CurrentAmount) >= 0 THEN
              AppliedAmount += CorrectionAmount;
            CurrentAmount += TempAppliedVendLedgEntry."Amount to Apply";
          END;
        END ELSE BEGIN
          TempAppliedVendLedgEntry.SETRANGE(Positive);
          TempAppliedVendLedgEntry.FINDFIRST;
          ExchangeAmountsOnLedgerEntry(Type,CurrencyCode,TempAppliedVendLedgEntry,PostingDate);
        END;

        IF OldPmtdisc <> PmtDiscAmount THEN
          AppliedAmount += TempAppliedVendLedgEntry."Remaining Amount"
        ELSE
          AppliedAmount += TempAppliedVendLedgEntry."Amount to Apply";
        OldPmtdisc := PmtDiscAmount;

        IF PossiblePmtdisc <> 0 THEN
          CorrectionAmount := TempAppliedVendLedgEntry."Remaining Amount" - TempAppliedVendLedgEntry."Amount to Apply"
        ELSE
          CorrectionAmount := 0;

        IF NOT DifferentCurrenciesInAppln THEN
          DifferentCurrenciesInAppln := ApplnCurrencyCode <> TempAppliedVendLedgEntry."Currency Code";

        TempAppliedVendLedgEntry.DELETE;
        TempAppliedVendLedgEntry.SETRANGE(Positive);

      UNTIL NOT TempAppliedVendLedgEntry.FINDFIRST;
      CheckRounding;
    END;

    LOCAL PROCEDURE AmountToApplyOnAfterValidate@19038179();
    BEGIN
      IF ApplnType <> ApplnType::"Applies-to Doc. No." THEN BEGIN
        CalcApplnAmount;
        CurrPage.UPDATE(FALSE);
      END;
    END;

    LOCAL PROCEDURE RecalcApplnAmount@19051222();
    BEGIN
      CurrPage.UPDATE(TRUE);
      CalcApplnAmount;
    END;

    LOCAL PROCEDURE LookupOKOnPush@19031339();
    BEGIN
      OK := TRUE;
    END;

    LOCAL PROCEDURE PostDirectApplication@15(PreviewMode@1005 : Boolean);
    VAR
      VendEntryApplyPostedEntries@1000 : Codeunit 227;
      PostApplication@1002 : Page 579;
      Applied@1006 : Boolean;
      ApplicationDate@1001 : Date;
      NewApplicationDate@1003 : Date;
      NewDocumentNo@1004 : Code[20];
    BEGIN
      IF CalcType = CalcType::Direct THEN BEGIN
        IF ApplyingVendLedgEntry."Entry No." <> 0 THEN BEGIN
          Rec := ApplyingVendLedgEntry;
          ApplicationDate := VendEntryApplyPostedEntries.GetApplicationDate(Rec);

          PostApplication.SetValues("Document No.",ApplicationDate);
          IF ACTION::OK = PostApplication.RUNMODAL THEN BEGIN
            PostApplication.GetValues(NewDocumentNo,NewApplicationDate);
            IF NewApplicationDate < ApplicationDate THEN
              ERROR(Text013,FIELDCAPTION("Posting Date"),TABLECAPTION);
          END ELSE
            ERROR(Text019);

          IF PreviewMode THEN
            VendEntryApplyPostedEntries.PreviewApply(Rec,NewDocumentNo,NewApplicationDate)
          ELSE
            Applied := VendEntryApplyPostedEntries.Apply(Rec,NewDocumentNo,NewApplicationDate);

          IF (NOT PreviewMode) AND Applied THEN BEGIN
            MESSAGE(Text012);
            PostingDone := TRUE;
            CurrPage.CLOSE;
          END;
        END ELSE
          ERROR(Text002);
      END ELSE
        ERROR(Text003);
    END;

    LOCAL PROCEDURE CheckActionPerformed@1011() : Boolean;
    BEGIN
      IF ActionPerformed THEN
        EXIT(FALSE);
      IF (NOT (CalcType = CalcType::Direct) AND NOT OK AND NOT PostingDone) OR
         (ApplnType = ApplnType::"Applies-to Doc. No.")
      THEN
        EXIT(FALSE);
      EXIT((CalcType = CalcType::Direct) AND NOT OK AND NOT PostingDone);
    END;

    [External]
    PROCEDURE SetAppliesToID@1031(AppliesToID2@1043 : Code[50]);
    BEGIN
      AppliesToID := AppliesToID2;
    END;

    [External]
    PROCEDURE ExchangeAmountsOnLedgerEntry@14(Type@1000 : 'Direct,GenJnlLine,PurchHeader';CurrencyCode@1001 : Code[10];VAR CalcVendLedgEntry@1002 : Record 25;PostingDate@1004 : Date);
    VAR
      CalculateCurrency@1003 : Boolean;
    BEGIN
      CalcVendLedgEntry.CALCFIELDS("Remaining Amount");

      IF Type = Type::Direct THEN
        CalculateCurrency := ApplyingVendLedgEntry."Entry No." <> 0
      ELSE
        CalculateCurrency := TRUE;

      IF (CurrencyCode <> CalcVendLedgEntry."Currency Code") AND CalculateCurrency THEN BEGIN
        CalcVendLedgEntry."Remaining Amount" :=
          CurrExchRate.ExchangeAmount(
            //CalcVendLedgEntry."Remaining Amount",CalcVendLedgEntry."Currency Code",CurrencyCode,PostingDate); //**4PS.o
            CalcVendLedgEntry."Remaining Amount",CalcVendLedgEntry."Currency Code",CurrencyCode,PostingDate,FALSE); //**4PS.n
        CalcVendLedgEntry."Remaining Pmt. Disc. Possible" :=
          CurrExchRate.ExchangeAmount(
            //CalcVendLedgEntry."Remaining Pmt. Disc. Possible",CalcVendLedgEntry."Currency Code",CurrencyCode,PostingDate); //**4PS.o
            CalcVendLedgEntry."Remaining Pmt. Disc. Possible",CalcVendLedgEntry."Currency Code",CurrencyCode,PostingDate,FALSE); //**4PS.n
        CalcVendLedgEntry."Amount to Apply" :=
          CurrExchRate.ExchangeAmount(
            //CalcVendLedgEntry."Amount to Apply",CalcVendLedgEntry."Currency Code",CurrencyCode,PostingDate); //**4PS.o
            CalcVendLedgEntry."Amount to Apply",CalcVendLedgEntry."Currency Code",CurrencyCode,PostingDate,FALSE); //**4PS.n
      END;

      OnAfterExchangeAmountsOnLedgerEntry(CalcVendLedgEntry,VendLedgEntry,CurrencyCode);
    END;

    [External]
    PROCEDURE CalcOppositeEntriesAmount@17(VAR TempAppliedVendorLedgerEntry@1000 : TEMPORARY Record 25) Result : Decimal;
    VAR
      SavedAppliedVendorLedgerEntry@1002 : Record 25;
      CurrPosFilter@1001 : Text;
    BEGIN
      WITH TempAppliedVendorLedgerEntry DO BEGIN
        CurrPosFilter := GETFILTER(Positive);
        IF CurrPosFilter <> '' THEN BEGIN
          SavedAppliedVendorLedgerEntry := TempAppliedVendorLedgerEntry;
          SETRANGE(Positive,NOT Positive);
          IF FINDSET THEN
            REPEAT
              CALCFIELDS("Remaining Amount");
              Result += "Remaining Amount";
            UNTIL NEXT = 0;
          SETFILTER(Positive,CurrPosFilter);
          TempAppliedVendorLedgerEntry := SavedAppliedVendorLedgerEntry;
        END;
      END;
    END;

    [External]
    PROCEDURE GetCalcType@24() : Integer;
    BEGIN
      EXIT(CalcType);
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcApplnAmount@18(VendorLedgerEntry@1000 : Record 25;VAR AppliedAmount@1001 : Decimal;VAR ApplyingAmount@1002 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcApplnAmountToApply@25(VendorLedgerEntry@1000 : Record 25;VAR ApplnAmountToApply@1001 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcApplnRemainingAmount@21(VendorLedgerEntry@1000 : Record 25;VAR ApplnRemainingAmount@1001 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterExchangeAmountsOnLedgerEntry@27(VAR CalcVendorLedgerEntry@1000 : Record 25;VendorLedgerEntry@1001 : Record 25;CurrencyCode@1002 : Code[10]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCalcApplnAmount@19(VAR VendorLedgerEntry@1000 : Record 25;VAR GenJournalLine@1001 : Record 81);
    BEGIN
    END;

    [Integration(TRUE,TRUE)]
    LOCAL PROCEDURE OnBeforeHandledChosenEntries@23(Type@1003 : 'Direct,GenJnlLine,PurchHeader';CurrentAmount@1002 : Decimal;CurrencyCode@1001 : Code[10];PostingDate@1000 : Date;VAR AppliedVendLedgEntry@1004 : Record 25;VAR IsHandled@1005 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeEarlierPostingDateError@16(ApplyingVendLedgEntry@1000 : Record 25;VendorLedgerEntry@1001 : Record 25;VAR RaiseError@1002 : Boolean;CalcType@1003 : Option);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeSetApplyingVendLedgEntry@20(VAR ApplyingVendLedgEntry@1000 : Record 25;GenJournalLine@1001 : Record 81);
    BEGIN
    END;

    BEGIN
    {
      150304 ITERO.WG SC003192 Added field "Remaining Amt. (LCY)"
    }
    END.
  }
}

