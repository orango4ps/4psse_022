OBJECT Table 11012746 Document Properties
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    DataPerCompany=No;
    DataCaptionFields=No.,Description;
    OnInsert=VAR
               UserSetup@1100528700 : Record 91;
             BEGIN
               IF "No." = '' THEN BEGIN
                 DocumentMgtSetup.GET;
                 IF "External Document" THEN BEGIN
                   DocumentMgtSetup.TESTFIELD("External Document Nos.");
                   NoSeriesMgt.InitSeries(DocumentMgtSetup."External Document Nos.",xRec."No. Series",0D,"No.","No. Series");
                 END ELSE BEGIN
                   DocumentMgtSetup.TESTFIELD("Document Nos.");
                   NoSeriesMgt.InitSeries(DocumentMgtSetup."Document Nos.",xRec."No. Series",0D,"No.","No. Series");
                 END;
               END;
               "Creation Date" := TODAY;
               "Creation Time" := TIME;
               "User ID" := USERID;
               "Internal Company" := COMPANYNAME;

               IF ("External Document") AND (Status = Rec.Status::" ") THEN
                 VALIDATE(Status, Status::Concept);

               IF NOT "External Document" THEN BEGIN
                 IF UserSetup.GET(USERID) THEN
                   VALIDATE(Sender, UserSetup."Employee No.");
               END ELSE BEGIN
                 SetDefaultValues;
               END;

               "SharePoint Status" := "SharePoint Status"::New;

               CheckFilterGroupSettings;

               FillReference;    //**4PS07.n

               IF "Department Code" = '' THEN
                 DPA_OnInsert;

               FillModificationData;

               ProjectSiteMgt.LogDocumentProperties(1, Rec); //**4PS.n
               VALIDATE("Show in Control");
             END;

    OnModify=BEGIN
               IF ("SharePoint Status" = "SharePoint Status"::Updated) AND (NOT "External Document") THEN
                 "SharePoint Status" := "SharePoint Status"::Modified;

               FillModificationData;

               UpdateProjectPortal;
               CreateDocumentRelationForLinkedDocuments;

               ProjectSiteMgt.LogDocumentProperties(2, Rec); //**4PS.n
               VALIDATE("Show in Control");
             END;

    OnDelete=VAR
               DocumentLinkMgt@1100525002 : Codeunit 11012401;
               DocumentManagement@1100527800 : Codeunit 11012406;
             BEGIN
               IF (DocumentManagement.URIExists("Storage Type",GetStorageURI)) THEN
                 IF NOT (DocumentManagement.DeleteStorageURI("Storage Type",GetStorageURI)) THEN
                   ERROR(Text034);

               DocumentLinkMgt.DeleteDocumentLink(Rec);
               DeleteFromRelatedTables;
               ProjectSiteMgt.LogDocumentProperties(3, Rec); //**4PS.n
             END;

    OnRename=BEGIN
               FillModificationData;
             END;

    CaptionML=[ENU=Document Properties;
               NOR=Dokumentegenskaper;
               SVE=Dokumentegenskaper];
    LookupPageID=Page11012407;
  }
  FIELDS
  {
    { 1   ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                //IF "Person Name 2" <> xRec."Person Name 2" THEN BEGIN  // **4PS MVOS 28157.o
                                                                IF GUIALLOWED AND ("No." <> xRec."No.") THEN BEGIN  // **4PS MVOS 28157.n //#C047031.c
                                                                  DocumentMgtSetup.GET;
                                                                  NoSeriesMgt.TestManual(DocumentMgtSetup."Document Nos.");
                                                                  "No. Series" := '';
                                                                END;
                                                                FillReference;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr;
                                                              SVE=Nr] }
    { 2   ;   ;Document Group      ;Code10        ;TableRelation="Document Group";
                                                   OnValidate=BEGIN
                                                                IF ("Document Group" <> xRec."Document Group") AND
                                                                   (xRec."Document Group" <> '') THEN BEGIN
                                                                  "Document Template" := '';
                                                                  "Document Type" := '';
                                                                END;

                                                                CALCFIELDS("Description Document Group");
                                                                CALCFIELDS("Description Document Template");
                                                                CALCFIELDS("Document Type Description");
                                                              END;

                                                   CaptionML=[ENU=Document Group;
                                                              NOR=Dokumentgruppen finnes ikke;
                                                              SVE=Dokumentgrupp] }
    { 3   ;   ;Document Template   ;Code20        ;TableRelation="Document Template"."Template Code" WHERE (Document Group=FIELD(Document Group));
                                                   OnValidate=VAR
                                                                DocumentTemplate@1100525000 : Record 11012401;
                                                                DocumentMgt@1100485000 : Codeunit 11012406;
                                                                DocumentLinkMgt@1199198000 : Codeunit 11012401;
                                                              BEGIN
                                                                IF "Document Template" <> '' THEN BEGIN
                                                                  DocumentMgt.CheckUserPermission("Document Group", "Document Template");  //**4PS05.n
                                                                  DocumentTemplate.GET("Document Group","Document Template");
                                                                  IF (CurrFieldNo = FIELDNO("Document Template")) THEN
                                                                    DocumentTemplate.TESTFIELD(Type, DocumentTemplate.Type::Miscellaneous);
                                                                  IF xRec."Document Template" <> "Document Template" THEN //mg.c, 05-07-11: M28016
                                                                    VALIDATE("Document Type", DocumentTemplate."Document Type");
                                                                  IF DocumentTemplate."Secured Document" = DocumentTemplate."Secured Document"::Always THEN
                                                                    Secure := TRUE;
                                                                END;
                                                                CALCFIELDS("Description Document Template");

                                                                DocumentLinkMgt.FillDefaultDocumentLink(Rec, FALSE); // DocMgt
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupDocumentTemplate(FALSE);
                                                            END;

                                                   CaptionML=[ENU=Document Template;
                                                              NOR=Dokumentmal;
                                                              SVE=Dokumentmall] }
    { 4   ;   ;Creation Date       ;Date          ;CaptionML=[ENU=Creation Date;
                                                              NOR=Opprettelsesdato;
                                                              SVE=UpplÑggningsdatum] }
    { 5   ;   ;Creation Time       ;Time          ;CaptionML=[ENU=Creation Time;
                                                              NOR=Opprettet (tid);
                                                              SVE=Skapades (tid)] }
    { 6   ;   ;User ID             ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=User ID;
                                                              NOR=Bruker-ID;
                                                              SVE=AnvÑndar-ID] }
    { 8   ;   ;Document No.        ;Code20        ;OnValidate=BEGIN
                                                                FillReference;
                                                              END;

                                                   CaptionML=[ENU=Document No.;
                                                              NOR=Bilagsnr.;
                                                              SVE=Dokumentnr] }
    { 9   ;   ;File                ;Text250       ;OnValidate=BEGIN
                                                                IF File <> '' THEN
                                                                  VALIDATE("File Extension", LOWERCASE(FileMgt.GetExtension(File)))
                                                                ELSE
                                                                  IF "Document Service URL" = '' THEN
                                                                    VALIDATE("File Extension", '');
                                                              END;

                                                   CaptionML=[ENU=File;
                                                              NOR=Fil;
                                                              SVE=Fil];
                                                   Editable=No }
    { 10  ;   ;Version             ;Integer       ;CaptionML=[ENU=Version;
                                                              NOR=Versjon;
                                                              SVE=Version] }
    { 11  ;   ;Contact No.         ;Code20        ;TableRelation=Contact WHERE (Person No.=FILTER(''));
                                                   OnValidate=BEGIN
                                                                IF (NOT IsPPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                                IF (NOT IsDPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);

                                                                IF Contact.GET("Contact No.") THEN BEGIN
                                                                  IF Contact.IsContactPerson THEN
                                                                     ERROR(Text008, Contact."Company No.", FIELDCAPTION("Contact Person No."));

                                                                  IF (NOT "External Document") THEN
                                                                    Contact.TESTFIELD(Blocked, FALSE);

                                                                  "Contact Name" := Contact.Name;
                                                                  "Contact Name 2" := Contact."Name 2";
                                                                  IF ("Storage Type" <> "Storage Type"::"File System on Premise") AND ("Storage Type" <> "Storage Type"::"SharePoint Online") THEN
                                                                      VALIDATE("Document Group", Contact."Document Group");
                                                                END;
                                                                IF "Contact No." <> xRec."Contact No." THEN BEGIN
                                                                  IF "Contact No." = '' THEN BEGIN
                                                                    "Contact Name" := '';
                                                                    "Contact Name 2" := '';
                                                                  END;
                                                                  IF xRec."Contact No." <> '' THEN // T001106.n
                                                                    VALIDATE("Contact Person No.", '');
                                                                END;

                                                                CopyPostAddress();
                                                                SetShowInControl(TRUE);
                                                                CopySalutation("Contact No.");
                                                              END;

                                                   CaptionML=[ENU=Contact No.;
                                                              NOR=Kontaktnr;
                                                              SVE=Kontaktnr] }
    { 12  ;   ;Doc. Action         ;Code50        ;CaptionML=[ENU=Action;
                                                              NOR=Handling;
                                                              SVE=ètgÑrd] }
    { 13  ;   ;Contact Person No.  ;Code20        ;TableRelation=Contact.No. WHERE (Type=CONST(Person),
                                                                                    Company No.=FIELD(Contact No.));
                                                   OnValidate=BEGIN
                                                                IF (NOT IsPPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                                IF (NOT IsDPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);

                                                                "Contact Person Name" := '';
                                                                "Contact Person Name 2" := '';

                                                                IF "Contact Person No." = '' THEN
                                                                  EXIT;

                                                                IF Contact.GET("Contact Person No.") THEN BEGIN
                                                                  IF (NOT "External Document") THEN
                                                                    Contact.TESTFIELD(Blocked, FALSE);
                                                                  "Contact Person Name" := Contact.Name;
                                                                  "Contact Person Name 2" := Contact."Name 2";
                                                                  IF (Contact."Company No." = '') AND
                                                                     (File = '') AND
                                                                     ("Document Service URL" = '')
                                                                  THEN
                                                                    VALIDATE("Document Group", Contact."Document Group");

                                                                  CopyPostAddress();

                                                                  IF Contact."Salutation Code" <> '' THEN
                                                                    CopySalutation("Contact Person No.");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Contact Person No.;
                                                              NOR=Kontaktperson;
                                                              SVE=Kontaktperson] }
    { 14  ;   ;Address             ;Text100       ;CaptionML=[ENU=Address;
                                                              NOR=Adresse;
                                                              SVE=Adress] }
    { 15  ;   ;Address 2           ;Text50        ;CaptionML=[ENU=Address 2;
                                                              NOR=Adresse 2;
                                                              SVE=Adress 2] }
    { 16  ;   ;Post Code           ;Code20        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Post Code;
                                                              NOR=Postnr;
                                                              SVE=Postnr] }
    { 17  ;   ;City                ;Text30        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=City;
                                                              NOR=Sted;
                                                              SVE=Ort] }
    { 18  ;   ;County              ;Text30        ;CaptionML=[ENU=County;
                                                              NOR=Delstat;
                                                              SVE=Delstat] }
    { 19  ;   ;Country/Region Code ;Code10        ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Country/Region Code;
                                                              NOR=Lands-/regionkode;
                                                              SVE=Lands-/regionkod] }
    { 20  ;   ;Template            ;Text30        ;CaptionML=[ENU=Template;
                                                              NOR=Mal;
                                                              SVE=Mall] }
    { 21  ;   ;Subject             ;Text100       ;CaptionML=[ENU=Subject;
                                                              NOR=Emne;
                                                              SVE=AngÜende] }
    { 22  ;   ;Confidential        ;Boolean       ;CaptionML=[ENU=Confidential;
                                                              NOR=Konfidensielt;
                                                              SVE=Konfidentiell] }
    { 23  ;   ;Internal Company    ;Text50        ;TableRelation=Company;
                                                   CaptionML=[ENU=Company;
                                                              NOR=Selskap;
                                                              SVE=Fîretag] }
    { 24  ;   ;Sender              ;Code20        ;TableRelation=Employee.No.;
                                                   OnValidate=BEGIN
                                                                FillEditor;  //**4PS02
                                                              END;

                                                   CaptionML=[ENU=Sender;
                                                              NOR=Avsender;
                                                              SVE=AvsÑndare] }
    { 25  ;   ;Editor              ;Code20        ;TableRelation=Employee.No.;
                                                   OnValidate=BEGIN
                                                                FillReference;
                                                              END;

                                                   CaptionML=[ENU=Editor;
                                                              NOR=Editor;
                                                              SVE=Editor] }
    { 26  ;   ;Contact Name        ;Text100       ;CaptionML=[ENU=Contact Name;
                                                              NOR=Kontaktnavn;
                                                              SVE=Kontaktnamn] }
    { 27  ;   ;Contact Person Name ;Text100       ;CaptionML=[ENU=Contact Person Name;
                                                              NOR=Kontaktpersonens navn;
                                                              SVE=Kontaktpersonens namn] }
    { 28  ;   ;Description Document Group;Text50  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Group".Description WHERE (Code=FIELD(Document Group)));
                                                   CaptionML=[ENU=Description Document Group;
                                                              NOR=Beskrivelse, Dokumentgruppe;
                                                              SVE=Beskrivning, dokumentgrupp];
                                                   Editable=No }
    { 29  ;   ;Description Document Template;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Template".Description WHERE (Document Group=FIELD(Document Group),
                                                                                                             Template Code=FIELD(Document Template)));
                                                   CaptionML=[ENU=Description Document Template;
                                                              NOR=Beskrivelse, Dokumentmal;
                                                              SVE=Beskrivning, dokumentmall];
                                                   Editable=No }
    { 30  ;   ;Final Printed       ;Boolean       ;OnValidate=BEGIN
                                                                IF "Final Printed" = TRUE THEN
                                                                  Status := Status::Definite;

                                                                IF xRec."Final Printed" AND (NOT "Final Printed") THEN BEGIN
                                                                  DocumentMgtSetup.GET;
                                                                  IF DocumentMgtSetup."Documentation System" = DocumentMgtSetup."Documentation System"::Sharepoint THEN
                                                                    ERROR(Text017);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Final Printed;
                                                              NOR=Resultat er skrevet ut;
                                                              SVE=Resultat Ñr utskrivet] }
    { 31  ;   ;Final Printed Date  ;Date          ;CaptionML=[ENU=Final Printed Date;
                                                              NOR=Utskriftsdato for Resultat;
                                                              SVE=Utskriftsdatum fîr resultat] }
    { 32  ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr-serie;
                                                              SVE=Nr-serie];
                                                   Editable=No }
    { 33  ;   ;Reference           ;Text80        ;CaptionML=[ENU=Reference;
                                                              NOR=Referanse;
                                                              SVE=Referens] }
    { 34  ;   ;Salutation (Formal) ;Text100       ;CaptionML=[ENU=Salutation (Formal);
                                                              NOR=Hilsning (Formell);
                                                              SVE=HÑlsning (formell)] }
    { 35  ;   ;Phone No.           ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No.;
                                                              NOR=Telefonnr.;
                                                              SVE=Telefonnr] }
    { 36  ;   ;Fax No.             ;Text30        ;CaptionML=[ENU=Fax No.;
                                                              NOR=Telefaxnr;
                                                              SVE=Telefaxnr] }
    { 37  ;   ;Phone No. 2         ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No. 2;
                                                              NOR=Telefonnr. 2;
                                                              SVE=Telefonnr 2] }
    { 38  ;   ;Mobile Phone No.    ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Mobile Phone No.;
                                                              NOR=Mobiltelefonnr;
                                                              SVE=Mobiltelefonnr] }
    { 39  ;   ;Contact Name 2      ;Text100       ;CaptionML=[ENU=Contact Name 2;
                                                              NOR=Kontaktnavn 2;
                                                              SVE=Kontaktnamn 2] }
    { 40  ;   ;Contact Person Name 2;Text100      ;CaptionML=[ENU=Contact Person Name 2;
                                                              NOR=Kontaktpersonsnavn 2;
                                                              SVE=Kontaktpersonsnamn 2] }
    { 41  ;   ;External Document   ;Boolean       ;CaptionML=[ENU=External Document;
                                                              NOR=Eksternt dokument;
                                                              SVE=Externt dokument] }
    { 42  ;   ;Scale               ;Text20        ;CaptionML=[ENU=Scale;
                                                              NOR=Skala;
                                                              SVE=Skala] }
    { 43  ;   ;Status              ;Option        ;CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=[ENU=" ,Concept,Provisional,Definite,Expired";
                                                                    NOR=" ,Konsept,Provisorisk,Definitiv,UtgÜtt";
                                                                    SVE=" ,Koncept,PreliminÑr,Definitiv,UtgÜngen"];
                                                   OptionString=[ ,Concept,Provisional,Definite,Expired] }
    { 44  ;   ;Modification Date   ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Max("Document Modification Date".Date WHERE (Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Modification Date;
                                                              NOR=Endringsdato;
                                                              SVE=éndringsdatum];
                                                   Editable=No }
    { 45  ;   ;Expired On          ;Date          ;CaptionML=[ENU=Expired On;
                                                              NOR=Gikk ut den;
                                                              SVE=Gick ut den] }
    { 46  ;   ;Document Date       ;Date          ;CaptionML=[ENU=Document Date;
                                                              NOR=Dokumentdato;
                                                              SVE=Dokumentdatum] }
    { 47  ;   ;Addressed To        ;Code20        ;TableRelation=Employee;
                                                   CaptionML=[ENU=Addressed To;
                                                              NOR=Adressert til;
                                                              SVE=Adresserat till] }
    { 48  ;   ;Addressed To Name   ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Addressed To)));
                                                   CaptionML=[ENU=Addressed To Name;
                                                              NOR=Adressert til navn;
                                                              SVE=Adresserat till namn];
                                                   Editable=No }
    { 49  ;   ;Document Type       ;Code10        ;TableRelation=IF (Document Portal Subsite=FILTER(<>''),
                                                                     Document Portal Source Type=CONST(Project)) "DPT Subsite Doc Type Project"."Document Type" WHERE (Project No.=FIELD(Document Portal Source No.),
                                                                                                                                                                       Subsite Code=FIELD(Document Portal Subsite))
                                                                                                                                                                       ELSE IF (Document Portal Subsite=FILTER(<>''),
                                                                                                                                                                                Document Portal Source Type=CONST(ServiceLoc)) "DPT Subsite Doc Type ServLoc"."Document Type" WHERE (Service Location No.=FIELD(Document Portal Source No.),
                                                                                                                                                                                                                                                                                     Subsite Code=FIELD(Document Portal Subsite))
                                                                                                                                                                                                                                                                                     ELSE IF (Project Portal Subsite=FILTER(<>'')) "Subsite-Doc Type (PPT)"."Document Type" WHERE (Subsite Type=CONST(Project),
                                                                                                                                                                                                                                                                                                                                                                                   Project Portal Subsite=FIELD(Project Portal Subsite))
                                                                                                                                                                                                                                                                                                                                                                                   ELSE "Document Type".Type;
                                                   OnValidate=VAR
                                                                DocumentLinkMgt@1100527812 : Codeunit 11012401;
                                                                FileMgt@1100527811 : Codeunit 419;
                                                                DocumentManagement@1100527810 : Codeunit 11012406;
                                                                TargetStorageURI@1100527804 : Text;
                                                                Dummy@1100527803 : Text;
                                                                TargetStorageType@1100527802 : Option;
                                                                StorageURI@1100527801 : Text;
                                                                ErrorMessage@1100527800 : Text;
                                                                ShortFileName@1100527700 : Text;
                                                              BEGIN
                                                                IF NOT DocumentType.GET("Document Type") THEN
                                                                  DocumentType.INIT;

                                                                IF ((DocumentManagement.GetMainStorageType <> "Storage Type") AND ("Document Service URL" <> '')) THEN
                                                                  MoveDocumentToMainStorage;

                                                                StorageURI := GetStorageURI;
                                                                FileMgt.SplitFileAbsPathName(StorageURI,Dummy,ShortFileName);
                                                                IF "External Document" AND
                                                                    (StorageURI <> '') AND
                                                                    (GUIALLOWED) AND
                                                                    ("Document Type" <> xRec."Document Type") THEN BEGIN
                                                                      DocumentManagement.PrepareDocumentRegistration(
                                                                        ShortFileName,"Document Type","Creation Date",TargetStorageURI,TargetStorageType);
                                                                      IF DocumentManagement.CopyStorageContent("Storage Type",TargetStorageType, StorageURI, TargetStorageURI,ErrorMessage) THEN BEGIN
                                                                        ValidateStorageURI("Storage Type",TargetStorageURI);
                                                                      END ELSE
                                                                          ERROR(ErrorMessage);
                                                                END;

                                                                IF DocumentType."Document Def. Available in FSA" AND (StorageURI <>'')  THEN
                                                                  "Available for Field Service" := TRUE;

                                                                DocumentLinkMgt.FillDefaultDocumentLink(Rec, TRUE); // DocMgt

                                                                CALCFIELDS("Document Type Description");
                                                              END;

                                                   CaptionML=[ENU=Document Type;
                                                              NOR=Dokumenttype;
                                                              SVE=Dokumenttyp] }
    { 50  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning];
                                                   NotBlank=Yes }
    { 51  ;   ;Original To         ;Code20        ;TableRelation=Employee.No.;
                                                   CaptionML=[ENU=Original To;
                                                              NOR=Opprinnelig til;
                                                              SVE=Ursprungligen till] }
    { 52  ;   ;Intended For        ;Text100       ;CaptionML=[ENU=Intended For;
                                                              NOR=Ment for;
                                                              SVE=Avsedd fîr] }
    { 53  ;   ;Salutation (Informal);Text100      ;CaptionML=[ENU=Salutation (Informal);
                                                              NOR=Hilsning (Uformell);
                                                              SVE=HÑlsning (informell)] }
    { 54  ;   ;Interaction Entry No.;Integer      ;TableRelation="Interaction Log Entry"."Entry No.";
                                                   CaptionML=[ENU=Interaction Entry No.;
                                                              NOR=Transaksjonsnr. for interaksjon;
                                                              SVE=Transaktionsnr fîr interaktion];
                                                   Editable=No }
    { 55  ;   ;Salutation 2 (Formal);Text100      ;CaptionML=[ENU=Salutation (Formal) Second Buyer;
                                                              NOR=Hilsning (Formell) for andre kjõper;
                                                              SVE=HÑlsning (formell) fîr en andra kîpare] }
    { 56  ;   ;Salutation 2 (Informal);Text100    ;CaptionML=[ENU=Salutation (Informal) Second Buyer;
                                                              NOR=Hilsning (Uformell) for andre kjõper;
                                                              SVE=HÑlsning (informell) fîr en andra kîpare] }
    { 57  ;   ;Secure              ;Boolean       ;CaptionML=[ENU=Secure;
                                                              NOR=Sikre;
                                                              SVE=Skydda] }
    { 58  ;   ;Intended for 2      ;Text100       ;CaptionML=[ENU=Intended for 2;
                                                              NOR=Ment for 2;
                                                              SVE=Avsedd fîr 2] }
    { 59  ;   ;Web link            ;Text250       ;OnValidate=BEGIN
                                                                IF (NOT IsPPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                                IF (NOT IsDPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                              END;

                                                   ExtendedDatatype=URL;
                                                   CaptionML=[ENU=Web Link;
                                                              NOR=Weblink;
                                                              SVE=WebblÑnk];
                                                   Editable=No }
    { 60  ;   ;Name Sender         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Sender)));
                                                   CaptionML=[ENU=Name Sender;
                                                              NOR=Avsenderens navn;
                                                              SVE=AvsÑndarens namn];
                                                   Editable=No }
    { 61  ;   ;Name Editor         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Editor)));
                                                   CaptionML=[ENU=Name Editor;
                                                              NOR=Redaktõrens navn;
                                                              SVE=Redigerarens namn];
                                                   Editable=No }
    { 62  ;   ;Department Code     ;Code20        ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Avdelingskode;
                                                              SVE=Mottagande avdelningskod];
                                                   CaptionClass='1,1,1' }
    { 63  ;   ;Handled By          ;Code20        ;TableRelation=Employee;
                                                   CaptionML=[ENU=Handled By;
                                                              NOR=HÜndtert av;
                                                              SVE=Hanterat av] }
    { 64  ;   ;Name Handled By     ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Handled By)));
                                                   CaptionML=[ENU=Name Handled By;
                                                              NOR=Navn HÜndert av;
                                                              SVE=Namn hanterat av];
                                                   Editable=No }
    { 65  ;   ;React Before        ;Date          ;CaptionML=[ENU=React Before;
                                                              NOR=Reager innen;
                                                              SVE=Reagera innan] }
    { 66  ;   ;SharePoint Status   ;Option        ;CaptionML=[ENU=SharePoint Status;
                                                              NOR=SharePoint-status;
                                                              SVE=SharePoint-status];
                                                   OptionCaptionML=[ENU=New,Modified,Updated;
                                                                    NOR=Ny,Endret,Oppdatert;
                                                                    SVE=Ny,éndrad,Uppdaterad];
                                                   OptionString=New,Modified,Updated;
                                                   Editable=Yes }
    { 67  ;   ;Archive Location    ;Code20        ;CaptionML=[ENU=Archive Location;
                                                              NOR=Arkiver lokasjon;
                                                              SVE=Arkivera lagerstÑlle] }
    { 68  ;   ;Modified            ;DateTime      ;CaptionML=[ENU=Modified;
                                                              NOR=Endret;
                                                              SVE=éndrad] }
    { 69  ;   ;Modified By         ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190001 : Code[50];
                                                              LoginManagement@1210190000 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Modified By";
                                                              LoginManagement.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified By;
                                                              NOR=Modified By;
                                                              SVE=Modified By] }
    { 70  ;   ;Document Type Description;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Type".Description WHERE (Type=FIELD(Document Type)));
                                                   CaptionML=[ENU=Document Type Description;
                                                              NOR=Dokumenttype, Beskrivelse;
                                                              SVE=Dokumenttyp, beskrivning];
                                                   Editable=No }
    { 71  ;   ;Sender Function     ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Job Title" WHERE (No.=FIELD(Sender)));
                                                   CaptionML=[ENU=Sender Function;
                                                              NOR=Avsenderfunksjon;
                                                              SVE=AvsÑndarfunktion] }
    { 72  ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line" WHERE (Table Name=CONST(Document Properties),
                                                                                           No.=FIELD(No.)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 75  ;   ;Showing Result Document Filter;Boolean;
                                                   FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Showing Result Document Filter;
                                                              NOR=Viser Resultat Dokumentfilter;
                                                              SVE=Visar resultatdokumentfilter] }
    { 76  ;   ;From Filter Form    ;Boolean       ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=From Filter Form;
                                                              NOR=Fra filterskjema;
                                                              SVE=FrÜn filterformulÑr] }
    { 150 ;   ;Link Field 1        ;Text50        ;CaptionML=[ENU=Link Field 1;
                                                              NOR=Linkfelt 1];
                                                   Editable=No }
    { 160 ;   ;Link Field 2        ;Text50        ;CaptionML=[ENU=Link Field 2;
                                                              NOR=Linkfelt 2];
                                                   Editable=No }
    { 170 ;   ;Link Field 3        ;Text50        ;CaptionML=[ENU=Link Field 3;
                                                              NOR=Linkfelt 3];
                                                   Editable=No }
    { 180 ;   ;Link Field 4        ;Text50        ;CaptionML=[ENU=Link Field 4;
                                                              NOR=Linkfelt 4];
                                                   Editable=No }
    { 190 ;   ;Link Field 5        ;Text50        ;CaptionML=[ENU=Link Field 5;
                                                              NOR=Linkfelt 5];
                                                   Editable=No }
    { 200 ;   ;E-Mail Sent On      ;DateTime      ;CaptionML=[ENU=Email Sent On;
                                                              NOR=E-post sendt den;
                                                              SVE=E-post skickades den];
                                                   Editable=No }
    { 210 ;   ;E-Mail Sent By      ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190001 : Code[50];
                                                              LoginManagement@1210190000 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "E-Mail Sent By";
                                                              LoginManagement.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Email Sent By;
                                                              NOR=E-post sendt av;
                                                              SVE=E-post skickades av];
                                                   Editable=No }
    { 220 ;   ;E-Mail Sent To      ;Text30        ;CaptionML=[ENU=Email Sent To;
                                                              SVE=E-post skickades till];
                                                   Editable=No }
    { 300 ;   ;Publish on Service Portal;Boolean  ;OnValidate=BEGIN
                                                                SetShowInControl(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Publish on Service Portal;
                                                              NOR=Publiser pÜ Serviceportal;
                                                              SVE=Publicera pÜ serviceportalen] }
    { 310 ;   ;Publish on Subcont.Portal;Boolean  ;CaptionML=[ENU=Publish on Subcontractor Portal;
                                                              NOR=Publiser pÜ underentrepenõrportal;
                                                              SVE=Visa pÜ UE portal] }
    { 320 ;   ;Available for Field Service;Boolean;OnValidate=BEGIN
                                                                IF "Available for Field Service" AND (GetStorageURI = '') THEN
                                                                  TESTFIELD(File);
                                                              END;

                                                   CaptionML=[ENU=Available in Field Service;
                                                              NOR=Tilgjengelig i Feltservice] }
    { 330 ;   ;Created by Field Service;Boolean   ;CaptionML=[ENU=Created by Field Service;
                                                              NOR=Opprettet av Feltservice];
                                                   Editable=No }
    { 340 ;   ;Show in Control     ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Show in Control;
                                                   Editable=No }
    { 400 ;   ;RID Filter          ;Text250       ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=RID Filter;
                                                              NOR=RID-Filter] }
    { 410 ;   ;Department Code Filter;Code20      ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Department Code Filter;
                                                              NOR=Avdelingskode, filter:;
                                                              SVE=Avdelningskod, filter:] }
    { 500 ;   ;D3 Document Type    ;Text30        ;CaptionML=[ENU=D3 Document Type;
                                                              NOR=D3-dokumenttype] }
    { 510 ;   ;D3 Document ID      ;Text30        ;CaptionML=ENU=D3 Document ID }
    { 520 ;   ;File Extension      ;Text250       ;CaptionML=[ENU=File Extension;
                                                              NOR=Filtype;
                                                              SVE=FilÑndelse] }
    { 550 ;   ;Sent to Dispatch on ;DateTime      ;CaptionML=ENU=Sent to Dispatch on;
                                                   Editable=No }
    { 560 ;   ;Send to Dispatch    ;Boolean       ;OnValidate=VAR
                                                                ServiceOrder@1100528602 : Record 11012823;
                                                                DispatchInterface@1100528600 : Codeunit 11071685;
                                                                ServiceOrderNo@1100528601 : Code[20];
                                                              BEGIN
                                                                IF "Send to Dispatch" THEN BEGIN
                                                                  DispatchInterface.TestDispatchWoonActive;
                                                                  TESTFIELD("External Document");
                                                                  ServiceOrderNo := DispatchInterface.GetServiceOrderNoFromDocumentProperty(Rec);
                                                                  IF ServiceOrder.GET(ServiceOrderNo) THEN
                                                                    ServiceOrder.TESTFIELD(Origin, ServiceOrder.Origin::Dispatch);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Send to Dispatch }
    { 570 ;   ;Dispatch Attachment Type;Code20    ;TableRelation="Dispatch Attachment Type";
                                                   OnValidate=VAR
                                                                ServiceOrder@1100528602 : Record 11012823;
                                                                DispatchInterface@1100528600 : Codeunit 11071685;
                                                                ServiceOrderNo@1100528601 : Code[20];
                                                              BEGIN
                                                                IF "Dispatch Attachment Type" <> '' THEN BEGIN
                                                                  DispatchInterface.TestDispatchWoonActive;
                                                                  TESTFIELD("External Document");
                                                                  ServiceOrderNo := DispatchInterface.GetServiceOrderNoFromDocumentProperty(Rec);
                                                                  IF ServiceOrder.GET(ServiceOrderNo) THEN
                                                                    ServiceOrder.TESTFIELD(Origin, ServiceOrder.Origin::Dispatch);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Dispatch Attachment Type }
    { 580 ;   ;Document Service URL;Text250       ;OnValidate=BEGIN
                                                                IF "Document Service URL" <> '' THEN
                                                                  VALIDATE("File Extension", FileMgt.GetExtension("Document Service URL"));
                                                              END;

                                                   ExtendedDatatype=URL;
                                                   CaptionML=ENU=Document Service URL;
                                                   Editable=No }
    { 590 ;   ;Storage Type        ;Option        ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Storage Type;
                                                              SVE=Lagringstyp];
                                                   OptionCaptionML=ENU=,File System on Premise,SharePoint Online,Azure File Storage,,,,,,,,Project Portal,Document Portal,External Project Portal;
                                                   OptionString=,File System on Premise,SharePoint Online,Azure File Storage,,,,,,,,PPT,DPTDUAL,CTB;
                                                   Editable=No }
    { 11012874;;SharePoint Phase   ;Option        ;CaptionML=[ENU=SharePoint Phase;
                                                              NOR=SharePoint-fase;
                                                              SVE=SharePoint-fas];
                                                   OptionCaptionML=[ENU=" ,Development,Design and Preparation,Production";
                                                                    NOR=" ,Utvikling,Design og Forberedelser,Produksjon";
                                                                    SVE=" ,Utveckling,Design och fîrberedelser,Produktion"];
                                                   OptionString=[ ,Development,Design and Preparation,Production] }
    { 11012875;;Document Category  ;Code5         ;TableRelation="Document Category";
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Document Category Description")
                                                              END;

                                                   CaptionML=[ENU=Document Category;
                                                              NOR=Dokumentkategori;
                                                              SVE=Dokumentkategori] }
    { 11012876;;Version External Doc.;Text10      ;CaptionML=[ENU=Document Version;
                                                              NOR=Dokumentversjon;
                                                              SVE=Dokumentversion] }
    { 11012877;;Document Sharepoint ID;Integer    ;CaptionML=[ENU=Document Sharepoint ID;
                                                              NOR=Dokument Sharepoint-ID;
                                                              SVE=Dokument Sharepoint-ID] }
    { 11012878;;Document Category Description;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Category".Description WHERE (Code=FIELD(Document Category)));
                                                   CaptionML=[ENU=Document Category Description;
                                                              NOR=Dokumentkategori, Beskrivelse;
                                                              SVE=Dokumentkategori, beskrivning];
                                                   Editable=No }
    { 11012890;;Project Element    ;Code20        ;OnValidate=VAR
                                                                ProjectNo@1100409000 : Code[20];
                                                                BaseElement@1100409001 : Record 11012060;
                                                                ProjectElement@1100409002 : Record 11012010;
                                                              BEGIN
                                                                //kzwerver.c #C016690
                                                                IF ("Project Element" <> '') THEN BEGIN
                                                                  ProjectNo := GetFirstProjectNo("No.");
                                                                  IF (ProjectNo <> '') THEN
                                                                    ProjectElement.GET(ProjectNo, "Project Element")
                                                                  ELSE
                                                                    BaseElement.GET("Project Element");
                                                                END;
                                                                CALCFIELDS("Project Element Description");
                                                              END;

                                                   OnLookup=VAR
                                                              BaseElement@1100409000 : Record 11012060;
                                                              ProjectElement@1100409002 : Record 11012010;
                                                              Elements@1100409001 : Page 11012118;
                                                              ProjectElements@1100409003 : Page 11012028;
                                                              ProjectNo@1100409004 : Code[20];
                                                            BEGIN
                                                              //kzwerver.c #C016690
                                                              ProjectNo := GetFirstProjectNo("No.");
                                                              IF (ProjectNo <> '') THEN BEGIN
                                                                ProjectElement.SETRANGE("Project No.", ProjectNo);
                                                                ProjectElement."Project No." := ProjectNo;
                                                                ProjectElement.Element := "Project Element";
                                                                ProjectElements.LOOKUPMODE := TRUE;
                                                                ProjectElements.SETTABLEVIEW(ProjectElement);
                                                                ProjectElements.SETRECORD(ProjectElement);
                                                                IF (ProjectElements.RUNMODAL = ACTION::LookupOK) THEN
                                                                  ProjectElements.GETRECORD(ProjectElement);
                                                                VALIDATE("Project Element", ProjectElement.Element);
                                                              END ELSE BEGIN
                                                                BaseElement.Code := "Project Element";
                                                                Elements.LOOKUPMODE := TRUE;
                                                                Elements.SETRECORD(BaseElement);
                                                                IF (Elements.RUNMODAL = ACTION::LookupOK) THEN
                                                                  Elements.GETRECORD(BaseElement);
                                                                VALIDATE("Project Element", BaseElement.Code);
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Project Element;
                                                              NOR=Prosjektelement;
                                                              SVE=Projektelement] }
    { 11012891;;Project Element Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Base Element".Description WHERE (Code=FIELD(Project Element)));
                                                   CaptionML=ENU=Project Element Description;
                                                   Editable=No }
    { 11012900;;Project Portal Subsite;Code20     ;TableRelation=IF (Document Portal Source Type=CONST(Project)) "Project Portal Subsite".Code WHERE (Quote Request Subsite=CONST(No),
                                                                                                                                                      Type=CONST(Project))
                                                                                                                                                      ELSE IF (Document Portal Source Type=CONST(ServiceLoc)) "Project Portal Subsite".Code WHERE (Quote Request Subsite=CONST(No),
                                                                                                                                                                                                                                                   Type=CONST(ServLoc));
                                                   OnValidate=BEGIN
                                                                IF (NOT IsPPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                              END;

                                                   CaptionML=ENU=Document Portal Subsite }
    { 11012901;;Project Portal Subsite Descr;Text30;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Portal Subsite".Description WHERE (Code=FIELD(Project Portal Subsite)));
                                                   CaptionML=ENU=Document Portal Subsite Description;
                                                   Editable=No }
    { 11012910;;Private Company Document;Boolean  ;OnValidate=BEGIN
                                                                IF (NOT IsPPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                              END;

                                                   CaptionML=ENU=Private Company Document }
    { 11012920;;Project Portal Publish Date;DateTime;
                                                   CaptionML=ENU=Document Portal Publish Date;
                                                   Editable=No }
    { 11012930;;Document Portal Subsite;Code20    ;TableRelation=IF (Document Portal Source Type=CONST(Project)) "DPT Subsite Project".Code WHERE (Project No.=FIELD(Document Portal Source No.),
                                                                                                                                                   Quote Request Subsite=CONST(No))
                                                                                                                                                   ELSE IF (Document Portal Source Type=CONST(ServiceLoc)) "DPT Default Subsite".Code WHERE (Source Type=CONST(ServiceLocation),
                                                                                                                                                                                                                                             Quote Request Subsite=CONST(No))
                                                                                                                                                                                                                                             ELSE "DPT Default Subsite".Code WHERE (Source Type=CONST(Project),
                                                                                                                                                                                                                                                                                    Quote Request Subsite=CONST(No));
                                                   OnValidate=BEGIN
                                                                IF (NOT IsDPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                              END;

                                                   CaptionML=ENU=Document Portal Subsite (Dual) }
    { 11012940;;Document Portal Private Doc;Boolean;
                                                   OnValidate=BEGIN
                                                                IF (NOT IsDPTDocumentChangeAllowed) THEN
                                                                  ERROR(Text025);
                                                              END;

                                                   CaptionML=ENU=Document Portal Private Document (Dual) }
    { 11012941;;Document Portal Source Type;Option;CaptionML=ENU=Document Portal Source Type (Dual);
                                                   OptionCaptionML=[ENU=" ,Project,Service Location";
                                                                    SVE=" ,Project,Serviceplats"];
                                                   OptionString=[ ,Project,ServiceLoc];
                                                   Editable=No }
    { 11012942;;Document Portal Source No.;Code20 ;CaptionML=ENU=Document Portal Source No. (Dual);
                                                   Editable=No }
    { 11012950;;Modification Comment;Text80       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Modification Date".Comment WHERE (Document No.=FIELD(No.),
                                                                                                                  Date=FIELD(Modification Date)));
                                                   CaptionML=ENU=Modification Comment;
                                                   Editable=No }
    { 11012951;;DPTPublish         ;Boolean       ;CaptionML=ENU=Document published }
    { 11012960;;Parent Table No. Filter;Integer   ;FieldClass=FlowFilter }
    { 11012961;;Parent Table Key 1 Filter;Code20  ;FieldClass=FlowFilter }
    { 11012962;;Parent Table Key 2 Filter;Code20  ;FieldClass=FlowFilter }
    { 11012963;;Parent Table Key 3 Filter;Code20  ;FieldClass=FlowFilter }
    { 11012964;;Parent Table Key 4 Filter;Code20  ;FieldClass=FlowFilter }
    { 11012965;;Uploaded by ContactNo;Code20      ;TableRelation=Contact WHERE (Person No.=FILTER(''));
                                                   CaptionML=ENU=Uploaded by Contact;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Document Group,Document Template,Internal Company,Contact No.,Doc. Action,Version }
    {    ;Document Group,Document Template,Internal Company,Contact No.,Document No. }
    {    ;Document No.,Creation Date,Creation Time }
    {    ;Contact No.,Contact Person No.           }
    {    ;Document Sharepoint ID                   }
    {    ;External Document                        }
    {    ;Document Type,Document No.               }
    {    ;Document Type,Contact No.                }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      DocumentMgtSetup@1100528702 : Record 11071831;
      Contact@1100525001 : Record 5050;
      Text000@1100409000 : TextConst 'ENU=Table%1 (%2) is not implemented for this Function.\Please try this from the Project Card.';
      Text004@1199198000 : TextConst 'ENU=Document %1 present for %2;NOR=Dokument %1 finnes for %2;SVE=Dokument %1 finns fîr %2';
      Text008@1100525002 : TextConst 'ENU=Enter contact %1 here, and enter contact person in field %2.;NOR=Angi kontakten %1 her, og angi kontaktperson i feltet ''Person''.;SVE=Ange kontakten %1 hÑr, och ange kontaktperson i fÑltet ''Person''.';
      PostCode@1100525003 : Record 225;
      Employee@1100525005 : Record 5200;
      DocumentType@1100525011 : Record 11012405;
      NoSeriesMgt@1100525010 : Codeunit 396;
      WordAutomation@1100525017 : Codeunit 11012400;
      FileMgt@1100525500 : Codeunit 419;
      Text009@1199198002 : TextConst 'ENU=Unable to change relation because filename document is getting too long. Document %1;NOR=Kan ikke endre relasjonen fordi dokumentets filnavn blir for langt. Dokument %1;SVE=Det gÜr inte att Ñndra relationen eftersom dokumentets filnamn blir fîr lÜngt. Dokument %1';
      Text014@1199198004 : TextConst 'ENU=Path %1 does not exist;NOR=Filbanen %1 finnes ikke;SVE=SîkvÑgen %1 finns inte';
      Text015@1199198005 : TextConst 'ENU=Folder %1 is not empty, cannot remove it.;NOR=Mappen %1 er ikke tom. Den kan ikke fjernes.;SVE=Mappen %1 Ñr inte tom. Den kan inte tas bort.';
      Text017@1100525009 : TextConst 'ENU=Cannot change Sharepoint Document.;NOR=Kan ikke endre Sharepoint-dokumentet.;SVE=Det gÜr inte att Ñndra Sharepoint-dokumentet.';
      Text020@1199198006 : TextConst 'ENU=%1 link(s) have no document link!\Are you sure you want to exit?;NOR=%1 link(er) mangler dokumentlink!\Er du sikker pÜ Ü du vil avslutte?;SVE=%1 lÑnk(ar) har ingen dokumentlÑnk!\ér du sÑker pÜ att du vill avsluta?';
      DocLink@1199198001 : Record 11012747;
      DPA_Management@1100525026 : Codeunit 11012783;
      Text023@1100525027 : TextConst 'ENU=%1 link(s) of document %2 have no document link!;NOR=%1 link(er) i dokument %2 har ingen dokumentlink!;SVE=%1 lÑnk(ar) av dokument %2 har ingen dokumentlÑnk!';
      DocumentFilters@1100528700 : Codeunit 11012432;
      Text024@1210190000 : TextConst 'ENU=File %1 is in use.;NOR=Fil %1 er i bruk.;SVE=Fil %1 anvÑnds.';
      ProjectSiteMgt@1100528300 : Codeunit 11012282;
      Text025@1100525006 : TextConst 'ENU=Document already in Project Portal. Change not allowed.;SVE=Dokumentet finns redan i projektportalen. éndringar tillÜts ej.';
      ExternalDocumentManagement@1100528502 : Codeunit 11012403;
      EmptyRecId@1100525000 : RecordID;
      Text028@1100527600 : TextConst 'ENU=No files to send as attachment.';
      Text029@1100528500 : TextConst 'ENU=Do you want to copy Document %1?;NOR=Dokument %1 er kopiert til dokument %2;SVE=Dokument %1 har kopierats till dokument %2';
      Text030@1100528501 : TextConst 'ENU=Document %1 copied to Document %2;NOR=Vil du kopiere dokument %1?;SVE=Vill du kopiera dokument %1?';
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      Text034@1100527800 : TextConst 'ENU=Document could not be removed from storage.';
      CtrlContactShowTxt@1100528301 : TextConst 'ENU=%1 can only be set to TRUE, when all the %2s are shown in 4PS Control.';

    PROCEDURE AssistEdit@5(OldDoc@11012000 : Record 11012746) : Boolean;
    VAR
      DocumentProperties@1100525000 : Record 11012746;
    BEGIN
      WITH DocumentProperties DO BEGIN
        DocumentProperties := Rec;
        DocumentMgtSetup.GET;
        //Document Nos.
        CASE DocumentProperties."External Document" OF
          TRUE:
            BEGIN
              DocumentMgtSetup.TESTFIELD("External Document Nos.");
              IF NoSeriesMgt.SelectSeries(DocumentMgtSetup."External Document Nos.", OldDoc."No. Series","No. Series") THEN BEGIN
                DocumentMgtSetup.GET;
                DocumentMgtSetup.TESTFIELD("External Document Nos.");     //Document Nos.
                NoSeriesMgt.SetSeries("No.");
                Rec := DocumentProperties;
                EXIT(TRUE);
              END;
            END;
          FALSE:
            BEGIN
              DocumentMgtSetup.TESTFIELD("Document Nos.");
              IF NoSeriesMgt.SelectSeries(DocumentMgtSetup."Document Nos.", OldDoc."No. Series","No. Series") THEN BEGIN
                DocumentMgtSetup.GET;
                DocumentMgtSetup.TESTFIELD("Document Nos.");     //Document Nos.
                NoSeriesMgt.SetSeries("No.");
                Rec := DocumentProperties;
                EXIT(TRUE);
              END;
            END;
        END;
      END;
    END;

    PROCEDURE CheckDefaultDocumentLink@1199198000(DocumentProperties@1199198000 : Record 11012746;OnlyWarn@1100525000 : Boolean) : Boolean;
    VAR
      DocumentLink@1199198001 : Record 11012747;
      DefaultDocumentLink@1199198002 : Record 11012749;
      i@1199198003 : Integer;
      IsDefault@1100528700 : Boolean;
    BEGIN
      i := 0;

      DocumentLink.SETRANGE("Document No.", DocumentProperties."No.");
      DocumentLink.SETRANGE("Internal Company", DocumentProperties."Internal Company");
      IF DocumentLink.FINDSET THEN BEGIN
        REPEAT
          IF FORMAT(DocumentLink."Record ID") = '' THEN BEGIN
            IsDefault := FALSE;
            IF DocumentProperties."Document Type" <> '' THEN BEGIN
              DefaultDocumentLink.RESET;
              DefaultDocumentLink.SETRANGE("Related To", DefaultDocumentLink."Related To"::"Document Type");
              DefaultDocumentLink.SETRANGE("Document Type", DocumentProperties."Document Type");
              DefaultDocumentLink.SETRANGE("Table No.", DocumentLink."Table No.");
              DefaultDocumentLink.SETRANGE("Filter Expression", DocumentLink."Filter Expression");
              IF DefaultDocumentLink.FINDFIRST THEN
                IsDefault := TRUE;
            END;
            IF (DocumentProperties."Document Template" <> '') AND (NOT IsDefault) THEN BEGIN
              DefaultDocumentLink.RESET;
              DefaultDocumentLink.SETRANGE("Related To", DefaultDocumentLink."Related To"::"Document Template");
              DefaultDocumentLink.SETRANGE("Document Group", DocumentProperties."Document Group");
              DefaultDocumentLink.SETRANGE("Template Code", DocumentProperties."Document Template");
              DefaultDocumentLink.SETRANGE("Table No.", DocumentLink."Table No.");
              DefaultDocumentLink.SETRANGE("Filter Expression", DocumentLink."Filter Expression");
              IF DefaultDocumentLink.FINDFIRST THEN
                IsDefault := TRUE;
            END;
            IF IsDefault THEN
              i := i + 1;
          END;
        UNTIL DocumentLink.NEXT = 0;
      END;

      IF i > 0 THEN
        IF OnlyWarn THEN BEGIN
          MESSAGE(Text023, i, DocumentProperties."No.");
        END ELSE BEGIN
          IF CONFIRM(STRSUBSTNO(Text020, i), TRUE) THEN
            EXIT(TRUE) // Close form
          ELSE
            EXIT(FALSE);
        END;
      EXIT(TRUE); // Close form or open next record
    END;

    PROCEDURE CopyAddress@1100525002();
    VAR
      TempAddressFrom@1100525000 : TEMPORARY Record 11125737;
      i@1100525007 : Integer;
      ActionResult@1100525001 : Action;
    BEGIN
      FOR i := 0 TO 7 DO
        GetAddress(i, TempAddressFrom);

      ActionResult := PAGE.RUNMODAL(0, TempAddressFrom);

      IF ActionResult = ACTION::LookupOK THEN BEGIN
        Address := TempAddressFrom.Address;
        "Address 2" := TempAddressFrom."Address 2";
        "Post Code" := TempAddressFrom."Post Code";
        City := TempAddressFrom.City;
        County := TempAddressFrom.County;
        "Country/Region Code" := TempAddressFrom."Country/Region Code";
        "Phone No." := TempAddressFrom."Phone No.";
        "Fax No." := TempAddressFrom."Fax No.";
        "Phone No. 2" := TempAddressFrom."Phone No. 2";
        "Mobile Phone No." := TempAddressFrom."Mobile Phone No.";

        MODIFY(TRUE);
      END;
    END;

    PROCEDURE CopyPostAddress@1210190001();
    BEGIN
      Address := Contact.Address;
      "Address 2" := Contact."Address 2";
      "Post Code" := Contact."Post Code";
      City := Contact.City;
      County := Contact.County;
      "Country/Region Code" := Contact."Country/Region Code";
      "Phone No." := Contact."Phone No.";
      "Fax No." := Contact."Fax No.";
      "Phone No. 2" := Contact."Phone No. 2";
      "Mobile Phone No." := Contact."Mobile Phone No.";
    END;

    PROCEDURE CopySalutation@1210190000(ContactNo@1100525000 : Code[20]);
    VAR
      lvSalutFormulaRec@1210190000 : Record 5069;
    BEGIN
      // Doc Mgt
      Contact.GET(ContactNo);

      //**4PS03.sn
      "Salutation (Formal)" :=
        Contact.GetSalutationSpecial(lvSalutFormulaRec."Salutation Type"::Formal, Contact."Language Code", FALSE);
      "Salutation (Informal)" :=
        Contact.GetSalutationSpecial(lvSalutFormulaRec."Salutation Type"::Informal, Contact."Language Code", FALSE);
      "Intended For" :=
        Contact.GetSalutationSpecial(lvSalutFormulaRec."Salutation Type"::"Intended For", Contact."Language Code", FALSE);
      "Intended for 2" :=
        Contact.GetSalutationSpecial(lvSalutFormulaRec."Salutation Type"::"Intended For 2", Contact."Language Code", FALSE);
      //**4PS03.en
    END;

    PROCEDURE FillReference@1210190017();
    VAR
      Employee@11012000 : Record 5200;
      DocumentMgtSetup@1100528701 : Record 11071831;
      InitSender@11012001 : Text[30];
      InitEditor@11012002 : Text[30];
      DocumentLinkMgt@1199198002 : Codeunit 11012401;
      DocumentDescription@1199198003 : Text[30];
    BEGIN
      IF "External Document" THEN
        EXIT;

      IF Employee.GET(Editor) THEN
        InitEditor := Employee."Name Abbreviation";

      IF Employee.GET(Sender) THEN
        InitSender := Employee."Name Abbreviation";

      DocumentMgtSetup.GET;
      IF DocumentMgtSetup."Custom Reference Format" = '' THEN BEGIN
        // Get source link
        DocumentDescription := DocumentLinkMgt.GetShortDescription(Rec);

        //IF CurrFieldNo IN [FIELDNO(Editor),FIELDNO(Sender)] THEN BEGIN                                //**4PS08.n
        IF (CurrFieldNo IN [FIELDNO(Editor),FIELDNO(Sender)]) OR (CurrFieldNo = 0) THEN BEGIN           //**4PS09.n
          Reference := DocumentDescription;

          IF InitSender <> '' THEN BEGIN
            IF Reference <> '' THEN
              Reference := Reference + '.';
            Reference := Reference + InitSender;
          END;
          IF InitEditor <> '' THEN BEGIN
            IF Reference <> '' THEN
              Reference := Reference + '.';
            Reference := Reference + InitEditor;
          END;
        END;
      END ELSE BEGIN
        CASE TRUE OF
          STRPOS(DocumentMgtSetup."Custom Reference Format", '%1') <> 0,
          ((CurrFieldNo = FIELDNO(Sender)) AND (STRPOS(DocumentMgtSetup."Custom Reference Format", '%2') <> 0)),
          ((CurrFieldNo = FIELDNO(Editor)) AND (STRPOS(DocumentMgtSetup."Custom Reference Format", '%3') <> 0)),
          STRPOS(DocumentMgtSetup."Custom Reference Format", '%4') <> 0,
          ((CurrFieldNo = FIELDNO("No.")) AND (STRPOS(DocumentMgtSetup."Custom Reference Format", '%5') <> 0)),
          (CurrFieldNo = 0):
            Reference := STRSUBSTNO(DocumentMgtSetup."Custom Reference Format",
                                    DocumentLinkMgt.GetShortDescription(Rec),
                                    UPPERCASE(InitSender),
                                    UPPERCASE(InitEditor),
                                    DocumentLinkMgt.GetProjectNo("No."),
                                    "No.");
        END;
      END;
    END;

    PROCEDURE FillEditor@4();
    VAR
      EmplRec@11012000 : Record 5200;
    BEGIN
      IF EmplRec.GET(Sender) THEN BEGIN
        IF EmplRec."Document Editor" <> '' THEN BEGIN
          VALIDATE(Editor,EmplRec."Document Editor")
        END ELSE BEGIN
          FillReference;
        END
      END ELSE BEGIN
        FillReference;
      END;
    END;

    PROCEDURE FillModificationData@1100485012();
    BEGIN
      Modified := CURRENTDATETIME;
      "Modified By" := USERID;
    END;

    PROCEDURE GetAddress@1100525003(AddressSource@1100525000 : 'Company Post Address,Company Visit Address,Person Post Address,Person Visit Address,Project Address,Project Location Address,Service Location Address,Order Address';VAR TempAddressFrom@1100525003 : Record 11125737);
    VAR
      DocumentLink@1100525006 : Record 11012747;
      Job@1100525009 : Record 11072003;
      ProjectLocation@1100525005 : Record 11012011;
      ServiceLocation@1100525008 : Record 11012801;
      ContBusRel@1100525002 : Record 5054;
      Vendor@1100525013 : Record 23;
      OrderAddress@1100525012 : Record 224;
      RID@1100525010 : RecordID;
      RecRef@1100525011 : RecordRef;
      LineNo@1100525004 : Integer;
    BEGIN
      IF TempAddressFrom.FINDLAST THEN
        LineNo := TempAddressFrom."Line No." + 1
      ELSE
        LineNo := 1;

      CASE AddressSource OF
        AddressSource::"Company Post Address":
          BEGIN
            IF Contact.GET("Contact No.") THEN BEGIN
              GetPostAddress(AddressSource, TempAddressFrom, LineNo);
              LineNo += 1;
              GetAltAddress(AddressSource, TempAddressFrom, LineNo);
            END;
          END;
        AddressSource::"Company Visit Address":
          BEGIN
            IF Contact.GET("Contact No.") THEN BEGIN
              GetVisitAddress(AddressSource, TempAddressFrom, LineNo);
              LineNo += 1;
              GetAltAddress(AddressSource, TempAddressFrom, LineNo);
            END;
          END;

        AddressSource::"Person Post Address":
          BEGIN
            IF Contact.GET("Contact Person No.") THEN BEGIN
              GetPostAddress(AddressSource, TempAddressFrom, LineNo);
              LineNo += 1;
              GetAltAddress(AddressSource, TempAddressFrom, LineNo);
            END;
          END;
        AddressSource::"Person Visit Address":
          BEGIN
            IF Contact.GET("Contact Person No.") THEN BEGIN
              GetVisitAddress(AddressSource, TempAddressFrom, LineNo);
              LineNo += 1;
              GetAltAddress(AddressSource, TempAddressFrom, LineNo);
            END;
          END;
        AddressSource::"Project Address":
          BEGIN
            DocumentLink.SETRANGE("Document No.", "No.");
            DocumentLink.SETRANGE("Table No.", DATABASE::Job);
            DocumentLink.SETRANGE("Internal Company", "Internal Company");
            IF DocumentLink.FINDSET THEN BEGIN
              REPEAT
                IF FORMAT(DocumentLink."Record ID") <> '' THEN BEGIN
                  RID := DocumentLink."Record ID";
                  RecRef := RID.GETRECORD();
                  RecRef.SETTABLE(Job);
                  Job.FIND('=');
                  TempAddressFrom.INIT;
                  TempAddressFrom."Line No." := LineNo;
                  TempAddressFrom."Address Source" := AddressSource;
                  TempAddressFrom."Code 1" := Job."No.";
                  TempAddressFrom."Code 2" := '';
                  TempAddressFrom.Address := Job.Address;
                  TempAddressFrom."Address 2" := Job."Address 2";
                  TempAddressFrom."Post Code" := Job."Post Code";
                  TempAddressFrom.City := Job.City;
                  TempAddressFrom.County := Job.County;
                  TempAddressFrom."Country/Region Code" := Job."Country/Region Code";
                  TempAddressFrom."Phone No." := Job."Phone No.";
                  TempAddressFrom."Fax No." := Job."Fax No.";
                  TempAddressFrom."Phone No. 2" := '';
                  TempAddressFrom."Mobile Phone No." := Job."Mobile Phone No.";
                  TempAddressFrom.INSERT;

                  LineNo += 1;

                  ProjectLocation.SETRANGE("Project No.", Job."No.");
                  IF ProjectLocation.FINDSET THEN BEGIN
                    REPEAT
                      TempAddressFrom.INIT;
                      TempAddressFrom."Line No." := LineNo;
                      TempAddressFrom."Address Source" := AddressSource::"Project Location Address";
                      TempAddressFrom."Code 1" := ProjectLocation."Project No.";
                      TempAddressFrom."Code 2" := ProjectLocation.Code;
                      TempAddressFrom.Address := ProjectLocation.Address;
                      TempAddressFrom."Address 2" := ProjectLocation."Address 2";
                      TempAddressFrom."Post Code" := ProjectLocation."Post Code";
                      TempAddressFrom.City := ProjectLocation.City;
                      TempAddressFrom.County := '';
                      TempAddressFrom."Country/Region Code" := ProjectLocation."Country/Region Code";
                      TempAddressFrom."Phone No." := ProjectLocation."Phone No.";
                      TempAddressFrom."Fax No." := ProjectLocation."Fax No.";
                      TempAddressFrom."Phone No. 2" := '';
                      TempAddressFrom."Mobile Phone No." := '';
                      TempAddressFrom.INSERT;

                      LineNo += 1;

                    UNTIL ProjectLocation.NEXT = 0;
                  END;
                END;
              UNTIL DocumentLink.NEXT = 0;
            END;
          END;
        AddressSource::"Service Location Address":
          BEGIN
            DocumentLink.SETRANGE("Document No.", "No.");
            DocumentLink.SETRANGE("Table No.", DATABASE::"Service Location");
            DocumentLink.SETRANGE("Internal Company", "Internal Company");
            IF DocumentLink.FINDSET THEN BEGIN
              REPEAT
                IF FORMAT(DocumentLink."Record ID") <> '' THEN BEGIN
                  RID := DocumentLink."Record ID";
                  RecRef := RID.GETRECORD();
                  RecRef.SETTABLE(ServiceLocation);
                  ServiceLocation.FIND('=');
                  TempAddressFrom.INIT;
                  TempAddressFrom."Line No." := LineNo;
                  TempAddressFrom."Address Source" := AddressSource;
                  TempAddressFrom."Code 1" := ServiceLocation."No.";
                  TempAddressFrom.Address := ServiceLocation.Address;
                  TempAddressFrom."Address 2" := ServiceLocation."Address 2";
                  TempAddressFrom."Post Code" := ServiceLocation."Post Code";
                  TempAddressFrom.City := ServiceLocation.City;
                  TempAddressFrom.County := ServiceLocation.County;
                  TempAddressFrom."Country/Region Code" := ServiceLocation."Country/Region Code";
                  TempAddressFrom."Phone No." := ServiceLocation."Phone No.";
                  TempAddressFrom."Fax No." := ServiceLocation."Fax No.";
                  TempAddressFrom."Phone No. 2" := ServiceLocation."Phone No. 2";
                  TempAddressFrom."Mobile Phone No." := ServiceLocation."Mobile Phone No.";

                  TempAddressFrom.INSERT;

                  LineNo += 1;
                END;
              UNTIL DocumentLink.NEXT = 0;
            END;
          END;
        AddressSource::"Order Address":
          BEGIN
            ContBusRel.SETRANGE("Contact No.","Contact No.");
            ContBusRel.SETFILTER("No.",'<>''''');
            ContBusRel.SETRANGE("Link to Table", ContBusRel."Link to Table"::Vendor);
            IF ContBusRel.FINDFIRST THEN BEGIN
              IF Vendor.GET(ContBusRel."No.") THEN BEGIN
                OrderAddress.SETRANGE("Vendor No.", Vendor."No.");
                IF OrderAddress.FINDSET THEN BEGIN
                  REPEAT
                    TempAddressFrom.INIT;
                    TempAddressFrom."Line No." := LineNo;
                    TempAddressFrom."Address Source" := AddressSource;
                    TempAddressFrom."Code 1" := OrderAddress."Vendor No.";
                    TempAddressFrom."Code 2" := OrderAddress.Code;
                    TempAddressFrom.Address := OrderAddress.Address;
                    TempAddressFrom."Address 2" := OrderAddress."Address 2";
                    TempAddressFrom."Post Code" := OrderAddress."Post Code";
                    TempAddressFrom.City := OrderAddress.City;
                    TempAddressFrom.County := OrderAddress.County;
                    TempAddressFrom."Country/Region Code" := OrderAddress."Country/Region Code";
                    TempAddressFrom."Phone No." := OrderAddress."Phone No.";
                    TempAddressFrom."Fax No." := OrderAddress."Fax No.";
                    TempAddressFrom."Phone No. 2" := '';
                    TempAddressFrom."Mobile Phone No." := '';

                    TempAddressFrom.INSERT;

                    LineNo += 1;
                  UNTIL OrderAddress.NEXT = 0;
                END;
              END;
            END;
          END;
      END;
    END;

    PROCEDURE GetContact@1210190002(lVendorCde@1210190001 : Code[20]) RelationCde : Code[20];
    VAR
      ContBusRelRec@1210190000 : Record 5054;
    BEGIN
      ContBusRelRec.SETCURRENTKEY("Link to Table","No.");
      ContBusRelRec.SETRANGE("No.",lVendorCde);
      ContBusRelRec.SETRANGE("Link to Table",ContBusRelRec."Link to Table"::Vendor);
      IF ContBusRelRec.FIND('-') THEN
        EXIT(ContBusRelRec."Contact No.")
      ELSE
        EXIT('');
    END;

    PROCEDURE GetPostAddress@1100525012(AddressSource@1100525003 : 'Company Post Address,Company Visit Address,Person Post Address,Person Visit Address,Project Address,Project Location Address,Service Location Address,Order Address';VAR TempAddressFrom@1100525002 : Record 11125737;LineNo@1100525001 : Integer);
    BEGIN
      TempAddressFrom.INIT;
      TempAddressFrom."Line No." := LineNo;
      TempAddressFrom."Address Source" := AddressSource;
      TempAddressFrom."Code 1" := Contact."No.";
      TempAddressFrom.Address := Contact.Address;
      TempAddressFrom."Address 2" := Contact."Address 2";
      TempAddressFrom."Post Code" := Contact."Post Code";
      TempAddressFrom.City := Contact.City;
      TempAddressFrom.County := Contact.County;
      TempAddressFrom."Country/Region Code" := Contact."Country/Region Code";
      TempAddressFrom."Phone No." := Contact."Phone No.";
      TempAddressFrom."Fax No." := Contact."Fax No.";
      TempAddressFrom."Phone No. 2" := Contact."Phone No. 2";
      TempAddressFrom."Mobile Phone No." := Contact."Mobile Phone No.";
      TempAddressFrom.INSERT;
    END;

    PROCEDURE GetVisitAddress@1100525013(AddressSource@1100525002 : 'Company Post Address,Company Visit Address,Person Post Address,Person Visit Address,Project Address,Project Location Address,Service Location Address,Order Address';VAR TempAddressFrom@1100525001 : Record 11125737;LineNo@1100525000 : Integer);
    BEGIN
      TempAddressFrom.INIT;
      TempAddressFrom."Line No." := LineNo;
      TempAddressFrom."Address Source" := AddressSource;
      TempAddressFrom."Code 1" := Contact."No.";
      TempAddressFrom.Address := Contact."Visit Address";
      TempAddressFrom."Address 2" := Contact."Visit Address 2";
      TempAddressFrom."Post Code" := Contact."Visit Address Post Code";
      TempAddressFrom.City := Contact."Visit Address City";
      TempAddressFrom.County := Contact."Visit Address County";
      TempAddressFrom."Country/Region Code" := Contact."Visit Address Country/Region";
      TempAddressFrom."Phone No." := Contact."Phone No.";
      TempAddressFrom."Fax No." := Contact."Fax No.";
      TempAddressFrom."Phone No. 2" := Contact."Phone No. 2";
      TempAddressFrom."Mobile Phone No." := Contact."Mobile Phone No.";
      TempAddressFrom.INSERT;
    END;

    PROCEDURE GetAltAddress@1100525015(AddressSource@1100525002 : 'Company Post Address,Company Visit Address,Person Post Address,Person Visit Address,Project Address,Project Location Address,Service Location Address,Order Address';VAR TempAddressFrom@1100525001 : Record 11125737;LineNo@1100525000 : Integer);
    VAR
      ContactAltAddress@1100525003 : Record 5051;
    BEGIN
      ContactAltAddress.SETRANGE("Contact No.", Contact."No.");
      IF ContactAltAddress.FINDSET THEN BEGIN
        REPEAT
          TempAddressFrom.INIT;
          TempAddressFrom."Line No." := LineNo;
          TempAddressFrom."Address Source" := AddressSource;
          TempAddressFrom."Code 1" := ContactAltAddress."Contact No.";
          TempAddressFrom."Code 2" := ContactAltAddress.Code;
          TempAddressFrom.Address := ContactAltAddress.Address;
          TempAddressFrom."Address 2" := ContactAltAddress."Address 2";
          TempAddressFrom."Post Code" := ContactAltAddress."Post Code";
          TempAddressFrom.City := ContactAltAddress.City;
          TempAddressFrom.County := ContactAltAddress.County;
          TempAddressFrom."Country/Region Code" := ContactAltAddress."Country/Region Code";
          TempAddressFrom."Phone No." := ContactAltAddress."Phone No.";
          TempAddressFrom."Fax No." := ContactAltAddress."Fax No.";
          TempAddressFrom."Phone No. 2" := '';
          TempAddressFrom."Mobile Phone No." := ContactAltAddress."Mobile Phone No.";
          TempAddressFrom.INSERT;

          LineNo += 1;
        UNTIL ContactAltAddress.NEXT = 0;
      END;
    END;

    PROCEDURE GetEmployerNo@1100485007() EmployerNo : Code[20];
    VAR
      ContBusRel@1100485000 : Record 5054;
    BEGIN
      ContBusRel.RESET;
      ContBusRel.SETRANGE("Contact No.", "Contact No.");
      ContBusRel.SETRANGE("Link to Table", ContBusRel."Link to Table"::Employer);
      IF ContBusRel.FINDFIRST THEN
        EmployerNo := ContBusRel."No."
      ELSE
        EmployerNo := '';
    END;

    PROCEDURE GetLastVersion@1100485013() lvVersion : Integer;
    VAR
      DocumentProperties@1100485000 : Record 11012746;
    BEGIN
      //DocumentProperties.SETCURRENTKEY("Document Group", "Document Template", Type, "Contact No.", "Document No.");
      DocumentProperties.SETCURRENTKEY("Document Group", "Document Template","Internal Company","Contact No.", "Document No.");
      DocumentProperties.SETRANGE("Document Group", "Document Group");
      DocumentProperties.SETRANGE("Document Template", "Document Template");
      DocumentProperties.SETRANGE("Contact No.", "Contact No.");
      DocumentProperties.SETRANGE("Document No.", "Document No.");
      DocumentProperties.SETRANGE("Internal Company", "Internal Company");

      //**4PS 23172
      //lvVersion := 1;
      lvVersion := 0;
      //**4PS 23172

      IF DocumentProperties.FINDSET(FALSE,FALSE) THEN
        REPEAT
          IF DocumentProperties.Version > lvVersion THEN
            lvVersion := DocumentProperties.Version;
        UNTIL DocumentProperties.NEXT = 0;
    END;

    PROCEDURE HandleRenameofContact@1210190007(lvCompanyname@1210190000 : Text[50];OldContactNo@1210190001 : Code[20];NewContactNo@1210190002 : Code[20];lvContactDocGroup@1210190008 : Code[10];lvMoveToOtherContact@1100485002 : Boolean);
    VAR
      lDocGroupRec@1210190006 : Record 11012400;
      OldContact@1210190010 : Record 5050;
      NewContact@1100525000 : Record 5050;
      DocumentProperties@1210190007 : Record 11012746;
      lTxtPath_old@1210190004 : Text[132];
      lTxtPath_new@1210190009 : Text[132];
      lUCFile@1210190003 : Text[132];
      lUCPath@1210190005 : Text[132];
      DocumentLink@1100528700 : Record 11012747;
      RecRef1@1100528701 : RecordRef;
      RecRef2@1100528702 : RecordRef;
      FileManagement@1100528400 : Codeunit 419;
    BEGIN
      //When the Contact No. field is renamed we need to move the collection of documents to a new directory.
      //Function can also be used for moving documents from one contact to another: lvMoveToOtherContact
      //NOTE: THis function doesn't work for Secured documents because this function asumes that al documenten for 1 contact are in the
      //same folder.

      RESET;

      lDocGroupRec.Code := lvContactDocGroup;
      lDocGroupRec.FIND('=');

      OldContact.GET(OldContactNo);
      IF OldContact.IsCompany OR OldContact.IsPerson THEN BEGIN
        lTxtPath_old :=  lDocGroupRec."Document Directory" + 'R' + OldContactNo;
        SETRANGE("Contact No.", OldContactNo);
      END ELSE BEGIN
        lTxtPath_old :=  lDocGroupRec."Document Directory" + 'R' + OldContact."Company No.";
        SETRANGE("Contact No.", OldContact."Company No.");
        SETRANGE("Contact Person No.", OldContactNo);
      END;
      SETRANGE("External Document", FALSE);
      SETRANGE("Internal Company", lvCompanyname);

      NewContact.GET(NewContactNo);
      SETCURRENTKEY("Contact No.");
      //first modify the document records.
      DocumentProperties.COPY(Rec); //because we change "Contact No.", the order changes, therefore use different variable for loop
      IF DocumentProperties.FINDSET(TRUE,FALSE) THEN
        REPEAT
          Rec := DocumentProperties;
          IF lvMoveToOtherContact THEN BEGIN
            IF NewContact.IsCompany OR NewContact.IsPerson THEN BEGIN
              lTxtPath_new := lDocGroupRec."Document Directory" + 'R' + NewContactNo;
              VALIDATE("Contact No.", NewContactNo);
              VALIDATE("Contact Person No.", '');
            END ELSE BEGIN
              lTxtPath_new := lDocGroupRec."Document Directory" + 'R' + NewContact."Company No.";
              VALIDATE("Contact No.", NewContact."Company No.");
              VALIDATE("Contact Person No.", NewContactNo);
            END;
          END ELSE BEGIN
            IF NewContact.IsCompany OR NewContact.IsPerson THEN BEGIN
              lTxtPath_new := lDocGroupRec."Document Directory" + 'R' + NewContactNo;
              "Contact No." := NewContactNo
            END ELSE BEGIN
              lTxtPath_new := lDocGroupRec."Document Directory" + 'R' + NewContact."Company No.";
              "Contact Person No." := NewContactNo;
            END;
          END;

          IF IsFileSystemOnPremiseDocument THEN BEGIN
            lUCFile := UPPERCASE(File);
            lUCPath := UPPERCASE(lTxtPath_old);
            IF STRPOS(lUCFile, lUCPath) = 1 THEN BEGIN
              VALIDATE(File, DELSTR(File, 1, STRLEN(lTxtPath_old)));
              IF STRLEN(lTxtPath_new + File) <= 127 THEN BEGIN
                VALIDATE(File, lTxtPath_new + File);
                IF lTxtPath_new <> lTxtPath_old THEN
                  IF FileManagement.ClientFileExists(File) THEN
                    ERROR(Text004, File, NewContactNo);
              END ELSE BEGIN
                ERROR(Text009,"No.");
              END;
            END;
          END;
          MODIFY(TRUE);
          MARK(TRUE);
        UNTIL DocumentProperties.NEXT = 0;

      RecRef1.GETTABLE(OldContact);
      RecRef2.GETTABLE(NewContact);
      DocumentLink.HandleRenameOfDocumentLink(RecRef1.RECORDID, RecRef2.RECORDID);

      //If the above went fine then we can move the word-files to the new directory
      SETRANGE("Contact No.");
      SETRANGE("Contact Person No.");
      MARKEDONLY(TRUE);
      IF FINDFIRST THEN
        IF (lTxtPath_new <> lTxtPath_old) THEN BEGIN
          IF lDocGroupRec."Document Directory" <> '' THEN BEGIN
            IF NOT FileMgt.ClientDirectoryExists(lTxtPath_new) THEN BEGIN
              IF FileMgt.ClientDirectoryExists(lDocGroupRec."Document Directory") THEN
                FileMgt.CreateClientFolder(lTxtPath_new)
              ELSE
                ERROR(Text014,lDocGroupRec."Document Directory");
            END;

            HandleMoveWordFiles(Rec,lTxtPath_old,lTxtPath_new);

            IF NOT lvMoveToOtherContact THEN
              HandleDeleteFolder(lTxtPath_old);

          END;
        END;
      MARKEDONLY(FALSE);

      SETRANGE("External Document", TRUE);
      IF OldContact.IsCompany OR OldContact.IsPerson THEN
        SETRANGE("Contact No.", OldContactNo)
      ELSE BEGIN
        SETRANGE("Contact No.", OldContact."Company No.");
        SETRANGE("Contact Person No.", OldContactNo);
      END;
      {
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Contact No." := lvContact_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
      }
      WHILE FINDFIRST DO BEGIN
        IF lvMoveToOtherContact THEN BEGIN
          IF NewContact.IsCompany OR NewContact.IsPerson THEN BEGIN
            VALIDATE("Contact No.", NewContactNo);
            VALIDATE("Contact Person No.", '');
          END ELSE BEGIN
            VALIDATE("Contact No.", NewContact."Company No.");
            VALIDATE("Contact Person No.", NewContactNo);
          END;
        END ELSE BEGIN
          IF NewContact.IsCompany OR NewContact.IsPerson THEN
            "Contact No." := NewContactNo
          ELSE
            "Contact Person No." := NewContactNo;
        END;
        MODIFY(TRUE);
      END;
    END;

    PROCEDURE HandleRenameofCountry@1210190010(lvCompanyname@1210190000 : Text[30];lvCountry_old@1210190001 : Code[10];lvCountry_new@1210190002 : Code[10]);
    BEGIN
      RESET;
      SETRANGE("Country/Region Code",lvCountry_old);
      SETRANGE("Internal Company",lvCompanyname);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Country/Region Code" := lvCountry_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
    END;

    PROCEDURE HandleRenameofDocumentGroup@1210190005(lvCompanyname@1210190000 : Text[30];lvDocGroup_old@1210190001 : Code[10];lvDocGroup_new@1210190002 : Code[10]);
    BEGIN
      RESET;
      SETCURRENTKEY("Document Group");
      SETRANGE("Document Group",lvDocGroup_old);
      SETRANGE("Internal Company",lvCompanyname);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Document Group" := lvDocGroup_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
    END;

    PROCEDURE HandleRenameofDocumentTemplate@1210190006(lvCompanyname@1210190000 : Text[30];lvDocGroup_old@1210190001 : Code[10];lvDocTemplate_old@1210190003 : Code[20];lvDocGroup_new@1210190002 : Code[10];lvDocTemplate_new@1210190005 : Code[20]);
    BEGIN
      RESET;
      SETCURRENTKEY("Document Group", "Document Template");
      SETRANGE("Document Group",lvDocGroup_old);
      SETRANGE("Document Template",lvDocTemplate_old);
      SETRANGE("Internal Company",lvCompanyname);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Document Group" := lvDocGroup_new;
          "Document Template" := lvDocTemplate_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
    END;

    PROCEDURE HandleRenameofDocumentType@1210190009(lvCompanyname@1210190000 : Text[30];lvDocType_old@1210190001 : Code[10];lvDocType_new@1210190002 : Code[10]);
    BEGIN
      RESET;
      SETRANGE("Document Type",lvDocType_old);
      SETRANGE("Internal Company",lvCompanyname);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Document Type" := lvDocType_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
    END;

    PROCEDURE HandleRenameofEmployee@1210190011(lvCompanyname@1210190000 : Text[30];lvEmployee_old@1210190001 : Code[20];lvEmployee_new@1210190002 : Code[20]);
    BEGIN
      //The Fields Sender, Editor, 'Adressed to' and 'Original to' all refer to the employee table.
      RESET;
      SETRANGE(Sender,lvEmployee_old);
      SETRANGE("Internal Company",lvCompanyname);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          Sender := lvEmployee_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;

      SETRANGE(Editor,lvEmployee_old);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          Editor := lvEmployee_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
      SETRANGE(Editor); //call C-029598

      SETRANGE("Addressed To",lvEmployee_old);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Addressed To" := lvEmployee_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
      SETRANGE("Addressed To"); //call C-029598

      SETRANGE("Original To",lvEmployee_old);
      IF FINDSET(TRUE,FALSE) THEN
        REPEAT
          "Original To" := lvEmployee_new;
          MODIFY(TRUE);
        UNTIL NEXT = 0;
      SETRANGE("Original To"); //call C-029598
    END;

    LOCAL PROCEDURE HandleMoveWordFiles@1100485011(VAR DocumentProperties@1100485000 : Record 11012746;lTxtPath_old@1100485005 : Text[132];lTxtPath_new@1100485004 : Text[132]);
    VAR
      lUCFile@1100485002 : Text[132];
      lUCPath@1100485001 : Text[132];
      lOldFile@1100485006 : Text[132];
      lNewFile@1100485003 : Text[132];
      lTestLength@1100485008 : Integer;
      FileManagement@1100528400 : Codeunit 419;
    BEGIN
      IF DocumentProperties.FINDSET THEN
        REPEAT
          IF IsFileSystemOnPremiseDocument THEN BEGIN
            lUCFile := UPPERCASE(File);
            lUCPath := UPPERCASE(lTxtPath_new);
            IF STRPOS(lUCFile, lUCPath) = 1 THEN BEGIN
              VALIDATE(File, DELSTR(File, 1, STRLEN(lTxtPath_new)));
              lOldFile := lTxtPath_old + File;
              IF FileManagement.ClientFileExists(lOldFile) THEN BEGIN
                lNewFile := lTxtPath_new + File;
                VALIDATE(File, lNewFile);
                lTestLength := STRLEN(('move ' + lOldFile + ' ' + lNewFile));
                FileMgt.RenameClientFile(lOldFile, lNewFile, TRUE);
              END;
            END;
          END;
        UNTIL DocumentProperties.NEXT = 0;
    END;

    PROCEDURE HandleDeleteFolder@1100485010(lTxtPath@1100485000 : Text[132]);
    VAR
      FileMgt@1100525000 : Codeunit 419;
      lCanDelete@1100485001 : Boolean;
    BEGIN
      IF NOT FileMgt.ClientDirectoryExists(lTxtPath) THEN
        EXIT;

      lCanDelete := FileMgt.ClientFolderIsEmpty(lTxtPath, '');
      IF lCanDelete THEN
        FileMgt.DeleteClientFolder(lTxtPath)
      ELSE
        MESSAGE(Text015, lTxtPath);
    END;

    PROCEDURE LookupDocumentTemplate@1100525001(IsEditable@1100525000 : Boolean);
    VAR
      DocumentTemplate@1100525004 : Record 11012401;
      DocumentTemplate2@1199198000 : Record 11012401;
      TempDocumentTemplate@1100525003 : TEMPORARY Record 11012401;
      DocumentPermission@1100525002 : Record 11012404;
      AddTemplate@1100525001 : Boolean;
    BEGIN
      DocumentTemplate.SETRANGE("Document Group", "Document Group");
      IF "Document Template" = '' THEN
        DocumentTemplate.SETRANGE(Type, DocumentTemplate.Type::Miscellaneous)
      ELSE
        IF DocumentTemplate2.GET("Document Group", "Document Template") THEN
          DocumentTemplate.SETRANGE(Type, DocumentTemplate2.Type);

      IF DocumentTemplate.FINDSET THEN BEGIN
        REPEAT
          AddTemplate := FALSE;
          DocumentPermission.SETRANGE("Document Group", DocumentTemplate."Document Group");
          DocumentPermission.SETRANGE("Template Code", DocumentTemplate."Template Code");
          DocumentPermission.SETRANGE("User ID");
          IF NOT DocumentPermission.FINDFIRST THEN BEGIN
            //no permissions defined for any user, this means all have permissions
            AddTemplate := TRUE;
          END ELSE BEGIN
            //there are permissions defined, check whether they are defined for the current user
            DocumentPermission.SETRANGE("User ID", USERID);
            IF DocumentPermission.FINDFIRST THEN
              AddTemplate := TRUE;
          END;

          IF AddTemplate THEN BEGIN
            TempDocumentTemplate.TRANSFERFIELDS(DocumentTemplate, TRUE);
            TempDocumentTemplate.INSERT;
          END;
        UNTIL DocumentTemplate.NEXT = 0;
      END;

      IF PAGE.RUNMODAL(PAGE::"Document Template List", TempDocumentTemplate) = ACTION::LookupOK THEN
        IF IsEditable THEN BEGIN
          VALIDATE("Document Template", TempDocumentTemplate."Template Code");
          IF (TempDocumentTemplate."Project Portal Subsite" <> '') THEN BEGIN
            "Project Portal Subsite" := TempDocumentTemplate."Project Portal Subsite";
            "Document Type" := TempDocumentTemplate."Document Type";
            "Private Company Document" := TempDocumentTemplate."Private Company Document";
          END;
          IF (TempDocumentTemplate."Document Portal Subsite" <> '') THEN BEGIN
            "Document Portal Subsite" := TempDocumentTemplate."Document Portal Subsite";
            "Document Type" := TempDocumentTemplate."Document Type";
            "Document Portal Private Doc" := TempDocumentTemplate."Document Portal Private Doc";
          END;
        END;
    END;

    PROCEDURE OpenDocument@1210190004();
    VAR
      AzureFileStorageManagement@1100527806 : Codeunit 11012350;
      DocumentServiceManagement@1100528400 : Codeunit 9510;
      InteractionLogEntry@1100527804 : Record 11072027;
      FileName@1100527801 : Text;
      ServerTempFileName@1100528402 : Text;
    BEGIN
      CASE "Storage Type" OF
        "Storage Type"::"File System on Premise":
          BEGIN
            FileName := FileNameShort;
            DOWNLOAD(File,'','',STRSUBSTNO('(*.%1)|*.%1|(*.*)|*.*',Extension),FileName);
          END;
        "Storage Type"::"SharePoint Online":
          BEGIN
            FileName := FileNameShort;
            DocumentServiceManagement.SetUseDocumentService4PS(TRUE);
            ServerTempFileName := DocumentServiceManagement.DownloadFileFromCloudToServerSilent("Document Service URL");
            DOWNLOAD(ServerTempFileName,'','',STRSUBSTNO('(*.%1)|*.%1|(*.*)|*.*',Extension),FileName);
            ERASE(ServerTempFileName);
          END;
        "Storage Type"::"Azure File Storage":
          HYPERLINK(AzureFileStorageManagement.GetUrlByResource("Document Service URL"));
        "Storage Type"::DPTDUAL,"Storage Type"::PPT, "Storage Type"::CTB:
          HYPERLINK(GetStorageURI);
        ELSE
          IF "Interaction Entry No." <> 0 THEN BEGIN
              IF InteractionLogEntry.GET("Interaction Entry No.") THEN
                IF InteractionLogEntry."Attachment No." <> 0 THEN
                  InteractionLogEntry.OpenAttachment
                ELSE
                  InteractionLogEntry.ShowDocument;
          END;
      END;
    END;

    PROCEDURE EditDocument@1100528504();
    VAR
      DocumentServiceManagement@1100528500 : Codeunit 9510;
      DPTInterface@1100525000 : Codeunit 11012451;
    BEGIN
      TESTFIELD("Final Printed", FALSE);
      MoveDocumentToEditStorage();
      CASE "Storage Type" OF
        "Storage Type"::"SharePoint Online":
          BEGIN
            DocumentServiceManagement.SetUseDocumentService4PS(TRUE);
            DocumentServiceManagement.OpenDocument(GetStorageURI());
          END;
        "Storage Type"::"File System on Premise", "Storage Type"::DPTDUAL, "Storage Type"::PPT, "Storage Type"::CTB:
          HYPERLINK(GetStorageURI);
      END;

      "Modified By" := USERID;
      Modified := CURRENTDATETIME;
      MODIFY;
    END;

    PROCEDURE IsConfidentialOwner@1100525004() : Boolean;
    VAR
      UserSetup@1100525001 : Record 91;
    BEGIN
      IF "Internal Company" <> '' THEN
        UserSetup.CHANGECOMPANY("Internal Company");

      IF NOT UserSetup.GET(USERID) THEN UserSetup.INIT;
      IF "External Document" THEN BEGIN
        IF (UserSetup."Employee No." <> "Addressed To") AND
           (UserSetup."Employee No." <> "Original To") AND
           Confidential THEN
          EXIT(FALSE);
      END ELSE BEGIN
        IF (UserSetup."Employee No." <> Editor) AND
           (UserSetup."Employee No." <> Sender) AND
           Confidential THEN
          EXIT(FALSE);
      END;
      EXIT(TRUE);
    END;

    PROCEDURE PrintDocument@1100525006();
    VAR
      ExternalDocumentManagement@1100525003 : Codeunit 11012403;
      FileManagement@1100528400 : Codeunit 419;
      FilePath@1100525002 : Text[1024];
    BEGIN
      IF (HasStorageURI) THEN BEGIN
        IF ("External Document") THEN
          ExternalDocumentManagement.PrintExternalDocument(Rec, "Internal Company")
        ELSE BEGIN
          WriteContentToClient(FilePath);
          PrintWordDocument(FilePath);
          FileManagement.DeleteClientFile(FilePath);
        END;
      END;
    END;

    LOCAL PROCEDURE PrintWordDocument@1100528701(ClientFile@1100528701 : Text);
    VAR
      WordAutomation@1100528702 : Codeunit 11012400;
    BEGIN
      WordAutomation.InitialiseForPrinting;
      WordAutomation.PrintWithPrinterSelection(ClientFile);
      WordAutomation.TerminateAfterPrinting;
    END;

    PROCEDURE CreateDocumentLink@1100525005(RID@1100525001 : RecordID) : Boolean;
    VAR
      DocumentLink@1100525000 : Record 11012747;
      SeqNo@1199198000 : Integer;
      DocumentLinkMgt@1100528400 : Codeunit 11012401;
    BEGIN
      IF (FORMAT(RID) <> '') AND ("No." <> '') THEN BEGIN

        IF DocumentLinkExists(RID) THEN
          EXIT (FALSE);

        DocumentLink.RESET;
        DocumentLink.SETRANGE("Document No.", "No.");
        IF DocumentLink.FINDLAST THEN
          SeqNo := DocumentLink."Seq. No." + 10000
        ELSE
          SeqNo := 10000;

        DocumentLink.INIT;
        DocumentLink."Document No." := "No.";
        DocumentLink."Seq. No." := SeqNo;
        DocumentLink."Table No." := RID.TABLENO;
        DocumentLink."Filter Expression" := DocumentLinkMgt.GetFilterExpression(RID);
        DocumentLink."Internal Company" := "Internal Company";
        DocumentLink."Record ID" := RID;
        DocumentLink.INSERT;

        EXIT(TRUE); // Give true back to the form and update form
      END;

      EXIT(FALSE); // form is not updated
    END;

    PROCEDURE GetType@1199198001() : Text[80];
    VAR
      DocumentTemplate@1199198000 : Record 11012401;
    BEGIN
      IF NOT DocumentTemplate.GET("Document Group", "Document Template") THEN
        DocumentTemplate.Type := DocumentTemplate.Type::Miscellaneous;
      EXIT(FORMAT(DocumentTemplate.Type));
    END;

    PROCEDURE TypeIsMisc@1100525008() : Boolean;
    VAR
      DocumentTemplate@1100525000 : Record 11012401;
    BEGIN
      IF NOT DocumentTemplate.GET("Document Group", "Document Template") THEN
        DocumentTemplate.Type := DocumentTemplate.Type::Miscellaneous;
      EXIT(DocumentTemplate.Type = DocumentTemplate.Type::Miscellaneous);
    END;

    PROCEDURE SetVar@1199198002(DocumentLink@1199198000 : Record 11012747);
    BEGIN
      DocLink := DocumentLink;
    END;

    PROCEDURE FullFileName@1100485002() : Text[250];
    VAR
      WordAutomation@1100528700 : Codeunit 11012400;
      Extension@1100485001 : Text[30];
    BEGIN
      IF File = '' THEN
        EXIT(File);

      IF "External Document" THEN
        EXIT(File)
      ELSE BEGIN
        IF WordAutomation.ExistingFileName(File, TRUE, FALSE, Extension) THEN
          EXIT(File + Extension)
        ELSE
          EXIT(File);
      END;
    END;

    PROCEDURE FileName@1100528405() : Text[250];
    BEGIN
      CASE "Storage Type" OF
        "Storage Type"::"File System on Premise":
          EXIT(FileMgt.GetFileName(FullFileName));
        "Storage Type"::"SharePoint Online", "Storage Type"::"Azure File Storage":
          EXIT(FileMgt.GetFileName("Document Service URL"));
      END;
    END;

    PROCEDURE FileNameShort@1100527809() : Text[250];
    BEGIN
      EXIT(FileMgt.GetFileName(GetStorageURI));
    END;

    PROCEDURE Extension@1100527808() : Text;
    VAR
      URI@1100527801 : Text;
    BEGIN
      IF ("File Extension" <> '') THEN
        EXIT("File Extension");

      URI := GetStorageURI;
      EXIT(FileMgt.GetExtension(URI));
    END;

    PROCEDURE DPA_SetDefaultDpmtFromNoSeries@1100000995(xRecRef@1100525002 : RecordRef);
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      xRecRef.SETTABLE(xRec);
      DPA_Management.SetDepartmentCodeNoSeries(
        TABLENAME,
        "Department Code",
        "No. Series",
        xRec."No. Series" );
    END;

    LOCAL PROCEDURE DPA_OnInsert@1100000991();
    VAR
      Dimension1Code@1100528400 : Code[20];
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      Dimension1Code :=
        DPA_Management.GetNoSeriesDepartmentCode(
          "No. Series",
          xRec."No. Series",
          DATABASE::"Document Properties");
      IF Dimension1Code <> '' THEN
        "Department Code" := Dimension1Code;

      IF "Department Code" <> '' THEN
        VALIDATE("Department Code");
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012746) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012746');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Document Properties", "Department Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Department Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Department Code");
    END;

    PROCEDURE GetCaptionClass@1100528700(Index@1100528700 : Integer) : Text[80];
    BEGIN
      EXIT(DocumentFilters.GetLinkFieldCaption(Index));
    END;

    PROCEDURE CheckFileIsInUse@1210190003();
    VAR
      WordAutomation@1210190000 : Codeunit 11012400;
      FileMgt@1100525000 : Codeunit 419;
      Extension@1210190002 : Text[30];
    BEGIN
      IF WordAutomation.ExistingFileName(Rec.File, TRUE, FALSE, Extension) THEN
        IF FileMgt.ClientFileIsInUse(File + Extension) THEN
          ERROR(Text024, File + Extension);
    END;

    PROCEDURE UpdateProjectPortal@1100528300();
    VAR
      DocumentLink@1100528301 : Record 11012747;
      Job@1100528302 : Record 11072003;
      SharePointIntegration@1100528300 : Codeunit 11020210;
      DocumentPortalProject@1100528305 : Codeunit 11012948;
      RecRef@1100528303 : RecordRef;
      RecId@1100528304 : RecordID;
    BEGIN
      IF (NOT SharePointIntegration.IsProjectPortalActive) THEN
        EXIT;

      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE("Table No.", DATABASE::Job);
      IF (NOT DocumentLink.FINDSET) THEN
        EXIT;

      REPEAT
        RecId := DocumentLink."Record ID";
        IF (RecRef.GET(RecId)) THEN BEGIN
          RecRef.SETTABLE(Job);
          IF (Job.IsJobInProjectPortal) AND
             (File = '') AND ("Web link" <> '')
          THEN
            DocumentPortalProject.ModifyDocument(Job, Rec, TRUE);
        END;
      UNTIL (DocumentLink.NEXT = 0);
    END;

    PROCEDURE AddAllProjectDocsToPPT@1100528301(RecId@1100528300 : RecordID);
    VAR
      Job@1100528302 : Record 11072003;
      DocumentPortalProject@1100528301 : Codeunit 11012948;
      RecRef@1100528303 : RecordRef;
    BEGIN
      RecRef.GET(RecId);
      IF (RecId.TABLENO <> DATABASE::Job) THEN
        ERROR(Text000, RecRef.CAPTION, RecId.TABLENO);

      RecRef.GET(RecId);
      RecRef.SETTABLE(Job);
      DocumentPortalProject.AddDocuments(Job);
    END;

    PROCEDURE OpenCommentSheet@1100528302();
    VAR
      CommentLine@1100528301 : Record 97;
      CommentSheet@1100528300 : Page 124;
    BEGIN
      CommentLine.FILTERGROUP(9);
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::"Document Properties");
      CommentLine.FILTERGROUP(0);
      CommentLine.SETRANGE("No.", "No.");
      CommentSheet.SETTABLEVIEW(CommentLine);
      CommentSheet.RUNMODAL;
      IF (CommentSheet.IsUpdated) THEN
        UpdateProjectPortal;
    END;

    LOCAL PROCEDURE IsPPTDocumentChangeAllowed@1100525000() : Boolean;
    VAR
      DocumentProperties@1100525003 : Record 11012746;
      DocumentLink@1100525000 : Record 11012747;
      Job@1100525001 : Record 11072003;
      RecRef@1100525002 : RecordRef;
    BEGIN
      IF ("Web link" = '') THEN
        EXIT(TRUE);
      DocumentProperties.GET("No."); //get old record
      IF (Description = DocumentProperties.Description) AND
         ("Project Portal Subsite" = DocumentProperties."Project Portal Subsite") AND
         ("Document Type" = DocumentProperties."Document Type") AND
         ("Private Company Document" = DocumentProperties."Private Company Document") AND
         (("Contact No." = DocumentProperties."Contact No.") OR ( NOT DocumentProperties."Private Company Document"))
      THEN
        EXIT(TRUE);
      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE("Table No.", DATABASE::Job);
      IF (NOT DocumentLink.FINDSET) THEN
        EXIT(TRUE);
      REPEAT
        RecRef.GET(DocumentLink."Record ID");
        RecRef.SETTABLE(Job);
        IF (Job.IsJobInProjectPortal) THEN
          EXIT(FALSE);
      UNTIL (DocumentLink.NEXT = 0);
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE IsDPTDocumentChangeAllowed@1100528306() : Boolean;
    VAR
      DocumentProperties@1100525003 : Record 11012746;
      DocumentLink@1100525000 : Record 11012747;
      Job@1100525001 : Record 11072003;
      RecRef@1100525002 : RecordRef;
    BEGIN
      IF ("Web link" = '') THEN
        EXIT(TRUE);
      DocumentProperties.GET("No."); //get old record
      IF (Description = DocumentProperties.Description) AND
         ("Document Portal Subsite" = DocumentProperties."Document Portal Subsite") AND
         ("Document Type" = DocumentProperties."Document Type") AND
         ("Document Portal Private Doc" = DocumentProperties."Document Portal Private Doc") AND
         (("Contact No." = DocumentProperties."Contact No.") OR ( NOT DocumentProperties."Document Portal Private Doc"))
      THEN
        EXIT(TRUE);
      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE("Table No.", DATABASE::Job);
      IF (NOT DocumentLink.FINDSET) THEN
        EXIT(TRUE);
      REPEAT
        RecRef.GET(DocumentLink."Record ID");
        RecRef.SETTABLE(Job);
        IF (Job.IsDocumentPortalDualProject) THEN
          EXIT(FALSE);
      UNTIL (DocumentLink.NEXT = 0);
      EXIT(TRUE);
    END;

    PROCEDURE GetFirstProjectNo@1100409001(DocumentNo@1100409000 : Code[20]) : Code[20];
    VAR
      DocumentLink@1100409001 : Record 11012747;
      Job@1100409002 : Record 11072003;
      RecRef@1100409003 : RecordRef;
    BEGIN
      //kzwerver.n #C016690
      DocumentLink.SETRANGE("Document No.", DocumentNo);
      DocumentLink.SETRANGE("Table No.", DATABASE::Job);
      DocumentLink.SETRANGE("Internal Company", COMPANYNAME);
      IF (DocumentLink.FINDFIRST) THEN BEGIN
        RecRef.GET(DocumentLink."Record ID");
        RecRef.SETTABLE(Job);
        EXIT(Job."No.");
      END;
      EXIT('');
    END;

    PROCEDURE SetFilterPicturesOnly@1100528600();
    VAR
      FileManagement@1100528601 : Codeunit 419;
      Filters@1100528600 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.ArrayList";
      i@1100528603 : Integer;
      FilterString@1100528604 : Text;
    BEGIN
      FileManagement.GetPossiblePicturesExtensions(Filters);
      SETRANGE("External Document", TRUE);

      FOR i := 0 TO Filters.Count -1 DO BEGIN
        IF FilterString <> '' THEN
          FilterString += '|';
        FilterString += FORMAT(Filters.Item(i));//STRSUBSTNO('%1', Filters.Item(i));
      END;
      SETFILTER("File Extension", LOWERCASE(FilterString) + '|' + UPPERCASE(FilterString));
    END;

    PROCEDURE IsDocumentPicture@1100525009() : Boolean;
    VAR
      FileManagement@1100528600 : Codeunit 419;
      Filters@1100528601 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.ArrayList";
    BEGIN
      IF NOT "External Document" THEN
        EXIT(FALSE);
      FileManagement.GetPossiblePicturesExtensions(Filters);
      IF Filters.IndexOf("File Extension") > -1 THEN
        EXIT(TRUE);
    END;

    PROCEDURE FileCanBeConvertedToPDF@1100528400() : Boolean;
    VAR
      PDFFileManagement@1100525000 : Codeunit 11020228;
    BEGIN
      IF File <> '' THEN
        EXIT(PDFFileManagement.FileCanBeConvertedToPDF(FullFileName))
      ELSE
        IF "Document Service URL" <> '' THEN
          EXIT(PDFFileManagement.FileCanBeConvertedToPDF("Document Service URL"));
    END;

    PROCEDURE IsPPTFieldVisible@1100528303() : Boolean;
    VAR
      SharePointSetup4PS@1100528301 : Record 11012730;
      Job@1100528300 : Record 11072003;
      DocumentLink@1100528303 : Record 11012747;
      RecRef@1100528304 : RecordRef;
    BEGIN
      IF (NOT SharePointSetup4PS.ISEMPTY) AND (FPSLicenseManagement.LicenseAndReadPermissionForTable(SharePointSetup4PS)) THEN BEGIN
        SharePointSetup4PS.GET;
        CASE TRUE OF
          SharePointSetup4PS."Use Project Portal": BEGIN
            DocumentLink.SETRANGE("Document No.", "No.");
            DocumentLink.SETRANGE("Table No.", DATABASE::Job);
            DocumentLink.SETFILTER("Record ID", '<>%1', EmptyRecId); //#C036663.c
            IF (DocumentLink.FINDSET) THEN BEGIN
              REPEAT
                RecRef.GET(DocumentLink."Record ID");
                RecRef.SETTABLE(Job);
                IF (Job."Make SharePoint Site") THEN
                  EXIT(TRUE);
              UNTIL (DocumentLink.NEXT = 0);
            END;
          END;
          SharePointSetup4PS."Use Location Portal": BEGIN
            EXIT(FALSE);
          END;
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE IsDPTFieldVisible@1100528304() : Boolean;
    VAR
      DPTSetup@1100528300 : Record 11229823;
      Job@1100528302 : Record 11072003;
      ServiceLocation@1100528900 : Record 11012801;
      DocumentLink@1100528301 : Record 11012747;
      RecRef@1100528303 : RecordRef;
    BEGIN
      IF (NOT DPTSetup.ISEMPTY) AND (FPSLicenseManagement.LicenseAndReadPermissionForTable(DPTSetup)) THEN BEGIN
        DPTSetup.GET;
        CASE TRUE OF
          DPTSetup."Use Project Portal": BEGIN
            DocumentLink.SETRANGE("Document No.", "No.");
            DocumentLink.SETRANGE("Table No.", DATABASE::Job);
            DocumentLink.SETFILTER("Record ID", '<>%1', EmptyRecId); //#C036663.c
            IF (DocumentLink.FINDSET) THEN BEGIN
              REPEAT
                IF (RecRef.GET(DocumentLink."Record ID")) THEN BEGIN
                  RecRef.SETTABLE(Job);
                  IF (Job."Generate Document Portal Site") THEN
                    EXIT(TRUE);
                END;
              UNTIL (DocumentLink.NEXT = 0);
            END;
          END;
          DPTSetup."Use Location Portal": BEGIN
            DocumentLink.SETRANGE("Document No.", "No.");
            DocumentLink.SETRANGE("Table No.", DATABASE::"Service Location");
            DocumentLink.SETFILTER("Record ID", '<>%1', EmptyRecId); //#C036663.c
            IF (DocumentLink.FINDSET) THEN BEGIN
              REPEAT
                IF (RecRef.GET(DocumentLink."Record ID")) THEN BEGIN
                  RecRef.SETTABLE(ServiceLocation);
                  IF (ServiceLocation."Generate Document Portal Site") THEN
                    EXIT(TRUE);
                END;
              UNTIL (DocumentLink.NEXT = 0);
            END;
          END;
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetPPTDocumentProject@1100528307() : Code[20];
    VAR
      DocumentLink@1100528300 : Record 11012747;
      Job@1100528301 : Record 11072003;
      RecRef@1100528302 : RecordRef;
    BEGIN
      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE("Table No.", DATABASE::Job);
      DocumentLink.SETFILTER("Record ID", '<>%1', EmptyRecId); //#C036663.c
      IF (DocumentLink.FINDSET) THEN BEGIN
        REPEAT
          RecRef.GET(DocumentLink."Record ID");
          RecRef.SETTABLE(Job);
          IF (Job."Make SharePoint Site") THEN
            EXIT(Job."No.");
        UNTIL (DocumentLink.NEXT = 0);
      END;
      EXIT('');
    END;

    PROCEDURE GetDPTDocumentProject@1100528305() : Code[20];
    VAR
      DocumentLink@1100528300 : Record 11012747;
      Job@1100528301 : Record 11072003;
      RecRef@1100528302 : RecordRef;
    BEGIN
      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE("Table No.", DATABASE::Job);
      DocumentLink.SETFILTER("Record ID", '<>%1', EmptyRecId); //#C036663.c
      IF (DocumentLink.FINDSET) THEN BEGIN
        REPEAT
          RecRef.GET(DocumentLink."Record ID");
          RecRef.SETTABLE(Job);
          IF (Job."Generate Document Portal Site") THEN
            EXIT(Job."No.");
        UNTIL (DocumentLink.NEXT = 0);
      END;
      EXIT('');
    END;

    PROCEDURE GetClientFile@1100528704(VAR IsTemporaryFile@1100528702 : Boolean) ClientFileName : Text;
    BEGIN
      IF "Storage Type" = "Storage Type"::"File System on Premise" THEN
        IF FileMgt.ClientFileExists(File) THEN BEGIN
          IsTemporaryFile := FALSE;
          ClientFileName := File;
          EXIT;
        END;

      WriteContentToClient(ClientFileName);
      IsTemporaryFile := TRUE;
    END;

    PROCEDURE DocumentIsLinkedToDPT@1100528900(RecId@1100528901 : RecordID) : Boolean;
    VAR
      DPTSetup@1100528300 : Record 11229823;
      Job@1100528302 : Record 11072003;
      ServiceLocation@1100528900 : Record 11012801;
      RecRef@1100528303 : RecordRef;
    BEGIN
      IF (FORMAT(RecId) <> '') AND (NOT DPTSetup.ISEMPTY) AND (FPSLicenseManagement.LicenseAndReadPermissionForTable(DPTSetup)) THEN BEGIN //#C036663.c
        DPTSetup.GET;

        CASE TRUE OF
          (RecId.TABLENO = DATABASE::Job) AND (DPTSetup."Use Project Portal"): BEGIN
            RecRef.GET(RecId);
            RecRef.SETTABLE(Job);
            IF (Job."Document Portal Site Generated") THEN
              EXIT(TRUE);
          END;
          (RecId.TABLENO = DATABASE::"Service Location") AND (DPTSetup."Use Location Portal"): BEGIN
            RecRef.GET(RecId);
            RecRef.SETTABLE(ServiceLocation);
            IF (ServiceLocation."Document Portal Site Generated") THEN
              EXIT(TRUE);
          END;
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetPropertiesFromFile@1100529101(VAR FileName@1100529100 : Text;VAR ModifyDateTime@1100529102 : DateTime;VAR FileLength@1100529104 : BigInteger);
    VAR
      FileManagement@1100529101 : Codeunit 419;
      DocumentServiceManagement@1100528400 : Codeunit 9510;
      AzureFileStorageManagement@1100528402 : Codeunit 11012350;
      DocumentManagement@1100528404 : Codeunit 11012406;
      MemoryStream@1100528403 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      ModifyDate@1100529103 : Date;
      ModifyTime@1100529105 : Time;
      FileDirectory@1100529106 : Text;
      Share@1100528405 : Text;
      ServerTempFileName@1100528401 : Text;
    BEGIN
      FileName := '';
      ModifyDateTime := 0DT;
      FileLength := 0;

      IF IsFileSystemOnPremiseDocument THEN BEGIN
        // get data from file system on premise
        IF FileManagement.ClientFileExists(FullFileName) THEN BEGIN
          FileManagement.GetClientFileProperties(FullFileName,ModifyDate,ModifyTime,FileLength);
          ModifyDateTime := CREATEDATETIME(ModifyDate, ModifyTime);
          FileManagement.SplitFileAbsPathName(FullFileName,FileDirectory,FileName);
        END;
        EXIT;
      END;

      IF IsO365Document THEN BEGIN
        // get data from office 365
        DocumentServiceManagement.SetUseDocumentService4PS(TRUE);
        ServerTempFileName := DocumentServiceManagement.DownloadFileFromCloudToServerSilent("Document Service URL");
        FileManagement.GetServerFileProperties(ServerTempFileName,ModifyDate,ModifyTime,FileLength);
        ModifyDateTime := CREATEDATETIME(ModifyDate, ModifyTime);
        FileManagement.SplitFileAbsPathName("Document Service URL",FileDirectory,FileName);
        ERASE(ServerTempFileName);
        EXIT;
      END;

      IF IsAzureDocument THEN BEGIN
        ServerTempFileName := FileManagement.ServerTempFileName('');
        MemoryStream := MemoryStream.MemoryStream;
        AzureFileStorageManagement.GetFileContentsViaMemoryStreamByResource("Document Service URL", MemoryStream);
        DocumentManagement.PutContentToStorageByStream(MemoryStream, "Storage Type"::"File System on Premise", ServerTempFileName);
        FileManagement.GetServerFileProperties(ServerTempFileName, ModifyDate, ModifyTime, FileLength);
        FileManagement.SplitFileAbsPathName("Document Service URL", FileDirectory, FileName);
        Share := DELCHR(FileDirectory, '>', '/\');
        ModifyDateTime := AzureFileStorageManagement.GetLastModified(Share, FileName, 1);
        ERASE(ServerTempFileName);
      END;
    END;

    PROCEDURE SetDPTFields@1100525007(RecId@1100525000 : RecordID);
    VAR
      RecRef@1100525001 : RecordRef;
      Job@1100525002 : Record 11072003;
      ServiceLocation@1100525003 : Record 11012801;
    BEGIN
      IF ("Document Portal Source Type" <> 0) THEN
        EXIT;
      IF (NOT RecRef.GET(RecId)) THEN
        EXIT;

      CASE RecId.TABLENO OF
        DATABASE::Job: BEGIN
          RecRef.SETTABLE(Job);
          "Document Portal Source Type" := "Document Portal Source Type"::Project;
          "Document Portal Source No." := Job."No.";
        END;
        DATABASE::"Service Location": BEGIN
          RecRef.SETTABLE(ServiceLocation);
          "Document Portal Source Type" := "Document Portal Source Type"::ServiceLoc;
          "Document Portal Source No." := ServiceLocation."No.";
        END;
      END;
    END;

    PROCEDURE SetFiltersForGettingAllVersionsOfDocument@1100528401(DocumentTemplate@1100528400 : Record 11012401;SetContactNoFilter@1100528403 : Boolean;ContactNo@1100528401 : Code[20];DocAction@1100528402 : Code[50]);
    BEGIN
      SETRANGE("Document Group", DocumentTemplate."Document Group");
      SETRANGE("Document Template", DocumentTemplate."Template Code");
      SETRANGE("Internal Company", COMPANYNAME);
      IF SetContactNoFilter THEN
        SETRANGE("Contact No.", ContactNo);

      IF DocAction <> '' THEN
        SETRANGE("Doc. Action", DocAction)
      ELSE
        SETRANGE("Doc. Action");
    END;

    PROCEDURE MarkDocumentsLinkedToRecordID@1100528402(RecID@1100528401 : RecordID);
    VAR
      DocumentLink@1100528400 : Record 11012747;
    BEGIN
      DocumentLink.SETCURRENTKEY("Record ID");
      DocumentLink.SETFILTER("Record ID", STRSUBSTNO('''%1''', RecID));
      DocumentLink.SETRANGE(Source, TRUE);
      DocumentLink.SETRANGE("Internal Company", COMPANYNAME);
      IF DocumentLink.FINDSET THEN BEGIN
        REPEAT
          IF GET(DocumentLink."Document No.") THEN
            MARK(TRUE);
        UNTIL DocumentLink.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE GetDocumentVersions@1100528407(DocumentTemplate@1100528402 : Record 11012401;DocAction@1100528401 : Code[50];RecID@1100528403 : RecordID;VAR DocumentProperties@1100528404 : Record 11012746);
    BEGIN
      DocumentProperties.SETCURRENTKEY("Document Group","Document Template","Internal Company","Contact No.","Doc. Action",Version);
      DocumentProperties.SetFiltersForGettingAllVersionsOfDocument(
        DocumentTemplate, FALSE, '', DocAction);
      DocumentProperties.SETFILTER(Version, '>0');
      DocumentProperties.MarkDocumentsLinkedToRecordID(RecID);
      DocumentProperties.MARKEDONLY(TRUE);
    END;

    PROCEDURE DocumentVersionsExist@1100528403(DocumentTemplate@1100528402 : Record 11012401;DocAction@1100528401 : Code[50];RecID@1100528403 : RecordID) : Boolean;
    VAR
      DocumentProperties@1100528400 : Record 11012746;
    BEGIN
      IF Version <> 0 THEN
        EXIT(TRUE);
      GetDocumentVersions(DocumentTemplate, DocAction, RecID, DocumentProperties);
      IF NOT DocumentProperties.ISEMPTY THEN
        EXIT(TRUE);
    END;

    PROCEDURE SelectDocumentVersion@1100528404(DocumentTemplate@1100528402 : Record 11012401;DocAction@1100528401 : Code[50];RecID@1100528400 : RecordID) : Boolean;
    VAR
      DocumentProperties@1100528403 : Record 11012746;
      DocumentList@1100528404 : Page 11012407;
    BEGIN
      GetDocumentVersions(DocumentTemplate, DocAction, RecID, DocumentProperties);
      DocumentList.LOOKUPMODE(TRUE);
      IF Template <> '' THEN
        DocumentList.SETRECORD(Rec);
      DocumentList.SETTABLEVIEW(DocumentProperties);
      IF DocumentList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        DocumentList.GETRECORD(Rec);
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE GetDocumentNoOfPreviousVersionOfWordDocument@1100528409(DocAction@1100528402 : Code[50];RecID@1100528401 : RecordID;ThrowError@1100528404 : Boolean;VAR WordDocumentNo@1100528405 : Code[20]) PreviousVersionFound : Boolean;
    VAR
      DocumentTemplate@1100528400 : Record 11012401;
      DocumentProperties@1100528403 : Record 11012746;
    BEGIN
      IF "External Document" THEN
        EXIT;
      IF NOT DocumentTemplate.GET("Document Group", "Document Template") THEN
        EXIT;
      GetDocumentVersions(DocumentTemplate, DocAction, RecID, DocumentProperties);
      DocumentProperties.SETCURRENTKEY(
        "Document Group", "Document Template", "Internal Company", "Contact No.", "Doc. Action", Version);
      DocumentProperties.SETFILTER(Version, '<%1', Version);
      IF ThrowError THEN BEGIN
        DocumentProperties.FINDLAST;
        PreviousVersionFound := TRUE;
        WordDocumentNo := DocumentProperties."No.";
      END ELSE
        IF DocumentProperties.FINDLAST THEN BEGIN
          PreviousVersionFound := TRUE;
          WordDocumentNo := DocumentProperties."No.";
        END;
    END;

    PROCEDURE GetDocumentsFromDocumentRelations@1100529601(VAR DocumentProperties@1100529601 : Record 11012746;DocumentType@1100529603 : Option;DocumentNo@1100529604 : Code[20];SendAsEmail@1100529600 : Boolean);
    VAR
      DocumentRelation@1100529602 : Record 11012407;
    BEGIN
      DocumentRelation.SETRANGE("Document Type", DocumentType);
      DocumentRelation.SETRANGE("No.", DocumentNo);
      IF SendAsEmail THEN
        DocumentRelation.SETRANGE("Send by E-Mail", TRUE)
      ELSE
        DocumentRelation.SETRANGE(Print, TRUE);

      IF DocumentRelation.FINDSET THEN
        REPEAT
          IF DocumentProperties.GET(DocumentRelation."Related Document No.") THEN
            IF NOT SendAsEmail THEN
              DocumentProperties.MARK(TRUE)
            ELSE
              IF DocumentProperties."Document Service URL" <> '' THEN
                DocumentProperties.MARK(TRUE)
              ELSE
                IF DocumentProperties.FullFileName() <> '' THEN
                  IF FileMgt.ClientFileExists(DocumentProperties.FullFileName) THEN
                    DocumentProperties.MARK(TRUE);
        UNTIL DocumentRelation.NEXT = 0;
    END;

    PROCEDURE GetDocumentsFromProjectDocRelations@1100529602(VAR DocumentProperties@1100529601 : Record 11012746;SourceType@1100529603 : Option;ProjectNo@1100529600 : Code[20];SourceNo@1100529604 : Code[10]);
    VAR
      ProjectDocumentRelation@1100529602 : Record 11071833;
    BEGIN
      ProjectDocumentRelation.SETRANGE("Source Type", SourceType);
      ProjectDocumentRelation.SETRANGE("Project No.", ProjectNo);
      ProjectDocumentRelation.SETRANGE("No.", SourceNo);
      ProjectDocumentRelation.SETRANGE("Send by E-Mail", TRUE);
      IF ProjectDocumentRelation.FINDSET THEN
        REPEAT
          IF DocumentProperties.GET(ProjectDocumentRelation."Related Document No.") THEN
            IF DocumentProperties."Document Service URL" <> '' THEN
              DocumentProperties.MARK(TRUE)
            ELSE
              IF DocumentProperties.FullFileName() <> '' THEN
                IF FileMgt.ClientFileExists(DocumentProperties.FullFileName) THEN
                  DocumentProperties.MARK(TRUE);
        UNTIL ProjectDocumentRelation.NEXT = 0;
    END;

    PROCEDURE RemovePrevVersions@1100529600(VAR DocumentProperties@1100529600 : Record 11012746);
    VAR
      DocumentPropertiesTmp@1100529601 : TEMPORARY Record 11012746;
    BEGIN
      DocumentProperties.MARKEDONLY(TRUE);
      IF DocumentProperties.ISEMPTY THEN
        EXIT;

      DocumentProperties.SETCURRENTKEY("Document Template", Version);
      DocumentProperties.FINDSET;
      REPEAT
        IF DocumentProperties."Document Template" <> '' THEN BEGIN
          DocumentProperties.SETRANGE("Document Template", DocumentProperties."Document Template");
          DocumentProperties.FINDLAST;
          DocumentProperties.SETRANGE("Document Template");
        END;
        DocumentPropertiesTmp := DocumentProperties;
        DocumentPropertiesTmp.INSERT;
      UNTIL DocumentProperties.NEXT = 0;

      DocumentProperties.CLEARMARKS;
      DocumentProperties.MARKEDONLY(FALSE);

      DocumentPropertiesTmp.FINDSET;
      REPEAT
        DocumentProperties.GET(DocumentPropertiesTmp."No.");
        DocumentProperties.MARK(TRUE);
      UNTIL DocumentPropertiesTmp.NEXT = 0;

      DocumentProperties.MARKEDONLY(TRUE);
    END;

    PROCEDURE IsPPTDocument@1100525010() : Boolean;
    BEGIN
      EXIT(("Web link" <> '') AND ("Project Portal Subsite" <> ''));
    END;

    PROCEDURE IsDPTDUALDocument@1100527800() : Boolean;
    BEGIN
      EXIT(("Web link" <> '') AND ("Document Portal Source No." <> ''))
    END;

    PROCEDURE IsO365Document@1100525016() : Boolean;
    BEGIN
      EXIT(("Document Service URL" <> '') AND ("Storage Type" = "Storage Type"::"SharePoint Online"))
    END;

    PROCEDURE IsAzureDocument@1100528411() : Boolean;
    BEGIN
      EXIT(("Document Service URL" <> '') AND ("Storage Type" = "Storage Type"::"Azure File Storage"))
    END;

    PROCEDURE IsFileSystemOnPremiseDocument@1100525017() : Boolean;
    BEGIN
      EXIT ("Storage Type" = "Storage Type"::"File System on Premise")
    END;

    PROCEDURE DeleteFromRelatedTables@1100525014();
    VAR
      DocumentRelation@1100525002 : Record 11012407;
      CommentLine@1100525001 : Record 97;
      DocumentVersions@1100525000 : Record 11229809;
      SignhostDocument@1100528400 : Record 11229468;
      SignhostSigner@1100528402 : Record 11229467;
      SignhostSignerRejectionText@1100528401 : Record 11072462;
      InstallationMgt@1100525003 : Codeunit 11012268;
    BEGIN
      //**4PS.n  22-01-18
      DocumentRelation.SETRANGE("Related Document No.", "No.");
      DocumentRelation.DELETEALL(TRUE);

      DocumentRelation.SETRANGE("Related Document No.");
      DocumentRelation.SETRANGE("Document Type", DocumentRelation."Document Type"::Document);
      DocumentRelation.SETRANGE("No.", "No."); //mg.c, 26-04-11
      DocumentRelation.DELETEALL(TRUE);

      //mg.sn, 12-04-11
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::"Document Properties");
      CommentLine.SETRANGE("No.", "No.");
      CommentLine.DELETEALL(TRUE);
      //mg.sn, 12-04-11

      //kzwerver, 131112, sn
      IF (NOT InstallationMgt.NoLicensePermissionForTableData(DATABASE::"Document Versions (PPT)")) THEN BEGIN
        DocumentVersions.SETRANGE("Document No.", "No.");
        DocumentVersions.DELETEALL(TRUE);
      END;
      //kzwerver, 131112, en

      SignhostDocument.SETRANGE("Sent Word Document No.", "No.");
      SignhostDocument.DELETEALL;

      SignhostSigner.SETRANGE("Word Document No.", "No.");
      SignhostSigner.DELETEALL;

      SignhostSignerRejectionText.SETRANGE("Word Document No.", "No.");
      SignhostSignerRejectionText.DELETEALL;
    END;

    PROCEDURE CreateDocumentRelation@1100527000(DocumentType@1100527001 : Integer;DocumentNo@1100527000 : Code[20]);
    VAR
      DocumentRelation@1100527002 : Record 11012407;
    BEGIN
      IF DocumentRelation.GET(DocumentType, DocumentNo, "No.") THEN
        EXIT;

      DocumentRelation.INIT;
      DocumentRelation."Document Type" := DocumentType;
      DocumentRelation."No." := DocumentNo;
      DocumentRelation.VALIDATE("Related Document No.", "No.");
      DocumentRelation."Document No." := "Document No.";
      DocumentRelation."Send by E-Mail" := TRUE;
      IF FileCanBeConvertedToPDF THEN
        DocumentRelation.Print := TRUE;
      DocumentRelation.INSERT;
    END;

    LOCAL PROCEDURE CheckAndCreateDocumentRelation@1100527001(DocType@1100527004 : Integer;DocNo@1100527003 : Code[20]);
    VAR
      DocumentType@1100527000 : Record 11012405;
      DocumentCategory@1100527001 : Record 11012147;
    BEGIN
      IF (NOT DocumentType.GET("Document Type")) OR (NOT DocumentType."Attach to Document Relation") THEN
        IF (NOT DocumentCategory.GET("Document Category")) OR (NOT DocumentCategory."Attach to Document Relation") THEN
          EXIT;

      CreateDocumentRelation(DocType, DocNo);
    END;

    PROCEDURE CreateDocumentRelationForLinkedDocuments@1100527002();
    VAR
      DocumentLink@1100527000 : Record 11012747;
      DocumentType@1100527004 : Integer;
      DocumentNo@1100527003 : Code[20];
    BEGIN
      DocumentLink.SETRANGE("Document No.", "No.");
      IF DocumentLink.FINDSET THEN
        REPEAT
          IF GetDocumentFromRID(DocumentType, DocumentNo, DocumentLink) THEN
            CheckAndCreateDocumentRelation(DocumentType, DocumentNo);
        UNTIL DocumentLink.NEXT = 0;
    END;

    LOCAL PROCEDURE GetDocumentFromRID@1100527003(VAR DocumentType@1100527002 : Integer;VAR DocumentNo@1100527003 : Code[20];DocumentLink@1100527000 : Record 11012747) : Boolean;
    VAR
      DocumentRelation@1100527001 : Record 11012407;
      PurchaseHeader@1100527005 : Record 38;
      SalesHeader@1100527006 : Record 36;
      RecRef@1100527007 : RecordRef;
      RecID@1100527004 : RecordID;
    BEGIN
      RecID := DocumentLink."Record ID";
      IF RecID.TABLENO = 0 THEN
        EXIT(FALSE);

      RecRef := RecID.GETRECORD;
      CASE RecRef.NUMBER OF
        DATABASE::"Purchase Header":
          BEGIN
            CASE GetDocumentType(RecRef) OF
              PurchaseHeader."Document Type"::"Blanket Order":
                DocumentType := DocumentRelation."Document Type"::"Blanket Order";
              PurchaseHeader."Document Type"::Quote:
                DocumentType := DocumentRelation."Document Type"::"Purchase Quote";
              PurchaseHeader."Document Type"::Order:
                DocumentType := DocumentRelation."Document Type"::"Purchase Order";
            END;
            DocumentNo := GetDocumentNo(RecRef, 2);
            EXIT(TRUE);
          END;
        DATABASE::"Sales Header":
          BEGIN
            CASE GetDocumentType(RecRef) OF
              SalesHeader."Document Type"::Quote:
                DocumentType := DocumentRelation."Document Type"::"Sales Quote";
              SalesHeader."Document Type"::Order:
                DocumentType := DocumentRelation."Document Type"::"Sales Order";
              SalesHeader."Document Type"::Invoice:
                DocumentType := DocumentRelation."Document Type"::"Sales Invoice";
              SalesHeader."Document Type"::"Credit Memo":
                DocumentType := DocumentRelation."Document Type"::"Sales Cr.Memo";
            END;
            DocumentNo := GetDocumentNo(RecRef, 2);
            EXIT(TRUE);
          END;
        DATABASE::"Sales Invoice Header":
            DocumentType := DocumentRelation."Document Type"::"Posted Sales Invoice";
        DATABASE::"Sales Cr.Memo Header":
            DocumentType := DocumentRelation."Document Type"::"Posted Sales Cr.Memo";
        DATABASE::"Try-out Quote":
            DocumentType := DocumentRelation."Document Type"::"Try-out Quote";
        DATABASE::"Service Order":
            DocumentType := DocumentRelation."Document Type"::"Service Order";
        DATABASE::"Plant Transport Order":
            DocumentType := DocumentRelation."Document Type"::"Plant Transport Order";
        DATABASE::"Exit Order":
            DocumentType := DocumentRelation."Document Type"::"Plant Exit Order";
        DATABASE::"Service-Contract":
            DocumentType := DocumentRelation."Document Type"::"Service Contract";
        DATABASE::"Plant Order":
            DocumentType := DocumentRelation."Document Type"::"Plant Order";
        DATABASE::"Plant Transport Ride":
            DocumentType := DocumentRelation."Document Type"::"Plant Transport Ride";
        DATABASE::"Option Quote Header":
            DocumentType := DocumentRelation."Document Type"::"Option Quote";
        DATABASE::"Work Order":
            DocumentType := DocumentRelation."Document Type"::"Work Order";
        ELSE
          EXIT(FALSE);
      END;
      DocumentNo := GetDocumentNo(RecRef, 1);
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetDocumentType@1100527004(RecRef@1100527000 : RecordRef) : Integer;
    VAR
      FldRef@1100527002 : FieldRef;
      KRef@1100527001 : KeyRef;
    BEGIN
      KRef := RecRef.KEYINDEX(1);
      FldRef := KRef.FIELDINDEX(1);
      EXIT(FldRef.VALUE);
    END;

    LOCAL PROCEDURE GetDocumentNo@1100527005(RecRef@1100527000 : RecordRef;FieldIndex@1100527003 : Integer) : Code[20];
    VAR
      FldRef@1100527002 : FieldRef;
      KRef@1100527001 : KeyRef;
    BEGIN
      KRef := RecRef.KEYINDEX(1);
      FldRef := KRef.FIELDINDEX(FieldIndex);
      EXIT(FldRef.VALUE);
    END;

    PROCEDURE MailDocuments@1100528500();
    VAR
      OutlookApp@1100528500 : DotNet "'Microsoft.Office.Interop.Outlook, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'.Microsoft.Office.Interop.Outlook.ApplicationClass" RUNONCLIENT;
      OutlookMailItem@1100528501 : DotNet "'Microsoft.Office.Interop.Outlook, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'.Microsoft.Office.Interop.Outlook.MailItem" RUNONCLIENT;
      OutlookItemType@1100528502 : DotNet "'Microsoft.Office.Interop.Outlook, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'.Microsoft.Office.Interop.Outlook.OlItemType" RUNONCLIENT;
      OutlookAttachmentType@1100528505 : DotNet "'Microsoft.Office.Interop.Outlook, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'.Microsoft.Office.Interop.Outlook.OlAttachmentType" RUNONCLIENT;
      IsTemporaryFile@1100528503 : Boolean;
      FullPath@1100528504 : Text;
      NumberOfFilesAdded@1100528506 : Integer;
    BEGIN
      OutlookApp := OutlookApp.ApplicationClass;
      OutlookMailItem := OutlookApp.CreateItem(OutlookItemType.olMailItem);
      REPEAT
        IF DocumentCanBeMailed THEN BEGIN
          FullPath := GetClientFile(IsTemporaryFile);
          OutlookMailItem.Attachments.Add(FullPath, OutlookAttachmentType.olByValue, 1, '');
          NumberOfFilesAdded := NumberOfFilesAdded + 1;
          IF IsTemporaryFile THEN
            FileMgt.DeleteClientFile(FullPath);
        END;
      UNTIL NEXT = 0;
      IF NumberOfFilesAdded > 0 THEN
        OutlookMailItem.Display(TRUE)
      ELSE
        MESSAGE(Text028);
    END;

    PROCEDURE DocumentCanBeMailed@1100528412() : Boolean;
    BEGIN
      IF NOT IsConfidentialOwner THEN
        EXIT(FALSE);

      IF NOT ("Storage Type" IN [
        "Storage Type"::"File System on Premise", "Storage Type"::"SharePoint Online", "Storage Type"::"Azure File Storage"])
      THEN
        EXIT(FALSE);

      IF NOT HasStorageURI THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE DocumentLinkExists@1100525011(RID@1100525000 : RecordID) : Boolean;
    VAR
      DocumentLink@1100525001 : Record 11012747;
    BEGIN
      DocumentLink.RESET;
      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE("Internal Company", "Internal Company");
      DocumentLink.SETRANGE("Record ID", RID);

      EXIT(DocumentLink.FINDFIRST());
    END;

    PROCEDURE CopyDocument@1100528501();
    VAR
      UserSetup@1100528500 : Record 91;
      DocumentProperties@1100528501 : Record 11012746;
      DocumentProperties2@1100528502 : Record 11012746;
      ExternalDocCopyTo@1100528503 : Record 11012408;
      ExternalDocCopyTo2@1100528504 : Record 11012408;
      DocumentLinkMgt@1100528505 : Codeunit 11012401;
      WasRecordMarked@1100528507 : Boolean;
      TargetStorageURI@1100527804 : Text;
      SourceStorageURI@1100527803 : Text;
      TargetStorageType@1100527802 : Option;
      DocumentManagement@1100527801 : Codeunit 11012406;
      ErrorMessage@1100527800 : Text;
    BEGIN
      TESTFIELD("External Document",TRUE);

      IF NOT UserSetup.GET THEN
        UserSetup.INIT;

      IF (UserSetup."Employee No." <> "Addressed To") AND
          (UserSetup."Employee No." <> "Original To") THEN
        TESTFIELD(Confidential, FALSE);

      IF NOT CONFIRM(Text029, TRUE, "No.") THEN
        EXIT;

      WasRecordMarked := MARK;

      DocumentProperties.COPY(Rec);
      DocumentProperties."No." := '';
      DocumentProperties.FILTERGROUP(2);
      DocumentProperties.COPYFILTER("RID Filter", DocumentProperties2."RID Filter");
      DocumentProperties.SETRANGE("RID Filter");
      DocumentProperties.FILTERGROUP(0);
      DocumentProperties.INSERT(TRUE);

      SourceStorageURI := DocumentProperties.GetStorageURI;

      IF (SourceStorageURI <> '') THEN BEGIN
         DocumentMgtSetup.GET;
        DocumentManagement.PrepareDocumentRegistration(
          Description,"Document Type",DocumentProperties."Creation Date",TargetStorageURI,TargetStorageType);
        IF (DocumentManagement.CopyStorageContent("Storage Type", TargetStorageType, SourceStorageURI, TargetStorageURI,ErrorMessage)) THEN BEGIN
          DocumentProperties.ValidateStorageURI(TargetStorageType,TargetStorageURI);
          DocumentProperties.MODIFY(TRUE);
        END ELSE
          ERROR(ErrorMessage);
      END;

      DocumentProperties.FILTERGROUP(2);
      DocumentProperties2.COPYFILTER("RID Filter", DocumentProperties."RID Filter");
      DocumentProperties.FILTERGROUP(0);

      DocumentProperties."Internal Company" := "Internal Company";
      DocumentProperties.MODIFY;

      // Copy Document Links
      DocumentLinkMgt.CopyDocumentLink("No.", DocumentProperties."No.", FALSE);

      ExternalDocCopyTo.SETRANGE("Document No.", "No.");
      IF ExternalDocCopyTo.FIND('-') THEN
        REPEAT
          ExternalDocCopyTo2 := ExternalDocCopyTo;
          ExternalDocCopyTo2."Document No." := DocumentProperties."No.";
          ExternalDocCopyTo2.INSERT;
        UNTIL ExternalDocCopyTo.NEXT = 0;

      MESSAGE(STRSUBSTNO(Text030, "No.", DocumentProperties."No."));

      IF ISTEMPORARY THEN BEGIN
        Rec := DocumentProperties;
        INSERT;
      END ELSE
        GET(DocumentProperties."No.");
      MARK(WasRecordMarked);
    END;

    PROCEDURE GetContentInMemoryStream@1100527801(VAR MemoryStream@1100527802 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream") : Boolean;
    VAR
      DocumentManagement@1100527806 : Codeunit 11012406;
    BEGIN
      EXIT(DocumentManagement.GetContentFromStorageByStream("Storage Type", GetStorageURI, MemoryStream));
    END;

    PROCEDURE SetDefaultValues@1100528502();
    VAR
      DocumentMgtSetup@1100528500 : Record 11071831;
      ServPortSetup@1100528300 : Record 11126065;
      DocumentType@1100527800 : Record 11012405;
      Contact@1100527801 : Record 5050;
    BEGIN
      DocumentMgtSetup.GET;
      IF ("Document Type" = '') THEN
        "Document Type" :=  DocumentMgtSetup."Document Type";

      IF DocumentMgtSetup.GET THEN BEGIN
        IF ("Document Type" = '') THEN
          "Document Type" :=  DocumentMgtSetup."Document Type";
        IF ("Document Category" = '') THEN
          "Document Category" :=  DocumentMgtSetup."Document Category";
      END;

      IF (NOT "Publish on Service Portal") THEN BEGIN
        IF FPSLicenseManagement.LicenseAndReadPermissionForTable(ServPortSetup) THEN BEGIN
        ServPortSetup.SETRANGE("Primary Key", '1');
        IF ServPortSetup.FINDFIRST THEN
          IF ServPortSetup."Document Publ. to Portal" THEN BEGIN
            IF ("Contact No." <> '') THEN BEGIN
              IF (Contact.GET("Contact No.")) THEN  BEGIN
                IF (Contact."Available for Control") THEN
                  VALIDATE("Publish on Service Portal", ServPortSetup."Document Publ. to Portal");
              END;
            END;
          END;
        END;
      END;

      IF (NOT "Available for Field Service") AND (DocumentType.GET("Document Type")) THEN
        IF DocumentType."Document Def. Available in FSA" THEN
           "Available for Field Service" := TRUE;
    END;

    PROCEDURE SetShowInControl@1100528308(ShowNotification@1100528304 : Boolean);
    VAR
      Contact@1100528303 : Record 5050;
      DocumentProperties@1100528305 : Record 11012746;
      CTRLManagement@1100528302 : Codeunit 11012498;
      InstallationManagement@1100528301 : Codeunit 11012268;
      ContactNotification@1100528300 : Notification;
    BEGIN
      IF (InstallationManagement.NoLicensePermissionForCodeUnit(CODEUNIT::"CTRL Management")) THEN BEGIN
        "Show in Control" := FALSE;
        EXIT;
      END ELSE BEGIN
        IF (NOT "Publish on Service Portal") OR (NOT CTRLManagement.CtrlIsActive) THEN BEGIN
          "Show in Control" := FALSE;
          EXIT;
        END;
      END;

      IF (CTRLManagement.HasOnlyValidRelationLinks(Rec, Rec.RECORDID)) THEN
        "Show in Control" := TRUE
      ELSE BEGIN
        "Show in Control" := FALSE;
        IF (ShowNotification) THEN BEGIN
          ContactNotification.SCOPE := NOTIFICATIONSCOPE::LocalScope;
          ContactNotification.MESSAGE(STRSUBSTNO(CtrlContactShowTxt, FIELDCAPTION("Show in Control"), Contact.TABLECAPTION));
          ContactNotification.SEND;
        END;
      END;

      IF (Rec.ISTEMPORARY) THEN BEGIN
        IF (DocumentProperties.GET("No.")) THEN BEGIN
          DocumentProperties.VALIDATE("Publish on Service Portal", "Publish on Service Portal");
          DocumentProperties.MODIFY(TRUE);
        END;
      END;
    END;

    PROCEDURE MoveDocumentToEditStorage@1100527810();
    VAR
      DocumentManagement@1100528502 : Codeunit 11012406;
      TypeHelper@1100528400 : Codeunit 10;
      MemoryStream@1100528500 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      FileName@1100528600 : Text;
      EditFileStorageType@1100528603 : Option;
      TargetFolderURI@1100528604 : Text;
      TargetFileURI@1100527800 : Text;
      OStream@1100527801 : OutStream;
    BEGIN
      TESTFIELD("Storage Type");
      EditFileStorageType := DocumentManagement.GetEditStorageType();
      IF NOT DocumentManagement.CheckIfDocumentCanBeMovedToEditStorage("Storage Type",EditFileStorageType) THEN
        EXIT;

      MemoryStream := MemoryStream.MemoryStream;
      IF (NOT GetContentInMemoryStream(MemoryStream)) THEN
        EXIT;

      DocumentManagement.GetStorageLocationForStorageType(
        EditFileStorageType,'','','',"Document Type","Creation Date",TargetFolderURI);
      DocumentManagement.CreateStorageLocationIfNotExists(EditFileStorageType,TargetFolderURI);
      FileName := FileNameShort;
      IF ("Storage Type" = "Storage Type"::"SharePoint Online") THEN
        FileName := TypeHelper.UrlDecode(FileName);
      DocumentManagement.GetUniqueFileName(FileName);
      TargetFileURI := TargetFolderURI + FileName;
      OStream := MemoryStream;

      IF (DocumentManagement.PutContentToStorageByStream(OStream,EditFileStorageType,TargetFileURI)) THEN
        UpdatePropertiesAfterStorageMove(TargetFileURI, EditFileStorageType);

      MemoryStream.Dispose;
      CLEAR(MemoryStream);
    END;

    PROCEDURE MoveDocumentToMainStorage@1100528601();
    VAR
      DocumentManagement@1100528502 : Codeunit 11012406;
      TypeHelper@1100528401 : Codeunit 10;
      MemoryStream@1100528500 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      FileName@1100528600 : Text;
      MainStorageType@1100528603 : Option;
      TargetFolderURI@1100528608 : Text;
      TargetFileURI@1100527800 : Text;
    BEGIN
      MainStorageType := DocumentManagement.GetMainStorageType;

      IF "Storage Type" = MainStorageType THEN
        EXIT;

      DocumentManagement.GetStorageLocation(
        "Document Group", "Document Template", "Contact No.", "Document Type", "Creation Date", TargetFolderURI, MainStorageType);
      DocumentManagement.CreateStorageLocationIfNotExists(MainStorageType,TargetFolderURI);

      MemoryStream := MemoryStream.MemoryStream;
      GetContentInMemoryStream(MemoryStream);

      FileName := FileNameShort;
      DocumentManagement.RemoveTimeStampFromFileName(FileName);
      IF ("Storage Type" = "Storage Type"::"SharePoint Online") THEN
        FileName := TypeHelper.UrlDecode(FileName);
      TargetFileURI := TargetFolderURI + FileName;

      IF (DocumentManagement.PutContentToStorageByStream(MemoryStream,MainStorageType,TargetFileURI)) THEN
        UpdatePropertiesAfterStorageMove(TargetFileURI, MainStorageType);
    END;

    LOCAL PROCEDURE UpdatePropertiesAfterStorageMove@1100528603(StorageFileURI@1100528601 : Text;StorageType@1100528602 : Option);
    VAR
      DocumentProperties@1100528604 : Record 11012746;
    BEGIN
      ValidateStorageURI(StorageType,StorageFileURI);
      MODIFY;
      IF ISTEMPORARY THEN BEGIN
        DocumentProperties.GET("No.");
        DocumentProperties.ValidateStorageURI(StorageType,StorageFileURI);
        DocumentProperties.MODIFY;
      END;
    END;

    LOCAL PROCEDURE CheckFilterGroupSettings@1100527812();
    VAR
      RID@1100527800 : RecordID;
      DocLinkRecIDArray@1100527803 : ARRAY [10] OF RecordID;
      DocumentLinkManagement@1100527802 : Codeunit 11012401;
      i@1100527801 : Integer;
    BEGIN
      // T000916.sn
      FILTERGROUP(2);

      IF GETFILTER("RID Filter") <> '''''' THEN BEGIN
        IF EVALUATE(RID, GETFILTER("RID Filter")) THEN BEGIN
          IF GETFILTER("Department Code Filter") <> '''''' THEN
            "Department Code" := GETFILTER("Department Code Filter");

          DocumentLinkManagement.GetAdditionalDocumentLinksFromRecordID(RID,DocLinkRecIDArray);
          FOR i:= 1 TO ARRAYLEN(DocLinkRecIDArray) DO
          BEGIN
            CreateDocumentLink(DocLinkRecIDArray[i]);
          END;

        END;
      END;
      FILTERGROUP(0);
      // T000916.en
    END;

    PROCEDURE GetStorageURI@1100527803() : Text;
    BEGIN
       CASE "Storage Type" OF
        "Storage Type" ::"File System on Premise":
          EXIT(File);
        "Storage Type" ::"Azure File Storage","Storage Type"::"SharePoint Online":
          EXIT("Document Service URL");
        "Storage Type" ::PPT, "Storage Type"::DPTDUAL, "Storage Type"::CTB:
          EXIT("Web link");
      END;
    END;

    PROCEDURE HasStorageURI@1100527805() : Boolean;
    BEGIN
      EXIT(GetStorageURI <> '');
    END;

    PROCEDURE ValidateStorageURI@1100527804(NewStorageType@1100527801 : Option;StorageURI@1100527800 : Text);
    BEGIN
      "Storage Type":= NewStorageType;
      File := '';
      "Document Service URL" := '';
      "Web link" := '';

      VALIDATE("File Extension", LOWERCASE(FileMgt.GetExtension(StorageURI)));

      CASE "Storage Type" OF
        "Storage Type"::"File System on Premise":
          VALIDATE(File, StorageURI);
        "Storage Type" ::"Azure File Storage","Storage Type"::"SharePoint Online":
          VALIDATE("Document Service URL", StorageURI);
        "Storage Type"::PPT, "Storage Type"::DPTDUAL, "Storage Type"::CTB:
          VALIDATE("Web link", StorageURI);
      END;
    END;

    PROCEDURE WriteContentToClient@1100527806(VAR ClientFileName@1100527800 : Text);
    VAR
      FileManagement@1100527802 : Codeunit 419;
      ServerFileName@1100528400 : Text;
      TempClientFileName@1100528401 : Text;
      ClientFolderName@1100528402 : Text;
    BEGIN
      WriteContentToServerTempFile(ServerFileName);
      TempClientFileName := FileManagement.DownloadTempFile(ServerFileName);
      ERASE(ServerFileName);
      ClientFolderName := FileManagement.GetDirectoryNameWithBackSlash(TempClientFileName);
      ClientFileName := ClientFolderName + FileNameShort;
      FileManagement.RenameClientFile(TempClientFileName, ClientFileName, TRUE);
    END;

    PROCEDURE WriteContentToServerTempFile@1100527807(VAR ServerTempFile@1100527800 : Text);
    VAR
      MemoryStream@1100527801 : DotNet "'mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.IO.MemoryStream";
      FileManagement@1100527802 : Codeunit 419;
      OStream@1100528400 : OutStream;
    BEGIN
      MemoryStream := MemoryStream.MemoryStream;
      GetContentInMemoryStream(MemoryStream);
      ServerTempFile := FileManagement.ServerTempFileName(Extension);
      OStream := MemoryStream;
      FileManagement.WriteFileContentFromOutStream(ServerTempFile, OStream);
      MemoryStream.Dispose;
      CLEAR(MemoryStream);
    END;

    PROCEDURE GetSourceDocumentLinkRecordID@1100528406(VAR RecID@1100528400 : RecordID) : Boolean;
    VAR
      DocumentLink@1100528401 : Record 11012747;
    BEGIN
      CLEAR(RecID);
      DocumentLink.SETRANGE("Document No.", "No.");
      DocumentLink.SETRANGE(Source, TRUE);
      IF DocumentLink.FINDFIRST THEN BEGIN
        RecID := DocumentLink."Record ID";
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ShowSignhostSigners@1100528408();
    VAR
      SignhostSigner@1100528401 : Record 11229467;
      RecID@1100528400 : RecordID;
    BEGIN
      TESTFIELD("External Document", FALSE);
      GetSourceDocumentLinkRecordID(RecID);
      SignhostSigner.SETRANGE("Record ID", RecID);
      SignhostSigner.SETRANGE("Word Document No.", "No.");
      PAGE.RUN(0, SignhostSigner);
    END;

    PROCEDURE ShowSignhostDocument@1100528410();
    VAR
      SignhostDocument@1100528401 : Record 11229468;
      RecID@1100528400 : RecordID;
    BEGIN
      TESTFIELD("External Document", FALSE);
      GetSourceDocumentLinkRecordID(RecID);
      SignhostDocument.SETRANGE("Record ID", RecID);
      SignhostDocument.SETRANGE("Sent Word Document No.", "No.");
      PAGE.RUN(PAGE::"Signhost Document", SignhostDocument);
    END;

    PROCEDURE GetServerFile@1100529603(VAR IsTemporaryFile@1100528702 : Boolean;VAR FileName@1100529601 : Text[250]) ServerFileName : Text;
    BEGIN
      IF (File = '') AND ("Document Service URL" = '') THEN
        EXIT;
      IF "Storage Type" = "Storage Type"::"File System on Premise" THEN
        FileName := COPYSTR(FileMgt.GetFileName(File), 1, MAXSTRLEN(FileName))
      ELSE
        FileName := COPYSTR(FileMgt.GetFileName("Document Service URL"), 1, MAXSTRLEN(FileName));

      IF ("Storage Type" = "Storage Type"::"File System on Premise") AND (File <> '') THEN
        IF FileMgt.ServerFileExists(File) THEN BEGIN
          ServerFileName := File;
          EXIT;
        END;
      WriteContentToServerTempFile(ServerFileName);
      IsTemporaryFile := TRUE;
    END;

    BEGIN
    {
      4PS MVOS 20101005 23172 : Changed function GetLastVersion
      4PS 08-12-11 call 31421: Key Document Type,Document No. added to accomodate loss of functionality

      Not allowed to add more fields to this table
    }
    END.
  }
}

