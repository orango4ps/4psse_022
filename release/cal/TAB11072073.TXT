OBJECT Table 11072073 Estimate Part
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Estimate No.,Sub-Estimate No.,Part,Description;
    OnInsert=BEGIN
               TESTFIELD("Part Group");
               TESTFIELD(Part);
               Finished := FALSE;
               UpdatePartTotal;
               InitAdjustmentFactor;
             END;

    OnModify=BEGIN
               EstRec.UpdateLogbook("Estimate No.");
               UpdatePartTotal;  //DP00381
             END;

    OnDelete=VAR
               sp1@1100485001 : Integer;
               sp2@1100485000 : Integer;
               CurrLevel@1100485002 : Integer;
               EstLineTotal@1100528900 : Record 11072077;
               EstPartTotal@1100525000 : Record 11229767;
             BEGIN
               DeleteSubPartsLowerLevel;

               EstRec.UpdateLogbook("Estimate No.");

               IF EstRec.GET("Estimate No.") THEN BEGIN
                 TESTFIELD("Offer fixed", FALSE);
                 IF EstRec."Full Cost/Sales Price Updated" THEN BEGIN
                   EstRec."Full Cost/Sales Price Updated" := FALSE;
                   EstRec.MODIFY;
                 END;
               END;

               IF EstPartTotal.GET("Estimate No.","Sub-Estimate No.","Part Group",Part) THEN
                 EstPartTotal.DELETE;   //DP00381

               EstLineRec.RESET;
               EstLineRec.SETRANGE("Estimate No.","Estimate No.");
               EstLineRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstLineRec.SETRANGE("Part Group","Part Group");
               EstLineRec.SETRANGE(Part,Part);
               IF NOT EstLineRec.ISEMPTY THEN
                 EstLineRec.DELETEALL;

               EstLineTotal.SETRANGE("Estimate No.","Estimate No.");
               EstLineTotal.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstLineTotal.SETRANGE("Part Group","Part Group");
               EstLineTotal.SETRANGE(Part,Part);
               EstLineTotal.DELETEALL;   //DP00381

               RecipeRec.RESET;
               RecipeRec.SETRANGE("Estimate No.","Estimate No.");
               RecipeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               RecipeRec.SETRANGE("Part Group","Part Group");
               RecipeRec.SETRANGE(Part,Part);
               IF NOT RecipeRec.ISEMPTY THEN
                 RecipeRec.DELETEALL;

               TextRec.RESET;
               TextRec.SETRANGE("Table Name",TextRec."Table Name"::Estimate);
               TextRec.SETRANGE("Estimate No.","Estimate No.");
               TextRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               TextRec.SETRANGE("Part Group","Part Group");
               TextRec.SETRANGE(Part,Part);
               IF NOT TextRec.ISEMPTY THEN
                 TextRec.DELETEALL;

               EstCodeRec.RESET;
               EstCodeRec.SETRANGE("Estimate No.","Estimate No.");
               EstCodeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstCodeRec.SETRANGE("Part Group","Part Group");
               EstCodeRec.SETRANGE(Part,Part);
               IF NOT EstCodeRec.ISEMPTY THEN
                 EstCodeRec.DELETEALL;

               ChrgRec.RESET;
               ChrgRec.SETRANGE("Estimate No.","Estimate No.");
               ChrgRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               ChrgRec.SETRANGE("Part Group","Part Group");
               ChrgRec.SETRANGE(Part,Part);
               IF NOT ChrgRec.ISEMPTY THEN
                 ChrgRec.DELETEALL;

               QuanSheetRec.RESET;
               QuanSheetRec.SETRANGE("Estimate No.","Estimate No.");
               QuanSheetRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanSheetRec.SETRANGE("Part Group","Part Group");
               QuanSheetRec.SETRANGE(Part,Part);
               IF NOT QuanSheetRec.ISEMPTY THEN
                 QuanSheetRec.DELETEALL;

               DeleteQuantityRelation("Estimate No.", "Sub-Estimate No.", "Part Group", Part); //DP00686

               QuanModelRec.RESET;
               QuanModelRec.SETRANGE("Estimate No.","Estimate No.");
               QuanModelRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanModelRec.SETRANGE("Part Group","Part Group");
               QuanModelRec.SETRANGE(Part,Part);
               IF NOT QuanModelRec.ISEMPTY THEN
                 QuanModelRec.DELETEALL;

               EstPartRec.RESET;
               EstPartRec.SETRANGE("Estimate No.","Estimate No.");
               EstPartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstPartRec.SETRANGE("Part Group","Part Group");

               EstLineRec.SETRANGE(Part);
               EstLineTotal.SETRANGE(Part);  //DP00381
               RecipeRec.SETRANGE(Part);
               TextRec.SETRANGE(Part);
               EstCodeRec.SETRANGE(Part);
               ChrgRec.SETRANGE(Part);
               QuanSheetRec.SETRANGE(Part);
               QuanModelRec.SETRANGE(Part);

               FormatMgt.CheckFormat(1,sp1,sp2);  //C063045
               CurrLevel := Level;
               IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
               IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

               CASE CurrLevel OF
                 0:BEGIN
                     DeleteExcelFile(EstPartRec);
                     IF NOT EstPartRec.ISEMPTY THEN
                       EstPartRec.DELETEALL;
                     IF NOT EstLineRec.ISEMPTY THEN
                       EstLineRec.DELETEALL;
                     IF NOT RecipeRec.ISEMPTY THEN
                       RecipeRec.DELETEALL;
                     IF NOT TextRec.ISEMPTY THEN
                       TextRec.DELETEALL;
                     IF NOT EstCodeRec.ISEMPTY THEN
                       EstCodeRec.DELETEALL;
                     IF NOT ChrgRec.ISEMPTY THEN
                       ChrgRec.DELETEALL;
                     IF NOT QuanSheetRec.ISEMPTY THEN
                       QuanSheetRec.DELETEALL;
                     IF NOT QuanModelRec.ISEMPTY THEN
                       QuanModelRec.DELETEALL;
                   END;
                 1:BEGIN
                     EstPartRec.SETRANGE(Chapter,Chapter);
                     DeleteExcelFile(EstPartRec);
                     EstLineRec.SETRANGE(Chapter,Chapter);
                     IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
                       REPEAT
                         EstLineTotal.SETRANGE(Part,EstLineRec.Part);
                         EstLineTotal.SETRANGE("Line No.",EstLineRec."Line No.");
                         EstLineTotal.DELETEALL;  //DP00381

                         RecipeRec.SETRANGE(Part,EstLineRec.Part);
                         RecipeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT RecipeRec.ISEMPTY THEN
                           RecipeRec.DELETEALL(TRUE);

                         TextRec.SETRANGE(Part,EstLineRec.Part);
                         TextRec.SETRANGE("Estimate Line No.",EstLineRec."Line No.");
                         IF NOT TextRec.ISEMPTY THEN
                           TextRec.DELETEALL;

                         EstCodeRec.SETRANGE(Part,EstLineRec.Part);
                         EstCodeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT EstCodeRec.ISEMPTY THEN
                           EstCodeRec.DELETEALL;

                         ChrgRec.SETRANGE(Part,EstLineRec.Part);
                         ChrgRec.SETRANGE("Surcharge Line",EstLineRec."Line No.");
                         ChrgRec.SETRANGE("Basic Line");
                         IF NOT ChrgRec.ISEMPTY THEN
                           ChrgRec.DELETEALL;
                         ChrgRec.SETRANGE("Surcharge Line");
                         ChrgRec.SETRANGE("Basic Line",EstLineRec."Line No.");
                         IF NOT ChrgRec.ISEMPTY THEN
                           ChrgRec.DELETEALL;

                         QuanSheetRec.SETRANGE(Part,EstLineRec.Part);
                         QuanSheetRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanSheetRec.ISEMPTY THEN
                           QuanSheetRec.DELETEALL;

                         QuanModelRec.SETRANGE(Part,EstLineRec.Part);
                         QuanModelRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanModelRec.ISEMPTY THEN
                           QuanModelRec.DELETEALL;
                       UNTIL EstLineRec.NEXT = 0;
                     END;
                     IF NOT EstLineRec.ISEMPTY THEN
                       EstLineRec.DELETEALL;
                   END;
                 2:BEGIN
                     EstPartRec.SETRANGE(Paragraph,Paragraph);
                     DeleteExcelFile(EstPartRec);
                     EstLineRec.SETRANGE(Paragraph,Paragraph);
                     IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
                       REPEAT
                         EstLineTotal.SETRANGE(Part,EstLineRec.Part);
                         EstLineTotal.SETRANGE("Line No.",EstLineRec."Line No.");
                         EstLineTotal.DELETEALL;  //DP00381

                         RecipeRec.SETRANGE(Part,EstLineRec.Part);
                         RecipeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT RecipeRec.ISEMPTY THEN
                           RecipeRec.DELETEALL(TRUE);

                         TextRec.SETRANGE(Part,EstLineRec.Part);
                         TextRec.SETRANGE("Estimate Line No.",EstLineRec."Line No.");
                         IF NOT TextRec.ISEMPTY THEN
                           TextRec.DELETEALL;

                         EstCodeRec.SETRANGE(Part,EstLineRec.Part);
                         EstCodeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT EstCodeRec.ISEMPTY THEN
                           EstCodeRec.DELETEALL;

                         ChrgRec.SETRANGE(Part,EstLineRec.Part);
                         ChrgRec.SETRANGE("Surcharge Line",EstLineRec."Line No.");
                         ChrgRec.SETRANGE("Basic Line");
                         IF NOT ChrgRec.ISEMPTY THEN
                           ChrgRec.DELETEALL;
                         ChrgRec.SETRANGE("Surcharge Line");
                         ChrgRec.SETRANGE("Basic Line",EstLineRec."Line No.");
                         IF NOT ChrgRec.ISEMPTY THEN
                           ChrgRec.DELETEALL;

                         QuanSheetRec.SETRANGE(Part,EstLineRec.Part);
                         QuanSheetRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanSheetRec.ISEMPTY THEN
                           QuanSheetRec.DELETEALL;

                         QuanModelRec.SETRANGE(Part,EstLineRec.Part);
                         QuanModelRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanModelRec.ISEMPTY THEN
                           QuanModelRec.DELETEALL;
                       UNTIL EstLineRec.NEXT = 0;
                     END;
                     IF NOT EstLineRec.ISEMPTY THEN
                       EstLineRec.DELETEALL;
                   END;
                 3:BEGIN
                     EstPartRec := Rec;
                     EstPartRec.SETRECFILTER;
                     DeleteExcelFile(EstPartRec);
                   END;
               END;

               ProcessSalesTotalUnitPrices(TRUE);
             END;

    OnRename=BEGIN
               ERROR(Text001);
             END;

    CaptionML=[ENU=Estimate Part;
               NOR=Kalkyledel;
               SVE=Kalkyldel];
    PasteIsValid=No;
    LookupPageID=Page11229768;
    DrillDownPageID=Page11229768;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr] }
    { 11  ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=[ENU=Estimate Description;
                                                              NOR=Kalkylebeskrivelse;
                                                              SVE=Kalkylbeskrivning];
                                                   Editable=No }
    { 12  ;   ;Sub-Estimate No.    ;Code20        ;TableRelation=Sub-Estimate."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Sub-Estimate No.;
                                                              NOR=Delkalkylenummer;
                                                              SVE=Delkalkylnr] }
    { 13  ;   ;Sub-Estimate Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Sub-Estimate.Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Sub-Estimate Description;
                                                              NOR=Beskrivelse av delkalkyle;
                                                              SVE=Beskrivning av delkalkyl];
                                                   Editable=No }
    { 15  ;   ;Part Group          ;Code10        ;CaptionML=[ENU=Part Group;
                                                              NOR=Del gruppe;
                                                              SVE=Delgrupp] }
    { 20  ;   ;Part                ;Code20        ;TableRelation="Estimate Base Part".Code WHERE (Part Group=FIELD(Part Group));
                                                   OnValidate=BEGIN
                                                                FormatMgt.CreateEstPart("Estimate No.","Sub-Estimate No.","Part Group",Part,Chapter,Paragraph,Level,TRUE);
                                                                IF CurrFieldNo = FIELDNO(Part) THEN
                                                                  IF (xRec.Part <> '') AND (xRec.Part <> Part) THEN
                                                                    ERROR(Text001);  //C017149

                                                                IF Part <> xRec.Part THEN
                                                                  IF PartRec.GET("Part Group",Part) THEN BEGIN
                                                                    InheritFromBasePart(PartRec); //C035157
                                                                    CopyPartText('','');  //DP00686
                                                                    CopyPartQuantitySheet('','');  //DP00686
                                                                  END;

                                                                InheritFromParentLevel;  //DP02460
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Part;
                                                              NOR=Del;
                                                              SVE=Del] }
    { 21  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 22  ;   ;Quantity            ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                ProcessPartQuantity;
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5 }
    { 23  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=Enhet;
                                                              SVE=M†ttenhet] }
    { 25  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              NOR=Beskrivelse 2;
                                                              SVE=Beskrivning 2] }
    { 31  ;   ;Chapter             ;Code20        ;CaptionML=[ENU=Chapter;
                                                              NOR=Kapittel;
                                                              SVE=Kapitel] }
    { 32  ;   ;Paragraph           ;Code20        ;CaptionML=[ENU=Paragraph;
                                                              NOR=Avsnitt;
                                                              SVE=Stycke] }
    { 40  ;   ;Level               ;Integer       ;CaptionML=[ENU=Level;
                                                              NOR=Niv†;
                                                              SVE=Niv†] }
    { 50  ;   ;Estimated Part      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                        Part=FIELD(Part)));
                                                   CaptionML=[ENU=Estimated Part;
                                                              NOR=Kalkulert del;
                                                              SVE=Kalkylerad del];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 80  ;   ;Estimated Total     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Estimated Total;
                                                              NOR=Kalkulert Sum;
                                                              SVE=Kalkylerad summa] }
    { 90  ;   ;Hours Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Part=FIELD(Part)));
                                                   CaptionML=[ENU=Hours Part;
                                                              NOR=Timer, del;
                                                              SVE=Timmar, del];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 100 ;   ;Hours Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Paragraph=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Hours Paragraph;
                                                              NOR=Timer, avsnitt;
                                                              SVE=Timmar, stycke];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 110 ;   ;Hours Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Chapter=FIELD(Chapter)));
                                                   CaptionML=[ENU=Hours Chapter;
                                                              NOR=Timer, kapittel;
                                                              SVE=Timmar, kapitel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 120 ;   ;Hours Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Hours Total;
                                                              NOR=Timer, totalt;
                                                              SVE=Timmar, totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;Labor Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                              Part=FIELD(Part)));
                                                   CaptionML=[ENU=Labor Part;
                                                              NOR=Arbeidskraftsdel;
                                                              SVE=Arbetskraftsdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 140 ;   ;Labor Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                              Paragraph=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Labor Paragraph;
                                                              NOR=Arbeidskraftsavsnitt;
                                                              SVE=Arbetskraftsstycke];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 150 ;   ;Labor Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                              Chapter=FIELD(Chapter)));
                                                   CaptionML=[ENU=Labor Chapter;
                                                              NOR=Arbeidskraftskapittel;
                                                              SVE=Arbetskraftskapitel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 160 ;   ;Labor Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Labor Total;
                                                              NOR=Arbeidskraft totalt;
                                                              SVE=Arbetskraft totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 170 ;   ;Material Part       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part=FIELD(Part)));
                                                   CaptionML=[ENU=Material Part;
                                                              NOR=Materialedel;
                                                              SVE=Materialdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 171 ;   ;Gross Price Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Part=FIELD(Part)));
                                                   CaptionML=[ENU=Gross Price Part;
                                                              NOR=Bruttoprisdel;
                                                              SVE=Bruttoprisdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 180 ;   ;Material Paragraph  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Paragraph=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Material Paragraph;
                                                              NOR=Materialeavsnitt;
                                                              SVE=Materialstycke];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 181 ;   ;Gross Price Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Paragraph=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Gross Price Paragraph;
                                                              NOR=Bruttoprisavsnitt;
                                                              SVE=Bruttoprisstycke];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 190 ;   ;Material Chapter    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Chapter=FIELD(Chapter)));
                                                   CaptionML=[ENU=Material Chapter;
                                                              NOR=Materialekapittel;
                                                              SVE=Materialkapitel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 191 ;   ;Gross Price Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Chapter=FIELD(Chapter)));
                                                   CaptionML=[ENU=Gross Price Chapter;
                                                              NOR=Bruttopriskapittel;
                                                              SVE=Bruttopriskapitel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 200 ;   ;Material Total      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Material Total;
                                                              NOR=Materiale totalt;
                                                              SVE=Material totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 201 ;   ;Gross Price Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Gross Price Total;
                                                              NOR=Total Bruttopris;
                                                              SVE=Totalt bruttopris];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 210 ;   ;Subcontracting Part ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Part=FIELD(Part)));
                                                   CaptionML=[ENU=Subcontracting Part;
                                                              NOR=Underentrepen›rsdel;
                                                              SVE=Underentreprenadsdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 220 ;   ;Subcontracting Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Paragraph=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Subcontracting Paragraph;
                                                              NOR=Underentrepen›rsavsnitt;
                                                              SVE=Underentreprenadsstycke];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 230 ;   ;Subcontracting Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Chapter=FIELD(Chapter)));
                                                   CaptionML=[ENU=Subcontracting Chapter;
                                                              NOR=Underentrepen›rskapittel;
                                                              SVE=Underentreprenadskapitel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Subcontracting Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Subcontracting Total;
                                                              NOR=Underentrepen›r Total;
                                                              SVE=Underentreprenadssumma];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Plant Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                              Part=FIELD(Part)));
                                                   CaptionML=[ENU=Plant Part;
                                                              NOR=Maskindel;
                                                              SVE=Maskindel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 260 ;   ;Plant Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                              Paragraph=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Plant Paragraph;
                                                              NOR=Maskinavsnitt;
                                                              SVE=Maskinstycke];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Plant Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                              Chapter=FIELD(Chapter)));
                                                   CaptionML=[ENU=Plant Chapter;
                                                              NOR=Maskinkapittel;
                                                              SVE=Maskinkapitel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Plant Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Plant Total;
                                                              NOR=Total for maskinen;
                                                              SVE=Totalt f”r Maskinen];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 290 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                UpdateNormGroup;  //DP00686
                                                              END;

                                                   CaptionML=[ENU=Norm Group;
                                                              NOR=Normgruppe;
                                                              SVE=Normgrupp] }
    { 300 ;   ;Element             ;Code20        ;TableRelation="Base Element".Code;
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                GetDisciplineByElement;  //DP02460
                                                                UpdateProjElem(1);
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 305 ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                UpdateProjElem(0);
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 310 ;   ;Text                ;Text250       ;CaptionML=[ENU=Text;
                                                              NOR=Tekst;
                                                              SVE=Ben„mning] }
    { 315 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line (Group)" WHERE (Table Name=CONST(Estimate),
                                                                                                   Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FIELD(Part Group),
                                                                                                   Part=FIELD(Part),
                                                                                                   Estimate Line No.=CONST(0)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 316 ;   ;Print on Quote      ;Boolean       ;OnValidate=VAR
                                                                EstLineRec@1210190000 : Record 11072072;
                                                              BEGIN
                                                                EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstLineRec.SETRANGE("Part Group", "Part Group");
                                                                EstLineRec.SETRANGE(Part, Part);
                                                                IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                  REPEAT
                                                                    EstLineRec.VALIDATE("Print on Quote", "Print on Quote");
                                                                    EstLineRec.MODIFY;
                                                                  UNTIL EstLineRec.NEXT = 0;
                                                                END;

                                                                ProcessPartFields(FIELDNO("Print on Quote"));
                                                              END;

                                                   CaptionML=[ENU=Print on Quote;
                                                              NOR=Skriv ut p† tilbud;
                                                              SVE=Skriv ut p† offert] }
    { 317 ;   ;Extension           ;Boolean       ;OnValidate=VAR
                                                                EstLineRec@1210190000 : Record 11072072;
                                                              BEGIN
                                                                EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstLineRec.SETRANGE("Part Group", "Part Group");
                                                                EstLineRec.SETRANGE(Part, Part);
                                                                IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                  REPEAT
                                                                    EstLineRec.VALIDATE(Extension, Extension);
                                                                    EstLineRec.MODIFY;
                                                                  UNTIL EstLineRec.NEXT = 0;
                                                                END;

                                                                ProcessPartFields(FIELDNO(Extension));
                                                              END;

                                                   CaptionML=[ENU=Extension;
                                                              NOR=Direktenr.;
                                                              SVE=Extension] }
    { 320 ;   ;Adjustment Factor Hours;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,1);  //DP00555
                                                              END;

                                                   CaptionML=[ENU=Hours Adjustment Factor;
                                                              NOR=Timejusteringsfaktor;
                                                              SVE=Timjusteringsfaktor];
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 321 ;   ;Adjustment Factor Material;Decimal ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(2,1);  //DP00555
                                                              END;

                                                   CaptionML=[ENU=Material Adjustment Factor;
                                                              NOR=Materialejusteringsfaktor;
                                                              SVE=Materialjusteringsfaktor];
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 322 ;   ;Adjustment Factor Subcontr.;Decimal;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(3,1);  //DP00555
                                                              END;

                                                   CaptionML=[ENU=Subcontr. Adjustment Factor;
                                                              NOR=Underentrepen›r Justeringsfaktor;
                                                              SVE=Underlev. Justeringsfaktor];
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 323 ;   ;Adjustment Factor Plant;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(4,1);  //DP00555
                                                              END;

                                                   CaptionML=[ENU=Plant Adjustment Factor;
                                                              NOR=Maskin Justeringsfaktor;
                                                              SVE=Maskin justeringsfaktor];
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 324 ;   ;Adjustment Factor Sundry;Decimal   ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(5,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 325 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=[ENU=Hours Cum. Adj. Factor Hours;
                                                              NOR=Timer akkumulert Justeringsfaktor for timer;
                                                              SVE=Timmar ackum., justeringsfaktor f”r timmar];
                                                   DecimalPlaces=0:6 }
    { 326 ;   ;Cum. Adj. Factor Material;Decimal  ;CaptionML=[ENU=Material Cum. Adj. Factor;
                                                              NOR=Akkumulert Justeringsfaktor for Materiale;
                                                              SVE=Ackum. justeringsfaktor f”r material];
                                                   DecimalPlaces=0:6 }
    { 327 ;   ;Cum. Adj. Factor Subcontr.;Decimal ;CaptionML=[ENU=Subcontr. Cum. Adj. Factor;
                                                              NOR=Akkumulert Justeringsfaktor for Underentrepren›r;
                                                              SVE=Ackum. justeringsfaktor f”r underentrepren”r];
                                                   DecimalPlaces=0:6 }
    { 328 ;   ;Cum. Adj. Factor Plant;Decimal     ;CaptionML=[ENU=Plant Cum. Adj. Factor;
                                                              NOR=Akkumulert Justeringsfaktor for maskin;
                                                              SVE=Ackum. justeringsfaktor f”r Maskin];
                                                   DecimalPlaces=0:6 }
    { 329 ;   ;Cum. Adj. Factor Sundry;Decimal    ;CaptionML=ENU=Cum. Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 330 ;   ;Code                ;Code20        ;OnValidate=VAR
                                                                CodingSystem@1100525000 : Record 11012088;
                                                              BEGIN
                                                                EstRec.GET("Estimate No.");
                                                                EstRec.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  CodingSystem.GET(EstRec."Coding System");
                                                                  IF CodingSystem."Deviant Code allowed" = FALSE THEN BEGIN
                                                                    FormatMgt.SetSelection(EstRec."Coding System");
                                                                    FormatMgt.FormatElem(Code,4,'');
                                                                    CodeRec.GET(EstRec."Coding System", Code);
                                                                  END;
                                                                END;

                                                                MODIFY;
                                                                UpdateMgt.UpdateCode("Estimate No.", "Sub-Estimate No.", Part, Code);  //DP00381
                                                              END;

                                                   OnLookup=BEGIN
                                                              EstRec.GET("Estimate No.");
                                                              EstRec.TESTFIELD("Coding System");
                                                              CodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                              CodeRec.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeRec) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeRec.Code);
                                                            END;

                                                   CaptionML=[ENU=Code;
                                                              NOR=Kode;
                                                              SVE=Kod] }
    { 340 ;   ;Target Hours        ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Amount Labor", 0);
                                                              END;

                                                   CaptionML=[ENU=Target Hours;
                                                              NOR=M†ltimer;
                                                              SVE=M†ltimmar] }
    { 341 ;   ;Target Amount Labor ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Hours", 0);
                                                              END;

                                                   CaptionML=[ENU=Target Amount Labor;
                                                              NOR=M†lbel›p for arbeidskraft;
                                                              SVE=M†lbelopp f”r arbetskraft] }
    { 342 ;   ;Target Amount Material;Decimal     ;CaptionML=[ENU=Target Amount Material;
                                                              NOR=M†lbel›p for Materiale;
                                                              SVE=M†lbelopp f”r material] }
    { 343 ;   ;Target Amount Subcontracting;Decimal;
                                                   CaptionML=[ENU=Target Amount Subcontracting;
                                                              NOR=M†lbel›p for underentrepen›r;
                                                              SVE=M†lbelopp f”r underentreprenad] }
    { 344 ;   ;Target Amount Plant ;Decimal       ;CaptionML=[ENU=Target Amount Plant;
                                                              NOR=M†lbel›p for maskin;
                                                              SVE=M†lbelopp f”r Maskin] }
    { 345 ;   ;Target Amount Sundry;Decimal       ;CaptionML=ENU=Target Amount Sundry }
    { 350 ;   ;Condition           ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=[ENU=Condition;
                                                              NOR=Betingelse;
                                                              SVE=Villkor] }
    { 360 ;   ;Excel Estimate Template;Text50     ;OnValidate=BEGIN
                                                                IF ExcelFileExists THEN EXIT;  //C032217
                                                                //when part with excel-file is copied, file already exist; default template by validate (base)part not relevant

                                                                IF (xRec."Excel Estimate Template" <> Rec."Excel Estimate Template") AND ExcelFileExists THEN
                                                                  IF CONFIRM(Text005,TRUE,FIELDCAPTION("Excel Estimate Template")) THEN
                                                                    FileMgt.DeleteClientFile4PS(ExcelEstimateMgt.GetPathFileName(Rec), TRUE)
                                                                  ELSE
                                                                    ERROR(Text006,FIELDCAPTION("Excel Estimate Template"));

                                                                IF CheckValidExcelTemplate(TRUE) THEN;
                                                              END;

                                                   OnLookup=VAR
                                                              lvEstimateSetupRec@1100528904 : Record 11012150;
                                                              lvExcelTemplate@1100528902 : Text[250];
                                                              DirectoryName@1100528901 : Text;
                                                              FileAbsPathName@1100528900 : Text;
                                                            BEGIN
                                                              lvEstimateSetupRec.GET;
                                                              DirectoryName := lvEstimateSetupRec."Pathname Excel Est. Template";
                                                              IF FileMgt.SelectFile('xlt', DirectoryName, lvExcelTemplate, FileAbsPathName) THEN
                                                                VALIDATE("Excel Estimate Template",lvExcelTemplate);
                                                            END;

                                                   CaptionML=[ENU=Excel Estimate Template;
                                                              NOR=Excel-kalkylemal;
                                                              SVE=Excel-kalkylmall] }
    { 370 ;   ;Updated form Excel  ;Boolean       ;CaptionML=[ENU=Updated form Excel;
                                                              NOR=Excel-skjemaet er oppdatert;
                                                              SVE=Excel-formul„ret har uppdaterats];
                                                   Editable=No }
    { 380 ;   ;Vendor              ;Code20        ;TableRelation=Vendor.No.;
                                                   CaptionML=[ENU=Vendor;
                                                              NOR=Leverand›r;
                                                              SVE=Leverant”r] }
    { 381 ;   ;Vendor Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=[ENU=Vendor Name;
                                                              NOR=Leverand›rsnavn;
                                                              SVE=Leverant”rsnamn];
                                                   Editable=No }
    { 390 ;   ;Subcontractor       ;Code20        ;TableRelation=Vendor.No. WHERE (Subcontractor Type=FILTER(Subcontractor|Self Employed|Employment Agency));
                                                   CaptionML=[ENU=Subcontractor;
                                                              NOR=Underentrepren›r;
                                                              SVE=Underentrepren”r] }
    { 391 ;   ;Subcontractor Name  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=[ENU=Subcontractor Name;
                                                              NOR=Underentrepren›rens navn;
                                                              SVE=Underentrepren”rens namn];
                                                   Editable=No }
    { 400 ;   ;Quantity Model Exist;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Model Line Quantity" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                           Part Group=FIELD(Part Group),
                                                                                                           Part=FIELD(Part)));
                                                   CaptionML=[ENU=Quantity Model Exist;
                                                              NOR=Antallsmodell finnes;
                                                              SVE=Antalsmodell finns];
                                                   Editable=No }
    { 500 ;   ;Settlement Type     ;Option        ;CaptionML=[ENU=Settlement Type;
                                                              NOR=Oppgj›rstype;
                                                              SVE=Avr„kningstyp];
                                                   OptionCaptionML=[ENU=" ,Non Settling,Settling,Approved,Reduction,Open";
                                                                    NOR=" ,Ingen avregning,Avregning,Godkjenn,Reduksjon,pen";
                                                                    SVE=" ,Ingen avr„kning,Avr„kning,Godk„nd,Reduktion,™ppen"];
                                                   OptionString=[ ,Non Settling,Settling,Approved,Reduction,Open] }
    { 510 ;   ;Settlement Status   ;Code10        ;TableRelation="Estimate Part Status".Status;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Settlement Status Description");
                                                              END;

                                                   CaptionML=[ENU=Settlement Status;
                                                              NOR=Oppgj›rsstatus;
                                                              SVE=Avr„kningsstatus] }
    { 511 ;   ;Settlement Status Description;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Part Status".Description WHERE (Status=FIELD(Settlement Status)));
                                                   CaptionML=[ENU=Settlement Status Description;
                                                              NOR=Beskrivelse av oppgj›rsstatus;
                                                              SVE=Beskrivning av avr„kningsstatus];
                                                   Editable=No }
    { 600 ;   ;Quantity per Unit   ;Decimal       ;OnValidate=VAR
                                                                EstQuanSheetHeader@1100409001 : Record 11020462;
                                                                EstQuanSheetLine@1100409000 : Record 11020464;
                                                              BEGIN
                                                                //DP00686
                                                                EstQuanSheetHeader.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstQuanSheetHeader.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstQuanSheetHeader.SETRANGE(Part, Part);
                                                                IF EstQuanSheetHeader.FINDSET THEN BEGIN
                                                                  REPEAT
                                                                    EstQuanSheetLine.SETRANGE("Estimate No.", EstQuanSheetHeader."Estimate No.");
                                                                    EstQuanSheetLine.SETRANGE("Quantity Sheet", EstQuanSheetHeader.Code);
                                                                    EstQuanSheetLine.SETRANGE("Related to Part Quantity", TRUE);
                                                                    IF EstQuanSheetLine.FINDSET THEN BEGIN
                                                                      IF EstQuanSheetLine."Related to Column" = EstQuanSheetLine."Related to Column"::Quantity THEN BEGIN
                                                                        EstQuanSheetLine.VALIDATE(Quantity, "Quantity per Unit");
                                                                        EstQuanSheetLine.MODIFY;
                                                                      END;
                                                                    END;
                                                                    EstQuanSheetHeader.ProcessSheet(EstQuanSheetHeader."Estimate No.",EstQuanSheetHeader.Code);
                                                                    EstQuanSheetHeader.WriteDataFromSheetToEstimate(EstQuanSheetHeader."Estimate No.",EstQuanSheetHeader.Code);
                                                                  UNTIL EstQuanSheetHeader.NEXT = 0;
                                                                END;
                                                                CalculateOfferPriceIndex;  //C036026

                                                                VALIDATE("Unit Price");
                                                              END;

                                                   CaptionML=[ENU=Quantity per Unit;
                                                              NOR=Antall per Enhet;
                                                              SVE=Antal per enhet] }
    { 601 ;   ;Unit of Qty per Unit;Code20        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Qty per Unit;
                                                              NOR=Antallsenhet per enhet;
                                                              SVE=Antalsenhet per enhet] }
    { 610 ;   ;Calculated Cost Amount;Decimal     ;CaptionML=ENU=Calculated Cost Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 611 ;   ;Calculated Cost Price;Decimal      ;CaptionML=[ENU=Calculated Cost Price;
                                                              NOR=Estimert selvkost;
                                                              SVE=Ber„knat sj„lvkostnadspris];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 620 ;   ;Offer Amount        ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Amount (FCY)" := ExchangeAmtLCYToFCY("Offer Amount", FALSE);
                                                                CumQuan := GetPartQuantity;
                                                                IF CumQuan <> 0 THEN BEGIN
                                                                  GLSetup.GET;  //C033941
                                                                  "Offer Price" := ROUND(("Offer Amount" / CumQuan), GLSetup."Unit-Amount Rounding Precision");
                                                                  "Offer Price (FCY)" := ROUND(("Offer Amount (FCY)" / CumQuan), GLSetup."Unit-Amount Rounding Precision");
                                                                END;
                                                                IF (CurrFieldNo = FIELDNO("Margin %")) OR //C042551
                                                                   (CurrFieldNo = FIELDNO("Markup %")) OR
                                                                   (CurrFieldNo = FIELDNO("Offer Price Index")) OR  //C045271
                                                                   (CurrFieldNo = FIELDNO("Offer Amount")) THEN  //C040037
                                                                  ProcessSalesOfferPrices(FALSE);
                                                                CalculateOfferPriceIndex;  //C036026
                                                              END;

                                                   CaptionML=[ENU=Offer Amount;
                                                              NOR=Tilbudsbel›p;
                                                              SVE=Anbudsbelopp];
                                                   AutoFormatType=1 }
    { 621 ;   ;Offer Price         ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Price (FCY)" := ExchangeAmtLCYToFCY("Offer Price", TRUE);
                                                                CumQuan := GetPartQuantity;
                                                                GLSetup.GET;  //C033941
                                                                "Offer Amount" := ROUND((CumQuan * "Offer Price"), GLSetup."Amount Rounding Precision");
                                                                "Offer Amount (FCY)" := ROUND((CumQuan * "Offer Price (FCY)"), GLSetup."Amount Rounding Precision");
                                                                IF (CurrFieldNo = FIELDNO("Margin %")) OR //C042551
                                                                   (CurrFieldNo = FIELDNO("Markup %")) OR
                                                                   (CurrFieldNo = FIELDNO("Offer Price Index")) OR  //C045271
                                                                   (CurrFieldNo = FIELDNO("Offer Price")) THEN  //C040037
                                                                  ProcessSalesOfferPrices(FALSE);
                                                                CalculateOfferPriceIndex;  //C036026
                                                              END;

                                                   CaptionML=[ENU=Offer Price;
                                                              NOR=Tilbudspris;
                                                              SVE=Anbudspris];
                                                   AutoFormatType=1 }
    { 622 ;   ;Margin %            ;Decimal       ;CaptionML=[ENU=Margin %;
                                                              NOR=Marginal %;
                                                              SVE=Marginalprocent] }
    { 623 ;   ;Sales Comment       ;Text250       ;CaptionML=[ENU=Sales Comment;
                                                              NOR=Salgskommentar;
                                                              SVE=F”rs„ljningskommentar] }
    { 624 ;   ;Transfer to Installment M.;Boolean ;CaptionML=[ENU=Transfer to Installment Motivation;
                                                              NOR=Overf›r til Avdragsmotivasjon;
                                                              SVE=™verf”r till avbetalningsmotivation] }
    { 625 ;   ;Offer fixed         ;Boolean       ;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO("Offer fixed"));
                                                              END;

                                                   CaptionML=[ENU=Offer fixed;
                                                              NOR=Fast tilbud;
                                                              SVE=Fast anbud] }
    { 626 ;   ;Markup %            ;Decimal       ;CaptionML=[ENU=Markup %;
                                                              NOR=P†f›ringsprosent;
                                                              SVE=P†l„ggsprocent] }
    { 630 ;   ;Exclude Additional Costs;Boolean   ;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO("Exclude Additional Costs"));
                                                              END;

                                                   CaptionML=ENU=Exclude Additional Costs Summary Sheet from Offer Price }
    { 635 ;   ;Offer Price Index   ;Decimal       ;CaptionML=ENU=Offer Price Index;
                                                   Description=C036026 }
    { 640 ;   ;Last Date Modified (FCP);Date      ;CaptionML=ENU=Last Date Full Cost Price Modified;
                                                   Description=DP01315;
                                                   Editable=No }
    { 641 ;   ;Last Time Modified (FCP);Time      ;CaptionML=ENU=Last Time Full Cost Price Modified;
                                                   Description=DP01315 }
    { 645 ;   ;Last Date Modified (FSP);Date      ;CaptionML=ENU=Last Date Full Sales Price Modified;
                                                   Description=DP01315;
                                                   Editable=No }
    { 646 ;   ;Last Time Modified (FSP);Time      ;CaptionML=ENU=Last Time Full Sales Price Modified;
                                                   Description=DP01315 }
    { 650 ;   ;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");

                                                                UpdateProjPlanActCode;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Project Planning Activity Code;
                                                              NOR=Prosjektplan, Aktivitetskode;
                                                              SVE=Projektplan, aktivitetskod] }
    { 660 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                UpdateExtensionContract;  //DP00260
                                                              END;

                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=ŽTA] }
    { 670 ;   ;Rate Code           ;Code10        ;TableRelation="Estimate Rate"."Rate Code" WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Rate Code;
                                                              NOR=Avgiftskode;
                                                              SVE=Avgiftskod] }
    { 675 ;   ;Discipline          ;Code10        ;TableRelation=Discipline;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo <> FIELDNO(Discipline) THEN
                                                                  GetDisciplineByElement;  //DP02460
                                                                ProcessPartFields(FIELDNO(Discipline));  //DP02460
                                                                UpdateDiscipline;  //DP02460
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Discipline;
                                                              SVE=Disciplin];
                                                   Description=DP02460 }
    { 680 ;   ;Exclude Surcharge (GenCost);Boolean;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO("Exclude Surcharge (GenCost)")); //DP02080
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Exclude Surcharge General Cost;
                                                   Description=DP02080 }
    { 690 ;   ;Last Date Recalculated;Date        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Last Date recalculated;
                                                   Description=DP02080;
                                                   Editable=No }
    { 691 ;   ;Last Time Recalculated;Time        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Last Time recalculated;
                                                   Description=DP02080 }
    { 700 ;   ;Lines Exist         ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Line" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                            Part Group=FIELD(Part Group),
                                                                                            Part=FIELD(Part)));
                                                   CaptionML=[ENU=Lines;
                                                              NOR=Rader;
                                                              SVE=Rader];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 710 ;   ;Finished            ;Boolean       ;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO(Finished));  //DP01931
                                                              END;

                                                   CaptionML=[ENU=Estimate Finished;
                                                              NOR=Kalkyle ferdig;
                                                              SVE=Kalkyl f„rdig];
                                                   Description=DP01931 }
    { 900 ;   ;Treeview Level      ;Integer       ;CaptionML=ENU=Treeview Level }
    { 1000;   ;OnTempTable         ;Boolean       ;CaptionML=[ENU=Temp table;
                                                              NOR=Midlertidig tabell;
                                                              SVE=Tillf. tabell];
                                                   Editable=No }
    { 2000;   ;Sundry Part         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Part=FIELD(Part)));
                                                   CaptionML=ENU=Sundry Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2010;   ;Sundry Paragraph    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Sundry Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2020;   ;Sundry Chapter      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Sundry Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2030;   ;Sundry Total        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sundry Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2040;   ;Gross Price Part (Subc);Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                        Part=FIELD(Part)));
                                                   CaptionML=[ENU=Gross Price Part;
                                                              NOR=Bruttoprisdel;
                                                              SVE=Bruttoprisdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2045;   ;Gross Price Part (Plant);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Part=FIELD(Part)));
                                                   CaptionML=[ENU=Gross Price Part;
                                                              NOR=Bruttoprisdel;
                                                              SVE=Bruttoprisdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2050;   ;Gross Price Part (Sundry);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part=FIELD(Part)));
                                                   CaptionML=[ENU=Gross Price Part;
                                                              NOR=Bruttoprisdel;
                                                              SVE=Bruttoprisdel];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2060;   ;Hours Sales Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part=FIELD(Part)));
                                                   CaptionML=ENU=Hours Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2061;   ;Hours Sales Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Hours Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2062;   ;Hours Sales Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Hours Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2063;   ;Hours Sales Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Hours Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2070;   ;Labor Sales Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Part=FIELD(Part)));
                                                   CaptionML=ENU=Labor Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2071;   ;Labor Sales Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Labor Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2072;   ;Labor Sales Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Labor Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2073;   ;Labor Sales Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Labor Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2100;   ;Material Sales Part ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Part=FIELD(Part)));
                                                   CaptionML=ENU=Material Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2110;   ;Material Sales Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Material Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2120;   ;Material Sales Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Material Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2130;   ;Material Sales Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Material Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2140;   ;Subcontracting Sales Part;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                        Part=FIELD(Part)));
                                                   CaptionML=ENU=Subcontracting Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2150;   ;Subcontracting Sales Paragraph;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                        Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Subcontracting Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2160;   ;Subcontracting Sales Chapter;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                        Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Subcontracting Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2170;   ;Subcontracting Sales Total;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                        Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Subcontracting Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2180;   ;Plant Sales Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Part=FIELD(Part)));
                                                   CaptionML=ENU=Plant Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2190;   ;Plant Sales Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Plant Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2200;   ;Plant Sales Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Plant Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2210;   ;Plant Sales Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Plant Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2220;   ;Sundry Sales Part   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part=FIELD(Part)));
                                                   CaptionML=ENU=Sundry Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2230;   ;Sundry Sales Paragraph;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Sundry Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2240;   ;Sundry Sales Chapter;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Sundry Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2250;   ;Sundry Sales Total  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sundry Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2300;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(0);
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Labor;
                                                              NOR=Tilleggsgebyrsprosent, arbeidskraft;
                                                              SVE=Till„ggsavgiftsprocent, arbetskraft];
                                                   BlankZero=Yes }
    { 2301;   ;Surcharge % Material;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(1);
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Material;
                                                              NOR=Tilleggsgebyrsprosent, Materiale;
                                                              SVE=Till„ggsavgiftsprocent, material];
                                                   BlankZero=Yes }
    { 2302;   ;Surcharge % Subcontracting;Decimal ;OnValidate=BEGIN
                                                                UpdateSurcharge(2);
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Subcontracting;
                                                              NOR=Tilleggsgebyrsprosent, underentrepen›r;
                                                              SVE=Till„ggsavgiftsprocent, underentreprenad];
                                                   BlankZero=Yes }
    { 2303;   ;Surcharge % Plant   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(3);
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Plant;
                                                              NOR=Tilleggsgebyrsprosent, maskin;
                                                              SVE=Till„ggsavgiftsprocent, Maskin];
                                                   BlankZero=Yes }
    { 2304;   ;Surcharge % Sundry  ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(4);
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Sundry;
                                                              NOR=P†slagssatser, diverse;
                                                              SVE=Till„ggsavgiftsprocent, diverse];
                                                   BlankZero=Yes }
    { 2310;   ;Calculated Sales Amount;Decimal    ;CaptionML=[ENU=Calculated Sales Amount;
                                                              NOR=Estimert salgsbel›p;
                                                              SVE=Ber„knat f”rs„ljningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2315;   ;Calculated Sales Price;Decimal     ;CaptionML=[ENU=Calculated Sales Price;
                                                              NOR=Estimert salgspris;
                                                              SVE=Ber„knat f”rs„ljningspris];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2320;   ;Norm Group (Sales)  ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                UpdateNormGroupSales;  //DP00686
                                                              END;

                                                   CaptionML=[ENU=Norm Group (Sales);
                                                              SVE=Kopiera till] }
    { 2330;   ;Adj. Factor Hours (Sales);Decimal  ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,2);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 2340;   ;Cum. Adj. Factor Hours (Sales);Decimal;
                                                   CaptionML=ENU=Cum. Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6 }
    { 2350;   ;Currency Code       ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate."Report Currency Code" WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod];
                                                   Editable=No }
    { 2360;   ;Offer Amount (FCY)  ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Amount" := ExchangeAmtFCYToLCY("Offer Amount (FCY)", FALSE);
                                                                CumQuan := GetPartQuantity;
                                                                IF CumQuan <> 0 THEN BEGIN
                                                                  GLSetup.GET;  //C033941
                                                                  "Offer Price (FCY)" := ROUND(("Offer Amount (FCY)" / CumQuan), GLSetup."Unit-Amount Rounding Precision");
                                                                  "Offer Price" := ROUND(("Offer Amount" / CumQuan), GLSetup."Unit-Amount Rounding Precision");
                                                                END;
                                                                IF (CurrFieldNo = FIELDNO("Margin %")) OR //C042551
                                                                   (CurrFieldNo = FIELDNO("Markup %")) OR
                                                                   (CurrFieldNo = FIELDNO("Offer Amount (FCY)")) THEN  //C040037
                                                                  ProcessSalesOfferPrices(TRUE);
                                                                CalculateOfferPriceIndex;  //C036026
                                                              END;

                                                   CaptionML=ENU=Offer Amount (FCY);
                                                   AutoFormatType=1 }
    { 2370;   ;Offer Price (FCY)   ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Price" := ExchangeAmtFCYToLCY("Offer Price (FCY)", TRUE);
                                                                CumQuan := GetPartQuantity;
                                                                GLSetup.GET;  //C033941
                                                                "Offer Amount (FCY)" := ROUND((CumQuan * "Offer Price (FCY)"), GLSetup."Amount Rounding Precision");
                                                                "Offer Amount" := ROUND((CumQuan * "Offer Price"), GLSetup."Amount Rounding Precision");
                                                                IF (CurrFieldNo = FIELDNO("Margin %")) OR //C042551
                                                                   (CurrFieldNo = FIELDNO("Markup %")) OR
                                                                   (CurrFieldNo = FIELDNO("Offer Price (FCY)")) THEN  //C040037
                                                                  ProcessSalesOfferPrices(TRUE);
                                                                CalculateOfferPriceIndex;  //C036026
                                                              END;

                                                   CaptionML=ENU=Offer Price (FCY);
                                                   AutoFormatType=1 }
    { 11128464;;Unit Price         ;Decimal       ;OnValidate=BEGIN
                                                                IF PartHasLowerLevels THEN BEGIN
                                                                  "Unit Price" := 0;
                                                                  IF CurrFieldNo = FIELDNO("Unit Price") THEN
                                                                    MESSAGE(MsgNotLowestLevel,Part);
                                                                  EXIT;
                                                                END;

                                                                CumQuan := GetPartQuantity;
                                                                IF CumQuan <> 0 THEN
                                                                  "Total Unit Price" := ROUND(("Unit Price" * "Quantity per Unit") / CumQuan, 0.01);

                                                                ProcessSalesTotalUnitPrices(FALSE);
                                                              END;

                                                   CaptionML=[ENU=Unit Price;
                                                              NOR=Enhetspris;
                                                              SVE=A-pris];
                                                   DecimalPlaces=2:2 }
    { 11128465;;Total Unit Price   ;Decimal       ;CaptionML=ENU=Total Unit Price;
                                                   DecimalPlaces=2:2;
                                                   Editable=No }
    { 11128466;;Unit Price Fixed   ;Boolean       ;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO("Unit Price Fixed"));
                                                              END;

                                                   CaptionML=ENU=Unit Price Fixed }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part;
                                                   SumIndexFields=Offer Amount,Calculated Cost Amount,Calculated Sales Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Estimate No.,Sub-Estimate No.,Level,Chapter,Paragraph;
                                                   SumIndexFields=Offer Amount,Calculated Cost Amount,Calculated Sales Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Element                     ;MaintainSIFTIndex=No }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      GLSetup@1100529500 : Record 98;
      EstRec@11012000 : Record 11012151;
      SubEstRec@1210190002 : Record 11072074;
      EstPartRec@1210190001 : Record 11072073;
      EstLineRec@11012001 : Record 11072072;
      RecipeRec@11012002 : Record 11072075;
      EstCodeRec@1210190013 : Record 11229772;
      CodeRec@1210190014 : Record 11012089;
      ChrgRec@11012004 : Record 11229771;
      TextRec@1210190005 : Record 11020595;
      QuanSheetRec@1210190011 : Record 11012186;
      QuanModelRec@1210190015 : Record 11012197;
      PartRec@11012006 : Record 11012169;
      ElemRec@1210190004 : Record 11012060;
      ProjElemRec@1210190003 : Record 11012010;
      FormatMgt@11012007 : Codeunit 11012022;
      Text001@1210190000 : TextConst 'ENU="Rename disabled; use copy function and delete original line afterwards.";NOR=Kan ikke endre navn. Bruk kopieringsfunksjonen og Fjern den originale raden etterp†.;SVE=Det g†r inte att byta namn. Anv„nd kopieringsfunktionen och ta bort den ursprungliga raden efter†t.';
      UpdateMgt@1210190012 : Codeunit 11012229;
      ExcelEstimateMgt@1100485000 : Codeunit 11012231;
      Text003@1100485001 : TextConst 'ENU="A %1 on a lower %2 is present. ";NOR=En %1 p† en lavere %2 finnes.;SVE="En %1 p† en l„gre %2 finns. "';
      Text004@1100485002 : TextConst 'ENU="A %1 on a higher %2 is present. ";NOR=En %1 p† en h›yere %2 finnes.;SVE="En %1 p† en h”gre %2 finns. "';
      Text005@1100485003 : TextConst 'ENU=The existing Excelfile doesn''t match %1 anymore, remove Excelfile is removed.;NOR=Den eksisterende Excel-filen stemmer ikke overens med %1 lenger, Fjern Excel-filen er fjernet.;SVE=Den befintliga Excel-filen st„mmer inte ”verens med %1 l„ngre, Excel-filen har tagits bort.';
      Text006@1100485004 : TextConst 'ENU=%1 is not changed.;NOR=%1 er ikke endret.;SVE=%1 har inte „ndrats.';
      Text007@1100485005 : TextConst 'ENU=%1 %2 doesn''t exist.;NOR=%1 %2 finnes ikke.;SVE=%1 %2 finns inte.';
      Text008@1100485007 : TextConst 'ENU=Price is Fixed on level (%1).;NOR=Prisen er fast p† niv† (%1).;SVE=Priset „r fast p† niv† (%1).';
      Text009@1100485008 : TextConst 'ENU=Price is Fixed on level (%1).;NOR=Prisen er fast p† niv† (%1).;SVE=Priset „r fast p† niv† (%1).';
      FileMgt@1100528900 : Codeunit 419;
      CumQuan@1100525000 : Decimal;
      MsgCopyOfficePriceIndex@111284600 : TextConst 'ENU=Not all Offer Price Indexes are copied because some Unit Prices are fixed.';
      MsgNotLowestLevel@111284601 : TextConst 'ENU=The part %1 is not on the lowest level. Changing is not allowed.';

    PROCEDURE InitAdjustmentFactor@1210190003();
    VAR
      CurrLevel@1210190000 : Integer;
    BEGIN
      IF "Adjustment Factor Hours" = 0 THEN
        "Adjustment Factor Hours" := 1;
      IF "Adjustment Factor Material" = 0 THEN
        "Adjustment Factor Material" := 1;
      IF "Adjustment Factor Subcontr." = 0 THEN
        "Adjustment Factor Subcontr." := 1;
      IF "Adjustment Factor Plant" = 0 THEN
        "Adjustment Factor Plant" := 1;
      IF "Adjustment Factor Sundry" = 0 THEN  //DP00381
        "Adjustment Factor Sundry" := 1;

      IF "Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
        "Adj. Factor Hours (Sales)" := 1;

      CurrLevel := Level;

      IF CurrLevel <> 0 THEN BEGIN
        EstPartRec.RESET;
        EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
        EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstPartRec.SETRANGE("Part Group", "Part Group");
        IF CurrLevel = 3 THEN BEGIN
          EstPartRec.SETRANGE(Part, Paragraph);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel = 2 THEN BEGIN
          EstPartRec.SETRANGE(Part, Chapter);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel = 1 THEN BEGIN
          EstPartRec.SETRANGE(Part);
          EstPartRec.SETRANGE(Level, 0);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel <> 0 THEN BEGIN
          IF EstPartRec."Cum. Adj. Factor Hours" = 0 THEN
            "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
          ELSE
            "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * EstPartRec."Cum. Adj. Factor Hours";
          IF EstPartRec."Cum. Adj. Factor Material" = 0 THEN
            "Cum. Adj. Factor Material" := "Adjustment Factor Material"
          ELSE
            "Cum. Adj. Factor Material" := "Adjustment Factor Material" * EstPartRec."Cum. Adj. Factor Material";
          IF EstPartRec."Cum. Adj. Factor Subcontr." = 0 THEN
            "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
          ELSE
            "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * EstPartRec."Cum. Adj. Factor Subcontr.";
          IF EstPartRec."Cum. Adj. Factor Plant" = 0 THEN
            "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
          ELSE
            "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * EstPartRec."Cum. Adj. Factor Plant";
          IF EstPartRec."Cum. Adj. Factor Sundry" = 0 THEN  //DP00381
            "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry"
          ELSE
            "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry" * EstPartRec."Cum. Adj. Factor Sundry";

          IF EstPartRec."Cum. Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
            "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)"
          ELSE
            "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)" * EstPartRec."Cum. Adj. Factor Hours (Sales)";
        END;
      END;

      IF CurrLevel = 0 THEN BEGIN
        IF NOT SubEstRec.GET("Estimate No.","Sub-Estimate No.") THEN SubEstRec.INIT;
        IF SubEstRec."Cum. Adj. Factor Hours" = 0 THEN
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
        ELSE
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * SubEstRec."Cum. Adj. Factor Hours";
        IF SubEstRec."Cum. Adj. Factor Material" = 0 THEN
          "Cum. Adj. Factor Material" := "Adjustment Factor Material"
        ELSE
          "Cum. Adj. Factor Material" := "Adjustment Factor Material" * SubEstRec."Cum. Adj. Factor Material";
        IF SubEstRec."Cum. Adj. Factor Subcontr." = 0 THEN
          "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
        ELSE
          "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * SubEstRec."Cum. Adj. Factor Subcontr.";
        IF SubEstRec."Cum. Adj. Factor Plant" = 0 THEN
          "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
        ELSE
          "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * SubEstRec."Cum. Adj. Factor Plant";
        IF SubEstRec."Cum. Adj. Factor Sundry" = 0 THEN  //DP00381
          "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry"
        ELSE
          "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry" * SubEstRec."Cum. Adj. Factor Sundry";

        IF SubEstRec."Cum. Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
          "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)"
        ELSE
          "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)" * SubEstRec."Cum. Adj. Factor Hours (Sales)";
      END;
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190001(IAdjType@1210190000 : Integer;IEstType@1100525001 : Integer);
    BEGIN
      IF (IEstType = 0) OR (IEstType = 2) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adj. Factor Hours (Sales)" = 0 THEN
              "Adj. Factor Hours (Sales)" := 1;
        END;
      END;
      IF (IEstType = 0) OR (IEstType = 1) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adjustment Factor Hours" = 0 THEN
              "Adjustment Factor Hours" := 1;
          2:
            IF "Adjustment Factor Material" = 0 THEN
              "Adjustment Factor Material" := 1;
          3:
            IF "Adjustment Factor Subcontr." = 0 THEN
              "Adjustment Factor Subcontr." := 1;
          4:
            IF "Adjustment Factor Plant" = 0 THEN
              "Adjustment Factor Plant" := 1;
          5:  //DP00381
            IF "Adjustment Factor Sundry" = 0 THEN
              "Adjustment Factor Sundry" := 1;
        END;
      END;
      MODIFY;

      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", Level, Chapter, Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      IF EstPartRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          UpdateMgt.ResetAdjustmentFactor(EstPartRec."Estimate No.", EstPartRec."Sub-Estimate No.",
            EstPartRec."Part Group", EstPartRec.Part, 0, TRUE, 2, IAdjType, IEstType);  //DP00555
        UNTIL EstPartRec.NEXT = 0;
      END;

      GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part);
    END;

    PROCEDURE ProcessPartQuantity@1210190002();
    BEGIN
      MODIFY;
      VALIDATE("Offer Price");

      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", Level, Chapter, Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      IF EstPartRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          EstLineRec.RESET;
          EstLineRec.SETRANGE("Estimate No.", EstPartRec."Estimate No.");
          EstLineRec.SETRANGE("Sub-Estimate No.", EstPartRec."Sub-Estimate No.");
          EstLineRec.SETRANGE("Part Group", EstPartRec."Part Group");
          EstLineRec.SETRANGE(Part, EstPartRec.Part);
          IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
            REPEAT
              EstLineRec.VALIDATE(Quantity);  //incl. CalculateTotal + UpdateRecipeTotal
              EstLineRec.MODIFY;
            UNTIL EstLineRec.NEXT = 0;
          END;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE ExcelFileExists@1100485001() : Boolean;
    BEGIN
      EXIT(FileMgt.ClientFileExists(ExcelEstimateMgt.GetPathFileName(Rec)));
    END;

    PROCEDURE CheckValidExcelTemplate@1100485003(iUserInteraction@1100485003 : Boolean) rResult : Boolean;
    BEGIN
      IF "Excel Estimate Template" = '' THEN
        EXIT(TRUE);

      IF NOT FileMgt.ClientFileExists(ExcelEstimateMgt.GetTemplPathFile(Rec)) THEN
        IF iUserInteraction THEN
          ERROR(Text007,FIELDCAPTION("Excel Estimate Template"),ExcelEstimateMgt.GetTemplPathFile(Rec))
        ELSE
          EXIT(FALSE);

      IF NOT CheckDownWards(iUserInteraction) THEN
        EXIT(FALSE);

      IF NOT CheckUpwards(iUserInteraction) THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckDownWards@1100485002(iUserInteraction@1100485000 : Boolean) : Boolean;
    VAR
      lvSubEstimatePartRec@1100485005 : Record 11072073;
    BEGIN
      lvSubEstimatePartRec.SETRANGE("Estimate No.","Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Part Group","Part Group");

      CASE Level OF
        //0: No Filters
        1: lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
        2: lvSubEstimatePartRec.SETRANGE(Paragraph,Paragraph);
        3: lvSubEstimatePartRec.SETRANGE(Part,Part);
      END;

      lvSubEstimatePartRec.SETFILTER(Level,'>%1',Level);
      lvSubEstimatePartRec.SETFILTER("Excel Estimate Template",'<>%1','');

      FILTERGROUP(10);
      lvSubEstimatePartRec.SETFILTER(Part,'<>%1',Part);
      FILTERGROUP(0);
      IF lvSubEstimatePartRec.FINDFIRST THEN
        IF iUserInteraction THEN
          ERROR(Text003,FIELDCAPTION("Excel Estimate Template"),FIELDCAPTION(Level))
        ELSE
          EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckUpwards@1100485004(iUserInteraction@1100485003 : Boolean) : Boolean;
    VAR
      lvSubEstimatePartRec@1100485002 : Record 11072073;
      lvLevel@1100485000 : Integer;
    BEGIN
      lvSubEstimatePartRec.SETRANGE("Estimate No.","Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");

      lvSubEstimatePartRec.SETRANGE(Chapter);
      lvSubEstimatePartRec.SETRANGE(Paragraph);
      lvSubEstimatePartRec.SETRANGE(Part);
      lvSubEstimatePartRec.SETFILTER("Excel Estimate Template",'<>%1','');
      lvLevel := Level;
      WHILE lvLevel > 0 DO
        BEGIN
          lvLevel -= 1;
          lvSubEstimatePartRec.SETRANGE(Level,lvLevel);
          CASE lvLevel OF
            0:
              BEGIN
                lvSubEstimatePartRec.SETFILTER(Chapter,'%1','');
                lvSubEstimatePartRec.SETFILTER(Paragraph,'%1','');
              END;
            1:
              BEGIN
                lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
                lvSubEstimatePartRec.SETFILTER(Paragraph,'%1','');
              END;
            2:
              BEGIN
                lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
                lvSubEstimatePartRec.SETRANGE(Paragraph,Paragraph);
              END;
          END;
          IF lvSubEstimatePartRec.FINDFIRST THEN
            IF iUserInteraction THEN
              ERROR(Text004,FIELDCAPTION("Excel Estimate Template"),FIELDCAPTION(Level))
            ELSE
              EXIT(FALSE);
        END;

      EXIT(TRUE);
    END;

    PROCEDURE CheckExcelTemplateFilled@1100485005();
    VAR
      EstSetup@1100485000 : Record 11012150;
      StdPartRec@1100525001 : Record 11012169;
      ExcelTemplate@1100525000 : Text[250];
    BEGIN
      IF "Excel Estimate Template" = '' THEN BEGIN
        EstSetup.GET;
        IF NOT StdPartRec.GET("Part Group", Part) THEN StdPartRec.INIT;
        IF StdPartRec."Excel Estimate Template" <> '' THEN
          ExcelTemplate := StdPartRec."Excel Estimate Template"
        ELSE
          IF Level = 0 THEN
            ExcelTemplate := EstSetup."Excel Estimate Template";
        IF CheckValidExcelTemplate(FALSE) THEN
          VALIDATE("Excel Estimate Template", ExcelTemplate)
        ELSE
          "Excel Estimate Template" := '';
      END;
    END;

    PROCEDURE DeleteExcelFile@1100485006(VAR EstPartRec@1100485001 : Record 11072073);
    VAR
      EstPartRec2@1210190000 : Record 11072073;
    BEGIN
      EstPartRec2.COPY(EstPartRec);
      WITH EstPartRec2 DO BEGIN
        IF FINDSET(FALSE, FALSE) THEN
          REPEAT
            IF ExcelFileExists THEN
              FileMgt.DeleteClientFile4PS(
                ExcelEstimateMgt.GetPathFileName(EstPartRec2), TRUE);
          UNTIL NEXT = 0;
      END;
    END;

    PROCEDURE GetPartQuantity@1210190007() PartQuan@1210190000 : Decimal;
    VAR
      lvEstPartRec@1210190001 : Record 11072073;
      lvSubEstRec@1100485000 : Record 11072074;
      CurrLevel@1210190002 : Integer;
    BEGIN
      PartQuan := 1;

      IF lvSubEstRec.GET("Estimate No.", "Sub-Estimate No.") THEN
        PartQuan := PartQuan * lvSubEstRec."Cumulative Frequency";

      IF lvEstPartRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN BEGIN

        PartQuan := PartQuan * lvEstPartRec.Quantity;
        CurrLevel := lvEstPartRec.Level;

        lvEstPartRec.RESET;
        lvEstPartRec.SETRANGE("Estimate No.", lvEstPartRec."Estimate No.");
        lvEstPartRec.SETRANGE("Sub-Estimate No.", lvEstPartRec."Sub-Estimate No.");
        lvEstPartRec.SETRANGE("Part Group", lvEstPartRec."Part Group");
        IF CurrLevel = 3 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part, lvEstPartRec.Paragraph);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
        IF CurrLevel = 2 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part, lvEstPartRec.Chapter);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
        IF CurrLevel = 1 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part);
          lvEstPartRec.SETRANGE(Level, 0);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
      END;

      EXIT(PartQuan);
    END;

    PROCEDURE ProcessSalesOfferPrices@1100485007(IFCYChanged@1100528600 : Boolean);
    VAR
      lvEstPartRec@1100485000 : Record 11072073;
      lLevel@1100485001 : Integer;
      lvPartQty@1100485003 : Decimal;
      NewOfferAmount@1210190003 : Decimal;
      OldOfferAmount@1210190001 : Decimal;
      FixedOfferAmount@1210190002 : Decimal;
      DifferenceAmount@1210190004 : Decimal;
      DifferenceFactor@1210190005 : Decimal;
      TotalOfferAmount@1210190006 : Decimal;
    BEGIN
      IF OnTempTable THEN
        EXIT;

      GLSetup.GET;  //C033941
      IF NOT IFCYChanged THEN BEGIN
        NewOfferAmount := "Offer Amount";
        OldOfferAmount := xRec."Offer Amount";
        DifferenceAmount := NewOfferAmount - OldOfferAmount;
      END ELSE BEGIN
        NewOfferAmount := "Offer Amount (FCY)";
        OldOfferAmount := xRec."Offer Amount (FCY)";
        DifferenceAmount := NewOfferAmount - OldOfferAmount;
      END;

      GetFixedOfferAmount(Rec, IFCYChanged, FixedOfferAmount);

      NewOfferAmount := NewOfferAmount - FixedOfferAmount;
      OldOfferAmount := OldOfferAmount - FixedOfferAmount;

      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      lvEstPartRec.SETRANGE("Offer fixed",FALSE);
      IF OldOfferAmount <> 0 THEN
        DifferenceFactor := NewOfferAmount / OldOfferAmount
      ELSE
        DifferenceFactor := 0;

      IF Level < 3 THEN BEGIN
        //Distribute amount downwards.
        lvEstPartRec.SETRANGE(Level, Level + 1, 3);
        CASE Level OF
          1: BEGIN
               lvEstPartRec.SETRANGE(Chapter, Part);
             END;
          2: BEGIN
               lvEstPartRec.SETRANGE(Chapter, Chapter);
               lvEstPartRec.SETRANGE(Paragraph, Part);
             END;
        END;
        IF lvEstPartRec.FINDSET THEN BEGIN
          REPEAT
            IF lvEstPartRec."Offer fixed" THEN
              ERROR(Text009, lvEstPartRec.Part);
            FixedOfferAmount := 0;
            GetFixedOfferAmount(lvEstPartRec, IFCYChanged, FixedOfferAmount);
            IF NOT IFCYChanged THEN BEGIN
              lvEstPartRec."Offer Amount" := (lvEstPartRec."Offer Amount" - FixedOfferAmount) * DifferenceFactor + FixedOfferAmount;
              lvEstPartRec."Offer Amount (FCY)" := ExchangeAmtLCYToFCY(lvEstPartRec."Offer Amount", FALSE);
            END ELSE BEGIN
              lvEstPartRec."Offer Amount (FCY)" := (lvEstPartRec."Offer Amount (FCY)" - FixedOfferAmount) * DifferenceFactor + FixedOfferAmount;
              lvEstPartRec."Offer Amount" := ExchangeAmtFCYToLCY(lvEstPartRec."Offer Amount (FCY)", FALSE);
            END;
            lvPartQty := lvEstPartRec.GetPartQuantity();
            IF lvPartQty <> 0 THEN BEGIN
              lvEstPartRec."Offer Price" := lvEstPartRec."Offer Amount" / lvPartQty;
              lvEstPartRec."Offer Price (FCY)" := lvEstPartRec."Offer Amount (FCY)" / lvPartQty;
            END;
            //C033941.sn
            lvEstPartRec."Offer Price" := ROUND(lvEstPartRec."Offer Price", GLSetup."Unit-Amount Rounding Precision");
            lvEstPartRec."Offer Price (FCY)" := ROUND(lvEstPartRec."Offer Price (FCY)", GLSetup."Unit-Amount Rounding Precision");
            lvEstPartRec."Offer Amount" := ROUND(lvEstPartRec."Offer Amount", GLSetup."Amount Rounding Precision");
            lvEstPartRec."Offer Amount (FCY)" := ROUND(lvEstPartRec."Offer Amount (FCY)", GLSetup."Amount Rounding Precision");
            //C033941.en
            lvEstPartRec.CalculateOfferPriceIndex;  //C036026
            lvEstPartRec.MODIFY;
          UNTIL lvEstPartRec.NEXT = 0;
        END;
      END;

      IF GetTotalOfferAmount(Rec, IFCYChanged, TotalOfferAmount) THEN BEGIN
        IF (NOT IFCYChanged AND ("Offer Amount" <> TotalOfferAmount)) OR
           (IFCYChanged AND ("Offer Amount (FCY)" <> TotalOfferAmount))
        THEN BEGIN
          CumQuan := GetPartQuantity;
          IF NOT IFCYChanged THEN BEGIN
            "Offer Amount" := TotalOfferAmount;
            "Offer Amount (FCY)" := ExchangeAmtLCYToFCY("Offer Amount", FALSE);
          END ELSE BEGIN
            "Offer Amount (FCY)" := TotalOfferAmount;
            "Offer Amount" := ExchangeAmtFCYToLCY("Offer Amount (FCY)", FALSE);
          END;
          IF CumQuan <> 0 THEN BEGIN
            "Offer Price" := "Offer Amount" / CumQuan;
            "Offer Price (FCY)" := "Offer Amount (FCY)" / CumQuan;
          END;
          IF NOT IFCYChanged THEN
            DifferenceAmount := "Offer Amount" - xRec."Offer Amount"
          ELSE
            DifferenceAmount := "Offer Amount (FCY)" - xRec."Offer Amount (FCY)";
          //C033941.sn
          "Offer Price" := ROUND("Offer Price", GLSetup."Unit-Amount Rounding Precision");
          "Offer Price (FCY)" := ROUND("Offer Price (FCY)", GLSetup."Unit-Amount Rounding Precision");
          "Offer Amount" := ROUND("Offer Amount", GLSetup."Amount Rounding Precision");
          "Offer Amount (FCY)" := ROUND("Offer Amount (FCY)", GLSetup."Amount Rounding Precision");
          DifferenceAmount := ROUND(DifferenceAmount, GLSetup."Amount Rounding Precision");
          //C033941.en
          CalculateOfferPriceIndex;  //C036026
        END;
      END;

      IF Level > 0 THEN BEGIN
        FOR lLevel := Level DOWNTO 1 DO BEGIN
          lvEstPartRec.RESET;
          lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          lvEstPartRec.SETRANGE("Offer fixed",FALSE);
          CASE lLevel OF
            3: BEGIN
                 lvEstPartRec.SETRANGE(Level, lLevel - 1);
                 lvEstPartRec.SETRANGE(Chapter, Chapter);
                 lvEstPartRec.SETRANGE(Paragraph, Paragraph);
               END;
            2: BEGIN
                 lvEstPartRec.SETRANGE(Level, lLevel - 1);
                 lvEstPartRec.SETRANGE(Chapter, Chapter);
                 lvEstPartRec.SETRANGE(Paragraph);
               END;
            1: BEGIN
                 lvEstPartRec.SETRANGE(Level, lLevel - 1);
                 lvEstPartRec.SETRANGE(Chapter);
               END;
          END;
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            IF lvEstPartRec."Offer fixed" THEN
              ERROR(Text008, lvEstPartRec.Part);
            IF NOT IFCYChanged THEN BEGIN
              lvEstPartRec."Offer Amount" := lvEstPartRec."Offer Amount" + DifferenceAmount;
              lvEstPartRec."Offer Amount (FCY)" := ExchangeAmtLCYToFCY(lvEstPartRec."Offer Amount", FALSE);
            END ELSE BEGIN
              lvEstPartRec."Offer Amount (FCY)" := lvEstPartRec."Offer Amount (FCY)" + DifferenceAmount;
              lvEstPartRec."Offer Amount" := ExchangeAmtFCYToLCY(lvEstPartRec."Offer Amount (FCY)", FALSE);
            END;
            lvPartQty := lvEstPartRec.GetPartQuantity();
            IF lvPartQty <> 0 THEN BEGIN
              lvEstPartRec."Offer Price" := lvEstPartRec."Offer Amount" / lvPartQty;
              lvEstPartRec."Offer Price (FCY)" := lvEstPartRec."Offer Amount (FCY)" / lvPartQty;
            END ELSE BEGIN
              lvEstPartRec."Offer Price" := lvEstPartRec."Offer Amount";
              lvEstPartRec."Offer Amount" := 0;
              lvEstPartRec."Offer Price (FCY)" := lvEstPartRec."Offer Amount (FCY)";
              lvEstPartRec."Offer Amount (FCY)" := 0;
             END;
             //C033941.sn
             lvEstPartRec."Offer Price" := ROUND(lvEstPartRec."Offer Price", GLSetup."Unit-Amount Rounding Precision");
             lvEstPartRec."Offer Price (FCY)" := ROUND(lvEstPartRec."Offer Price (FCY)", GLSetup."Unit-Amount Rounding Precision");
             lvEstPartRec."Offer Amount" := ROUND(lvEstPartRec."Offer Amount", GLSetup."Amount Rounding Precision");
             lvEstPartRec."Offer Amount (FCY)" := ROUND(lvEstPartRec."Offer Amount (FCY)", GLSetup."Amount Rounding Precision");
             //C033941.en
             lvEstPartRec.CalculateOfferPriceIndex;  //C036026
             lvEstPartRec.MODIFY;
          END;
        END;
      END;
    END;

    PROCEDURE UpdateProjElem@1100525000(lvAction@1100485000 : Integer);
    VAR
      lvEstLineRec@1100485001 : Record 11072072;
    BEGIN
      IF "Project No." = '' THEN
        "Extension Contract" := '';  //DP00260

      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      IF lvAction = 0 THEN
        lvEstLineRec.SETFILTER("Project No.", '%1|%2', '', xRec."Project No.")
      ELSE
        lvEstLineRec.SETFILTER(Element, '%1|%2', '', xRec.Element);
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvAction = 0 THEN
            lvEstLineRec.VALIDATE("Project No.", "Project No.")
          ELSE
            lvEstLineRec.VALIDATE(Element, Element);
          IF "Project No."= '' THEN
            lvEstLineRec."Extension Contract" := '';  //DP00260
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateDiscipline@1100528903();
    VAR
      EstimateLine@1100485001 : Record 11072072;
    BEGIN
      //DP02460
      EstimateLine.SETRANGE("Estimate No.", "Estimate No.");
      EstimateLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstimateLine.SETRANGE("Part Group", "Part Group");
      EstimateLine.SETRANGE(Part, Part);
      EstimateLine.SETFILTER(Discipline, '%1|%2', '', xRec.Discipline);
      IF EstimateLine.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          EstimateLine.VALIDATE(Discipline, Discipline);
          EstimateLine.MODIFY;
        UNTIL EstimateLine.NEXT = 0;
      END;
    END;

    PROCEDURE GetEstLineFilterFromEstPart@1100525001(VAR EstLine@1100525003 : Record 11072072);
    VAR
      SubEst@1100525002 : Record 11072074;
    BEGIN
      SubEst.GET("Estimate No.","Sub-Estimate No.");

      EstLine.RESET;
      EstLine.SETRANGE("Estimate No.",SubEst."Estimate No.");
      EstLine.SETRANGE("Chapter (Sub-Estimate)",SubEst.Chapter);
      IF SubEst.Level >= 1 THEN
        IF SubEst.Paragraph <> '' THEN //workaround for empty paragraph when only two levels are used (e.g.: xxx.xxx)
          EstLine.SETRANGE("Paragraph (Sub-Estimate)",SubEst.Paragraph)
        ELSE
          EstLine.SETRANGE("Sub-Estimate No.",SubEst."Sub-Estimate No.");
      IF SubEst.Level >= 2 THEN
        EstLine.SETRANGE("Sub-Estimate No.",SubEst."Sub-Estimate No.");

      IF Level >= 1 THEN
        EstLine.SETRANGE(Chapter,Chapter);
      IF Level >= 2 THEN
        EstLine.SETRANGE(Paragraph,Paragraph);
      IF Level >= 3 THEN
        EstLine.SETRANGE(Part,Part);
    END;

    PROCEDURE GetMargin@1100525003(iOfferPrice@1100525000 : Decimal;iCostPrice@1100525001 : Decimal) Result : Decimal;
    BEGIN
      IF (iOfferPrice > -1) AND (iOfferPrice < 1) THEN
        iOfferPrice := 0;  //C033941
      IF (iOfferPrice <> 0)  THEN
        Result := ROUND(100*(iOfferPrice - iCostPrice)/iOfferPrice)
      ELSE
        Result := 0;

      EXIT(Result);
    END;

    PROCEDURE GetMarkup@1100525006(iOfferPrice@1100525000 : Decimal;iCostPrice@1100525001 : Decimal) Result : Decimal;
    BEGIN
      IF (iCostPrice > -1) AND (iCostPrice < 1) THEN
        iCostPrice := 0;  //C033941
      IF (iCostPrice <> 0)  THEN
        Result := ROUND(100*(iOfferPrice - iCostPrice)/iCostPrice)
      ELSE
        Result := 0;

      EXIT(Result);
    END;

    PROCEDURE ProcessPartFields@1100525004(CalledBy@1100525001 : Integer);
    VAR
      EstPartRec@1100525000 : Record 11072073;
    BEGIN
      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.",Level,Chapter,Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      EstPartRec.SETFILTER(Level, '%1..', Level+1);
      IF EstPartRec.FINDSET THEN BEGIN
        REPEAT
          IF CalledBy = FIELDNO("Offer fixed") THEN BEGIN
            EstPartRec.VALIDATE("Offer fixed", "Offer fixed");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO("Print on Quote") THEN BEGIN
            EstPartRec.VALIDATE("Print on Quote", "Print on Quote");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO(Extension) THEN BEGIN
            EstPartRec.VALIDATE(Extension, Extension);
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO("Exclude Additional Costs") THEN BEGIN
            EstPartRec.VALIDATE("Exclude Additional Costs", "Exclude Additional Costs");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO("Exclude Surcharge (GenCost)") THEN BEGIN   //DP02080
            EstPartRec.VALIDATE("Exclude Surcharge (GenCost)", "Exclude Surcharge (GenCost)");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO(Finished) THEN BEGIN  //DP01931
            EstPartRec.VALIDATE(Finished, Finished);
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO(Discipline) THEN BEGIN  //DP02460
            EstPartRec.VALIDATE(Discipline, Discipline);
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO("Unit Price Fixed") THEN BEGIN
            EstPartRec.VALIDATE("Unit Price Fixed", "Unit Price Fixed");
            EstPartRec.MODIFY;
          END;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckOfferFixedUpwards@1100525005(iPartRec@1100525001 : Record 11072073);
    BEGIN
      WITH iPartRec DO BEGIN
        IF Level = 0 THEN EXIT;
        IF NOT "Offer fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            EstPartRec."Offer fixed" := "Offer fixed";
            EstPartRec.MODIFY;
            CheckOfferFixedUpwards(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE CheckOfferFixedUpwards1@1100525007(iPartRec@1100525001 : Record 11072073);
    VAR
      EstPartRec2@1100525000 : Record 11072073;
    BEGIN
      WITH iPartRec DO BEGIN
        IF Level = 0 THEN EXIT;
        IF "Offer fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            IF NOT EstPartRec."Offer fixed" THEN BEGIN
              EstPartRec2.RESET;
              EstPartRec2.SETRANGE("Estimate No.", "Estimate No.");
              EstPartRec2.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
              EstPartRec2.SETRANGE("Part Group", "Part Group");
              EstPartRec2.SETFILTER(Part, '<>%1', Part);
              CASE EstPartRec.Level OF
                1: EstPartRec2.SETRANGE(Chapter, EstPartRec.Chapter);
                2: EstPartRec2.SETRANGE(Paragraph, EstPartRec.Paragraph);
              END;
              EstPartRec2.SETRANGE(Level, Level);
              EstPartRec2.SETRANGE("Offer fixed", FALSE);
              IF EstPartRec2.FINDSET THEN BEGIN
                EXIT;
              END ELSE BEGIN
                EstPartRec."Offer fixed" := "Offer fixed";
                EstPartRec.MODIFY;
              END;
            END;
            CheckOfferFixedUpwards1(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE PartHasLowerLevels@1100525008() : Boolean;
    VAR
      SubEstimatePart@1100525000 : Record 11072073;
    BEGIN
      IF Level = 3 THEN
        EXIT;
      SubEstimatePart.SETRANGE("Estimate No.", "Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      SubEstimatePart.SETRANGE("Part Group", "Part Group");
      SubEstimatePart.SETRANGE(Level, Level +1);
      CASE Level +1 OF
        2:
          SubEstimatePart.SETRANGE(Chapter, Chapter);
        3:
          BEGIN
            SubEstimatePart.SETRANGE(Chapter, Chapter);
            SubEstimatePart.SETRANGE(Paragraph, Part);
          END;
      END;
      EXIT(NOT SubEstimatePart.ISEMPTY);
    END;

    PROCEDURE DeleteSubPartsLowerLevel@1210190000();
    VAR
      EstPartRec@1210190000 : Record 11072073;
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      IF Level = 3 THEN
        EXIT;

      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      IF Level > 0 THEN
        EstPartRec.SETRANGE(Chapter, Chapter);
      IF Level = 2 THEN
        EstPartRec.SETRANGE(Paragraph, Paragraph);
      EstPartRec.SETRANGE(Level, Level + 1);
      IF EstPartRec.FINDSET THEN
        REPEAT
          EstPartRec.DELETE(TRUE);
          IF EstPartTotal.GET(EstPartRec."Estimate No.",EstPartRec."Sub-Estimate No.",EstPartRec."Part Group",EstPartRec.Part) THEN
            EstPartTotal.DELETE;   //DP00381
          COMMIT;
        UNTIL EstPartRec.NEXT = 0;
    END;

    PROCEDURE GetFixedOfferAmount@1210190005(ISubEstimatePart@1210190000 : Record 11072073;IUseFCY@1100528600 : Boolean;VAR FixedOfferAmount@1210190001 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190002 : Record 11072073;
    BEGIN
      IF ISubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", ISubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", ISubEstimatePart."Sub-Estimate No.");
      CASE ISubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, ISubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, ISubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, ISubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, ISubEstimatePart.Level +1);
      //SubEstimatePart.SETRANGE("Offer fixed",TRUE);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetFixedOfferAmount(SubEstimatePart, IUseFCY, FixedOfferAmount) THEN
            IF SubEstimatePart."Offer fixed" THEN
              IF NOT IUseFCY THEN
                FixedOfferAmount += SubEstimatePart."Offer Amount"
              ELSE
                FixedOfferAmount += SubEstimatePart."Offer Amount (FCY)"
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE GetTotalOfferAmount@1210190004(ISubEstimatePart@1210190000 : Record 11072073;IUseFCY@1100528600 : Boolean;VAR TotalOfferAmount@1210190002 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190001 : Record 11072073;
    BEGIN
      IF ISubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", ISubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", ISubEstimatePart."Sub-Estimate No.");
      CASE ISubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, ISubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, ISubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, ISubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, ISubEstimatePart.Level +1);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetTotalOfferAmount(SubEstimatePart, IUseFCY, TotalOfferAmount) THEN
            IF NOT IUseFCY THEN
              TotalOfferAmount += SubEstimatePart."Offer Amount"
            ELSE
              TotalOfferAmount += SubEstimatePart."Offer Amount (FCY)";
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE CopyPartText@1210190021(OrigPart@1100528900 : Code[20];DestPart@1100528901 : Code[20]);
    VAR
      TextRec@1100485000 : Record 11020595;
      TextRec2@1100485001 : Record 11020595;
      CurrLino@1100525001 : Integer;
    BEGIN
      IF OrigPart = '' THEN OrigPart := Part;      //DP00686
      IF DestPart = '' THEN DestPart := OrigPart;  //DP00686

      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETFILTER(Group, '%1', '');
      TextRec.SETFILTER("No.", '%1', '');
      TextRec.SETRANGE("Estimate No.", "Estimate No.");
      TextRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, DestPart);  //DP00686
      TextRec.SETRANGE("Estimate Line No.", 0);
      TextRec.SETRANGE("Source Table", TextRec."Source Table"::Part);
      TextRec.DELETEALL;

      TextRec.SETRANGE("Source Table");
      IF TextRec.FINDLAST THEN
        CurrLino := TextRec."Line No."
      ELSE
        CurrLino := 0;

      TextRec.RESET;
      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, OrigPart);  //DP00686
      TextRec.SETRANGE("Part Line No.", 0);  //skip comment lines: see CopyPartLines
      TextRec.SETFILTER("Estimate No.", '%1', '');
      TextRec.SETRANGE("Source Table", TextRec."Source Table"::" ");
      IF TextRec.FINDSET THEN BEGIN
        REPEAT
          TextRec2.COPY(TextRec);
          TextRec2."Source Table" := TextRec2."Source Table"::Part;
          TextRec2."Created by" := USERID;
          TextRec2."Time Created" := TIME;

          TextRec2."Estimate No." := "Estimate No.";
          TextRec2."Sub-Estimate No." := "Sub-Estimate No.";
          TextRec2.Part := DestPart;  //DP00686
          CurrLino := CurrLino + 10000;
          TextRec2."Line No." := CurrLino;
          TextRec2.INSERT;
        UNTIL TextRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateProjPlanActCode@1210190022();
    VAR
      lvEstLineRec@1210190000 : Record 11072072;
    BEGIN
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER("Project Planning Activity Code", '%1|%2', '', xRec."Project Planning Activity Code");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Project Planning Activity Code", "Project Planning Activity Code");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateExtensionContract@1100525013();
    VAR
      lvEstLineRec@1210190000 : Record 11072072;
    BEGIN
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER("Extension Contract", '%1|%2', '', xRec."Extension Contract");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvEstLineRec."Project No." <> '' THEN
            lvEstLineRec.VALIDATE("Extension Contract", "Extension Contract");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE EditDocuments@1100528702(ContactNo@1210190003 : Code[20];ContactPersonNo@1210190004 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      DocumentTemplate@1210190001 : Record 11012401;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      DocumentMailing.EditDocuments(
        STRSUBSTNO('%1', DocumentTemplate.Type::Estimate), DocumentLinkRIDs,
        '', ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE InitRecord@1210190006();
    BEGIN
      // 34595.n
      IF SubEstRec.GET("Estimate No.","Sub-Estimate No.") THEN BEGIN
        "Project No." := SubEstRec."Project No.";
        Element := SubEstRec.Element;
        GetDisciplineByElement;  //DP02460
        IF Discipline = '' THEN
          Discipline := SubEstRec.Discipline;  //DP02460
        IF "Project No." <> '' THEN
          "Extension Contract" := SubEstRec."Extension Contract";  //DP00260
        "Project Planning Activity Code" := SubEstRec."Project Planning Activity Code";
        "Part Group" := SubEstRec."Part Group";
      END;
      InitSurcharge;  //DP00381
    END;

    PROCEDURE GetDataCaption@1100528000() : Text[250];
    BEGIN
      EXIT(STRSUBSTNO('%1 - %2 - %3 - %4 - %5', "Estimate No.", "Sub-Estimate No.", "Part Group", Part, Description + ' ' + "Description 2"));
    END;

    PROCEDURE GetPreviousPart@1100528001(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      SETRANGE("Estimate No.", "Estimate No.");  //DP00909
      IF Level = 0 THEN
        EXIT(NEXT(-1) <> 0);  //DP00909

      CASE JumpLevel OF
        0 : EXIT(NEXT(-1) <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDFIRST;
              SETRANGE(Paragraph);
              IF NEXT(-1) = 0 THEN BEGIN
                SETRANGE(Chapter);
                IF NEXT(-1) = 0 THEN
                  EXIT(TRUE);
                SETRANGE(Chapter, Chapter);
              END;

              SETRANGE(Paragraph, Paragraph);
              EXIT(FINDFIRST);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDFIRST;
              SETRANGE(Chapter);
              IF NEXT(-1) = 0 THEN
                EXIT(TRUE)
              ELSE BEGIN
                SETRANGE(Chapter, Chapter);
                EXIT(FINDFIRST);
              END;
            END;
       END;
    END;

    PROCEDURE GetNextPart@1100528002(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      SETRANGE("Estimate No.", "Estimate No.");  //DP00909
      IF Level = 0 THEN
        EXIT(NEXT <> 0);

      CASE JumpLevel OF
        0 : EXIT(NEXT <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDLAST;
              SETRANGE(Chapter);
              SETRANGE(Paragraph);
              IF NEXT = 0 THEN;
              EXIT(TRUE);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDLAST;
              SETRANGE(Chapter);
              IF NEXT = 0 THEN;
              EXIT(TRUE)
            END;
      END;
    END;

    PROCEDURE UpdateSurcharge@1100528900(CostType@1100485000 : Integer);
    VAR
      EstLineRec@1100485001 : Record 11072072;
      RcpLineRec@1100528900 : Record 11072075;
    BEGIN
      //DP00381
      EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstLineRec.SETRANGE("Part Group", "Part Group");
      EstLineRec.SETRANGE(Part, Part);
      EstLineRec.SETRANGE("Surcharge Type", EstLineRec."Surcharge Type"::" ");
      EstLineRec.SETFILTER(Recipe, '%1', '');
      IF CostType = 0 THEN
        EstLineRec.SETFILTER("Surcharge % Labor", '%1|%2', 0, xRec."Surcharge % Labor");
      IF CostType = 1 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Material");
      IF CostType = 2 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Subcontracting");
      IF CostType = 3 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Plant");
      IF CostType = 4 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Sundry");
      IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CostType = 0 THEN
            EstLineRec.VALIDATE("Surcharge % Labor", "Surcharge % Labor");
          IF CostType = 1 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Material THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Material");
          IF CostType = 2 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Subcontracting THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Subcontracting");
          IF CostType = 3 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Plant THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Plant");
          IF CostType = 4 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Sundry THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Sundry");
          EstLineRec.MODIFY;
        UNTIL EstLineRec.NEXT = 0;
      END;

      RcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      RcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      RcpLineRec.SETRANGE("Part Group", "Part Group");
      RcpLineRec.SETRANGE(Part, Part);
      RcpLineRec.SETRANGE("Surcharge Type", RcpLineRec."Surcharge Type"::" ");
      IF CostType = 0 THEN
        RcpLineRec.SETFILTER("Surcharge % Labor", '%1|%2', 0, xRec."Surcharge % Labor");
      IF CostType = 1 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Material");
      IF CostType = 2 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Subcontracting");
      IF CostType = 3 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Plant");
      IF CostType = 4 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Sundry");
      IF RcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CostType = 0 THEN
            RcpLineRec.VALIDATE("Surcharge % Labor", "Surcharge % Labor");
          IF CostType = 1 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Material THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Material");
          IF CostType = 2 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Subcontracting THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Subcontracting");
          IF CostType = 3 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Plant THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Plant");
          IF CostType = 4 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Sundry THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Sundry");
          RcpLineRec.MODIFY;
        UNTIL RcpLineRec.NEXT = 0;
      END;

      //C038463.sn
      EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstLineRec.SETRANGE("Part Group", "Part Group");
      EstLineRec.SETRANGE(Part, Part);
      EstLineRec.SETRANGE("Surcharge Type", EstLineRec."Surcharge Type"::" ");
      EstLineRec.SETFILTER(Recipe, '<>%1', '');
      IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          //calculate recipe totals: UpdateEstimateLine skipped on validate Surcharge % for Recipe Line
          EstLineRec.CalculateTotals;
          EstLineRec.MODIFY;
        UNTIL EstLineRec.NEXT = 0;
      END;
      //C038463.en
    END;

    PROCEDURE InitSurcharge@1100528911();
    BEGIN
      //DP00381
      IF SubEstRec.GET("Estimate No.", "Sub-Estimate No.") THEN BEGIN
        "Surcharge % Labor" := SubEstRec."Surcharge % Labor";
        "Surcharge % Material" := SubEstRec."Surcharge % Material";
        "Surcharge % Subcontracting" := SubEstRec."Surcharge % Subcontracting";
        "Surcharge % Plant" := SubEstRec."Surcharge % Plant";
        "Surcharge % Sundry" := SubEstRec."Surcharge % Sundry";
      END;
    END;

    PROCEDURE GetTotals@1100528901(VAR CostHours@1100528903 : Decimal;VAR CostLabor@1100528904 : Decimal;VAR CostMat@1100528905 : Decimal;VAR CostSubc@1100528907 : Decimal;VAR CostPlant@1100528908 : Decimal;VAR CostSundry@1100528909 : Decimal;VAR SalesHours@1100528924 : Decimal;VAR SalesLabor@1100528923 : Decimal;VAR SalesMat@1100528922 : Decimal;VAR SalesSubc@1100528921 : Decimal;VAR SalesPlant@1100528920 : Decimal;VAR SalesSundry@1100528919 : Decimal);
    VAR
      CurrLevel@1100528900 : Integer;
      sp1@1100528901 : Integer;
      sp2@1100528902 : Integer;
    BEGIN
      //DP00381
      FormatMgt.CheckFormat(1,sp1,sp2);  //C063045

      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

      CASE CurrLevel OF
        0:BEGIN
            CALCFIELDS("Hours Total", "Labor Total", "Material Total",
              "Subcontracting Total", "Plant Total", "Sundry Total");
            CostHours := "Hours Total";
            CostLabor := "Labor Total";
            CostMat := "Material Total";
            CostSubc := "Subcontracting Total";
            CostPlant := "Plant Total";
            CostSundry := "Sundry Total";

            CALCFIELDS(
              "Hours Sales Total", "Labor Sales Total", "Material Sales Total",
              "Subcontracting Sales Total", "Plant Sales Total", "Sundry Sales Total");
            SalesHours := "Hours Sales Total";
            SalesLabor := "Labor Sales Total";
            SalesMat := "Material Sales Total";
            SalesSubc := "Subcontracting Sales Total";
            SalesPlant := "Plant Sales Total";
            SalesSundry := "Sundry Sales Total";
          END;
        1:BEGIN
            CALCFIELDS("Hours Chapter", "Labor Chapter", "Material Chapter",
              "Subcontracting Chapter", "Plant Chapter", "Sundry Chapter");
            CostHours := "Hours Chapter";
            CostLabor := "Labor Chapter";
            CostMat := "Material Chapter";
            CostSubc := "Subcontracting Chapter";
            CostPlant := "Plant Chapter";
            CostSundry := "Sundry Chapter";

            CALCFIELDS(
              "Hours Sales Chapter", "Labor Sales Chapter", "Material Sales Chapter",
              "Subcontracting Sales Chapter", "Plant Sales Chapter", "Sundry Sales Chapter");
            SalesHours := "Hours Sales Chapter";
            SalesLabor := "Labor Sales Chapter";
            SalesMat := "Material Sales Chapter";
            SalesSubc := "Subcontracting Sales Chapter";
            SalesPlant := "Plant Sales Chapter";
            SalesSundry := "Sundry Sales Chapter";
          END;
        2:BEGIN
            CALCFIELDS("Hours Paragraph", "Labor Paragraph", "Material Paragraph",
              "Subcontracting Paragraph", "Plant Paragraph", "Sundry Paragraph");
            CostHours := "Hours Paragraph";
            CostLabor := "Labor Paragraph";
            CostMat := "Material Paragraph";
            CostSubc := "Subcontracting Paragraph";
            CostPlant := "Plant Paragraph";
            CostSundry := "Sundry Paragraph";

            CALCFIELDS(
              "Hours Sales Paragraph", "Labor Sales Paragraph", "Material Sales Paragraph",
              "Subcontracting Sales Paragraph", "Plant Sales Paragraph", "Sundry Sales Paragraph");
            SalesHours := "Hours Sales Paragraph";
            SalesLabor := "Labor Sales Paragraph";
            SalesMat := "Material Sales Paragraph";
            SalesSubc := "Subcontracting Sales Paragraph";
            SalesPlant := "Plant Sales Paragraph";
            SalesSundry := "Sundry Sales Paragraph";
          END;
        3:BEGIN
            CALCFIELDS("Hours Part", "Labor Part", "Material Part",
              "Subcontracting Part", "Plant Part", "Sundry Part");
            CostHours := "Hours Part";
            CostLabor := "Labor Part";
            CostMat := "Material Part";
            CostSubc := "Subcontracting Part";
            CostPlant := "Plant Part";
            CostSundry := "Sundry Part";

            CALCFIELDS("Hours Sales Part", "Labor Sales Part", "Material Sales Part",
              "Subcontracting Sales Part", "Plant Sales Part", "Sundry Sales Part");
            SalesHours := "Hours Sales Part";
            SalesLabor := "Labor Sales Part";
            SalesMat := "Material Sales Part";
            SalesSubc := "Subcontracting Sales Part";
            SalesPlant := "Plant Sales Part";
            SalesSundry := "Sundry Sales Part";
          END;
      END;
    END;

    PROCEDURE GetCumTotals@1100525011(VAR CostHours@1100528903 : Decimal;VAR CostLabor@1100528904 : Decimal;VAR CostMat@1100528905 : Decimal;VAR CostSubc@1100528907 : Decimal;VAR CostPlant@1100528908 : Decimal;VAR CostSundry@1100528909 : Decimal;VAR SalesHours@1100528924 : Decimal;VAR SalesLabor@1100528923 : Decimal;VAR SalesMat@1100528922 : Decimal;VAR SalesSubc@1100528921 : Decimal;VAR SalesPlant@1100528920 : Decimal;VAR SalesSundry@1100528919 : Decimal);
    VAR
      CurrLevel@1100528900 : Integer;
      sp1@1100528901 : Integer;
      sp2@1100528902 : Integer;
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      //DP00381
      FormatMgt.CheckFormat(1,sp1,sp2);  //C063045

      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

      IF NOT EstPartTotal.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN
        EstPartTotal.INIT;

      WITH EstPartTotal DO BEGIN
        CASE CurrLevel OF
          0:BEGIN
              CALCFIELDS("Cum. Hours Total", "Cum. Labor Total", "Cum. Material Total",
                "Cum. Subcontracting Total", "Cum. Plant Total", "Cum. Sundry Total");
              CostHours := "Cum. Hours Total";
              CostLabor := "Cum. Labor Total";
              CostMat := "Cum. Material Total";
              CostSubc := "Cum. Subcontracting Total";
              CostPlant := "Cum. Plant Total";
              CostSundry := "Cum. Sundry Total";

              CALCFIELDS("Cum. Hours Total (Sales)", "Cum. Labor Total (Sales)", "Cum. Mat. Total (Sales)",
                "Cum. Subc. Total (Sales)", "Cum. Plant Total (Sales)", "Cum. Sundry Total (Sales)");
              SalesHours := "Cum. Hours Total (Sales)";
              SalesLabor := "Cum. Labor Total (Sales)";
              SalesMat := "Cum. Mat. Total (Sales)";
              SalesSubc := "Cum. Subc. Total (Sales)";
              SalesPlant := "Cum. Plant Total (Sales)";
              SalesSundry := "Cum. Sundry Total (Sales)";
            END;
          1:BEGIN
              CALCFIELDS("Cum. Hours Chapter", "Cum. Labor Chapter", "Cum. Material Chapter",
                "Cum. Subcontracting Chapter", "Cum. Plant Chapter", "Cum. Sundry Chapter");
              CostHours := "Cum. Hours Chapter";
              CostLabor := "Cum. Labor Chapter";
              CostMat := "Cum. Material Chapter";
              CostSubc := "Cum. Subcontracting Chapter";
              CostPlant := "Cum. Plant Chapter";
              CostSundry := "Cum. Sundry Chapter";

              CALCFIELDS("Cum. Hours Chapter (Sales)", "Cum. Labor Chapter (Sales)", "Cum. Mat. Chapter (Sales)",
                "Cum. Subc. Chapter (Sales)", "Cum. Plant Chapter (Sales)", "Cum. Sundry Chapter (Sales)");
              SalesHours := "Cum. Hours Chapter (Sales)";
              SalesLabor := "Cum. Labor Chapter (Sales)";
              SalesMat := "Cum. Mat. Chapter (Sales)";
              SalesSubc := "Cum. Subc. Chapter (Sales)";
              SalesPlant := "Cum. Plant Chapter (Sales)";
              SalesSundry := "Cum. Sundry Chapter (Sales)";
            END;
          2:BEGIN
              CALCFIELDS("Cum. Hours Paragraph", "Cum. Labor Paragraph", "Cum. Material Paragraph",
                "Cum. Subcontracting Paragraph", "Cum. Plant Paragraph", "Cum. Sundry Paragraph");
              CostHours := "Cum. Hours Paragraph";
              CostLabor := "Cum. Labor Paragraph";
              CostMat := "Cum. Material Paragraph";
              CostSubc := "Cum. Subcontracting Paragraph";
              CostPlant := "Cum. Plant Paragraph";
              CostSundry := "Cum. Sundry Paragraph";

              CALCFIELDS("Cum. Hours Paragraph (Sales)", "Cum. Labor Paragraph (Sales)", "Cum. Mat. Paragraph (Sales)",
                "Cum. Subc. Paragraph (Sales)", "Cum. Plant Paragraph (Sales)", "Cum. Sundry Paragraph (Sales)");
              SalesHours := "Cum. Hours Paragraph (Sales)";
              SalesLabor := "Cum. Labor Paragraph (Sales)";
              SalesMat := "Cum. Mat. Paragraph (Sales)";
              SalesSubc := "Cum. Subc. Paragraph (Sales)";
              SalesPlant := "Cum. Plant Paragraph (Sales)";
              SalesSundry := "Cum. Sundry Paragraph (Sales)";
            END;
          3:BEGIN
              CALCFIELDS("Cum. Hours Part", "Cum. Labor Part", "Cum. Material Part",
                "Cum. Subcontracting Part", "Cum. Plant Part", "Cum. Sundry Part");
              CostHours := "Cum. Hours Part";
              CostLabor := "Cum. Labor Part";
              CostMat := "Cum. Material Part";
              CostSubc := "Cum. Subcontracting Part";
              CostPlant := "Cum. Plant Part";
              CostSundry := "Cum. Sundry Part";

              CALCFIELDS("Cum. Hours Part (Sales)", "Cum. Labor Part (Sales)", "Cum. Mat. Part (Sales)",
                "Cum. Subc. Part (Sales)", "Cum. Plant Part (Sales)", "Cum. Sundry Part (Sales)");
              SalesHours := "Cum. Hours Part (Sales)";
              SalesLabor := "Cum. Labor Part (Sales)";
              SalesMat := "Cum. Mat. Part (Sales)";
              SalesSubc := "Cum. Subc. Part (Sales)";
              SalesPlant := "Cum. Plant Part (Sales)";
              SalesSundry := "Cum. Sundry Part (Sales)";
            END;
        END;
      END;
    END;

    PROCEDURE GetTotalsProductDiscount@1100528902(VAR ProductDiscount@1100528903 : Decimal;VAR CumProductDiscount@1100528904 : Decimal);
    VAR
      CurrLevel@1100528900 : Integer;
      sp1@1100528901 : Integer;
      sp2@1100528902 : Integer;
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      //DP01727
      FormatMgt.CheckFormat(1,sp1,sp2);  //C063045

      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

      IF NOT EstPartTotal.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN
        EstPartTotal.INIT;

      CASE CurrLevel OF
        0:BEGIN
            EstPartTotal.CALCFIELDS("Product Discount Total", "Cum. Product Discount Total");
            ProductDiscount := EstPartTotal."Product Discount Total";
            CumProductDiscount := EstPartTotal."Cum. Product Discount Total";
          END;
        1:BEGIN
            EstPartTotal.CALCFIELDS("Product Discount Chapter", "Cum. Product Discount Chapter");
            ProductDiscount := EstPartTotal."Product Discount Chapter";
            CumProductDiscount := EstPartTotal."Cum. Product Discount Chapter";
          END;
        2:BEGIN
            EstPartTotal.CALCFIELDS("Product Discount Paragraph", "Cum. Product Discount Paragr.");
            ProductDiscount := EstPartTotal."Product Discount Paragraph";
            CumProductDiscount := EstPartTotal."Cum. Product Discount Paragr.";
          END;
        3:BEGIN
            EstPartTotal.CALCFIELDS("Product Discount Part", "Cum. Product Discount Part");
            ProductDiscount := EstPartTotal."Product Discount Part";
            CumProductDiscount := EstPartTotal."Cum. Product Discount Part";
          END;
      END;
    END;

    PROCEDURE UpdatePartTotal@1100525012();
    VAR
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      //DP00381
      IF NOT EstPartTotal.GET("Estimate No.","Sub-Estimate No.","Part Group",Part) THEN BEGIN
        EstPartTotal.INIT;
        EstPartTotal."Estimate No." := "Estimate No.";
        EstPartTotal."Sub-Estimate No." := "Sub-Estimate No.";
        EstPartTotal."Part Group" := "Part Group";
        EstPartTotal.Part := Part;
        EstPartTotal.INSERT;
      END;
      EstPartTotal.Chapter := Chapter;
      EstPartTotal.Paragraph := Paragraph;
      EstPartTotal.MODIFY;
    END;

    PROCEDURE CopyPartQuantitySheet@1100409000(OrigPart@1100528900 : Code[20];DestPart@1100528901 : Code[20]);
    VAR
      BasePartQuantitySheet@1100409000 : Record 11020459;
      BasePartQuantityRow@1100409001 : Record 11020460;
      EstimateQuantitySheet@1100409003 : Record 11020462;
      EstimateQuantityRow@1100409002 : Record 11020464;
      EstSetup@1100409006 : Record 11012150;
      NoSeriesMgt@1100409005 : Codeunit 396;
      NewSheet@1100409004 : Code[20];
    BEGIN
      //DP00686
      IF OrigPart = '' THEN OrigPart := Part;      //DP00686
      IF DestPart = '' THEN DestPart := OrigPart;  //DP00686

      //copy relations based on option CopyPartLines (function table Estimate Lines)
      BasePartQuantitySheet.SETRANGE("Part Group", "Part Group");
      BasePartQuantitySheet.SETRANGE(Part, OrigPart);  //DP00686
      IF BasePartQuantitySheet.FINDSET THEN BEGIN
        REPEAT
          EstSetup.GET;
          NewSheet := NoSeriesMgt.GetNextNo(EstSetup."Quantity Sheet Nos.",0D,TRUE);

          EstimateQuantitySheet.INIT;
          EstimateQuantitySheet."Estimate No." := "Estimate No.";
          EstimateQuantitySheet."Sub-Estimate No." := "Sub-Estimate No.";
          EstimateQuantitySheet."Part Group" := "Part Group";
          EstimateQuantitySheet.Part := DestPart;  //DP00686
          EstimateQuantitySheet.Code := NewSheet;
          EstimateQuantitySheet."Source Type" := EstimateQuantitySheet."Source Type"::Part;
          EstimateQuantitySheet."Source Group" := BasePartQuantitySheet."Part Group";
          EstimateQuantitySheet."Source Code" := BasePartQuantitySheet.Part;
          EstimateQuantitySheet."Source Sheet" := BasePartQuantitySheet.Code;
          EstimateQuantitySheet.Description := BasePartQuantitySheet.Description;
          EstimateQuantitySheet.INSERT;

          BasePartQuantityRow.SETRANGE("Part Group", BasePartQuantitySheet."Part Group");
          BasePartQuantityRow.SETRANGE(Part, BasePartQuantitySheet.Part);
          BasePartQuantityRow.SETRANGE("Quantity Sheet", BasePartQuantitySheet.Code);
          IF BasePartQuantityRow.FINDSET THEN BEGIN
            REPEAT
              EstimateQuantityRow.INIT;
              EstimateQuantityRow."Estimate No." := "Estimate No.";
              EstimateQuantityRow."Quantity Sheet" := NewSheet;
              EstimateQuantityRow."Row No." := BasePartQuantityRow."Row No.";
              EstimateQuantityRow.Total := BasePartQuantityRow.Total;
              EstimateQuantityRow.Quantity := BasePartQuantityRow.Quantity;
              EstimateQuantityRow.Length := BasePartQuantityRow.Length;
              EstimateQuantityRow.Width := BasePartQuantityRow.Width;
              EstimateQuantityRow.Height := BasePartQuantityRow.Height;
              EstimateQuantityRow.Result := BasePartQuantityRow.Result;
              EstimateQuantityRow.Description := BasePartQuantityRow.Description;
              EstimateQuantityRow.Formula := BasePartQuantityRow.Formula;
              EstimateQuantityRow.Totaling := BasePartQuantityRow.Totaling;
              EstimateQuantityRow."Total Length" := BasePartQuantityRow."Total Length";
              EstimateQuantityRow."Total Width" := BasePartQuantityRow."Total Width";
              EstimateQuantityRow."Total Height" := BasePartQuantityRow."Total Height";
              EstimateQuantityRow.Feature := BasePartQuantityRow.Feature;
              EstimateQuantityRow."Related to Column" := BasePartQuantityRow."Related to Column";
              EstimateQuantityRow."Related to Part Quantity" := BasePartQuantityRow."Related to Part Quantity";
              EstimateQuantityRow.INSERT;
            UNTIL BasePartQuantityRow.NEXT = 0;
          END;
        UNTIL BasePartQuantitySheet.NEXT = 0;
      END;
    END;

    PROCEDURE DeleteQuantityRelation@1100409001(lvEst@1100409000 : Code[20];lvSubEst@1100409001 : Code[20];lvPartGrp@1100409002 : Code[20];lvPart@1100409003 : Code[20]);
    VAR
      QuanHeader@1100409006 : Record 11020462;
      QuanRelation@1100409005 : Record 11020463;
      QuanLine@1100409004 : Record 11020464;
    BEGIN
      //DP00686
      QuanHeader.SETRANGE("Estimate No.", "Estimate No.");
      QuanHeader.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      QuanHeader.SETRANGE("Part Group", "Part Group");
      QuanHeader.SETRANGE(Part, Part);
      IF QuanHeader.FINDSET THEN BEGIN
        REPEAT
          QuanLine.SETRANGE("Estimate No.", QuanHeader."Estimate No.");
          QuanLine.SETRANGE("Quantity Sheet", QuanHeader.Code);
          QuanLine.DELETEALL;
        UNTIL QuanHeader.NEXT = 0;
        QuanHeader.DELETEALL;
      END;

      QuanRelation.SETRANGE("Estimate No.", "Estimate No.");
      QuanRelation.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      QuanRelation.SETRANGE("Part Group", "Part Group");
      QuanRelation.SETRANGE(Part, Part);
      QuanRelation.DELETEALL;
    END;

    PROCEDURE UpdateNormGroup@1100409002();
    VAR
      lvEstLineRec@1100485001 : Record 11072072;
      lvRcpLineRec@1100409000 : Record 11072075;
    BEGIN
      //DP00686
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER(Recipe, '%1', '');
      lvEstLineRec.SETFILTER("Norm Group", '%1|%2', '', xRec."Norm Group");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Norm Group", "Norm Group");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;

      lvRcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvRcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvRcpLineRec.SETRANGE("Part Group", "Part Group");
      lvRcpLineRec.SETRANGE(Part, Part);
      lvRcpLineRec.SETFILTER("Norm Group", '%1|%2', '', xRec."Norm Group");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvRcpLineRec.VALIDATE("Norm Group", "Norm Group");
          lvRcpLineRec.MODIFY;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateNormGroupSales@1100525009();
    VAR
      lvEstLineRec@1100485001 : Record 11072072;
      lvRcpLineRec@1100409000 : Record 11072075;
    BEGIN
      //DP00686
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER(Recipe, '%1', '');
      lvEstLineRec.SETFILTER("Norm Group (Sales)", '%1|%2', '', xRec."Norm Group (Sales)");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Norm Group (Sales)", "Norm Group (Sales)");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;

      lvRcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvRcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvRcpLineRec.SETRANGE("Part Group", "Part Group");
      lvRcpLineRec.SETRANGE(Part, Part);
      lvRcpLineRec.SETFILTER("Norm Group (Sales)", '%1|%2', '', xRec."Norm Group (Sales)");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvRcpLineRec.VALIDATE("Norm Group (Sales)", "Norm Group (Sales)");
          lvRcpLineRec.MODIFY;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetCurrencyFactor@1100528601() : Decimal;
    VAR
      CurrencyExchangeRate@1100528601 : Record 330;
    BEGIN
      CALCFIELDS("Currency Code");
      EXIT(CurrencyExchangeRate.ExchangeRate(2, "Estimate No.", EstRec."Reference Date (Rate)", "Currency Code", TRUE));
    END;

    PROCEDURE ExchangeAmtLCYToFCY@1100528602(IAmount@1100528601 : Decimal;IUsePriceRounding@1100528605 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528600 : Record 330;
      Currency@1100528604 : Record 4;
      Amount@1100528603 : Decimal;
      CurrencyCode@1100528606 : Code[10];
    BEGIN
      CALCFIELDS("Currency Code");
      IF "Currency Code" = '' THEN
        EXIT(IAmount);
      Amount := CurrencyExchangeRate.ExchangeAmtLCYToFCY(
        2, "Estimate No.", EstRec."Reference Date (Rate)", "Currency Code", IAmount, GetCurrencyFactor, TRUE);
      IF NOT Currency.GET(CurrencyCode) THEN
        Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    PROCEDURE ExchangeAmtFCYToLCY@1100528600(IAmount@1100528601 : Decimal;IUsePriceRounding@1100528605 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528600 : Record 330;
      Currency@1100528604 : Record 4;
      Amount@1100528603 : Decimal;
    BEGIN
      CALCFIELDS("Currency Code");
      IF "Currency Code" = '' THEN
        EXIT(IAmount);
      Amount := CurrencyExchangeRate.ExchangeAmtFCYToLCY(
        2, "Estimate No.", EstRec."Reference Date (Rate)", "Currency Code", IAmount, GetCurrencyFactor, TRUE);
      Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    PROCEDURE CheckDateTimeOfferPrice@1100529400(VAR DateTimeWarningFCP@1100528900 : Boolean;VAR DateTimeWarningFSP@1100528901 : Boolean);
    VAR
      Estimate@1100525004 : Record 11012151;
      SubEstimate@1100525001 : Record 11072074;
      EstimatePart@1100525005 : Record 11072073;
      EstimateLine@1100528902 : Record 11072072;
      SummarySheet@1100525000 : Record 11012172;
      SummaryCost@1100525002 : Code[20];
      SummarySales@1100525003 : Code[20];
      DateTimeFCP@1100528903 : DateTime;
      DateTimeFSP@1100528904 : DateTime;
      UserSetup@1100528905 : Record 91;
    BEGIN
      //DP01315
      DateTimeWarningFCP := FALSE;
      DateTimeWarningFSP := FALSE;
      //C057346.sn
      IF NOT UserSetup.GET(USERID) THEN EXIT;
      IF UserSetup."Activate Full Cost Price" = FALSE THEN EXIT;
      //C057346.en

      IF NOT EstimatePart.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN EXIT;
      IF NOT SubEstimate.GET("Estimate No.", "Sub-Estimate No.") THEN EXIT;
      IF NOT Estimate.GET("Estimate No.") THEN EXIT;

      //C057346.sn
      IF (EstimatePart."Last Date Recalculated" > EstimatePart."Last Date Modified (FCP)") OR
         ((EstimatePart."Last Date Recalculated" = EstimatePart."Last Date Modified (FCP)") AND
          (EstimatePart."Last Time Recalculated" > EstimatePart."Last Time Modified (FCP)")) THEN
        DateTimeWarningFCP := TRUE;
      IF (EstimatePart."Last Date Recalculated" > EstimatePart."Last Date Modified (FSP)") OR
         ((EstimatePart."Last Date Recalculated" = EstimatePart."Last Date Modified (FSP)") AND
          (EstimatePart."Last Time Recalculated" > EstimatePart."Last Time Modified (FSP)")) THEN
        DateTimeWarningFSP := TRUE;
      //C057346.en

      SummaryCost := Estimate."Summary (Cost)";
      SummarySales := Estimate."Summary (Sales)";
      IF SubEstimate."Summary (Cost)" <> '' THEN
        SummaryCost := SubEstimate."Summary (Cost)";
      IF SubEstimate."Summary (Sales)" <> '' THEN
        SummarySales := SubEstimate."Summary (Sales)";
      IF SummarySheet.GET("Estimate No.", SummaryCost) THEN BEGIN  //C055219
        IF (SummarySheet."Last Date Modified" > EstimatePart."Last Date Modified (FCP)") OR
           ((SummarySheet."Last Date Modified" = EstimatePart."Last Date Modified (FCP)") AND
            (SummarySheet."Last Time Modified" > EstimatePart."Last Time Modified (FCP)")) THEN
          DateTimeWarningFCP := TRUE;
      END;
      IF SummarySheet.GET("Estimate No.", SummarySales) THEN BEGIN  //C055219
        IF (SummarySheet."Last Date Modified" > EstimatePart."Last Date Modified (FSP)") OR
           ((SummarySheet."Last Date Modified" = EstimatePart."Last Date Modified (FSP)") AND
            (SummarySheet."Last Time Modified" > EstimatePart."Last Time Modified (FSP)")) THEN
          DateTimeWarningFSP := TRUE;
      END;
      //C057346.sn
      IF DateTimeWarningFCP = FALSE THEN BEGIN
        DateTimeFCP := CREATEDATETIME(EstimatePart."Last Date Modified (FCP)", EstimatePart."Last Time Modified (FCP)");
        EstimateLine.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstimateLine.SETRANGE("Part Group", "Part Group");
        EstimateLine.SETRANGE(Part, Part);
        EstimateLine.SETFILTER("Last Modified on", '>%1', DateTimeFCP);
        IF NOT EstimateLine.ISEMPTY THEN
          DateTimeWarningFCP := TRUE;
      END;
      IF DateTimeWarningFSP = FALSE THEN BEGIN
        DateTimeFSP := CREATEDATETIME(EstimatePart."Last Date Modified (FSP)", EstimatePart."Last Time Modified (FSP)");
        EstimateLine.SETRANGE("Estimate No.", "Estimate No.");
        EstimateLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstimateLine.SETRANGE("Part Group", "Part Group");
        EstimateLine.SETRANGE(Part, Part);
        EstimateLine.SETFILTER("Last Modified on", '>%1', DateTimeFSP);
        IF NOT EstimateLine.ISEMPTY THEN
          DateTimeWarningFSP := TRUE;
      END;
      //C057346.en
    END;

    PROCEDURE CalculateOfferPriceIndex@1100525002();
    BEGIN
      //C036026
      IF "Quantity per Unit" <> 0 THEN
        "Offer Price Index" := "Offer Amount"/"Quantity per Unit"
      ELSE
        "Offer Price Index" := 0;
    END;

    PROCEDURE GetStyleExpressionPartAmount@1100529900() : Boolean;
    BEGIN
      //C036784
      CALCFIELDS("Estimated Part");
      EXIT("Estimated Part" <> 0);
    END;

    PROCEDURE CopyOfferPriceIndex@111284600(iEstimateNo@111284600 : Code[20]);
    BEGIN
      EstPartRec.RESET;
      EstPartRec.SETRANGE("Estimate No.", iEstimateNo);
      EstPartRec.SETRANGE("Unit Price Fixed", FALSE);
      IF EstPartRec.FINDSET THEN
        REPEAT
          EstPartRec.VALIDATE("Unit Price", ROUND(EstPartRec."Offer Price Index", 0.01));
          EstPartRec.MODIFY;
        UNTIL EstPartRec.NEXT = 0;

      EstPartRec.RESET;
      EstPartRec.SETRANGE("Estimate No.", iEstimateNo);
      EstPartRec.SETRANGE("Unit Price Fixed", TRUE);
      IF NOT EstPartRec.ISEMPTY THEN
        MESSAGE(MsgCopyOfficePriceIndex);
    END;

    PROCEDURE CheckUnitPriceFixedUpwards@111284602(iEstimatePart@1100525001 : Record 11072073);
    BEGIN
      WITH iEstimatePart DO BEGIN
        IF Level = 0 THEN
          EXIT;
        IF NOT "Unit Price Fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            EstPartRec."Unit Price Fixed" := "Unit Price Fixed";
            EstPartRec.MODIFY;
            CheckUnitPriceFixedUpwards(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE CheckUnitPriceFixedUpwards1@111284601(iEstimatePart@1100525001 : Record 11072073);
    VAR
      EstimatePart2@1100525000 : Record 11072073;
    BEGIN
      WITH iEstimatePart DO BEGIN
        IF Level = 0 THEN
          EXIT;
        IF "Unit Price Fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDFIRST THEN BEGIN
            IF NOT EstPartRec."Unit Price Fixed" THEN BEGIN
              EstimatePart2.RESET;
              EstimatePart2.SETRANGE("Estimate No.", "Estimate No.");
              EstimatePart2.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
              EstimatePart2.SETRANGE("Part Group", "Part Group");
              EstimatePart2.SETFILTER(Part, '<>%1', Part);
              CASE EstPartRec.Level OF
                1: EstimatePart2.SETRANGE(Chapter, EstPartRec.Chapter);
                2: EstimatePart2.SETRANGE(Paragraph, EstPartRec.Paragraph);
              END;
              EstimatePart2.SETRANGE(Level, Level);
              EstimatePart2.SETRANGE("Unit Price Fixed", FALSE);
              IF NOT EstimatePart2.ISEMPTY THEN
                EXIT;
              EstPartRec."Unit Price Fixed" := "Unit Price Fixed";
              EstPartRec.MODIFY;
            END;
            CheckUnitPriceFixedUpwards1(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE ProcessSalesTotalUnitPrices@111284607(RecordDeleted@111284605 : Boolean);
    VAR
      EstimatePart@1100485000 : Record 11072073;
      lLevel@1100485001 : Integer;
      lvPartQty@1100485003 : Decimal;
      NewUnitPrice@1210190003 : Decimal;
      OldUnitPrice@1210190001 : Decimal;
      FixedUnitPrice@1210190002 : Decimal;
      DifferencePrice@1210190004 : Decimal;
      DifferenceFactor@1210190005 : Decimal;
      TotalUnitPrice@1210190006 : Decimal;
      NewTotalUnitPrice@111284602 : Decimal;
      OldTotalUnitPrice@111284601 : Decimal;
      DifferenceTotalUnitPrice@111284600 : Decimal;
      FixedTotalUnitPrice@111284603 : Decimal;
      DifferenceTotalFactor@111284604 : Decimal;
    BEGIN
      IF OnTempTable THEN
        EXIT;

      IF RecordDeleted THEN BEGIN
        NewUnitPrice := 0;
        NewTotalUnitPrice := 0;
      END ELSE BEGIN
        NewUnitPrice := "Unit Price";
        NewTotalUnitPrice := "Total Unit Price";
      END;

      OldUnitPrice := xRec."Unit Price";
      OldTotalUnitPrice := xRec."Total Unit Price";
      DifferencePrice := NewUnitPrice - OldUnitPrice;
      DifferenceTotalUnitPrice := NewTotalUnitPrice - OldTotalUnitPrice;

      GetFixedUnitPrice(Rec, FixedUnitPrice, FixedTotalUnitPrice);

      NewUnitPrice := NewUnitPrice - FixedUnitPrice;
      OldUnitPrice := OldUnitPrice - FixedUnitPrice;
      NewTotalUnitPrice := NewTotalUnitPrice - FixedTotalUnitPrice;
      OldTotalUnitPrice := OldTotalUnitPrice - FixedTotalUnitPrice;

      EstimatePart.SETRANGE("Estimate No.", "Estimate No.");
      EstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstimatePart.SETRANGE("Unit Price Fixed", FALSE);
      IF OldUnitPrice <> 0 THEN
        DifferenceFactor := NewUnitPrice / OldUnitPrice
      ELSE
        DifferenceFactor := 0;

      IF OldTotalUnitPrice <> 0 THEN
        DifferenceTotalFactor := NewTotalUnitPrice / OldTotalUnitPrice
      ELSE
        DifferenceTotalFactor := 0;

      IF Level < 3 THEN BEGIN
        //Distribute amount downwards.
        EstimatePart.SETRANGE(Level, Level + 1, 3);
        CASE Level OF
          1: BEGIN
               EstimatePart.SETRANGE(Chapter, Part);
             END;
          2: BEGIN
               EstimatePart.SETRANGE(Chapter, Chapter);
               EstimatePart.SETRANGE(Paragraph, Part);
             END;
        END;
        IF EstimatePart.FINDSET THEN
          REPEAT
            IF EstimatePart."Unit Price Fixed" THEN
              ERROR(Text009, EstimatePart.Part);
            FixedUnitPrice := 0;
            FixedTotalUnitPrice := 0;

            GetFixedUnitPrice(EstimatePart, FixedUnitPrice, FixedTotalUnitPrice);
            EstimatePart."Unit Price" := (EstimatePart."Unit Price" - FixedUnitPrice) * DifferenceFactor + FixedUnitPrice;
            lvPartQty := EstimatePart.GetPartQuantity;
            IF lvPartQty <> 0 THEN
              EstimatePart."Total Unit Price" := ((EstimatePart."Total Unit Price" - FixedTotalUnitPrice) * DifferenceTotalFactor + FixedTotalUnitPrice) / lvPartQty;
            EstimatePart."Total Unit Price" := ROUND(EstimatePart."Total Unit Price", 0.01);
            EstimatePart."Unit Price" := ROUND(EstimatePart."Unit Price", 0.01);
            EstimatePart.MODIFY;
          UNTIL EstimatePart.NEXT = 0;
      END;

      IF GetTotalUnitPrice(Rec, TotalUnitPrice) THEN
        IF "Unit Price" <> TotalUnitPrice THEN BEGIN
          CumQuan := GetPartQuantity;
          "Unit Price" := TotalUnitPrice;
          IF CumQuan <> 0 THEN
            "Total Unit Price" := "Total Unit Price" / CumQuan;
          DifferencePrice := "Unit Price" - xRec."Unit Price";
          "Total Unit Price" := ROUND("Total Unit Price", 0.01);
          "Unit Price" := ROUND("Unit Price", 0.01);
          DifferencePrice := ROUND(DifferencePrice, 0.01);
        END;

      IF Level > 0 THEN
        FOR lLevel := Level DOWNTO 1 DO BEGIN
          EstimatePart.RESET;
          EstimatePart.SETRANGE("Estimate No.", "Estimate No.");
          EstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstimatePart.SETRANGE("Unit Price Fixed", FALSE);
          CASE lLevel OF
            3: BEGIN
                 EstimatePart.SETRANGE(Level, lLevel - 1);
                 EstimatePart.SETRANGE(Chapter, Chapter);
                 EstimatePart.SETRANGE(Paragraph, Paragraph);
               END;
            2: BEGIN
                 EstimatePart.SETRANGE(Level, lLevel - 1);
                 EstimatePart.SETRANGE(Chapter, Chapter);
                 EstimatePart.SETRANGE(Paragraph);
               END;
            1: BEGIN
                 EstimatePart.SETRANGE(Level, lLevel - 1);
                 EstimatePart.SETRANGE(Chapter);
               END;
          END;
          IF EstimatePart.FINDFIRST THEN BEGIN
            IF EstimatePart."Unit Price Fixed" THEN
              ERROR(Text008, EstimatePart.Part);
            lvPartQty := EstimatePart.GetPartQuantity;
            IF lvPartQty <> 0 THEN
              EstimatePart."Total Unit Price" := (EstimatePart."Total Unit Price" + DifferenceTotalUnitPrice) / lvPartQty
            ELSE
              EstimatePart."Total Unit Price" := EstimatePart."Total Unit Price" + DifferenceTotalUnitPrice;
             EstimatePart."Total Unit Price" := ROUND(EstimatePart."Total Unit Price", 0.01);
             EstimatePart.MODIFY;
          END;
        END;
    END;

    PROCEDURE GetFixedUnitPrice@111284611(iSubEstimatePart@1210190000 : Record 11072073;VAR FixedUnitPrice@1210190001 : Decimal;VAR FixedTotalUnitPrice@111284600 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190002 : Record 11072073;
    BEGIN
      IF iSubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", iSubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", iSubEstimatePart."Sub-Estimate No.");
      CASE iSubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, iSubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, iSubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, iSubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, iSubEstimatePart.Level + 1);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetFixedUnitPrice(SubEstimatePart, FixedUnitPrice, FixedTotalUnitPrice) THEN
            IF SubEstimatePart."Unit Price Fixed" THEN BEGIN
              FixedUnitPrice += SubEstimatePart."Unit Price";
              FixedTotalUnitPrice += SubEstimatePart."Total Unit Price";
            END;
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetTotalUnitPrice@111284610(iSubEstimatePart@1210190000 : Record 11072073;VAR TotalUnitPrice@1210190002 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190001 : Record 11072073;
    BEGIN
      IF iSubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", iSubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", iSubEstimatePart."Sub-Estimate No.");
      CASE iSubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, iSubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, iSubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, iSubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, iSubEstimatePart.Level + 1);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetTotalUnitPrice(SubEstimatePart, TotalUnitPrice) THEN
            TotalUnitPrice += SubEstimatePart."Unit Price"
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE InheritFromBasePart@1100528500(BasePart@1100528500 : Record 11012169);
    BEGIN
      //C035157
      Description := BasePart.Description;
      Quantity := BasePart.Quantity;
      "Unit of Measure" := BasePart."Unit of Measure";
      IF BasePart.Element <> '' THEN
        Element := BasePart.Element;
      GetDisciplineByElement;  //DP02460
      IF BasePart."Project Plann. Base Act. Code" <> '' THEN
        "Project Planning Activity Code" := BasePart."Project Plann. Base Act. Code";
      "Unit of Qty per Unit" := BasePart."Unit of Qty per Unit";
      IF BasePart."Surcharge % Labor" <> 0 THEN
        "Surcharge % Labor" := BasePart."Surcharge % Labor";
      IF BasePart."Surcharge % Material" <> 0 THEN
        "Surcharge % Material" := BasePart."Surcharge % Material";
      IF BasePart."Surcharge % Subcontracting" <> 0 THEN
        "Surcharge % Subcontracting" := BasePart."Surcharge % Subcontracting";
      IF BasePart."Surcharge % Plant" <> 0 THEN
        "Surcharge % Plant" := BasePart."Surcharge % Plant";
      IF BasePart."Surcharge % Labor" <> 0 THEN
        "Surcharge % Sundry" := BasePart."Surcharge % Sundry";
    END;

    PROCEDURE GetDisciplineByElement@1100528920();
    VAR
      BaseElement@1100528900 : Record 11012060;
      ProjectElement@1100528901 : Record 11012010;
    BEGIN
      //DP02460
      IF Element = '' THEN EXIT;
      IF "Project No." <> '' THEN BEGIN
        IF NOT ProjectElement.GET("Project No.", Element) THEN ProjectElement.INIT;
        IF ProjectElement.Discipline <> '' THEN
          Discipline := ProjectElement.Discipline;
      END ELSE BEGIN
        IF NOT BaseElement.GET(Element) THEN BaseElement.INIT;
        IF BaseElement.Discipline <> '' THEN
          Discipline := BaseElement.Discipline;
      END;
    END;

    PROCEDURE InheritFromParentLevel@1100528905();
    VAR
      AssignValue@1100528900 : Boolean;
      EstimatePart@1100528901 : Record 11072073;
    BEGIN
      //DP02460
      IF Level = 1 THEN BEGIN
        EstimatePart.SETRANGE("Estimate No.", "Estimate No.");
        EstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstimatePart.SETRANGE(Level, 0);
        IF EstimatePart.FINDSET THEN
          AssignValue := TRUE;
      END;
      IF Level = 2 THEN
        IF EstimatePart.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Chapter) THEN
          AssignValue := TRUE;
      IF Level = 3 THEN
        IF EstimatePart.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Paragraph) THEN
          AssignValue := TRUE;
      IF AssignValue THEN BEGIN
        IF EstimatePart."Project No." <> '' THEN
          "Project No." := EstimatePart."Project No.";
        IF EstimatePart."Project Planning Activity Code" <> '' THEN
          "Project Planning Activity Code" := EstimatePart."Project Planning Activity Code";
        IF EstimatePart.Element <> '' THEN
          Element := EstimatePart.Element;
        IF EstimatePart.Discipline <> '' THEN
          Discipline := EstimatePart.Discipline;
        IF EstimatePart."Rate Code" <> '' THEN
          "Rate Code" := EstimatePart."Rate Code";
        IF EstimatePart."Norm Group" <> '' THEN
          "Norm Group" := EstimatePart."Norm Group";
        IF EstimatePart."Norm Group (Sales)" <> '' THEN
          "Norm Group (Sales)" := EstimatePart."Norm Group (Sales)";
      END;
    END;

    BEGIN
    END.
  }
}

