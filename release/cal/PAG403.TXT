OBJECT Page 403 Purchase Order Statistics
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.00,4PS14.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=_Purchase Order Statistics;
               NOR=Bestillingsstatistikk;
               SVE=Inkîpsorderstatistik];
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    SourceTable=Table38;
    PageType=Card;
    OnOpenPage=BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**4PS Generated Code.en01
                 PurchSetup.GET;
                 AllowInvDisc :=
                   NOT (PurchSetup."Calc. Inv. Discount" AND VendInvDiscRecExists("Invoice Disc. Code"));
                 AllowVATDifference :=
                   PurchSetup."Allow VAT Difference" AND
                   NOT ("Document Type" IN ["Document Type"::Quote,"Document Type"::"Blanket Order"]);
                 OnOpenPageOnBeforeSetEditable(AllowInvDisc,AllowVATDifference);
                 VATLinesFormIsEditable := AllowVATDifference OR AllowInvDisc;
                 CurrPage.EDITABLE := VATLinesFormIsEditable;
               END;

    OnAfterGetRecord=BEGIN
                       RefreshOnAfterGetRecord;
                     END;

    OnNewRecord=BEGIN
                  //**4PS Generated Code. Do Not Change.sn02
                  DPA_SetDefaultDepartment;
                  //**4PS Generated Code.en02
                END;

    OnInsertRecord=VAR
                     xRecRef@1100000999 : RecordRef;
                   BEGIN
                     //**4PS Generated Code. Do Not Change.sn05
                     xRecRef.GETTABLE(xRec);
                     DPA_SetDefaultDpmtFromNoSeries(xRecRef);
                     //**4PS Generated Code.en05
                   END;

    OnQueryClosePage=VAR
                       PurchLine@1001 : Record 39;
                       ReleasePurchaseDocument@1002 : Codeunit 415;
                     BEGIN
                       GetVATSpecification(PrevTab);
                       ReleasePurchaseDocument.CalcAndUpdateVATOnLines(Rec,PurchLine);
                       EXIT(TRUE);
                     END;

  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                CaptionML=[ENU=General;
                           NOR=Generelt;
                           SVE=AllmÑnt] }

    { 35  ;2   ;Field     ;
                Name=LineAmountGeneral;
                CaptionML=[ENU=Amount;
                           NOR=Belõp;
                           SVE=Belopp];
                ToolTipML=[ENU=Specifies the net amount of all the lines in the purchase order. This amount does not include VAT or any invoice discount, but does include line discounts.;
                           NOR=Angir nettobelõpet for alle linjene i bestillingen. Belõpet inkluderer ikke mva. eller noen fakturarabattbelõp, men inkluderer eventuelle linjerabatter.;
                           SVE=Anger nettobeloppet fîr alla rader pÜ inkîpsordern. Moms eller fakturarabatter ingÜr inte i beloppet, men dÑremot ingÜr radrabatter.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[1]."Line Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text002,FALSE);
                Importance=Promoted;
                Editable=FALSE }

    { 32  ;2   ;Field     ;
                Name=InvDiscountAmount_General;
                CaptionML=[ENU=Inv. Discount Amount;
                           NOR=Fakturarabattbelõp;
                           SVE=Fakturarabatt];
                ToolTipML=[ENU=Specifies the invoice discount amount for the entire purchase order.;
                           NOR=Angir fakturarabattbelõpet for hele bestillingen.;
                           SVE=Anger fakturarabatten fîr hela inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[1]."Inv. Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                Importance=Promoted;
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::General;
                             UpdateInvDiscAmount(1);
                           END;
                            }

    { 26  ;2   ;Field     ;
                Name=Total_General;
                CaptionML=[ENU=Total;
                           NOR=I alt;
                           SVE=Totalt];
                ToolTipML=[ENU=Specifies the total amount, less any invoice discount amount and excluding VAT for the purchase order.;
                           NOR=Angir det totale belõpet minus fakturarabattbelõp og uten mva for bestillingen.;
                           SVE=Anger inkîpsorderns totalbelopp exklusive moms och fakturarabatt.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount1[1];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,FALSE);
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::General;
                             UpdateTotalAmount(1);
                           END;
                            }

    { 22  ;2   ;Field     ;
                CaptionML=[ENU=VAT Amount;
                           NOR=Mva-belõp;
                           SVE=Momsbelopp];
                ToolTipML=[ENU=Specifies the total VAT amount that has been calculated for all the lines in the purchase order.;
                           NOR=Angir det totale mva.-belõpet som er beregnet for alle linjene i bestillingen.;
                           SVE=Anger totalt momsbelopp berÑknat pÜ alla inkîpsorderns rader.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=VATAmount[1];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(VATAmountText[1]);
                Editable=FALSE }

    { 20  ;2   ;Field     ;
                Name=TotalInclVAT_General;
                CaptionML=[ENU=Total Incl. VAT;
                           NOR=Totalt inkl. mva.;
                           SVE=Totalt inkl. moms];
                ToolTipML=[ENU=Specifies the amount, including VAT. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.;
                           NOR=Angir belõpet inkludert mva. PÜ hurtigfanen Fakturering vil dette vëre belõpet som bokfõres pÜ leverandõrens konto for alle linjene i bestillingen, hvis du bokfõrer bestillingen som fakturert.;
                           SVE=Anger beloppet inklusive moms. PÜ snabbfliken Fakturering Ñr detta beloppet som bokfîrs till leverantîrens konto fîr alla rader pÜ inkîpsordern nÑr du bokfîr den som fakturerad.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount2[1];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,TRUE);
                Editable=FALSE }

    { 16  ;2   ;Field     ;
                CaptionML=[ENU=Purchase (LCY);
                           NOR=Kjõp (NOK);
                           SVE=Inkîp (BVA)];
                ToolTipML=[ENU=Specifies the amount in the Total field, converted to LCY.;
                           NOR=Angir belõpet i feltet Total omregnet til norske kroner.;
                           SVE=Anger beloppet i fÑltet Totalt exkl. moms omrÑknat i BVA.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLineLCY[1].Amount;
                AutoFormatType=1;
                Editable=FALSE }

    { 37  ;2   ;Field     ;
                Name=Quantity_General;
                CaptionML=[ENU=Quantity;
                           NOR=Antall;
                           SVE=Antal];
                ToolTipML=[ENU=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.;
                           NOR=Angir det totale antall finansposter, aktiva og/eller varer i bestillingen.;
                           SVE=Anger det totala antalet redovisningskontotransaktioner, anlÑggningstillgÜngar och/eller artiklar pÜ inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1].Quantity;
                Editable=FALSE }

    { 30  ;2   ;Field     ;
                CaptionML=[ENU=Parcels;
                           NOR=Kolli;
                           SVE=Fîrpackningar];
                ToolTipML=[ENU=Specifies the total number of parcels in the purchase order.;
                           NOR=Angir antall kolli i bestillingen.;
                           SVE=Anger totalt antal fîrpackningar pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Units per Parcel";
                Editable=FALSE }

    { 28  ;2   ;Field     ;
                CaptionML=[ENU=Net Weight;
                           NOR=Nettovekt;
                           SVE=Nettovikt];
                ToolTipML=[ENU=Specifies the total net weight of the items in the purchase order.;
                           NOR=Angir den totale nettovekten av varene i bestillingen.;
                           SVE=Anger total nettovikt fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Net Weight";
                Editable=FALSE }

    { 23  ;2   ;Field     ;
                CaptionML=[ENU=Gross Weight;
                           NOR=Bruttovekt;
                           SVE=Bruttovikt];
                ToolTipML=[ENU=Specifies the total gross weight of the items in the purchase order.;
                           NOR=Angir den totale bruttovekten av varene i bestillingen.;
                           SVE=Anger total bruttovikt fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Gross Weight";
                Editable=FALSE }

    { 18  ;2   ;Field     ;
                CaptionML=[ENU=Volume;
                           NOR=Volum;
                           SVE=Volym];
                ToolTipML=[ENU=Specifies the total volume of the items in the purchase order.;
                           NOR=Angir det totale volumet av varene i bestillingen.;
                           SVE=Anger total volym fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Unit Volume";
                Editable=FALSE }

    { 40  ;2   ;Field     ;
                Name=NoOfVATLines_General;
                DrillDown=Yes;
                CaptionML=[ENU=No. of Tax Lines;
                           NOR=Ant. mva-linjer;
                           SVE=Antal momsrader];
                ToolTipML=[ENU=Specifies the number of lines on the purchase order that have VAT amounts.;
                           NOR=Angir antallet linjer pÜ bestillingen som har mva-belõp.;
                           SVE=Anger antalet rader pÜ inkîpsordern som har momsbelopp.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TempVATAmountLine1.COUNT;
                OnDrillDown=BEGIN
                              VATLinesDrillDown(TempVATAmountLine1,FALSE);
                              UpdateHeaderInfo(1,TempVATAmountLine1);
                            END;
                             }

    { 1905885101;1;Group  ;
                CaptionML=[ENU=Invoicing;
                           NOR=Fakturering;
                           SVE=Fakturering] }

    { 59  ;2   ;Field     ;
                CaptionML=[ENU=Amount;
                           NOR=Belõp;
                           SVE=Belopp];
                ToolTipML=[ENU=Specifies the net amount of all the lines in the purchase order. This amount does not include VAT or any invoice discount, but does include line discounts.;
                           NOR=Angir nettobelõpet for alle linjene i bestillingen. Belõpet inkluderer ikke mva. eller noen fakturarabattbelõp, men inkluderer eventuelle linjerabatter.;
                           SVE=Anger nettobeloppet fîr alla rader pÜ inkîpsordern. Moms eller fakturarabatter ingÜr inte i beloppet, men dÑremot ingÜr radrabatter.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[2]."Line Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text002,FALSE);
                Importance=Promoted;
                Editable=FALSE }

    { 57  ;2   ;Field     ;
                Name=InvDiscountAmount_Invoicing;
                CaptionML=[ENU=Inv. Discount Amount;
                           NOR=Fakturarabattbelõp;
                           SVE=Fakturarabatt];
                ToolTipML=[ENU=Specifies the invoice discount amount.;
                           NOR=Angir fakturarabattbelõpet.;
                           SVE=Anger fakturarabatten.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[2]."Inv. Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                Importance=Promoted;
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::Invoicing;
                             UpdateInvDiscAmount(2);
                           END;
                            }

    { 51  ;2   ;Field     ;
                Name=Total_Invoicing;
                CaptionML=[ENU=Total;
                           NOR=I alt;
                           SVE=Totalt];
                ToolTipML=[ENU=Specifies the total amount less any invoice discount amount and excluding VAT for the purchase order.;
                           NOR=Angir det totale belõpet minus fakturarabattbelõp og uten mva for bestillingen.;
                           SVE=Anger inkîpsorderns totalbelopp exklusive moms och fakturarabatt.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount1[2];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,FALSE);
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::Invoicing;
                             UpdateTotalAmount(2);
                           END;
                            }

    { 47  ;2   ;Field     ;
                Name=VATAmount_Invoicing;
                CaptionML=[ENU=VAT Amount;
                           NOR=Mva-belõp;
                           SVE=Momsbelopp];
                ToolTipML=[ENU=Specifies the total VAT amount that has been calculated for all the lines in the purchase order.;
                           NOR=Angir det totale mva.-belõpet som er beregnet for alle linjene i bestillingen.;
                           SVE=Anger totalt momsbelopp berÑknat pÜ alla inkîpsorderns rader.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=VATAmount[2];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(VATAmountText[2]);
                Editable=FALSE }

    { 45  ;2   ;Field     ;
                Name=TotalInclVAT_Invoicing;
                CaptionML=[ENU=Total Incl. VAT;
                           NOR=Totalt inkl. mva.;
                           SVE=Totalt inkl. moms];
                ToolTipML=[ENU=Specifies the amount, including VAT. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.;
                           NOR=Angir belõpet inkludert mva. PÜ hurtigfanen Fakturering vil dette vëre belõpet som bokfõres pÜ leverandõrens konto for alle linjene i bestillingen, hvis du bokfõrer bestillingen som fakturert.;
                           SVE=Anger beloppet inklusive moms. PÜ snabbfliken Fakturering Ñr detta beloppet som bokfîrs till leverantîrens konto fîr alla rader pÜ inkîpsordern nÑr du bokfîr den som fakturerad.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount2[2];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,TRUE);
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                CaptionML=[ENU=Purchase (LCY);
                           NOR=Kjõp (NOK);
                           SVE=Inkîp (BVA)];
                ToolTipML=[ENU=Specifies the amount in the Total field, converted to LCY.;
                           NOR=Angir belõpet i feltet Total omregnet til norske kroner.;
                           SVE=Anger beloppet i fÑltet Totalt exkl. moms omrÑknat i BVA.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLineLCY[2].Amount;
                AutoFormatType=1;
                Editable=FALSE }

    { 61  ;2   ;Field     ;
                Name=Quantity_Invoicing;
                CaptionML=[ENU=Quantity;
                           NOR=Antall;
                           SVE=Antal];
                ToolTipML=[ENU=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.;
                           NOR=Angir det totale antall finansposter, aktiva og/eller varer i bestillingen.;
                           SVE=Anger det totala antalet redovisningskontotransaktioner, anlÑggningstillgÜngar och/eller artiklar pÜ inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2].Quantity;
                Editable=FALSE }

    { 55  ;2   ;Field     ;
                CaptionML=[ENU=Parcels;
                           NOR=Kolli;
                           SVE=Fîrpackningar];
                ToolTipML=[ENU=Specifies the total number of parcels in the purchase order.;
                           NOR=Angir antall kolli i bestillingen.;
                           SVE=Anger totalt antal fîrpackningar pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Units per Parcel";
                Editable=FALSE }

    { 53  ;2   ;Field     ;
                CaptionML=[ENU=Net Weight;
                           NOR=Nettovekt;
                           SVE=Nettovikt];
                ToolTipML=[ENU=Specifies the total net weight of the items in the purchase order.;
                           NOR=Angir den totale nettovekten av varene i bestillingen.;
                           SVE=Anger total nettovikt fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Net Weight";
                Editable=FALSE }

    { 48  ;2   ;Field     ;
                CaptionML=[ENU=Gross Weight;
                           NOR=Bruttovekt;
                           SVE=Bruttovikt];
                ToolTipML=[ENU=Specifies the total gross weight of the items in the purchase order.;
                           NOR=Angir den totale bruttovekten av varene i bestillingen.;
                           SVE=Anger total bruttovikt fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Gross Weight";
                Editable=FALSE }

    { 43  ;2   ;Field     ;
                CaptionML=[ENU=Volume;
                           NOR=Volum;
                           SVE=Volym];
                ToolTipML=[ENU=Specifies the total volume of the items in the purchase order.;
                           NOR=Angir det totale volumet av varene i bestillingen.;
                           SVE=Anger total volym fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Unit Volume";
                Editable=FALSE }

    { 64  ;2   ;Field     ;
                Name=NoOfVATLines_Invoicing;
                DrillDown=Yes;
                CaptionML=[ENU=No. of Tax Lines;
                           NOR=Ant. mva-linjer;
                           SVE=Antal momsrader];
                ToolTipML=[ENU=Specifies the number of lines on the purchase order that have VAT amounts.;
                           NOR=Angir antallet linjer pÜ bestillingen som har mva-belõp.;
                           SVE=Anger antalet rader pÜ inkîpsordern som har momsbelopp.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TempVATAmountLine2.COUNT;
                OnDrillDown=BEGIN
                              ActiveTab := ActiveTab::Invoicing;
                              VATLinesDrillDown(TempVATAmountLine2,TRUE);
                              UpdateHeaderInfo(2,TempVATAmountLine2);

                              IF TempVATAmountLine2.GetAnyLineModified THEN BEGIN
                                UpdateVATOnPurchLines;
                                RefreshOnAfterGetRecord;
                              END;
                            END;
                             }

    { 1906801201;1;Group  ;
                CaptionML=[ENU=Shipping;
                           NOR=Levering;
                           SVE=Leverans] }

    { 83  ;2   ;Field     ;
                CaptionML=[ENU=Amount;
                           NOR=Belõp;
                           SVE=Belopp];
                ToolTipML=[ENU=Specifies the net amount of all the lines in the purchase order. This amount does not include VAT or any invoice discount, but does include line discounts.;
                           NOR=Angir nettobelõpet for alle linjene i bestillingen. Belõpet inkluderer ikke mva. eller noen fakturarabattbelõp, men inkluderer eventuelle linjerabatter.;
                           SVE=Anger nettobeloppet fîr alla rader pÜ inkîpsordern. Moms eller fakturarabatter ingÜr inte i beloppet, men dÑremot ingÜr radrabatter.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[3]."Line Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text002,FALSE);
                Importance=Promoted;
                Editable=FALSE }

    { 81  ;2   ;Field     ;
                CaptionML=[ENU=Inv. Discount Amount;
                           NOR=Fakturarabattbelõp;
                           SVE=Fakturarabatt];
                ToolTipML=[ENU=Specifies the invoice discount amount for the entire purchase order.;
                           NOR=Angir fakturarabattbelõpet for hele bestillingen.;
                           SVE=Anger fakturarabatten fîr hela inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[3]."Inv. Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                Importance=Promoted;
                Editable=FALSE }

    { 75  ;2   ;Field     ;
                CaptionML=[ENU=Total;
                           NOR=I alt;
                           SVE=Totalt];
                ToolTipML=[ENU=Specifies the total amount less any invoice discount amount and excluding VAT for the purchase order.;
                           NOR=Angir det totale belõpet minus fakturarabattbelõp og uten mva for bestillingen.;
                           SVE=Anger inkîpsorderns totalbelopp exklusive moms och fakturarabatt.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount1[3];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,FALSE);
                Editable=FALSE }

    { 71  ;2   ;Field     ;
                CaptionML=[ENU=VAT Amount;
                           NOR=Mva-belõp;
                           SVE=Momsbelopp];
                ToolTipML=[ENU=Specifies the total VAT amount that has been calculated for all the lines in the purchase order.;
                           NOR=Angir det totale mva.-belõpet som er beregnet for alle linjene i bestillingen.;
                           SVE=Anger totalt momsbelopp berÑknat pÜ alla inkîpsorderns rader.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=VATAmount[3];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(VATAmountText[3]);
                Editable=FALSE }

    { 69  ;2   ;Field     ;
                Name=TotalInclVAT_Shipping;
                CaptionML=[ENU=Total Incl. VAT;
                           NOR=Totalt inkl. mva.;
                           SVE=Totalt inkl. moms];
                ToolTipML=[ENU=Specifies the amount, including VAT. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.;
                           NOR=Angir belõpet inkludert mva. PÜ hurtigfanen Fakturering vil dette vëre belõpet som bokfõres pÜ leverandõrens konto for alle linjene i bestillingen, hvis du bokfõrer bestillingen som fakturert.;
                           SVE=Anger beloppet inklusive moms. PÜ snabbfliken Fakturering Ñr detta beloppet som bokfîrs till leverantîrens konto fîr alla rader pÜ inkîpsordern nÑr du bokfîr den som fakturerad.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount2[3];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,TRUE);
                Editable=FALSE }

    { 65  ;2   ;Field     ;
                CaptionML=[ENU=Purchase (LCY);
                           NOR=Kjõp (NOK);
                           SVE=Inkîp (BVA)];
                ToolTipML=[ENU=Specifies the amount in the Total field, converted to LCY.;
                           NOR=Angir belõpet i feltet Total omregnet til norske kroner.;
                           SVE=Anger beloppet i fÑltet Totalt exkl. moms omrÑknat i BVA.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLineLCY[3].Amount;
                AutoFormatType=1;
                Editable=FALSE }

    { 85  ;2   ;Field     ;
                Name=Quantity_Shipping;
                CaptionML=[ENU=Quantity;
                           NOR=Antall;
                           SVE=Antal];
                ToolTipML=[ENU=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.;
                           NOR=Angir det totale antall finansposter, aktiva og/eller varer i bestillingen.;
                           SVE=Anger det totala antalet redovisningskontotransaktioner, anlÑggningstillgÜngar och/eller artiklar pÜ inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3].Quantity;
                Editable=FALSE }

    { 79  ;2   ;Field     ;
                CaptionML=[ENU=Parcels;
                           NOR=Kolli;
                           SVE=Fîrpackningar];
                ToolTipML=[ENU=Specifies the total number of parcels in the purchase order.;
                           NOR=Angir antall kolli i bestillingen.;
                           SVE=Anger totalt antal fîrpackningar pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Units per Parcel";
                Editable=FALSE }

    { 77  ;2   ;Field     ;
                CaptionML=[ENU=Net Weight;
                           NOR=Nettovekt;
                           SVE=Nettovikt];
                ToolTipML=[ENU=Specifies the total net weight of the items in the purchase order.;
                           NOR=Angir den totale nettovekten av varene i bestillingen.;
                           SVE=Anger total nettovikt fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Net Weight";
                Editable=FALSE }

    { 72  ;2   ;Field     ;
                CaptionML=[ENU=Gross Weight;
                           NOR=Bruttovekt;
                           SVE=Bruttovikt];
                ToolTipML=[ENU=Specifies the total gross weight of the items in the purchase order.;
                           NOR=Angir den totale bruttovekten av varene i bestillingen.;
                           SVE=Anger total bruttovikt fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Gross Weight";
                Editable=FALSE }

    { 67  ;2   ;Field     ;
                CaptionML=[ENU=Volume;
                           NOR=Volum;
                           SVE=Volym];
                ToolTipML=[ENU=Specifies the total volume of the items in the purchase order.;
                           NOR=Angir det totale volumet av varene i bestillingen.;
                           SVE=Anger total volym fîr artiklarna pÜ inkîpsordern.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Unit Volume";
                Editable=FALSE }

    { 88  ;2   ;Field     ;
                DrillDown=Yes;
                CaptionML=[ENU=No. of Tax Lines;
                           NOR=Ant. mva-linjer;
                           SVE=Antal momsrader];
                ToolTipML=[ENU=Specifies the number of lines on the purchase order that have VAT amounts.;
                           NOR=Angir antallet linjer pÜ bestillingen som har mva-belõp.;
                           SVE=Anger antalet rader pÜ inkîpsordern som har momsbelopp.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TempVATAmountLine3.COUNT;
                OnDrillDown=BEGIN
                              VATLinesDrillDown(TempVATAmountLine3,FALSE);
                            END;
                             }

    { 1900201301;1;Group  ;
                CaptionML=[ENU=Prepayment;
                           NOR=Forskudd;
                           SVE=Fîrskottsbetalning] }

    { 15  ;2   ;Field     ;
                Name=PrepmtTotalAmount;
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtTotalAmount;
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text006,FALSE);
                Importance=Promoted;
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::Prepayment;
                             UpdatePrepmtAmount;
                           END;
                            }

    { 13  ;2   ;Field     ;
                CaptionML=[ENU=Prepayment Amount Invoiced;
                           NOR=Fakturert forskuddsbelõp;
                           SVE=Fakturerad fîrskottsbetalning];
                ToolTipML=[ENU=Specifies the total prepayment amount that has been invoiced for the order.;
                           NOR=Angir det totale forskuddsbelõpet som er fakturert for bestillingen.;
                           SVE=Anger det totala fîrskottsbetalningsbelopp som har fakturerats fîr ordern.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtVATAmount;
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(PrepmtVATAmountText);
                Importance=Promoted;
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                CaptionML=[ENU=Prepmt. Amount Invoiced;
                           NOR=Forskuddsbelõp fakturert;
                           SVE=Fakturerad fîrskottsbetalning];
                ToolTipML=[ENU=Specifies the total prepayment amount that has been invoiced for the order.;
                           NOR=Angir det totale forskuddsbelõpet som er fakturert for bestillingen.;
                           SVE=Anger det totala fîrskottsbetalningsbelopp som har fakturerats fîr ordern.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtTotalAmount2;
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text006,TRUE);
                Editable=FALSE }

    { 6   ;2   ;Field     ;
                ApplicationArea=#Prepayments;
                SourceExpr=TotalPurchLine[1]."Prepmt. Amt. Inv.";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text007,FALSE);
                Editable=FALSE }

    { 7   ;2   ;Field     ;
                ExtendedDatatype=Ratio;
                CaptionML=[ENU=Invoiced % of Prepayment Amt.;
                           NOR=Fakturert % av forskuddsbelõp;
                           SVE=Fakturerat i % av fîrskottsbetalning];
                ToolTipML=[ENU=Specifies the invoiced percentage of the prepayment amount.;
                           NOR=Angir den fakturerte prosentandelen av forskuddsbelõpet.;
                           SVE=Anger fakturerat i procent av fîrskottsbetalningen.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtInvPct }

    { 5   ;2   ;Field     ;
                ApplicationArea=#Prepayments;
                SourceExpr=TotalPurchLine[1]."Prepmt Amt Deducted";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text008,FALSE);
                Editable=FALSE }

    { 3   ;2   ;Field     ;
                ExtendedDatatype=Ratio;
                CaptionML=[ENU=Deducted % of Prepayment Amt. to Deduct;
                           NOR=Fratrukket % av forskuddsbelõp til fradrag;
                           SVE=Avdraget i % av fîrskottsbetalning att dra av];
                ToolTipML=[ENU=Specifies the deducted percentage of the prepayment amount to deduct.;
                           NOR=Angir den fratrukkede prosentandelen av forskuddsbelõpet som skal trekkes fra.;
                           SVE=Anger avdraget i procent av fîrskottsbetalningen att dra av.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtDeductedPct }

    { 4   ;2   ;Field     ;
                ApplicationArea=#Prepayments;
                SourceExpr=TotalPurchLine[1]."Prepmt Amt to Deduct";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text009,FALSE);
                Editable=FALSE }

    { 90  ;2   ;Field     ;
                DrillDown=Yes;
                CaptionML=[ENU=No. of VAT Lines;
                           NOR=Antall mva-linjer;
                           SVE=Antal momsrader];
                ToolTipML=[ENU=Specifies the number of purchase order lines that are associated with the VAT ledger line.;
                           NOR=Angir antall bestillingslinjer som er knyttet til mva-postlinjen.;
                           SVE=Anger antalet inkîpsorderrader som associeras med momstransaktionsraden.];
                ApplicationArea=#Suite;
                SourceExpr=TempVATAmountLine4.COUNT;
                OnDrillDown=BEGIN
                              VATLinesDrillDown(TempVATAmountLine4,TRUE);
                            END;
                             }

    { 1901061301;1;Group  ;
                CaptionML=[ENU=Vendor;
                           NOR=Leverandõr;
                           SVE=Leverantîr] }

    { 131 ;2   ;Field     ;
                CaptionML=[ENU=Balance (LCY);
                           NOR=Saldo (NOK);
                           SVE=Saldo (BVA)];
                ToolTipML=[ENU=Specifies the balance (in LCY) due to the vendor.;
                           NOR=Angir forfalt saldo (i NOK) til leverandõren.;
                           SVE=Anger saldot (i BVA) som Ñr fîrfallet till leverantîren.];
                ApplicationArea=#Suite;
                SourceExpr=Vend."Balance (LCY)";
                AutoFormatType=1;
                Importance=Promoted;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=Purchase %1 Statistics;NOR=Kjõpsstatistikk - %1;SVE=Inkîp %1 statistik';
      Text001@1001 : TextConst 'ENU=Total;NOR=I alt;SVE=Totalt';
      Text002@1002 : TextConst 'ENU=Amount;NOR=Belõp;SVE=Belopp';
      Text003@1003 : TextConst 'ENU=%1 must not be 0.;NOR=%1 skal ikke vëre 0.;SVE=%1 fÜr inte vara 0.';
      Text004@1004 : TextConst 'ENU=%1 must not be greater than %2.;NOR=%1 skal ikke vëre stõrre enn %2.;SVE=%1 fÜr inte vara stîrre Ñn %2.';
      Text005@1005 : TextConst 'ENU=You cannot change the invoice discount because there is a %1 record for %2 %3.;NOR=Du kan ikke endre fakturarabatten fordi det finnes en %1-post for %2 %3.;SVE=Du kan inte Ñndra fakturarabatten dÑrfîr att det finns en %1 post fîr %2 %3.';
      TotalPurchLine@1006 : ARRAY [3] OF Record 39;
      TotalPurchLineLCY@1007 : ARRAY [3] OF Record 39;
      Vend@1008 : Record 23;
      TempVATAmountLine1@1009 : TEMPORARY Record 290;
      TempVATAmountLine2@1010 : TEMPORARY Record 290;
      TempVATAmountLine3@1011 : TEMPORARY Record 290;
      TempVATAmountLine4@1030 : TEMPORARY Record 290;
      PurchSetup@1012 : Record 312;
      PurchPost@1013 : Codeunit 90;
      VATLinesForm@1037 : Page 9401;
      TotalAmount1@1014 : ARRAY [3] OF Decimal;
      TotalAmount2@1015 : ARRAY [3] OF Decimal;
      VATAmount@1016 : ARRAY [3] OF Decimal;
      PrepmtTotalAmount@1028 : Decimal;
      PrepmtVATAmount@1027 : Decimal;
      PrepmtTotalAmount2@1026 : Decimal;
      VATAmountText@1017 : ARRAY [3] OF Text[30];
      PrepmtVATAmountText@1029 : Text[30];
      PrepmtInvPct@1032 : Decimal;
      PrepmtDeductedPct@1031 : Decimal;
      i@1018 : Integer;
      PrevNo@1019 : Code[20];
      ActiveTab@1020 : 'General,Invoicing,Shipping,Prepayment';
      PrevTab@1021 : 'General,Invoicing,Shipping,Prepayment';
      VATLinesFormIsEditable@1023 : Boolean;
      AllowInvDisc@1024 : Boolean;
      AllowVATDifference@1025 : Boolean;
      Text006@1033 : TextConst 'ENU=Prepmt. Amount;NOR=Forskuddsbelõp;SVE=Fîrskottsbetalning';
      Text007@1034 : TextConst 'ENU=Prepmt. Amt. Invoiced;NOR=Forskuddsbelõp fakturert;SVE=Fakturerad fîrskottsbetalning';
      Text008@1035 : TextConst 'ENU=Prepmt. Amt. Deducted;NOR=Fratrukket forskuddsbelõp;SVE=Avdragen fîrskottsbetalning';
      Text009@1036 : TextConst 'ENU=Prepmt. Amt. to Deduct;NOR=Forskuddsbelõp til fradrag;SVE=Fîrskottsbetalning att dra av';
      UpdateInvDiscountQst@1022 : TextConst 'ENU=One or more lines have been invoiced. The discount distributed to invoiced lines will not be taken into account.\\Do you want to update the invoice discount?;NOR=ên eller flere linjer er fakturert. Det tas ikke hensyn til rabatt som er fordelt pÜ fakturerte linjer.\\Vil du oppdatere fakturarabatten?;SVE=En eller flera rader har fakturerats. Rabatten som fîrdelas pÜ de fakturerade raderna beaktas inte.\\Vill du uppdatera fakturarabatten?';
      DPA_IsHardFilter@1100000999 : Boolean;

    LOCAL PROCEDURE RefreshOnAfterGetRecord@11();
    VAR
      PurchLine@1003 : Record 39;
      TempPurchLine@1002 : TEMPORARY Record 39;
      PurchPostPrepayments@1001 : Codeunit 444;
    BEGIN
      CurrPage.CAPTION(STRSUBSTNO(Text000,"Document Type"));

      IF PrevNo = "No." THEN
        EXIT;
      PrevNo := "No.";
      FILTERGROUP(2);
      SETRANGE("No.",PrevNo);
      FILTERGROUP(0);

      CLEAR(PurchLine);
      CLEAR(TotalPurchLine);
      CLEAR(TotalPurchLineLCY);

      FOR i := 1 TO 3 DO BEGIN
        TempPurchLine.DELETEALL;
        CLEAR(TempPurchLine);
        CLEAR(PurchPost);
        PurchPost.GetPurchLines(Rec,TempPurchLine,i - 1);
        CLEAR(PurchPost);
        CASE i OF
          1:
            PurchLine.CalcVATAmountLines(0,Rec,TempPurchLine,TempVATAmountLine1);
          2:
            PurchLine.CalcVATAmountLines(0,Rec,TempPurchLine,TempVATAmountLine2);
          3:
            PurchLine.CalcVATAmountLines(0,Rec,TempPurchLine,TempVATAmountLine3);
        END;

        PurchPost.SumPurchLinesTemp(
          Rec,TempPurchLine,i - 1,TotalPurchLine[i],TotalPurchLineLCY[i],
          VATAmount[i],VATAmountText[i]);
        IF "Prices Including VAT" THEN BEGIN
          TotalAmount2[i] := TotalPurchLine[i].Amount;
          TotalAmount1[i] := TotalAmount2[i] + VATAmount[i];
          TotalPurchLine[i]."Line Amount" := TotalAmount1[i] + TotalPurchLine[i]."Inv. Discount Amount";
        END ELSE BEGIN
          TotalAmount1[i] := TotalPurchLine[i].Amount;
          TotalAmount2[i] := TotalPurchLine[i]."Amount Including VAT";
        END;
      END;
      TempPurchLine.DELETEALL;
      CLEAR(TempPurchLine);
      PurchPostPrepayments.GetPurchLines(Rec,0,TempPurchLine);
      PurchPostPrepayments.SumPrepmt(
        Rec,TempPurchLine,TempVATAmountLine4,PrepmtTotalAmount,PrepmtVATAmount,PrepmtVATAmountText);
      PrepmtInvPct :=
        Pct(TotalPurchLine[1]."Prepmt. Amt. Inv.",PrepmtTotalAmount);
      PrepmtDeductedPct :=
        Pct(TotalPurchLine[1]."Prepmt Amt Deducted",TotalPurchLine[1]."Prepmt. Amt. Inv.");
      IF "Prices Including VAT" THEN BEGIN
        PrepmtTotalAmount2 := PrepmtTotalAmount;
        PrepmtTotalAmount := PrepmtTotalAmount + PrepmtVATAmount;
      END ELSE
        PrepmtTotalAmount2 := PrepmtTotalAmount + PrepmtVATAmount;

      IF Vend.GET("Pay-to Vendor No.") THEN
        Vend.CALCFIELDS("Balance (LCY)")
      ELSE
        CLEAR(Vend);

      TempVATAmountLine1.MODIFYALL(Modified,FALSE);
      TempVATAmountLine2.MODIFYALL(Modified,FALSE);
      TempVATAmountLine3.MODIFYALL(Modified,FALSE);
      TempVATAmountLine4.MODIFYALL(Modified,FALSE);

      PrevTab := -1;
      UpdateHeaderInfo(2,TempVATAmountLine2);
    END;

    LOCAL PROCEDURE UpdateHeaderInfo@5(IndexNo@1000 : Integer;VAR VATAmountLine@1001 : Record 290);
    VAR
      CurrExchRate@1002 : Record 330;
      UseDate@1003 : Date;
    BEGIN
      TotalPurchLine[IndexNo]."Inv. Discount Amount" := VATAmountLine.GetTotalInvDiscAmount;
      TotalAmount1[IndexNo] :=
        TotalPurchLine[IndexNo]."Line Amount" - TotalPurchLine[IndexNo]."Inv. Discount Amount";
      VATAmount[IndexNo] := VATAmountLine.GetTotalVATAmount;
      IF "Prices Including VAT" THEN BEGIN
        TotalAmount1[IndexNo] := VATAmountLine.GetTotalAmountInclVAT;
        TotalAmount2[IndexNo] := TotalAmount1[IndexNo] - VATAmount[IndexNo];
        TotalPurchLine[IndexNo]."Line Amount" :=
          TotalAmount1[IndexNo] + TotalPurchLine[IndexNo]."Inv. Discount Amount";
      END ELSE
        TotalAmount2[IndexNo] := TotalAmount1[IndexNo] + VATAmount[IndexNo];

      IF "Prices Including VAT" THEN
        TotalPurchLineLCY[IndexNo].Amount := TotalAmount2[IndexNo]
      ELSE
        TotalPurchLineLCY[IndexNo].Amount := TotalAmount1[IndexNo];
      IF "Currency Code" <> '' THEN BEGIN
        IF "Posting Date" = 0D THEN
          UseDate := WORKDATE
        ELSE
          UseDate := "Posting Date";

        TotalPurchLineLCY[IndexNo].Amount :=
          CurrExchRate.ExchangeAmtFCYToLCY(
      //    UseDate,"Currency Code",TotalPurchLineLCY[IndexNo].Amount,"Currency Factor"); //**4PS.o
            0, '',UseDate,"Currency Code",TotalPurchLineLCY[IndexNo].Amount,"Currency Factor",TRUE); //**4PS.n

      END;
    END;

    LOCAL PROCEDURE GetVATSpecification@21(QtyType@1000 : 'General,Invoicing,Shipping');
    BEGIN
      CASE QtyType OF
        QtyType::General:
          BEGIN
            VATLinesForm.GetTempVATAmountLine(TempVATAmountLine1);
            IF TempVATAmountLine1.GetAnyLineModified THEN
              UpdateHeaderInfo(1,TempVATAmountLine1);
          END;
        QtyType::Invoicing:
          BEGIN
            VATLinesForm.GetTempVATAmountLine(TempVATAmountLine2);
            IF TempVATAmountLine2.GetAnyLineModified THEN
              UpdateHeaderInfo(2,TempVATAmountLine2);
          END;
        QtyType::Shipping:
          VATLinesForm.GetTempVATAmountLine(TempVATAmountLine3);
      END;
    END;

    LOCAL PROCEDURE UpdateTotalAmount@16(IndexNo@1000 : Integer);
    VAR
      SaveTotalAmount@1001 : Decimal;
    BEGIN
      CheckAllowInvDisc;
      IF "Prices Including VAT" THEN BEGIN
        SaveTotalAmount := TotalAmount1[IndexNo];
        UpdateInvDiscAmount(IndexNo);
        TotalAmount1[IndexNo] := SaveTotalAmount;
      END;
      WITH TotalPurchLine[IndexNo] DO
        "Inv. Discount Amount" := "Line Amount" - TotalAmount1[IndexNo];
      UpdateInvDiscAmount(IndexNo);
    END;

    LOCAL PROCEDURE UpdateInvDiscAmount@3(ModifiedIndexNo@1000 : Integer);
    VAR
      ConfirmManagement@1006 : Codeunit 27;
      PartialInvoicing@1001 : Boolean;
      MaxIndexNo@1002 : Integer;
      IndexNo@1003 : ARRAY [2] OF Integer;
      i@1004 : Integer;
      InvDiscBaseAmount@1005 : Decimal;
    BEGIN
      CheckAllowInvDisc;
      IF NOT (ModifiedIndexNo IN [1,2]) THEN
        EXIT;

      IF InvoicedLineExists THEN
        IF NOT ConfirmManagement.ConfirmProcess(UpdateInvDiscountQst,TRUE) THEN
          ERROR('');

      IF ModifiedIndexNo = 1 THEN
        InvDiscBaseAmount := TempVATAmountLine1.GetTotalInvDiscBaseAmount(FALSE,"Currency Code")
      ELSE
        InvDiscBaseAmount := TempVATAmountLine2.GetTotalInvDiscBaseAmount(FALSE,"Currency Code");

      IF InvDiscBaseAmount = 0 THEN
        ERROR(Text003,TempVATAmountLine2.FIELDCAPTION("Inv. Disc. Base Amount"));

      IF TotalPurchLine[ModifiedIndexNo]."Inv. Discount Amount" / InvDiscBaseAmount > 1 THEN
        ERROR(
          Text004,
          TotalPurchLine[ModifiedIndexNo].FIELDCAPTION("Inv. Discount Amount"),
          TempVATAmountLine2.FIELDCAPTION("Inv. Disc. Base Amount"));

      PartialInvoicing := (TotalPurchLine[1]."Line Amount" <> TotalPurchLine[2]."Line Amount");

      IndexNo[1] := ModifiedIndexNo;
      IndexNo[2] := 3 - ModifiedIndexNo;
      IF (ModifiedIndexNo = 2) AND PartialInvoicing THEN
        MaxIndexNo := 1
      ELSE
        MaxIndexNo := 2;

      IF NOT PartialInvoicing THEN
        IF ModifiedIndexNo = 1 THEN
          TotalPurchLine[2]."Inv. Discount Amount" := TotalPurchLine[1]."Inv. Discount Amount"
        ELSE
          TotalPurchLine[1]."Inv. Discount Amount" := TotalPurchLine[2]."Inv. Discount Amount";

      FOR i := 1 TO MaxIndexNo DO
        WITH TotalPurchLine[IndexNo[i]] DO BEGIN
          IF (i = 1) OR NOT PartialInvoicing THEN
            IF IndexNo[i] = 1 THEN BEGIN
              TempVATAmountLine1.SetInvoiceDiscountAmount(
                "Inv. Discount Amount","Currency Code","Prices Including VAT","VAT Base Discount %");
            END ELSE
              TempVATAmountLine2.SetInvoiceDiscountAmount(
                "Inv. Discount Amount","Currency Code","Prices Including VAT","VAT Base Discount %");

          IF (i = 2) AND PartialInvoicing THEN
            IF IndexNo[i] = 1 THEN BEGIN
              InvDiscBaseAmount := TempVATAmountLine2.GetTotalInvDiscBaseAmount(FALSE,"Currency Code");
              IF InvDiscBaseAmount = 0 THEN
                TempVATAmountLine1.SetInvoiceDiscountPercent(
                  0,"Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %")
              ELSE
                TempVATAmountLine1.SetInvoiceDiscountPercent(
                  100 * TempVATAmountLine2.GetTotalInvDiscAmount / InvDiscBaseAmount,
                  "Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %");
            END ELSE BEGIN
              InvDiscBaseAmount := TempVATAmountLine1.GetTotalInvDiscBaseAmount(FALSE,"Currency Code");
              IF InvDiscBaseAmount = 0 THEN
                TempVATAmountLine2.SetInvoiceDiscountPercent(
                  0,"Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %")
              ELSE
                TempVATAmountLine2.SetInvoiceDiscountPercent(
                  100 * TempVATAmountLine1.GetTotalInvDiscAmount / InvDiscBaseAmount,
                  "Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %");
            END;
        END;

      UpdateHeaderInfo(1,TempVATAmountLine1);
      UpdateHeaderInfo(2,TempVATAmountLine2);

      IF ModifiedIndexNo = 1 THEN
        VATLinesForm.SetTempVATAmountLine(TempVATAmountLine1)
      ELSE
        VATLinesForm.SetTempVATAmountLine(TempVATAmountLine2);

      "Invoice Discount Calculation" := "Invoice Discount Calculation"::Amount;
      "Invoice Discount Value" := TotalPurchLine[1]."Inv. Discount Amount";
      MODIFY;
      UpdateVATOnPurchLines;
    END;

    LOCAL PROCEDURE UpdatePrepmtAmount@9();
    VAR
      TempPurchLine@1001 : TEMPORARY Record 39;
      PurchPostPrepmt@1000 : Codeunit 444;
    BEGIN
      PurchPostPrepmt.UpdatePrepmtAmountOnPurchLines(Rec,PrepmtTotalAmount);
      PurchPostPrepmt.GetPurchLines(Rec,0,TempPurchLine);
      PurchPostPrepmt.SumPrepmt(
        Rec,TempPurchLine,TempVATAmountLine4,PrepmtTotalAmount,PrepmtVATAmount,PrepmtVATAmountText);
      PrepmtInvPct :=
        Pct(TotalPurchLine[1]."Prepmt. Amt. Inv.",PrepmtTotalAmount);
      PrepmtDeductedPct :=
        Pct(TotalPurchLine[1]."Prepmt Amt Deducted",TotalPurchLine[1]."Prepmt. Amt. Inv.");
      IF "Prices Including VAT" THEN BEGIN
        PrepmtTotalAmount2 := PrepmtTotalAmount;
        PrepmtTotalAmount := PrepmtTotalAmount + PrepmtVATAmount;
      END ELSE
        PrepmtTotalAmount2 := PrepmtTotalAmount + PrepmtVATAmount;
      MODIFY;
    END;

    LOCAL PROCEDURE GetCaptionClass@2(FieldCaption@1000 : Text[100];ReverseCaption@1001 : Boolean) : Text[80];
    BEGIN
      IF "Prices Including VAT" XOR ReverseCaption THEN
        EXIT('2,1,' + FieldCaption);

      EXIT('2,0,' + FieldCaption);
    END;

    [External]
    PROCEDURE UpdateVATOnPurchLines@1();
    VAR
      PurchLine@1000 : Record 39;
    BEGIN
      GetVATSpecification(ActiveTab);
      IF TempVATAmountLine1.GetAnyLineModified THEN
        PurchLine.UpdateVATOnLines(0,Rec,PurchLine,TempVATAmountLine1);
      IF TempVATAmountLine2.GetAnyLineModified THEN
        PurchLine.UpdateVATOnLines(1,Rec,PurchLine,TempVATAmountLine2);
      PrevNo := '';
    END;

    LOCAL PROCEDURE VendInvDiscRecExists@4(InvDiscCode@1000 : Code[20]) : Boolean;
    VAR
      VendInvDisc@1001 : Record 24;
    BEGIN
      VendInvDisc.SETRANGE(Code,InvDiscCode);
      EXIT(VendInvDisc.FINDFIRST);
    END;

    LOCAL PROCEDURE CheckAllowInvDisc@8();
    VAR
      VendInvDisc@1000 : Record 24;
    BEGIN
      IF NOT AllowInvDisc THEN
        ERROR(
          Text005,
          VendInvDisc.TABLECAPTION,FIELDCAPTION("Invoice Disc. Code"),"Invoice Disc. Code");
    END;

    LOCAL PROCEDURE Pct@6(Numerator@1001 : Decimal;Denominator@1000 : Decimal) : Decimal;
    BEGIN
      IF Denominator = 0 THEN
        EXIT(0);
      EXIT(ROUND(Numerator / Denominator * 10000,1));
    END;

    LOCAL PROCEDURE VATLinesDrillDown@7(VAR VATLinesToDrillDown@1000 : Record 290;ThisTabAllowsVATEditing@1001 : Boolean);
    BEGIN
      CLEAR(VATLinesForm);
      VATLinesForm.SetTempVATAmountLine(VATLinesToDrillDown);
      VATLinesForm.InitGlobals(
        "Currency Code",AllowVATDifference,AllowVATDifference AND ThisTabAllowsVATEditing,
        "Prices Including VAT",AllowInvDisc,"VAT Base Discount %");
      VATLinesForm.RUNMODAL;
      VATLinesForm.GetTempVATAmountLine(VATLinesToDrillDown);
    END;

    [Integration]
    LOCAL PROCEDURE OnOpenPageOnBeforeSetEditable@10(VAR AllowInvDisc@1000 : Boolean;VAR AllowVATDifference@1001 : Boolean);
    BEGIN
    END;

    BEGIN
    END.
  }
}

