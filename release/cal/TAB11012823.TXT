OBJECT Table 11012823 Service Order
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    Permissions=TableData 37=m,
                TableData 39=m,
                TableData 83=m,
                TableData 11012039=rm,
                TableData 11012055=m,
                TableData 11012085=m,
                TableData 11012819=m,
                TableData 11012823=md,
                TableData 11012825=m,
                TableData 11012886=m,
                TableData 11020221=m,
                TableData 11020308=m,
                TableData 11020335=m,
                TableData 11020585=m;
    DataCaptionFields=No.,Description;
    OnInsert=VAR
               ServiceSourceTypeSetup@1100528600 : Record 11071726;
               INSBOUSetup@1100528800 : Record 11012348;
               ServiceSurchargeManagement@1100528601 : Codeunit 11012834;
               ServiceProcessManagement@1100528602 : Codeunit 11012883;
               DummyBool@1100529400 : Boolean;
             BEGIN
               ServSetup.GET;
               InheritFromProjectSetup;  //DP02115

               IF "VAT Prod. Posting Group" = '' THEN
                 "VAT Prod. Posting Group" := ServSetup."VAT Prod. Posting Group";

               ServiceSourceTypeSetup.GET("Source Type");

               IF "No." = '' THEN BEGIN
                 ServiceSourceTypeSetup.TESTFIELD("No. Series");
                 NoSeriesMgt.InitSeries(ServiceSourceTypeSetup."No. Series", xRec."No. Series", 0D, "No.", "No. Series");
               END;

               //db.sn, 28-08-14: C016922
               IF "Assigned to" = '' THEN
                 IF ServSetup."Assign To" = ServSetup."Assign To"::User THEN
                   IF UserSetup.GET(USERID) THEN
                     VALIDATE("Assigned to", UserSetup."Employee No.");
               IF "Order Manager" = '' THEN
                 IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::User THEN
                   IF UserSetup.GET(USERID) THEN
                     VALIDATE("Order Manager", UserSetup.Salesperson);
               //db.en, 28-08-14:C016922

               IF (NOT gUseFilledOrderDateTime) THEN BEGIN
                 "Order Date":= WORKDATE;
                 "Order Time":= TIME;
               END;

               DetermineServiceType(TRUE, DummyBool);
               IF ("Order Kind" = '') AND (ServiceSourceTypeSetup."Order Kind" <> '') THEN
                 VALIDATE("Order Kind", ServiceSourceTypeSetup."Order Kind");
               IF ("Order Type" = '') AND (ServiceSourceTypeSetup."Order Type" <> '') THEN
                 VALIDATE("Order Type", ServiceSourceTypeSetup."Order Type");

               "Created on":= TODAY;
               //>> ORANGO.LP GAP 14
               "Created Time" := TIME;
               //<< ORANGO.LP GAP 14
               "Created by" := USERID;
               "Modified by" := USERID;
               "Modified on":= TODAY;
               "Previous Service Order No." := '';
               "Base Service Order No." := "No.";
               "Base Service Order" := TRUE;
               Status := Status::Open;
               "Export to FSA" := FALSE;
               "Date/Time Export to FSA" := 0DT;
               "Decentral Created" := FALSE;
               "Service Order Cost Activated" := FALSE;
               IF "Starting Date" = 0D THEN
                 "Starting Date" := WORKDATE;
               //mg.sc, 12-04-11: M18535
               IF "Expected Hours" = 0 THEN BEGIN
                 "Expected Hours" := ServSetup."Expected Hours";
                 CheckExpectedHours(0, "Order Kind");
                 CheckExpectedHours(1, "Order Type");
               END;
               IF "Duration Time" < "Expected Hours" THEN
                 "Duration Time" := "Expected Hours";
               //mg.ec, 12-04-11: M18535
               IF "Source Type" <> "Source Type"::Contract THEN
                 "Service Control Period Date" := "Order Date";
               CheckUpdateDocRefPoint('I');
               VALIDATE("Progress Scheme", ProgSchemeRec.DetermineProgrScheme("No. Series","No."));
               IF (NOT gUseFilledOrderDateTime) THEN
                 ProgPhaseRec.CheckProgressScheme(ProgPhaseRec.Type::ServOrder, "Progress Scheme", "No.", Status, TODAY, TIME)
               ELSE
                 ProgPhaseRec.CheckProgressScheme(ProgPhaseRec.Type::ServOrder,"Progress Scheme","No.",Status,"Order Date","Order Time");
               UpdateNextDeadline;
               CheckSendReport;  //db, 21-06-11: M26634
               "Additional Cost" := DetermineAdditionalCost;  //db, 08-11-07 (call 9622)
               ValidateShortcutDimCode(1,"Global Dimension 1 Code", TRUE);  //db, 30-11-11: M28816

               BuildRelationalStructure('INSERT');
               ServiceSurchargeManagement.CopySurchargeLinesToSO(Rec);
               UpdateSurchargeFields; //mg, 15-04-13: C006849

               IF Origin = Origin::"INSBOU Maint. Instr." THEN BEGIN
                 INSBOUSetup.GET;
                 "Allow Invoice Separately" := INSBOUSetup."Allow Invoice Separately";
               END;

               UpdateLongitudeLatitudeInExtensionTable;

               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, FALSE);

               //**4PS Generated Code. Do Not Change.sn05
               DPA_OnInsert;
               //**4PS Generated Code.en05

               EvaluateStartingTime;

               //>>160408 ITERO.SB RAD-206 Added field "Tactics Agreement"
               "Tactics Agreement":=ServSetup."Tactics Agreement";
               //<<
             END;

    OnModify=VAR
               ServiceProcessManagement@1100528600 : Codeunit 11012883;
             BEGIN
               "Modified by" := USERID;
               "Modified on":= TODAY;
               "Modified on (Time)" := TIME;

               UpdateServiceCall;
               UpdateFinishedBudgetLines();
               CheckUpdateDocRefPoint('M');
               UpdateNextDeadline;
               CheckSendReport;  //db, 21-06-11: M26634

               BuildRelationalStructure('MODIFY');

               IF (xRec.Address <> Address) OR (xRec.City <> City) OR (xRec."Post Code" <> "Post Code")
                 OR (xRec."Service Location No." <> "Service Location No.") OR (xRec."Service Contract No." <> "Service Contract No.") THEN
                   UpdateLongitudeLatitudeInExtensionTable;

               VALIDATE("Collective List No.");
               UpdateServiceOrderFinished;
               UpdateNEN2767Defects; //DP01529

               DetermineProcessStructure;
               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, FALSE);
             END;

    OnDelete=VAR
               lShippingDetailsRec@1210190000 : Record 11012120;
               CommentLine@1100485000 : Record 97;
               lvDebriefTextRec@1100485001 : Record 11012886;
               lvDocRefPointRec@1100525004 : Record 11020296;
               ServBudgetRec@1100485003 : Record 11012875;
               PreferenceLocation@1100525000 : Record 11020353;
               SignatureRec@1100525002 : Record 11020349;
               ServOrderExtensionRec@1210190001 : Record 11071727;
               ServiceText@1210190002 : Record 11012882;
               ServiceOrderObject@1100528600 : Record 11071724;
               UnitPriceServiceOrder@1100528601 : Record 11071772;
               UnitPriceProdRecording@1100528602 : Record 11071773;
               ServiceResponsiblePerson@1100528603 : Record 11012808;
               MobileItemUsage@1100528101 : Record 11229872;
               WorkOrder@1100529000 : Record 11229279;
               ServiceCall@1100528604 : Record 11012822;
               SOPlantMaintenanceScheme@1100528800 : Record 11072210;
               PlantServiceOrder@1100528801 : Record 11072211;
               PlantMaintProposalLine@1100529003 : Record 11126148;
               ServiceLocContactDebrief@1100528605 : Record 11072288;
               ServiceOrderPlantPart@1100529001 : Record 11072320;
               ServiceOrderPlantPartText@1100529002 : Record 11072321;
               ServSourceProcStepCheck@1100528606 : Record 11072324;
               UpdateAction@1100525001 : 'Insert,Modify,Delete,Rename';
               PlantRequestSMF@1100529700 : Record 11125529;
             BEGIN
               DisconnectChain;

               IF Status = Status::Cancelled THEN BEGIN  //db, 10-12-09: M15683
                 CheckCommitments;
                 CheckWIP;
               END ELSE BEGIN
                 TESTFIELD(Status, Status::Finished);
               END;

               IF SignatureRec.GET("No.") THEN
                 SignatureRec.DELETE;  //db, 21-05-10

               IF ServOrderExtensionRec.GET("No.") THEN
                 ServOrderExtensionRec.DELETE(TRUE);  //db, 20-05-11

               ServBudgetRec.SETRANGE("Budget Type", ServBudgetRec."Budget Type"::Order);
               ServBudgetRec.SETRANGE("Service Order No.", "No.");
               ServBudgetRec.DELETEALL; //kkleermaker, 110706, M27202 (with TRUE: SQL-problem)

               ServAdviceRec.SETRANGE("Record Type", ServAdviceRec."Record Type"::ServOrder);
               ServAdviceRec.SETRANGE("Service Order No.", "No.");
               ServAdviceRec.DELETEALL(TRUE);

               ServCostPlusRec.SETRANGE("Service Order No.", "No.");
               ServCostPlusRec.DELETEALL(TRUE);

               ServActRec.SETRANGE("Service Order No.", "No.");
               ServActRec.DELETEALL(TRUE);

               ServLogRec.SETRANGE("Document Type", ServLogRec."Document Type"::ServOrder);
               ServLogRec.SETRANGE("Document No.", "No.");
               ServLogRec.DELETEALL(TRUE);

               ProgPhaseRec.SETRANGE(Type, ProgPhaseRec.Type::ServOrder);
               ProgPhaseRec.SETRANGE("Document No.", "No.");
               ProgPhaseRec.DELETEALL(TRUE);

               RefPeriodRec.RESET;
               RefPeriodRec.SETCURRENTKEY(Type, "Document No.");
               RefPeriodRec.SETRANGE(Type, RefPeriodRec.Type::ServOrder);
               RefPeriodRec.SETRANGE("Document No.", "No.");
               RefPeriodRec.DELETEALL(TRUE);

               lvDocRefPointRec.SETRANGE(Type, lvDocRefPointRec.Type::ServOrder);
               lvDocRefPointRec.SETRANGE("Document No.", "No.");
               IF lvDocRefPointRec.FINDSET() THEN
                 REPEAT
                   lvDocRefPointRec.InsertDocRefPointQueueEntry(UpdateAction::Delete);
                 UNTIL lvDocRefPointRec.NEXT = 0;
               lvDocRefPointRec.DELETEALL;

               IF FPSLicenseManagement.LicenseAndReadPermissionForTable(lShippingDetailsRec) THEN BEGIN
                 lShippingDetailsRec.SETRANGE(Source, lShippingDetailsRec.Source::AdviceOrder);
                 lShippingDetailsRec.SETRANGE("Order No.", "No.");
                 lShippingDetailsRec.DELETEALL(TRUE);
               END;

               CommentLine.SETRANGE("Table Name",CommentLine."Table Name"::"Service Order");
               CommentLine.SETRANGE("No.","No.");
               CommentLine.DELETEALL;

               lvDebriefTextRec.SETRANGE(Type,lvDebriefTextRec.Type::ServiceOrder);
               lvDebriefTextRec.SETRANGE("No.","No.");
               lvDebriefTextRec.DELETEALL;

               ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Order");
               ServiceText.SETRANGE("No.","No.");
               ServiceText.DELETEALL;

               MoveEntries.RemoveServOrderEntries(Rec);

               PreferenceLocation.SETRANGE(Type,PreferenceLocation.Type::"Service Order");
               PreferenceLocation.SETRANGE("No.","No.");
               PreferenceLocation.DELETEALL(TRUE);

               ServiceOrderObject.SETRANGE("Service Order No.", "No.");
               ServiceOrderObject.DELETEALL(TRUE);

               //kzwerver, 111003, sn, #RfC Unit Price
               UnitPriceServiceOrder.SETRANGE("Service Order No.", "No.");
               UnitPriceServiceOrder.DELETEALL;

               UnitPriceProdRecording.SETRANGE("Service Order No.", "No.");
               UnitPriceProdRecording.DELETEALL(TRUE);
               //kzwerver, 111003, en, #RfC Unit Price

               ServiceResponsiblePerson.SETRANGE("Service Order No.", "No.");
               ServiceResponsiblePerson.DELETEALL(TRUE);

               ServiceLocContactDebrief.SETRANGE("Service Order No.", "No.");
               ServiceLocContactDebrief.DELETEALL(TRUE);

               //DP00465
               WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
               WorkOrder.SETRANGE("Source Company", COMPANYNAME);
               WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
               WorkOrder.SETRANGE("Source No.", "No.");
               WorkOrder.SetOnDeleteSource();
               WorkOrder.DELETEALL(TRUE);

               SOPlantMaintenanceScheme.SETRANGE("Service Order No.", "No.");
               SOPlantMaintenanceScheme.DELETEALL(TRUE);

               ServiceOrderPlantPart.SETRANGE("Service Order No.", "No.");
               ServiceOrderPlantPart.DELETEALL;

               ServiceOrderPlantPartText.SETRANGE("Service Order No.", "No.");
               ServiceOrderPlantPartText.DELETEALL;

               IF Status IN [Status::Open, Status::Cancelled] THEN BEGIN
                 IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
                   PlantServiceOrder.CHANGECOMPANY("Plant Company");
                 PlantServiceOrder.SETCURRENTKEY("Service Order No.");
                 PlantServiceOrder.SETRANGE("Service Order No.", "No.");
                 IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
                   PlantServiceOrder.SETRANGE("Service Company", COMPANYNAME)
                 ELSE
                   PlantServiceOrder.SETRANGE("Service Company", '');
                 IF PlantServiceOrder.FINDSET(TRUE) THEN BEGIN
                   REPEAT
                     PlantServiceOrder."Service Order No." := '';
                     PlantServiceOrder.Processed := FALSE;
                     PlantServiceOrder."Process Date" := 0DT;
                     PlantServiceOrder."Processed By" := '' ;
                     PlantServiceOrder.MODIFY;
                   UNTIL PlantServiceOrder.NEXT = 0;
                 END;

                 IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
                   PlantMaintProposalLine.CHANGECOMPANY("Plant Company");
                 PlantMaintProposalLine.SETCURRENTKEY("Service Order No.");
                 PlantMaintProposalLine.SETRANGE("Service Order No.", "No.");
                 IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
                   PlantMaintProposalLine.SETRANGE("Service Company", COMPANYNAME)
                 ELSE
                   PlantMaintProposalLine.SETRANGE("Service Company", '');
                 IF PlantMaintProposalLine.FINDSET(TRUE) THEN BEGIN
                   REPEAT
                     PlantMaintProposalLine."Service Order No." := '';
                     PlantMaintProposalLine.MODIFY;
                   UNTIL PlantServiceOrder.NEXT = 0;
                 END;
               END;

               IF "Call No." <> '' THEN
                 IF ServiceCall.GET("Call No.") THEN
                   IF ServiceCall."Service Order No." = "No." THEN BEGIN
                     ServiceCall."Service Order No." := '';
                     ServiceCall.MODIFY(TRUE);
                   END;

               FIND('=');

               DimMgt.DeleteDefaultDim(DATABASE::"Service Order", "No."); //** 09-06-2010

               BuildRelationalStructure('DELETE');

               MobileItemUsage.SETRANGE("Source Type", MobileItemUsage."Source Type"::ServiceOrder);
               MobileItemUsage.SETRANGE("Source No.", "No.");
               MobileItemUsage.DELETEALL(TRUE);
               CommunicateOrderToFLS(3); //DP00703.n

               ServSourceProcStepCheck.SETRANGE(Type, ServSourceProcStepCheck.Type::"Service Order");
               ServSourceProcStepCheck.SETRANGE("Source No.", "No.");
               ServSourceProcStepCheck.DELETEALL(TRUE);

               PlantRequestSMF.SETCURRENTKEY("Source Type","Source No.");
               PlantRequestSMF.SETRANGE("Source Type", PlantRequestSMF."Source Type"::"Service Order");
               PlantRequestSMF.SETRANGE("Source No.", "No.");
               PlantRequestSMF.DELETEALL(TRUE);

               StoreDeletedData('D');
             END;

    OnRename=BEGIN
               ERROR(Text999);
             END;

    CaptionML=[ENU=Service Order;
               NOR=Serviceordre;
               SVE=Serviceorder];
    LookupPageID=Page11012830;
    DrillDownPageID=Page11012830;
  }
  FIELDS
  {
    { 10  ;   ;No.                 ;Code20        ;OnValidate=VAR
                                                                ServiceSourceTypeSetup@1100528600 : Record 11071726;
                                                              BEGIN
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  ServiceSourceTypeSetup.GET("Source Type");
                                                                  NoSeriesMgt.TestManual(ServiceSourceTypeSetup."No. Series");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr;
                                                              SVE=Nr] }
    { 15  ;   ;Description         ;Text50        ;OnValidate=BEGIN
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO(Description)); //C043234.n
                                                              END;

                                                   CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 17  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              NOR=Beskrivelse 2;
                                                              SVE=Beskrivning 2] }
    { 20  ;   ;Customer No.        ;Code20        ;TableRelation=Customer.No.;
                                                   OnValidate=VAR
                                                                ServiceCollectiveList@1100528600 : Record 11071730;
                                                                lvBillToCust@1100485000 : Code[20];
                                                              BEGIN
                                                                IF NOT CustRec.GET("Customer No.") THEN CustRec.INIT;
                                                                CustRec.CheckBlockedCustomerByTableNo(DATABASE::"Service Order", FIELDNO("Customer No."));

                                                                IF "Customer No." <> xRec."Customer No." THEN BEGIN   //evdb.sn
                                                                  "Contact Person No." := '';
                                                                  "Contact Person Name" := '';
                                                                  "Contact Person Gender" := "Contact Person Gender"::" ";
                                                                  TESTFIELD("Collective List No.", '');
                                                                END;                                                  //evdb.en

                                                                IF CurrFieldNo = FIELDNO("Customer No.") THEN BEGIN
                                                                  IF "Service Contract No." <> '' THEN
                                                                    TestCustomerContract;
                                                                  CheckOrderNoCustomer;
                                                                END;

                                                                IF "Customer No." <> xRec."Customer No." THEN BEGIN //mg, 28-12-10: M23158
                                                                  UpdateInvoiceDataBaseServiceOrderTree(FIELDNO("Customer No."));
                                                                  ValidateAddressData(1);
                                                                  CopyCustomerNotGlobalDims();  //*24651.n
                                                                  IF "Service Contract No." = '' THEN //mg, 03-10-12: C001213
                                                                    CopyExtraCost;
                                                                  IF "Customer No." <> '' THEN
                                                                    "Use Bill-To Cust. for Pr. Book" := CustRec."Use Bill-To Cust. for Pr. Book";
                                                                END;
                                                                CheckVATServOrder;

                                                                IF CustRec."Bill-to Customer No." <> '' THEN
                                                                  lvBillToCust := CustRec."Bill-to Customer No."
                                                                ELSE
                                                                  lvBillToCust := "Customer No.";
                                                                IF ("Bill-to Customer No." = '') OR ("Customer No." = '') THEN BEGIN  //db, 23-02-09: M13533
                                                                  VALIDATE("Bill-to Customer No.",lvBillToCust);
                                                                  CheckInvoiceAddress;
                                                                END;

                                                                IF ("Service Contract No." = '') AND ("Service Location No." = '') THEN BEGIN  //db, 09-04-10: M18890
                                                                  "VAT Prod. Posting Group" := CustRec."VAT Prod. Posting Group";
                                                                  "% Labor" := CustRec."% Labor";
                                                                  "% to B Account" := CustRec."% to B Account";
                                                                END;

                                                                IF CustRec."Payment Terms Code" <> '' THEN
                                                                  "Payment Terms Code" := CustRec."Payment Terms Code";

                                                                DetermineDiscountGroups;

                                                                UpdateCostPlus(FIELDNO("Customer No."));  //db, 08-12-10: M23704
                                                                UpdateSurchargeFields;

                                                                IF "Collective List No." <> '' THEN BEGIN
                                                                  ServiceCollectiveList.GET("Collective List No.");
                                                                  ServiceCollectiveList.TESTFIELD("Customer No.", "Customer No.");
                                                                END;

                                                                UpdateConfirmationLetter;
                                                                CheckTravelData;
                                                                DeterminePriceBookFields;
                                                                DetermineProcessStructure;
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   CaptionML=[ENU=Customer No.;
                                                              NOR=Kundenr;
                                                              SVE=Kundnr] }
    { 21  ;   ;Name                ;Text100       ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Name;
                                                              NOR=Navn;
                                                              SVE=Namn] }
    { 22  ;   ;Name 2              ;Text50        ;CaptionML=[ENU=Name 2;
                                                              NOR=Navn 2;
                                                              SVE=Namn 2] }
    { 23  ;   ;Address             ;Text100       ;OnValidate=VAR
                                                                lDummy@1210190000 : Text[30];
                                                              BEGIN
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   CaptionML=[ENU=Address;
                                                              NOR=Adresse;
                                                              SVE=Adress] }
    { 24  ;   ;Address 2           ;Text50        ;OnValidate=VAR
                                                                lDummy@1210190000 : Text[30];
                                                              BEGIN
                                                              END;

                                                   CaptionML=[ENU=Address 2;
                                                              NOR=Adresse 2;
                                                              SVE=Adress 2] }
    { 25  ;   ;City                ;Text30        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                IF ("Employee No." = '') AND (Subcontractor = '') THEN
                                                                  UpdateWorkOrderAnonymous;
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=City;
                                                              NOR=Poststed;
                                                              SVE=Ort] }
    { 26  ;   ;Post Code           ;Code20        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=VAR
                                                                PostCode@1210190000 : Record 225;
                                                              BEGIN
                                                                PostCode.ValidatePostCode(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                PostCode.GetTerritoryByPostCodeGroup(City,"Post Code","Territory Code");  //db, 11-02-13: C005566
                                                                IF "Post Code" <> xRec."Post Code" THEN
                                                                  CopyExtraCost;
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Post Code;
                                                              NOR=Postnr;
                                                              SVE=Postnr] }
    { 27  ;   ;Phone No.           ;Text30        ;OnValidate=BEGIN
                                                                FormatPhoneNumberWhenNotSynced("Phone No.");
                                                                IF CurrFieldNo = 0 THEN
                                                                  SyncServiceLocationData(FIELDNO("Phone No."))
                                                                ELSE
                                                                  SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No.;
                                                              NOR=Telefonnr;
                                                              SVE=Telefonnr] }
    { 28  ;   ;Customer Name       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Customer No.)));
                                                   CaptionML=[ENU=Customer Name;
                                                              NOR=Kundnavn;
                                                              SVE=Kundens namn];
                                                   Editable=No }
    { 30  ;   ;Your Reference      ;Text50        ;CaptionML=[ENU=Your Reference;
                                                              NOR=Din referanse;
                                                              SVE=Er referens] }
    { 31  ;   ;E-Mail              ;Text80        ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Email;
                                                              NOR=E-post;
                                                              SVE=E-post, undertecknare] }
    { 32  ;   ;Contact Name        ;Text100       ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Contact Name;
                                                              NOR=Kontaktnavn;
                                                              SVE=Kontaktnamn] }
    { 33  ;   ;County              ;Text30        ;CaptionML=[ENU=County;
                                                              NOR=Delstat;
                                                              SVE=Delstat];
                                                   Editable=Yes }
    { 34  ;   ;Country/Region Code ;Code10        ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Country/Region Code;
                                                              NOR=Lands-/regionkode;
                                                              SVE=Lands-/regionkod] }
    { 40  ;   ;Bill-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=VAR
                                                                Customer@1100528600 : Record 18;
                                                                DummyBool@1100529400 : Boolean;
                                                              BEGIN
                                                                IF "Bill-to Customer No." <> xRec."Bill-to Customer No." THEN BEGIN
                                                                  IF "Bill-to Customer No." <> "Customer No." THEN
                                                                    IF Customer.GET("Bill-to Customer No.") THEN BEGIN
                                                                      Customer.CheckBlockedCustomerByTableNo(DATABASE::"Service Order", FIELDNO("Bill-to Customer No."));
                                                                      IF Customer."Payment Terms Code" <> '' THEN
                                                                        "Payment Terms Code" := Customer."Payment Terms Code";
                                                                    END;
                                                                  "Bill-to Contact Person" := '';
                                                                  TESTFIELD("Collective List No.", '');
                                                                  CreateInvoiceText;
                                                                END;

                                                                ValidateAddressData(2);
                                                                ValidateBilltoContactPerson;
                                                                DetermineServiceType(FALSE, DummyBool);
                                                                "Currency Code" := DetermineCurrencyCode;
                                                                CheckVATServOrder;
                                                                IF "Bill-to Customer No." <> xRec."Bill-to Customer No." THEN BEGIN
                                                                  UpdateInvoiceDataBaseServiceOrderTree(FIELDNO("Bill-to Customer No."));
                                                                  IF Customer.GET("Bill-to Customer No.") THEN
                                                                    "Use Bill-To Cust. for Pr. Book" := Customer."Use Bill-To Cust. for Pr. Book";
                                                                END;
                                                                UpdateCostPlus(FIELDNO("Bill-to Customer No."));  //db, 08-12-10: M23704
                                                                IF "Service Contract No." = '' THEN
                                                                  DetermineAlternativeBilltoAddress;

                                                                IF ("Use Bill-To Cust. for Pr. Book" AND ("Bill-to Customer No." <> '')) OR
                                                                   ("Use Bill-To Cust. for Pr. Book" <> xRec."Use Bill-To Cust. for Pr. Book")
                                                                THEN
                                                                  DeterminePriceBookFields;
                                                              END;

                                                   CaptionML=[ENU=Bill-to Customer No.;
                                                              NOR=Faktureringskundenr;
                                                              SVE=Faktureringskundnr] }
    { 41  ;   ;Bill-to Name        ;Text100       ;CaptionML=[ENU=Bill-to Name;
                                                              NOR=Faktureringsnavn;
                                                              SVE=Faktureringsnamn];
                                                   Editable=No }
    { 42  ;   ;Bill-to Name 2      ;Text50        ;CaptionML=[ENU=Bill-to Name 2;
                                                              NOR=Faktureringsnavn 2;
                                                              SVE=Faktureringsnamn 2];
                                                   Editable=No }
    { 43  ;   ;Bill-to Address     ;Text100       ;CaptionML=[ENU=Bill-to Address;
                                                              NOR=Faktureringsadresse;
                                                              SVE=Faktureringsadress];
                                                   Editable=No }
    { 44  ;   ;Bill-to Address 2   ;Text50        ;CaptionML=[ENU=Bill-to Address 2;
                                                              NOR=Faktureringsadresse 2;
                                                              SVE=Faktureringsadress 2];
                                                   Editable=No }
    { 45  ;   ;Bill-to Post Code   ;Code20        ;TableRelation=IF (Bill-to Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Bill-to Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Bill-to Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(
                                                                  "Bill-to City",
                                                                  "Bill-to Post Code",
                                                                  "Bill-to County",
                                                                  "Bill-to Country/Region Code",
                                                                  (CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Bill-to Post Code;
                                                              NOR=Faktura til-postnr.;
                                                              SVE=Faktureras postnr];
                                                   Editable=No }
    { 46  ;   ;Bill-to City        ;Text30        ;TableRelation=IF (Bill-to Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Bill-to Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Bill-to Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(
                                                                  "Bill-to City",
                                                                  "Bill-to Post Code",
                                                                  "Bill-to County",
                                                                  "Bill-to Country/Region Code",
                                                                  (CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Bill-to City;
                                                              NOR=Faktureringsby;
                                                              SVE=Faktureras ort];
                                                   Editable=No }
    { 48  ;   ;Bill-to County      ;Text30        ;CaptionML=[ENU=Bill-to County;
                                                              NOR=Faktureres Fylke;
                                                              SVE=Faktureras delstat];
                                                   Editable=Yes }
    { 49  ;   ;Bill-to Country/Region Code;Code10 ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Bill-to Country/Region Code;
                                                              NOR=Kode for Faktureringsland/-Region;
                                                              SVE=Faktureringsland/-region] }
    { 50  ;   ;Order Date          ;Date          ;OnValidate=BEGIN
                                                                IF ("Order Date" > "Starting Date") AND ("Starting Date" <> 0D) THEN
                                                                  IF (CurrFieldNo = 0) OR NOT (CurrFieldNo IN [FIELDNO("Starting Date"), FIELDNO("Ending Date")]) THEN
                                                                    FIELDERROR("Order Date",STRSUBSTNO(Text000,FIELDCAPTION("Starting Date")))
                                                                  ELSE
                                                                    IF GUIALLOWED AND (CurrFieldNo <> FIELDNO("Ending Date")) THEN
                                                                      IF NOT CONFIRM(Text119, FALSE, FIELDCAPTION("Starting Date"), FIELDCAPTION("Order Date")) THEN
                                                                        ERROR('');
                                                                IF CurrFieldNo = FIELDNO("Order Date") THEN FIELDERROR("Order Date");  //db, 12-04-07 (because of editable form 11020671)
                                                                IF (xRec."Order Date" <> "Order Date") AND ("Source Type" <> "Source Type"::Contract) THEN
                                                                  "Service Control Period Date" := "Order Date";
                                                              END;

                                                   CaptionML=[ENU=Order Date;
                                                              NOR=Ordredato;
                                                              SVE=Orderdatum];
                                                   NotBlank=Yes;
                                                   Editable=No }
    { 51  ;   ;Order Time          ;Time          ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Order Time") THEN FIELDERROR("Order Time");  //db, 12-04-07 (because of editable form 11020671)
                                                              END;

                                                   CaptionML=[ENU=Order Time;
                                                              NOR=Ordretidspunkt;
                                                              SVE=Ordertid];
                                                   NotBlank=Yes;
                                                   Editable=No }
    { 52  ;   ;Starting Date       ;Date          ;OnValidate=BEGIN
                                                                VALIDATE("Order Date");
                                                                //db.sn, 04-10-10: M23012
                                                                IF ("Starting Date" > "Ending Date") AND ("Ending Date" <> 0D) THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Starting Date") THEN BEGIN
                                                                    "Ending Date" := 0D;
                                                                    "Ending Time" := 0T;
                                                                  END ELSE BEGIN
                                                                    FIELDERROR("Starting Date",STRSUBSTNO(Text000,FIELDCAPTION("Ending Date")));
                                                                  END;
                                                                END;
                                                                //db.en, 04-10-10: M23012

                                                                CheckPlanDateTime;
                                                                CheckPlanDataFSA;
                                                                IF "Starting Date" = 0D THEN BEGIN
                                                                  "Starting Time" := 0T;
                                                                  "Ending Date" := 0D;
                                                                  "Ending Time" := 0T;
                                                                END;
                                                                CheckFirmPlannedPlanDates;
                                                                CheckPlanPeriod();
                                                                EvaluateStartingTime;
                                                                IF "Starting Date" <> xRec."Starting Date" THEN
                                                                  ServLogRec.StoreChange(2, "No.", ServLogRec.FormatDescription(FIELDCAPTION("Starting Date"), FORMAT(xRec."Starting Date"), FORMAT("Starting Date")));
                                                                UpdateFirstLastPossibleFields;
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO("Starting Date")); //C043234.n
                                                                UpdateAppointmentConfirmationResend;
                                                                SendDspPlanMessage;

                                                                IF MODIFY(TRUE) THEN
                                                                  UpdateContractArrangements;
                                                              END;

                                                   CaptionML=[ENU=Starting Date;
                                                              NOR=Startdato;
                                                              SVE=Startdatum] }
    { 53  ;   ;Starting Time       ;Time          ;OnValidate=BEGIN
                                                                CheckPlanDateTime;
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                CheckPlanPeriod();
                                                                IF "Starting Time" <> xRec."Starting Time" THEN
                                                                  ServLogRec.StoreChange(2, "No.", ServLogRec.FormatDescription(FIELDCAPTION("Starting Time"), FORMAT(xRec."Starting Time"), FORMAT("Starting Time")));
                                                                UpdateFirstLastPossibleFields;
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO("Starting Time")); //C043234.n
                                                                UpdateAppointmentConfirmationResend;
                                                                SendDspPlanMessage;
                                                              END;

                                                   CaptionML=[ENU=Starting Time;
                                                              NOR=Starttid;
                                                              SVE=Starttid] }
    { 54  ;   ;Ending Date         ;Date          ;OnValidate=BEGIN
                                                                SkipPlanCu := TRUE;
                                                                VALIDATE("Starting Date");
                                                                SkipPlanCu := FALSE;

                                                                CheckPlanDateTime;
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                UpdateFirstLastPossibleFields;
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO("Ending Date")); //C043234.n
                                                                SendDspPlanMessage;
                                                              END;

                                                   CaptionML=[ENU=Ending Date;
                                                              NOR=Sluttdato;
                                                              SVE=Slutdatum] }
    { 55  ;   ;Ending Time         ;Time          ;OnValidate=BEGIN
                                                                CheckPlanDateTime;
                                                                CheckPlanDataFSA;
                                                                CheckFirmPlannedPlanDates;
                                                                CheckPlanPeriod();
                                                                UpdateFirstLastPossibleFields;
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO("Ending Time")); //C043234.n
                                                                SendDspPlanMessage;
                                                              END;

                                                   CaptionML=[ENU=Ending Time;
                                                              NOR=Sluttid;
                                                              SVE=Sluttid] }
    { 56  ;   ;Expected Hours      ;Decimal       ;OnValidate=BEGIN
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO("Expected Hours")); //C043234.n
                                                                DetermineLimitBudgetExceeded;
                                                              END;

                                                   CaptionML=[ENU=Expected Hours;
                                                              NOR=Forventede timer;
                                                              SVE=Frvntade timmar];
                                                   DecimalPlaces=0:5 }
    { 57  ;   ;Modified on         ;Date          ;CaptionML=[ENU=Modified on;
                                                              NOR=Endret den;
                                                              SVE=ndrad den];
                                                   Editable=No }
    { 58  ;   ;Modified by         ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190001 : Code[50];
                                                              UserMgt@1210190000 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Modified by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=ndrad av];
                                                   Editable=No }
    { 59  ;   ;Assigned to         ;Code20        ;TableRelation=Employee.No.;
                                                   OnValidate=VAR
                                                                Employee@1100529600 : Record 5200;
                                                                CUFunc@1100285300 : Codeunit 11128007;
                                                              BEGIN
                                                                Employee.CheckEmployeeStatus("Assigned to", "Order Date");
                                                                //<< ITERO.PR 150928
                                                                IF "Assigned to" <> '' THEN BEGIN
                                                                  CUFunc.SOOrderManager(Rec,"Assigned to");
                                                                END;
                                                                //>> ITERO.PR 150928
                                                              END;

                                                   CaptionML=[ENU=Assigned to;
                                                              NOR=Tilordnet;
                                                              SVE=Tilldelat till] }
    { 60  ;   ;Service Contract No.;Code20        ;TableRelation=Service-Contract.No.;
                                                   OnValidate=VAR
                                                                PurchaseLine@1100525000 : Record 39;
                                                                ItemJnlLine@1100525001 : Record 83;
                                                                HourAccountingLine@1100525002 : Record 11012039;
                                                                ServiceType@1100529401 : Record 11012814;
                                                                Employee@1100525003 : Record 5200;
                                                                ServiceSetup@1100528601 : Record 11012800;
                                                                ServiceSurchargeManagement@1100528600 : Codeunit 11012834;
                                                                ServiceTypeFromSCSourceType@1100529400 : Boolean;
                                                              BEGIN
                                                                TESTFIELD("Plant Location",''); //DP00195
                                                                CheckServOrderAuthorization(FIELDCAPTION("Service Contract No."));

                                                                IF "Service Contract No." <> xRec."Service Contract No." THEN
                                                                  TESTFIELD("Collective List No.", '');

                                                                IF CurrFieldNo <> 0 THEN
                                                                  IF "Source Type" = "Source Type"::Contract THEN
                                                                    IF xRec."Service Contract No." <> '' THEN //mg, 12-04-11: M25869
                                                                      TESTFIELD("Service Contract No.", xRec."Service Contract No.");  //db, 23-03-10: M18554

                                                                DetermineObjectNo;  //db, 16-03-15: C019952
                                                                IF ServContrRec.GET("Service Contract No.") THEN BEGIN
                                                                  TestSLandSCCombination;

                                                                  SkipDeterminePriceBookFields := TRUE;
                                                                  ServSetup.GET;
                                                                  IF ServContrRec."Customer No." <> '' THEN //C032186.n
                                                                    VALIDATE("Customer No.", ServContrRec."Customer No.");
                                                                  DetermineBilltoCustomerbySC;
                                                                  CheckContractStatus(ServContrRec);  //db, 10-06-10: M19645
                                                                  //db.sn, 12-04-13: C006839
                                                                  IF "Service Contract No." <> xRec."Service Contract No." THEN BEGIN
                                                                    //force update from contract or SourceTypeSetup (object)
                                                                    "Service Type (Other)" := '';
                                                                    "Service Type" := '';
                                                                  END;
                                                                  //db.en, 12-04-13: C006839
                                                                  DetermineServicePackage;
                                                                  DetermineServiceType(FALSE, ServiceTypeFromSCSourceType);
                                                                  IF "Service Type" = '' THEN BEGIN
                                                                    VALIDATE("Service Type", ServContrRec."Service Type");
                                                                    VALIDATE("Service Type (Other)", ServContrRec."Service Type (Other)");
                                                                  END;

                                                                  IF "Service Contract No." <> xRec."Service Contract No." THEN //C032213
                                                                    CopyDefaultDimFromContract;  //db, 14-09-11: M28816
                                                                  IF NOT ServiceType.GET("Service Type") THEN
                                                                    ServiceType.INIT;
                                                                  ServiceSetup.GET;
                                                                  IF NOT ServiceTypeFromSCSourceType OR (ServiceType."Department Code" = '') OR ServiceSetup."Use Dep. Code from Contract" THEN BEGIN
                                                                    "Department Code (Other)" := ServContrRec."Department Code (Other)";
                                                                    VALIDATE("Global Dimension 1 Code", ServContrRec."Global Dimension 1 Code");
                                                                  END;
                                                                  CheckDimension;
                                                                  DetermineDiscountGroups;
                                                                  IF ServContrRec."Payment Terms Code" <> '' THEN                                       // ek, 14-05-13: W051546.n
                                                                    "Payment Terms Code" := ServContrRec."Payment Terms Code";                          // ek, 14-05-13: W051546.n
                                                                  IF "Your Reference" = '' THEN //mg, 20-12-11: M31690
                                                                    "Your Reference" := ServContrRec."Your Reference";
                                                                  IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::ContractMgt THEN
                                                                    VALIDATE("Order Manager", ServContrRec."Contract Manager");  //db, 06-01-09
                                                                  IF ServSetup."Assign To" = ServSetup."Assign To"::ContractMgt THEN
                                                                    IF (ServContrRec."Contract Manager" = '') OR Employee.GET(ServContrRec."Contract Manager") THEN
                                                                      VALIDATE("Assigned to", ServContrRec."Contract Manager");
                                                                  CheckContrDiscAdditionalCost;  //db, 04-02-10
                                                                  "Currency Code" := DetermineCurrencyCode;
                                                                  "Use Bill-To Cust. for Pr. Book" := ServContrRec."Use Bill-To Cust. for Pr. Book";
                                                                  CheckVATServOrder;
                                                                  CheckVATReverse(FALSE,FALSE);
                                                                  CheckInternalCharge;  //db, 20-05-11
                                                                  DetermineLimitBudget;
                                                                  DetermineInvoiceBaseAmount;
                                                                  CheckContractServBudget(1);
                                                                  CopyExtraCost;
                                                                  CheckTravelData;
                                                                  ServiceSurchargeManagement.CopySurchargeLinesToSO(Rec);
                                                                  "Additional Cost" := DetermineAdditionalCost;
                                                                  UpdateSurchargeFields;
                                                                  TestSCPeriodClosed;
                                                                  FillSubcontractor;
                                                                  FillPreferredEmployee;
                                                                  DetermineServiceCategory;
                                                                  SkipDeterminePriceBookFields := FALSE;
                                                                  DeterminePriceBookFields;

                                                                  //update tables where service contract no. is not a flowfield (M16794)
                                                                  IF "No." <> '' THEN BEGIN  //db, 06-04-10: M18963
                                                                    PurchaseLine.SETCURRENTKEY("Document Type","Service Order No.");
                                                                    PurchaseLine.SETRANGE("Service Order No.", "No.");
                                                                    IF NOT PurchaseLine.ISEMPTY THEN BEGIN
                                                                      IF PurchaseLine.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                        REPEAT
                                                                          PurchaseLine."Service Contract No." := "Service Contract No.";
                                                                          PurchaseLine.MODIFY(TRUE);
                                                                        UNTIL PurchaseLine.NEXT = 0;
                                                                      END;
                                                                    END;

                                                                    ItemJnlLine.SETCURRENTKEY("Service Order No.");
                                                                    ItemJnlLine.SETRANGE("Service Order No.", "No.");
                                                                    IF NOT ItemJnlLine.ISEMPTY THEN BEGIN
                                                                      IF ItemJnlLine.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                        REPEAT
                                                                          ItemJnlLine."Service Contract No." := "Service Contract No.";
                                                                          ItemJnlLine.MODIFY(TRUE);
                                                                        UNTIL ItemJnlLine.NEXT = 0;
                                                                      END;
                                                                    END;

                                                                    HourAccountingLine.SETCURRENTKEY("Service Order No.");
                                                                    HourAccountingLine.SETRANGE("Service Order No.", "No.");
                                                                    IF NOT HourAccountingLine.ISEMPTY THEN BEGIN
                                                                      IF HourAccountingLine.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                        REPEAT
                                                                          HourAccountingLine."Service Contract No." := "Service Contract No.";
                                                                          //db.sn, 12-09-13: C008074
                                                                          //HourAccountingLine."Additional Cost (Service)" := "Additional Cost";
                                                                          HourAccountingLine."Additional Cost (Service)" :=
                                                                            GetAdditionalCostService("No.", HourAccountingLine."Cost Object", HourAccountingLine."Cost Type" +1, COMPANYNAME, HourAccountingLine);
                                                                          IF HourAccountingLine."Additional Cost (Service)" THEN
                                                                            HourAccountingLine."Department Code" := "Department Code (Other)"
                                                                          ELSE
                                                                            HourAccountingLine."Department Code" := "Global Dimension 1 Code";
                                                                          //db.en, 12-09-13: C008074
                                                                          HourAccountingLine.MODIFY(TRUE);
                                                                        UNTIL HourAccountingLine.NEXT = 0;
                                                                      END;
                                                                    END;
                                                                  END;
                                                                END ELSE
                                                                  IF "Service Contract No." = '' THEN BEGIN
                                                                    VALIDATE("Service Location No.");
                                                                    DetermineServiceType(FALSE, ServiceTypeFromSCSourceType);
                                                                    IF "Service Contract No." <> xRec."Service Contract No." THEN
                                                                      CopyExtraCost;
                                                                  END;
                                                                UpdateConfirmationLetter;
                                                                UpdateExtraWorkOrderFields;
                                                                DetermineProcessStructure;
                                                                UpdateReferencePeriodServContractNo(ServContrRec);
                                                              END;

                                                   CaptionML=[ENU=Service Contract No.;
                                                              NOR=Servicekontraktnr;
                                                              SVE=Servicekontraktnr] }
    { 61  ;   ;Service Package     ;Code10        ;TableRelation="Service Package";
                                                   OnValidate=BEGIN
                                                                //db, 04-02-10: where-condition on source type removed
                                                                IF ServPackRec.GET("Service Package") THEN
                                                                  IF ServPackRec."Source Type" <> ServPackRec."Source Type"::None THEN
                                                                    ServPackRec.TESTFIELD("Source Type", "Source Type");
                                                              END;

                                                   CaptionML=[ENU=Service Package;
                                                              NOR=Servicepakke;
                                                              SVE=Servicepaket] }
    { 62  ;   ;Service Contract Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Contract.Description WHERE (No.=FIELD(Service Contract No.)));
                                                   CaptionML=[ENU=Service Contract Description;
                                                              NOR=Servicekontraktsbeskrivelse;
                                                              SVE=Servicekontraktsbeskrivning];
                                                   Editable=No }
    { 63  ;   ;Modified on (Time)  ;Time          ;CaptionML=[ENU=Modified on (Time);
                                                              NOR=Endret den (tid);
                                                              SVE=ndrad den (tid)];
                                                   Editable=No }
    { 65  ;   ;Service Location No.;Code20        ;TableRelation="Service Location".No.;
                                                   OnValidate=BEGIN
                                                                CheckServOrderAuthorization(FIELDCAPTION("Service Location No."));
                                                                SkipDeterminePriceBookFields := TRUE;
                                                                //db.sn, 16-03-15: C019952
                                                                IF (CurrFieldNo <> 0) AND (CurrFieldNo <> FIELDNO("Service Contract No.")) THEN BEGIN
                                                                  IF ("Service Contract No." = '') AND ("Plant Location" = '') THEN
                                                                    DetermineContractNo;
                                                                  DetermineObjectNo;
                                                                END;
                                                                //db.en, 16-03-15: C019952
                                                                TestSLandSCCombination;
                                                                ValidateAddressData(1);
                                                                ValidateOtherData;
                                                                DetermineBilltoCustomerbySC;
                                                                ValidateBilltoContactPerson;
                                                                DetermineLimitBudget;
                                                                //4PSSE.sn #15039
                                                                ServSetup.GET;
                                                                IF NOT ServSetup."Dont replace Dim1 fr ServLoc" THEN
                                                                //4PSSE.en #15039
                                                                  CheckDimension;
                                                                DetermineDiscountGroups;
                                                                DetermineTenantID;
                                                                CheckVATServOrder;
                                                                CheckVATReverse(FALSE,FALSE);
                                                                CheckInternalCharge;  //db, 20-05-11
                                                                CheckContractServBudget(0);
                                                                CALCFIELDS("Project No.");
                                                                IF "Service Location No." <> xRec."Service Location No." THEN
                                                                  UpdatePrefLocations;
                                                                UpdateCostPlus(FIELDNO("Service Location No."));  //db, 08-12-10: M23704
                                                                ReplaceServiceOrderLocations;
                                                                SkipDeterminePriceBookFields := FALSE;
                                                                DeterminePriceBookFields;
                                                                MODIFY; //mg
                                                                CheckTravelData;

                                                                UpdateVessel; //kkleermaker.n, 110817, M28697
                                                                FillSubcontractor;
                                                                FillPreferredEmployee;
                                                                FillMasterProjectFromServiceLocation;
                                                                MODIFY;
                                                                IF ("Employee No." = '') AND (Subcontractor = '') THEN
                                                                  UpdateWorkOrderAnonymous;
                                                              END;

                                                   CaptionML=[ENU=Service Location No.;
                                                              NOR=Servicelokasjon Nr.;
                                                              SVE=Serviceplatsnr] }
    { 66  ;   ;Territory Code      ;Code10        ;TableRelation=Territory;
                                                   OnValidate=BEGIN
                                                                DetermineServiceClusterBySourceType;
                                                              END;

                                                   CaptionML=[ENU=Territory Code;
                                                              NOR=Distriktskode;
                                                              SVE=Distriktskod] }
    { 67  ;   ;Remote Control      ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Remote Control" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Remote Control;
                                                              NOR=Fjernkontroll;
                                                              SVE=Fjrrkontroll];
                                                   Editable=No }
    { 68  ;   ;Service Location Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location".Description WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Service Location Description;
                                                              NOR=Servicelokasjonbeskrivelse;
                                                              SVE=Serviceplatsbeskrivning];
                                                   Editable=No }
    { 69  ;   ;Service Type (Other);Code20        ;TableRelation="Service Type";
                                                   OnValidate=BEGIN
                                                                CheckServOrderAuthorization(FIELDCAPTION("Service Type (Other)"));

                                                                ServSetup.GET;
                                                                IF ServSetup."Copy Additional Cost Setup" THEN BEGIN
                                                                  TESTFIELD("Service Type (Other)", "Service Type");
                                                                  VALIDATE("Department Code (Other)", "Global Dimension 1 Code");
                                                                END ELSE BEGIN
                                                                  IF ServTypeRec.GET("Service Type (Other)") THEN
                                                                    IF ServTypeRec."Department Code" <> '' THEN
                                                                      IF ("Service Contract No." = '') OR NOT ServSetup."Use Dep. Code from Contract" THEN
                                                                        VALIDATE("Department Code (Other)", ServTypeRec."Department Code");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Service Type (Additional Cost);
                                                              NOR=Servicetype (Tilleggskost);
                                                              SVE=Servicetyp (extra kostnad)] }
    { 70  ;   ;Service Type        ;Code20        ;TableRelation="Service Type";
                                                   OnValidate=VAR
                                                                ServiceSurchargeManagement@1210190000 : Codeunit 11012834;
                                                              BEGIN
                                                                CheckServOrderAuthorization(FIELDCAPTION("Service Type"));

                                                                ServSetup.GET;
                                                                IF ServSetup."Copy Additional Cost Setup" THEN
                                                                  VALIDATE("Service Type (Other)", "Service Type");
                                                                IF ServTypeRec.GET("Service Type") THEN
                                                                  IF ServTypeRec."Department Code" <> '' THEN
                                                                    IF ("Service Contract No." = '') OR NOT ServSetup."Use Dep. Code from Contract" THEN
                                                                      VALIDATE("Global Dimension 1 Code", ServTypeRec."Department Code");

                                                                ServiceSurchargeManagement.CopySurchargeLinesToSO(Rec);
                                                              END;

                                                   CaptionML=[ENU=Service Type;
                                                              NOR=Servicetype;
                                                              SVE=Servicetyp] }
    { 71  ;   ;Status              ;Option        ;OnValidate=VAR
                                                                CloseProjectService@1100528600 : Codeunit 11012046;
                                                              BEGIN
                                                                OnBeforeValidateStatus(Rec,xRec);  //181204, RAD108
                                                                //db.sn, 07-04-11
                                                                IF (Status = Status::"Technical Finished") OR (Status = Status::"Administrative Finished") THEN
                                                                  IF "Closing Date" = 0D THEN BEGIN
                                                                    "Closing Date" := TODAY;
                                                                    UpdateWorkOrderInfo(-10);
                                                                  END;
                                                                IF (Status = Status::"Administrative Finished") AND GUIALLOWED THEN
                                                                  CloseProjectService.CheckOpenPurchase("No.");
                                                                ServLogRec.StoreChange(2, "No.", ServLogRec.FormatDescription(FIELDCAPTION(Status), FORMAT(xRec.Status), FORMAT(Status)));
                                                                //db.en, 07-04-11

                                                                IF (CurrFieldNo = FIELDNO(Status)) AND (Status <> xRec.Status) THEN
                                                                  HandleStatusChange;
                                                                HandleStatusChangeLinkedOrders;
                                                                UpdateSOPlantMaintSchemesOnTechFinished(xRec.Status);
                                                              END;

                                                   CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=[ENU=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                                    NOR=pne,,Under behandling,Teknisk ferdig,Administrativt ferdig,Ferdig,Avbrutt;
                                                                    SVE=ppna,,Under behandling,Tekniskt frdig,Administrativt frdig,Frdig,Avbrutet];
                                                   OptionString=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled }
    { 72  ;   ;Priority            ;Code10        ;TableRelation="Service Priority" WHERE (Contract Filter=FIELD(Service Contract No.));
                                                   OnValidate=BEGIN
                                                                IF "Service Contract No." + "Customer No." <> '' THEN
                                                                  CopyExtraCost;

                                                                ServLogRec.StoreChange(2, "No.", ServLogRec.FormatDescription(FIELDCAPTION(Priority), xRec.Priority, Priority));

                                                                OnAfterValidatePriority(Rec,xRec); //4PSSE
                                                              END;

                                                   CaptionML=[ENU=Priority;
                                                              NOR=Prioritet;
                                                              SVE=Prioritet] }
    { 80  ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr-serie;
                                                              SVE=Nr-serier];
                                                   Editable=No }
    { 81  ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line" WHERE (Table Name=CONST(Service Order),
                                                                                           No.=FIELD(No.)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 82  ;   ;Debrief Comment     ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Debrief Text" WHERE (Type=CONST(ServiceOrder),
                                                                                           No.=FIELD(No.),
                                                                                           Finished=CONST(No)));
                                                   CaptionML=[ENU=Debrief Text;
                                                              NOR=Debrieftekst;
                                                              SVE=Avrapportera text];
                                                   Editable=No }
    { 85  ;   ;Source Type         ;Option        ;InitValue=Direct;
                                                   CaptionML=[ENU=Source Type;
                                                              NOR=Kildetype;
                                                              SVE=Ursprungstyp];
                                                   OptionCaptionML=[ENU=Call,Contract,Direct,Estimate,,,Modification,Replacement;
                                                                    NOR=Samtale,Kontrakt,Direkte,Kalkyle,,,Endring,Erstatning;
                                                                    SVE=Samtal,Kontrakt,Direkt,Kalkyl,,,ndring,Ersttning];
                                                   OptionString=Call,Contract,Direct,Estimate,,,Modification,Replacement;
                                                   Editable=No }
    { 95  ;   ;Comment (Problem Text);Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Order),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(90)));
                                                   CaptionML=[ENU=Comment (Problem Text);
                                                              NOR=Kommentar (problemtekst);
                                                              SVE=Kommentar (problem text)];
                                                   Editable=No }
    { 96  ;   ;Comment (Internal Text);Boolean    ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Order),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(91)));
                                                   CaptionML=[ENU=Comment (Internal Text);
                                                              NOR=Kommentar (intern tekst);
                                                              SVE=Kommentar (intern text)];
                                                   Editable=No }
    { 97  ;   ;Comment (Solution Text);Boolean    ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Order),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(92)));
                                                   CaptionML=[ENU=Comment (Solution Text);
                                                              NOR=Kommentar (lsningstekst);
                                                              SVE=Kommentar (lsningstext)];
                                                   Editable=No }
    { 98  ;   ;Comment (Invoice Text);Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Order),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(93)));
                                                   CaptionML=[ENU=Comment (Invoice Text);
                                                              NOR=Kommentar (fakturatekst);
                                                              SVE=Kommentar (fakturatext)];
                                                   Editable=No }
    { 99  ;   ;Comment (Cause Text);Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Order),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(94)));
                                                   CaptionML=[ENU=Comment (Cause Text);
                                                              NOR=Kommentar (rsakstekst);
                                                              SVE=Kommentar (orsakstext)];
                                                   Editable=No }
    { 100 ;   ;Call No.            ;Code20        ;TableRelation="Service Call".No.;
                                                   CaptionML=[ENU=Call No.;
                                                              NOR=Samtalenr;
                                                              SVE=Samtalsnr];
                                                   Editable=No }
    { 101 ;   ;Glazing Service Call No.;Code20    ;TableRelation="Glazing Service Call";
                                                   CaptionML=[ENU=Glazing Service Call No.;
                                                              NOR=Servicesamtalenr. for Innglassing;
                                                              SVE=Servicesamtalsnr fr inglasning];
                                                   Editable=No }
    { 105 ;   ;Description Call    ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Call".Description WHERE (No.=FIELD(Call No.)));
                                                   CaptionML=[ENU=Description Call;
                                                              NOR=Beskrivelse, samtale;
                                                              SVE=Beskrivning, samtal];
                                                   Editable=No }
    { 110 ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=BEGIN
                                                                CheckVATReverse(TRUE,FALSE);
                                                                UpdateCostPlus(FIELDNO("VAT Prod. Posting Group"));  //db, 08-12-10: M23704
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Moms produktbokfringsmal;
                                                              SVE=Moms produktbokfringsmall] }
    { 120 ;   ;Order Kind          ;Code10        ;TableRelation="Service Order Indication".Code WHERE (Indication=CONST(Kind));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Description Order Kind", "Flow FSA");
                                                                CheckContrDiscAdditionalCost;  //db, 04-02-10
                                                                CheckExpectedHours(0, "Order Kind");
                                                                IF xRec."Order Kind" <> "Order Kind" THEN BEGIN
                                                                  UpdateCostPlusEntryDiscount;
                                                                  UpdateServiceCategory;
                                                                  DetermineServiceClusterBySourceType;
                                                                END;
                                                                DetermineProcessStructure;
                                                                DetermineCostComponentPlant;
                                                              END;

                                                   CaptionML=[ENU=Order Kind;
                                                              NOR=Type ordre;
                                                              SVE=Ordertyp] }
    { 121 ;   ;Description Order Kind;Text30      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Indication".Description WHERE (Indication=CONST(Kind),
                                                                                                                    Code=FIELD(Order Kind)));
                                                   CaptionML=[ENU=Description Order Kind;
                                                              NOR=Beskrivelse av ordretype;
                                                              SVE=Beskrivning ordertyp];
                                                   Editable=No }
    { 122 ;   ;Flow FSA            ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Indication"."Flow FSA" WHERE (Indication=CONST(Kind),
                                                                                                                   Code=FIELD(Order Kind)));
                                                   CaptionML=[ENU=Flow Field Service;
                                                              NOR=Flyt, feltservice;
                                                              SVE=Flde, fltservice];
                                                   Editable=No }
    { 125 ;   ;Order Type          ;Code10        ;TableRelation="Service Order Indication".Code WHERE (Indication=CONST(Type));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Description Order Type");
                                                                CheckContrDiscAdditionalCost;  //db, 04-02-10
                                                                CheckExpectedHours(1, "Order Type");
                                                                DetermineProcessStructure;
                                                                DetermineServiceClusterBySourceType;
                                                              END;

                                                   CaptionML=[ENU=Order Type;
                                                              NOR=Ordretype;
                                                              SVE=Typ av order] }
    { 126 ;   ;Description Order Type;Text30      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Indication".Description WHERE (Indication=CONST(Type),
                                                                                                                    Code=FIELD(Order Type)));
                                                   CaptionML=[ENU=Description Order Type;
                                                              NOR=Beskrivelse av ordretype;
                                                              SVE=Beskrivning av ordertyp];
                                                   Editable=No }
    { 130 ;   ;Alternative Bill-to Address;Code10 ;TableRelation="Ship-to Address".Code WHERE (Customer No.=FIELD(Bill-to Customer No.),
                                                                                               Billing Address=CONST(Yes));
                                                   OnValidate=BEGIN
                                                                IF "Alternative Bill-to Address" <> xRec."Alternative Bill-to Address" THEN
                                                                  TESTFIELD("Collective List No.", '');
                                                                CheckInvoiceAddress;
                                                                IF "Alternative Bill-to Address" <> xRec."Alternative Bill-to Address" THEN
                                                                  UpdateInvoiceDataBaseServiceOrderTree(FIELDNO("Alternative Bill-to Address"));
                                                                UpdateCostPlus(FIELDNO("Alternative Bill-to Address"));
                                                              END;

                                                   CaptionML=[ENU=Alternative Bill-to Address;
                                                              NOR=Alternativ Faktureringsadresse;
                                                              SVE=Alternativ faktureringsadress] }
    { 140 ;   ;Collect Invoices By OLD;Option     ;CaptionML=ENU=Collect Invoices By OLD;
                                                   OptionCaptionML=[ENU=Service Order,Service Location,Service Contract,Customer,Call,Orderno. Customer,Base Service Order;
                                                                    NOR=Serviceordre,Servicelokasjon,Servicekontrakt,Kunde,Samtale,Ordrenr. Kunde,Baseserviceordre;
                                                                    SVE=Serviceorder,Serviceplats,Servicekontrakt,Kund,Samtal,Ordernr Kund,Basserviceorder];
                                                   OptionString=ServOrder,ServLocation,ServContract,Customer,Call,CustOrder,BaseOrder;
                                                   Description=OBSOLETE }
    { 150 ;   ;Problem             ;Code10        ;TableRelation="Service Analysis".Code WHERE (Analysis Type=CONST(Problem));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Description Problem");
                                                                IF xRec.Problem <> Problem THEN BEGIN
                                                                  InsertServiceText(0, Problem, 90);  //DP00106: FIELDNO("Problem Text")
                                                                  UpdateCustomerProblem;
                                                                  UpdateServAnalysisNotGlobDims;
                                                                  UpdateCostPlusEntryDiscount;
                                                                  ApplyProblemCodeAdditionalInfo;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceAnalysis@1100409000 : Record 11012842;
                                                              ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
                                                              ServiceContractInfoMgt@1100528601 : Codeunit 11012842;
                                                            BEGIN
                                                              GetFilteredProblemsOnDisciplines(ServiceAnalysis);
                                                              ServiceUnitPriceManagement.GetProblemsDS("Customer No.", "Service Location Type", "Room (SUP)", "Part (SUP)", ServiceAnalysis);
                                                              ServiceContractInfoMgt.GetFilteredAnalysisByContract("Service Contract No.", ServiceAnalysis."Analysis Type"::Problem, ServiceAnalysis);
                                                              IF Problem <> '' THEN BEGIN
                                                                ServiceAnalysis."Analysis Type" := ServiceAnalysis."Analysis Type"::Problem;
                                                                ServiceAnalysis.Code := Problem;
                                                              END;
                                                              IF PAGE.RUNMODAL(PAGE::"Service Analysis (Problem)", ServiceAnalysis) = ACTION::LookupOK THEN
                                                                VALIDATE(Problem, ServiceAnalysis.Code);
                                                            END;

                                                   CaptionML=[ENU=Problem;
                                                              NOR=Problem;
                                                              SVE=Problem] }
    { 151 ;   ;Description Problem ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Analysis".Description WHERE (Analysis Type=CONST(Problem),
                                                                                                            Code=FIELD(Problem)));
                                                   CaptionML=[ENU=Description Problem;
                                                              NOR=Beskrivelse av problem;
                                                              SVE=Beskrivning av problem];
                                                   Editable=No }
    { 160 ;   ;Cause               ;Code10        ;TableRelation="Service Analysis".Code WHERE (Analysis Type=CONST(Cause));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Description Cause");
                                                                IF xRec.Cause <> Cause THEN BEGIN
                                                                  InsertServiceText(1, Cause, 94);  //DP00106: FIELDNO("Cause Text")
                                                                  UpdateCostPlusEntryDiscount;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceAnalysis@1100409001 : Record 11012842;
                                                              ServiceContractInfoMgt@1100528600 : Codeunit 11012842;
                                                            BEGIN
                                                              GetFilteredCausesByProblem(Problem, ServiceAnalysis);
                                                              ServiceContractInfoMgt.GetFilteredAnalysisByContract("Service Contract No.", ServiceAnalysis."Analysis Type"::Cause, ServiceAnalysis);
                                                              IF Cause <> '' THEN BEGIN
                                                                ServiceAnalysis."Analysis Type" := ServiceAnalysis."Analysis Type"::Cause;
                                                                ServiceAnalysis.Code := Cause;
                                                              END;
                                                              IF PAGE.RUNMODAL(PAGE::"Service Analysis (Cause)", ServiceAnalysis) = ACTION::LookupOK THEN
                                                                VALIDATE(Cause, ServiceAnalysis.Code);
                                                            END;

                                                   CaptionML=[ENU=Cause;
                                                              NOR=rsak;
                                                              SVE=Orsak] }
    { 161 ;   ;Description Cause   ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Analysis".Description WHERE (Analysis Type=CONST(Cause),
                                                                                                            Code=FIELD(Cause)));
                                                   CaptionML=[ENU=Description Cause;
                                                              NOR=Beskrivelse, rsak;
                                                              SVE=Beskrivning, orsak];
                                                   Editable=No }
    { 170 ;   ;Solution            ;Code10        ;TableRelation="Service Analysis".Code WHERE (Analysis Type=CONST(Solution));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Description Solution");
                                                                IF xRec.Solution <> Solution THEN BEGIN
                                                                  InsertServiceText(2, Solution, 92);  //DP00106: FIELDNO("Solution Text")
                                                                  UpdateCostPlusEntryDiscount;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceAnalysis@1100409000 : Record 11012842;
                                                              ServiceContractInfoMgt@1100528600 : Codeunit 11012842;
                                                            BEGIN
                                                              GetFilteredSolutionsByProblemCause(Problem, Cause, ServiceAnalysis);
                                                              ServiceContractInfoMgt.GetFilteredAnalysisByContract("Service Contract No.", ServiceAnalysis."Analysis Type"::Solution, ServiceAnalysis);
                                                              IF Solution <> '' THEN BEGIN
                                                                ServiceAnalysis."Analysis Type" := ServiceAnalysis."Analysis Type"::Solution;
                                                                ServiceAnalysis.Code := Solution;
                                                              END;
                                                              IF PAGE.RUNMODAL(PAGE::"Service Analysis (Solution)", ServiceAnalysis) = ACTION::LookupOK THEN
                                                                VALIDATE(Solution, ServiceAnalysis.Code);
                                                            END;

                                                   CaptionML=[ENU=Solution;
                                                              NOR=Lsning;
                                                              SVE=Lsning] }
    { 171 ;   ;Description Solution;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Analysis".Description WHERE (Analysis Type=CONST(Solution),
                                                                                                            Code=FIELD(Solution)));
                                                   CaptionML=[ENU=Description Solution;
                                                              NOR=Beskrivelse, lsning;
                                                              SVE=Beskrivning av lsning];
                                                   Editable=No }
    { 180 ;   ;Previous Service Order No.;Code20  ;TableRelation="Service Order".No. WHERE (No.=FIELD(Previous Service Order No.));
                                                   OnValidate=VAR
                                                                ServiceOrder@1100525000 : Record 11012823;
                                                              BEGIN
                                                                CheckParentChildOrder;
                                                                IF ServiceOrder.GET("Previous Service Order No.") THEN
                                                                  IF ServiceOrder."Base Service Order" OR (ServiceOrder."Previous Service Order No." <> '') THEN BEGIN
                                                                    VALIDATE("Base Service Order No.", ServiceOrder."Base Service Order No.")
                                                                  END ELSE BEGIN
                                                                    VALIDATE("Base Service Order No.", "Previous Service Order No.");
                                                                    ServiceOrder.VALIDATE("Base Service Order No.", "Previous Service Order No.");
                                                                    ServiceOrder.VALIDATE("Base Service Order", TRUE);
                                                                    ServiceOrder.MODIFY(TRUE);
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Previous Service Order No.;
                                                              NOR=Forrige serviceordrenr.;
                                                              SVE=Fregende serviceordernr] }
    { 190 ;   ;Base Service Order No.;Code20      ;TableRelation="Service Order".No. WHERE (No.=FIELD(Base Service Order No.));
                                                   OnValidate=VAR
                                                                ServiceOrderCostPlus@1100525003 : Record 11012825;
                                                                AdviceOrderLine@1100525002 : Record 11012055;
                                                                DebriefText@1100525001 : Record 11012886;
                                                                SrvOrdDebriefSpec@1100525000 : Record 11020335;
                                                                ServiceLedgerEntry@1100525004 : Record 11012819;
                                                                SalesLine@1100525005 : Record 37;
                                                                PurchaseOrderControlLine@1100525006 : Record 11020221;
                                                                HourAccountingSurcharge@1100525007 : Record 11020308;
                                                                ItemJournalLine@1100525008 : Record 83;
                                                                ItemJournalSurcharge@1100525011 : Record 11020585;
                                                                HourAccountingLine@1100525009 : Record 11012039;
                                                                PurchaseLine@1100525010 : Record 39;
                                                                ServiceOrder@1100525012 : Record 11012823;
                                                                ServiceOrderBudgetLine@1100529600 : Record 11012875;
                                                                SUPRecordingLine@1100529602 : Record 11071772;
                                                              BEGIN
                                                                //In following tabels the field "Base Service Order No." is set when creating the record
                                                                //Here we handle the changing of this field.
                                                                IF "No." = '' THEN
                                                                  EXIT;

                                                                //DP00503 sn
                                                                IF (CurrFieldNo <> 0) AND GUIALLOWED THEN BEGIN
                                                                  IF (xRec."Base Service Order No." <> "Base Service Order No.") AND
                                                                     ("Base Service Order No." <> '') THEN BEGIN
                                                                    IF ServiceOrder.GET("Base Service Order No.") THEN BEGIN
                                                                      IF ServiceOrder.Status > ServiceOrder.Status::"Technical Finished" THEN
                                                                        MESSAGE(Text112, "Base Service Order No.", ServiceOrder.Status);
                                                                        //base service order is already 'Administrative Finished'.
                                                                    END;
                                                                  END;
                                                                END;
                                                                //DP00503 en

                                                                WITH ServiceOrderCostPlus DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH ServiceLedgerEntry DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH AdviceOrderLine DO BEGIN
                                                                  SETCURRENTKEY("Record Type","Project No.","Service Order No.");
                                                                  SETRANGE("Record Type", "Record Type"::ServOrder);
                                                                  SETRANGE("Project No.", '');
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH DebriefText DO BEGIN
                                                                  SETCURRENTKEY(Type,"No.");
                                                                  SETRANGE(Type, Type::ServiceOrder);
                                                                  SETRANGE("No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH SrvOrdDebriefSpec DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH SalesLine DO BEGIN
                                                                  SETCURRENTKEY("Document Type","Service Invoice","Service Order No.");
                                                                  SETFILTER("Document Type", '%1|%2', "Document Type"::Invoice, "Document Type"::"Credit Memo");
                                                                  SETRANGE("Service Invoice", TRUE);
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH PurchaseOrderControlLine DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH HourAccountingSurcharge DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH ItemJournalLine DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                //** 4PS 14-11-2010 sn
                                                                WITH ItemJournalSurcharge DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;
                                                                //** 4PS 14-11-2010 sn

                                                                WITH HourAccountingLine DO BEGIN
                                                                  SETCURRENTKEY("Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                WITH PurchaseLine DO BEGIN
                                                                  SETCURRENTKEY("Document Type","Service Order No.");
                                                                  SETRANGE("Service Order No.", Rec."No.");
                                                                  SETRANGE("Document Type", "Document Type"::Order);
                                                                  SETFILTER("Base Service Order No.", '<>%1', Rec."Base Service Order No.");
                                                                  IF NOT ISEMPTY THEN //For Performance in SQL
                                                                    MODIFYALL("Base Service Order No.", Rec."Base Service Order No.",FALSE);
                                                                END;

                                                                ServiceOrderBudgetLine.SETRANGE("Service Order No.", "No.");
                                                                ServiceOrderBudgetLine.SETFILTER("Base Service Order No.", '<>%1', "Base Service Order No.");
                                                                IF NOT ServiceOrderBudgetLine.ISEMPTY THEN
                                                                  ServiceOrderBudgetLine.MODIFYALL("Base Service Order No.", "Base Service Order No.", FALSE);

                                                                SUPRecordingLine.SETRANGE("Service Order No.", "No.");
                                                                SUPRecordingLine.SETFILTER("Base Service Order No.", '<>%1', "Base Service Order No.");
                                                                IF NOT SUPRecordingLine.ISEMPTY THEN
                                                                  SUPRecordingLine.MODIFYALL("Base Service Order No.", "Base Service Order No.", FALSE);

                                                                IF ServiceOrder.GET("Base Service Order No.") THEN
                                                                  IF "Service Control Period Date" <> ServiceOrder."Service Control Period Date" THEN BEGIN
                                                                    "Service Control Period Date" := ServiceOrder."Service Control Period Date";
                                                                    PropagateServiceControlPeriodDate;
                                                                  END;
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceOrder@1100525000 : Record 11012823;
                                                            BEGIN
                                                              ServiceOrder.GET("Base Service Order No.");
                                                              PAGE.RUNMODAL(PAGE::"Base Service Order", ServiceOrder);
                                                            END;

                                                   CaptionML=[ENU=Base Service Order No.;
                                                              NOR=Baseserviceordrenr;
                                                              SVE=Basserviceordernr];
                                                   Editable=No }
    { 195 ;   ;Base Service Order  ;Boolean       ;CaptionML=[ENU=Base Service Order;
                                                              NOR=Basisserviceordre;
                                                              SVE=Basserviceorder];
                                                   Editable=No }
    { 200 ;   ;Project No.         ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Project No." WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr];
                                                   Editable=No }
    { 220 ;   ;Mobile Phone No.    ;Text30        ;OnValidate=BEGIN
                                                                FormatPhoneNumberWhenNotSynced("Mobile Phone No.");
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Mobile Phone No.;
                                                              NOR=Mobiltelefonnr;
                                                              SVE=Mobiltelefonnr] }
    { 230 ;   ;Phone No. 2         ;Text30        ;OnValidate=BEGIN
                                                                FormatPhoneNumberWhenNotSynced("Phone No. 2");
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No. 2;
                                                              NOR=Telefonnr 2;
                                                              SVE=Telefonnr 2] }
    { 240 ;   ;Fax No.             ;Text30        ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Fax No.;
                                                              NOR=Telefaxnr;
                                                              SVE=Telefaxnr] }
    { 250 ;   ;No. Printed         ;Integer       ;CaptionML=[ENU=No. Printed;
                                                              NOR=Antall skrevet ut;
                                                              SVE=Utskriven];
                                                   Editable=No }
    { 260 ;   ;Limit Budget Labor  ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Limit Budget Total", "Limit Budget Labor" + "Limit Budget Material");
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Labor;
                                                              NOR=Budsjettgrense, arbeidskraft;
                                                              SVE=Budgetgrns, arbetskraft];
                                                   AutoFormatType=1 }
    { 261 ;   ;Limit Budget Hours  ;Decimal       ;OnValidate=BEGIN
                                                                DetermineLimitBudgetExceeded;
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Hours;
                                                              NOR=Budsjettgrense, timer;
                                                              SVE=Budgetgrns, timmar];
                                                   DecimalPlaces=2:5 }
    { 262 ;   ;Limit Budget Material;Decimal      ;OnValidate=BEGIN
                                                                VALIDATE("Limit Budget Total", "Limit Budget Labor" + "Limit Budget Material");
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Material;
                                                              NOR=Budsjettgrense, Materiale;
                                                              SVE=Budgetgrns, material];
                                                   AutoFormatType=1 }
    { 265 ;   ;Limit Budget Total  ;Decimal       ;FieldClass=Normal;
                                                   OnValidate=BEGIN
                                                                IF ("Limit Budget Labor" <> 0) OR ("Limit Budget Material" <> 0) THEN
                                                                  TESTFIELD("Limit Budget Total", "Limit Budget Labor" + "Limit Budget Material");
                                                                DetermineLimitBudgetExceeded;
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Total;
                                                              NOR=Budsjettgrense, Totalt;
                                                              SVE=Budgetgrns, totalt];
                                                   AutoFormatType=1 }
    { 270 ;   ;Invoice Price       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Cost Plus Entry"."Invoice Price (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                Service Order No.=FIELD(No.),
                                                                                                                                Invoiced=CONST(No),
                                                                                                                                Chargeable=CONST(Yes)));
                                                   CaptionML=[ENU=Invoice Price;
                                                              NOR=Fakturapris;
                                                              SVE=Fakturapris];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 271 ;   ;Invoiced Price      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Invoiced Price;
                                                              NOR=Fakturert pris;
                                                              SVE=Fakturerat pris];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 272 ;   ;Invoice in Process  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Sales Line"."Amount (LCY)" WHERE (Document Type=CONST(Invoice),
                                                                                                      Service Invoice=CONST(Yes),
                                                                                                      Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                      Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Invoice in Process;
                                                              NOR=Pgende fakturering;
                                                              SVE=Pgende fakturering];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 273 ;   ;Credit Memo in Process;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Sales Line"."Amount (LCY)" WHERE (Document Type=CONST(Credit Memo),
                                                                                                       Service Invoice=CONST(Yes),
                                                                                                       Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                       Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Credit Memo in Process;
                                                              NOR=Kreditnotaen behandles;
                                                              SVE=Kreditnotan behandlas];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 275 ;   ;Service Entry Cost  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Service Entry Cost;
                                                              NOR=Servicetransaksjonskost;
                                                              SVE=Servicetransaktionskostnad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Actual Costs        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Cost Component=FIELD(Cost Component Filter),
                                                                                                                    Posting Date=FIELD(Period Filter),
                                                                                                                    Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Costs;
                                                              NOR=Faktiske koster;
                                                              SVE=Verkliga kostnader];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 281 ;   ;Actual Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry".Quantity WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                          Service Order No.=FIELD(No.),
                                                                                                          Cost Component=FIELD(Cost Component Filter),
                                                                                                          Posting Date=FIELD(Period Filter),
                                                                                                          Cost Type=CONST(Labor),
                                                                                                          Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Hours;
                                                              NOR=Reelle timer;
                                                              SVE=Verkliga timmar];
                                                   Editable=No }
    { 282 ;   ;Revenues            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.),
                                                                                                                       Cost Component=FIELD(Cost Component Filter),
                                                                                                                       Posting Date=FIELD(Period Filter),
                                                                                                                       Revenue Present=CONST(Yes)));
                                                   CaptionML=[ENU=Revenues;
                                                              NOR=Inntekter;
                                                              SVE=Intkter];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 283 ;   ;Actual Costs (Additional);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Cost Component=FIELD(Cost Component Filter),
                                                                                                                    Posting Date=FIELD(Period Filter),
                                                                                                                    Additional Cost=CONST(Yes),
                                                                                                                    Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Costs (Additional);
                                                              NOR=Faktiske Kostnader (Ekstra);
                                                              SVE=Verkliga kostnader (extra)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 284 ;   ;Actual Costs (Contract);Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Cost Component=FIELD(Cost Component Filter),
                                                                                                                    Posting Date=FIELD(Period Filter),
                                                                                                                    Additional Cost=CONST(No),
                                                                                                                    Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Costs (Contract);
                                                              NOR=Faktiske Kostnader (Kontrakt);
                                                              SVE=Verkliga kostnader (kontrakt)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 285 ;   ;Actual Hours (Additional);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry".Quantity WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                          Service Order No.=FIELD(No.),
                                                                                                          Cost Component=FIELD(Cost Component Filter),
                                                                                                          Posting Date=FIELD(Period Filter),
                                                                                                          Additional Cost=CONST(Yes),
                                                                                                          Cost Type=CONST(Labor),
                                                                                                          Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Hours (Additional);
                                                              NOR=Faktiske timer (Ekstra);
                                                              SVE=Verkliga timmar (extra)];
                                                   Editable=No }
    { 286 ;   ;Actual Hours (Contract);Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry".Quantity WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                          Service Order No.=FIELD(No.),
                                                                                                          Cost Component=FIELD(Cost Component Filter),
                                                                                                          Posting Date=FIELD(Period Filter),
                                                                                                          Additional Cost=CONST(No),
                                                                                                          Cost Type=CONST(Labor),
                                                                                                          Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Hours (Contract);
                                                              NOR=Faktiske timer (Kontrakt);
                                                              SVE=Verkliga timmar (kontrakt)];
                                                   Editable=No }
    { 287 ;   ;Revenues (Additional);Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.),
                                                                                                                       Cost Component=FIELD(Cost Component Filter),
                                                                                                                       Posting Date=FIELD(Period Filter),
                                                                                                                       Additional Cost=CONST(Yes),
                                                                                                                       Revenue Present=CONST(Yes)));
                                                   CaptionML=[ENU=Revenues (Additional);
                                                              NOR=Inntekter (Ekstra);
                                                              SVE=Intkter (extra)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 288 ;   ;Revenues (Contract) ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.),
                                                                                                                       Cost Component=FIELD(Cost Component Filter),
                                                                                                                       Posting Date=FIELD(Period Filter),
                                                                                                                       Additional Cost=CONST(No),
                                                                                                                       Revenue Present=CONST(Yes)));
                                                   CaptionML=[ENU=Revenues (Contract);
                                                              NOR=Inntekter (Kontrakt);
                                                              SVE=Intkter (kontrakt)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 289 ;   ;Invoice Cost        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Cost Component=FIELD(Cost Component Filter),
                                                                                                                    Posting Date=FIELD(Period Filter),
                                                                                                                    Cost Present=CONST(Yes),
                                                                                                                    Chargeable=CONST(Yes),
                                                                                                                    Cost Plus Entry Created=CONST(No),
                                                                                                                    Transfer to Project=CONST(" ")));
                                                   CaptionML=[ENU=Invoice Cost;
                                                              NOR=Fakturakostnad;
                                                              SVE=Fakturakostnad];
                                                   Editable=No }
    { 290 ;   ;Period Filter       ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Period Filter;
                                                              NOR=Periodefilter;
                                                              SVE=Periodfilter] }
    { 291 ;   ;Cumulative Filter   ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Cumulative Filter;
                                                              SVE=Kumulativt filter] }
    { 292 ;   ;Period Type Filter  ;Option        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Period Type Filter;
                                                              NOR=Periodetypefilter;
                                                              SVE=Periodtypfilter];
                                                   OptionCaptionML=[ENU=Day,Week,Month,Quarter,Year,Accounting Period;
                                                                    NOR=Dag,Uke,Mned,Kvartal,r,bokfringsperiode;
                                                                    SVE=Dag,Vecka,Mnad,Kvartal,r,Bokfringsperiod];
                                                   OptionString=Day,Week,Month,Quarter,Year,Accounting Period }
    { 293 ;   ;Source Type Filter  ;Option        ;FieldClass=FlowFilter;
                                                   InitValue=Other;
                                                   CaptionML=[ENU=Source Type Filter;
                                                              NOR=Kildetypefilter;
                                                              SVE=Ursprungstypsfilter];
                                                   OptionCaptionML=[ENU=Call,Contract,Other,Estimate;
                                                                    NOR=Samtale,Kontrakt,Andre,Kalkyle;
                                                                    SVE=Samtal,Kontrakt,vrigt,Kalkyl];
                                                   OptionString=Call,Contract,Other,Estimate }
    { 294 ;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Date Filter;
                                                              NOR=Dato filter;
                                                              SVE=Datumfilter];
                                                   Editable=No }
    { 295 ;   ;Cost Component Filter;Code10       ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Cost Component Filter;
                                                              NOR=Kostdel, filter;
                                                              SVE=Kostnadsdel, filter] }
    { 300 ;   ;Order Amount (LCY)  ;Decimal       ;OnValidate=VAR
                                                                CurrencyDate@1100528802 : Date;
                                                                CurrencyExchangeRate@1100528801 : Record 330;
                                                                Currency2@1100528800 : Record 4;
                                                              BEGIN
                                                                // dp00116.sn
                                                                Currency2.InitRoundingPrecision;
                                                                IF "Currency Code" <> '' THEN BEGIN
                                                                  CurrencyDate := "Order Date";
                                                                  "Order Amount" :=
                                                                  ROUND(
                                                                    CurrencyExchangeRate.ExchangeAmtLCYToFCY(
                                                                      0, '', CurrencyDate, "Currency Code", "Order Amount (LCY)",
                                                                       CurrencyExchangeRate.ExchangeRate(0, '', CurrencyDate, "Currency Code",TRUE),TRUE),
                                                                       Currency2."Amount Rounding Precision");
                                                                END ELSE BEGIN
                                                                  "Order Amount" := ROUND("Order Amount (LCY)",Currency2."Amount Rounding Precision");
                                                                END;
                                                                // dp00116.en

                                                                ServCostPlusRec.CheckInstallment(Rec, xRec);
                                                              END;

                                                   CaptionML=[ENU=Order Amount (LCY);
                                                              NOR=Ordrebelp (NOK);
                                                              SVE=Orderbelopp (BVA)];
                                                   AutoFormatType=1 }
    { 301 ;   ;Order Amount        ;Decimal       ;OnValidate=VAR
                                                                CurrencyDate@1100528802 : Date;
                                                                CurrencyExchangeRate@1100528801 : Record 330;
                                                                Currency2@1100528800 : Record 4;
                                                              BEGIN
                                                                // dp00116.n
                                                                Currency2.InitRoundingPrecision;
                                                                IF "Currency Code" <> '' THEN BEGIN
                                                                  CurrencyDate := "Order Date";
                                                                  "Order Amount (LCY)" :=
                                                                  ROUND(
                                                                    CurrencyExchangeRate.ExchangeAmtFCYToLCY(
                                                                      0, '', CurrencyDate, "Currency Code", "Order Amount",
                                                                       CurrencyExchangeRate.ExchangeRate(0, '', CurrencyDate, "Currency Code",TRUE),TRUE),
                                                                       Currency2."Amount Rounding Precision");
                                                                END ELSE BEGIN
                                                                  "Order Amount (LCY)" := ROUND("Order Amount",Currency2."Amount Rounding Precision");
                                                                END;

                                                                ServCostPlusRec.CheckInstallment(Rec, xRec);
                                                              END;

                                                   CaptionML=[ENU=Order Amount;
                                                              NOR=Ordrebelp;
                                                              SVE=Orderbelopp];
                                                   AutoFormatType=1 }
    { 302 ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                // dp00116.n
                                                                IF "Currency Code" <> xRec."Currency Code" THEN BEGIN
                                                                  UpdateInvoiceDataBaseServiceOrderTree(FIELDNO("Currency Code"));
                                                                  UpdateCurrencyCodeOnCostPlusEntries;
                                                                  CalcServiceOrderAmountFromLCY;
                                                                END
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod] }
    { 305 ;   ;Installment Scheme  ;Code10        ;TableRelation="Installment Scheme".Code WHERE (Type=CONST(Service Order));
                                                   OnValidate=BEGIN
                                                                ServCostPlusRec.CheckInstallment(Rec, xRec);
                                                              END;

                                                   CaptionML=[ENU=Installment Scheme;
                                                              NOR=Betalingsplan;
                                                              SVE=Betalplan] }
    { 306 ;   ;Installment Amount  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Cost Plus Entry"."Invoice Price (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                Service Order No.=FIELD(No.),
                                                                                                                                Installment Scheme=FILTER(<>''),
                                                                                                                                Posting Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Installment Amount;
                                                              NOR=Betalingsplansbelp;
                                                              SVE=Betalplansbelopp];
                                                   Editable=No }
    { 310 ;   ;Invoice Base Amount Labor;Decimal  ;OnValidate=BEGIN
                                                                VALIDATE("Invoice Base Amount Total", "Invoice Base Amount Labor" + "Invoice Base Amount Material");
                                                              END;

                                                   CaptionML=[ENU=Invoice Base Amount Labor;
                                                              NOR=Faktura, Grunnbelp for arbeidskraft;
                                                              SVE=Faktura, basbelopp fr arbetskraft];
                                                   AutoFormatType=1 }
    { 311 ;   ;Invoice Base Hours  ;Decimal       ;CaptionML=[ENU=Invoice Base Hours;
                                                              NOR=Faktura, Grunntimer;
                                                              SVE=Faktura, bastimmar];
                                                   DecimalPlaces=2:5 }
    { 312 ;   ;Invoice Base Amount Material;Decimal;
                                                   OnValidate=BEGIN
                                                                VALIDATE("Invoice Base Amount Total", "Invoice Base Amount Labor" + "Invoice Base Amount Material");
                                                              END;

                                                   CaptionML=[ENU=Invoice Base Amount Material;
                                                              NOR=Faktura, Grunnbelp for Materiale;
                                                              SVE=Faktura, basbelopp fr material];
                                                   AutoFormatType=1 }
    { 315 ;   ;Invoice Base Amount Total;Decimal  ;OnValidate=BEGIN
                                                                IF ("Invoice Base Amount Labor" <> 0) OR ("Invoice Base Amount Material" <> 0) THEN
                                                                  TESTFIELD("Invoice Base Amount Total", "Invoice Base Amount Labor" + "Invoice Base Amount Material");
                                                              END;

                                                   CaptionML=[ENU=Invoice Base Amount Total;
                                                              NOR=Faktura, Totalt Grunnbelp;
                                                              SVE=Faktura, totalt basbelopp];
                                                   AutoFormatType=1 }
    { 320 ;   ;Invoice Base Method ;Option        ;OnValidate=BEGIN
                                                                IF "Invoice Base Method" = "Invoice Base Method"::" " THEN BEGIN
                                                                  "Invoice Base Amount Labor" := 0;
                                                                  "Invoice Base Hours" := 0;
                                                                  "Invoice Base Amount Material" := 0;
                                                                  "Invoice Base Amount Total" := 0;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Invoice Base Method;
                                                              NOR=Faktura, Grunnmetode;
                                                              SVE=Faktura, basmetod];
                                                   OptionCaptionML=[ENU=" ,Total Service Order - Invoice Base Amount,Total Service Order if exceeding Invoice Base Amount";
                                                                    NOR=" ,Total Serviceordre  Fakturagrunnbelp,Total Serviceordre ved overskridelse av Fakturagrunnbelp";
                                                                    SVE=" ,Total serviceorder  fakturabasbelopp,Total serviceorder vid verskridande av fakturabasbelopp"];
                                                   OptionString=[ ,total-base,total>base] }
    { 329 ;   ;Department Code (Other);Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=BEGIN
                                                                CheckServOrderAuthorization(FIELDCAPTION("Department Code (Other)"));
                                                                ValidateShortcutDimCode(1,"Department Code (Other)", FALSE);  //db, 14-09-11: M28816

                                                                ServSetup.GET;
                                                                IF ServSetup."Copy Additional Cost Setup" THEN
                                                                  TESTFIELD("Department Code (Other)", "Global Dimension 1 Code");
                                                              END;

                                                   CaptionML=[ENU=Department (Additional Cost);
                                                              NOR=Avdeling (Tilleggskoster);
                                                              SVE=Avdelning (tillggskostnader)] }
    { 330 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=VAR
                                                                ServiceSurchargeManagement@1100528600 : Codeunit 11012834;
                                                              BEGIN
                                                                CheckServOrderAuthorization(FIELDCAPTION("Global Dimension 1 Code"));
                                                                UpdateAdviceOrderLinesPurchaser;
                                                                ValidateShortcutDimCode(1,"Global Dimension 1 Code", TRUE);  //db, 14-09-11: M28816

                                                                IF "Global Dimension 1 Code" <> xRec."Global Dimension 1 Code" THEN
                                                                  UpdatePrefLocations;

                                                                ServSetup.GET;
                                                                IF ServSetup."Copy Additional Cost Setup" THEN
                                                                  VALIDATE("Department Code (Other)", "Global Dimension 1 Code");

                                                                ServiceSurchargeManagement.CopySurchargeLinesToSO(Rec);
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Global dimensjon 1 kode;
                                                              SVE=Global dimension 1 kod];
                                                   CaptionClass='1,1,1' }
    { 335 ;   ;Open (Purchase)     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Outstanding Amount" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                             Service Order No.=FIELD(No.),
                                                                                                                             Cost Component=FIELD(Cost Component Filter),
                                                                                                                             Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Open (Purchase);
                                                              NOR=pne innkjp;
                                                              SVE=ppna inkp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 336 ;   ;Received/Not Invoiced;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Amt. Rcd. Not Invoiced" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                 Service Order No.=FIELD(No.),
                                                                                                                                 Cost Component=FIELD(Cost Component Filter),
                                                                                                                                 Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Received/Not Invoiced;
                                                              NOR=Mottatt/ikke fakturert;
                                                              SVE=Mottaget/inte fakturerat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 337 ;   ;Open Ovh. Surch. Firm (Purch.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Overhead Surcharge Firm" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                  Service Order No.=FIELD(No.),
                                                                                                                                  Cost Component=FIELD(Cost Component Filter),
                                                                                                                                  Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Open Ovh. Surch. Firm Commitments (Purchase);
                                                              NOR=pen overheadkost, faste Forpliktelser (Innkjp);
                                                              SVE=ppen overheadkostnad, fasta taganden (inkp)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 338 ;   ;Open Amount (Hours) ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Line"."Amount (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                Service Order No.=FIELD(No.),
                                                                                                                Cost Component=FIELD(Cost Component Filter),
                                                                                                                Posting Date=FIELD(Period Filter),
                                                                                                                Receiving Company=CONST('')));
                                                   CaptionML=[ENU=Open Amount (Hours);
                                                              NOR=pne belp (Timer);
                                                              SVE=ppna belopp (timmar)];
                                                   Editable=No }
    { 339 ;   ;Open Hours          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Line"."Total Line" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                              Service Order No.=FIELD(No.),
                                                                                                              Cost Component=FIELD(Cost Component Filter),
                                                                                                              Posting Date=FIELD(Period Filter),
                                                                                                              Receiving Company=CONST('')));
                                                   CaptionML=[ENU=Open Hours;
                                                              NOR=pne timer;
                                                              SVE=ppna timmar];
                                                   Editable=No }
    { 340 ;   ;Open Ovh. Surch. (Hours);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Surcharge"."Overhead Surcharge Service" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                   Service Order No.=FIELD(No.),
                                                                                                                                   Cost Component=FIELD(Cost Component Filter),
                                                                                                                                   Posting Date=FIELD(Period Filter),
                                                                                                                                   Receiving Company=CONST('')));
                                                   CaptionML=[ENU=Open Ovh. Surch. (Hours);
                                                              NOR=pen tilleggsgebyr for overhead (Timer);
                                                              SVE=ppen overheadkostnad (timmar)];
                                                   Editable=No }
    { 341 ;   ;Open Ovh. Surch. Soft (Purch.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Overhead Surcharge Soft" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                  Service Order No.=FIELD(No.),
                                                                                                                                  Cost Component=FIELD(Cost Component Filter),
                                                                                                                                  Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Open Ovh. Surch. Soft Commitments (Purchase);
                                                              NOR=pen overheadkost, lpende engasjementer (Innkjp);
                                                              SVE=ppen overheadkostnad, lpande taganden (inkp)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 345 ;   ;Open (Inventory)    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Journal Line".Amount WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                     Service Order No.=FIELD(No.),
                                                                                                     Cost Component=FIELD(Cost Component Filter),
                                                                                                     Posting Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Open (Inventory);
                                                              NOR=pne (lager);
                                                              SVE=ppna (lager)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 346 ;   ;Open Ovh. Surch. (Inventory);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Journal Surcharge"."Overhead Surcharge Service" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                Service Order No.=FIELD(No.),
                                                                                                                                Cost Component=FIELD(Cost Component Filter),
                                                                                                                                Posting Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Open Ovh. Surch. (Inventory);
                                                              NOR=pen overheadkost (lager);
                                                              SVE=ppen overheadkostnad (lager)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 347 ;   ;Open Hours (Site Mngmnt.);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Site Mngmnt. Hours Line"."Total Line" WHERE (Object No.=FIELD(No.),
                                                                                                                 Type=CONST(Service),
                                                                                                                 Status=FILTER(<Posted),
                                                                                                                 Receiving Company=FIELD(Company Filter),
                                                                                                                 Component Type=CONST(Hours)));
                                                   CaptionML=ENU=Open Hours (Site Mngmnt.);
                                                   Editable=No }
    { 350 ;   ;On Hold             ;Code3         ;TableRelation="On Hold Code".Code;
                                                   OnValidate=VAR
                                                                INSBOUMaintStatusMgt@1100528800 : Codeunit 11072102;
                                                                INSBOUMaintInstruction@1100529900 : Record 11072350;
                                                                SentType@1100528801 : ' ,Manual,,Automatic';
                                                              BEGIN
                                                                ServLogRec.StoreChange(2, "No.", ServLogRec.FormatDescription(FIELDCAPTION("On Hold"), xRec."On Hold", "On Hold"));

                                                                IF FPSLicenseManagement.LicenseAndReadPermissionForTable(INSBOUMaintInstruction) THEN
                                                                  INSBOUMaintStatusMgt.AddMaintStatusToMessageQueue("No.", SentType::Automatic);
                                                              END;

                                                   CaptionML=[ENU=On Hold;
                                                              NOR=P vent;
                                                              SVE=Stoppad] }
    { 351 ;   ;Description On Hold ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("On Hold Code".Description WHERE (Code=FIELD(On Hold)));
                                                   CaptionML=[ENU=Description On Hold;
                                                              NOR=Beskrivelse p vent;
                                                              SVE=Beskrivning stoppad];
                                                   Editable=No }
    { 360 ;   ;Closing Date        ;Date          ;OnValidate=BEGIN
                                                                //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                UpdateWorkOrderInfo(FIELDNO("Closing Date")); //C043234.n
                                                              END;

                                                   CaptionML=[ENU=Closing Date;
                                                              NOR=Sluttdato;
                                                              SVE=Avslutsdatum] }
    { 370 ;   ;% Labor             ;Decimal       ;OnValidate=BEGIN
                                                                CheckVATReverse(TRUE,FALSE);
                                                              END;

                                                   CaptionML=[ENU=% Labor;
                                                              NOR=% arbeidskraft;
                                                              SVE=Procent, arbetskraft];
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   AutoFormatType=1 }
    { 380 ;   ;% to B Account      ;Decimal       ;OnValidate=BEGIN
                                                                CheckVATReverse(TRUE,FALSE);
                                                              END;

                                                   CaptionML=[ENU=% to B Account;
                                                              NOR=% til B-konto;
                                                              SVE=Procent till B-konto];
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 390 ;   ;Shipping Agent Code ;Code10        ;TableRelation="Shipping Agent";
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Status,Status::Open);
                                                              END;

                                                   CaptionML=[ENU=Shipping Agent Code;
                                                              NOR=Transportrkode;
                                                              SVE=Speditrkod] }
    { 400 ;   ;Purchase            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                         Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                         Service Order No.=FIELD(No.),
                                                                                                         Cost Component=FIELD(Cost Component Filter),
                                                                                                         Order Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Purchase;
                                                              NOR=Innkjp;
                                                              SVE=Inkp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 410 ;   ;Name Assigned To    ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Assigned to)));
                                                   CaptionML=[ENU=Name Assigned To;
                                                              NOR=Navn tilordnet;
                                                              SVE=Namn tilldelat till];
                                                   Editable=No }
    { 430 ;   ;Payment Terms Code  ;Code10        ;TableRelation="Payment Terms";
                                                   CaptionML=[ENU=Payment Terms Code;
                                                              NOR=Betalingsvilkrskode;
                                                              SVE=Betalningsvillkorskod] }
    { 460 ;   ;Created on          ;Date          ;CaptionML=[ENU=Created on;
                                                              NOR=Opprettet den;
                                                              SVE=Skapades];
                                                   Editable=No }
    { 465 ;   ;Created by          ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190000 : Code[50];
                                                              UserMgt@1210190001 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Created by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Created by;
                                                              NOR=Opprettet av;
                                                              SVE=Skapad av];
                                                   Editable=No }
    { 470 ;   ;Progress Scheme     ;Code10        ;TableRelation="Progress Scheme".Code;
                                                   OnValidate=VAR
                                                                ProgressRec@1100485000 : Record 11020251;
                                                              BEGIN
                                                                ProgressRec.EditProgressScheme(ProgressRec.Type::ServOrder, "Progress Scheme", "No.");
                                                              END;

                                                   CaptionML=[ENU=Progress Scheme;
                                                              NOR=Fremdriftsskjema;
                                                              SVE=Frloppsschema] }
    { 480 ;   ;Received/Not Inv. Hours;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Hours Rcd. Not Invoiced" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                                  Service Order No.=FIELD(No.),
                                                                                                                                  Cost Component=FIELD(Cost Component Filter),
                                                                                                                                  Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Received/Not Inv. Hours;
                                                              NOR=Mottatte/ikke fakturerte timer;
                                                              SVE=Mottaget/inte fakt. Timmar];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 490 ;   ;Employee No.        ;Code20        ;TableRelation="Resource (WOP)" WHERE (Type=CONST(Employee),
                                                                                         Schedule=FILTER(ServiceOrder|Both));
                                                   OnValidate=VAR
                                                                ResourceMgtWorkOrderPlan@1100528601 : Codeunit 11229277;
                                                                CUFunc@1101285000 : Codeunit 11128007;
                                                              BEGIN
                                                                EvaluateStartingTime;
                                                                CheckPlanDataFSA;
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup("Employee No.");
                                                                DetermineLimitBudgetExceeded;
                                                                CALCFIELDS("Employee Name");
                                                                SendDspPlanMessage;
                                                                //<< ITERO.PR 150928
                                                                IF "Employee No." <> '' THEN BEGIN
                                                                  CUFunc.SOEmployee(Rec,"Employee No.");
                                                                END;
                                                                //>> ITERO.PR 150928
                                                              END;

                                                   CaptionML=[ENU=Employee No.;
                                                              NOR=Ansattnr;
                                                              SVE=Anstllningsnr];
                                                   Description=DP00465, based on Resource }
    { 491 ;   ;Employee Name       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Employee No.)));
                                                   CaptionML=[ENU=Employee Name;
                                                              NOR=Navn p ansatt;
                                                              SVE=Namn p anstlld];
                                                   Editable=No }
    { 495 ;   ;Subcontractor       ;Code20        ;TableRelation="Resource (WOP)" WHERE (Type=CONST(Subcontractor),
                                                                                         Schedule=FILTER(ServiceOrder|Both));
                                                   OnValidate=VAR
                                                                ResourceMgtWorkOrderPlan@1100528601 : Codeunit 11229277;
                                                              BEGIN
                                                                CheckPlanDataFSA;
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup(Subcontractor);
                                                                CALCFIELDS("Subcontractor Name");
                                                              END;

                                                   CaptionML=[ENU=Subcontractor;
                                                              NOR=Underentreprenr;
                                                              SVE=Underentreprenr];
                                                   Description=DP00610, based on Resource }
    { 496 ;   ;Subcontractor Name  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=[ENU=Subcontractor Name;
                                                              NOR=Underentreprenrens navn;
                                                              SVE=Underentreprenrens namn];
                                                   Editable=No }
    { 510 ;   ;Discipline          ;Code10        ;FieldClass=Normal;
                                                   TableRelation=Discipline;
                                                   OnValidate=BEGIN
                                                                IF xRec.Discipline <> Discipline THEN BEGIN
                                                                  VALIDATE("Trade Speciality", '');
                                                                  DetermineServiceClusterBySourceType;
                                                                END;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Discipline;
                                                              NOR=Disiplin;
                                                              SVE=Disciplin] }
    { 511 ;   ;Trade Speciality    ;Code10        ;TableRelation="Trade Speciality".Code WHERE (Discipline=FIELD(Discipline));
                                                   OnValidate=BEGIN
                                                                FillSubcontractor;
                                                                FillPreferredEmployee;
                                                              END;

                                                   CaptionML=[ENU=Trade Speciality;
                                                              NOR=SNI-nummer;
                                                              SVE=SNI-nummer] }
    { 540 ;   ;Location Filter     ;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation="Service Location".No.;
                                                   CaptionML=[ENU=Location Filter;
                                                              NOR=Plasseringfilter;
                                                              SVE=Lagerstllefilter] }
    { 550 ;   ;Territory Filter    ;Code10        ;FieldClass=FlowFilter;
                                                   TableRelation=Territory.Code;
                                                   CaptionML=[ENU=Territory Filter;
                                                              NOR=Distriktsfilter;
                                                              SVE=Distriktsfilter] }
    { 560 ;   ;Discipline Filter   ;Code10        ;FieldClass=FlowFilter;
                                                   TableRelation=Discipline.Code;
                                                   CaptionML=[ENU=Discipline Filter;
                                                              NOR=Disiplinfilter;
                                                              SVE=Disciplinfilter] }
    { 570 ;   ;Department Filter   ;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Filter;
                                                              NOR=Avdelingsfilter;
                                                              SVE=Avdelningsfilter];
                                                   CaptionClass='1,3,1' }
    { 578 ;   ;First Possible Starting Time;Time  ;OnValidate=BEGIN
                                                                IF (xRec."First Possible Starting Time" <> "First Possible Starting Time") THEN BEGIN
                                                                  CheckPlanLimitDateTime;
                                                                  CheckFirmPlannedPlanDates;
                                                                  CheckPlanDataFSA();
                                                                  CheckPlanPeriod();
                                                                  UpdateWorkOrderInfo(FIELDNO("First Possible Starting Time"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=First Possible Starting Time;
                                                              NOR=Frste mulige tid for oppstart;
                                                              SVE=Frsta mjliga starttid] }
    { 579 ;   ;Last Possible Ending Time;Time     ;OnValidate=BEGIN
                                                                IF xRec."Last Possible Ending Time" <> "Last Possible Ending Time" THEN BEGIN
                                                                  CheckPlanLimitDateTime;
                                                                  CheckFirmPlannedPlanDates;
                                                                  CheckPlanDataFSA();
                                                                  CheckPlanPeriod();
                                                                  UpdateWorkOrderInfo(FIELDNO("Last Possible Ending Time"));  //C043234.n
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Last Possible Ending Time;
                                                              NOR=Siste mulige tid for avslutning;
                                                              SVE=Senast mjliga sluttid] }
    { 580 ;   ;First Possible Starting Date;Date  ;OnValidate=BEGIN
                                                                IF xRec."First Possible Starting Date" <> "First Possible Starting Date" THEN BEGIN
                                                                  IF ("First Possible Starting Date" > "Last Possible Ending Date") AND ("Last Possible Ending Date" <> 0D) THEN
                                                                    FIELDERROR("First Possible Starting Date",STRSUBSTNO(Text000,FIELDCAPTION("Last Possible Ending Date")));
                                                                  IF "First Possible Starting Date" = 0D THEN
                                                                    "Last Possible Ending Date" := 0D;
                                                                  IF "Starting Date" < "First Possible Starting Date" THEN
                                                                    "Starting Date" := "First Possible Starting Date";
                                                                  IF "Ending Date" > "Last Possible Ending Date" THEN
                                                                    IF ("Ending Date" <> 0D) AND ("Last Possible Ending Date" <> 0D) THEN
                                                                     "Ending Date" := "Last Possible Ending Date";
                                                                  IF ("Ending Date" <> 0D) AND ("Ending Date" < "Starting Date") THEN
                                                                    "Ending Date" := "Starting Date";
                                                                  CheckPlanLimitDateTime;
                                                                  CheckFirmPlannedPlanDates;
                                                                  CheckPlanDataFSA;
                                                                  CheckPlanPeriod();
                                                                  UpdateWorkOrderInfo(FIELDNO("First Possible Starting Date"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=First Possible Starting Date;
                                                              NOR=Frste mulige dato for oppstart;
                                                              SVE=Frsta mjliga startdatum] }
    { 581 ;   ;Last Possible Ending Date;Date     ;OnValidate=BEGIN
                                                                IF xRec."Last Possible Ending Date" <> "Last Possible Ending Date" THEN BEGIN
                                                                  IF ("First Possible Starting Date" > "Last Possible Ending Date") AND ("Last Possible Ending Date" <> 0D) THEN
                                                                    FIELDERROR("First Possible Starting Date",STRSUBSTNO(Text000,FIELDCAPTION("Last Possible Ending Date")));
                                                                  IF "Ending Date" > "Last Possible Ending Date" THEN
                                                                    IF ("Ending Date" <> 0D) AND ("Last Possible Ending Date" <> 0D) THEN
                                                                     "Ending Date" := "Last Possible Ending Date";
                                                                  CheckPlanLimitDateTime;
                                                                  CheckFirmPlannedPlanDates;
                                                                  CheckPlanDataFSA;
                                                                  CheckPlanPeriod();
                                                                  UpdateWorkOrderInfo(FIELDNO("Last Possible Ending Date"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Last Possible Ending Date;
                                                              NOR=Siste mulig tid for avslutning;
                                                              SVE=Senast mjliga slutdatum] }
    { 583 ;   ;Schedule Relation   ;Option        ;CaptionML=[ENU=Schedule Relation;
                                                              NOR=Tidsplan, relasjon;
                                                              SVE=Planering, relation];
                                                   OptionCaptionML=[ENU=" ,Start-Start,Start-End,End-Start,End-End";
                                                                    NOR=" ,Start-start,Start-slutt,slutt-start,slutt-slutt";
                                                                    SVE=" ,Start-start,Start-slut,Slut-start,Slut-slut"];
                                                   OptionString=[ ,Start-Start,Start-End,End-Start,End-End] }
    { 584 ;   ;Duration Time       ;Decimal       ;OnValidate=BEGIN
                                                                CheckPlanDataFSA;
                                                                UpdateWorkOrderInfo(FIELDNO("Duration Time"));
                                                              END;

                                                   CaptionML=[ENU=Duration Time;
                                                              NOR=Varighet;
                                                              SVE=Lptid];
                                                   DecimalPlaces=0:5 }
    { 585 ;   ;Budget Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line".Hours WHERE (Service Order No.=FIELD(No.),
                                                                                                            Cost Component=FIELD(Cost Component Filter),
                                                                                                            Index Date=FIELD(Period Filter),
                                                                                                            Cost Type=CONST(Labor)));
                                                   CaptionML=[ENU=Budget Hours;
                                                              NOR=Budsjett (Timer);
                                                              SVE=Budget (timmar)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 586 ;   ;Budget Amount       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line".Amount WHERE (Service Order No.=FIELD(No.),
                                                                                                             Cost Component=FIELD(Cost Component Filter),
                                                                                                             Index Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Budget Amount;
                                                              NOR=Budsjettbelp;
                                                              SVE=Budgetbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 587 ;   ;Budget Overhead Surcharge;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line"."Overhead Surcharge" WHERE (Service Order No.=FIELD(No.),
                                                                                                                           Cost Component=FIELD(Cost Component Filter),
                                                                                                                           Index Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Budget Overhead Surcharge;
                                                              NOR=Budsjettert tilleggskostnad for overhead;
                                                              SVE=Budgeterad overheadkostnad];
                                                   Editable=No }
    { 588 ;   ;Budget Hours Plant  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line".Hours WHERE (Service Order No.=FIELD(No.),
                                                                                                            Cost Component=FIELD(Cost Component Filter),
                                                                                                            Index Date=FIELD(Period Filter),
                                                                                                            Cost Type=CONST(Plant)));
                                                   CaptionML=ENU=Budget Hours Plant;
                                                   DecimalPlaces=0:5;
                                                   Description=DP02115;
                                                   Editable=No }
    { 591 ;   ;Next Deadline       ;DateTime      ;CaptionML=[ENU=Next Deadline;
                                                              NOR=Neste deadline;
                                                              SVE=Nsta deadline];
                                                   Description=W014185;
                                                   Editable=No }
    { 595 ;   ;Next Reference Period;Code10       ;TableRelation="Reference Period".Code WHERE (Type=CONST(ServOrder),
                                                                                                Document No.=FIELD(No.));
                                                   CaptionML=[ENU=Next Reference Period;
                                                              NOR=Neste referanseperiode;
                                                              SVE=Nsta referenspunkt];
                                                   Editable=No }
    { 596 ;   ;Next Reference Period Desc;Text50  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Reference Period".Description WHERE (Type=CONST(ServOrder),
                                                                                                            Document No.=FIELD(No.),
                                                                                                            Code=FIELD(Next Reference Period)));
                                                   CaptionML=[ENU=Next Reference Period Description;
                                                              NOR=Beskrivelse av neste referanseperiode;
                                                              SVE=Nsta referensperiod, beskrivning];
                                                   Editable=No }
    { 600 ;   ;Watch               ;Code10        ;TableRelation=Watch;
                                                   CaptionML=[ENU=Watch;
                                                              NOR=Observer;
                                                              SVE=Observera];
                                                   Editable=No }
    { 610 ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr];
                                                   Editable=No }
    { 611 ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=[ENU=Estimate Description;
                                                              NOR=Kalkylebeskrivelse;
                                                              SVE=Kalkylbeskrivning];
                                                   Editable=No }
    { 612 ;   ;Sub-Estimate No.    ;Code20        ;TableRelation=Sub-Estimate."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Sub-Estimate No.;
                                                              NOR=Delkalkylenummer;
                                                              SVE=Delkalkylnr];
                                                   Editable=No }
    { 613 ;   ;Sub-Estimate Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Sub-Estimate.Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Sub-Estimate Description;
                                                              NOR=Beskrivelse av delkalkyle;
                                                              SVE=Beskrivning av delkalkyl];
                                                   Editable=No }
    { 615 ;   ;Latest Reference Period;Code10     ;FieldClass=FlowField;
                                                   CalcFormula=Max("Reference Period".Code WHERE (Type=CONST(ServOrder),
                                                                                                  Document No.=FIELD(No.),
                                                                                                  Ending Date-Time=FILTER(<>'')));
                                                   CaptionML=[ENU=Latest Reference Period;
                                                              NOR=Siste referanseperiode;
                                                              SVE=Senaste referensperiod];
                                                   Editable=No }
    { 650 ;   ;Latest Reference Period Time;DateTime;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Max("Reference Period"."Ending Date-Time" WHERE (Type=CONST(ServOrder),
                                                                                                                Document No.=FIELD(No.),
                                                                                                                Ending Date-Time=FILTER(<>'')));
                                                   CaptionML=[ENU=Latest Reference Period Time;
                                                              NOR=Siste referanseperiode, tid;
                                                              SVE=Senaste referensperiodtid];
                                                   Editable=No }
    { 660 ;   ;Actual Reference Point;Integer     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Reference Point"."Reference Point" WHERE (Type=CONST(ServOrder),
                                                                                                                          Document No.=FIELD(No.),
                                                                                                                          Actual=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Reference Point;
                                                              NOR=Faktisk referansepunkt;
                                                              SVE=Verklig referenspunkt];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 661 ;   ;Actual Reference Point Desc;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Reference Point".Description WHERE (No.=FIELD(Actual Reference Point)));
                                                   CaptionML=[ENU=Actual Reference Point Description;
                                                              NOR=Faktisk referansepunkt, beskrivelse;
                                                              SVE=Verklig referenspunktsbeskrivning];
                                                   Editable=No }
    { 662 ;   ;Actual Reference Point Time;DateTime;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Reference Point"."Date-Time (modified)" WHERE (Type=CONST(ServOrder),
                                                                                                                               Document No.=FIELD(No.),
                                                                                                                               Actual=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Reference Point Time;
                                                              SVE=Verklig referenstidspunkt];
                                                   Editable=No }
    { 670 ;   ;Allowed Costs       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line".Amount WHERE (Service Order No.=FIELD(No.),
                                                                                                             Cost Component=FIELD(Cost Component Filter),
                                                                                                             Finished=CONST(Yes),
                                                                                                             Index Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Allowed Costs;
                                                              NOR=Tillatte koster;
                                                              SVE=Tilltna kostnader];
                                                   Editable=No }
    { 671 ;   ;Allowed Costs (Ovh. Surch.);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line"."Overhead Surcharge" WHERE (Service Order No.=FIELD(No.),
                                                                                                                           Cost Component=FIELD(Cost Component Filter),
                                                                                                                           Finished=CONST(Yes),
                                                                                                                           Index Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Allowed Costs (Overhead Surcharge);
                                                              NOR=Tillatte koster (Overheadkost);
                                                              SVE=Tilltna kostnader (overheadkostnad)];
                                                   Editable=No }
    { 672 ;   ;Allowed Hours       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Budget Line".Hours WHERE (Service Order No.=FIELD(No.),
                                                                                                            Cost Component=FIELD(Cost Component Filter),
                                                                                                            Finished=CONST(Yes),
                                                                                                            Index Date=FIELD(Period Filter)));
                                                   CaptionML=[ENU=Allowed Hours;
                                                              NOR=Tillatte timer;
                                                              SVE=Tilltna timmar];
                                                   Editable=No }
    { 680 ;   ;Settlement Method   ;Option        ;OnValidate=VAR
                                                                ServiceOrderExtension@1100528600 : Record 11071727;
                                                              BEGIN
                                                                IF "Settlement Method" <> xRec."Settlement Method" THEN BEGIN
                                                                  CASE "Settlement Method" OF
                                                                    "Settlement Method"::"Cost Plus":
                                                                      BEGIN
                                                                        TESTFIELD("Installment Scheme", '');
                                                                        TESTFIELD("Order Amount",0);
                                                                      END;
                                                                    "Settlement Method"::"Collective Installment Overview",
                                                                    "Settlement Method"::"Installment Overview by Service Order":
                                                                      BEGIN
                                                                        TESTFIELD("Service Contract No.");
                                                                        ServiceOrderExtension.GetServOrderExtension("No.");
                                                                        ServiceOrderExtension.TESTFIELD("Price Book Code");
                                                                      END;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Settlement Method;
                                                              NOR=Oppgjrsmetode;
                                                              SVE=Avrkningsmetod];
                                                   OptionCaptionML=[ENU=Cost Plus,Fixed Price,Collective Installment Overview,Installment Overview by Service Order;
                                                                    SVE=Lpande,Fastpris,Samlad betalplansversikt,Betalplansversikt per serviceorder];
                                                   OptionString=Cost Plus,Fixed Price,Collective Installment Overview,Installment Overview by Service Order }
    { 691 ;   ;Signer              ;Text50        ;CaptionML=[ENU=Signer;
                                                              NOR=Underskriver;
                                                              SVE=Undertecknare] }
    { 692 ;   ;E-Mail Signer       ;Text80        ;CaptionML=[ENU=Email Signer;
                                                              SVE=E-post skickades till] }
    { 695 ;   ;Accepted            ;Boolean       ;CaptionML=[ENU=Accepted;
                                                              NOR=Godtatt;
                                                              SVE=Accepterat] }
    { 700 ;   ;EP Contact No. Company;Code20      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value"."Contact No. (Company)" WHERE (Code=FIELD(Global Dimension 1 Code),
                                                                                                                       Global Dimension No.=CONST(1)));
                                                   CaptionML=[ENU=Company No.;
                                                              NOR=Selskapsnr.;
                                                              SVE=Fretagsnr];
                                                   Editable=No }
    { 710 ;   ;EP Company Name     ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(EP Contact No. Company)));
                                                   CaptionML=[ENU=Company Name;
                                                              NOR=Navn p selskap;
                                                              SVE=fretagsnamn];
                                                   Editable=No }
    { 720 ;   ;EP Company Address  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Address WHERE (No.=FIELD(EP Contact No. Company)));
                                                   CaptionML=[ENU=Company Address;
                                                              NOR=Selskapets adresse;
                                                              SVE=Fretagets adress];
                                                   Editable=No }
    { 730 ;   ;EP Company Postcode ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Post Code" WHERE (No.=FIELD(EP Contact No. Company)));
                                                   CaptionML=[ENU=Company Post Code;
                                                              NOR=Selskapets postkode;
                                                              SVE=Fretagspostnummer];
                                                   Editable=No }
    { 740 ;   ;EP Company City     ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.City WHERE (No.=FIELD(EP Contact No. Company)));
                                                   CaptionML=[ENU=Company City;
                                                              NOR=Selskapets poststed;
                                                              SVE=Fretagsort];
                                                   Editable=No }
    { 750 ;   ;Dsp Final Planning  ;Boolean       ;OnValidate=BEGIN
                                                                IF ("Dsp Final Planning") THEN
                                                                  SendDspPlanMessage;
                                                              END;

                                                   CaptionML=ENU=DSP Final Planning }
    { 760 ;   ;Dsp Order Type      ;Code20        ;CaptionML=ENU=DSP Order Type;
                                                   Editable=No }
    { 770 ;   ;Dsp Connection Object Id;Text50    ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=DSP Connection Object ID;
                                                   Editable=No }
    { 780 ;   ;Dsp Cluster Id      ;Text50        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=DSP Cluster ID;
                                                   Editable=No }
    { 790 ;   ;Dsp Production Cluster Id;Code50   ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=DSP Production Cluster ID }
    { 800 ;   ;Postpone Invoicing  ;Boolean       ;CaptionML=[ENU=Postpone Invoicing;
                                                              NOR=Utsett fakturering;
                                                              SVE=Skjut upp fakturering] }
    { 810 ;   ;Order No. Customer  ;Text50        ;OnValidate=BEGIN
                                                                IF "Order No. Customer" <> xRec."Order No. Customer" THEN
                                                                  IF Origin = Origin::Dispatch THEN
                                                                    FIELDERROR(Origin);
                                                                IF Origin = Origin::"4PS Construct" THEN
                                                                  IF CurrFieldNo = FIELDNO("Order No. Customer") THEN
                                                                    CheckOrderNoCustomer;
                                                              END;

                                                   CaptionML=[ENU=Order No. Customer;
                                                              NOR=Ordrenr, (Kunde);
                                                              SVE=Ordernr, (kund)] }
    { 820 ;   ;Additional Cost     ;Boolean       ;OnValidate=BEGIN
                                                                CheckAdditionalCostSetup;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost;
                                                              NOR=Tilleggskoster;
                                                              SVE=Tillggskostnader] }
    { 821 ;   ;Additional Cost (Labor);Boolean    ;OnValidate=BEGIN
                                                                CheckAdditionalCostSetup;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Labor);
                                                              NOR=Tilleggskostnad;
                                                              SVE=Tillggskostnader (arbetskraft)] }
    { 822 ;   ;Additional Cost (Material);Boolean ;OnValidate=BEGIN
                                                                CheckAdditionalCostSetup;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Material);
                                                              NOR=Tilleggskoster (materiale);
                                                              SVE=Tillggskostnader (material)] }
    { 823 ;   ;Additional Cost (Subc);Boolean     ;OnValidate=BEGIN
                                                                CheckAdditionalCostSetup;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Subcontracting);
                                                              NOR=Tilleggskoster (underenrepenr);
                                                              SVE=Tillggskostnader (Underentreprenad)] }
    { 824 ;   ;Additional Cost (Plant);Boolean    ;OnValidate=BEGIN
                                                                CheckAdditionalCostSetup;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Plant);
                                                              NOR=Tilleggskoster (Maskin);
                                                              SVE=Tillggskostnader (Maskin)] }
    { 825 ;   ;Additional Cost (Sundry);Boolean   ;OnValidate=BEGIN
                                                                CheckAdditionalCostSetup;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Sundry);
                                                              NOR=Tilleggskoster (diverse);
                                                              SVE=Tillggskostnader (diverse)] }
    { 830 ;   ;Service Cluster     ;Code20        ;TableRelation="Service Cluster".Code;
                                                   OnValidate=BEGIN
                                                                CheckBlockedByFSA;
                                                                TESTFIELD(Status, Status::Open);
                                                                ValidateServiceCluster;
                                                                DetermineServiceClusterSeqn;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupServiceCluster;
                                                            END;

                                                   CaptionML=[ENU=Service Cluster;
                                                              SVE=Servicekontraktskluster] }
    { 832 ;   ;Service Cluster Seqn.;Integer      ;TableRelation="Service Cluster Seq."."Seq. No." WHERE (Cluster Code=FIELD(Service Cluster));
                                                   OnValidate=BEGIN
                                                                CheckBlockedByFSA;
                                                                TESTFIELD(Status, Status::Open);
                                                                ValidateServiceClusterSeqn;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupServiceClusterSeqn;
                                                            END;

                                                   CaptionML=ENU=Service Cluster Seqn.;
                                                   BlankZero=Yes }
    { 840 ;   ;Schedule Method     ;Option        ;CaptionML=[ENU=Schedule Method;
                                                              NOR=Tidsplan, metode;
                                                              SVE=Planeringsmetod];
                                                   OptionCaptionML=[ENU=" ,Date Fixed,Period Bound";
                                                                    NOR=" ,Fast dato,Periodebundet";
                                                                    SVE=" ,Fast datum,Periodhopp"];
                                                   OptionString=[ ,Date,Period] }
    { 850 ;No ;Warranty found at   ;Text1         ;CaptionML=[ENU=Warranty found at;
                                                              NOR=Garanti funnet i;
                                                              SVE=Garantin finns i];
                                                   Description=DP00106: expired;
                                                   Editable=No }
    { 860 ;   ;Serv.Order WIP not processed;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("Service-Ledger Entry" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                   Service Order No.=FIELD(No.),
                                                                                                   Service Order WIP processed=CONST(No)));
                                                   CaptionML=[ENU=Service Order WIP not processed;
                                                              NOR=Serviceordre, arbeidskapital er ikke prosessert;
                                                              SVE=Serviceorder, WIP inte behandlat];
                                                   Editable=No }
    { 865 ;   ;Service Entry Revenue (WIP);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.),
                                                                                                                       Service Order WIP processed=CONST(No)));
                                                   CaptionML=[ENU=Service Entry (WIP Revenue);
                                                              NOR=Servicetransaksjon (Arbeidskapital inntekter);
                                                              SVE=Servicetransaktion (konto fr pgende arbeten, intkter)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 866 ;   ;Service Entry Cost (WIP);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Service Order WIP processed=CONST(No)));
                                                   CaptionML=[ENU=Service Entry (WIP Cost);
                                                              NOR=Servicetransaksjon (Arbeidskapital kostnader);
                                                              SVE=Servicetransaktion (konto fr pgende arbeten, kostnad)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 900 ;   ;Purch Discount Term Group 1;Code20 ;TableRelation="Discount Term Group".Code WHERE (Level=CONST(Customer),
                                                                                                   Type=FILTER(Common|Purchase));
                                                   CaptionML=[ENU=Purchase Discount Term Group (Customer);
                                                              NOR=Innkjp, Rabattvilkrsgruppe (Kunde);
                                                              SVE=Inkp, rabattvillkorsgrupp (kund)] }
    { 901 ;   ;Purch Discount Term Group 2;Code20 ;TableRelation="Discount Term Group".Code WHERE (Level=CONST(Job),
                                                                                                   Type=FILTER(Common|Purchase));
                                                   CaptionML=[ENU=Purchase Discount Term Group (Job);
                                                              NOR=Innkjp, Rabattvilkrsgruppe (Jobb);
                                                              SVE=Inkp, rabattvillkorsgrupp (jobb)] }
    { 905 ;   ;Reference Date (Item);Date         ;CaptionML=[ENU=Reference Date Item Prices;
                                                              NOR=Referansedato for artikkelpriser;
                                                              SVE=Referensdatum fr artikelpriser] }
    { 906 ;   ;Reference Date (Company);Date      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Inventory Setup"."Reference Date (Item)");
                                                   CaptionML=[ENU=Reference Date Item Prices (Company);
                                                              NOR=Referansedato for artikkelpriser (Selskap);
                                                              SVE=Referensdatum fr artikelpriser (fretag)];
                                                   Editable=No }
    { 907 ;   ;Reference Date (Customer);Date     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Reference Date (Item)" WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Reference Date Item Prices (Customer);
                                                              NOR=Referansedato for artikkelpriser (Kunde);
                                                              SVE=Referensdatum fr artikelpriser (kund)];
                                                   Editable=No }
    { 910 ;   ;Sales Discount Term Group 1;Code20 ;TableRelation="Discount Term Group".Code WHERE (Level=CONST(Customer),
                                                                                                   Type=FILTER(Common|Sales));
                                                   OnValidate=BEGIN
                                                                //>> 161010 ITERO.AC RAD043 New field "Sales Discount Term Percent" (User must select either a Discount Term Group or a discount percentage)
                                                                IF ("Sales Discount Term Group 1" <> '') AND ("Sales Discount Term Percent" <> 0) THEN
                                                                  ERROR(Text11128291, FIELDCAPTION("Sales Discount Term Group 1"));
                                                                //<< 161010 ITERO.AC RAD043
                                                              END;

                                                   CaptionML=[ENU=Sales Discount Term Group (Customer);
                                                              NOR=Salg, rabattvilkrsgruppe (Kunde);
                                                              SVE=Frsljning, rabattvillkorsgrupp (kund)] }
    { 911 ;   ;Sales Discount Term Group 2;Code20 ;TableRelation="Discount Term Group".Code WHERE (Level=CONST(Job),
                                                                                                   Type=FILTER(Common|Sales));
                                                   CaptionML=[ENU=Sales Discount Term Group (Job);
                                                              NOR=Salg, Rabattvilkrsgruppe (Jobb);
                                                              SVE=Frsljning, rabattvillkorsgrupp (jobb)] }
    { 950 ;   ;Cost Control Up to Date;Boolean    ;CaptionML=[ENU=Cost Control Up to Date;
                                                              NOR=Kostkontroll Oppdatert;
                                                              SVE=Kostnadskontroll uppdaterad] }
    { 1010;   ;Order Manager       ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   OnValidate=BEGIN
                                                                UpdateExtraWorkOrderFields;
                                                              END;

                                                   CaptionML=[ENU=Order Manager;
                                                              NOR=Ordreleder;
                                                              SVE=Orderchef] }
    { 1011;   ;Order Manager Name  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Order Manager)));
                                                   CaptionML=[ENU=Order Manager Name;
                                                              NOR=Ordrelederens navn;
                                                              SVE=Orderchefens namn];
                                                   Editable=No }
    { 1020;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   CaptionML=[ENU=Language Code;
                                                              NOR=Sprkkode;
                                                              SVE=Sprkkod] }
    { 1030;   ;Location Customer   ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Location Customer" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Location Customer;
                                                              NOR=Plassering, Kunde;
                                                              SVE=Lagerstlle, kund];
                                                   Editable=No }
    { 1050;   ;Service Order Filter;Code20        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Service Order Filter;
                                                              NOR=Serviceordrefilter;
                                                              SVE=Serviceorderfilter];
                                                   Description=expired for Base ServOrder (still used in R11012806) }
    { 1060;   ;Send Report         ;Boolean       ;CaptionML=[ENU=Send Report;
                                                              NOR=Send rapport;
                                                              SVE=Skicka rapport];
                                                   Editable=No }
    { 1070;   ;Date/Time Export Work Sheet;DateTime;
                                                   CaptionML=[ENU=Date/Time Export Work Sheet;
                                                              NOR=Dato/tid eksportarbeidsark;
                                                              SVE=Datum/tid fr kalkylbladsexport];
                                                   Editable=No }
    { 1090;   ;Collective List No. ;Code20        ;TableRelation=IF (Base Service Order=CONST(Yes)) "Service Collective-List" WHERE (Bill-to Customer No.=FIELD(Bill-to Customer No.),
                                                                                                                                     Alternative Bill-to Address=FIELD(Alternative Bill-to Address))
                                                                                                                                     ELSE IF (Base Service Order=CONST(No)) "Service Collective-List";
                                                   OnValidate=VAR
                                                                ServiceOrderCostPlusEntry@1100528600 : Record 11012825;
                                                                ServiceCollectiveList@1100528601 : Record 11071730;
                                                                Customer@1100528602 : Record 18;
                                                                ServiceSetup@1100528604 : Record 11012800;
                                                                ServiceCollectiveListMgt@1100528603 : Codeunit 11012850;
                                                              BEGIN
                                                                IF xRec."Collective List No." = "Collective List No." THEN EXIT;

                                                                IF "Collective List No." <> '' THEN BEGIN
                                                                  CheckCollectiveList;
                                                                  IF NOT DisableBaseOrderCheck THEN
                                                                    IF "Base Service Order No." <> "No." THEN
                                                                      IF NOT InvoiceDataDiffersFromBaseOrder THEN
                                                                        IF NOT "Allow Invoice Separately" THEN
                                                                          TESTFIELD("Base Service Order", TRUE);
                                                                END ELSE BEGIN
                                                                  ServiceCollectiveList.GET(xRec."Collective List No.");
                                                                  ServiceCollectiveList.TESTFIELD(Status, ServiceCollectiveList.Status::Open);
                                                                END;

                                                                IF "Collective List No." <> '' THEN BEGIN
                                                                  IF Status < Status::"Administrative Finished" THEN
                                                                    RecalcSOCostPlusEntries;
                                                                  IF xRec."Collective List No." <> "Collective List No." THEN
                                                                    MODIFY;
                                                                  ServiceCollectiveListMgt.CreateCollListSCInvoicingLines("Collective List No.", FALSE);
                                                                  ServiceSetup.GET;
                                                                  IF NOT SuppressAutoRecalculateCollectiveList AND ServiceSetup."Auto Recalculate Coll. List" THEN BEGIN
                                                                    ServiceCollectiveList.GET("Collective List No.");
                                                                    ServiceCollectiveList.Recalculate;
                                                                  END;
                                                                END;

                                                                IF Status < Status::"Administrative Finished" THEN BEGIN
                                                                  ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
                                                                  ServiceOrderCostPlusEntry.SETRANGE(Invoiced, FALSE);
                                                                  ServiceOrderCostPlusEntry.SETRANGE("Bill-to Customer No.", "Bill-to Customer No.");
                                                                  ServiceOrderCostPlusEntry.SETRANGE("Alternative Bill-to Address", "Alternative Bill-to Address");
                                                                  ServiceOrderCostPlusEntry.MODIFYALL("Collective List No.", "Collective List No.", TRUE);
                                                                END;

                                                                IF "Base Service Order" AND NOT "Allow Invoice Separately" THEN
                                                                  CheckBaseServiceOrderTree;
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupCollectiveListNo();
                                                            END;

                                                   CaptionML=[ENU=Collective List No.;
                                                              NOR=Samlingsfaktura nr.;
                                                              SVE=Samlingsfaktura nr.] }
    { 1200;   ;Direct Debit Mandate ID;Code35     ;TableRelation="SEPA Direct Debit Mandate" WHERE (Customer No.=FIELD(Bill-to Customer No.),
                                                                                                    Closed=CONST(No),
                                                                                                    Blocked=CONST(No),
                                                                                                    Mandate for Filter=CONST(ServiceOrder),
                                                                                                    No. Mandate for Filter=FIELD(No.));
                                                   OnValidate=BEGIN
                                                                IF "Direct Debit Mandate ID" <> '' THEN
                                                                  TESTFIELD("Bill-to Customer No.");
                                                              END;

                                                   CaptionML=[ENU=Direct Debit Mandate ID;
                                                              NOR=ID for Direct Debit-belastningsfullmakt;
                                                              SVE=Medgivande-ID fr autogiro] }
    { 1620;   ;Payment Method Code (SO Inv.);Code10;
                                                   TableRelation="Payment Method";
                                                   CaptionML=ENU=Payment Method Code (SO Invoicing) }
    { 1640;   ;Actual Costs incl. Period;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Cost Component=FIELD(Cost Component Filter),
                                                                                                                    Posting Date=FIELD(Cumulative Filter),
                                                                                                                    Cost Present=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Costs up to and including Period;
                                                              SVE=Verkliga kostnader fram till och med period];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 1650;   ;Revenues incl. Period;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.),
                                                                                                                       Cost Component=FIELD(Cost Component Filter),
                                                                                                                       Posting Date=FIELD(Cumulative Filter),
                                                                                                                       Revenue Present=CONST(Yes)));
                                                   CaptionML=ENU=Revenues up to and including Period;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2000;   ;Budget Hours (Gantt Chart);Decimal ;CaptionML=[ENU=Budget Hours (Gantt Chart);
                                                              NOR=Budsjettimer (Gantt-skjema);
                                                              SVE=Budgettimmar (Gant-schema)];
                                                   Editable=No }
    { 2010;   ;Open Hours (Gantt Chart);Decimal   ;CaptionML=[ENU=Open Hours (Gantt Chart);
                                                              NOR=pne timer (Gantt-skjema);
                                                              SVE=ppna timmar (Gant-schema)];
                                                   Editable=No }
    { 2020;   ;Posted Hours (Gantt Chart);Decimal ;CaptionML=[ENU=Posted Hours (Gantt Chart);
                                                              NOR=Bokfrte timer (Gantt-skjema);
                                                              SVE=ppna timmar (Gant-schema)];
                                                   Editable=No }
    { 2030;   ;Finished Hours (Gantt Chart);Decimal;
                                                   CaptionML=[ENU=Finished Hours (Gantt Chart);
                                                              NOR=Ferdige timer (Gantt-skjema);
                                                              SVE=Avslutade timmar (Gant-schema)];
                                                   Editable=No }
    { 2040;   ;Actual Reference Point (Gantt);Integer;
                                                   TableRelation="Reference Point".No. WHERE (Apply=CONST(ServOrder));
                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Actual Reference Point (Gantt Chart);
                                                   BlankZero=Yes;
                                                   Description=Diekus: also used in SO-monitor;
                                                   Editable=No }
    { 2050;   ;Commision Date      ;Date          ;CaptionML=[ENU=Commision Date;
                                                              NOR=Provisjonsdato;
                                                              SVE=Provisionsdatum] }
    { 2060;   ;Customer Problem    ;Code10        ;TableRelation="Customer Service Analysis".Code WHERE (Analysis Type=CONST(Problem),
                                                                                                         Customer No.=FIELD(Customer No.));
                                                   OnLookup=VAR
                                                              CustomerServiceAnalysis@1100528602 : Record 11071728;
                                                              ServiceOrderInfoMgt@1100528603 : Codeunit 11012841;
                                                            BEGIN
                                                              ServiceOrderInfoMgt.GetFilteredCustomerAnalysis("Customer No.", "Service Contract No.", CustomerServiceAnalysis."Analysis Type"::Problem, CustomerServiceAnalysis);
                                                              IF PAGE.RUNMODAL(0, CustomerServiceAnalysis) = ACTION::LookupOK THEN
                                                                VALIDATE("Customer Problem", CustomerServiceAnalysis.Code);
                                                            END;

                                                   CaptionML=[ENU=Customer Problem;
                                                              NOR=Kundeproblem;
                                                              SVE=Kundproblem] }
    { 2070;   ;Service Order Cost Activated;Boolean;
                                                   CaptionML=ENU=Service Order Cost Activated;
                                                   Editable=No }
    { 2080;   ;Tenant Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Name" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Name;
                                                   Editable=No }
    { 2090;   ;Tenant Name 2       ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Name 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Name 2;
                                                   Editable=No }
    { 2100;   ;Tenant Phone        ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone;
                                                   Editable=No }
    { 2110;   ;Tenant Phone 2      ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone 2;
                                                   Editable=No }
    { 2120;   ;Tenant Mobile Phone ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Mobile Phone" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Mobile Phone;
                                                   Editable=No }
    { 2130;   ;Tenant Mobile Phone 2;Text30       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Mobile Phone 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Mobile Phone 2;
                                                   Editable=No }
    { 2140;   ;Tenant E-Mail       ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant E-Mail" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant E-Mail;
                                                   Editable=No }
    { 2150;   ;Tenant E-Mail 2     ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant E-Mail 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant E-Mail 2;
                                                   Editable=No }
    { 2160;   ;Tenant Phone Work   ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone Work" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone Work;
                                                   Editable=No }
    { 2170;   ;Tenant Phone Work 2 ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone Work 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone Work 2;
                                                   Editable=No }
    { 6000;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              NOR=Moms Bevegelsebokfringsmal;
                                                              SVE=Moms rrelsebokfringsmall] }
    { 7000;   ;FLS VisiTour ID     ;Integer       ;CaptionML=[ENU=FLS VisiTour ID;
                                                              SVE=FLS VisiTour-ID];
                                                   Editable=No }
    { 11012001;;Vessel No.         ;Code20        ;TableRelation=Vessel.No.;
                                                   CaptionML=[ENU=Vessel No.;
                                                              NOR=Kjretynr.;
                                                              SVE=Fartygsnr];
                                                   Description=Vessels;
                                                   Editable=No }
    { 11012010;;Charge Vendor (Warranty);Boolean  ;CaptionML=[ENU=Charge Vendor (Warranty);
                                                              NOR=Belast leverandr (garanti)];
                                                   Editable=No }
    { 11012020;;Service Control Period Date;Date  ;OnValidate=VAR
                                                                ServiceContract@1100529600 : Record 11012812;
                                                              BEGIN
                                                                IF Status = Status::Finished THEN
                                                                  ERROR(Text005, TABLECAPTION, "No.", FIELDCAPTION(Status), Status);
                                                                //TESTFIELD("Base Service Order");
                                                                TESTFIELD("Service Control Period Date");
                                                                IF "Service Contract No." <> '' THEN BEGIN
                                                                  ServiceContract.GET("Service Contract No.");
                                                                  IF (ServiceContract."Ending Date" <> 0D) AND ("Service Control Period Date" > ServiceContract."Ending Date") THEN
                                                                    ERROR(Text128, FIELDCAPTION("Service Control Period Date"), TABLECAPTION, "No.",
                                                                          ServiceContract.FIELDCAPTION("Ending Date"), ServiceContract.TABLECAPTION, ServiceContract."No.", ServiceContract."Ending Date");
                                                                END;
                                                                TestSCPeriodClosed;
                                                                PropagateServiceControlPeriodDate;
                                                              END;

                                                   CaptionML=[ENU=Service Control Period Date;
                                                              NOR=Servicekontrollperiode, dato;
                                                              SVE=Servicekontroll datumperiod] }
    { 11012024;;Subcontracting in Hours;Boolean   ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Subcontracting in Hours;
                                                   Description=C053751 }
    { 11012025;;Plant Rates in Hours;Boolean      ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Plant Rates in Hours;
                                                              SVE=Maskinavgifter i timmar];
                                                   Description=DP02115 }
    { 11012026;;Kind of Plant Rate ;Option        ;InitValue=Intern;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Kind of Plant Rate;
                                                   OptionCaptionML=[ENU=Intern,Extern;
                                                                    SVE=Internt,Externt];
                                                   OptionString=Intern,Extern;
                                                   Description=DP02115 }
    { 11012030;;Plant Location     ;Code20        ;TableRelation="Plant Location".Code;
                                                   OnValidate=VAR
                                                                ServiceOrderCostPlusEntry@1100529600 : Record 11012825;
                                                                Customer@1100525000 : Record 18;
                                                                MarketingSetup@1100528500 : Record 5079;
                                                                CompanyRelationsCentralMgt@1100528501 : Record 11012059;
                                                              BEGIN
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  TESTFIELD("Service Contract No.",''); //DJN, 7-10-13: DP00195
                                                                  PlantLocRec.CHANGECOMPANY("Plant Company");
                                                                  PlantLocRec.GET("Plant Location");
                                                                  //DP02115.sn
                                                                  IF PlantLocRec."Estimate Company" <> '' THEN BEGIN
                                                                    IF "Plant Company" <> '' THEN
                                                                      PlantLocRec.TESTFIELD("Estimate Company", "Plant Company")
                                                                    ELSE
                                                                      PlantLocRec.TESTFIELD("Estimate Company", COMPANYNAME);
                                                                  END;
                                                                  "Kind of Plant Rate" := PlantLocRec."Kind of Rate";
                                                                  //DP02115.en
                                                                  IF PlantLocRec."Service Order No." <> '' THEN
                                                                    ERROR(Text114);
                                                                  IF (PlantLocRec."Customer No." <> '') AND (PlantLocRec."Customer No." <> "Customer No.") THEN BEGIN
                                                                    IF ("Plant Company" <> COMPANYNAME) AND ("Plant Company" <> '') THEN BEGIN
                                                                      MarketingSetup.GET;
                                                                      IF MarketingSetup."Central Management" THEN
                                                                        IF CompanyRelationsCentralMgt.GET("Plant Company") THEN
                                                                          IF CompanyRelationsCentralMgt.GetLeadingCompany(DATABASE::"Marketing Setup", TRUE) = CompanyRelationsCentralMgt."Company Contact Data" THEN
                                                                            IF Customer.GET(PlantLocRec."Customer No.") THEN
                                                                              VALIDATE("Customer No.", PlantLocRec."Customer No.");
                                                                    END ELSE
                                                                      IF Customer.GET(PlantLocRec."Customer No.") THEN
                                                                        VALIDATE("Customer No.", PlantLocRec."Customer No.");
                                                                  END;
                                                                  IF "Plant Location" <> xRec."Plant Location" THEN BEGIN
                                                                    CheckServOrderAuthorization(FIELDCAPTION("Plant Location"));
                                                                    ValidateAddressData(3);
                                                                  END;
                                                                END;
                                                                CALCFIELDS("Project No.");
                                                                MODIFY; //mg
                                                                CheckTravelData;
                                                                "Additional Cost" := DetermineAdditionalCost;
                                                                GetPlantLocationDescription;

                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
                                                                  ServiceOrderCostPlusEntry.SETRANGE(Invoiced, FALSE);
                                                                  ServiceOrderCostPlusEntry.SETRANGE("Charge to Plant Location", TRUE);
                                                                  IF ServiceOrderCostPlusEntry.FINDSET THEN
                                                                    ServiceOrderCostPlusEntry.MODIFYALL("Additional Cost", FALSE);
                                                                END ELSE
                                                                  UpdateChargeToPlantInCostPlusEntries;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantLocation;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant Location;
                                                              NOR=Maskinplassering;
                                                              SVE=Maskinplats] }
    { 11012035;;Plant Location Description;Text100;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Location".Description WHERE (Code=FIELD(Plant Location)));
                                                   OnLookup=BEGIN
                                                              LookupPlantLocationDescription;
                                                            END;

                                                   CaptionML=[ENU=Plant Location Description;
                                                              NOR=Beskrivelse av maskinplassering;
                                                              SVE=Beskrivning av Maskinplats];
                                                   Editable=No }
    { 11012040;;Plant Type         ;Code20        ;TableRelation="Plant Type".Code;
                                                   OnValidate=VAR
                                                                PlantType@1100525000 : Record 11012551;
                                                                PlantNumber@1100529600 : Record 11012552;
                                                                PlantMeterType@1100529400 : Record 11229921;
                                                              BEGIN
                                                                IF "Plant Type" = '' THEN
                                                                  "Plant Number" := ''
                                                                ELSE BEGIN
                                                                  PlantType.CHANGECOMPANY("Plant Company");
                                                                  PlantType.GET("Plant Type");
                                                                  PlantType.TESTFIELD(Blocked, FALSE);
                                                                END;
                                                                IF "Plant Type" <> xRec."Plant Type" THEN BEGIN
                                                                  CheckChargeToProject;
                                                                  IF "Plant Number" <> '' THEN BEGIN
                                                                    PlantNumber.CHANGECOMPANY("Plant Company");
                                                                    IF NOT PlantNumber.GET("Plant Type", "Plant Number") THEN
                                                                      "Plant Number" := '';
                                                                  END;
                                                                  CALCFIELDS("Plant Parts");
                                                                  TESTFIELD("Plant Parts", 0);
                                                                END;
                                                                IF CurrFieldNo <> 0 THEN BEGIN
                                                                  GetPlantTypeDescription;
                                                                  GetPlantNumberValues;
                                                                END;
                                                                //**4PS.sn BI049 KD 10-08-16
                                                                PlantMeterType.CHANGECOMPANY("Plant Company");
                                                                PlantMeterType.SETRANGE("Plant Type","Plant Type");
                                                                PlantMeterType.SETRANGE("Plant No.","Plant Number");
                                                                PlantMeterType.SETRANGE("Plant Meter","Plant Meter");
                                                                IF PlantMeterType.ISEMPTY THEN
                                                                  VALIDATE("Plant Meter",'');
                                                                //**4PS.sn BI049 KD 10-08-16
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantType;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp] }
    { 11012045;;Plant Type Description;Text50     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Type".Description WHERE (Code=FIELD(Plant Type)));
                                                   OnLookup=BEGIN
                                                              LookupPlantTypeDescription;
                                                            END;

                                                   CaptionML=[ENU=Plant Type Description;
                                                              NOR=Maskintype Beskrivelse;
                                                              SVE=Maskintyp beskrivning];
                                                   Editable=No }
    { 11012050;;Plant Number       ;Code10        ;TableRelation="Plant Number".No. WHERE (Plant Type=FIELD(Plant Type));
                                                   OnValidate=VAR
                                                                PlantType@1100528000 : Record 11012551;
                                                                PlantNumber@1100529000 : Record 11012552;
                                                                PlantInventory@1100528800 : Record 11012555;
                                                                PlantMeterType@1100529400 : Record 11229921;
                                                                OPlantLocation@1100528801 : Code[20];
                                                              BEGIN
                                                                IF "Plant Number" <> xRec."Plant Number" THEN BEGIN
                                                                  CheckChargeToProject;
                                                                  CALCFIELDS("Plant Parts");
                                                                  TESTFIELD("Plant Parts", 0);
                                                                END;

                                                                PlantType.CHANGECOMPANY("Plant Company");
                                                                IF "Plant Type" <> '' THEN
                                                                  PlantType.GET("Plant Type");
                                                                PlantNumber.CHANGECOMPANY("Plant Company");

                                                                IF "Plant Number" <> '' THEN BEGIN
                                                                  PlantNumber.GET("Plant Type", "Plant Number");
                                                                  PlantNumber.TESTFIELD(Blocked, FALSE);

                                                                  IF (NOT PlantType.Bulk) AND GUIALLOWED THEN BEGIN
                                                                    PlantInventory.CHANGECOMPANY("Plant Company");
                                                                    PlantInventory.SETCURRENTKEY(Removed, "Plant Type", "Plant No.", "Rate Code", Location);
                                                                    PlantInventory.SETRANGE(Removed, FALSE);
                                                                    PlantInventory.SETRANGE("Plant Type", "Plant Type");
                                                                    PlantInventory.SETRANGE("Plant No.", "Plant Number");
                                                                    IF PlantInventory.ISEMPTY THEN
                                                                      MESSAGE(Text124, FIELDCAPTION("Plant Number"), "Plant Type", "Plant Number", PlantInventory.TABLECAPTION);
                                                                    PlantInventory.RESET;
                                                                  END;
                                                                END;

                                                                IF ("Plant Location" = '') AND ("Plant Number" <> '') AND (xRec."Plant Number" <> "Plant Number") THEN
                                                                  IF NOT PlantType.Bulk THEN BEGIN
                                                                    PlantInventory.CHANGECOMPANY("Plant Company");
                                                                    IF PlantInventory.GetPlantLocationByPlantNumber("Plant Type", "Plant Number", OPlantLocation) THEN
                                                                      IF OPlantLocation <> '' THEN
                                                                        VALIDATE("Plant Location", OPlantLocation);
                                                                  END;

                                                                IF CurrFieldNo <> 0 THEN
                                                                  GetPlantNumberValues;
                                                                //**4PS.sn BI049 KD 10-08-16
                                                                PlantMeterType.CHANGECOMPANY("Plant Company");
                                                                PlantMeterType.SETRANGE("Plant Type","Plant Type");
                                                                PlantMeterType.SETRANGE("Plant No.","Plant Number");
                                                                PlantMeterType.SETRANGE("Plant Meter","Plant Meter");
                                                                IF PlantMeterType.ISEMPTY THEN
                                                                  VALIDATE("Plant Meter",'');
                                                                //**4PS.en BI049 KD 10-08-16
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantInventory(2);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant No.;
                                                              NOR=Maskinnr.;
                                                              SVE=Maskinnr] }
    { 11012055;;Plant Number Description;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Number".Description WHERE (Plant Type=FIELD(Plant Type),
                                                                                                        No.=FIELD(Plant Number)));
                                                   OnLookup=BEGIN
                                                              LookupPlantNumberValues;
                                                            END;

                                                   CaptionML=[ENU=Plant No. Description;
                                                              NOR=Maskinnr., Beskrivelse;
                                                              SVE=Maskinnr, beskrivning];
                                                   Editable=No }
    { 11012056;;Plant Inspection No.;Code30       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Number"."Inspection No." WHERE (Plant Type=FIELD(Plant Type),
                                                                                                             No.=FIELD(Plant Number)));
                                                   OnLookup=BEGIN
                                                              LookupPlantNumberValues;
                                                            END;

                                                   CaptionML=[ENU=Plant Inspection No.;
                                                              NOR=Maskininspeksjonsnr;
                                                              SVE=Maskininspektionsnr];
                                                   Editable=No }
    { 11012057;;Plant Parts        ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Service Order Plant Part" WHERE (Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Plant Parts;
                                                              SVE=Maskindelar];
                                                   Editable=No }
    { 11012060;;Cost Component Plant;Code10       ;TableRelation="Cost Component Plant".Code;
                                                   OnValidate=VAR
                                                                CostComponentPlant@1100529600 : Record 11012575;
                                                              BEGIN
                                                                IF "Cost Component Plant" <> '' THEN BEGIN
                                                                  CostComponentPlant.CHANGECOMPANY("Plant Company");
                                                                  CostComponentPlant.GET("Cost Component Plant");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupCostComponentPlant;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Cost Component Plant;
                                                              NOR=Kostdel, maskin;
                                                              SVE=Kostnadsdel, Maskin] }
    { 11012070;;Alternative Plant Loc Address;Code10;
                                                   TableRelation="Plant Location Address"."Address Code" WHERE (Location=FIELD(Plant Location));
                                                   OnValidate=BEGIN
                                                                ValidateAddressData(3);
                                                              END;

                                                   OnLookup=VAR
                                                              PlantLocationAddressesFrm@1100529901 : Page 11012625;
                                                              PlantLocationAddressRec@1100529900 : Record 11012590;
                                                            BEGIN
                                                              PlantLocationAddressRec.CHANGECOMPANY("Plant Company");
                                                              PlantLocationAddressRec.SETRANGE(Location,"Plant Location");
                                                              PlantLocationAddressesFrm.SETTABLEVIEW(PlantLocationAddressRec);
                                                              PlantLocationAddressesFrm.LOOKUPMODE := TRUE;
                                                              IF PlantLocationAddressesFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                                PlantLocationAddressesFrm.GETRECORD(PlantLocationAddressRec);
                                                                "Alternative Plant Loc Address" := PlantLocationAddressRec."Address Code";
                                                                ValidateAddressData(3);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Alternative Plant Location Address;
                                                              SVE=Alternativ maskinplatsadress] }
    { 11012080;;Travel Duration    ;Duration      ;CaptionML=[ENU=Travel Duration;
                                                              SVE=Restid] }
    { 11012090;;No. of Work Orders ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Work Order" WHERE (Source Company=FIELD(Company Filter),
                                                                                         Source Type=CONST(ServiceOrder),
                                                                                         Source No.=FIELD(No.)));
                                                   CaptionML=[ENU=No. of Work Orders;
                                                              SVE=Antal arbetsordrar];
                                                   Editable=No }
    { 11012100;;Company Filter     ;Text30        ;FieldClass=FlowFilter;
                                                   TableRelation=Company.Name;
                                                   CaptionML=[ENU=Company Filter;
                                                              NOR=Selskapsfilter;
                                                              SVE=Fretagsfilter] }
    { 11012110;;Firm Planned       ;Boolean       ;OnValidate=BEGIN
                                                                IF xRec."Firm Planned" <> "Firm Planned" THEN BEGIN
                                                                  IF NOT "Firm Planned" THEN BEGIN
                                                                    IF GUIALLOWED THEN
                                                                      IF NOT CONFIRM(Text115) THEN
                                                                        ERROR('');
                                                                  END ELSE
                                                                    CheckFirmPlannedPlanDates;
                                                                  //UpdateWorkOrderInfo(CurrFieldNo);  //C043234.o
                                                                  UpdateWorkOrderInfo(FIELDNO("Firm Planned")); //C043234.n
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Firm Planned;
                                                              NOR=Fast planlagt;
                                                              SVE=Fast planerad] }
    { 11012120;;Service Category   ;Code10        ;TableRelation=IF (Service Contract No.=FILTER(<>'')) "Service Category".Code WHERE (Service Contract No.=FIELD(Service Contract No.));
                                                   OnValidate=VAR
                                                                ServiceOrder@1100528600 : Record 11012823;
                                                                ServiceType@1100528601 : Record 11012814;
                                                                ServiceSetup@1100528602 : Record 11012800;
                                                                ServiceTypeFromSCSourceType@1100527351 : Boolean;
                                                              BEGIN
                                                                TESTFIELD("Service Contract No.");
                                                                CheckServOrderAuthorization(FIELDCAPTION("Service Category"));

                                                                IF "Service Category" <> xRec."Service Category" THEN BEGIN
                                                                  IF (CurrFieldNo = FIELDNO("Service Category")) AND NOT "Base Service Order" THEN BEGIN
                                                                    ServiceSetup.GET;
                                                                    IF ServiceSetup."Service Control Method" = ServiceSetup."Service Control Method"::"Real-Time" THEN
                                                                      IF ServiceOrder.GET("Base Service Order No.") THEN
                                                                        IF ServiceOrder."Service Category" <> "Service Category" THEN
                                                                          ERROR(Text131, FIELDCAPTION("Service Category"));
                                                                  END;
                                                                  DetermineServiceType(FALSE, ServiceTypeFromSCSourceType);
                                                                  IF NOT ServiceType.GET("Service Type") THEN
                                                                    ServiceType.INIT;
                                                                  IF NOT ServiceTypeFromSCSourceType OR (ServiceType."Department Code" = '') THEN BEGIN
                                                                    IF ServContrRec.GET("Service Contract No.") THEN BEGIN
                                                                      "Department Code (Other)" := ServContrRec."Department Code (Other)";
                                                                      VALIDATE("Global Dimension 1 Code", ServContrRec."Global Dimension 1 Code");
                                                                    END;
                                                                  END;
                                                                END;

                                                                PropagateServiceCategory;
                                                                SetUnitPriceStatus;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Service Category;
                                                              SVE=Servicekategori] }
    { 11012130;;Post Code Type     ;Option        ;CaptionML=[ENU=Post Code Type;
                                                              SVE=Postkodtyp];
                                                   OptionCaptionML=ENU=" ,Odd,Even,House Boat,House Trailer";
                                                   OptionString=[ ,Odd,Even,House Boat,House Trailer];
                                                   Editable=No }
    { 11012140;;SO Finished (Field Service);Boolean;
                                                   CaptionML=ENU=Service Order Finished (Field Service);
                                                   Editable=No }
    { 11012150;;House No.          ;Integer       ;CaptionML=[ENU=House No.;
                                                              NOR=Husnr.;
                                                              SVE=Husnr];
                                                   Editable=No }
    { 11012160;;House No. Ext.     ;Code10        ;CaptionML=[ENU=House No. Extension;
                                                              NOR=Husnr ETA;
                                                              SVE=Husnr TA];
                                                   Editable=No }
    { 11012170;;Recording Unit Prices by;Code20   ;TableRelation=Employee.No.;
                                                   CaptionML=ENU=Recording Unit Prices by }
    { 11012175;;Recording Work Order No.;Code20   ;TableRelation="Work Order" WHERE (Source Type=CONST(ServiceOrder),
                                                                                     Source No.=FIELD(No.));
                                                   OnValidate=VAR
                                                                SUPRecordingLine@1100527000 : Record 11071772;
                                                              BEGIN
                                                                IF "Recording Work Order No." <> '' THEN BEGIN
                                                                  SUPRecordingLine.SETRANGE("Service Order No.", "No.");
                                                                  SUPRecordingLine.SETFILTER("Work Order No.", '<>%1', '');
                                                                  IF SUPRecordingLine.FINDFIRST THEN
                                                                    SUPRecordingLine.TESTFIELD("Work Order No.", '');
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Recording Work Order No.;
                                                              SVE=Arbetsorder, registreringsnummer] }
    { 11012180;;Next Service Orders Exist;Boolean ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Order" WHERE (Base Service Order No.=FIELD(No.),
                                                                                            Base Service Order=CONST(No)));
                                                   CaptionML=ENU=Next Service Orders Exist;
                                                   Editable=No }
    { 11012190;;Cause of Exclusion Code;Code10    ;TableRelation="Cause of Excl. (Ref. Period)";
                                                   CaptionML=[ENU=Cause of Exclusion;
                                                              SVE=Orsak till exluderande] }
    { 11012200;;Preferred Employee No.;Code20     ;TableRelation="Resource (WOP)";
                                                   OnValidate=VAR
                                                                ResourceMgtWorkOrderPlan@1100528600 : Codeunit 11229277;
                                                              BEGIN
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup("Preferred Employee No.");
                                                              END;

                                                   CaptionML=[ENU=Preferred Employee No.;
                                                              SVE=Nr p frvald anstlld];
                                                   Editable=No }
    { 11012210;;Preferred Employee Name;Text100   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Preferred Employee No.)));
                                                   CaptionML=[ENU=Preferred Employee Name;
                                                              NOR=Foretrukket ansatt, navn;
                                                              SVE=Namn p frvald anstlld];
                                                   Editable=No }
    { 11012220;;Service Location Type;Code20      ;TableRelation="Service Location Type";
                                                   OnValidate=VAR
                                                                ServiceLocation@1100528600 : Record 11012801;
                                                              BEGIN
                                                                IF "Service Location No." <> '' THEN
                                                                  IF ServiceLocation.GET("Service Location No.") THEN
                                                                    IF ServiceLocation."Service Location Type" <> '' THEN
                                                                      TESTFIELD("Service Location Type", ServiceLocation."Service Location Type");
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Service Location Type;
                                                              SVE=Serviceplatstyp] }
    { 11012230;;Room (SUP)         ;Code20        ;TableRelation="SUP Room".Code;
                                                   OnValidate=VAR
                                                                ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
                                                              BEGIN
                                                                IF "Room (SUP)" <> xRec."Room (SUP)" THEN BEGIN
                                                                  ServiceUnitPriceManagement.ValidateRoom("Customer No.", "Room (SUP)");
                                                                  VALIDATE("Part (SUP)", '');
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceUnitPriceManagement@1100528602 : Codeunit 11012846;
                                                            BEGIN
                                                              ServiceUnitPriceManagement.LookupRoom("Customer No.", "Service Location Type", "Room (SUP)");
                                                              VALIDATE("Room (SUP)");
                                                            END;

                                                   CaptionML=[ENU=Room;
                                                              NOR=Rom;
                                                              SVE=Rum] }
    { 11012240;;Part (SUP)         ;Code20        ;TableRelation="SUP Part".Code;
                                                   OnValidate=VAR
                                                                ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
                                                              BEGIN
                                                                ServiceUnitPriceManagement.ValidatePart("Customer No.", "Part (SUP)");
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
                                                            BEGIN
                                                              ServiceUnitPriceManagement.LookupPart("Customer No.", "Room (SUP)", "Part (SUP)");
                                                              VALIDATE("Part (SUP)");
                                                            END;

                                                   CaptionML=[ENU=Part;
                                                              NOR=Del;
                                                              SVE=Del] }
    { 11012250;;Customer Feature   ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Customer Feature" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Customer Feature;
                                                              NOR=Kundefunksjon;
                                                              SVE=Kundfunktion];
                                                   Editable=No }
    { 11012260;;Location Contact Debrief;Boolean  ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Loc. Contact Debrief" WHERE (Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Location Contact Debrief;
                                                              SVE=Lagerstllekontakt, avrapportering];
                                                   Editable=No }
    { 11012270;;Tenant No.         ;Code20        ;CaptionML=[ENU=Tenant No.;
                                                              SVE=Klientnummer] }
    { 11012280;;Plant Company      ;Text30        ;FieldClass=Normal;
                                                   TableRelation="Plant Management Company"."Plant Company";
                                                   OnValidate=VAR
                                                                CompanyData@1100529602 : Record 11020674;
                                                              BEGIN
                                                                IF "Plant Company" = COMPANYNAME THEN
                                                                  "Plant Company" := '';
                                                                IF "Plant Company" <> xRec."Plant Company" THEN BEGIN
                                                                  CheckChargeToProject;
                                                                  IF "Plant Company" <> '' THEN
                                                                    IF CompanyData.GET("Plant Company") THEN
                                                                      IF CompanyData."Customer No." <> '' THEN
                                                                        VALIDATE("Customer No.", CompanyData."Customer No.");
                                                                  VALIDATE("Plant Location", '');
                                                                  VALIDATE("Plant Type", '');
                                                                  "Cost Component Plant" := '';
                                                                  DetermineCostComponentPlant;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Plant Company;
                                                              SVE=Maskinfretag] }
    { 11012700;;Service Warranty Code;Code10      ;TableRelation="Service Warranty";
                                                   CaptionML=[ENU=Service Warranty Code;
                                                              NOR=Servicegarantikode;
                                                              SVE=Servicegarantikod] }
    { 11012710;;Origin             ;Option        ;CaptionML=[ENU=Origin;
                                                              NOR=Utstedt;
                                                              SVE=Ursprung];
                                                   OptionCaptionML=ENU=4PS Construct,4PS Mobile,4PS Service Portal,4PS Service Call App,Dispatch,4PS Field Service App,INSBOU Maint. Instr.,Survey,IoT Event,DSP,4PS Control,,,Other,Scan Application";
                                                   OptionString=4PS Construct,4PS Mobile,4PS Service Portal,4PS Service Call App,Dispatch,4PS Field Service App,INSBOU Maint. Instr.,Survey,IoT Event,DSP,4PS Control,,,Other,Scan Application;
                                                   Description=Same as T11012822:920;
                                                   Editable=No }
    { 11012720;;Limit Budget Exceedance;Boolean   ;CaptionML=[ENU=Limit Budget Exceedance;
                                                              SVE=Budgetgrns, verskridande];
                                                   Editable=No }
    { 11012721;;Limit Budget Hours Exceedance;Boolean;
                                                   CaptionML=ENU=Limit Budget Hours Exceedance;
                                                   Editable=No }
    { 11012722;;Limit Budget Labor Exceedance;Boolean;
                                                   CaptionML=ENU=Limit Budget Labor Exceedance;
                                                   Editable=No }
    { 11012723;;Lm. Budg. Material Exceedance;Boolean;
                                                   CaptionML=ENU=Limit Budget Material Exceedance;
                                                   Editable=No }
    { 11012724;;Limit Budget Total Exceedance;Boolean;
                                                   CaptionML=ENU=Limit Budget Total Exceedance;
                                                   Editable=No }
    { 11012730;;Charged on Project ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                       Service Order No.=FIELD(No.),
                                                                                                                       Transfer to Project=CONST(Processed)));
                                                   CaptionML=[ENU=Charged on Project;
                                                              SVE=Fakturerat p projekt];
                                                   Editable=No }
    { 11012735;;Charged on Project (Cost);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Cost (LCY)" WHERE (Base Service Order No.=FIELD(Base Service Order No.),
                                                                                                                    Service Order No.=FIELD(No.),
                                                                                                                    Transfer to Project=CONST(Processed)));
                                                   CaptionML=ENU=Charged on Project (Cost);
                                                   Editable=No }
    { 11012740;;Process Structure Code;Code10     ;TableRelation="Service Process Structure".Code WHERE (Type=CONST(Service Order));
                                                   OnValidate=BEGIN
                                                                IF (xRec."Process Structure Code" <> "Process Structure Code") AND ("Process Structure Code" <> '') THEN
                                                                  ApplyDefaultsByProcessStructure;
                                                              END;

                                                   CaptionML=ENU=Process Structure Code }
    { 11012750;;Causer Source Type ;Option        ;OnValidate=BEGIN
                                                                IF xRec."Causer Source Type" <> "Causer Source Type" THEN BEGIN
                                                                  IF "Causer Source Type" = "Causer Source Type"::Customer THEN
                                                                    VALIDATE("Causer Source No.", "Customer No.")
                                                                  ELSE
                                                                    VALIDATE("Causer Source No.", '');
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Instigator Source Type;
                                                              SVE=Orsaksklla, typ];
                                                   OptionCaptionML=[ENU=" ,Customer,Vendor,Service Order,Other";
                                                                    SVE=" ,Kund,Leverantr,Serviceorder,Annat"];
                                                   OptionString=[ ,Customer,Vendor,Service Order,Other] }
    { 11012760;;Causer Source No.  ;Code20        ;TableRelation=IF (Causer Source Type=CONST(Customer)) Customer
                                                                 ELSE IF (Causer Source Type=CONST(Vendor)) Vendor
                                                                 ELSE IF (Causer Source Type=CONST(Service Order)) "Service Order"
                                                                 ELSE IF (Causer Source Type=CONST(Other)) "Causer Type";
                                                   CaptionML=[ENU=Instigator Source No.;
                                                              SVE=Orsaksklla, nr.] }
    { 11012770;;Latest Expected Receipt Date;Date ;FieldClass=FlowField;
                                                   CalcFormula=Max("Purchase Line"."Expected Receipt Date" WHERE (Document Type=CONST(Order),
                                                                                                                  Service Order No.=FIELD(No.)));
                                                   CaptionML=ENU=Latest Expected Receipt Date;
                                                   Editable=No }
    { 11012780;;Charged to Plant   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Plant Ledger Entry"."Total Cost" WHERE (Plant Invoice Origin=CONST(Service Order),
                                                                                                            Service Order No.=FIELD(No.)));
                                                   CaptionML=ENU=Charged to Plant;
                                                   Editable=No }
    { 11012790;;Charged to Plant Location;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Plant Ledger Entry"."Total Cost" WHERE (Plant Invoice Origin=CONST(Service Order),
                                                                                                            Service Order No.=FIELD(No.),
                                                                                                            Plant Location=FILTER(<>'')));
                                                   CaptionML=ENU=Charged to Plant Location;
                                                   Editable=No }
    { 11012831;;Laboratory Service Call No.;Code20;TableRelation="Service Call";
                                                   CaptionML=[ENU=Laboratory Service Call No.;
                                                              NOR=Laboratorium, servicesamtalenr.;
                                                              SVE=Laboratorieservicesamtal nr];
                                                   Editable=No }
    { 11012832;;Laboratory Order Creation Date;DateTime;
                                                   OnValidate=BEGIN
                                                                // Intentionally left editable for troubleshooting purposes; should not be editable from the UI.
                                                              END;

                                                   CaptionML=[ENU=Laboratory Order Creation Date;
                                                              NOR=Laboratorium, opprettelsesdato for ordre;
                                                              SVE=Laboratorieorder, skapandedatum] }
    { 11012833;;Lab. Results Retrieval Dat OLD;DateTime;
                                                   OnValidate=BEGIN
                                                                // Intentionally left editable for troubleshooting purposes; should not be editable from the UI.
                                                              END;

                                                   CaptionML=[ENU=Lab. Results Retrieval Date OLD;
                                                              NOR=Arbeidsresultater, innhentingsdato;
                                                              SVE=Lab. resultat hmtningsdatum];
                                                   Description=Removed in AL conversion }
    { 11012834;;Lab. Certif. Retrieval Dat OLD;DateTime;
                                                   OnValidate=BEGIN
                                                                // Intentionally left editable for troubleshooting purposes; should not be editable from the UI.
                                                              END;

                                                   CaptionML=[ENU=Lab. Certif. Retrieval Date OLD;
                                                              NOR=Arbeidssertifikater, innhentingsdato;
                                                              SVE=Lab.certif. hmtningsdatum];
                                                   Description=Removed in AL conversion }
    { 11012835;;Get Lab Certificate OLD;Boolean   ;CaptionML=[ENU=Get Lab Certificate OLD;
                                                              NOR=Hent labsertifikat;
                                                              SVE=Hmta arbetscertifikat];
                                                   Description=Removed in AL conversion;
                                                   Editable=No }
    { 11012840;;Hide on Service Portal;Boolean    ;CaptionML=ENU=Hide on Portal }
    { 11012990;;Export to FSA      ;Boolean       ;OnValidate=VAR
                                                                DocRefPoint@1210190000 : Record 11020296;
                                                                ServiceOrder@1100527300 : Record 11012823;
                                                              BEGIN
                                                                IF "Export to FSA" THEN BEGIN
                                                                  AddLatLngToServiceLocation;
                                                                  AddLatLngToServiceObjects;
                                                                  UpdateLongitudeLatitudeInExtensionTable;
                                                                  IF (Status > Status::"In Process") AND (Status <> Status::Cancelled) THEN
                                                                    FIELDERROR("Export to FSA", STRSUBSTNO(Text011, Status));
                                                                  IF (Status = Status::Cancelled) AND ("Date/Time Export to FSA" = 0DT) THEN
                                                                    FIELDERROR("Export to FSA", STRSUBSTNO(Text012, Status));

                                                                  CheckExportToFSA();
                                                                  DocRefPoint.InsertDocRefPointExportFSA("No.");
                                                                  //mg.sn, 14-12-11: M31481
                                                                  IF DocRefPoint.GetNewActRefPoint >= 0 THEN
                                                                    "Actual Reference Point (Gantt)" := DocRefPoint.GetNewActRefPoint;
                                                                  //mg.en, 14-12-11: M31481
                                                                END;

                                                                UpdateExportFSAInWorkOrder();

                                                                IF "Export to FSA" AND ServiceOrder.GET("No.") AND (Status <> ServiceOrder.Status) THEN BEGIN
                                                                  GET("No.");
                                                                  "Export to FSA" := TRUE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Export to Field Service;
                                                              NOR=Eksporter til Feltservice;
                                                              SVE=Exportera till fltservice];
                                                   Description=Export indication to FSA. (Field Service Admin. of 4PS-Mobile). Must be turned on at SO conscious. }
    { 11012991;;Date/Time Export to FSA;DateTime  ;CaptionML=[ENU=Date/Time Export to Field Service;
                                                              NOR=Dato/tid, Eksporter til Feltservice;
                                                              SVE=Datum/tid, export till fltservice];
                                                   Editable=No }
    { 11012992;;Contact No.        ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Contact Business Relation"."Contact No." WHERE (Link to Table=CONST(Customer),
                                                                                                                       No.=FIELD(Customer No.)));
                                                   CaptionML=[ENU=Contact No.;
                                                              NOR=Kontaktnr;
                                                              SVE=Kontaktnr];
                                                   Editable=No }
    { 11012993;;Bill-to Contact No.;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Contact Business Relation"."Contact No." WHERE (Link to Table=CONST(Customer),
                                                                                                                       No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Contact No.;
                                                              NOR=Faktura til-kontaktnr.;
                                                              SVE=Faktureringskontaktnr];
                                                   Editable=No }
    { 11012995;;Decentral Created  ;Boolean       ;CaptionML=[ENU=Decentral Created;
                                                              NOR=Perifer er opprettet;
                                                              SVE=Perifer r skapad];
                                                   Description=FSA/Mobile;
                                                   Editable=No }
    { 11012996;;Contact Person No. ;Code20        ;TableRelation=Contact.No. WHERE (Type=CONST(Person),
                                                                                    Company No.=FIELD(Contact No.),
                                                                                    Blocked=CONST(No));
                                                   OnValidate=VAR
                                                                Contact@1210190000 : Record 5050;
                                                                OverwriteCommunicationFields@1100409000 : Boolean;
                                                              BEGIN
                                                                CALCFIELDS("Contact Person Name","Contact Person Gender");

                                                                IF "Contact Person No." <> '' THEN BEGIN
                                                                  Contact.GET("Contact Person No.");
                                                                  Contact.TESTFIELD(Type, Contact.Type::Person);
                                                                  Contact.TESTFIELD(Blocked, FALSE);

                                                                  IF CurrFieldNo <> FIELDNO("Contact Person No.") THEN
                                                                    OverwriteCommunicationFields := TRUE
                                                                  ELSE
                                                                    OverwriteCommunicationFields := CONFIRM(Text108, TRUE);

                                                                  //mg.sn, 04-04-12: M33783
                                                                  IF OverwriteCommunicationFields THEN BEGIN
                                                                    "Contact Name" := "Contact Person Name";
                                                                    "Phone No." := Contact."Phone No.";
                                                                    "E-Mail" := Contact."E-Mail";
                                                                    "Phone No. 2" := Contact."Phone No. 2";
                                                                    "Mobile Phone No." := Contact."Mobile Phone No.";
                                                                    "Fax No." := Contact."Fax No.";
                                                                  END;
                                                                  //mg.en, 04-04-12: M33783
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupContactPersonNo;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Contact Person No.;
                                                              NOR=Kontaktperson;
                                                              SVE=Kontaktperson] }
    { 11012997;;Contact Person Name;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact Person No.)));
                                                   CaptionML=[ENU=Contact Person Name;
                                                              NOR=Kontaktpersonens navn;
                                                              SVE=Kontaktpersonens namn];
                                                   Editable=No }
    { 11012998;;Bill-to Contact Person;Code20     ;TableRelation=Contact.No. WHERE (Company No.=FIELD(Bill-to Contact No.),
                                                                                    Type=CONST(Person));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Bill-to Contact Person Name","Bill-to Contact Person Gender");
                                                                "Bill-to Contact Name" := "Bill-to Contact Person Name";
                                                                IF "Bill-to Contact Person" <> xRec."Bill-to Contact Person" THEN
                                                                  UpdateInvoiceDataBaseServiceOrderTree(FIELDNO("Bill-to Contact Person"));
                                                              END;

                                                   CaptionML=[ENU=Bill-to Contact Person;
                                                              NOR=Faktura til Kontaktperson;
                                                              SVE=Faktura till kontaktperson] }
    { 11012999;;Bill-to Contact Person Name;Text100;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Bill-to Contact Person)));
                                                   CaptionML=[ENU=Bill-to Contact Person Name;
                                                              NOR=Faktura til Kontaktperson, navn;
                                                              SVE=Faktura till kontaktperson, namn];
                                                   Editable=No }
    { 11013000;;Price Book Type    ;Option        ;OnValidate=BEGIN
                                                                IF xRec."Price Book Type" <> "Price Book Type" THEN
                                                                  ValidateUnitPriceTypeChange;
                                                              END;

                                                   CaptionML=[ENU=Price Book Type;
                                                              SVE=Enhetspristyp];
                                                   OptionCaptionML=[ENU=None,Internal,Customer;
                                                                    NOR=Ingen,Intern,Kunde);
                                                                    SVE=Inget,Internt,Kund];
                                                   OptionString=None,Internal,Customer }
    { 11013001;;Price Book Code    ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Extension"."Price Book Code" WHERE (Service Order No.=FIELD(No.)));
                                                   OnLookup=BEGIN
                                                              LookupPriceBook;
                                                            END;

                                                   CaptionML=[ENU=Price Book Code;
                                                              SVE=Enhetspriskod];
                                                   Editable=No }
    { 11013002;;Price Book Index Date;Date        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Extension"."Price Book Index Date" WHERE (Service Order No.=FIELD(No.)));
                                                   OnLookup=BEGIN
                                                              LookupPriceBook;
                                                            END;

                                                   CaptionML=[ENU=Price Book Index Date;
                                                              SVE=Indexdatum fr enhetspris];
                                                   Editable=No }
    { 11013010;;Unit Price Status  ;Option        ;OnValidate=BEGIN
                                                                ProcessUnitPriceStatusChange;
                                                              END;

                                                   CaptionML=[ENU=Unit Price Status;
                                                              NOR=Enhetspris, status;
                                                              SVE=Enhetsprisstatus];
                                                   OptionCaptionML=[ENU=" ,Pre-Recording,Recording,Production Recording,,,,,Finished";
                                                                    NOR=" ,Forhndsregistrering,Registrering,Realisering,,,,,Finished";
                                                                    SVE=" ,Frregistrering,Registrering,Realisering,,,,,Avslutad"];
                                                   OptionString=[ ,Pre-Recording,Recording,Production Recording,,,,,Finished] }
    { 11013020;;Change Request No. ;Code20        ;TableRelation="Change Request";
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Change Request Description");
                                                              END;

                                                   CaptionML=[ENU=Change Request No.;
                                                              SVE=ndringsbegransnr];
                                                   NotBlank=Yes;
                                                   Editable=No }
    { 11013021;;Change Request Description;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Change Request".Description WHERE (No.=FIELD(Change Request No.)));
                                                   CaptionML=[ENU=Change Request Description;
                                                              SVE=ndringsbegran, beskrivning];
                                                   Editable=No }
    { 11013030;;Invoiced (LCY)     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service-Ledger Entry"."Total Revenue (LCY)" WHERE (Service Order No.=FIELD(No.),
                                                                                                                       Cost Type=CONST(Revenues)));
                                                   CaptionML=[ENU=Invoiced (LCY);
                                                              SVE=Fakturerat (BVA)] }
    { 11013035;;Master Company     ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Extension"."Master Company" WHERE (Service Order No.=FIELD(No.)));
                                                   TableRelation=Company;
                                                   CaptionML=[ENU=Master Company;
                                                              SVE=Huvudfretag];
                                                   Editable=No }
    { 11013040;;Master Project     ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Extension"."Master Project" WHERE (Service Order No.=FIELD(No.)));
                                                   OnLookup=VAR
                                                              Job@1100528600 : Record 11072003;
                                                            BEGIN
                                                              Job.SETRANGE("Internal Project", FALSE);
                                                              IF Job.GET("Master Project") THEN;
                                                              PAGE.RUN(0, Job);
                                                            END;

                                                   CaptionML=[ENU=Master Project;
                                                              NOR=Hovedprosjekt;
                                                              SVE=Originalprojekt];
                                                   Editable=No }
    { 11013050;;Master Element     ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order Extension"."Master Element" WHERE (Service Order No.=FIELD(No.)));
                                                   OnLookup=VAR
                                                              ProjectElement@1100528600 : Record 11012010;
                                                            BEGIN
                                                              CALCFIELDS("Master Project", "Master Element");
                                                              ProjectElement.SETRANGE("Project No.", "Master Project");
                                                              IF ProjectElement.GET("Master Project", "Master Element") THEN
                                                              PAGE.RUN(0, ProjectElement);
                                                            END;

                                                   CaptionML=[ENU=Master Element;
                                                              NOR=Hovedelement;
                                                              SVE=Originalelement];
                                                   Editable=No }
    { 11013060;;No. of Unproc. Debrief Specs;Integer;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Count("Service Order Obj. Spec. Line" WHERE (Service Order No.=FIELD(No.),
                                                                                                            Status=CONST(Received),
                                                                                                            Type=CONST(Line)));
                                                   CaptionML=ENU=No. of Unprocessed Debrief Specifications;
                                                   Editable=No }
    { 11013070;;SMS Reminder Sent  ;Boolean       ;CaptionML=[ENU=SMS Reminder Sent;
                                                              SVE=SMS-pminnelse snd];
                                                   Editable=No }
    { 11013080;;Plant Meter        ;Code10        ;TableRelation="Plant Meter Type"."Plant Meter" WHERE (Plant Type=FIELD(Plant Type),
                                                                                                         Plant No.=FIELD(Plant Number));
                                                   OnValidate=VAR
                                                                PlantMeterType@1100529600 : Record 11229921;
                                                              BEGIN
                                                                IF "Plant Meter" <> '' THEN BEGIN
                                                                  PlantMeterType.CHANGECOMPANY("Plant Company");
                                                                  PlantMeterType.SETRANGE("Plant Type", "Plant Type");
                                                                  PlantMeterType.SETRANGE("Plant No.",  "Plant Number");
                                                                  PlantMeterType.SETRANGE("Plant Meter",  "Plant Meter");
                                                                  PlantMeterType.FINDFIRST;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantMeter;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant Meter;
                                                              SVE=Maskinrknare];
                                                   Description=BI049 }
    { 11013090;;Allow Invoice Separately;Boolean  ;CaptionML=[ENU=Allow Invoice Separately;
                                                              SVE=Tillt separat fakturering] }
    { 11013100;;Contact Person Gender;Option      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Gender WHERE (No.=FIELD(Contact Person No.)));
                                                   CaptionML=[ENU=Contact Person Gender;
                                                              SVE=Kontaktperson, kn];
                                                   OptionCaptionML=[ENU=" ,Female,Male";
                                                                    NOR=" ,Kvinne,Mann";
                                                                    SVE=" ,Kvinna,Man"];
                                                   OptionString=[ ,Female,Male];
                                                   Editable=No }
    { 11013110;;Bill-to Contact Person Gender;Option;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Gender WHERE (No.=FIELD(Bill-to Contact Person)));
                                                   CaptionML=[ENU=Bill-to Contact Person Gender;
                                                              SVE=Faktura till kontaktperson, kn];
                                                   OptionCaptionML=[ENU=" ,Female,Male";
                                                                    NOR=" ,Kvinne,Mann";
                                                                    SVE=" ,Kvinna,Man"];
                                                   OptionString=[ ,Female,Male];
                                                   Editable=No }
    { 11013120;;Pre-Recording Amount;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("SUP Recording Line"."Pre-Recording Amount" WHERE (Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Pre-Recording Amount;
                                                              NOR=Forhndsregistrering Belp;
                                                              SVE=Frregistreringsbelopp];
                                                   DecimalPlaces=2:5;
                                                   Editable=No }
    { 11013130;;Recording Amount   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("SUP Recording Line"."Recording Amount" WHERE (Service Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=Recording Amount;
                                                              NOR=Registrering Belp;
                                                              SVE=Registreringsbelopp];
                                                   DecimalPlaces=2:5;
                                                   Editable=No }
    { 11013140;;Service Object No. ;Code20        ;OnValidate=VAR
                                                                ServiceOrderObject@1100528500 : Record 11071724;
                                                                ServiceObject@1100526100 : Record 11071691;
                                                              BEGIN
                                                                IF NOT ServiceOrderObject.GET("No.", "Service Object No.") THEN BEGIN
                                                                  IF NOT ServiceObject.GET("Service Object No.") THEN BEGIN
                                                                    ServiceObject.INIT;
                                                                    ServiceObject.VALIDATE("No.", "Service Object No.");
                                                                    ServiceObject.INSERT;
                                                                  END;
                                                                  ServiceOrderObject.INIT;
                                                                  ServiceOrderObject.VALIDATE("Service Order No.", "No.");
                                                                  ServiceOrderObject.VALIDATE("Object No.", "Service Object No.");
                                                                  ServiceOrderObject.INSERT(TRUE);
                                                                END;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Service Object No.;
                                                              SVE=Serviceobjektnr] }
    { 11013150;;Bill-to Contact Name;Text100      ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Bill-to Contact Name;
                                                              SVE=Fakturera till kontaktnamn] }
    { 11013160;;Use Bill-To Cust. for Pr. Book;Boolean;
                                                   OnValidate=BEGIN
                                                                DeterminePriceBookFields;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Use bill-to Customer for Price Book }
    { 11128000;;Created Time       ;Time          ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Created Time;
                                                              SVE=Skapattid];
                                                   Editable=No }
    { 11128270;;Price List Code    ;Code20        ;TableRelation="Customer Price List" WHERE (Display Price List=CONST(Yes));
                                                   CaptionML=[ENU=Price List Code;
                                                              NOR=Prislistekode;
                                                              SVE=Prislistekod] }
    { 11128285;;Tactics Agreement  ;Decimal       ;CaptionML=[ENU=Tactics Agreeement (%);
                                                              SVE=Taktikavtal (%)] }
    { 11128286;;Delivery Address Note;Text30      ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Delivery Address Note;
                                                              SVE=Leveransmeddelande] }
    { 11128287;;Invoice Text       ;Text250       ;CaptionML=[ENU=Invoice Text;
                                                              NOR=Fakturatekst;
                                                              SVE=Fakturatext] }
    { 11128290;;Sales Discount Term Percent;Decimal;
                                                   OnValidate=BEGIN
                                                                //>> 161010 ITERO.AC RAD043 New field "Sales Discount Term Percent" (User must select either a Discount Term Group or a discount percentage)
                                                                IF ("Sales Discount Term Percent" > 99.99) OR ("Sales Discount Term Percent" < -99.99) THEN
                                                                  ERROR(Text11128292, FIELDCAPTION("Sales Discount Term Percent"));

                                                                IF ("Sales Discount Term Group 1" <> '') AND ("Sales Discount Term Percent" <> 0) THEN
                                                                  ERROR(Text11128290, FIELDCAPTION("Sales Discount Term Group 1"));
                                                                //<< 161010 ITERO.AC RAD043
                                                              END;

                                                   CaptionML=[ENU=Sales Discount percent;
                                                              NOR=Salgsrabatt prosent;
                                                              SVE=Frsljningsrabatt procent] }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Customer No.                             }
    {    ;Service Contract No.,Source Type,Order Date }
    {    ;Service Location No.,Source Type         }
    {    ;Previous Service Order No.               }
    {    ;Base Service Order No.                   }
    {    ;Base Service Order                       }
    {    ;City,Address                             }
    {    ;Post Code                                }
    {    ;Order Date,Order Time                    }
    {    ;Starting Date,Starting Time              }
    {    ;Ending Date,Ending Time                  }
    {    ;Priority                                 }
    {    ;Call No.                                 }
    {    ;Next Deadline                            }
    {    ;Actual Reference Point (Gantt),Service Type,Source Type,Assigned to }
    {    ;Employee No.,Starting Date,Starting Time }
    {    ;Global Dimension 1 Code                  }
    {    ;Export to FSA                            }
    {    ;Estimate No.,Sub-Estimate No.            }
    {    ;Laboratory Order Creation Date           }
    {    ;Service Location No.,Order Date,Order Time }
    {    ;Vessel No.                               }
    {    ;Service Location No.,Status,Starting Date }
    {    ;Service Contract No.,Status,Starting Date }
    {    ;Collective List No.                      }
    {    ;Bill-to Customer No.                     }
    {    ;Subcontractor,Actual Reference Point (Gantt),Last Possible Ending Date,Ending Date }
    {    ;Glazing Service Call No.                 }
    {    ;Subcontractor,Starting Date,Starting Time }
    {    ;Starting Date,Duration Time,Status       }
    {    ;Assigned to                              }
    {    ;Service Contract No.,Order Date,Source Type;
                                                   SumIndexFields=Order Amount (LCY) }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ServSetup@1210190000 : Record 11012800;
      UserSetup@1100485011 : Record 91;
      ServLogRec@1100485006 : Record 11012855;
      ServContrRec@1210190008 : Record 11012812;
      ServLocRec@1210190004 : Record 11012801;
      ServActRec@1210190011 : Record 5080;
      ServAdviceRec@1210190015 : Record 11012055;
      ServCostPlusRec@1210190012 : Record 11012825;
      ServTypeRec@1210190022 : Record 11012814;
      ServPackRec@1100525007 : Record 11012806;
      ProgSchemeRec@1100485004 : Record 11020250;
      ProgPhaseRec@1100485005 : Record 11020251;
      RefPeriodRec@1100485007 : Record 11020272;
      CustRec@1210190009 : Record 18;
      BudgetRateRec@1210190020 : Record 11012000;
      DimValRec@1210190019 : Record 349;
      TempServOrderRec2@1100485001 : TEMPORARY Record 11012823;
      PostCode@1210190016 : Record 225;
      TradeSpecRec@1100485021 : Record 11020285;
      SignatureRec@1100525010 : Record 11020349;
      ServOrderExtension@1100528900 : Record 11071727;
      PlantLocRec@1100529300 : Record 11012554;
      DimMgt@1210190018 : Codeunit 408;
      NoSeriesMgt@1210190001 : Codeunit 396;
      CtrlOrSubContrActiveTxt@1100528301 : TextConst 'ENU=%1 %2 or %3 %4 must be active.';
      Text000@1210190006 : TextConst 'ENU=must occur before %1;NOR=m inntreffe fr %1;SVE=mste intrffa fre %1';
      MoveEntries@1210190027 : Codeunit 361;
      Text001@1210190013 : TextConst 'ENU=Do you want to change %1?;NOR=Vil du endre %1?;SVE=Vill du ndra %1?';
      Text002@1210190021 : TextConst 'ENU=Status not allowed, will be set by Closing procedure;NOR=Status er ikke tillatt, denne vil bli satt av avslutningsprosedyre';
      Text003@1210190023 : TextConst 'ENU=%1 %2 should have at least %3 %4.;NOR=%1 %2 m ha minst %3 %4.;SVE=%1 %2 mste minst ha %3 %4.';
      Text004@1210190030 : TextConst 'ENU=Service Contract %1 expires on %2;NOR=Servicekontrakt %1 utgr %2;SVE=Servicekontrakt %1 lper ut den %2';
      Text004a@1100525009 : TextConst 'ENU=%3 before Starting Date %2 of Service Contract %1;NOR=%3 fr startdato %2 for servicekontrakt %1;SVE=%3 fre startdatum %2 av servicekontrakt %1';
      Text004b@1100525005 : TextConst 'ENU=%3 after Ending Date %2 of Service Contract %1;NOR=%3 etter sluttdato %2 for servicekontrakt %1;SVE=%3 efter slutdatum %2 av servicekontrakt %1';
      Text005@1210190026 : TextConst 'ENU=%1 %2 has %3 %4.;NOR=%1 %2 har %3 %4.;SVE=%1 %2 har %3 %4.';
      Text007@1210190031 : TextConst 'ENU=Assignment not accepted: the result would be a never ending chain of Service Orders;NOR=Tilordningen ble ikke akseptert: Resultatet ville blitt en evigvarende kjede av serviceordre.;SVE=Tilldelning inte godknd: resultatet skulle bli en ondlig kedja av serviceordrar';
      Text008@1100485008 : TextConst 'ENU=must occur between %1 and %2;NOR=M inntreffe mellom %1 og %2;SVE=mste intrffa mellan %1 och %2';
      Text009@1100485016 : TextConst 'ENU=Modify %1 of %2 ''%3'' not allowed due to choosen blockade by actual Reference Point.;NOR= endre %1 av %2 er ikke tillatt pga valgt blokkering av faktisk referansepunkt;SVE=Att ndra %1 av %2 r inte tilltet p grund av vald blockering av verklig referenspunkt.';
      Text010@1100485000 : TextConst 'ENU=Do you want to change the Address and the Communication Data? \\Old: \%1 \%2 \%3 \%4 \%5 \%6 \%7 \\New: \%8 \%9 \%10 \%11 \%12 \%13 \%14;SVE=Vill du ndra adressdata? \\Gammal: \%1 \%2 \%3 \%4 \%5 \\Nya: \%6 \%7 \%8 \%9 \%10';
      gSkipStatusCheck@1210190002 : Boolean;
      gSkipUpdateDocRefPoint@1100485012 : Boolean;
      gUseFilledOrderDateTime@1100485019 : Boolean;
      Text011@1100485013 : TextConst 'ENU=not allowed for an order with status ''%1'';NOR=ikke tillatt for en ordre med status ''%1'';SVE=inte tilltet fr en order med status ''%1''';
      Text012@1100485014 : TextConst 'ENU=not allowed for n order with status ''%1'' that is never exported to Field Service;NOR=ikke tillatt for en ordre med status ''%1'' som aldri er eksportert til feltservice;SVE=inte tilltet fr en order med status ''%1'' som aldrig har exporterats till fltservice';
      Text013@1100485015 : TextConst 'ENU=Actueel Reference Point is blocked for modify, send Service Order ''%1'' to Field Service not allowed.;NOR=Faktisk referansepunkt er blokkert for endring,  sende Serviceordre ''%1'' til ferltservice er ikke tillatt;SVE=Verklig referenspunkt r sprrad fr ndring, att skicka serviceorder ''%1'' till fltservice r inte tilltet.';
      AskQuestionAddress@1100485017 : Boolean;
      Text014@1100485018 : TextConst 'ENU=Actueel Reference Point is blocked for export of Service Order %1 to Field Service.;NOR=Faktisk referansepunkt er blokkert for eksport av Serviceordre %1 til feltservice.;SVE=Verklig referenspunkt r sprrad fr export av serviceorder %1 till fltservice.';
      SkipPlanCu@1100485023 : Boolean;
      Text015@1100485010 : TextConst 'ENU=Bill-To Address,Address;NOR=Fakturer til-adresse,Adresse;SVE=Fakturera-till adress,adress';
      Text016@1100525000 : TextConst 'ENU=%1 can not be changed by user %2, because (expected) cost and/or revenues are registrated.;NOR=%1 kan ikke endres av bruker %2, fordi (forventet kostnad og/eller inntekt er registrert);SVE=%1 kan inte anvndas av anvndare %2, eftersom (frvntad) kostnad och/eller intkter r registrerade.';
      Text018@1100528602 : TextConst 'ENU=Do you want to change %1: \Old: %2 - %3\New: %4 - %5;SVE=Vill du ndra %1: \Gammal: %2 - %3\Ny: %4 - %5';
      Text023@1100525008 : TextConst 'ENU=Before you can use Online Map, you must fill in the Online Map Setup window.\See Setting Up Online Map in Help.;NOR=Fr du kan bruke Online Map m du fylle ut vinduet Online Map - Innstillinger.\Se Konfigurasjon av Online Map i Hjelp;SVE=Innan du kan anvnda Online Map mste du fylla i fnstret Online Map - instllning.\Se Konfiguration av Online Map i hjlpen';
      Text024@1100528300 : TextConst 'ENU=FuctionCode FLS VisiTour not allowed.';
      Text999@1100525006 : TextConst 'ENU=Rename not allowed due to external applications;NOR=Gi nytt navn er ikke tillatt pga eksterne programmer;SVE=Att ge nytt namn r inte tilltet p grund av externa program';
      DPA_Management@1100000999 : Codeunit 11012783;
      SaveField@1210190014 : Integer;
      Text036@1100528401 : TextConst 'ENU=%1 with %2 %3 not found.;NOR=%1 med %2 %3 ikke funnet;SVE=%1 med %2 %3 hittades inte.';
      Text037@1100528400 : TextConst 'ENU=There should be only 1 %1 with %2 %3.;NOR=Det skal kun vre 1 %1 med %2 %3.;SVE=Det ska endast vara 1 %1 med %2 %3.';
      SaveDefaultDim@1210190032 : Boolean;
      Text040@1210190036 : TextConst 'ENU=Not all related Service Orders have status Technical Finished, continue?;NOR=Noen Serviceordre mangler statusen Teknisk ferdig. Fortsette?;SVE=Alla relaterade serviceordrar har inte statusen Tekniskt frdig, fortstta?';
      Text041@1210190035 : TextConst 'ENU=Show these Service Orders First,Change Both Base and Related Service Orders,Change Only Base Service Order;SVE=Bde basserviceorder och relaterade serviceorder,Endast basserviceorder';
      Text042@1210190034 : TextConst 'ENU="Status Change ";SVE="ndra status p "';
      DisableBaseOrderCheck@1100528603 : Boolean;
      Text103@1100528604 : TextConst 'ENU=Service Location No. %1 is not part of any Service Contract Object of Service Contract %2;NOR=Servicekontrakt nr. %1 er ikke del av et Servicekontraktobjekt for Servicekontrakt %2;SVE=Serviceplatsnr %1 r inte del av ngot servicekontraktsobjekt av servicekontrakt %2';
      Text104@1210190038 : TextConst 'ENU=Manually entered Price;NOR=Manuellt angitt pris;SVE=Manuellt angivet pris';
      Text106@1100528800 : TextConst 'ENU=Do you want to change the Currency Code ?;NOR=Vil du endre Valutakoden?;SVE=Vill du ndra valutakoden?';
      Text107@1210190040 : TextConst 'ENU=%1 is within Closed Contract Period %2 of Service Contract %3.;SVE=%1 r inom stngd kontraktsperiod %2 fr servicekontrakt %3.';
      AnalysisType@1100528606 : 'Problem,Cause,Solution';
      Text108@1100409000 : TextConst 'ENU=Copy Communication Data from Contact Person?;NOR=Kopier kommunikasjonsdata fra kontaktperson?;SVE=Kopiera kommunikationsuppgifter frn kontaktperson?';
      Text109@1100528600 : TextConst 'ENU=Are you sure you want to disconnect this Next Service Order (and possible connected Next Service Orders) from the Base Service Order?;NOR=Er du sikker p at du vil koble fra denne Neste Serviceordren (og mulige koblede Neste serviceordre) fra Basisserviceordren?';
      Text110@1100528607 : TextConst 'ENU=Invoiced Cost Plus Entries exist, disconnecting not possible.;NOR=Fakturerte selvkosttransaksjoner finnes, frakobling er ikke mulig';
      Text112@1100525002 : TextConst 'ENU=Attention! Base Service Order %1 has status %2.';
      Text113@1100525003 : TextConst 'ENU=Service Order %1 has Next Service Orders, linking not allowed';
      Text114@1100525011 : TextConst 'ENU=Plant Location cannot be assigned to a service order;SVE=Maskinplats kan inte tilldelas till en serviceorder';
      DontShowMenuOnStatusChange@1100525012 : Boolean;
      Text115@1100528601 : TextConst 'ENU=Service Order is Firm Planned, continue?;SVE=Det finns fakturerade redovisade sjlvkostnader, att ndra %1 r inte tilltet';
      Text116@1100528608 : TextConst 'ENU=Service Order %1 is Firm Planned, changes not allowed';
      Text117@1100528609 : TextConst 'ENU=Changes to field %1 not allowed, more than 1 work orders present';
      Text118@1100409001 : TextConst 'ENU=Changes to field %1 not propagated to work orders, more than 1 work orders present';
      Text119@1100409002 : TextConst 'ENU=%1 precedes %2, continue?;SVE=%1 fregr %2, fortstt?';
      Text120@1100528611 : TextConst 'ENU=Only Entry List will be displayed without expected costs';
      Text121@1100528610 : TextConst 'ENU=Only Entry List will be displayed without expected revenues';
      Text122@1100529400 : TextConst 'ENU=%1 %2 of %3 %4 also assigned to %5 %6;NOR=%1 %2 av %3 %4 ogs tilordnet %5 %6;SVE=%1 %2 av %3 %4 ven tilldelade till %5 %6';
      SkipUpdateServiceText@1100525001 : Boolean;
      SuppressAutoRecalculateCollectiveList@1100528612 : Boolean;
      Text124@1100525004 : TextConst 'ENU=Warning: %1 ''%2-%3'' not in %4;SVE=Varning: %1 ''%2-%3'' inte i %4';
      MultipleAnswerStatusChange@1100527000 : Integer;
      Text125@1100529600 : TextConst 'ENU=Changes to field %1 not allowed, processed advice order lines present.';
      Text127@1100527001 : TextConst 'ENU=If you change the %1, then the %2s will be removed. Are you sure that you want to continue?';
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      ReferencePointModifiedByEmployee@1100526000 : Code[20];
      Text128@1100529601 : TextConst 'ENU=%1 on %2 %3 must not be later than %4 on %5 %6 (%7).';
      Text129@1100529691 : TextConst 'ENU=Charge to Company must be empty.';
      Text130@1100529692 : TextConst 'ENU=Charge to Project must be empty.';
      Text131@1100528605 : TextConst 'ENU=Changes to field %1 not allowed, change this field on base service order instead.';
      SkipDeterminePriceBookFields@1100529602 : Boolean;
      Text132@1100529603 : TextConst 'ENU=Price book already in place. Do you want to change it?';
      Text133@1100529604 : TextConst 'ENU=SUP Recording Lines already exist, overwrite?';
      Text134@1100527350 : TextConst 'ENU=must occur after %1';
      Text135@1100527450 : TextConst 'ENU=%1 related Work Order(s) exist. Delete related Work Order(s)?';
      Text11128290@1101285000 : TextConst 'ENU=You cannot enter a discount percentage if %1 has been selected;NOR=Du kan ikke angi noen rabattprosenten nr %1 er valgt;SVE=Du fr inte ange ngon rabatt i procent nr %1 har valts';
      Text11128291@1101285001 : TextConst 'ENU=You cannot select %1 if a Sales Discount Percentage has been entered;NOR=Du kan ikke velge noe i %1 nr salgsrabatt i prosent er ifyllt;SVE=Du fr inte vlja ngot i "%1" nr en frsljningsrabatt i procent har angivits';
      Text11128292@1101285002 : TextConst 'ENU=Illegal value in %1 (valid range is -99,99 to 99,99);NOR=Ulovlig verdi av %1 (tillatte omrdet er 99,9 til 99,99);SVE=Otilltet vrde i %1 (tilltet intervall r -99,9 till 99,99)';

    PROCEDURE ValidateAddressData@1210190000(lvAction@1210190002 : Integer);
    VAR
      Message@1100527000 : Text;
    BEGIN
      ServSetup.GET;
      IF (lvAction <> 3) AND ((CurrFieldNo = FIELDNO("Plant Location")) OR (CurrFieldNo = FIELDNO("Plant Number"))) AND
         ("Plant Location" <> '') AND ("Customer No." = ServSetup."Customer Internal Charge")
      THEN  //C022547.n
        EXIT;

      CASE lvAction OF
        1: ValidateServiceLocAddressData;
        2: ValidateBillToCustAddressData;
        3: ValidatePlantLocAddressData;
      END;

      IF ((CurrFieldNo <> 0) OR ((CurrFieldNo = 0) AND AskQuestionAddress)) AND  ((lvAction = 1) OR (lvAction = 3 )) AND ("No." <> '') THEN BEGIN
        IF ((xRec.Name + xRec.Address + xRec.City + xRec."Post Code" + xRec."Contact Name" + xRec."Phone No." + xRec."Mobile Phone No." + xRec."E-Mail") <>
            (Name + Address + City + "Post Code" + "Contact Name" + "Phone No." + "Mobile Phone No." + "E-Mail")) AND
            ((xRec.Name + xRec.Address + xRec.City + xRec."Post Code" + xRec."Contact Name" + xRec."Phone No." + xRec."Mobile Phone No." + xRec."E-Mail" <> ''))
        THEN BEGIN
          Message := STRSUBSTNO(Text010, xRec.Name, xRec.Address, (xRec."Post Code" + '  ' + xRec.City), xRec."Contact Name", xRec."Phone No.", xRec."Mobile Phone No.",
                                xRec."E-Mail", Name, Address, ("Post Code" + '  ' + City), "Contact Name", "Phone No.", "Mobile Phone No.", "E-Mail");
          IF CONFIRM(Message, TRUE) = FALSE THEN BEGIN
            Name := xRec.Name;
            "Name 2" := xRec."Name 2";
            Address := xRec.Address;
            "Address 2":= xRec."Address 2";
            VALIDATE("Post Code", xRec."Post Code");
            City := xRec.City;
            "Country/Region Code" := xRec."Country/Region Code";
            "Contact Name" := xRec."Contact Name";
            "Phone No." := xRec."Phone No.";
            "Phone No. 2" := xRec."Phone No. 2";
            "Mobile Phone No." := xRec."Mobile Phone No.";
            "Fax No." := xRec."Fax No.";
            "E-Mail" := xRec."E-Mail";
            "Territory Code" := xRec."Territory Code";
          END ELSE BEGIN
            AskQuestionAddress := FALSE;  //db, 12-06-07 (call 9357)
            xRec.Name := Name;
            xRec."Name 2" := "Name 2";
            xRec.Address := Address;
            xRec."Address 2" := "Address 2";
            xRec.City := City;
            xRec."Country/Region Code" := "Country/Region Code";
            xRec."Post Code" := "Post Code";
            xRec."Post Code Type" := "Post Code Type";
            xRec."Contact Name" := "Contact Name";
            xRec."Phone No." := "Phone No.";
            xRec."Phone No. 2" := "Phone No. 2";
            xRec."Mobile Phone No." := "Mobile Phone No.";
            xRec."Fax No." := "Fax No.";
            xRec."E-Mail" := "E-Mail";
            xRec."Territory Code" := "Territory Code";
          END;
        END;
      END;
      CopyExtraCost;
      UpdateExtraWorkOrderFields;
    END;

    PROCEDURE ValidateServiceLocAddressData@1100529910();
    BEGIN
      GetCustomerAddressData;

      IF NOT GetServiceLocationAddressData THEN
        IF NOT GetServiceContractAddressData THEN
          GetPlantLocationAddressData;
    END;

    PROCEDURE ValidateBillToCustAddressData@1100529901();
    BEGIN
      IF "Bill-to Customer No."  <> '' THEN BEGIN
        CheckInvoiceAddress;
        CustRec.GET("Bill-to Customer No.");
        CustRec.CheckCustomerStatus("Bill-to Customer No.");
      END;
    END;

    PROCEDURE ValidatePlantLocAddressData@1100529908();
    BEGIN
      IF NOT GetPlantLocationAddressData THEN
        IF NOT GetServiceLocationAddressData THEN
          IF NOT GetServiceContractAddressData THEN
            GetCustomerAddressData;
    END;

    LOCAL PROCEDURE GetServiceLocationAddressData@1100529610() : Boolean;
    VAR
      Employee@1100525000 : Record 5200;
    BEGIN
      IF "Service Location No." = '' THEN
        EXIT(FALSE);
      ServSetup.GET;

      ServLocRec.GET("Service Location No.");
      ServLocRec.TESTFIELD(Blocked, FALSE);
      Name := COPYSTR(ServLocRec.Description, 1, MAXSTRLEN(Name));
      "Name 2":= COPYSTR(ServLocRec."Description 2", 1, MAXSTRLEN("Name 2"));
      Address := ServLocRec.Address;
      "Address 2" := ServLocRec."Address 2";
      City := ServLocRec.City;
      "Country/Region Code" := ServLocRec."Country/Region Code";
      "Post Code" := ServLocRec."Post Code";
      "Contact Name" := ServLocRec."Contact Name";
      "Bill-to Contact Name" := ServLocRec."Bill-to Contact Name";
      "Phone No." := ServLocRec."Phone No.";
      "Phone No. 2" := ServLocRec."Phone No. 2";
      "Mobile Phone No." := ServLocRec."Mobile Phone No.";
      "Fax No." := ServLocRec."Fax No.";
      "E-Mail" := ServLocRec."E-Mail";
      "Territory Code" := ServLocRec."Territory Code";
      IF "Territory Code" = '' THEN
        PostCode.GetTerritoryByPostCodeGroup(City,"Post Code","Territory Code");  //db, 11-02-13: C005566
      IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::LocationMgt THEN
        VALIDATE("Order Manager", ServLocRec."Location Manager");  //db, 06-01-09
      IF ServSetup."Assign To" = ServSetup."Assign To"::LocationMgt THEN
        IF (ServLocRec."Location Manager" = '') OR Employee.GET(ServLocRec."Location Manager") THEN
          VALIDATE("Assigned to", ServLocRec."Location Manager");
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetServiceContractAddressData@1100529612() : Boolean;
    VAR
      Employee@1100525000 : Record 5200;
    BEGIN
      IF "Service Contract No." = '' THEN
        EXIT(FALSE);
      ServSetup.GET;
      ServContrRec.GET("Service Contract No.");
      ServContrRec.TESTFIELD(Blocked, FALSE);
      ServContrRec.CALCFIELDS(Name, Address, City, "Post Code");
      IF ServContrRec."Customer No." <> '' THEN BEGIN  //db, 23-11-06 (dummy contract)
        Name := ServContrRec.Name;
        "Name 2" := ServContrRec."Name 2";
        Address := ServContrRec.Address;
        "Address 2" := ServContrRec."Address 2";
        City := ServContrRec.City;
        "Country/Region Code" := ServContrRec."Country/Region Code";
        VALIDATE("Post Code", ServContrRec."Post Code");
        "Contact Name" := ServContrRec."Contact Name";
        "Phone No." := ServContrRec."Phone No.";
        "Phone No. 2" := ServContrRec."Phone No. 2";
        "Mobile Phone No." := ServContrRec."Mobile Phone No.";
        "Fax No." := ServContrRec."Fax No.";
        "E-Mail" := ServContrRec."E-Mail";
        //"Territory Code" := ServContrRec."Territory Code";
      END;
      IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::ContractMgt THEN
        VALIDATE("Order Manager", ServContrRec."Contract Manager");  //db, 06-01-09
      IF ServSetup."Assign To" = ServSetup."Assign To"::ContractMgt THEN
        IF (ServContrRec."Contract Manager" = '') OR Employee.GET(ServContrRec."Contract Manager") THEN
          VALIDATE("Assigned to", ServContrRec."Contract Manager");
      EXIT(TRUE);
    END;

    PROCEDURE GetPlantLocationAddressData@1100529607() : Boolean;
    VAR
      PlantLocation@1100529901 : Record 11012554;
      PlantLocationAddress@1100529902 : Record 11012590;
    BEGIN
      IF "Plant Location" = '' THEN
        EXIT(FALSE);

      PlantLocation.CHANGECOMPANY("Plant Company");
      PlantLocation.GET("Plant Location");
      PlantLocation.TESTFIELD(Blocked, FALSE);
      Name := COPYSTR(PlantLocation.Description, 1, MAXSTRLEN(Name));
      "Name 2":= COPYSTR(PlantLocation."Description 2", 1, MAXSTRLEN("Name 2"));
      "VAT Bus. Posting Group" := PlantLocation."VAT Bus. Posting Group";
      IF "Alternative Plant Loc Address" = '' THEN BEGIN
        Address := PlantLocation.Address;
        "Address 2" := PlantLocation."Address 2";
        City := PlantLocation.City;
        "Country/Region Code" := PlantLocation."Country/Region Code";
        "Post Code" := PlantLocation."Post Code";
        "Contact Name" := PlantLocation.Contact;
        "Phone No." := PlantLocation."Phone No.";
        "Phone No. 2" := PlantLocation."Contact Phone No.";
        "Fax No." := PlantLocation."Fax No.";
        "E-Mail" := PlantLocation."E-Mail";
        "Territory Code" := PlantLocation."Territory Code";
        "Mobile Phone No." := PlantLocation."Mobile Phone No.";
      END ELSE BEGIN
        PlantLocationAddress.CHANGECOMPANY("Plant Company");
        IF PlantLocationAddress.GET("Plant Location", "Alternative Plant Loc Address") THEN BEGIN
          Address := PlantLocationAddress.Address;
          "Address 2" := PlantLocationAddress."Address 2";
          City := PlantLocationAddress.City;
          "Country/Region Code" := '';
          "Post Code" := PlantLocationAddress."Post Code";
          "Contact Name" := PlantLocationAddress.Contact;
          "Phone No." := PlantLocationAddress."Phone No.";
          "Phone No. 2" := '';
          "Fax No." := '';
          "E-Mail" := PlantLocationAddress."E-Mail";
          "Territory Code" := '';
          "Mobile Phone No." := PlantLocationAddress."Mobile Phone No.";
        END;
      END;
      PostCode.GetTerritoryByPostCodeGroup(City, "Post Code", "Territory Code");  //db, 11-02-13: C005566

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetCustomerAddressData@1100529603();
    VAR
      BillToCustomerCodeLoc@1100529900 : Code[20];
    BEGIN
      IF "Customer No."  = '' THEN
        EXIT;

      CustRec.GET("Customer No.");
      CustRec.CheckCustomerStatus("Customer No.");
      Name := CustRec.Name;
      "Name 2":= CustRec."Name 2";
      Address := CustRec.Address;
      "Address 2":= CustRec."Address 2";
      City := CustRec.City;
      "Country/Region Code" := CustRec."Country/Region Code";
      "Post Code" := CustRec."Post Code";
      "Contact Name" := CustRec.Contact;
      "Phone No." := CustRec."Phone No.";
      "Phone No. 2" := CustRec."Phone No. 2";
      "Mobile Phone No." := CustRec."Mobile Phone No.";
      "Fax No." := CustRec."Fax No.";
      "E-Mail" := CustRec."E-Mail";
      "Territory Code" := CustRec."Territory Code";
      IF "Territory Code" = '' THEN
        PostCode.GetTerritoryByPostCodeGroup(City,"Post Code","Territory Code");  //db, 11-02-13: C005566
      IF CustRec."Bill-to Customer No." <> '' THEN
        BillToCustomerCodeLoc := CustRec."Bill-to Customer No."
      ELSE
        BillToCustomerCodeLoc := "Customer No.";
      IF "Bill-to Customer No." = '' THEN
        VALIDATE("Bill-to Customer No.", BillToCustomerCodeLoc)
      ELSE BEGIN
        IF (CurrFieldNo = FIELDNO("Customer No.")) AND (BillToCustomerCodeLoc<> "Bill-to Customer No.") THEN
          IF CONFIRM(Text001,FALSE,FIELDCAPTION("Bill-to Customer No.")) THEN BEGIN
            VALIDATE("Bill-to Customer No.", BillToCustomerCodeLoc);
            "Alternative Bill-to Address" := '';
          END;
      END;
    END;

    PROCEDURE ValidateOtherData@1210190004();
    VAR
      SaveBilltoCustomer@1210190002 : Code[20];
    BEGIN
      IF ServLocRec.GET("Service Location No.") THEN
        "Service Location Type" := ServLocRec."Service Location Type";

      IF "Source Type" <> "Source Type"::Direct THEN
       IF NOT "Decentral Created" THEN  //db, 23-06-11: M27832
         EXIT;

      SaveBilltoCustomer := '';
      IF NOT CustRec.GET("Customer No.") THEN
        CustRec.INIT;
      IF CustRec."Bill-to Customer No." = '' THEN
        CustRec."Bill-to Customer No." := CustRec."No.";  //db, 08-02-12: M32854
      IF NOT ServContrRec.GET("Service Contract No.") THEN
        ServContrRec.INIT;
      IF ServContrRec."Bill-to Customer No. (CP)" = '' THEN
        ServContrRec."Bill-to Customer No. (CP)" := ServContrRec."Customer No.";  //db, 08-02-12: M32854
      IF (("Service Contract No." = '') AND ("Bill-to Customer No." <> CustRec."Bill-to Customer No.")) OR
         (("Service Contract No." <> '') AND ("Bill-to Customer No." <> ServContrRec."Bill-to Customer No. (CP)"))
      THEN
        SaveBilltoCustomer := "Bill-to Customer No.";

      IF ServLocRec.GET("Service Location No.") THEN BEGIN
        IF ("Service Contract No." = '') OR (ServContrRec."Customer No." = '') THEN BEGIN
          IF ServLocRec."Customer No." <> '' THEN BEGIN
            "Bill-to Customer No." := '';
            VALIDATE("Customer No.", ServLocRec."Customer No.");
          END;
        END ELSE
          VALIDATE("Service Contract No.");
        IF ("Service Contract No." = '') OR (ServContrRec."Bill-to Customer No. (CP)" = '') THEN
          IF ServLocRec."Bill-to Customer No." <> '' THEN
            SaveBilltoCustomer := ServLocRec."Bill-to Customer No.";
      END;

      IF SaveBilltoCustomer = '' THEN
        SaveBilltoCustomer := "Bill-to Customer No.";
      VALIDATE("Bill-to Customer No.", SaveBilltoCustomer);

      IF ServLocRec.GET("Service Location No.") THEN
        IF ("Alternative Bill-to Address" <> ServLocRec."Alternative Bill-to Address") AND (ServLocRec."Alternative Bill-to Address" <> '') AND
           ("Bill-to Customer No." = ServLocRec."Bill-to Customer No.")
        THEN
          VALIDATE("Alternative Bill-to Address", ServLocRec."Alternative Bill-to Address");
    END;

    PROCEDURE CheckInvoiceAddress@1210190002();
    VAR
      AdrsRec@1210190000 : Record 222;
    BEGIN
      IF AdrsRec.GET("Bill-to Customer No.", "Alternative Bill-to Address") THEN BEGIN
        "Bill-to Name" := AdrsRec.Name;
        "Bill-to Name 2" := AdrsRec."Name 2";
        "Bill-to Address" := AdrsRec.Address;
        "Bill-to Address 2" := AdrsRec."Address 2";
        "Bill-to Post Code" := AdrsRec."Post Code";
        "Bill-to City" := AdrsRec.City;
      END ELSE BEGIN
        "Alternative Bill-to Address" := '';
        IF NOT CustRec.GET("Bill-to Customer No.") THEN CustRec.INIT;  //db, 23-02-09: M13533
        "Bill-to Name" := CustRec.Name;
        "Bill-to Name 2" := CustRec."Name 2";
        "Bill-to Address" := CustRec.Address;
        "Bill-to Address 2" := CustRec."Address 2";
        "Bill-to Post Code" := CustRec."Post Code";
        "Bill-to City" := CustRec.City;
      END;
    END;

    PROCEDURE CheckParentChildOrder@1210190011();
    VAR
      lvServOrderRec@1210190000 : Record 11012823;
      lvOrder@1210190002 : Code[20];
    BEGIN
      lvOrder := "Previous Service Order No.";
      WHILE lvOrder <> '' DO BEGIN
        IF "No." = lvOrder THEN
          ERROR(Text007);
        IF NOT lvServOrderRec.GET(lvOrder) THEN EXIT;
        lvOrder := lvServOrderRec."Previous Service Order No.";
      END;
    END;

    PROCEDURE CheckStatus@8(ExtraStepsLimitation@11012000 : Integer);
    BEGIN
      IF Status = Status::Cancelled THEN
        ERROR(Text005, TABLECAPTION, "No.", FIELDCAPTION(Status), Status);

      IF Status >= (Status::Finished - ExtraStepsLimitation) THEN
        ERROR(Text005, TABLECAPTION, "No.", FIELDCAPTION(Status), Status);
    END;

    PROCEDURE CheckDimension@1100485008();
    BEGIN
      IF ServLocRec.GET("Service Location No.") THEN BEGIN
        IF ServLocRec."Global Dimension 1 Code" <> '' THEN
          VALIDATE("Global Dimension 1 Code", ServLocRec."Global Dimension 1 Code");
      END;
    END;

    PROCEDURE CheckVATServOrder@1100525007();
    VAR
      VatGroupFoundAt@1100525000 : 'Customer,Contract,Location';
    BEGIN
      IF CustRec.GET("Bill-to Customer No.") THEN BEGIN
        "VAT Prod. Posting Group" := CustRec."VAT Prod. Posting Group";
        //DP00195.sn
        IF "Plant Location" <> '' THEN BEGIN
          PlantLocRec.CHANGECOMPANY("Plant Company");
          IF PlantLocRec.GET("Plant Location") THEN
            "VAT Bus. Posting Group" := PlantLocRec."VAT Bus. Posting Group";
        END ELSE
          "VAT Bus. Posting Group" := CustRec."VAT Bus. Posting Group";  //M25440
        //DP00195.en
      END;
      IF NOT "Charge Vendor (Warranty)" THEN BEGIN
        //C025182.sn
        IF ServContrRec.GET("Service Contract No.") THEN BEGIN
          IF ServContrRec."VAT Prod. Posting Group" <> '' THEN BEGIN  //db, 22-09-11: M28204
            "VAT Prod. Posting Group" := ServContrRec."VAT Prod. Posting Group";
            VatGroupFoundAt := VatGroupFoundAt::Contract;
          END;
        END;
        IF (VatGroupFoundAt = VatGroupFoundAt::Contract) AND ("Bill-to Customer No." <> ServContrRec."Bill-to Customer No. (CP)") THEN BEGIN
          IF NOT CustRec.GET("Bill-to Customer No.") THEN CustRec.INIT;
          "VAT Prod. Posting Group" := CustRec."VAT Prod. Posting Group";
          "VAT Bus. Posting Group" := CustRec."VAT Bus. Posting Group";
        END;
        IF ServLocRec.GET("Service Location No.") THEN BEGIN
          IF ServLocRec."VAT Prod. Posting Group" <> '' THEN BEGIN
            "VAT Prod. Posting Group" := ServLocRec."VAT Prod. Posting Group";  //**4PS-BE
             VatGroupFoundAt := VatGroupFoundAt::Location;
          END;
        END;
        IF (VatGroupFoundAt = VatGroupFoundAt::Location) AND ("Bill-to Customer No." <> ServContrRec."Customer No.") THEN BEGIN
          IF NOT CustRec.GET("Bill-to Customer No.") THEN CustRec.INIT;
          "VAT Bus. Posting Group" := CustRec."VAT Bus. Posting Group";
        END;
        //C025182.en
      END;
    END;

    PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20];SaveDefaultDim@1210190000 : Boolean);
    VAR
      DimMgt@1100525000 : Codeunit 408;
      DimValRec@1100525001 : Record 349;
    BEGIN
      //db, 19-08-09: M15896
      DimMgt.ValidateDimValueCode(FieldNumber,ShortcutDimCode);
      DimMgt.GetDimValueRec(FieldNumber, ShortcutDimCode, DimValRec, ShortcutDimCode <> '', '');
      IF NOT DimMgt.CheckDimValue(DimValRec."Dimension Code",ShortcutDimCode) THEN
        ERROR(DimMgt.GetDimErr);
      IF "No." <> '' THEN  //ps, 03-08-11, call 28595
        IF SaveDefaultDim THEN  //db, 14-09-11: M28816
          DimMgt.SaveDefaultDim(DATABASE::"Service Order","No.",FieldNumber,ShortcutDimCode); //mg, 17-05-11: M27041
    END;

    PROCEDURE AssistEdit@2(OldServOrder@11012000 : Record 11012823) : Boolean;
    VAR
      ServiceSourceTypeSetup@1100528600 : Record 11071726;
      ServOrder@1210190000 : Record 11012823;
      lvSeries@1100485000 : Text[30];
    BEGIN
      WITH ServOrder DO BEGIN
        ServOrder := Rec;
        ServiceSourceTypeSetup.GET(OldServOrder."Source Type");
        ServiceSourceTypeSetup.TESTFIELD("No. Series");
        lvSeries := ServiceSourceTypeSetup."No. Series";

        IF NoSeriesMgt.SelectSeries(lvSeries,OldServOrder."No. Series","No. Series") THEN BEGIN
          NoSeriesMgt.SetSeries("No.");
          ServSetup.GET;  //WG 160114
          IF ServSetup."Assign To" = ServSetup."Assign To"::User THEN
            IF UserSetup.GET(USERID) THEN
              VALIDATE("Assigned to", UserSetup."Employee No.");
          Rec := ServOrder;
          EXIT(TRUE);
        END;
      END;
    END;

    PROCEDURE LookupServiceLocation@1210190003();
    VAR
      ServiceLocation@1210190000 : Record 11012801;
      ServiceLocation2@1100528302 : Record 11012801;
      ContractObject@1100528600 : Record 11071702;
      BuildingObjectRelation@1100528301 : Record 11071820;
      ServiceContract@1100525000 : Record 11012812;
      RunTempTable@1100529700 : Boolean;
      TempServiceLocation@1100529701 : TEMPORARY Record 11012801;
      RunPageAction@1100529702 : Action;
    BEGIN
      IF "Service Contract No." <> '' THEN
        ServiceContract.GET("Service Contract No.");
      ContractObject.SETRANGE("Service Contract No.", "Service Contract No.");
      IF ("Service Contract No." <> '') AND
         (ServiceContract."Contract Form" <> ServiceContract."Contract Form"::"Framework Contract") AND
         NOT ContractObject.ISEMPTY
      THEN BEGIN
        IF ContractObject.FINDSET THEN
          REPEAT
            IF ContractObject."Service Location No." <> '' THEN BEGIN
              IF ServiceLocation2.GET(ContractObject."Service Location No.") THEN BEGIN
                TempServiceLocation := ServiceLocation2;
                IF TempServiceLocation.INSERT THEN;
              END;
            END ELSE BEGIN
              BuildingObjectRelation.SETCURRENTKEY("Object No.");
              BuildingObjectRelation.SETRANGE("Object No.", ContractObject."Service Object No.");
              BuildingObjectRelation.SETFILTER("Building Code", '<>%1', '');
              IF BuildingObjectRelation.FINDSET THEN BEGIN
                ServiceLocation2.SETCURRENTKEY("Building Code");
                REPEAT
                  ServiceLocation2.SETRANGE("Building Code", BuildingObjectRelation."Building Code");
                  IF ServiceLocation2.FINDSET THEN
                    REPEAT
                      TempServiceLocation := ServiceLocation2;
                      IF TempServiceLocation.INSERT THEN;
                    UNTIL ServiceLocation2.NEXT = 0;
                UNTIL BuildingObjectRelation.NEXT = 0;
              END;
            END;
          UNTIL ContractObject.NEXT = 0;
        RunTempTable := TRUE;
      END ELSE BEGIN
        IF "Customer No." <> '' THEN
          ServiceLocation.SETFILTER("Customer No.", "Customer No.");
        IF "Service Contract No." <> '' THEN BEGIN
          ServiceLocation2.RESET;
          ServiceLocation2.COPY(ServiceLocation);
          IF ServiceLocation2.FINDSET THEN
            REPEAT
              ContractObject.SETRANGE("Service Location No.", ServiceLocation2."No.");
              ContractObject.SETFILTER("Ending Date", '%1|>=%2', 0D, WORKDATE);
              IF ContractObject.ISEMPTY THEN BEGIN
                TempServiceLocation := ServiceLocation2;
                IF TempServiceLocation.INSERT THEN;
              END;
            UNTIL ServiceLocation2.NEXT = 0;
          RunTempTable := TRUE;
        END;
      END;

      IF RunTempTable THEN BEGIN
        TempServiceLocation."No." := "Service Location No.";
        RunPageAction := PAGE.RUNMODAL(PAGE::"Service Location List", TempServiceLocation)
      END ELSE BEGIN
        ServiceLocation."No." := "Service Location No.";
        RunPageAction := PAGE.RUNMODAL(PAGE::"Service Location List", ServiceLocation);
        IF RunPageAction = ACTION::LookupOK THEN
          TempServiceLocation := ServiceLocation;
      END;

      IF RunPageAction = ACTION::LookupOK THEN BEGIN
        xRec := Rec;
        SkipDeterminePriceBookFields := TRUE;
        VALIDATE("Customer No.", TempServiceLocation."Customer No.");
        AskQuestionAddress := TRUE;
        CurrFieldNo := FIELDNO("Service Location No.");
        VALIDATE("Service Location No.", TempServiceLocation."No.");
        SkipDeterminePriceBookFields := FALSE;
      END;
    END;

    PROCEDURE LookupServiceContract@1210190007();
    BEGIN
      FindServiceContracts(ServContrRec);

      IF "Service Contract No." <> '' THEN
        ServContrRec."No." := "Service Contract No.";
      IF PAGE.RUNMODAL(PAGE::"Service Contracts List", ServContrRec) = ACTION::LookupOK THEN BEGIN
        xRec := Rec;
        //db.sn, 17-12-09: M17472
        //AskQuestionAddress := TRUE;
        CurrFieldNo := FIELDNO("Service Contract No.");
        //db.en, 17-12-09: M17472
        VALIDATE("Service Contract No.", ServContrRec."No.");
      END;
    END;

    PROCEDURE ShowContact@1210190005(lvCust@1210190001 : Code[20];lvBillToCust@1100529600 : Code[20]);
    VAR
      ContRec@1210190006 : Record 5050;
      ServContRec@1100485000 : Record 11012841;
    BEGIN
      IF "Service Location No." <> '' THEN BEGIN
        ServContRec.SETRANGE("Service Location No.", "Service Location No.");
      END ELSE BEGIN
        IF "Service Contract No." <> '' THEN BEGIN
          ServContRec.SETRANGE("Service Contract No.", "Service Contract No.");
        END ELSE BEGIN
          ServContRec.SETRANGE("Service Location No.", '%1', '');
          ServContRec.SETRANGE("Service Contract No.", '%1', '');
        END;
      END;
      IF ServContRec.FINDFIRST THEN BEGIN
        IF PAGE.RUNMODAL(PAGE::"Service Contacts", ServContRec) = ACTION::LookupOK THEN BEGIN
          CurrFieldNo := FIELDNO("Contact Name");
          VALIDATE("Contact Name", ServContRec."Contact Name");
          CurrFieldNo := FIELDNO("Phone No.");
          VALIDATE("Phone No.", ServContRec."Phone No.");
          CurrFieldNo := FIELDNO("E-Mail");
          VALIDATE("E-Mail", ServContRec."E-Mail");
          CurrFieldNo := FIELDNO("Phone No. 2");
          VALIDATE("Phone No. 2", ServContRec."Phone No. 2");
          CurrFieldNo := FIELDNO("Mobile Phone No.");
          VALIDATE("Mobile Phone No.", ServContRec."Mobile Phone No.");
          CurrFieldNo := FIELDNO("Fax No.");
          VALIDATE("Fax No.", ServContRec."Fax No.");
        END;
      END ELSE BEGIN
        CustRec.ShowContactName2(lvCust, lvBillToCust, ContRec);
        IF ContRec.Name <> '' THEN BEGIN
          CurrFieldNo := FIELDNO("Contact Name");
          VALIDATE("Contact Name", ContRec.Name);
          CurrFieldNo := FIELDNO("Phone No.");
          VALIDATE("Phone No.", ContRec."Phone No. Work");
          CurrFieldNo := FIELDNO("Phone No. 2");
          VALIDATE("Phone No. 2", ContRec."Phone No. Work 2");
          IF "Phone No." = '' THEN BEGIN
            CurrFieldNo := FIELDNO("Phone No.");
            VALIDATE("Phone No.", ContRec."Phone No.");
          END;
          IF "Phone No. 2" = '' THEN BEGIN
            CurrFieldNo := FIELDNO("Phone No. 2");
            VALIDATE("Phone No. 2", ContRec."Phone No. 2");
          END;
          CurrFieldNo := FIELDNO("E-Mail");
          VALIDATE("E-Mail", ContRec."E-Mail");
          CurrFieldNo := FIELDNO("Mobile Phone No.");
          VALIDATE("Mobile Phone No.", ContRec."Mobile Phone No.");
          CurrFieldNo := FIELDNO("Fax No.");
          VALIDATE("Fax No.", ContRec."Fax No.");
        END;
      END;
    END;

    PROCEDURE ShowBillToContact@1100529601(BillToCustomerNo@1210190001 : Code[20]);
    VAR
      LocContact@1210190006 : Record 5050;
      LocServiceContact@1100485000 : Record 11012841;
    BEGIN
      IF "Service Location No." <> '' THEN BEGIN
        LocServiceContact.SETRANGE("Service Location No.", "Service Location No.");
      END ELSE BEGIN
        IF "Service Contract No." <> '' THEN BEGIN
          LocServiceContact.SETRANGE("Service Contract No.", "Service Contract No.");
        END ELSE BEGIN
          LocServiceContact.SETRANGE("Service Location No.", '%1', '');
          LocServiceContact.SETRANGE("Service Contract No.", '%1', '');
        END;
      END;
      IF LocServiceContact.FINDFIRST THEN BEGIN
        IF PAGE.RUNMODAL(PAGE::"Service Contacts", LocServiceContact) = ACTION::LookupOK THEN BEGIN
          CurrFieldNo := FIELDNO("Bill-to Contact Name");
          VALIDATE("Bill-to Contact Name", LocServiceContact."Contact Name");
        END;
      END ELSE BEGIN
        CustRec.ShowContactName(BillToCustomerNo, LocContact);
        IF LocContact.Name <> '' THEN BEGIN
          CurrFieldNo := FIELDNO("Bill-to Contact Name");
          VALIDATE("Bill-to Contact Name", LocContact.Name);
        END;
      END;
    END;

    PROCEDURE ShowInvoice@1210190001(CreditMemo@1210190000 : Boolean);
    VAR
      lSalesInvHeader@1210190002 : Record 112;
      lSalesInvLine@1210190001 : Record 113;
      lSalesCrMemoHeader@1210190004 : Record 114;
      lSalesCrMemoLine@1210190003 : Record 115;
    BEGIN
      IF CreditMemo = FALSE THEN BEGIN
        lSalesInvHeader.CLEARMARKS;
        lSalesInvLine.SETCURRENTKEY("Service Contract No.", "Service Order No.");
        lSalesInvLine.SETRANGE("Service Order No.", "No.");
        IF lSalesInvLine.FINDSET THEN BEGIN
          REPEAT
            IF lSalesInvHeader.GET(lSalesInvLine."Document No.") THEN
              lSalesInvHeader.MARK(TRUE);
          UNTIL lSalesInvLine.NEXT = 0;
        END;
        lSalesInvHeader.MARKEDONLY(TRUE);
        PAGE.RUNMODAL(PAGE::"Posted Sales Invoices",lSalesInvHeader);
      END ELSE BEGIN
        lSalesCrMemoHeader.CLEARMARKS;
        lSalesCrMemoLine.SETCURRENTKEY("Service Contract No.", "Service Order No.");
        lSalesCrMemoLine.SETRANGE("Service Order No.", "No.");
        IF lSalesCrMemoLine.FINDSET THEN BEGIN
          REPEAT
            IF lSalesCrMemoHeader.GET(lSalesCrMemoLine."Document No.") THEN
              lSalesCrMemoHeader.MARK(TRUE);
          UNTIL lSalesCrMemoLine.NEXT = 0;
        END;
        lSalesCrMemoHeader.MARKEDONLY(TRUE);
        PAGE.RUNMODAL(PAGE::"Posted Sales Credit Memos",lSalesCrMemoHeader);
      END;
    END;

    PROCEDURE ShowNextOrder@1210190015(lvAction@1210190001 : Integer) : Text[30];
    VAR
      lvCount@1210190002 : Integer;
      lvNextOrder@1100485000 : Code[20];
    BEGIN
      //0=display; 1=lookup

      TempServOrderRec2.DELETEALL;
      IF "No." = '' THEN EXIT('');  //db, 26-07-06 (call 7861)
      CheckNextOrder("No.", lvNextOrder);
      IF lvNextOrder = '' THEN EXIT('');

      IF lvAction = 0 THEN BEGIN
        lvCount := TempServOrderRec2.COUNT;
        IF lvCount = 1 THEN
          EXIT(lvNextOrder)
        ELSE
          EXIT(STRSUBSTNO('[%1]', lvCount));
      END ELSE BEGIN
        TempServOrderRec2.MARKEDONLY(TRUE);
        PAGE.RUNMODAL(PAGE::"Service-Order List", TempServOrderRec2);
      END;
    END;

    PROCEDURE CheckNextOrder@1100485001(lvServOrder@1100485000 : Code[20];VAR lvNextOrder@1100485002 : Code[20]);
    VAR
      lvServOrderRec@1100485001 : Record 11012823;
    BEGIN
      lvServOrderRec.SETCURRENTKEY("Previous Service Order No.");
      lvServOrderRec.SETRANGE("Previous Service Order No.", lvServOrder);
      IF lvServOrderRec.FINDSET THEN BEGIN
        IF lvNextOrder = '' THEN
          lvNextOrder := lvServOrderRec."No.";
        REPEAT
          TempServOrderRec2 := lvServOrderRec;
          TempServOrderRec2.INSERT;
          TempServOrderRec2.MARK := TRUE;
          CheckNextOrder(lvServOrderRec."No.", lvNextOrder);
        UNTIL lvServOrderRec.NEXT = 0;
      END;
    END;

    PROCEDURE ShowPrevOrder@1100485005(lvAction@1210190001 : Integer) : Text[30];
    VAR
      lvCount@1210190002 : Integer;
      lvPrevOrder@1100485000 : Code[20];
    BEGIN
      //0=display; 1=lookup

      TempServOrderRec2.DELETEALL;
      lvPrevOrder := "Previous Service Order No.";
      CheckPrevOrder("Previous Service Order No.");
      IF lvPrevOrder = '' THEN EXIT('');

      IF lvAction = 0 THEN BEGIN
        lvCount := TempServOrderRec2.COUNT;
        IF lvCount = 1 THEN
          EXIT(lvPrevOrder)
        ELSE
          EXIT(STRSUBSTNO('[%1]', lvCount));
      END ELSE BEGIN
        TempServOrderRec2.MARKEDONLY(TRUE);
        PAGE.RUNMODAL(PAGE::"Service-Order List", TempServOrderRec2);
      END;
    END;

    PROCEDURE CheckPrevOrder@1100485006(lvServOrder@1100485000 : Code[20]);
    VAR
      lvServOrderRec@1100485001 : Record 11012823;
    BEGIN
      WHILE lvServOrder <> '' DO BEGIN
        IF NOT lvServOrderRec.GET(lvServOrder) THEN EXIT;
        TempServOrderRec2 := lvServOrderRec;
        TempServOrderRec2.INSERT;
        TempServOrderRec2.MARK := TRUE;
        lvServOrder := lvServOrderRec."Previous Service Order No.";
      END;
    END;

    PROCEDURE DisconnectChain@1100485004();
    VAR
      lvServOrderRec@1100485000 : Record 11012823;
      lvServOrderRec2@1100485001 : Record 11012823;
    BEGIN
      IF "Base Service Order" THEN BEGIN
        lvServOrderRec.SETCURRENTKEY("Base Service Order No.");
        lvServOrderRec.SETRANGE("Base Service Order No.", "No.");
        lvServOrderRec.SETFILTER("No.", '<>%1', "No.");
        IF NOT lvServOrderRec.ISEMPTY THEN
          TESTFIELD("Base Service Order", FALSE);
        lvServOrderRec.RESET;
      END;

      lvServOrderRec.SETCURRENTKEY("Previous Service Order No.");
      lvServOrderRec.SETRANGE("Previous Service Order No.", "No.");
      IF NOT lvServOrderRec.ISEMPTY THEN BEGIN
        IF lvServOrderRec.FINDSET(TRUE, TRUE) THEN BEGIN
          REPEAT
            lvServOrderRec2 := lvServOrderRec;
            lvServOrderRec2."Previous Service Order No." := "Previous Service Order No.";
            lvServOrderRec2.MODIFY;
          UNTIL lvServOrderRec.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE DetermineLimitBudget@1210190012();
    VAR
      lvServLocLimit@1100485000 : Decimal;
    BEGIN
      ServSetup.GET;
      IF NOT ServContrRec.GET("Service Contract No.") THEN ServContrRec.INIT;
      IF NOT ServLocRec.GET("Service Location No.") THEN ServLocRec.INIT;

      "Limit Budget Hours" := ServContrRec."Limit Budget Hours";
      "Limit Budget Labor" := ServContrRec."Limit Budget Labor";
      "Limit Budget Material" := ServContrRec."Limit Budget Material";
      "Limit Budget Total" := ServContrRec."Limit Budget Total";

      IF ServLocRec."Travel Time" <> 0 THEN BEGIN
        ServSetup.TESTFIELD("Cost Object Travel Time");
        DimMgt.GetDimValueRec(2, ServSetup."Cost Object Travel Time", DimValRec, TRUE,'');
        BudgetRateRec.SETRANGE(Code,DimValRec."Rate Code");
        BudgetRateRec.SETRANGE("Starting Date",0D,TODAY);
        BudgetRateRec.SETFILTER("Ending Date",'%1|>=%2',0D, TODAY);
        IF BudgetRateRec.FINDLAST THEN
          DimValRec."Sales Price" := BudgetRateRec.Rate;
        lvServLocLimit := ServLocRec."Travel Time" * DimValRec."Sales Price";
        "Limit Budget Labor" := "Limit Budget Labor" - lvServLocLimit;
        "Limit Budget Hours" := "Limit Budget Hours" - ServLocRec."Travel Time";
        IF (ServContrRec."Limit Budget Labor" + ServContrRec."Limit Budget Material" <> ServContrRec."Limit Budget Total") THEN
          "Limit Budget Total" := "Limit Budget Total" - lvServLocLimit;
      END;

      IF "Limit Budget Labor" < 0 THEN "Limit Budget Labor" := 0;
      IF "Limit Budget Hours" < 0 THEN "Limit Budget Hours" := 0;
      IF "Limit Budget Material" < 0 THEN "Limit Budget Material" := 0;

      IF (ServContrRec."Limit Budget Labor" + ServContrRec."Limit Budget Material" = ServContrRec."Limit Budget Total") THEN
        "Limit Budget Total" := "Limit Budget Labor" + "Limit Budget Material";
    END;

    PROCEDURE DetermineLimitBudgetExceeded@1100528656() : Boolean;
    VAR
      LimitBudgetManagement@1100528600 : Codeunit 11012878;
    BEGIN
      EXIT(LimitBudgetManagement.UpdateServiceOrderLimitBudgetExceeded(Rec));
    END;

    PROCEDURE DetermineInvoiceBaseAmount@1210190013();
    BEGIN
      IF NOT ServContrRec.GET("Service Contract No.") THEN ServContrRec.INIT;

      "Invoice Base Method" := ServContrRec."Invoice Base Method";

      "Invoice Base Hours" := ServContrRec."Invoice Base Hours";
      "Invoice Base Amount Labor" := ServContrRec."Invoice Base Amount Labor";
      "Invoice Base Amount Material" := ServContrRec."Invoice Base Amount Material";
      "Invoice Base Amount Total" := ServContrRec."Invoice Base Amount Total";
    END;

    PROCEDURE DetermineAdditionalCost@1100485025() : Boolean;
    VAR
      NoSeries@1100528600 : Record 308;
    BEGIN
      IF ("Plant Location" <> '') AND ("Service Contract No." = '') THEN BEGIN
        IF NOT NoSeries.GET("No. Series") THEN
          NoSeries.INIT;
        EXIT(NoSeries."Additional Cost (Service)");
      END ELSE
        EXIT(("Source Type" = "Source Type"::Direct) AND ("Service Contract No." <> ''));
    END;

    PROCEDURE DetermineCurrencyCode@1100528800() : Code[10];
    VAR
      Customer@1100485000 : Record 18;
      MaintenanceInvoiceMgt@1100528800 : Codeunit 11012828;
      ContractCurr@1100528801 : Code[10];
    BEGIN
      ContractCurr := MaintenanceInvoiceMgt.GetContractCurrency("Service Contract No.");
      IF ContractCurr <> '' THEN BEGIN
        EXIT(ContractCurr)
      END ELSE BEGIN
        IF Customer.GET("Bill-to Customer No.") THEN //mg.c, 15-02-13: C005445
          EXIT(Customer."Currency Code");
      END;
    END;

    PROCEDURE GetHistoryServiceOrder@1100485002(lvSpec@1100485001 : Boolean);
    VAR
      lvServOrderRec@1100485000 : Record 11012823;
    BEGIN
      lvServOrderRec."No." := "No.";

      lvServOrderRec.RESET;
      IF "Service Location No." <> '' THEN
        lvServOrderRec.SETRANGE("Service Location No.", "Service Location No.");
      IF "Service Contract No." <> '' THEN
        lvServOrderRec.SETRANGE("Service Contract No.", "Service Contract No.");
      IF "Customer No." <> '' THEN
        lvServOrderRec.SETRANGE("Customer No.", "Customer No.");
      PAGE.RUNMODAL(PAGE::"Service-Order List", lvServOrderRec);
    END;

    PROCEDURE CheckUpdateDocRefPoint@1100485014(IUpdateMode@1100485000 : Code[1]);
    VAR
      lvDocRefPointRec@1100485001 : Record 11020296;
      ReferencePoint@1100528000 : Record 11020271;
      lvServOrderxRec@1100485002 : Record 11012823;
    BEGIN
      IF gSkipUpdateDocRefPoint THEN
        EXIT;

      IF SaveField = FIELDNO(Status) THEN  //db, 19-05-11: M27257
        COMMIT; //there is also a commit in lvDocRefPointRec in case of sending mails

      lvDocRefPointRec.SetModifiedByEmployee(ReferencePointModifiedByEmployee);
      CASE IUpdateMode OF
        'I':
          BEGIN
            IF (NOT gUseFilledOrderDateTime) THEN
              lvDocRefPointRec.InsertDocRefPoint(lvDocRefPointRec.Type::ServOrder,"No.",Status,TODAY,TIME)
            ELSE
              lvDocRefPointRec.InsertDocRefPoint(lvDocRefPointRec.Type::ServOrder,"No.",Status,"Order Date","Order Time");
          END;
        'M':
          BEGIN
            IF gSkipStatusCheck = FALSE THEN BEGIN  //db, 21-03-11
              IF NOT lvServOrderxRec.GET("No.") THEN  //* Get old (so call always before saving change!)
                EXIT;
              IF lvServOrderxRec.Status = Status THEN
                EXIT;
            END;

            ReferencePoint.SETRANGE("Triggered by Status ServOrder", Status +1);
            ReferencePoint.SETRANGE(Apply, ReferencePoint.Apply::ServOrder);
            IF NOT ReferencePoint.FINDLAST THEN
              EXIT;
            IF ReferencePoint."No." = "Actual Reference Point (Gantt)" THEN
              EXIT;

            lvDocRefPointRec.InsertDocRefPoint(lvDocRefPointRec.Type::ServOrder,"No.",Status,TODAY,TIME);
            IF SaveField = FIELDNO(Status) THEN  //db, 19-05-11: M27257
              Rec.FIND('=');  //jd, 06-04-11: in lvDocRefPointRec in case of sending worksheet by mail Rec is updated
          END;
      END;

      //Actual Reference Point (Gantt) is changed in lvDocRefPointRec.InsertDocRefPoint. Get Result here
      IF lvDocRefPointRec.GetNewActRefPoint >= 0 THEN
        "Actual Reference Point (Gantt)" := lvDocRefPointRec.GetNewActRefPoint;
    END;

    PROCEDURE SetSkipUpdateDocRefPoint@1100485015(ISkip@1100485000 : Boolean);
    BEGIN
      gSkipUpdateDocRefPoint := ISkip;
    END;

    PROCEDURE SetSkipStatusCheck@1100526200(ISkip@1100485000 : Boolean);
    BEGIN
      //db, 21-03-11
      gSkipStatusCheck := ISkip;
    END;

    PROCEDURE SetUseFilledOrderDateTime@1100485021(IUseOrderDateTime@1100485000 : Boolean);
    BEGIN
      gUseFilledOrderDateTime := IUseOrderDateTime;
    END;

    PROCEDURE UpdateNextDeadline@1100485007();
    VAR
      DateTimeMgt@1100485000 : Codeunit 11020218;
      RefLimit@1100485001 : Text[50];
      CurrDeadline@1100485002 : DateTime;
    BEGIN
      //db, 24-08-12: W014185
      "Next Reference Period" := '';
      "Next Deadline" := 0DT;

      RefPeriodRec.RESET;
      RefPeriodRec.SETCURRENTKEY(Type, "Document No.");
      RefPeriodRec.SETRANGE(Type, RefPeriodRec.Type::ServOrder);
      RefPeriodRec.SETRANGE("Document No.", "No.");
      IF RefPeriodRec.FINDSET THEN BEGIN
        REPEAT
          IF (RefPeriodRec.Norm <> 0) AND
             (RefPeriodRec."Starting Date" <> 0D) AND
             (RefPeriodRec."Starting Time" <> 0T) AND
             (RefPeriodRec."Ending Date" = 0D) AND
             (RefPeriodRec."Ending Time" = 0T) THEN BEGIN
            RefLimit := RefPeriodRec.CheckRefPeriod(1,RefPeriodRec.Type::ServOrder,"No.",RefPeriodRec.Code,0);
            IF RefLimit <> '' THEN BEGIN
              CurrDeadline := DateTimeMgt.Text2Datetime(RefLimit);
              IF ("Next Deadline" = 0DT) OR (CurrDeadline <= "Next Deadline") THEN BEGIN
                "Next Deadline" := CurrDeadline;
                "Next Reference Period" := RefPeriodRec.Code;
              END;
            END;
          END;
        UNTIL RefPeriodRec.NEXT = 0;
      END;
    END;

    PROCEDURE AssistEditPriority@1100485012();
    VAR
      ServicePriority@1100528800 : Record 11012829;
      ServiceCallInfoMgt@1100528801 : Codeunit 11012855;
    BEGIN
      ServiceCallInfoMgt.GetServicePriorityDS(
        "Service Contract No.",
        "Customer No.",
        Discipline,
        "Trade Speciality",
        Priority,
        ServicePriority);

      IF PAGE.RUNMODAL(0, ServicePriority) = ACTION::LookupOK THEN
        VALIDATE(Priority, ServicePriority.Code);
    END;

    PROCEDURE AssistEditDiscipline@1100485011();
    VAR
      ContrDiscRec@1100485002 : Record 11012881;
      LocDiscRec@1100485000 : Record 11012844;
      DiscRec@1100485001 : Record 11020204;
    BEGIN
      IF "Service Contract No." <> '' THEN BEGIN
        ContrDiscRec.SETRANGE("Service Contract No.", "Service Contract No.");
        ContrDiscRec.SETFILTER(Discipline, '<>%1', '');
        IF ContrDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF DiscRec.GET(ContrDiscRec.Discipline) THEN
              DiscRec.MARK := TRUE;
          UNTIL ContrDiscRec.NEXT = 0;
          DiscRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Service Location No." <> '' THEN BEGIN
        LocDiscRec.SETRANGE("Service Location No.", "Service Location No.");
        LocDiscRec.SETFILTER(Discipline, '<>%1', '');
        IF LocDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF DiscRec.GET(LocDiscRec.Discipline) THEN
              DiscRec.MARK := TRUE;
          UNTIL LocDiscRec.NEXT = 0;
          DiscRec.MARKEDONLY(TRUE);
        END;
      END;

      IF Discipline <> '' THEN
        DiscRec.GET(Discipline);

      IF PAGE.RUNMODAL(0, DiscRec) = ACTION::LookupOK THEN
        VALIDATE(Discipline, DiscRec.Code);
    END;

    PROCEDURE AssistEditTradeSpeciality@1100485034();
    VAR
      TradeSpecRec@1100485003 : Record 11020285;
      ContrDiscRec@1100485004 : Record 11012881;
      LocDiscRec@1100485005 : Record 11012844;
    BEGIN
      IF "Service Contract No." <> '' THEN BEGIN
        ContrDiscRec.SETRANGE("Service Contract No.", "Service Contract No.");
        IF Discipline <> '' THEN  //db, 27-03-09: M13480
          ContrDiscRec.SETRANGE(Discipline, Discipline);
        ContrDiscRec.SETFILTER("Trade Speciality", '<>%1', '');
        IF ContrDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF TradeSpecRec.GET(ContrDiscRec.Discipline, ContrDiscRec."Trade Speciality") THEN
              TradeSpecRec.MARK := TRUE;
          UNTIL ContrDiscRec.NEXT = 0;
          TradeSpecRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Service Location No." <> '' THEN BEGIN
        LocDiscRec.SETRANGE("Service Location No.", "Service Location No.");
        IF Discipline <> '' THEN  //db, 27-03-09: M13480
          LocDiscRec.SETRANGE(Discipline, Discipline);
        LocDiscRec.SETFILTER("Trade Speciality", '<>%1', '');
        IF LocDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF TradeSpecRec.GET(LocDiscRec.Discipline, LocDiscRec."Trade Speciality") THEN
              TradeSpecRec.MARK := TRUE;
          UNTIL LocDiscRec.NEXT = 0;
          TradeSpecRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Trade Speciality" <> '' THEN
        TradeSpecRec.GET(Discipline, "Trade Speciality");

      IF Discipline <> '' THEN
        TradeSpecRec.SETRANGE(Discipline, Discipline);  //db, 27-03-09: M13480

      IF PAGE.RUNMODAL(0, TradeSpecRec) = ACTION::LookupOK THEN
        VALIDATE("Trade Speciality", TradeSpecRec.Code);
    END;

    PROCEDURE AssistEditDimension1@1100485000();
    VAR
      ContrDimRec@1100485002 : Record 11012809;
      DimValRec@1100485001 : Record 349;
    BEGIN
      DimValRec.SETRANGE("Global Dimension No.", 1);

      IF "Service Contract No." <> '' THEN BEGIN
        ContrDimRec.SETRANGE("Service Contract No.", "Service Contract No.");
        ContrDimRec.SETFILTER("Global Dimension 1 Code", '<>%1', '');
        IF ContrDimRec.FINDSET THEN BEGIN
          REPEAT
            DimValRec.SETRANGE(Code, ContrDimRec."Global Dimension 1 Code");
            IF DimValRec.FINDSET THEN
              DimValRec.MARK := TRUE;
          UNTIL ContrDimRec.NEXT = 0;
          DimValRec.SETRANGE(Code);
          DimValRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Global Dimension 1 Code" <> '' THEN
        DimMgt.GetDimValueRec(1, "Global Dimension 1 Code", DimValRec, TRUE,'');

      IF PAGE.RUNMODAL(0, DimValRec) = ACTION::LookupOK THEN
        VALIDATE("Global Dimension 1 Code", DimValRec.Code);
    END;

    PROCEDURE CheckWIP@1100485009();
    VAR
      ServiceLedgerEntry@1100485000 : Record 11012819;
    BEGIN
      ServiceLedgerEntry.SETCURRENTKEY("Service Order No.");   //db, 11-06-10: M19759
      ServiceLedgerEntry.SETRANGE("Service Order No.", "No.");
      ServiceLedgerEntry.SETRANGE("Service Order WIP processed", FALSE);
      IF ServiceLedgerEntry.FINDFIRST THEN
        IF CheckServTypePosting THEN //T006898.n
          ServiceLedgerEntry.TESTFIELD("Service Order WIP processed", TRUE);
    END;

    PROCEDURE CheckCommitments@1100525008();
    VAR
      ItemJnlLineRec@1100525003 : Record 83;
      PurchLineRec@1100525002 : Record 39;
      HourLineRec@1100525000 : Record 11012039;
    BEGIN
      //db, 10-12-09: M15683
      ItemJnlLineRec.SETCURRENTKEY("Service Order No.");
      ItemJnlLineRec.SETRANGE("Service Order No.", "No.");
      IF ItemJnlLineRec.FINDFIRST THEN
        ItemJnlLineRec.FIELDERROR("Service Order No.");

      PurchLineRec.SETCURRENTKEY("Document Type","Service Order No.");
      PurchLineRec.SETRANGE("Service Order No.", "No.");
      IF PurchLineRec.FINDFIRST THEN
        PurchLineRec.FIELDERROR("Service Order No.");

      HourLineRec.SETCURRENTKEY("Service Order No.");
      HourLineRec.SETRANGE("Service Order No.", "No.");
      IF HourLineRec.FINDFIRST THEN
        HourLineRec.FIELDERROR("Service Order No.");
    END;

    PROCEDURE CheckBlockedByFSA@1100485016() : Boolean;
    VAR
      lvProjSetupRec@1100485001 : Record 315;
      lvRefPointRec@1100485000 : Record 11020271;
    BEGIN
      lvProjSetupRec.GET;
      IF (NOT lvProjSetupRec."Field Service Active") AND (NOT lvProjSetupRec.IsFSAActive) THEN
        EXIT(FALSE);

      IF NOT "Export to FSA" THEN
        EXIT(FALSE);

      CALCFIELDS("Actual Reference Point");
      IF "Actual Reference Point" <> 0 THEN BEGIN
        IF lvRefPointRec.GET("Actual Reference Point") THEN BEGIN
          IF lvRefPointRec."Block Modify Service Order" THEN
            EXIT(TRUE);
        END;
      END;

      EXIT(FALSE);
    END;

    PROCEDURE CheckExportToFSA@1100485010();
    VAR
      lvProjSetupRec@1100485000 : Record 315;
      MandatoryFields@1100485001 : Record 11125651;
      lvRefPointRec@1100485002 : Record 11020271;
      WorkOrder@1100528700 : Record 11229279;
    BEGIN
      IF NOT "Export to FSA" THEN
        EXIT;

      lvProjSetupRec.GET;
      IF (NOT lvProjSetupRec."Field Service Active") AND (NOT lvProjSetupRec.IsFSAActive) THEN BEGIN
        IF "Export to FSA" THEN
          "Export to FSA" := FALSE;  //* No (error) message, just switch off
        EXIT;
      END;

      IF CheckBlockedByFSA() THEN
        ERROR(Text013, "No.");

      CALCFIELDS("Actual Reference Point");
      IF "Actual Reference Point" <> 0 THEN
        IF lvRefPointRec.GET("Actual Reference Point") THEN
          IF lvRefPointRec."Skip Export to FSA" THEN
            ERROR(Text014, "No.");

      IF "Price Book Type" <> "Price Book Type"::None THEN
        IF ProductionRecordingIsUsed THEN
          TESTFIELD("Unit Price Status", "Unit Price Status"::"Production Recording");

      //CheckEmplNotActiveInFSA();
      //CheckOneTeamLeader();

      WorkOrder.INIT;
      MandatoryFields.CheckMandatoryFieldsServiceOrder(Rec, WorkOrder, COMPANYNAME);
    END;

    PROCEDURE CheckPlanDataFSA@1100485032();
    BEGIN
      CASE CurrFieldNo OF
        FIELDNO("Starting Date"): IF "Starting Date" = xRec."Starting Date" THEN EXIT;
        FIELDNO("Starting Time"): IF "Starting Time" = xRec."Starting Time" THEN EXIT;
        FIELDNO("Ending Date"): IF "Ending Date" = xRec."Ending Date" THEN EXIT;
        FIELDNO("Ending Time"): IF "Ending Time" = xRec."Ending Time" THEN EXIT;
        FIELDNO("Duration Time"): IF "Duration Time" = xRec."Duration Time" THEN EXIT;
        FIELDNO(Subcontractor):
          BEGIN
            IF Subcontractor = xRec.Subcontractor THEN
              EXIT
            ELSE
              IF Status >= Status::"Technical Finished" THEN  //db, 30-09-10
                FIELDERROR(Status);  //db, 22-10-08: M12751
          END;
        FIELDNO("Employee No."):
          BEGIN
            IF "Employee No." = xRec."Employee No." THEN
              EXIT
            ELSE
              IF Status >= Status::"Technical Finished" THEN  //db, 30-09-10
                FIELDERROR(Status);  //db, 22-10-08: M12751
          END;
        FIELDNO("First Possible Starting Date"): IF "First Possible Starting Date" = xRec."First Possible Starting Date" THEN EXIT;
        FIELDNO("Last Possible Ending Date"): IF "Last Possible Ending Date" = xRec."Last Possible Ending Date" THEN EXIT;
        FIELDNO("First Possible Starting Time"): IF "First Possible Starting Time" = xRec."First Possible Starting Time" THEN EXIT;
        FIELDNO("Last Possible Ending Time"): IF "Last Possible Ending Time" = xRec."Last Possible Ending Time" THEN EXIT;
        //FIELDNO("Plan during Clock Time"): IF "Plan during Clock Time" = xRec."Plan during Clock Time" THEN EXIT;
      END;

      IF NOT UpdatePlanningAllowed() THEN BEGIN
        CASE CurrFieldNo OF
          FIELDNO("Starting Date"): ERROR(Text009, FIELDCAPTION("Starting Date"), TABLECAPTION, "No.");
          FIELDNO("Starting Time"): ERROR(Text009, FIELDCAPTION("Starting Time"), TABLECAPTION, "No.");
          FIELDNO("Ending Date"): CheckNumberOfWorkOrders(FIELDCAPTION("Ending Date"));
          FIELDNO("Ending Time"): CheckNumberOfWorkOrders(FIELDCAPTION("Ending Time"));
          FIELDNO("Duration Time"): ERROR(Text009, FIELDCAPTION("Duration Time"), TABLECAPTION, "No.");
          FIELDNO(Subcontractor): ERROR(Text009, FIELDCAPTION(Subcontractor), TABLECAPTION, "No.");
          FIELDNO("Employee No."): ERROR(Text009, FIELDCAPTION("Employee No."), TABLECAPTION, "No.");
          FIELDNO("First Possible Starting Date"): ERROR(Text009, FIELDCAPTION("First Possible Starting Date"), TABLECAPTION, "No.");
          FIELDNO("Last Possible Ending Date"): ERROR(Text009, FIELDCAPTION("Last Possible Ending Date"), TABLECAPTION, "No.");
          FIELDNO("First Possible Starting Time"): ERROR(Text009, FIELDCAPTION("First Possible Starting Time"), TABLECAPTION, "No.");
          FIELDNO("Last Possible Ending Time"): ERROR(Text009, FIELDCAPTION("Last Possible Ending Time"), TABLECAPTION, "No.");
          //FIELDNO("Plan during Clock Time"): ERROR(Text009, FIELDCAPTION("Plan during Clock Time"), TABLECAPTION, "No.");
        END;
      END;
    END;

    PROCEDURE UpdatePlanningAllowed@1100525028() : Boolean;
    VAR
      lvRefPointRec@1100525000 : Record 11020271;
    BEGIN
      CALCFIELDS("Actual Reference Point");
      IF "Actual Reference Point" <> 0 THEN
        IF lvRefPointRec.GET("Actual Reference Point") THEN
          EXIT(NOT lvRefPointRec."Block Modify Service Order");
      EXIT(TRUE);
    END;

    PROCEDURE UpdateFinishedBudgetLines@1100485020();
    VAR
      ServBudgetRec@1100485000 : Record 11012875;
      GanttChartMgt@1210190000 : Codeunit 11012037;
    BEGIN
      //IF ("Date/Time Export to FSA" = 0DT) THEN EXIT;

      IF (Status = Status::"Technical Finished") OR (Status = Status::"Administrative Finished") THEN BEGIN
        ServBudgetRec.SETRANGE("Budget Type", ServBudgetRec."Budget Type"::Order);
        ServBudgetRec.SETRANGE("Service Order No.", "No.");
        ServBudgetRec.SETRANGE(Finished, FALSE);
        ServBudgetRec.SETRANGE("Follow-up Job", FALSE);
        ServBudgetRec.MODIFYALL(Finished,TRUE);
        GanttChartMgt.BuildServiceHours(Rec,FALSE);  //db, 12-12-11: M31261

        UpdateFinishedObjects;
      END;
    END;

    PROCEDURE LookupPreviousServOrder@1100485013();
    VAR
      ServOrderRec@1100485000 : Record 11012823;
    BEGIN
      IF "Previous Service Order No." <> '' THEN
        ServOrderRec.GET("Previous Service Order No.");
      ServOrderRec.SETFILTER("No.", '<>%1', "No.");
      IF "Customer No." <> '' THEN
        ServOrderRec.SETRANGE("Customer No.", "Customer No.");
      IF "Service Contract No." <> '' THEN
        ServOrderRec.SETRANGE("Service Contract No.", "Service Contract No.");
      IF "Service Location No." <> '' THEN
        ServOrderRec.SETRANGE("Service Location No.", "Service Location No.");
      IF PAGE.RUNMODAL(PAGE::"Service-Order List", ServOrderRec) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Previous Service Order No.", ServOrderRec."No.");
      END;
    END;

    PROCEDURE CheckVATReverse@1100485017(lvFieldValidate@1100485002 : Boolean;lvFieldEntry@1100525000 : Boolean) : Boolean;
    VAR
      VATPostingSetup@1100485000 : Record 325;
      CustRec@1100485001 : Record 18;
    BEGIN
      //db, 06-07-09
      IF NOT CustRec.GET("Bill-to Customer No.") THEN
        CustRec.INIT;
      IF NOT VATPostingSetup.GET(CustRec."VAT Bus. Posting Group","VAT Prod. Posting Group") THEN
        VATPostingSetup.INIT;
      IF VATPostingSetup."VAT Calculation Type" = VATPostingSetup."VAT Calculation Type"::"Reverse Charge VAT" THEN BEGIN
        IF lvFieldEntry = TRUE THEN EXIT(TRUE);
        IF lvFieldValidate = FALSE THEN BEGIN
          IF NOT ServLocRec.GET("Service Location No.") THEN ServLocRec.INIT;
          IF ServLocRec."VAT Prod. Posting Group" <> '' THEN BEGIN
            "% Labor" := ServLocRec."Percentage Labor";
            "% to B Account" := ServLocRec."Percentage to B Account";
          END ELSE BEGIN
            IF NOT ServContrRec.GET("Service Contract No.") THEN ServContrRec.INIT;
            IF ServContrRec."VAT Prod. Posting Group" <> '' THEN BEGIN  //db, 25-02-11: M25849
              "% Labor" := ServContrRec."% Labor";
              "% to B Account" := ServContrRec."% to B Account";
            END;
          END;
        END;
      END ELSE BEGIN
        IF lvFieldEntry = TRUE THEN EXIT(FALSE);
        IF lvFieldValidate = TRUE THEN BEGIN
          TESTFIELD("% Labor", 0);
          TESTFIELD("% to B Account", 0);
        END ELSE BEGIN
          "% Labor" := 0;
          "% to B Account" := 0;
        END;
      END;
    END;

    PROCEDURE DrillDownActualRefPoint@1100485019();
    VAR
      DocumentReferencePointsFRM@1100485000 : Page 11020345;
    BEGIN
      DocumentReferencePointsFRM.SetServiceOrderNo("No.");
      DocumentReferencePointsFRM.EDITABLE(FALSE);
      DocumentReferencePointsFRM.RUNMODAL;
    END;

    PROCEDURE CreateTryOutQuote@1100485023();
    VAR
      TryOutQuoteRec@1100485000 : Record 11012758;
      TryOutSuccRec@1100485001 : Record 11012761;
      ContBusRel@1100485002 : Record 5054;
      lvText000@1100485003 : TextConst 'ENU=%1 %2 created;NOR=%1 %2 er opprettet.;SVE=%1 %2 har skapats.';
      Options@1100485004 : Text[80];
      Selected@1100485005 : Integer;
    BEGIN
      Options := Text015;
      Selected := STRMENU(Options, 2);
      IF Selected = 0 THEN EXIT;

      TryOutQuoteRec.INIT;
      TryOutQuoteRec.INSERT(TRUE);

      ContBusRel.SETCURRENTKEY("Link to Table", "No.");
      ContBusRel.SETRANGE("No.", "Customer No.");
      ContBusRel.SETRANGE("Link to Table", ContBusRel."Link to Table"::Customer);
      IF ContBusRel.FIND('-') THEN
        TryOutQuoteRec.VALIDATE("Contact No.", ContBusRel."Contact No.");

      IF Selected = 2 THEN BEGIN
        IF "Service Location No." <> '' THEN BEGIN
          TryOutQuoteRec."Copy Address from" := TryOutQuoteRec."Copy Address from"::"Service Location";
          TryOutQuoteRec.VALIDATE("Service Location", "Service Location No.");
        END ELSE
          TryOutQuoteRec."Copy Address from" := TryOutQuoteRec."Copy Address from"::Company;
        TryOutQuoteRec.Description := Description;
        TryOutQuoteRec."Description 2" := Name;
        TryOutQuoteRec.Address := Address;
        TryOutQuoteRec.City := City;
        TryOutQuoteRec."Post Code" := "Post Code";
        TryOutQuoteRec."Territory Code" := "Territory Code";
        TryOutQuoteRec.VALIDATE("Bill-to Customer No.", "Bill-to Customer No.");
      END;

      IF Selected = 1 THEN BEGIN
        //TryOutQuoteRec.VALIDATE("Copy Address from", TryOutQuoteRec."Copy Address from"::Company);
        TryOutQuoteRec.VALIDATE("Copy Address from", TryOutQuoteRec."Copy Address from"::"Bill-to"); //WWB, 14 okt 2008 - Call 11612
        TryOutQuoteRec.Description := Description;
        TryOutQuoteRec."Description 2" := "Bill-to Name";
        TryOutQuoteRec.Address := "Bill-to Address";
        TryOutQuoteRec."Address 2" := "Bill-to Address 2";
        TryOutQuoteRec.City := "Bill-to City";
        TryOutQuoteRec."Post Code" := "Bill-to Post Code";
        TryOutQuoteRec."Territory Code" := "Territory Code";
        //TryOutQuoteRec.County := ?;                                                              These aren't available from record
        //TryOutQuoteRec."Country Code" := ?;
      END;


      TryOutQuoteRec."Your reference" := "Your Reference";
      TryOutQuoteRec."Global Dimension 1 Code" := "Global Dimension 1 Code";
      TryOutQuoteRec.Discipline := Discipline;
      TryOutQuoteRec.MODIFY(TRUE);

      TryOutSuccRec.INIT;
      TryOutSuccRec."Try-out No." := TryOutQuoteRec."Try-out No.";
      TryOutSuccRec."Try-out Quote" := TryOutQuoteRec.Code;
      TryOutSuccRec."Line No." := 10000;
      TryOutSuccRec.INSERT(TRUE);
      TryOutSuccRec."Service Order No." := "No.";
      TryOutSuccRec."Service Contract No." := "Service Contract No.";    //db, 10-10-08: M12693
      TryOutSuccRec."Service Location No." := "Service Location No.";  //db, 10-10-08: M12693
      TryOutSuccRec.MODIFY(TRUE);

      MESSAGE(lvText000, TryOutQuoteRec.TABLECAPTION, TryOutQuoteRec.Code);
    END;

    PROCEDURE CheckContractServBudget@1100485029(lvAction@1100485002 : Integer);
    VAR
      lvServBudgetRec@1100485000 : Record 11012875;
      lvServBudgetRec2@1100485001 : Record 11012875;
    BEGIN
      lvServBudgetRec.SETRANGE("Budget Type", lvServBudgetRec."Budget Type"::Order);
      lvServBudgetRec.SETRANGE("Service Order No.", "No.");
      IF NOT lvServBudgetRec.ISEMPTY THEN BEGIN
        IF lvServBudgetRec.FINDSET(TRUE, TRUE) THEN BEGIN
          REPEAT
            IF lvAction = 0 THEN BEGIN
              lvServBudgetRec."Service Location No." := "Service Location No.";
              lvServBudgetRec.MODIFY;
            END;
            IF lvAction = 1 THEN BEGIN
              IF lvServBudgetRec."Service Contract No." <> "Service Contract No." THEN BEGIN
                IF "Source Type" = "Source Type"::Contract THEN
                  TESTFIELD("Service Contract No.", lvServBudgetRec."Service Contract No.");  //db, 23-03-10: M18554
                lvServBudgetRec2 := lvServBudgetRec;
                lvServBudgetRec2."Service Contract No." := "Service Contract No.";
                lvServBudgetRec2.INSERT;
                lvServBudgetRec.DELETE;
              END;
            END;
          UNTIL lvServBudgetRec.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE CheckServOrderAuthorization@1100485028(FieldCap@1100485000 : Text[100]);
    BEGIN
      IF "No." = '' THEN EXIT;  //db, 11-02-09
      IF CurrFieldNo = 0 THEN EXIT;  //db, 28-02-11: M25697 (skip function if validate called for just created orders)

      ServSetup.GET;
      IF NOT ServSetup."Service Authorization" THEN
        EXIT;

      IF CheckCostsAndRevenuesZero(TRUE) THEN
        EXIT;

      //Check now if user is authorized for changes
      IF UserSetup.GET(USERID) THEN
        IF UserSetup."Service Authorization Active" THEN
          EXIT;

      ERROR(Text016, FieldCap, USERID);
    END;

    PROCEDURE CheckCostsAndRevenuesZero@1100485031(CheckOpen@1100485002 : Boolean) : Boolean;
    VAR
      CostControlMgt@1100485001 : Codeunit 11012006;
      TotCost@1100485000 : Decimal;
    BEGIN
      //db.sn, 01-02-11: M22902
      CALCFIELDS(Revenues, "Invoice in Process", "Credit Memo in Process");
      IF (Revenues <> 0) OR ("Invoice in Process" <> 0) OR ("Credit Memo in Process" <> 0) THEN
        EXIT(FALSE);
      //db.en, 01-02-11: M22902

      IF (CurrFieldNo = FIELDNO("Service Contract No.")) AND ("Decentral Created" = TRUE) THEN  //db, 15-08-13: C008074
        CheckOpen := FALSE;  //check ActualCost only; ExpectedCost (OpenPurch/Hours/Inventory) will be updated

      IF CheckOpen THEN BEGIN
        TotCost := CostControlMgt.TotCostServOrder(Rec, TRUE)
      END ELSE BEGIN
        CALCFIELDS("Actual Costs");
        TotCost := "Actual Costs";
      END;

      EXIT(TotCost = 0);
    END;

    PROCEDURE AssistEditSubcontractor@1100525006(lvAction@1100485007 : Integer) : Text[30];
    VAR
      lvVendorRec@1100485000 : Record 23;
      lvNumRec@1100485008 : Integer;
    BEGIN
      IF "Service Contract No." = '' THEN BEGIN  //db, 01-11-07 (regarding to performance)
        IF lvAction = 0 THEN EXIT('');  //display (form)
        IF lvAction = 2 THEN EXIT('');  //validate (discipline)
      END;

      IF Subcontractor <> '' THEN
        lvVendorRec.GET(Subcontractor);

      lvVendorRec.MARKEDONLY(TRUE);
      IF lvAction = 0 THEN BEGIN  //0=display; 1=assist-edit; 2=validate discipline; 3=lookup
        lvNumRec := lvVendorRec.COUNT;
        IF lvNumRec = 0 THEN
          EXIT('')
        ELSE
          EXIT('[' + FORMAT(lvNumRec) + ']');
      END;
      IF lvAction = 1 THEN BEGIN
        lvVendorRec.SETFILTER("Subcontractor Type",'>%1',lvVendorRec."Subcontractor Type"::" ");
        IF PAGE.RUNMODAL(0, lvVendorRec) = ACTION::LookupOK THEN
          VALIDATE(Subcontractor, lvVendorRec."No.");
      END;
      IF lvAction = 2 THEN BEGIN
        lvNumRec := lvVendorRec.COUNT;
        IF lvNumRec <> 1 THEN
          EXIT('')
        ELSE
          EXIT(lvVendorRec."No.");
      END;
    END;

    PROCEDURE ActivateCreditLimit@1100525033(lvAction@1100525001 : Integer) ShowWarning : Boolean;
    VAR
      CreditLimitFrm@1100525000 : Page 343;
    BEGIN
      //db, 16-12-10: M23068
      ShowWarning := CreditLimitFrm.ServiceOrderShowWarning("Bill-to Customer No.");
      IF lvAction = 1 THEN
        CreditLimitFrm.RUNMODAL;
      EXIT(ShowWarning);
    END;

    PROCEDURE UpdateServiceCall@1100525000();
    VAR
      ServiceSetup@1100528600 : Record 11012800;
      lvServCallRec@1100525000 : Record 11012822;
      lvServOrderRec@1100525001 : Record 11012823;
      OldServCallRec@1100525002 : Record 11012822;
      ServiceCallStatus@1100525003 : Option;
    BEGIN
      IF lvServCallRec.GET("Call No.") THEN BEGIN
        OldServCallRec := lvServCallRec;  //db, 22-03-10: M15436
        IF ServiceSetup.GET AND ServiceSetup."Auto Update Call from Order" THEN BEGIN
          IF (lvServCallRec."Customer No." <> "Customer No.") OR
             (lvServCallRec."Service Location No." <> "Service Location No.") OR
             (lvServCallRec."Service Contract No." <> "Service Contract No.") OR
             (lvServCallRec.Problem <> Problem) OR
             (lvServCallRec.Cause <> Cause) OR
             (lvServCallRec.Solution <> Solution)
          THEN BEGIN
            lvServCallRec."Customer No." := "Customer No.";
            lvServCallRec."Service Location No." := "Service Location No.";
            lvServCallRec."Service Contract No." := "Service Contract No.";
            lvServCallRec.Problem := Problem;
            lvServCallRec.Cause := Cause;
            lvServCallRec.Solution := Solution;
          END;
        END;

        lvServOrderRec.SETCURRENTKEY("Call No.");
        lvServOrderRec.SETRANGE("Call No.", "Call No.");
        lvServOrderRec.SETFILTER("No.", '<>%1', "No.");
        lvServOrderRec.SETFILTER(Status, '<%1', Status::"Technical Finished");
        IF (lvServOrderRec.ISEMPTY) AND (Status >= Status::"Technical Finished") THEN
          ServiceCallStatus := lvServCallRec.Status::Finished
        ELSE
          ServiceCallStatus := lvServCallRec.Status::"In Process";
        IF Status = Status::Cancelled THEN BEGIN
          lvServOrderRec.SETFILTER(Status, '<>%1', Status);
          IF (lvServOrderRec.ISEMPTY) THEN
            ServiceCallStatus := lvServCallRec.Status::Cancelled;
        END;
        lvServCallRec.VALIDATE(Status, ServiceCallStatus);

        IF OldServCallRec.Status <> lvServCallRec.Status THEN BEGIN  //db, 22-03-10: M15436
          ServLogRec.StoreChange(2, lvServCallRec."No.", ServLogRec.FormatDescription(lvServCallRec.FIELDCAPTION(Status),
            FORMAT(OldServCallRec.Status), FORMAT(lvServCallRec.Status)));
          ProgPhaseRec.CheckProgressScheme(ProgPhaseRec.Type::ServCall,
            lvServCallRec."Progress Scheme", lvServCallRec."No.", lvServCallRec.Status, TODAY, TIME);
          lvServCallRec.CheckUpdateDocRefPoint('M');
          lvServCallRec.UpdateNextDeadline;  //db, 24-02-11
        END;
        lvServCallRec.MODIFY();
      END;
    END;

    PROCEDURE CheckDateOutOfUse@1100525002() StartDate : Date;
    BEGIN
      IF "Starting Date" <> 0D THEN
        StartDate := "Starting Date"
      ELSE
        StartDate := "Order Date";

      IF StartDate = 0D THEN
        StartDate := TODAY;  //db, 16-11-09: M16603

      EXIT(StartDate);
    END;

    LOCAL PROCEDURE UpdatePrefLocations@1100525003();
    VAR
      PreferenceLocation@1100525001 : Record 11020353;
      ServiceLocationPrefLoc@1100525000 : Record 11020391;
      GeneralLedgerSetup@1100528602 : Record 98;
      DimensionValueLocation@1100528600 : Record 11020352;
    BEGIN
      PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::"Service Order");
      PreferenceLocation.SETRANGE("No.", "No.");
      IF NOT PreferenceLocation.ISEMPTY THEN
        PreferenceLocation.DELETEALL;

      ServiceLocationPrefLoc.SETRANGE("Service Location No.", "Service Location No.");
      IF ServiceLocationPrefLoc.FINDSET THEN BEGIN
        REPEAT
          PreferenceLocation.Type := PreferenceLocation.Type::"Service Order";
          PreferenceLocation."No." := "No.";
          PreferenceLocation."Location Code" := ServiceLocationPrefLoc."Location Code";
          PreferenceLocation.Priority := ServiceLocationPrefLoc.Priority;
          PreferenceLocation.INSERT;
        UNTIL ServiceLocationPrefLoc.NEXT = 0;
      END ELSE BEGIN
        GeneralLedgerSetup.GET;
        DimensionValueLocation.SETRANGE("Dimension Code", GeneralLedgerSetup."Global Dimension 1 Code");
        DimensionValueLocation.SETRANGE("Dimension Value Code", "Global Dimension 1 Code");
        IF DimensionValueLocation.FINDSET THEN
          REPEAT
            PreferenceLocation.Type := PreferenceLocation.Type::"Service Order";
            PreferenceLocation."No." := "No.";
            PreferenceLocation."Location Code" := DimensionValueLocation."Location Code";
            PreferenceLocation.Priority := DimensionValueLocation.Priority;
            PreferenceLocation.INSERT;
          UNTIL DimensionValueLocation.NEXT = 0;
      END;
    END;

    PROCEDURE CheckModifyCallNoAllowed@1100525004() : Boolean;
    VAR
      lvProjSetupRec@1100525000 : Record 315;
    BEGIN
      IF "Source Type" <> "Source Type"::Call THEN
        EXIT(FALSE);

      IF "Decentral Created" THEN BEGIN
        lvProjSetupRec.GET;
        IF (lvProjSetupRec."Field Service Active") OR (lvProjSetupRec.IsFSAActive) THEN
          EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE UpdateExportFSAInWorkOrder@1100525005();
    VAR
      ProjSetup@1100525001 : Record 315;
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      //DP00465.n
      IF ProjSetup.IsFSAActive THEN BEGIN
        WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
        WorkOrder.SETRANGE("Source Company", COMPANYNAME);
        WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
        WorkOrder.SETRANGE("Source No.", "No.");
        WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Employee);
        IF NOT "Export to FSA" THEN
          WorkOrder.SETRANGE("Export to FSA", TRUE)
        ELSE BEGIN
          WorkOrder.FINDFIRST; // Need at least 1 work order
          WorkOrder.SETRANGE("Export to FSA", FALSE);
        END;
        IF NOT WorkOrder.ISEMPTY THEN BEGIN
          IF WorkOrder.FINDSET(TRUE,FALSE) THEN BEGIN
            REPEAT
              WorkOrder.VALIDATE("Export to FSA", "Export to FSA");
              WorkOrder.MODIFY(TRUE);
            UNTIL WorkOrder.NEXT = 0;
          END;
        END;
      END;
    END;

    PROCEDURE CopyExtraCost@1100525127();
    VAR
      ServiceExtraCostFrom@1100525001 : Record 11020344;
      ServiceExtraCostTo@1100525000 : Record 11020344;
      ServiceSetup@1100525002 : Record 11012800;
      CostObjectFilter@1100525003 : Text[250];
      LineNo@1100525004 : Integer;
    BEGIN
      IF ("Service Contract No." = '') AND ("Customer No." = '') THEN
        EXIT;

      ServiceSetup.GET;
      IF ServiceSetup."Cost Object Travel Time" <> '' THEN
        CostObjectFilter := STRSUBSTNO('<>%1', ServiceSetup."Cost Object Travel Time");
      IF ServiceSetup."Cost Object Travel Distance" <> '' THEN BEGIN
        IF CostObjectFilter <> '' THEN
          CostObjectFilter := CostObjectFilter + '&';
        CostObjectFilter := STRSUBSTNO('%1<>%2', CostObjectFilter, ServiceSetup."Cost Object Travel Distance");
      END;
      IF ServiceSetup."Cost Object Travel Cost" <> '' THEN BEGIN
        IF CostObjectFilter <> '' THEN
          CostObjectFilter := CostObjectFilter + '&';
        CostObjectFilter := STRSUBSTNO('%1<>%2', CostObjectFilter, ServiceSetup."Cost Object Travel Cost");
      END;

      ServiceExtraCostTo.SETRANGE("Entity Type", ServiceExtraCostFrom."Entity Type"::"Service Order");
      ServiceExtraCostTo.SETRANGE("Entity Code", "No.");
      IF CostObjectFilter <> '' THEN
        ServiceExtraCostTo.SETFILTER("Cost Object", CostObjectFilter);
      ServiceExtraCostTo.DELETEALL(TRUE);
      ServiceExtraCostTo.SETRANGE("Cost Object");
      IF ServiceExtraCostTo.FINDLAST THEN
        LineNo := ServiceExtraCostTo."Line No.";
      LineNo += 10000;

      IF "Service Contract No." <> '' THEN BEGIN
        ServiceExtraCostFrom.SETRANGE("Entity Type", ServiceExtraCostFrom."Entity Type"::"Service Contract");
        ServiceExtraCostFrom.SETRANGE("Entity Code", "Service Contract No.");
      END ELSE BEGIN
        ServiceExtraCostFrom.SETRANGE("Entity Type", ServiceExtraCostFrom."Entity Type"::Customer);
        ServiceExtraCostFrom.SETRANGE("Entity Code", "Customer No.");
      END;

      ServiceExtraCostFrom.SETFILTER("Apply at Source Type", '%1|%2',
        ServiceExtraCostFrom."Apply at Source Type"::"All Source Types", "Source Type");
      ServiceExtraCostFrom.SETFILTER(Priority, '%1|%2', '', Priority);

      ServiceExtraCostFrom.SetPostCodeGroupFilter(GetPostCodeGroupCode);

      IF ServiceExtraCostFrom.FINDSET THEN
        REPEAT
          ServiceExtraCostTo := ServiceExtraCostFrom;
          ServiceExtraCostTo."Entity Type" := ServiceExtraCostTo."Entity Type"::"Service Order";
          ServiceExtraCostTo."Entity Code" := "No.";
          ServiceExtraCostTo."Line No." := LineNo;
          ServiceExtraCostTo."Apply at Post Code Group" := '';
          ServiceExtraCostTo.INSERT(TRUE);
          LineNo += 10000;
        UNTIL ServiceExtraCostFrom.NEXT = 0;
    END;

    PROCEDURE ShowMyOrders@1100525009();
    VAR
      ServiceOrder@1100525001 : Record 11012823;
      UserSetup@1100525000 : Record 91;
    BEGIN
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("Employee No.");

      ServiceOrder := Rec;

      ServiceOrder.RESET;
      ServiceOrder.SETRANGE("Assigned to", UserSetup."Employee No.");
      ServiceOrder.SETFILTER(Status,'<%1', Status::Finished);
      PAGE.RUN(PAGE::"Service-Order List", ServiceOrder);
    END;

    PROCEDURE LookupServicePackage@1100525011();
    VAR
      ServPackFrm@1100525000 : Page 11012857;
      ServPackRec@1100525001 : Record 11012806;
    BEGIN
      //db, 17-03-10: T4627
      ServPackRec.SETFILTER("Source Type", '%1|%2', "Source Type", ServPackRec."Source Type"::None);
      ServPackFrm.SETTABLEVIEW(ServPackRec);
      IF ServPackRec.GET("Service Package") THEN
        ServPackFrm.SETRECORD(ServPackRec);
      ServPackFrm.SetSelection("Service Contract No.");
      ServPackFrm.LOOKUPMODE(TRUE);
      IF ServPackFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
        ServPackFrm.GETRECORD(ServPackRec);
        VALIDATE("Service Package", ServPackRec.Code);
      END;
    END;

    PROCEDURE CheckContrDiscAdditionalCost@1100525012();
    VAR
      ContrDiscRec@1100525000 : Record 11012828;
      OrderIndicationRec@1100525001 : Record 11012837;
      CostComp@1100525002 : Text[50];
    BEGIN
      //db, 04-02-10
      IF "Service Contract No." = '' THEN EXIT;  //skip check standard discount terms

      ServSetup.GET;
      IF ServSetup."Add.Cost Based On Contr.Disc." = FALSE THEN BEGIN
        "Additional Cost (Labor)" := FALSE;
        "Additional Cost (Material)" := FALSE;
        "Additional Cost (Subc)" := FALSE;
        "Additional Cost (Plant)" := FALSE;
        "Additional Cost (Sundry)" := FALSE;
      END ELSE BEGIN
        "Additional Cost" := FALSE;
        "Additional Cost (Labor)" := TRUE;
        "Additional Cost (Material)" := TRUE;
        "Additional Cost (Subc)" := TRUE;
        "Additional Cost (Plant)" := TRUE;
        "Additional Cost (Sundry)" := TRUE;
      END;
      IF "Source Type" = "Source Type"::Direct THEN
        EXIT;

      IF ServSetup."Contract Discount Level" = ServSetup."Contract Discount Level"::CostComponent THEN BEGIN
        IF OrderIndicationRec.GET(OrderIndicationRec.Indication::Kind, "Order Kind") THEN
          CostComp := OrderIndicationRec."Cost Component";
        IF OrderIndicationRec.GET(OrderIndicationRec.Indication::Type, "Order Type") THEN BEGIN
          IF (CostComp = '') THEN
            CostComp := OrderIndicationRec."Cost Component";
          IF (CostComp <> OrderIndicationRec."Cost Component") AND (OrderIndicationRec."Cost Component" <> '')THEN
            CostComp := CostComp + '|' + OrderIndicationRec."Cost Component";
        END;
      END;

      ContrDiscRec.SETRANGE("Service Contract No.", "Service Contract No.");
      IF ServSetup."Contract Discount Level" = ServSetup."Contract Discount Level"::SourceType THEN BEGIN
        ContrDiscRec.SETRANGE("Discount Level", ContrDiscRec."Discount Level"::SourceType);
        ContrDiscRec.SETRANGE("Source Type", "Source Type");
      END;
      IF ServSetup."Contract Discount Level" = ServSetup."Contract Discount Level"::CostComponent THEN BEGIN
        ContrDiscRec.SETRANGE("Discount Level", ContrDiscRec."Discount Level"::CostComponent);
        IF CostComp <> '' THEN
          ContrDiscRec.SETFILTER("Cost Component", CostComp);
      END;
      IF ContrDiscRec.FINDSET THEN BEGIN
        REPEAT
          CASE ContrDiscRec."Cost Type" OF
             ContrDiscRec."Cost Type"::" ":
               BEGIN
                 "Additional Cost (Labor)" := FALSE;
                 "Additional Cost (Material)" := FALSE;
                 "Additional Cost (Subc)" := FALSE;
                 "Additional Cost (Plant)" := FALSE;
                 "Additional Cost (Sundry)" := FALSE;
               END;
            ContrDiscRec."Cost Type"::Labor: "Additional Cost (Labor)" := FALSE;
            ContrDiscRec."Cost Type"::Material: "Additional Cost (Material)" := FALSE;
            ContrDiscRec."Cost Type"::Subcontracting: "Additional Cost (Subc)" := FALSE;
            ContrDiscRec."Cost Type"::Plant: "Additional Cost (Plant)" := FALSE;
            ContrDiscRec."Cost Type"::Sundry: "Additional Cost (Sundry)" := FALSE;
          END;
        UNTIL ContrDiscRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetAdditionalCostService@1100525013(IServiceOrderNo@1100525001 : Code[20];ICostObject@1100525003 : Code[20];ICostType@1100525006 : ' ,Labor,Material,Subcontracting,Plant,Sundry,Revenue';ICompanyName@1100525005 : Text[50];ISource@1100528600 : Variant) AdditionCost : Boolean;
    VAR
      ServiceSetup@1100528613 : Record 11012800;
      ServiceOrder@1100528601 : Record 11012823;
      ServiceOrderCostPlusEntry@1100528612 : Record 11012825;
      SalesLine@1100528611 : Record 37;
      PurchaseLine@1100528610 : Record 39;
      GenJournalLine@1100528609 : Record 81;
      ItemJournalLine@1100528608 : Record 83;
      RequisitionLine@1100528607 : Record 246;
      InvoiceApprovalLine@1100528606 : Record 11012032;
      HourAccountingLine@1100528605 : Record 11012039;
      AdviceOrderLine@1100528604 : Record 11012055;
      ServiceOrderBudgetLine@1100528603 : Record 11012875;
      RecRef@1100528602 : RecordRef;
    BEGIN
      //12-07-2016: used in table 37, 39, 81, 83, 246, 11012032/039/055/825/875, report 11012564
      IF ICompanyName <> '' THEN BEGIN
        ServiceSetup.CHANGECOMPANY(ICompanyName);
        ServiceOrder.CHANGECOMPANY(ICompanyName);
      END;

      ServiceSetup.GET;
      ServiceOrder.GET(IServiceOrderNo);
      IF ServiceSetup."Add.Cost Based On Contr.Disc." = FALSE THEN BEGIN
        AdditionCost := ServiceOrder."Additional Cost";
      END ELSE BEGIN
        IF ServiceOrder."Source Type" = ServiceOrder."Source Type"::Direct THEN BEGIN
          CASE ICostType OF
            ICostType::Labor:
              AdditionCost := ServiceOrder."Additional Cost (Labor)";
            ICostType::Material:
              AdditionCost := ServiceOrder."Additional Cost (Material)";
            ICostType::Subcontracting:
              AdditionCost := ServiceOrder."Additional Cost (Subc)";
            ICostType::Plant:
              AdditionCost := ServiceOrder."Additional Cost (Plant)";
            ICostType::Sundry:
              AdditionCost := ServiceOrder."Additional Cost (Sundry)";
            ELSE
              AdditionCost :=
                (ServiceOrder."Additional Cost (Labor)" AND
                 ServiceOrder."Additional Cost (Material)" AND
                 ServiceOrder."Additional Cost (Subc)" AND
                 ServiceOrder."Additional Cost (Plant)" AND
                 ServiceOrder."Additional Cost (Sundry)");
          END;
        END ELSE BEGIN
          IF ISource.ISRECORD THEN
            RecRef.GETTABLE(ISource);

          IF ICompanyName <> '' THEN
            ServiceOrderCostPlusEntry.CHANGECOMPANY(ICompanyName);

          ServiceOrderCostPlusEntry."Service Order No." := IServiceOrderNo;
          ServiceOrderCostPlusEntry."Cost Object" := ICostObject;
          ServiceOrderCostPlusEntry."Cost Type" := ICostType -1;

          CASE RecRef.NUMBER OF
            DATABASE::"Sales Line":
              BEGIN
                RecRef.SETTABLE(SalesLine);
                ServiceOrderCostPlusEntry."Cost Component" := SalesLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := SalesLine."Posting Date";
                ServiceOrderCostPlusEntry.Quantity := SalesLine.Quantity;
                IF ServiceOrderCostPlusEntry.Quantity <> 0 THEN
                  ServiceOrderCostPlusEntry."Sales Price (LCY)" := SalesLine."Amount (LCY)" / ServiceOrderCostPlusEntry.Quantity
                ELSE
                  ServiceOrderCostPlusEntry."Sales Price (LCY)" := SalesLine."Amount (LCY)";
                ServiceOrderCostPlusEntry."Item No." := SalesLine."Item No.";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := SalesLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := SalesLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := SalesLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := SalesLine."Basic Item";
              END;
            DATABASE::"Purchase Line":
              BEGIN
                RecRef.SETTABLE(PurchaseLine);
                ServiceOrderCostPlusEntry."Cost Component" := PurchaseLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := PurchaseLine."Posting Date";
                ServiceOrderCostPlusEntry.Quantity := PurchaseLine.Quantity;
                IF ServiceOrderCostPlusEntry.Quantity <> 0 THEN
                  ServiceOrderCostPlusEntry."Sales Price (LCY)" := PurchaseLine."Amount (LCY)" / ServiceOrderCostPlusEntry.Quantity
                ELSE
                  ServiceOrderCostPlusEntry."Sales Price (LCY)" := PurchaseLine."Amount (LCY)";
                ServiceOrderCostPlusEntry."Item No." := PurchaseLine."Item No.";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := PurchaseLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := PurchaseLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := PurchaseLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := PurchaseLine."Basic Item";
              END;
            DATABASE::"Gen. Journal Line":
              BEGIN
                RecRef.SETTABLE(GenJournalLine);
                ServiceOrderCostPlusEntry."Cost Component" := GenJournalLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := GenJournalLine."Posting Date";
                ServiceOrderCostPlusEntry.Quantity := GenJournalLine.Quantity;
                IF ServiceOrderCostPlusEntry.Quantity <> 0 THEN
                  ServiceOrderCostPlusEntry."Sales Price (LCY)" := GenJournalLine."Amount (LCY)" / ServiceOrderCostPlusEntry.Quantity
                ELSE
                  ServiceOrderCostPlusEntry."Sales Price (LCY)" := GenJournalLine."Amount (LCY)";
                ServiceOrderCostPlusEntry."Item No." := GenJournalLine."Item No.";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := GenJournalLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := GenJournalLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := GenJournalLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := GenJournalLine."Basic Item";
              END;
            DATABASE::"Item Journal Line":
              BEGIN
                RecRef.SETTABLE(ItemJournalLine);
                ServiceOrderCostPlusEntry."Cost Component" := ItemJournalLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := ItemJournalLine."Posting Date";
                ServiceOrderCostPlusEntry.Quantity := ItemJournalLine.Quantity;
                ServiceOrderCostPlusEntry."Sales Price (LCY)" := ItemJournalLine."Unit Amount";
                ServiceOrderCostPlusEntry."Item No." := ItemJournalLine."Item No.";
              END;
            DATABASE::"Requisition Line":
              BEGIN
                RecRef.SETTABLE(RequisitionLine);
                ServiceOrderCostPlusEntry."Cost Component" := RequisitionLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := RequisitionLine."Order Date";
                ServiceOrderCostPlusEntry.Quantity := RequisitionLine.Quantity;
                ServiceOrderCostPlusEntry."Sales Price (LCY)" := RequisitionLine."Unit Price (LCY)";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := RequisitionLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := RequisitionLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := RequisitionLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := RequisitionLine."Basic Item";
              END;
            DATABASE::"Invoice Approval Line":
              BEGIN
                RecRef.SETTABLE(InvoiceApprovalLine);
                ServiceOrderCostPlusEntry."Cost Component" := InvoiceApprovalLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := InvoiceApprovalLine."Posting Date";
                ServiceOrderCostPlusEntry.Quantity := InvoiceApprovalLine.Quantity;
                ServiceOrderCostPlusEntry."Currency Code" := InvoiceApprovalLine.GetCurrCodeHeader;
                ServiceOrderCostPlusEntry.VALIDATE("Sales Price", InvoiceApprovalLine."Sales Price");
                ServiceOrderCostPlusEntry."Item No." := InvoiceApprovalLine."Item No.";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := InvoiceApprovalLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := InvoiceApprovalLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := InvoiceApprovalLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := InvoiceApprovalLine."Basic Item";
              END;
            DATABASE::"Hour Accounting Line":
              BEGIN
                RecRef.SETTABLE(HourAccountingLine);
                ServiceOrderCostPlusEntry."Cost Component" := HourAccountingLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := HourAccountingLine."Posting Date";
                ServiceOrderCostPlusEntry.Quantity := HourAccountingLine."Total Line";
                ServiceOrderCostPlusEntry."Sales Price (LCY)" := HourAccountingLine."Unit Cost (LCY)";
              END;
            DATABASE::"Advice Order Line":
              BEGIN
                RecRef.SETTABLE(AdviceOrderLine);
                ServiceOrderCostPlusEntry."Cost Component" := AdviceOrderLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := AdviceOrderLine."Order Date";
                ServiceOrderCostPlusEntry.Quantity := AdviceOrderLine."Quantity (Advice)";
                ServiceOrderCostPlusEntry."Sales Price (LCY)" := AdviceOrderLine."Sales Price (LCY)";
                ServiceOrderCostPlusEntry."Item No." := AdviceOrderLine."Item No.";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := AdviceOrderLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := AdviceOrderLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := AdviceOrderLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := AdviceOrderLine."Basic Item";
              END;
            DATABASE::"Service Order Cost Plus Entry":
              RecRef.SETTABLE(ServiceOrderCostPlusEntry);
            DATABASE::"Service Order Budget Line":
              BEGIN
                RecRef.SETTABLE(ServiceOrderBudgetLine);
                ServiceOrderCostPlusEntry."Cost Component" := ServiceOrderBudgetLine."Cost Component";
                ServiceOrderCostPlusEntry."Posting Date" := ServiceOrderBudgetLine."Index Date";
                ServiceOrderCostPlusEntry.Quantity := ServiceOrderBudgetLine.Quantity;
                ServiceOrderCostPlusEntry."Sales Price (LCY)" := ServiceOrderBudgetLine.Price;
                ServiceOrderCostPlusEntry."Item No." := ServiceOrderBudgetLine."Item No.";
                ServiceOrderCostPlusEntry."Vendor (Trade Item)" := ServiceOrderBudgetLine."Vendor (Trade Item)";
                ServiceOrderCostPlusEntry."Trade Item" := ServiceOrderBudgetLine."Trade Item";
                ServiceOrderCostPlusEntry.Manufacturer := ServiceOrderBudgetLine.Manufacturer;
                ServiceOrderCostPlusEntry."Basic Item" := ServiceOrderBudgetLine."Basic Item";
              END;
          END;
          ServiceOrderCostPlusEntry.DetermineObjectNo(FALSE);
          ServiceOrderCostPlusEntry.GetContractDiscount;
          AdditionCost := ServiceOrderCostPlusEntry."Discount % (ServContr)" <> 100;
        END;
      END;
    END;

    PROCEDURE CheckAdditionalCostSetup@1100525019();
    BEGIN
      //db, 04-03-10
      IF CurrFieldNo = 0 THEN EXIT;

      ServSetup.GET;
      IF NOT ServSetup."Add.Cost Based On Contr.Disc." THEN EXIT;

      CASE CurrFieldNo OF
        FIELDNO("Additional Cost"):
          BEGIN
            "Additional Cost (Labor)" := "Additional Cost";
            "Additional Cost (Material)" := "Additional Cost";
            "Additional Cost (Subc)" := "Additional Cost";
            "Additional Cost (Plant)" := "Additional Cost";
            "Additional Cost (Sundry)" := "Additional Cost";
          END;
        FIELDNO("Additional Cost (Labor)"),
        FIELDNO("Additional Cost (Material)"),
        FIELDNO("Additional Cost (Subc)"),
        FIELDNO("Additional Cost (Plant)"),
        FIELDNO("Additional Cost (Sundry)"):
          BEGIN
            IF ("Additional Cost (Labor)" = TRUE) AND
               ("Additional Cost (Material)" = TRUE) AND
               ("Additional Cost (Subc)" = TRUE) AND
               ("Additional Cost (Plant)" = TRUE) AND
               ("Additional Cost (Sundry)" = TRUE) THEN
              "Additional Cost" := TRUE;
            IF ("Additional Cost (Labor)" = FALSE) AND
               ("Additional Cost (Material)" = FALSE) AND
               ("Additional Cost (Subc)" = FALSE) AND
               ("Additional Cost (Plant)" = FALSE) AND
               ("Additional Cost (Sundry)" = FALSE) THEN
              "Additional Cost" := FALSE;
          END;
      END;
    END;

    PROCEDURE CheckExpectedHours@1100525015(lvType@1100485000 : Integer;lvIndication@1100485001 : Code[10]);
    VAR
      ServIndicationRec@1100485002 : Record 11012837;
    BEGIN
      IF ServIndicationRec.GET(lvType, lvIndication) THEN BEGIN
        IF (ServIndicationRec."Expected Hours" <> 0) AND ("Expected Hours" <> 0) THEN BEGIN
          //db.sn, 02-03-15: C020552
          "Expected Hours" := ServIndicationRec."Expected Hours";
          CheckBudgetHours;
          VALIDATE("Expected Hours");
          //db.en, 02-03-15: C020552
        END;
      END;
    END;

    PROCEDURE RunCreatePlantLocation@1100525018(IServOrderRec@1100485002 : Record 11012823);
    VAR
      PlantMgtCompRec@1100525003 : Record 11020586;
      TmpPlantMgtCompRec@1100525002 : TEMPORARY Record 11020586;
      PlantMgtCompListFrm@1100525006 : Page 11124918;
      NoOfPlantComps@1100525005 : Integer;
      NoCreated@1100525004 : Integer;
      lvPlantLocCode@1100485000 : Code[20];
      lvText11012001@1100525001 : TextConst 'ENU=Create a Plant Location of Service Order ''%1''. Status is ''%2'', are you sure?;NOR=Opprett en Maskinlokasjon for Serviceordre ''%1''. Status er ''%2'', er du sikker?;SVE=Skapa en Maskinplats fr serviceorder ''%1''. Status r ''%2'', r du sker?';
      lvText11012002@1100525000 : TextConst 'ENU=Do you want to create a Plant Location of Service Order ''%1''?;NOR=Vil du opprette en maskinlokasjon for Serviceordre ''%1''?;SVE=Vill du skapa en Maskinplats fr serviceorder ''%1''?';
      lvText11012003@1100485003 : TextConst 'ENU=Plant Location ''%1'' is created in plant company ''%2''.;NOR=Maskinlokasjon ''%1'' er opprettet i maskinselskap ''%2''.;SVE=Lagerplats ''%1'' r skapad i Maskinfretag ''%2''.';
      lvText11012004@1100485004 : TextConst 'ENU=Plant Location ''%1'' is created in %2 plant companies.;NOR=Maskinlokasjon ''%1'' er opprettet i %2 maskinselskaper.;SVE=Lagerplats ''%1'' r skapad i %2 Maskinfretag.';
    BEGIN
      //**4PS (Copied from the T5200)
      CASE TRUE OF
        IServOrderRec.Status < Status::"In Process":
          IF NOT CONFIRM(lvText11012001, TRUE, IServOrderRec."No.", Status) THEN
            EXIT;
        IServOrderRec.Status = Status::"In Process":
          IF NOT CONFIRM(lvText11012002, TRUE, IServOrderRec."No.") THEN
            EXIT;
        IServOrderRec.Status > Status::"In Process":
          FIELDERROR(Status);
      END;

      NoCreated := 0;
      PlantMgtCompRec."Plant Company" := PlantMgtCompRec.GetPlantCompany(TRUE, NoOfPlantComps, '');
      IF NoOfPlantComps = 1 THEN BEGIN
        lvPlantLocCode := CreatePlantLocation(IServOrderRec, PlantMgtCompRec."Plant Company");
        IF lvPlantLocCode <> '' THEN
          NoCreated := 1;
      END ELSE BEGIN
        PlantMgtCompRec.RESET;
        PlantMgtCompListFrm.SetMultiCreate();
        PlantMgtCompListFrm.SETRECORD(PlantMgtCompRec);
        PlantMgtCompListFrm.LOOKUPMODE(TRUE);
        IF PlantMgtCompListFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          IF NOT PlantMgtCompListFrm.GetMarkedRecords(TmpPlantMgtCompRec) THEN BEGIN
            PlantMgtCompListFrm.GETRECORD(PlantMgtCompRec);
            lvPlantLocCode := CreatePlantLocation(IServOrderRec, PlantMgtCompRec."Plant Company");
            IF lvPlantLocCode <> '' THEN
              NoCreated := 1;
          END ELSE BEGIN
            TmpPlantMgtCompRec.FINDSET;
            REPEAT
              lvPlantLocCode := CreatePlantLocation(IServOrderRec, TmpPlantMgtCompRec."Plant Company");
              IF lvPlantLocCode <> '' THEN BEGIN
                NoCreated := NoCreated + 1;
                PlantMgtCompRec."Plant Company" := TmpPlantMgtCompRec."Plant Company";
              END;
            UNTIL TmpPlantMgtCompRec. NEXT = 0;
          END;
        END;
      END;

      IF NoCreated > 0 THEN BEGIN
        IF NoCreated = 1 THEN
          MESSAGE(lvText11012003, lvPlantLocCode, PlantMgtCompRec."Plant Company")
        ELSE
          MESSAGE(lvText11012004, lvPlantLocCode, NoCreated);
      END;
    END;

    PROCEDURE CreatePlantLocation@1100525016(VAR IServOrderRec@1100485000 : Record 11012823;IPlantCompany@1100485010 : Text[30]) : Code[20];
    VAR
      lvServSetupRec@1100525000 : Record 11012800;
      lvPlantSetupRec@1100485004 : Record 11012550;
      CompanyData@1100485006 : Record 11020674;
      lvCustRec@1100485003 : Record 18;
      lvPlantLocRec@1100485001 : Record 11012554;
      lvPlantLocRec2@1100485002 : Record 11012554;
      lvText11012001@1100529000 : TextConst 'ENU=must be present/filled (via field ''%1'' of %2  in plant company ''%3'')';
      lvText11012003@1100485009 : TextConst 'ENU=Plant Location ''%1'' is already present in Company ''%2'', with Service Order ''%3'' and Company Name ''%4''.;NOR=Maskinlokasjon ''%1'' finnes allerede i firma ''%2'', med Serviceordre ''%3'' og Selskapsnavn ''%4''.;SVE=Maskinplats ''%1'' finns redan i fretag ''%2'', med serviceorder ''%3'' och fretagsnamn ''%4''.';
      lvDimValRec@1100525001 : Record 349;
      Employee@1100528600 : Record 5200;
      CompanyPlantLocNoSeries@1100529002 : Record 11229940;
      NoSeriesMgt@1100529001 : Codeunit 396;
      SalespersonPurchaser@1100528500 : Record 13;
    BEGIN
      //**4PS  (Copied from the function 'CreatePlantLocation' in T11072003/T5200)
      //* From a service order in the 'Service Company' create a plant location in the 'Plant Company' this
      //* can be another company, so do not use 'VALIDATE'/'INSERT/MODIFY(TRUE)' on the Plant Location table!

      WITH IServOrderRec DO BEGIN
        TESTFIELD("No.");
        lvServSetupRec.GET;
        lvServSetupRec.TESTFIELD("Build Plant Location Code from");

        IF NOT CompanyData.GET(CURRENTCOMPANY) THEN  //* Current company, so not the Plant company
          CompanyData."Company Name" := CURRENTCOMPANY;

        IF (CompanyData."Company No." = '') AND
           (lvServSetupRec."Build Plant Location Code from" = lvServSetupRec."Build Plant Location Code from"::CompNoServNo)
        THEN
          CompanyData.TESTFIELD("Company No.");
        IF lvServSetupRec."Build Plant Location Code from" = lvServSetupRec."Build Plant Location Code from"::NoSeries THEN BEGIN
          CompanyPlantLocNoSeries.CHANGECOMPANY(IPlantCompany);
          IF NOT CompanyPlantLocNoSeries.GET(CURRENTCOMPANY) THEN BEGIN
            CompanyPlantLocNoSeries.INIT;
            CompanyPlantLocNoSeries."Company Name" := CURRENTCOMPANY;
          END;
          IF CompanyPlantLocNoSeries."Plant Location Nos. Srv.Orders" = '' THEN
            CompanyPlantLocNoSeries.FIELDERROR("Plant Location Nos. Srv.Orders",
              STRSUBSTNO(lvText11012001, lvPlantSetupRec.FIELDCAPTION("Plant Location Nos."), lvPlantSetupRec.TABLECAPTION, IPlantCompany));
        END;

        lvPlantSetupRec.CHANGECOMPANY(IPlantCompany);
        lvPlantSetupRec.GET;

        lvPlantLocRec2.CHANGECOMPANY(IPlantCompany);

        lvPlantLocRec.CHANGECOMPANY(IPlantCompany);
        lvPlantLocRec.INIT;
        lvPlantLocRec.InitRecord;
        CASE lvServSetupRec."Build Plant Location Code from" OF
          lvServSetupRec."Build Plant Location Code from"::ServNo:
            lvPlantLocRec.Code := "No.";
          lvServSetupRec."Build Plant Location Code from"::CompNoServNo:
            lvPlantLocRec.Code := CompanyData."Company No." + "No.";
          lvServSetupRec."Build Plant Location Code from"::NoSeries:
            BEGIN
              IF IPlantCompany <> COMPANYNAME THEN
                NoSeriesMgt.SetFromOtherCompany(IPlantCompany);
              lvPlantLocRec.Code := NoSeriesMgt.GetNextNo(CompanyPlantLocNoSeries."Plant Location Nos. Srv.Orders", 0D, TRUE);
              lvPlantLocRec."No. Series" := CompanyPlantLocNoSeries."Plant Location Nos. Srv.Orders";
            END;
          ELSE
            lvPlantLocRec.Code := '';
        END;
        lvPlantLocRec.TESTFIELD(Code);
        IF lvPlantLocRec2.GET(lvPlantLocRec.Code) THEN
          ERROR(lvText11012003, lvPlantLocRec.Code, IPlantCompany, lvPlantLocRec2."Service Order No.", lvPlantLocRec2."Company Name");

        lvPlantLocRec."Creation Date" := TODAY;
        lvPlantLocRec.Depot :=  FALSE;
        lvPlantLocRec."Service Order No." :=  "No.";
        IF IPlantCompany <> CURRENTCOMPANY THEN BEGIN
          lvPlantLocRec."Company Name" := CURRENTCOMPANY;
          //
          //* CustomerNo may only be filled (mandatory with that of the company table) if SO and Plant Location
          //* in different companies. If the companies are the same then Coustomer must be empty.
          CompanyData.TESTFIELD("Customer No.");
          lvCustRec.CHANGECOMPANY(IPlantCompany);
          IF NOT lvCustRec.GET(CompanyData."Customer No.") THEN
            lvCustRec.INIT;
          lvPlantLocRec."Customer No." := CompanyData."Customer No.";
          lvPlantLocRec."VAT Bus. Posting Group" := lvCustRec."VAT Bus. Posting Group";
          lvPlantLocRec."Gen. Bus. Posting Group" := lvPlantSetupRec."Default Gen. Bus.Posting Group";
          IF lvPlantSetupRec."Def. Loc. Bus. P.Grp of Cust." THEN
            lvPlantLocRec."Gen. Bus. Posting Group" := lvCustRec."Gen. Bus. Posting Group";
        END;
        //mg.sn, 09-03-11: M25508
        IF lvPlantLocRec."Customer No." = '' THEN BEGIN
          lvPlantLocRec."Gen. Bus. Posting Group" := lvPlantSetupRec."Default Gen. Bus.Posting Group";
          lvPlantLocRec."VAT Bus. Posting Group" := lvPlantSetupRec."Default VAT Bus.Posting Group";
        END;
        //mg.en, 09-03-11: M25508
        lvPlantLocRec.Description :=  Description;
        lvPlantLocRec."Search Name" := Description;
        lvPlantLocRec.Address := Address;
        lvPlantLocRec."Address 2" := "Address 2";
        lvPlantLocRec.City := City;
        lvPlantLocRec."Post Code" := "Post Code";
        IF SalespersonPurchaser.GET("Order Manager") THEN BEGIN
          lvPlantLocRec."Contact Phone No." := SalespersonPurchaser."Phone No.";
          lvPlantLocRec."E-Mail" := SalespersonPurchaser."E-Mail";
          lvPlantLocRec.Contact := SalespersonPurchaser.Name;
        END ELSE BEGIN
          lvPlantLocRec.Contact := "Contact Name";
          IF "Assigned to" <> '' THEN
            IF Employee.GET("Assigned to") THEN
              lvPlantLocRec."E-Mail" := Employee."Company E-Mail";
        END;
        lvPlantLocRec."Phone No." := "Phone No.";
        lvPlantLocRec."Fax No." := "Fax No.";
        lvPlantLocRec."Territory Code" := "Territory Code";
        lvPlantLocRec."Starting Date" := "Starting Date";
        lvPlantLocRec."Ending Date" := "Ending Date";
        IF "Global Dimension 1 Code" <> '' THEN BEGIN  //*24614.sn
          IF IPlantCompany = CURRENTCOMPANY THEN
            lvPlantLocRec."Department Code" := "Global Dimension 1 Code"
          ELSE BEGIN
            lvDimValRec.CHANGECOMPANY(IPlantCompany);
            lvDimValRec.SETCURRENTKEY(Code, "Global Dimension No.");
            lvDimValRec.SETRANGE(Code, "Global Dimension 1 Code");
            lvDimValRec.SETRANGE("Global Dimension No.", 1);
            IF lvDimValRec.FINDFIRST THEN
              lvPlantLocRec."Department Code" := "Global Dimension 1 Code";
          END;
        END;                                           //*24614.en
        lvPlantLocRec.NormalizePostCodeHouseNo;//DP00195
        lvPlantLocRec.FillDefaultFromDepotPlantNeed;
        lvPlantLocRec.INSERT;

        EXIT(lvPlantLocRec.Code);
      END;
    END;

    PROCEDURE DisplayMap@1100525017();
    VAR
      MapPoint@1001 : Record 800;
      MapMgt@1000 : Codeunit 802;
    BEGIN
      IF MapPoint.FIND('-') THEN
        MapMgt.MakeSelection(DATABASE::"Service Order",GETPOSITION)
      ELSE
        MESSAGE(Text023);
    END;

    PROCEDURE CheckPlanDateTime@1100525020();
    BEGIN
      //db, 17-03-10: M18520
       IF ("Starting Date" = "Ending Date") THEN
        IF ("Starting Time" <> 0T) AND ("Ending Time" <> 0T) THEN
          IF ("Starting Time" > "Ending Time") THEN
            FIELDERROR("Starting Time",STRSUBSTNO(Text000,FIELDCAPTION("Ending Time")));
    END;

    PROCEDURE CheckPlanLimitDateTime@1100525021();
    BEGIN
      //db, 19-03-10: M18520
       IF ("First Possible Starting Date" = "Last Possible Ending Date") THEN
        IF ("First Possible Starting Time" <> 0T) AND ("Last Possible Ending Time" <> 0T) THEN
          IF ("First Possible Starting Time" > "Last Possible Ending Time") THEN
            FIELDERROR("First Possible Starting Time",STRSUBSTNO(Text000,FIELDCAPTION("Last Possible Ending Time")));
    END;

    PROCEDURE CheckFirmPlannedPlanDates@1100528738();
    VAR
      FirstPossibleStartingDateTime@1100528601 : DateTime;
      LastPossibleEndingDateTime@1100528603 : DateTime;
      StartingDateTime@1100528602 : DateTime;
      EndingDateTime@1100528604 : DateTime;
    BEGIN
      IF NOT "Firm Planned" THEN
        EXIT;
      IF ("First Possible Starting Date" <> 0D) OR ("Last Possible Ending Date" <> 0D) THEN BEGIN
        FirstPossibleStartingDateTime := CREATEDATETIME("First Possible Starting Date", "First Possible Starting Time");
        StartingDateTime := CREATEDATETIME("Starting Date", "Starting Time");
        IF StartingDateTime < FirstPossibleStartingDateTime THEN
          IF "Starting Date" <> "First Possible Starting Date" THEN
            FIELDERROR("First Possible Starting Date", STRSUBSTNO(Text000, FIELDCAPTION("Starting Date")))
          ELSE
            FIELDERROR("First Possible Starting Time", STRSUBSTNO(Text000, FIELDCAPTION("Starting Time")));

        IF "Last Possible Ending Time" <> 0T THEN
          LastPossibleEndingDateTime := CREATEDATETIME("Last Possible Ending Date", "Last Possible Ending Time")
        ELSE
          LastPossibleEndingDateTime := CREATEDATETIME("Last Possible Ending Date", 235959.999T);
        EndingDateTime := CREATEDATETIME("Ending Date", "Ending Time");

        IF StartingDateTime > LastPossibleEndingDateTime THEN
          IF "Starting Date" <> "Last Possible Ending Date" THEN
            FIELDERROR("Starting Date", STRSUBSTNO(Text000, FIELDCAPTION("Last Possible Ending Date")))
          ELSE
            FIELDERROR("Starting Time", STRSUBSTNO(Text000, FIELDCAPTION("Last Possible Ending Time")));

        IF ("Starting Date" <> 0D) AND (("Starting Date" < "First Possible Starting Date") OR ("Starting Date" > "Last Possible Ending Date")) THEN
          FIELDERROR("Starting Date", STRSUBSTNO(Text008, FIELDCAPTION("First Possible Starting Date"), FIELDCAPTION("Last Possible Ending Date")));
        IF ("Ending Date" <> 0D) AND (("Ending Date" < "First Possible Starting Date") OR ("Ending Date" > "Last Possible Ending Date")) THEN
          FIELDERROR("Ending Date", STRSUBSTNO(Text008, FIELDCAPTION("First Possible Starting Date"), FIELDCAPTION("Last Possible Ending Date")));

        IF EndingDateTime > LastPossibleEndingDateTime THEN
          IF "Ending Date" <> "Last Possible Ending Date" THEN
            FIELDERROR("Ending Date", STRSUBSTNO(Text000, FIELDCAPTION("Last Possible Ending Date")))
          ELSE
            FIELDERROR("Ending Time", STRSUBSTNO(Text000, FIELDCAPTION("Last Possible Ending Time")));
      END ELSE BEGIN
        IF ((xRec."Starting Date" <> 0D) AND (xRec."Starting Date" <> "Starting Date")) OR
           ((xRec."Ending Date" <> 0D) AND (xRec."Ending Date" <> "Ending Date")) OR
           ((xRec."Starting Time" <> 0T) AND (xRec."Starting Time" <> "Starting Time")) OR
           ((xRec."Ending Time" <> 0T) AND (xRec."Ending Time" <> "Ending Time"))
        THEN
          ERROR(Text116, "No.");
      END;
    END;

    PROCEDURE BuildRelationalStructure@1100525022(Action@1100525000 : Text[30]);
    VAR
      RelationalStructureMgt@1100525001 : Codeunit 11012238;
    BEGIN
      RelationalStructureMgt.BuildFromServOrder(Rec, xRec, Action);
    END;

    PROCEDURE CopyDefaultDimFromContract@1100525023();
    BEGIN
      IF "No." = '' THEN EXIT;  //db, 12-12-11: M28816

      DimMgt.DeleteDefaultDim(DATABASE::"Service Order", "No.");
      DimMgt.CopyDefaultDim(
        DATABASE::"Service-Contract", "Service Contract No.",
        DATABASE::"Service Order", "No.");

      UpdateServAnalysisNotGlobDims;
    END;

    PROCEDURE UpdateServAnalysisNotGlobDims@1100528616();
    BEGIN
      IF "No." = '' THEN
        EXIT;

      IF Problem <> '' THEN
        DimMgt.UpdateAnalysisDimNotGlobal(AnalysisType::Problem, Problem, DATABASE::"Service Order", "No.");
    END;

    PROCEDURE CheckContractStatus@1100525024(ServContrRec@1100525001 : Record 11012812);
    VAR
      ServiceContract@1100528700 : Record 11012812;
      OrderDate@1100525000 : Date;
    BEGIN
      //db, 10-06-10: M19644, M19645
      ServContrRec.TESTFIELD(Blocked, FALSE);
      IF ServContrRec.Status < ServContrRec.Status::Order THEN BEGIN
        ServiceContract.Status := ServiceContract.Status::Order;
        ERROR(Text003, ServContrRec.TABLECAPTION, ServContrRec."No.", ServContrRec.FIELDCAPTION(Status), ServiceContract.Status);
      END;
      IF "Order Date" = 0D THEN
        OrderDate:= WORKDATE
      ELSE
        OrderDate := "Order Date";
      IF ("Source Type" = "Source Type"::Call) OR (CurrFieldNo <> 0) THEN BEGIN //M21841
        IF OrderDate < ServContrRec."Starting Date" THEN
          MESSAGE(Text004a, ServContrRec."No.", ServContrRec."Starting Date", FIELDCAPTION("Order Date"));
        IF OrderDate > ServContrRec."Ending Date" THEN
          IF ServContrRec."Expiring Date" < ServContrRec."Ending Date" THEN  //db, 15-02-11:M25682
            MESSAGE(Text004b, ServContrRec."No.", ServContrRec."Ending Date", FIELDCAPTION("Order Date"));
      END;
      IF ServContrRec."Expiring Date" <> 0D THEN BEGIN
        IF ServContrRec."Expiring Date" < OrderDate THEN
          ERROR(Text004, ServContrRec."No.", ServContrRec."Expiring Date");
        //IF ServContrRec."Ending Date" >= ServContrRec."Expiring Date" THEN
        // MESSAGE(Text004, ServContrRec."No.", ServContrRec."Expiring Date");  //db, 30-12-10: M21843
      END;
    END;

    PROCEDURE GetSignature@1100525025(VAR SignatureRec@1100525001 : Record 11020349;ShowPicture@1100525000 : Boolean);
    BEGIN
      //db, 21-05-10: M19537
      IF "No." <> '' THEN BEGIN
        IF NOT SignatureRec.GET("No.") THEN BEGIN
          CLEAR(SignatureRec.Signature);
        END ELSE BEGIN
          IF FORMAT(SignatureRec.Signature) <> '' THEN
            IF ShowPicture THEN
              SignatureRec.CALCFIELDS(Signature);
        END;
      END;
    END;

    PROCEDURE HasSignature@1100526000() : Boolean;
    VAR
      SignatureRec@1100526000 : Record 11020349;
    BEGIN
      IF "No." = '' THEN
        EXIT(FALSE);

      IF SignatureRec.GET("No.") THEN
          EXIT(SignatureRec.Signature.COUNT > 0);

      EXIT(FALSE);
    END;

    PROCEDURE DPA_SetDefaultDpmtFromNoSeries@1100000995(xRecRef@1100525002 : RecordRef);
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      xRecRef.SETTABLE(xRec);
      DPA_Management.SetDepartmentCodeNoSeries(
        TABLENAME,
        "Global Dimension 1 Code",
        "No. Series",
        xRec."No. Series" );
    END;

    LOCAL PROCEDURE DPA_OnInsert@1100000991();
    VAR
      Dimension1Code@1100528400 : Code[20];
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      Dimension1Code :=
        DPA_Management.GetNoSeriesDepartmentCode(
          "No. Series",
          xRec."No. Series",
          DATABASE::"Service Order");
      IF Dimension1Code <> '' THEN
        "Global Dimension 1 Code" := Dimension1Code;

      IF "Global Dimension 1 Code" <> '' THEN
        VALIDATE("Global Dimension 1 Code");
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Department Filter"));
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012823) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012823');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Service Order", "Global Dimension 1 Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Global Dimension 1 Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Global Dimension 1 Code");
    END;

    PROCEDURE DPA_SetFiltersForResource@1100525049(Context@1100525000 : Text[30];ResourceNo@1100525001 : Code[20]) : Boolean;
    VAR
      Resource@1100525002 : Record 11229278;
      UserSetup@1100525003 : Record 91;
    BEGIN
      //**4PS
      Resource.SETRANGE("No.", ResourceNo);
      Resource.SETRANGE(Type, Resource.Type::Employee);
      Resource.SETRANGE(Company, COMPANYNAME);
      IF Resource.FINDFIRST THEN BEGIN
        UserSetup.SETRANGE("Employee No.", Resource."Source No.");
        IF UserSetup.FINDFIRST THEN
          DPA_Management.SetUserWSEmployee(UserSetup."User ID");
      END;

      EXIT(DPA_SetFilters(Context));
    END;

    PROCEDURE CheckPlanPeriod@1100525031();
    VAR
      DateTimeNotification1@1100527300 : Notification;
      DateTimeNotification2@1100527350 : Notification;
    BEGIN
      //db, 04-10-10: M23012
      DateTimeNotification1.ID := '00000000-0000-0000-0000-000000000001';
      DateTimeNotification2.ID := '00000000-0000-0000-0000-000000000002';

      IF ("Starting Date" = 0D) AND ("Ending Date" = 0D) THEN BEGIN
        DateTimeNotification1.RECALL;
        DateTimeNotification2.RECALL;
      END;

      IF (("Starting Date" < "First Possible Starting Date") AND ("Starting Date" <> 0D) AND ("First Possible Starting Date" <> 0D)) OR
         (("Starting Date" > "Last Possible Ending Date") AND ("Starting Date" <> 0D) AND ("Last Possible Ending Date" <> 0D)) THEN
        DateTimeNotification1.MESSAGE(FIELDCAPTION("Starting Date") + ' ' + STRSUBSTNO(Text008, FIELDCAPTION("First Possible Starting Date"), FIELDCAPTION("Last Possible Ending Date")))
      ELSE BEGIN
        IF ("Starting Date" = "First Possible Starting Date") AND ("Starting Time" < "First Possible Starting Time") AND
           ("Starting Time" <> 0T) AND ("First Possible Starting Time" <> 0T) THEN
          DateTimeNotification1.MESSAGE(FIELDCAPTION("Starting Time") + ' ' + STRSUBSTNO(Text134, FIELDCAPTION("First Possible Starting Time")))
        ELSE
          DateTimeNotification1.RECALL;
      END;

      IF DateTimeNotification1.MESSAGE <> '' THEN
        DateTimeNotification1.SEND;

      IF (("Ending Date" > "Last Possible Ending Date") AND ("Last Possible Ending Date" <> 0D) AND ("Ending Date" <> 0D)) OR
         (("Ending Date" < "First Possible Starting Date") AND ("Ending Date" <> 0D) AND ("First Possible Starting Date" <> 0D)) THEN
        DateTimeNotification2.MESSAGE(FIELDCAPTION("Ending Date") + ' ' + STRSUBSTNO(Text008, FIELDCAPTION("First Possible Starting Date"), FIELDCAPTION("Last Possible Ending Date")))
      ELSE BEGIN
        IF ("Ending Date" = "Last Possible Ending Date") AND ("Ending Time" > "Last Possible Ending Time") AND ("Last Possible Ending Time" <> 0T) AND ("Ending Time" <> 0T) THEN
          DateTimeNotification2.MESSAGE(FIELDCAPTION("Ending Time") + ' ' + STRSUBSTNO(Text000, FIELDCAPTION("Last Possible Ending Time")))
        ELSE
          DateTimeNotification2.RECALL;
      END;

      IF DateTimeNotification2.MESSAGE <> '' THEN
        DateTimeNotification2.SEND;
    END;

    PROCEDURE UpdateCostPlus@1100525032(CalledBy@1100525001 : Integer);
    VAR
      CostPlusRec@1100525000 : Record 11012825;
      JobsSetup@1100528601 : Record 315;
      PurchInvLine@1100528500 : Record 123;
    BEGIN
      //db, 08-12-10: M23704
      //IF MODIFY THEN;  //db, 26-05-11: M27720, due calcfields(Service Contract No.) in GetBasicPrice

      CostPlusRec.SETRANGE("Service Order No.", "No.");
      CostPlusRec.SETRANGE(Invoiced, FALSE);
      CostPlusRec.MODIFYALL("Customer No.", "Customer No.", FALSE);
      CostPlusRec.MODIFYALL("Service Location No.", "Service Location No.", FALSE);
      //CostPlusRec.SETFILTER("Installment No.", '%1', '');  //db, 25-05-11: M26461 //mg.o, 09-02-12: M32859
      CASE CalledBy OF
        FIELDNO("Bill-to Customer No."):
          CostPlusRec.SETRANGE("Bill-to Customer No.", xRec."Bill-to Customer No.");
        FIELDNO("Alternative Bill-to Address"):
          BEGIN
            CostPlusRec.SETRANGE("Bill-to Customer No.", "Bill-to Customer No.");
            CostPlusRec.SETRANGE("Alternative Bill-to Address", xRec."Alternative Bill-to Address");
          END;
      ELSE
        CostPlusRec.SETRANGE("Bill-to Customer No.", "Bill-to Customer No.");
        CostPlusRec.SETRANGE("Alternative Bill-to Address", "Alternative Bill-to Address");
      END;

      IF MODIFY THEN;  //db, 26-05-11: M27720, due calcfields(Service Contract No.) in GetBasicPrice
      IF NOT CostPlusRec.ISEMPTY THEN BEGIN
        IF CostPlusRec.FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            IF CostPlusRec."Bill-to Customer No." <> "Bill-to Customer No." THEN
              CostPlusRec.VALIDATE("Bill-to Customer No.", "Bill-to Customer No.");
            IF CostPlusRec."Alternative Bill-to Address" <> "Alternative Bill-to Address" THEN
              CostPlusRec.VALIDATE("Alternative Bill-to Address", "Alternative Bill-to Address");
            IF CalledBy <> FIELDNO("Alternative Bill-to Address") THEN
              CostPlusRec."VAT Prod. Posting Group":= "VAT Prod. Posting Group";
            IF (CalledBy = FIELDNO("Customer No.")) OR (CalledBy = FIELDNO("Bill-to Customer No.")) THEN BEGIN
              IF CostPlusRec."Installment No." = '' THEN BEGIN //mg, 09-02-12: M32843
                IF (CostPlusRec."Basic Price Found at" <> Text104) AND  //mg, 09-02-12: M32859
                   (CostPlusRec."Basic Price Found at" <> PurchInvLine.TABLECAPTION) THEN
                BEGIN
                  //db.sn, 26-05-11: M27720
                  IF CostPlusRec.CheckItemLine THEN BEGIN  //db, 24-06-14: C009380
                    CostPlusRec.FindSalesPrice;
                  END ELSE BEGIN
                    CostPlusRec.SetValidateHourRateCode(TRUE);
                    CostPlusRec.GetBasicPrice;
                  END;
                  //db.en, 26-05-11: M27720
                END;
              END;
            END;
            CostPlusRec.MODIFY;
          UNTIL CostPlusRec.NEXT = 0;
        END;
      END;

      JobsSetup.GET;
      IF NOT JobsSetup.IsFSAActive THEN BEGIN
        IF CalledBy = FIELDNO("Service Contract No.") THEN BEGIN
          CostPlusRec."Service Order No." := "No.";
          CostPlusRec.GetExtraCostLinesByContract();
        END;
      END;
    END;

    PROCEDURE GetTryOut@1210190010(iAction@1210190000 : Integer) Result : Text[30];
    VAR
      TryOutRelationRec@1210190001 : Record 11012761;
    BEGIN
      //db, 05-05-11
      IF FPSLicenseManagement.LicenseAndReadPermissionForTable(TryOutRelationRec) THEN
        Result := TryOutRelationRec.GetTryOut('', '', '', '', "No.", '', '', '', iAction);

      EXIT(Result);
    END;

    PROCEDURE ShowTryOut@1210190008(iAction@1210190000 : Integer);
    VAR
      TryOutRelationRec@1210190001 : Record 11012761;
    BEGIN
      //db, 05-05-11
      TryOutRelationRec.ShowTryOut('', '', '', '', "No.", '', '', '', iAction);
    END;

    PROCEDURE CheckInternalCharge@1210190014();
    VAR
      ServOrderRec@1210190000 : Record 11012823;
    BEGIN
      //db, 20-05-11
      IF NOT ServOrderRec.GET("No.") THEN
        EXIT;
      ServOrderExtension.GetServOrderExtension("No.");  //db, 22-04-13: C007214

      IF NOT ServContrRec.GET("Service Contract No.") THEN
        ServContrRec.INIT;
      IF ServContrRec."Internal Contract" THEN BEGIN
        IF ServLocRec.GET("Service Location No.") THEN
          IF ServLocRec."Project No." <> '' THEN BEGIN
            ServOrderExtension."Master Company" := ServLocRec."Supplying Company";
            ServOrderExtension."Master Project" := ServLocRec."Project No.";
            ServOrderExtension."Master Element" := '';
          END;
      END ELSE BEGIN
        ServOrderExtension."Master Company" := '';
        ServOrderExtension."Master Project" := '';
        ServOrderExtension."Master Element" := '';
      END;

      ServOrderExtension.UpdateServOrderExtension("No.");  //db, 22-04-13: C007214
    END;

    PROCEDURE CheckSendReport@1210190018();
    VAR
      ServMailRec@1210190000 : Record 11071711;
    BEGIN
      //db, 21-06-11: M26634
      "Send Report" := FALSE;

      IF NOT ServContrRec.GET("Service Contract No.") THEN ServContrRec.INIT;
      IF NOT ServContrRec."Send Mail/Save Work Sheet" THEN EXIT;

      ServMailRec.SETRANGE("Service Contract No.", "Service Contract No.");
      ServMailRec.SETRANGE("Source Type", "Source Type");
      ServMailRec.SETRANGE("Source E-Mail", ServMailRec."Source E-Mail"::OrderSigner);
      IF ServMailRec.FINDSET THEN
        "Send Report" := ServMailRec."Mail Work Sheet";
    END;

    PROCEDURE FillExecServiceContractData@1100528400(PrincipalCompanyName@1100528402 : Text[30];ServContrNoPrincComp@1100528403 : Code[20]);
    VAR
      ExecutingServiceContract@1100528400 : Record 11071725;
      ServiceContract@1100528401 : Record 11012812;
    BEGIN
      IF "Service Contract No." = '' THEN BEGIN
        ExecutingServiceContract.GET(PrincipalCompanyName, ServContrNoPrincComp);
        ServiceContract.GET(ExecutingServiceContract."Serv. Contr. No. Exec. Comp.");
        VALIDATE("Service Contract No.", ExecutingServiceContract."Serv. Contr. No. Exec. Comp."); //kkleermaker, 110815, M27956
        "Customer No." := ServiceContract."Customer No.";
      END;
    END;

    PROCEDURE GetSolutionTextFromExecCompany@1100528401();
    VAR
      ServiceText@1100528403 : Record 11012882;
      WebServiceMgt@1100528400 : Codeunit 11012266;
      NoOfProblemLines@1100528401 : Integer;
      I@1100528402 : Integer;
      XPath@1100528404 : Text[1024];
    BEGIN
      GetDataFromExecCompany('Description', WebServiceMgt);

      ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Order");
      ServiceText.SETRANGE("No.", "No.");
      ServiceText.SETRANGE("Table Field", 92);  //DP00106: FIELDNO("Solution Text")
      ServiceText.DELETEALL;

      NoOfProblemLines := WebServiceMgt.GetResponseValueCount('.//so:Solution_Text_Line_SVCNET');
      FOR I := 1 TO NoOfProblemLines DO BEGIN
        ServiceText."Table Name" := ServiceText."Table Name"::"Service Order";
        ServiceText."No." := "No.";
        ServiceText."Table Field" := 92;  //DP00106: FIELDNO("Solution Text");
        ServiceText."Line No." := GetFirstFreeServiceTextLineNo(
          ServiceText."Table Name",
          ServiceText."No.",
          ServiceText."Table Field");
        XPath := STRSUBSTNO('.//so:Solution_Text_Line_SVCNET[%1]/so:Date', I);
        ServiceText.Date := WebServiceMgt.GetResponseValueDate(XPath, FALSE);
        XPath := STRSUBSTNO('.//so:Solution_Text_Line_SVCNET[%1]/so:Code', I);
        ServiceText.Code := WebServiceMgt.GetResponseValueText(XPath, FALSE);
        XPath := STRSUBSTNO('.//so:Solution_Text_Line_SVCNET[%1]/so:Comment', I);
        ServiceText.Comment := WebServiceMgt.GetResponseValueText(XPath, FALSE);
        ServiceText.INSERT(TRUE);
      END;
    END;

    LOCAL PROCEDURE GetFirstFreeServiceTextLineNo@1100528407(TableName@1100528400 : Integer;No@1100528401 : Code[20];TableFieldNo@1100528402 : Integer) : Integer;
    VAR
      ServiceText@1100528403 : Record 11012882;
    BEGIN
      ServiceText.SETRANGE("Table Name", TableName);
      ServiceText.SETRANGE("No.", No);
      ServiceText.SETRANGE("Table Field", TableFieldNo);
      IF ServiceText.FINDLAST THEN
        EXIT(ServiceText."Line No." + 10000)
      ELSE
        EXIT(10000);
    END;

    PROCEDURE GetActRefPointFromExecCompany@1100528403();
    VAR
      ServiceOrderExtension@1100525000 : Record 11071727;
      WebServiceMgt@1100528401 : Codeunit 11012266;
    BEGIN
      ServiceOrderExtension.GetServOrderExtension("No.");
      EVALUATE(
        ServiceOrderExtension."Act. Ref. Point Exec. Company",
        GetDataFromExecCompany('Actual_Reference_Point', WebServiceMgt));
      ServiceOrderExtension.UpdateServOrderExtension("No.");
    END;

    LOCAL PROCEDURE GetDataFromExecCompany@1100528404(TagName@1100528403 : Text[50];VAR WebServiceMgt@1100528405 : Codeunit 11012266) : Text[250];
    VAR
      WebServiceURL@1100528401 : Record 11020659;
      Namespaces@1100528402 : ARRAY [10,2] OF Text[100];
      ServiceOrderExtension@1100528404 : Record 11071727;
    BEGIN
      ServiceOrderExtension.GetServOrderExtension("No.");
      ServiceOrderExtension.TESTFIELD("Executing Company Name");
      ServiceOrderExtension.TESTFIELD("Order No. Executing Company");
      GetServiceOrderWebServiceURL(WebServiceURL);
      WebServiceMgt.PrepareSOAPRequest(WebServiceURL."Target Namespace", 'Read');
      WebServiceMgt.AppendSOAPParameter(
        WebServiceURL."Target Namespace",
        'No',
        ServiceOrderExtension."Order No. Executing Company");
      WebServiceMgt.SendSOAPRequest2('Read', WebServiceURL.URL, WebServiceURL.Login, WebServiceURL.Password, TRUE);
      Namespaces[1, 1] := 'so';
      Namespaces[1, 2] := WebServiceURL."Target Namespace";
      WebServiceMgt.AddResponseSelectionNamespaces(Namespaces);
      EXIT(WebServiceMgt.GetResponseValueText('.//so:' + TagName, FALSE));
    END;

    LOCAL PROCEDURE GetServiceOrderWebServiceURL@1100528402(VAR WebServiceURL@1100528403 : Record 11020659);
    VAR
      ServiceOrderExtension@1100528400 : Record 11071727;
    BEGIN
      ServiceOrderExtension.GetServOrderExtension("No.");
      ServiceOrderExtension.TESTFIELD("Executing Company Name");
      WebServiceURL.SETRANGE(Type, WebServiceURL.Type::"Service Network");
      WebServiceURL.SETRANGE("Company Name", ServiceOrderExtension."Executing Company Name");
      IF WebServiceURL.COUNT = 0 THEN
        ERROR(
          Text036,
          WebServiceURL.TABLECAPTION,
          WebServiceURL.FIELDCAPTION("Company Name"),
          ServiceOrderExtension."Executing Company Name");
      IF WebServiceURL.COUNT > 1 THEN
        ERROR(
          Text037,
          WebServiceURL.TABLECAPTION,
          WebServiceURL.FIELDCAPTION("Company Name"),
          ServiceOrderExtension."Executing Company Name");
      WebServiceURL.FINDFIRST;
    END;

    LOCAL PROCEDURE UpdateVessel@1210190019();
    VAR
      Vessel@1210190000 : Record 11071737;
      ServiceOrderExtension@1210190001 : Record 11071727;
    BEGIN
      //kkleermaker, 110817, M28697
      IF "Service Location No." <> xRec."Service Location No." THEN
        IF Vessel.GET("Service Location No.") THEN BEGIN
          "Vessel No." := Vessel."No.";
          IF NOT ServiceOrderExtension.GET("No.") THEN
            ServiceOrderExtension.INIT;
          ServiceOrderExtension."Vessel Name" := Vessel.Name;
          ServiceOrderExtension.UpdateServOrderExtension("No.");
        END ELSE BEGIN
          "Vessel No." := '';
          IF ServiceOrderExtension.GET("No.") THEN BEGIN
            ServiceOrderExtension."Vessel Name" := '';
            ServiceOrderExtension.UpdateServOrderExtension("No.");
          END;
        END
    END;

    PROCEDURE GetOpenPurchaseBaseOrder@1210190021() : Decimal;
    VAR
      PurchaseOrderControlLine@1210190000 : Record 11020221;
    BEGIN
      //mg, 19-09-11: M28500
      PurchaseOrderControlLine.SETCURRENTKEY("Base Service Order No.");
      PurchaseOrderControlLine.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        PurchaseOrderControlLine.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        PurchaseOrderControlLine.SETFILTER(Date, GETFILTER("Period Filter"));
      PurchaseOrderControlLine.CALCSUMS("Outstanding Amount");
      EXIT(PurchaseOrderControlLine."Outstanding Amount");
    END;

    PROCEDURE GetReceivedNotInvBaseOrder@1210190022() : Decimal;
    VAR
      PurchaseOrderControlLine@1210190000 : Record 11020221;
    BEGIN
      //mg, 19-09-11: M28500
      PurchaseOrderControlLine.SETCURRENTKEY("Base Service Order No.");
      PurchaseOrderControlLine.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        PurchaseOrderControlLine.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        PurchaseOrderControlLine.SETFILTER(Date, GETFILTER("Period Filter"));
      PurchaseOrderControlLine.CALCSUMS("Amt. Rcd. Not Invoiced");
      EXIT(PurchaseOrderControlLine."Amt. Rcd. Not Invoiced");
    END;

    PROCEDURE GetOpenInventoryBaseOrder@1210190023() : Decimal;
    VAR
      ItemJournalLine@1210190000 : Record 83;
    BEGIN
      //mg, 19-09-11: M28500
      ItemJournalLine.SETCURRENTKEY("Base Service Order No.");
      ItemJournalLine.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        ItemJournalLine.SETRANGE("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        ItemJournalLine.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      ItemJournalLine.CALCSUMS(Amount);
      EXIT(ItemJournalLine.Amount);
    END;

    PROCEDURE GetOpenHoursBaseOrder@1210190024() : Decimal;
    VAR
      HourAccountingLine@1210190000 : Record 11012039;
    BEGIN
      //mg, 19-09-11: M28500
      HourAccountingLine.SETCURRENTKEY("Base Service Order No.");
      HourAccountingLine.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        HourAccountingLine.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        HourAccountingLine.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      HourAccountingLine.CALCSUMS("Total Line");
      EXIT(HourAccountingLine."Total Line");
    END;

    PROCEDURE GetOpenAmountHoursBaseOrder@1210190025() : Decimal;
    VAR
      HourAccountingLine@1210190000 : Record 11012039;
    BEGIN
      //mg, 19-09-11: M28500
      HourAccountingLine.SETCURRENTKEY("Base Service Order No.");
      HourAccountingLine.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        HourAccountingLine.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        HourAccountingLine.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      HourAccountingLine.CALCSUMS("Amount (LCY)");
      EXIT(HourAccountingLine."Amount (LCY)");
    END;

    PROCEDURE GetActualCostsBaseOrder@1210190026() : Decimal;
    VAR
      ServiceLedgerEntry@1210190000 : Record 11012819;
    BEGIN
      //mg, 19-09-11: M28500
      ServiceLedgerEntry.SETCURRENTKEY("Base Service Order No.");
      ServiceLedgerEntry.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        ServiceLedgerEntry.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        ServiceLedgerEntry.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      ServiceLedgerEntry.SETRANGE("Cost Present", TRUE);
      ServiceLedgerEntry.CALCSUMS("Total Cost (LCY)");
      EXIT(ServiceLedgerEntry."Total Cost (LCY)");
    END;

    PROCEDURE GetActualHoursBaseOrder@1210190027() : Decimal;
    VAR
      ServiceLedgerEntry@1210190000 : Record 11012819;
    BEGIN
      //mg, 19-09-11: M28500
      ServiceLedgerEntry.SETCURRENTKEY("Base Service Order No.");
      ServiceLedgerEntry.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        ServiceLedgerEntry.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        ServiceLedgerEntry.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      ServiceLedgerEntry.SETRANGE("Cost Type", ServiceLedgerEntry."Cost Type"::Labor);
      ServiceLedgerEntry.SETRANGE("Cost Present", TRUE);
      ServiceLedgerEntry.CALCSUMS(Quantity);
      EXIT(ServiceLedgerEntry.Quantity);
    END;

    PROCEDURE GetTotalOpenOvhSurchBaseOrder@1210190028() TotalOvhSurch : Decimal;
    VAR
      PurchaseOrderControlLine@1210190000 : Record 11020221;
      HourAccountingSurcharge@1210190001 : Record 11020308;
      ItemJournalSurcharge@1210190002 : Record 11020585;
    BEGIN
      //mg, 19-09-11: M28500
      PurchaseOrderControlLine.SETCURRENTKEY("Base Service Order No.");
      PurchaseOrderControlLine.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        PurchaseOrderControlLine.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        PurchaseOrderControlLine.SETFILTER(Date, GETFILTER("Period Filter"));
      PurchaseOrderControlLine.CALCSUMS("Overhead Surcharge Firm");
      TotalOvhSurch += PurchaseOrderControlLine."Overhead Surcharge Firm";
      //db.sn, 23-05-13: C002866
      PurchaseOrderControlLine.CALCSUMS("Overhead Surcharge Soft");
      TotalOvhSurch += PurchaseOrderControlLine."Overhead Surcharge Soft";
      //db.en, 23-05-13: C002866

      HourAccountingSurcharge.SETCURRENTKEY("Base Service Order No.");
      HourAccountingSurcharge.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        HourAccountingSurcharge.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        HourAccountingSurcharge.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      HourAccountingSurcharge.CALCSUMS("Overhead Surcharge Service");
      TotalOvhSurch += HourAccountingSurcharge."Overhead Surcharge Service";

      ItemJournalSurcharge.SETCURRENTKEY("Base Service Order No.");
      ItemJournalSurcharge.SETRANGE("Base Service Order No.", "Base Service Order No.");
      IF GETFILTER("Cost Component Filter") <> '' THEN
        ItemJournalSurcharge.SETFILTER("Cost Component", GETFILTER("Cost Component Filter"));
      IF GETFILTER("Period Filter") <> '' THEN
        ItemJournalSurcharge.SETFILTER("Posting Date", GETFILTER("Period Filter"));
      ItemJournalSurcharge.CALCSUMS("Overhead Surcharge Service");
      TotalOvhSurch += ItemJournalSurcharge."Overhead Surcharge Service";

      EXIT(TotalOvhSurch);
    END;

    PROCEDURE CheckBaseServiceOrderTree@1100528600();
    VAR
      ServiceOrder@1100528600 : Record 11012823;
    BEGIN
      ServiceOrder.SETCURRENTKEY("Base Service Order No.");
      ServiceOrder.SETRANGE("Base Service Order No.", "No.");
      ServiceOrder.SETFILTER("No.", '<>%1', "No.");
      ServiceOrder.SetDisableBaseOrderCheck;
      IF ServiceOrder.FINDSET THEN
        REPEAT
          IF NOT ServiceOrder.InvoiceDataDiffersFromBaseOrder THEN BEGIN
            ServiceOrder.VALIDATE("Collective List No.", "Collective List No.");
            ServiceOrder.MODIFY(TRUE);
          END;
        UNTIL ServiceOrder.NEXT = 0;
    END;

    PROCEDURE SetDisableBaseOrderCheck@1100528601();
    BEGIN
      DisableBaseOrderCheck := TRUE;
    END;

    PROCEDURE CheckCollectiveList@1100528602();
    VAR
      ServiceCollectiveList@1100528600 : Record 11071730;
      Customer@1100528601 : Record 18;
      StartingDate@1100525000 : Date;
    BEGIN
      TESTFIELD("Collective List No.");
      IF NOT IsPlantInternalCharge THEN BEGIN
        TESTFIELD("Bill-to Customer No.");
        TESTFIELD("Customer No.");
      END;
      ServiceCollectiveList.GET("Collective List No.");
      ServiceCollectiveList.TESTFIELD(Status, ServiceCollectiveList.Status::Open);
      IF "No." = "Base Service Order No." THEN BEGIN
        ServiceCollectiveList.TESTFIELD("Bill-to Customer No.", "Bill-to Customer No.");
        IF NOT UseBilltoAsSelltoCustomer THEN
          ServiceCollectiveList.TESTFIELD("Customer No.", "Customer No.");
      END;
      TESTFIELD("Currency Code", ServiceCollectiveList."Currency Code");
      IF NOT IsPlantInternalCharge THEN
        Customer.GET("Customer No.");

      IF ServiceCollectiveList."Service Contract No." <> '' THEN
        ServiceCollectiveList.TESTFIELD("Service Contract No.", "Service Contract No.");
      IF ServiceCollectiveList."Service Location No." <> '' THEN
      ServiceCollectiveList.TESTFIELD("Service Location No.", "Service Location No.");

      StartingDate := GetStartingDate;
      ServiceCollectiveList.SETFILTER("Starting Date", '%1|<=%2', 0D, StartingDate);
      ServiceCollectiveList.SETFILTER("Ending Date", '%1|>=%2', 0D, StartingDate);
      ServiceCollectiveList.FIND;
    END;

    PROCEDURE HandleLookupCollectiveListNo@1100528603() : Boolean;
    VAR
      ServiceCollectiveList@1100528602 : Record 11071730;
      Customer@1100528603 : Record 18;
      ServiceCollectiveListsFRM@1100528600 : Page 11125230;
      ServiceOrderNo@1100409000 : Code[20];
      StartingDate@1100525000 : Date;
    BEGIN
      TESTFIELD("Bill-to Customer No.");
      Customer.GET("Bill-to Customer No.");
      IF "No." <> "Base Service Order No." THEN
        ServiceOrderNo := "Base Service Order No."
      ELSE
        ServiceOrderNo := "No.";
      ServiceCollectiveList.SETRANGE("Bill-to Customer No.", "Bill-to Customer No.");
      IF NOT UseBilltoAsSelltoCustomer THEN
        ServiceCollectiveList.SETRANGE("Customer No.", "Customer No.")
      ELSE
        ServiceCollectiveList.SETRANGE("Customer No.", "Bill-to Customer No.");
      ServiceCollectiveList.SETRANGE("Alternative Bill-to Address", "Alternative Bill-to Address");
      ServiceCollectiveList.SETRANGE("Bill-to Contact Person No.", "Bill-to Contact Person");
      IF "Collective List No." = '' THEN
        ServiceCollectiveList.SETRANGE(Status, ServiceCollectiveList.Status::Open);

      //DP00195 sn.
      IF IsPlantServiceOrder OR IsPlantInternalCharge THEN
        Customer."Collect SO Invoices By" := Customer."Collect SO Invoices By"::"Service Order";
      //DP00195 en.

      CASE Customer."Collect SO Invoices By" OF
        Customer."Collect SO Invoices By"::"Service Contract":
          BEGIN
            ServiceCollectiveList.SETFILTER("Service Contract No.", '%1|%2', '', "Service Contract No.");
            ServiceCollectiveList.SETFILTER("Service Order No.", '%1|%2', '', ServiceOrderNo);
          END;
        Customer."Collect SO Invoices By"::Complex:
          ServiceCollectiveList.SETFILTER("Complex Code", '%1|%2', '', GetComplexCode);
        Customer."Collect SO Invoices By"::"Service Location":
          BEGIN
            ServiceCollectiveList.SETFILTER("Service Contract No.", '%1|%2', '', "Service Contract No.");
            ServiceCollectiveList.SETRANGE("Service Location No.", "Service Location No.");
            ServiceCollectiveList.SETFILTER("Service Order No.", '%1|%2', '', ServiceOrderNo);
          END;
        Customer."Collect SO Invoices By"::"Service Order":
          ServiceCollectiveList.SETRANGE("Service Order No.", ServiceOrderNo)
      END;
      ServiceCollectiveList.SETRANGE("Currency Code", "Currency Code");
      StartingDate := GetStartingDate;
      ServiceCollectiveList.SETFILTER("Starting Date", '%1|<=%2', 0D, StartingDate);
      ServiceCollectiveList.SETFILTER("Ending Date", '%1|>=%2', 0D, StartingDate);
      ServiceCollectiveList."No." := "Collective List No.";
      ServiceCollectiveListsFRM.SetDefaults(Rec);
      //IF PAGE.RUNMODAL(0, ServiceCollectiveList) = ACTION::LookupOK THEN
      ServiceCollectiveListsFRM.SETTABLEVIEW(ServiceCollectiveList);
      ServiceCollectiveListsFRM.SETRECORD(ServiceCollectiveList);
      ServiceCollectiveListsFRM.LOOKUPMODE(TRUE);
      IF ServiceCollectiveListsFRM.RUNMODAL = ACTION::LookupOK THEN BEGIN
        ServiceCollectiveListsFRM.GETRECORD(ServiceCollectiveList);
        VALIDATE("Collective List No.", ServiceCollectiveList."No.");
      END;
    END;

    PROCEDURE RecalcSOCostPlusEntries@1100528604();
    VAR
      ServiceOrderCostPlusEntry@1100528601 : Record 11012825;
    BEGIN
      ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
      IF ServiceOrderCostPlusEntry.FINDFIRST THEN BEGIN
        ServiceOrderCostPlusEntry.DetermineRemovalContribution(FALSE);  //C024476 (inherit default from item line)
        IF NOT InvoiceDataDiffersFromBaseOrder THEN
          ServiceOrderCostPlusEntry.CheckInvBaseAmountBaseOrder
        ELSE
          ServiceOrderCostPlusEntry.CheckInvoiceBaseAmount;
      END;
    END;

    PROCEDURE RecalcBaseSOCostPlusEntries@1100528620(IBaseServiceOrder@1100528600 : Code[20]);
    VAR
      ServiceOrder@1100528601 : Record 11012823;
    BEGIN
      IF NOT ServiceOrder.GET(IBaseServiceOrder) THEN
        EXIT;
      IF NOT ServiceOrder."Base Service Order" THEN
        EXIT;

      ServiceOrder.RecalcSOCostPlusEntries;
    END;

    PROCEDURE CheckTravelData@1100528605();
    VAR
      ServiceExtraCost@1100528600 : Record 11020344;
    BEGIN
      ServiceExtraCost."Entity Type" := ServiceExtraCost."Entity Type"::"Service Order";
      ServiceExtraCost."Entity Code" := "No.";
      ServiceExtraCost.CheckTravelData;
    END;

    PROCEDURE ProcessUnitPriceStatusChange@1100528606();
    VAR
      ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
    BEGIN
      //kzwerver, 110930, n, RfC Unit Price
      IF (CurrFieldNo <> FIELDNO("Unit Price Status")) THEN
        EXIT;

      MODIFY; //mg, 26-09-12: T000805
      CASE "Unit Price Status" OF
        "Unit Price Status"::"Pre-Recording":
          ServiceUnitPriceManagement.ProcessStatusPreRecording(Rec);
        "Unit Price Status"::Recording:
          IF xRec."Unit Price Status" = "Unit Price Status"::"Pre-Recording" THEN
            ServiceUnitPriceManagement.ProcessStatusRecording(Rec);
        "Unit Price Status"::"Production Recording":
          ServiceUnitPriceManagement.ProcessStatusRealization(Rec);
      END;
      FIND('='); //previous command changes record
      //MODIFY; //mg.o, 26-09-12: T000805
    END;

    PROCEDURE ValidateUnitPriceTypeChange@1100528609();
    VAR
      ServiceOrderExtension@1210190000 : Record 11071727;
      ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
    BEGIN
      //kzwerver, 110930, n, RfC Unit Price
      ServiceUnitPriceManagement.ValidateSOUnitPriceChange("No.", FIELDCAPTION("Price Book Type"));

      ServiceOrderExtension.GetServOrderExtension("No.");
      ServiceOrderExtension."Price Book Code" := '';
      ServiceOrderExtension."Price Book Index Date" := 0D;
      "Unit Price Status" := 0;

      IF ("Price Book Type" = "Price Book Type"::Customer) THEN BEGIN
        ServiceOrderExtension."Price Book Code" := "Customer No.";
        ServiceOrderExtension."Price Book Index Date" :=
          ServiceUnitPriceManagement.GetLatestPriceBookIndexDate("Price Book Type", "Customer No.");
        IF (ServiceOrderExtension."Price Book Index Date" = 0D) THEN
          ServiceOrderExtension."Price Book Code" := '';
      END;
      ServiceOrderExtension.UpdateServOrderExtension("No.");
      ServiceOrderExtension.ValidateUnitPriceFieldsIncDate(Rec);
    END;

    PROCEDURE TestSLandSCCombination@1100528607();
    VAR
      ContractObject@1100528600 : Record 11071702;
    BEGIN
      IF ("Service Location No." = '') OR ("Service Contract No." = '') THEN EXIT;

      ContractObject.SETCURRENTKEY("Service Contract No.", "Service Location No.");
      ContractObject.SETRANGE("Service Contract No.", "Service Contract No.");
      IF ContractObject.ISEMPTY THEN
        EXIT;
      ContractObject.SETRANGE("Service Location No.", "Service Location No.");
      IF ContractObject.ISEMPTY THEN
        ERROR(Text103, "Service Location No.", "Service Contract No.");
    END;

    PROCEDURE InsertServiceText@1100528608(IAnalysisType@1100528600 : 'Problem,Cause,Solution';IAnalysisCode@1100528601 : Code[10];ITableFieldNo@1100528602 : Integer);
    VAR
      ServiceText@1100528603 : Record 11012882;
      ServiceAnalysis@1100528606 : Record 11012842;
    BEGIN
      IF SkipUpdateServiceText THEN EXIT;

      IF IAnalysisCode = '' THEN EXIT;

      ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Order");
      ServiceText.SETRANGE("No.", "No.");
      ServiceText.SETRANGE("Table Field", ITableFieldNo);
      IF NOT ServiceText.ISEMPTY THEN
        EXIT;

      IF ServiceAnalysis.GET(IAnalysisType, IAnalysisCode) THEN BEGIN
        ServiceText."Table Name" := ServiceText."Table Name"::"Service Order";
        ServiceText."No." := "No.";
        ServiceText."Table Field" := ITableFieldNo;
        ServiceText."Line No." := 10000;
        ServiceText.Date := TODAY;
        ServiceText."Time Created" := TIME;
        ServiceText.Comment := ServiceAnalysis.Description;
        ServiceText."Active in FSA" := ServiceText.GetDefaultValueOfActiveInFSA;
        ServiceText.INSERT(TRUE);
      END;
    END;

    PROCEDURE ChangeStatusLinkedSOs@1210190032();
    VAR
      ServiceOrder@1210190000 : Record 11012823;
      ServiceOrderList@1100525000 : Page 11012830;
      SaveStatusOld@1100525001 : Option;
      SaveStatusNew@1100525002 : Option;
      Answer@1100525003 : Integer;
    BEGIN
      TESTFIELD("Base Service Order", TRUE);

      ServiceOrder.SETCURRENTKEY("Base Service Order No.");
      ServiceOrder.SETRANGE("Base Service Order No.", "No.");
      ServiceOrder.SETRANGE("Base Service Order", FALSE);
      IF ServiceOrder.ISEMPTY THEN
        EXIT;

      IF MultipleAnswerStatusChange <> 0 THEN
        Answer := MultipleAnswerStatusChange - 1
      ELSE
        IF DontShowMenuOnStatusChange THEN
          Answer := 2
        ELSE
          Answer := STRMENU(Text041, 1, Text042);

      CASE Answer OF
        0: ERROR('');
        //DP00503 sn
        1:
          BEGIN
            IF (CurrFieldNo = FIELDNO(Status)) THEN BEGIN
              ServiceOrder.SETFILTER(Status, '..%1', ServiceOrder.Status::"Technical Finished");
              ServiceOrderList.SETTABLEVIEW(ServiceOrder);
              SaveStatusOld := xRec.Status;
              SaveStatusNew := Rec.Status;
              COMMIT;  //Otherwise RunModal is not possible.
              ServiceOrderList.SetShowOnlyForm(TRUE);
              ServiceOrderList.LOOKUPMODE(TRUE);
              IF ServiceOrderList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                ServiceOrder.SETFILTER(Status, '<%1', ServiceOrder.Status::"Technical Finished");
                IF NOT ServiceOrder.ISEMPTY THEN
                  IF NOT CONFIRM(Text040) THEN
                    ERROR('');
                ServiceOrder.SETFILTER(Status, '..%1', ServiceOrder.Status::"Technical Finished");
                IF NOT ServiceOrder.ISEMPTY THEN BEGIN
                  IF ServiceOrder.FINDSET(TRUE) THEN
                    REPEAT
                      ServiceOrder.VALIDATE(Status, Status);
                      ServiceOrder.HandleStatusChange;
                    UNTIL ServiceOrder.NEXT = 0;
                END;
              END ELSE BEGIN
                ServiceOrder.SETRANGE(Status);
                Status := SaveStatusOld;
                COMMIT;  //Reset status
                ERROR('');
              END;
            END;
          END;
        //DP00503 en
        2:
          BEGIN
            ServiceOrder.SETFILTER(Status, '<%1', ServiceOrder.Status::"Technical Finished");
            IF NOT ServiceOrder.ISEMPTY THEN
              IF NOT CONFIRM(Text040) THEN
                ERROR('');
            ServiceOrder.SETFILTER(Status, '..%1', ServiceOrder.Status::"Technical Finished"); //mg, 09-11-11: M30581
            IF NOT ServiceOrder.ISEMPTY THEN BEGIN
              IF ServiceOrder.FINDSET(TRUE) THEN
                REPEAT
                  ServiceOrder.VALIDATE(Status, Status);
                  ServiceOrder.HandleStatusChange;
                UNTIL ServiceOrder.NEXT = 0;
            END;
          END;
      END;
    END;

    PROCEDURE UpdateToNextRefPoint@1210190033(IStep@1210190000 : 'Planned,Reviewed,Make Chargeable,Not Invoice,Prepare,Next Service Order,Appointment Confirmed');
    VAR
      DocumentReferencePoint@1210190003 : Record 11020296;
      SubcontPortSetup@1100528600 : Record 11126402;
      ServiceOrderCostPlusEntry@1100528000 : Record 11012825;
      ServiceSetup@1100528601 : Record 11012800;
    BEGIN
      CASE IStep OF
        IStep::Planned:
          BEGIN
            DocumentReferencePoint.InsertDocRefPointSOPlanned("No.");
            IF NOT SubcontPortSetup.FINDSET OR NOT SubcontPortSetup."Subcontracting Portal Active" THEN
              CreateSubcontrPurchaseOrder;
          END;
        IStep::Reviewed:
          DocumentReferencePoint.InsertDocRefPointSOReviewed("No.");
        IStep::"Make Chargeable":
          DocumentReferencePoint.InsertDocRefPointSOInvoiced("No.");
        // dp00215.sn
        IStep::"Not Invoice":
          BEGIN
            DocumentReferencePoint.InsertDocRefPointSONotInvoice("No.");
            ServiceSetup.GET;
            IF ServiceSetup."Not Invoice - CP No Charge" THEN BEGIN
              ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
              ServiceOrderCostPlusEntry.SETRANGE(Chargeable, TRUE);
              ServiceOrderCostPlusEntry.SETRANGE(Invoiced, FALSE);
              ServiceOrderCostPlusEntry.MODIFYALL(Chargeable, FALSE, TRUE);
            END;
          END;
        // dp00215.en
        IStep::Prepare:
          DocumentReferencePoint.InsertDocRefPointSOPrepared("No.");  //DP01015
        IStep::"Next Service Order":
          DocumentReferencePoint.InsertDocRefPointNextServiceOrder("No.");
        IStep::"Appointment Confirmed":
          DocumentReferencePoint.InsertDocRefPointSOAppointmentConfirmed("No.");
      END;
      IF DocumentReferencePoint.GetNewActRefPoint >= 0 THEN BEGIN
        FIND('='); // Previous command may modify data
        "Actual Reference Point (Gantt)" := DocumentReferencePoint.GetNewActRefPoint;
        MODIFY(TRUE);
      END;
    END;

    PROCEDURE ChangeStatusToAdministrativeFinished@1100528663();
    BEGIN
      IF Status = Status::Finished THEN
        FIELDERROR(Status);
      StatusOnBeforeValidate;
      VALIDATE(Status, Status::"Administrative Finished");
      MODIFY(TRUE);
    END;

    PROCEDURE UpdateSOSurchageBudgetLines@1100528610();
    VAR
      ServiceSurchargeManagement@1100528600 : Codeunit 11012834;
    BEGIN
      ServiceSurchargeManagement.UpdateSOSurchargeBudgetLines(Rec);
    END;

    PROCEDURE UpdateSurchargeFields@1100528611();
    VAR
      ServiceOrderExtension@1100528600 : Record 11071727;
      ServiceContract@1100528601 : Record 11012812;
      Customer@1100528602 : Record 18;
      ItemPriceCPEbySourceType@1100528603 : Record 11071800;
      ServiceSourceTypeSetup@1100528604 : Record 11071726;
      ItemPriceCostPlusEntry@1100528605 : Option;
    BEGIN
      ServiceOrderExtension.GetServOrderExtension("No.");  //db, 22-04-13: C007214

      IF "Service Contract No." <> '' THEN BEGIN
        ServiceContract.GET("Service Contract No.");
        ServiceOrderExtension.VALIDATE("Surcharge % Labor", ServiceContract."Surcharge % Labor");
        ServiceOrderExtension.VALIDATE("Surcharge % Material", ServiceContract."Surcharge % Material");
        ServiceOrderExtension.VALIDATE("Surcharge % Subcontr.", ServiceContract."Surcharge % Subcontr.");
        ServiceOrderExtension.VALIDATE("Surcharge % Plant", ServiceContract."Surcharge % Plant");
        ServiceOrderExtension.VALIDATE("Surcharge % Sundry", ServiceContract."Surcharge % Sundry");
      END ELSE
        IF "Customer No." <> '' THEN BEGIN
          Customer.GET("Customer No.");
          ServiceOrderExtension.VALIDATE("Surcharge % Labor", Customer."Surcharge % Labor");
          ServiceOrderExtension.VALIDATE("Surcharge % Material", Customer."Surcharge % Material");
          ServiceOrderExtension.VALIDATE("Surcharge % Subcontr.", Customer."Surcharge % Subcontr.");
          ServiceOrderExtension.VALIDATE("Surcharge % Plant", Customer."Surcharge % Plant");
          ServiceOrderExtension.VALIDATE("Surcharge % Sundry", Customer."Surcharge % Sundry");
        END;

      IF ServiceSourceTypeSetup.GET("Source Type") THEN
        ItemPriceCostPlusEntry := ServiceSourceTypeSetup."Item Price Cost Plus Entry";
      IF "Customer No." <> '' THEN
        IF ItemPriceCPEbySourceType.GET(ItemPriceCPEbySourceType.Type::Customer, "Customer No.", "Source Type") THEN
          IF ItemPriceCPEbySourceType."Item Price Cost Plus Entry" <> ItemPriceCPEbySourceType."Item Price Cost Plus Entry"::Default THEN
            ItemPriceCostPlusEntry := ItemPriceCPEbySourceType."Item Price Cost Plus Entry";
      IF "Service Contract No." <> '' THEN
        IF ItemPriceCPEbySourceType.GET(ItemPriceCPEbySourceType.Type::Contract, "Service Contract No.", "Source Type") THEN
          IF ItemPriceCPEbySourceType."Item Price Cost Plus Entry" <> ItemPriceCPEbySourceType."Item Price Cost Plus Entry"::Default THEN
            ItemPriceCostPlusEntry := ItemPriceCPEbySourceType."Item Price Cost Plus Entry";

      ServiceOrderExtension.VALIDATE("Item Price Cost Plus Entry", ItemPriceCostPlusEntry);
      ServiceOrderExtension.UpdateServOrderExtension("No.");
    END;

    PROCEDURE ActivateServOrderCard@1210190034();
    VAR
      ServiceSetup@1100525000 : Record 11012800;
      ServiceOrder@1100409000 : Record 11012823;
    BEGIN
      ServiceSetup.GET;
      ServiceOrder := Rec;  //db, 28-09-12: C002699
      IF ServiceSetup."Page ID Order" <> 0 THEN
        PAGE.RUN(ServiceSetup."Page ID Order", ServiceOrder)
      ELSE
        PAGE.RUN(PAGE::"Service Order (General)", ServiceOrder);
    END;

    PROCEDURE UpdateCustomerProblem@1210190035();
    VAR
      CustomerServiceAnalysis@1210190000 : Record 11071728;
    BEGIN
      IF ("Customer No." = '') OR (Problem = '') THEN
        EXIT;
      CustomerServiceAnalysis.SETRANGE("Analysis Type", CustomerServiceAnalysis."Analysis Type"::Problem);
      CustomerServiceAnalysis.SETRANGE("Customer No.", "Customer No.");
      CustomerServiceAnalysis.SETRANGE("Standard Analysis Code", Problem);
      IF CustomerServiceAnalysis.COUNT = 1 THEN BEGIN
        CustomerServiceAnalysis.FINDFIRST;
        VALIDATE("Customer Problem", CustomerServiceAnalysis.Code);
      END;
    END;

    PROCEDURE UpdateConfirmationLetter@1100528612();
    VAR
      ServiceOrderExtension@1100528601 : Record 11071727;
      ServiceSetup@1100528600 : Record 11012800;
      SCCustSourceTypeSetup@1100528603 : Record 11071800;
    BEGIN
      SCCustSourceTypeSetup.GetAppointmentInfoByServiceOrder(Rec, SCCustSourceTypeSetup);
      ServiceOrderExtension.GetServOrderExtension("No.");
      IF SCCustSourceTypeSetup."Appointments by" <> SCCustSourceTypeSetup."Appointments by"::" " THEN BEGIN
        ServiceOrderExtension."Appointment Letter Code" := SCCustSourceTypeSetup."Appointment Letter Code";
        IF ServiceOrderExtension."Appointment Letter Code" = '' THEN BEGIN
          ServiceSetup.GET;
          ServiceOrderExtension."Appointment Letter Code" := ServiceSetup."Default SO Appointm. Letter";
        END;
      END ELSE
        ServiceOrderExtension."Appointment Letter Code" := '';
      ServiceOrderExtension.UpdateServOrderExtension("No.");
    END;

    PROCEDURE EditDocuments@1100528702(ContactNo@1210190003 : Code[20];ContactPersonNo@1210190004 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      DocumentTemplate@1210190001 : Record 11012401;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      DocumentMailing.EditDocuments(
        STRSUBSTNO('%1', DocumentTemplate.Type::"Service Order"), DocumentLinkRIDs,
        "Global Dimension 1 Code", ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE TestCustomerLocation@1100528614();
    BEGIN
      ServLocRec.GET("Service Location No.");
      IF ServLocRec."Customer No." <> '' THEN
        TESTFIELD("Customer No.", ServLocRec."Customer No.");
    END;

    PROCEDURE TestCustomerContract@1100528615();
    BEGIN
      ServContrRec.GET("Service Contract No.");
      IF ServContrRec."Customer No." <> '' THEN  //mg, 03-05-11: M27178
        TESTFIELD("Customer No.", ServContrRec."Customer No.");
    END;

    PROCEDURE ShowObjectSpecificationLines@1210190038();
    VAR
      ServiceOrderObjSpecLine@1210190000 : Record 11071782;
    BEGIN
      TESTFIELD("No.");
      ServiceOrderObjSpecLine.SETRANGE("Service Order No.", "No.");
      PAGE.RUNMODAL(0, ServiceOrderObjSpecLine);
    END;

    PROCEDURE ShowTodos@1100528700();
    VAR
      Todo@1100528700 : Record 5080;
    BEGIN
      Todo.SETRANGE("Service Order No.", "No.");
      Todo.SETRANGE("System To-do Type", Todo."System To-do Type"::Organizer);
      PAGE.RUNMODAL(PAGE::"Task List", Todo);
    END;

    PROCEDURE UpdateFinishedObjects@1100525035();
    VAR
      ServiceOrderObject@1100525000 : Record 11071724;
    BEGIN
      ServiceOrderObject.SETRANGE("Service Order No.", "No.");
      IF ServiceOrderObject.FINDSET THEN
        REPEAT
          ServiceOrderObject.UpdateFinishedFromBudgetLines;
        UNTIL ServiceOrderObject.NEXT = 0;
    END;

    PROCEDURE ServiceOrderCostPlusEntryExist@3() : Boolean;
    VAR
      SOCostPlusEntry@1100528800 : Record 11012825;
    BEGIN
      // dp00116.n
      SOCostPlusEntry.SETRANGE("Service Order No.","No.");
      EXIT(SOCostPlusEntry.FINDFIRST);
    END;

    PROCEDURE UpdateCurrencyCodeOnCostPlusEntries@4();
    VAR
      SOCostPlusEntry@1100528801 : Record 11012825;
      Confirmed@1100528800 : Boolean;
    BEGIN
      // dp00116.n
      IF ServiceOrderCostPlusEntryExist THEN BEGIN
        IF (NOT GUIALLOWED) THEN
          Confirmed := TRUE
        ELSE
          Confirmed :=
            CONFIRM(Text106, FALSE);
        IF Confirmed THEN BEGIN
          SOCostPlusEntry.SETRANGE("Service Order No.","No.");
          SOCostPlusEntry.SETRANGE(Invoiced, FALSE); //4ps.n DP01236
          SOCostPlusEntry.SETRANGE("Bill-to Customer No.", "Customer No.");
          IF SOCostPlusEntry.FINDSET THEN BEGIN
            REPEAT
              //SOCostPlusEntry.TESTFIELD(Invoiced,FALSE); //4ps.o DP01236
              SOCostPlusEntry.TESTFIELD("Invoice in Process (LCY)",0);
              SOCostPlusEntry.TESTFIELD("Invoiced Price",0);
              SOCostPlusEntry.TESTFIELD("Credit Memo in Process (LCY)",0);

              SOCostPlusEntry."Currency Code" := "Currency Code";
              //DP00887.sn
              SOCostPlusEntry.CalculateFCYFromLCY(SOCostPlusEntry.FIELDNO("Gross Price (LCY)"));
              SOCostPlusEntry.CalculateFCYFromLCY(SOCostPlusEntry.FIELDNO("Cost Price (LCY)"));
              SOCostPlusEntry.CalculateFCYFromLCY(SOCostPlusEntry.FIELDNO("Basic Price (LCY)"));
              SOCostPlusEntry.CalculateFCYFromLCY(SOCostPlusEntry.FIELDNO("Sales Price (LCY)"));
              SOCostPlusEntry.CalculateFCYFromLCY(SOCostPlusEntry.FIELDNO("Invoice Price (LCY)"));
              //DP00887.en
              SOCostPlusEntry.MODIFY;
            UNTIL SOCostPlusEntry.NEXT = 0;
          END;
        END;
      END;
    END;

    PROCEDURE CalcServiceOrderAmountFromLCY@1100528802();
    VAR
      CurrencyDate@1100528802 : Date;
      CurrencyExchangeRate@1100528801 : Record 330;
      Currency2@1100528800 : Record 4;
    BEGIN
      // dp00116.n
      Currency2.InitRoundingPrecision;
      IF "Currency Code" <> '' THEN BEGIN
        CurrencyDate := "Order Date";
        "Order Amount" :=
        ROUND(
          CurrencyExchangeRate.ExchangeAmtLCYToFCY(
            0, '', CurrencyDate, "Currency Code", "Order Amount (LCY)",
             CurrencyExchangeRate.ExchangeRate(0, '', CurrencyDate, "Currency Code",TRUE),TRUE),
             Currency2."Amount Rounding Precision");
      END ELSE BEGIN
        "Order Amount" := ROUND("Order Amount (LCY)",Currency2."Amount Rounding Precision");
      END;
    END;

    PROCEDURE CreateSalesInvoiceViaCollList@1100409006();
    VAR
      ServiceOrder@1100409000 : Record 11012823;
    BEGIN
      IF NOT InvoiceDataDiffersFromBaseOrder THEN
        IF NOT "Allow Invoice Separately" THEN
          TESTFIELD("Base Service Order", TRUE);
      ServiceOrder := Rec;
      ServiceOrder.SETRECFILTER;
      ServiceOrder.CreateSalesInvoiceViaCollLists;
    END;

    PROCEDURE CreateSalesInvoiceViaCollLists@1100528627();
    VAR
      ServiceOrder@1100409000 : Record 11012823;
    BEGIN
      ServiceOrder.COPY(Rec);
      SETRANGE("Base Service Order", TRUE);
      IF "Glazing Service Call No." <> '' THEN  //C028240
        ServiceOrder.SETRANGE("Glazing Service Call No.", "Glazing Service Call No.");
      REPORT.RUNMODAL(REPORT::"Create Service Order Invoice", TRUE, FALSE, ServiceOrder);
    END;

    PROCEDURE TestSCPeriodClosed@1210190040();
    VAR
      ServiceContractCtrlPeriod@1210190000 : Record 11071746;
    BEGIN
      IF ("Service Contract No." = '') OR ("Service Control Period Date" = 0D) THEN
        EXIT;

      ServiceContractCtrlPeriod.SETRANGE("Service Contract No.", "Service Contract No.");
      ServiceContractCtrlPeriod.SETFILTER("Date Finished", '<>%1', 0D);
      ServiceContractCtrlPeriod.SETFILTER("Ending Date", '>=%1', "Service Control Period Date");
      IF ServiceContractCtrlPeriod.FINDFIRST THEN
        ERROR(Text107, FIELDCAPTION("Service Control Period Date"), ServiceContractCtrlPeriod.Code, ServiceContractCtrlPeriod."Service Contract No.");
    END;

    PROCEDURE CopyCustomerNotGlobalDims@1100525036();
    VAR
      GLSetup@1210190002 : Record 98;
      DefDimCust@1210190000 : Record 352;
      DefDimServOrder@1210190001 : Record 352;
    BEGIN
      //*  (24651.n
      IF ("Customer No." = '') OR ("Service Contract No." <> '') THEN
        EXIT;
      GLSetup.GET;

      DefDimCust.SETRANGE("Table ID", DATABASE::Customer);
      DefDimCust.SETRANGE("No.", "Customer No.");
      DefDimCust.SETFILTER("Dimension Code", '<>%1&<>%2', GLSetup."Global Dimension 1 Code", GLSetup."Global Dimension 2 Code");
      IF DefDimCust.FINDSET THEN BEGIN
        REPEAT
          IF NOT DefDimServOrder.GET(DATABASE::"Service Order", "No.", DefDimCust."Dimension Code") THEN BEGIN
            DefDimServOrder := DefDimCust;
            DefDimServOrder."Table ID" := DATABASE::"Service Order";
            DefDimServOrder."No." := "No.";
            DefDimServOrder.INSERT;
          END ELSE BEGIN
            IF DefDimServOrder."Dimension Value Code" <> DefDimCust."Dimension Value Code" THEN BEGIN
              DefDimServOrder."Dimension Value Code" := DefDimCust."Dimension Value Code";
              DefDimServOrder."Value Posting" := DefDimCust."Value Posting";
              DefDimServOrder.MODIFY;
            END;
          END;
        UNTIL DefDimCust.NEXT = 0;
      END;

      UpdateServAnalysisNotGlobDims;
    END;

    [External]
    PROCEDURE GetServiceOrderCard@1100525034() : Integer;
    VAR
      ServiceSetup@1100525001 : Record 11012800;
      ServiceOrder@1100525000 : Record 11012823;
    BEGIN
      ServiceSetup.GET;

      IF ServiceSetup."Page ID Order" <> 0 THEN BEGIN
        EXIT(ServiceSetup."Page ID Order");
      END ELSE BEGIN
        ServiceOrder := Rec;
        ServiceOrder.SETRECFILTER;
        IF ServiceSetup."SO (Plan) Ref. Point Filter" <> '' THEN BEGIN
          ServiceOrder.SETFILTER("Actual Reference Point (Gantt)", ServiceSetup."SO (Plan) Ref. Point Filter");
          IF ServiceOrder.FINDFIRST THEN BEGIN
            EXIT(PAGE::"Service Order (Plan)");
          END;
        END;
        IF ServiceSetup."SO (Prepare) Ref. Point Filter" <> '' THEN BEGIN
          ServiceOrder.SETFILTER("Actual Reference Point (Gantt)", ServiceSetup."SO (Prepare) Ref. Point Filter");
          IF ServiceOrder.FINDFIRST THEN BEGIN
            EXIT(PAGE::"Service Order (Preparation)");
          END;
        END;
        IF ServiceSetup."SO (Review) Ref. Point Filter" <> '' THEN BEGIN
          ServiceOrder.SETFILTER("Actual Reference Point (Gantt)", ServiceSetup."SO (Review) Ref. Point Filter");
          IF ServiceOrder.FINDFIRST THEN BEGIN
            EXIT(PAGE::"Service Order (Review)");
          END;
        END;
        IF ServiceSetup."SO (Invoice) Ref. Point Filter" <> '' THEN BEGIN
          ServiceOrder.SETFILTER("Actual Reference Point (Gantt)", ServiceSetup."SO (Invoice) Ref. Point Filter");
          IF ServiceOrder.FINDFIRST THEN BEGIN
            EXIT(PAGE::"Service Order (Invoicing)");
          END;
        END;
      END;
      EXIT(PAGE::"Service Order (General)");
    END;

    PROCEDURE ShowServiceOrderCard@1100528613();
    BEGIN
      PAGE.RUN(GetServiceOrderCard(), Rec);
    END;

    PROCEDURE CreateSubcontrPurchaseOrder@1100528621();
    VAR
      Vendor@1100528604 : Record 23;
      AdviceOrderLine@1100528602 : Record 11012055;
      TmpAdviceOrderLine@1100528605 : TEMPORARY Record 11012055;
      PurchaseLine@1100528603 : Record 39;
      PurchaseHeader@1100528601 : Record 38;
      ResourceWOP@1100528607 : Record 11229278;
      WorkOrder@1100528606 : Record 11229279;
      AdviceOrderManagement@1100528600 : Codeunit 11012041;
      VendorNoFilter@1100528608 : Text;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("Resource Company", COMPANYNAME);
      WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Subcontractor);
      WorkOrder.SETFILTER("Resource No.", '<>%1', '');
      IF WorkOrder.ISEMPTY THEN
        EXIT;
      WorkOrder.FINDSET;
      REPEAT
        ResourceWOP.GET(WorkOrder."Resource No.");
        Vendor.GET(ResourceWOP."Source No.");
        IF VendorNoFilter <> '' THEN
          VendorNoFilter += '|';
        VendorNoFilter += Vendor."No.";
      UNTIL WorkOrder.NEXT = 0;

      IF VendorNoFilter <> '' THEN BEGIN
        AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
        AdviceOrderLine.SETFILTER(Vendor, VendorNoFilter);
        AdviceOrderLine.SETRANGE("Service Order No.", "No.");
        AdviceOrderLine.SETFILTER("Process Status", '<%1', AdviceOrderLine."Process Status"::Cancelled);
        IF NOT AdviceOrderLine.ISEMPTY THEN BEGIN
          Vendor.SETFILTER("No.", VendorNoFilter);
          IF Vendor.FINDSET THEN
            REPEAT
              IF Vendor."Direct Post Order ICM" THEN BEGIN
                AdviceOrderLine.SETRANGE(Vendor, Vendor."No.");
                IF AdviceOrderLine.FINDSET THEN
                  REPEAT
                    TmpAdviceOrderLine := AdviceOrderLine;
                    TmpAdviceOrderLine.INSERT;
                  UNTIL AdviceOrderLine.NEXT = 0;
                COMMIT; // Next process has a runmodal
              END;
            UNTIL Vendor.NEXT = 0;
          AdviceOrderLine.SETFILTER(Vendor, VendorNoFilter);
          AdviceOrderManagement.ProcessPurchase(AdviceOrderLine, FALSE, FALSE);

          IF TmpAdviceOrderLine.FINDSET THEN BEGIN
            REPEAT
              AdviceOrderLine.GET(
                TmpAdviceOrderLine."Record Type", TmpAdviceOrderLine."Project No.",
                TmpAdviceOrderLine."Service Order No.", '', TmpAdviceOrderLine."Line No.");  //DP01378

              IF AdviceOrderLine."Purchase Route Reference" <> '' THEN BEGIN
                PurchaseLine.SETCURRENTKEY("Document Type", "Purchase Route Reference");
                PurchaseLine.SETRANGE("Document Type", PurchaseLine."Document Type"::Order);
                PurchaseLine.SETRANGE("Purchase Route Reference", AdviceOrderLine."Purchase Route Reference");
                IF PurchaseLine.FINDSET THEN
                  REPEAT
                    IF PurchaseHeader.GET(PurchaseLine."Document Type", PurchaseLine."Document No.") THEN
                      PurchaseHeader.MARK(TRUE);
                  UNTIL PurchaseLine.NEXT = 0;
              END;
            UNTIL TmpAdviceOrderLine.NEXT = 0;
            PurchaseHeader.MARKEDONLY(TRUE);
            PurchaseHeader.DirectPosting;
          END;
        END;
      END;
    END;

    PROCEDURE CheckAndChangeStatusBaseOrder@1100528618(INewSOStatus@1100409000 : Integer);
    VAR
      ServiceSetup@1100528600 : Record 11012800;
      ServiceOrder@1100528601 : Record 11012823;
    BEGIN
      ServiceSetup.GET;

      IF NOT ServiceSetup."Update Status Base Order" THEN
        EXIT;

      ServiceOrder.SETCURRENTKEY("Base Service Order No.");
      ServiceOrder.SETRANGE("Base Service Order No.", "Base Service Order No.");
      ServiceOrder.SETRANGE("Base Service Order", FALSE);
      ServiceOrder.SETFILTER("No.", '<>%1', "No.");
      ServiceOrder.SETFILTER(Status, '<>%1', INewSOStatus);
      IF ServiceOrder.ISEMPTY THEN BEGIN
        ServiceOrder.GET("Base Service Order No.");
        IF ServiceOrder.Status < INewSOStatus THEN BEGIN
          ServiceOrder.VALIDATE(Status, INewSOStatus);
          ServiceOrder.HandleStatusChange;
        END;
      END;
    END;

    PROCEDURE HandleStatusChange@1100409000();
    VAR
      Employee@1100409002 : Record 5200;
      WorkOrder@1100409001 : Record 11229279;
      ServiceOrderFilters@1100528602 : Record 11012823;
      LastActualReferencePoint@1100528601 : Integer;
      LastMultipleAnswerStatusChange@1100527000 : Integer;
    BEGIN
      IF ((xRec.Status <> Status:: Finished) AND (Status = Status::Finished)) OR
         ((xRec.Status = Status:: Finished) AND (Status <> Status::Finished)) THEN
        ERROR(Text002);
      IF (Status = Status::Cancelled) THEN BEGIN  //db, 22-03-10: M18714
        CheckCommitments;
        CheckWIP;
        //DP00465.sc  (EmplBySO -> WorkOrder/SO, and DeletedServiceOrderCache -> DeletedWorkOrderCache)
        //When order is canceled remove the order from the PDA (Test Call 4705)
        WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
        WorkOrder.SETRANGE("Source Company", COMPANYNAME);
        WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
        WorkOrder.SETRANGE("Source No.", "No.");
        WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Employee);
        WorkOrder.SETFILTER("Resource No.", '<>%1', '');
        WorkOrder.SETRANGE("Active in FSA", TRUE);
        IF WorkOrder.FINDSET THEN BEGIN
          REPEAT
            WorkOrder.UpdateDeletedWorkOrderCache(WorkOrder, 'D');
          UNTIL WorkOrder.NEXT = 0;
        END;
        //DP00465.ec (EmplBySO -> WorkOrder/SO, and DeletedServiceOrderCache -> DeletedWorkOrderCache)
        CommunicateOrderToFLS(3); //DP00703.n
      END;
      IF CheckBlockedByFSA() THEN
        ERROR(Text009, FIELDCAPTION(Status), TABLECAPTION, "No.");
      //db.sn, 21-03-11
      SaveField := CurrFieldNo;  //db, 09-05-11: M27257
      SetSkipUpdateDocRefPoint(TRUE);

      IF MODIFY(TRUE) THEN
        ProgPhaseRec.CheckProgressScheme(ProgPhaseRec.Type::ServOrder, "Progress Scheme", "No.", Status, TODAY, TIME);
      SetSkipUpdateDocRefPoint(FALSE);
      SaveField := 0;  //db, 09-05-11: M27257
      //db.en, 21-03-11
      //jd.sn, 06-04-11
      SetSkipStatusCheck(TRUE);
      CheckUpdateDocRefPoint('M');
      //A status change triggers an Insert of a Doc Ref Point, which can trigger a WorkOrder being sent by E-mail, this changes the
      //current ServiceOrder-rec. (Fields: "No. Printed" and "Date/Time Export Work Sheet").
      LastActualReferencePoint := "Actual Reference Point (Gantt)";
      LastMultipleAnswerStatusChange := MultipleAnswerStatusChange;
      ServiceOrderFilters.COPYFILTERS(Rec);
      RESET;
      FIND;
      COPYFILTERS(ServiceOrderFilters);
      "Actual Reference Point (Gantt)" := LastActualReferencePoint;
      MultipleAnswerStatusChange := LastMultipleAnswerStatusChange;
      UpdateNextDeadline;
      SetSkipStatusCheck(FALSE);
      IF MODIFY THEN;
      //jd.en, 06-04-11
      //db, 07-04-11: no update actions beyond this point, due to problem with transaction swich off by smtp.sendmail

      UpdateContractArrangements;
    END;

    PROCEDURE HandleStatusChangeLinkedOrders@1100528655();
    BEGIN
      IF "Base Service Order" AND (Status = Status::"Administrative Finished") THEN
        ChangeStatusLinkedSOs;
      IF NOT "Base Service Order" AND
         ((Status = Status::"Technical Finished") OR (Status = Status::"Administrative Finished")) THEN
        CheckAndChangeStatusBaseOrder(Status);
    END;

    PROCEDURE DocumentsCreatedByFSA@1100409001() : Boolean;
    VAR
      RecRef@1100525000 : RecordRef;
      DocumentLinkMgt@1100525001 : Codeunit 11012401;
    BEGIN
      RecRef.GETTABLE(Rec);
      EXIT(DocumentLinkMgt.GetInfoFiltered(RecRef, TRUE)>0);
    END;

    PROCEDURE FillSubcontractor@1100409002();
    VAR
      SubcontractorService@1100409000 : Record 11071789;
      ResourceWOP@1100528601 : Record 11229278;
      NewSubcontractorCode@1100528600 : Code[20];
    BEGIN
      IF "Source Type" <> "Source Type"::Call THEN
        EXIT;
      NewSubcontractorCode :=
        SubcontractorService.GetSubcontractorResourceNo(
          "Service Contract No.", "Service Location No.", '', '', Discipline, "Trade Speciality");

      IF NewSubcontractorCode = Subcontractor THEN
        EXIT;

      IF Subcontractor <> '' THEN
        IF GUIALLOWED THEN
          IF NOT CONFIRM(Text018, TRUE, FIELDCAPTION(Subcontractor),
            Subcontractor, ResourceWOP.GetResourceName(Subcontractor),
            NewSubcontractorCode, ResourceWOP.GetResourceName(NewSubcontractorCode))
          THEN
            EXIT;
      VALIDATE(Subcontractor, NewSubcontractorCode);
    END;

    PROCEDURE DetermineServiceType@1100409003(IOnInsert@1100409000 : Boolean;VAR OServiceTypeFromSCSourceType@1100529400 : Boolean);
    VAR
      SCCustSourceTypeSetup@1100409001 : Record 11071800;
      ServiceSourceTypeSetup@1100409003 : Record 11071726;
      NoSeries@1100525000 : Record 308;
      ServiceType@1100409004 : Code[20];
      ServiceTypeOther@1100409005 : Code[20];
      Level@1100409006 : Integer;
      ServiceCategory@1100528500 : Record 11071985;
    BEGIN
      IF "Service Category" <> '' THEN BEGIN
        IF ServiceCategory.GET("Service Contract No.", "Service Category") THEN BEGIN
          ServiceType := ServiceCategory."Service Type";
          ServiceTypeOther := ServiceCategory."Service Type (Other)";
         END;
      END;
      IF ServiceType = '' THEN BEGIN
        IF "No. Series" <> '' THEN BEGIN
          IF NoSeries.GET("No. Series") THEN
            IF NoSeries."Service Type" <> '' THEN BEGIN
              ServiceType := NoSeries."Service Type";
              ServiceTypeOther := NoSeries."Service Type (Other)";
            END;
        END;
      END;

      IF ServiceType = '' THEN BEGIN
        IF "Service Contract No." = '' THEN
          Level += 1
        ELSE
          IF "Charge Vendor (Warranty)" THEN
            Level += 1;
        IF (Level = 1) AND ("Customer No." = '') THEN
          Level += 1;
        REPEAT
          CASE Level OF
            0:
              BEGIN
                IF SCCustSourceTypeSetup.GET(SCCustSourceTypeSetup.Type::Contract, "Service Contract No.", "Source Type") THEN BEGIN
                  ServiceType :=  SCCustSourceTypeSetup."Service Type";
                  ServiceTypeOther :=  SCCustSourceTypeSetup."Service Type (Other)";
                  OServiceTypeFromSCSourceType := TRUE;
                END;
              END;
            1:
              BEGIN
                IF SCCustSourceTypeSetup.GET(SCCustSourceTypeSetup.Type::Customer, "Bill-to Customer No.", "Source Type") THEN BEGIN
                  IF ServiceType = '' THEN
                    ServiceType :=  SCCustSourceTypeSetup."Service Type";
                  IF ServiceTypeOther = '' THEN
                    ServiceTypeOther :=  SCCustSourceTypeSetup."Service Type (Other)";
                END;
              END;
            2:
              BEGIN
                IF ServiceSourceTypeSetup.GET("Source Type") THEN BEGIN
                  IF ServiceType = '' THEN
                    ServiceType :=  ServiceSourceTypeSetup."Service Type";
                  IF ServiceTypeOther = '' THEN
                    ServiceTypeOther :=  ServiceSourceTypeSetup."Service Type (Other)";
                END;
              END;
          END;
          Level += 1;
        UNTIL (Level > 2) OR ((ServiceType <> '') AND (ServiceTypeOther <> ''));
      END;

      IF (ServiceType <> '') AND
         (NOT IOnInsert OR ("Service Type" = '')) AND
         (ServiceType <> "Service Type")
      THEN
        VALIDATE("Service Type", ServiceType);
      IF (ServiceTypeOther <> '') AND
         (NOT IOnInsert OR ("Service Type (Other)" = '')) AND
         (ServiceTypeOther <> "Service Type (Other)")
      THEN
        VALIDATE("Service Type (Other)", ServiceTypeOther);
    END;

    PROCEDURE SearchPlantLocation@1100529900() : Boolean;
    VAR
      PlantLocation@1100528601 : Record 11012554;
    BEGIN
      PlantLocation.CHANGECOMPANY("Plant Company");
      PlantLocation.SETCURRENTKEY("Post Code", "House No.", "House No. Ext.");
      IF PAGE.RUNMODAL(PAGE::"Plant Location Search", PlantLocation) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Plant Location", PlantLocation.Code);
        EXIT(TRUE);
      END;
    END;

    PROCEDURE SearchServiceLocation@1100528619() : Boolean;
    VAR
      ServiceLocation@1100528601 : Record 11012801;
    BEGIN
      ServiceLocation.SETCURRENTKEY("Post Code", "House No.", "House No. Ext.");
      IF PAGE.RUNMODAL(PAGE::"Find Service Location", ServiceLocation) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Service Location No.", ServiceLocation."No.");
        EXIT(TRUE);
      END;
    END;

    PROCEDURE TransferCostRevToProject@1100528622();
    VAR
      ServiceOrder@1100528600 : Record 11012823;
      ServiceOrderExtension@1100528602 : Record 11071727;
      ServiceSetup@1100528603 : Record 11012800;
      TransferServicetoProjectREP@1100528601 : Report 11012777;
    BEGIN
      ServiceOrderExtension.GetServOrderExtension("No.");
      ServiceOrderExtension.TESTFIELD("Master Project");

      ServiceSetup.GET;
      ServiceSetup.TESTFIELD("Service to Project", ServiceSetup."Service to Project"::"Transfer Cost and Revenue");

      ServiceOrder.COPY(Rec);
      ServiceOrder.SETRECFILTER;
      TransferServicetoProjectREP.SETTABLEVIEW(ServiceOrder);
      TransferServicetoProjectREP.RUNMODAL;
    END;

    PROCEDURE StartServOrders@1100409004(lvAction@1100485000 : Integer;lvCount@1100485001 : Boolean) : Integer;
    VAR
      lvServOrderRec@1100485002 : Record 11012823;
    BEGIN
      //db, 31-12-12: moved from form to table, not yet integrated with same function of codeunit 11012825

      //C026176.sn
      IF lvCount AND ("No." = '') THEN
        EXIT(0);
      //C026176.en

      lvServOrderRec.SETFILTER("No.", '<>%1', "No.");
      CASE lvAction OF
        0:
          BEGIN
            lvServOrderRec.SETCURRENTKEY("Service Contract No.");
            lvServOrderRec.SETRANGE("Service Contract No.", "Service Contract No.");
            IF (lvCount = TRUE) AND ("Service Contract No." = '') THEN EXIT(0);
          END;
        1:
          BEGIN
            lvServOrderRec.SETCURRENTKEY("Service Location No.");
            lvServOrderRec.SETRANGE("Service Location No.", "Service Location No.");
            IF (lvCount = TRUE) AND ("Service Location No." = '') THEN EXIT(0);
          END;
        2:
          BEGIN
            lvServOrderRec.SETCURRENTKEY("Call No.");
            lvServOrderRec.SETRANGE("Call No.", "Call No.");
            lvServOrderRec.SETRANGE("Source Type", lvServOrderRec."Source Type"::Call);
            IF (lvCount = TRUE) AND ("Call No." = '') THEN EXIT(0);
          END;
        3:
          BEGIN
            IF NOT lvCount THEN BEGIN
              IF "Base Service Order No." = '' THEN
                EXIT(0);
              lvServOrderRec.SETRANGE("No.", "Base Service Order No.");
              lvServOrderRec.FINDFIRST;
              PAGE.RUNMODAL(PAGE::"Base Service Order", lvServOrderRec);
              EXIT(0);
            END ELSE BEGIN
              lvServOrderRec.SETCURRENTKEY("Base Service Order No.");
              lvServOrderRec.SETRANGE("Base Service Order No.", "Base Service Order No.");
              IF ("Base Service Order No."= '') THEN EXIT(0);
              EXIT(lvServOrderRec.COUNT);
            END;
          END;
        9:  //db, 31-12-12: 30184
          BEGIN
            lvServOrderRec.SETCURRENTKEY("Glazing Service Call No.");
            lvServOrderRec.SETRANGE("Glazing Service Call No.", "Glazing Service Call No.");
            //lvServOrderRec.SETRANGE("Source Type", lvServOrderRec."Source Type"::Call);  //db, 20-03-13: T001508
            IF (lvCount = TRUE) AND ("Glazing Service Call No." = '') THEN EXIT(0);
          END;
      END;

      IF lvCount = FALSE THEN BEGIN
        PAGE.RUNMODAL(0, lvServOrderRec);
      END ELSE BEGIN
        EXIT(lvServOrderRec.COUNT);
      END;
    END;

    PROCEDURE DetermineBilltoCustomerbySC@1100528623();
    VAR
      SCCustSourceTypeSetup@1100528600 : Record 11071800;
      ServiceContract@1100528601 : Record 11012812;
      ServiceLocation@1100528602 : Record 11012801;
      ShiptoAddress@1100528500 : Record 222;
    BEGIN
      IF "Service Contract No." = '' THEN
        EXIT;
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        EXIT;
      IF ("Service Location No." <> '') AND
         SCCustSourceTypeSetup.GET(SCCustSourceTypeSetup.Type::Contract, "Service Contract No.", "Source Type") AND
         (SCCustSourceTypeSetup."Bill-to" = SCCustSourceTypeSetup."Bill-to"::"Service Location")
      THEN BEGIN
        IF ServiceLocation.GET("Service Location No.") THEN BEGIN
          IF ServiceLocation."Bill-to Customer No." <> '' THEN BEGIN
            VALIDATE("Bill-to Customer No.", ServiceLocation."Bill-to Customer No.");
            IF ServiceLocation."Alternative Bill-to Address" <> '' THEN
              VALIDATE("Alternative Bill-to Address", ServiceLocation."Alternative Bill-to Address")
          END ELSE
            IF ServiceLocation."Customer No." <> '' THEN BEGIN
              VALIDATE("Bill-to Customer No.", ServiceLocation."Customer No.");
              //
              ShiptoAddress.SETRANGE("Customer No.", ServiceLocation."Customer No.");
              ShiptoAddress.SETRANGE(Code,ServiceLocation."Address Code");
              ShiptoAddress.SETRANGE("Billing Address", TRUE);
              IF ShiptoAddress.FINDFIRST THEN
              //
                VALIDATE("Alternative Bill-to Address", ServiceLocation."Address Code");
            END;
        END;
      END ELSE BEGIN
        IF ServiceContract."Bill-to Customer No. (CP)" <> '' THEN BEGIN
          VALIDATE("Bill-to Customer No.", ServiceContract."Bill-to Customer No. (CP)");
          VALIDATE("Alternative Bill-to Address", ServiceContract."Alt. Bill-to Address (CP)");
        END;
        IF ServiceContract."Bill-to Contact Person (CP)" <> '' THEN
          VALIDATE("Bill-to Contact Person", ServiceContract."Bill-to Contact Person (CP)");
      END;
      CheckInvoiceAddress;
    END;

    PROCEDURE CreateInvoiceText@1100409005();
    VAR
      Customer@1100409000 : Record 18;
      ServiceText@1100409005 : Record 11012882;
      TextFunctionManagement@1100409001 : Codeunit 11012357;
      InvoiceText@1100409002 : Text[250];
      EndPos@1100409004 : Integer;
    BEGIN
      IF "Bill-to Customer No." = '' THEN
        EXIT;
      IF NOT Customer.GET("Bill-to Customer No.") THEN
        EXIT;
      IF Customer."Invoice Text Cost Plus" = '' THEN
        EXIT;

      ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Order");
      ServiceText.SETRANGE("No.", "No.");
      ServiceText.SETRANGE("Table Field", 93);
      ServiceText.DELETEALL(TRUE);

      InvoiceText := Customer."Invoice Text Cost Plus";
      REPEAT
        IF STRLEN(InvoiceText) > MAXSTRLEN(ServiceText.Comment) THEN
          EndPos := TextFunctionManagement.GetSplitPosition(InvoiceText, MAXSTRLEN(ServiceText.Comment))
        ELSE
          EndPos := STRLEN(InvoiceText);
        IF EndPos > 0 THEN BEGIN
          ServiceText."Table Name" := ServiceText."Table Name"::"Service Order";
          ServiceText."No." := "No.";
          ServiceText."Table Field" := 93;
          ServiceText."Line No." += 10000;
          ServiceText.Comment := COPYSTR(InvoiceText, 1, EndPos);
          ServiceText.SetUpNewLine;
          ServiceText.INSERT(TRUE);
          InvoiceText := COPYSTR(InvoiceText, EndPos +1, MAXSTRLEN(ServiceText.Comment));
        END;
      UNTIL (EndPos = 0) OR (InvoiceText = '');
    END;

    PROCEDURE DisconnectNextServiceOrder@1100528624(IConfirm@1100528600 : Boolean);
    VAR
      ServiceOrderCostPlusEntry@1100528601 : Record 11012825;
    BEGIN
      TESTFIELD("Base Service Order", FALSE);

      IF IConfirm AND GUIALLOWED THEN
        IF NOT CONFIRM(Text109) THEN
          ERROR('');

      ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
      ServiceOrderCostPlusEntry.SETRANGE(Invoiced, TRUE);
      IF NOT ServiceOrderCostPlusEntry.ISEMPTY THEN
        ERROR(Text110);

      VALIDATE("Base Service Order", TRUE);
      VALIDATE("Base Service Order No.", "No.");
      VALIDATE("Previous Service Order No.", '');
      MODIFY(TRUE);

      UpdateBaseServiceOrder("No.", "No.");

      IF "Collective List No." <> '' THEN BEGIN
        xRec := Rec;
        VALIDATE("Collective List No.", '');
      END;
      MODIFY(TRUE);
    END;

    LOCAL PROCEDURE UpdateBaseServiceOrder@1100528625(IServiceOrderNo@1100528600 : Code[20];INewBaseServiceOrderNo@1100528601 : Code[20]);
    VAR
      ServiceOrder@1100528602 : Record 11012823;
    BEGIN
      ServiceOrder.SETCURRENTKEY("Previous Service Order No.");
      ServiceOrder.SETRANGE("Previous Service Order No.", IServiceOrderNo);
      IF NOT ServiceOrder.ISEMPTY THEN BEGIN
        IF ServiceOrder.FINDSET(TRUE) THEN
          REPEAT
            UpdateBaseServiceOrder(ServiceOrder."No.", INewBaseServiceOrderNo);
            ServiceOrder.VALIDATE("Base Service Order No.", INewBaseServiceOrderNo);
            ServiceOrder.MODIFY(TRUE);
          UNTIL ServiceOrder.NEXT = 0;
      END;
    END;

    PROCEDURE SelectAndConnectToBaseServiceOrder@1100528635();
    BEGIN
      SelectAndConnectToBaseServiceOrder2(0);
    END;

    LOCAL PROCEDURE SelectAndConnectToBaseServiceOrder2@1100528408(LookupPageNo@1100528400 : Integer);
    VAR
      ServiceOrder@1100528600 : Record 11012823;
    BEGIN
      TESTFIELD("Base Service Order", TRUE);
      IF HasNextServiceOrders THEN
        ERROR(Text113, "No.");
      ServiceOrder.SETCURRENTKEY("Base Service Order");
      ServiceOrder.SETRANGE("Base Service Order", TRUE);
      ServiceOrder.SETRANGE("Customer No.", "Customer No.");
      ServiceOrder.SETRANGE("Bill-to Customer No.", "Bill-to Customer No.");
      ServiceOrder.SETRANGE("Service Contract No.", "Service Contract No.");
      ServiceOrder.SETRANGE("Service Location No.", "Service Location No.");
      ServiceOrder.SETFILTER("No.", '<>%1', "No.");
      IF PAGE.RUNMODAL(LookupPageNo, ServiceOrder) = ACTION::LookupOK THEN
        ConnectToBaseServiceOrder(ServiceOrder."No.");
    END;

    PROCEDURE ConnectToBaseServiceOrder@1100528636(IBaseServiceOrderNo@1100528600 : Code[20]);
    VAR
      ServiceOrder@1100528601 : Record 11012823;
    BEGIN
      TESTFIELD("Base Service Order", TRUE);
      IF HasNextServiceOrders THEN
        ERROR(Text113, "No.");
      ServiceOrder.GET(IBaseServiceOrderNo);
      ServiceOrder.TESTFIELD("Base Service Order");
      IF ("Collective List No." <> '') AND (ServiceOrder."Collective List No." <> '') THEN
        TESTFIELD("Collective List No.", ServiceOrder."Collective List No.")
      ELSE
        TESTFIELD("Collective List No.", '');
      TESTFIELD("Customer No.", ServiceOrder."Customer No.");
      TESTFIELD("Bill-to Customer No.", ServiceOrder."Bill-to Customer No.");
      TESTFIELD("Service Contract No.", ServiceOrder."Service Contract No.");
      TESTFIELD("Service Location No.", ServiceOrder."Service Location No.");

      VALIDATE("Base Service Order", FALSE);
      VALIDATE("Base Service Order No.", IBaseServiceOrderNo);
      VALIDATE("Previous Service Order No.", IBaseServiceOrderNo);
      MODIFY(TRUE);
      IF ("Collective List No." = '') AND (ServiceOrder."Collective List No." <> '') THEN BEGIN
        IF NOT InvoiceDataDiffersFromBaseOrder THEN BEGIN
          SetDisableBaseOrderCheck;
          VALIDATE("Collective List No.", ServiceOrder."Collective List No.");
          MODIFY(TRUE);
        END;
      END;
    END;

    PROCEDURE UseBilltoAsSelltoCustomer@1100528626() : Boolean;
    VAR
      ServiceCollectiveListMgt@1100528602 : Codeunit 11012850;
    BEGIN
      EXIT(ServiceCollectiveListMgt.UseBilltoAsSelltoCustomer("Customer No.", "Service Contract No."));
    END;

    PROCEDURE GetSelectionFilter@1100525010(VAR ServiceOrder@1100525000 : Record 11012823) : Code[250];
    VAR
      SelectionFilter@1003 : Code[250];
      RecordCount@1004 : Integer;
    BEGIN
      //**4PS.n
      RecordCount := ServiceOrder.COUNT;
      IF RecordCount > 0 THEN BEGIN
        ServiceOrder.FINDSET;
        WHILE RecordCount > 0 DO BEGIN
          RecordCount := RecordCount - 1;
          IF SelectionFilter <> '' THEN
            SelectionFilter := SelectionFilter + '|';
          SelectionFilter := SelectionFilter + ServiceOrder."No.";
          IF RecordCount > 0 THEN
            ServiceOrder.NEXT;
        END;
      END;
      EXIT(SelectionFilter);
    END;

    PROCEDURE DetermineDiscountGroups@1100529200();
    VAR
      ServiceContract@1100529207 : Record 11012812;
      Customer@1100529206 : Record 18;
    BEGIN
      IF Customer.GET("Bill-to Customer No.") THEN BEGIN                                    // Usage of customer level is new.
        "Purch Discount Term Group 1" := Customer."Purch Discount Term Group";
        "Sales Discount Term Group 1" := Customer."Sales Discount Term Group";
        //>> ITERO.AC 150904 Copy price list code from customer
        "Price List Code" := Customer."Price List Code";
        //<< ITERO.AC 150904
        "Sales Discount Term Percent" := Customer."Sales Discount Term Percent";            // 161010 ITERO.AC RAD043 Added new field
      END;

      IF ServiceContract.GET("Service Contract No.") THEN BEGIN                             // Usage of contract level was standard.
        IF (ServiceContract."Purch Discount Term Group 1" <> '') AND (ServiceContract."Customer No." <> '') THEN
          "Purch Discount Term Group 1" := ServiceContract."Purch Discount Term Group 1";
        "Purch Discount Term Group 2" := ServiceContract."Purch Discount Term Group 2";
        IF (ServiceContract."Sales Discount Term Group 1" <> '') AND (ServiceContract."Customer No." <> '') THEN
          "Sales Discount Term Group 1" := ServiceContract."Sales Discount Term Group 1";
        "Sales Discount Term Group 2" := ServiceContract."Sales Discount Term Group 2";
      END;

      IF "Service Location No." <> '' THEN BEGIN                                              // Location Always leading
        IF ServLocRec.GET("Service Location No.") THEN BEGIN
          IF ServLocRec."Purch Discount Term Group 1" <> '' THEN
            "Purch Discount Term Group 1" := ServLocRec."Purch Discount Term Group 1";
          IF ServLocRec."Purch Discount Term Group 2" <> '' THEN
            "Purch Discount Term Group 2" := ServLocRec."Purch Discount Term Group 2";
          IF ServLocRec."Sales Discount Term Group 1" <> '' THEN
            "Sales Discount Term Group 1" := ServLocRec."Sales Discount Term Group 1";
          IF ServLocRec."Sales Discount Term Group 2" <> '' THEN
            "Sales Discount Term Group 2" := ServLocRec."Sales Discount Term Group 2";
        END;
      END;
    END;

    PROCEDURE GetStartingDate@1100528628() : Date;
    BEGIN
      IF "Starting Date" <> 0D THEN
        EXIT("Starting Date");
      IF "Order Date" <> 0D THEN
        EXIT("Order Date");
      EXIT(WORKDATE);
    END;

    PROCEDURE IsOldMaintenanceServiceOrder@1100525026() : Boolean;
    VAR
      ServiceOrderObject@1100528601 : Record 11071724;
    BEGIN
      TESTFIELD("Source Type", "Source Type"::Contract);
      ServiceOrderObject.SETRANGE("Service Order No.", "No.");
      ServiceOrderObject.SETFILTER("Source Line No.", '<>%1', 0);
      EXIT(ServiceOrderObject.ISEMPTY);
    END;

    PROCEDURE UpdateContractArrangements@1100525014();
    VAR
      ServiceOrderObject@1100525000 : Record 11071724;
      ContractObjectMaintenance@1100525001 : Record 11071692;
    BEGIN
      IF "Source Type" <> "Source Type"::Contract THEN
        EXIT;
      ServiceOrderObject.SETRANGE("Service Order No.", "No.");
      ServiceOrderObject.SETFILTER("Maintenance Scheme", '<>%1', '');
      IF ServiceOrderObject.FINDSET THEN
        REPEAT
          IF ContractObjectMaintenance.GET(
            ServiceOrderObject."Service Contract No.", ServiceOrderObject."Object No.", ServiceOrderObject."Maintenance Scheme")
          THEN BEGIN
            ContractObjectMaintenance.UpdateLastAndNextMaintDate;
            ContractObjectMaintenance.MODIFY;
          END;
        UNTIL ServiceOrderObject.NEXT = 0;
    END;

    PROCEDURE CheckDurationOnInitServOrder@1100525027();
    BEGIN
      //db, 08-08-13: C007836
      IF "Duration Time" < "Expected Hours" THEN
        VALIDATE("Duration Time", "Expected Hours");
    END;

    PROCEDURE ValidateServiceCluster@1100528633();
    VAR
      ServiceCluster@1100528600 : Record 11071742;
    BEGIN
      IF "Service Cluster" <> '' THEN
        IF NOT GetFilteredServiceClusters(ServiceCluster) THEN
          ServiceCluster.FINDFIRST;
      VALIDATE("Service Cluster Seqn.", 0);
    END;

    PROCEDURE LookupServiceCluster@1100528632();
    VAR
      ServiceCluster@1100528601 : Record 11071742;
    BEGIN
      GetFilteredServiceClusters(ServiceCluster);
      ServiceCluster.SETRANGE(Code);
      IF PAGE.RUNMODAL(0, ServiceCluster) = ACTION::LookupOK THEN
        VALIDATE("Service Cluster", ServiceCluster.Code);
    END;

    LOCAL PROCEDURE GetFilteredServiceClusters@1100528670(VAR OServiceCluster@1100528600 : Record 11071742) : Boolean;
    VAR
      ServiceContract@1100528601 : Record 11012812;
      ObjectModification@1100528604 : Record 11071700;
      ObjectModificationMgt@1100528603 : Codeunit 11012835;
      ObjectModificationNo@1100528602 : Code[20];
    BEGIN
      OServiceCluster.RESET;
      CASE "Source Type" OF
        "Source Type"::Contract:
          IF ServiceContract.GET("Service Contract No.") THEN BEGIN
            IF ServiceContract."Use Contract Clusters" THEN BEGIN
              OServiceCluster.SETRANGE(Type, OServiceCluster.Type::Contract);
              OServiceCluster.SETRANGE("Type Code", "Service Contract No.");
            END ELSE BEGIN
              OServiceCluster.SETRANGE(Type, OServiceCluster.Type::" ");
              OServiceCluster.SETRANGE("Type Code", '');
            END;
            OServiceCluster.SETRANGE("Source Type", OServiceCluster."Source Type"::" ");
            IF "Service Cluster" <> '' THEN
              OServiceCluster.SETRANGE(Code, "Service Cluster");
            EXIT(OServiceCluster.FINDFIRST);
          END;
        "Source Type"::Modification:
          BEGIN
            ObjectModificationNo := ObjectModificationMgt.GetModificationNoByServiceOrderNo("No.");
            ObjectModification.GET(ObjectModificationNo);
            IF ObjectModification."Use Modification Clusters" THEN BEGIN
              OServiceCluster.SETRANGE(Type, OServiceCluster.Type::Modification);
              OServiceCluster.SETRANGE("Type Code", ObjectModificationNo);
            END ELSE BEGIN
              OServiceCluster.SETRANGE(Type, OServiceCluster.Type::" ");
              OServiceCluster.SETRANGE("Type Code", '');
            END;
            OServiceCluster.SETRANGE("Source Type", OServiceCluster."Source Type"::" ");
            IF "Service Cluster" <> '' THEN
              OServiceCluster.SETRANGE(Code, "Service Cluster");
            EXIT(OServiceCluster.FINDFIRST);
          END;
        "Source Type"::Call,
        "Source Type"::Direct:
          BEGIN
            OServiceCluster.SETRANGE(Type, OServiceCluster.Type::"Source Type");
            OServiceCluster.SETRANGE("Type Code", '');
            OServiceCluster.SETRANGE("Source Type", "Source Type");
            IF "Service Cluster" <> '' THEN
              OServiceCluster.SETRANGE(Code, "Service Cluster");
            OServiceCluster.SETFILTER("Order Kind", '%1|%2', '', "Order Kind");
            OServiceCluster.SETFILTER("Order Type", '%1|%2', '', "Order Type");
            OServiceCluster.SETFILTER(Discipline, '%1|%2', '',Discipline);
            OServiceCluster.SETFILTER("Territory Code", '%1|%2', '', "Territory Code");
            EXIT(OServiceCluster.FINDFIRST);
          END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE ValidateServiceClusterSeqn@1100528631();
    VAR
      AppointmentManagement@1100528602 : Codeunit 11012865;
      StartingDatePeriod@1100528601 : Date;
      EndingDatePeriod@1100528603 : Date;
    BEGIN
      IF ("Service Cluster" <> '') AND ("Service Cluster Seqn." <> 0) THEN BEGIN
        AppointmentManagement.DetermineStartEndPeriod(Rec, StartingDatePeriod, EndingDatePeriod);
        IF StartingDatePeriod <> 0D THEN BEGIN
          "First Possible Starting Date" := 0D;
          "First Possible Starting Time" := 0T;
          "Last Possible Ending Date" := 0D;
          "Last Possible Ending Time" := 0T;
          "Ending Date" := 0D;
          IF (StartingDatePeriod < "Order Date") AND (EndingDatePeriod >= TODAY) THEN
            VALIDATE("Starting Date", TODAY)
          ELSE
            VALIDATE("Starting Date", StartingDatePeriod);
          VALIDATE("First Possible Starting Date", StartingDatePeriod);
          VALIDATE("Last Possible Ending Date", EndingDatePeriod);
        END;
      END;
    END;

    PROCEDURE LookupServiceClusterSeqn@1100528630();
    VAR
      ServiceCluster@1100528605 : Record 11071742;
      ServiceClusterSeq@1100528601 : Record 11071966;
    BEGIN
      GetFilteredServiceClusters(ServiceCluster);
      ServiceClusterSeq.SETRANGE(Type, ServiceCluster.Type);
      ServiceClusterSeq.SETRANGE("Type Code", ServiceCluster."Type Code");
      ServiceClusterSeq.SETRANGE("Source Type", ServiceCluster."Source Type");
      ServiceClusterSeq.SETRANGE("Cluster Code", "Service Cluster");
      IF "Service Cluster Seqn." <> 0 THEN BEGIN
        ServiceClusterSeq.SETRANGE("Seq. No.", "Service Cluster Seqn.");
        IF ServiceClusterSeq.FINDFIRST THEN;
        ServiceClusterSeq.SETRANGE("Seq. No.");
      END;
      IF PAGE.RUNMODAL(0, ServiceClusterSeq) = ACTION::LookupOK THEN
        VALIDATE("Service Cluster Seqn.", ServiceClusterSeq."Seq. No.");
    END;

    PROCEDURE SendAppointmentConfirmation@1100528634(VAR IServiceOrder@1100528604 : Record 11012823);
    VAR
      ServiceOrder@1100528603 : Record 11012823;
    BEGIN
      ServiceOrder.COPY(IServiceOrder);
      REPORT.RUNMODAL(REPORT::"Send SO Appointm. Confirm.", TRUE, TRUE, ServiceOrder);
    END;

    PROCEDURE IsPlantServiceOrder@1100529902() : Boolean;
    BEGIN
      EXIT("Plant Location" <> '');
    END;

    PROCEDURE GetComplexCode@1100528629() : Code[20];
    VAR
      ServiceLocation@1100528600 : Record 11012801;
    BEGIN
      IF ServiceLocation.GET("Service Location No.") THEN
        EXIT(ServiceLocation.GetComplexCode);
    END;

    PROCEDURE SyncServiceLocationData@1100528637(IFieldNo@1100528600 : Integer);
    VAR
      ServiceSetup@1100528601 : Record 11012800;
      ServiceLocation@1100528602 : Record 11012801;
    BEGIN
      ServiceSetup.GET;
      IF NOT ServiceSetup."Sync. Location by Order/Call" THEN
        EXIT;
      IF NOT ServiceLocation.GET("Service Location No.") THEN
        EXIT;
      CASE IFieldNo OF
        FIELDNO(Name):
          ServiceLocation.VALIDATE(Description, Name);
        FIELDNO("Contact Name"):
          ServiceLocation.VALIDATE("Contact Name", "Contact Name");
        FIELDNO("Phone No."):
          BEGIN
            ServiceLocation.VALIDATE("Phone No.", "Phone No.");
            "Phone No." := ServiceLocation."Phone No.";
          END;
        FIELDNO("Phone No. 2"):
          BEGIN
            ServiceLocation.VALIDATE("Phone No. 2", "Phone No. 2");
            "Phone No. 2" := ServiceLocation."Phone No. 2";
          END;
        FIELDNO("Mobile Phone No."):
          BEGIN
            ServiceLocation.VALIDATE("Mobile Phone No.", "Mobile Phone No.");
            "Mobile Phone No." := ServiceLocation."Mobile Phone No.";
          END;
        FIELDNO("E-Mail"):
          ServiceLocation.VALIDATE("E-Mail", "E-Mail");
        FIELDNO("Fax No."):
          ServiceLocation.VALIDATE("Fax No.", "Fax No.");
        FIELDNO("Bill-to Contact Name"):
          ServiceLocation.VALIDATE("Bill-to Contact Name", "Bill-to Contact Name");
      ELSE
        EXIT;
      END;
      ServiceLocation.MODIFY(TRUE);
    END;

    PROCEDURE HasNextServiceOrders@1100525040() : Boolean;
    VAR
      ServiceOrder@1100525000 : Record 11012823;
    BEGIN
      ServiceOrder.SETCURRENTKEY("Base Service Order No.");
      ServiceOrder.SETRANGE("Base Service Order No.", "No.");
      ServiceOrder.SETRANGE("Base Service Order", FALSE);
      EXIT(NOT ServiceOrder.ISEMPTY);
    END;

    PROCEDURE LookupResourceEmpl@1100527004(VAR ResourceNo@1100527002 : Code[20];EditableMode@1100527003 : Boolean);
    VAR
      Resource@1100527000 : Record 11229278;
      ServiceOrder@1100528601 : Record 11012823;
      ServiceOrderPlanManagement@1100528600 : Codeunit 11012868;
      dummyDate@1100528602 : Date;
    BEGIN
      //DP00465
      IF "Service Cluster" <> '' THEN BEGIN
        ServiceOrder := Rec;
        ServiceOrder.SETRECFILTER;
        Resource.SETFILTER("No.", ServiceOrderPlanManagement.DetermineResourceFilterAndDatesByCluster(ServiceOrder, dummyDate, dummyDate));
      END;
      Resource.SETRANGE(Type, Resource.Type::Employee);
      Resource.SETFILTER(Schedule, '%1|%2', Resource.Schedule::ServiceOrder, Resource.Schedule::Both);
      IF NOT Resource.GET(ResourceNo) OR (ResourceNo = '') THEN BEGIN
        Resource."No." := ResourceNo;
        Resource.Type := Resource.Type::Employee;
        Resource.Company := COMPANYNAME;
      END;
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, Resource)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, Resource) = ACTION::LookupOK THEN BEGIN
          IF (Resource."No." <> ResourceNo) AND (Resource."No." <> '') THEN
            ResourceNo := Resource."No.";
        END;
      END;
    END;

    PROCEDURE LookupResourceSubcontractor@1100528638(VAR ResourceNo@1100527002 : Code[20];EditableMode@1100527003 : Boolean);
    VAR
      Resource@1100527000 : Record 11229278;
    BEGIN
      //DP00610
      Resource.SETRANGE(Type, Resource.Type::Subcontractor);
      Resource.SETFILTER(Schedule, '%1|%2', Resource.Schedule::ServiceOrder, Resource.Schedule::Both);
      IF NOT Resource.GET(ResourceNo) OR (ResourceNo = '') THEN BEGIN
        Resource."No." := ResourceNo;
        Resource.Type := Resource.Type::Subcontractor;
        Resource.Company := COMPANYNAME;
      END;
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, Resource)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, Resource) = ACTION::LookupOK THEN BEGIN
          IF (Resource."No." <> ResourceNo) AND (Resource."No." <> '') THEN
            ResourceNo := Resource."No.";
        END;
      END;
    END;

    PROCEDURE UpdateWorkOrder@1100525030(IUpdateDateTimes@1100528600 : Boolean);
    BEGIN
      UpdateWorkorderEmployee(IUpdateDateTimes);
      UpdateWorkorderSubcontractor(IUpdateDateTimes);
      UpdateWorkOrderAnonymous;
      UpdateWorkOrderInfo(1);
    END;

    PROCEDURE UpdateWorkorderEmployee@1100525128(IUpdateDateTimes@1100528600 : Boolean);
    VAR
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      //DP00465
      IF ("Employee No." = '') OR (Status > Status::"In Process") THEN
        EXIT;
      IF NOT UpdateResourceWorkOrderAllowed(WorkOrder."Resource Type"::Employee) THEN
        EXIT;
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Employee);
      WorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
      IF WorkOrder.ISEMPTY THEN BEGIN
        WorkOrder.SETRANGE("Resource Type");
        WorkOrder.SETRANGE("Resource No.", '');
      END;
      IF WorkOrder.FINDFIRST THEN BEGIN
        WorkOrder.TestIfModificationIsAllowed;
        IF IUpdateDateTimes THEN
          WorkOrder.VALIDATE("Source No.", "No.");
        WorkOrder."Resource Type" := WorkOrder."Resource Type"::Employee;
        WorkOrder.VALIDATE("Resource No.", "Employee No.");
        WorkOrder.MODIFY(TRUE);
      END ELSE BEGIN
        WorkOrder.INIT;
        WorkOrder."No." := '';
        WorkOrder."Source Company" := COMPANYNAME;
        WorkOrder."Source Type" := WorkOrder."Source Type"::ServiceOrder;
        WorkOrder.VALIDATE("Source No.", "No.");
        WorkOrder."Resource Type" := WorkOrder."Resource Type"::Employee;
        WorkOrder.INSERT(TRUE);
        IF WorkOrder.Description = '' THEN
          WorkOrder.Description := COPYSTR(Description, 1, MAXSTRLEN(WorkOrder.Description));
        WorkOrder.VALIDATE("Resource No.", "Employee No.");
        WorkOrder.VALIDATE("Leading Resource", TRUE);
        WorkOrder.MODIFY(TRUE);
      END;
    END;

    PROCEDURE UpdateWorkorderSubcontractor@1100528617(IUpdateDateTimes@1100528600 : Boolean);
    VAR
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      //DP00610
      IF (Subcontractor = '') OR (Status > Status::"In Process") THEN
        EXIT;
      IF NOT UpdateResourceWorkOrderAllowed(WorkOrder."Resource Type"::Subcontractor) THEN
        EXIT;
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Subcontractor);
      WorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
      IF WorkOrder.ISEMPTY THEN BEGIN
        WorkOrder.SETRANGE("Resource Type");
        WorkOrder.SETRANGE("Resource No.", '');
      END;
      IF WorkOrder.FINDFIRST THEN BEGIN
        WorkOrder.TestIfModificationIsAllowed;
        IF IUpdateDateTimes THEN
          WorkOrder.VALIDATE("Source No.", "No.");
        WorkOrder.VALIDATE("Resource Type", WorkOrder."Resource Type"::Subcontractor);
        WorkOrder.VALIDATE("Resource No.", Subcontractor);
        WorkOrder.MODIFY(TRUE);
      END ELSE BEGIN
        WorkOrder.INIT;
        WorkOrder."No." := '';
        WorkOrder."Source Company" := COMPANYNAME;
        WorkOrder."Source Type" := WorkOrder."Source Type"::ServiceOrder;
        WorkOrder.VALIDATE("Source No.", "No.");
        WorkOrder."Resource Type" := WorkOrder."Resource Type"::Subcontractor;
        WorkOrder.INSERT(TRUE);
        IF WorkOrder.Description = '' THEN
          WorkOrder.Description := COPYSTR(Description, 1, MAXSTRLEN(WorkOrder.Description));
        WorkOrder.VALIDATE("Resource No.", Subcontractor);
        WorkOrder.MODIFY(TRUE);
      END;
    END;

    PROCEDURE UpdateWorkOrderAnonymous@1100525038();
    VAR
      WorkOrder@1100525000 : Record 11229279;
    BEGIN
      IF Status > Status::"In Process" THEN
        EXIT;
      IF NOT UpdateResourceWorkOrderAllowed(WorkOrder."Resource Type"::" ") THEN
        EXIT;
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
      IF WorkOrder.ISEMPTY THEN BEGIN
        WorkOrder.INIT;
        WorkOrder."No." := '';
        WorkOrder."Source Company" := COMPANYNAME;
        WorkOrder."Source Type" := WorkOrder."Source Type"::ServiceOrder;
        WorkOrder.VALIDATE("Source No.", "No.");
        WorkOrder."Resource Type" := WorkOrder."Resource Type"::Employee;
        WorkOrder.INSERT(TRUE);
        IF WorkOrder.Description = '' THEN BEGIN
          WorkOrder.Description := COPYSTR(Description, 1, MAXSTRLEN(WorkOrder.Description));
          WorkOrder.MODIFY;
        END;
        WorkOrder.UpdateServiceOrder('I');
      END;
    END;

    LOCAL PROCEDURE UpdateResourceWorkOrderAllowed@1100527000(ICheckResourceType@1100528600 : ' ,Employee,Subcontractor') : Boolean;
    VAR
      WorkOrder@1100527000 : Record 11229279;
    BEGIN
      //DP00465
      IF Status <= Status::"In Process" THEN BEGIN
        WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
        WorkOrder.SETRANGE("Source Company", COMPANYNAME);
        WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
        WorkOrder.SETRANGE("Source No.", "No.");
        WorkOrder.SETRANGE("Resource Type", ICheckResourceType);
        WorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
        IF WorkOrder.ISEMPTY THEN
          EXIT(TRUE);
        IF WorkOrder.FINDFIRST THEN BEGIN
          IF WorkOrder.NEXT = 0 THEN
            EXIT(TRUE);  // If 1 WO on SO, with resource empty
        END;
      END;
      EXIT(FALSE);
    END;

    PROCEDURE GetServiceOrderBudgetHours@1100528729() : Decimal;
    BEGIN
      CALCFIELDS("Budget Hours");
      IF "Budget Hours" <> 0 THEN
        EXIT("Budget Hours");
      IF "Starting Date" <> "Ending Date" THEN
        EXIT(-1);
      IF ("Starting Time" <> 0T) AND ("Ending Time" <> 0T) THEN
        EXIT(("Ending Time" - "Starting Time") / (60 * 60 * 1000));
    END;

    PROCEDURE SetDontShowMenuOnStatusChange@1100525037(IDontShowMenuOnStatusChange@1100525000 : Boolean);
    BEGIN
      DontShowMenuOnStatusChange := IDontShowMenuOnStatusChange;
    END;

    PROCEDURE DetermineServiceCategory@1100528639();
    VAR
      ServiceOrderObject@1100528600 : Record 11071724;
      ServiceContract@1100528601 : Record 11012812;
    BEGIN
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        EXIT;
      IF NOT (ServiceContract."Budget Based on" IN
        [ServiceContract."Budget Based on"::Category, ServiceContract."Budget Based on"::"Category + Maintenance Scheme"])
      THEN
        EXIT;
      IF "Service Category" <> '' THEN
        EXIT;
      CASE "Source Type" OF
        "Source Type"::Call:
          VALIDATE("Service Category", ServiceContract."Service Category (Call)");
        "Source Type"::Direct:
          VALIDATE("Service Category", ServiceContract."Service Category (Direct)");
      ELSE
        ServiceOrderObject.SETRANGE("Service Order No.", "No.");
        ServiceOrderObject.SETFILTER("Service Category", '<>%1', '');
        IF ServiceOrderObject.FINDFIRST THEN
          VALIDATE("Service Category", ServiceOrderObject."Service Category");
      END;

      IF "Order Kind" <> '' THEN
        UpdateServiceCategory;
    END;

    PROCEDURE GetServiceCategory@1100528640() ServiceCategory : Code[10];
    VAR
      ServiceContract@1100528600 : Record 11012812;
    BEGIN
      ServiceCategory := "Service Category";

      IF CURRENTCOMPANY <> COMPANYNAME THEN
        ServiceContract.CHANGECOMPANY(CURRENTCOMPANY);

      IF NOT ServiceContract.GET("Service Contract No.") THEN
        EXIT;
      IF NOT (ServiceContract."Budget Based on" IN
        [ServiceContract."Budget Based on"::Category, ServiceContract."Budget Based on"::"Category + Maintenance Scheme"])
      THEN
        EXIT;
      IF ServiceCategory = '' THEN BEGIN
        CASE "Source Type" OF
          "Source Type"::Call:
            ServiceCategory := ServiceContract."Service Category (Call)";
          "Source Type"::Direct:
            ServiceCategory := ServiceContract."Service Category (Direct)"
        END;
      END;
    END;

    PROCEDURE DetermineServicePackage@1100525041();
    VAR
      ServiceContract@1100525000 : Record 11012812;
    BEGIN
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        EXIT;
      CASE "Source Type" OF
        "Source Type"::Call:
          IF ServiceContract."Service Package Call" = '' THEN
            "Service Package" := ServiceContract."Service Package"
          ELSE
            "Service Package" := ServiceContract."Service Package Call";
        "Source Type"::Contract:
          IF ServiceContract."Service Package Contract" = '' THEN BEGIN
            "Service Package" := ServiceContract."Service Package";
            GetServiceCategoryFromServicePackage("Service Package")
          END ELSE BEGIN
            "Service Package" := ServiceContract."Service Package Contract";
            GetServiceCategoryFromServicePackage("Service Package");
          END;
        "Source Type"::Direct:
          IF ServiceContract."Service Package Other" = '' THEN
            "Service Package" := ServiceContract."Service Package"
          ELSE
            "Service Package" := ServiceContract."Service Package Other";
        "Source Type"::Estimate:
          IF ServiceContract."Service Package Estimate" = '' THEN
            "Service Package" := ServiceContract."Service Package"
          ELSE
            "Service Package" := ServiceContract."Service Package Estimate";
      END;
    END;

    PROCEDURE GetFilteredCausesByProblem@1100525043(Problem@1100409000 : Code[10];VAR ServiceAnalysis@1100409001 : Record 11012842);
    VAR
      ServiceAnalysisRelation@1100409002 : Record 11072238;
    BEGIN
      ServiceAnalysisRelation.SETRANGE("Problem Code", Problem);
      IF ServiceAnalysisRelation.FINDSET THEN BEGIN
        REPEAT
          ServiceAnalysis."Analysis Type" := ServiceAnalysis."Analysis Type"::Cause;
          ServiceAnalysis.Code := ServiceAnalysisRelation."Cause Code";
          ServiceAnalysis.MARK(TRUE);
          ServiceAnalysis.MARKEDONLY(TRUE);
        UNTIL ServiceAnalysisRelation.NEXT = 0;
      END;
    END;

    PROCEDURE GetFilteredSolutionsByProblemCause@1100525039(Problem@1100409000 : Code[20];Cause@1100409001 : Code[20];VAR ServiceAnalysis@1100409002 : Record 11012842);
    VAR
      ServiceAnalysisRelation@1100409003 : Record 11072238;
    BEGIN
      ServiceAnalysisRelation.SETRANGE("Problem Code", Problem);
      ServiceAnalysisRelation.SETRANGE("Cause Code", Cause);
      IF ServiceAnalysisRelation.FINDSET THEN BEGIN
        REPEAT
          ServiceAnalysis."Analysis Type" := ServiceAnalysis."Analysis Type"::Solution;
          ServiceAnalysis.Code := ServiceAnalysisRelation."Solution Code";
          ServiceAnalysis.MARK(TRUE);
          ServiceAnalysis.MARKEDONLY(TRUE);
        UNTIL ServiceAnalysisRelation.NEXT = 0;
      END;
    END;

    PROCEDURE GetFilteredProblemsOnDisciplines@1100409009(VAR ServiceAnalysis@1100409001 : Record 11012842);
    VAR
      Resource@1100409000 : Record 11229278;
      ServiceContractDiscipline@1100409004 : Record 11012881;
      ServiceLocationDiscipline@1100409003 : Record 11012844;
      ServiceAnalysisDiscipline@1100409002 : Record 11072198;
      DisciplineFilter@1100525000 : Text;
    BEGIN
      // dp00662
      IF NOT Resource.GET("Employee No.") THEN
        Resource.INIT;
      Resource.CALCFIELDS("Disciplines Exist");
      IF (Discipline <> '') OR Resource."Disciplines Exist" THEN BEGIN
         ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
         DisciplineFilter := Resource.GetDisciplineFilter;
         IF DisciplineFilter <> '' THEN
           DisciplineFilter += '|';
         IF Discipline <> '' THEN
           DisciplineFilter += Discipline
         ELSE
           DisciplineFilter += '''''';
         ServiceAnalysisDiscipline.SETFILTER(Discipline, DisciplineFilter);
         IF ServiceAnalysisDiscipline.FINDSET THEN BEGIN
           REPEAT
             IF ServiceAnalysis.GET(ServiceAnalysisDiscipline."Analysis Type", ServiceAnalysisDiscipline."Analysis Code") THEN BEGIN
               ServiceAnalysis.MARK(TRUE);
               ServiceAnalysis.MARKEDONLY(TRUE);
             END;
           UNTIL ServiceAnalysisDiscipline.NEXT = 0;
         END;
      END ELSE BEGIN
        IF "Service Contract No." <> '' THEN BEGIN
          ServiceContractDiscipline.SETRANGE("Service Contract No.", "Service Contract No.");
          IF ServiceContractDiscipline.FINDSET THEN BEGIN
            REPEAT
              ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
              ServiceAnalysisDiscipline.SETRANGE(Discipline, ServiceContractDiscipline.Discipline);
              IF ServiceAnalysisDiscipline.FINDSET THEN BEGIN
                REPEAT
                  IF ServiceAnalysis.GET(ServiceAnalysisDiscipline."Analysis Type", ServiceAnalysisDiscipline."Analysis Code") THEN BEGIN
                    ServiceAnalysis.MARK(TRUE);
                    ServiceAnalysis.MARKEDONLY(TRUE);
                  END;
                UNTIL ServiceAnalysisDiscipline.NEXT = 0;
              END;
            UNTIL ServiceContractDiscipline.NEXT = 0;
          END;
        END;

        IF "Service Location No." <> '' THEN BEGIN
          ServiceLocationDiscipline.SETRANGE("Service Location No.", "Service Location No.");
          IF ServiceLocationDiscipline.FINDSET THEN BEGIN
            REPEAT
              ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
              ServiceAnalysisDiscipline.SETRANGE(Discipline, ServiceLocationDiscipline.Discipline);
              IF ServiceAnalysisDiscipline.FINDSET THEN BEGIN
                REPEAT
                  IF ServiceAnalysis.GET(ServiceAnalysisDiscipline."Analysis Type", ServiceAnalysisDiscipline."Analysis Code") THEN BEGIN
                    ServiceAnalysis.MARK(TRUE);
                    ServiceAnalysis.MARKEDONLY(TRUE);
                  END;
                UNTIL ServiceAnalysisDiscipline.NEXT = 0;
              END;
            UNTIL ServiceLocationDiscipline.NEXT = 0;
          END;
        END;
      END;
    END;

    PROCEDURE UpdateWorkOrderInfo@1100528641(ICurrFieldNo@1100409000 : Integer);
    VAR
      WorkOrder@1100528600 : Record 11229279;
      WorkOrder2@1100529100 : Record 11229279;
      RecRef@1100528601 : RecordRef;
      FieldRef@1100528602 : FieldRef;
    BEGIN
      IF ICurrFieldNo = 0 THEN
        EXIT;
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
      IF WorkOrder.FINDSET THEN BEGIN
        IF WorkOrder.NEXT <> 0 THEN BEGIN
          IF NOT GUIALLOWED OR (ICurrFieldNo <= 1) THEN
            EXIT;
          RecRef.GETTABLE(Rec);
          IF ICurrFieldNo > 1 THEN
            FieldRef := RecRef.FIELD(ICurrFieldNo);
          IF ICurrFieldNo <> FIELDNO(Description) THEN BEGIN
            WorkOrder.SETFILTER("Schedule Relation", '<>%1', WorkOrder."Schedule Relation"::"Start-Start");
            IF WorkOrder.COUNT > 1 THEN
              IF ICurrFieldNo IN [FIELDNO("Last Possible Ending Date"), FIELDNO("Last Possible Ending Time"), FIELDNO("Closing Date"),
                                  FIELDNO("First Possible Starting Date"), FIELDNO("First Possible Starting Time")]
              THEN BEGIN
                MESSAGE(Text118, FieldRef.CAPTION);
                EXIT;
              END ELSE
                ERROR(Text117, FieldRef.CAPTION);
            IF WorkOrder.FINDSET THEN;
          END ELSE BEGIN
            WorkOrder2.COPY(WorkOrder);
            WorkOrder2.SETRANGE(Description, xRec.Description);
            IF WorkOrder2.COUNT <> WorkOrder.COUNT THEN BEGIN
              MESSAGE(Text118, FieldRef.CAPTION);
            END ELSE BEGIN
              IF WorkOrder2.FINDSET(TRUE) THEN
                REPEAT
                  WorkOrder2.Description := Description;
                  WorkOrder2.UpdateModifiedOnAndBy;
                  WorkOrder2.MODIFY(FALSE);
                UNTIL WorkOrder2.NEXT = 0;
            END;
            EXIT;
          END;
        END;
        MODIFY(ICurrFieldNo <> -10);
        WorkOrder.VALIDATE("Source No.");
        WorkOrder.UpdateModifiedOnAndBy;
        WorkOrder.UpdateLinkedWOs;
        WorkOrder.MODIFY(FALSE);
      END;
    END;

    PROCEDURE UpdateServiceOrderFinished@1100528642();
    VAR
      DocumentReferencePoint@1100528600 : Record 11020296;
    BEGIN
      DocumentReferencePoint.SETRANGE(Type, DocumentReferencePoint.Type::ServOrder);
      DocumentReferencePoint.SETRANGE("Document No.", "No.");
      IF NOT DocumentReferencePoint.FINDLAST THEN
        DocumentReferencePoint.INIT;
      "SO Finished (Field Service)" := DocumentReferencePoint.IsOrderFinished;
    END;

    PROCEDURE DetermineHouseNo@1100528643();
    VAR
      ObjectImpWorkSheetMgt@1100528600 : Codeunit 11012839;
    BEGIN
      "House No." := ObjectImpWorkSheetMgt.DetermineHouseNoAsInt(Address, "House No. Ext.");
    END;

    PROCEDURE UpdateCostPlusEntryDiscount@1100528644();
    VAR
      ServiceOrderCostPlusEntry@1100528600 : Record 11012825;
    BEGIN
      IF MODIFY THEN; //mg, 29-05-2015: C023298
      ServiceOrderCostPlusEntry.SetSkipDetermineChargeable(TRUE);
      ServiceOrderCostPlusEntry.CalcDiscount("No.");
    END;

    PROCEDURE DrillDownMeterReading@1100529011();
    VAR
      PlantMeterType@1100529002 : Record 11229921;
    BEGIN
      IF ("Plant Type" = '') OR ("Plant Number" = '') THEN
        EXIT;
      IF NOT PlantReadPermission THEN
        EXIT;
      TESTFIELD("No.");
      PlantMeterType.CHANGECOMPANY("Plant Company");
      PlantMeterType.ShowMeterReadings_General("Plant Type", "Plant Number", "Plant Meter", '', 2, "No.");
    END;

    PROCEDURE DrillDownServiceOrder@1100528806(OnServiceOrder@1100528800 : Code[20]);
    VAR
      ServiceOrderGeneralPage@1100528801 : Page 11125209;
    BEGIN
      GET(OnServiceOrder);
      ServiceOrderGeneralPage.SETRECORD(Rec);
      ServiceOrderGeneralPage.RUNMODAL;
    END;

    PROCEDURE GetMeterReading@1100528804(VAR OMeterReading@1100528801 : Decimal;VAR OMeterReadingType@1100528802 : Code[10];VAR OMeterReadingUnitOfMeasure@1100528803 : Code[10];VAR OMeterReadingDate@1100525000 : DateTime);
    VAR
      PlantMeterType@1100529000 : Record 11229921;
    BEGIN
      OMeterReading := 0;
      OMeterReadingType := '';
      OMeterReadingUnitOfMeasure := '';
      OMeterReadingDate := 0DT;
      IF ("Plant Type" = '') OR ("Plant Number" = '') THEN
        EXIT;
      IF NOT PlantReadPermission THEN
        EXIT;
      PlantMeterType.CHANGECOMPANY("Plant Company");
      PlantMeterType.DetermineMeterAndMeterType_PlantNo("Plant Type", "Plant Number", "Plant Meter", OMeterReadingType);
      IF ("Plant Meter" = '') OR (OMeterReadingType = '') THEN
        EXIT;
      OMeterReading := ActualMeterReadingForServiceOrder("Plant Type", "Plant Number", "Plant Meter", OMeterReadingType);
      OMeterReadingDate := PlantMeterType.ActualMeterReadingDateTime("Plant Type", "Plant Number", "Plant Meter", OMeterReadingType);
      IF PlantMeterType.GET("Plant Type", "Plant Number", "Plant Meter", OMeterReadingType) THEN BEGIN
        PlantMeterType.CALCFIELDS("Unit of Measure");
        OMeterReadingUnitOfMeasure := PlantMeterType."Unit of Measure";
      END;
    END;

    PROCEDURE PlantReadPermission@1100528805() : Boolean;
    VAR
      PlantSetup@1100528800 : Record 11012550;
    BEGIN
      IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlantSetup) THEN
        EXIT(TRUE);
    END;

    PROCEDURE ValidateBilltoContactPerson@1100528900() : Code[20];
    VAR
      Customer@1100528803 : Record 18;
      ServiceContact@1100528802 : Record 11012841;
    BEGIN
      IF (ServLocRec.GET("Service Location No.")) AND ("Bill-to Customer No." <> '') THEN
        IF Customer.GET("Bill-to Customer No.") THEN BEGIN
          Customer.CALCFIELDS("Contact No.");
          ServiceContact.SETRANGE("Service Location No.", "Service Location No.");
          ServiceContact.SETRANGE("Contact Company No.", Customer."Contact No.");
          ServiceContact.SETRANGE("Bill-to Contact Person", TRUE);
          IF ServiceContact.FINDFIRST THEN
            VALIDATE("Bill-to Contact Person", ServiceContact."Contact Person No.");
        END;
    END;

    PROCEDURE UpdateSOHours@1100528645();
    BEGIN
      IF "No." = '' THEN
        EXIT;
      UpdateSOSurchageBudgetLines;
      CheckBudgetHours;  //db, 02-03-15: C020552
      DetermineServiceCategory;
      MODIFY;
    END;

    PROCEDURE CheckBudgetHours@1100409011();
    BEGIN
      //db, 02-03-15: C020552
      CALCFIELDS("Budget Hours");
      IF "Budget Hours" <> 0 THEN BEGIN
        "Expected Hours" := "Budget Hours";
        "Duration Time" := "Expected Hours";
      END ELSE BEGIN
        IF "Duration Time" < "Expected Hours" THEN
          "Duration Time" := "Expected Hours";
      END;
      UpdateWorkOrderInfo(1);
    END;

    PROCEDURE ShowPurchaseOrdersForServiceOrder@1100528405();
    VAR
      PurchaseHeader@1100528400 : Record 38;
      ServicePurchaseOrderList@1100528401 : Page 11012877;
    BEGIN
      PurchaseHeader.MarkPurchaseOrdersOfServiceOrder("No.");
      PurchaseHeader.MARKEDONLY(TRUE);
      ServicePurchaseOrderList.SETTABLEVIEW(PurchaseHeader);
      ServicePurchaseOrderList.SetServiceOrderNo("No.");
      ServicePurchaseOrderList.RUNMODAL;
    END;

    PROCEDURE CommunicateOrderToFLS@1100528300(FunctionCode@1100528301 : Integer);
    VAR
      FLSVisiTourInterface@1100528300 : Codeunit 11072090;
    BEGIN
      //DP00703.n
      //FunctionCode
      //0: Create or modify call
      //1: Generate suggestions for appointment
      //2: Confirmation of appointment and planning
      //3: Cancellation (unconditionally)
      //4: Cancellation (if possible. If not -> ReturnCode 40 is geven)
      //5: Parking of appointment (planning is removed, order is stillin FLS)

      ServSetup.GET;
      IF (NOT ServSetup."FLS VisiTour Active") THEN
        EXIT;

      CASE FunctionCode OF
        0: FLSVisiTourInterface.CreateUpdateCall(Rec);
        1: FLSVisiTourInterface.PlanCall(Rec);
        3,4: FLSVisiTourInterface.DeleteCall(Rec, FunctionCode);
        ELSE ERROR(Text024);
      END;
    END;

    PROCEDURE CommunicateOrderFromFLS@1100409007();
    VAR
      FLSVisiTourInterface@1100528300 : Codeunit 11072090;
    BEGIN
      //DP00703.n
      ServSetup.GET;
      IF (NOT ServSetup."FLS VisiTour Active") THEN
        EXIT;
      FLSVisiTourInterface.ShowCallInfo(Rec);
    END;

    PROCEDURE UpdateFirstLastPossibleFields@1100409010();
    VAR
      PlanningAgreement@1100409000 : Record 11071729;
    BEGIN
      ServSetup.GET;
      IF NOT ServSetup."Use Planning Agreement on SO" THEN
        EXIT;
      IF "Source Type" <> "Source Type"::Contract THEN
        EXIT;
      IF "First Possible Starting Date" = 0D THEN
        VALIDATE("First Possible Starting Date", "Starting Date");
      IF "Last Possible Ending Date" = 0D THEN
        VALIDATE("Last Possible Ending Date", "Ending Date");
      IF "Starting Time" = 0T THEN
        EXIT;
      IF ("Starting Date" <> "Ending Date") AND ("Ending Date" <> 0D) THEN
        EXIT;
      PlanningAgreement.GetPlanningAgreementTimes("Starting Time", "First Possible Starting Time", "Last Possible Ending Time");
      IF "First Possible Starting Time" <> 0T THEN
        VALIDATE("First Possible Starting Time");
      IF "Last Possible Ending Time" <> 0T THEN
        VALIDATE("Last Possible Ending Time");
    END;

    PROCEDURE GetInvoiceInProcessLCY@1100529100() : Decimal;
    VAR
      SalesLine@1100529100 : Record 37;
      AmountInvoice@1100529101 : Decimal;
      AmountCreditMemo@1100529102 : Decimal;
    BEGIN
      //C026176.sn
      IF "No." = '' THEN
        EXIT(0);
      //C026176.en

      SalesLine.SETRANGE("Service Order No.", "No.");
      SalesLine.SETFILTER(
        "Document Type", '%1|%2|%3', SalesLine."Document Type"::Invoice,
        SalesLine."Document Type"::"Credit Memo", SalesLine."Document Type"::"Invoice Proposal");
      IF SalesLine.FINDSET THEN BEGIN
        REPEAT
          IF (SalesLine."Document Type" = SalesLine."Document Type"::Invoice) OR
             (SalesLine."Document Type" = SalesLine."Document Type"::"Invoice Proposal")
          THEN
            AmountInvoice += SalesLine."Amount (LCY)";
          IF SalesLine."Document Type" = SalesLine."Document Type"::"Credit Memo" THEN
            AmountCreditMemo += SalesLine."Amount (LCY)";
        UNTIL SalesLine.NEXT = 0;
      END;
      EXIT(AmountInvoice - AmountCreditMemo);
    END;

    PROCEDURE DetermineObjectNo@1100525046();
    VAR
      LocationServiceObject@1100525003 : Record 11071691;
      ServiceObject@1100525001 : Record 11071691;
      ServiceLocation@1100525000 : Record 11012801;
      ServiceContractObject@1100525002 : Record 11071702;
      ServiceContract@1100525005 : Record 11012812;
      FoundServiceObjectNo@1100525004 : Code[20];
      ServiceOrderObject@1100525006 : Record 11071724;
      ServiceCall@1100525008 : Record 11012822;
      ContinueBln@1100525007 : Boolean;
    BEGIN
      //db, 16-03-15: C019952
      //- function copied from Service Call, but object is flowfield for Service Order
      //- skip update for Source Type where more then 1 object is common

      IF "Decentral Created" THEN EXIT;  //db, 15-05-15

      CASE "Source Type" OF
        "Source Type"::Call:
          BEGIN
            IF NOT ServiceCall.GET("Call No.") THEN ServiceCall.INIT;
            ContinueBln := (ServiceCall."Object No." = '');
          END;
        "Source Type"::Contract: ContinueBln := FALSE;
        "Source Type"::Direct: ContinueBln := TRUE;
        "Source Type"::Estimate: ContinueBln := TRUE;
        "Source Type"::Modification: ContinueBln := FALSE;
        "Source Type"::Replacement: ContinueBln := FALSE;
      END;
      IF ContinueBln = FALSE THEN EXIT;

      IF "Service Contract No." <> '' THEN BEGIN
        ServiceContract.GET("Service Contract No.");
        ServiceContractObject.SETRANGE("Service Contract No.", "Service Contract No.");
        ServiceContractObject.SETRANGE(Blocked, FALSE);
        IF "Service Location No." <> '' THEN
          ServiceContractObject.SETRANGE("Service Location No.", "Service Location No.");
        IF ServiceContractObject.FINDFIRST THEN BEGIN
          IF ServiceContractObject.NEXT = 0 THEN
            FoundServiceObjectNo := ServiceContractObject."Service Object No."
          ELSE BEGIN
            IF ServiceLocation.GET("Service Location No.") THEN BEGIN
              ServiceLocation.GetRelatedObjects(LocationServiceObject);
              LocationServiceObject.SETRANGE(Blocked, FALSE);
              ServiceContractObject.FINDSET;
              ServiceObject.MARKEDONLY(TRUE);
              REPEAT
                LocationServiceObject.SETRANGE("No.", ServiceContractObject."Service Object No.");
                IF NOT LocationServiceObject.ISEMPTY THEN BEGIN
                  ServiceObject."No." := ServiceContractObject."Service Object No.";
                  ServiceObject.MARK(TRUE);
                END;
              UNTIL (ServiceObject.COUNT > 1) OR (ServiceContractObject.NEXT = 0);
              IF ServiceObject.FINDFIRST AND (ServiceObject.NEXT = 0) THEN
                FoundServiceObjectNo := ServiceObject."No.";
            END;
          END;
        END;
      END;
      IF (ServiceContract."Contract Form" <> ServiceContract."Contract Form"::"Framework Contract") AND
         (FoundServiceObjectNo = '') AND ("Service Location No." <> '')
      THEN BEGIN
        IF ServiceLocation.GET("Service Location No.") THEN BEGIN
          ServiceLocation.GetRelatedObjects(LocationServiceObject);
          LocationServiceObject.SETRANGE(Blocked, FALSE);
          IF LocationServiceObject.FINDFIRST AND (LocationServiceObject.NEXT = 0) THEN
            FoundServiceObjectNo := LocationServiceObject."No.";
        END;
      END;

      IF (FoundServiceObjectNo <> '') OR
         (ServiceContract."Contract Form" = ServiceContract."Contract Form"::"Framework Contract")
      THEN BEGIN
        {
        //db, 15-05-15: skip fysical insert object; just determine object
        ServiceOrderObject.SETRANGE("Service Order No.", "No.");
        ServiceOrderObject.DELETEALL;
        //
        ServiceOrderObject.INIT;
        ServiceOrderObject.VALIDATE("Service Order No.", "No.");
        ServiceOrderObject.VALIDATE("Object No.", FoundServiceObjectNo);
        ServiceOrderObject.VALIDATE("Service Contract No.", "Service Contract No.");
        CASE "Source Type" OF
          "Source Type"::Call: ServiceOrderObject.Source := ServiceOrderObject.Source::Calls;
          "Source Type"::Contract: ServiceOrderObject.Source := ServiceOrderObject.Source::Maintenance;
          "Source Type"::Direct: ServiceOrderObject.Source := ServiceOrderObject.Source::Other;
          "Source Type"::Estimate: ServiceOrderObject.Source := ServiceOrderObject.Source::Other;
          "Source Type"::Modification: ServiceOrderObject.Source := ServiceOrderObject.Source::Modifications;
          "Source Type"::Replacement: ServiceOrderObject.Source := ServiceOrderObject.Source::Replacements;
        END;
        ServiceOrderObject.INSERT(TRUE);
        }
        //C030866.so
      //  ServiceContractNo := MaintenanceManagementCU.GetActualContractForObject(FoundServiceObjectNo, TODAY);
      //  IF ServiceContractNo <> '' THEN
      //    IF "Service Contract No." = '' THEN
      //      VALIDATE("Service Contract No.", ServiceContractNo)
      //    ELSE
      //      TESTFIELD("Service Contract No.", ServiceContractNo);
        //C030866.eo
      END;
    END;

    PROCEDURE GetBillToLanguageCode@1100528409() : Code[10];
    VAR
      Customer@1100528400 : Record 18;
    BEGIN
      IF "Bill-to Customer No." = '' THEN
        EXIT('');

      IF Customer.GET("Bill-to Customer No.") THEN
        EXIT(Customer."Language Code");
    END;

    PROCEDURE DetermineContractNo@1100528646();
    VAR
      ServiceLocationInfoMgt@1100528600 : Codeunit 11012856;
      ActualServiceContractNo@1100528601 : Code[20];
      ServiceContract@1100527300 : Record 11012812;
      ServiceSetup@1100528200 : Record 11012800;
    BEGIN
      ServiceSetup.GET;
      IF ("Service Location No." <> '') AND (ServiceSetup."Use Contract from Location") THEN BEGIN
        ActualServiceContractNo := ServiceLocationInfoMgt.GetActualContractFromLocation("Service Location No.", '', TODAY);
        IF ActualServiceContractNo <> '' THEN
          VALIDATE("Service Contract No.", ActualServiceContractNo)
        ELSE
          IF CurrFieldNo = FIELDNO("Service Location No.") THEN BEGIN
            FindServiceContracts(ServiceContract);
            IF ServiceContract.COUNT = 1 THEN BEGIN
              ServiceContract.FINDFIRST;
              IF (ServiceContract.Status <> ServiceContract.Status::Offered) AND (ServiceContract.Status <> ServiceContract.Status::Applied) THEN
                VALIDATE("Service Contract No.", ServiceContract."No.");
            END;
          END;
      END;
    END;

    PROCEDURE GetPublishSubcontPort@1100528647() : Boolean;
    VAR
      SubcontPortSetup@1100528600 : Record 11126402;
      WorkOrder@1100528601 : Record 11229279;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(SubcontPortSetup) THEN
        EXIT;

      IF NOT SubcontPortSetup.GET('1') THEN
        EXIT;
      IF NOT SubcontPortSetup."Subcontracting Portal Active" THEN
        EXIT;

      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Subcontractor);
      WorkOrder.SETFILTER("Resource No.", '<>%1', '');
      WorkOrder.SETRANGE("Publish on Subcontr. Portal", TRUE);
      EXIT(NOT WorkOrder.ISEMPTY);
    END;

    PROCEDURE TogglePublishSubcontPort@1100528648(IPublish@1100528602 : Boolean);
    VAR
      CTRLSetup@1100528302 : Record 11125686;
      SubcontPortSetup@1100528300 : Record 11126402;
      WorkOrder@1100528600 : Record 11229279;
      TmpSkipPurch@1100528605 : TEMPORARY Record 11012005;
      FPSLicenseManagement@1100528301 : Codeunit 11229289;
      SkipCreatePurchOrder@1100528604 : Boolean;
    BEGIN
      IF (NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(CTRLSetup)) THEN
        CTRLSetup.Active := FALSE
      ELSE
        CTRLSetup.GET;
      SubcontPortSetup.GET('1');
      IF (NOT SubcontPortSetup."Subcontracting Portal Active") AND (NOT CTRLSetup.Active) THEN
        ERROR(CtrlOrSubContrActiveTxt, SubcontPortSetup.TABLECAPTION,
          SubcontPortSetup.FIELDCAPTION("Subcontracting Portal Active"), CTRLSetup.TABLECAPTION,
          CTRLSetup.FIELDCAPTION(Active));

      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Subcontractor);
      WorkOrder.SETRANGE("Publish on Subcontr. Portal", NOT IPublish);
      WorkOrder.SETFILTER("Resource No.", '<>%1', '');
      IF NOT WorkOrder.ISEMPTY THEN BEGIN
        IF WorkOrder.FINDSET(TRUE, FALSE) THEN
          REPEAT
            SkipCreatePurchOrder := TmpSkipPurch.GET(WorkOrder."Source No.", WorkOrder."Resource No.");
            WorkOrder.SetCollectivePublishSubcPortalRun(SkipCreatePurchOrder);
            WorkOrder.VALIDATE("Publish on Subcontr. Portal", IPublish);
            WorkOrder.MODIFY(TRUE);
            IF NOT SkipCreatePurchOrder THEN BEGIN
              TmpSkipPurch."Project No." := WorkOrder."Source No.";
              TmpSkipPurch.Principal := WorkOrder."Resource No.";
              TmpSkipPurch.INSERT;
            END;
          UNTIL WorkOrder.NEXT = 0;
      END;
    END;

    PROCEDURE ShowServiceEntries@1100528649(IType@1100525001 : Integer);
    VAR
      ServiceLedgerEntry@1100525000 : Record 11012819;
    BEGIN
      ServiceLedgerEntry.SETCURRENTKEY("Service Order No.");
      ServiceLedgerEntry.SETRANGE("Service Order No.", "No.");
      IF IType = 0 THEN BEGIN
        ServiceLedgerEntry.SETRANGE("Cost Present", TRUE);
        MESSAGE(Text120);
      END ELSE BEGIN
        ServiceLedgerEntry.SETRANGE("Revenue Present", TRUE);
        MESSAGE(Text121);
      END;
      PAGE.RUNMODAL(PAGE::"Service Entry List", ServiceLedgerEntry);
    END;

    PROCEDURE FillPreferredEmployee@1100528650();
    VAR
      PreferredEmployee@1100528600 : Record 11012843;
      ServiceOrderObject@1100528601 : Record 11071724;
      ResourceWOP@1100528607 : Record 11229278;
      ObjectNo@1100528602 : Code[20];
      MaintenanceScheme@1100528603 : Code[20];
      DummyOption@1100528604 : Option;
      Origin@1100528605 : ' ,Call,Service Order';
      PreferredEmployeeNo@1100528606 : Code[20];
    BEGIN
      IF "Source Type" IN ["Source Type"::Call, "Source Type"::Contract, "Source Type"::Direct] THEN BEGIN
        ServiceOrderObject.SETRANGE("Service Order No.", "No.");
        IF ServiceOrderObject.FINDFIRST THEN BEGIN
          ObjectNo := ServiceOrderObject."Object No.";
          MaintenanceScheme := ServiceOrderObject."Maintenance Scheme";
        END;
      END;

      PreferredEmployeeNo :=
        PreferredEmployee.GetPreferredEmployee(
          "Service Contract No.", "Service Location No.", ObjectNo, MaintenanceScheme, "No.", Discipline, "Trade Speciality", "Starting Date", DummyOption, Origin::"Service Order");

      IF PreferredEmployeeNo = "Preferred Employee No." THEN
        EXIT;

      IF "Preferred Employee No." <> '' THEN
        IF GUIALLOWED THEN
          IF NOT CONFIRM(Text018, TRUE,
            FIELDCAPTION("Preferred Employee No."),
            "Preferred Employee No.", ResourceWOP.GetResourceName("Preferred Employee No."),
            PreferredEmployeeNo, ResourceWOP.GetResourceName(PreferredEmployeeNo))
          THEN
            EXIT;
      VALIDATE("Preferred Employee No.", PreferredEmployeeNo);
    END;

    LOCAL PROCEDURE ShowPreferredEmployee@1100528651();
    VAR
      PreferredEmployee@1100528600 : Record 11012843;
      ServiceOrderObject@1100528605 : Record 11071724;
      ObjectNo@1100528604 : Code[20];
      MaintenanceScheme@1100528603 : Code[20];
    BEGIN
      IF "Source Type" IN ["Source Type"::Call, "Source Type"::Contract, "Source Type"::Direct] THEN BEGIN
        ServiceOrderObject.SETRANGE("Service Order No.", "No.");
        IF ServiceOrderObject.FINDFIRST THEN BEGIN
          ObjectNo := ServiceOrderObject."Object No.";
          MaintenanceScheme := ServiceOrderObject."Maintenance Scheme";
        END;
      END;
      PreferredEmployee.AssistEditPreferredEmployee("Service Contract No.", "Service Location No.", ObjectNo, MaintenanceScheme, '');
    END;

    PROCEDURE SetSkipUpdateServiceText@1100525045(Value@1100525000 : Boolean);
    BEGIN
      SkipUpdateServiceText := Value;
    END;

    LOCAL PROCEDURE ApplyProblemCodeAdditionalInfo@1100528652();
    VAR
      ServiceAnalysis@1100528600 : Record 11012842;
      ServiceAnalysisDiscipline@1100528601 : Record 11072198;
    BEGIN
      IF ServiceAnalysis.GET(ServiceAnalysis."Analysis Type"::Problem, Problem) THEN BEGIN
        IF ServiceAnalysis.Priority <> '' THEN
          VALIDATE(Priority, ServiceAnalysis.Priority);
        IF ServiceAnalysis."Expected Hours" <> 0 THEN BEGIN
          "Expected Hours" := ServiceAnalysis."Expected Hours";
          CheckBudgetHours;
          VALIDATE("Expected Hours");
        END;
        ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
        ServiceAnalysisDiscipline.SETRANGE("Analysis Code", Problem);
        IF ServiceAnalysisDiscipline.FINDSET THEN
          IF ServiceAnalysisDiscipline.NEXT = 0 THEN
            VALIDATE(Discipline, ServiceAnalysisDiscipline.Discipline);
      END;
    END;

    PROCEDURE SetSuppressAutoRecalculateCollectiveList@1100528654(ISuppressAutoRecalculateCollectiveList@1100528600 : Boolean);
    BEGIN
      SuppressAutoRecalculateCollectiveList := ISuppressAutoRecalculateCollectiveList;
    END;

    PROCEDURE GetRoomDescription@1100525047() : Text[50];
    VAR
      SUPRoom@1100525000 : Record 11071950;
      ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
      CustomerNo@1100528601 : Code[20];
    BEGIN
      IF ServiceUnitPriceManagement.CustomerHasCustomizations("Customer No.") THEN
        CustomerNo := "Customer No.";
      IF SUPRoom.GET(CustomerNo, "Room (SUP)") THEN
        EXIT(SUPRoom.Description);
    END;

    PROCEDURE GetPartDescription@1100525048() : Text[50];
    VAR
      SUPPart@1100525000 : Record 11071951;
      ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
      CustomerNo@1100528601 : Code[20];
    BEGIN
      IF ServiceUnitPriceManagement.CustomerHasCustomizations("Customer No.") THEN
        CustomerNo := "Customer No.";
      IF SUPPart.GET(CustomerNo, "Part (SUP)") THEN
        EXIT(SUPPart.Description);
    END;

    LOCAL PROCEDURE DeterminePriceBookFields@1100528657();
    VAR
      ServiceContract@1100528601 : Record 11012812;
      Customer@1100528600 : Record 18;
      ServiceOrderExtension@1100528602 : Record 11071727;
      DoCustomerLevel@1100529000 : Boolean;
      CustomerNo@1100529600 : Code[20];
    BEGIN
      IF NOT ("Source Type" IN ["Source Type"::Call, "Source Type"::Direct]) THEN
        EXIT;
      IF SkipDeterminePriceBookFields THEN
        EXIT;
      IF "Use Bill-To Cust. for Pr. Book" THEN
        CustomerNo := "Bill-to Customer No.";
      IF CustomerNo = '' THEN
        CustomerNo := "Customer No.";

      ServiceOrderExtension.GetServOrderExtension("No.");
      IF "Service Contract No." <> '' THEN BEGIN
        ServiceContract.GET("Service Contract No.");
        DoCustomerLevel := (CustomerNo <> '') AND
         ((ServiceContract."Price Book Type" = ServiceContract."Price Book Type"::None) OR (ServiceContract."Price Book Code" = ''));
        IF (ServiceContract."Price Book Type" <> ServiceContract."Price Book Type"::None) AND (NOT DoCustomerLevel) THEN BEGIN
          IF (ServiceOrderExtension."Price Book Code" <> ServiceContract."Price Book Code") AND (ServiceOrderExtension."Price Book Code" <> '') THEN
            IF GUIALLOWED THEN
              IF NOT CONFIRM(Text132) THEN
                EXIT;
          IF ("Price Book Type" <> ServiceContract."Price Book Type") OR
             (ServiceOrderExtension."Price Book Code" <> ServiceContract."Price Book Code") OR
             (ServiceOrderExtension."Price Book Code" <> ServiceContract."Price Book Code")
          THEN
            CheckSUPRecordingLines;
          IF "Price Book Type" <> ServiceContract."Price Book Type" THEN
            VALIDATE("Price Book Type", ServiceContract."Price Book Type");
          IF MODIFY(TRUE) THEN;
          IF ServiceOrderExtension."Price Book Code" <> ServiceContract."Price Book Code" THEN
            ServiceOrderExtension.VALIDATE("Price Book Code", ServiceContract."Price Book Code");
          IF ServiceOrderExtension."Price Book Index Date" <> ServiceContract."Price Book Index Date" THEN
            ServiceOrderExtension.VALIDATE("Price Book Index Date", ServiceContract."Price Book Index Date");
          IF ServiceOrderExtension."Unit Price Set" <> ServiceContract."Unit Price Set" THEN
            ServiceOrderExtension.VALIDATE("Unit Price Set", ServiceContract."Unit Price Set");
          IF "Unit Price Status" <> ServiceContract."Unit Price Status" THEN
            VALIDATE("Unit Price Status", ServiceContract."Unit Price Status");
        END;
      END;
      IF (CustomerNo <> '') AND (("Service Contract No." = '') OR DoCustomerLevel) THEN BEGIN
        Customer.GET(CustomerNo);
        IF Customer."Price Book Type" <> Customer."Price Book Type"::None THEN BEGIN
          IF (ServiceOrderExtension."Price Book Code" <> Customer."Price Book Code") AND (ServiceOrderExtension."Price Book Code" <> '') THEN
            IF GUIALLOWED THEN
              IF NOT CONFIRM(Text132) THEN
                EXIT;
          IF ("Price Book Type" <> Customer."Price Book Type") OR
             (ServiceOrderExtension."Price Book Code" <> Customer."Price Book Code") OR
             (ServiceOrderExtension."Price Book Code" <> Customer."Price Book Code")
          THEN
            CheckSUPRecordingLines;
          IF "Price Book Type" <> Customer."Price Book Type" THEN
            VALIDATE("Price Book Type", Customer."Price Book Type");
          IF MODIFY(TRUE) THEN;
          IF ServiceOrderExtension."Price Book Code" <> Customer."Price Book Code" THEN
            ServiceOrderExtension.VALIDATE("Price Book Code", Customer."Price Book Code");
          IF ServiceOrderExtension."Price Book Index Date" <> Customer."Price Book Index Date" THEN
            ServiceOrderExtension.VALIDATE("Price Book Index Date", Customer."Price Book Index Date");
          IF ServiceOrderExtension."Unit Price Set" <> Customer."Unit Price Set" THEN
            ServiceOrderExtension.VALIDATE("Unit Price Set", Customer."Unit Price Set");
          IF "Unit Price Status" <> Customer."Unit Price Status" THEN
            VALIDATE("Unit Price Status", Customer."Unit Price Status");
        END;
      END;
      ServiceOrderExtension.UpdateServOrderExtension("No.");
      ServiceOrderExtension.ValidateUnitPriceFieldsIncDate(Rec);
    END;

    PROCEDURE CheckServTypePosting@1100529400() : Boolean;
    VAR
      ServiceType@1100525002 : Record 11012814;
      ServiceTypeOther@1100525003 : Record 11012814;
    BEGIN
      //T006898
      ServiceType.GET("Service Type");
      ServiceTypeOther.GET("Service Type (Other)");

      EXIT(NOT ServiceType."No Closing Ledger Entries" OR NOT ServiceTypeOther."No Closing Ledger Entries");
    END;

    LOCAL PROCEDURE UpdateServiceCategory@1100528658();
    VAR
      ServiceOrderIndication@1100528600 : Record 11012837;
      ServiceCategory@1100528601 : Record 11071985;
      ServiceContract@1100528602 : Record 11012812;
    BEGIN
      IF "Order Kind" = '' THEN
        EXIT;
      IF "Service Contract No." = '' THEN
        EXIT;
      IF NOT ServiceOrderIndication.GET(ServiceOrderIndication.Indication::Kind, "Order Kind") THEN
        EXIT;
      IF ServiceOrderIndication."Service Category" = '' THEN
        EXIT;
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        EXIT;
      IF NOT (ServiceContract."Budget Based on" IN
        [ServiceContract."Budget Based on"::Category, ServiceContract."Budget Based on"::"Category + Maintenance Scheme"])
      THEN
        EXIT;
      ServiceCategory.GET("Service Contract No.", ServiceOrderIndication."Service Category");
      VALIDATE("Service Category", ServiceOrderIndication."Service Category");
    END;

    LOCAL PROCEDURE UpdateAppointmentConfirmationResend@1100528659();
    VAR
      ServiceOrderExtension@1100528600 : Record 11071727;
      OldServiceOrder@1100528601 : Record 11012823;
      SCCustSourceTypeSetup@1100529500 : Record 11071800;
      AppointmentManagement@1100528602 : Codeunit 11012865;
      OldPlanningAgreementCode@1100528603 : Code[10];
      NewPlanningAgreementCode@1100528604 : Code[10];
    BEGIN
      SCCustSourceTypeSetup.GetAppointmentInfoByServiceOrder(Rec, SCCustSourceTypeSetup);
      IF SCCustSourceTypeSetup."Appointments by" = SCCustSourceTypeSetup."Appointments by"::" " THEN
        EXIT;

      OldServiceOrder.GET("No.");
      OldPlanningAgreementCode := AppointmentManagement.GetPlanningAgreementCodeByTime(OldServiceOrder."Starting Time");
      NewPlanningAgreementCode := AppointmentManagement.GetPlanningAgreementCodeByTime("Starting Time");
      IF (OldServiceOrder."Starting Date" <> "Starting Date") OR (OldPlanningAgreementCode <> NewPlanningAgreementCode) THEN BEGIN
        ServiceOrderExtension.GetServOrderExtension("No.");
        IF ("Starting Date" <> 0D) AND ("Starting Time" <> 0T) AND
           (NewPlanningAgreementCode <> '') AND
           (ServiceOrderExtension."Date Appointm. Confirm. Sent" <> 0D)
        THEN BEGIN
          ServiceOrderExtension.VALIDATE("Resend Appointm. Confirmation", TRUE);
          ServiceOrderExtension.UpdateServOrderExtension("No.");
        END;
      END;
      "SMS Reminder Sent" := FALSE;
    END;

    PROCEDURE GetFullStartingDate@1100528660(ILanguageID@1100528600 : Integer) : Text;
    BEGIN
      CASE ILanguageID OF
        1043:
          EXIT(FORMAT("Starting Date", 0, '<Weekday Text> <Day> <Month Text> <Year4>'));
      ELSE
        EXIT(FORMAT("Starting Date"));
      END;
    END;

    LOCAL PROCEDURE DetermineTenantID@1100528653();
    VAR
      ServiceLocation@1100528600 : Record 11012801;
    BEGIN
      IF NOT ServiceLocation.GET("Service Location No.") THEN
        ServiceLocation.INIT;
      VALIDATE("Tenant No.", ServiceLocation."Tenant No.");
    END;

    LOCAL PROCEDURE CheckOrderNoCustomer@1100529401();
    VAR
      ServiceCall@1100525000 : Record 11012822;
    BEGIN
      IF NOT GUIALLOWED OR ("Order No. Customer" = '') OR ("Customer No." = '') THEN EXIT;

      ServiceCall.SETCURRENTKEY("Customer No.");
      ServiceCall.SETRANGE("Customer No.", "Customer No.");
      ServiceCall.SETRANGE("Order No. Customer", "Order No. Customer");
      ServiceCall.SETFILTER("No.", '<>%1', "No.");
      IF ServiceCall.FINDFIRST THEN
        MESSAGE(Text122,
          FIELDCAPTION("Order No. Customer"), "Order No. Customer",
          FIELDCAPTION("Customer No."), "Customer No.",
          ServiceCall.TABLECAPTION, ServiceCall."No.");
    END;

    PROCEDURE TestServiceContractMandatory@1100528661();
    BEGIN
      IF IsServiceContractMandatory THEN
        TESTFIELD("Service Contract No.");
    END;

    PROCEDURE IsServiceContractMandatory@1100528662() : Boolean;
    VAR
      ServiceSetup@1100528600 : Record 11012800;
    BEGIN
      IF CURRENTCOMPANY <> COMPANYNAME THEN
        ServiceSetup.CHANGECOMPANY(CURRENTCOMPANY);
      ServiceSetup.GET;
      EXIT(ServiceSetup."Serv. Contract Mandatory on SO");
    END;

    LOCAL PROCEDURE DetermineAlternativeBilltoAddress@1100528763();
    VAR
      ShiptoAddress@1100528600 : Record 222;
    BEGIN
      IF ShiptoAddress.GetAlternativeBilltoAddress("Bill-to Customer No.", ShiptoAddress.Code) THEN
        VALIDATE("Alternative Bill-to Address", ShiptoAddress.Code);
    END;

    PROCEDURE InvoiceDataDiffersFromBaseOrder@1100528664() : Boolean;
    VAR
      ServiceOrder@1100528600 : Record 11012823;
    BEGIN
      IF "Base Service Order No." <> "No." THEN BEGIN
        ServiceOrder.GET("Base Service Order No.");
        IF (ServiceOrder."Customer No." <> "Customer No.") OR
           (ServiceOrder."Bill-to Customer No." <> "Bill-to Customer No.") OR
           (ServiceOrder."Alternative Bill-to Address" <> "Alternative Bill-to Address") OR
           (ServiceOrder."Bill-to Contact Person" <> "Bill-to Contact Person") OR
           (ServiceOrder."Currency Code" <> "Currency Code")
        THEN
          EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE UpdateInvoiceDataBaseServiceOrderTree@1100528665(IFieldNo@1100528600 : Integer);
    VAR
      OldServiceOrder@1100528602 : Record 11012823;
      ServiceOrder@1100528601 : Record 11012823;
    BEGIN
      IF "Base Service Order No." <> "No." THEN
        EXIT;
      OldServiceOrder.GET("No.");
      ServiceOrder.SETCURRENTKEY("Base Service Order No.");
      ServiceOrder.SETRANGE("Base Service Order No.", "No.");
      ServiceOrder.SETFILTER("No.", '<>%1', "No.");
      CASE IFieldNo OF
        FIELDNO("Customer No."):
          ServiceOrder.SETRANGE("Customer No.", OldServiceOrder."Customer No.");
        FIELDNO("Bill-to Customer No."):
          ServiceOrder.SETRANGE("Bill-to Customer No.", OldServiceOrder."Bill-to Customer No.");
        FIELDNO("Alternative Bill-to Address"):
          BEGIN
            ServiceOrder.SETRANGE("Bill-to Customer No.", OldServiceOrder."Bill-to Customer No.");
            ServiceOrder.SETRANGE("Alternative Bill-to Address", OldServiceOrder."Alternative Bill-to Address");
          END;
        FIELDNO("Bill-to Contact Person"):
          BEGIN
            ServiceOrder.SETRANGE("Bill-to Customer No.", OldServiceOrder."Bill-to Customer No.");
            ServiceOrder.SETRANGE("Bill-to Contact Person", OldServiceOrder."Bill-to Contact Person");
          END;
        FIELDNO("Currency Code"):
          BEGIN
            ServiceOrder.SETRANGE("Bill-to Customer No.", OldServiceOrder."Bill-to Customer No.");
            ServiceOrder.SETRANGE("Currency Code", OldServiceOrder."Currency Code");
          END;
      ELSE
        EXIT;
      END;
      IF ServiceOrder.FINDSET THEN
        REPEAT
          CASE IFieldNo OF
            FIELDNO("Customer No."):
              ServiceOrder.VALIDATE("Customer No.", "Customer No.");
            FIELDNO("Bill-to Customer No."):
              ServiceOrder.VALIDATE("Bill-to Customer No.", "Bill-to Customer No.");
            FIELDNO("Alternative Bill-to Address"):
              ServiceOrder.VALIDATE("Alternative Bill-to Address", "Alternative Bill-to Address");
            FIELDNO("Bill-to Contact Person"):
              ServiceOrder.VALIDATE("Bill-to Contact Person", "Bill-to Contact Person");
            FIELDNO("Currency Code"):
              ServiceOrder.VALIDATE("Currency Code", "Currency Code");
          END;
          ServiceOrder.MODIFY(TRUE);
        UNTIL ServiceOrder.NEXT = 0;
    END;

    PROCEDURE PropagateServiceControlPeriodDate@1100528964();
    VAR
      ServiceLedgerEntry@1100528600 : Record 11012819;
      PurchaseOrderControlLine@1100528606 : Record 11020221;
      ItemJournalLine@1100528601 : Record 83;
      ItemJournalSurcharge@1100528602 : Record 11020585;
      HourAccountingLine@1100528603 : Record 11012039;
      HourAccountingSurcharge@1100528604 : Record 11020308;
      PostedHourLine@1100528605 : Record 11012085;
    BEGIN
      IF Status = Status::Finished THEN
        FIELDERROR(Status);
      TESTFIELD("Service Control Period Date");

      ServiceLedgerEntry.SETCURRENTKEY("Service Order No.");
      ServiceLedgerEntry.SETRANGE("Service Order No.", "No.");
      IF NOT ServiceLedgerEntry.ISEMPTY THEN
        ServiceLedgerEntry.MODIFYALL("Service Control Period Date", "Service Control Period Date");

      PurchaseOrderControlLine.SETCURRENTKEY("Service Order No.");
      PurchaseOrderControlLine.SETRANGE("Service Order No.", "No.");
      IF NOT PurchaseOrderControlLine.ISEMPTY THEN
        PurchaseOrderControlLine.MODIFYALL("Service Control Period Date", "Service Control Period Date");

      ItemJournalLine.SETCURRENTKEY("Service Order No.");
      ItemJournalLine.SETRANGE("Service Order No.", "No.");
      IF NOT ItemJournalLine.ISEMPTY THEN
        ItemJournalLine.MODIFYALL("Service Control Period Date", "Service Control Period Date");

      ItemJournalSurcharge.SETCURRENTKEY("Service Order No.");
      ItemJournalSurcharge.SETRANGE("Service Order No.", "No.");
      IF NOT ItemJournalSurcharge.ISEMPTY THEN
        ItemJournalSurcharge.MODIFYALL("Service Control Period Date", "Service Control Period Date");

      HourAccountingLine.SETCURRENTKEY("Service Order No.");
      HourAccountingLine.SETRANGE("Service Order No.", "No.");
      IF NOT HourAccountingLine.ISEMPTY THEN
        HourAccountingLine.MODIFYALL("Service Control Period Date", "Service Control Period Date");

      HourAccountingSurcharge.SETCURRENTKEY("Service Order No.");
      HourAccountingSurcharge.SETRANGE("Service Order No.", "No.");
      IF NOT HourAccountingSurcharge.ISEMPTY THEN
        HourAccountingSurcharge.MODIFYALL("Service Control Period Date", "Service Control Period Date");

      PostedHourLine.SETCURRENTKEY("Service Order No.");
      PostedHourLine.SETRANGE("Service Order No.", "No.");
      IF NOT PostedHourLine.ISEMPTY THEN
        PostedHourLine.MODIFYALL("Service Control Period Date", "Service Control Period Date");
    END;

    PROCEDURE PropagateServiceCategory@1100528965();
    VAR
      ServiceLedgerEntry@1100528600 : Record 11012819;
      PurchaseOrderControlLine@1100528606 : Record 11020221;
      ItemJournalLine@1100528601 : Record 83;
      ItemJournalSurcharge@1100528602 : Record 11020585;
      HourAccountingLine@1100528603 : Record 11012039;
      HourAccountingSurcharge@1100528604 : Record 11020308;
      PostedHourLine@1100528605 : Record 11012085;
      ServiceOrderObject@1100528607 : Record 11071724;
      ServiceOrder@1100528608 : Record 11012823;
    BEGIN
      IF Status = Status::Finished THEN
        FIELDERROR(Status);

      IF "Base Service Order" THEN BEGIN
        ServiceOrder.SETCURRENTKEY("Base Service Order No.");
        ServiceOrder.SETRANGE("Base Service Order No.", "No.");
        ServiceOrder.SETFILTER("No.", '<>%1', "No.");
        IF ServiceOrder.FINDSET THEN
          REPEAT
            ServiceOrder.VALIDATE("Service Category", "Service Category");
            ServiceOrder.MODIFY(TRUE);
          UNTIL ServiceOrder.NEXT = 0;
      END;

      ServiceLedgerEntry.SETCURRENTKEY("Service Order No.");
      ServiceLedgerEntry.SETRANGE("Service Order No.", "No.");
      IF NOT ServiceLedgerEntry.ISEMPTY THEN
        ServiceLedgerEntry.MODIFYALL("Service Category", "Service Category");

      PurchaseOrderControlLine.SETCURRENTKEY("Service Order No.");
      PurchaseOrderControlLine.SETRANGE("Service Order No.", "No.");
      IF NOT PurchaseOrderControlLine.ISEMPTY THEN
        PurchaseOrderControlLine.MODIFYALL("Service Category", "Service Category");

      ItemJournalLine.SETCURRENTKEY("Service Order No.");
      ItemJournalLine.SETRANGE("Service Order No.", "No.");
      IF NOT ItemJournalLine.ISEMPTY THEN
        ItemJournalLine.MODIFYALL("Service Category", "Service Category");

      ItemJournalSurcharge.SETCURRENTKEY("Service Order No.");
      ItemJournalSurcharge.SETRANGE("Service Order No.", "No.");
      IF NOT ItemJournalSurcharge.ISEMPTY THEN
        ItemJournalSurcharge.MODIFYALL("Service Category", "Service Category");

      HourAccountingLine.SETCURRENTKEY("Service Order No.");
      HourAccountingLine.SETRANGE("Service Order No.", "No.");
      IF NOT HourAccountingLine.ISEMPTY THEN
        HourAccountingLine.MODIFYALL("Service Category", "Service Category");

      HourAccountingSurcharge.SETCURRENTKEY("Service Order No.");
      HourAccountingSurcharge.SETRANGE("Service Order No.", "No.");
      IF NOT HourAccountingSurcharge.ISEMPTY THEN
        HourAccountingSurcharge.MODIFYALL("Service Category", "Service Category");

      PostedHourLine.SETCURRENTKEY("Service Order No.");
      PostedHourLine.SETRANGE("Service Order No.", "No.");
      IF NOT PostedHourLine.ISEMPTY THEN
        PostedHourLine.MODIFYALL("Service Category", "Service Category");

      ServiceOrderObject.SETRANGE("Service Order No.", "No.");
      IF NOT ServiceOrderObject.ISEMPTY THEN
        ServiceOrderObject.MODIFYALL("Service Category", "Service Category");
    END;

    PROCEDURE UpdateDateTimeExportWorkSheet@1100525050();
    BEGIN
      "Date/Time Export Work Sheet" := CURRENTDATETIME;
      MODIFY;
    END;

    LOCAL PROCEDURE UpdateExtraWorkOrderFields@1100528666();
    VAR
      WorkOrder@1100528600 : Record 11229279;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      WorkOrder.SETRANGE("WO Finished (Field Service)", FALSE);
      IF WorkOrder.FINDSET THEN
        REPEAT
          WorkOrder.DetermineExtraField(Rec);
          WorkOrder.MODIFY(FALSE);
        UNTIL WorkOrder.NEXT = 0;
    END;

    PROCEDURE IsCalculateTravelHoursInFSA@1100528000(ServiceOrder@1100409001 : Record 11012823;ServCompany@1100525000 : Text[30]) : Boolean;
    VAR
      SCCustSourceTypeSetup@1100409002 : Record 11071800;
    BEGIN
      SCCustSourceTypeSetup.CHANGECOMPANY(ServCompany);
      SCCustSourceTypeSetup.SETRANGE("Source Type", ServiceOrder."Source Type");
      IF ServiceOrder."Service Contract No." <> '' THEN BEGIN
        SCCustSourceTypeSetup.SETRANGE(Type, SCCustSourceTypeSetup.Type::Contract);
        SCCustSourceTypeSetup.SETRANGE(Code, ServiceOrder."Service Contract No.");
      END ELSE BEGIN
        SCCustSourceTypeSetup.SETRANGE(Type, SCCustSourceTypeSetup.Type::Customer);
        SCCustSourceTypeSetup.SETRANGE(Code, ServiceOrder."Customer No.");
      END;
      IF SCCustSourceTypeSetup.FINDFIRST THEN
        EXIT(SCCustSourceTypeSetup."Calc. Field Serv. Travel Costs");
      EXIT(TRUE);
    END;

    PROCEDURE GetPlantParts@1100529000() PlantParts : Text;
    VAR
      ServiceOrderPlantPart@1100529000 : Record 11072320;
      PrevPlantPart@1100529001 : Code[30];
    BEGIN
      PlantParts := '';
      IF ("No." <> '') AND ("Plant Type" <> '') AND ("Plant Number" <> '') THEN BEGIN
        ServiceOrderPlantPart.SETCURRENTKEY("Service Order No.", "Plant Part");
        ServiceOrderPlantPart.SETRANGE("Service Order No.", "No.");
        IF ServiceOrderPlantPart.FINDFIRST THEN BEGIN
          REPEAT
            IF ServiceOrderPlantPart."Plant Part" <> PrevPlantPart THEN BEGIN
              IF PlantParts <> '' THEN
                PlantParts := PlantParts + ', ';
              PlantParts := PlantParts + ServiceOrderPlantPart."Plant Part";
              PrevPlantPart := ServiceOrderPlantPart."Plant Part";
            END;
          UNTIL ServiceOrderPlantPart.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE ShowPlantParts@1100529001();
    VAR
      ServiceOrderPlantPart@1100529000 : Record 11072320;
    BEGIN
      TESTFIELD("No.");
      TESTFIELD("Plant Type");
      TESTFIELD("Plant Number");
      ServiceOrderPlantPart.FILTERGROUP(4);
      ServiceOrderPlantPart.SETRANGE("Service Order No.", "No.");
      ServiceOrderPlantPart.FILTERGROUP(0);
      PAGE.RUNMODAL(PAGE::"Service Order Plant Parts", ServiceOrderPlantPart);
    END;

    PROCEDURE GetCauserSourceDescription@1100528668() : Text;
    VAR
      Customer@1100528600 : Record 18;
      Vendor@1100528601 : Record 23;
      ServiceOrder@1100528602 : Record 11012823;
      CauserType@1100527350 : Record 11072557;
    BEGIN
      IF "Causer Source No." = '' THEN
        EXIT;
      CASE "Causer Source Type" OF
        "Causer Source Type"::Customer:
          IF Customer.GET("Causer Source No.") THEN
            EXIT(Customer.Name);
        "Causer Source Type"::Vendor:
          IF Vendor.GET("Causer Source No.") THEN
            EXIT(Vendor.Name);
        "Causer Source Type"::"Service Order":
          IF ServiceOrder.GET("Causer Source No.") THEN
            EXIT(ServiceOrder.Description);
        "Causer Source Type"::Other:
          IF CauserType.GET("Causer Source No.") THEN
            EXIT(CauserType.Description);
      END;
    END;

    PROCEDURE GetNoOfDSPCancellations@1100528801() : Integer;
    VAR
      DSPCancellation@1100528800 : Record 11126733;
    BEGIN
      DSPCancellation.SETRANGE("Service Order No.", "No.");
      EXIT(DSPCancellation.COUNT);
    END;

    PROCEDURE ShowDSPCancellations@1100528807();
    VAR
      DSPCancellation@1100528800 : Record 11126733;
    BEGIN
      DSPCancellation.SETRANGE("Service Order No.", "No.");
      PAGE.RUN(PAGE::"DSP Cancellations", DSPCancellation);
    END;

    LOCAL PROCEDURE UpdateNEN2767Defects@1100528500();
    VAR
      NEN2767LTMPLine@1100528500 : Record 11128785;
    BEGIN
      IF "No." = '' THEN
        EXIT;

      IF Status < Status::"Technical Finished" THEN
        EXIT;

      NEN2767LTMPLine.SETRANGE("Service Order No.","No.");
      NEN2767LTMPLine.SETRANGE(Status,NEN2767LTMPLine.Status::Open);
      NEN2767LTMPLine.MODIFYALL(Status,NEN2767LTMPLine.Status::Closed);
    END;

    LOCAL PROCEDURE SetUnitPriceStatus@1100528667();
    VAR
      ServiceCategory@1100528600 : Record 11071985;
    BEGIN
      IF ("Service Contract No." = '') OR ("Service Category" = '') THEN
        EXIT;
      ServiceCategory.GET("Service Contract No.", "Service Category");
      IF ServiceCategory."Unit Price Status" <> ServiceCategory."Unit Price Status"::" " THEN
        VALIDATE("Unit Price Status", ServiceCategory."Unit Price Status");
    END;

    PROCEDURE SetMultipleAnswerStatusChange@1100527001();
    BEGIN
      MultipleAnswerStatusChange := STRMENU(Text041, 1, Text042) + 1;
    END;

    PROCEDURE StatusOnBeforeValidate@1100527002();
    BEGIN
      CurrFieldNo := FIELDNO(Status);
    END;

    LOCAL PROCEDURE DetermineProcessStructure@1100528669();
    VAR
      ServiceProcessManagement@1100528603 : Codeunit 11012883;
      FoundProcessStructureCode@1100528601 : Code[10];
    BEGIN
      IF ServiceProcessManagement.DetermineProcessStructure(Rec, FoundProcessStructureCode) THEN
        VALIDATE("Process Structure Code", FoundProcessStructureCode);
    END;

    PROCEDURE ApplyDefaultsByProcessStructure@1100528671();
    VAR
      ServiceOrderExtension@1100528602 : Record 11071727;
      ServiceProcessManagement@1100528600 : Codeunit 11012883;
      RecRef@1100528601 : RecordRef;
    BEGIN
      IF "Process Structure Code" = '' THEN
        EXIT;
      IF ServiceProcessManagement.AssignDefaultValues(Rec, "Process Structure Code", RecRef) THEN
        RecRef.SETTABLE(Rec);
      IF MODIFY(TRUE) THEN;
      ServiceOrderExtension.GetServOrderExtension("No.");
      IF ServiceProcessManagement.AssignDefaultValues(ServiceOrderExtension, "Process Structure Code", RecRef) THEN BEGIN
        RecRef.SETTABLE(ServiceOrderExtension);
        ServiceOrderExtension.UpdateServOrderExtension("No.");
      END;
    END;

    PROCEDURE GetLastPossibleChangeDate@1100528969() : Date;
    VAR
      ServiceClusterSeq@1100528600 : Record 11071966;
      ServiceContract@1100528601 : Record 11012812;
      ObjectModification@1100525002 : Record 11071700;
      ObjectModificationMgt@1100525001 : Codeunit 11012835;
      ObjectModificationNo@1100525000 : Code[20];
    BEGIN
      IF ("Service Cluster" = '') OR ("Service Cluster Seqn." = 0) THEN
        EXIT(0D);
      CASE "Source Type" OF
        "Source Type"::Contract:
          BEGIN
            IF NOT ServiceContract.GET("Service Contract No.") THEN
              ServiceContract.INIT;
            IF ServiceContract."Use Contract Clusters" THEN
              ServiceClusterSeq.GET(ServiceClusterSeq.Type::Contract, "Service Contract No.", ServiceClusterSeq."Source Type"::" ", "Service Cluster", "Service Cluster Seqn.")
            ELSE
              ServiceClusterSeq.GET(ServiceClusterSeq.Type::" ", '', ServiceClusterSeq."Source Type"::" ", "Service Cluster", "Service Cluster Seqn.");
          END;
        "Source Type"::Modification:
          BEGIN
            ObjectModificationNo := ObjectModificationMgt.GetModificationNoByServiceOrderNo("No.");
            ObjectModification.GET(ObjectModificationNo);
            IF ObjectModification."Use Modification Clusters" THEN
              ServiceClusterSeq.GET(ServiceClusterSeq.Type::Modification, ObjectModificationNo, ServiceClusterSeq."Source Type"::" ", "Service Cluster", "Service Cluster Seqn.")
            ELSE
              ServiceClusterSeq.GET(ServiceClusterSeq.Type::" ", '', ServiceClusterSeq."Source Type"::" ", "Service Cluster", "Service Cluster Seqn.")
          END;
      ELSE
        ServiceClusterSeq.GET(ServiceClusterSeq.Type::"Source Type", '', "Source Type", "Service Cluster", "Service Cluster Seqn.");
      END;
      IF (ServiceClusterSeq."Last Possible Change Date" <> 0D) OR ("Starting Date" = 0D) OR (FORMAT(ServiceClusterSeq."Last Possible Change Bandwidth") = '') THEN
        EXIT(ServiceClusterSeq."Last Possible Change Date")
      ELSE
        EXIT(CALCDATE(ServiceClusterSeq."Last Possible Change Bandwidth", "Starting Date"));
    END;

    LOCAL PROCEDURE DetermineServiceClusterBySourceType@1100528970();
    VAR
      ServiceCluster@1100528600 : Record 11071742;
    BEGIN
      IF Status <> Status::Open THEN
        EXIT;
      IF "Source Type" <> "Source Type"::Direct THEN
        EXIT;
      ServiceCluster.SETRANGE(Type, ServiceCluster.Type::"Source Type");
      ServiceCluster.SETRANGE("Type Code", '');
      ServiceCluster.SETRANGE("Source Type", "Source Type");
      ServiceCluster.SETFILTER("Order Kind", '%1|%2', '', "Order Kind");
      ServiceCluster.SETFILTER("Order Type", '%1|%2', '', "Order Type");
      ServiceCluster.SETFILTER("Territory Code", '%1|%2', '', "Territory Code");
      ServiceCluster.SETFILTER(Discipline, '%1|%2', '', Discipline);
      IF ServiceCluster.FINDFIRST THEN
        VALIDATE("Service Cluster", ServiceCluster.Code);
    END;

    LOCAL PROCEDURE DetermineServiceClusterSeqn@1100528971();
    VAR
      ServiceCluster@1100528602 : Record 11071742;
      ServiceClusterSeq@1100528600 : Record 11071966;
      StartingDate@1100528601 : Date;
    BEGIN
      IF Status <> Status::Open THEN
        EXIT;
      IF "Service Cluster" = '' THEN
        EXIT;
      IF NOT GetFilteredServiceClusters(ServiceCluster) THEN
        EXIT;
      ServiceClusterSeq.SETRANGE(Type, ServiceCluster.Type);
      ServiceClusterSeq.SETRANGE("Type Code", ServiceCluster."Type Code");
      ServiceClusterSeq.SETRANGE("Source Type", ServiceCluster."Source Type");
      ServiceClusterSeq.SETRANGE("Cluster Code", ServiceCluster.Code);
      StartingDate := "Starting Date";
      IF StartingDate = 0D THEN
        StartingDate := "Order Date";
      ServiceClusterSeq.SETFILTER("Execution Period Start Date", '<=%1', StartingDate);
      ServiceClusterSeq.SETFILTER("Execution Period Ending Date", '%1|>=%2', 0D, StartingDate);
      IF ServiceClusterSeq.FINDFIRST THEN
        VALIDATE("Service Cluster Seqn.", ServiceClusterSeq."Seq. No.")
      ELSE BEGIN
        ServiceClusterSeq.SETRANGE("Execution Period Start Date");

        IF ServiceClusterSeq.FINDSET THEN
          VALIDATE("Service Cluster Seqn.", ServiceClusterSeq."Seq. No.");
      END;
    END;

    LOCAL PROCEDURE UpdateAdviceOrderLinesPurchaser@1100529600();
    VAR
      AdviceOrderLine@1100529600 : Record 11012055;
      DimValue@1100529603 : Record 349;
      OldPurchCode@1100529601 : Code[10];
      NewPurchCode@1100529602 : Code[10];
    BEGIN
      IF "Global Dimension 1 Code" = xRec."Global Dimension 1 Code" THEN
        EXIT;

      DimMgt.GetDimValueRec(1, xRec."Global Dimension 1 Code", DimValue, FALSE, '');
      OldPurchCode := DimValue."Purchaser (Service)";
      DimMgt.GetDimValueRec(1, "Global Dimension 1 Code", DimValue, FALSE, '');
      NewPurchCode := DimValue."Purchaser (Service)";
      IF OldPurchCode = NewPurchCode THEN
        EXIT;

      AdviceOrderLine.SETRANGE("Record Type", AdviceOrderLine."Record Type"::ServOrder);
      AdviceOrderLine.SETRANGE("Service Order No.", "No.");
      AdviceOrderLine.SETRANGE(Transaction, AdviceOrderLine.Transaction::Purchase);

      AdviceOrderLine.SETFILTER("Process Status", '%1|%2|%3', AdviceOrderLine."Process Status"::Released, AdviceOrderLine."Process Status"::Processed, AdviceOrderLine."Process Status"::"Pending Approval");
      IF NOT AdviceOrderLine.ISEMPTY THEN
        ERROR(Text125, FIELDCAPTION("Global Dimension 1 Code"));

      AdviceOrderLine.SETRANGE("Process Status");
      AdviceOrderLine.SETRANGE(Processed, TRUE);
      IF NOT AdviceOrderLine.ISEMPTY THEN
        ERROR(Text125, FIELDCAPTION("Global Dimension 1 Code"));

      AdviceOrderLine.SETRANGE(Processed);
      AdviceOrderLine.SETRANGE(Transaction);
      IF AdviceOrderLine.FINDSET(TRUE) THEN
        REPEAT
          AdviceOrderLine."Purchaser Code" := NewPurchCode;
          AdviceOrderLine.MODIFY;
        UNTIL AdviceOrderLine.NEXT = 0;
    END;

    PROCEDURE AddLatLngToServiceObjects@1100525001() : Boolean;
    VAR
      ServiceOrderObject@1100525000 : Record 11071724;
      BingMapsHandler@1100525001 : Codeunit 11012485;
      ServiceObject@1100525004 : Record 11071691;
      BingMapsSetup@1100527650 : Record 11072390;
      Success@1100525005 : Boolean;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(BingMapsSetup) THEN
        EXIT;

      IF NOT BingMapsHandler.SetupIsDoneAndEnabled THEN
        EXIT;

      Success := TRUE;
      ServiceOrderObject.SETFILTER("Service Order No.", "No.");
      IF ServiceOrderObject.FINDSET THEN BEGIN
        REPEAT
          ServiceObject.GET(ServiceOrderObject."Object No.");
          IF NOT ServiceObject.AddLatLng THEN
            Success := FALSE;
        UNTIL ServiceOrderObject.NEXT = 0;
      END;
      EXIT(Success);
    END;

    PROCEDURE AddLatLngToServiceLocation@1100525051() : Boolean;
    VAR
      BingMapsHandler@1100525000 : Codeunit 11012485;
      ServiceLocation@1100525001 : Record 11012801;
      InstallationManagement@1100525005 : Codeunit 11012268;
    BEGIN
      IF NOT InstallationManagement.LicensePermissionForTableData(DATABASE::"Bing Maps Setup") THEN
        EXIT;

      IF NOT BingMapsHandler.SetupIsDoneAndEnabled THEN
        EXIT;

      IF ServiceLocation.GET("Service Location No.") THEN
        IF ServiceLocation.AddLatLng THEN
          EXIT(TRUE);
    END;

    PROCEDURE UpdateLongitudeLatitudeInExtensionTable@1100525052() : Boolean;
    VAR
      BingMapsHandler@1100525000 : Codeunit 11012485;
      ServiceOrderExtension@1100525003 : Record 11071727;
      InstallationManagement@1100525005 : Codeunit 11012268;
    BEGIN
      IF NOT InstallationManagement.LicensePermissionForTableData(DATABASE::"Bing Maps Setup") THEN
        EXIT;

      IF NOT BingMapsHandler.SetupIsDoneAndEnabled THEN
        EXIT;

      IF NOT ServiceOrderExtension.GET("No.") THEN BEGIN
        ServiceOrderExtension."Service Order No." := "No.";
        ServiceOrderExtension.INSERT;
      END;

      IF ServiceOrderExtension.UpdateLongitudeLatitude THEN
        EXIT(TRUE);
    END;

    LOCAL PROCEDURE SendDspPlanMessage@1100528301();
    VAR
      DSPSetup@1100528302 : Record 11126726;
      DSPPlanningManagement@1100528300 : Codeunit 11126717;
      InstallationManagement@1100528303 : Codeunit 11012268;
    BEGIN
      IF (InstallationManagement.NoLicensePermissionForTableData(DATABASE::"DSP Setup") OR
          InstallationManagement.NoLicensePermissionForCodeUnit(CODEUNIT::"DSP Planning Management"))
      THEN EXIT;
      IF (NOT DSPSetup.GET) THEN DSPSetup.INIT;
      IF (NOT DSPSetup."Dsp Active") THEN EXIT;

      DSPPlanningManagement.SendAutomaticPlanMessage(Rec);
    END;

    LOCAL PROCEDURE FindServiceContracts@1100527300(VAR ServiceContract@1100527300 : Record 11012812);
    VAR
      ServiceObject@1100527306 : Record 11071691;
      ContractObject@1100527305 : Record 11071702;
      ServiceLocation@1100527304 : Record 11012801;
      BuildingObjectRelation@1100527303 : Record 11071820;
      ServiceContract2@1100527302 : Record 11012812;
      RecordsMarked@1100527301 : Boolean;
    BEGIN
      ServiceContract.RESET;
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        ServiceContract.INIT;
      IF NOT ServiceContract.Blocked THEN
        ServiceContract.SETRANGE(Blocked, FALSE);
      ServiceContract.SETFILTER("Customer No.", "Customer No.");

      IF "Service Location No." <> '' THEN BEGIN
        ContractObject.SETCURRENTKEY("Service Object No.");

        ServiceObject.SETCURRENTKEY("Service Location No.");
        ServiceObject.SETRANGE("Service Location No.", "Service Location No.");
        IF ServiceObject.FINDSET THEN
          REPEAT
            ContractObject.SETRANGE("Service Object No.", ServiceObject."No.");
            IF ContractObject.FINDSET THEN
              REPEAT
                ServiceContract."No." := ContractObject."Service Contract No.";
                ServiceContract.MARK(TRUE);
                RecordsMarked := TRUE;
              UNTIL ContractObject.NEXT = 0;
          UNTIL ServiceObject.NEXT = 0;

        ServiceLocation.GET("Service Location No.");
        IF ServiceLocation."Building Code" <> '' THEN BEGIN
          BuildingObjectRelation.SETRANGE("Building Code", ServiceLocation."Building Code");
          IF BuildingObjectRelation.FINDSET THEN
            REPEAT
              ContractObject.SETRANGE("Service Object No.", BuildingObjectRelation."Object No.");
              IF ContractObject.FINDSET THEN
                REPEAT
                  ServiceContract."No." := ContractObject."Service Contract No.";
                  ServiceContract.MARK(TRUE);
                  RecordsMarked := TRUE;
                UNTIL ContractObject.NEXT = 0;
            UNTIL BuildingObjectRelation.NEXT = 0;
        END;

        ServiceContract2.SETCURRENTKEY("Customer No.");
        ServiceContract2.SETRANGE("Customer No.", "Customer No.");
        ServiceContract2.SETRANGE("Contract Form", ServiceContract2."Contract Form"::"Framework Contract");
        IF ServiceContract2.FINDSET THEN
          REPEAT
            ServiceContract."No." := ServiceContract2."No.";
            ServiceContract.MARK(TRUE);
            RecordsMarked := TRUE;
          UNTIL ServiceContract2.NEXT = 0;

        IF NOT RecordsMarked THEN BEGIN
          ContractObject.RESET;
          ServiceContract2.RESET;
          ServiceContract2.COPY(ServiceContract);
          ServiceContract2.SETRANGE("Contract Form", ServiceContract2."Contract Form"::" ");
          IF ServiceContract2.FINDSET THEN
            REPEAT
              ContractObject.SETRANGE("Service Contract No.", ServiceContract2."No.");
              IF ContractObject.ISEMPTY THEN BEGIN
                ServiceContract."No." := ServiceContract2."No.";
                ServiceContract.MARK(TRUE);
              END;
            UNTIL ServiceContract2.NEXT = 0;
        END;

        ServiceContract.MARKEDONLY(TRUE);
      END;
    END;

    LOCAL PROCEDURE ReplaceServiceOrderLocations@1100528410();
    VAR
      ServiceOrderLocation@1100528400 : Record 11071688;
      ServiceLocShipToAddress@1100528401 : Record 11072328;
    BEGIN
      ServiceOrderLocation.SETRANGE("Service Order No.", "No.");
      IF GUIALLOWED AND NOT ServiceOrderLocation.ISEMPTY THEN
        IF NOT CONFIRM(
          Text127, TRUE, FIELDCAPTION("Service Location No."), ServiceOrderLocation.TABLECAPTION)
        THEN
          ERROR('');
      ServiceOrderLocation.DELETEALL;

      IF "Service Location No." <> '' THEN BEGIN
        ServiceLocShipToAddress.SETRANGE("Service Location No.", "Service Location No.");
        IF ServiceLocShipToAddress.FINDSET THEN
          REPEAT
            ServiceOrderLocation.TRANSFERFIELDS(ServiceLocShipToAddress, TRUE);
            ServiceOrderLocation."Service Order No." := "No.";
            ServiceOrderLocation.INSERT;
          UNTIL ServiceLocShipToAddress.NEXT = 0;
      END;
    END;

    PROCEDURE GetDefaultServiceOrderLocationCode@1100528411() DefaultServiceOrderLocationCode : Code[10];
    VAR
      ServiceOrderLocation@1100528401 : Record 11071688;
    BEGIN
      DefaultServiceOrderLocationCode := GetDefaultShipToAddressOfServiceLocation;

      IF DefaultServiceOrderLocationCode = '' THEN BEGIN
        ServiceOrderLocation.SETRANGE("Service Order No.", "No.");
        IF ServiceOrderLocation.FINDFIRST THEN
          IF ServiceOrderLocation.NEXT = 0 THEN
            DefaultServiceOrderLocationCode := ServiceOrderLocation.Code;
      END;
    END;

    PROCEDURE ServiceLocationHasDefaultShipToAddress@1100528418() : Boolean;
    VAR
      DefaultServiceOrderLocationCode@1100528400 : Code[10];
    BEGIN
      DefaultServiceOrderLocationCode := GetDefaultShipToAddressOfServiceLocation;
      EXIT(DefaultServiceOrderLocationCode <> '');
    END;

    LOCAL PROCEDURE GetDefaultShipToAddressOfServiceLocation@1100528412() DefaultServiceOrderLocationCode : Code[10];
    VAR
      ServiceLocation@1100528401 : Record 11012801;
      ServiceOrderLocation@1100528400 : Record 11071688;
    BEGIN
      IF ServiceLocation.GET("Service Location No.") THEN
        IF (ServiceLocation.Deliver = ServiceLocation.Deliver::"Service Loc. Ship-to Address") AND
           (ServiceLocation."Ship To Location" <> '')
        THEN
          IF ServiceOrderLocation.GET("No.", ServiceLocation."Ship To Location") THEN
            DefaultServiceOrderLocationCode := ServiceLocation."Ship To Location";
    END;

    PROCEDURE GetPostCodeGroupCode@1100528413() : Code[10];
    VAR
      PostCode@1100528400 : Record 225;
    BEGIN
      IF "Post Code" = '' THEN
        EXIT;

      IF PostCode.GET("Post Code", City) THEN
        EXIT(PostCode.Group);
    END;

    PROCEDURE CreateAndDisplayServiceOrder@1100527600(OfficeAddinContext@1100527601 : Record 1600);
    VAR
      Customer@1100527602 : Record 18;
    BEGIN
      INIT;

      Customer.SETRANGE("E-Mail", OfficeAddinContext.Email);
      IF Customer.FINDFIRST THEN
        "Customer No." := Customer."No.";

      "E-Mail" := OfficeAddinContext.Email;
      Name := OfficeAddinContext.Name;
      INSERT(TRUE);
      COMMIT;
      PAGE.RUN(PAGE::"Service Order (General)", Rec);
    END;

    LOCAL PROCEDURE LookupPriceBook@1100529602();
    VAR
      ServiceUnitPrice@1100529601 : Record 11071768;
      ServiceUnitPriceList@1100529600 : Page 11125269;
    BEGIN
      ServiceUnitPrice.SETRANGE(Type, "Price Book Type");
      CALCFIELDS("Price Book Code", "Price Book Index Date");
      IF "Price Book Code" <> '' THEN
        ServiceUnitPrice.SETRANGE(Code, "Price Book Code");
      IF "Price Book Index Date" <> 0D THEN
        ServiceUnitPrice.SETRANGE("Index Date", "Price Book Index Date");

      ServiceUnitPriceList.EDITABLE(FALSE);
      ServiceUnitPriceList.SETTABLEVIEW(ServiceUnitPrice);
      ServiceUnitPriceList.RUNMODAL;
    END;

    PROCEDURE ProductionRecordingIsUsed@1100528414() : Boolean;
    VAR
      SUPRecordingLine@1100528400 : Record 11071772;
    BEGIN
      IF "Unit Price Status" <> "Unit Price Status"::" " THEN
        EXIT(TRUE);

      IF CURRENTCOMPANY <> COMPANYNAME THEN
        SUPRecordingLine.CHANGECOMPANY(CURRENTCOMPANY);
      SUPRecordingLine.SETRANGE("Service Order No.", "No.");
      IF NOT SUPRecordingLine.ISEMPTY THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE SetReferencePointModifiedByEmployee@1100528701(Employee@1100528700 : Code[20]);
    BEGIN
      ReferencePointModifiedByEmployee := Employee;
    END;

    LOCAL PROCEDURE GetServiceCategoryFromServicePackage@1100527350(ServicePackageCode@1100527350 : Code[20]);
    VAR
      ServicePackage@1100527351 : Record 11012806;
    BEGIN
      IF "Service Package" <> '' THEN
        IF ServicePackage.GET("Service Package") THEN
          IF ServicePackage."Service Category" <> '' THEN
            "Service Category" := ServicePackage."Service Category";
    END;

    PROCEDURE UpdateReferencePeriodServContractNo@1100527900(ServiceContract@1100527900 : Record 11012812);
    VAR
      ReferencePeriod@1100527901 : Record 11020272;
    BEGIN
      ReferencePeriod.SETCURRENTKEY(Type, "Document No.");
      ReferencePeriod.SETRANGE(Type,ReferencePeriod.Type::ServOrder);
      ReferencePeriod.SETRANGE("Document No.","No.");
      IF ReferencePeriod.FINDSET THEN REPEAT
        ReferencePeriod.VALIDATE("Service Time Table Code",ServiceContract."Service Time Table Code");
        ReferencePeriod.MODIFY(TRUE);
      UNTIL ReferencePeriod.NEXT  = 0;
    END;

    PROCEDURE LookupPlantLocation@1100529674();
    VAR
      PlantLocation@1100525001 : Record 11012554;
    BEGIN
      PlantLocation.CHANGECOMPANY("Plant Company");
      IF "Plant Location" <> '' THEN
        IF PlantLocation.GET("Plant Location") THEN;
      IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN
        IF PlantLocation.Code <> "Plant Location" THEN
          VALIDATE("Plant Location", PlantLocation.Code);
    END;

    LOCAL PROCEDURE LookupPlantType@1100529675();
    VAR
      PlantType@1100529600 : Record 11012551;
    BEGIN
      PlantType.CHANGECOMPANY("Plant Company");
      IF "Plant Type" <> '' THEN
        IF PlantType.GET("Plant Type") THEN;
      IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN
        IF PlantType.Code <> "Plant Type" THEN
          VALIDATE("Plant Type", PlantType.Code);
    END;

    PROCEDURE LookupPlantInventory@1100529671(ILevel@1100485003 : Integer);
    VAR
      PlantInventory@1100485001 : Record 11012555;
      PlantType@1100529600 : Record 11012551;
      PlantInventoryPage@1100485000 : Page 11012559;
      LocDetails@1100485002 : 'InventEntry,PlantType,PlantNo,RateCode';
    BEGIN
      //* Level: 1-Plant Type, 2-Plant No.
      PlantInventory.CHANGECOMPANY("Plant Company");

      PlantInventory.SETRANGE(Removed, FALSE);
      PlantInventory.SETRANGE(Location, "Plant Location");
      IF ILevel = 2 THEN
        PlantInventory.SETRANGE("Plant Type", "Plant Type");

      PlantInventory.Removed := FALSE;
      PlantInventory.Location := "Plant Location";
      PlantInventory."Plant Type" := "Plant Type";
      PlantInventory."Plant No." := "Plant Number";

      PlantInventoryPage.SetCompany("Plant Company");
      PlantInventoryPage.SetDetailSelection(LocDetails::PlantNo);

      IF "Starting Date" <> 0D THEN
        PlantInventory.SETFILTER("Present from", '..%1', "Starting Date");
      PlantInventoryPage.SETTABLEVIEW(PlantInventory);
      PlantInventoryPage.SETRECORD(PlantInventory);

      PlantInventoryPage.LOOKUPMODE := TRUE;
      IF PlantInventoryPage.RUNMODAL = ACTION::LookupOK THEN BEGIN
        PlantInventoryPage.GETRECORD(PlantInventory);
        PlantInventoryPage.GetDetailSelection(LocDetails);
        IF (ILevel = 1) THEN
          VALIDATE("Plant Type", PlantInventory."Plant Type");
        IF ((ILevel = 1) OR (ILevel = 2)) AND (LocDetails <> LocDetails::PlantType) THEN BEGIN
          PlantType.CHANGECOMPANY("Plant Company");
          IF NOT PlantType.GET("Plant Type") THEN
            CLEAR(PlantType);
          IF NOT PlantType.Bulk THEN
            VALIDATE("Plant Number", PlantInventory."Plant No.");
        END;
      END;
    END;

    LOCAL PROCEDURE LookupCostComponentPlant@1100529688();
    VAR
      CostComponentPlant@1100525001 : Record 11012575;
    BEGIN
      CostComponentPlant.CHANGECOMPANY("Plant Company");
      IF "Cost Component Plant" <> '' THEN
        IF CostComponentPlant.GET("Cost Component Plant") THEN ;
      IF PAGE.RUNMODAL(0, CostComponentPlant) = ACTION::LookupOK THEN
        "Cost Component Plant" := CostComponentPlant.Code;
    END;

    PROCEDURE GetPlantValues@1100529683();
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN BEGIN
        CALCFIELDS("Plant Location Description", "Plant Type Description", "Plant Number Description", "Plant Inspection No.");
        EXIT;
      END;
      GetPlantLocationDescription;
      GetPlantTypeDescription;
      GetPlantNumberValues;
    END;

    PROCEDURE GetPlantLocationDescription@1100529676();
    VAR
      PlantLocation@1100529600 : Record 11012554;
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
        CALCFIELDS("Plant Location Description")
      ELSE BEGIN
        "Plant Location Description" := '';
        IF "Plant Location" <> '' THEN BEGIN
          PlantLocation.CHANGECOMPANY("Plant Company");
          IF PlantLocation.GET("Plant Location") THEN
            "Plant Location Description" := PlantLocation.Description;
        END;
      END;
    END;

    PROCEDURE GetPlantTypeDescription@1100529686();
    VAR
      PlantType@1100529601 : Record 11012551;
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
        CALCFIELDS("Plant Type Description")
      ELSE BEGIN
        "Plant Type Description" := '';
        IF "Plant Type" <> '' THEN BEGIN
          PlantType.CHANGECOMPANY("Plant Company");
          IF PlantType.GET("Plant Type") THEN
            "Plant Type Description" := PlantType.Description;
        END;
      END;
    END;

    PROCEDURE GetPlantNumberValues@1100529687();
    VAR
      PlantNumber@1100529602 : Record 11012552;
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
        CALCFIELDS("Plant Number Description", "Plant Inspection No.")
      ELSE BEGIN
        "Plant Number Description" := '';
        "Plant Inspection No." := '';
        IF "Plant Number" <> '' THEN BEGIN
          PlantNumber.CHANGECOMPANY("Plant Company");
          IF PlantNumber.GET("Plant Type", "Plant Number") THEN BEGIN
            "Plant Number Description" := PlantNumber.Description;
            "Plant Inspection No." := PlantNumber."Inspection No.";
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE LookupPlantLocationDescription@1100529678();
    VAR
      PlantLocation@1100529600 : Record 11012554;
    BEGIN
      PlantLocation.CHANGECOMPANY("Plant Company");
      PlantLocation.SETRANGE(Code, "Plant Location");
      PAGE.RUN(0, PlantLocation);
    END;

    LOCAL PROCEDURE LookupPlantTypeDescription@1100529672();
    VAR
      PlantType@1100529600 : Record 11012551;
    BEGIN
      PlantType.CHANGECOMPANY("Plant Company");
      PlantType.SETRANGE(Code, "Plant Type");
      PAGE.RUN(0, PlantType);
    END;

    LOCAL PROCEDURE LookupPlantNumberValues@1100529679();
    VAR
      PlantNumber@1100529600 : Record 11012552;
    BEGIN
      PlantNumber.CHANGECOMPANY("Plant Company");
      PlantNumber.SETRANGE("Plant Type", "Plant Type");
      PlantNumber.SETRANGE("No.", "Plant Number");
      PAGE.RUN(0, PlantNumber);
    END;

    LOCAL PROCEDURE DetermineCostComponentPlant@1100529615();
    VAR
      OrderKind@1100529600 : Record 11012837;
      CostComponentPlant@1100529000 : Record 11012575;
    BEGIN
      IF "Order Kind" <> '' THEN BEGIN
        IF OrderKind.GET(OrderKind.Indication::Kind, "Order Kind") THEN BEGIN
          IF OrderKind."Cost Component Plant" <> '' THEN BEGIN
            CostComponentPlant.CHANGECOMPANY("Plant Company");
            IF CostComponentPlant.GET("Cost Component Plant") THEN
              VALIDATE("Cost Component Plant", OrderKind."Cost Component Plant");
          END;
        END;
      END;
    END;

    PROCEDURE CheckChargeToProject@1100529611();
    VAR
      ServiceOrderExtension@1100529600 : Record 11071727;
    BEGIN
      IF ("Plant Company" = '') AND ("Plant Type" = '') AND ("Plant Number" = '') THEN
        EXIT;
      IF NOT ServiceOrderExtension.GET("No.") THEN
        EXIT;
      IF ServiceOrderExtension."Master Company" <> '' THEN
        ERROR(Text129);
      IF ServiceOrderExtension."Master Project" <> '' THEN
        ERROR(Text130);
    END;

    LOCAL PROCEDURE LookupPlantMeter@1100529614();
    VAR
      PlantMeterType@1100529600 : Record 11229921;
    BEGIN
      PlantMeterType.CHANGECOMPANY("Plant Company");
      PlantMeterType.SETRANGE("Plant Type", "Plant Type");
      PlantMeterType.SETRANGE("Plant No.", "Plant Number");
      IF PAGE.RUNMODAL(0, PlantMeterType) = ACTION::LookupOK THEN
        "Plant Meter" := PlantMeterType."Plant Meter";
    END;

    LOCAL PROCEDURE UpdateChargeToPlantInCostPlusEntries@1100529621();
    VAR
      ServiceOrderCostPlusEntry@1100529600 : Record 11012825;
    BEGIN
      IF "Plant Location" <> '' THEN
        EXIT;
      ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
      ServiceOrderCostPlusEntry.SETRANGE(Invoiced, FALSE);
      IF ServiceOrderCostPlusEntry.ISEMPTY THEN
        EXIT;
      ServiceOrderCostPlusEntry.MODIFYALL("Charge to Plant Location", FALSE);
    END;

    PROCEDURE IsPlantInternalCharge@1100529619() : Boolean;
    BEGIN
      EXIT("Plant Type" <> '');
    END;

    PROCEDURE GetChargedToPlant@1100529620(ChargeToPlantLocation@1100529601 : Boolean) ChargedToPlant : Decimal;
    VAR
      ServiceOrderCostPlusEntry@1100529600 : Record 11012825;
    BEGIN
      ChargedToPlant := 0;
      IF NOT IsPlantInternalCharge THEN
        EXIT;
      ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", "No.");
      IF ChargeToPlantLocation THEN
        ServiceOrderCostPlusEntry.SETRANGE("Charge to Plant Location", ChargeToPlantLocation);
      IF ServiceOrderCostPlusEntry.ISEMPTY THEN
        EXIT;
      ServiceOrderCostPlusEntry.SETAUTOCALCFIELDS("Invoiced Price (LCY)");
      ServiceOrderCostPlusEntry.FINDSET;
      REPEAT
        ChargedToPlant += ServiceOrderCostPlusEntry."Invoiced Price (LCY)";
      UNTIL ServiceOrderCostPlusEntry.NEXT = 0;
    END;

    LOCAL PROCEDURE StoreDeletedData@1100528703(Mode@1100528000 : Code[10]);
    VAR
      DeletedDataMgtApps@1100528701 : Codeunit 11012440;
    BEGIN
      IF (Mode = 'D') THEN
        DeletedDataMgtApps.StoreDeletedServiceOrder(Rec);

      IF (Mode = 'R') THEN
        IF (xRec."No." = '') THEN
          DeletedDataMgtApps.StoreDeletedServiceOrder(Rec)
        ELSE
          DeletedDataMgtApps.StoreDeletedServiceOrder(xRec);
    END;

    LOCAL PROCEDURE InheritFromProjectSetup@1100528901();
    VAR
      JobsSetup@1100528900 : Record 315;
    BEGIN
      //DP02115
      JobsSetup.GET;
      "Subcontracting in Hours" := JobsSetup."Subcontracting in Hours";  //C053751
      "Plant Rates in Hours" := JobsSetup."Plant Rates in Hours";
      "Kind of Plant Rate" := JobsSetup."Kind of Plant Rate";
      "Plant Company":= JobsSetup.GetDefaultPlantCompany;  //C052059
      IF "Plant Company" = COMPANYNAME THEN
        "Plant Company" := '';
    END;

    LOCAL PROCEDURE CheckSUPRecordingLines@1100529604();
    VAR
      SUPRecordingLine@1100529600 : Record 11071772;
    BEGIN
      SUPRecordingLine.SETRANGE("Service Order No.", "No.");
      SUPRecordingLine.SETFILTER("Price Book Code", '<>%1', '');
      SUPRecordingLine.SETFILTER("Index Date", '<>%1', 0D);
      IF SUPRecordingLine.ISEMPTY THEN
        EXIT;
      IF GUIALLOWED THEN
        IF NOT CONFIRM(Text133) THEN
          EXIT;
      SUPRecordingLine.DELETEALL(TRUE);
    END;

    PROCEDURE SetSkipDeterminePriceBookFields@1100529605(NewSkipDeterminePriceBookFields@1100529600 : Boolean);
    BEGIN
      SkipDeterminePriceBookFields := NewSkipDeterminePriceBookFields;
    END;

    LOCAL PROCEDURE LookupContactPersonNo@1100529608();
    VAR
      LocContact@1100529602 : Record 5050;
      ContactNo@1100529601 : Code[20];
      BillToContactNo@1100529600 : Code[20];
    BEGIN
      IF ("Contact No." = '') AND ("Bill-to Contact No." = '') THEN
        EXIT;
      ContactNo := "Contact No.";
      IF ContactNo = '' THEN
        ContactNo := "Bill-to Contact No."
      ELSE
        BillToContactNo := "Bill-to Contact No.";

      LocContact.SETCURRENTKEY("Company Name", "Company No.", Type, Name);
      LocContact.SETRANGE(Type, LocContact.Type::Person);
      LocContact.SETRANGE(Blocked, FALSE);
      IF (ContactNo = BillToContactNo) OR (BillToContactNo = '') THEN
        LocContact.SETRANGE("Company No.", ContactNo)
      ELSE
        LocContact.SETFILTER("Company No.", '%1|%2', ContactNo, BillToContactNo);
      IF PAGE.RUNMODAL(0, LocContact) = ACTION::LookupOK THEN
        VALIDATE("Contact Person No.", LocContact."No.");
    END;

    PROCEDURE FillMasterProjectFromServiceLocation@1100527404();
    VAR
      ServiceLocation@1100527400 : Record 11012801;
      ServiceSetup@1100527401 : Record 11012800;
      ServiceOrderExtension@1100527402 : Record 11071727;
      ProjectElement@1100527403 : Record 11012010;
    BEGIN
      IF "Service Location No." = '' THEN
        EXIT;
      ServiceSetup.GET;
      IF NOT ServiceSetup."Fill Project No. from Location" THEN
        EXIT;
      IF NOT ServiceLocation.GET("Service Location No.") THEN
        EXIT;
      IF ServiceLocation."Warranty Expires On" <> 0D THEN
        IF "Created on" > ServiceLocation."Warranty Expires On" THEN
          EXIT;
      ServiceOrderExtension.GetServOrderExtension("No.");
      ServiceOrderExtension.VALIDATE("Master Company", ServiceLocation."Warranty Company");
      ServiceOrderExtension.VALIDATE("Master Project", ServiceLocation."Warranty Project No.");
      IF ServiceOrderExtension."Master Company" = '' THEN
        ProjectElement.CHANGECOMPANY(COMPANYNAME)
      ELSE
        ProjectElement.CHANGECOMPANY(ServiceOrderExtension."Master Company");
      ProjectElement.SETRANGE("Project No.", ServiceOrderExtension."Master Project");
      IF ServiceLocation."Warranty Element No" <> '' THEN BEGIN
        ServiceOrderExtension.VALIDATE("Master Element", ServiceLocation."Warranty Element No")
      END ELSE IF ProjectElement.FINDFIRST AND (ProjectElement.NEXT = 0) THEN
        ServiceOrderExtension.VALIDATE("Master Element", ProjectElement.Element);
      ServiceOrderExtension.UpdateServOrderExtension("No.");
    END;

    LOCAL PROCEDURE ActualMeterReadingForServiceOrder@1100528501(PlantType@1100528504 : Code[20];PlantNo@1100528503 : Code[10];PlantMeter@1100528502 : Code[10];MeterType@1100528501 : Code[10]) : Decimal;
    VAR
      PlantMeterReading@1100528500 : Record 11072671;
    BEGIN
      PlantMeterReading.CHANGECOMPANY("Plant Company");
      PlantMeterReading.SETRANGE("Plant Type", PlantType);
      PlantMeterReading.SETRANGE("Plant No.", PlantNo);
      PlantMeterReading.SETRANGE(Meter, PlantMeter);
      PlantMeterReading.SETRANGE("Meter Reading Type", MeterType);
      PlantMeterReading.SETRANGE("Order Type", PlantMeterReading."Order Type"::ServiceOrder);
      PlantMeterReading.SETRANGE("Order No.", "No.");
      IF PlantMeterReading.ISEMPTY THEN BEGIN
        PlantMeterReading.SETRANGE("Order Type");
        PlantMeterReading.SETRANGE("Order No.");
      END;
      IF PlantMeterReading.FINDLAST THEN
        EXIT(PlantMeterReading."Meter Reading");
    END;

    LOCAL PROCEDURE UpdateSOPlantMaintSchemesOnTechFinished@1100529002(OldStatus@1100529001 : Option);
    VAR
      SOPlantMaintenanceScheme@1100529000 : Record 11072210;
    BEGIN
      IF (Status = Status::"Technical Finished") AND (OldStatus = Status::"In Process") THEN BEGIN
        SOPlantMaintenanceScheme.SETRANGE("Service Order No.", "No.");
        SOPlantMaintenanceScheme.SETRANGE("Inspection Result", SOPlantMaintenanceScheme."Inspection Result"::" ");
        IF SOPlantMaintenanceScheme.FINDSET(TRUE,FALSE) THEN BEGIN
          REPEAT
            SOPlantMaintenanceScheme."Inspected on" := TODAY;
            IF "Employee No." <> '' THEN
              SOPlantMaintenanceScheme."Inspected by" := "Employee No."
            ELSE BEGIN
              IF Subcontractor <> '' THEN
                SOPlantMaintenanceScheme."Inspected by" := Subcontractor;
            END;
            SOPlantMaintenanceScheme.MODIFY;
          UNTIL SOPlantMaintenanceScheme.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE InsertServiceTextFromPort@1100527351(CommentPortData@1100527352 : Text[30];CommentTextFromPort@1100527351 : Text[80]);
    VAR
      ServiceText@1100527350 : Record 11012882;
    BEGIN
      ServiceText.INIT;
      ServiceText."Table Name" := ServiceText."Table Name"::"Service Order";
      ServiceText."No." := "No.";
      ServiceText."Table Field" := 90;
      ServiceText."Line No." := GetFirstFreeServiceTextLineNo(
        ServiceText."Table Name",
        ServiceText."No.",
        ServiceText."Table Field");
      ServiceText.Date := TODAY;
      ServiceText."Time Created" := TIME;
      ServiceText.Comment := STRSUBSTNO(CommentPortData, CommentTextFromPort);
      ServiceText.INSERT(TRUE);
    END;

    LOCAL PROCEDURE CheckNumberOfWorkOrders@1100527353(FieldName@1100527350 : Text[50]);
    VAR
      WorkOrder@1100527351 : Record 11229279;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      IF WorkOrder.COUNT > 1 THEN
        ERROR(Text009, FieldName, TABLECAPTION, "No.")
      ELSE
        EXIT;
    END;

    LOCAL PROCEDURE FormatPhoneNumberWhenNotSynced@1100528705(VAR PhoneNumber@1100528700 : Text);
    VAR
      PhoneNumberFormatting@1100528701 : Codeunit 11012276;
      ServiceSetup@1100528702 : Record 11012800;
      ServiceLocation@1100528703 : Record 11012801;
    BEGIN
      ServiceSetup.GET;
      IF NOT ServiceSetup."Sync. Location by Order/Call" OR NOT ServiceLocation.GET("Service Location No.") THEN
        PhoneNumberFormatting.ValidatePhoneNumber("Country/Region Code", PhoneNumber);
    END;

    PROCEDURE DeleteRelatedWorkOrders@1100527450(ServiceOrderNo@1100527450 : Code[20]);
    VAR
      WorkOrder@1100527451 : Record 11229279;
      WorkOrder2@1100527452 : Record 11229279;
    BEGIN
      IF ServiceOrderNo <> '' THEN BEGIN
        WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
        WorkOrder.SETRANGE("Source Company", COMPANYNAME);
        WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
        WorkOrder.SETRANGE("Source No.", ServiceOrderNo);
        IF NOT WorkOrder.ISEMPTY THEN BEGIN
          WorkOrder2.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
          WorkOrder2.COPYFILTERS(WorkOrder);
          WorkOrder2.SETFILTER("Resource No.", '<>%1', '');
          IF NOT WorkOrder2.ISEMPTY THEN BEGIN
            IF CONFIRM(Text135, FALSE, WorkOrder.COUNT) THEN
              WorkOrder.DELETEALL(TRUE)
          END ELSE
            WorkOrder.DELETEALL(TRUE);
        END;
      END;
    END;

    LOCAL PROCEDURE EvaluateStartingTime@1100527650();
    VAR
      ServiceOrder@1100527650 : Record 11012823;
      StartingTime@1100527651 : Time;
    BEGIN
      IF ("Starting Date" <> 0D) AND ("Starting Time" = 0T) THEN BEGIN
        StartingTime := "Starting Time";
        GetStartingTime("Employee No.", "Starting Date", "Starting Time", CURRENTCOMPANY);
        IF ServiceOrder.GET("No.") AND (StartingTime <> "Starting Time") THEN
          VALIDATE("Starting Time");
      END;
    END;

    PROCEDURE GetStartingTime@1100527654(ResourceNo@1100527662 : Code[20];StartingDate@1100527663 : Date;VAR StartingTime@1100527664 : Time;Company@1100527665 : Text);
    VAR
      ResourceWOP@1100527661 : Record 11229278;
      CompanyInformation@1100527660 : Record 79;
      BaseCalendar@1100527659 : Record 11072014;
      sDateTime@1100527658 : DateTime;
      eDateTime@1100527657 : DateTime;
      Duration@1100527656 : Integer;
      DayOfWeek@1100527655 : Integer;
      WorkingHours@1100527654 : Decimal;
      WorkFrom@1100527653 : Time;
      WorkUntil@1100527652 : Time;
      PauseFrom@1100527651 : Time;
      PauseUntil@1100527650 : Time;
    BEGIN
      IF ResourceWOP.GET(ResourceNo) THEN BEGIN
        sDateTime := CREATEDATETIME(StartingDate, StartingTime);
        eDateTime := CREATEDATETIME(StartingDate, 235959T);
        ResourceWOP.CalculateWorkingTimes(sDateTime, eDateTime, Duration, TRUE);
        StartingTime := DT2TIME(sDateTime);
      END ELSE BEGIN
        Company := ResourceWOP.GetPlanGroupCompany(Company);
        IF Company <> COMPANYNAME THEN BEGIN
          CompanyInformation.CHANGECOMPANY(Company);
          BaseCalendar.CHANGECOMPANY(Company);
        END;
        CompanyInformation.GET;
        IF BaseCalendar.GET(CompanyInformation."Base Calendar Code") THEN BEGIN
          DayOfWeek := DATE2DWY(StartingDate, 1);
          BaseCalendar.GetWorkingTimeForWeekDay(DayOfWeek, WorkingHours, WorkFrom, WorkUntil, PauseFrom, PauseUntil);
          StartingTime := WorkFrom;
        END;
      END;
    END;

    PROCEDURE UpdateFromWorkOrder@1100527651();
    VAR
      WorkOrder@1100527650 : Record 11229279;
    BEGIN
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", "No.");
      IF WorkOrder.FINDFIRST() THEN BEGIN
        MODIFY();
        WorkOrder.UpdateServiceOrder('I');
        GET("No.");
      END;
    END;

    LOCAL PROCEDURE "--Itero"@1101285000();
    BEGIN
    END;

    PROCEDURE GetLatestUnitPriceIndexDate@1101285001(Type@1101285000 : Option;Code@1101285001 : Code[20]) : Date;
    VAR
      ServiceUnitPrice@1101285002 : Record 11071768;
    BEGIN
      ServiceUnitPrice.SETRANGE(Type, Type);
      ServiceUnitPrice.SETRANGE(Code, Code);
      IF (ServiceUnitPrice.FINDLAST) THEN
        EXIT(ServiceUnitPrice."Index Date");
      EXIT(0D);
    END;

    [Business]
    LOCAL PROCEDURE OnAfterValidatePriority@1101285002(Rec@1101285000 : Record 11012823;xRec@1101285001 : Record 11012823);
    BEGIN
    END;

    [Integration]
    PROCEDURE OnBeforeValidateStatus@1100285100(ServiceOrder@1100285100 : Record 11012823;xServiceOrder@1100285101 : Record 11012823);
    BEGIN
      //181204 RAD108
    END;

    BEGIN
    {
      4PS01 HBK 06-08-09: Field added "Language Code"
      4PS, 15-11-13, DP00483, Performance tuning:
      - MaintainSIFTIndex Disabled for key Service Contract No.,Source Type,Order Date
      - Key Starting Date,Duration Time,Status added
      4PS 10-08-16 UKR-C25593 KD: Multiple meter readings (BI049) - Field "Plant Meter" added
                                                                    Triggers OnDelete, "Plant Type - OnValidate", "Plant Number - OnValidate", DrillDownMeterReading, GetMeterReading changed
                                                                    Triggers ActualMeterReading, ActualMeterReadingUnitofMeasure, ActualMeterReadingType, ActualMeterReadingDate removed

      150817 ITERO.AC Added field Price List Code
      150904 ITERO.AC Copy Price List Code from Customer to Service Order in DetermineDiscountGroups
      150928 ITERO.PR New Code in "Assigned to"

      160114 ITERO.WG Added ServSetup.GET in assistedit
      160408 ITERO.SB RAD-206 Added field "Tactics Agreement"
      160608 ITERO.SB RAD-006 Added field "Delivery Address Note"
      160718 ITERO.SB RAD-023 Added field "Invoice Text"
      161010 ITERO.AC RAD043 Added filed "Sales Discount Term Percent" in Customer and Service Order
      161012 ITERO.AC RAD043 Adjusted Caption ML for "Sales Discount Term Percent"

      180628 ORANGO.WG #15039 etc Wrong dimension 1 on order
      181204 ORANGO.DL #21999 RAD108 Frbttringsfrslag ppna Workorder
      190827 ORANGO.LP GAP 32 New field "Created Time"
    }
    END.
  }
}

