OBJECT Table 11012500 Plot
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    Permissions=TableData 11072003=rm;
    OnInsert=VAR
               StandDeliveryRec@1210190000 : Record 11012507;
               PlotDeliveryRec@1210190001 : Record 11012507;
               lJobRec@1210190002 : Record 11072003;
               PlotRecordingCrossList@1100525000 : Record 11072253;
               PlotRecordingListBaseLine@1100525001 : Record 11072254;
             BEGIN
               TESTFIELD("Plot No."); //C017655

               "Generate Installments" := FALSE;
               "Installments Generated" := FALSE;
               "Generation Date" := 0D;

               StandDeliveryRec.SETFILTER("Project No.",'%1','');
               StandDeliveryRec.SETFILTER("Plot No.",'%1','');
               IF StandDeliveryRec.FIND('-') THEN
                 REPEAT
                   IF NOT PlotDeliveryRec.GET("Project No.","Plot No.", StandDeliveryRec."Delivery No.") THEN BEGIN
                     PlotDeliveryRec.INIT;
                     PlotDeliveryRec."Project No." := "Project No.";
                     PlotDeliveryRec."Plot No." := "Plot No.";
                     PlotDeliveryRec."Delivery No." := StandDeliveryRec."Delivery No.";
                     PlotDeliveryRec.TRANSFERFIELDS(StandDeliveryRec,FALSE);
                     PlotDeliveryRec.INSERT;
                   END;
               UNTIL StandDeliveryRec.NEXT = 0;

               IF lJobRec.GET("Project No.") THEN BEGIN
                 IF "Due Date Plot" = 0D THEN
                   "Due Date Plot" := lJobRec."Due Date Plot";
                 IF lJobRec."SharePoint Status" = lJobRec."SharePoint Status"::Updated THEN BEGIN
                   lJobRec."SharePoint Status" := lJobRec."SharePoint Status"::Modified;
                   lJobRec.MODIFY;
                 END;
               END;
               ProjectSiteMgt.LogPlot(1, Rec); //**4PS.n

               IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlotRecordingCrossList) AND
                  FPSLicenseManagement.LicenseAndReadPermissionForTable(PlotRecordingListBaseLine)
               THEN BEGIN
                 PlotRecordingCrossList.RESET;
                 PlotRecordingCrossList.SETRANGE("Project No.", "Project No.");
                 IF PlotRecordingCrossList.FINDSET THEN BEGIN
                   REPEAT
                     PlotRecordingListBaseLine.RESET;
                     PlotRecordingListBaseLine.SETRANGE("Project No.", PlotRecordingCrossList."Project No.");
                     PlotRecordingListBaseLine.SETRANGE("Plot No.", "Plot No.");
                     PlotRecordingListBaseLine.SETRANGE("House Model", PlotRecordingCrossList."House Model");
                     PlotRecordingListBaseLine.SETRANGE(Unit, PlotRecordingCrossList.Unit);
                     PlotRecordingListBaseLine.SETRANGE("Line No.", PlotRecordingCrossList."Line No.");
                     IF PlotRecordingListBaseLine.ISEMPTY THEN BEGIN
                       IF PlotRecordingListBaseLine.WRITEPERMISSION THEN BEGIN
                         PlotRecordingListBaseLine.INIT;
                         PlotRecordingListBaseLine."Project No." := PlotRecordingCrossList."Project No.";
                         PlotRecordingListBaseLine."Plot No." := "Plot No.";
                         PlotRecordingListBaseLine."House Model" := PlotRecordingCrossList."House Model";
                         PlotRecordingListBaseLine.Unit := PlotRecordingCrossList.Unit;
                         PlotRecordingListBaseLine."Line No." := PlotRecordingCrossList."Line No.";
                         PlotRecordingListBaseLine.INSERT;
                       END;
                     END;
                   UNTIL PlotRecordingCrossList.NEXT = 0;
                 END;
               END;

               CopyProjectOptiongroups;
             END;

    OnModify=BEGIN
               MODIFY;
               UpdateContractAmount(xRec);
               UpdateContractAmount(Rec);
               UpdateDeliveredObject();
               ProjectSiteMgt.LogPlot(2, Rec); //**4PS.n
             END;

    OnDelete=VAR
               lJobRec@1100485000 : Record 11072003;
               OptionRec@11012000 : Record 11012502;
               ProjDeliveryRec@1210190000 : Record 11012507;
               ProjInstalmRec@1100525000 : Record 11012018;
               OptionMainGroup@1100528200 : Record 11012509;
               OptionGroup@1100528201 : Record 11012504;
               OptionSubGroup@1100528202 : Record 11012505;
             BEGIN
               //CALL C007542 sn
               IF NOT DeleteCompleteProject THEN
                 TESTFIELD("Plot No. Fixed", FALSE);

               ProjInstalmRec.SETRANGE("Project No.","Project No.");
               ProjInstalmRec.SETRANGE("Plot No.","Plot No.");
               IF ProjInstalmRec.FINDSET THEN BEGIN
                 IF ProjRec.GET("Project No.") THEN
                   IF ProjRec."Project Status" < ProjRec."Project Status"::Finished THEN
                     IF CONFIRM(Text008, FALSE) = FALSE THEN
                       ERROR(Text006);
                 IF NOT DeleteCompleteProject THEN BEGIN
                   REPEAT
                     ProjInstalmRec.CALCFIELDS("Invoiced Price (LCY)", "Invoice in Process (LCY)");
                     IF ProjInstalmRec."Invoiced Price (LCY)" + ProjInstalmRec."Invoice in Process (LCY)" <> 0 THEN
                       ERROR(Text007);
                   UNTIL ProjInstalmRec.NEXT = 0;
                 END;
               END;
               //CALL C007542 en

               ProjDeliveryRec.SETRANGE("Project No.","Project No.");
               ProjDeliveryRec.SETRANGE("Plot No.","Plot No.");
               ProjDeliveryRec.DELETEALL;

               OptionRec.SETRANGE("Project No.","Project No.");
               OptionRec.SETRANGE("Plot No.","Plot No.");
               IF OptionRec.FINDSET(TRUE,FALSE) THEN BEGIN
                 OptionRec.SetSkipCheckDelete;
                 REPEAT
                   OptionRec.DELETE(TRUE);
                 UNTIL OptionRec.NEXT = 0;
               END;

               OptionMainGroup.SETRANGE("Project No.","Project No.");
               OptionMainGroup.SETRANGE("Plot No.","Plot No.");
               OptionMainGroup.DELETEALL(TRUE);

               OptionGroup.SETRANGE("Project No.","Project No.");
               OptionGroup.SETRANGE("Plot No.","Plot No.");
               OptionGroup.DELETEALL(TRUE);

               OptionSubGroup.SETRANGE("Project No.","Project No.");
               OptionSubGroup.SETRANGE("Plot No.","Plot No.");
               OptionSubGroup.DELETEALL(TRUE);

               IF NOT DeleteCompleteProject THEN BEGIN //CALL C00754 new

                 DELETE;
                 COMMIT;

                 UpdateContractAmount(Rec);
                 IF lJobRec.GET("Project No.") THEN BEGIN
                   IF lJobRec."SharePoint Status" = lJobRec."SharePoint Status"::Updated THEN BEGIN
                     lJobRec."SharePoint Status" := lJobRec."SharePoint Status"::Modified;
                     lJobRec.MODIFY;
                   END;
                 END;

               END; //CALL C00754 new

               ProjectSiteMgt.LogPlot(3, Rec); //**4PS.n
             END;

    OnRename=VAR
               DocumentLinkMgt@1100525003 : Codeunit 11012401;
               RecRef@1100525000 : RecordRef;
               OldRID@1100525001 : RecordID;
               NewRID@1100525002 : RecordID;
             BEGIN
               IF "Plot No." = '' THEN
                 ERROR('');

               RecRef.GETTABLE(xRec);
               OldRID := RecRef.RECORDID();

               RecRef.GETTABLE(Rec);
               NewRID := RecRef.RECORDID();

               DocumentLinkMgt.HandleRenameDocumentLink(COMPANYNAME, OldRID, NewRID)
             END;

    CaptionML=[ENU=Plot;
               NOR=Tegning;
               SVE=Ritning];
    LookupPageID=Page11012506;
    DrillDownPageID=Page11012506;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr];
                                                   NotBlank=Yes }
    { 11  ;   ;Project Description ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning] }
    { 20  ;   ;Plot No.            ;Code10        ;OnValidate=BEGIN
                                                                TESTFIELD("Plot No.");
                                                              END;

                                                   CaptionML=[ENU=Plot No.;
                                                              NOR=Tegningnr;
                                                              SVE=Ritningnr] }
    { 25  ;   ;Plot No. Fixed      ;Boolean       ;CaptionML=[ENU=Plot No. Fixed;
                                                              NOR=Tegningnr. fast;
                                                              SVE=Ritningnr fastst„llt] }
    { 30  ;   ;House Model         ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                PlotActRec@1100485000 : Record 11020274;
                                                              BEGIN
                                                                IF ("House Model" <> xRec."House Model") THEN BEGIN
                                                                  IF NOT ModelRec.GET("Project No.", "House Model") THEN
                                                                    CLEAR(ModelRec);
                                                                  IF PlotHasPlotRecordingListLines THEN
                                                                    FIELDERROR("House Model", Text009);
                                                                  IF PlotHasOptions() THEN
                                                                    FIELDERROR("House Model", Text000);
                                                                  IF PlotHasOptQuoteLines() THEN
                                                                    FIELDERROR("House Model", Text001);
                                                                  IF ("Installment Scheme" = '') THEN BEGIN
                                                                    IF ModelRec."Project No." <> '' THEN
                                                                      "Installment Scheme" := ModelRec."Installment Scheme Plot";
                                                                  END;
                                                                  IF ModelRec."Project No." <> '' THEN BEGIN
                                                                    "VAT Bus. Posting Group" := ModelRec."VAT Bus. Posting Group";
                                                                    IF Principal = '' THEN
                                                                      "VAT Prod. Posting Group" := ModelRec."VAT Prod. Posting Group";
                                                                  END;
                                                                  PlotActRec.SETRANGE("Project No.","Project No.");
                                                                  PlotActRec.SETRANGE("Plot No.","Plot No.");
                                                                  IF PlotActRec.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      PlotActRec."House Model" := "House Model";
                                                                      PlotActRec.MODIFY;
                                                                    UNTIL PlotActRec.NEXT = 0;
                                                                  END;

                                                                  IF ModelRec."Product Code" <> '' THEN
                                                                    "Product Code" := ModelRec."Product Code";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=House Model;
                                                              NOR=Husmodell;
                                                              SVE=Husmodell];
                                                   NotBlank=Yes }
    { 40  ;   ;Building Seq.       ;Integer       ;CaptionML=[ENU=Building Seq.;
                                                              NOR=Byggesekvens;
                                                              SVE=Byggnadssek.] }
    { 55  ;   ;Block No.           ;Code10        ;CaptionML=[ENU=Block No.;
                                                              NOR=Sperrenr;
                                                              SVE=Sp„rrnr] }
    { 60  ;   ;Seq. No. in Block   ;Integer       ;CaptionML=[ENU=Seq. No. in Block;
                                                              NOR=Sekvensnr i Sperring;
                                                              SVE=Sekvensnr i sp„rr] }
    { 70  ;   ;Address             ;Text100       ;OnValidate=VAR
                                                                lDummy@1210190000 : Text[30];
                                                              BEGIN
                                                              END;

                                                   CaptionML=[ENU=Address;
                                                              NOR=Adresse;
                                                              SVE=Adress] }
    { 80  ;   ;Post Code           ;Code20        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Post Code;
                                                              NOR=Postnr.;
                                                              SVE=Postnr] }
    { 90  ;   ;City                ;Text30        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=City;
                                                              NOR=Sted;
                                                              SVE=Summa inklusive moms] }
    { 95  ;   ;Country/Region Code ;Code10        ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Country/Region Code;
                                                              NOR=Lands-/regionkode;
                                                              SVE=Lands-/regionkod] }
    { 97  ;   ;County              ;Text30        ;CaptionML=[ENU=County;
                                                              NOR=Delstat;
                                                              SVE=Delstat] }
    { 100 ;   ;Plot Surface        ;Decimal       ;CaptionML=[ENU=Plot Surface;
                                                              NOR=Tegningsoverflate;
                                                              SVE=Ritningsyta] }
    { 120 ;   ;Plot Price          ;Decimal       ;OnValidate=BEGIN
                                                                "Plot Price Incl. VAT" := CalculateAmountInclVAT("Plot Price", "Plot Price VAT Amount");
                                                                MessageIfPlotPriceChangesAfterGeneratingInstallments;
                                                              END;

                                                   CaptionML=[ENU=Plot Price;
                                                              NOR=Tegningpris;
                                                              SVE=Ritningspris];
                                                   AutoFormatType=1 }
    { 121 ;   ;Plot Price Incl. VAT;Decimal       ;OnValidate=BEGIN
                                                                "Plot Price" := CalculateAmountExclVAT("Plot Price Incl. VAT", "Plot Price VAT Amount");
                                                                MessageIfPlotPriceChangesAfterGeneratingInstallments;
                                                              END;

                                                   CaptionML=ENU=Plot Price Incl. VAT;
                                                   AutoFormatType=1 }
    { 122 ;   ;Plot Price VAT Amount;Decimal      ;CaptionML=ENU=Plot Price VAT Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 125 ;   ;VAT Amount Long Lease;Decimal      ;CaptionML=[ENU=VAT Amount Long Lease;
                                                              NOR=Mva.-bel›p, lang leasingavtale;
                                                              SVE=Momsbelopp, l†ngt leasingavtal];
                                                   AutoFormatType=1 }
    { 130 ;   ;Building Price      ;Decimal       ;OnValidate=BEGIN
                                                                "Building Price Incl. VAT" := CalculateAmountInclVAT("Building Price", "Building Price VAT Amount");
                                                                MessageIfBuildingPriceChangesAfterGeneratingInstallments;
                                                              END;

                                                   CaptionML=[ENU=Building Price;
                                                              NOR=Byggepris;
                                                              SVE=Byggnadspris];
                                                   AutoFormatType=1 }
    { 131 ;   ;Building Price Incl. VAT;Decimal   ;OnValidate=BEGIN
                                                                "Building Price" := CalculateAmountExclVAT("Building Price Incl. VAT", "Building Price VAT Amount");
                                                                MessageIfBuildingPriceChangesAfterGeneratingInstallments;
                                                              END;

                                                   CaptionML=ENU=Building Price Incl. VAT;
                                                   AutoFormatType=1 }
    { 132 ;   ;Building Price VAT Amount;Decimal  ;CaptionML=ENU=Building Price VAT Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 140 ;   ;Additional Costs    ;Decimal       ;OnValidate=BEGIN
                                                                "Additional Costs Incl. VAT" := CalculateAmountInclVAT("Additional Costs", "Additional Costs VAT Amount");
                                                                MessageIfAdditionalCostsChangeAfterGeneratingInstallments;
                                                              END;

                                                   CaptionML=[ENU=Additional Costs;
                                                              NOR=Tilleggskoster;
                                                              SVE=Till„ggskostnader];
                                                   AutoFormatType=1 }
    { 141 ;   ;Additional Costs Incl. VAT;Decimal ;OnValidate=BEGIN
                                                                "Additional Costs" := CalculateAmountExclVAT("Additional Costs Incl. VAT", "Additional Costs VAT Amount");
                                                                MessageIfAdditionalCostsChangeAfterGeneratingInstallments;
                                                              END;

                                                   CaptionML=ENU=Additional Costs Incl. VAT;
                                                   AutoFormatType=1 }
    { 142 ;   ;Additional Costs VAT Amount;Decimal;CaptionML=ENU=Additional Costs VAT Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 150 ;   ;Installment Scheme  ;Code10        ;TableRelation="Installment Scheme".Code WHERE (Type=CONST(Project));
                                                   CaptionML=[ENU=Installment Scheme;
                                                              NOR=Betalingsplan;
                                                              SVE=Betalplan] }
    { 155 ;   ;Generate Installments;Boolean      ;OnValidate=BEGIN
                                                                TestInstallmentsPerPlotno;
                                                              END;

                                                   CaptionML=[ENU=Generate Installments;
                                                              NOR=Generer avdrag;
                                                              SVE=Generera avbetalningar] }
    { 156 ;   ;Installments Generated;Boolean     ;CaptionML=[ENU=Installments Generated;
                                                              NOR=Genererte avdrag;
                                                              SVE=Genererade avbetalningar];
                                                   Editable=No }
    { 157 ;   ;Generation Date     ;Date          ;CaptionML=[ENU=Generation Date;
                                                              NOR=Genereringsdato;
                                                              SVE=Genererandedatum];
                                                   Editable=No }
    { 160 ;   ;Sales date          ;Date          ;OnValidate=BEGIN
                                                                MODIFY; //Needed cause PlotRec is read in next codeunit
                                                                BuyersMgt.RecalcPlotInstallments("Project No.", "Plot No.");
                                                              END;

                                                   CaptionML=[ENU=Sales date;
                                                              NOR=Salgsdato;
                                                              SVE=F”rs„ljningsdatum] }
    { 170 ;   ;Principal           ;Code20        ;TableRelation="Project Principal".Principal WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                lProjectPricipalRec@1100485000 : Record 11012005;
                                                                PlotActRec@1100485001 : Record 11020274;
                                                              BEGIN
                                                                CALCFIELDS("Principal Name");

                                                                IF ("Principal Options" = '') OR ("Principal Options" = xRec.Principal) THEN
                                                                  VALIDATE("Principal Options",Principal);
                                                                Buyer := GetProspectNo;

                                                                IF (Principal <> xRec.Principal) THEN
                                                                  IF lProjectPricipalRec.GET("Project No.",Principal) THEN
                                                                    "VAT Prod. Posting Group" := lProjectPricipalRec."VAT Prod. Posting Group";

                                                                PlotActRec.SETRANGE("Project No.","Project No.");
                                                                PlotActRec.SETRANGE("Plot No.","Plot No.");
                                                                IF PlotActRec.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    PlotActRec.Principal := Principal;
                                                                    PlotActRec.MODIFY;
                                                                  UNTIL PlotActRec.NEXT = 0;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Principal;
                                                              NOR=Oppdragsgiver;
                                                              SVE=Uppdragsgivare] }
    { 180 ;   ;Principal Name      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Principal)));
                                                   CaptionML=[ENU=Principal Name;
                                                              NOR=Oppdragsgivers navn;
                                                              SVE=Uppdragsgivarens namn];
                                                   Editable=No }
    { 185 ;   ;Second Buyer        ;Code20        ;TableRelation=Contact.No.;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Second Buyer Name");
                                                              END;

                                                   CaptionML=[ENU=Second Buyer;
                                                              NOR=Andre kj›per;
                                                              SVE=Andra k”pare] }
    { 186 ;   ;Second Buyer Name   ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Second Buyer)));
                                                   CaptionML=[ENU=Second Buyer Name;
                                                              NOR=Andre Kj›pers navn;
                                                              SVE=Andre k”parens namn];
                                                   Editable=No }
    { 187 ;   ;Second Buyer Email  ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.E-Mail WHERE (No.=FIELD(Second Buyer)));
                                                   CaptionML=ENU=Second Buyer E-Mail;
                                                   Editable=No }
    { 188 ;   ;Second Buyer Phone  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Phone No." WHERE (No.=FIELD(Second Buyer)));
                                                   CaptionML=ENU=Second Buyer Phone;
                                                   Editable=No }
    { 189 ;   ;Second Buyer Mobile ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Mobile Phone No." WHERE (No.=FIELD(Second Buyer)));
                                                   CaptionML=ENU=Second Buyer Mobile Phone;
                                                   Editable=No }
    { 190 ;   ;Option Total        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum(Option."Contract Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                   Plot No.=FIELD(Plot No.),
                                                                                                   Status=FILTER(Order|Invoice)));
                                                   CaptionML=[ENU=Option Total;
                                                              NOR=Totalt for alternativ;
                                                              SVE=Totalt f”r alternativ];
                                                   Editable=No }
    { 200 ;   ;Modular Option Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum(Option."Contract Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                   Plot No.=FIELD(Plot No.),
                                                                                                   Status=FILTER(Order|Invoice),
                                                                                                   Modular=CONST(Yes)));
                                                   CaptionML=ENU=Modular Option Total;
                                                   Editable=No }
    { 210 ;   ;Buyer Name          ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer Name;
                                                              NOR=Kj›pers navn;
                                                              SVE=K”parnamn];
                                                   Editable=No }
    { 220 ;   ;Buyer Name 2        ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Name 2" WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer Name 2;
                                                              NOR=Kj›pers navn 2;
                                                              SVE=K”parens namn 2];
                                                   Editable=No }
    { 230 ;   ;Buyer Address       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Address WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer Address;
                                                              NOR=Kj›peraderesse;
                                                              SVE=K”paradress];
                                                   Editable=No }
    { 240 ;   ;Buyer Address 2     ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Address 2" WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer Address 2;
                                                              NOR=Kj›peraderesse 2;
                                                              SVE=K”paradress 2];
                                                   Editable=No }
    { 250 ;   ;Buyer Post Code     ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Post Code" WHERE (No.=FIELD(Buyer)));
                                                   TableRelation="Post Code";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Buyer Post Code;
                                                              NOR=Kj›pers Postnummer;
                                                              SVE=K”parens postnummer];
                                                   Editable=No }
    { 260 ;   ;Buyer City          ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.City WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer City;
                                                              NOR=Kj›perby;
                                                              SVE=K”parort];
                                                   Editable=No }
    { 270 ;   ;Buyer Country/Region;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Country/Region Code" WHERE (No.=FIELD(Buyer)));
                                                   TableRelation=Country/Region;
                                                   CaptionML=[ENU=Buyer Country/Region;
                                                              NOR=Kj›pers land/region;
                                                              SVE=K”parens land/region];
                                                   Editable=No }
    { 275 ;   ;Buyer County        ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.County WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer County;
                                                              NOR=Kj›perfylke];
                                                   Editable=No }
    { 280 ;   ;Buyer Phone         ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Phone No." WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Buyer Phone;
                                                              NOR=Kj›pers Telefon;
                                                              SVE=K”parens telefon];
                                                   Editable=No }
    { 281 ;   ;Buyer Phone 2       ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Phone No. 2" WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Buyer Phone 2;
                                                              NOR=Kj›pers Telefon 2;
                                                              SVE=K”parens telefon 2];
                                                   Editable=No }
    { 282 ;   ;Buyer Mobile Phone  ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Mobile Phone No." WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Buyer Mobile Phone;
                                                              NOR=Kj›pers mobiltelefon;
                                                              SVE=K”parens mobiltelefon];
                                                   Editable=No }
    { 283 ;   ;Buyer E-Mail        ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.E-Mail WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=E-Mail;
                                                   CaptionML=[ENU=Buyer E-Mail;
                                                              NOR=Kj›pers E-Mail;
                                                              SVE=K”parens e-post];
                                                   Editable=No }
    { 284 ;   ;Buyer Mobile Phone 2;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Mobile Phone No. 2" WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Buyer Mobile Phone 2;
                                                              NOR=Kj›pers mobiltelefon 2;
                                                              SVE=K”parens mobiltelefon 2];
                                                   Editable=No }
    { 285 ;   ;Buyer Phone Work    ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Phone No. Work" WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Buyer Phone Work;
                                                              NOR=Kj›pers jobbtelefon;
                                                              SVE=K”parens arbetstelefon];
                                                   Editable=No }
    { 286 ;   ;Buyer Phone Work 2  ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."Phone No. Work 2" WHERE (No.=FIELD(Buyer)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Buyer Phone Work 2;
                                                              NOR=Kj›pers jobbtelefon 2;
                                                              SVE=K”parens arbetstelefon 2];
                                                   Editable=No }
    { 300 ;   ;Number of Options in Order;Integer ;FieldClass=FlowField;
                                                   CalcFormula=Count(Option WHERE (Project No.=FIELD(Project No.),
                                                                                   Plot No.=FIELD(Plot No.),
                                                                                   Status=FILTER(Order|Invoice)));
                                                   CaptionML=[ENU=Number of Options in Order;
                                                              NOR=Antall alternativer i Ordre;
                                                              SVE=Antal alternativ i order];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 310 ;   ;Number of Options Open;Integer     ;FieldClass=FlowField;
                                                   CalcFormula=Count(Option WHERE (Project No.=FIELD(Project No.),
                                                                                   Plot No.=FIELD(Plot No.),
                                                                                   Status=FILTER(<Order)));
                                                   CaptionML=[ENU=Number of Options Open;
                                                              NOR=Antall pne alternativer;
                                                              SVE=Antal ”ppna alternativ];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 320 ;   ;Principal Options   ;Code20        ;TableRelation="Project Principal".Principal WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                OptionRec@1100485000 : Record 11012502;
                                                              BEGIN
                                                                OptionRec.SETRANGE("Project No.","Project No.");
                                                                OptionRec.SETRANGE("Plot No.","Plot No.");
                                                                IF OptionRec.COUNT > 0 THEN
                                                                  IF CONFIRM(Text002, TRUE, "Principal Options") THEN BEGIN
                                                                    IF OptionRec.FINDSET(TRUE,FALSE) THEN BEGIN
                                                                      REPEAT
                                                                        OptionRec.Principal := "Principal Options";
                                                                        OptionRec.MODIFY;
                                                                      UNTIL OptionRec.NEXT = 0;
                                                                    END;
                                                                  END;

                                                                CALCFIELDS("Principal Options Name");
                                                                Buyer := GetProspectNo;
                                                              END;

                                                   CaptionML=[ENU=Principal Options;
                                                              NOR=Hovedalternativ;
                                                              SVE=Huvudalternativ] }
    { 330 ;   ;Principal Options Name;Text100     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Principal Options)));
                                                   CaptionML=[ENU=Principal Options Name;
                                                              NOR=Hovedalternativer, navn;
                                                              SVE=Huvudalternativ, namn];
                                                   Editable=No }
    { 340 ;   ;Options Closing Date;Date          ;CaptionML=[ENU=Options Closing Date;
                                                              NOR=Alternativer, Sluttdato;
                                                              SVE=Alternativ, st„ngningsdatum] }
    { 350 ;   ;Buyer               ;Code20        ;TableRelation=Contact.No.;
                                                   CaptionML=[ENU=Buyer;
                                                              NOR=Kj›per;
                                                              SVE=K”pare] }
    { 360 ;   ;Last Date Option List Printed;Date ;CaptionML=[ENU=Last Date Option List Printed;
                                                              NOR=Sist dato Alternativlisten ble skrevet ut;
                                                              SVE=Senaste datum som alternativlistan skrevs ut];
                                                   Editable=No }
    { 365 ;   ;Last Time Option List Printed;Time ;CaptionML=[ENU=Last Time Option List Printed;
                                                              NOR=Sist gang Alternativlisten ble skrevet ut;
                                                              SVE=Senaste g†ngen som alternativlistan skrevs ut];
                                                   Editable=No }
    { 380 ;   ;(Re)Print Option List;Boolean      ;FieldClass=FlowField;
                                                   CalcFormula=Exist(Option WHERE (Project No.=FIELD(Project No.),
                                                                                   Plot No.=FIELD(Plot No.),
                                                                                   (Re)Print Option List=CONST(Yes)));
                                                   CaptionML=[ENU=(Re)Print Option List;
                                                              NOR=Skriv ut Alternativlisten (p† nytt);
                                                              SVE=Skriv ut alternativlistan (igen)];
                                                   Editable=No }
    { 387 ;   ;Buyer E-Mail 2      ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact."E-Mail 2" WHERE (No.=FIELD(Buyer)));
                                                   CaptionML=[ENU=Buyer E-Mail 2;
                                                              NOR=Kj›pers E-Mail 2;
                                                              SVE=K”parens e-post 2];
                                                   Editable=No }
    { 390 ;   ;Offers Expired      ;Boolean       ;CaptionML=[ENU=Offers Expired;
                                                              NOR=Tilbudet har forfalt;
                                                              SVE=Anbudet har f”rfallit];
                                                   Editable=No }
    { 400 ;   ;Due Date Plot       ;Date          ;CaptionML=[ENU=Due Date Plot;
                                                              NOR=Forfallsdato for tegning;
                                                              SVE=F”rfallodatum f”r Ritning] }
    { 410 ;   ;Contract Date       ;Date          ;CaptionML=[ENU=Contract Date;
                                                              NOR=Kontraktsdato;
                                                              SVE=Kontraktdatum] }
    { 420 ;   ;Transfer Date       ;Date          ;CaptionML=[ENU=Transfer Date;
                                                              NOR=Overf›ringsdato;
                                                              SVE=™verf”ringsdatum] }
    { 430 ;   ;Interest Applicable ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Interest Applicable;
                                                              NOR=Rente Anvendes;
                                                              SVE=R„nta till„mpas] }
    { 440 ;   ;Sales Status        ;Option        ;OnValidate=BEGIN
                                                                "Sales Status Since" := TODAY;
                                                                CASE "Sales Status" OF
                                                                  "Sales Status"::"Provisional Contract":
                                                                    IF "Contract Date" = 0D THEN
                                                                      "Contract Date" := TODAY;
                                                                  "Sales Status"::Sold:
                                                                    IF "Sales date" = 0D THEN
                                                                      VALIDATE("Sales date", TODAY);
                                                                  "Sales Status"::Transferred:
                                                                    IF "Transfer Date" = 0D THEN
                                                                      "Transfer Date" := TODAY;
                                                                END;

                                                                SalesStatusHistory.UpdateSalesStatusHistory(Rec, xRec."Sales Status", xRec."Sales Status Since"); //C036798.n
                                                              END;

                                                   CaptionML=[ENU=Sales Status;
                                                              NOR=Salgsstatus;
                                                              SVE=F”rs„ljningsstatus];
                                                   OptionCaptionML=[ENU=" ,Option,Under Negotiation,Provisional Contract,Consideration Time,Sold,Transferred";
                                                                    NOR=" ,Alternativ,Under forhandling,Provisorisk kontrakt,Betenkningstid,Solgt,Overf›rt";
                                                                    SVE=" ,Alternativ,Under f”rhandling,Prelimin„rt kontrakt,Bet„nketid,S†lt,™verf”rt"];
                                                   OptionString=[ ,Option,Under Negotiation,Provisional Contract,Consideration Time,Sold,Transferred] }
    { 450 ;   ;Sales Status Since  ;Date          ;OnValidate=BEGIN
                                                                SalesStatusHistory.UpdateSalesStatusHistory(Rec, xRec."Sales Status", xRec."Sales Status Since"); //C036798.n
                                                              END;

                                                   CaptionML=[ENU=Sales Status Since;
                                                              NOR=Salgsstatus siden;
                                                              SVE=F”rs„ljningsstatus sedan] }
    { 460 ;   ;Delivered Object    ;Code20        ;TableRelation="Delivered Object".No.;
                                                   CaptionML=[ENU=Delivered Object;
                                                              NOR=Levert objekt;
                                                              SVE=Levererat objekt];
                                                   Editable=No }
    { 470 ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=BEGIN
                                                                CalculateVAT;
                                                              END;

                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              NOR=Moms Bevegelsebokf›ringsmal;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 480 ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=BEGIN
                                                                CalculateVAT;
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Mva-bokf›ringsgruppe - vare;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 485 ;   ;VAT Percentage      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("VAT Posting Setup"."VAT %" WHERE (VAT Bus. Posting Group=FIELD(VAT Bus. Posting Group),
                                                                                                         VAT Prod. Posting Group=FIELD(VAT Prod. Posting Group)));
                                                   CaptionML=[ENU=VAT Percentage;
                                                              NOR=Mva.-sats;
                                                              SVE=Momsprocentsats];
                                                   Editable=No }
    { 490 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Plot Comment Line" WHERE (Project No.=FIELD(Project No.),
                                                                                                Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 500 ;   ;Floor No.           ;Code10        ;CaptionML=[ENU=Floor No.;
                                                              NOR=Etasje nr;
                                                              SVE=V†ning nr] }
    { 510 ;   ;Div. Int. Before Contract Date;Decimal;
                                                   CaptionML=[ENU=Div. Interest Before Contract Date;
                                                              NOR=Del rente f›r Kontraktsdato;
                                                              SVE=Del. r„nta f”re kontraktsdatum];
                                                   DecimalPlaces=2:2;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 520 ;   ;Div. Int. Before Transfer Date;Decimal;
                                                   CaptionML=[ENU=Div. Interest Before Transfer Date;
                                                              NOR=Del rente f›r Overf›ringsdato;
                                                              SVE=Del. r„nta f”re ”verf”ringsdatum];
                                                   DecimalPlaces=2:2;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 530 ;   ;Land Registry No.   ;Code50        ;CaptionML=[ENU=Land Registry No.;
                                                              NOR=Landregistreringsnr.;
                                                              SVE=Markregistreringsnr] }
    { 540 ;   ;EAN Code Electricity;Code18        ;CaptionML=[ENU=EAN Code Electricity;
                                                              NOR=EAN-kode, Elektrisitet;
                                                              SVE=EAN-kod, elektricitet];
                                                   Numeric=Yes }
    { 545 ;   ;Request EAN Code El. Before;Date   ;CaptionML=[ENU=Request EAN Code Electricity Before;
                                                              NOR=Anmod EAN-kode for elektrisitet f›r;
                                                              SVE=Efterfr†ga EAN-kod f”r elektricitet f”re] }
    { 550 ;   ;EAN Code Gas        ;Code18        ;CaptionML=[ENU=EAN Code Gas;
                                                              NOR=EAN-kode for gass;
                                                              SVE=EAN-kod f”r gas];
                                                   Numeric=Yes }
    { 555 ;   ;Request EAN Code Gas Before;Date   ;CaptionML=[ENU=Request EAN Code Gas Before;
                                                              NOR=Anmod EAN-kode for gass f›r;
                                                              SVE=Efterfr†ga EAN-kod f”r gas f”re] }
    { 560 ;   ;Energy Label        ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("House Model"."Energy Label" WHERE (Project No.=FIELD(Project No.),
                                                                                                          Model=FIELD(House Model)));
                                                   CaptionML=[ENU=Energy Label;
                                                              NOR=Energimerking;
                                                              SVE=Energim„rkning];
                                                   Editable=No }
    { 562 ;   ;Warrenty Certificate No.;Code30    ;CaptionML=ENU=Warrenty Certificate No. }
    { 570 ;   ;Buy/Rent            ;Option        ;CaptionML=ENU=Buy/Rent;
                                                   OptionCaptionML=ENU=Buy,Rent;
                                                   OptionString=Sale,Rent }
    { 610 ;   ;Occupant Name       ;Text100       ;CaptionML=ENU=Occupant Name }
    { 620 ;   ;Occupant Phone      ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=ENU=Occupant Phone }
    { 630 ;   ;Occupant Mobile Phone;Text30       ;ExtendedDatatype=Phone No.;
                                                   CaptionML=ENU=Occupant Mobile Phone }
    { 640 ;   ;Occupant E-Mail     ;Text80        ;ExtendedDatatype=E-Mail;
                                                   CaptionML=ENU=Occupant E-Mail }
    { 650 ;   ;MMR Phase           ;Option        ;CaptionML=ENU=MMR Phase;
                                                   OptionCaptionML=ENU=PreRecording,Recording,Production;
                                                   OptionString=PreRecording,Recording,Production }
    { 660 ;   ;MMR Status          ;Option        ;CaptionML=ENU=MMR Status;
                                                   OptionCaptionML=ENU=Open,,,Finished;
                                                   OptionString=Open,,,Finished }
    { 670 ;   ;MMR Generate Invoice;Boolean       ;CaptionML=ENU=MMR Generate Invoice }
    { 680 ;   ;MMR Invoiced        ;Boolean       ;CaptionML=ENU=MMR Invoiced }
    { 700 ;   ;Expiration Date     ;Date          ;CaptionML=[ENU=Expiration Date;
                                                              SVE=Utg†ngsdatum] }
    { 710 ;   ;Good News Letter Date;Date         ;CaptionML=ENU=Good News Letter Date }
    { 720 ;   ;Financial Restriction Date;Date    ;CaptionML=ENU=Financial Restriction Date }
    { 730 ;   ;Starting Date       ;Date          ;CaptionML=[ENU=Starting Date;
                                                              NOR=Startdato;
                                                              SVE=Startdatum] }
    { 740 ;   ;Image               ;Media         ;CaptionML=[ENU=Image;
                                                              NOR=Image;
                                                              SVE=Bild] }
    { 750 ;   ;Perm. to Use Tenant SurveyInfo;Boolean;
                                                   CaptionML=ENU=Perm. to Use Tenant SurveyInfo }
    { 760 ;   ;Perm. to Supply Info to Others;Boolean;
                                                   CaptionML=ENU=Perm. to Supply Info to Others }
    { 770 ;   ;Warranty End Date   ;Date          ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Warranty End Date }
    { 780 ;   ;Product Code        ;Code10        ;TableRelation="Project CF Product".Product WHERE (Project No.=FIELD(Project No.),
                                                                                                     Record Type=CONST(Project));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Product Code;
                                                              SVE=Produktkod] }
  }
  KEYS
  {
    {    ;Project No.,Plot No.                    ;Clustered=Yes }
    {    ;Plot No.                                 }
    {    ;Project No.,Principal                   ;SumIndexFields=Building Price,Plot Price,Additional Costs }
    {    ;Project No.,Building Seq.                }
  }
  FIELDGROUPS
  {
    { 1   ;Brick               ;Plot No.,Project Description,Project No.,House Model,Building Price,Buyer Name,Image }
  }
  CODE
  {
    VAR
      ProjSetup@1100485001 : Record 315;
      ModelRec@11012000 : Record 11012501;
      PostCode@11012001 : Record 225;
      ProjRec@1100485000 : Record 11072003;
      SalesStatusHistory@1100529600 : Record 11071835;
      Currency@1100528400 : Record 4;
      BuyersMgt@1210190000 : Codeunit 11012500;
      Text000@1210190001 : TextConst 'ENU=of Plot No. may not be modified, there are already Options present;NOR=av tegningnr. kan ikke endres, det finnes allerede alternativer;SVE=av Ritningnr kan inte „ndras, det finns redan alternativ';
      Text001@1210190002 : TextConst 'ENU=of Plot No. may not be modified, there are already Option Quote Lines present;NOR=av tegningnr. kan ikke kan endres, det finnes allerede Alternativtilbudrader;SVE=av Ritningnr kan inte kan „ndras, det finns redan alternativoffertrader';
      Text002@1100485002 : TextConst 'ENU=Change Principal of te Option Lines into %1?;NOR=Endre Oppdragsgiver for Alternativradene til %1?;SVE=Žndra uppdragsgivare f”r alternativraderna till %1?';
      Text003@1100525000 : TextConst 'ENU=Project Installments generated. Change them manually.;NOR=Prosjektavdrag er Generert. Endre dem manuelt.;SVE=Projektavbetalningar har genererats. Žndra dem manuellt.';
      ProjectSiteMgt@1100528300 : Codeunit 11012282;
      DeleteCompleteProject@1100525001 : Boolean;
      Text006@1100525004 : TextConst 'ENU=Process stopped;NOR=Prosessen har stoppet;SVE=Processen har stannat';
      Text007@1100525003 : TextConst 'ENU="Installments already invoiced; Process stopped";NOR="Betalingsplaner er allerede fakturert; Prosess stoppet.";SVE=Betalplaner har redan fakturerats. Processen har stoppats';
      Text008@1100525002 : TextConst 'ENU="Installments present; continue ?";NOR=Betalingsplaner finnes, fortsette?;SVE=Betalplaner finns, forts„tta?';
      Text009@1100528200 : TextConst 'ENU=of Plot No. may not be modified, there are already Plot Recording List Lines present.';
      RoundingPrecisionInitialized@1100528401 : Boolean;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;

    PROCEDURE UpdateContractAmount@1(lPlotNoRec@11012000 : Record 11012500);
    VAR
      lPrincipRec@11012001 : Record 11012005;
    BEGIN
      COMMIT;
      IF lPrincipRec.GET(lPlotNoRec."Project No.",lPlotNoRec.Principal) THEN
        IF lPrincipRec."Installments per Plot" THEN BEGIN
          lPrincipRec.VALIDATE("Installments per Plot");
          lPrincipRec.MODIFY;
        END;
    END;

    PROCEDURE TestInstallmentsPerPlotno@2();
    VAR
      lPrincipRec@11012000 : Record 11012005;
    BEGIN
      TESTFIELD(Principal);
      lPrincipRec.GET("Project No.",Principal);
      lPrincipRec.TESTFIELD("Installments per Plot",TRUE);
    END;

    PROCEDURE GetProspectNo@1210190002() ProspectCde : Code[20];
    VAR
      BusinessRelRec@1210190000 : Record 5054;
    BEGIN
      IF "Principal Options" = '' THEN EXIT('');  //C031436
      BusinessRelRec.SETCURRENTKEY("Link to Table","No.");
      BusinessRelRec.SETRANGE("No.","Principal Options");
      BusinessRelRec.SETRANGE("Link to Table",BusinessRelRec."Link to Table"::Customer);
      IF BusinessRelRec.FIND('-') THEN
        EXIT(BusinessRelRec."Contact No.")
      ELSE
        EXIT('');
    END;

    PROCEDURE PlotHasOptions@1210190000() : Boolean;
    VAR
      lvOptionRec@1210190000 : Record 11012502;
    BEGIN
      IF ("Project No." <> '') AND ("Plot No." <> '') THEN BEGIN
        lvOptionRec.SETRANGE("Project No.", "Project No.");
        lvOptionRec.SETRANGE("Plot No.", "Plot No.");
        IF lvOptionRec.FINDFIRST THEN
          EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE PlotHasOptQuoteLines@1210190001() : Boolean;
    VAR
      lvOptQuoteLineRec@1210190000 : Record 11012514;
    BEGIN
      IF ("Project No." <> '') AND ("Plot No." <> '') THEN BEGIN
        lvOptQuoteLineRec.SETCURRENTKEY("Project No.", "Plot No.");
        lvOptQuoteLineRec.SETRANGE("Project No.", "Project No.");
        lvOptQuoteLineRec.SETRANGE("Plot No.", "Plot No.");
        IF lvOptQuoteLineRec.FIND('-') THEN
          EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE PlotVatProdPostingGroup@1100485000() : Code[10];
    BEGIN
      ProjRec.GET("Project No.");
      IF ProjRec."Conveyance Tax" AND
        ((ProjRec."Ready for Building Date" = 0D) OR ("Sales date" < ProjRec."Ready for Building Date")) THEN
      BEGIN
        ProjSetup.GET;
        ProjSetup.TESTFIELD("VAT Prod. Posting Group Plot");
        EXIT(ProjSetup."VAT Prod. Posting Group Plot");
      END;
    END;

    PROCEDURE ShowDocuments@1100485003();
    VAR
      RecRef@1100525000 : RecordRef;
      DocumentFilters@1100525001 : Codeunit 11012432;
    BEGIN
      IF "Plot No." = '' THEN
        EXIT;

      TESTFIELD("Principal Options");

      IF GetProspectNo <> '' THEN BEGIN
        RecRef.GETTABLE(Rec);
        DocumentFilters.CreateTempFilterAndExecute1(RecRef, '', FALSE, TRUE);
      END;
    END;

    PROCEDURE UpdateDeliveredObject@1100525000();
    VAR
      lvDelivbjectRec@1100525000 : Record 11012101;
      lvModified@1100525001 : Boolean;
    BEGIN
      IF "Delivered Object" = '' THEN
        EXIT;
      IF NOT lvDelivbjectRec.GET("Delivered Object") THEN
        EXIT;

      IF lvDelivbjectRec.Address <> Address THEN BEGIN
        lvDelivbjectRec.Address := Address;
        lvModified := TRUE;
      END;
      IF lvDelivbjectRec."Post Code" <> "Post Code" THEN BEGIN
        lvDelivbjectRec."Post Code" := "Post Code";
        lvModified := TRUE;
      END;
      IF lvDelivbjectRec. City <>  City THEN BEGIN
        lvDelivbjectRec. City :=  City;
        lvModified := TRUE;
      END;

      IF lvModified THEN
        lvDelivbjectRec.MODIFY;
    END;

    PROCEDURE EditDocuments@1100528702(DocumentTemplateTypeFilter@1210190003 : Text[250];ContactNo@1210190004 : Code[20];ContactPersonNo@1210190005 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      Job@1100528701 : Record 11072003;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      IF Job.GET("Project No.") THEN BEGIN
        RecRef.GETTABLE(Job);
        DocumentLinkRIDs[2] := RecRef.RECORDID;
      END;

      DocumentMailing.EditDocuments(
        DocumentTemplateTypeFilter, DocumentLinkRIDs, '', ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE SetDeleteCompleteProject@1100525001();
    BEGIN
      //CALL C007542
      DeleteCompleteProject := TRUE;
    END;

    PROCEDURE PlotHasPlotRecordingListLines@1100528200() : Boolean;
    VAR
      PlotSQRecordingLine@1100528200 : Record 11072252;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(PlotSQRecordingLine) THEN
        EXIT;

      IF ("Project No." <> '') AND ("Plot No." <> '') THEN BEGIN
        PlotSQRecordingLine.SETRANGE("Project No.", "Project No.");
        PlotSQRecordingLine.SETRANGE("Plot No.", "Plot No.");
        IF PlotSQRecordingLine.FINDFIRST THEN
          EXIT(TRUE);
      END;
      EXIT(FALSE);
    END;

    PROCEDURE UpdatePlotCollectively@1100528614(VAR Plot@1100528200 : Record 11012500);
    VAR
      lvPlot@1100528600 : Record 11012500;
      UpdatePlotStatus@1100528602 : Report 11071710;
    BEGIN
      lvPlot.COPY(Plot);
      IF lvPlot.ISEMPTY THEN
        ERROR(Text000);
      UpdatePlotStatus.SETTABLEVIEW(lvPlot);
      UpdatePlotStatus.RUNMODAL;
      Plot.CLEARMARKS;
    END;

    PROCEDURE GetOptionTotalInclVAT@1100528400(OnlyModularOptions@1100528401 : Boolean) OptionTotalInclVAT : Decimal;
    VAR
      Option@1100528400 : Record 11012502;
    BEGIN
      Option.SETRANGE("Project No.", "Project No.");
      Option.SETRANGE("Plot No.", "Plot No.");
      Option.SETFILTER(Status, '%1|%2', Option.Status::Order, Option.Status::Invoice);
      IF OnlyModularOptions THEN
        Option.SETRANGE(Modular, TRUE);
      IF Option.FINDSET THEN
        REPEAT
          Option.CALCFIELDS("VAT Percentage");
          OptionTotalInclVAT :=
            OptionTotalInclVAT +
            RoundAmount(Option."Contract Amount" * (1 + Option."VAT Percentage" / 100));
        UNTIL Option.NEXT = 0;
    END;

    LOCAL PROCEDURE MessageIfPlotPriceChangesAfterGeneratingInstallments@1100528414();
    BEGIN
      IF ("Plot Price" <> xRec."Plot Price") AND
         "Installments Generated" AND
         GUIALLOWED
      THEN
        MESSAGE(Text003);
    END;

    LOCAL PROCEDURE MessageIfBuildingPriceChangesAfterGeneratingInstallments@1100528415();
    BEGIN
      IF ("Building Price" <> xRec."Building Price") AND
         "Installments Generated" AND
         GUIALLOWED
      THEN
        MESSAGE(Text003);
    END;

    LOCAL PROCEDURE MessageIfAdditionalCostsChangeAfterGeneratingInstallments@1100528416();
    BEGIN
      IF ("Additional Costs" <> xRec."Additional Costs") AND
         "Installments Generated" AND
         GUIALLOWED
      THEN
        MESSAGE(Text003);
    END;

    LOCAL PROCEDURE CalculateAmountExclVAT@1100528401(AmountInclVAT@1100528400 : Decimal;VAR VATAmount@1100528401 : Decimal) AmountExclVAT : Decimal;
    BEGIN
      CALCFIELDS("VAT Percentage");
      VATAmount := RoundAmount("VAT Percentage" * AmountInclVAT / (100 + "VAT Percentage"));
      AmountExclVAT := AmountInclVAT - VATAmount;
    END;

    LOCAL PROCEDURE CalculateAmountInclVAT@1100528402(AmountExclVAT@1100528400 : Decimal;VAR VATAmount@1100528401 : Decimal) AmountInclVAT : Decimal;
    BEGIN
      CALCFIELDS("VAT Percentage");
      VATAmount := RoundAmount("VAT Percentage" * AmountExclVAT / 100);
      AmountInclVAT := AmountExclVAT + VATAmount;
    END;

    LOCAL PROCEDURE RoundAmount@1100528404(Amount@1100528400 : Decimal) RoundedAmount : Decimal;
    BEGIN
      IF NOT RoundingPrecisionInitialized THEN BEGIN
        Currency.InitRoundingPrecision;
        RoundingPrecisionInitialized := TRUE;
      END;
      RoundedAmount := ROUND(Amount, Currency."Amount Rounding Precision");
    END;

    LOCAL PROCEDURE CalculateVAT@1100528406();
    BEGIN
      VALIDATE("Plot Price");
      VALIDATE("Building Price");
      VALIDATE("Additional Costs");
    END;

    LOCAL PROCEDURE CopyProjectOptiongroups@1100528201();
    VAR
      OptionMainGroup@1100528202 : Record 11012509;
      OptionGroup@1100528201 : Record 11012504;
      OptionSubGroup@1100528200 : Record 11012505;
      OptionMainGroup2@1100528205 : Record 11012509;
      OptionGroup2@1100528204 : Record 11012504;
      OptionSubGroup2@1100528203 : Record 11012505;
    BEGIN
      OptionMainGroup.SETRANGE("Project No.","Project No.");
      OptionMainGroup.SETRANGE("Plot No.",'');
      IF OptionMainGroup.FINDSET(FALSE,FALSE) THEN
        REPEAT
          OptionMainGroup2 := OptionMainGroup;
          OptionMainGroup2."Plot No." := "Plot No.";
          IF NOT OptionMainGroup2.FIND('=') THEN
            OptionMainGroup2.INSERT;
        UNTIL OptionMainGroup.NEXT = 0;

      OptionGroup.SETRANGE("Project No.","Project No.");
      OptionGroup.SETRANGE("Plot No.",'');
      IF OptionGroup.FINDSET(FALSE,FALSE) THEN
        REPEAT
          OptionGroup2 := OptionGroup;
          OptionGroup2."Plot No." := "Plot No.";
          IF NOT OptionGroup2.FIND('=') THEN
            OptionGroup2.INSERT;
        UNTIL OptionGroup.NEXT = 0;

      OptionSubGroup.SETRANGE("Project No.","Project No.");
      OptionSubGroup.SETRANGE("Plot No.",'');
      IF OptionSubGroup.FINDSET(FALSE,FALSE) THEN
        REPEAT
          OptionSubGroup2 := OptionSubGroup;
          OptionSubGroup2."Plot No." := "Plot No.";
          IF NOT OptionSubGroup2.FIND('=') THEN
            OptionSubGroup2.INSERT;
        UNTIL OptionSubGroup.NEXT = 0;
    END;

    BEGIN
    {
      **4PS01 Jan ter Harmsel, Call 2094  At Rename also update references in documents.
      That table is on database level and will not be handled automatically.

      4PS02 Jan ter Harmsel, Deliveries Heijligers.
    }
    END.
  }
}

