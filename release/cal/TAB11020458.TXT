OBJECT Table 11020458 Estimate Composition
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnModify=BEGIN
               Changed := TRUE;
               CheckRelatedApplianceType;  //db, 14-03-19
             END;

    CaptionML=[ENU=Estimate Composition;
               NOR=Kalkylesammensetning;
               SVE=Ackordkalkyl];
    LookupPageID=Page11229769;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr];
                                                   Editable=No }
    { 20  ;   ;Sub-Estimate No.    ;Code20        ;TableRelation=Sub-Estimate."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Sub-Estimate No.;
                                                              NOR=Delkalkylenummer;
                                                              SVE=Delkalkylnr] }
    { 25  ;   ;Part Group          ;Code10        ;TableRelation=Sub-Estimate."Part Group" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.));
                                                   CaptionML=[ENU=Part Group;
                                                              NOR=Del gruppe;
                                                              SVE=Delgrupp] }
    { 30  ;   ;Part                ;Code20        ;TableRelation="Estimate Part".Part WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                             Part Group=FIELD(Part Group));
                                                   CaptionML=[ENU=Part;
                                                              NOR=Del;
                                                              SVE=Del] }
    { 40  ;   ;Estimate Line       ;Integer       ;TableRelation="Estimate Line"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part=FIELD(Part));
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Estimate Line;
                                                              NOR=Kalkylerad;
                                                              SVE=Uppskattningsrad] }
    { 43  ;   ;Estimate Level Sub-Estimate;Integer;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Sub-Estimate.Level WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Estimate Level Sub-Estimat;
                                                              NOR=Delkalkyle for kalkylenivÜ;
                                                              SVE=Delkalkyl fîr kalkylnivÜ] }
    { 45  ;   ;Estimate Level Part ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Part".Level WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FIELD(Part Group),
                                                                                                   Part=FIELD(Part)));
                                                   CaptionML=[ENU=Estimate Level Part;
                                                              NOR=Del for kalkylenivÜ;
                                                              SVE=Del fîr kalkylnivÜ] }
    { 50  ;   ;Recipe Line         ;Integer       ;CaptionML=[ENU=Recipe Line;
                                                              NOR=Malrad;
                                                              SVE=Mallrad] }
    { 51  ;   ;Recipe              ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Recipe Group));
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Recipe;
                                                              NOR=Mal;
                                                              SVE=Mall] }
    { 52  ;   ;Recipe Group        ;Code10        ;TableRelation="Recipe Group".No.;
                                                   CaptionML=[ENU=Recipe Group;
                                                              NOR=Maltype;
                                                              SVE=Malltyp] }
    { 53  ;   ;Recipe Description  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Base Recipe".Description WHERE (Recipe Group=FIELD(Recipe Group),
                                                                                                       No.=FIELD(Recipe)));
                                                   CaptionML=[ENU=Recipe Description;
                                                              NOR=Beskrivelse av mal;
                                                              SVE=Mallbeskrivning];
                                                   Editable=No }
    { 55  ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 56  ;   ;Attached to Line No.;Integer       ;TableRelation="Estimate Line"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FIELD(Part Group),
                                                                                                   Part=FIELD(Part));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              NOR=Knyttet til linjenr.;
                                                              SVE=Bifogad till radnr];
                                                   Editable=No }
    { 57  ;   ;Set Level           ;Integer       ;CaptionML=[ENU=Set Level;
                                                              NOR=Still inn nivÜ;
                                                              SVE=StÑll in nivÜ] }
    { 58  ;   ;Set Code            ;Code10        ;TableRelation="Plant Set";
                                                   CaptionML=[ENU=Set Code;
                                                              NOR=Still inn kode;
                                                              SVE=StÑll in kod];
                                                   Editable=No }
    { 60  ;   ;Description         ;Text100       ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 75  ;   ;Compressed          ;Boolean       ;CaptionML=[ENU=Compressed;
                                                              NOR=Komprimert;
                                                              SVE=Komprimerad] }
    { 80  ;   ;Quantity            ;Decimal       ;CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 85  ;   ;Part Quantity       ;Decimal       ;CaptionML=[ENU=Part Quantity;
                                                              NOR=Delantall;
                                                              SVE=Delantal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 86  ;   ;Cumulative Quantity ;Decimal       ;CaptionML=[ENU=Cumulative Quantity;
                                                              NOR=Akkumulert antall;
                                                              SVE=Ackumulerat antal];
                                                   DecimalPlaces=0:5 }
    { 90  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN
                                                                  IF "Unit of Measure" <>  xRec."Unit of Measure" THEN
                                                                    CheckItemUnitConversion(Rec, xRec);
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=MÜleenhet;
                                                              SVE=Enhet] }
    { 91  ;   ;Unit Factor         ;Decimal       ;InitValue=1;
                                                   CaptionML=[ENU=Unit Factor;
                                                              NOR=Enhetsfaktor;
                                                              SVE=Enhetsfaktor];
                                                   Editable=No }
    { 95  ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   CaptionML=[ENU=Norm Group;
                                                              NOR=Normgruppe;
                                                              SVE=Normgrupp] }
    { 96  ;   ;Sub Operation Code  ;Code20        ;TableRelation="Sub Operation".Code;
                                                   CaptionML=[ENU=Sub Operation Code;
                                                              NOR=Underinnsatskode;
                                                              SVE=Underinsatskod] }
    { 100 ;   ;Norm                ;Decimal       ;OnValidate=BEGIN
                                                                //DP01676.sn
                                                                IF CurrFieldNo <> FIELDNO("Production Rate") THEN BEGIN
                                                                  IF Norm <> 0 THEN
                                                                    "Production Rate" := 1 / Norm
                                                                  ELSE
                                                                    "Production Rate" := 0;
                                                                END;
                                                                //DP01676.en
                                                                CalculateTotals;
                                                                UpdateSalesNorm;  //C031706
                                                              END;

                                                   CaptionML=[ENU=Norm;
                                                              NOR=Norm;
                                                              SVE=Norm];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 105 ;   ;Production Rate     ;Decimal       ;OnValidate=BEGIN
                                                                //DP01676
                                                                IF "Apply Obligation" THEN BEGIN
                                                                  Norm := 1;
                                                                  TESTFIELD("Production Rate");
                                                                  Quantity := Quantity * xRec."Production Rate" / "Production Rate";
                                                                  "Cumulative Quantity" := "Cumulative Quantity" * xRec."Production Rate" / "Production Rate";
                                                                END ELSE BEGIN
                                                                  IF "Production Rate" <> 0 THEN
                                                                    VALIDATE(Norm, 1 / "Production Rate")
                                                                  ELSE
                                                                    VALIDATE(Norm,1);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Production Rate;
                                                              NOR=Produksjonsrate;
                                                              SVE=Produktionstakt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01676 }
    { 110 ;   ;Net Cost Price      ;Decimal       ;OnValidate=BEGIN
                                                                CalculateDiscount(FALSE);
                                                                PlantMgt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",0,"Net Cost Price","Buy Back Price","Buy Back %");  //DP01208
                                                                UpdateSalesPriceFromCostPrice;  //C059577
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Net Cost Price;
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 115 ;   ;Purchase Discount % ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNetPrice;
                                                                UpdateSalesPriceFromCostPrice;  //C059577
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Purchase Discount %;
                                                              NOR=Innkjõpsrabattprosent;
                                                              SVE=Inkîpsrabattprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 120 ;   ;Gross Price         ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNetPrice;
                                                                UpdateSalesPriceFromCostPrice;  //C059577
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              NOR=Bruttopris;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 141 ;   ;Buy Back Price      ;Decimal       ;OnValidate=BEGIN
                                                                PlantMgt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",1,"Net Cost Price","Buy Back Price","Buy Back %");  //DP01208
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Buy Back Price;
                                                              NOR=Tilbakekjõpspris;
                                                              SVE=èterkîpspris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 144 ;   ;Buy Back %          ;Decimal       ;OnValidate=BEGIN
                                                                PlantMgt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",2,"Net Cost Price","Buy Back Price","Buy Back %");  //DP01208
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Buy Back %;
                                                              NOR=Tilbakekjõpsprosent;
                                                              SVE=èterkîpsprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 150 ;   ;Rate Code           ;Code10        ;TableRelation="Estimate Rate"."Rate Code" WHERE (Estimate No.=FIELD(Estimate No.));
                                                   OnValidate=VAR
                                                                RateRec@1210190000 : Record 11012160;
                                                                EstimateSetup@1100528500 : Record 11012150;
                                                              BEGIN
                                                                IF RateRec.GET("Estimate No.","Rate Code") THEN BEGIN
                                                                  EstimateSetup.GET;
                                                                  IF (EstimateSetup."Upd. Cost Object by Rate Code") THEN
                                                                    "Cost Object Labor" := RateRec."Cost Object";  //C053189
                                                                  "Cost Rate" := RateRec."Cost Rate";
                                                                  "Sales Rate" := RateRec."Sales Rate";
                                                                  "Rate Type" := RateRec."Rate Type";
                                                                  "Team Size" := RateRec."Team Size";
                                                                  IF ("Rate Type" <> xRec."Rate Type") THEN BEGIN
                                                                    IF "Rate Type" = "Rate Type"::Hours THEN BEGIN
                                                                      Norm := Norm / 60;
                                                                      "Norm (Sales)" := "Norm (Sales)" / 60;
                                                                    END ELSE BEGIN
                                                                      Norm := Norm * 60;
                                                                      "Norm (Sales)" := "Norm (Sales)" * 60;
                                                                    END;
                                                                  END;
                                                                  IF ("Team Size" <> xRec."Team Size") THEN BEGIN
                                                                    IF "Team Size" <> 0 THEN BEGIN
                                                                      Norm := Norm / "Team Size";
                                                                      "Norm (Sales)" := "Norm (Sales)" / "Team Size";
                                                                    END;
                                                                    IF xRec."Team Size" <> 0 THEN BEGIN
                                                                      Norm := Norm * xRec."Team Size";
                                                                      "Norm (Sales)" := "Norm (Sales)" * xRec."Team Size";
                                                                    END;
                                                                  END;
                                                                  //DP01676.sn
                                                                  IF Norm <> 0 THEN
                                                                    "Production Rate" := 1 / Norm
                                                                  ELSE
                                                                    "Production Rate" := 0;
                                                                  IF "Norm (Sales)" <> 0 THEN
                                                                    "Production Rate (Sales)" := 1 / "Norm (Sales)"
                                                                  ELSE
                                                                    "Production Rate (Sales)" := 0;
                                                                  //DP01676.en
                                                                END;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Rate Code;
                                                              NOR=Avgiftskode;
                                                              SVE=Avgiftskod] }
    { 151 ;   ;Cost Rate           ;Decimal       ;CaptionML=[ENU=Cost Rate;
                                                              SVE=Avgift];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 152 ;   ;Rate Type           ;Option        ;CaptionML=[ENU=Rate Type;
                                                              NOR=Avgiftstype;
                                                              SVE=Avgiftstyp];
                                                   OptionCaptionML=[ENU=Hours,Minuts;
                                                                    NOR=Timer,Minutter;
                                                                    SVE=Timmar,Minuter];
                                                   OptionString=Hours,Minuts;
                                                   Editable=No }
    { 153 ;   ;Team Size           ;Decimal       ;CaptionML=[ENU=Team Size;
                                                              NOR=Teamstõrrelse;
                                                              SVE=Teamstorlek];
                                                   Editable=No }
    { 160 ;   ;Text Composition    ;Code140       ;CaptionML=[ENU=Text Composition;
                                                              NOR=Tekstsammensettning;
                                                              SVE=TextsammansÑttning];
                                                   Editable=No }
    { 165 ;   ;Apply Obligation    ;Boolean       ;CaptionML=ENU=Apply Obligation;
                                                   Description=DP01676;
                                                   Editable=No }
    { 170 ;   ;Appliance Type      ;Option        ;CaptionML=ENU=Appliance Type;
                                                   OptionCaptionML=ENU=" ,Item,Trade Item,Recipe,Plant Type,Plant Set,Subcontracting Activity,Estimate Appliance,Rate Code,Estimate Recipe";
                                                   OptionString=[ ,Item,TradeItem,Recipe,PlantType,PlantSet,SubcontractingActivity,EstimateAppliance,RateCode,EstimateRecipe];
                                                   Description=DP01676;
                                                   Editable=No }
    { 175 ;   ;Appliance Code      ;Code20        ;CaptionML=ENU=Appliance Code;
                                                   Description=DP01676;
                                                   Editable=No }
    { 200 ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=BEGIN
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              NOR=Artikkelnr;
                                                              SVE=Artikelnr] }
    { 210 ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN
                                                                  ValidateItem(ItemTypeOpt::"Basic Item");
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              NOR=Fabrikantartikkel;
                                                              SVE=Basartikel] }
    { 220 ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN
                                                                  ValidateItem(ItemTypeOpt::"Trade Item");
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              NOR=Katalogartikkel;
                                                              SVE=Anskaffningsartikel] }
    { 240 ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  //db.sn, 17-12-10: M18021
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                  //db.en, 17-12-10: M18021
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              NOR=Leverandõr (katalogartikkel);
                                                              SVE=Leverantîr (skaffningsartikel)] }
    { 250 ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              NOR=Produsent;
                                                              SVE=Tillverkare] }
    { 260 ;   ;Plant Type          ;Code20        ;TableRelation="Plant Type";
                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp];
                                                   Editable=No }
    { 270 ;   ;Weight              ;Decimal       ;CaptionML=[ENU=Weight;
                                                              NOR=Vekt;
                                                              SVE=Vikt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 271 ;   ;Total Weight        ;Decimal       ;CaptionML=[ENU=Total Weight;
                                                              NOR=Totalvekt;
                                                              SVE=Viktsumma];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 280 ;   ;Ask for Quote       ;Boolean       ;OnValidate=BEGIN
                                                                IF "Ask for Quote" THEN BEGIN
                                                                  IF ("Net Cost Price" = 0) AND ("Cost Object Price" = '') THEN BEGIN
                                                                    "Ask for Quote" := FALSE;
                                                                    IF CurrFieldNo <> 0 THEN
                                                                      FIELDERROR("Ask for Quote", Text002);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Ask for Quote;
                                                              NOR=Be om tilbud;
                                                              SVE=BegÑr offert] }
    { 290 ;   ;Purchase Route Reference;Code20    ;CaptionML=[ENU=Purchase Route Reference;
                                                              NOR=Referanse for Innkjõpsrute;
                                                              SVE=Referens fîr inkîpsfîljd];
                                                   Editable=No }
    { 300 ;   ;Compress No.        ;Integer       ;CaptionML=[ENU=Compress No.;
                                                              NOR=Komprimer nr.;
                                                              SVE=Komprimera nr];
                                                   Editable=No }
    { 310 ;   ;Zero Line           ;Boolean       ;CaptionML=[ENU=Zero Line;
                                                              NOR=Nullrad;
                                                              SVE=Nollrad] }
    { 320 ;   ;Document No.        ;Code20        ;TableRelation="Document Properties";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Document No.;
                                                              NOR=Dokumentnr.;
                                                              SVE=Dokumentnr] }
    { 330 ;   ;Code                ;Code20        ;CaptionML=[ENU=Code;
                                                              NOR=Kode;
                                                              SVE=Kod];
                                                   Editable=No }
    { 340 ;   ;Price Agreement     ;Boolean       ;CaptionML=[ENU=Price Agreement;
                                                              NOR=Prisavtale;
                                                              SVE=Prisavtal] }
    { 341 ;   ;Norm Agreement      ;Boolean       ;CaptionML=[ENU=Norm Agreement;
                                                              NOR=Normavtale;
                                                              SVE=Normavtal] }
    { 350 ;   ;Vendor              ;Code20        ;TableRelation=Vendor;
                                                   CaptionML=[ENU=Vendor;
                                                              NOR=Leverandõr;
                                                              SVE=Leverantîr] }
    { 360 ;   ;Changed             ;Boolean       ;CaptionML=[ENU=Changed;
                                                              NOR=Endret;
                                                              SVE=éndrad];
                                                   Editable=No }
    { 370 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadskomponent] }
    { 380 ;   ;Time Quantity       ;Decimal       ;InitValue=1;
                                                   CaptionML=[ENU=Time Quantity;
                                                              NOR=Tidskvantitet;
                                                              SVE=Tidskvantitet];
                                                   BlankZero=Yes }
    { 390 ;   ;Unit of Time        ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Time;
                                                              NOR=Tidsenhet;
                                                              SVE=Tidsenhet] }
    { 400 ;   ;Hours               ;Decimal       ;CaptionML=[ENU=Hours;
                                                              NOR="Timer ";
                                                              SVE=Timmar];
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 410 ;   ;Labor Cost Amount   ;Decimal       ;CaptionML=[ENU=Labor Cost Amount;
                                                              SVE=Arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 420 ;   ;Material Cost Amount;Decimal       ;CaptionML=[ENU=Material Cost Amount;
                                                              SVE=Material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 421 ;   ;Gross Amount        ;Decimal       ;CaptionML=[ENU=Gross Amount;
                                                              NOR=Bruttobelõp;
                                                              SVE=Bruttobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 430 ;   ;Subcontracting Cost Amount;Decimal ;CaptionML=[ENU=Subcontracting Cost Amount;
                                                              SVE=Underentreprenad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 440 ;   ;Plant Cost Amount   ;Decimal       ;CaptionML=[ENU=Plant Cost Amount;
                                                              SVE=Maskin];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 441 ;   ;Buy Back Amount     ;Decimal       ;CaptionML=[ENU=Buy Back Amount;
                                                              NOR=Tilbakekjõpsbelõp;
                                                              SVE=èterkîpsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 445 ;   ;Sundry Cost Amount  ;Decimal       ;CaptionML=[ENU=Sundry Cost Amount;
                                                              SVE=Diverse];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 450 ;   ;Cost Amount         ;Decimal       ;CaptionML=[ENU=Cost Amount;
                                                              NOR=Kostbelõp;
                                                              SVE=Kostnadsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 460 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=ENU=Cum. Adjustment Factor Hours;
                                                   DecimalPlaces=0:6 }
    { 461 ;   ;Cum. Adj. Factor Price;Decimal     ;CaptionML=ENU=Cum. Adjustment Factor Price;
                                                   DecimalPlaces=0:6 }
    { 470 ;   ;Alternative Vendor OLD;Code15      ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=ENU=Alternative Vendor OLD }
    { 480 ;   ;Alternative Item OLD;Code20        ;CaptionML=ENU=Alternative Item OLD }
    { 490 ;   ;Alternative Price OLD;Decimal      ;CaptionML=ENU=Alternative Price OLD;
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 500 ;   ;Project No.         ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 510 ;   ;Element             ;Code20        ;TableRelation=IF (Project No.=FILTER('')) "Base Element".Code
                                                                 ELSE IF (Project No.=FILTER(<>'')) "Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                GetDisciplineByElement; //DP02460
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 520 ;   ;Line Status         ;Code10        ;TableRelation="Line Status".Status;
                                                   CaptionML=[ENU=Line Status;
                                                              NOR=Radstatus;
                                                              SVE=Radstatus] }
    { 530 ;   ;Purchase Action     ;Code10        ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action;
                                                              NOR=Innkjõpshandling, Materiale;
                                                              SVE=InkîpsÜtgÑrdsmaterial] }
    { 531 ;   ;Purchase Phase      ;Code10        ;CaptionML=[ENU=Purchase Phase;
                                                              NOR=Innkjõpsfase, Materiale;
                                                              SVE=Inkîpsfas, material];
                                                   Numeric=Yes }
    { 540 ;   ;Purchase Action Subc. OLD;Code10   ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action Subcontracting OLD;
                                                              NOR=Innkjõpshandling, underentrepenõr;
                                                              SVE=InkîpsÜtgÑrd, underentreprenad];
                                                   Description=DP01676: expired }
    { 541 ;   ;Purchase Phase Subc. OLD;Code10    ;CaptionML=[ENU=Purchase Phase Subcontracting OLD;
                                                              NOR=Innkjõpsfase, underentrepenõr;
                                                              SVE=Inkîpsfas, underentreprenad];
                                                   Numeric=Yes;
                                                   Description=DP01676: expired }
    { 550 ;   ;Purchase Action Plant OLD;Code10   ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action Plant OLD;
                                                              NOR=Innkjõpshandling for maskin;
                                                              SVE=InkîpsÜtgÑrd fîr Maskin];
                                                   Description=DP01676: expired }
    { 551 ;   ;Purchase Phase Plant OLD;Code10    ;CaptionML=[ENU=Purchase Phase Plant OLD;
                                                              NOR=Innkjõpsfase, maskin;
                                                              SVE=Inkîpsfas, Maskin];
                                                   Numeric=Yes;
                                                   Description=DP01676: expired }
    { 560 ;   ;Sub-Estimate Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Sub-Estimate.Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Estimate Part Description;
                                                              NOR=Kalkyledel Õ Beskrivelse;
                                                              SVE=Kalkyl Õ delbeskrivning];
                                                   Editable=No }
    { 570 ;   ;Part Description    ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Part".Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                         Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                         Part=FIELD(Part)));
                                                   CaptionML=[ENU=Part Description;
                                                              NOR=Delbeskrivelse;
                                                              SVE=Delbeskrivning];
                                                   Editable=No }
    { 575 ;   ;Part Description (RAW);Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Paragraph RAW".Text WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                           Tender Paragraph No.=FIELD(Part),
                                                                                                           Construction Spec. Line No.=CONST(00)));
                                                   CaptionML=ENU=Part Description (RAW);
                                                   Description=DP01619;
                                                   Editable=No }
    { 580 ;   ;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528401 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528402 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(0, ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(0, ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Project Planning Activity Code;
                                                              NOR=Prosjektplan, Aktivitetskode;
                                                              SVE=Projektplan, aktivitetskod] }
    { 585 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=éTA];
                                                   Description=DP00260 }
    { 590 ;   ;Uncoded Estimate Line;Boolean      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Line"."Uncoded Line" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                            Part Group=FIELD(Part Group),
                                                                                                            Part=FIELD(Part),
                                                                                                            Line No.=FIELD(Estimate Line)));
                                                   CaptionML=ENU=Uncoded Estimate Line;
                                                   Editable=No }
    { 595 ;   ;Uncoded Recipe Line ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Recipe Line"."Uncoded Line" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Part Group=FIELD(Part Group),
                                                                                                                   Part=FIELD(Part),
                                                                                                                   Estimate Line=FIELD(Estimate Line),
                                                                                                                   Line No.=FIELD(Recipe Line)));
                                                   CaptionML=ENU=Uncoded  Recipe Line;
                                                   Editable=No }
    { 600 ;   ;Discipline          ;Code10        ;TableRelation=Discipline;
                                                   CaptionML=[ENU=Discipline;
                                                              NOR=Disiplin;
                                                              SVE=Disciplin] }
    { 601 ;   ;Trade Speciality    ;Code10        ;TableRelation="Trade Speciality".Code WHERE (Discipline=FIELD(Discipline));
                                                   CaptionML=[ENU=Trade Speciality;
                                                              NOR=SNI-nummer;
                                                              SVE=SNI-nummer] }
    { 602 ;   ;Trade Expertise     ;Code10        ;TableRelation="Trade Expertise";
                                                   OnValidate=VAR
                                                                TradeExpRec@1100525000 : Record 11020286;
                                                              BEGIN
                                                                TradeExpRec.GetRelatedValue(Discipline, "Trade Speciality", "Trade Expertise");
                                                              END;

                                                   CaptionML=[ENU=Trade Expertise;
                                                              NOR=Bransjeekspertise;
                                                              SVE=Branschexpertis] }
    { 880 ;   ;Subcontracting Activity;Code10     ;TableRelation="Subcontracting Activity".Code;
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO("Subcontracting Activity"));  //DP01958a
                                                              END;

                                                   CaptionML=ENU=Subcontracting Activity;
                                                   Description=DP01492-2 }
    { 890 ;   ;Subcontractor       ;Code20        ;TableRelation=IF (Subcontracting Activity=FILTER(='')) Vendor.No. WHERE (Subcontractor Type=FILTER(Subcontractor|Self Employed|Employment Agency))
                                                                 ELSE IF (Subcontracting Activity=FILTER(<>'')) "Subcontracting Activity Price"."Subcontractor No." WHERE (Subcontracting Activity=FIELD(Subcontracting Activity));
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO(Subcontractor));  //DP01958a
                                                              END;

                                                   CaptionML=[ENU=Subcontractor;
                                                              NOR=Underentreprenõr;
                                                              SVE=Underentreprenîr];
                                                   Description=DP01492-2 }
    { 1250;   ;Wage Component      ;Code10        ;TableRelation="Wage Component";
                                                   CaptionML=[ENU=Wage Component;
                                                              NOR=Lõnnsart;
                                                              SVE=Lîneart];
                                                   Description=DP01676 }
    { 1260;   ;Price History 0 Exists;Boolean     ;CaptionML=ENU=Price History 0 Exists;
                                                   Editable=No }
    { 2000;   ;Cost Type (Price)   ;Option        ;CaptionML=ENU=Cost Type (Price);
                                                   OptionCaptionML=[ENU=" ,Material,Subcontracting,Plant,Sundry";
                                                                    SVE=" ,Material,Underentreprenad,Maskin,Diverse"];
                                                   OptionString=[ ,Material,Subcontracting,Plant,Sundry];
                                                   Description=DP00381 }
    { 2001;   ;Cost Type (Hours)   ;Option        ;CaptionML=ENU=Cost Type (Hours);
                                                   OptionCaptionML=ENU="Labor,,Subcontracting,Plant,, ";
                                                   OptionString=[Labor,,Subcontracting,Plant,, ];
                                                   Description=C038168 }
    { 2005;   ;Cost Object Labor   ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Labor),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                DimValRec@1210190000 : Record 349;
                                                                DimMgt@1210190001 : Codeunit 408;
                                                              BEGIN
                                                                //DP00381
                                                                IF "Cost Object Labor" <> '' THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2, "Cost Object Labor", DimValRec, TRUE, '');
                                                                  "Cost Component" := DimValRec."Cost Component";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Cost Object Labor;
                                                              NOR=Kostnadsobjekt, arbeidskraft;
                                                              SVE=Kostnadsobjekt, arbetskraft];
                                                   Description=DP00381 }
    { 2006;   ;Cost Object Price   ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=FIELD("Cost Type (Price)"),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                DimValRec@1210190000 : Record 349;
                                                                DimMgt@1210190001 : Codeunit 408;
                                                              BEGIN
                                                                //DP00381
                                                                IF "Cost Object Price" <> '' THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2, "Cost Object Price", DimValRec, TRUE, '');
                                                                  "Cost Component" := DimValRec."Cost Component";
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Cost Object Price;
                                                   Description=DP00381 }
    { 2010;   ;Net Sales Price     ;Decimal       ;OnValidate=BEGIN
                                                                //DP00381
                                                                CalculateDiscount(TRUE);
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Net Sales Price;
                                                   BlankZero=Yes;
                                                   Description=DP00381;
                                                   AutoFormatType=2 }
    { 2015;   ;Sales Discount %    ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Sales Discount %") THEN BEGIN
                                                                  TESTFIELD("Gross Price");  //db, 11-11-13: DP00260 (C005807)
                                                                END;

                                                                //DP00381.sn
                                                                CalculateNetPrice;
                                                                CalculateTotals;
                                                                //DP00381.en
                                                              END;

                                                   CaptionML=[ENU=Sales Discount %;
                                                              NOR=Salgsrabattprosent;
                                                              SVE=FîrsÑljningsrabattprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 2020;   ;Norm Group (Sales)  ;Code10        ;TableRelation="Norm Group".Code;
                                                   CaptionML=[ENU=Norm Group (Sales);
                                                              SVE=Kopiera till];
                                                   Description=DP00381 }
    { 2030;   ;Norm (Sales)        ;Decimal       ;OnValidate=BEGIN
                                                                //DP00381
                                                                IF CurrFieldNo <> FIELDNO("Production Rate (Sales)") THEN
                                                                  IF "Norm (Sales)" <> 0 THEN
                                                                    "Production Rate (Sales)" := 1 / "Norm (Sales)"
                                                                  ELSE
                                                                    "Production Rate (Sales)" := 0;

                                                                CalculateTotals;  //db, 24-09-12: norm and production rate used to calculate hours
                                                              END;

                                                   CaptionML=ENU=Norm (Sales);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 2035;   ;Production Rate (Sales);Decimal    ;OnValidate=BEGIN
                                                                //DP00381
                                                                IF "Production Rate (Sales)" <> 0 THEN
                                                                  VALIDATE("Norm (Sales)", 1 / "Production Rate (Sales)")
                                                                ELSE
                                                                  VALIDATE("Norm (Sales)",1);
                                                              END;

                                                   CaptionML=ENU=Production Rate (Sales);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 2040;   ;Sales Rate          ;Decimal       ;CaptionML=[ENU=Sales Rate;
                                                              NOR=Salgsrate;
                                                              SVE=FîrsÑljningsavgift];
                                                   BlankZero=Yes;
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 2050;   ;Quantity (Sales)    ;Decimal       ;OnValidate=BEGIN
                                                                //DP00381
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Quantity (Sales);
                                                              NOR=Antall (salg);
                                                              SVE=Antal (fîrsÑljning)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 2055;   ;Cumulative Quantity (Sales);Decimal;CaptionML=ENU=Cumulative Quantity (Sales);
                                                   DecimalPlaces=0:5;
                                                   Description=DP00381 }
    { 2060;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Labor;
                                                              NOR=Tilleggsgebyrsprosent, arbeidskraft;
                                                              SVE=TillÑggsavgiftsprocent, arbetskraft];
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 2065;   ;Surcharge % Price   ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Surcharge % Price;
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 2070;   ;Price Agreement (Sales);Boolean    ;CaptionML=ENU=Price Agreement (Sales);
                                                   Description=C037311 }
    { 2075;   ;Norm Agreement (Sales);Boolean     ;CaptionML=ENU=Norm Agreement (Sales);
                                                   Description=C037311 }
    { 2100;   ;Labor Sales Amount  ;Decimal       ;CaptionML=[ENU=Labor Sales Amount;
                                                              NOR=Belõp salg arbied;
                                                              SVE=Arbetskraft fîrsÑljningsbelopp];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2105;   ;Hours (Sales)       ;Decimal       ;CaptionML=[ENU=Hours (Sales);
                                                              SVE=Timmar];
                                                   DecimalPlaces=2:;
                                                   Description=DP00381;
                                                   Editable=No }
    { 2110;   ;Material Sales Amount;Decimal      ;CaptionML=[ENU=Material Sales Amount;
                                                              NOR=Belõp salg materialer;
                                                              SVE=FîrsÑljningsbelopp material];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2120;   ;Subcontracting Sales Amount;Decimal;CaptionML=[ENU=Subcontracting Sales Amount;
                                                              NOR=Belõp salg underentreprenõr;
                                                              SVE=Underentreprenad, fîrsÑljningsbelopp];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2130;   ;Plant Sales Amount  ;Decimal       ;CaptionML=[ENU=Plant Sales Amount;
                                                              NOR=Belõp maskinsalg;
                                                              SVE=MaskinfîrsÑljningsbelopp];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2140;   ;Sundry Sales Amount ;Decimal       ;CaptionML=[ENU=Sundry Sales Amount;
                                                              SVE=FîrsÑljningsbelopp, diverse];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2150;   ;Sales Amount        ;Decimal       ;CaptionML=[ENU=Sales Amount;
                                                              NOR=Salgsbelõp;
                                                              SVE=FîrsÑljningsbelopp];
                                                   Description=DP00381;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2160;   ;Cum. Adj. Factor Hours (Sales);Decimal;
                                                   CaptionML=ENU=Cum. Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6;
                                                   Description=DP00555 }
    { 2170;   ;Original Vendor (Trade Item);Code15;CaptionML=ENU=Original Vendor (Trade Item);
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part,Estimate Line,Recipe Line;
                                                   Clustered=Yes }
    {    ;Estimate No.,Line No.,Compressed         }
    {    ;Estimate No.,Text Composition,Ask for Quote,Price Agreement,Norm Agreement,Zero Line,Norm,Norm (Sales),Net Cost Price,Net Sales Price }
    {    ;Estimate No.,Compress No.                }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      CompRec@1210190002 : Record 11020458;
      EstLineRec@1210190001 : Record 11072072;
      RcpLineRec@1210190000 : Record 11072075;
      EstRec@1210190003 : Record 11012151;
      ItemRec@1210190013 : Record 27;
      BasicItemRec@1210190012 : Record 11012316;
      TradeItemRec@1210190011 : Record 11012317;
      ItemUnitRec@1210190014 : Record 5404;
      ElemRec@1100485005 : Record 11012060;
      ProjElemRec@1100485004 : Record 11012010;
      FormatMgt@1100485006 : Codeunit 11012022;
      PlantMgt@1100528900 : Codeunit 11012232;
      Status@1210190008 : Dialog;
      maxrec@1210190007 : Integer;
      currec@1210190006 : Integer;
      Text000@1210190009 : TextConst 'ENU=Busy with      #1#################\;NOR=Opptatt med #1#################\;SVE=Upptagen med   #1#################\';
      Text001@1210190005 : TextConst 'ENU=Estimatepart  #2################# @3@@@@@@@@@@@@@;NOR=Kalkyledel  #2################# @3@@@@@@@@@@@@@;SVE=Kalkyldel  #2################# @3@@@@@@@@@@@@@';
      ItemTypeOpt@1210190010 : 'Item,Basic Item,Trade Item,Trade Vendor';
      Text002@1100485008 : TextConst 'ENU=only allowed for material, subcontracting or plant;NOR=kun tillatt for materiale, underentrepenõr eller maskin;SVE=endast tillÜtet fîr material, underentreprenad eller Maskin';

    PROCEDURE SelectLines@1100485001(VAR EstLineRec@1100485000 : Record 11072072;SkipZeroLines@1100529400 : ' ,Cost,Sales,Both');
    VAR
      ICurrEst@1100485001 : Code[20];
    BEGIN
      ICurrEst := EstLineRec.GETFILTER("Estimate No.");
      IF NOT EstRec.GET(ICurrEst) THEN
        EXIT;

      CompRec.RESET;
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      CompRec.DELETEALL;

      Status.OPEN(Text000 + Text001);

      EstLineRec.SETRANGE("Surcharge Type", EstLineRec."Surcharge Type"::" ");
      //DP01931.sn
      IF SkipZeroLines <> SkipZeroLines::" " THEN BEGIN
        IF (SkipZeroLines = SkipZeroLines::Cost) OR (SkipZeroLines = SkipZeroLines::Both) THEN
          EstLineRec.SETFILTER(Quantity, '<>%1', 0);
        IF (SkipZeroLines = SkipZeroLines::Sales) OR (SkipZeroLines = SkipZeroLines::Both) THEN
          EstLineRec.SETFILTER("Quantity (Sales)", '<>%1', 0);
        EstLineRec.SETFILTER("Part Quantity", '<>%1', 0);
      END;
      //DP01931.en
      IF EstLineRec.FINDSET THEN BEGIN
        currec := 0;
        maxrec := EstLineRec.COUNT;
        Status.UPDATE(1,EstLineRec.TABLECAPTION);
        REPEAT
          currec := currec + 1;
          Status.UPDATE(2,EstLineRec.Part);
          Status.UPDATE(3,ROUND(currec / maxrec * 10000,1));
          IF EstLineRec.Recipe = '' THEN BEGIN
            CompRec.INIT;
            CompRec."Estimate No." := EstLineRec."Estimate No.";
            CompRec."Sub-Estimate No." := EstLineRec."Sub-Estimate No.";
            CompRec."Part Group" := EstLineRec."Part Group";
            CompRec.Part := EstLineRec.Part;
            CompRec."Estimate Line" := EstLineRec."Line No.";
            CompRec."Recipe Line" := 0;  //db, 18-08-08: M12430
            CompRec."Recipe Group" := EstLineRec."Recipe Group";
            CompRec.Recipe := EstLineRec.Recipe;
            CompRec.Description := EstLineRec.Description;
            CompRec."Cost Type (Price)" := EstLineRec."Cost Type (Price)";
            CompRec."Cost Type (Hours)" := EstLineRec."Cost Type (Hours)";  //C038168
            CompRec."Cost Object Labor" := EstLineRec."Cost Object Labor";
            CompRec."Cost Object Price" := EstLineRec."Cost Object Price";
            CompRec."Cost Component" := EstLineRec."Cost Component";
            CompRec."Time Quantity" := EstLineRec."Time Quantity";
            CompRec."Unit of Time" := EstLineRec."Unit of Time";
            CompRec.Quantity := EstLineRec.Quantity;
            CompRec."Quantity (Sales)" := EstLineRec."Quantity (Sales)";  //DP00381
            CompRec."Part Quantity" := EstLineRec."Part Quantity";
            CompRec."Cumulative Quantity" := CompRec.Quantity * CompRec."Part Quantity";
            CompRec."Cumulative Quantity (Sales)" := CompRec."Quantity (Sales)" * CompRec."Part Quantity";  //DP00381
            CompRec."Unit of Measure" := EstLineRec."Unit of Measure";
            CompRec."Norm Group" := EstLineRec."Norm Group";
            CompRec."Norm Group (Sales)" := EstLineRec."Norm Group (Sales)";  //DP00381
            CompRec."Sub Operation Code" := EstLineRec."Sub Operation Code";
            CompRec.Norm := EstLineRec.Norm;
            CompRec."Norm (Sales)" := EstLineRec."Norm (Sales)";  //DP00381
            //DP01676.sn
            CompRec."Production Rate" := EstLineRec."Production Rate";
            CompRec."Production Rate (Sales)" := EstLineRec."Production Rate (Sales)";
            //DP01676.en
            CompRec."Cost Rate" := EstLineRec."Cost Rate";
            CompRec."Sales Rate" := EstLineRec."Sales Rate";  //DP00381
            CompRec."Rate Code" := EstLineRec."Rate Code";
            CompRec."Rate Type" := EstLineRec."Rate Type";
            CompRec."Team Size" := EstLineRec."Team Size";
            CompRec."Surcharge % Labor" := EstLineRec."Surcharge % Labor";  //DP00381
            CompRec."Surcharge % Price" := EstLineRec."Surcharge % Price";  //DP00381
            CompRec."Net Cost Price" := EstLineRec."Net Cost Price";
            CompRec."Net Sales Price" := EstLineRec."Net Sales Price";  //DP00381
            CompRec."Purchase Discount %" := EstLineRec."Purchase Discount %";
            CompRec."Sales Discount %" := EstLineRec."Sales Discount %";
            CompRec."Gross Price" := EstLineRec."Gross Price";
            CompRec."Buy Back Price" := EstLineRec."Buy Back Price";
            CompRec."Buy Back %" := EstLineRec."Buy Back %";
            CompRec.Weight := EstLineRec.Weight;
            CompRec."Item No." := EstLineRec."Item No.";
            CompRec."Basic Item" := EstLineRec."Basic Item";
            CompRec."Trade Item" := EstLineRec."Trade Item";
            CompRec."Vendor (Trade Item)" := EstLineRec."Vendor (Trade Item)";
            CompRec.Manufacturer := EstLineRec.Manufacturer;
            CompRec."Plant Type" := EstLineRec."Plant Type";
            CompRec."Text Composition" := ComposeText(CompRec);
            CompRec."Ask for Quote" := EstLineRec."Ask for Quote";
            CompRec."Purchase Route Reference" := EstLineRec."Purchase Route Reference";
            CompRec."Zero Line" := (CompRec."Cumulative Quantity" = 0);
            CompRec."Document No." := EstLineRec."Document No.";
            CompRec.Code := EstLineRec.Code;
            CompRec."Project No." := EstLineRec."Project No.";
            CompRec.Element := EstLineRec.Element;
            CompRec."Extension Contract" := EstLineRec."Extension Contract";  //DP00260
            CompRec."Project Planning Activity Code" := EstLineRec."Project Planning Activity Code";
            CompRec."Wage Component" := EstLineRec."Wage Component";  //DP01676
            CompRec."Price Agreement" := EstLineRec."Price Agreement";
            CompRec."Norm Agreement" := EstLineRec."Norm Agreement";
            CompRec."Price Agreement (Sales)" := EstLineRec."Price Agreement (Sales)";  //C037311
            CompRec."Norm Agreement (Sales)" := EstLineRec."Norm Agreement (Sales)";  //C037311
            CompRec.Vendor := EstLineRec.Vendor;
            CompRec.Subcontractor := EstLineRec.Subcontractor;  //DP01958a
            CompRec."Subcontracting Activity" := EstLineRec."Subcontracting Activity";  //DP01958a
            CompRec."Unit Factor" := CheckUnitFactor;
            CompRec."Cum. Adj. Factor Hours" := EstLineRec."Cum. Adj. Factor Hours";
            CompRec."Cum. Adj. Factor Price" := EstLineRec."Cum. Adj. Factor Price";
            CompRec."Cum. Adj. Factor Hours (Sales)" := EstLineRec."Cum. Adj. Factor Hours (Sales)";  //DP00555
            CompRec."Line Status" := EstLineRec."Line Status";
            CompRec."Purchase Action" := EstLineRec."Purchase Action";
            CompRec."Purchase Phase" := EstLineRec."Purchase Phase";
            //db.sn, 01-11-13: DP00260 (17764)
            CompRec.Discipline := EstLineRec.Discipline;
            CompRec."Trade Speciality" := EstLineRec."Trade Speciality";
            CompRec."Trade Expertise" := EstLineRec."Trade Expertise";
            //db.en, 01-11-13: DP00260 (17764)
            CompRec."Price History 0 Exists" := EstLineRec."Price History 0 Exists";
            CompRec.CalculateTotals;
            CompRec.INSERT;
          END ELSE BEGIN
            RcpLineRec.SETRANGE("Estimate No.", EstLineRec."Estimate No.");
            RcpLineRec.SETRANGE("Sub-Estimate No.", EstLineRec."Sub-Estimate No.");
            RcpLineRec.SETRANGE("Part Group", EstLineRec."Part Group");
            RcpLineRec.SETRANGE(Part, EstLineRec.Part);
            RcpLineRec.SETRANGE("Estimate Line", EstLineRec."Line No.");
            //RcpLineRec.SETFILTER("Recipe (Child)", '%1', '');
            RcpLineRec.SETRANGE("Recipe Header", FALSE);  //db, 26-09-14
            RcpLineRec.SETRANGE("Surcharge Type", RcpLineRec."Surcharge Type"::" ");
            //DP01931.sn
            IF SkipZeroLines <> SkipZeroLines::" " THEN BEGIN
              IF (SkipZeroLines = SkipZeroLines::Cost) OR (SkipZeroLines = SkipZeroLines::Both) THEN
                RcpLineRec.SETFILTER(Quantity, '<>%1', 0);
              IF (SkipZeroLines = SkipZeroLines::Sales) OR (SkipZeroLines = SkipZeroLines::Both) THEN
                RcpLineRec.SETFILTER("Quantity (Sales)", '<>%1', 0);
            END;
            //DP01931.en
            IF RcpLineRec.FINDSET THEN BEGIN
              REPEAT
                CompRec.INIT;
                CompRec."Estimate No." := RcpLineRec."Estimate No.";
                CompRec."Sub-Estimate No." := RcpLineRec."Sub-Estimate No.";
                CompRec."Part Group" := RcpLineRec."Part Group";
                CompRec.Part := RcpLineRec.Part;
                CompRec."Estimate Line" := RcpLineRec."Estimate Line";
                CompRec."Recipe Line" := RcpLineRec."Line No.";
                CompRec."Recipe Group" := RcpLineRec."Recipe Group";
                CompRec.Recipe := RcpLineRec.Recipe;
                CompRec.Description := RcpLineRec.Description;
                CompRec."Cost Type (Price)" := RcpLineRec."Cost Type (Price)";
                CompRec."Cost Type (Hours)" := RcpLineRec."Cost Type (Hours)";  //C038168
                CompRec."Cost Object Labor" := RcpLineRec."Cost Object Labor";
                CompRec."Cost Object Price" := RcpLineRec."Cost Object Price";
                CompRec."Cost Component" := RcpLineRec."Cost Component";
                CompRec."Time Quantity" := RcpLineRec."Time Quantity";
                CompRec."Unit of Time" := RcpLineRec."Unit of Time";
                CompRec.Quantity := RcpLineRec.Quantity;
                CompRec."Quantity (Sales)" := RcpLineRec."Quantity (Sales)";  //DP00381
                //mg.sc, 05-04-11: M26499
                IF RcpLineRec."Ignore Recipe Quantity" THEN
                  CompRec."Part Quantity" := EstLineRec."Part Quantity"
                ELSE
                  CompRec."Part Quantity" := EstLineRec.Quantity * EstLineRec."Part Quantity";
                //mg.ec, 05-04-11: M26499
                CompRec."Cumulative Quantity" := CompRec.Quantity * CompRec."Part Quantity";
                CompRec."Cumulative Quantity (Sales)" := CompRec."Quantity (Sales)" * CompRec."Part Quantity";  //DP00381
                CompRec."Unit of Measure" := RcpLineRec."Unit of Measure";
                CompRec."Norm Group" := RcpLineRec."Norm Group";
                CompRec."Norm Group (Sales)" := RcpLineRec."Norm Group (Sales)";  //DP00381
                CompRec."Sub Operation Code" := RcpLineRec."Sub Operation Code";
                CompRec.Norm := RcpLineRec.Norm;
                CompRec."Norm (Sales)" := RcpLineRec."Norm (Sales)";  //DP00381
                //DP01676.sn
                CompRec."Production Rate" := RcpLineRec."Production Rate";
                CompRec."Production Rate (Sales)" := RcpLineRec."Production Rate (Sales)";
                //DP01676.en
                CompRec."Cost Rate" := RcpLineRec."Cost Rate";
                CompRec."Sales Rate" := RcpLineRec."Sales Rate";  //DP00381
                CompRec."Rate Code" := RcpLineRec."Rate Code";
                CompRec."Rate Type" := RcpLineRec."Rate Type";
                CompRec."Team Size" := RcpLineRec."Team Size";
                CompRec."Surcharge % Labor" := RcpLineRec."Surcharge % Labor";  //DP00381
                CompRec."Surcharge % Price" := RcpLineRec."Surcharge % Price";  //DP00381
                CompRec."Net Cost Price" := RcpLineRec."Net Cost Price";
                CompRec."Net Sales Price" := RcpLineRec."Net Sales Price";  //DP00381
                CompRec."Purchase Discount %" := RcpLineRec."Purchase Discount %";
                CompRec."Sales Discount %" := RcpLineRec."Sales Discount %";
                CompRec."Gross Price" := RcpLineRec."Gross Price";
                CompRec."Buy Back Price" := RcpLineRec."Buy Back Price";
                CompRec."Buy Back %" := RcpLineRec."Buy Back %";
                CompRec.Weight := RcpLineRec.Weight;
                CompRec."Item No." := RcpLineRec."Item No.";
                CompRec."Basic Item" := RcpLineRec."Basic Item";
                CompRec."Trade Item" := RcpLineRec."Trade Item";
                CompRec."Vendor (Trade Item)" := RcpLineRec."Vendor (Trade Item)";
                CompRec.Manufacturer := RcpLineRec.Manufacturer;
                CompRec."Plant Type" := RcpLineRec."Plant Type";
                CompRec."Text Composition" := ComposeText(CompRec);
                CompRec."Ask for Quote" := RcpLineRec."Ask for Quote";
                CompRec."Purchase Route Reference" := RcpLineRec."Purchase Route Reference";
                CompRec."Zero Line" := (CompRec."Cumulative Quantity" = 0);
                CompRec."Document No." := RcpLineRec."Document No.";
                CompRec.Code := RcpLineRec.Code;
                CompRec."Project No." := RcpLineRec."Project No.";
                CompRec.Element := RcpLineRec.Element;
                CompRec."Extension Contract" := RcpLineRec."Extension Contract";  //DP00260
                CompRec."Project Planning Activity Code" := RcpLineRec."Project Planning Activity Code";
                CompRec."Wage Component" := RcpLineRec."Wage Component";  //DP01676
                CompRec."Price Agreement" := RcpLineRec."Price Agreement";
                CompRec."Norm Agreement" := RcpLineRec."Norm Agreement";
                CompRec."Price Agreement (Sales)" := RcpLineRec."Price Agreement (Sales)";  //C037311
                CompRec."Norm Agreement (Sales)" := RcpLineRec."Norm Agreement (Sales)";  //C037311
                CompRec.Vendor := RcpLineRec.Vendor;
                CompRec.Subcontractor := RcpLineRec.Subcontractor;  //DP01958a
                CompRec."Subcontracting Activity" := RcpLineRec."Subcontracting Activity";  //DP01958a
                CompRec."Unit Factor" := CheckUnitFactor;
                CompRec."Cum. Adj. Factor Hours" := RcpLineRec."Cum. Adj. Factor Hours";
                CompRec."Cum. Adj. Factor Price" := RcpLineRec."Cum. Adj. Factor Price";
                CompRec."Cum. Adj. Factor Hours (Sales)" := RcpLineRec."Cum. Adj. Factor Hours (Sales)";  //DP00555
                CompRec."Line Status" := RcpLineRec."Line Status";
                CompRec."Purchase Action" := RcpLineRec."Purchase Action";
                CompRec."Purchase Phase" := RcpLineRec."Purchase Phase";
                //db.sn, 01-11-13: DP00260 (17764)
                CompRec.Discipline := RcpLineRec.Discipline;
                CompRec."Trade Speciality" := RcpLineRec."Trade Speciality";
                CompRec."Trade Expertise" := RcpLineRec."Trade Expertise";
                //db.en, 01-11-13: DP00260 (17764)
                CompRec."Price History 0 Exists" := RcpLineRec."Price History 0 Exists";
                CompRec.CalculateTotals;
                CompRec.INSERT;
              UNTIL RcpLineRec.NEXT = 0;
            END;
          END;
        UNTIL EstLineRec.NEXT = 0;
      END;

      Compress(ICurrEst);
      Status.CLOSE;
      COMMIT;

      CompRec.RESET;
      CompRec.SETCURRENTKEY("Estimate No.", "Line No.", Compressed);
      CompRec.FILTERGROUP(2);  //db, 29-09-08: M12466
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      CompRec.FILTERGROUP(0);  //db, 29-09-08: M12466
      CompRec.SETRANGE(Compressed, TRUE);
      PAGE.RUNMODAL(0, CompRec);

      CompRec.RESET;
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      CompRec.DELETEALL;
      COMMIT;
    END;

    PROCEDURE SelectLinesRaw@1100525000(VAR EstLineRec@1100485000 : Record 11125698);
    VAR
      ICurrEst@1100485001 : Code[20];
    BEGIN
      //db, 20-01-10
      ICurrEst := EstLineRec.GETFILTER("Estimate No.");
      IF NOT EstRec.GET(ICurrEst) THEN
        EXIT;

      CompRec.RESET;
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      CompRec.DELETEALL;

      Status.OPEN(Text000 + Text001);

      IF EstLineRec.FINDSET THEN BEGIN
        currec := 0;
        maxrec := EstLineRec.COUNT;
        Status.UPDATE(1,EstLineRec.TABLECAPTION);
        REPEAT
          currec := currec + 1;
          Status.UPDATE(2,EstLineRec."Tender Paragraph No.");
          Status.UPDATE(3,ROUND(currec / maxrec * 10000,1));
          CompRec.INIT;
          CompRec."Estimate No." := EstLineRec."Estimate No.";
          CompRec."Sub-Estimate No." := '';
          CompRec."Part Group" := '';
          CompRec.Part := EstLineRec."Tender Paragraph No.";  //temporary tender entry as part
          CompRec."Estimate Line" := EstLineRec."Line No.";
          CompRec."Recipe Line" := 0;
          CompRec."Recipe Group" := '';
          CompRec.Recipe := '';
          CompRec.Description := EstLineRec.Description;
          //DP01676.sn
          IF EstLineRec."Cost Type" = EstLineRec."Cost Type"::Labor THEN BEGIN
            CompRec."Cost Type (Hours)" := CompRec."Cost Type (Hours)"::Labor;
            CompRec."Cost Type (Price)" := CompRec."Cost Type (Price)"::" ";
            CompRec."Cost Object Labor" := EstLineRec."Cost Object";
          END;
          IF EstLineRec."Cost Type" = EstLineRec."Cost Type"::Material THEN BEGIN
            CompRec."Cost Type (Price)" := CompRec."Cost Type (Price)"::Material;
            CompRec."Cost Object Price" := EstLineRec."Cost Object";
          END;
          IF EstLineRec."Cost Type" = EstLineRec."Cost Type"::Subcontracting THEN BEGIN
            CompRec."Cost Type (Hours)" := CompRec."Cost Type (Hours)"::Subcontracting;
            CompRec."Cost Type (Price)" := CompRec."Cost Type (Price)"::Subcontracting;
            CompRec."Cost Object Price" := EstLineRec."Cost Object";
          END;
          IF EstLineRec."Cost Type" = EstLineRec."Cost Type"::Plant THEN BEGIN
            IF EstLineRec."Plant Rates in Hours" THEN
              CompRec."Cost Type (Hours)" := CompRec."Cost Type (Hours)"::Plant;
            CompRec."Cost Type (Price)" := CompRec."Cost Type (Price)"::Plant;
            CompRec."Cost Object Price" := EstLineRec."Cost Object";
          END;
          IF EstLineRec."Cost Type" = EstLineRec."Cost Type"::Sundry THEN BEGIN
            CompRec."Cost Type (Price)" := CompRec."Cost Type (Price)"::Sundry;
            CompRec."Cost Object Price" := EstLineRec."Cost Object";
          END;
          //DP01676.en
          CompRec."Cost Component" := EstLineRec."Cost Component";
          CompRec."Time Quantity" := EstLineRec."Time Quantity";
          CompRec."Unit of Time" := EstLineRec."Unit of Time";
          CompRec.Quantity := EstLineRec.Quantity;
          //CompRec."Quantity (Sales)" := EstLineRec."Quantity (Sales)";
          CompRec."Part Quantity" := EstLineRec."Part Quantity";
          //CompRec."Cumulative Quantity" := CompRec.Quantity * CompRec."Part Quantity";
          CompRec."Cumulative Quantity" := EstLineRec."Cumulative Quantity";  //db, 02-03-15: C016484 (PartQuantity not adjusted for RAW)
          //CompRec."Cumulative Quantity (Sales)" := CompRec."Quantity (Sales)" * CompRec."Part Quantity";  //DP00381
          CompRec."Unit of Measure" := EstLineRec."Unit of Measure";
          CompRec."Norm Group" := EstLineRec."Norm Group";
          //CompRec."Norm Group (Sales)" := EstLineRec."Norm Group (Sales)";
          CompRec."Sub Operation Code" := EstLineRec."Sub Operation Code";
          CompRec.Norm := EstLineRec.Norm;
          //CompRec."Norm (Sales)" := EstLineRec."Norm (Sales)";
          //DP01676.sn
          CompRec."Production Rate" := EstLineRec."Production Rate";
          //CompRec."Production Rate (Sales)" := EstLineRec."Production Rate (Sales)";
          //DP01676.en
          CompRec."Cost Rate" := EstLineRec.Rate;
          //CompRec."Sales Rate" := EstLineRec."Sales Rate";
          CompRec."Rate Code" := EstLineRec."Rate Code";
          CompRec."Rate Type" := EstLineRec."Rate Type";
          CompRec."Team Size" := EstLineRec."Team Size";
          //CompRec."Surcharge % Labor" := EstLineRec."Surcharge % Labor";  //DP00381
          //CompRec."Surcharge % Price" := EstLineRec."Surcharge % Price";  //DP00381
          CompRec."Net Cost Price" := EstLineRec."Net Cost Price";  //DP01676
          //CompRec."Net Sales Price" := EstLineRec."Material Price";
          CompRec."Purchase Discount %" := EstLineRec."Purchase Discount %";
          CompRec."Sales Discount %" := EstLineRec."Sales Discount %";
          CompRec."Gross Price" := EstLineRec."Gross Price";
          CompRec."Buy Back Price" := EstLineRec."Buy Back Price";
          CompRec."Buy Back %" := EstLineRec."Buy Back %";
          CompRec.Weight := EstLineRec.Weight;
          CompRec."Item No." := EstLineRec."Item No.";
          CompRec."Basic Item" := EstLineRec."Basic Item";
          CompRec."Trade Item" := EstLineRec."Trade Item";
          CompRec."Vendor (Trade Item)" := EstLineRec."Vendor (Trade Item)";
          CompRec.Manufacturer := EstLineRec.Manufacturer;
          CompRec."Plant Type" := EstLineRec."Plant Type";
          CompRec."Text Composition" := ComposeText(CompRec);
          CompRec."Ask for Quote" := EstLineRec."Ask for Quote";
          CompRec."Purchase Route Reference" := EstLineRec."Purchase Route Reference";
          CompRec."Zero Line" := (CompRec."Cumulative Quantity" = 0);
          CompRec."Document No." := EstLineRec."Document No.";
          CompRec.Code := EstLineRec.Code;  //DP01676
          CompRec."Project No." := EstLineRec."Project No.";
          CompRec.Element := EstLineRec.Element;
          //CompRec."Extension Contract" := EstLineRec."Extension Contract";  //DP00260
          CompRec."Project Planning Activity Code" := EstLineRec."Project Planning Activity Code";
          CompRec."Wage Component" := EstLineRec."Wage Component";  //DP01676
          CompRec."Price Agreement" := EstLineRec."Price Agreement";
          CompRec."Norm Agreement" := EstLineRec."Norm Agreement";
          //CompRec."Price Agreement (Sales)" := EstLineRec."Price Agreement (Sales)";  //C037311
          //CompRec."Norm Agreement (Sales)" := EstLineRec."Norm Agreement (Sales)";  //C037311
          CompRec.Vendor := EstLineRec.Vendor;
          CompRec.Subcontractor := EstLineRec.Subcontractor;  //DP01958a
          CompRec."Subcontracting Activity" := EstLineRec."Subcontracting Activity";  //DP01958a
          CompRec."Unit Factor" := CheckUnitFactor;
          CompRec."Cum. Adj. Factor Hours" := EstLineRec."Cum. Adj. Factor";
          //DP01676.sn
          IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Material THEN
            CompRec."Cum. Adj. Factor Price" := EstLineRec."Cum. Adj. Factor";
          IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Subcontracting THEN
            CompRec."Cum. Adj. Factor Price" := EstLineRec."Cum. Adj. Factor";
          IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Plant THEN
            IF NOT EstLineRec."Plant Rates in Hours" THEN
              CompRec."Cum. Adj. Factor Price" := EstLineRec."Cum. Adj. Factor";
          //DP01676.en
          CompRec."Cum. Adj. Factor Hours (Sales)" := CompRec."Cum. Adj. Factor Hours";  //DP00555
          CompRec."Line Status" := EstLineRec."Line Status";
          CompRec."Purchase Action" := EstLineRec."Purchase Action";
          CompRec."Purchase Phase" := EstLineRec."Purchase Phase";
          //db.sn, 01-11-13: DP00260 (17764)
          CompRec.Discipline := EstLineRec.Discipline;
          CompRec."Trade Speciality" := EstLineRec."Trade Speciality";
          CompRec."Trade Expertise" := EstLineRec."Trade Expertise";
          //db.en, 01-11-13: DP00260 (17764)
          CompRec."Apply Obligation" := EstLineRec."Apply Obligation";  //DP01676
          CompRec."Appliance Type" := EstLineRec."Appliance Type";  //DP01676
          CompRec."Appliance Code" := EstLineRec."Appliance Code";  //DP01676
          CompRec.CalculateTotals;
          CompRec.INSERT;
        UNTIL EstLineRec.NEXT = 0;
      END;

      Compress(ICurrEst);
      Status.CLOSE;
      COMMIT;

      CompRec.RESET;
      CompRec.SETCURRENTKEY("Estimate No.", "Line No.", Compressed);
      CompRec.FILTERGROUP(2);
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      CompRec.FILTERGROUP(0);
      CompRec.SETRANGE(Compressed, TRUE);
      PAGE.RUNMODAL(0, CompRec);

      CompRec.RESET;
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      CompRec.DELETEALL;
      COMMIT;
    END;

    PROCEDURE Compress@1210190005(ICurrEst@1210190000 : Code[20]);
    VAR
      LastLino@1210190006 : Integer;
      LastText@1210190004 : Text[250];
      LastAskQ@1210190007 : Boolean;
      LastAgrP@1210190009 : Boolean;
      LastAgrN@1100485005 : Boolean;
      LastComp@1210190008 : Integer;
      LastFact1@1100485000 : Decimal;
      LastFact2@1100485001 : Decimal;
      LastFact3@1100485002 : Decimal;
      LastFact4@1100485003 : Decimal;
      LastFact5@1100485004 : Decimal;
      LastFact6@1100525002 : Decimal;
      LastProj@1100525000 : Code[20];
      LastElem@1100525001 : Code[20];
      LastExtContr@1100525004 : Code[20];
      LastStatus@1100525003 : Code[20];
      LastProjPlanActCode@1100528400 : Code[20];
      LastWageComponent@1100528900 : Code[20];
    BEGIN
      LastLino := 0;
      LastComp := 0;
      LastText := '~';
      LastAskQ := FALSE;
      LastAgrP := FALSE;
      LastAgrN := FALSE;

      CompRec.RESET;
      CompRec.SETCURRENTKEY("Estimate No.", "Text Composition", "Ask for Quote", "Price Agreement", "Norm Agreement", "Zero Line");
      //db, 07-10-16: C033135 (limited index (nav2009) extended with Norm, Price)
      CompRec.SETRANGE("Estimate No.", ICurrEst);
      IF CompRec.FINDSET(TRUE, FALSE) THEN BEGIN
        currec := 0;
        maxrec := CompRec.COUNT;
        Status.UPDATE(1,CompRec.TABLECAPTION);
        REPEAT
          currec := currec + 1;
          IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::" " THEN
            Status.UPDATE(2,CompRec."Cost Object Labor")
          ELSE
            Status.UPDATE(2,CompRec."Cost Object Price");
          Status.UPDATE(3,ROUND(currec / maxrec * 10000,1));
          CompRec."Line No." := LastLino + 1;
          LastLino := CompRec."Line No.";
          IF (LastText <> CompRec."Text Composition") OR
             (LastAskQ <> CompRec."Ask for Quote") OR
             (LastAgrP <> CompRec."Price Agreement") OR
             (LastAgrN <> CompRec."Norm Agreement")
          THEN BEGIN
            CompRec.Compressed := TRUE;
            LastText := CompRec."Text Composition";
            LastAskQ := CompRec."Ask for Quote";
            LastAgrP := CompRec."Price Agreement";
            LastAgrN := CompRec."Norm Agreement";
            LastFact1 := CompRec.Norm;
            LastFact2 := CompRec."Gross Price";
            LastFact3 := CompRec."Net Cost Price";
            LastFact4 := CompRec."Net Sales Price";  //DP00381
            LastFact5 := CompRec."Norm (Sales)";  //DP00381
            LastFact6 := CompRec."Buy Back Price";
            LastProj := CompRec."Project No.";
            LastElem := CompRec.Element;
            LastExtContr := CompRec."Extension Contract";  //DP00260
            LastProjPlanActCode := CompRec."Project Planning Activity Code";
            LastWageComponent := CompRec."Wage Component";  //DP01676
            LastStatus := CompRec."Line Status";
            LastComp := LastComp + 1;
          END ELSE BEGIN
            IF (LastFact1 <> CompRec.Norm) OR
               (LastFact2 <> CompRec."Gross Price") OR
               (LastFact3 <> CompRec."Net Cost Price") OR
               (LastFact4 <> CompRec."Net Sales Price") OR  //DP00381
               (LastFact5 <> CompRec."Norm (Sales)") OR  //DP00381
               (LastFact6 <> CompRec."Buy Back Price") OR
               (LastProj <> CompRec."Project No.") OR
               (LastElem <> CompRec.Element) OR
               (LastExtContr <> CompRec."Extension Contract") OR  //DP00260
               (LastProjPlanActCode <> CompRec."Project Planning Activity Code") OR
               (LastWageComponent <> CompRec."Wage Component") OR  //DP01676
               (LastStatus <> CompRec."Line Status") THEN
            BEGIN
              CompRec.Compressed := TRUE;
              LastFact1 := CompRec.Norm;
              LastFact2 := CompRec."Gross Price";
              LastFact3 := CompRec."Net Cost Price";
              LastFact4 := CompRec."Net Sales Price";  //DP00381
              LastFact5 := CompRec."Norm (Sales)";  //DP00381
              LastFact6 := CompRec."Buy Back Price";
              LastProj := CompRec."Project No.";
              LastElem := CompRec.Element;
              LastExtContr := CompRec."Extension Contract";  //DP00260
              LastProjPlanActCode := CompRec."Project Planning Activity Code";
              LastWageComponent := CompRec."Wage Component";  //DP01676
              LastStatus := CompRec."Line Status";
              LastComp := LastComp + 1;
            END;
          END;
          CompRec."Compress No." := LastComp;
          CompRec.MODIFY;
        UNTIL CompRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateIntern@1210190001();
    VAR
      CompRec@1210190000 : Record 11020458;
    BEGIN
      TESTFIELD(Compressed, TRUE);

      CompRec.RESET;
      CompRec.SETCURRENTKEY("Estimate No.", "Compress No.");
      CompRec.SETRANGE("Estimate No.", "Estimate No.");
      CompRec.SETRANGE("Compress No.", "Compress No.");
      CompRec.SETFILTER("Line No.", '<>%1', "Line No.");
      IF CompRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          CompRec."Cost Type (Price)" := "Cost Type (Price)";
          CompRec.Norm := Norm;
          CompRec."Norm (Sales)" := "Norm (Sales)";  //DP00381
          //DP01676.sn
          CompRec."Production Rate" := "Production Rate";
          CompRec."Production Rate (Sales)" := "Production Rate (Sales)";
          //DP01676.en
          CompRec."Surcharge % Labor" := "Surcharge % Labor";  //DP00381
          CompRec."Surcharge % Price" := "Surcharge % Price";  //DP00381
          CompRec."Net Cost Price" := "Net Cost Price";
          CompRec."Net Sales Price" := "Net Sales Price";  //DP00381
          CompRec."Purchase Discount %":= "Purchase Discount %";
          CompRec."Sales Discount %":= "Sales Discount %";
          CompRec."Gross Price" := "Gross Price";
          CompRec.Description := Description;
          CompRec."Price Agreement" := "Price Agreement";
          CompRec."Norm Agreement" := "Norm Agreement";
          CompRec."Price Agreement (Sales)" := "Price Agreement (Sales)";  //C037311
          CompRec."Norm Agreement (Sales)" := "Norm Agreement (Sales)";  //C037311
          CompRec."Item No." := "Item No.";
          CompRec."Basic Item" := "Basic Item";
          CompRec."Trade Item" := "Trade Item";
          CompRec.Manufacturer := Manufacturer;
          CompRec."Vendor (Trade Item)" := "Vendor (Trade Item)";
          CompRec."Cost Object Labor" := "Cost Object Labor";
          CompRec."Cost Object Price" := "Cost Object Price";
          CompRec."Cost Component" := "Cost Component";
          CompRec."Unit of Measure" := "Unit of Measure";
          IF (CompRec."Unit Factor" <> 0) AND ("Unit Factor" = 1) THEN BEGIN
            IF CompRec."Unit Factor" <> 1 THEN BEGIN
              CompRec.Quantity := ROUND(CompRec.Quantity * CompRec."Unit Factor", 1, '>');
              CompRec."Quantity (Sales)" := ROUND(CompRec."Quantity (Sales)" * CompRec."Unit Factor", 1, '>');  //DP00381
            END;
          END;
          IF (CompRec."Unit Factor" = 1) AND ("Unit Factor" <> 0) THEN BEGIN
            IF "Unit Factor" <> 1 THEN BEGIN
              CompRec.Quantity := ROUND(CompRec.Quantity / "Unit Factor", 1, '>');
              CompRec."Quantity (Sales)" := ROUND(CompRec."Quantity (Sales)" / "Unit Factor", 1, '>');  //DP00381
            END;
          END;
          CompRec."Unit Factor" := "Unit Factor";
          CompRec."Norm Group" := "Norm Group";
          CompRec."Norm Group (Sales)" := "Norm Group (Sales)";  //DP00381
          CompRec."Sub Operation Code" := "Sub Operation Code";
          CompRec."Rate Code" := "Rate Code";
          CompRec."Rate Type" := "Rate Type";
          CompRec."Cost Rate" := "Cost Rate";
          CompRec."Sales Rate" := "Sales Rate";  //DP00381
          CompRec."Team Size" := "Team Size";
          CompRec."Project No." := "Project No.";
          CompRec.Element := Element;
          CompRec."Extension Contract" := "Extension Contract";  //DP00260
          CompRec."Project Planning Activity Code" := "Project Planning Activity Code";
          CompRec."Wage Component" := "Wage Component"; //DP01676
          CompRec.Vendor := Vendor;  //DP01676
          CompRec.Subcontractor := Subcontractor;  //DP01958a
          CompRec."Subcontracting Activity" := "Subcontracting Activity";  //DP01958a
          CompRec."Ask for Quote" := "Ask for Quote";
          CompRec."Buy Back Price" := "Buy Back Price";
          CompRec."Buy Back %" := "Buy Back %";
          CompRec.Weight := Weight;
          CompRec."Line Status" := "Line Status";
          CompRec."Purchase Action" := "Purchase Action";
          CompRec."Purchase Phase" := "Purchase Phase";
          //db.sn, 01-11-13: DP00260 (17764)
          CompRec.Discipline := Discipline;
          CompRec."Trade Speciality" := "Trade Speciality";
          CompRec."Trade Expertise" := "Trade Expertise";
          //db.en, 01-11-13: DP00260 (17764)
          CompRec."Appliance Code":= "Appliance Code";  //db, 14-03-19
          CompRec.Changed := TRUE;
          CompRec.CalculateTotals;
          CompRec.MODIFY;
        UNTIL CompRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateExtern@1210190002(CurrEst@1210190004 : Code[20]);
    VAR
      CompRec@1210190000 : Record 11020458;
      EstRec@1210190003 : Record 11012151;
      EstLineRec@1210190002 : Record 11072072;
      RcpLineRec@1210190001 : Record 11072075;
      RawEstLineRec@1100525000 : Record 11125698;
    BEGIN
      EstRec.GET(CurrEst);
      EstRec.TESTFIELD(Fixed, FALSE);

      Status.OPEN(Text000 + Text001);

      EstRec.LOCKTABLE;
      IF EstRec."RAW Estimate" THEN BEGIN  //db, 20-01-10
        RawEstLineRec.LOCKTABLE;
      END ELSE BEGIN
        EstLineRec.LOCKTABLE;
        RcpLineRec.LOCKTABLE;
      END;

      CompRec.RESET;
      CompRec.SETRANGE("Estimate No.", CurrEst);
      CompRec.SETRANGE(Changed, TRUE);
      IF CompRec.FINDSET(TRUE, FALSE) THEN BEGIN
        currec := 0;
        maxrec := CompRec.COUNT;
        Status.UPDATE(1,CompRec.TABLECAPTION);
        REPEAT
          currec := currec + 1;
          Status.UPDATE(2,CompRec.Part);
          Status.UPDATE(3,ROUND(currec / maxrec * 10000,1));
          IF EstRec."RAW Estimate" THEN BEGIN  //db, 20-01-10
            RawEstLineRec.GET(CompRec."Estimate No.", CompRec.Part, CompRec."Estimate Line");
            IF RawEstLineRec."Appliance Code" <> CompRec."Appliance Code" THEN
              RawEstLineRec.VALIDATE("Appliance Code", CompRec."Appliance Code");  //db, 14-03-19
            //DP01676.sn
            IF CompRec."Cost Object Labor" <> '' THEN BEGIN
              RawEstLineRec.VALIDATE("Cost Object", CompRec."Cost Object Labor");
              CompRec.TESTFIELD("Cost Object Price", '');
            END;
            IF CompRec."Cost Object Price" <> '' THEN BEGIN
              RawEstLineRec.VALIDATE("Cost Object", CompRec."Cost Object Price");
              CompRec.TESTFIELD("Cost Object Labor", '');
            END;
            RawEstLineRec.TESTFIELD("Cost Object");
            IF (CompRec.Norm <> 0) OR (CompRec."Sub Operation Code" <> '') THEN BEGIN
              CompRec.TESTFIELD("Gross Price", 0);
              CompRec.TESTFIELD("Net Cost Price", 0);
            END;
            IF (CompRec."Gross Price" <> 0) OR (CompRec."Net Cost Price" <> 0) THEN BEGIN
              CompRec.TESTFIELD(Norm, 0);
              CompRec.TESTFIELD("Production Rate", 0);
            END;
            RawEstLineRec.VALIDATE("Production Rate", CompRec."Production Rate");  //DP01676: evaluate norm and quantity
            RawEstLineRec."Net Cost Price" := CompRec."Net Cost Price";
            RawEstLineRec."Purchase Discount %":= CompRec."Purchase Discount %";
            RawEstLineRec."Sales Discount %":= CompRec."Sales Discount %";
            RawEstLineRec."Gross Price" := CompRec."Gross Price" ;
            //DP01676.en
            RawEstLineRec.Description := CompRec.Description;
            RawEstLineRec."Price Agreement" := CompRec."Price Agreement";
            RawEstLineRec."Norm Agreement" := CompRec."Norm Agreement";
            //RawEstLineRec."Price Agreement (Sales)" := CompRec."Price Agreement (Sales)";  //C037311
            //RawEstLineRec."Norm Agreement (Sales)" := CompRec."Norm Agreement (Sales)";  //C037311
            RawEstLineRec."Item No." := CompRec."Item No.";
            RawEstLineRec."Basic Item" := CompRec."Basic Item";
            RawEstLineRec."Trade Item" := CompRec."Trade Item";
            RawEstLineRec.Manufacturer := CompRec.Manufacturer;
            RawEstLineRec."Vendor (Trade Item)" := CompRec."Vendor (Trade Item)";
            //DP01676.sn
            IF CompRec."Cost Object Labor" <> '' THEN BEGIN
              RawEstLineRec.VALIDATE("Cost Object", CompRec."Cost Object Labor");
              CompRec.TESTFIELD("Cost Object Price", '');
            END;
            IF CompRec."Cost Object Price" <> '' THEN BEGIN
              RawEstLineRec.VALIDATE("Cost Object", CompRec."Cost Object Price");
              CompRec.TESTFIELD("Cost Object Labor", '');
            END;
            IF (CompRec.Norm <> 0) OR (CompRec."Net Cost Price" <> 0) THEN
              RawEstLineRec.TESTFIELD("Cost Object");
            //DP01676.en
            RawEstLineRec."Cost Component" := CompRec."Cost Component";
            IF RawEstLineRec."Apply Obligation" = FALSE THEN  //DP01676: quantity evaluated by Obligation
              RawEstLineRec.Quantity := CompRec.Quantity;
            //RawEstLineRec."Quantity (Sales)" := CompRec."Quantity (Sales)";
            RawEstLineRec."Unit of Measure" := CompRec."Unit of Measure";
            RawEstLineRec."Norm Group" := CompRec."Norm Group";
            RawEstLineRec."Sub Operation Code" := CompRec."Sub Operation Code";
            RawEstLineRec."Rate Code" := CompRec."Rate Code";
            RawEstLineRec."Rate Type" := CompRec."Rate Type";
            RawEstLineRec.Rate := CompRec."Cost Rate";
            //RawEstLineRec."Sales Rate" := CompRec."Sales Rate";
            RawEstLineRec."Team Size" := CompRec."Team Size";
            RawEstLineRec."Project No." := CompRec."Project No.";
            RawEstLineRec.Element := CompRec.Element;
            //RawEstLineRec."Extension Contract" := CompRec."Extension Contract";  //DP00260
            RawEstLineRec."Project Planning Activity Code" := CompRec."Project Planning Activity Code";
            RawEstLineRec."Wage Component" := CompRec."Wage Component";  //DP01676
            RawEstLineRec.Vendor := CompRec.Vendor;  //DP01676
            RawEstLineRec.Subcontractor := CompRec.Subcontractor;  //DP01958a
            RawEstLineRec."Subcontracting Activity" := CompRec."Subcontracting Activity";  //DP01958a
            RawEstLineRec."Ask for Quote" := CompRec."Ask for Quote";
            RawEstLineRec."Buy Back Price" := CompRec."Buy Back Price";
            RawEstLineRec."Buy Back %" := CompRec."Buy Back %";
            RawEstLineRec.Weight := CompRec.Weight;
            RawEstLineRec."Line Status" := CompRec."Line Status";
            RawEstLineRec."Purchase Action" := CompRec."Purchase Action";
            RawEstLineRec."Purchase Phase" := CompRec."Purchase Phase";
            //db.sn, 01-11-13: DP00260 (17764)
            RawEstLineRec.Discipline := CompRec.Discipline;
            RawEstLineRec."Trade Speciality" := CompRec."Trade Speciality";
            RawEstLineRec."Trade Expertise" := CompRec."Trade Expertise";
            //db.en, 01-11-13: DP00260 (17764)
            RawEstLineRec.CalculateTotals;
            RawEstLineRec.MODIFY;
          END ELSE BEGIN
            IF CompRec."Recipe Line" = 0 THEN BEGIN
              EstLineRec.GET(CompRec."Estimate No.", CompRec."Sub-Estimate No.", CompRec."Part Group",
                             CompRec.Part, CompRec."Estimate Line");
              EstLineRec.Norm := CompRec.Norm;
              EstLineRec."Norm (Sales)" := CompRec."Norm (Sales)";  //DP00381
              //db.sn, 28-09-12: C002769
              IF EstLineRec.Norm <> 0 THEN
                EstLineRec."Production Rate" := 1 / EstLineRec.Norm
              ELSE
                EstLineRec."Production Rate" := 0;
              IF EstLineRec."Norm (Sales)" <> 0 THEN  //DP00381
                EstLineRec."Production Rate (Sales)" := 1 / EstLineRec."Norm (Sales)"
              ELSE
                EstLineRec."Production Rate (Sales)" := 0;
              //db.en, 28-09-12: C002769
              EstLineRec."Surcharge % Labor" := CompRec."Surcharge % Labor";  //DP00381
              EstLineRec."Surcharge % Price" := CompRec."Surcharge % Price";  //DP00381
              EstLineRec."Cost Type (Price)" := CompRec."Cost Type (Price)";  //DP00381
              EstLineRec."Net Cost Price" := CompRec."Net Cost Price";
              EstLineRec."Net Sales Price" := CompRec."Net Sales Price";  //DP00381
              EstLineRec."Purchase Discount %":= CompRec."Purchase Discount %";
              EstLineRec."Sales Discount %":= CompRec."Sales Discount %";
              EstLineRec.VALIDATE("Gross Price", CompRec."Gross Price");
              EstLineRec.Description := CompRec.Description;
              EstLineRec."Price Agreement" := CompRec."Price Agreement";
              EstLineRec."Norm Agreement" := CompRec."Norm Agreement";
              EstLineRec."Price Agreement (Sales)" := CompRec."Price Agreement (Sales)";  //C037311
              EstLineRec."Norm Agreement (Sales)" := CompRec."Norm Agreement (Sales)";  //C037311
              EstLineRec."Item No." := CompRec."Item No.";
              EstLineRec."Basic Item" := CompRec."Basic Item";
              EstLineRec."Trade Item" := CompRec."Trade Item";
              EstLineRec.Manufacturer := CompRec.Manufacturer;
              EstLineRec."Vendor (Trade Item)" := CompRec."Vendor (Trade Item)";
              EstLineRec."Cost Object Labor" := CompRec."Cost Object Labor";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Material THEN
                EstLineRec."Cost Object Price" := CompRec."Cost Object Price";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Subcontracting THEN
                EstLineRec."Cost Object Price" := CompRec."Cost Object Price";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Plant THEN
                EstLineRec."Cost Object Price" := CompRec."Cost Object Price";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Sundry THEN  //C039639
                EstLineRec."Cost Object Price" := CompRec."Cost Object Price";
              EstLineRec."Cost Component" := CompRec."Cost Component";
              EstLineRec.Quantity := CompRec.Quantity;
              EstLineRec."Quantity (Sales)" := CompRec."Quantity (Sales)";  //DP00381
              EstLineRec."Unit of Measure" := CompRec."Unit of Measure";
              EstLineRec."Norm Group" := CompRec."Norm Group";
              EstLineRec."Norm Group (Sales)" := CompRec."Norm Group (Sales)";  //DP00381
              EstLineRec."Sub Operation Code" := CompRec."Sub Operation Code";
              EstLineRec."Rate Code" := CompRec."Rate Code";
              EstLineRec."Rate Type" := CompRec."Rate Type";
              EstLineRec."Cost Rate" := CompRec."Cost Rate";
              EstLineRec."Sales Rate" := CompRec."Sales Rate";  //DP00381
              EstLineRec."Team Size" := CompRec."Team Size";
              EstLineRec."Project No." := CompRec."Project No.";
              EstLineRec.Element := CompRec.Element;
              EstLineRec."Extension Contract" := CompRec."Extension Contract";  //DP00260
              EstLineRec."Project Planning Activity Code" := CompRec."Project Planning Activity Code";
              EstLineRec."Wage Component" := CompRec."Wage Component";  //DP01676
              EstLineRec.Vendor := CompRec.Vendor;  //DP01676
              EstLineRec.Subcontractor := CompRec.Subcontractor;  //DP01958a
              EstLineRec."Subcontracting Activity" := CompRec."Subcontracting Activity";  //DP01958a
              EstLineRec."Ask for Quote" := CompRec."Ask for Quote";
              EstLineRec."Buy Back Price" := CompRec."Buy Back Price";
              EstLineRec."Buy Back %" := CompRec."Buy Back %";
              EstLineRec.Weight := CompRec.Weight;
              EstLineRec."Line Status" := CompRec."Line Status";
              EstLineRec."Purchase Action" := CompRec."Purchase Action";
              EstLineRec."Purchase Phase" := CompRec."Purchase Phase";
              //db.sn, 01-11-13: DP00260 (17764)
              EstLineRec.Discipline := CompRec.Discipline;
              EstLineRec."Trade Speciality" := CompRec."Trade Speciality";
              EstLineRec."Trade Expertise" := CompRec."Trade Expertise";
              //db.en, 01-11-13: DP00260 (17764)
              EstLineRec.CalculateTotals;
              EstLineRec.MODIFY;
              EstLineRec.CheckEstimateCharge;
            END ELSE BEGIN
              RcpLineRec.GET(CompRec."Estimate No.", CompRec."Sub-Estimate No.", CompRec."Part Group",
                             CompRec.Part, CompRec."Estimate Line", CompRec."Recipe Group",
                             CompRec.Recipe, CompRec."Recipe Line");
              RcpLineRec.Norm := CompRec.Norm;
              RcpLineRec."Norm (Sales)" := CompRec."Norm (Sales)";  //DP00381
              //db.sn, 28-09-12: C002769
              IF RcpLineRec.Norm <> 0 THEN
                RcpLineRec."Production Rate" := 1 / RcpLineRec.Norm
              ELSE
                RcpLineRec."Production Rate" := 0;
              IF RcpLineRec."Norm (Sales)" <> 0 THEN  //DP00381
                RcpLineRec."Production Rate (Sales)" := 1 / RcpLineRec."Norm (Sales)"
              ELSE
                RcpLineRec."Production Rate (Sales)" := 0;
              //db.en, 28-09-12: C002769
              RcpLineRec."Surcharge % Labor" := CompRec."Surcharge % Labor";  //DP00381
              RcpLineRec."Surcharge % Price" := CompRec."Surcharge % Price";  //DP00381
              RcpLineRec."Cost Type (Price)" := CompRec."Cost Type (Price)";  //DP00381
              RcpLineRec."Net Cost Price" := CompRec."Net Cost Price";
              RcpLineRec."Net Sales Price" := CompRec."Net Sales Price";  //DP00381
              RcpLineRec."Purchase Discount %":= CompRec."Purchase Discount %";
              RcpLineRec."Sales Discount %":= CompRec."Sales Discount %";
              RcpLineRec.VALIDATE("Gross Price", CompRec."Gross Price");
              RcpLineRec.Description := CompRec.Description;
              RcpLineRec."Price Agreement" := CompRec."Price Agreement";
              RcpLineRec."Norm Agreement" := CompRec."Norm Agreement";
              RcpLineRec."Price Agreement (Sales)" := CompRec."Price Agreement (Sales)";  //C037311
              RcpLineRec."Norm Agreement (Sales)" := CompRec."Norm Agreement (Sales)";  //C037311
              RcpLineRec."Item No." := CompRec."Item No.";
              RcpLineRec."Basic Item" := CompRec."Basic Item";
              RcpLineRec."Trade Item" := CompRec."Trade Item";
              RcpLineRec.Manufacturer := CompRec.Manufacturer;
              RcpLineRec."Vendor (Trade Item)" := CompRec."Vendor (Trade Item)";
              RcpLineRec."Cost Object Labor" := CompRec."Cost Object Labor";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Material THEN
                RcpLineRec."Cost Object Price" := CompRec."Cost Object Price";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Subcontracting THEN
                RcpLineRec."Cost Object Price" := CompRec."Cost Object Price";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Plant THEN
                RcpLineRec."Cost Object Price" := CompRec."Cost Object Price";
              IF CompRec."Cost Type (Price)" = CompRec."Cost Type (Price)"::Sundry THEN  //C039639
                RcpLineRec."Cost Object Price" := CompRec."Cost Object Price";
              RcpLineRec."Cost Component" := CompRec."Cost Component";
              RcpLineRec.Quantity := CompRec.Quantity;
              RcpLineRec."Quantity (Sales)" := CompRec."Quantity (Sales)";  //DP00381
              RcpLineRec."Unit of Measure" := CompRec."Unit of Measure";
              RcpLineRec."Norm Group" := CompRec."Norm Group";
              RcpLineRec."Norm Group (Sales)" := CompRec."Norm Group (Sales)";  //DP00381
              RcpLineRec."Sub Operation Code" := CompRec."Sub Operation Code";
              RcpLineRec."Rate Code" := CompRec."Rate Code";
              RcpLineRec."Rate Type" := CompRec."Rate Type";
              RcpLineRec."Cost Rate" := CompRec."Cost Rate";
              RcpLineRec."Sales Rate" := CompRec."Sales Rate";  //DP00381
              RcpLineRec."Team Size" := CompRec."Team Size";
              RcpLineRec."Project No." := CompRec."Project No.";
              RcpLineRec.Element := CompRec.Element;
              RcpLineRec."Extension Contract" := CompRec."Extension Contract";  //DP00260
              RcpLineRec."Project Planning Activity Code" := CompRec."Project Planning Activity Code";
              RcpLineRec."Wage Component" := CompRec."Wage Component";  //DP01676
              RcpLineRec.Vendor := CompRec.Vendor;  //DP01676
              RcpLineRec.Subcontractor := CompRec.Subcontractor;  //DP01958a
              RcpLineRec."Subcontracting Activity" := CompRec."Subcontracting Activity";  //DP01958a
              RcpLineRec."Ask for Quote" := CompRec."Ask for Quote";
              RcpLineRec."Buy Back Price" := CompRec."Buy Back Price";
              RcpLineRec."Buy Back %" := CompRec."Buy Back %";
              RcpLineRec.Weight := CompRec.Weight;
              RcpLineRec."Line Status" := CompRec."Line Status";
              RcpLineRec."Purchase Action" := CompRec."Purchase Action";
              RcpLineRec."Purchase Phase" := CompRec."Purchase Phase";
              //db.sn, 01-11-13: DP00260 (17764)
              RcpLineRec.Discipline := CompRec.Discipline;
              RcpLineRec."Trade Speciality" := CompRec."Trade Speciality";
              RcpLineRec."Trade Expertise" := CompRec."Trade Expertise";
              //db.en, 01-11-13: DP00260 (17764)
              RcpLineRec.CalculateTotals;
              RcpLineRec.MODIFY;
              RcpLineRec.CheckRecipeCharge;
              RcpLineRec.UpdateEstLines;
            END;
          END;
          CompRec.Changed := FALSE;
          CompRec.MODIFY;
        UNTIL CompRec.NEXT = 0;
      END;

      EstRec.UpdateLogbook(CurrEst);
      COMMIT;
      Status.CLOSE;
    END;

    PROCEDURE FillPurchRouteRefFilterCompres@1210190006() : Code[1024];
    VAR
      lvTmpRouteRefRec@1210190000 : TEMPORARY Record 11012079;
      lvRefFilter@1210190001 : Code[1024];
    BEGIN
      lvRefFilter := '';

      CompRec.RESET;
      CompRec.SETCURRENTKEY("Estimate No.", "Text Composition", "Ask for Quote", "Price Agreement", "Norm Agreement", "Zero Line");
      CompRec.SETRANGE("Estimate No.", "Estimate No.");
      CompRec.SETRANGE("Text Composition", "Text Composition");
      CompRec.SETRANGE("Ask for Quote", "Ask for Quote");
      CompRec.SETRANGE("Price Agreement", "Price Agreement");
      CompRec.SETFILTER("Purchase Route Reference", '<>%1', '');
      IF CompRec.FINDSET THEN BEGIN
        REPEAT
          lvTmpRouteRefRec.SETRANGE(Type, lvTmpRouteRefRec.Type::Reference);
          lvTmpRouteRefRec.SETRANGE("Reference No.", CompRec."Purchase Route Reference");
          IF NOT lvTmpRouteRefRec.FIND('-') THEN BEGIN
            lvTmpRouteRefRec.Type := lvTmpRouteRefRec.Type::Reference;
            lvTmpRouteRefRec."Reference No." := CompRec."Purchase Route Reference";
            lvTmpRouteRefRec."Entry No." := 1;
            lvTmpRouteRefRec.INSERT;
          END;
        UNTIL CompRec.NEXT = 0;
      END;

      lvTmpRouteRefRec.RESET;
      lvTmpRouteRefRec.SETRANGE(Type, lvTmpRouteRefRec.Type::Reference);
      IF lvTmpRouteRefRec.FIND('-') THEN BEGIN
        REPEAT
          IF (STRLEN(lvRefFilter) + STRLEN(lvTmpRouteRefRec."Reference No.")) <= MAXSTRLEN(lvRefFilter) THEN BEGIN
            IF lvRefFilter <> '' THEN
              lvRefFilter := lvRefFilter +'|';
            lvRefFilter := lvRefFilter + lvTmpRouteRefRec."Reference No.";
          END;
        UNTIL lvTmpRouteRefRec.NEXT = 0;
      END;

      EXIT(lvRefFilter);
    END;

    PROCEDURE ComposeText@1210190016(MainRec@1210190000 : Record 11020458) TextComp : Code[250];
    VAR
      sep@1100485000 : Text[30];
    BEGIN
      sep := '~';
      TextComp := '';

      TextComp := TextComp + MainRec.Description + sep;
      TextComp := TextComp + MainRec."Unit of Measure" + sep;
      TextComp := TextComp + MainRec."Rate Code" + sep;
      IF MainRec."Trade Item" <> '' THEN
        TextComp := TextComp + MainRec."Trade Item" + sep
      ELSE
        IF MainRec."Basic Item" <> '' THEN
          TextComp := TextComp + MainRec."Basic Item" + sep
        ELSE
          IF MainRec."Item No." <> '' THEN
            TextComp := TextComp + MainRec."Item No." + sep
          ELSE
            IF MainRec."Cost Object Labor" <> '' THEN
              TextComp := TextComp + MainRec."Cost Object Labor" + sep
            ELSE
              TextComp := TextComp + MainRec."Cost Object Price" + sep;
      IF MainRec."Plant Type" <> '' THEN
        TextComp := TextComp + MainRec."Plant Type" + sep;

      TextComp := COPYSTR(TextComp, 1, MAXSTRLEN(MainRec."Text Composition"));  //100+10+10+20
      EXIT(TextComp);
    END;

    PROCEDURE CalculateDiscount@1100485000(SalesBln@1100525001 : Boolean);
    BEGIN
      IF "Gross Price" <> 0 THEN BEGIN
        IF  ("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Purchase Discount %" = 0) THEN BEGIN
          "Gross Price" := "Net Cost Price";
          //db.sn, 11-11-13: DP00260 (C005807)
          IF NOT SalesBln THEN
            VALIDATE("Net Sales Price","Gross Price" - (("Gross Price"/100) * "Sales Discount %"));
          //db.en, 11-11-13: DP00260 (C005807)
        END ELSE BEGIN
          IF SalesBln THEN
            "Sales Discount %" := (("Gross Price" - "Net Sales Price") / "Gross Price") * 100
          ELSE
            "Purchase Discount %" := (("Gross Price" - "Net Cost Price") / "Gross Price") * 100;
        END;
      END ELSE BEGIN
        //db.sn, 11-11-13: DP00260 (C005807)
        IF NOT SalesBln THEN BEGIN
          IF "Purchase Discount %" = 0 THEN BEGIN
            "Gross Price" := "Net Cost Price";
            VALIDATE("Net Sales Price","Gross Price" - (("Gross Price"/100) * "Sales Discount %"));
          END;
        END;
        //db.en, 11-11-13: DP00260 (C005807)
        IF "Purchase Discount %" <> 100 THEN BEGIN
          IF NOT (("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Purchase Discount %" = 0)) THEN
            "Gross Price" := "Net Cost Price" / ((100 - "Purchase Discount %") / 100);
        END ELSE BEGIN
          "Gross Price" := "Net Cost Price";
        END;
      END;
    END;

    PROCEDURE CalculateNetPrice@13();
    BEGIN
      VALIDATE("Net Cost Price","Gross Price" - (("Gross Price"/100) * "Purchase Discount %"));
      VALIDATE("Net Sales Price","Gross Price" - (("Gross Price"/100) * "Sales Discount %"));  //DP00381
    END;

    PROCEDURE CalculateGrossPrice@1100525002();
    BEGIN
      IF "Purchase Discount %" <> 100 THEN
        "Gross Price" := "Net Cost Price" * 100 / (100 - "Purchase Discount %");
    END;

    PROCEDURE CalculateCompressedTotals@1210190009(VAR CumQuanCost@1100485001 : Decimal;VAR HoursCost@1100485002 : Decimal;VAR LaborCost@1100485003 : Decimal;VAR MaterialCost@1100485004 : Decimal;VAR SubcontractingCost@1100485005 : Decimal;VAR PlantCost@1100485006 : Decimal;VAR SundryCost@1100525005 : Decimal;VAR CostAmount@1100485000 : Decimal;VAR BuyBack@1100525000 : Decimal;VAR CumQuanSales@1100525009 : Decimal;VAR HoursSales@1100525007 : Decimal;VAR LaborSales@1100525006 : Decimal;VAR MaterialSales@1100525004 : Decimal;VAR SubcontractingSales@1100525003 : Decimal;VAR PlantSales@1100525002 : Decimal;VAR SundrySales@1100525008 : Decimal;VAR SalesAmount@1100525001 : Decimal);
    BEGIN
      //Dp00381
      CumQuanCost := 0;
      HoursCost := 0;
      LaborCost := 0;
      MaterialCost := 0;
      SubcontractingCost := 0;
      PlantCost := 0;
      SundryCost := 0;
      CostAmount := 0;
      BuyBack := 0;
      CumQuanSales := 0;
      HoursSales := 0;
      LaborSales := 0;
      MaterialSales := 0;
      SubcontractingSales := 0;
      PlantSales := 0;
      SundrySales := 0;
      SalesAmount := 0;

      CompRec.RESET;
      CompRec.SETCURRENTKEY("Estimate No.", "Compress No.");
      CompRec.SETRANGE("Estimate No.", "Estimate No.");
      CompRec.SETRANGE("Compress No.", "Compress No.");
      IF CompRec.FINDSET THEN BEGIN
        REPEAT
          CumQuanCost := CumQuanCost + CompRec."Cumulative Quantity";
          HoursCost := HoursCost + CompRec.Hours;
          LaborCost := LaborCost + CompRec."Labor Cost Amount";
          MaterialCost := MaterialCost + CompRec."Material Cost Amount";
          SubcontractingCost := SubcontractingCost + CompRec."Subcontracting Cost Amount";
          PlantCost := PlantCost + CompRec."Plant Cost Amount";
          SundryCost := SundryCost + CompRec."Sundry Cost Amount";
          CostAmount := CostAmount + CompRec."Cost Amount";
          BuyBack := BuyBack + CompRec."Buy Back Amount";
          //Sales
          CumQuanSales := CumQuanSales + CompRec."Cumulative Quantity (Sales)";
          HoursSales := HoursSales + CompRec."Hours (Sales)";
          LaborSales := LaborSales + CompRec."Labor Sales Amount";
          MaterialSales := MaterialSales + CompRec."Material Sales Amount";
          SubcontractingSales := SubcontractingSales + CompRec."Subcontracting Sales Amount";
          PlantSales := PlantSales + CompRec."Plant Sales Amount";
          SundrySales := SundrySales + CompRec."Sundry Sales Amount";
          SalesAmount := SalesAmount + CompRec."Sales Amount";
        UNTIL CompRec.NEXT = 0;
      END;
    END;

    PROCEDURE HandleLookupUnit@1210190011();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";  //db, 01-07-04: standard bug
        VALIDATE("Unit of Measure", lvUnit);
        IF CurrFieldNo = 0 THEN  //db, 07-11-05: if function called by lookup on form
          CheckItemUnitConversion(Rec, xRec);
      END;
    END;

    PROCEDURE CheckItemUnitConversion@1210190007(VAR MainNewRec@1210190006 : Record 11020458;MainOldRec@1210190007 : Record 11020458);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
      ValidateCu@1210190008 : Codeunit 11012033;
      DummyFactor@1100525000 : Decimal;
    BEGIN
      WITH MainNewRec DO BEGIN
        UnitFactorOld := 1;
        UnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            Quantity,"Unit of Measure",UnitFactorNew);
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            "Quantity (Sales)","Unit of Measure",DummyFactor);  //C036708
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              Quantity,"Unit of Measure",UnitFactorNew);
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              "Quantity (Sales)","Unit of Measure",DummyFactor);  //C036708
          END ELSE BEGIN
            IF "Item No." <> '' THEN BEGIN
              ItemRec.GET("Item No.");
              UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, MainOldRec."Unit of Measure");
              UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, "Unit of Measure");
              UnitFactor := UnitFactorOld;
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                Quantity,"Unit of Measure",UnitFactor);
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                "Quantity (Sales)","Unit of Measure",DummyFactor);  //C036708
            END;
          END;
        END;
        IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
          IF UnitFactorNew <> UnitFactorOld THEN BEGIN
            VALIDATE("Gross Price", ("Gross Price" * UnitFactorNew / UnitFactorOld));
            VALIDATE(Weight,(Weight * UnitFactorNew / UnitFactorOld));
            //C036708.sn
            "Cumulative Quantity" := Quantity * "Part Quantity";
            "Cumulative Quantity (Sales)" := "Quantity (Sales)" * "Part Quantity";
            //C036708.en
          END;
          "Unit Factor" := UnitFactorNew;
        END;
      END;
    END;

    PROCEDURE CheckUnitFactor@1210190012() lvFactor : Decimal;
    BEGIN
      lvFactor := 1;

      WITH CompRec DO BEGIN
        IF TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
          IF "Unit of Measure" = UPPERCASE(TradeItemRec."Packaging Unit") THEN
            IF TradeItemRec."Qty. per Unit of Measure" <> 0 THEN
              lvFactor := TradeItemRec."Qty. per Unit of Measure";
          EXIT(lvFactor);
        END;
        IF BasicItemRec.GET(Manufacturer, "Basic Item") THEN BEGIN
          IF "Unit of Measure" = UPPERCASE(BasicItemRec."Packaging Unit") THEN
            IF BasicItemRec."Qty. per Unit of Measure" <> 0 THEN
              lvFactor := BasicItemRec."Qty. per Unit of Measure";
          EXIT(lvFactor);
        END;
        IF ItemUnitRec.GET("Item No.", "Unit of Measure") THEN BEGIN
          IF ItemUnitRec."Qty. per Unit of Measure" <> 0 THEN
            lvFactor := ItemUnitRec."Qty. per Unit of Measure";
          EXIT(lvFactor);
        END;
      END;

      EXIT(lvFactor);
    END;

    PROCEDURE ValidateItem@3(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item');
    VAR
      Desc1Txt@1210190001 : Text[50];
      Desc2Txt@1210190003 : Text[50];
      lvDummyDate@1210190005 : Date;
      lvRefDate@1100485000 : Date;
      lvDiscRef1@1100525001 : Code[20];
      lvDiscRef2@1100525002 : Code[20];
      lvRefPrio@1100525000 : Code[10];
      lvDiscType@1100525003 : 'Purchase,Sales';
      ValidateCu@1210190004 : Codeunit 11012033;
    BEGIN
      IF ("Purchase Route Reference" = '') AND ("Price Agreement" = FALSE) THEN BEGIN
        EstRec.GET("Estimate No.");
        lvRefDate := ValidateCu.GetRefDateEstimate(EstRec);
        ValidateCu.GetRefDiscEstimate(EstRec, lvDiscRef1, lvDiscRef2, lvDiscType::Purchase);
        lvRefPrio := ValidateCu.GetRefPrioEstimate(EstRec, lvDiscType::Purchase);

        ValidateCu.ValidateItem(
          LTypeArtOpt, "Trade Item", "Item No.", Manufacturer, "Vendor (Trade Item)", "Basic Item",
          "Cost Object Price", Desc1Txt, "Unit of Measure", "Net Cost Price",
          "Purchase Discount %", lvDummyDate, "Gross Price", Desc2Txt, "Cost Component",
          lvDiscRef1, lvDiscRef2, lvRefDate, lvRefPrio);

        //dbeekman.sn, 31-03-09, calculate BuyBack
        CLEAR("Buy Back Price");
        CLEAR("Buy Back %");
        IF LTypeArtOpt = LTypeArtOpt::Item THEN BEGIN
          IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
          IF ItemRec."Sales/Buy-Back Item (Plant)" THEN BEGIN  //db, 06-06-11: M27669 (skip validate for normal items)
            ValidateCu.GetSalesBuyBackRates("Item No.", EstRec."Plant Location",lvRefDate,
              "Gross Price","Buy Back Price");  //db, 06-06-11: M27669 (use SalesRate as GrossPrice)
            VALIDATE("Buy Back Price");
            VALIDATE("Purchase Discount %", ItemRec."Profit %");  //db, 22-09-11: M27669 (assumed to be zero)
          END;
        END;
        //dbeekman.en

        "Text Composition" := ComposeText(Rec);
        IF Desc2Txt = '' THEN
          Description := Desc1Txt
        ELSE
          Description := COPYSTR((Desc1Txt + '\' + Desc2Txt), 1, MAXSTRLEN(Description));

        ValidateCu.GetRefDiscEstimate(EstRec, lvDiscRef1, lvDiscRef2, lvDiscType::Sales);
        lvRefPrio := ValidateCu.GetRefPrioEstimate(EstRec, lvDiscType::Sales);
        ValidateCu.GetSalesDiscount(
          EstRec."Customer No.", "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
          "Net Sales Price", "Sales Discount %", "Gross Price", lvRefDate, EstRec."Customer Disc. Group",
          lvDiscRef1, lvDiscRef2, lvRefPrio);  //DP00381
      END;

      CASE LTypeArtOpt OF
        LTypeArtOpt::Item:
          BEGIN
            IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
            Weight := ItemRec.Weight;
            IF ItemRec."Sub Operation Code" <> '' THEN
              VALIDATE("Sub Operation Code", ItemRec."Sub Operation Code");
          END;
        LTypeArtOpt::"Basic Item":
          BEGIN
            IF NOT BasicItemRec.GET(Manufacturer, "Basic Item") THEN BasicItemRec.INIT;
            Weight := BasicItemRec."Net Weight";
            IF BasicItemRec."Sub Operation Code" <> '' THEN
              VALIDATE("Sub Operation Code", BasicItemRec."Sub Operation Code");
          END;
        LTypeArtOpt::"Trade Item":
          BEGIN
            IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN TradeItemRec.INIT;
            Weight := TradeItemRec."Gross Weight";
            IF TradeItemRec."Sub Operation Code" <> '' THEN
              VALIDATE("Sub Operation Code", TradeItemRec."Sub Operation Code");
          END;
      END;

      VALIDATE("Buy Back Price"); //to trigger error if buyback is not allowed when new item is selected with price agreement
    END;

    PROCEDURE CalculateTotals@1();
    VAR
      WageCompRec@1100525017 : Record 11012014;
      OverTimeFactorCost@1100525016 : Decimal;
      OverTimeFactorSales@1100525015 : Decimal;
      NetPriceMat@1100525013 : Decimal;
      NetPriceSubc@1100525012 : Decimal;
      NetPricePlant@1100525011 : Decimal;
      NetPriceSundry@1100525010 : Decimal;
      GrossPriceMat@1100525009 : Decimal;
      GrossPriceSubc@1100525008 : Decimal;
      GrossPricePlant@1100525007 : Decimal;
      GrossPriceSundry@1100525006 : Decimal;
      SalesPriceMat@1100525005 : Decimal;
      SalesPriceSubc@1100525004 : Decimal;
      SalesPricePlant@1100525003 : Decimal;
      SalesPriceSundry@1100525002 : Decimal;
      CostRate@1100525001 : Decimal;
      SalesRate@1100525000 : Decimal;
    BEGIN
      //DP00381: copy from EstLineRec", adapted for cumulative quantity
      Hours := "Time Quantity" * "Cumulative Quantity" * Norm;
      "Hours (Sales)" := "Time Quantity" * "Cumulative Quantity (Sales)" * "Norm (Sales)";
      CostRate := "Cost Rate";
      SalesRate := "Sales Rate" * (1 + "Surcharge % Labor"/100);
      IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN BEGIN
        NetPriceMat := "Net Cost Price";
        GrossPriceMat := "Gross Price";
        SalesPriceMat := "Net Sales Price" * (1 + "Surcharge % Price"/100);
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN BEGIN
        NetPriceSubc := "Net Cost Price";
        GrossPriceSubc := "Gross Price";
        SalesPriceSubc := "Net Sales Price" * (1 + "Surcharge % Price"/100);
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN BEGIN
        NetPricePlant := "Net Cost Price";
        GrossPricePlant := "Gross Price";
        SalesPricePlant := "Net Sales Price" * (1 + "Surcharge % Price"/100);
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN BEGIN
        NetPriceSundry := "Net Cost Price";
        GrossPriceSundry := "Gross Price";
        SalesPriceSundry := "Net Sales Price" * (1 + "Surcharge % Price"/100);
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::" " THEN BEGIN
        IF ("Net Cost Price" <> 0) OR ("Net Sales Price" <> 0) THEN
          TESTFIELD("Cost Type (Price)");
      END;

      IF "Cum. Adj. Factor Hours" <> 0 THEN
        Hours := Hours * "Cum. Adj. Factor Hours";
      IF "Cum. Adj. Factor Hours (Sales)" <> 0 THEN  //DP00555
        "Hours (Sales)" := "Hours (Sales)" * "Cum. Adj. Factor Hours (Sales)";
      "Labor Cost Amount"  := Hours * CostRate;
      "Labor Sales Amount"  := "Hours (Sales)" * SalesRate;
      //DP01676.sn
      IF "Wage Component" <> '' THEN BEGIN
        WageCompRec.GetOverTimeFactors("Wage Component",OverTimeFactorCost, OverTimeFactorSales);
        IF OverTimeFactorCost <> 0 THEN
          "Labor Cost Amount" := "Labor Cost Amount" * OverTimeFactorCost;
        IF OverTimeFactorSales <> 0 THEN
          "Labor Sales Amount" := "Labor Sales Amount" * OverTimeFactorSales;
      END;
      //DP01676.en
      IF "Rate Type" = "Rate Type"::Minuts THEN BEGIN
        Hours := Hours * "Team Size" / 60;
        "Hours (Sales)":= "Hours (Sales)" * "Team Size" / 60;
      END;

      "Material Cost Amount" := "Time Quantity" * "Cumulative Quantity" * NetPriceMat;
      "Material Sales Amount" := "Time Quantity" * "Cumulative Quantity (Sales)" * SalesPriceMat;

      IF "Cost Type (Hours)"= "Cost Type (Hours)"::Subcontracting THEN BEGIN  //DP01676
        "Subcontracting Cost Amount" := Hours * NetPriceSubc;
        "Subcontracting Sales Amount" := "Hours (Sales)" * SalesPriceSubc;
      END ELSE BEGIN
        "Subcontracting Cost Amount" := "Time Quantity" * "Cumulative Quantity" * NetPriceSubc;
        "Subcontracting Sales Amount" := "Time Quantity" * "Cumulative Quantity (Sales)" * SalesPriceSubc;
      END;

      //C038168.sn
      IF "Cost Type (Hours)"= "Cost Type (Hours)"::Plant THEN BEGIN
        "Plant Cost Amount" := Hours * NetPricePlant;
        "Plant Sales Amount" := "Hours (Sales)" * SalesPricePlant;
      END ELSE BEGIN
        "Plant Cost Amount" := "Time Quantity" * "Cumulative Quantity" * NetPricePlant;
        "Plant Sales Amount" := "Time Quantity" * "Cumulative Quantity (Sales)" * SalesPricePlant;
      END;
      //C038168.en

      "Sundry Cost Amount" := "Time Quantity" * "Cumulative Quantity" * NetPriceSundry;
      "Sundry Sales Amount" := "Time Quantity" * "Cumulative Quantity (Sales)" * SalesPriceSundry;

      IF ("Cum. Adj. Factor Price" <> 0)  AND ("Cost Type (Price)" = "Cost Type (Price)"::Material) THEN BEGIN
        "Material Cost Amount" := "Material Cost Amount" * "Cum. Adj. Factor Price";
        "Gross Amount" := "Gross Amount" * "Cum. Adj. Factor Price";
      END;
      IF ("Cum. Adj. Factor Price" <> 0)  AND ("Cost Type (Price)" = "Cost Type (Price)"::Subcontracting) THEN BEGIN
        "Subcontracting Cost Amount" := "Subcontracting Cost Amount" * "Cum. Adj. Factor Price";
        //"Subcontracting Gross Amount" := "Subcontracting Gross Amount" * "Cum. Adj. Factor Price";
      END;
      IF ("Cum. Adj. Factor Price" <> 0)  AND ("Cost Type (Price)" = "Cost Type (Price)"::Plant) THEN BEGIN
        "Plant Cost Amount" := "Plant Cost Amount" * "Cum. Adj. Factor Price";
        //"Plant Gross Amount" := "Plant Gross Amount" * "Cum. Adj. Factor Price";
      END;
      IF ("Cum. Adj. Factor Price" <> 0)  AND ("Cost Type (Price)" = "Cost Type (Price)"::Sundry) THEN BEGIN
        "Sundry Cost Amount" := "Sundry Cost Amount" * "Cum. Adj. Factor Price";
        //"Sundry Gross Amount" := "Sundry Gross Amount" * "Cum. Adj. Factor Price";
      END;

      "Cost Amount" := "Labor Cost Amount" + "Material Cost Amount" + "Subcontracting Cost Amount" +
        "Plant Cost Amount" + "Sundry Cost Amount";
      "Sales Amount" := "Labor Sales Amount" + "Material Sales Amount" + "Subcontracting Sales Amount" +
        "Plant Sales Amount" + "Sundry Sales Amount";

      "Total Weight" := ROUND("Cumulative Quantity" * Weight);
      "Buy Back Amount" := ROUND("Cumulative Quantity" * "Buy Back Price");
    END;

    PROCEDURE GetPartDescription@1100525001() : Text[50];
    VAR
      EstimateElementRAW@1100525000 : Record 11125679;
    BEGIN
      CALCFIELDS("Part Description");
      IF ("Part Group" = '') AND ("Part Description" = '') THEN BEGIN
        EstimateElementRAW.SETCURRENTKEY("Estimate No.", "Tender Paragraph No.");
        EstimateElementRAW.SETRANGE("Estimate No.", "Estimate No.");
        EstimateElementRAW.SETRANGE("Tender Paragraph No.", Part);
        IF EstimateElementRAW.FINDFIRST THEN
          EXIT(EstimateElementRAW.Text);
      END;
      EXIT("Part Description");
    END;

    PROCEDURE UpdateSalesNorm@1100528905();
    BEGIN
      //C031706
      IF (xRec.Norm = "Norm (Sales)") OR ("Norm (Sales)" = 0) THEN BEGIN
        "Norm (Sales)" := Norm;
        IF "Norm (Sales)" <> 0 THEN
          "Production Rate (Sales)" := 1 / "Norm (Sales)"
        ELSE
          "Production Rate (Sales)" := 0;
      END;
    END;

    PROCEDURE FindLowestPriceTradeItems@1100528404(ShowCompressed@1100528403 : Boolean);
    VAR
      TempAlternativeTradeItem@1100528400 : TEMPORARY Record 11012744;
      SourceRecRef@1100528402 : RecordRef;
      QuantityCost@1100528420 : Decimal;
      QuantitySales@1100528419 : Decimal;
      HoursCost@1100528418 : Decimal;
      LaborCost@1100528417 : Decimal;
      MaterialCost@1100528416 : Decimal;
      SubcontractingCost@1100528415 : Decimal;
      PlantCost@1100528414 : Decimal;
      SundryCost@1100528413 : Decimal;
      CostAmount@1100528412 : Decimal;
      HoursSales@1100528411 : Decimal;
      LaborSales@1100528410 : Decimal;
      MaterialSales@1100528409 : Decimal;
      SubcontractingSales@1100528408 : Decimal;
      PlantSales@1100528407 : Decimal;
      SundrySales@1100528406 : Decimal;
      SalesAmount@1100528405 : Decimal;
      TotalBuyBack@1100528404 : Decimal;
      LineNo@1100528401 : Integer;
    BEGIN
      IF FINDSET THEN
        REPEAT
          LineNo := LineNo + 10000;
          IF ShowCompressed THEN
            CalculateCompressedTotals(
              QuantityCost, HoursCost, LaborCost, MaterialCost, SubcontractingCost, PlantCost, SundryCost, CostAmount, TotalBuyBack,
              QuantitySales, HoursSales, LaborSales, MaterialSales, SubcontractingSales, PlantSales, SundrySales, SalesAmount)
          ELSE BEGIN
            QuantityCost := "Cumulative Quantity";
            MaterialCost := "Material Cost Amount";
          END;
          TempAlternativeTradeItem.CreateAlternativeTradeItem(
            LineNo, "Trade Item", "Unit of Measure", "Vendor (Trade Item)", QuantityCost,
            '', "Net Cost Price", 0, MaterialCost, 0, RECORDID, ShowCompressed);
        UNTIL NEXT = 0;

      IF PAGE.RUNMODAL(PAGE::"Alternative Trade Items", TempAlternativeTradeItem) = ACTION::LookupOK THEN BEGIN
        IF TempAlternativeTradeItem.FINDSET THEN
          REPEAT
            SourceRecRef.GET(TempAlternativeTradeItem."Source Record ID");
            SourceRecRef.SETTABLE(Rec);
            IF ("Trade Item" <> TempAlternativeTradeItem."Item Code") OR
               ("Vendor (Trade Item)" <> TempAlternativeTradeItem.Vendor)
            THEN BEGIN
              VALIDATE("Trade Item", '');
              IF "Vendor (Trade Item)" <> TempAlternativeTradeItem.Vendor THEN
                VALIDATE("Original Vendor (Trade Item)", "Vendor (Trade Item)");
              VALIDATE("Vendor (Trade Item)", TempAlternativeTradeItem.Vendor);
              VALIDATE("Trade Item", TempAlternativeTradeItem."Item Code");
              MODIFY(TRUE);
              IF ShowCompressed THEN
                UpdateIntern;
            END;
          UNTIL TempAlternativeTradeItem.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE GetSubcontractorActivity@1100529901(CalledBy@1100528500 : Integer);
    VAR
      SubcontractingActivityPrice@1100529900 : Record 11229373;
      Estimate@1100525000 : Record 11012151;
    BEGIN
      //DP01492-2
      Estimate.GET("Estimate No.");
      Estimate.TESTFIELD(Fixed, FALSE);  //C041836

      TESTFIELD("Cost Type (Price)", "Cost Type (Price)"::Subcontracting);
      SubcontractingActivityPrice.SETRANGE("Subcontracting Activity", "Subcontracting Activity");
      IF CalledBy = FIELDNO("Subcontracting Activity") THEN  //DP01958a
        SubcontractingActivityPrice.SETRANGE("Preferred Subcontractor", TRUE)
      ELSE
        SubcontractingActivityPrice.SETRANGE("Subcontractor No.", Subcontractor);
      IF SubcontractingActivityPrice.FINDFIRST THEN BEGIN
        VALIDATE("Net Cost Price", SubcontractingActivityPrice.GetPrice(Estimate."Reference Date (Rate)"));
        IF CalledBy = FIELDNO("Subcontracting Activity") THEN BEGIN  //DP01958a
          SubcontractingActivityPrice.CALCFIELDS("Activity Description");
          Description := SubcontractingActivityPrice."Activity Description";
        END;
        "Unit of Measure" := SubcontractingActivityPrice."Unit of Measure";
        "Cost Object Price" := SubcontractingActivityPrice."Cost Object";
        Subcontractor := SubcontractingActivityPrice."Subcontractor No.";
      END;
    END;

    LOCAL PROCEDURE CheckRelatedApplianceType@1100528500();
    BEGIN
      //db, 14-03-19
      CASE "Appliance Type" OF
        "Appliance Type"::Item: "Appliance Code" := "Item No.";
        "Appliance Type"::TradeItem: "Appliance Code" := "Trade Item";
        "Appliance Type"::PlantType: "Appliance Code" := "Plant Type";
        "Appliance Type"::PlantSet: "Appliance Code" := "Set Code";
        "Appliance Type"::SubcontractingActivity: "Appliance Code" := "Subcontracting Activity";
        //"Appliance Type"::Recipe: "Appliance Code" := "Recipe No.";
        "Appliance Type"::RateCode: "Appliance Code" := "Rate Code";
      END;
    END;

    PROCEDURE GetDisciplineByElement@1100528920();
    VAR
      BaseElement@1100528900 : Record 11012060;
      ProjectElement@1100528901 : Record 11012010;
    BEGIN
      //DP02460
      IF Element = '' THEN EXIT;
      IF "Project No." <> '' THEN BEGIN
        IF NOT ProjectElement.GET("Project No.", Element) THEN ProjectElement.INIT;
        IF ProjectElement.Discipline <> '' THEN
          Discipline := ProjectElement.Discipline;
      END ELSE BEGIN
        IF NOT BaseElement.GET(Element) THEN BaseElement.INIT;
        IF BaseElement.Discipline <> '' THEN
          Discipline := BaseElement.Discipline;
      END;
    END;

    LOCAL PROCEDURE UpdateSalesPriceFromCostPrice@1100525026();
    BEGIN
      //C059577
      EstRec.GET("Estimate No.");
      IF EstRec."RAW Estimate" THEN EXIT;
      IF EstRec."Item Sales Price Based On" = EstRec."Item Sales Price Based On"::GrossMin THEN EXIT;

      IF "Recipe Line" = 0 THEN BEGIN
        EstLineRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line");
        IF EstLineRec."Surcharge Type" <> EstLineRec."Surcharge Type"::" " THEN EXIT;
        IF EstLineRec."Price Agreement (Sales)" THEN EXIT;
        IF EstRec."Apply SalesPrice for SurchMat" AND EstLineRec."Sales Condition Present" THEN EXIT;
      END ELSE BEGIN
        RcpLineRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
          "Recipe Group", Recipe, "Recipe Line");
        IF RcpLineRec."Surcharge Type" <> RcpLineRec."Surcharge Type"::" " THEN EXIT;
        IF RcpLineRec."Price Agreement (Sales)" THEN EXIT;
        IF EstRec."Apply SalesPrice for SurchMat" AND RcpLineRec."Sales Condition Present" THEN EXIT;
      END;

      "Sales Discount %" := 0;
      "Net Sales Price" := "Net Cost Price";
    END;

    BEGIN
    END.
  }
}

