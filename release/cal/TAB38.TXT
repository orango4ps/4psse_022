OBJECT Table 38 Purchase Header
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.05,4PS14.00,NAVSE.FI.DK.NO,4PSSE,EXF500000;
  }
  PROPERTIES
  {
    Permissions=TableData 288=r;
    DataCaptionFields=No.,Buy-from Vendor Name;
    OnInsert=VAR
               StandardCodesMgt@1000 : Codeunit 170;
             BEGIN
               InitInsert;

               IF GETFILTER("Buy-from Vendor No.") <> '' THEN
                 IF GETRANGEMIN("Buy-from Vendor No.") = GETRANGEMAX("Buy-from Vendor No.") THEN
                   VALIDATE("Buy-from Vendor No.",GETRANGEMIN("Buy-from Vendor No."));

               IF "Purchaser Code" = '' THEN BEGIN
                 SkipModify := TRUE;   //**4PS.n
                 SetDefaultPurchaser;
                 SkipModify := FALSE;   //**4PS.n
               END;

               IF "Buy-from Vendor No." <> '' THEN
                 StandardCodesMgt.CheckShowPurchRecurringLinesNotification(Rec);

               //**4PS.sn
               PurchSetup.GET;
               IF (PurchSetup."Scanning Application Purch.Inv" = PurchSetup."Scanning Application Purch.Inv"::Other) AND
                  (PurchSetup."Auto Fill Ext. Document ID" <> '') THEN
                 "Ext. Document ID" := STRSUBSTNO(PurchSetup."Auto Fill Ext. Document ID", "No.");
               IF ("Document Type" = "Document Type"::Quote) AND ("Comparison Quote" <> '') THEN
                 UpdateComparisonQuoteLinks('INSERT');
               "Input by" := USERID;
               "Input Date" := TODAY;
               IF "Document Type" = "Document Type"::Order THEN BEGIN
                 "Extra Receipts Allowed" := NOT PurchSetup."Block Extra Receipts";
                 "Purchase Order Correction" := PurchSetup."Purchase Order Correction";
               END;
               IF "ICM Status" > "ICM Status"::Manual THEN
                 IcmLicenceCu.CheckICMProcess;
               //**4PS.en

               //**4PS Generated Code. Do Not Change.sn05
               DPA_OnInsert;
               //**4PS Generated Code.en05

               ProjectSiteMgt.LogPurchaseHeader(1, Rec); //**4PS.n

               FillReferenceICM; //**4PS SR 18-01-2013
             END;

    OnModify=BEGIN
               // ExFlow ->
               IF ExFlowSetup.GET THEN
                 ExFlow.UpdateDocument(Rec);
               // <- ExFlow
               //**4PS.sn
               IF ("Document Type" = "Document Type"::Quote) AND ("Comparison Quote" <> xRec."Comparison Quote") THEN
                 UpdateComparisonQuoteLinks('MODIFY');
               "Modified by" := USERID;
               "Last Date Modified" := TODAY;
               IF "ICM Status" > "ICM Status"::Manual THEN
                 IcmLicenceCu.CheckICMProcess;
               CreateDocPhases;
               ProjectSiteMgt.LogPurchaseHeader(2, Rec);
               //**4PS.en
             END;

    OnDelete=VAR
               PostPurchDelete@1000 : Codeunit 364;
               ArchiveManagement@1001 : Codeunit 5063;
               Job@1100528300 : Record 11072003;
               DocumentPortalProject@1100528301 : Codeunit 11012948;
               PlantOrder@1100528500 : Record 11012556;
               PlantOrderLine@1100528501 : Record 11012557;
             BEGIN
               //**4PS01.sn
               IF ("Document Type" = "Document Type"::Order) THEN BEGIN
                 IF (Status <> Status::Closed) THEN
                  IF PurchLinesExist THEN
                    ERROR(Text11012010);
               END;
               IF ("Document Type" = "Document Type"::Quote) THEN BEGIN
                 IF ("Comparison Quote" = "No.") AND ("Comparison Quote" <> '') THEN
                   CheckDeleteCompQuoteAllowed();
               END;
               //**4PS01.en

               IF NOT UserSetupMgt.CheckRespCenter(1,"Responsibility Center") THEN
                 ERROR(
                   Text023,
                   RespCenter.TABLECAPTION,UserSetupMgt.GetPurchasesFilter);

               ArchiveManagement.AutoArchivePurchDocument(Rec);
               PostPurchDelete.DeleteHeader(
                 Rec,PurchRcptHeader,PurchInvHeader,PurchCrMemoHeader,
                 ReturnShptHeader,PurchInvHeaderPrepmt,PurchCrMemoHeaderPrepmt);
               VALIDATE("Applies-to ID",'');
               VALIDATE("Incoming Document Entry No.",0);

               // ExFlow ->
               IF ExFlowSetup.GET THEN
                 IF DocHead.RetrieveRecord(DocHead,"Document Type","No.") THEN
                   DocHead.DELETE(TRUE);
               // <- ExFlow
               ApprovalsMgmt.OnDeleteRecordInApprovalRequest(RECORDID);
               PurchLine.LOCKTABLE;

               WhseRequest.SETRANGE("Source Type",DATABASE::"Purchase Line");
               WhseRequest.SETRANGE("Source Subtype","Document Type");
               WhseRequest.SETRANGE("Source No.","No.");
               WhseRequest.DELETEALL(TRUE);

               PurchLine.SetDeleteHeader(TRUE); //**4PS.n
               PurchLine.SETRANGE("Document Type","Document Type");
               PurchLine.SETRANGE("Document No.","No.");
               PurchLine.SETRANGE(Type,PurchLine.Type::"Charge (Item)");
               DeletePurchaseLines;
               PurchLine.SETRANGE(Type);
               DeletePurchaseLines;
               DeleteInwardHeader;  //NAVSE

               PurchCommentLine.SETRANGE("Document Type","Document Type");
               PurchCommentLine.SETRANGE("No.","No.");
               PurchCommentLine.DELETEALL;

               //**4PS.sn
               Delete4PSAdditions;

               IF ("Document Type" = "Document Type"::Quote) AND ("Job No." <> '') AND ("Purchase Action" <> '') THEN BEGIN
                 Job.GET("Job No.");
                 IF (Job.IsJobInProjectPortal) THEN
                   DocumentPortalProject.RemoveQuoteRequest(Rec);
               END;

               ProjectSiteMgt.LogPurchaseHeader(3, Rec);

               UpdateVendorByPurchaseRequisition;

               IF ("Document Type" = "Document Type"::Order) THEN BEGIN
                 PlantOrder.SETRANGE("Purchase Order No.", "No.");
                 PlantOrder.SETRANGE(Posted, FALSE);
                 IF PlantOrder.FINDSET THEN BEGIN
                   REPEAT
                     PlantOrderLine.SETRANGE("Plant Order No.", PlantOrder."No.");
                     PlantOrderLine.SETFILTER("Purch. Order Type", '%1|%2', PlantOrderLine."Purch. Order Type"::Purchase, PlantOrderLine."Purch. Order Type"::Rent);
                     PlantOrderLine.SETRANGE("Purchase Order", "No.");
                     IF PlantOrderLine.FINDSET THEN
                       REPEAT
                         PlantOrderLine."Purchase Order" := '';
                         PlantOrderLine."Purchase Order Line No." := 0;
                         PlantOrderLine.MODIFY;
                       UNTIL PlantOrderLine.NEXT = 0;
                   UNTIL PlantOrder.NEXT = 0;

                   PlantOrder.MODIFYALL("Purchase Order No.", '');
                 END;
               END;
               //**4PS.en

               IF (PurchRcptHeader."No." <> '') OR
                  (PurchInvHeader."No." <> '') OR
                  (PurchCrMemoHeader."No." <> '') OR
                  (ReturnShptHeader."No." <> '') OR
                  (PurchInvHeaderPrepmt."No." <> '') OR
                  (PurchCrMemoHeaderPrepmt."No." <> '')
               THEN
                 IF NOT GetHideValidationDialog THEN //**4PS.n
                   MESSAGE(PostedDocsToPrintCreatedMsg);
             END;

    OnRename=BEGIN
               ERROR(Text003,TABLECAPTION);
             END;

    CaptionML=[ENU=Purchase Header;
               NOR=Bestillingshode;
               SVE=Ink”pshuvud];
    LookupPageID=Page53;
  }
  FIELDS
  {
    { 1   ;   ;Document Type       ;Option        ;CaptionML=[ENU=Document Type;
                                                              NOR=Bilagstype;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=[ENU=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order;
                                                                    NOR=Foresp›rsel,Bestilling,Faktura,Kreditnota,Rammebestilling,Bestillingsretur;
                                                                    SVE=Offert,Order,Faktura,Kreditnota,Avropsorder,Returorder];
                                                   OptionString=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order;
                                                   Description=[4PS: Raam  -> Afroep  ] }
    { 2   ;   ;Buy-from Vendor No. ;Code20        ;TableRelation=Vendor;
                                                   OnValidate=VAR
                                                                StandardCodesMgt@1000 : Codeunit 170;
                                                                PurchHeadExtensionRec@1100528500 : Record 11020398;
                                                              BEGIN
                                                                IF "No." = '' THEN
                                                                  InitRecord;
                                                                TestStatusOpen;

                                                                //**4PS.sn
                                                                GetVend("Buy-from Vendor No.");
                                                                IF NOT SkipStrategicPurchCheck AND
                                                                  StrategicPurchMgt.IsLimitedPurchaser("Document Type") AND
                                                                  NOT StrategicPurchMgt.VendorHasContract(Vend)
                                                                THEN
                                                                  ERROR(STRSUBSTNO(Text11012023,"Buy-from Vendor No."));
                                                                //**4PS.en

                                                                IF ("Buy-from Vendor No." <> xRec."Buy-from Vendor No.") AND
                                                                   (xRec."Buy-from Vendor No." <> '')
                                                                THEN BEGIN
                                                                  CheckDropShipmentLineExists;
                                                                  IF GetHideValidationDialog OR NOT GUIALLOWED THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed := CONFIRM(ConfirmChangeQst,FALSE,BuyFromVendorTxt);
                                                                  // PEB0028
                                                                  HideValidationDialog := TRUE;
                                                                  // 0028
                                                                  IF Confirmed THEN BEGIN
                                                                    IF InitFromVendor("Buy-from Vendor No.",FIELDCAPTION("Buy-from Vendor No.")) THEN
                                                                      EXIT;

                                                                    CheckReceiptInfo(PurchLine,FALSE);
                                                                    CheckPrepmtInfo(PurchLine);
                                                                    CheckReturnInfo(PurchLine,FALSE);

                                                                    PurchLine.RESET;
                                                                    //**4PS.sn
                                                                    CASE "Document Type" OF
                                                                      "Document Type"::Invoice:
                                                                        VALIDATE("Vendor Invoice No.");
                                                                      "Document Type"::"Credit Memo":
                                                                        VALIDATE("Vendor Cr. Memo No.");
                                                                    END;
                                                                    //**4PS.en
                                                                  END ELSE BEGIN
                                                                    Rec := xRec;
                                                                    EXIT;
                                                                  END;
                                                                END;

                                                                GetVend("Buy-from Vendor No.");
                                                                Vend.CheckBlockedVendOnDocs(Vend,FALSE);
                                                                //**4PS.sn
                                                                IF "Document Type" = "Document Type"::Quote THEN BEGIN
                                                                  IF Vend."Block Purchase Quote" THEN
                                                                    Vend.TESTFIELD("Block Purchase Quote", FALSE);
                                                                  IF Vend."Block Purchase Order" THEN
                                                                    MESSAGE(Text11012006, Vend."No.");
                                                                END;
                                                                IF "Document Type" = "Document Type"::Order THEN
                                                                  Vend.TESTFIELD("Block Purchase Order", FALSE);
                                                                //**4PS.en

                                                                Vend.TESTFIELD("Gen. Bus. Posting Group");
                                                                OnAfterCheckBuyFromVendor(Rec,xRec,Vend);

                                                                "Buy-from Vendor Name" := Vend.Name;
                                                                "Buy-from Vendor Name 2" := Vend."Name 2";
                                                                CopyBuyFromVendorAddressFieldsFromVendor(Vend,FALSE);
                                                                IF NOT SkipBuyFromContact THEN
                                                                  "Buy-from Contact" := Vend.Contact;
                                                                //>> ORANGO.LP CER GAP 15
                                                                "Document Sent By" := Vend."Document Sent By";
                                                                //<< ORANGO.LP CER GAP 15
                                                                //**4PS.sn
                                                                IF NOT SkipBuyFromContact THEN BEGIN
                                                                  "Buy-from Contact Person No." := '';
                                                                  UpdateEMailForPurchOrderForContactPerson;
                                                                END;
                                                                "Buy-from Phone No." := Vend."Phone No.";
                                                                "Buy-from Fax No." := Vend."Fax No.";
                                                                "E-Mail for Purch. Order" := Vend."E-Mail for Purch. Order";
                                                                //**4PS.en
                                                                "Gen. Bus. Posting Group" := Vend."Gen. Bus. Posting Group";
                                                                "VAT Bus. Posting Group" := Vend."VAT Bus. Posting Group";
                                                                "Tax Area Code" := Vend."Tax Area Code";
                                                                "Tax Liable" := Vend."Tax Liable";
                                                                "VAT Country/Region Code" := Vend."Country/Region Code";
                                                                "VAT Registration No." := Vend."VAT Registration No.";
                                                                //**4PS.sn
                                                                "Transaction Type" := Vend."Transaction Type";
                                                                "Transaction Specification" := Vend."Transaction Specification";
                                                                "Transport Method" := Vend."Transport Method";
                                                                "Entry Point" := Vend."Entry Point";
                                                                "Shipping Agent Code" := Vend."Shipping Agent Code";
                                                                "Electronic Order Type" := Vend."Electronic Order Type";

                                                                PurchHeadExtensionRec.GetPurchHeadExtension("Document Type","No.");
                                                                PurchHeadExtensionRec."Service Warranty Code" := Vend."Service Warranty Code";
                                                                PurchHeadExtensionRec.UpdatePurchHeadExtension("Document Type","No.");
                                                                //**4PS.en

                                                                VALIDATE("Country of Origin",Vend."Country/Region Code"); //**4PS.n
                                                                VALIDATE("Lead Time Calculation",Vend."Lead Time Calculation");
                                                                "Responsibility Center" := UserSetupMgt.GetRespCenter(1,Vend."Responsibility Center");
                                                                ValidateEmptySellToCustomerAndLocation;
                                                                OnAfterCopyBuyFromVendorFieldsFromVendor(Rec,Vend,xRec);

                                                                //>>NAVNO
                                                                IF VendorExtension.GET(Vend."No.") THEN BEGIN //4PSSE
                                                                  "Payment Type Code Abroad" := VendorExtension."Payment Type Code Abroad";
                                                                  "Specification (Norges Bank)" := VendorExtension."Specification (Norges Bank)";
                                                                END;
                                                                //<<NAVNO
                                                                //**4PS.sn
                                                                IF ("Buy-from Vendor No." <> xRec."Buy-from Vendor No.") THEN BEGIN
                                                                  InitIcmStatus;
                                                                  GetExpectedReceiptDate;
                                                                  CLEAR("Payment Agreement");
                                                                END;
                                                                //**4PS.en

                                                                IF "Buy-from Vendor No." = xRec."Pay-to Vendor No." THEN
                                                                  IF ReceivedPurchLinesExist OR ReturnShipmentExist THEN BEGIN
                                                                    TESTFIELD("VAT Bus. Posting Group",xRec."VAT Bus. Posting Group");
                                                                    TESTFIELD("Gen. Bus. Posting Group",xRec."Gen. Bus. Posting Group");
                                                                  END;

                                                                "Buy-from IC Partner Code" := Vend."IC Partner Code";
                                                                "Send IC Document" := ("Buy-from IC Partner Code" <> '') AND ("IC Direction" = "IC Direction"::Outgoing);

                                                                //**4PS.sn
                                                                IF NOT PurchLinesExist THEN
                                                                  "Amounts only" := Vend."Default Amounts Only Orders";  //DP00477
                                                                "VAT Prod. Posting Group" :=  Vend."VAT Prod. Posting Group";
                                                                IF VATSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group") THEN
                                                                  "Manually VAT Posting" := VATSetup.Manually;
                                                                // VALIDATE("Subcontracting Invoice",Vend."Subcontractor OLD"); //**4PS.o
                                                                //**4PS.sn
                                                                IF Vend."Subcontractor Type" = Vend."Subcontractor Type"::" " THEN
                                                                  VALIDATE("Subcontracting Invoice",FALSE)
                                                                ELSE
                                                                  VALIDATE("Subcontracting Invoice",TRUE);
                                                                //**4PS.en
                                                                IF "Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"] THEN
                                                                  IF "Subcontracting Invoice" THEN BEGIN
                                                                    IF ("Document Type" = "Document Type"::"Credit Memo") AND (PurchSetup."Credit Memo by G-Account allow") THEN
                                                                      VALIDATE("Payment Agreement", Vend."Default Payment Agreement");
                                                                    IF "Document Type" = "Document Type"::Invoice THEN
                                                                      VALIDATE("Payment Agreement", Vend."Default Payment Agreement");
                                                                  END;

                                                                FillJournalTemplate;
                                                                //**4PS.en
                                                                IF Vend."Pay-to Vendor No." <> '' THEN
                                                                  VALIDATE("Pay-to Vendor No.",Vend."Pay-to Vendor No.")
                                                                ELSE BEGIN
                                                                  IF "Buy-from Vendor No." = "Pay-to Vendor No." THEN
                                                                    SkipPayToContact := TRUE;
                                                                  VALIDATE("Pay-to Vendor No.","Buy-from Vendor No.");
                                                                  SkipPayToContact := FALSE;
                                                                END;
                                                                VALIDATE("Ship-to Project");  //**4PS.n

                                                                "Order Address Code" := '';
                                                                //**4PS.sn
                                                                GetDefaultOrderAddress;
                                                                GetOrderAddressByDepartment("Order Address Code");
                                                                //**4PS.en

                                                                CopyPayToVendorAddressFieldsFromVendor(Vend,FALSE);
                                                                IF IsCreditDocType THEN BEGIN
                                                                  "Ship-to Name" := Vend.Name;
                                                                  "Ship-to Name 2" := Vend."Name 2";
                                                                  CopyShipToVendorAddressFieldsFromVendor(Vend,TRUE);
                                                                  "Ship-to Contact" := Vend.Contact;
                                                                  "Shipment Method Code" := Vend."Shipment Method Code";
                                                                  IF Vend."Location Code" <> '' THEN
                                                                    VALIDATE("Location Code",Vend."Location Code");
                                                                END;

                                                                OnValidateBuyFromVendorNoBeforeRecreateLines(Rec,CurrFieldNo);

                                                                IF (xRec."Buy-from Vendor No." <> "Buy-from Vendor No.") OR
                                                                   (xRec."Currency Code" <> "Currency Code") OR
                                                                   (xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group") OR
                                                                   (xRec."VAT Bus. Posting Group" <> "VAT Bus. Posting Group")
                                                                THEN
                                                                  RecreatePurchLines(BuyFromVendorTxt);

                                                                IF NOT SkipBuyFromContact THEN
                                                                  UpdateBuyFromCont("Buy-from Vendor No.");
                                                                // ExFlow ->
                                                                IF ExFlowSetup.GET THEN
                                                                  BEGIN
                                                                    IF ExFlowSetup."Purchase Order" AND ("Document Type" IN ["Document Type"::Order,
                                                                                                                          "Document Type"::Quote,
                                                                                                                          "Document Type"::"Blanket Order"]) THEN
                                                                      BEGIN
                                                                        VALIDATE(Approve,TRUE);

                                                                        IF ExFlow.GetUserComp(exUserComp,USERID) THEN
                                                                          IF exUserComp."Approve Order" = exUserComp."Approve Order"::" " THEN
                                                                            VALIDATE(Approve,FALSE);

                                                                //        IF ExFlowVend.GET("No.") THEN
                                                                //          IF ExFlowVend."Approve Order"  = ExFlowVend."Approve Order"::Never THEN
                                                                //            VALIDATE(Approve,FALSE);

                                                                      END;
                                                                  END;

                                                                IF ExFlowVend.GET("No.") THEN
                                                                  "Receipt No. Mandatory" := ExFlowVend."Receipt No. Mandatory";
                                                                // <- Exflow

                                                                IF "No." <> '' THEN
                                                                  StandardCodesMgt.CheckShowPurchRecurringLinesNotification(Rec);

                                                                IF (xRec."Buy-from Vendor No." <> '') AND (xRec."Buy-from Vendor No." <> "Buy-from Vendor No.") THEN
                                                                  RecallModifyAddressNotification(GetModifyVendorAddressNotificationId);

                                                                //**4PS.sn
                                                                UpdateVATData;

                                                                "Contract Applicable" := DetermineContractApplicable(Vend);
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Buy-from Vendor No.;
                                                              NOR=Kj›p fra-leverand›rnr.;
                                                              SVE=Ink”psleverant”rsnr] }
    { 3   ;   ;No.                 ;Code20        ;TableRelation="Purchase Header".No. WHERE (Document Type=FIELD(Document Type));
                                                   OnValidate=BEGIN
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  GetPurchSetup;
                                                                  NoSeriesMgt.TestManual(GetNoSeriesCode);
                                                                  "No. Series" := '';
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr.;
                                                              SVE=Nr] }
    { 4   ;   ;Pay-to Vendor No.   ;Code20        ;TableRelation=Vendor;
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF (xRec."Pay-to Vendor No." <> "Pay-to Vendor No.") AND
                                                                   (xRec."Pay-to Vendor No." <> '')
                                                                THEN BEGIN
                                                                  IF GetHideValidationDialog OR NOT GUIALLOWED THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed := CONFIRM(ConfirmChangeQst,FALSE,PayToVendorTxt);
                                                                  IF Confirmed THEN BEGIN
                                                                    PurchLine.SETRANGE("Document Type","Document Type");
                                                                    PurchLine.SETRANGE("Document No.","No.");

                                                                    CheckReceiptInfo(PurchLine,TRUE);
                                                                    CheckPrepmtInfo(PurchLine);
                                                                    CheckReturnInfo(PurchLine,TRUE);

                                                                    PurchLine.RESET;
                                                                  END ELSE
                                                                    "Pay-to Vendor No." := xRec."Pay-to Vendor No.";
                                                                END;

                                                                GetVend("Pay-to Vendor No.");
                                                                Vend.CheckBlockedVendOnDocs(Vend,FALSE);
                                                                //**4PS.sn
                                                                IF "Document Type" = "Document Type"::Quote THEN
                                                                  IF "Pay-to Vendor No." <> "Buy-from Vendor No." THEN
                                                                    IF Vend."Block Purchase Order" THEN
                                                                      MESSAGE(Text11012006, Vend."No.");
                                                                IF "Document Type" = "Document Type"::Order THEN
                                                                  Vend.TESTFIELD("Block Purchase Order",FALSE);
                                                                //**4PS.en
                                                                Vend.TESTFIELD("Vendor Posting Group");
                                                                PostingSetupMgt.CheckVendPostingGroupPayablesAccount("Vendor Posting Group");
                                                                OnAfterCheckPayToVendor(Rec,xRec,Vend);

                                                                "Pay-to Name" := Vend.Name;
                                                                "Pay-to Name 2" := Vend."Name 2";
                                                                CopyPayToVendorAddressFieldsFromVendor(Vend,FALSE);
                                                                IF NOT SkipPayToContact THEN
                                                                  "Pay-to Contact" := Vend.Contact;
                                                                "Payment Terms Code" := Vend."Payment Terms Code";
                                                                "Prepmt. Payment Terms Code" := Vend."Payment Terms Code";

                                                                IF IsCreditDocType THEN BEGIN
                                                                  "Payment Method Code" := '';
                                                                  IF PaymentTerms.GET("Payment Terms Code") THEN
                                                                    IF PaymentTerms."Calc. Pmt. Disc. on Cr. Memos" THEN
                                                                      "Payment Method Code" := Vend."Payment Method Code"
                                                                END ELSE
                                                                  "Payment Method Code" := Vend."Payment Method Code";
                                                                // NL0001.begin

                                                                //**4PS.sn
                                                                "Transaction Mode B Payments" := Vend."Transaction Mode B Payments";
                                                                "Bank Account Code B Payments" := Vend."Bank Account Code B Payments";
                                                                IF "Document Type" IN ["Document Type"::Quote, "Document Type"::Order] THEN
                                                                  "Reminder Terms Code" := Vend."Reminder Terms Code";
                                                                //**4PS.en

                                                                IF "Buy-from Vendor No." = Vend."No." THEN
                                                                  "Shipment Method Code" := Vend."Shipment Method Code";
                                                                "Vendor Posting Group" := Vend."Vendor Posting Group";
                                                                GLSetup.GET;
                                                                IF GLSetup."Bill-to/Sell-to VAT Calc." = GLSetup."Bill-to/Sell-to VAT Calc."::"Bill-to/Pay-to No." THEN BEGIN
                                                                  "VAT Bus. Posting Group" := Vend."VAT Bus. Posting Group";
                                                                  "VAT Country/Region Code" := Vend."Country/Region Code";
                                                                  "VAT Registration No." := Vend."VAT Registration No.";
                                                                  "Gen. Bus. Posting Group" := Vend."Gen. Bus. Posting Group";
                                                                END;
                                                                "Prices Including VAT" := Vend."Prices Including VAT";
                                                                "Currency Code" := Vend."Currency Code";
                                                                "Invoice Disc. Code" := Vend."Invoice Disc. Code";
                                                                "Language Code" := Vend."Language Code";
                                                                IF Vend."Purchaser Code" <> '' THEN BEGIN //**4PS.n
                                                                  SetPurchaserCode(Vend."Purchaser Code","Purchaser Code");
                                                                //**4PS.sn
                                                                  CALCFIELDS("Name Purchaser");
                                                                END;
                                                                //**4PS.en
                                                                VALIDATE("Payment Terms Code");
                                                                VALIDATE("Prepmt. Payment Terms Code");
                                                                VALIDATE("Payment Method Code");
                                                                VALIDATE("Currency Code");
                                                                VALIDATE("Creditor No.",Vend."Creditor No.");
                                                                VALIDATE("Giro Acc. No.",Vend."Giro Acc. No.");  //NAVDK
                                                                OnValidatePurchaseHeaderPayToVendorNo(Vend,Rec);

                                                                IF "Document Type" = "Document Type"::Order THEN
                                                                  VALIDATE("Prepayment %",Vend."Prepayment %");

                                                                IF "Pay-to Vendor No." = xRec."Pay-to Vendor No." THEN BEGIN
                                                                  IF ReceivedPurchLinesExist THEN
                                                                    TESTFIELD("Currency Code",xRec."Currency Code");
                                                                END;

                                                                CreateDim(
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::Job,"Job No.", //**4PS.n
                                                                  DATABASE::"Service Order","Service Order No.",  //**4PS.n
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::Campaign,"Campaign No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n

                                                                OnValidatePaytoVendorNoBeforeRecreateLines(Rec,CurrFieldNo);

                                                                IF (xRec."Buy-from Vendor No." = "Buy-from Vendor No.") AND
                                                                   (xRec."Pay-to Vendor No." <> "Pay-to Vendor No.")
                                                                THEN
                                                                  RecreatePurchLines(PayToVendorTxt);

                                                                IF NOT SkipPayToContact THEN
                                                                  UpdatePayToCont("Pay-to Vendor No.");

                                                                "Pay-to IC Partner Code" := Vend."IC Partner Code";

                                                                IF (xRec."Pay-to Vendor No." <> '') AND (xRec."Pay-to Vendor No." <> "Pay-to Vendor No.") THEN
                                                                  RecallModifyAddressNotification(GetModifyPayToVendorAddressNotificationId);

                                                                FillJournalTemplate; //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Pay-to Vendor No.;
                                                              NOR=Betal til-levrd.nr.;
                                                              SVE=Betalningsleverant”rsnr];
                                                   NotBlank=Yes }
    { 5   ;   ;Pay-to Name         ;Text100       ;TableRelation=Vendor;
                                                   OnValidate=VAR
                                                                Vendor@1000 : Record 23;
                                                              BEGIN
                                                                IF ShouldLookForVendorByName("Pay-to Vendor No.") THEN
                                                                  VALIDATE("Pay-to Vendor No.",Vendor.GetVendorNo("Pay-to Name"));
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Pay-to Name;
                                                              NOR=Betal til-navn;
                                                              SVE=Betalningsnamn] }
    { 6   ;   ;Pay-to Name 2       ;Text50        ;CaptionML=[ENU=Pay-to Name 2;
                                                              NOR=Betal til-navn 2;
                                                              SVE=Betalningsnamn 2] }
    { 7   ;   ;Pay-to Address      ;Text100       ;OnValidate=BEGIN
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Pay-to Address;
                                                              NOR=Betal til-adresse;
                                                              SVE=Betalningsadress] }
    { 8   ;   ;Pay-to Address 2    ;Text50        ;OnValidate=BEGIN
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Pay-to Address 2;
                                                              NOR=Betal til-adresse 2;
                                                              SVE=Betalningsadress 2] }
    { 9   ;   ;Pay-to City         ;Text30        ;TableRelation=IF (Pay-to Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Pay-to Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Pay-to Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(
                                                                  "Pay-to City","Pay-to Post Code","Pay-to County","Pay-to Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   OnLookup=BEGIN
                                                              PostCode.LookupPostCode("Pay-to City","Pay-to Post Code","Pay-to County","Pay-to Country/Region Code");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Pay-to City;
                                                              NOR=Betal til-sted;
                                                              SVE=Betalningsort] }
    { 10  ;   ;Pay-to Contact      ;Text100       ;OnValidate=BEGIN
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   OnLookup=VAR
                                                              Contact@1000 : Record 5050;
                                                            BEGIN
                                                              LookupContact("Pay-to Vendor No.","Pay-to Contact No.",Contact);
                                                              IF PAGE.RUNMODAL(0,Contact) = ACTION::LookupOK THEN
                                                                VALIDATE("Pay-to Contact No.",Contact."No.");
                                                            END;

                                                   CaptionML=[ENU=Pay-to Contact;
                                                              NOR=Betal til-kontakt;
                                                              SVE=Betalningskontakt] }
    { 11  ;   ;Your Reference      ;Text35        ;CaptionML=[ENU=Your Reference;
                                                              NOR=Deres referanse;
                                                              SVE=Er referens] }
    { 12  ;   ;Ship-to Code        ;Code10        ;TableRelation="Ship-to Address".Code WHERE (Customer No.=FIELD(Sell-to Customer No.));
                                                   OnValidate=BEGIN
                                                                IF ("Document Type" = "Document Type"::Order) AND
                                                                   (xRec."Ship-to Code" <> "Ship-to Code")
                                                                THEN BEGIN
                                                                  PurchLine.SETRANGE("Document Type",PurchLine."Document Type"::Order);
                                                                  PurchLine.SETRANGE("Document No.","No.");
                                                                  PurchLine.SETFILTER("Sales Order Line No.",'<>0');
                                                                  IF NOT PurchLine.ISEMPTY THEN
                                                                    ERROR(
                                                                      YouCannotChangeFieldErr,
                                                                      FIELDCAPTION("Ship-to Code"));
                                                                END;

                                                                //**4PS.so
                                                                // IF "Ship-to Code" <> '' THEN BEGIN
                                                                //  ShipToAddr.GET("Sell-to Customer No.","Ship-to Code");
                                                                //  SetShipToAddress(
                                                                //    ShipToAddr.Name,ShipToAddr."Name 2",ShipToAddr.Address,ShipToAddr."Address 2",
                                                                //    ShipToAddr.City,ShipToAddr."Post Code",ShipToAddr.County,ShipToAddr."Country/Region Code");
                                                                //  "Ship-to Contact" := ShipToAddr.Contact;
                                                                //  "Shipment Method Code" := ShipToAddr."Shipment Method Code";
                                                                //  IF ShipToAddr."Location Code" <> '' THEN
                                                                //    VALIDATE("Location Code",ShipToAddr."Location Code");
                                                                // END ELSE BEGIN
                                                                //  TESTFIELD("Sell-to Customer No.");
                                                                //  Cust.GET("Sell-to Customer No.");
                                                                //  SetShipToAddress(
                                                                //    Cust.Name,Cust."Name 2",Cust.Address,Cust."Address 2",
                                                                //    Cust.City,Cust."Post Code",Cust.County,Cust."Country/Region Code");
                                                                //  "Ship-to Contact" := Cust.Contact;
                                                                //  "Shipment Method Code" := Cust."Shipment Method Code";
                                                                //  IF Cust."Location Code" <> '' THEN
                                                                //    VALIDATE("Location Code",Cust."Location Code");
                                                                // END;
                                                                //**4PS.eo

                                                                //**4PS.sn
                                                                UpdateDeliver(FIELDNO("Ship-to Code"));
                                                                UpdateShipToAddress;
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Ship-to Code;
                                                              NOR=Lever til-kode;
                                                              SVE=Leveransadresskod] }
    { 13  ;   ;Ship-to Name        ;Text100       ;CaptionML=[ENU=Ship-to Name;
                                                              NOR=Lever til-navn;
                                                              SVE=Leveransnamn] }
    { 14  ;   ;Ship-to Name 2      ;Text50        ;CaptionML=[ENU=Ship-to Name 2;
                                                              NOR=Lever til-navn 2;
                                                              SVE=Leveransnamn 2] }
    { 15  ;   ;Ship-to Address     ;Text100       ;CaptionML=[ENU=Ship-to Address;
                                                              NOR=Lever til-adresse;
                                                              SVE=Leveransadress] }
    { 16  ;   ;Ship-to Address 2   ;Text50        ;CaptionML=[ENU=Ship-to Address 2;
                                                              NOR=Lever til-adresse 2;
                                                              SVE=Leveransadress 2] }
    { 17  ;   ;Ship-to City        ;Text30        ;TableRelation=IF (Ship-to Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Ship-to Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Ship-to Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(
                                                                  "Ship-to City","Ship-to Post Code","Ship-to County","Ship-to Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   OnLookup=BEGIN
                                                              PostCode.LookupPostCode("Ship-to City","Ship-to Post Code","Ship-to County","Ship-to Country/Region Code");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Ship-to City;
                                                              NOR=Lever til-sted;
                                                              SVE=Leveransort] }
    { 18  ;   ;Ship-to Contact     ;Text100       ;CaptionML=[ENU=Ship-to Contact;
                                                              NOR=Lever til-kontakt;
                                                              SVE=Leveranskontaktperson] }
    { 19  ;   ;Order Date          ;Date          ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND
                                                                   NOT ("Order Date" = xRec."Order Date")
                                                                THEN
                                                                  PriceMessageIfPurchLinesExist(FIELDCAPTION("Order Date"));

                                                                UpdatePurchLinesByFieldNo(FIELDNO("Order Date"),CurrFieldNo <> 0); //**4PS.n
                                                              END;

                                                   AccessByPermission=TableData 120=R;
                                                   CaptionML=[ENU=Order Date;
                                                              NOR=Bestillingsdato;
                                                              SVE=Orderdatum] }
    { 20  ;   ;Posting Date        ;Date          ;OnValidate=VAR
                                                                SkipJobCurrFactorUpdate@1000 : Boolean;
                                                              BEGIN
                                                                TESTFIELD("Posting Date");
                                                                TestNoSeriesDate(
                                                                  "Posting No.","Posting No. Series",
                                                                  FIELDCAPTION("Posting No."),FIELDCAPTION("Posting No. Series"));
                                                                TestNoSeriesDate(
                                                                  "Prepayment No.","Prepayment No. Series",
                                                                  FIELDCAPTION("Prepayment No."),FIELDCAPTION("Prepayment No. Series"));
                                                                TestNoSeriesDate(
                                                                  "Prepmt. Cr. Memo No.","Prepmt. Cr. Memo No. Series",
                                                                  FIELDCAPTION("Prepmt. Cr. Memo No."),FIELDCAPTION("Prepmt. Cr. Memo No. Series"));

                                                                //**4PS.sn
                                                                PurchSetup.GET;
                                                                IF NOT PurchSetup."Separate Post/Document Date" THEN
                                                                //**4PS.en
                                                                  IF "Incoming Document Entry No." = 0 THEN
                                                                    VALIDATE("Document Date","Posting Date");
                                                                // ExFlow ->
                                                                IF ExFlowSetup.GET THEN BEGIN
                                                                  UpdateDocDate := TRUE;
                                                                  IF ExFlowSetup.GET THEN
                                                                    IF ExFlowSetup."Set Document Date To" <> ExFlowSetup."Set Document Date To"::"Posting Date" THEN
                                                                      UpdateDocDate := FALSE;
                                                                END;
                                                                  IF UpdateDocDate THEN
                                                                // <- ExFlow
                                                                  VALIDATE("Document Date","Posting Date");//MC-029175 n

                                                                VALIDATE("Interest Date"); //**4PS.n

                                                                IF "Currency Code" <> '' THEN BEGIN //**4PS.n
                                                                  IF ("Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"]) AND
                                                                     NOT ("Posting Date" = xRec."Posting Date")
                                                                  THEN BEGIN
                                                                    PriceMessageIfPurchLinesExist(FIELDCAPTION("Posting Date"));
                                                                    UpdateInwardHeader; //NAVSE
                                                                  END;

                                                                //IF "Currency Code" <> '' THEN BEGIN //**4PS.o
                                                                  UpdateCurrencyFactor;
                                                                  IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                    SkipJobCurrFactorUpdate := NOT ConfirmUpdateCurrencyFactor;
                                                                //END; //**4PS.o
                                                                //**4PS.sn
                                                                END ELSE
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Posting Date"),CurrFieldNo <> 0);
                                                                //**4PS.en

                                                                IF "Posting Date" <> xRec."Posting Date" THEN
                                                                  IF DeferralHeadersExist THEN
                                                                    ConfirmUpdateDeferralDate;

                                                                //**4PS.so
                                                                //IF PurchLinesExist THEN
                                                                //  JobUpdatePurchLines(SkipJobCurrFactorUpdate);
                                                                //**4PS.eo
                                                              END;

                                                   CaptionML=[ENU=Posting Date;
                                                              NOR=Bokf›ringsdato;
                                                              SVE=Bokf”ringsdatum] }
    { 21  ;   ;Expected Receipt Date;Date         ;OnValidate=BEGIN
                                                                //**4PS.sn
                                                                IF (CurrFieldNo = FIELDNO("Expected Receipt Date")) AND (Status = Status::Closed) THEN
                                                                  TestStatusOpen;
                                                                //**4PS.en

                                                                IF "Expected Receipt Date" <> 0D THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Expected Receipt Date"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Expected Receipt Date;
                                                              NOR=Forventet mottaksdato;
                                                              SVE=F”rv„ntat inleveransdatum] }
    { 22  ;   ;Posting Description ;Text100       ;CaptionML=[ENU=Posting Description;
                                                              NOR=Bokf›ringsbeskrivelse;
                                                              SVE=Bokf”ringsbeskrivning] }
    { 23  ;   ;Payment Terms Code  ;Code10        ;TableRelation="Payment Terms";
                                                   OnValidate=VAR
                                                                IsHandled@1000 : Boolean;
                                                              BEGIN
                                                                IF ("Payment Terms Code" <> '') AND ("Document Date" <> 0D) THEN BEGIN
                                                                  PaymentTerms.GET("Payment Terms Code");
                                                                  IF IsCreditDocType AND NOT PaymentTerms."Calc. Pmt. Disc. on Cr. Memos" THEN BEGIN
                                                                    VALIDATE("Due Date","Document Date");
                                                                    VALIDATE("Pmt. Discount Date",0D);
                                                                    VALIDATE("Payment Discount %",0);
                                                                    // **4PS.sn
                                                                    VALIDATE("Pmt. Discount Date 2",0D);
                                                                    VALIDATE("Payment Discount % 2",0);
                                                                    VALIDATE("Pmt. Discount Date 3",0D);
                                                                    VALIDATE("Payment Discount % 3",0);
                                                                    // **4PS.en
                                                                  END ELSE BEGIN
                                                                    IsHandled := FALSE;
                                                                    OnValidatePaymentTermsCodeOnBeforeCalcDueDate(Rec,xRec,FIELDNO("Payment Terms Code"),CurrFieldNo,IsHandled);
                                                                    IF NOT IsHandled THEN
                                                                      "Due Date" := CALCDATE(PaymentTerms."Due Date Calculation","Document Date");
                                                                    IsHandled := FALSE;
                                                                    OnValidatePaymentTermsCodeOnBeforeCalcPmtDiscDate(Rec,xRec,FIELDNO("Payment Terms Code"),CurrFieldNo,IsHandled);
                                                                    IF NOT IsHandled THEN
                                                                      "Pmt. Discount Date" := CALCDATE(PaymentTerms."Discount Date Calculation","Document Date");
                                                                    IF NOT UpdateDocumentDate THEN
                                                                      VALIDATE("Payment Discount %",PaymentTerms."Discount %");
                                                                    //**4PS.sn
                                                                    "Pmt. Discount Date 2" := CALCDATE(PaymentTerms."Discount Date Calculation 2","Document Date");
                                                                    IF NOT UpdateDocumentDate THEN
                                                                      VALIDATE("Payment Discount % 2",PaymentTerms."Discount % 2");
                                                                    "Pmt. Discount Date 3" := CALCDATE(PaymentTerms."Discount Date Calculation 3","Document Date");
                                                                    IF NOT UpdateDocumentDate THEN
                                                                      VALIDATE("Payment Discount % 3",PaymentTerms."Discount % 3");
                                                                    //**4PS.en
                                                                  END;
                                                                END ELSE BEGIN
                                                                  VALIDATE("Due Date","Document Date");
                                                                  IF NOT UpdateDocumentDate THEN BEGIN
                                                                    VALIDATE("Pmt. Discount Date",0D);
                                                                    VALIDATE("Payment Discount %",0);
                                                                    //**4PS.sn
                                                                    VALIDATE("Pmt. Discount Date 2",0D);
                                                                    VALIDATE("Payment Discount % 2",0);
                                                                    VALIDATE("Pmt. Discount Date 3",0D);
                                                                    VALIDATE("Payment Discount % 3",0);
                                                                    //**4PS.en
                                                                  END;
                                                                END;
                                                                IF xRec."Payment Terms Code" = "Prepmt. Payment Terms Code" THEN
                                                                  VALIDATE("Prepmt. Payment Terms Code","Payment Terms Code");
                                                              END;

                                                   CaptionML=[ENU=Payment Terms Code;
                                                              NOR=Betalingsbet.kode;
                                                              SVE=Betalningsvillkorskod] }
    { 24  ;   ;Due Date            ;Date          ;CaptionML=[ENU=Due Date;
                                                              NOR=Forfallsdato;
                                                              SVE=F”rfallodatum] }
    { 25  ;   ;Payment Discount %  ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT (CurrFieldNo IN [0,FIELDNO("Posting Date"),FIELDNO("Document Date")]) THEN
                                                                  TestStatusOpen;
                                                                GLSetup.GET;
                                                                IF "Payment Discount %" < GLSetup."VAT Tolerance %" THEN
                                                                  "VAT Base Discount %" := "Payment Discount %"
                                                                ELSE
                                                                  "VAT Base Discount %" := GLSetup."VAT Tolerance %";
                                                                VALIDATE("VAT Base Discount %");
                                                              END;

                                                   CaptionML=[ENU=Payment Discount %;
                                                              NOR=Kontantrabatt-%;
                                                              SVE=Kassarabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 26  ;   ;Pmt. Discount Date  ;Date          ;CaptionML=[ENU=Pmt. Discount Date;
                                                              NOR=Kont.rabattdato;
                                                              SVE=Kassarabattsdatum] }
    { 27  ;   ;Shipment Method Code;Code10        ;TableRelation="Shipment Method";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                              END;

                                                   CaptionML=[ENU=Shipment Method/Incoterm Code;
                                                              NOR=Leveringsm†tekode;
                                                              SVE=Utleveransvillkorskod] }
    { 28  ;   ;Location Code       ;Code10        ;TableRelation=Location WHERE (Use As In-Transit=CONST(No));
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;

                                                                CheckLocationBlocked("Location Code"); //**4PS.n

                                                                IF ("Location Code" <> xRec."Location Code") AND
                                                                   (xRec."Buy-from Vendor No." = "Buy-from Vendor No.")
                                                                THEN
                                                                  //MessageIfPurchLinesExist(FIELDCAPTION("Location Code")); //**4PS.o
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Location Code"),CurrFieldNo <> 0); //**4PS.n

                                                                ValidateLocationCode; //**4PS.n
                                                                UpdateShipToAddress;
                                                                UpdateInboundWhseHandlingTime;
                                                              END;

                                                   CaptionML=[ENU=Location Code;
                                                              NOR=Lokasjonskode;
                                                              SVE=Lagerst„llekod] }
    { 29  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1),
                                                                                               Blocked=CONST(No));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");

                                                                //**4PS.sn
                                                                FillJournalTemplate;
                                                                IF "Amount incl. VAT" <> 0 THEN
                                                                  CreatePurchLineRegAcc;
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 1 Code;
                                                              NOR=Snarveisdimensjon 1 - kode;
                                                              SVE=Genv„g dimension 1 kod];
                                                   CaptionClass='1,2,1' }
    { 30  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2),
                                                                                               Blocked=CONST(No),
                                                                                               Cost Type=FILTER(<Revenue));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 2 Code;
                                                              NOR=Snarveisdimensjon 2 - kode;
                                                              SVE=Genv„g dimension 2 kod];
                                                   CaptionClass='1,2,2' }
    { 31  ;   ;Vendor Posting Group;Code20        ;TableRelation="Vendor Posting Group";
                                                   CaptionML=[ENU=Vendor Posting Group;
                                                              NOR=Bokf›ringsgruppe - leverand›r;
                                                              SVE=Leverant”rsbokf”ringsmall];
                                                   Editable=No }
    { 32  ;   ;Currency Code       ;Code20        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                IF NOT (CurrFieldNo IN [0,FIELDNO("Posting Date")]) OR ("Currency Code" <> xRec."Currency Code") THEN
                                                                  TestStatusOpen;
                                                                IF (CurrFieldNo <> FIELDNO("Currency Code")) AND ("Currency Code" = xRec."Currency Code") THEN
                                                                  UpdateCurrencyFactor
                                                                ELSE
                                                                  IF "Currency Code" <> xRec."Currency Code" THEN
                                                                    UpdateCurrencyFactor
                                                                  ELSE
                                                                    IF "Currency Code" <> '' THEN BEGIN
                                                                      UpdateCurrencyFactor;
                                                                      IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                        ConfirmUpdateCurrencyFactor;
                                                                    END;

                                                                UpdateInwardHeader;  //NAVSE
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod] }
    { 33  ;   ;Currency Factor     ;Decimal       ;OnValidate=BEGIN
                                                                IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Currency Factor"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Currency Factor;
                                                              NOR=Valutafaktor;
                                                              SVE=Valutafaktor];
                                                   DecimalPlaces=0:15;
                                                   MinValue=0;
                                                   Editable=No }
    { 35  ;   ;Prices Including VAT;Boolean       ;OnValidate=VAR
                                                                PurchLine@1000 : Record 39;
                                                                Currency@1001 : Record 4;
                                                                ConfirmManagement@1006 : Codeunit 27;
                                                                RecalculatePrice@1002 : Boolean;
                                                                VatFactor@1005 : Decimal;
                                                                LineInvDiscAmt@1004 : Decimal;
                                                                InvDiscRounding@1003 : Decimal;
                                                              BEGIN
                                                                TestStatusOpen;

                                                                IF "Prices Including VAT" <> xRec."Prices Including VAT" THEN BEGIN
                                                                  PurchLine.SETRANGE("Document Type","Document Type");
                                                                  PurchLine.SETRANGE("Document No.","No.");
                                                                  PurchLine.SETFILTER("Direct Unit Cost",'<>%1',0);
                                                                  PurchLine.SETFILTER("VAT %",'<>%1',0);
                                                                  IF PurchLine.FIND('-') THEN BEGIN
                                                                    IF GetHideValidationDialog OR NOT GUIALLOWED THEN
                                                                      RecalculatePrice := TRUE
                                                                    ELSE
                                                                      RecalculatePrice :=
                                                                        ConfirmManagement.ConfirmProcess(
                                                                          STRSUBSTNO(
                                                                            Text025 +
                                                                            Text027,
                                                                            FIELDCAPTION("Prices Including VAT"),PurchLine.FIELDCAPTION("Direct Unit Cost")),
                                                                          TRUE);
                                                                    OnAfterConfirmPurchPrice(Rec,PurchLine,RecalculatePrice);
                                                                    //>>NAVNO
                                                                    GLSetup.GET;
                                                                    IF GLSetup."Norwegian Localization Active" THEN
                                                                      IF NOT RecalculatePrice THEN
                                                                        ERROR('');
                                                                    //<<NAVNO
                                                                    PurchLine.SetPurchHeader(Rec);

                                                                    IF "Currency Code" = '' THEN
                                                                      Currency.InitRoundingPrecision
                                                                    ELSE
                                                                      Currency.GET("Currency Code");

                                                                    PurchLine.FINDSET;
                                                                    REPEAT
                                                                      PurchLine.TESTFIELD("Quantity Invoiced",0);
                                                                      PurchLine.TESTFIELD("Prepmt. Amt. Inv.",0);
                                                                      IF NOT RecalculatePrice THEN BEGIN
                                                                        PurchLine."VAT Difference" := 0;
                                                                        PurchLine.UpdateAmounts;
                                                                      END ELSE BEGIN
                                                                        VatFactor := 1 + PurchLine."VAT %" / 100;
                                                                        IF VatFactor = 0 THEN
                                                                          VatFactor := 1;
                                                                        IF NOT "Prices Including VAT" THEN
                                                                          VatFactor := 1 / VatFactor;
                                                                        PurchLine."Direct Unit Cost" :=
                                                                          ROUND(PurchLine."Direct Unit Cost" * VatFactor,Currency."Unit-Amount Rounding Precision");
                                                                        PurchLine."Line Discount Amount" :=
                                                                          ROUND(
                                                                            PurchLine.Quantity * PurchLine."Direct Unit Cost" * PurchLine."Line Discount %" / 100,
                                                                            Currency."Amount Rounding Precision");
                                                                        LineInvDiscAmt := InvDiscRounding + PurchLine."Inv. Discount Amount" * VatFactor;
                                                                        PurchLine."Inv. Discount Amount" := ROUND(LineInvDiscAmt,Currency."Amount Rounding Precision");
                                                                        InvDiscRounding := LineInvDiscAmt - PurchLine."Inv. Discount Amount";
                                                                        IF "Prices Including VAT" THEN
                                                                          PurchLine."Line Amount" := PurchLine."Amount Including VAT" + PurchLine."Inv. Discount Amount"
                                                                        ELSE
                                                                          PurchLine."Line Amount" := PurchLine.Amount + PurchLine."Inv. Discount Amount";
                                                                      END;
                                                                      //**4PS.sn
                                                                      PurchLine."Modified by" := USERID;
                                                                      PurchLine."Last Date Modified" := TODAY;
                                                                      //**4PS.en
                                                                      PurchLine.MODIFY;
                                                                    UNTIL PurchLine.NEXT = 0;
                                                                  END;
                                                                  OnAfterChangePricesIncludingVAT(Rec);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Prices Including VAT;
                                                              NOR=Priser inkl. mva.;
                                                              SVE=Priser inkl. moms] }
    { 37  ;   ;Invoice Disc. Code  ;Code20        ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Invoice Disc. Code"));
                                                              END;

                                                   CaptionML=[ENU=Invoice Disc. Code;
                                                              NOR=Fakturarabattkode;
                                                              SVE=Fakturarabattkod] }
    { 41  ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   OnValidate=BEGIN
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Language Code"));
                                                              END;

                                                   CaptionML=[ENU=Language Code;
                                                              NOR=Spr†kkode;
                                                              SVE=Spr†kkod] }
    { 43  ;   ;Purchaser Code      ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   OnValidate=VAR
                                                                ApprovalEntry@1001 : Record 454;
                                                                PurchaserRec@1100485000 : Record 13;
                                                              BEGIN
                                                                ValidatePurchaserOnPurchHeader(Rec,FALSE,FALSE);

                                                                ApprovalEntry.SETRANGE("Table ID",DATABASE::"Purchase Header");
                                                                ApprovalEntry.SETRANGE("Document Type","Document Type");
                                                                ApprovalEntry.SETRANGE("Document No.","No.");
                                                                ApprovalEntry.SETFILTER(Status,'%1|%2',ApprovalEntry.Status::Created,ApprovalEntry.Status::Open);
                                                                IF NOT ApprovalEntry.ISEMPTY THEN
                                                                  ERROR(Text042,FIELDCAPTION("Purchaser Code"));

                                                                //**4PS.sn
                                                                PurchSetup.GET;
                                                                IF (PurchSetup."Reference (ICM) Based on" = PurchSetup."Reference (ICM) Based on"::Purchaser) //mg.c, 19-04-11: M24458
                                                                  AND PurchaserRec.GET("Purchaser Code") THEN BEGIN
                                                                  "Reference (ICM)" := PurchaserRec."Reference (ICM)";
                                                                  IF NOT SkipModify THEN
                                                                    MODIFY(TRUE);
                                                                END;
                                                                IF CurrFieldNo > 0 THEN
                                                                  CALCFIELDS("Name Purchaser");
                                                                //**4PS.en

                                                                IF ("Job No." = '') AND ("Service Order No." = '') THEN BEGIN  //**4PS.n
                                                                  CreateDim(
                                                                    DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                    DATABASE::Vendor,"Pay-to Vendor No.",
                                                                    DATABASE::Job,"Job No.", //**4PS.n
                                                                    DATABASE::"Service Order","Service Order No.",  //**4PS.n
                                                                    DATABASE::Campaign,"Campaign No.",
                                                                    DATABASE::"Responsibility Center","Responsibility Center");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n
                                                                END;

                                                                FillReferenceICM; //**4PS SR 18-01-2013
                                                              END;

                                                   CaptionML=[ENU=Purchaser Code;
                                                              NOR=Innkj›perkode;
                                                              SVE=Ink”parkod] }
    { 45  ;   ;Order Class         ;Code10        ;CaptionML=[ENU=Order Class;
                                                              NOR=Ordreklasse;
                                                              SVE=Orderstatistiknr] }
    { 46  ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Purch. Comment Line" WHERE (Document Type=FIELD(Document Type),
                                                                                                  No.=FIELD(No.),
                                                                                                  Document Line No.=CONST(0)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Merknad;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 47  ;   ;No. Printed         ;Integer       ;CaptionML=[ENU=No. Printed;
                                                              NOR=Antall skrevet ut;
                                                              SVE=Utskriven];
                                                   Editable=No }
    { 51  ;   ;On Hold             ;Code3         ;TableRelation="On Hold Code".Code;
                                                   OnValidate=VAR
                                                                OnHoldRec@1210190000 : Record 11012031;
                                                              BEGIN
                                                                //**4PS.n
                                                                IF OnHoldRec.GET("On Hold") THEN
                                                                  IF OnHoldRec."Default Approvement Initials" <> '' THEN
                                                                    "Approvement Initials" := OnHoldRec."Default Approvement Initials";
                                                              END;

                                                   CaptionML=[ENU=On Hold;
                                                              NOR=Avvent;
                                                              SVE=Stoppad] }
    { 52  ;   ;Applies-to Doc. Type;Option        ;CaptionML=[ENU=Applies-to Doc. Type;
                                                              NOR=Utligningsbilagstype;
                                                              SVE=Kopplas till dokumenttyp];
                                                   OptionCaptionML=[ENU=" ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund";
                                                                    NOR=" ,Betaling,Faktura,Kreditnota,Rentenota,Purring,Refusjon";
                                                                    SVE=" ,Betalning,Faktura,Kreditnota,R„ntefaktura,Betalningsp†minnelse,terbetalning"];
                                                   OptionString=[ ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund] }
    { 53  ;   ;Applies-to Doc. No. ;Code20        ;OnValidate=BEGIN
                                                                IF "Applies-to Doc. No." <> '' THEN
                                                                  TESTFIELD("Bal. Account No.",'');


                                                                IF ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") AND (xRec."Applies-to Doc. No." <> '') AND
                                                                   ("Applies-to Doc. No." <> '')
                                                                THEN BEGIN
                                                                  SetAmountToApply("Applies-to Doc. No.","Buy-from Vendor No.");
                                                                  SetAmountToApply(xRec."Applies-to Doc. No.","Buy-from Vendor No.");
                                                                END ELSE
                                                                  IF ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") AND (xRec."Applies-to Doc. No." = '') THEN
                                                                    SetAmountToApply("Applies-to Doc. No.","Buy-from Vendor No.")
                                                                  ELSE
                                                                    IF ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") AND ("Applies-to Doc. No." = '') THEN
                                                                      SetAmountToApply(xRec."Applies-to Doc. No.","Buy-from Vendor No.");
                                                              END;

                                                   OnLookup=VAR
                                                              GenJnlLine@1001 : Record 81;
                                                              GenJnlApply@1000 : Codeunit 225;
                                                              ApplyVendEntries@1002 : Page 233;
                                                            BEGIN
                                                              TESTFIELD("Bal. Account No.",'');
                                                              VendLedgEntry.SETCURRENTKEY("Vendor No.",Open,Positive,"Due Date");
                                                              VendLedgEntry.SETRANGE("Vendor No.","Pay-to Vendor No.");
                                                              VendLedgEntry.SETRANGE(Open,TRUE);
                                                              IF "Applies-to Doc. No." <> '' THEN BEGIN
                                                                VendLedgEntry.SETRANGE("Document Type","Applies-to Doc. Type");
                                                                VendLedgEntry.SETRANGE("Document No.","Applies-to Doc. No.");
                                                                IF VendLedgEntry.FINDFIRST THEN;
                                                                VendLedgEntry.SETRANGE("Document Type");
                                                                VendLedgEntry.SETRANGE("Document No.");
                                                              END ELSE
                                                                IF "Applies-to Doc. Type" <> 0 THEN BEGIN
                                                                  VendLedgEntry.SETRANGE("Document Type","Applies-to Doc. Type");
                                                                  IF VendLedgEntry.FINDFIRST THEN;
                                                                  VendLedgEntry.SETRANGE("Document Type");
                                                                END ELSE
                                                                  IF Amount <> 0 THEN BEGIN
                                                                    VendLedgEntry.SETRANGE(Positive,Amount < 0);
                                                                    IF VendLedgEntry.FINDFIRST THEN;
                                                                    VendLedgEntry.SETRANGE(Positive);
                                                                  END;
                                                              ApplyVendEntries.SetPurch(Rec,VendLedgEntry,PurchHeader.FIELDNO("Applies-to Doc. No."));
                                                              ApplyVendEntries.SETTABLEVIEW(VendLedgEntry);
                                                              ApplyVendEntries.SETRECORD(VendLedgEntry);
                                                              ApplyVendEntries.LOOKUPMODE(TRUE);
                                                              IF ApplyVendEntries.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                                ApplyVendEntries.GetVendLedgEntry(VendLedgEntry);
                                                                GenJnlApply.CheckAgainstApplnCurrency(
                                                                  "Currency Code",VendLedgEntry."Currency Code",GenJnlLine."Account Type"::Vendor,TRUE);
                                                                "Applies-to Doc. Type" := VendLedgEntry."Document Type";
                                                                "Applies-to Doc. No." := VendLedgEntry."Document No.";
                                                                OnAfterAppliesToDocNoOnLookup(Rec,VendLedgEntry);
                                                              END;
                                                              CLEAR(ApplyVendEntries);
                                                            END;

                                                   CaptionML=[ENU=Applies-to Doc. No.;
                                                              NOR=Utligningsbilagsnr.;
                                                              SVE=Kopplas till ver.nr] }
    { 55  ;   ;Bal. Account No.    ;Code20        ;TableRelation=IF (Bal. Account Type=CONST(G/L Account)) "G/L Account"
                                                                 ELSE IF (Bal. Account Type=CONST(Bank Account)) "Bank Account";
                                                   OnValidate=BEGIN
                                                                IF "Bal. Account No." <> '' THEN
                                                                  CASE "Bal. Account Type" OF
                                                                    "Bal. Account Type"::"G/L Account":
                                                                      BEGIN
                                                                        GLAcc.GET("Bal. Account No.");
                                                                        GLAcc.CheckGLAcc;
                                                                        GLAcc.TESTFIELD("Direct Posting",TRUE);
                                                                      END;
                                                                    "Bal. Account Type"::"Bank Account":
                                                                      BEGIN
                                                                        BankAcc.GET("Bal. Account No.");
                                                                        BankAcc.TESTFIELD(Blocked,FALSE);
                                                                        BankAcc.TESTFIELD("Currency Code","Currency Code");
                                                                      END;
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Bal. Account No.;
                                                              NOR=Motkontonr.;
                                                              SVE=Motkonto] }
    { 56  ;   ;Recalculate Invoice Disc.;Boolean  ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Purchase Line" WHERE (Document Type=FIELD(Document Type),
                                                                                            Document No.=FIELD(No.),
                                                                                            Recalculate Invoice Disc.=CONST(Yes)));
                                                   CaptionML=[ENU=Recalculate Invoice Disc.;
                                                              NOR=Beregn fakturarabatt p† nytt;
                                                              SVE=Ber„kna om fakturarabatt];
                                                   Editable=No }
    { 57  ;   ;Receive             ;Boolean       ;CaptionML=[ENU=Receive;
                                                              NOR=Motta;
                                                              SVE=Inleverera] }
    { 58  ;   ;Invoice             ;Boolean       ;CaptionML=[ENU=Invoice;
                                                              NOR=Faktura;
                                                              SVE=Faktura] }
    { 59  ;   ;Print Posted Documents;Boolean     ;CaptionML=[ENU=Print Posted Documents;
                                                              NOR=Skriv ut bokf›rte dokumenter;
                                                              SVE=Skriv ut bokf”rda dokument] }
    { 60  ;   ;Amount              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line".Amount WHERE (Document Type=FIELD(Document Type),
                                                                                                 Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Amount;
                                                              NOR=Bel›p;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 61  ;   ;Amount Including VAT;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amount Including VAT" WHERE (Document Type=FIELD(Document Type),
                                                                                                                 Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Amount Including VAT;
                                                              NOR=Bel›p inkl. mva.;
                                                              SVE=Belopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 62  ;   ;Receiving No.       ;Code20        ;CaptionML=[ENU=Receiving No.;
                                                              NOR=Mottaksnr.;
                                                              SVE=Inleveransnr] }
    { 63  ;   ;Posting No.         ;Code20        ;CaptionML=[ENU=Posting No.;
                                                              NOR=Bokf›ringsnr.;
                                                              SVE=Bokf”ring med nr] }
    { 64  ;   ;Last Receiving No.  ;Code20        ;TableRelation="Purch. Rcpt. Header";
                                                   CaptionML=[ENU=Last Receiving No.;
                                                              NOR=Siste mottaksnr.;
                                                              SVE=Senaste inleveransnr];
                                                   Editable=No }
    { 65  ;   ;Last Posting No.    ;Code20        ;TableRelation="Purch. Inv. Header";
                                                   CaptionML=[ENU=Last Posting No.;
                                                              NOR=Siste bokf›ringsnr.;
                                                              SVE=Senast bokf”rt med nr];
                                                   Editable=No }
    { 66  ;   ;Vendor Order No.    ;Code35        ;CaptionML=[ENU=Vendor Order No.;
                                                              NOR=Leverand›rs bestillingsnr.;
                                                              SVE=Leverant”rens ordernr] }
    { 67  ;   ;Vendor Shipment No. ;Code35        ;CaptionML=[ENU=Vendor Shipment No.;
                                                              NOR=Leverand›rs f›lgeseddelnr.;
                                                              SVE=Leverant”rens utleveransnr] }
    { 68  ;   ;Vendor Invoice No.  ;Code35        ;OnValidate=VAR
                                                                VendorLedgerEntry@1000 : Record 25;
                                                              BEGIN
                                                                IF "Vendor Invoice No." <> '' THEN
                                                                  IF FindPostedDocumentWithSameExternalDocNo(VendorLedgerEntry,"Vendor Invoice No.") THEN
                                                                    ShowExternalDocAlreadyExistNotification(VendorLedgerEntry)
                                                                  ELSE
                                                                    RecallExternalDocAlreadyExistsNotification;
                                                                //**4PS.sn
                                                                IF "Vendor Invoice No." <> '' THEN
                                                                  CheckVendorInvoiceNo("Vendor Invoice No.", FALSE, TRUE);
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Vendor Invoice No.;
                                                              NOR=Leverand›rs fakturanr.;
                                                              SVE=Leverant”rens fakturanr] }
    { 69  ;   ;Vendor Cr. Memo No. ;Code35        ;OnValidate=VAR
                                                                VendorLedgerEntry@1000 : Record 25;
                                                              BEGIN
                                                                //**4PS
                                                                IF "Vendor Cr. Memo No." <> '' THEN
                                                                  IF FindPostedDocumentWithSameExternalDocNo(VendorLedgerEntry,"Vendor Cr. Memo No.") THEN
                                                                    ShowExternalDocAlreadyExistNotification(VendorLedgerEntry)
                                                                  ELSE
                                                                    RecallExternalDocAlreadyExistsNotification;

                                                                //**4PS.sn
                                                                IF "Vendor Cr. Memo No." <> '' THEN
                                                                  CheckVendorInvoiceNo("Vendor Cr. Memo No.", TRUE, TRUE);
                                                                //**4PS.en
                                                                // PEB0010
                                                                UpdateInwardHeader;
                                                                // 0010
                                                              END;

                                                   CaptionML=[ENU=Vendor Cr. Memo No.;
                                                              NOR=Leverand›rs kreditnotanr.;
                                                              SVE=Leverant”rens kreditnotanr] }
    { 70  ;   ;VAT Registration No.;Text20        ;CaptionML=[ENU=VAT Registration No.;
                                                              NOR=Organisasjonsnr.;
                                                              SVE=Momsregistreringsnr] }
    { 72  ;   ;Sell-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=BEGIN
                                                                IF ("Document Type" = "Document Type"::Order) AND
                                                                   (xRec."Sell-to Customer No." <> "Sell-to Customer No.")
                                                                THEN BEGIN
                                                                  PurchLine.SETRANGE("Document Type",PurchLine."Document Type"::Order);
                                                                  PurchLine.SETRANGE("Document No.","No.");
                                                                  PurchLine.SETFILTER("Sales Order Line No.",'<>0');
                                                                  IF NOT PurchLine.ISEMPTY THEN
                                                                    ERROR(
                                                                      YouCannotChangeFieldErr,
                                                                      FIELDCAPTION("Sell-to Customer No."));

                                                                  PurchLine.SETRANGE("Sales Order Line No.");
                                                                  PurchLine.SETFILTER("Special Order Sales Line No.",'<>0');
                                                                  IF NOT PurchLine.ISEMPTY THEN
                                                                    ERROR(
                                                                      YouCannotChangeFieldErr,
                                                                      FIELDCAPTION("Sell-to Customer No."));
                                                                END;

                                                                IF "Sell-to Customer No." = '' THEN
                                                                  UpdateLocationCode('')
                                                                ELSE
                                                                //**4PS.sn
                                                                BEGIN
                                                                  "Ship-to Project" := '';
                                                                  "Ship-to Location" := "Sell-to Customer No.";
                                                                  IF (Deliver = Deliver::"Customer Address") OR
                                                                     ("Sell-to Customer No." <> xRec."Sell-to Customer No.")
                                                                  THEN
                                                                //**4PS.en
                                                                  VALIDATE("Ship-to Code",'');
                                                                END; //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Sell-to Customer No.;
                                                              NOR=Salg til-kundenr.;
                                                              SVE=F”rs.kundnr] }
    { 73  ;   ;Reason Code         ;Code10        ;TableRelation="Reason Code";
                                                   CaptionML=[ENU=Reason Code;
                                                              NOR=rsaksspor;
                                                              SVE=Uppf”ljningskod] }
    { 74  ;   ;Gen. Bus. Posting Group;Code20     ;TableRelation="Gen. Business Posting Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF (xRec."Buy-from Vendor No." = "Buy-from Vendor No.") AND
                                                                   (xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group")
                                                                THEN BEGIN
                                                                  IF GenBusPostingGrp.ValidateVatBusPostingGroup(GenBusPostingGrp,"Gen. Bus. Posting Group") THEN
                                                                    "VAT Bus. Posting Group" := GenBusPostingGrp."Def. VAT Bus. Posting Group";
                                                                  RecreatePurchLines(FIELDCAPTION("Gen. Bus. Posting Group"));
                                                                  UpdateInwardHeader;  //NAVSE
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Gen. Bus. Posting Group;
                                                              NOR=Bokf›ringsgruppe - firma;
                                                              SVE=Gen. r”relsebokf”ringsmall] }
    { 76  ;   ;Transaction Type    ;Code10        ;TableRelation="Transaction Type";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLinesByFieldNo(FIELDNO("Transaction Type"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Transaction Type;
                                                              NOR=Transaksjonsart;
                                                              SVE=EU transaktionstyp] }
    { 77  ;   ;Transport Method    ;Code10        ;TableRelation="Transport Method";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLinesByFieldNo(FIELDNO("Transport Method"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Transport Method;
                                                              NOR=Transportm†te;
                                                              SVE=Transports„tt] }
    { 78  ;   ;VAT Country/Region Code;Code10     ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=VAT Country/Region Code;
                                                              NOR=Lands-/omr†dekode for mva;
                                                              SVE=Momskod f”r land/region] }
    { 79  ;   ;Buy-from Vendor Name;Text100       ;TableRelation=Vendor;
                                                   OnValidate=VAR
                                                                Vendor@1000 : Record 23;
                                                              BEGIN
                                                                IF ShouldLookForVendorByName("Pay-to Vendor No.") THEN
                                                                  VALIDATE("Buy-from Vendor No.",Vendor.GetVendorNo("Buy-from Vendor Name"));
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Buy-from Vendor Name;
                                                              NOR=Kj›p fra-leverand›rnavn;
                                                              SVE=Ink”psnamn] }
    { 80  ;   ;Buy-from Vendor Name 2;Text50      ;CaptionML=[ENU=Buy-from Vendor Name 2;
                                                              NOR=Kj›p fra-leverand›rnavn 2;
                                                              SVE=Ink”psnamn 2] }
    { 81  ;   ;Buy-from Address    ;Text100       ;OnValidate=BEGIN
                                                                UpdatePayToAddressFromBuyFromAddress(FIELDNO("Pay-to Address"));
                                                                ModifyVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Buy-from Address;
                                                              NOR=Kj›p fra-adresse;
                                                              SVE=Ink”psadress] }
    { 82  ;   ;Buy-from Address 2  ;Text50        ;OnValidate=BEGIN
                                                                UpdatePayToAddressFromBuyFromAddress(FIELDNO("Pay-to Address 2"));
                                                                ModifyVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Buy-from Address 2;
                                                              NOR=Kj›p fra-adresse 2;
                                                              SVE=Ink”psadress 2] }
    { 83  ;   ;Buy-from City       ;Text30        ;TableRelation=IF (Buy-from Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Buy-from Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Buy-from Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(
                                                                  "Buy-from City","Buy-from Post Code","Buy-from County","Buy-from Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                UpdatePayToAddressFromBuyFromAddress(FIELDNO("Pay-to City"));
                                                                ModifyVendorAddress;
                                                              END;

                                                   OnLookup=BEGIN
                                                              PostCode.LookupPostCode("Buy-from City","Buy-from Post Code","Buy-from County","Buy-from Country/Region Code");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Buy-from City;
                                                              NOR=Kj›p fra-sted;
                                                              SVE=Ink”psort] }
    { 84  ;   ;Buy-from Contact    ;Text100       ;OnValidate=BEGIN
                                                                ModifyVendorAddress;
                                                              END;

                                                   OnLookup=VAR
                                                              Contact@1001 : Record 5050;
                                                            BEGIN
                                                              IF "Buy-from Vendor No." = '' THEN
                                                                EXIT;

                                                              LookupContact("Buy-from Vendor No.","Buy-from Contact No.",Contact);
                                                              IF PAGE.RUNMODAL(0,Contact) = ACTION::LookupOK THEN
                                                                VALIDATE("Buy-from Contact No.",Contact."No.");
                                                            END;

                                                   CaptionML=[ENU=Buy-from Contact;
                                                              NOR=Kj›p fra-kontakt;
                                                              SVE=Ink”pskontaktperson] }
    { 85  ;   ;Pay-to Post Code    ;Code20        ;TableRelation=IF (Pay-to Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Pay-to Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Pay-to Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(
                                                                  "Pay-to City","Pay-to Post Code","Pay-to County","Pay-to Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   OnLookup=BEGIN
                                                              PostCode.LookupPostCode("Pay-to City","Pay-to Post Code","Pay-to County","Pay-to Country/Region Code");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Pay-to Post Code;
                                                              NOR=Betal til-postnr.;
                                                              SVE=Betalas postnr] }
    { 86  ;   ;Pay-to County       ;Text30        ;OnValidate=BEGIN
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Pay-to County;
                                                              NOR=Betal til-fylke/delstat;
                                                              SVE=Betalas delstat];
                                                   CaptionClass='5,1,' + "Pay-to Country/Region Code" }
    { 87  ;   ;Pay-to Country/Region Code;Code10  ;TableRelation=Country/Region;
                                                   OnValidate=BEGIN
                                                                ModifyPayToVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Pay-to Country/Region Code;
                                                              NOR=Lands-/omr†dekode for Betal til;
                                                              SVE=Betalningslands-/regionkod] }
    { 88  ;   ;Buy-from Post Code  ;Code20        ;TableRelation=IF (Buy-from Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Buy-from Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Buy-from Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(
                                                                  "Buy-from City","Buy-from Post Code","Buy-from County","Buy-from Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                UpdatePayToAddressFromBuyFromAddress(FIELDNO("Pay-to Post Code"));
                                                                ModifyVendorAddress;
                                                              END;

                                                   OnLookup=BEGIN
                                                              PostCode.LookupPostCode("Buy-from City","Buy-from Post Code","Buy-from County","Buy-from Country/Region Code");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Buy-from Post Code;
                                                              NOR=Kj›p fra-postnr.;
                                                              SVE=Leverant”rspostnr] }
    { 89  ;   ;Buy-from County     ;Text30        ;OnValidate=BEGIN
                                                                UpdatePayToAddressFromBuyFromAddress(FIELDNO("Pay-to County"));
                                                                ModifyVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Buy-from County;
                                                              NOR=Kj›p fra-fylke/delstat;
                                                              SVE=Leverant”rsdelstat];
                                                   CaptionClass='5,1,' + "Buy-from Country/Region Code" }
    { 90  ;   ;Buy-from Country/Region Code;Code10;TableRelation=Country/Region;
                                                   OnValidate=BEGIN
                                                                UpdatePayToAddressFromBuyFromAddress(FIELDNO("Pay-to Country/Region Code"));
                                                                ModifyVendorAddress;
                                                              END;

                                                   CaptionML=[ENU=Buy-from Country/Region Code;
                                                              NOR=Lands-/omr†dekode for Kj›p fra;
                                                              SVE=Ink”pslands-/regionkod] }
    { 91  ;   ;Ship-to Post Code   ;Code20        ;TableRelation=IF (Ship-to Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Ship-to Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Ship-to Country/Region Code));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(
                                                                  "Ship-to City","Ship-to Post Code","Ship-to County","Ship-to Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   OnLookup=BEGIN
                                                              PostCode.LookupPostCode("Ship-to City","Ship-to Post Code","Ship-to County","Ship-to Country/Region Code");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Ship-to Post Code;
                                                              NOR=Lever til-postnr.;
                                                              SVE=Leveranspostnrkod] }
    { 92  ;   ;Ship-to County      ;Text30        ;CaptionML=[ENU=Ship-to County;
                                                              NOR=Lever til-fylke/delstat;
                                                              SVE=Leveransdelstat];
                                                   CaptionClass='5,1,' + "Ship-to Country/Region Code" }
    { 93  ;   ;Ship-to Country/Region Code;Code10 ;TableRelation=Country/Region;
                                                   OnValidate=BEGIN
                                                                VALIDATE("Country of Destination","Ship-to Country/Region Code"); //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Ship-to Country/Region Code;
                                                              NOR=Lands-/omr†dekode for Lever til;
                                                              SVE=Kod f”r leveransland/-region] }
    { 94  ;   ;Bal. Account Type   ;Option        ;CaptionML=[ENU=Bal. Account Type;
                                                              NOR=Motkontotype;
                                                              SVE=Motkontotyp];
                                                   OptionCaptionML=[ENU=G/L Account,Bank Account;
                                                                    NOR=Finanskonto,Bankkonto;
                                                                    SVE=Redov.konto,Bankkonto];
                                                   OptionString=G/L Account,Bank Account }
    { 95  ;   ;Order Address Code  ;Code10        ;TableRelation="Order Address".Code WHERE (Vendor No.=FIELD(Buy-from Vendor No.));
                                                   OnValidate=BEGIN
                                                                IF "Order Address Code" <> '' THEN BEGIN
                                                                  OrderAddr.GET("Buy-from Vendor No.","Order Address Code");
                                                                  "Buy-from Vendor Name" := OrderAddr.Name;
                                                                  "Buy-from Vendor Name 2" := OrderAddr."Name 2";
                                                                  "Buy-from Address" := OrderAddr.Address;
                                                                  "Buy-from Address 2" := OrderAddr."Address 2";
                                                                  "Buy-from City" := OrderAddr.City;
                                                                  "Buy-from Contact" := OrderAddr.Contact;
                                                                  "Buy-from Contact Person No." := ''; //**4PS.n
                                                                  "E-Mail for Purch. Order" := OrderAddr."E-Mail for Purch. Order"; //**4PS.n
                                                                  UpdateEMailForPurchOrderForContactPerson; //**4PS.n
                                                                  "Buy-from Post Code" := OrderAddr."Post Code";
                                                                  "Buy-from County" := OrderAddr.County;
                                                                  "Buy-from Country/Region Code" := OrderAddr."Country/Region Code";
                                                                  VALIDATE("Country of Origin","Buy-from Country/Region Code");   //**4PS05.n
                                                                  "Buy-from Phone No." := OrderAddr."Phone No.";  //**4PS.n
                                                                  "Buy-from Fax No." := OrderAddr."Fax No.";  //**4PS.n

                                                                  IF IsCreditDocType THEN BEGIN
                                                                    SetShipToAddress(
                                                                      OrderAddr.Name,OrderAddr."Name 2",OrderAddr.Address,OrderAddr."Address 2",
                                                                      OrderAddr.City,OrderAddr."Post Code",OrderAddr.County,OrderAddr."Country/Region Code");
                                                                    "Ship-to Contact" := OrderAddr.Contact;
                                                                    UpdateVATData(); //**4PS05.n
                                                                  END;
                                                                END ELSE BEGIN
                                                                  GetVend("Buy-from Vendor No.");
                                                                  "Buy-from Vendor Name" := Vend.Name;
                                                                  "Buy-from Vendor Name 2" := Vend."Name 2";
                                                                  CopyBuyFromVendorAddressFieldsFromVendor(Vend,TRUE);

                                                                  IF IsCreditDocType THEN BEGIN
                                                                    "Ship-to Name" := Vend.Name;
                                                                    "Ship-to Name 2" := Vend."Name 2";
                                                                    CopyShipToVendorAddressFieldsFromVendor(Vend,TRUE);
                                                                    "Ship-to Contact" := Vend.Contact;
                                                                    "Shipment Method Code" := Vend."Shipment Method Code";
                                                                    IF Vend."Location Code" <> '' THEN
                                                                      VALIDATE("Location Code",Vend."Location Code");
                                                                    UpdateVATData(); //**4PS05.n
                                                                  END
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Order Address Code;
                                                              NOR=Bestillingsadressekode;
                                                              SVE=Ink”psadresskod] }
    { 97  ;   ;Entry Point         ;Code10        ;TableRelation="Entry/Exit Point";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLinesByFieldNo(FIELDNO("Entry Point"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Entry Point;
                                                              NOR=Innpunkt;
                                                              SVE=Inskeppningshamn] }
    { 98  ;   ;Correction          ;Boolean       ;CaptionML=[ENU=Correction;
                                                              NOR=Korreksjon;
                                                              SVE=R„ttningstransaktion] }
    { 99  ;   ;Document Date       ;Date          ;OnValidate=BEGIN
                                                                IF xRec."Document Date" <> "Document Date" THEN
                                                                  UpdateDocumentDate := TRUE;
                                                                VALIDATE("Payment Terms Code");
                                                                VALIDATE("Prepmt. Payment Terms Code");
                                                              END;

                                                   CaptionML=[ENU=Document Date;
                                                              NOR=Bilagsdato;
                                                              SVE=Dokumentdatum] }
    { 101 ;   ;Area                ;Code10        ;TableRelation=Area;
                                                   OnValidate=BEGIN
                                                                UpdatePurchLinesByFieldNo(FIELDNO(Area),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Area;
                                                              NOR=Omr†de;
                                                              SVE=Omr†de] }
    { 102 ;   ;Transaction Specification;Code10   ;TableRelation="Transaction Specification";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLinesByFieldNo(FIELDNO("Transaction Specification"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Transaction Specification;
                                                              NOR=Transaksjonsspesifikasjon;
                                                              SVE=EU transaktionsspecifikation] }
    { 104 ;   ;Payment Method Code ;Code10        ;TableRelation="Payment Method";
                                                   OnValidate=BEGIN
                                                                PaymentMethod.INIT;
                                                                IF "Payment Method Code" <> '' THEN
                                                                  PaymentMethod.GET("Payment Method Code");

                                                                //>>NAVDK
                                                                IF GLSetup."Danish Localization Active" THEN BEGIN
                                                                  IF PaymentMethod.GET("Payment Method Code") THEN
                                                                    IF PaymentMethod."Payment Type Validation" IN [PaymentMethod."Payment Type Validation"::"FIK 01",PaymentMethod."Payment Type Validation"::"FIK 73"] THEN
                                                                      "Payment Reference" := '';
                                                                END;
                                                                //<<NAVDK

                                                                "Bal. Account Type" := PaymentMethod."Bal. Account Type";
                                                                "Bal. Account No." := PaymentMethod."Bal. Account No.";
                                                                IF "Bal. Account No." <> '' THEN BEGIN
                                                                  TESTFIELD("Applies-to Doc. No.",'');
                                                                  TESTFIELD("Applies-to ID",'');
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Payment Method Code;
                                                              NOR=Betalingsm†te - kode;
                                                              SVE=Betalningss„tt] }
    { 107 ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr.serie;
                                                              SVE=Nr-serie];
                                                   Editable=No }
    { 108 ;   ;Posting No. Series  ;Code20        ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                IF "Posting No. Series" <> '' THEN BEGIN
                                                                  GetPurchSetup;
                                                                  TestNoSeries;
                                                                  NoSeriesMgt.TestSeries(GetPostingNoSeriesCode,"Posting No. Series");
                                                                END;
                                                                TESTFIELD("Posting No.",'');
                                                              END;

                                                   OnLookup=BEGIN
                                                              WITH PurchHeader DO BEGIN
                                                                PurchHeader := Rec;
                                                                GetPurchSetup;
                                                                TestNoSeries;
                                                                IF NoSeriesMgt.LookupSeries(GetPostingNoSeriesCode,"Posting No. Series") THEN
                                                                  VALIDATE("Posting No. Series");
                                                                Rec := PurchHeader;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Posting No. Series;
                                                              NOR=Bokf›ringsnr.serie;
                                                              SVE=Bokf”ringsnr-serie] }
    { 109 ;   ;Receiving No. Series;Code20        ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                IF "Receiving No. Series" <> '' THEN BEGIN
                                                                  GetPurchSetup;
                                                                  PurchSetup.TESTFIELD("Posted Receipt Nos.");
                                                                  NoSeriesMgt.TestSeries(PurchSetup."Posted Receipt Nos.","Receiving No. Series");
                                                                END;
                                                                TESTFIELD("Receiving No.",'');
                                                              END;

                                                   OnLookup=BEGIN
                                                              WITH PurchHeader DO BEGIN
                                                                PurchHeader := Rec;
                                                                GetPurchSetup;
                                                                PurchSetup.TESTFIELD("Posted Receipt Nos.");
                                                                IF NoSeriesMgt.LookupSeries(PurchSetup."Posted Receipt Nos.","Receiving No. Series") THEN
                                                                  VALIDATE("Receiving No. Series");
                                                                Rec := PurchHeader;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Receiving No. Series;
                                                              NOR=Mottaksnr.serie;
                                                              SVE=Inleverans nr-serie] }
    { 114 ;   ;Tax Area Code       ;Code20        ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Tax Area Code"));
                                                              END;

                                                   CaptionML=[ENU=Tax Area Code;
                                                              NOR=Mva-omr†dekode;
                                                              SVE=Skatteomr†deskod] }
    { 115 ;   ;Tax Liable          ;Boolean       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Tax Liable"));
                                                              END;

                                                   CaptionML=[ENU=Tax Liable;
                                                              NOR=Skyldig mva.;
                                                              SVE=Skattepliktig] }
    { 116 ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF (xRec."Buy-from Vendor No." = "Buy-from Vendor No.") AND
                                                                   (xRec."VAT Bus. Posting Group" <> "VAT Bus. Posting Group")
                                                                THEN BEGIN
                                                                  RecreatePurchLines(FIELDCAPTION("VAT Bus. Posting Group"));
                                                                  UpdateInwardHeader;  //NAVSE
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              NOR=Mva-bokf›ringsgruppe - firma;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 118 ;   ;Applies-to ID       ;Code50        ;OnValidate=VAR
                                                                TempVendLedgEntry@1000 : TEMPORARY Record 25;
                                                                VendEntrySetApplID@1001 : Codeunit 111;
                                                              BEGIN
                                                                IF "Applies-to ID" <> '' THEN
                                                                  TESTFIELD("Bal. Account No.",'');
                                                                IF ("Applies-to ID" <> xRec."Applies-to ID") AND (xRec."Applies-to ID" <> '') THEN BEGIN
                                                                  VendLedgEntry.SETCURRENTKEY("Vendor No.",Open);
                                                                  VendLedgEntry.SETRANGE("Vendor No.","Pay-to Vendor No.");
                                                                  VendLedgEntry.SETRANGE(Open,TRUE);
                                                                  VendLedgEntry.SETRANGE("Applies-to ID",xRec."Applies-to ID");
                                                                  IF VendLedgEntry.FINDFIRST THEN
                                                                    VendEntrySetApplID.SetApplId(VendLedgEntry,TempVendLedgEntry,'');
                                                                  VendLedgEntry.RESET;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Applies-to ID;
                                                              NOR=Utlignings-ID;
                                                              SVE=Koppla till ID] }
    { 119 ;   ;VAT Base Discount % ;Decimal       ;OnValidate=BEGIN
                                                                GLSetup.GET;
                                                                IF "VAT Base Discount %" > GLSetup."VAT Tolerance %" THEN BEGIN
                                                                  IF GetHideValidationDialog OR NOT GUIALLOWED THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed :=
                                                                      CONFIRM(
                                                                        Text007 +
                                                                        Text008,FALSE,
                                                                        FIELDCAPTION("VAT Base Discount %"),
                                                                        GLSetup.FIELDCAPTION("VAT Tolerance %"),
                                                                        GLSetup.TABLECAPTION);
                                                                  IF NOT Confirmed THEN
                                                                    "VAT Base Discount %" := xRec."VAT Base Discount %";
                                                                END;

                                                                IF ("VAT Base Discount %" = xRec."VAT Base Discount %") AND
                                                                   (CurrFieldNo <> 0)
                                                                THEN
                                                                  EXIT;

                                                                PurchLine.SETRANGE("Document Type","Document Type");
                                                                PurchLine.SETRANGE("Document No.","No.");
                                                                PurchLine.SETFILTER(Type,'<>%1',PurchLine.Type::" ");
                                                                PurchLine.SETFILTER(Quantity,'<>0');
                                                                PurchLine.LOCKTABLE;
                                                                IF PurchLine.FINDSET THEN BEGIN
                                                                  //**4PS.sn
                                                                  //MODIFY;
                                                                  MODIFY(TRUE);
                                                                  //**4PS.en
                                                                  REPEAT
                                                                    PurchLine.UpdateAmounts;
                                                                    //**4PS.sn
                                                                    PurchLine."Modified by" := USERID; //DP00469
                                                                    PurchLine."Last Date Modified" := TODAY;//DP00469
                                                                    //**4PS.en
                                                                    PurchLine.MODIFY;
                                                                  UNTIL PurchLine.NEXT = 0;
                                                                END;
                                                                PurchLine.RESET;
                                                              END;

                                                   CaptionML=[ENU=VAT Base Discount %;
                                                              NOR=Mva-gr.lagsrabatt-%;
                                                              SVE=Nettobelopprabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 120 ;   ;Status              ;Option        ;OnValidate=BEGIN
                                                                CALCFIELDS("Order Approval Entry Present");
                                                              END;

                                                   CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=[ENU=Open,Released,Pending Approval,Pending Prepayment,,,,,Closed;
                                                                    NOR=pen,Frigitt,Venter p† godkjenning,Venter p† forskudd;
                                                                    SVE=™ppen,Sl„ppt,V„ntar p† godk„nnande,V„ntar p† f”rskottsbetalning,,,,,St„ngd];
                                                   OptionString=Open,Released,Pending Approval,Pending Prepayment,,,,,Closed;
                                                   Description=4PS Status::Closed added;
                                                   Editable=No }
    { 121 ;   ;Invoice Discount Calculation;Option;CaptionML=[ENU=Invoice Discount Calculation;
                                                              NOR=Fakturarabattberegning;
                                                              SVE=Fakturarabattber„kning];
                                                   OptionCaptionML=[ENU=None,%,Amount;
                                                                    NOR=Ingen,%,Bel›p;
                                                                    SVE=Ingen,%,Belopp];
                                                   OptionString=None,%,Amount;
                                                   Editable=No }
    { 122 ;   ;Invoice Discount Value;Decimal     ;CaptionML=[ENU=Invoice Discount Value;
                                                              NOR=Fakturarabattverdi;
                                                              SVE=Fakturarabattv„rde];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 123 ;   ;Send IC Document    ;Boolean       ;OnValidate=BEGIN
                                                                IF "Send IC Document" THEN BEGIN
                                                                  TESTFIELD("Buy-from IC Partner Code");
                                                                  TESTFIELD("IC Direction","IC Direction"::Outgoing);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Send IC Document;
                                                              NOR=Send KI-dokument;
                                                              SVE=Skicka konc.int. dokument] }
    { 124 ;   ;IC Status           ;Option        ;CaptionML=[ENU=IC Status;
                                                              NOR=KI-status;
                                                              SVE=Konc.int. status];
                                                   OptionCaptionML=[ENU=New,Pending,Sent;
                                                                    NOR=Ny,I k›,Sendt;
                                                                    SVE=Ny,V„ntar,Skickad];
                                                   OptionString=New,Pending,Sent }
    { 125 ;   ;Buy-from IC Partner Code;Code20    ;TableRelation="IC Partner";
                                                   CaptionML=[ENU=Buy-from IC Partner Code;
                                                              NOR=KI-partnerkode for Kj›p fra;
                                                              SVE=Konc.int. partnerkod f”r ink”p];
                                                   Editable=No }
    { 126 ;   ;Pay-to IC Partner Code;Code20      ;TableRelation="IC Partner";
                                                   CaptionML=[ENU=Pay-to IC Partner Code;
                                                              NOR=KI-partnerkode for Betal til;
                                                              SVE=Konc.int. partnerkod f”r bet.];
                                                   Editable=No }
    { 129 ;   ;IC Direction        ;Option        ;OnValidate=BEGIN
                                                                IF "IC Direction" = "IC Direction"::Incoming THEN
                                                                  "Send IC Document" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=IC Direction;
                                                              NOR=KI-retning;
                                                              SVE=Konc.int. riktning];
                                                   OptionCaptionML=[ENU=Outgoing,Incoming;
                                                                    NOR=Utg†ende,Inng†ende;
                                                                    SVE=Utg†ende,Ing†ende];
                                                   OptionString=Outgoing,Incoming }
    { 130 ;   ;Prepayment No.      ;Code20        ;CaptionML=[ENU=Prepayment No.;
                                                              NOR=Forskuddsnummer;
                                                              SVE=Nr f”r f”rskottsbetalning] }
    { 131 ;   ;Last Prepayment No. ;Code20        ;TableRelation="Purch. Inv. Header";
                                                   CaptionML=[ENU=Last Prepayment No.;
                                                              NOR=Siste forskuddsnummer;
                                                              SVE=Nr f”r senaste f”rskottsbetalning] }
    { 132 ;   ;Prepmt. Cr. Memo No.;Code20        ;CaptionML=[ENU=Prepmt. Cr. Memo No.;
                                                              NOR=Kreditnotanummer for forskudd;
                                                              SVE=Kreditnotanr f”r f”rbet.] }
    { 133 ;   ;Last Prepmt. Cr. Memo No.;Code20   ;TableRelation="Purch. Cr. Memo Hdr.";
                                                   CaptionML=[ENU=Last Prepmt. Cr. Memo No.;
                                                              NOR=Siste kreditnotanummer for forskudd;
                                                              SVE=Kreditnotanr f”r senaste f”rbet.] }
    { 134 ;   ;Prepayment %        ;Decimal       ;OnValidate=BEGIN
                                                                IF xRec."Prepayment %" <> "Prepayment %" THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Prepayment %"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Prepayment %;
                                                              NOR=Forskuddsprosent;
                                                              SVE=F”rskottsbetalning %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 135 ;   ;Prepayment No. Series;Code20       ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                IF "Prepayment No. Series" <> '' THEN BEGIN
                                                                  GetPurchSetup;
                                                                  PurchSetup.TESTFIELD("Posted Prepmt. Inv. Nos.");
                                                                  NoSeriesMgt.TestSeries(GetPostingPrepaymentNoSeriesCode,"Prepayment No. Series");
                                                                END;
                                                                TESTFIELD("Prepayment No.",'');
                                                              END;

                                                   OnLookup=BEGIN
                                                              WITH PurchHeader DO BEGIN
                                                                PurchHeader := Rec;
                                                                GetPurchSetup;
                                                                PurchSetup.TESTFIELD("Posted Prepmt. Inv. Nos.");
                                                                IF NoSeriesMgt.LookupSeries(GetPostingPrepaymentNoSeriesCode,"Prepayment No. Series") THEN
                                                                  VALIDATE("Prepayment No. Series");
                                                                Rec := PurchHeader;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Prepayment No. Series;
                                                              NOR=Nummerserie for forskudd;
                                                              SVE=Nummerserie f”r f”rskottsbet.] }
    { 136 ;   ;Compress Prepayment ;Boolean       ;InitValue=Yes;
                                                   CaptionML=[ENU=Compress Prepayment;
                                                              NOR=Komprimer forskudd;
                                                              SVE=Komprimera f”rskottsbetalning] }
    { 137 ;   ;Prepayment Due Date ;Date          ;CaptionML=[ENU=Prepayment Due Date;
                                                              NOR=Forfallsdato for forskudd;
                                                              SVE=F”rfallodatum f”r f”rskottsbet.] }
    { 138 ;   ;Prepmt. Cr. Memo No. Series;Code20 ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                IF "Prepmt. Cr. Memo No. Series" <> '' THEN BEGIN
                                                                  GetPurchSetup;
                                                                  PurchSetup.TESTFIELD("Posted Prepmt. Cr. Memo Nos.");
                                                                  NoSeriesMgt.TestSeries(GetPostingPrepaymentNoSeriesCode,"Prepmt. Cr. Memo No. Series");
                                                                END;
                                                                TESTFIELD("Prepmt. Cr. Memo No.",'');
                                                              END;

                                                   OnLookup=BEGIN
                                                              WITH PurchHeader DO BEGIN
                                                                PurchHeader := Rec;
                                                                GetPurchSetup;
                                                                PurchSetup.TESTFIELD("Posted Prepmt. Cr. Memo Nos.");
                                                                IF NoSeriesMgt.LookupSeries(GetPostingPrepaymentNoSeriesCode,"Prepmt. Cr. Memo No. Series") THEN
                                                                  VALIDATE("Prepmt. Cr. Memo No. Series");
                                                                Rec := PurchHeader;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Prepmt. Cr. Memo No. Series;
                                                              NOR=Nummerserie for kreditnota for forskudd;
                                                              SVE=Nr-serie f”r kreditnota f”r f”rbet.] }
    { 139 ;   ;Prepmt. Posting Description;Text100;CaptionML=[ENU=Prepmt. Posting Description;
                                                              NOR=Beskrivelse av bokf›ring av forskudd;
                                                              SVE=F”rskottsbet: bokf”ringsbeskr.] }
    { 142 ;   ;Prepmt. Pmt. Discount Date;Date    ;CaptionML=[ENU=Prepmt. Pmt. Discount Date;
                                                              NOR=Rabattdato for betaling for forskudd;
                                                              SVE=Betalningsrabattdatum f”r f”rskottsbetalning] }
    { 143 ;   ;Prepmt. Payment Terms Code;Code10  ;TableRelation="Payment Terms";
                                                   OnValidate=VAR
                                                                PaymentTerms@1000 : Record 3;
                                                                IsHandled@1001 : Boolean;
                                                              BEGIN
                                                                IF ("Prepmt. Payment Terms Code" <> '') AND ("Document Date" <> 0D) THEN BEGIN
                                                                  PaymentTerms.GET("Prepmt. Payment Terms Code");
                                                                  IF IsCreditDocType AND NOT PaymentTerms."Calc. Pmt. Disc. on Cr. Memos" THEN BEGIN
                                                                    VALIDATE("Prepayment Due Date","Document Date");
                                                                    VALIDATE("Prepmt. Pmt. Discount Date",0D);
                                                                    VALIDATE("Prepmt. Payment Discount %",0);
                                                                  END ELSE BEGIN
                                                                    IsHandled := FALSE;
                                                                    OnValidatePaymentTermsCodeOnBeforeCalcDueDate(Rec,xRec,FIELDNO("Prepmt. Payment Terms Code"),CurrFieldNo,IsHandled);
                                                                    IF NOT IsHandled THEN
                                                                      "Prepayment Due Date" := CALCDATE(PaymentTerms."Due Date Calculation","Document Date");
                                                                    IsHandled := FALSE;
                                                                    OnValidatePaymentTermsCodeOnBeforeCalcPmtDiscDate(Rec,xRec,FIELDNO("Prepmt. Payment Terms Code"),CurrFieldNo,IsHandled);
                                                                    IF NOT IsHandled THEN
                                                                      "Prepmt. Pmt. Discount Date" := CALCDATE(PaymentTerms."Discount Date Calculation","Document Date");
                                                                    IF NOT UpdateDocumentDate THEN
                                                                      VALIDATE("Prepmt. Payment Discount %",PaymentTerms."Discount %")
                                                                  END;
                                                                END ELSE BEGIN
                                                                  VALIDATE("Prepayment Due Date","Document Date");
                                                                  IF NOT UpdateDocumentDate THEN BEGIN
                                                                    VALIDATE("Prepmt. Pmt. Discount Date",0D);
                                                                    VALIDATE("Prepmt. Payment Discount %",0);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Prepmt. Payment Terms Code;
                                                              NOR=Kode for betalingsbetingelser for forskudd;
                                                              SVE=Betalningsvillkorskod f”r f”rskottsbetalning] }
    { 144 ;   ;Prepmt. Payment Discount %;Decimal ;OnValidate=BEGIN
                                                                IF NOT (CurrFieldNo IN [0,FIELDNO("Posting Date"),FIELDNO("Document Date")]) THEN
                                                                  TestStatusOpen;
                                                                GLSetup.GET;
                                                                IF "Payment Discount %" < GLSetup."VAT Tolerance %" THEN
                                                                  "VAT Base Discount %" := "Payment Discount %"
                                                                ELSE
                                                                  "VAT Base Discount %" := GLSetup."VAT Tolerance %";
                                                                VALIDATE("VAT Base Discount %");
                                                              END;

                                                   CaptionML=[ENU=Prepmt. Payment Discount %;
                                                              NOR=Rabattprosent for betaling for forskudd;
                                                              SVE=Kassarabatter i % f”r f”rskottsbetalning];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 151 ;   ;Quote No.           ;Code20        ;CaptionML=[ENU=Quote No.;
                                                              NOR=Foresp›rselsnr.;
                                                              SVE=Offertnr];
                                                   Editable=No }
    { 160 ;   ;Job Queue Status    ;Option        ;OnLookup=VAR
                                                              JobQueueEntry@1000 : Record 472;
                                                            BEGIN
                                                              IF "Job Queue Status" = "Job Queue Status"::" " THEN
                                                                EXIT;
                                                              JobQueueEntry.ShowStatusMsg("Job Queue Entry ID");
                                                            END;

                                                   CaptionML=[ENU=Job Queue Status;
                                                              NOR=Jobbk›status;
                                                              SVE=Status f”r jobbk”];
                                                   OptionCaptionML=[ENU=" ,Scheduled for Posting,Error,Posting";
                                                                    NOR=" ,Planlagt for bokf›ring,Feil,Bokf›ring";
                                                                    SVE=" ,Planerat f”r bokf”ring,Fel,Bokf”ring"];
                                                   OptionString=[ ,Scheduled for Posting,Error,Posting];
                                                   Editable=No }
    { 161 ;   ;Job Queue Entry ID  ;GUID          ;CaptionML=[ENU=Job Queue Entry ID;
                                                              NOR=Post-ID for jobbk›;
                                                              SVE=Transaktions-ID f”r jobbk”];
                                                   Editable=No }
    { 165 ;   ;Incoming Document Entry No.;Integer;TableRelation="Incoming Document";
                                                   OnValidate=VAR
                                                                IncomingDocument@1000 : Record 130;
                                                              BEGIN
                                                                IF "Incoming Document Entry No." = xRec."Incoming Document Entry No." THEN
                                                                  EXIT;
                                                                IF "Incoming Document Entry No." = 0 THEN
                                                                  IncomingDocument.RemoveReferenceToWorkingDocument(xRec."Incoming Document Entry No.")
                                                                ELSE
                                                                  IncomingDocument.SetPurchDoc(Rec);
                                                              END;

                                                   CaptionML=[ENU=Incoming Document Entry No.;
                                                              NOR=L›penummer for inng†ende dokument;
                                                              SVE=L”pnr f”r inkommande dokument] }
    { 170 ;   ;Creditor No.        ;Code20        ;OnValidate=BEGIN
                                                                //NAVDK
                                                                GLSetup.GET;
                                                                IF GLSetup."Danish Localization Active" AND ("Creditor No." <> '') THEN
                                                                  "Creditor No." := PADSTR('',MAXSTRLEN("Creditor No.") - STRLEN("Creditor No."),'0') + "Creditor No.";
                                                              END;

                                                   CaptionML=[ENU=Creditor No.;
                                                              NOR=Kreditornr.;
                                                              SVE=Fordrings„garenr.] }
    { 171 ;   ;Payment Reference   ;Code50        ;OnValidate=VAR
                                                                PaymentMethod@1060000 : Record 289;
                                                                FIKManagement@1060001 : Codeunit 11128589;
                                                              BEGIN
                                                                IF "Payment Reference" <> '' THEN
                                                                  TESTFIELD("Creditor No.");

                                                                //>>NAVDK
                                                                GLSetup.GET;
                                                                IF GLSetup."Danish Localization Active" THEN BEGIN
                                                                  IF "Payment Reference" <> '' THEN BEGIN
                                                                    TESTFIELD("Payment Method Code");
                                                                    PaymentMethod.GET("Payment Method Code");
                                                                    BEGIN
                                                                      PaymentMethod.TESTFIELD("Payment Type Validation");
                                                                      CASE PaymentMethod."Payment Type Validation" OF
                                                                        PaymentMethod."Payment Type Validation"::"FIK 01",
                                                                        PaymentMethod."Payment Type Validation"::"FIK 73":
                                                                          ERROR(PmtReferenceErr,FIELDCAPTION("Payment Reference"),PaymentMethod.TABLECAPTION,"Payment Method Code");
                                                                      END;
                                                                      "Payment Reference" := FIKManagement.EvaluateFIK("Payment Reference","Payment Method Code");
                                                                    END;
                                                                  END;
                                                                END;
                                                                //<<NAVDK
                                                              END;

                                                   CaptionML=[ENU=Payment Reference;
                                                              NOR=Betalingsreferanse;
                                                              SVE=Betalningsreferens];
                                                   Numeric=Yes }
    { 300 ;   ;A. Rcd. Not Inv. Ex. VAT (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."A. Rcd. Not Inv. Ex. VAT (LCY)" WHERE (Document Type=FIELD(Document Type),
                                                                                                                           Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Amount Received Not Invoiced (LCY);
                                                              NOR=Bel›p mottatt, ikke fakturert (NOK)] }
    { 301 ;   ;Amt. Rcd. Not Invoiced (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amt. Rcd. Not Invoiced (LCY)" WHERE (Document Type=FIELD(Document Type),
                                                                                                                         Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Amount Received Not Invoiced (LCY) Incl. VAT;
                                                              NOR=Bel›p mottatt, ikke fakturert (NOK), inkl. mva.] }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnValidate=BEGIN
                                                                DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
                                                              END;

                                                   OnLookup=BEGIN
                                                              ShowDocDim;
                                                            END;

                                                   CaptionML=[ENU=Dimension Set ID;
                                                              NOR=Dimensjonssett-ID;
                                                              SVE=Dimensionsupps„ttnings-ID];
                                                   Editable=No }
    { 1305;   ;Invoice Discount Amount;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Inv. Discount Amount" WHERE (Document No.=FIELD(No.),
                                                                                                                 Document Type=FIELD(Document Type)));
                                                   CaptionML=[ENU=Invoice Discount Amount;
                                                              NOR=Fakturarabattbel›p;
                                                              SVE=Fakturarabatt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 5043;   ;No. of Archived Versions;Integer   ;FieldClass=FlowField;
                                                   CalcFormula=Max("Purchase Header Archive"."Version No." WHERE (Document Type=FIELD(Document Type),
                                                                                                                  No.=FIELD(No.),
                                                                                                                  Doc. No. Occurrence=FIELD(Doc. No. Occurrence)));
                                                   CaptionML=[ENU=No. of Archived Versions;
                                                              NOR=Ant. arkiverte versjoner;
                                                              SVE=Ant. arkiverade versioner];
                                                   Editable=No }
    { 5048;   ;Doc. No. Occurrence ;Integer       ;CaptionML=[ENU=Doc. No. Occurrence;
                                                              NOR=Forekomst av bilagsnr.;
                                                              SVE=Dok.nr f”rekomst] }
    { 5050;   ;Campaign No.        ;Code20        ;TableRelation=Campaign;
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::Campaign,"Campaign No.",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::Job,"Job No.", //**4PS.n
                                                                  DATABASE::"Service Order","Service Order No.",  //**4PS.n
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Campaign No.;
                                                              NOR=Kampanjenr.;
                                                              SVE=Kampanjnr] }
    { 5052;   ;Buy-from Contact No.;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                ContBusinessRelation@1000 : Record 5054;
                                                                Cont@1002 : Record 5050;
                                                              BEGIN
                                                                TestStatusOpen;

                                                                IF "Buy-from Contact No." <> '' THEN
                                                                  IF Cont.GET("Buy-from Contact No.") THEN
                                                                    Cont.CheckIfPrivacyBlockedGeneric;

                                                                IF ("Buy-from Contact No." <> xRec."Buy-from Contact No.") AND
                                                                   (xRec."Buy-from Contact No." <> '')
                                                                THEN BEGIN
                                                                  IF GetHideValidationDialog OR NOT GUIALLOWED THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed := CONFIRM(ConfirmChangeQst,FALSE,FIELDCAPTION("Buy-from Contact No."));
                                                                  IF Confirmed THEN BEGIN
                                                                    IF InitFromContact("Buy-from Contact No.","Buy-from Vendor No.",FIELDCAPTION("Buy-from Contact No.")) THEN
                                                                      EXIT
                                                                  END ELSE BEGIN
                                                                    Rec := xRec;
                                                                    EXIT;
                                                                  END;
                                                                END;

                                                                IF ("Buy-from Vendor No." <> '') AND ("Buy-from Contact No." <> '') THEN BEGIN
                                                                  Cont.GET("Buy-from Contact No.");
                                                                  IF ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Vendor,"Buy-from Vendor No.") THEN
                                                                    IF ContBusinessRelation."Contact No." <> Cont."Company No." THEN
                                                                      ERROR(Text038,Cont."No.",Cont.Name,"Buy-from Vendor No.");
                                                                END;

                                                                UpdateBuyFromVend("Buy-from Contact No.");
                                                              END;

                                                   OnLookup=VAR
                                                              Cont@1001 : Record 5050;
                                                              ContBusinessRelation@1000 : Record 5054;
                                                            BEGIN
                                                              IF "Buy-from Vendor No." <> '' THEN
                                                                IF Cont.GET("Buy-from Contact No.") THEN
                                                                  Cont.SETRANGE("Company No.",Cont."Company No.")
                                                                ELSE
                                                                  IF ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Vendor,"Buy-from Vendor No.") THEN
                                                                    Cont.SETRANGE("Company No.",ContBusinessRelation."Contact No.")
                                                                  ELSE
                                                                    Cont.SETRANGE("No.",'');

                                                              IF "Buy-from Contact No." <> '' THEN
                                                                IF Cont.GET("Buy-from Contact No.") THEN ;
                                                              IF PAGE.RUNMODAL(0,Cont) = ACTION::LookupOK THEN BEGIN
                                                                xRec := Rec;
                                                                VALIDATE("Buy-from Contact No.",Cont."No.");
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Buy-from Contact No.;
                                                              NOR=Kj›p fra-kontaktnr.;
                                                              SVE=Ink”pskontaktnr.] }
    { 5053;   ;Pay-to Contact No.  ;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                ContBusinessRelation@1004 : Record 5054;
                                                                Cont@1002 : Record 5050;
                                                              BEGIN
                                                                TestStatusOpen;

                                                                IF "Pay-to Contact No." <> '' THEN
                                                                  IF Cont.GET("Pay-to Contact No.") THEN
                                                                    Cont.CheckIfPrivacyBlockedGeneric;

                                                                IF ("Pay-to Contact No." <> xRec."Pay-to Contact No.") AND
                                                                   (xRec."Pay-to Contact No." <> '')
                                                                THEN BEGIN
                                                                  IF GetHideValidationDialog OR NOT GUIALLOWED THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed := CONFIRM(ConfirmChangeQst,FALSE,FIELDCAPTION("Pay-to Contact No."));
                                                                  IF Confirmed THEN BEGIN
                                                                    IF InitFromContact("Pay-to Contact No.","Pay-to Vendor No.",FIELDCAPTION("Pay-to Contact No.")) THEN
                                                                      EXIT
                                                                  END ELSE BEGIN
                                                                    "Pay-to Contact No." := xRec."Pay-to Contact No.";
                                                                    EXIT;
                                                                  END;
                                                                END;

                                                                //IF ("Pay-to Vendor No." <> '') AND ("Pay-to Contact No." <> '') THEN BEGIN  //**4PS03.o
                                                                IF ("Pay-to Vendor No." <> '') AND ("Pay-to Contact No." <> '') AND (Cont."Company No." <> '') THEN BEGIN    //**4PS03.n
                                                                  Cont.GET("Pay-to Contact No.");
                                                                  IF ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Vendor,"Pay-to Vendor No.") THEN
                                                                    IF ContBusinessRelation."Contact No." <> Cont."Company No." THEN
                                                                      ERROR(Text038,Cont."No.",Cont.Name,"Pay-to Vendor No.");
                                                                END;

                                                                UpdatePayToVend("Pay-to Contact No.");
                                                              END;

                                                   OnLookup=VAR
                                                              Cont@1000 : Record 5050;
                                                              ContBusinessRelation@1001 : Record 5054;
                                                            BEGIN
                                                              IF "Pay-to Vendor No." <> '' THEN
                                                                IF Cont.GET("Pay-to Contact No.") THEN
                                                                  Cont.SETRANGE("Company No.",Cont."Company No.")
                                                                ELSE
                                                                  IF ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Vendor,"Pay-to Vendor No.") THEN
                                                                    Cont.SETRANGE("Company No.",ContBusinessRelation."Contact No.")
                                                                  ELSE
                                                                    Cont.SETRANGE("No.",'');

                                                              IF "Pay-to Contact No." <> '' THEN
                                                                IF Cont.GET("Pay-to Contact No.") THEN ;
                                                              IF PAGE.RUNMODAL(0,Cont) = ACTION::LookupOK THEN BEGIN
                                                                xRec := Rec;
                                                                VALIDATE("Pay-to Contact No.",Cont."No.");
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Pay-to Contact No.;
                                                              NOR=Betal til-kontaktnr.;
                                                              SVE=Betalas kontaktnr] }
    { 5700;   ;Responsibility Center;Code10       ;TableRelation="Responsibility Center";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF NOT UserSetupMgt.CheckRespCenter(1,"Responsibility Center") THEN
                                                                  ERROR(
                                                                    Text028,
                                                                    RespCenter.TABLECAPTION,UserSetupMgt.GetPurchasesFilter);

                                                                UpdateLocationCode('');
                                                                UpdateInboundWhseHandlingTime;

                                                                UpdateShipToAddress;

                                                                CreateDim(
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::Job,"Job No.", //**4PS.n
                                                                  DATABASE::"Service Order","Service Order No.",  //**4PS.n
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::Campaign,"Campaign No.");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n

                                                                IF xRec."Responsibility Center" <> "Responsibility Center" THEN BEGIN
                                                                  //RecreatePurchLines(FIELDCAPTION("Responsibility Center"));        //**4PS.o
                                                                  "Assigned User ID" := '';
                                                                  MessageIfPurchLinesExist(FIELDCAPTION("Responsibility Center"));  //**4PS.n
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Responsibility Center;
                                                              NOR=Ansvarssenter;
                                                              SVE=Ansvarsenhet] }
    { 5751;   ;Partially Invoiced  ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Purchase Line" WHERE (Document Type=FIELD(Document Type),
                                                                                            Document No.=FIELD(No.),
                                                                                            Type=FILTER(<>' '),
                                                                                            Location Code=FIELD(Location Filter),
                                                                                            Quantity Invoiced=FILTER(<>0)));
                                                   CaptionML=[ENU=Partially Invoiced;
                                                              NOR=Delvis fakturert;
                                                              SVE=Delvis fakturerat];
                                                   Editable=No }
    { 5752;   ;Completely Received ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Min("Purchase Line"."Completely Received" WHERE (Document Type=FIELD(Document Type),
                                                                                                                Document No.=FIELD(No.),
                                                                                                                Type=FILTER(<>' '),
                                                                                                                Location Code=FIELD(Location Filter)));
                                                   CaptionML=[ENU=Completely Received;
                                                              NOR=Fullstendig mottatt;
                                                              SVE=F„rdigt inlevererat];
                                                   Editable=No }
    { 5753;   ;Posting from Whse. Ref.;Integer    ;AccessByPermission=TableData 14=R;
                                                   CaptionML=[ENU=Posting from Whse. Ref.;
                                                              NOR=Bokf›ring fra lagerref.;
                                                              SVE=Bokf. fr†n dist.lager ref.] }
    { 5754;   ;Location Filter     ;Code10        ;FieldClass=FlowFilter;
                                                   TableRelation=Location;
                                                   CaptionML=[ENU=Location Filter;
                                                              NOR=Lokasjonsfilter;
                                                              SVE=Lagerst„llefilter] }
    { 5790;   ;Requested Receipt Date;Date        ;OnValidate=BEGIN
                                                                IF NOT ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote]) OR (Status = Status::Closed) THEN //**4PS.n
                                                                  TestStatusOpen;
                                                                IF "Promised Receipt Date" <> 0D THEN
                                                                  ERROR(
                                                                    Text034,
                                                                    FIELDCAPTION("Requested Receipt Date"),
                                                                    FIELDCAPTION("Promised Receipt Date"));

                                                                IF "Requested Receipt Date" <> xRec."Requested Receipt Date" THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Requested Receipt Date"),CurrFieldNo <> 0);

                                                                "Expected Receipt Date" := "Requested Receipt Date";  //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Requested Receipt Date;
                                                              NOR=nsket mottaksdato;
                                                              SVE=Beg„rt inleveransdatum] }
    { 5791;   ;Promised Receipt Date;Date         ;OnValidate=VAR
                                                                lvPurchLine@1100525000 : Record 39;
                                                              BEGIN
                                                                // << 131121
                                                                IF  (Status = Status::Released) THEN BEGIN
                                                                   lvPurchLine.SETRANGE("Document Type", "Document Type");
                                                                   lvPurchLine.SETRANGE("Document No.", "No.");
                                                                   IF (lvPurchLine.FINDSET(TRUE)) THEN REPEAT
                                                                      lvPurchLine."Promised Receipt Date" := "Promised Receipt Date";
                                                                      lvPurchLine.MODIFY(FALSE);
                                                                   UNTIL lvPurchLine.NEXT = 0;
                                                                   EXIT;
                                                                END;
                                                                // >> 131121

                                                                IF NOT ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote]) OR (Status = Status::Closed) THEN //**4PS.n
                                                                  TestStatusOpen;
                                                                IF "Promised Receipt Date" <> xRec."Promised Receipt Date" THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Promised Receipt Date"),CurrFieldNo <> 0);

                                                                //**4PS.sn
                                                                "Expected Receipt Date" := "Promised Receipt Date";

                                                                IF "Promised Receipt Date" = 0D THEN
                                                                  VALIDATE("Document Confirmation Received",FALSE)
                                                                ELSE
                                                                  VALIDATE("Document Confirmation Received",TRUE);
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Promised Receipt Date;
                                                              NOR=Lovet mottaksdato;
                                                              SVE=Lovat inleveransdatum] }
    { 5792;   ;Lead Time Calculation;DateFormula  ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                LeadTimeMgt.CheckLeadTimeIsNotNegative("Lead Time Calculation");

                                                                IF "Lead Time Calculation" <> xRec."Lead Time Calculation" THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Lead Time Calculation"),CurrFieldNo <> 0);
                                                              END;

                                                   AccessByPermission=TableData 120=R;
                                                   CaptionML=[ENU=Lead Time Calculation;
                                                              NOR=Beregning av leveringstid;
                                                              SVE=Ledtidsber„kning] }
    { 5793;   ;Inbound Whse. Handling Time;DateFormula;
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Inbound Whse. Handling Time" <> xRec."Inbound Whse. Handling Time" THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Inbound Whse. Handling Time"),CurrFieldNo <> 0);
                                                              END;

                                                   AccessByPermission=TableData 14=R;
                                                   CaptionML=[ENU=Inbound Whse. Handling Time;
                                                              NOR=Inng†ende lagerh†ndteringstid;
                                                              SVE=Ankommande lagerhanteringstid] }
    { 5796;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Date Filter;
                                                              NOR=Datofilter;
                                                              SVE=Datumfilter] }
    { 5800;   ;Vendor Authorization No.;Code35    ;CaptionML=[ENU=Vendor Authorization No.;
                                                              NOR=Leverand›rgodkjenningsnr.;
                                                              SVE=Lev.godk„nnande nr] }
    { 5801;   ;Return Shipment No. ;Code20        ;CaptionML=[ENU=Return Shipment No.;
                                                              NOR=Returforsendelsesnr.;
                                                              SVE=Returutleveransnr] }
    { 5802;   ;Return Shipment No. Series;Code20  ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                IF "Return Shipment No. Series" <> '' THEN BEGIN
                                                                  GetPurchSetup;
                                                                  PurchSetup.TESTFIELD("Posted Return Shpt. Nos.");
                                                                  NoSeriesMgt.TestSeries(PurchSetup."Posted Return Shpt. Nos.","Return Shipment No. Series");
                                                                END;
                                                                TESTFIELD("Return Shipment No.",'');
                                                              END;

                                                   OnLookup=BEGIN
                                                              WITH PurchHeader DO BEGIN
                                                                PurchHeader := Rec;
                                                                GetPurchSetup;
                                                                PurchSetup.TESTFIELD("Posted Return Shpt. Nos.");
                                                                IF NoSeriesMgt.LookupSeries(PurchSetup."Posted Return Shpt. Nos.","Return Shipment No. Series") THEN
                                                                  VALIDATE("Return Shipment No. Series");
                                                                Rec := PurchHeader;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Return Shipment No. Series;
                                                              NOR=Returforsendelse - nr.serie;
                                                              SVE=Returutleverans nr-serie] }
    { 5803;   ;Ship                ;Boolean       ;CaptionML=[ENU=Ship;
                                                              NOR=Levere;
                                                              SVE=Leverera] }
    { 5804;   ;Last Return Shipment No.;Code20    ;TableRelation="Return Shipment Header";
                                                   CaptionML=[ENU=Last Return Shipment No.;
                                                              NOR=Siste returforsendelsesnr.;
                                                              SVE=Senaste returutleveransnr];
                                                   Editable=No }
    { 8000;   ;Id                  ;GUID          ;CaptionML=[ENU=Id;
                                                              NOR=ID;
                                                              SVE=ID] }
    { 9000;   ;Assigned User ID    ;Code50        ;TableRelation="User Setup";
                                                   OnValidate=BEGIN
                                                                IF NOT UserSetupMgt.CheckRespCenter2(1,"Responsibility Center","Assigned User ID") THEN
                                                                  ERROR(
                                                                    Text049,"Assigned User ID",
                                                                    RespCenter.TABLECAPTION,UserSetupMgt.GetPurchasesFilter2("Assigned User ID"));
                                                              END;

                                                   DataClassification=EndUserIdentifiableInformation;
                                                   CaptionML=[ENU=Assigned User ID;
                                                              NOR=Tilordnet bruker-ID;
                                                              SVE=Tilldelat anv„ndar-ID] }
    { 9001;   ;Pending Approvals   ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Approval Entry" WHERE (Table ID=CONST(38),
                                                                                             Document Type=FIELD(Document Type),
                                                                                             Document No.=FIELD(No.),
                                                                                             Status=FILTER(Open|Created)));
                                                   CaptionML=[ENU=Pending Approvals;
                                                              NOR=Venter p† godkjenninger;
                                                              SVE=V„ntar p† godk„nnanden] }
    { 11200;  ;EU 3-Party Trade    ;Boolean       ;CaptionML=[ENU=EU 3-Party Trade;
                                                              SVE=EU trepartshandel];
                                                   Description=NAVSE (11200) }
    { 11202;  ;Periodic Template Code;Code10      ;TableRelation=Table11128015.Field1;
                                                   CaptionML=[ENU=Periodic Template Code;
                                                              SVE=Periodisk mallkod];
                                                   Description=4PSSE }
    { 11203;  ;Periodic Starting Date;Date        ;CaptionML=[ENU=Periodic Starting Date;
                                                              SVE=Periodiskt startdatum];
                                                   Description=4PSSE }
    { 13650;  ;Giro Acc. No.       ;Code8         ;OnValidate=BEGIN
                                                                IF "Giro Acc. No." <> '' THEN
                                                                  "Giro Acc. No." := PADSTR('',MAXSTRLEN("Giro Acc. No.") - STRLEN("Giro Acc. No."),'0') + "Giro Acc. No.";
                                                              END;

                                                   CaptionML=ENU=Giro Acc. No.;
                                                   Description=NAVDK (13650) }
    { 11012001;;Subcontracting Invoice;Boolean    ;OnValidate=BEGIN
                                                                IF NOT "Subcontracting Invoice" THEN BEGIN
                                                                  "Payment Agreement" := '';
                                                                  "Actual Effective Date" := 0D;
                                                                  "Actual End Date" := 0D;
                                                                  "Number of Hours" := 0;
                                                                  "Avg. Wage Rate" := 0;
                                                                  "Labor Amount" := 0;
                                                                  "Contribution Percentage Labor" := 0;
                                                                  "Contribution Percentage Total" := 0;
                                                                  "Fixed B Amount per Hour" := 0;
                                                                  "Pay To Tax Authority" := FALSE;
                                                                  "Wage Charge (to B Account)" := 0;
                                                                  "Wage Charge (to Tax Authority)" := 0;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Subcontracting Invoice;
                                                              NOR=Underentrepen›rsfaktura;
                                                              SVE=Underentreprenadsfaktura] }
    { 11012005;;Job No.            ;Code20        ;TableRelation=Job;
                                                   OnValidate=VAR
                                                                lvBlockingCodeRec@1100485000 : Record 11012027;
                                                                lvEmployeeReferenceICMRec@1210190000 : Record 11012739;
                                                                ProjRec@1100528500 : Record 11072003;
                                                              BEGIN
                                                                //**4PS.sn
                                                                IF "Job No." <> '' THEN BEGIN
                                                                  TESTFIELD("Service Order No.", '');
                                                                  ProjSetupRec.GET;
                                                                  ProjRec.GET("Job No.");

                                                                  IF ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::"Credit Memo"]) AND
                                                                     (ProjRec."Blocking Code" <> '') AND
                                                                     ((ProjRec."Project Status" = ProjRec."Project Status"::"Technical Finished") OR
                                                                      (ProjRec."Project Status" = ProjRec."Project Status"::"Administrative Finished") OR
                                                                      ((ProjRec."Project Status" = ProjRec."Project Status"::Finished) AND ProjSetupRec."Provisions at Closure")
                                                                     ) THEN
                                                                  BEGIN
                                                                    CASE "Document Type" OF
                                                                      "Document Type"::Order:
                                                                        lvBlockingCodeRec.Switch := lvBlockingCodeRec.Switch::"Purchase Order";
                                                                      "Document Type"::Invoice,"Document Type"::"Credit Memo":
                                                                        lvBlockingCodeRec.Switch := lvBlockingCodeRec.Switch::"Purchase Invoice";
                                                                    END;
                                                                    lvBlockingCodeRec.CheckBlocked(ProjRec."Blocking Code", lvBlockingCodeRec.Switch, ProjRec, TRUE);
                                                                  END ELSE BEGIN
                                                                    IF ProjSetupRec."Provisions at Closure" THEN
                                                                      ProjRec.CheckProjectStatus(-1)
                                                                    ELSE
                                                                      ProjRec.CheckProjectStatus(1);
                                                                  END;

                                                                  IF NOT ProjSetupRec."Post in Estim. Status allowed" THEN
                                                                    IF ((ProjRec."Project Status" < ProjRec."Project Status"::Preparation) AND ("Document Type" > "Document Type"::Quote)) OR
                                                                       ((ProjRec."Project Status" > ProjRec."Project Status"::Production) AND ("Document Type" < "Document Type"::Order))
                                                                    THEN
                                                                      ERROR(Text11012009,ProjRec.TABLECAPTION,"Job No.",ProjRec.FIELDCAPTION("Project Status"),ProjRec."Project Status");

                                                                  TESTFIELD("Service Order No.", '');

                                                                  IF (CurrFieldNo = FIELDNO("Job No.")) THEN BEGIN
                                                                    ProjRec.TESTFIELD("Project Type");
                                                                    Expediter := ProjRec.Expediter;
                                                                  END;

                                                                  PurchSetup.GET;
                                                                  IF PurchSetup."Reference (ICM) Based on" = PurchSetup."Reference (ICM) Based on"::"Project Manager" THEN
                                                                    IF lvEmployeeReferenceICMRec.GET(ProjRec."Project Manager") THEN
                                                                      "Reference (ICM)" := lvEmployeeReferenceICMRec."Reference (ICM)";
                                                                END;

                                                                IF "Ship-to Project" <> "Job No." THEN
                                                                  VALIDATE("Ship-to Project", "Job No.");

                                                                UpdateCurrencyFactor;
                                                                IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                  IF (CurrFieldNo = FIELDNO("Job No.")) THEN
                                                                    ConfirmUpdateCurrencyFactor
                                                                  ELSE
                                                                    VALIDATE("Currency Factor");

                                                                IF (CurrFieldNo = FIELDNO("Job No.")) THEN BEGIN
                                                                  IF "Invoice Lines Input" AND ("Job No." <> xRec."Job No.") THEN
                                                                    MessageIfPurchLinesExist(FIELDCAPTION("Job No."));
                                                                END;

                                                                ChangeProjectInWarrantyData;

                                                                UpdateOrderAddressByDepartment;

                                                                CreateDim(
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::Campaign,"Campaign No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");

                                                                FillJournalTemplate;

                                                                IF ("Preregister WIP") THEN
                                                                  CreatePurchLineRegAcc;

                                                                FillReferenceICM;
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 11012007;;Project Description;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Job No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 11012010;;Payment Agreement  ;Code20        ;TableRelation="Payment Agreement".Code WHERE (Sub Contractor=FIELD(Buy-from Vendor No.));
                                                   OnValidate=VAR
                                                                AgreementRec@11012000 : Record 11012028;
                                                              BEGIN
                                                                //**4PS
                                                                IF AgreementRec.GET("Payment Agreement") THEN BEGIN
                                                                  AgreementRec.TESTFIELD(Date);
                                                                  AgreementRec.TESTFIELD(Description);
                                                                  IF "Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"] THEN
                                                                    AgreementRec.TESTFIELD("Signed Return Date");

                                                                  GetVend("Buy-from Vendor No.");
                                                                  // IF (Vend."SWP OLD" OR Vend.ACL) THEN  //**4PS.o
                                                                  IF ((Vend."Subcontractor Type" = Vend."Subcontractor Type"::"Self Employed") OR Vend.ACL) THEN  //**4PS.n
                                                                    "Avg. Wage Rate" := 0
                                                                  ELSE
                                                                    IF "Currency Code" = '' THEN
                                                                      "Avg. Wage Rate" := AgreementRec."Avg. Wage Rate"
                                                                    ELSE
                                                                      "Avg. Wage Rate" :=
                                                                        ROUND(
                                                                          CurrExchRate.ExchangeAmtLCYToFCY(
                                                                            0, '', "Posting Date","Currency Code",
                                                                            AgreementRec."Avg. Wage Rate","Currency Factor",FALSE));

                                                                  "Contribution Percentage Labor" := AgreementRec."Contribution Percentage Labor";
                                                                  "Contribution Percentage Total" := AgreementRec."Contribution Percentage Total";
                                                                  "Fixed B Amount per Hour" := AgreementRec."Fixed B Amount per Hour";
                                                                  "Pay To Tax Authority" := AgreementRec."Pay To Tax Authority";
                                                                  "Actual Effective Date" := AgreementRec."Expected Effective Date";
                                                                  "Actual End Date" := AgreementRec."Expected Enddate";
                                                                  "Pay VAT Amt. on B-Acc. Vendor" := AgreementRec."Pay VAT Amt. on B-Account Vend";
                                                                  IF "Payment Agreement" <> xRec."Payment Agreement" THEN
                                                                    "Number of Hours" := AgreementRec."Number of Hours";
                                                                END;

                                                                IF "Payment Agreement" <> '' THEN
                                                                  VALIDATE("Number of Hours")
                                                                ELSE
                                                                  VALIDATE("Number of Hours", 0);
                                                              END;

                                                   OnLookup=VAR
                                                              lRecPaymentAgreement@1210190000 : Record 11012028;
                                                              PassDataBetweenPages@1100525000 : Codeunit 11012634;
                                                            BEGIN
                                                              //**4PS
                                                              lRecPaymentAgreement.SETRANGE("Sub Contractor", "Buy-from Vendor No.");
                                                              IF "Job No." <> '' THEN
                                                                lRecPaymentAgreement.SETFILTER("Project No.", '%1|%2', '', "Job No.");
                                                              PassDataBetweenPages.SetDefaultPaymentAgreementCode("No.");
                                                              IF PAGE.RUNMODAL(11012059, lRecPaymentAgreement) = ACTION::LookupOK THEN
                                                                VALIDATE("Payment Agreement", lRecPaymentAgreement.Code);
                                                            END;

                                                   CaptionML=[ENU=Payment Agreement;
                                                              NOR=Betalingsvilk†r;
                                                              SVE=Betalningsvillkor] }
    { 11012020;;Actual Effective Date;Date        ;CaptionML=[ENU=Actual Effective Date;
                                                              NOR=Faktisk effektueringsdato;
                                                              SVE=Verkligt ikrafttr„dandedatum] }
    { 11012030;;Actual End Date    ;Date          ;CaptionML=[ENU=Actual End Date;
                                                              NOR=Faktisk sluttdato;
                                                              SVE=Verkligt slutdatum] }
    { 11012040;;Number of Hours    ;Decimal       ;OnValidate=BEGIN
                                                                WKACalculationCu.CalculateWageCharge("Number of Hours","Avg. Wage Rate","Currency Code","Labor Amount");
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   CaptionML=[ENU=Number of Hours;
                                                              NOR=Antall timer;
                                                              SVE=Antal timmar];
                                                   MinValue=0 }
    { 11012050;;Avg. Wage Rate     ;Decimal       ;OnValidate=BEGIN
                                                                WKACalculationCu.CalculateWageCharge("Number of Hours","Avg. Wage Rate","Currency Code","Labor Amount");
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   CaptionML=[ENU=Avg. Wage Rate;
                                                              NOR=Gjennomsnitlig l›nnssats;
                                                              SVE=Gen. L”neavgift];
                                                   MinValue=0;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 11012060;;Labor Amount       ;Decimal       ;OnValidate=BEGIN
                                                                WKACalculationCu.CalculateRate("Number of Hours","Labor Amount","Avg. Wage Rate");
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   CaptionML=[ENU=Labor Amount;
                                                              NOR=Arbeidskraftsbel›p;
                                                              SVE=Arbetskraftsbelopp];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012070;;Contribution Percentage Labor;Decimal;
                                                   OnValidate=BEGIN
                                                                IF (xRec."Contribution Percentage Labor" = 0) AND ("Contribution Percentage Labor" <> 0) THEN BEGIN
                                                                  "Contribution Percentage Total" := 0;
                                                                  "Fixed B Amount per Hour" := 0;
                                                                END;
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   OnLookup=VAR
                                                              ContBusRel@1210190011 : Record 5054;
                                                              ContIndustGroup@11012000 : Record 5058;
                                                            BEGIN
                                                              ContBusRel.SETCURRENTKEY("Link to Table","No.");
                                                              ContBusRel.SETRANGE("Link to Table",ContBusRel."Link to Table"::Vendor);
                                                              ContBusRel.SETRANGE("No.", "Buy-from Vendor No.");
                                                              IF NOT ContBusRel.FIND('-') THEN
                                                                ERROR(Text11012001,ContBusRel.TABLECAPTION,FIELDCAPTION("Buy-from Vendor No."),"Buy-from Vendor No.");

                                                              ContIndustGroup.SETRANGE("Contact No.",ContBusRel."Contact No.");
                                                              IF PAGE.RUNMODAL(PAGE::"Contact Industry Groups",ContIndustGroup) = ACTION::LookupOK THEN BEGIN
                                                                "Contribution Percentage Labor" := ContIndustGroup."Contribution Percentage Labor";
                                                                "Contribution Percentage Total" := ContIndustGroup."Contribution Percentage Total";
                                                                "Fixed B Amount per Hour" := ContIndustGroup."Fixed B Amount per Hour";
                                                                 VALIDATE("Contribution Percentage Labor" );
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Contribution Percentage Labor;
                                                              NOR=Dekningsbidrag, arbeidskraft;
                                                              SVE=T„ckningsbidrag, arbetskraft];
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 11012071;;Contribution Percentage Total;Decimal;
                                                   OnValidate=BEGIN
                                                                IF (xRec."Contribution Percentage Total" = 0) AND ("Contribution Percentage Total" <> 0) THEN BEGIN
                                                                  "Contribution Percentage Labor" := 0;
                                                                  "Fixed B Amount per Hour" := 0;
                                                                END;
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   OnLookup=VAR
                                                              ContBusRel@1210190011 : Record 5054;
                                                              ContIndustGroup@11012000 : Record 5058;
                                                            BEGIN
                                                              ContBusRel.SETCURRENTKEY("Link to Table","No.");
                                                              ContBusRel.SETRANGE("Link to Table",ContBusRel."Link to Table"::Vendor);
                                                              ContBusRel.SETRANGE("No.", "Buy-from Vendor No.");
                                                              IF NOT ContBusRel.FIND('-') THEN
                                                                ERROR(Text11012001,ContBusRel.TABLECAPTION,FIELDCAPTION("Buy-from Vendor No."),"Buy-from Vendor No.");

                                                              ContIndustGroup.SETRANGE("Contact No.",ContBusRel."Contact No.");
                                                              IF PAGE.RUNMODAL(PAGE::"Contact Industry Groups",ContIndustGroup) = ACTION::LookupOK THEN BEGIN
                                                                "Contribution Percentage Labor" := ContIndustGroup."Contribution Percentage Labor";
                                                                "Contribution Percentage Total" := ContIndustGroup."Contribution Percentage Total";
                                                                "Fixed B Amount per Hour" := ContIndustGroup."Fixed B Amount per Hour";
                                                                 VALIDATE("Contribution Percentage Total" );
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Contribution Percentage Invoice Total;
                                                              NOR=Dekningsbidrag, faktura totalt;
                                                              SVE=T„ckningsbidrag, faktura totalt];
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 11012073;;Fixed B Amount per Hour;Decimal   ;OnValidate=BEGIN
                                                                IF (xRec."Fixed B Amount per Hour" = 0) AND ("Fixed B Amount per Hour" <> 0) THEN BEGIN
                                                                  "Contribution Percentage Labor" := 0;
                                                                  "Contribution Percentage Total" := 0;
                                                                END;
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   OnLookup=VAR
                                                              ContBusRel@1100528201 : Record 5054;
                                                              ContIndustGroup@1100528200 : Record 5058;
                                                            BEGIN
                                                              ContBusRel.SETCURRENTKEY("Link to Table","No.");
                                                              ContBusRel.SETRANGE("Link to Table",ContBusRel."Link to Table"::Vendor);
                                                              ContBusRel.SETRANGE("No.", "Buy-from Vendor No.");
                                                              IF NOT ContBusRel.FIND('-') THEN
                                                                ERROR(Text11012001,ContBusRel.TABLECAPTION,FIELDCAPTION("Buy-from Vendor No."),"Buy-from Vendor No.");

                                                              ContIndustGroup.SETRANGE("Contact No.",ContBusRel."Contact No.");
                                                              IF PAGE.RUNMODAL(PAGE::"Contact Industry Groups",ContIndustGroup) = ACTION::LookupOK THEN BEGIN
                                                                "Contribution Percentage Labor" := ContIndustGroup."Contribution Percentage Labor";
                                                                "Contribution Percentage Total" := ContIndustGroup."Contribution Percentage Total";
                                                                "Fixed B Amount per Hour" := ContIndustGroup."Fixed B Amount per Hour";
                                                                 VALIDATE("Fixed B Amount per Hour");
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Fixed B Amount per Hour;
                                                              SVE=Fast B-belopp per timme] }
    { 11012075;;Pay To Tax Authority;Boolean      ;OnValidate=VAR
                                                                lPurchLine@1210190000 : Record 39;
                                                              BEGIN
                                                                TESTFIELD("Pay To Tax Authority", FALSE);
                                                                lPurchLine.SETRANGE("Document Type","Document Type");
                                                                lPurchLine.SETRANGE("Document No.","No.");
                                                                lPurchLine.CALCSUMS(Amount);

                                                                WKACalculationCu.CalculateWageChart(
                                                                  "Buy-from Vendor No.","Labor Amount","Contribution Percentage Labor","Pay To Tax Authority","Currency Code",
                                                                  "Wage Charge (to B Account)","Wage Charge (to Tax Authority)", "Contribution Percentage Total",
                                                                  "Fixed B Amount per Hour", "Number of Hours", lPurchLine.Amount);
                                                              END;

                                                   CaptionML=[ENU=Pay To Tax Authority;
                                                              NOR=Betal til skattemyndighet;
                                                              SVE=Betala till skattemyndighet] }
    { 11012080;;Wage Charge (to B Account);Decimal;OnValidate=VAR
                                                                lPurchLine@1210190000 : Record 39;
                                                              BEGIN
                                                                lPurchLine.SETRANGE("Document Type","Document Type");
                                                                lPurchLine.SETRANGE("Document No.","No.");
                                                                lPurchLine.CALCSUMS(Amount);

                                                                WKACalculationCu.ValidateWageCharge(
                                                                  "Labor Amount","Currency Code","Wage Charge (to B Account)",
                                                                  "Contribution Percentage Labor","Contribution Percentage Total",
                                                                  "Fixed B Amount per Hour",lPurchLine.Amount);
                                                              END;

                                                   CaptionML=[ENU=Wage Charge (to B Account);
                                                              NOR=L›nnsgebyr (til B-konto);
                                                              SVE=L”neavgift (till B-konto)];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012090;;Wage Charge (to Tax Authority);Decimal;
                                                   OnValidate=VAR
                                                                lPurchLine@1210190000 : Record 39;
                                                              BEGIN
                                                                TESTFIELD("Wage Charge (to Tax Authority)", 0);
                                                                lPurchLine.SETRANGE("Document Type","Document Type");
                                                                lPurchLine.SETRANGE("Document No.","No.");
                                                                lPurchLine.CALCSUMS(Amount);

                                                                WKACalculationCu.ValidateWageTax(
                                                                  "Buy-from Vendor No.","Labor Amount","Currency Code","Contribution Percentage Labor",
                                                                  "Wage Charge (to Tax Authority)", "Contribution Percentage Total",
                                                                  "Fixed B Amount per Hour",lPurchLine.Amount);
                                                              END;

                                                   CaptionML=[ENU=Wage Charge (to Tax Authority);
                                                              NOR=L›nnsgebyr (til skattemyndighet);
                                                              SVE=L”neavgift (till skattemyndigheten)];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012120;;Invoice Lines Input;Boolean       ;InitValue=No;
                                                   OnValidate=BEGIN
                                                                PurchSetup.GET;
                                                                IF ("Invoice Lines Input") AND
                                                                   (PurchSetup."Approve Purchase Invoices") AND
                                                                   (PurchSetup."VAT Indicator (Purchase)" = PurchSetup."VAT Indicator (Purchase)" ::"No VAT") THEN
                                                                  ERROR(Text11012021);

                                                                IF "Preregister WIP" AND "Invoice Lines Input" THEN
                                                                  "Preregister WIP" := FALSE;

                                                                IF (NOT "Invoice Lines Input") AND (PurchSetup."Preregister WIP Purch. Inv.")  THEN
                                                                  "Preregister WIP" := TRUE;
                                                              END;

                                                   CaptionML=[ENU=Invoice Lines Input;
                                                              NOR=Fakturaradstilgang;
                                                              SVE=Inmatning f”r fakturarader] }
    { 11012121;;Manually VAT Posting;Boolean      ;CaptionML=[ENU=Manually VAT Posting;
                                                              NOR=Manuell Momsbokf›ring;
                                                              SVE=Manuell momsbokf”ring];
                                                   Editable=No }
    { 11012130;;Amount incl. VAT   ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF "Manually VAT Posting" THEN
                                                                  "VAT Amount" := "Amount incl. VAT" - "Amount excl. VAT";

                                                                CreatePurchLineRegAcc;

                                                                WKACalculationCu.CalculateWageCharge("Number of Hours","Avg. Wage Rate","Currency Code","Labor Amount");
                                                                VALIDATE("Pay To Tax Authority");
                                                              END;

                                                   CaptionML=[ENU=Amount incl. VAT;
                                                              NOR=Bel›p inkludert moms;
                                                              SVE=Summa inkl. Moms];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012131;;Amount excl. VAT   ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                "Amount incl. VAT" := "VAT Amount" + "Amount excl. VAT";

                                                                CreatePurchLineRegAcc; //**4PS 28-10-2008
                                                              END;

                                                   CaptionML=[ENU=Amount excl. VAT;
                                                              NOR=Bel›p eksklusive moms;
                                                              SVE=Belopp exklusive moms];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012132;;VAT Amount         ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                "Amount incl. VAT" := "VAT Amount" + "Amount excl. VAT";
                                                                CreatePurchLineRegAcc;
                                                              END;

                                                   CaptionML=[ENU=VAT Amount;
                                                              NOR=Mva-bel›p;
                                                              SVE=Momsbelopp];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012140;;VAT Prod. Posting Group;Code20    ;TableRelation="VAT Product Posting Group".Code;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF VATSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group") THEN
                                                                  "Manually VAT Posting" := VATSetup.Manually;
                                                                IF NOT "Manually VAT Posting" THEN BEGIN
                                                                  "Amount excl. VAT" := 0;
                                                                  "VAT Amount" := 0;
                                                                END;
                                                                IF "Amount incl. VAT" <> 0 THEN
                                                                  CreatePurchLineRegAcc;
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Moms produktbokf›ringsmal;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 11012150;;Quote Status       ;Option        ;OnValidate=VAR
                                                                lvPurchLine@1210190000 : Record 39;
                                                              BEGIN
                                                                //**4PS
                                                                IF ("Document Type" <> "Document Type"::Quote) THEN
                                                                  EXIT;

                                                                IF "Quote Status" < xRec."Quote Status" THEN
                                                                  IF NOT CONFIRM(
                                                                    Text11012002,FALSE,
                                                                    FIELDCAPTION("Quote Status"),xRec."Quote Status","Quote Status")
                                                                  THEN
                                                                    "Quote Status" := xRec."Quote Status";

                                                                IF "Quote Status" > xRec."Quote Status" THEN
                                                                  IF ("Quote Status" = "Quote Status"::Sent) OR ("Quote Status" = "Quote Status"::Thanks) THEN
                                                                    IF NOT CONFIRM(
                                                                      Text11012003 + ' ' +
                                                                      Text11012004,FALSE,
                                                                      FIELDCAPTION("Quote Status"),"Quote Status")
                                                                    THEN
                                                                      "Quote Status" := xRec."Quote Status";

                                                                IF (CurrFieldNo = FIELDNO("Quote Status")) AND
                                                                   ("Quote Status" <> xRec."Quote Status") AND
                                                                   (("Quote Status" = "Quote Status"::Selected) OR
                                                                    (xRec."Quote Status" = "Quote Status"::Selected))
                                                                THEN BEGIN
                                                                  IF CONFIRM(STRSUBSTNO(Text032, FIELDCAPTION("Quote Status"))) THEN BEGIN
                                                                    lvPurchLine.SETRANGE("Document Type","Document Type");
                                                                    lvPurchLine.SETRANGE("Document No.","No.");
                                                                    IF lvPurchLine.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                      REPEAT
                                                                        IF ("Quote Status" = "Quote Status"::Selected) THEN BEGIN
                                                                          lvPurchLine.VALIDATE("Quote Selected", TRUE);
                                                                          lvPurchLine.MODIFY(TRUE);
                                                                        END ELSE BEGIN
                                                                          IF (xRec."Quote Status" = "Quote Status"::Selected) THEN BEGIN
                                                                            lvPurchLine.VALIDATE("Quote Selected", FALSE);
                                                                            //**4PS.sn
                                                                            lvPurchLine."Modified by" := USERID; //DP00469
                                                                            lvPurchLine."Last Date Modified" := TODAY;//DP00469
                                                                            //**4PS.en
                                                                            lvPurchLine.MODIFY(FALSE);
                                                                          END;
                                                                        END;
                                                                      UNTIL lvPurchLine.NEXT = 0;
                                                                    END;
                                                                  END;
                                                                END;

                                                                FinishPhase(FIELDNO("Quote Status"));
                                                              END;

                                                   CaptionML=[ENU=Quote Status;
                                                              NOR=Tilbudsstatus;
                                                              SVE=Quote Status];
                                                   OptionCaptionML=ENU=Application,Sent,Received,Thanks,Selected,Rejected;
                                                   OptionString=Application,Sent,Received,Thanks,Selected,Rejected }
    { 11012160;;Write Off Letter Printed;Integer  ;CaptionML=[ENU=Write Off Letter Printed;
                                                              NOR=Avskrivningsbrev er skrevet ut;
                                                              SVE=Avskrivningsbrev har skrivits ut];
                                                   Editable=No }
    { 11012170;;Transaction Mode B Payments;Code20;CaptionML=[ENU=Transaction Mode Code B Payments;
                                                              NOR=Transaksjonsmodus for Kode B-betalninger;
                                                              SVE=Transaktionsl„ge f”r kod B-betalningar] }
    { 11012180;;Bank Account Code B Payments;Code20;
                                                   TableRelation="Vendor Bank Account".Code WHERE (Vendor No.=FIELD(Buy-from Vendor No.),
                                                                                                   B-Account=CONST(Yes));
                                                   CaptionML=[ENU=Bank Account Code B Payments;
                                                              NOR=Bankkontokode B-betalinger;
                                                              SVE=Bankkontokod B-betalningar] }
    { 11012190;;Ship-to Project    ;Code20        ;TableRelation=Job;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Document Type" = "Document Type"::Order) AND
                                                                   (xRec."Ship-to Project" <> "Ship-to Project")
                                                                THEN BEGIN
                                                                  PurchLine.SETRANGE("Document Type",PurchLine."Document Type"::Order);
                                                                  PurchLine.SETRANGE("Document No.","No.");
                                                                  PurchLine.SETFILTER("Sales Order Line No.",'<>0');
                                                                  IF PurchLine.FINDFIRST THEN
                                                                    ERROR(
                                                                      YouCannotChangeFieldErr,
                                                                      FIELDCAPTION("Ship-to Project"));
                                                                END;

                                                                IF (xRec."Ship-to Project" <> "Ship-to Project") THEN
                                                                  UpdateDeliver(FIELDNO("Ship-to Project"));

                                                                UpdateVATData();
                                                              END;

                                                   CaptionML=[ENU=Ship-to Project;
                                                              NOR=Mottatt p† prosjekt;
                                                              SVE=Mottaget f”r projekt] }
    { 11012200;;Inv.Appr.Journal Template;Code10  ;TableRelation="Gen. Journal Template".Name WHERE (Type=CONST(Purch.Invoice Approval));
                                                   CaptionML=[ENU=Inv.Appr.Journal Template;
                                                              NOR=Mal for Fakturagodkjenningsjournal;
                                                              SVE=Mall f”r fakt.godk.journal] }
    { 11012210;;Purchase Registration Account;Code20;
                                                   TableRelation="G/L Account".No.;
                                                   CaptionML=[ENU=Purchase Registration Account;
                                                              NOR=Innkj›psregistreringskonto;
                                                              SVE=Ink”psregistreringskonto] }
    { 11012215;;Preregister WIP    ;Boolean       ;InitValue=No;
                                                   OnValidate=BEGIN
                                                                IF "Preregister WIP" AND "Invoice Lines Input" THEN
                                                                  "Invoice Lines Input" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Preregister WIP;
                                                              NOR=Forh†ndregistrer arbeidskapital;
                                                              SVE=F”rregistrera p†g†ende arbeten] }
    { 11012220;;Invoice Approved   ;Boolean       ;InitValue=Yes;
                                                   CaptionML=[ENU=Invoice Approved;
                                                              NOR=Faktura godkjent;
                                                              SVE=Godk„nd faktura] }
    { 11012230;;Invoice Conduction Note;Boolean   ;OnValidate=BEGIN
                                                                IF NOT "Invoice Conduction Note" THEN
                                                                  "Induction Note No." := ''
                                                              END;

                                                   CaptionML=[ENU=Invoice Conduction Note;
                                                              NOR=Faktura overf›ringsnotat;
                                                              SVE=Faktura ”verf”ringsanteckning] }
    { 11012240;;Induction Note No. ;Text30        ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF "Induction Note No." <> '' THEN BEGIN
                                                                  PurchHeader.RESET;
                                                                  PurchHeader.SETCURRENTKEY("Induction Note No.");
                                                                  PurchHeader.SETRANGE("Induction Note No.","Induction Note No.");
                                                                  PurchHeader.SETRANGE("Document Type", "Document Type"::Order);
                                                                  PurchHeader.SETFILTER("No.",'<> %1',"No.");
                                                                  IF PurchHeader.FINDFIRST THEN
                                                                    IF NOT CONFIRM(STRSUBSTNO(
                                                                        Text11012005,
                                                                        FIELDCAPTION("Induction Note No."),
                                                                        "Induction Note No.",
                                                                        STRSUBSTNO('%1',PurchHeader."Document Type"),
                                                                        PurchHeader."No."),FALSE)
                                                                    THEN BEGIN
                                                                      "Induction Note No." := xRec."Induction Note No.";
                                                                      EXIT;
                                                                    END;

                                                                  PurchRcptHeader.RESET;
                                                                  PurchRcptHeader.SETCURRENTKEY("Buy-from Vendor No.","Induction Note No.");
                                                                  PurchRcptHeader.SETRANGE("Induction Note No.", "Induction Note No.");
                                                                  IF PurchRcptHeader.FINDFIRST THEN
                                                                    IF NOT CONFIRM(STRSUBSTNO(
                                                                        Text11012005,
                                                                        FIELDCAPTION("Induction Note No."),
                                                                        "Induction Note No.",
                                                                        PurchRcptHeader.TABLECAPTION,
                                                                        PurchRcptHeader."No."),FALSE)
                                                                    THEN BEGIN
                                                                      "Induction Note No." := xRec."Induction Note No.";
                                                                      EXIT;
                                                                    END;

                                                                  ApprLine.RESET;
                                                                  ApprLine.SETRANGE("Document Type", ApprLine."Document Type"::"Purchase Invoice");
                                                                  ApprLine.SETRANGE("Induction Note No.","Induction Note No.");
                                                                  IF ApprLine.FINDFIRST THEN
                                                                    IF NOT CONFIRM(STRSUBSTNO(
                                                                        Text11012005,
                                                                        FIELDCAPTION("Induction Note No."),
                                                                        "Induction Note No.",
                                                                        STRSUBSTNO('%1',ApprLine."Document Type"),
                                                                        ApprLine."Document No."),FALSE)
                                                                    THEN BEGIN
                                                                      "Induction Note No." := xRec."Induction Note No.";
                                                                      EXIT;
                                                                    END;

                                                                  PurchInvLine.RESET;
                                                                  PurchInvLine.SETCURRENTKEY("Induction Note No.");
                                                                  PurchInvLine.SETRANGE("Induction Note No.","Induction Note No.");
                                                                  IF PurchInvLine.FINDFIRST THEN
                                                                    IF NOT CONFIRM(STRSUBSTNO(
                                                                        Text11012005,
                                                                        FIELDCAPTION("Induction Note No."),
                                                                        "Induction Note No.",
                                                                        PurchInvHeader.TABLECAPTION,
                                                                        PurchInvLine."Document No."),FALSE)
                                                                    THEN BEGIN
                                                                      "Induction Note No." := xRec."Induction Note No.";
                                                                      EXIT;
                                                                    END;

                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Induction Note No.;
                                                              NOR=Nummer for induksjonsnotering;
                                                              SVE=Nummer f”r induktionsnotering] }
    { 11012250;;FSC Type Code      ;Code10        ;TableRelation="FSC Type";
                                                   CaptionML=[ENU=FSC Type Code;
                                                              NOR=FSC Typekode;
                                                              SVE=FSC typkod] }
    { 11012260;;Approvement Initials;Code10       ;TableRelation="Invoice Approval Initials".Code;
                                                   CaptionML=[ENU=Approvement Initials;
                                                              NOR=Godkjenningsinitialer;
                                                              SVE=Godk„nnandeinitialer] }
    { 11012271;;Hours Hire Order Type;Option      ;CaptionML=[ENU=Hours Hire Order Type;
                                                              NOR=Ordretype for timeleie;
                                                              SVE=Ordertyp f”r timhyra];
                                                   OptionCaptionML=[ENU=" ,Employee,Plant";
                                                                    NOR=" ,Ansatt,Maskin";
                                                                    SVE=" ,Anst„lld,Maskin"];
                                                   OptionString=[ ,Employee,Plant] }
    { 11012272;;Order Type (SiB)   ;Option        ;CaptionML=[ENU=Order Type (SiB);
                                                              NOR=Ordretype (SiB);
                                                              SVE=Ordertyp (SiB)];
                                                   OptionCaptionML=[ENU=" ,Dispatch Note,Invoice";
                                                                    NOR=" ,F›lgeseddel,Faktura";
                                                                    SVE=" ,Leveransbesked,Faktura"];
                                                   OptionString=[ ,DispatchNote,Invoice];
                                                   Description=DP00065 }
    { 11012280;;Credit Memo Approved;Boolean      ;InitValue=Yes;
                                                   CaptionML=[ENU=Credit Memo Approved;
                                                              NOR=Kreditnotaen er godkjent;
                                                              SVE=Kreditnotan har godk„nts] }
    { 11012290;;Bank Account No.   ;Text34        ;CaptionML=[ENU=Bank Account No.;
                                                              NOR=Bankkontonr.;
                                                              SVE=Bankkontonr];
                                                   Editable=No }
    { 11012301;;Deliver            ;Option        ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF Deliver <> xRec.Deliver THEN
                                                                  IF (Deliver IN [Deliver::"Customer Address",Deliver::"Customer Ship-to Address"]) AND
                                                                     (xRec.Deliver IN [Deliver::"Customer Address",Deliver::"Customer Ship-to Address"])
                                                                  THEN
                                                                    VALIDATE("Ship-to Location")
                                                                  ELSE
                                                                    VALIDATE("Ship-to Location",'')
                                                                ELSE
                                                                  VALIDATE("Ship-to Location");
                                                              END;

                                                   CaptionML=[ENU=Deliver;
                                                              NOR=Lever;
                                                              SVE=Leverera till];
                                                   OptionCaptionML=[ENU=Default (Company Address),Location,Project Location,Service Location,Contact Address,Plant Location,,,Order Address,,,Customer Address,Customer Ship-to Address,Custom Address;
                                                                    NOR=" ,Lokasjon,Prosjektlokasjon,Servicelokasjon,Kontaktadresse,Maskindepot,,,Order adresse";
                                                                    SVE=" ,Lagerst„lle,Etablering,Serviceplats,Kontaktadress,Maskindep†,,,Orderadress"];
                                                   OptionString=Default (Company Address),Location,Project Location,Service Location,Contact Address,Plant Location,,,Order Address,,Service Order Address,Customer Address,Customer Ship-to Address,Custom Address }
    { 11012302;;Ship-to Location   ;Code20        ;TableRelation=IF (Deliver=CONST(Project Location)) "Project Location".Code WHERE (Project No.=FIELD(Ship-to Project))
                                                                 ELSE IF (Deliver=CONST(Location)) Location.Code
                                                                 ELSE IF (Deliver=CONST(Service Location)) "Service Order Location".Code WHERE (Service Order No.=FIELD(Service Order No.))
                                                                 ELSE IF (Deliver=CONST(Contact Address)) Contact.No.
                                                                 ELSE IF (Deliver=CONST(Plant Location)) "Plant Location".Code
                                                                 ELSE IF (Deliver=CONST(Order Address)) "Order Address".Code WHERE (Vendor No.=FIELD(Buy-from Vendor No.))
                                                                 ELSE IF (Deliver=CONST(Customer Address)) Customer.No.
                                                                 ELSE IF (Deliver=CONST(Customer Ship-to Address)) Customer.No.;
                                                   OnValidate=VAR
                                                                SaveLocationCode@1100525001 : Code[10];
                                                              BEGIN
                                                                //**4PS
                                                                SaveLocationCode := "Location Code";

                                                                CASE Deliver OF
                                                                  Deliver::Location:
                                                                    BEGIN
                                                                      CheckLocationBlocked("Ship-to Location");
                                                                      "Location Code" := "Ship-to Location";
                                                                    END;
                                                                  Deliver::"Customer Address",
                                                                  Deliver::"Customer Ship-to Address":
                                                                    VALIDATE("Sell-to Customer No.","Ship-to Location");
                                                                          END;

                                                                UpdateShipToAddress;
                                                                UpdateVATData;

                                                                IF "Location Code" <> SaveLocationCode THEN
                                                                  UpdatePurchLinesByFieldNo(FIELDNO("Location Code"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=[ENU=Ship-to Location;
                                                              NOR=Depot lokasjon;
                                                              SVE=Leverera till lagerst„lle] }
    { 11012303;;Receipts in Bundles;Boolean       ;CaptionML=[ENU=Receipts in Bundles;
                                                              NOR=Kvitteringer i bunter;
                                                              SVE=Inleveranser i paket];
                                                   Editable=No }
    { 11012304;;ICM Procedure      ;Option        ;InitValue=Send;
                                                   CaptionML=[ENU=ICM Procedure;
                                                              NOR=ICM-prosedyre;
                                                              SVE=ICM-procedur];
                                                   OptionCaptionML=[ENU=Get,Send;
                                                                    NOR=Hent,Send;
                                                                    SVE=H„mta,Skicka];
                                                   OptionString=Get,Send }
    { 11012305;;ICM File Created on;Date          ;CaptionML=[ENU=ICM File Created on;
                                                              NOR=ICM-fil opprettet den;
                                                              SVE=ICM-fil skapad den];
                                                   Editable=No }
    { 11012306;;ICM File Created   ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=ICM File Created;
                                                              NOR=ICM-fil opprettet;
                                                              SVE=ICM-fil skapad] }
    { 11012307;;ICM Login Code     ;Code2         ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor."ICM Login Code" WHERE (No.=FIELD(Buy-from Vendor No.)));
                                                   CaptionML=[ENU=ICM Login Code;
                                                              NOR=ICM-innloggingskode;
                                                              SVE=ICM-inloggningskod];
                                                   Editable=No }
    { 11012308;;ICM Order Confirm. Received;Boolean;
                                                   CaptionML=[ENU=ICM Order Confirmation Received;
                                                              NOR=ICM-ordrebekreftelse mottatt;
                                                              SVE=ICM-orderbekr„ftelse mottagen] }
    { 11012309;;ICM Order Confirm. Received on;Date;
                                                   CaptionML=[ENU=ICM Order Confirmation Received on;
                                                              NOR=ICM-ordrebekreftelse mottatt den;
                                                              SVE=ICM-orderbekr„ftelse mottagen den];
                                                   Editable=No }
    { 11012310;;ICM Confirmations  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("ICM Order Confirmation Header" WHERE (Confirmation/Error=CONST(Confirmation),
                                                                                                            Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=ICM Confirmations;
                                                              NOR=ICM-bekreftelser;
                                                              SVE=ICM-bekr„ftelser];
                                                   Editable=No }
    { 11012311;;ICM Errors         ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("ICM Order Confirmation Header" WHERE (Confirmation/Error=CONST(Error),
                                                                                                            Order No.=FIELD(No.)));
                                                   CaptionML=[ENU=ICM Errors;
                                                              NOR=ICM-feil;
                                                              SVE=ICM-fel];
                                                   Editable=No }
    { 11012312;;Amounts only       ;Boolean       ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF "Amounts only" <> xRec."Amounts only" THEN BEGIN
                                                                  PurchLine.RESET;
                                                                  PurchLine.SETRANGE("Document Type","Document Type");
                                                                  PurchLine.SETRANGE("Document No.","No.");
                                                                  IF PurchLine.FINDFIRST THEN
                                                                     ERROR(
                                                                       Text11012008,
                                                                       FIELDCAPTION("Amounts only"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Amounts only;
                                                              NOR=Kun bel›p;
                                                              SVE=Endast belopp] }
    { 11012313;;ICM Status         ;Option        ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF "ICM Status" = "ICM Status"::Create THEN
                                                                  IF "Expected Receipt Date" < TODAY THEN
                                                                    GetExpectedReceiptDate;

                                                                IF (("ICM Status" = "ICM Status"::Manual) AND (xRec."ICM Status" <> xRec."ICM Status"::Manual)) OR
                                                                   (("ICM Status" <> "ICM Status"::Manual) AND (xRec."ICM Status" = xRec."ICM Status"::Manual)) THEN
                                                                  GetDefaultPurchasePlan;

                                                                FinishPhase(FIELDNO("ICM Status"));
                                                              END;

                                                   CaptionML=[ENU=ICM Status;
                                                              NOR=ICM-status;
                                                              SVE=ICM-status];
                                                   OptionCaptionML=[ENU=Manual,Create,Created,Confirmed;
                                                                    NOR=Manuell,Opprett,Opprettet,Bekreftet;
                                                                    SVE=Manuell,skapa,skapad,bekr„ftad];
                                                   OptionString=Manual,Create,Created,Confirmed }
    { 11012314;;ICF Status         ;Option        ;CaptionML=[ENU=ICF Status;
                                                              NOR=ICF-status;
                                                              SVE=ICF-status];
                                                   OptionCaptionML=[ENU=Manual,Received,Approved;
                                                                    NOR=Manuell,Mottatt,Godkjent;
                                                                    SVE=Manuell,mottagen,godk„nd];
                                                   OptionString=Manual,Received,Approved }
    { 11012315;;Input by           ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Input by;
                                                              NOR=Input av;
                                                              SVE=Inmatat av];
                                                   Editable=No }
    { 11012316;;Input Date         ;Date          ;CaptionML=[ENU=Input Date;
                                                              NOR=Input Dato;
                                                              SVE=Inmatat den];
                                                   Editable=No }
    { 11012317;;Modified by        ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=Žndrad av];
                                                   Editable=No }
    { 11012318;;Last Date Modified ;Date          ;CaptionML=[ENU=Last Date Modified;
                                                              NOR=Oppdateringsdato;
                                                              SVE=Uppdateringsdatum];
                                                   Editable=No }
    { 11012319;;Agreed Amount      ;Decimal       ;CaptionML=[ENU=Agreed Amount;
                                                              NOR=Avtalt bel›p;
                                                              SVE=Avtalat belopp];
                                                   BlankZero=Yes;
                                                   AutoFormatType=1 }
    { 11012320;;Starting Date Subcontracting;Date ;CaptionML=[ENU=Starting Date Subcontracting;
                                                              NOR=Startdato for underentrepen›r;
                                                              SVE=Startdatum f”r Underentreprenad] }
    { 11012321;;Finishing Date Subcontracting;Date;CaptionML=[ENU=Finishing Date Subcontracting;
                                                              NOR=Fullf›ringsdato for underentrepen›r;
                                                              SVE=F„rdigdatum f”r Underentreprenad] }
    { 11012322;;Renewal Date Subcontracting;Date  ;CaptionML=[ENU=Renewal Date Subcontracting;
                                                              NOR=Fornyelsesdato for underentrepen›r;
                                                              SVE=F”rnyelsedatum f”r Underentreprenad] }
    { 11012323;;Reference (Vendor) ;Text30        ;CaptionML=[ENU=Reference (Vendor);
                                                              NOR=Referanse (Leverand›r);
                                                              SVE=Referens (leverant”r)] }
    { 11012324;;Purchase Action    ;Code10        ;TableRelation="Project Purchase Action".Code WHERE (Project No.=FIELD(Job No.));
                                                   CaptionML=[ENU=Purchase Action;
                                                              NOR=Innkj›pshandling;
                                                              SVE=Ink”ps†tg„rd] }
    { 11012325;;Copied from Purchase Quote No.;Code20;
                                                   TableRelation="Purchase Header".No. WHERE (Document Type=CONST(Quote));
                                                   CaptionML=[ENU=Copied from Purchase Quote No.;
                                                              NOR=Kopiert fra innkj›pstilbudnr;
                                                              SVE=Kopierat fr†n ink”psoffertnr];
                                                   Editable=No }
    { 11012326;;Reference (ICM)    ;Text35        ;CaptionML=[ENU=Reference (ICM);
                                                              NOR=Referanse (ICM);
                                                              SVE=Referens (ICM)] }
    { 11012330;;Price Agreement    ;Boolean       ;OnValidate=BEGIN
                                                                //**4PS
                                                                PurchSetup.GET;
                                                                IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::" " THEN
                                                                  TESTFIELD("Price Agreement", FALSE);
                                                                IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::Company THEN
                                                                  TESTFIELD("Price Agreement", TRUE);
                                                              END;

                                                   CaptionML=[ENU=Price Agreement;
                                                              NOR=Prisavtale;
                                                              SVE=Prisavtal] }
    { 11012335;;Quote Receipt Date ;Date          ;OnValidate=BEGIN
                                                                IF "Quote Receipt Date" <> xRec."Quote Receipt Date" THEN
                                                                  IF "Quote Receipt Date" <> 0D THEN
                                                                    IF "Quote Status" < "Quote Status"::Received THEN
                                                                      "Quote Status" := "Quote Status"::Received;
                                                              END;

                                                   CaptionML=[ENU=Quote Receipt Date;
                                                              NOR=Tilbudsmottaksdato;
                                                              SVE=Offertens inleveransdatum] }
    { 11012340;;Return Date Signed Contract;Date  ;OnValidate=BEGIN
                                                                //**4PS
                                                                UpdateOnHoldOfRelatedInvoices;
                                                              END;

                                                   CaptionML=[ENU=Return Date Signed Contract;
                                                              NOR=Returdato for underskrevet kontrakt;
                                                              SVE=Returdatum f”r underskrivet kontrakt] }
    { 11012345;;Contract Applicable;Boolean       ;OnValidate=BEGIN
                                                                //**4PS
                                                                UpdateOnHoldOfRelatedInvoices;
                                                              END;

                                                   CaptionML=[ENU=Contract Applicable;
                                                              NOR=Kontrakt tilgjengelig;
                                                              SVE=Till„mpliga kontrakt] }
    { 11012350;;Return Date Letter of Credit;Date ;OnValidate=BEGIN
                                                                //**4PS
                                                                UpdateOnHoldOfRelatedInvoices;
                                                                //**4PS DP00561 sn
                                                                IF "Return Date Letter of Credit" > 0D THEN
                                                                  "Letter of Credit Applied" := TRUE
                                                                ELSE
                                                                  "Letter of Credit Applied" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Apply Date Letter of Credit;
                                                              SVE=Returdatum f”r remburs] }
    { 11012351;;Letter of Credit Applied;Boolean  ;OnValidate=BEGIN
                                                                //**4PS DP00561
                                                                IF "Letter of Credit Applied" THEN BEGIN
                                                                  IF "Return Date Letter of Credit" = 0D THEN
                                                                   VALIDATE("Return Date Letter of Credit", WORKDATE);
                                                                END ELSE
                                                                  VALIDATE("Return Date Letter of Credit", 0D);
                                                              END;

                                                   CaptionML=[ENU=Letter of Credit Applied;
                                                              SVE=Letter of Credit Till„mpad] }
    { 11012370;;Related Purch. Order No.;Code20   ;TableRelation="Purchase Header".No. WHERE (Document Type=CONST(Order),
                                                                                              Buy-from Vendor No.=FIELD(Buy-from Vendor No.));
                                                   OnValidate=VAR
                                                                lvPurchHeader@1210190000 : Record 38;
                                                                VendorBankAccount@1100525002 : Record 288;
                                                                PurchaseHeaderExtension@1100529100 : Record 11020398;
                                                                NewBankAccountNo@1100525001 : Text[50];
                                                                UsePaymentDiscountOrder@1100525000 : Boolean;
                                                              BEGIN
                                                                //**4PS
                                                                IF lvPurchHeader.GET(lvPurchHeader."Document Type"::Order, "Related Purch. Order No.") THEN BEGIN
                                                                  IF "Buy-from Vendor No." = '' THEN BEGIN
                                                                    SetHideValidationDialog(TRUE);
                                                                    VALIDATE("Buy-from Vendor No.", lvPurchHeader."Buy-from Vendor No.");
                                                                    SetHideValidationDialog(FALSE);
                                                                  END ELSE BEGIN
                                                                    PurchSetup.GET;
                                                                    IF PurchSetup."Approve Purchase Invoices" THEN BEGIN
                                                                      IF (PurchSetup."Preregister WIP Purch. Inv.") THEN BEGIN
                                                                        PurchSetup.TESTFIELD("Preregistration WIP Account");
                                                                        "Purchase Registration Account" := PurchSetup."Preregistration WIP Account";
                                                                      END ELSE BEGIN
                                                                        PurchSetup.TESTFIELD("Purchase Registration Account");
                                                                        "Purchase Registration Account" := PurchSetup."Purchase Registration Account";
                                                                     END;
                                                                      "Invoice Lines Input" := PurchSetup."Default Invoice Lines Input";
                                                                    END ELSE
                                                                      "Invoice Lines Input" := TRUE;
                                                                  END;

                                                                  TESTFIELD("Buy-from Vendor No.", lvPurchHeader."Buy-from Vendor No.");
                                                                  "Buy-from Vendor Name" := lvPurchHeader."Buy-from Vendor Name";
                                                                  IF "Pay-to Vendor No." = "Buy-from Vendor No." THEN
                                                                    "Pay-to Name" := lvPurchHeader."Pay-to Name";

                                                                  VALIDATE("Invoice Lines Input");
                                                                  VALIDATE("Amounts only",lvPurchHeader."Amounts only");
                                                                  IF lvPurchHeader."Service Order No." <> '' THEN
                                                                    VALIDATE("Service Order No.", lvPurchHeader."Service Order No.")
                                                                  ELSE
                                                                    VALIDATE("Job No.", lvPurchHeader."Job No.");
                                                                  VALIDATE("Ship-to Project", lvPurchHeader."Ship-to Project");


                                                                //C027348.sn
                                                                  "Recalculate Invoice Disc." := lvPurchHeader."Recalculate Invoice Disc.";
                                                                  "Invoice Discount Calculation" := lvPurchHeader."Invoice Discount Calculation";
                                                                  "Invoice Discount Value" := lvPurchHeader."Invoice Discount Value";

                                                                  VALIDATE("Payment Terms Code",lvPurchHeader."Payment Terms Code");
                                                                  UsePaymentDiscountOrder := TRUE;
                                                                  IF "Document Type" = "Document Type"::"Credit Memo" THEN
                                                                    IF PaymentTerms.GET("Payment Terms Code") THEN
                                                                      UsePaymentDiscountOrder := PaymentTerms."Calc. Pmt. Disc. on Cr. Memos";
                                                                  IF UsePaymentDiscountOrder THEN
                                                                    VALIDATE("Payment Discount %",lvPurchHeader."Payment Discount %");
                                                                  IF lvPurchHeader."Payment Agreement" <> '' THEN BEGIN
                                                                    VALIDATE("Subcontracting Invoice", TRUE);
                                                                    VALIDATE("Payment Agreement",lvPurchHeader."Payment Agreement");
                                                                  END;
                                                                  IF lvPurchHeader.Deliver <> Deliver THEN
                                                                    VALIDATE(Deliver,lvPurchHeader.Deliver);
                                                                  VALIDATE("Ship-to Location",lvPurchHeader."Ship-to Location");
                                                                  IF lvPurchHeader."Vendor Invoice No." <> '' THEN BEGIN
                                                                    IF "Document Type" <> "Document Type"::"Credit Memo" THEN BEGIN
                                                                      IF CheckVendorInvoiceNo(lvPurchHeader."Vendor Invoice No.", FALSE, FALSE) THEN
                                                                        VALIDATE("Vendor Invoice No.",lvPurchHeader."Vendor Invoice No.");
                                                                    END ELSE BEGIN
                                                                      IF CheckVendorInvoiceNo(lvPurchHeader."Vendor Invoice No.", TRUE, FALSE) THEN
                                                                        VALIDATE("Vendor Cr. Memo No.",lvPurchHeader."Vendor Invoice No.");
                                                                    END;
                                                                  END;
                                                                  IF (lvPurchHeader."Purchaser Code" <> '') AND ("Purchaser Code" <> lvPurchHeader."Purchaser Code") THEN
                                                                    "Purchaser Code" := lvPurchHeader."Purchaser Code";
                                                                  IF (lvPurchHeader."Shortcut Dimension 2 Code" <> '') AND ("No." <> '') THEN //needed for Donau
                                                                    VALIDATE("Shortcut Dimension 2 Code", lvPurchHeader."Shortcut Dimension 2 Code");
                                                                  "Currency Code" := lvPurchHeader."Currency Code";
                                                                  "Currency Factor" := lvPurchHeader."Currency Factor";
                                                                  "Your Reference" := lvPurchHeader."Your Reference";
                                                                  "Purchase Requisition No." := lvPurchHeader."Purchase Requisition No.";
                                                                  "Back-to-back" := lvPurchHeader."Back-to-back";
                                                                  "Shipment Method Code" := lvPurchHeader."Shipment Method Code";
                                                                  "Transport Method" := lvPurchHeader."Transport Method";
                                                                  "Subcontract No." := lvPurchHeader."Subcontract No.";
                                                                  "Subcontracting Invoice" := lvPurchHeader."Subcontracting Invoice";

                                                                  PurchaseHeaderExtension.GetPurchHeadExtension(lvPurchHeader."Document Type","Related Purch. Order No.");
                                                                  PurchaseHeaderExtension.UpdatePurchHeadExtension("Document Type","No.");

                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              //**4PS
                                                              LookupRelatedOrder();
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Related Purch. Order No.;
                                                              NOR=Relatert innkj›psordrenr;
                                                              SVE=Relaterat ink”p Ordernr] }
    { 11012375;;Expediter          ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=Expediter;
                                                              NOR=Logistiker;
                                                              SVE=Logistiker] }
    { 11012377;;Valid Until        ;Date          ;CaptionML=[ENU=Valid Until;
                                                              NOR=Gyldig til;
                                                              SVE=Giltigt till] }
    { 11012378;;Expediter E-Mail   ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.E-Mail WHERE (Code=FIELD(Expediter)));
                                                   CaptionML=[ENU=Expediter E-Mail;
                                                              NOR=Logistikerens e-post;
                                                              SVE=Logistikerns e-post];
                                                   Editable=No }
    { 11012379;;Expediter Phone    ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser."Phone No." WHERE (Code=FIELD(Expediter)));
                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Expediter Phone;
                                                              NOR=Handyman-kontaktens telefon;
                                                              SVE=Logistikerns telefon];
                                                   Editable=No }
    { 11012380;;Purchase Order Type;Option        ;OnValidate=BEGIN
                                                                //**4PS
                                                                TestStatusOpen;
                                                                CheckRelatedReceiptsExist;

                                                                IF ("Document Type" = "Document Type"::Order) THEN BEGIN
                                                                  CheckPurchOrderTypeAllowed();
                                                                  IF ("Purchase Order Type" = "Purchase Order Type"::"Blanket Order") THEN
                                                                    CheckResetToReceiveBlanktOrder();
                                                                END;
                                                                GetDefaultPurchasePlan;
                                                              END;

                                                   CaptionML=[ENU=Purchase Order Type;
                                                              NOR=Innkj›psordretype;
                                                              SVE=Ink”psordertyp];
                                                   OptionCaptionML=[ENU=Purchase Order,Blanket Order,Return Order;
                                                                    NOR=Innkj›psordre,Rammeordre,Returordre;
                                                                    SVE=Ink”psorder,Avropsorder,Returorder];
                                                   OptionString=Purchase Order,Blanket Order,Return Order }
    { 11012385;;Blanket Scheme     ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Blanket Scheme" WHERE (Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Blanket Scheme;
                                                              NOR=Blankettskjema;
                                                              SVE=Avropsschema];
                                                   Editable=No }
    { 11012387;;Comparison Quote   ;Code20        ;TableRelation="Comparison Quotes"."Comparison Quote" WHERE (Type=CONST(Comparison Quote));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Document Type" <> "Document Type"::Quote) THEN
                                                                  EXIT;

                                                                IF (xRec."Comparison Quote" = "No.") AND
                                                                   (xRec."Comparison Quote" <> '') AND
                                                                   ("Comparison Quote" <> xRec."Comparison Quote")
                                                                THEN
                                                                  CheckDeleteCompQuoteAllowed();
                                                              END;

                                                   CaptionML=[ENU=Comparison Quote;
                                                              NOR=Sammenligning av tilbud;
                                                              SVE=Offertj„mf”relse] }
    { 11012390;;Extra Receipts Allowed;Boolean    ;CaptionML=[ENU=Extra Receipts Allowed;
                                                              NOR=Tillatte ekstra mottak;
                                                              SVE=Till†tna extra inleveranser] }
    { 11012391;;Purchase Order Correction;Option  ;CaptionML=[ENU=Purchase Order Correction in Receipt Page;
                                                              SVE=Ink”psorderr„ttning p† inleveranssida];
                                                   OptionCaptionML=[ENU=Not allowed,Only Negative Correction,Full Correction;
                                                                    SVE=Inte till†ten,Endast negativa r„ttningar,Alla r„ttningar];
                                                   OptionString=Not allowed,Only Negative Correction,Full Correction }
    { 11012395;;Buy-from Contact Person No.;Code20;TableRelation=Contact;
                                                   CaptionML=[ENU=Buy-from Contact Person No.;
                                                              NOR=Kj›p fra-kontaktpersonnr;
                                                              SVE=Leverant”rens kontaktpersonnr] }
    { 11012400;;Project Appointment;Integer       ;TableRelation="Appointments By Project"."Line No." WHERE (Project No.=FIELD(Job No.),
                                                                                                             Appointment Type=FIELD(Project Appointment Type));
                                                   CaptionML=[ENU=Project Appointment;
                                                              NOR=Prosjektavtale;
                                                              SVE=Projektm”te];
                                                   Editable=No }
    { 11012405;;Project Appointment Type;Option   ;CaptionML=[ENU=Appointment Type;
                                                              NOR=M›tetype;
                                                              SVE=M”testyp];
                                                   OptionCaptionML=[ENU=General,Execution,Purchase;
                                                                    NOR=Generell,Gjennomf›ring,Innkj›p;
                                                                    SVE=Allm„nt,Utf”rande,Ink”p];
                                                   OptionString=General,Execution,Purchase }
    { 11012410;;Vendors react before;Date         ;CaptionML=[ENU=Vendors react before;
                                                              SVE=Leverant”rer reagerar innan] }
    { 11012415;;Bank No. Check     ;Text3         ;OnValidate=VAR
                                                                lBankNoOK@1100485001 : Boolean;
                                                                VendorBankAccount@1100529100 : Record 288;
                                                              BEGIN
                                                                //**4PS
                                                                IF "Bank No. Check" <> '' THEN BEGIN
                                                                  PurchSetup.GET;
                                                                  IF PurchSetup."Bank Account Check" THEN BEGIN
                                                                    lBankNoOK := FALSE;
                                                                    IF (VendorBankAccount.IBAN = '') AND ("Bank Account No." = '') THEN
                                                                      ERROR(Text11012029, VendorBankAccount.FIELDCAPTION(IBAN), FIELDCAPTION("Bank Account No."));

                                                                    IF (VendorBankAccount.IBAN <> '') THEN BEGIN
                                                                      IF NOT LastThreePositionsOK("Bank Account No.") THEN //In field bank account code will be determined if field
                                                                                                                           //bank account no will be filled with IBAN or ordinary bank account no.
                                                                        ERROR(Text11012030, VendorBankAccount.FIELDCAPTION(IBAN), FIELDCAPTION("Bank No. Check"));
                                                                    END ELSE
                                                                      IF NOT LastThreePositionsOK("Bank Account No.") THEN
                                                                        ERROR(Text11012020);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Bank Check No.;
                                                              NOR=Bankkontrollnr.;
                                                              SVE=Bankkontrollnr] }
    { 11012420;;Purchase Action Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Purchase Action".Description WHERE (Project No.=FIELD(Job No.),
                                                                                                                   Code=FIELD(Purchase Action)));
                                                   CaptionML=[ENU=Purchase Action Description;
                                                              NOR=Beskrivelse av Innkj›pshandling;
                                                              SVE=Beskrivning av ink”ps†tg„rd];
                                                   Editable=No }
    { 11012425;;Reminder Terms Code;Code10        ;TableRelation="Purch. Reminder Terms";
                                                   CaptionML=[ENU=Reminder Terms Code;
                                                              NOR=Betalingsp†minnelsekode;
                                                              SVE=Betalningsp†minnelsekod] }
    { 11012430;;Interest Date      ;Date          ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Interest Date" > "Posting Date") THEN
                                                                  FIELDERROR("Interest Date",STRSUBSTNO(Text11012016, "Interest Date", FIELDCAPTION("Posting Date"),"Posting Date"));
                                                              END;

                                                   CaptionML=[ENU=Interest Date;
                                                              NOR=Rentedato;
                                                              SVE=R„ntedatum] }
    { 11012450;;Document Confirmation Received;Boolean;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                FinishPhase(FIELDNO("Document Confirmation Received"));
                                                              END;

                                                   CaptionML=[ENU=Document Confirmation Received;
                                                              NOR=Dokumentbekreftelse mottatt;
                                                              SVE=Dokumentbekr„ftelse har tagits emot] }
    { 11012460;;Consumption per Location;Boolean  ;CaptionML=[ENU=Consumption per Location;
                                                              NOR=Forbruk per lokasjon;
                                                              SVE=F”rbrukning per lagerst„lle] }
    { 11012480;;Subcontract No.    ;Code20        ;TableRelation="Subcontractor Contract".No. WHERE (Vendor No.=FIELD(Buy-from Vendor No.),
                                                                                                     Project No.=FIELD(Job No.));
                                                   OnValidate=VAR
                                                                SubcontracterContract@1100528500 : Record 11020635;
                                                              BEGIN
                                                                //**4PS
                                                                TestStatusOpen;
                                                                IF "Subcontract No." <> '' THEN BEGIN
                                                                  SubcontracterContract.GET("Buy-from Vendor No.", "Subcontract No.");
                                                                  VALIDATE("Currency Code",SubcontracterContract."Currency Code");
                                                                END;

                                                                PurchLine.RESET;
                                                                PurchLine.SETRANGE("Document Type","Document Type");
                                                                PurchLine.SETRANGE("Document No.","No.");
                                                                PurchLine.SETFILTER("No.",'<>%1','');
                                                                IF PurchLine.FINDSET(TRUE) THEN
                                                                  REPEAT
                                                                    IF PurchLine."Job No." <> "Job No." THEN
                                                                      PurchLine.VALIDATE("Job No.","Job No.");
                                                                    PurchLine.MODIFY(TRUE);
                                                                  UNTIL PurchLine.NEXT = 0;
                                                                PurchLine.SETRANGE("No.");
                                                              END;

                                                   CaptionML=[ENU=Subcontract No.;
                                                              NOR=Underentrepren›rnr.;
                                                              SVE=Underentrepren”rsnr];
                                                   Description=Retention }
    { 11012490;;Pay VAT Amt. on B-Acc. Vendor;Boolean;
                                                   CaptionML=ENU=Pay VAT Amount on B-Account Vendor }
    { 11012580;;Amount VAT Lines   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Line VAT Amount" WHERE (Document Type=FIELD(Document Type),
                                                                                                            Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Amount VAT Lines;
                                                              NOR=Mva-bel›psrader;
                                                              SVE=Momsbeloppsrader];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012590;;Ext. Document ID   ;Text35        ;CaptionML=[ENU=Ext. Document ID;
                                                              NOR=Ext. dokument-ID;
                                                              SVE=Ext. Dokument-ID] }
    { 11012600;;E-Mail Sent on     ;Date          ;CaptionML=[ENU=Email Sent on;
                                                              SVE=E-post skickades den] }
    { 11012610;;E-Mail Sent by     ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Email Sent by;
                                                              SVE=E-post skickades av] }
    { 11012620;;Register Invoice   ;Boolean       ;CaptionML=[ENU=Register Invoice;
                                                              NOR=Registrer faktura;
                                                              SVE=Registrera faktura] }
    { 11012625;;Markedonly Receipt Run;Boolean    ;CaptionML=[ENU=Markedonly Receipt Run;
                                                              SVE=Anv„nd enbart markerade leveranser] }
    { 11012630;;Company VAT Registration No.;Text20;
                                                   CaptionML=[ENU=Company VAT Registration No.;
                                                              NOR=Selskapets momsregistreringsnr;
                                                              SVE=F”retagets momsregistreringsnr];
                                                   Editable=No }
    { 11012640;;Country of Origin  ;Code10        ;TableRelation=Country/Region;
                                                   OnValidate=BEGIN
                                                                UpdateVATGroup; //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Country of Origin;
                                                              NOR=Opprinnelsesland;
                                                              SVE=Ursprungsland];
                                                   Editable=No }
    { 11012650;;Country of Destination;Code10     ;TableRelation=Country/Region;
                                                   OnValidate=BEGIN
                                                                UpdateVATGroup; //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Country of Destination;
                                                              NOR=Destinasjonsland;
                                                              SVE=Destinationsland];
                                                   Editable=No }
    { 11012660;;Approval Comment   ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Approval Comment Line" WHERE (Table ID=CONST(38),
                                                                                                    Document Type=FIELD(Document Type),
                                                                                                    Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Approval Comment;
                                                              SVE=Godk„nnandekommentar];
                                                   Editable=No }
    { 11012700;;Estimate No.       ;Code20        ;TableRelation=Estimate;
                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr] }
    { 11012710;;Closing Date       ;Date          ;CaptionML=[ENU=Closing Date;
                                                              SVE=Avslutsdatum] }
    { 11012750;;Purchase Requisition No.;Code20   ;TableRelation="Purchase Requisition";
                                                   CaptionML=[ENU=Purchase Requisition No.;
                                                              SVE=Ink”psrekvisition nr];
                                                   Description=DP01137;
                                                   Editable=No }
    { 11012755;;Requested Quote Receipt Date;Date ;CaptionML=[ENU=Requested Quote Receipt Date;
                                                              NOR=Kvitteringsdato for anmodet tilbud;
                                                              SVE=Inleveransdatum f”r beg„rd offert];
                                                   Description=DP01137 }
    { 11012800;;Service Order No.  ;Code20        ;TableRelation="Service Order".No.;
                                                   OnValidate=BEGIN
                                                                //**4PS.n
                                                                IF "Service Order No." <> '' THEN BEGIN
                                                                  TESTFIELD("Job No.", '');
                                                                  ServOrderRec.GET("Service Order No.");
                                                                  ServOrderRec.TestServiceContractMandatory;
                                                                  ServOrderRec.CheckStatus(1);
                                                                  END;

                                                                IF CurrFieldNo = FIELDNO("Service Order No.") THEN  //do not disturb default set by advice order
                                                                  UpdateDeliver(FIELDNO("Service Order No."));

                                                                UpdateOrderAddressByDepartment;

                                                                CreateDim(
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::Campaign,"Campaign No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");

                                                                FillReferenceICM;
                                                              END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr;
                                                              SVE=Serviceordernr] }
    { 11012801;;Service Order Description;Text50  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Description WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Service Order Description;
                                                              NOR=Serviceordre Beskrivelse;
                                                              SVE=Serviceorder beskrivning];
                                                   Editable=No }
    { 11012810;;Buy-from Phone No. ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No.;
                                                              NOR=Telefonnr;
                                                              SVE=Telefonnr] }
    { 11012820;;Buy-from Fax No.   ;Text30        ;CaptionML=[ENU=Fax No.;
                                                              NOR=Telefaxnr;
                                                              SVE=Telefaxnr] }
    { 11012830;;QuoteIsOrdered     ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Purchase Header" WHERE (Document Type=CONST(Order),
                                                                                              Copied from Purchase Quote No.=FIELD(No.)));
                                                   CaptionML=[ENU=Quote is Order;
                                                              NOR=Tilbudet er ordre;
                                                              SVE=Offerten „r order];
                                                   Editable=No }
    { 11012840;;Original Order No. ;Code20        ;TableRelation="Purchase Header".No. WHERE (Document Type=CONST(Order),
                                                                                              Purchase Order Type=CONST(Purchase Order));
                                                   CaptionML=[ENU=Original Order No.;
                                                              NOR=Opprinnelig ordrenr;
                                                              SVE=Ursprungligt ordernr];
                                                   Editable=No }
    { 11012850;;Shipping Agent Code;Code10        ;TableRelation="Shipping Agent";
                                                   CaptionML=[ENU=Shipping Agent Code;
                                                              NOR=Transport›rkode;
                                                              SVE=Spedit”rkod] }
    { 11012860;;Package Tracking No.;Text30       ;CaptionML=[ENU=Package Tracking No.;
                                                              NOR=Pakkesporingsnr;
                                                              SVE=Godsupplysningsnr] }
    { 11012880;;Name Purchaser     ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Purchaser Code)));
                                                   CaptionML=[ENU=Name Purchaser;
                                                              NOR=Navn p† Innkj›per;
                                                              SVE=Namn p† ink”pare];
                                                   Editable=No }
    { 11012890;;Purchase Plan      ;Code10        ;TableRelation=IF (Document Type=CONST(Quote)) "Purchase Plan" WHERE (Applies to=FILTER(PurchQuote))
                                                                 ELSE IF (Document Type=CONST(Order)) "Purchase Plan" WHERE (Applies to=FILTER(PurchOrder));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                CheckPurchPlanPermission;
                                                                CreateDocPhases;
                                                              END;

                                                   CaptionML=[ENU=Purchase Plan;
                                                              NOR=Innkj›psplan;
                                                              SVE=Ink”psplan] }
    { 11012891;;Purchase Plan Phase;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Phase"."Phase No." WHERE (Document No.=FIELD(No.),
                                                                                                          Purchase Plan=FIELD(Purchase Plan),
                                                                                                          Status=CONST(Current)));
                                                   CaptionML=[ENU=Purchase Plan Phase;
                                                              NOR=Planleggingsfase for Innkj›p;
                                                              SVE=Ink”psplansfas];
                                                   BlankZero=Yes }
    { 11012900;;Return Date Safety/Health-plan;Date;
                                                   CaptionML=[ENU=Return Date Safety and Health-plan;
                                                              NOR=Returdato for sikkerhets- og helseplan;
                                                              SVE=Returdatum f”r s„kerhets- och h„lsoplan] }
    { 11012910;;Warranty Data present;Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Warranty Data per Purch. Order" WHERE (Document Type=FIELD(Document Type),
                                                                                                             Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Warranty Data present;
                                                              NOR=Garantidato finnes;
                                                              SVE=Garantiinformation finns];
                                                   Editable=No }
    { 11012920;;Electronic Order Type;Option      ;CaptionML=[ENU=Electronic Order Type;
                                                              NOR=Elektronisk ordretype;
                                                              SVE=Elektronisk ordertyp];
                                                   OptionCaptionML=ENU=Standard,ICM/ICF,E-mail,GS1 (SOAP),GS1 (XML-RPC),GS1 INSBOU,,,,E-Mail Contact Person;
                                                   OptionString=Standard,ICM/ICF,E-mail,GS1 (SOAP),GS1 (XML-RPC),GS1 INSBOU,,,,E-Mail Contact Person;
                                                   Editable=No }
    { 11012930;;E-Mail for Purch. Order;Text80    ;CaptionML=[ENU=Email for Purch. Order;
                                                              NOR=E-post for innkj›psordre;
                                                              SVE=E-post f”r ink”psorder] }
    { 11012940;;Processing Type    ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Purchase Header Extension"."Processing Type" WHERE (Document Type=FIELD(Document Type),
                                                                                                                           Document No.=FIELD(No.)));
                                                   CaptionML=ENU=Processing Type;
                                                   OptionCaptionML=ENU=Normal,INSBOU;
                                                   OptionString=Normal,INSBOU;
                                                   Editable=No }
    { 11020240;;Tolerate Exceeding Invoice Qu.;Boolean;
                                                   CaptionML=[ENU=Tolerate Invoice Quantity Exceeding  Received Quantity;
                                                              SVE=Till†t att fakturerat antal ”verstiger mottaget antal] }
    { 11020258;;Payment Discount % 2;Decimal      ;OnValidate=BEGIN
                                                                IF NOT (CurrFieldNo IN [0,FIELDNO("Posting Date"),FIELDNO("Document Date")]) THEN
                                                                  TestStatusOpen;
                                                              END;

                                                   CaptionML=[ENU=Payment Discount % 2;
                                                              NOR=Kontantrabatt % 2;
                                                              SVE=Kassarabatt % 2];
                                                   DecimalPlaces=0:5 }
    { 11020259;;Pmt. Discount Date 2;Date         ;CaptionML=[ENU=Pmt. Discount Date 2;
                                                              NOR=Kontantrabattdato 2;
                                                              SVE=Kassa Rabattdatum 2] }
    { 11020260;;Payment Discount % 3;Decimal      ;OnValidate=BEGIN
                                                                IF NOT (CurrFieldNo IN [0,FIELDNO("Posting Date"),FIELDNO("Document Date")]) THEN
                                                                  TestStatusOpen;
                                                              END;

                                                   CaptionML=[ENU=Payment Discount % 3;
                                                              NOR=Kontantrabatt % 3;
                                                              SVE=Kassarabatt % 3];
                                                   DecimalPlaces=0:5 }
    { 11020261;;Pmt. Discount Date 3;Date         ;CaptionML=[ENU=Pmt. Discount Date 3;
                                                              NOR=Kontantrabattdato 3;
                                                              SVE=Kassa Rabattdatum 3] }
    { 11020270;;Order Approval Entry Present;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("Approval Entry" WHERE (Table ID=CONST(38),
                                                                                             Document Type=CONST(Order),
                                                                                             Document No.=FIELD(No.),
                                                                                             Status=FILTER(Open|Created)));
                                                   CaptionML=[ENU=Order Approval Entry Present;
                                                              SVE=Ordergodk„nnanderad tillg„nglig];
                                                   Editable=No }
    { 11020271;;Quote Approval Entry Present;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("Approval Entry" WHERE (Table ID=CONST(38),
                                                                                             Document Type=CONST(Quote),
                                                                                             Document No.=FIELD(No.),
                                                                                             Status=FILTER(Open|Created)));
                                                   CaptionML=ENU=Quote Approval Entry Present }
    { 11020275;;Consented Date-Time;DateTime      ;CaptionML=[ENU=Consented Date-Time;
                                                              SVE=Godk„nd Datum-Tid];
                                                   Editable=No }
    { 11020277;;Approval Code      ;Code20        ;TableRelation="Approval Code 4PS".Code;
                                                   CaptionML=[ENU=Approval Code;
                                                              NOR=Godkjenningskode;
                                                              SVE=Godk„nnandekod] }
    { 11020280;;ICM File Sent      ;Boolean       ;CaptionML=[ENU=ICM File Sent;
                                                              NOR=ICM-fil er sendt;
                                                              SVE=ICM-fil har skickats];
                                                   Editable=No }
    { 11020290;;Resource Request No.;Code20       ;TableRelation="Resource Request";
                                                   CaptionML=[ENU=Resource Request No.;
                                                              SVE=Resursbeg„ran nr];
                                                   Editable=No }
    { 11020500;;Back-to-back       ;Boolean       ;CaptionML=ENU=Back-to-back;
                                                   Description=BI032 }
    { 11020510;;Processing Status SiB Invoice;Option;
                                                   CaptionML=ENU=Processing Status SiB invoice;
                                                   OptionCaptionML=ENU=" ,Complete Match,No OrderNumber Filled In,No (Complete) Match,No ReceiptLines found";
                                                   OptionString=[ ,Complete Match,No OrderNumber Filled In,No (Complete) Match,No ReceiptLines found] }
    { 11020520;;Processing Result SiB Invoice;Option;
                                                   CaptionML=ENU=Processing Result SiB Invoice;
                                                   OptionCaptionML=ENU=" ,Waiting,Failure,Success,External";
                                                   OptionString=[ ,Waiting,Failure,Success,External] }
    { 11127975;;Export to Symbrio  ;Boolean       ;CaptionML=SVE=Exportera till Symbrio;
                                                   Description=SYM037 }
    { 11127976;;Export to Symbrio Type;Option     ;CaptionML=[ENU=Export to Symbrio Type;
                                                              NOR=Eksporter til symbriotype;
                                                              SVE=Exportera till Symbrio Typ];
                                                   OptionCaptionML=[ENU=" ,Prelimary,Definitive";
                                                                    NOR=" ,Prelim.,Definitivt";
                                                                    SVE=" ,Prelimin„r,Definitiv"];
                                                   OptionString=[ ,Prelimary,Definitive];
                                                   Description=Symbrio Invoice Handling }
    { 11128000;;Document Sent By   ;Option        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Document Sent By;
                                                   OptionCaptionML=ENU=Manually,E-mail,File;
                                                   OptionString=Manually,E-mail,File }
    { 11128001;;Fast Order         ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Fast Order;
                                                              SVE=Snabborder] }
    { 12013591;;ExFlow Document Type;Option       ;CaptionML=[ENU=ExFlow Document Type;
                                                              SVE=ExFlow dokumenttyp];
                                                   OptionCaptionML=[ENU=" ,Invoice,Credit Memo,Prepayment";
                                                                    SVE=" ,Faktura,Kreditnota,F”rskottsbetalning"];
                                                   OptionString=[ ,Invoice,Credit Memo,Prepayment];
                                                   Description=ExFlow }
    { 12013601;;New Line           ;Boolean       ;CaptionML=[ENU=New Line;
                                                              NOR=Ny linje;
                                                              SVE=Ny rad];
                                                   Description=ExFlow }
    { 12013603;;Approve            ;Boolean       ;OnValidate=BEGIN
                                                                // ExFlow ->
                                                                IF ExFlowSetup.GET THEN
                                                                ExFlow.ValidateApprovePurchHeader(xRec,Rec);
                                                                // <- ExFlow
                                                              END;

                                                   CaptionML=[ENU=Approve;
                                                              NOR=Godkjenn;
                                                              SVE=Godk„nn];
                                                   Description=ExFlow }
    { 12013604;;Remaining Amount   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Outstanding Amount (LCY)" WHERE (Document Type=FIELD(Document Type),
                                                                                                                     Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Remaining Amount;
                                                              NOR=Gjenst†ende bel›p;
                                                              SVE=terst†ende belopp];
                                                   Description=ExFlow;
                                                   Editable=No }
    { 12013605;;Gross Invoice Amount ExFlow;Decimal;
                                                   OnValidate=BEGIN
                                                                IF ExFlowSetup.GET THEN BEGIN
                                                                  "Amount incl. VAT" := "Gross Invoice Amount ExFlow"; // 4PS
                                                                  "Amount excl. VAT" := "Gross Invoice Amount ExFlow" -"VAT Amount"; // 4PS
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Gross Invoice Amount;
                                                              SVE=Fakturabelopp brutto];
                                                   Description=ExFlow }
    { 12013606;;Import VAT Amount  ;Decimal       ;OnValidate=BEGIN
                                                                IF ExFlowSetup.GET THEN BEGIN
                                                                  "Amount incl. VAT" := "Gross Invoice Amount ExFlow"; // 4PS
                                                                  "VAT Amount" := "Import VAT Amount"; // 4PS
                                                                  "Amount excl. VAT" := "Gross Invoice Amount ExFlow" - "VAT Amount"; // 4PS
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Imported VAT Amount;
                                                              SVE=Importerat momsbelopp];
                                                   Description=ExFlow }
    { 12013609;No;Requisition No.  ;Code20        ;CaptionML=[ENU=Requisition No.;
                                                              SVE=Rekvisitionsnr];
                                                   Description=ExFlow }
    { 12013610;;Remaining to Invoice;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amt. Rcd. Not Invoiced" WHERE (Document Type=FIELD(Document Type),
                                                                                                                   Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=Remaining Amount;
                                                              NOR=Gjenst†ende bel›p;
                                                              SVE=terst†ende belopp];
                                                   Description=ExFlow;
                                                   Editable=No }
    { 12013613;;Propose VAT Line   ;Boolean       ;CaptionML=[ENU=Propose VAT Line;
                                                              SVE=Moms f”rslagsrad];
                                                   Description=ExFlow }
    { 12013622;No;Prepayment Order No.;Code20     ;TableRelation="Purchase Header".No. WHERE (Document Type=CONST(Order));
                                                   CaptionML=[ENU=Prepayment Order No.;
                                                              NOR=Ordrenummer for forskudd;
                                                              SVE=Ordernr f”r f”rskottsbetalning];
                                                   Description=ExFlow }
    { 12013638;;Block Document     ;Option        ;CaptionML=[ENU=Block Document;
                                                              SVE=Stoppa Dokument];
                                                   OptionCaptionML=[ENU=" ,,Posting";
                                                                    SVE=" ,,Bokf”ring"];
                                                   OptionString=[ ,,Posting];
                                                   Description=ExFlow }
    { 12013640;;Receipt No. Mandatory;Boolean     ;OnValidate=BEGIN
                                                                // ExFlow ->
                                                                IF ExFlowSetup.GET THEN
                                                                  UpdatePurchLines(FIELDCAPTION("Receipt No. Mandatory"),CurrFieldNo <> 0);
                                                                // <- ExFlow
                                                              END;

                                                   CaptionML=[ENU=Receipt No. Mandatory;
                                                              SVE=Inleveransnr obligatoriskt];
                                                   Description=ExFlow }
    { 12047960;;Inward Registrated ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Inward Reg. Header" WHERE (Document Type=FIELD(Document Type),
                                                                                                 Document No.=FIELD(No.),
                                                                                                 Status=FILTER(>New)));
                                                   CaptionML=ENU=Inward Registrated;
                                                   Description=PEB0010 (12047960);
                                                   Editable=No }
    { 12047961;;OCR No.            ;Code30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Purchase Header Extension"."OCR No." WHERE (Document Type=FIELD(Document Type),
                                                                                                                   Document No.=FIELD(No.)));
                                                   CaptionML=[ENU=OCR No.;
                                                              SVE=OCR nr];
                                                   Description=PEB0091 (12047961);
                                                   Editable=No }
    { 12047962;;Recipient Bank Account;Code10     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Purchase Header Extension"."Recipient Bank Account" WHERE (Document Type=FIELD(Document Type),
                                                                                                                                  Document No.=FIELD(No.)));
                                                   TableRelation="Vendor Bank Account".Code WHERE (Vendor No.=FIELD(Pay-to Vendor No.));
                                                   CaptionML=[ENU=Recipient Bank Account;
                                                              SVE=Mottagarens bankkonto];
                                                   Description=PEB0091 (12047962);
                                                   Editable=No }
    { 15000000;;KID                ;Code30        ;OnValidate=VAR
                                                                Tools@1080000 : Codeunit 11128515;
                                                                ErrorMess@1080001 : Text[250];
                                                              BEGIN
                                                                IF KID <> '' THEN BEGIN
                                                                  ErrorMess := Tools.CheckKID(KID);
                                                                  IF ErrorMess <> '' THEN
                                                                    ERROR(ErrorMess);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=KID;
                                                              NOR=KID;
                                                              SVE=KID];
                                                   Description=NAVNO (15000000) }
    { 15000014;;Payment Type Code Abroad;Code2    ;TableRelation="Payment Type Code Abroad";
                                                   CaptionML=[ENU=Payment Type Code Abroad;
                                                              NOR=Betalingsartkode utland;
                                                              SVE=Betalningstypkod, utland];
                                                   Description=NAVNO (15000014) }
    { 15000015;No;Specification (Norges Bank);Code60;
                                                   CaptionML=[ENU=Specification (Norges Bank);
                                                              NOR=Spesifikasjon (Norges Bank)];
                                                   Description=NAVNO (15000015) }
    { 32000000;;Message Type       ;Option        ;FieldClass=FlowField;
                                                   InitValue=Reference No.;
                                                   CalcFormula=Lookup("Purchase Header Extension"."Message Type" WHERE (Document Type=FIELD(Document Type),
                                                                                                                        Document No.=FIELD(No.)));
                                                   OnValidate=BEGIN
                                                                //RefNoCheck.PurchMessageCheck(Rec);
                                                              END;

                                                   CaptionML=[ENU=Message Type;
                                                              SVE=Meddelandetyp];
                                                   OptionCaptionML=ENU=Reference No.,Invoice Information,Message,Long Message,Tax Message;
                                                   OptionString=Reference No.,Invoice Information,Message,Long Message,Tax Message;
                                                   Description=NAVFI (32000000);
                                                   Editable=No }
    { 32000001;;Invoice Message    ;Text128       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Purchase Header Extension"."Invoice Message" WHERE (Document Type=FIELD(Document Type),
                                                                                                                           Document No.=FIELD(No.)));
                                                   OnValidate=BEGIN
                                                                // IF ("Invoice Message" <> '') AND ("Message Type" = "Message Type"::"Reference No.") THEN BEGIN
                                                                //  IF STRLEN("Invoice Message")  > 20 THEN
                                                                //    ERROR(Text1090000, FIELDCAPTION("Invoice Message"), 20);
                                                                //  RefNoCheck.InvReferenceCheck("Invoice Message");
                                                                // END;
                                                                //
                                                                // IF "Message Type" = "Message Type"::Message THEN
                                                                //  IF STRLEN("Invoice Message") > 70 THEN
                                                                //    ERROR(Text1090000, FIELDCAPTION("Invoice Message"), 70);
                                                                //
                                                                // IF ("Invoice Message" <> '') AND ("Message Type" = "Message Type"::"Tax Message") THEN BEGIN
                                                                //  IF STRLEN("Invoice Message")  > 20 THEN
                                                                //    ERROR(Text1090000, FIELDCAPTION("Invoice Message"), 20);
                                                                //  RefNoCheck.InvReferenceCheck("Invoice Message");
                                                                // END;
                                                              END;

                                                   CaptionML=ENU=Invoice Message;
                                                   Description=NAVFI (32000001) 250->128;
                                                   Editable=No }
    { 32000002;No;Invoice Message 2;Text250       ;OnValidate=BEGIN
                                                                //IF "Message Type" = "Message Type"::"Long Message" THEN
                                                                //  IF STRLEN("Invoice Message" + "Invoice Message 2") > 420 THEN
                                                                //    ERROR(Text1090003, FIELDCAPTION("Invoice Message"), FIELDCAPTION("Invoice Message 2"), 420);
                                                              END;

                                                   CaptionML=ENU=Invoice Message 2;
                                                   Description=NAVFI (32000002) }
  }
  KEYS
  {
    {    ;Document Type,No.                       ;Clustered=Yes }
    {    ;No.,Document Type                        }
    {    ;Document Type,Buy-from Vendor No.        }
    {    ;Document Type,Pay-to Vendor No.          }
    {    ;Buy-from Vendor No.,Vendor Authorization No. }
    {    ;Incoming Document Entry No.              }
    {    ;Document Date                            }
    {    ;Status,Expected Receipt Date,Location Code,Responsibility Center }
    {    ;Assigned User ID                         }
    {    ;Induction Note No.                       }
    {    ;Document Type,Job No.                    }
    {    ;Document Type,Copied from Purchase Quote No. }
    {    ;Vendor Invoice No.                       }
    {    ;Vendor Cr. Memo No.                      }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text003@1003 : TextConst 'ENU=You cannot rename a %1.;NOR=Du kan ikke gi nytt navn til en %1.;SVE=Du kan inte byta namn p† %1.';
      ConfirmChangeQst@1004 : TextConst '@@@="%1 = a Field Caption like Currency Code";ENU=Do you want to change %1?;NOR=Vil du endre %1?;SVE=Vill du „ndra %1?';
      Text005@1005 : TextConst 'ENU=You cannot reset %1 because the document still has one or more lines.;NOR=Du kan ikke nullstille %1 fordi dokumentet fremdeles har ‚n eller flere linjer.;SVE=Du kan inte †terst„lla %1 d„rf”r att dokumentet har en eller flera rader.';
      YouCannotChangeFieldErr@1006 : TextConst '@@@=%1 - fieldcaption;ENU=You cannot change %1 because the order is associated with one or more sales orders.;NOR=Du kan ikke endre %1 fordi bestillingen er tilknyttet ‚n eller flere ordrer.;SVE=Du kan inte „ndra %1 d„rf”r ink”psordern „r kopplad till en eller flera f”rs.order.';
      Text007@1007 : TextConst 'ENU=%1 is greater than %2 in the %3 table.\;NOR=%1 er st›rre enn %2 i tabellen %3.\;SVE=%1 „r st”rre „n %2 i tabellen %3.\';
      Text008@1008 : TextConst 'ENU=Confirm change?;NOR=Bekrefte endring?;SVE=Bekr„fta f”r„ndring?';
      Text009@1009 : TextConst '@@@="%1 = Document No.";ENU=Deleting this document will cause a gap in the number series for receipts. An empty receipt %1 will be created to fill this gap in the number series.\\Do you want to continue?;NOR=Hvis dokumentet slettes, vil det oppst† et hull i nummerserien for mottak. Det opprettes et tomt mottak %1 for † fylle dette hullet i nummerserien.\\Vil du fortsette?;SVE=Borttagning av detta dokument kommer att orsaka en lucka i nummerserien f”r inleveranser. En tom inleverans %1 skapas f”r att fylla luckan i nummerserien.\\Vill du forts„tta?';
      Text012@1012 : TextConst '@@@="%1 = Document No.";ENU=Deleting this document will cause a gap in the number series for posted invoices. An empty posted invoice %1 will be created to fill this gap in the number series.\\Do you want to continue?;NOR=Hvis dokumentet slettes, vil det oppst† et hull i nummerserien for bokf›rte fakturaer. Det opprettes en tom bokf›rt faktura %1 for † fylle dette hullet i nummerserien.\\Vil du fortsette?;SVE=Borttagning av detta dokument kommer att orsaka en lucka i nummerserien f”r bokf”rda fakturor. En tom bokf”rd faktura %1 skapas f”r att fylla luckan i nummerserien.\\Vill du forts„tta?';
      Text014@1014 : TextConst '@@@="%1 = Document No.";ENU=Deleting this document will cause a gap in the number series for posted credit memos. An empty posted credit memo %1 will be created to fill this gap in the number series.\\Do you want to continue?;NOR=Hvis dokumentet slettes, vil det oppst† et hull i nummerserien for bokf›rte kreditnotaer. Det opprettes en tom bokf›rt kreditnota %1 for † fylle dette hullet i nummerserien.\\Vil du fortsette?;SVE=Borttagning av detta dokument kommer att orsaka en lucka i nummerserien f”r bokf”rda kreditnotor. En tom bokf”rd kreditnota %1 skapas f”r att fylla luckan i nummerserien.\\Vill du forts„tta?';
      RecreatePurchLinesMsg@1016 : TextConst '@@@=%1: FieldCaption;ENU=If you change %1, the existing purchase lines will be deleted and new purchase lines based on the new information in the header will be created.\\Do you want to continue?;NOR=Hvis du endrer %1, slettes eksisterende bestillingslinjer mens det opprettes nye bestillingslinjer basert p† nye opplysninger i hodet.\\Vil du fortsette?;SVE=Om du „ndrar %1 kommer befintliga ink”psrader att tas bort och nya ink”psrader baserade p† den nya informationen i huvudet kommer att skapas.\\';
      ResetItemChargeAssignMsg@1093 : TextConst '@@@=%1: FieldCaption;ENU=If you change %1, the existing purchase lines will be deleted and new purchase lines based on the new information in the header will be created.\The amount of the item charge assignment will be reset to 0.\\Do you want to continue?;NOR=Hvis du endrer %1, slettes eksisterende kj›pslinjer mens det opprettes nye kj›pslinjer basert p† nye opplysninger i overskriften.\Bel›pet for varegebyrtilordningen blir tilbakestilt til 0.\\Vil du fortsette?';
      LinesNotUpdatedMsg@1018 : TextConst '@@@=You have changed Posting Date on the purchase header, but it has not been changed on the existing purchase lines.;ENU=You have changed %1 on the purchase header, but it has not been changed on the existing purchase lines.;NOR=Du har endret %1 i bestillingshodet, men det er ikke blitt endret p† eksisterende bestillingslinjer.;SVE=Du har „ndrat p† %1 p† ink”pshuvudet men det har inte „ndrats p† de befintliga ink”psraderna.\';
      Text020@1019 : TextConst 'ENU=You must update the existing purchase lines manually.;NOR=Du m† oppdatere eksisterende bestillingslinjer manuelt.;SVE=Du m†ste uppdatera de befintliga  ink”psraderna manuellt.';
      AffectExchangeRateMsg@1020 : TextConst 'ENU=The change may affect the exchange rate that is used for price calculation on the purchase lines.;NOR=Endringen kan p†virke valutakursen som brukes til prisberegning p† kj›pslinjene.;SVE=Žndringen kan p†verka v„xelkursen som anv„nts vid prisber„kning av ink”psrader.';
      Text022@1021 : TextConst 'ENU=Do you want to update the exchange rate?;NOR=Vil du oppdatere valutakursen?;SVE=Vill du uppdatera valutakursen?';
      Text023@1022 : TextConst 'ENU=You cannot delete this document. Your identification is set up to process from %1 %2 only.;NOR=Du kan ikke slette dette dokumentet. Identifikasjonen din er angitt til bare † behandle fra %1 %2.;SVE=Du kan inte ta bort dokumentet. Ditt ID „r upplagt f”r bearbetning fr†n endast %1 %2.';
      Text025@1024 : TextConst 'ENU=You have modified the %1 field. Note that the recalculation of VAT may cause penny differences, so you must check the amounts afterwards.;NOR="Du har endret feltet %1. Merk at gjenberegningen av mva. kan gi noen kroners differanse, og at du m† kontrollere bel›pene etterp†. ";SVE="Du har „ndrat f„ltet %1. Observera att omr„kningen av moms kan orsaka ”resskillnader, s† du m†ste efter†t kontrollera beloppen. "';
      Text027@1026 : TextConst 'ENU=Do you want to update the %2 field on the lines to reflect the new value of %1?;NOR=Vil du oppdatere feltet %2 p† linjene slik at de gjenspeiler den nye verdien for %1?;SVE=Vill du uppdatera f„ltet %2 p†  raderna f”r att †terspegla det nya v„rdet av %1?';
      Text028@1027 : TextConst 'ENU=Your identification is set up to process from %1 %2 only.;NOR=Identifikasjonen din er angitt til bare † behandle fra %1 %2.;SVE=Ditt ID „r upplagt f”r bearbetning fr†n endast %1 %2.';
      Text029@1028 : TextConst '@@@="%1 = Document No.";ENU=Deleting this document will cause a gap in the number series for return shipments. An empty return shipment %1 will be created to fill this gap in the number series.\\Do you want to continue?;NOR=Hvis du sletter dette dokumentet, vil det medf›re et hull i nummerserien for returforsendelser. Det opprettes en tom returforsendelse %1 for † fylle dette hullet i nummerserien.\\Vil du fortsette?;SVE=Borttagning av detta dokument kommer att orsaka en lucka i nummerserien f”r returutleveranser. En tom returutleverans %1 skapas f”r att fylla luckan i nummerserien.\\Vill du forts„tta?';
      Text032@1031 : TextConst '@@@=You have modified Currency Factor.\\Do you want to update the lines?;ENU=You have modified %1.\\Do you want to update the lines?;NOR=Du har endret %1.\\Vil du oppdatere linjene?;SVE=Du har „ndrat %1.\\';
      PurchSetup@1033 : Record 312;
      GLSetup@1034 : Record 98;
      GLAcc@1035 : Record 15;
      PurchLine@1036 : Record 39;
      xPurchLine@1080 : Record 39;
      VendLedgEntry@1037 : Record 25;
      Vend@1038 : Record 23;
      PaymentTerms@1039 : Record 3;
      PaymentMethod@1040 : Record 289;
      CurrExchRate@1041 : Record 330;
      PurchHeader@1042 : Record 38;
      PurchCommentLine@1043 : Record 43;
      Cust@1045 : Record 18;
      CompanyInfo@1046 : Record 79;
      PostCode@1047 : Record 225;
      OrderAddr@1048 : Record 224;
      BankAcc@1049 : Record 270;
      PurchRcptHeader@1050 : Record 120;
      PurchInvHeader@1051 : Record 122;
      PurchCrMemoHeader@1052 : Record 124;
      ReturnShptHeader@1053 : Record 6650;
      PurchInvHeaderPrepmt@1090 : Record 122;
      PurchCrMemoHeaderPrepmt@1089 : Record 124;
      GenBusPostingGrp@1054 : Record 250;
      RespCenter@1056 : Record 5714;
      Location@1057 : Record 14;
      WhseRequest@1058 : Record 5765;
      InvtSetup@1059 : Record 313;
      SalespersonPurchaser@1932 : Record 13;
      ProjSetupRec@1210190022 : Record 315;
      NoSeriesMgt@1060 : Codeunit 396;
      DimMgt@1065 : Codeunit 408;
      ApprovalsMgmt@1082 : Codeunit 1535;
      UserSetupMgt@1066 : Codeunit 5700;
      LeadTimeMgt@1002 : Codeunit 5404;
      PostingSetupMgt@1023 : Codeunit 48;
      CurrencyDate@1069 : Date;
      HideValidationDialog@1070 : Boolean;
      Confirmed@1071 : Boolean;
      Text034@1072 : TextConst 'ENU=You cannot change the %1 when the %2 has been filled in.;NOR=Du kan ikke endre %1 n†r %2 er fyllt ut.;SVE=Du kan inte „ndra %1 n„r %2 har fyllts i.';
      Text037@1076 : TextConst 'ENU=Contact %1 %2 is not related to vendor %3.;NOR=Kontakten %1 %2 er ikke knyttet til leverand›ren %3.;SVE=Kontakt %1 %2 „r inte knuten till leverant”r %3.';
      Text038@1075 : TextConst 'ENU=Contact %1 %2 is related to a different company than vendor %3.;NOR=Kontakten %1 %2 er knyttet til et annet selskap enn leverand›ren %3.;SVE=Kontakt %1 %2 „r knuten till ett annat f”retag „n leverant”r %3.';
      Text039@1077 : TextConst 'ENU=Contact %1 %2 is not related to a vendor.;NOR=Kontakten %1 %2  er ikke knyttet til noen leverand›r.;SVE=Kontakt %1 %2 „r inte knuten till en leverant”r.';
      SkipBuyFromContact@1030 : Boolean;
      SkipPayToContact@1078 : Boolean;
      UserRec@1210190008 : Record 91;
      VATSetup@11012022 : Record 325;
      Text040@1079 : TextConst 'ENU="You can not change the %1 field because %2 %3 has %4 = %5 and the %6 has already been assigned %7 %8.";NOR="Du kan ikke endre feltet %1 fordi %2 %3 har %4 = %5 og %6 er allerede tilordnet %7 %8.";SVE="Du kan inte „ndra f„ltet %1 d„rf”r att %2 %3 har %4 = %5 och %6 har redan tilldelats %7 %8."';
      Text042@1084 : TextConst 'ENU=You must cancel the approval process if you wish to change the %1.;NOR=Du m† avbryte godkjenningsprosessen hvis du vil endre %1.;SVE=Du m†ste avbryta godk„nnandeprocessen om du vill „ndra %1.';
      Text045@1086 : TextConst 'ENU=Deleting this document will cause a gap in the number series for prepayment invoices. An empty prepayment invoice %1 will be created to fill this gap in the number series.\\Do you want to continue?;NOR=Hvis du sletter dette dokumentet, f†r du et tomrom i nummerserien for forskuddsfakturaer. Det opprettes en tom forskuddsfaktura %1 for † fylle dette hullet i nummerserien.\\Vil du fortsette?;SVE=Om du tar bort det h„r dokumentet uppst†r en lucka i nummerserien f”r f”rskottsfakturor. En tom f”rskottsfaktura %1 kommer att skapas f”r att fylla luckan i nummerserien.\\Vill du forts„tta?';
      Text046@1087 : TextConst 'ENU=Deleting this document will cause a gap in the number series for prepayment credit memos. An empty prepayment credit memo %1 will be created to fill this gap in the number series.\\Do you want to continue?;NOR=Hvis du sletter dette dokumentet, f†r du et tomrom i nummerserien for kreditnotaer for forskudd. Det opprettes en tom kreditnota %1 for † fylle dette hullet i nummerserien.\\Vil du fortsette?;SVE=Om du tar bort det h„r dokumentet uppst†r en lucka i nummerserien f”r kreditnotor f”r f”rskottsbetalning. En tom f”rskottskreditnota %1 kommer att skapas f”r att fylla luckan i nummerserien.\\Vill du forts„tta?';
      Text049@1092 : TextConst 'ENU=%1 is set up to process from %2 %3 only.;NOR=%1 er konfigurert for behandling bare fra %2 %3.;SVE=%1 har endast konfigurerats f”r behandling fr†n %2 %3.';
      Text050@1067 : TextConst 'ENU=Reservations exist for this order. These reservations will be canceled if a date conflict is caused by this change.\\Do you want to continue?;NOR=Det finnes reservasjoner for denne bestillingen. Reservasjonene vil bli slettet hvis denne endringen for†rsaker en datokonflikt.\\Vil du fortsette?;SVE=Det finns reservationer f”r den h„r ordern. Reservationerna tas bort om „ndringen leder till en datumkonflikt.\\Vill du forts„tta?';
      Text051@1025 : TextConst 'ENU=You may have changed a dimension.\\Do you want to update the lines?;NOR=Du kan ha endret en dimensjon.\\Vil du oppdatere linjene?;SVE=Du kanske har „ndrat en dimension.\\Vill du uppdatera raderna?';
      Text052@1091 : TextConst 'ENU=The %1 field on the purchase order %2 must be the same as on sales order %3.;NOR=Feltet %1 i bestillingen %2 m† v‘re det samme som i ordren %3.;SVE=F„ltet %1 i ink”psordern %2 m†ste vara samma som i f”rs„ljningsordern %3.';
      UpdateDocumentDate@1120 : Boolean;
      PrepaymentInvoicesNotPaidErr@1074 : TextConst '@@@=You cannot post the document of type Order with the number 1001 before all related prepayment invoices are posted.;ENU=You cannot post the document of type %1 with the number %2 before all related prepayment invoices are posted.;NOR=Du kan ikke bokf›re dokumentet av typen %1 med nummeret %2 f›r alle relaterte forskuddsfakturaer blir bokf›rt.;SVE=Det finns obetalda f”rskottsfakturor som „r relaterade till dokumentet med typen %1 och numret %2.';
      Text054@1096 : TextConst 'ENU=There are unpaid prepayment invoices that are related to the document of type %1 with the number %2.\ \Do you wish to continue?;NOR=Det finnes ubetalte forskuddsfakturaer som er relatert til dokumentet av typen %1 med nummer %2.;SVE=Det finns obetalda f”rskottsfakturor som „r relaterade till dokumentet med typen %1 och numret %2.';
      DeferralLineQst@1055 : TextConst '@@@="%1=The posting date on the document.";ENU=You have changed the %1 on the purchase header, do you want to update the deferral schedules for the lines with this date?;NOR=Du har endret %1 i bestillingshodet. Vil du oppdatere tidsplanene for periodisering for linjene med denne datoen?;SVE=Du har „ndrat %1 p† ink”pshuvudet. Vill du uppdatera periodiseringsschemana f”r raderna med detta datum?';
      PostedDocsToPrintCreatedMsg@1083 : TextConst 'ENU=One or more related posted documents have been generated during deletion to fill gaps in the posting number series. You can view or print the documents from the respective document archive.;NOR=Ett eller flere relaterte bokf›rte dokumenter har blitt generert under slettingen for † fylle hull i bokf›ringsnummerseriene. Du kan vise eller skrive ut dokumentene fra det respektive dokumentarkivet.;SVE=Ett eller flera relaterade bokf”rda dokument har genererats under borttagningen f”r att fylla i tomrummen i bokf”ringsnummerserien. Du kan visa eller skriva ut dokumenten fr†n respektive dokumentarkiv.';
      BuyFromVendorTxt@1010 : TextConst 'ENU=Buy-from Vendor;NOR=Kj›p fra-leverand›r;SVE=Ink”psleverant”r';
      PayToVendorTxt@1011 : TextConst 'ENU=Pay-to Vendor;NOR=Betal til-levrd.;SVE=Betalningsleverant”r';
      DocumentNotPostedClosePageQst@1013 : TextConst 'ENU=The document has been saved but is not yet posted.\\Are you sure you want to exit?;NOR=Dokumentet er lagret, men er ikke bokf›rt enn†.\\Er du sikker p† at du vil avslutte?;SVE=Dokumentet har inte bokf”rts.\Vill du avsluta?';
      PurchOrderDocTxt@1000 : TextConst 'ENU=Purchase Order;NOR=Bestilling;SVE=Ink”psorder';
      SelectNoSeriesAllowed@1015 : Boolean;
      PurchQuoteDocTxt@1088 : TextConst 'ENU=Purchase Quote;NOR=Foresp›rsel;SVE=Ink”psoffert';
      MixedDropshipmentErr@1001 : TextConst 'ENU=You cannot print the purchase order because it contains one or more lines for drop shipment in addition to regular purchase lines.;NOR=Du kan ikke skrive ut bestillingen fordi den har ‚n eller flere linjer for direktelevering i tillegg til vanlige bestillingslinjer.';
      ModifyVendorAddressNotificationLbl@1062 : TextConst 'ENU=Update the address;NOR=Oppdater adressen';
      DontShowAgainActionLbl@1064 : TextConst 'ENU=Don''t show again;NOR=Ikke vis igjen';
      ModifyVendorAddressNotificationMsg@1063 : TextConst '@@@="%1=Vendor name";ENU=The address you entered for %1 is different from the Vendor''s existing address.;NOR=Adressen du angav for %1, er forskjellig fra leverand›rens eksisterende adresse.';
      ModifyBuyFromVendorAddressNotificationNameTxt@1106 : TextConst 'ENU=Update Buy-from Vendor Address;NOR=Oppdater Kj›p fra-leverand›radresse';
      ModifyBuyFromVendorAddressNotificationDescriptionTxt@1098 : TextConst 'ENU=Warn if the Buy-from address on sales documents is different from the Vendor''s existing address.;NOR=Varsle hvis Kj›p fra-adressen p† salgsdokumenter er forskjellig fra leverand›rens eksisterende adresse.';
      ModifyPayToVendorAddressNotificationNameTxt@1102 : TextConst 'ENU=Update Pay-to Vendor Address;NOR=Oppdater Betal til-leverand›radresse';
      ModifyPayToVendorAddressNotificationDescriptionTxt@1099 : TextConst 'ENU=Warn if the Pay-to address on sales documents is different from the Vendor''s existing address.;NOR=Varsle hvis Betal til-adressen p† salgsdokumenter er forskjellig fra leverand›rens eksisterende adresse.';
      PurchaseAlreadyExistsTxt@1029 : TextConst '@@@="%1 = Document Type; %2 = Document No.";ENU=Purchase %1 %2 already exists for this vendor.;NOR=Kj›p %1 %2 finnes allerede for denne leverand›ren.;SVE=Ink”pet %1 %2 finns redan f”r leverant”ren.';
      ShowVendLedgEntryTxt@1044 : TextConst 'ENU=Show the vendor ledger entry.;NOR=Vis leverand›rposten.';
      ShowDocAlreadyExistNotificationNameTxt@1068 : TextConst 'ENU=Purchase document with same external document number already exists.;NOR=Kj›psdokument med samme eksterndokumentnummer finnes allerede.';
      ShowDocAlreadyExistNotificationDescriptionTxt@1061 : TextConst 'ENU=Warn if purchase document with same external document number already exists.;NOR=Varsle hvis kj›psdokument med samme eksterndokumentnummer finnes allerede.';
      DuplicatedCaptionsNotAllowedErr@1081 : TextConst 'ENU=Field captions must not be duplicated when using this method. Use UpdatePurchLinesByFieldNo instead.;NOR=Felttitlene m† ikke dupliseres n†r du bruker denne metoden. Bruk i stedet UpdatePurchLinesByFieldNo.';
      MissingExchangeRatesQst@1032 : TextConst '@@@=%1 - currency code, %2 - posting date;ENU=There are no exchange rates for currency %1 and date %2. Do you want to add them now? Otherwise, the last change you made will be reverted.;NOR=Det finnes ingen valutakurser for valutaen %1 og datoen %2. Vil du legge dem til n†? Ellers tilbakestilles den siste endringen du gjorde.;SVE=Vill du uppdatera raderna?';
      SplitMessageTxt@1085 : TextConst '@@@=Some message text 1.\Some message text 2.;ENU=%1\%2;NOR=%1\%2';
      StatusCheckSuspended@1073 : Boolean;
      DocBaseAmount@1100 : Decimal;
      Currency@1101 : Record 4;
      Text11012000@1210190016 : TextConst 'ENU=%1 %2 of %3 %4 in use for %5 %6.;NOR=%1 %2 av %3 %4 er i bruk for %5 %6.;SVE=%1 %2 av %3 %4 anv„nds f”r %5 %6.';
      Text11012001@1210190015 : TextConst 'ENU=No %1 known for %2 %3;NOR=Ingen %1 kjent for %2 %3;SVE=Ingen %1 k„nns till f”r %2 %3';
      Text11012002@1210190014 : TextConst 'ENU=Restore %1 from %2 to %3 ?;NOR=Gjenopprett %1 fra %2 til %3?;SVE=terst„ll %1 fr†n %2 till %3?';
      Text11012003@1210190013 : TextConst 'ENU=Changing of %1 in %2 will normally be done by the system during printing or sending of the Quote electronically.';
      Text11012004@1210190012 : TextConst 'ENU=Change %1 in %2 anyway ?;NOR=Endre %1 i %2 likevel?;SVE=Žndra %1 i %2 i alla fall?';
      Text11012005@1210190011 : TextConst 'ENU=%1 %2 is in use for %3 %4. Use %1 anyway ?;NOR=%1 %2 er i bruk for %3 %4. Bruke %1 likevel?;SVE=%1 %2 anv„nds f”r %3 %4. Anv„nda %1 i alla fall?';
      Text11012006@1100485003 : TextConst 'ENU=Vendor %1 blocked for purchase;NOR=Leverand›r %1 sperret for innkj›p;SVE=Leverant”r %1 har sp„rrats f”r ink”p';
      Text11012008@11012008 : TextConst 'ENU=Purchase Lines present, changing %1 not allowed;NOR=Innkj›psrader finnes, det er ikke tillatt † endre %1;SVE=Ink”psrader finns, det „r inte till†tet att „ndra %1';
      Text11012009@11012009 : TextConst 'ENU=%1 %2 has %3 %4;NOR=%1 %2 har %3 %4;SVE=%1 %2 har %3 %4';
      ServOrderRec@1100485007 : Record 11012823;
      ApprLine@1210190001 : Record 11012032;
      PurchInvLine@1210190002 : Record 123;
      DocRelRec@1210190003 : Record 11012407;
      ParRec@1210190004 : Record 11012072;
      PurchTxtRec@1210190021 : Record 11012067;
      ReminderHeader@1210190027 : Record 11020212;
      TempPurchHeader@1100525008 : Record 38;
      IcmLicenceCu@1210190028 : Codeunit 11012790;
      WKACalculationCu@1210190007 : Codeunit 11012020;
      Text11012010@1210190009 : TextConst 'ENU=To delete an Order the Orderstatus should be Closed or Order Lines should not be present.;NOR=For † fjerne en ordre m† ordrestatus v‘re lukket, eller s† skal det ikke finnes n†gra ordrerader.;SVE=F”r att ta bort en order m†ste orderstatus vara st„ngd eller s† ska det inte finnas n†gra orderrader.';
      Text11012011@1210190017 : TextConst 'ENU=not allowed, there is a blanket scheme present;NOR=ikke tillatt, det finnes et blankettskjema;SVE=inte till†tet, det finns ett avropsschema';
      Text11012012@1210190018 : TextConst 'ENU=not allowed, there are lines were the quantity is not negative;NOR=ikke tillatt, det finnes rader hvor antallet ikke er negativt;SVE=inte till†tet, det finns rader d„r antalet inte „r negativt';
      Text11012013@1210190019 : TextConst 'ENU=not allowed, there are lines were the quantity is negative;NOR=ikke tillatt, det finnes rader hvor antallet er negativt;SVE=inte till†tet, det finns rader d„r antalet „r negativt';
      Text11012014@1210190020 : TextConst 'ENU=not allowed, there are lines were the Return Reason is filled;NOR=ikke tillatt, det finnes rader hvor retur†rsak er fylt ut;SVE=inte till†tet, det finns rader d„r returorsaken har fyllts i';
      Text11012016@1210190026 : TextConst 'ENU=(%1) may not be greater than the de %2 (%3);NOR=(%1) kan ikke v‘re mer enn %2 (%3);SVE=(%1) f†r inte vara mer „n %2 (%3)';
      Text11012017@1210190029 : TextConst 'ENU=There are still Quotes linked to this %1, f.i. ''%2'';NOR=Det finnes fortsatt tilbud som er koblet til denne %1, f.eks. ''%2'';SVE=Det finns fortfarande offerter som „r l„nkade till denna %1, t.ex. ''%2''';
      Text11012018@1210190030 : TextConst 'ENU=There is not selected a No. Serie.;NOR=Ingen nummerserie er valgt.;SVE=Ingen nummerserie har valts.';
      Text11012019@1210190031 : TextConst 'ENU=Order No. could not be determined.;NOR=Ordrenr kunne ikke fastsettes.;SVE=Ordernr kunde inte fastst„llas.';
      Text11012020@1100485000 : TextConst 'ENU=Bank Account does not match with Bank No. Check.;NOR=Bankkonto matcher ikke Banknr. Kontroller.;SVE=Bankkonto matchar inte banknr. M†ste kontrolleras.';
      Text11012021@1100525000 : TextConst 'ENU=Not allowed with Purchase Setup VAT Indicator ''No VAT'';NOR=Ikke tillatt med innkj›psinstillingen ''Ingen avgift'';SVE=Inte till†tet med ink”psinst„llningen ''Ingen moms''';
      Text11012022@1100485008 : TextConst 'ENU="Insert the Data for ""Inward Processing Relief""? ";NOR=Sett inn data for "Aktiv prosesseringsst›tte"?;SVE="Infoga data f”r ""Aktivt f”r„dlingsst”d""? "';
      StrategicPurchMgt@1100525001 : Codeunit 11020211;
      Text11012023@1100525002 : TextConst 'ENU=Vendor %1 has no valid Contract.;NOR=Leverand›r %1 har ingen gyldig kontrakt.;SVE=Leverant”r %1 har inget giltigt kontrakt.';
      SkipStrategicPurchCheck@1100525003 : Boolean;
      DPA_Management@1100000999 : Codeunit 11012783;
      Text11012024@1100525007 : TextConst 'ENU=Do you want to finish the next manual Phase?;NOR=Vil du gj›re ferdig neste manuelle fase?;SVE=Vill du avsluta n„sta manuella fas?';
      Text11012025@1210190000 : TextConst 'ENU=ICM Login Code is empty.;NOR=ICM-innloggingskode er tom.;SVE=ICM-inloggningskod „r tom.';
      Text11012026@1210190005 : TextConst 'ENU=No Purchase Order sent, because the %1 %2 is set to %3.;NOR=Ingen innkj›psordre er sendt, fordi %1 %2 er satt til %3.;SVE=Inga ink”psorder har skickats d„rf”r att %1 %2 har angetts som %3.';
      Text11012027@1210190041 : TextConst 'ENU=Do you want to go one phase back?;NOR=Vil du g† en fase tilbake?;SVE=Vill du g† tillbaka en fas?';
      ProjectSiteMgt@1100528300 : Codeunit 11012282;
      Text11012028@1100409000 : TextConst 'ENU=The specified Account No. %1 occurs serveral times. Select Vendor No. in next Form.;NOR=Den spesifiserte kontoen - nr %1 Í forekommer flere ganger. Velg leverand›rnr i det neste skjemaet.';
      Text11012029@1100529102 : TextConst 'ENU=You must specify either %1 or %2.;NOR=Du m† angi %1 eller %2.;SVE=Du m†ste ange %1 eller %2.';
      Text11012030@1100529101 : TextConst 'ENU=%1 does not match with %2.;NOR=%1 matcher ikke %2';
      Text11012031@1100529100 : TextConst 'ENU=No Vendors found that have to be paid to %1.;NOR=Ingen leverand›rer funnet som m† betale til %1';
      Text11012032@1100528600 : TextConst 'ENU=There are no receiptlines available, do you want to show the purchase lines?';
      Text11012033@1100525009 : TextConst 'ENU=Do you want to change %1 %2 to %3 of the purchase order?';
      SkipModify@1100528400 : Boolean;
      DocumentCaptureSetup@1100409001 : Record 6085573;
      Text11012035@1100409004 : TextConst 'ENU=Only super approvers are allowed to change %1.';
      PmtReferenceErr@1060000 : TextConst '@@@="%1=Field;%2=Table;%3=Field";ENU=%1 should be blank for %2 %3.';
      "*** ExFlow ***"@12013587 : Integer;
      ExFlow@12013588 : Codeunit 12013601;
      ExFlowDimMgt@12013595 : Codeunit 12013605;
      Purchaser@12013589 : Record 13;
      DocHead@12013590 : Record 12013608;
      ExFlowSetup@12013591 : Record 12013601;
      exUserComp@12013592 : Record 12013641;
      ExFlowVend@12013594 : Record 12013595;
      DocLine@12013600 : Record 12013609;
      UpdateDocDate@12013593 : Boolean;
      Text11012036@1100525010 : TextConst 'ENU=You can only select 1 %1.';
      Text11012037@1100525011 : TextConst 'ENU=Do you want to go back to the first phase?';
      Text11012038@1100528200 : TextConst 'ENU=You can create the order only when the approval process is complete.';
      Text11012039@1100528100 : TextConst 'ENU=Purchase Order Type cannot be changed. Receipts already present.';
      FPSLicenseManagement@1100528500 : Codeunit 11229289;
      DCSetupRead@1100525005 : Boolean;
      Text11012040@1100527450 : TextConst 'ENU=No vendor selected;SVE=Ingen leverant”r har valts';
      VendorExtension@100000000 : Record 11128090;

    [External]
    PROCEDURE InitInsert@41();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeInitInsert(Rec,xRec,IsHandled);
      IF NOT IsHandled THEN
        IF "No." = '' THEN BEGIN
          TestNoSeries;
          NoSeriesMgt.InitSeries(GetNoSeriesCode,xRec."No. Series","Posting Date","No.","No. Series");
        END;

      OnInitInsertOnBeforeInitRecord(Rec,xRec);
      InitRecord;
    END;

    [External]
    PROCEDURE InitRecord@10();
    VAR
      ArchiveManagement@1000 : Codeunit 5063;
      IsHandled@1001 : Boolean;
      OnHoldRec@1210190010 : Record 11012031;
    BEGIN
      GetPurchSetup;
      IsHandled := FALSE;
      OnBeforeInitRecord(Rec,IsHandled);
      IF NOT IsHandled THEN
        CASE "Document Type" OF
          "Document Type"::Quote,"Document Type"::Order:
            BEGIN
              NoSeriesMgt.SetDefaultSeries("Posting No. Series",PurchSetup."Posted Invoice Nos.");
              NoSeriesMgt.SetDefaultSeries("Receiving No. Series",PurchSetup."Posted Receipt Nos.");
              IF "Document Type" = "Document Type"::Order THEN BEGIN
                IF PurchSetup."Posted Prepmt. Inv. Nos." <> '' THEN  //**4PS.n
                  NoSeriesMgt.SetDefaultSeries("Prepayment No. Series",PurchSetup."Posted Prepmt. Inv. Nos.");
                IF PurchSetup."Posted Prepmt. Cr. Memo Nos." <> '' THEN  //**4PS.n
                  NoSeriesMgt.SetDefaultSeries("Prepmt. Cr. Memo No. Series",PurchSetup."Posted Prepmt. Cr. Memo Nos.");
              END;
            END;
          "Document Type"::Invoice:
            BEGIN
              IF ("No. Series" <> '') AND
                 (PurchSetup."Invoice Nos." = PurchSetup."Posted Invoice Nos.")
              THEN
                "Posting No. Series" := "No. Series"
              ELSE
                NoSeriesMgt.SetDefaultSeries("Posting No. Series",PurchSetup."Posted Invoice Nos.");
              IF PurchSetup."Receipt on Invoice" THEN
                NoSeriesMgt.SetDefaultSeries("Receiving No. Series",PurchSetup."Posted Receipt Nos.");
            END;
          "Document Type"::"Return Order":
            BEGIN
              NoSeriesMgt.SetDefaultSeries("Posting No. Series",PurchSetup."Posted Credit Memo Nos.");
              NoSeriesMgt.SetDefaultSeries("Return Shipment No. Series",PurchSetup."Posted Return Shpt. Nos.");
            END;
          "Document Type"::"Credit Memo":
            BEGIN
              IF ("No. Series" <> '') AND
                 (PurchSetup."Credit Memo Nos." = PurchSetup."Posted Credit Memo Nos.")
              THEN
                "Posting No. Series" := "No. Series"
              ELSE
                NoSeriesMgt.SetDefaultSeries("Posting No. Series",PurchSetup."Posted Credit Memo Nos.");
              IF PurchSetup."Return Shipment on Credit Memo" THEN
                NoSeriesMgt.SetDefaultSeries("Return Shipment No. Series",PurchSetup."Posted Return Shpt. Nos.");
            END;
        END;

      IF "Document Type" IN
         ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::"Return Order","Document Type"::Quote]
      THEN
        "Order Date" := WORKDATE;

      IF "Document Type" = "Document Type"::Invoice THEN
        "Expected Receipt Date" := WORKDATE;

      IF NOT ("Document Type" IN ["Document Type"::"Blanket Order","Document Type"::Quote]) AND
         ("Posting Date" = 0D)
      THEN
        "Posting Date" := WORKDATE;

      IF PurchSetup."Default Posting Date" = PurchSetup."Default Posting Date"::"No Date" THEN
        "Posting Date" := 0D;

      "Document Date" := WORKDATE;

      ValidateEmptySellToCustomerAndLocation;

      IF IsCreditDocType THEN BEGIN
        GLSetup.GET;
        Correction := GLSetup."Mark Cr. Memos as Corrections";
      END;

      "Posting Description" := FORMAT("Document Type") + ' ' + "No.";

      UpdateInboundWhseHandlingTime;

      "Responsibility Center" := UserSetupMgt.GetRespCenter(1,"Responsibility Center");
      "Doc. No. Occurrence" := ArchiveManagement.GetNextOccurrenceNo(DATABASE::"Purchase Header","Document Type","No.");

      //**4PS.sn
      IF PurchSetup."Use Invoice Induction Note" THEN
        "Invoice Conduction Note" := TRUE;
      IF PurchSetup."Default Amounts Only Orders" THEN
        "Amounts only" := TRUE;

      IF PurchSetup."Approve Purchase Invoices" THEN BEGIN
        IF (PurchSetup."Preregister WIP Purch. Inv.") THEN BEGIN
          PurchSetup.TESTFIELD("Preregistration WIP Account");
          "Purchase Registration Account" := PurchSetup."Preregistration WIP Account";
        END ELSE BEGIN
          PurchSetup.TESTFIELD("Purchase Registration Account");
          "Purchase Registration Account" := PurchSetup."Purchase Registration Account";
        END;
        "Invoice Lines Input" := PurchSetup."Default Invoice Lines Input";
      END ELSE
        "Invoice Lines Input" := TRUE;

      IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::Company THEN
        "Price Agreement" := TRUE
      ELSE
        "Price Agreement" := FALSE;

      IF ("Document Type" = "Document Type"::Invoice) OR
         ("Document Type" = "Document Type"::"Credit Memo") THEN BEGIN
        IF ("Document Type" = "Document Type"::Invoice) THEN
          OnHoldRec.SETRANGE("Default Value Purchase Invoice", TRUE)
        ELSE
          OnHoldRec.SETRANGE("Default Value Credit Memo", TRUE);
        IF OnHoldRec.FIND('-') THEN BEGIN
          "On Hold" := OnHoldRec.Code;
          "Approvement Initials" := OnHoldRec."Default Approvement Initials";
        END;
      END;

      InitIcmStatus;
      GetDefaultPurchasePlan; //Must be below InitIcmStatus
      IF "Purchaser Code" = '' THEN
        IF UserRec.GET(USERID) THEN
          IF (UserRec.Purchaser <> '') AND SalespersonPurchaser.GET(UserRec.Purchaser) THEN
            IF NOT SalespersonPurchaser.VerifySalesPersonPurchaserPrivacyBlocked(SalespersonPurchaser) THEN
              "Purchaser Code" := UserRec.Purchaser;

      IF PurchSetup."Preregister WIP Purch. Inv." THEN
        "Preregister WIP" := TRUE;
      //**4PS.en

      OnAfterInitRecord(Rec);
    END;

    LOCAL PROCEDURE InitNoSeries@52();
    BEGIN
      IF xRec."Receiving No." <> '' THEN BEGIN
        "Receiving No. Series" := xRec."Receiving No. Series";
        "Receiving No." := xRec."Receiving No.";
      END;
      IF xRec."Posting No." <> '' THEN BEGIN
        "Posting No. Series" := xRec."Posting No. Series";
        "Posting No." := xRec."Posting No.";
      END;
      IF xRec."Return Shipment No." <> '' THEN BEGIN
        "Return Shipment No. Series" := xRec."Return Shipment No. Series";
        "Return Shipment No." := xRec."Return Shipment No.";
      END;
      IF xRec."Prepayment No." <> '' THEN BEGIN
        "Prepayment No. Series" := xRec."Prepayment No. Series";
        "Prepayment No." := xRec."Prepayment No.";
      END;
      IF xRec."Prepmt. Cr. Memo No." <> '' THEN BEGIN
        "Prepmt. Cr. Memo No. Series" := xRec."Prepmt. Cr. Memo No. Series";
        "Prepmt. Cr. Memo No." := xRec."Prepmt. Cr. Memo No.";
      END;

      OnAfterInitNoSeries(Rec);
    END;

    [External]
    PROCEDURE AssistEdit@2(OldPurchHeader@1000 : Record 38) : Boolean;
    BEGIN
      GetPurchSetup;
      TestNoSeries;
      IF NoSeriesMgt.SelectSeries(GetNoSeriesCode,OldPurchHeader."No. Series","No. Series") THEN BEGIN
        TestNoSeries;
        NoSeriesMgt.SetSeries("No.");
        EXIT(TRUE);
      END;
    END;

    [External]
    PROCEDURE TestNoSeries@6();
    VAR
      IsHandled@1000 : Boolean;
      SiBSetup@1100528900 : Record 11072650;
    BEGIN
      GetPurchSetup;
      IsHandled := FALSE;
      OnBeforeTestNoSeries(Rec,IsHandled);
      IF NOT IsHandled THEN
        CASE "Document Type" OF
          "Document Type"::Quote:
            PurchSetup.TESTFIELD("Quote Nos.");
          "Document Type"::Order:
            //**4PS.sn
            BEGIN
              IF ("Order Type (SiB)" = "Order Type (SiB)"::" ") OR
                 ("Hours Hire Order Type" = "Hours Hire Order Type"::" ") THEN  //DP00065
                PurchSetup.TESTFIELD("Order Nos.");
              IF "Order Type (SiB)" = "Order Type (SiB)"::DispatchNote THEN BEGIN  //DP00065
                SiBSetup.GET;
                SiBSetup.TESTFIELD("Order Nos. (Dispatch Notes)");
              END;
              CASE "Hours Hire Order Type" OF
                "Hours Hire Order Type"::Employee:
                  PurchSetup.TESTFIELD("Lend In Orders Nos.");
                "Hours Hire Order Type"::Plant:
                  PurchSetup.TESTFIELD("Plant Hire Order Nos. (Hours)");
              END;
            END;
            //**4PS.en
          "Document Type"::Invoice:
            BEGIN
              //**4PS.sn
              IF ("Order Type (SiB)" = "Order Type (SiB)"::" ") THEN  //DP00065
                PurchSetup.TESTFIELD("Invoice Nos.");
              PurchSetup.TESTFIELD("Posted Invoice Nos.");
              IF "Order Type (SiB)" = "Order Type (SiB)"::Invoice THEN BEGIN  //DP00065
                SiBSetup.GET;
                SiBSetup.TESTFIELD("Invoice Nos. (Purch. Invoice)");
              END;
              //**4PS.sn
            END;
          "Document Type"::"Return Order":
            PurchSetup.TESTFIELD("Return Order Nos.");
          "Document Type"::"Credit Memo":
            BEGIN
              PurchSetup.TESTFIELD("Credit Memo Nos.");
              PurchSetup.TESTFIELD("Posted Credit Memo Nos.");
            END;
          "Document Type"::"Blanket Order":
            PurchSetup.TESTFIELD("Blanket Order Nos.");
        END;

      OnAfterTestNoSeries(Rec);
    END;

    [External]
    PROCEDURE GetNoSeriesCode@9() : Code[20];
    VAR
      NoSeriesCode@1001 : Code[20];
      SiBSetup@1100528900 : Record 11072650;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Quote:
          NoSeriesCode := PurchSetup."Quote Nos.";
        "Document Type"::Order:
          //NoSeriesCode := PurchSetup."Order Nos."; //**4PS.o
          //**4PS.sn
          BEGIN
            IF "Order Type (SiB)" = "Order Type (SiB)"::DispatchNote THEN BEGIN
              SiBSetup.GET;
              NoSeriesCode := SiBSetup."Order Nos. (Dispatch Notes)";
            END ELSE
              CASE "Hours Hire Order Type" OF
                "Hours Hire Order Type"::Employee:
                  NoSeriesCode := PurchSetup."Lend In Orders Nos.";
                "Hours Hire Order Type"::Plant:
                  NoSeriesCode := PurchSetup."Plant Hire Order Nos. (Hours)";
                ELSE
                  NoSeriesCode := PurchSetup."Order Nos.";
              END;
          END;
          //**4PS.en
        "Document Type"::Invoice:
          //NoSeriesCode := PurchSetup."Invoice Nos."; //**4PS.o
          //**4PS.sn
          BEGIN
            IF "Order Type (SiB)" = "Order Type (SiB)"::Invoice THEN BEGIN
              SiBSetup.GET;
              NoSeriesCode := SiBSetup."Invoice Nos. (Purch. Invoice)";
            END ELSE
              NoSeriesCode := PurchSetup."Invoice Nos.";
          END;
          //**4PS.en
        "Document Type"::"Return Order":
          NoSeriesCode := PurchSetup."Return Order Nos.";
        "Document Type"::"Credit Memo":
          NoSeriesCode := PurchSetup."Credit Memo Nos.";
        "Document Type"::"Blanket Order":
          NoSeriesCode := PurchSetup."Blanket Order Nos.";
      END;
      OnAfterGetNoSeriesCode(Rec,PurchSetup,NoSeriesCode);
      EXIT(NoSeriesMgt.GetNoSeriesWithCheck(NoSeriesCode,SelectNoSeriesAllowed,"No. Series"));
    END;

    LOCAL PROCEDURE GetPostingNoSeriesCode@8() PostingNos : Code[20];
    BEGIN
      IF IsCreditDocType THEN
        PostingNos := PurchSetup."Posted Credit Memo Nos."
      ELSE
        PostingNos := PurchSetup."Posted Invoice Nos.";

      OnAfterGetPostingNoSeriesCode(Rec,PostingNos);
    END;

    LOCAL PROCEDURE GetPostingPrepaymentNoSeriesCode@37() PostingNos : Code[20];
    BEGIN
      IF IsCreditDocType THEN
        PostingNos := PurchSetup."Posted Prepmt. Cr. Memo Nos."
      ELSE
        PostingNos := PurchSetup."Posted Prepmt. Inv. Nos.";

      OnAfterGetPrepaymentPostingNoSeriesCode(Rec,PostingNos);
    END;

    LOCAL PROCEDURE TestNoSeriesDate@40(No@1000 : Code[20];NoSeriesCode@1001 : Code[20];NoCapt@1002 : Text[1024];NoSeriesCapt@1004 : Text[1024]);
    VAR
      NoSeries@1005 : Record 308;
    BEGIN
      IF (No <> '') AND (NoSeriesCode <> '') THEN BEGIN
        NoSeries.GET(NoSeriesCode);
        IF NoSeries."Date Order" THEN
          ERROR(
            Text040,
            FIELDCAPTION("Posting Date"),NoSeriesCapt,NoSeriesCode,
            NoSeries.FIELDCAPTION("Date Order"),NoSeries."Date Order","Document Type",
            NoCapt,No);
      END;
    END;

    [External]
    PROCEDURE ConfirmDeletion@11() : Boolean;
    VAR
      SourceCode@1001 : Record 230;
      SourceCodeSetup@1000 : Record 242;
      PostPurchDelete@1002 : Codeunit 364;
      ConfirmManagement@1003 : Codeunit 27;
    BEGIN
      SourceCodeSetup.GET;
      SourceCodeSetup.TESTFIELD("Deleted Document");
      SourceCode.GET(SourceCodeSetup."Deleted Document");

      PostPurchDelete.InitDeleteHeader(
        Rec,PurchRcptHeader,PurchInvHeader,PurchCrMemoHeader,
        ReturnShptHeader,PurchInvHeaderPrepmt,PurchCrMemoHeaderPrepmt,SourceCode.Code);


      //**4PS.sn
      IF GetHideValidationDialog THEN
        EXIT(TRUE);
      //**4PS.en

      IF PurchRcptHeader."No." <> '' THEN
        IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text009,PurchRcptHeader."No."),TRUE) THEN
          EXIT;
      IF PurchInvHeader."No." <> '' THEN
        IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text012,PurchInvHeader."No."),TRUE) THEN
          EXIT;
      IF PurchCrMemoHeader."No." <> '' THEN
        IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text014,PurchCrMemoHeader."No."),TRUE) THEN
          EXIT;
      IF ReturnShptHeader."No." <> '' THEN
        IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text029,ReturnShptHeader."No."),TRUE) THEN
          EXIT;
      IF "Prepayment No." <> '' THEN
        IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text045,PurchInvHeaderPrepmt."No."),TRUE) THEN
          EXIT;
      IF "Prepmt. Cr. Memo No." <> '' THEN
        IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text046,PurchCrMemoHeaderPrepmt."No."),TRUE) THEN
          EXIT;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetPurchSetup@176();
    BEGIN
      PurchSetup.GET;
      OnAfterGetPurchSetup(Rec,PurchSetup,CurrFieldNo);
    END;

    LOCAL PROCEDURE GetVend@1(VendNo@1000 : Code[20]);
    BEGIN
      IF VendNo <> Vend."No." THEN
        //**4PS.sn
        IF VendNo = '' THEN
          CLEAR(Vend)
        ELSE
        //**4PS.en
          Vend.GET(VendNo);
    END;

    [External]
    PROCEDURE PurchLinesExist@3() : Boolean;
    BEGIN
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      EXIT(NOT PurchLine.ISEMPTY);
    END;

    LOCAL PROCEDURE RecreatePurchLines@4(ChangedFieldName@1000 : Text[100]);
    VAR
      TempPurchLine@1001 : TEMPORARY Record 39;
      ItemChargeAssgntPurch@1005 : Record 5805;
      TempItemChargeAssgntPurch@1004 : TEMPORARY Record 5805;
      TempInteger@1003 : TEMPORARY Record 2000000026;
      SalesHeader@1006 : Record 36;
      TransferExtendedText@1009 : Codeunit 378;
      ConfirmManagement@1008 : Codeunit 27;
      ExtendedTextAdded@1002 : Boolean;
      ConfirmText@1007 : Text;
      IsHandled@1010 : Boolean;
    BEGIN
      IF NOT PurchLinesExist THEN
        EXIT;

      IsHandled := FALSE;
      OnRecreatePurchLinesOnBeforeConfirm(Rec,xRec,ChangedFieldName,HideValidationDialog,Confirmed,IsHandled);
      IF NOT IsHandled THEN
        IF GetHideValidationDialog THEN
          Confirmed := TRUE
        ELSE BEGIN
          IF HasItemChargeAssignment THEN
            ConfirmText := ResetItemChargeAssignMsg
          ELSE
            ConfirmText := RecreatePurchLinesMsg;
          Confirmed := ConfirmManagement.ConfirmProcess(STRSUBSTNO(ConfirmText,ChangedFieldName),TRUE);
        END;

      IF Confirmed THEN BEGIN
        PurchLine.LOCKTABLE;
        ItemChargeAssgntPurch.LOCKTABLE;
        MODIFY;
        OnBeforeRecreatePurchLines(Rec);

        PurchLine.RESET;
        PurchLine.SETRANGE("Document Type","Document Type");
        PurchLine.SETRANGE("Document No.","No.");
        IF PurchLine.FINDSET THEN BEGIN
          REPEAT
            //**4PS.sn
            PurchLine.TESTFIELD("Amnt. Received",0);
            PurchLine.TESTFIELD("Amnt. Invoiced",0);
            //**4PS.en
            PurchLine.TESTFIELD("Quantity Received",0);
            PurchLine.TESTFIELD("Quantity Invoiced",0);
            PurchLine.TESTFIELD("Return Qty. Shipped",0);
            PurchLine.CALCFIELDS("Reserved Qty. (Base)");
            PurchLine.TESTFIELD("Reserved Qty. (Base)",0);
            PurchLine.TESTFIELD("Receipt No.",'');
            PurchLine.TESTFIELD("Return Shipment No.",'');
            PurchLine.TESTFIELD("Blanket Order No.",'');
            IF PurchLine."Drop Shipment" OR PurchLine."Special Order" THEN BEGIN
              CASE TRUE OF
                PurchLine."Drop Shipment":
                  SalesHeader.GET(SalesHeader."Document Type"::Order,PurchLine."Sales Order No.");
                PurchLine."Special Order":
                  SalesHeader.GET(SalesHeader."Document Type"::Order,PurchLine."Special Order Sales No.");
              END;
              TESTFIELD("Sell-to Customer No.",SalesHeader."Sell-to Customer No.");
              TESTFIELD("Ship-to Code",SalesHeader."Ship-to Code");
            END;

            PurchLine.TESTFIELD("Prepmt. Amt. Inv.",0);
            TempPurchLine := PurchLine;
            IF PurchLine.Nonstock THEN BEGIN
              PurchLine.Nonstock := FALSE;
              //**4PS.sn
              PurchLine."Modified by" := USERID;
              PurchLine."Last Date Modified" := TODAY;
              //**4PS.en
              PurchLine.MODIFY;
            END;
            OnRecreatePurchLinesOnBeforeTempPurchLineInsert(TempPurchLine,PurchLine);
            TempPurchLine.INSERT;
              // ExFlow ->
              IF ExFlowSetup.GET THEN
                IF Approve AND ExFlowSetup."Do Not Upd Dim Purchase Line" THEN
                  ExFlowDimMgt.CopyPurchLineDimToTemp(PurchLine);
              // <- ExFlow
          UNTIL PurchLine.NEXT = 0;

          TransferItemChargeAssgntPurchToTemp(ItemChargeAssgntPurch,TempItemChargeAssgntPurch);

          //PurchLine.DELETEALL(TRUE);  //**4PS.o
          //**4PS.sn
          PurchLine.FINDSET;
          REPEAT
            PurchLine.CreatePurchOrderControl(TRUE);
            PurchLine.DELETE;
          UNTIL PurchLine.NEXT = 0;
          //**4PS.en

          PurchLine.INIT;
          PurchLine."Line No." := 0;
          TempPurchLine.FINDSET;
          ExtendedTextAdded := FALSE;
          REPEAT
            IF TempPurchLine."Attached to Line No." = 0 THEN BEGIN
              PurchLine.INIT;
              PurchLine."Line No." := PurchLine."Line No." + 10000;
              PurchLine.VALIDATE(Type,TempPurchLine.Type);
              OnRecreatePurchLinesOnAfterValidateType(PurchLine,TempPurchLine);
              IF TempPurchLine."No." = '' THEN BEGIN
                IF PurchLine.Type <> PurchLine.Type::"Fixed Asset" THEN BEGIN //**4PS.n
                  PurchLine.VALIDATE(Description,TempPurchLine.Description);
                  PurchLine.VALIDATE("Description 2",TempPurchLine."Description 2");
                END; //**4PS.n
              END ELSE BEGIN
                PurchLine."System-Created Entry" := TempPurchLine."System-Created Entry"; //**4PS.n
                PurchLine.VALIDATE("No.",TempPurchLine."No.");
                IF PurchLine.Type <> PurchLine.Type::" " THEN
                  CASE TRUE OF
                    TempPurchLine."Drop Shipment":
                      TransferSavedFieldsDropShipment(PurchLine,TempPurchLine);
                    TempPurchLine."Special Order":
                      TransferSavedFieldsSpecialOrder(PurchLine,TempPurchLine);
                    ELSE
                      TransferSavedFields(PurchLine,TempPurchLine);
                  END;
              END;

              //**4PS.sn
              PurchLine."Buy-from Vendor No." := "Buy-from Vendor No.";  //**4PS.n
              PurchLine."Input by" := USERID;
              PurchLine."Input Date" := TODAY;
              //**4PS.en

              OnRecreatePurchLinesOnBeforeInsertPurchLine(PurchLine,TempPurchLine);
              PurchLine.INSERT;
                // ExFlow ->
                IF ExFlowSetup.GET THEN BEGIN
      //          IF (PurchLineTmp."No." <> '') AND (PurchLine.Type <> PurchLine.Type::" ") AND (NOT PurchLineTmp."Special Order") AND (NOT PurchLineTmp."Drop Shipment")
      //            THEN
                  IF PurchLine.Approve THEN BEGIN
                    ExFlow.CreateDocumentLine(PurchLine,TRUE,TRUE);
                    ExFlow.AmountToDocHead(PurchLine,FALSE,Rec);
                  END;

                  IF Approve AND ExFlowSetup."Do Not Upd Dim Purchase Line" THEN
                    ExFlowDimMgt.CopyTempDimToPurchLine(PurchLine,FALSE);
                END;
                // <- ExFlow

              //**4PS.sn
              PurchLine.GetTempPurchLine(TempPurchLine);
              PurchLine."Buy-from Vendor No." := "Buy-from Vendor No.";
              IF TempPurchLine.Quantity <> 0 THEN
                PurchLine.VALIDATE(Quantity,TempPurchLine.Quantity);
              IF (PurchLine."Document Type" = PurchLine."Document Type"::Order) AND
                 (TempPurchLine."Qty. to Receive" <> 0) THEN
                PurchLine.VALIDATE("Qty. to Receive",TempPurchLine."Qty. to Receive");
              PurchLine.MODIFY;
              PurchLine.CreatePurchOrderControl(FALSE);
              //**4PS.en

              ExtendedTextAdded := FALSE;

              OnAfterRecreatePurchLine(PurchLine,TempPurchLine);

              IF PurchLine.Type = PurchLine.Type::Item THEN
                RecreatePurchLinesFillItemChargeAssignment(PurchLine,TempPurchLine,TempItemChargeAssgntPurch);

              IF PurchLine.Type = PurchLine.Type::"Charge (Item)" THEN BEGIN
                TempInteger.INIT;
                TempInteger.Number := PurchLine."Line No.";
                TempInteger.INSERT;
              END;
            END ELSE
              IF NOT ExtendedTextAdded THEN BEGIN
                TransferExtendedText.PurchCheckIfAnyExtText(PurchLine,TRUE);
                TransferExtendedText.InsertPurchExtText(PurchLine);
                OnAfterTransferExtendedTextForPurchaseLineRecreation(PurchLine,TempPurchLine);
                PurchLine.FINDLAST;
                ExtendedTextAdded := TRUE;
              END;
          UNTIL TempPurchLine.NEXT = 0;

          RecreateItemChargeAssgntPurch(TempItemChargeAssgntPurch,TempPurchLine,TempInteger);

          TempPurchLine.SETRANGE(Type);
          TempPurchLine.DELETEALL;
          OnAfterDeleteAllTempPurchLines;
        END;
      END ELSE
        Rec := xRec;
    END;

    LOCAL PROCEDURE RecreatePurchLinesFillItemChargeAssignment@154(PurchLine@1000 : Record 39;VAR TempPurchLine@1001 : TEMPORARY Record 39;VAR TempItemChargeAssgntPurch@1002 : TEMPORARY Record 5805);
    BEGIN
      ClearItemAssgntPurchFilter(TempItemChargeAssgntPurch);
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Type",TempPurchLine."Document Type");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. No.",TempPurchLine."Document No.");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Line No.",TempPurchLine."Line No.");
      IF TempItemChargeAssgntPurch.FINDSET THEN
        REPEAT
          IF NOT TempItemChargeAssgntPurch.MARK THEN BEGIN
            TempItemChargeAssgntPurch."Applies-to Doc. Line No." := PurchLine."Line No.";
            TempItemChargeAssgntPurch.Description := PurchLine.Description;
            TempItemChargeAssgntPurch.MODIFY;
            TempItemChargeAssgntPurch.MARK(TRUE);
          END;
        UNTIL TempItemChargeAssgntPurch.NEXT = 0;
    END;

    LOCAL PROCEDURE RecreateItemChargeAssgntPurch@159(VAR TempItemChargeAssgntPurch@1001 : TEMPORARY Record 5805;VAR TempPurchLine@1000 : TEMPORARY Record 39;VAR TempInteger@1002 : TEMPORARY Record 2000000026);
    VAR
      ItemChargeAssgntPurch@1003 : Record 5805;
    BEGIN
      ClearItemAssgntPurchFilter(TempItemChargeAssgntPurch);
      TempPurchLine.SETRANGE(Type,TempPurchLine.Type::"Charge (Item)");
      IF TempPurchLine.FINDSET THEN
        REPEAT
          TempItemChargeAssgntPurch.SETRANGE("Document Line No.",TempPurchLine."Line No.");
          IF TempItemChargeAssgntPurch.FINDSET THEN BEGIN
            REPEAT
              TempInteger.FINDFIRST;
              ItemChargeAssgntPurch.INIT;
              ItemChargeAssgntPurch := TempItemChargeAssgntPurch;
              ItemChargeAssgntPurch."Document Line No." := TempInteger.Number;
              ItemChargeAssgntPurch.VALIDATE("Unit Cost",0);
              ItemChargeAssgntPurch.INSERT;
            UNTIL TempItemChargeAssgntPurch.NEXT = 0;
            TempInteger.DELETE;
          END;
        UNTIL TempPurchLine.NEXT = 0;

      ClearItemAssgntPurchFilter(TempItemChargeAssgntPurch);
      TempItemChargeAssgntPurch.DELETEALL;
    END;

    LOCAL PROCEDURE TransferSavedFields@72(VAR DestinationPurchaseLine@1000 : Record 39;VAR SourcePurchaseLine@1001 : Record 39);
    BEGIN
      DestinationPurchaseLine.VALIDATE("Unit of Measure Code",SourcePurchaseLine."Unit of Measure Code");
      DestinationPurchaseLine.VALIDATE("Variant Code",SourcePurchaseLine."Variant Code");
      DestinationPurchaseLine."Prod. Order No." := SourcePurchaseLine."Prod. Order No.";
      IF DestinationPurchaseLine."Prod. Order No." <> '' THEN BEGIN
        DestinationPurchaseLine.Description := SourcePurchaseLine.Description;
        DestinationPurchaseLine.VALIDATE("VAT Prod. Posting Group",SourcePurchaseLine."VAT Prod. Posting Group");
        DestinationPurchaseLine.VALIDATE("Gen. Prod. Posting Group",SourcePurchaseLine."Gen. Prod. Posting Group");
        DestinationPurchaseLine.VALIDATE("Expected Receipt Date",SourcePurchaseLine."Expected Receipt Date");
        DestinationPurchaseLine.VALIDATE("Requested Receipt Date",SourcePurchaseLine."Requested Receipt Date");
        DestinationPurchaseLine.VALIDATE("Qty. per Unit of Measure",SourcePurchaseLine."Qty. per Unit of Measure");
      END;
      IF (SourcePurchaseLine."Job No." <> '') AND (SourcePurchaseLine."Job Task No." <> '') THEN BEGIN
        DestinationPurchaseLine.VALIDATE("Job No.",SourcePurchaseLine."Job No.");
        DestinationPurchaseLine.VALIDATE("Job Task No.",SourcePurchaseLine."Job Task No.");
        DestinationPurchaseLine."Job Line Type" := SourcePurchaseLine."Job Line Type";
      END;
      IF SourcePurchaseLine.Quantity <> 0 THEN
        DestinationPurchaseLine.VALIDATE(Quantity,SourcePurchaseLine.Quantity);
      IF ("Currency Code" = xRec."Currency Code") AND (PurchLine."Direct Unit Cost" = 0) THEN
        DestinationPurchaseLine.VALIDATE("Direct Unit Cost",SourcePurchaseLine."Direct Unit Cost");
      DestinationPurchaseLine."Routing No." := SourcePurchaseLine."Routing No.";
      DestinationPurchaseLine."Routing Reference No." := SourcePurchaseLine."Routing Reference No.";
      DestinationPurchaseLine."Operation No." := SourcePurchaseLine."Operation No.";
      DestinationPurchaseLine."Work Center No." := SourcePurchaseLine."Work Center No.";
      DestinationPurchaseLine."Prod. Order Line No." := SourcePurchaseLine."Prod. Order Line No.";
      DestinationPurchaseLine."Overhead Rate" := SourcePurchaseLine."Overhead Rate";
      // ExFlow ->
      IF ExFlowSetup.GET THEN BEGIN
        IF Approve THEN BEGIN
          IF (DestinationPurchaseLine.Type IN [DestinationPurchaseLine.Type::"G/L Account",DestinationPurchaseLine.Type::"Fixed Asset"]) THEN BEGIN
            DestinationPurchaseLine.VALIDATE("Direct Unit Cost", SourcePurchaseLine."Direct Unit Cost");
            DestinationPurchaseLine.VALIDATE("Line Discount %", SourcePurchaseLine."Line Discount %");
          END;

          DestinationPurchaseLine.CopyExFlowFields(SourcePurchaseLine);
        END;
      END;
      // <- ExFlow

      OnAfterTransferSavedFields(DestinationPurchaseLine,SourcePurchaseLine);
    END;

    LOCAL PROCEDURE TransferSavedFieldsDropShipment@79(VAR DestinationPurchaseLine@1001 : Record 39;VAR SourcePurchaseLine@1000 : Record 39);
    VAR
      SalesLine@1003 : Record 37;
      CopyDocMgt@1002 : Codeunit 6620;
    BEGIN
      SalesLine.GET(SalesLine."Document Type"::Order,
        SourcePurchaseLine."Sales Order No.",
        SourcePurchaseLine."Sales Order Line No.");
      CopyDocMgt.TransfldsFromSalesToPurchLine(SalesLine,DestinationPurchaseLine);
      DestinationPurchaseLine."Drop Shipment" := SourcePurchaseLine."Drop Shipment";
      DestinationPurchaseLine."Purchasing Code" := SalesLine."Purchasing Code";
      DestinationPurchaseLine."Sales Order No." := SourcePurchaseLine."Sales Order No.";
      DestinationPurchaseLine."Sales Order Line No." := SourcePurchaseLine."Sales Order Line No.";
      EVALUATE(DestinationPurchaseLine."Inbound Whse. Handling Time",'<0D>');
      DestinationPurchaseLine.VALIDATE("Inbound Whse. Handling Time");
      SalesLine.VALIDATE("Unit Cost (LCY)",DestinationPurchaseLine."Unit Cost (LCY)");
      SalesLine."Purchase Order No." := DestinationPurchaseLine."Document No.";
      SalesLine."Purch. Order Line No." := DestinationPurchaseLine."Line No.";
      SalesLine.MODIFY;
    END;

    LOCAL PROCEDURE TransferSavedFieldsSpecialOrder@82(VAR DestinationPurchaseLine@1003 : Record 39;VAR SourcePurchaseLine@1002 : Record 39);
    VAR
      SalesLine@1004 : Record 37;
      CopyDocMgt@1000 : Codeunit 6620;
    BEGIN
      SalesLine.GET(SalesLine."Document Type"::Order,
        SourcePurchaseLine."Special Order Sales No.",
        SourcePurchaseLine."Special Order Sales Line No.");
      CopyDocMgt.TransfldsFromSalesToPurchLine(SalesLine,DestinationPurchaseLine);
      DestinationPurchaseLine."Special Order" := SourcePurchaseLine."Special Order";
      DestinationPurchaseLine."Purchasing Code" := SalesLine."Purchasing Code";
      DestinationPurchaseLine."Special Order Sales No." := SourcePurchaseLine."Special Order Sales No.";
      DestinationPurchaseLine."Special Order Sales Line No." := SourcePurchaseLine."Special Order Sales Line No.";
      DestinationPurchaseLine.VALIDATE("Unit of Measure Code",SourcePurchaseLine."Unit of Measure Code");
      IF SourcePurchaseLine.Quantity <> 0 THEN
        DestinationPurchaseLine.VALIDATE(Quantity,SourcePurchaseLine.Quantity);

      SalesLine.VALIDATE("Unit Cost (LCY)",DestinationPurchaseLine."Unit Cost (LCY)");
      SalesLine."Special Order Purchase No." := DestinationPurchaseLine."Document No.";
      SalesLine."Special Order Purch. Line No." := DestinationPurchaseLine."Line No.";
      SalesLine.MODIFY;
    END;

    [External]
    PROCEDURE MessageIfPurchLinesExist@5(ChangedFieldName@1000 : Text[100]);
    VAR
      MessageText@1001 : Text;
    BEGIN
      IF PurchLinesExist AND NOT GetHideValidationDialog THEN BEGIN
        MessageText := STRSUBSTNO(LinesNotUpdatedMsg,ChangedFieldName);
        MessageText := STRSUBSTNO(SplitMessageTxt,MessageText,Text020);
        MESSAGE(MessageText);
      END;
    END;

    [External]
    PROCEDURE PriceMessageIfPurchLinesExist@7(ChangedFieldName@1000 : Text[100]);
    VAR
      MessageText@1001 : Text;
    BEGIN
      IF PurchLinesExist AND NOT GetHideValidationDialog THEN BEGIN
        MessageText := STRSUBSTNO(LinesNotUpdatedMsg,ChangedFieldName);
        IF "Currency Code" <> '' THEN
          MessageText := STRSUBSTNO(SplitMessageTxt,MessageText,AffectExchangeRateMsg);
        MESSAGE(MessageText);
      END;
    END;

    [External]
    PROCEDURE UpdateCurrencyFactor@12();
    VAR
      UpdateCurrencyExchangeRates@1001 : Codeunit 1281;
      ConfirmManagement@1002 : Codeunit 27;
      Updated@1000 : Boolean;
    BEGIN
      OnBeforeUpdateCurrencyFactor(Rec,Updated);
      IF Updated THEN
        EXIT;

      IF "Currency Code" <> '' THEN BEGIN
        IF "Posting Date" <> 0D THEN
          CurrencyDate := "Posting Date"
        ELSE
          CurrencyDate := WORKDATE;

        IF UpdateCurrencyExchangeRates.ExchangeRatesForCurrencyExist(CurrencyDate,"Currency Code") THEN BEGIN
        //"Currency Factor" := CurrExchRate.ExchangeRate(CurrencyDate,"Currency Code");  //**4PS.o
          "Currency Factor" := CurrExchRate.ExchangeRate(1,"Job No.",CurrencyDate,"Currency Code",FALSE); //**4PS.n
          IF "Currency Code" <> xRec."Currency Code" THEN
            RecreatePurchLines(FIELDCAPTION("Currency Code"));
        END ELSE BEGIN
          IF ConfirmManagement.ConfirmProcess(
               STRSUBSTNO(MissingExchangeRatesQst,"Currency Code",CurrencyDate),TRUE)
          THEN BEGIN
            UpdateCurrencyExchangeRates.OpenExchangeRatesPage("Currency Code");
            UpdateCurrencyFactor;
          END ELSE
            RevertCurrencyCodeAndPostingDate;
        END;
      END ELSE BEGIN
        "Currency Factor" := 0;
        IF "Currency Code" <> xRec."Currency Code" THEN
          RecreatePurchLines(FIELDCAPTION("Currency Code"));
      END;

      OnAfterUpdateCurrencyFactor(Rec,GetHideValidationDialog);
    END;

    LOCAL PROCEDURE ConfirmUpdateCurrencyFactor@13() : Boolean;
    BEGIN
      OnBeforeConfirmUpdateCurrencyFactor(Rec,HideValidationDialog);
      IF GetHideValidationDialog OR NOT GUIALLOWED THEN
        Confirmed := TRUE
      ELSE
        Confirmed := CONFIRM(Text022,FALSE);
      IF Confirmed THEN
        VALIDATE("Currency Factor")
      ELSE
        "Currency Factor" := xRec."Currency Factor";
      EXIT(Confirmed);
    END;

    [External]
    PROCEDURE GetHideValidationDialog@100() : Boolean;
    BEGIN
      //EXIT(HideValidationDialog); //**4PS.o
      EXIT(HideValidationDialog OR (NOT GUIALLOWED)); //**4PS.n
    END;

    [External]
    PROCEDURE SetHideValidationDialog@14(NewHideValidationDialog@1000 : Boolean);
    BEGIN
      HideValidationDialog := NewHideValidationDialog;
    END;

    LOCAL PROCEDURE UpdateLocationCode@160(LocationCode@1000 : Code[10]);
    VAR
      IsHandled@1001 : Boolean;
      UserSetupLocationCode@110121000 : Code[10];
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdateLocationCode(Rec,LocationCode,IsHandled);
      IF NOT IsHandled THEN
      //VALIDATE("Location Code",UserSetupMgt.GetLocation(1,LocationCode,"Responsibility Center")); //**4PS.o
      //**4PS.sn
      BEGIN
        UserSetupLocationCode := UserSetupMgt.GetLocation(1,LocationCode,"Responsibility Center");
        IF UserSetupLocationCode <> '' THEN
          VALIDATE("Location Code",UserSetupLocationCode);
      END;
      //**4PS.en
    END;

    [External]
    PROCEDURE UpdatePurchLines@15(ChangedFieldName@1000 : Text[100];AskQuestion@1001 : Boolean);
    VAR
      Field@1002 : Record 2000000041;
    BEGIN
      Field.SETRANGE(TableNo,DATABASE::"Purchase Header");
      Field.SETRANGE("Field Caption",ChangedFieldName);
      Field.SETFILTER(ObsoleteState,'<>%1',Field.ObsoleteState::Removed);
      Field.FIND('-');
      IF Field.NEXT <> 0 THEN
        ERROR(DuplicatedCaptionsNotAllowedErr);
      UpdatePurchLinesByFieldNo(Field."No.",AskQuestion);

      OnAfterUpdatePurchLines(Rec);
    END;

    [External]
    PROCEDURE UpdatePurchLinesByFieldNo@99(ChangedFieldNo@1000 : Integer;AskQuestion@1001 : Boolean);
    VAR
      Field@1004 : Record 2000000041;
      PurchLineReserve@1003 : Codeunit 99000834;
      Question@1002 : Text[250];
      IsHandled@1005 : Boolean;
      UpdateConfirmed@1100285500 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdatePurchLinesByFieldNo(Rec,ChangedFieldNo,AskQuestion,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF NOT PurchLinesExist THEN
        EXIT;

      IF NOT Field.GET(DATABASE::"Purchase Header",ChangedFieldNo) THEN
        Field.GET(DATABASE::"Purchase Line",ChangedFieldNo);

      IF AskQuestion THEN BEGIN
        Question := STRSUBSTNO(Text032,Field."Field Caption");
        IF GUIALLOWED THEN
          IF DIALOG.CONFIRM(Question,TRUE) THEN
            CASE ChangedFieldNo OF
              //**4PS.sn
              FIELDNO("Order Date"),
              FIELDNO("Location Code"),
              //**4PS.en
              FIELDNO("Expected Receipt Date"),
              FIELDNO("Requested Receipt Date"),
              FIELDNO("Promised Receipt Date"),
              FIELDNO("Lead Time Calculation"),
              FIELDNO("Inbound Whse. Handling Time"):
                ConfirmResvDateConflict;
            END
          ELSE
            EXIT;
      END;

      PurchLine.LOCKTABLE;
      //MODIFY; //**4PS.o
      MODIFY(TRUE); //**4PS.n

      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      IF PurchLine.FINDSET THEN
        REPEAT
          xPurchLine := PurchLine;
          CASE ChangedFieldNo OF
            //**4PS.sn
            FIELDNO("Order Date"):
              IF PurchLine.Type <> PurchLine.Type::" " THEN BEGIN
                PurchLine.VALIDATE("Order Date","Order Date");
                IF FORMAT(PurchLine."Lead Time Calculation") <> '' THEN
                  PurchLine.CheckDeliveryTime(PurchLine.FIELDNO("Item No."));
              END;
            //**4PS.en
            FIELDNO("Expected Receipt Date"):
            //IF PurchLine."No." <> '' THEN //**4PS.o
              IF PurchLine.Type <> PurchLine.Type::" " THEN BEGIN //**4PS.n
                PurchLine.VALIDATE("Expected Receipt Date","Expected Receipt Date");
              //**4PS.sn
                IF FORMAT(PurchLine."Lead Time Calculation") <> '' THEN
                  PurchLine.CheckDeliveryTime(PurchLine.FIELDNO("Item No."));
              END;
              //**4PS.en
            FIELDNO("Currency Factor"):
              IF PurchLine.Type <> PurchLine.Type::" " THEN
                PurchLine.VALIDATE("Direct Unit Cost");
            FIELDNO("Transaction Type"):
              PurchLine.VALIDATE("Transaction Type","Transaction Type");
            FIELDNO("Transport Method"):
              PurchLine.VALIDATE("Transport Method","Transport Method");
            FIELDNO("Entry Point"):
              PurchLine.VALIDATE("Entry Point","Entry Point");
            FIELDNO(Area):
              PurchLine.VALIDATE(Area,Area);
            FIELDNO("Transaction Specification"):
              PurchLine.VALIDATE("Transaction Specification","Transaction Specification");
            FIELDNO("Requested Receipt Date"):
              IF PurchLine."No." <> '' THEN
              //4PS.sn
                IF PurchLine."Promised Receipt Date" <> 0D THEN
                  PurchLine."Requested Receipt Date" := "Requested Receipt Date"
                ELSE
              //4PS.en
                  PurchLine.VALIDATE("Requested Receipt Date","Requested Receipt Date");
            FIELDNO("Prepayment %"):
              IF PurchLine."No." <> '' THEN
                PurchLine.VALIDATE("Prepayment %","Prepayment %");
            FIELDNO("Promised Receipt Date"):
              IF PurchLine."No." <> '' THEN
                PurchLine.VALIDATE("Promised Receipt Date","Promised Receipt Date");
            FIELDNO("Lead Time Calculation"):
              IF PurchLine."No." <> '' THEN
                PurchLine.VALIDATE("Lead Time Calculation","Lead Time Calculation");
            FIELDNO("Inbound Whse. Handling Time"):
              IF PurchLine."No." <> '' THEN
                PurchLine.VALIDATE("Inbound Whse. Handling Time","Inbound Whse. Handling Time");
            PurchLine.FIELDNO("Deferral Code"):
              IF PurchLine."No." <> '' THEN
                PurchLine.VALIDATE("Deferral Code");
            //**4PS.sn
            FIELDNO("Location Code"):
              IF PurchLine."No." <> '' THEN
                PurchLine.VALIDATE("Location Code", "Location Code");
            FIELDNO("Posting Date") :
              PurchLine.VALIDATE("Posting Date","Posting Date");
            //**4PS.en
            // ExFlow ->
            FIELDNO("Receipt No. Mandatory"):
              IF UpdateConfirmed AND (PurchLine.Type <> PurchLine.Type::" ") THEN
                PurchLine.VALIDATE("Receipt No. Mandatory", "Receipt No. Mandatory");
            // <- ExFlow
            ELSE
              OnUpdatePurchLinesByChangedFieldName(Rec,PurchLine,Field.FieldName,ChangedFieldNo);
          END;
          PurchLine.MODIFY(TRUE);
          PurchLineReserve.VerifyChange(PurchLine,xPurchLine);
        UNTIL PurchLine.NEXT = 0;
    END;

    LOCAL PROCEDURE ConfirmResvDateConflict@31();
    VAR
      ResvEngMgt@1000 : Codeunit 99000831;
      ConfirmManagement@1001 : Codeunit 27;
    BEGIN
      IF ResvEngMgt.ResvExistsForPurchHeader(Rec) THEN
        IF NOT ConfirmManagement.ConfirmProcess(Text050,TRUE) THEN
          ERROR('');
    END;

    [External]
    PROCEDURE CreateDim@16(Type1@1000 : Integer;No1@1001 : Code[20];Type2@1002 : Integer;No2@1003 : Code[20];Type3@1004 : Integer;No3@1005 : Code[20];Type4@1006 : Integer;No4@1007 : Code[20];Type5@1100525001 : Integer;No5@1100525002 : Code[20];Type6@1100525003 : Integer;No6@1100525004 : Code[20]);
    VAR
      SourceCodeSetup@1010 : Record 242;
      TableID@1011 : ARRAY [10] OF Integer;
      No@1012 : ARRAY [10] OF Code[20];
      OldDimSetID@1008 : Integer;
      Dim2@1100525005 : Code[20];
    BEGIN
      SourceCodeSetup.GET;
      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;
      TableID[4] := Type4;
      No[4] := No4;

      //**4PS.sn
      TableID[5] := Type5;
      No[5] := No5;
      TableID[6] := Type6;
      No[6] := No6;

      Dim2 := "Shortcut Dimension 2 Code";
      //**4PS.en

      OnAfterCreateDimTableIDs(Rec,CurrFieldNo,TableID,No);

      //"Shortcut Dimension 1 Code" := ''; //**4PS.o Must be kept for Department Authorization
      "Shortcut Dimension 2 Code" := '';
      OldDimSetID := "Dimension Set ID";
      "Dimension Set ID" :=
        DimMgt.GetRecDefaultDimID(
          Rec,CurrFieldNo,TableID,No,SourceCodeSetup.Purchases,"Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",0,0);

      OnCreateDimOnBeforeUpdateLines(Rec,xRec,CurrFieldNo);

      IF (OldDimSetID <> "Dimension Set ID") AND PurchLinesExist THEN BEGIN
        MODIFY;
        UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      END;

      //**4PS.sn
      IF (Dim2 <> '') AND
         (("Shortcut Dimension 2 Code" = '') OR
          (CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")))
      THEN BEGIN
        "Shortcut Dimension 2 Code" := Dim2;
        ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
      END;
      //**4PS.en
    END;

    [External]
    PROCEDURE ValidateShortcutDimCode@19(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    VAR
      OldDimSetID@1005 : Integer;
    BEGIN
      //**4PS.sn
      IF FieldNumber = 1 THEN
        DimMgt.CheckDepartmentAuthorization(DATABASE::"Purchase Header", ShortcutDimCode);
      //**4PS.en
      OldDimSetID := "Dimension Set ID";
      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");
      IF "No." <> '' THEN
        IF NOT SkipModify THEN //**4PS.n
          MODIFY;

      IF OldDimSetID <> "Dimension Set ID" THEN BEGIN
        //MODIFY; //**4PS.o
        //**4PS.sn
        IF "No." <> '' THEN BEGIN
          IF NOT SkipModify THEN
            MODIFY(TRUE);
        //**4PS.en
          IF PurchLinesExist THEN
            UpdateAllLineDim("Dimension Set ID",OldDimSetID);
        END; //**4PS.n
      END;

      OnAfterValidateShortcutDimCode(Rec,xRec,FieldNumber,ShortcutDimCode);
    END;

    PROCEDURE ReceivedPurchLinesExist@20() : Boolean;
    BEGIN
      //4PS: changed to global function
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.SETFILTER("Quantity Received",'<>0');
      EXIT(PurchLine.FINDFIRST);
    END;

    LOCAL PROCEDURE ReturnShipmentExist@5800() : Boolean;
    BEGIN
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.SETFILTER("Return Qty. Shipped",'<>0');
      EXIT(PurchLine.FINDFIRST);
    END;

    [External]
    PROCEDURE UpdateShipToAddress@21();
    VAR
      IsHandled@1000 : Boolean;
      ProjectLocation@1100528504 : Record 11012011;
      ServiceOrderLocation@1100528505 : Record 11071688;
      ServiceLocation@1100528506 : Record 11012801;
      Contact@1100528507 : Record 5050;
      PlantLocation@1100528501 : Record 11012554;
      OrderAddress@1100528500 : Record 224;
      ShipToAddr@1100528502 : Record 222;
      Project@1100528508 : Record 11072003;
      ServiceOrder@1100528503 : Record 11012823;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdateShipToAddress(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF IsCreditDocType THEN BEGIN
        OnAfterUpdateShipToAddress(Rec);
        EXIT;
      END;

      //**4PS.so
      // IF ("Location Code" <> '') AND Location.GET("Location Code") AND ("Sell-to Customer No." = '') THEN BEGIN
      //  SetShipToAddress(
      //    Location.Name,Location."Name 2",Location.Address,Location."Address 2",
      //    Location.City,Location."Post Code",Location.County,Location."Country/Region Code");
      //  "Ship-to Contact" := Location.Contact;
      // END;
      //
      // IF ("Location Code" = '') AND ("Sell-to Customer No." = '') THEN BEGIN
      //  CompanyInfo.GET;
      //  "Ship-to Code" := '';
      //  SetShipToAddress(
      //    CompanyInfo."Ship-to Name",CompanyInfo."Ship-to Name 2",CompanyInfo."Ship-to Address",CompanyInfo."Ship-to Address 2",
      //    CompanyInfo."Ship-to City",CompanyInfo."Ship-to Post Code",CompanyInfo."Ship-to County",
      //    CompanyInfo."Ship-to Country/Region Code");
      //  "Ship-to Contact" := CompanyInfo."Ship-to Contact";
      // END;
      //**4PS.eo

      //**4PS.sn
      CASE Deliver OF
        Deliver::"Default (Company Address)":
          BEGIN
            CompanyInfo.GET;

            SetShipToAddress(
              CompanyInfo."Ship-to Name",CompanyInfo."Ship-to Name 2",CompanyInfo."Ship-to Address",CompanyInfo."Ship-to Address 2",
              CompanyInfo."Ship-to City",CompanyInfo."Ship-to Post Code",CompanyInfo."Ship-to County",
              CompanyInfo."Ship-to Country/Region Code");
            "Ship-to Contact" := CompanyInfo."Ship-to Contact";
            "Ship-to Code" := '';
      END;
        Deliver::Location:
          BEGIN
            IF Location.GET("Location Code") THEN;

        SetShipToAddress(
          Location.Name,Location."Name 2",Location.Address,Location."Address 2",
          Location.City,Location."Post Code",Location.County,Location."Country/Region Code");
        "Ship-to Contact" := Location.Contact;
      END;
        Deliver::"Project Location":
          BEGIN
            IF ProjectLocation.GET("Ship-to Project", "Ship-to Location") THEN BEGIN
              SetShipToAddress(
                ProjectLocation.Name,ProjectLocation."Name 2",ProjectLocation.Address,ProjectLocation."Address 2",
                ProjectLocation.City,ProjectLocation."Post Code",ProjectLocation.County,
                ProjectLocation."Country/Region Code");
              "Ship-to Contact" := ProjectLocation.Contact;
            END ELSE BEGIN
              IF Project.GET("Ship-to Project") THEN;

              SetShipToAddress(
                Project.Description,'',Project.Address,Project."Address 2",
                Project.City,Project."Post Code",Project.County,
                Project."Country/Region Code");
              "Ship-to Contact" := Project.Contact;
            END;
            "Location Code" := '';
          END;
        Deliver::"Service Location":
          BEGIN
            IF ServiceOrder.GET("Service Order No.") THEN;

            IF ServiceOrderLocation.GET("Service Order No.", "Ship-to Location") THEN BEGIN
        SetShipToAddress(
                ServiceOrderLocation.Name,ServiceOrderLocation."Name 2",ServiceOrderLocation.Address,ServiceOrderLocation."Address 2",
                ServiceOrderLocation.City,ServiceOrderLocation."Post Code",ServiceOrderLocation.County,
                ServiceOrderLocation."Country/Region Code");
              "Ship-to Contact" := ServiceOrderLocation.Contact;
            END ELSE BEGIN
              IF ServiceLocation.GET(ServiceOrder."Service Location No.") THEN BEGIN
                SetShipToAddress(
                  ServiceLocation.Description,ServiceLocation."Description 2",ServiceLocation.Address,ServiceLocation."Address 2",
                  ServiceLocation.City,ServiceLocation."Post Code",ServiceLocation.County,
                  ServiceLocation."Country/Region Code");
                "Ship-to Contact" := ServiceLocation."Contact Name";
              END ELSE BEGIN
                SetShipToAddress(
                  ServiceOrder.Name,ServiceOrder."Name 2",ServiceOrder.Address,ServiceOrder."Address 2",
                  ServiceOrder.City,ServiceOrder."Post Code",ServiceOrder.County,
                  ServiceOrder."Country/Region Code");
                "Ship-to Contact" := ServiceOrder."Contact Person No.";
              END;
            END;
            "Location Code" := '';
          END;
        Deliver::"Contact Address":
          BEGIN
            IF Contact.GET("Ship-to Location") THEN;

            IF Contact."Visit Address" = '' THEN BEGIN
              SetShipToAddress(
                Contact.Name,Contact."Name 2",Contact.Address,Contact."Address 2",
                Contact.City,Contact."Post Code",Contact.County,
                Contact."Country/Region Code");
            END ELSE BEGIN
              SetShipToAddress(
                Contact.Name,Contact."Name 2",Contact."Visit Address",Contact."Visit Address 2",
                Contact."Visit Address City",Contact."Visit Address Post Code",Contact."Visit Address County",
                Contact."Visit Address Country/Region");
            END;
            "Ship-to Contact" := '';
            "Location Code" := '';
          END;
        Deliver::"Plant Location":
          BEGIN
            IF PlantLocation.GET("Ship-to Location") THEN;

            PlantLocation.CheckBlock("Document Type", TRUE, FALSE);

            SetShipToAddress(
              PlantLocation.Description,PlantLocation."Description 2",PlantLocation.Address,PlantLocation."Address 2",
              PlantLocation.City,PlantLocation."Post Code",PlantLocation.County,
              PlantLocation."Country/Region Code");
            "Ship-to Contact" := PlantLocation.Contact;
            "Location Code" := '';
          END;
        Deliver::"Order Address":
          BEGIN
            IF OrderAddress.GET("Buy-from Vendor No.","Ship-to Location") THEN;

            SetShipToAddress(
              OrderAddress.Name,OrderAddress."Name 2",OrderAddress.Address,OrderAddress."Address 2",
              OrderAddress.City,OrderAddress."Post Code",OrderAddress.County,
              OrderAddress."Country/Region Code");
            "Ship-to Contact" := OrderAddress.Contact;
            "Location Code" := '';
          END;
        Deliver::"Customer Address":
          BEGIN
            IF Cust.GET("Sell-to Customer No.") THEN;

            SetShipToAddress(
              Cust.Name,Cust."Name 2",Cust.Address,Cust."Address 2",
              Cust.City,Cust."Post Code",Cust.County,Cust."Country/Region Code");
            "Ship-to Contact" := Cust.Contact;
            "Shipment Method Code" := Cust."Shipment Method Code";
            IF Cust."Location Code" <> '' THEN
              VALIDATE("Location Code",Cust."Location Code");
          END;
        Deliver::"Customer Ship-to Address":
          BEGIN
            IF ShipToAddr.GET("Sell-to Customer No.","Ship-to Code") THEN;

            SetShipToAddress(
              ShipToAddr.Name,ShipToAddr."Name 2",ShipToAddr.Address,ShipToAddr."Address 2",
              ShipToAddr.City,ShipToAddr."Post Code",ShipToAddr.County,ShipToAddr."Country/Region Code");
            "Ship-to Contact" := ShipToAddr.Contact;
            "Shipment Method Code" := ShipToAddr."Shipment Method Code";
            IF ShipToAddr."Location Code" <> '' THEN
              VALIDATE("Location Code",ShipToAddr."Location Code");
          END;
      END;
      //**4PS.en

      OnAfterUpdateShipToAddress(Rec);
    END;

    LOCAL PROCEDURE DeletePurchaseLines@17();
    VAR
      ReservMgt@1000 : Codeunit 99000845;
    BEGIN
      IF PurchLine.FINDSET THEN BEGIN
        ReservMgt.DeleteDocumentReservation(DATABASE::"Purchase Line","Document Type","No.",GetHideValidationDialog);
        REPEAT
          PurchLine.SuspendStatusCheck(TRUE);
          PurchLine.DELETE(TRUE);
        UNTIL PurchLine.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE ClearItemAssgntPurchFilter@22(VAR TempItemChargeAssgntPurch@1000 : TEMPORARY Record 5805);
    BEGIN
      TempItemChargeAssgntPurch.SETRANGE("Document Line No.");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Type");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. No.");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Line No.");
    END;

    LOCAL PROCEDURE CheckReceiptInfo@70(VAR PurchLine@1000 : Record 39;PayTo@1001 : Boolean);
    BEGIN
      IF "Document Type" = "Document Type"::Order THEN
        PurchLine.SETFILTER("Quantity Received",'<>0')
      ELSE
        IF "Document Type" = "Document Type"::Invoice THEN BEGIN
          IF NOT PayTo THEN
            PurchLine.SETRANGE("Buy-from Vendor No.",xRec."Buy-from Vendor No.");
          PurchLine.SETFILTER("Receipt No.",'<>%1','');
        END;

      IF PurchLine.FINDFIRST THEN
        IF "Document Type" = "Document Type"::Order THEN
          PurchLine.TESTFIELD("Quantity Received",0)
        ELSE
          PurchLine.TESTFIELD("Receipt No.",'');
      PurchLine.SETRANGE("Receipt No.");
      PurchLine.SETRANGE("Quantity Received");
      IF NOT PayTo THEN
        PurchLine.SETRANGE("Buy-from Vendor No.");
    END;

    LOCAL PROCEDURE CheckPrepmtInfo@119(VAR PurchLine@1000 : Record 39);
    BEGIN
      IF "Document Type" = "Document Type"::Order THEN BEGIN
        PurchLine.SETFILTER("Prepmt. Amt. Inv.",'<>0');
        IF PurchLine.FIND('-') THEN
          PurchLine.TESTFIELD("Prepmt. Amt. Inv.",0);
        PurchLine.SETRANGE("Prepmt. Amt. Inv.");
      END;
    END;

    LOCAL PROCEDURE CheckReturnInfo@121(VAR PurchLine@1000 : Record 39;PayTo@1001 : Boolean);
    BEGIN
      IF "Document Type" = "Document Type"::"Return Order" THEN
        PurchLine.SETFILTER("Return Qty. Shipped",'<>0')
      ELSE
        IF "Document Type" = "Document Type"::"Credit Memo" THEN BEGIN
          IF NOT PayTo THEN
            PurchLine.SETRANGE("Buy-from Vendor No.",xRec."Buy-from Vendor No.");
          PurchLine.SETFILTER("Return Shipment No.",'<>%1','');
        END;

      IF PurchLine.FINDFIRST THEN
        IF "Document Type" = "Document Type"::"Return Order" THEN
          PurchLine.TESTFIELD("Return Qty. Shipped",0)
        ELSE
          PurchLine.TESTFIELD("Return Shipment No.",'');
    END;

    LOCAL PROCEDURE UpdateBuyFromCont@24(VendorNo@1000 : Code[20]);
    VAR
      ContBusRel@1003 : Record 5054;
      Vend@1004 : Record 23;
      OfficeContact@1001 : Record 5050;
      OfficeMgt@1002 : Codeunit 1630;
      OrderAddress@1100525000 : Record 224;
    BEGIN
      IF OfficeMgt.GetContact(OfficeContact,VendorNo) THEN BEGIN
        SetHideValidationDialog(TRUE);
        UpdateBuyFromVend(OfficeContact."No.");
        SetHideValidationDialog(FALSE);
      END ELSE
        IF Vend.GET(VendorNo) THEN BEGIN
          IF Vend."Primary Contact No." <> '' THEN
            "Buy-from Contact No." := Vend."Primary Contact No."
          ELSE
            "Buy-from Contact No." := ContBusRel.GetContactNo(ContBusRel."Link to Table"::Vendor,"Buy-from Vendor No.");
          "Buy-from Contact" := Vend.Contact;
          "Buy-from Contact Person No." := ''; //**4PS.n
        END;

      IF "Buy-from Contact No." <> '' THEN
        IF OfficeContact.GET("Buy-from Contact No.") THEN
          OfficeContact.CheckIfPrivacyBlockedGeneric;

      OnAfterUpdateBuyFromCont(Rec,Vend,OfficeContact);
      //**4PS.sn
      IF "Order Address Code" <> '' THEN
        IF OrderAddress.GET("Buy-from Vendor No.", "Order Address Code") THEN BEGIN
          "Buy-from Contact" := OrderAddress.Contact;
          "Buy-from Contact Person No." := '';
        END;

      UpdateEMailForPurchOrderForContactPerson;
      //**4PS.en
    END;

    LOCAL PROCEDURE UpdatePayToCont@27(VendorNo@1000 : Code[20]);
    VAR
      ContBusRel@1003 : Record 5054;
      Vend@1001 : Record 23;
      Contact@1002 : Record 5050;
    BEGIN
      IF Vend.GET(VendorNo) THEN BEGIN
        IF Vend."Primary Contact No." <> '' THEN
          "Pay-to Contact No." := Vend."Primary Contact No."
        ELSE
          "Pay-to Contact No." := ContBusRel.GetContactNo(ContBusRel."Link to Table"::Vendor,"Pay-to Vendor No.");
        "Pay-to Contact" := Vend.Contact;
      END;

      IF "Pay-to Contact No." <> '' THEN
        IF Contact.GET("Pay-to Contact No.") THEN
          Contact.CheckIfPrivacyBlockedGeneric;

      OnAfterUpdatePayToCont(Rec,Vend,Contact);
    END;

    LOCAL PROCEDURE UpdateBuyFromVend@25(ContactNo@1002 : Code[20]);
    VAR
      ContBusinessRelation@1007 : Record 5054;
      Vend@1006 : Record 23;
      Cont@1005 : Record 5050;
      FindContactNo@1100525000 : Code[20];
    BEGIN
      "Buy-from Contact Person No." := ''; //**4PS.n
      IF Cont.GET(ContactNo) THEN BEGIN
        "Buy-from Contact No." := Cont."No.";
        IF Cont.Type = Cont.Type::Person THEN
          "Buy-from Contact" := Cont.Name
        ELSE
          IF Vend.GET("Buy-from Vendor No.") THEN
            "Buy-from Contact" := Vend.Contact
          ELSE
            //"Buy-from Contact" := '' //**4PS.o
            "Buy-from Contact" := ''; //**4PS.n
        UpdateEMailForPurchOrderForContactPerson; //**4PS.n
      END ELSE BEGIN
        "Buy-from Contact" := '';
        UpdateEMailForPurchOrderForContactPerson; //**4PS.n
        EXIT;
      END;

      //IF ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Vendor,Cont."Company No.") THEN BEGIN //**4PS.o
      //**4PS.sn
      IF Cont."Company No." = '' THEN
        FindContactNo := Cont."No."
      ELSE
        FindContactNo := Cont."Company No.";

      IF ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Vendor,FindContactNo) THEN BEGIN
      //**4PS.en
        IF ("Buy-from Vendor No." <> '') AND
           ("Buy-from Vendor No." <> ContBusinessRelation."No.")
        THEN
          ERROR(Text037,Cont."No.",Cont.Name,"Buy-from Vendor No.");
        IF "Buy-from Vendor No." = '' THEN BEGIN
          SkipBuyFromContact := TRUE;
          VALIDATE("Buy-from Vendor No.",ContBusinessRelation."No.");
          SkipBuyFromContact := FALSE;
        END;
      END ELSE
      //**4PS.sn
      BEGIN
        IF ("Document Type" <> "Document Type"::Quote) THEN
      //**4PS.en
          ERROR(Text039,Cont."No.",Cont.Name)
      //**4PS.sn
        ELSE BEGIN
          "Buy-from Vendor Name" := Cont.Name;
          "Buy-from Vendor Name 2" := Cont."Name 2";
          "Buy-from Address" := Cont.Address;
          "Buy-from Address 2" := Cont."Address 2";
          "Buy-from City" := Cont.City;
          "Buy-from Post Code" := Cont."Post Code";
          "Buy-from County" := Cont.County;
          "Buy-from Country/Region Code" := Cont."Country/Region Code";
          "Buy-from Phone No." := Cont."Phone No.";
          "Buy-from Fax No." := Cont."Fax No.";
          EXIT;
        END;
      END;
      //**4PS.en

      IF ("Buy-from Vendor No." = "Pay-to Vendor No.") OR
         ("Pay-to Vendor No." = '')
      THEN
        VALIDATE("Pay-to Contact No.","Buy-from Contact No.");

      OnAfterUpdateBuyFromVend(Rec,Cont);
    END;

    LOCAL PROCEDURE UpdatePayToVend@26(ContactNo@1000 : Code[20]);
    VAR
      ContBusinessRelation@1005 : Record 5054;
      Vend@1004 : Record 23;
      Cont@1003 : Record 5050;
      FindContactNo@1100525000 : Code[20];
    BEGIN
      IF Cont.GET(ContactNo) THEN BEGIN
        "Pay-to Contact No." := Cont."No.";
        IF Cont.Type = Cont.Type::Person THEN
          "Pay-to Contact" := Cont.Name
        ELSE
          IF Vend.GET("Pay-to Vendor No.") THEN
            "Pay-to Contact" := Vend.Contact
          ELSE
            "Pay-to Contact" := '';
      END ELSE BEGIN
        "Pay-to Contact" := '';
        EXIT;
      END;

      //IF ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Vendor,Cont."Company No.") THEN BEGIN //**4PS.o
      //**4PS.sn
      IF Cont."Company No." = '' THEN
        FindContactNo := Cont."No."
      ELSE
        FindContactNo := Cont."Company No.";

      IF ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Vendor,FindContactNo) THEN BEGIN
      //**4PS.en
        IF "Pay-to Vendor No." = '' THEN BEGIN
          SkipPayToContact := TRUE;
          VALIDATE("Pay-to Vendor No.",ContBusinessRelation."No.");
          SkipPayToContact := FALSE;
        END ELSE
          IF "Pay-to Vendor No." <> ContBusinessRelation."No." THEN
            ERROR(Text037,Cont."No.",Cont.Name,"Pay-to Vendor No.");
      END ELSE
        ERROR(Text039,Cont."No.",Cont.Name);

      OnAfterUpdatePayToVend(Rec,Cont);
    END;

    [External]
    PROCEDURE CreateInvtPutAwayPick@29();
    VAR
      WhseRequest@1000 : Record 5765;
    BEGIN
      TESTFIELD(Status,Status::Released);

      WhseRequest.RESET;
      WhseRequest.SETCURRENTKEY("Source Document","Source No.");
      CASE "Document Type" OF
        "Document Type"::Order:
          WhseRequest.SETRANGE("Source Document",WhseRequest."Source Document"::"Purchase Order");
        "Document Type"::"Return Order":
          WhseRequest.SETRANGE("Source Document",WhseRequest."Source Document"::"Purchase Return Order");
      END;
      WhseRequest.SETRANGE("Source No.","No.");
      REPORT.RUNMODAL(REPORT::"Create Invt Put-away/Pick/Mvmt",TRUE,FALSE,WhseRequest);
    END;

    PROCEDURE CreatePurchLineRegAcc@1210190100();
    VAR
      PurchLineNoRegAccount@1210190034 : Integer;
      OtherPurchLinesPresent@1100485001 : Boolean;
    BEGIN
      //**4PS
      // Rules for adding/changing purchase line registration account
      //
      //                                    | purchase line reg account
      //                                    | present               | not present
      // ---------------------------------------------------------------------------
      // Other lines (except text) present  | do nothing            | do nothing
      //                                    |                       |
      //                                    |-----------------------|---------------
      //                       not present  | rewrite purchase line | add purchase line
      //                                    | registration account  | registration account
      //

      IF NOT ("Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"]) THEN
        EXIT;

      IF "Invoice Lines Input" THEN
        EXIT;

      MODIFY;

      PurchSetup.GET;

      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.SETRANGE(Type, PurchLine.Type::"G/L Account");
      IF NOT "Preregister WIP" THEN
        PurchLine.SETRANGE("No.", PurchSetup."Purchase Registration Account")
      ELSE
        PurchLine.SETFILTER(
          "No.", '%1|%2', PurchSetup."Preregistration WIP Account",
          PurchSetup."Purchase Registration Account");

      IF PurchLine.FINDFIRST THEN BEGIN
        PurchLineNoRegAccount := PurchLine."Line No.";
        PurchLine.SETFILTER("Line No.", '<>%1', PurchLineNoRegAccount);
      END;
      PurchLine.SETFILTER(Type, '<>%1', PurchLine.Type::" ");
      PurchLine.SETRANGE("No.");
      OtherPurchLinesPresent := PurchLine.FINDFIRST;
      PurchLine.SETRANGE("Line No.");
      PurchLine.SETRANGE(Type);

      IF OtherPurchLinesPresent THEN
        EXIT;

      //Dus ook EXIT als meerdere regels op voorregistratie WIP zijn geschreven (op PurchSetup."Preregistration WIP Account") 12-02-2008

      IF (PurchLineNoRegAccount > 0) THEN
        PurchLine.DELETE
      ELSE
        PurchLineNoRegAccount := 10000;

      PurchLine.INIT;
      PurchLine."Document Type" := "Document Type";
      PurchLine."Invoice Lines Input" := FALSE;
      PurchLine."Document No." := "No.";
      PurchLine."Line No." := PurchLineNoRegAccount;
      IF ("Preregister WIP") AND ("Job No." <> '') THEN
        PurchLine.VALIDATE("Job No.", "Job No.");
      PurchLine."VAT Bus. Posting Group" := "VAT Bus. Posting Group";
      PurchLine."Gen. Bus. Posting Group" := "Gen. Bus. Posting Group";
      PurchLine."Buy-from Vendor No." := "Buy-from Vendor No.";
      PurchLine.Type := PurchLine.Type::"G/L Account";

      IF (NOT "Preregister WIP") OR (("Preregister WIP") AND ("Job No." = ''))THEN BEGIN
        PurchSetup.TESTFIELD("Purchase Registration Account");
        PurchLine.VALIDATE("No.",PurchSetup."Purchase Registration Account")
      END ELSE BEGIN
        PurchSetup.TESTFIELD("Preregistration WIP Account");
        PurchLine."System-Created Entry" := TRUE;
        PurchLine.VALIDATE("No.",PurchSetup."Preregistration WIP Account");
      END;

      GLAcc.GET(PurchLine."No.");
      "Purchase Registration Account" := PurchLine."No.";
      PurchLine.Description := GLAcc.Name;
      PurchLine."Gen. Prod. Posting Group" := GLAcc."Gen. Prod. Posting Group";
      IF NOT "Amounts only" THEN BEGIN
        PurchLine.Quantity := 1;
        PurchLine."Qty. to Receive" := 1;
        IF "Document Type" = "Document Type"::"Credit Memo" THEN
          PurchLine."Return Qty. to Ship" := 1;
        PurchLine."Qty. to Invoice" := 1;
        PurchLine.InitOutstanding;
      END;
      PurchLine."VAT Prod. Posting Group" := "VAT Prod. Posting Group";
      VATSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group");
      PurchLine."VAT %" := VATSetup."VAT %";
      PurchLine."VAT Calculation Type" := VATSetup."VAT Calculation Type";
      PurchLine."Manually VAT Posting" := "Manually VAT Posting";
      PurchLine."Currency Code" := "Currency Code";

      PurchLine.VALIDATE("VAT Prod. Posting Group");
      IF "Prices Including VAT" THEN BEGIN
        PurchLine.VALIDATE("Line Amount","Amount incl. VAT");
        IF "Manually VAT Posting" THEN BEGIN
          PurchLine.VALIDATE(Amount,"Amount excl. VAT");
          PurchLine.VALIDATE("Amount Including VAT","Amount incl. VAT");
        END;
      END ELSE BEGIN
        IF "Manually VAT Posting" THEN BEGIN
          PurchLine.VALIDATE(Amount,"Amount excl. VAT");
          PurchLine.VALIDATE("Amount Including VAT","Amount incl. VAT");
        END ELSE
          PurchLine.VALIDATE("Amount Including VAT","Amount incl. VAT");
      END;

      IF "Prices Including VAT" THEN
        PurchLine.VALIDATE("Direct Unit Cost",PurchLine."Amount Including VAT")
      ELSE
        PurchLine.VALIDATE("Direct Unit Cost",PurchLine.Amount);

      IF "Amounts only" THEN BEGIN
        PurchLine.UpdateAmounts;
        PurchLine.VALIDATE("Line Amount");
      END;

      PurchLine."Buy-from Vendor No." := "Buy-from Vendor No.";
      PurchLine."Cost Type" := PurchLine."Cost Type"::" ";
      PurchLine.VALIDATE("Posting Date","Posting Date");
      PurchLine."Input by" := USERID;
      PurchLine."Input Date" := TODAY;
      PurchLine.INSERT;
    END;

    [External]
    PROCEDURE ShowDocDim@32();
    VAR
      OldDimSetID@1000 : Integer;
    BEGIN
      DimMgt.SetTableID(DATABASE::"Purchase Header"); //**4PS.n
      OldDimSetID := "Dimension Set ID";
      "Dimension Set ID" :=
        DimMgt.EditDimensionSet2(
          "Dimension Set ID",STRSUBSTNO('%1 %2',"Document Type","No."),
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");

      IF OldDimSetID <> "Dimension Set ID" THEN BEGIN
        MODIFY;
        IF PurchLinesExist THEN
          UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      END;
    END;

    [External]
    PROCEDURE UpdateAllLineDim@34(NewParentDimSetID@1000 : Integer;OldParentDimSetID@1001 : Integer);
    VAR
      ConfirmManagement@1004 : Codeunit 27;
      NewDimSetID@1002 : Integer;
      ReceivedShippedItemLineDimChangeConfirmed@1003 : Boolean;
      IsHandled@1005 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdateAllLineDim(Rec,NewParentDimSetID,OldParentDimSetID,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF NewParentDimSetID = OldParentDimSetID THEN
        EXIT;

      IF (NOT HideValidationDialog AND GUIALLOWED) THEN //**4PS.n
        IF NOT ConfirmManagement.ConfirmProcess(Text051,TRUE) THEN
          EXIT;

      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.LOCKTABLE;
      IF PurchLine.FIND('-') THEN
        REPEAT
          NewDimSetID := DimMgt.GetDeltaDimSetID(PurchLine."Dimension Set ID",NewParentDimSetID,OldParentDimSetID);
          IF PurchLine."Dimension Set ID" <> NewDimSetID THEN BEGIN
            // ExFlow ->
            IF ExFlowSetup.GET THEN
              xPurchLine := PurchLine;
            // <- ExFlow
            PurchLine."Dimension Set ID" := NewDimSetID;

            IF NOT GetHideValidationDialog AND GUIALLOWED THEN
              VerifyReceivedShippedItemLineDimChange(ReceivedShippedItemLineDimChangeConfirmed);

            DimMgt.UpdateGlobalDimFromDimSetID(
              PurchLine."Dimension Set ID",PurchLine."Shortcut Dimension 1 Code",PurchLine."Shortcut Dimension 2 Code");
            //**4PS.sn
            PurchLine."Modified by" := USERID;
            PurchLine."Last Date Modified" := TODAY;
            //**4PS.en
            PurchLine.MODIFY;
            //348837
            // ExFlow ->
            IF ExFlowSetup.GET THEN BEGIN
              IF PurchLine.Approve THEN
                ExFlow.UpdateLine(PurchLine,xPurchLine,FALSE);
            END;
            // <- ExFlow
            //348837
          END;
        UNTIL PurchLine.NEXT = 0;
    END;

    LOCAL PROCEDURE VerifyReceivedShippedItemLineDimChange@71(VAR ReceivedShippedItemLineDimChangeConfirmed@1000 : Boolean);
    BEGIN
      IF PurchLine.IsReceivedShippedItemDimChanged THEN
        IF NOT ReceivedShippedItemLineDimChangeConfirmed THEN
          ReceivedShippedItemLineDimChangeConfirmed := PurchLine.ConfirmReceivedShippedItemDimChange;
    END;

    [External]
    PROCEDURE SetAmountToApply@18(AppliesToDocNo@1000 : Code[20];VendorNo@1001 : Code[20]);
    VAR
      VendLedgEntry@1002 : Record 25;
    BEGIN
      VendLedgEntry.SETCURRENTKEY("Document No.");
      VendLedgEntry.SETRANGE("Document No.",AppliesToDocNo);
      VendLedgEntry.SETRANGE("Vendor No.",VendorNo);
      VendLedgEntry.SETRANGE(Open,TRUE);
      IF VendLedgEntry.FINDFIRST THEN BEGIN
        IF VendLedgEntry."Amount to Apply" = 0 THEN  BEGIN
          VendLedgEntry.CALCFIELDS("Remaining Amount");
          VendLedgEntry."Amount to Apply" := VendLedgEntry."Remaining Amount";
        END ELSE
          VendLedgEntry."Amount to Apply" := 0;
        VendLedgEntry."Accepted Payment Tolerance" := 0;
        VendLedgEntry."Accepted Pmt. Disc. Tolerance" := FALSE;
        CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",VendLedgEntry);
      END;
    END;

    [External]
    PROCEDURE SetShipToForSpecOrder@23();
    BEGIN
      IF Location.GET("Location Code") THEN BEGIN
        "Ship-to Code" := '';
        SetShipToAddress(
          Location.Name,Location."Name 2",Location.Address,Location."Address 2",
          Location.City,Location."Post Code",Location.County,Location."Country/Region Code");
        "Ship-to Contact" := Location.Contact;
        "Location Code" := Location.Code;
      END ELSE BEGIN
        CompanyInfo.GET;
        "Ship-to Code" := '';
        SetShipToAddress(
          CompanyInfo."Ship-to Name",CompanyInfo."Ship-to Name 2",CompanyInfo."Ship-to Address",CompanyInfo."Ship-to Address 2",
          CompanyInfo."Ship-to City",CompanyInfo."Ship-to Post Code",CompanyInfo."Ship-to County",
          CompanyInfo."Ship-to Country/Region Code");
        "Ship-to Contact" := CompanyInfo."Ship-to Contact";
        "Location Code" := '';
      END;

      OnAfterSetShipToForSpecOrder(Rec);
    END;

    LOCAL PROCEDURE JobUpdatePurchLines@28(SkipJobCurrFactorUpdate@1000 : Boolean);
    BEGIN
      WITH PurchLine DO BEGIN
        SETFILTER("Job No.",'<>%1','');
        SETFILTER("Job Task No.",'<>%1','');
        LOCKTABLE;
        IF FINDSET(TRUE,FALSE) THEN BEGIN
          SetPurchHeader(Rec);
          REPEAT
            IF NOT SkipJobCurrFactorUpdate THEN
              JobSetCurrencyFactor;
            CreateTempJobJnlLine(FALSE);
            UpdateJobPrices;
            //**4PS.sn
            "Modified by" := USERID;
            "Last Date Modified" := TODAY;
            //**4PS.en
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END
    END;

    PROCEDURE GetPstdDocLinesToRevere@47();
    VAR
      PurchPostedDocLines@1002 : Page 5855;
    BEGIN
      GetVend("Buy-from Vendor No.");
      PurchPostedDocLines.SetToPurchHeader(Rec);
      PurchPostedDocLines.SETRECORD(Vend);
      PurchPostedDocLines.LOOKUPMODE := TRUE;
      IF PurchPostedDocLines.RUNMODAL = ACTION::LookupOK THEN
        PurchPostedDocLines.CopyLineToDoc;

      CLEAR(PurchPostedDocLines);
    END;

    [External]
    PROCEDURE SetSecurityFilterOnRespCenter@43();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeSetSecurityFilterOnRespCenter(Rec,IsHandled);
      IF (NOT IsHandled) AND (UserSetupMgt.GetPurchasesFilter <> '') THEN BEGIN
        FILTERGROUP(2);
        SETRANGE("Responsibility Center",UserSetupMgt.GetPurchasesFilter);
        FILTERGROUP(0);
      END;

      SETRANGE("Date Filter",0D,WORKDATE - 1);
    END;

    [External]
    PROCEDURE CalcInvDiscForHeader@45();
    VAR
      PurchaseInvDisc@1000 : Codeunit 70;
    BEGIN
      GetPurchSetup;
      IF PurchSetup."Calc. Inv. Discount" THEN
        PurchaseInvDisc.CalculateIncDiscForHeader(Rec);
    END;

    [External]
    PROCEDURE AddShipToAddress@46(SalesHeader@1000 : Record 36;ShowError@1001 : Boolean);
    VAR
      PurchLine2@1002 : Record 39;
    BEGIN
      IF ShowError THEN BEGIN
        PurchLine2.RESET;
        PurchLine2.SETRANGE("Document Type","Document Type"::Order);
        PurchLine2.SETRANGE("Document No.","No.");
        IF NOT PurchLine2.ISEMPTY THEN BEGIN
          IF "Ship-to Name" <> SalesHeader."Ship-to Name" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Name"),"No.",SalesHeader."No.");
          IF "Ship-to Name 2" <> SalesHeader."Ship-to Name 2" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Name 2"),"No.",SalesHeader."No.");
          IF "Ship-to Address" <> SalesHeader."Ship-to Address" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Address"),"No.",SalesHeader."No.");
          IF "Ship-to Address 2" <> SalesHeader."Ship-to Address 2" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Address 2"),"No.",SalesHeader."No.");
          IF "Ship-to Post Code" <> SalesHeader."Ship-to Post Code" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Post Code"),"No.",SalesHeader."No.");
          IF "Ship-to City" <> SalesHeader."Ship-to City" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to City"),"No.",SalesHeader."No.");
          IF "Ship-to Contact" <> SalesHeader."Ship-to Contact" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Contact"),"No.",SalesHeader."No.");
        END ELSE BEGIN
          // no purchase line exists
          "Ship-to Name" := SalesHeader."Ship-to Name";
          "Ship-to Name 2" := SalesHeader."Ship-to Name 2";
          "Ship-to Address" := SalesHeader."Ship-to Address";
          "Ship-to Address 2" := SalesHeader."Ship-to Address 2";
          "Ship-to Post Code" := SalesHeader."Ship-to Post Code";
          "Ship-to City" := SalesHeader."Ship-to City";
          "Ship-to Contact" := SalesHeader."Ship-to Contact";
        END;
      END;

      OnAfterAddShipToAddress(Rec,SalesHeader);
    END;

    [External]
    PROCEDURE DropShptOrderExists@48(SalesHeader@1000 : Record 36) : Boolean;
    VAR
      SalesLine2@1001 : Record 37;
    BEGIN
      // returns TRUE if sales is either Drop Shipment of Special Order
      SalesLine2.RESET;
      SalesLine2.SETRANGE("Document Type",SalesLine2."Document Type"::Order);
      SalesLine2.SETRANGE("Document No.",SalesHeader."No.");
      SalesLine2.SETRANGE("Drop Shipment",TRUE);
      EXIT(NOT SalesLine2.ISEMPTY);
    END;

    [External]
    PROCEDURE SpecialOrderExists@81(SalesHeader@1000 : Record 36) : Boolean;
    VAR
      SalesLine3@1001 : Record 37;
    BEGIN
      SalesLine3.RESET;
      SalesLine3.SETRANGE("Document Type",SalesLine3."Document Type"::Order);
      SalesLine3.SETRANGE("Document No.",SalesHeader."No.");
      SalesLine3.SETRANGE("Special Order",TRUE);
      EXIT(NOT SalesLine3.ISEMPTY);
    END;

    LOCAL PROCEDURE CheckDropShipmentLineExists@153();
    VAR
      SalesShipmentLine@1000 : Record 111;
    BEGIN
      SalesShipmentLine.SETRANGE("Purchase Order No.","No.");
      SalesShipmentLine.SETRANGE("Drop Shipment",TRUE);
      IF NOT SalesShipmentLine.ISEMPTY THEN
        ERROR(YouCannotChangeFieldErr,FIELDCAPTION("Buy-from Vendor No."));
    END;

    [External]
    PROCEDURE QtyToReceiveIsZero@30() : Boolean;
    BEGIN
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.SETFILTER("Qty. to Receive",'<>0');
      EXIT(PurchLine.ISEMPTY);
    END;

    PROCEDURE IsApprovedForPosting@50() : Boolean;
    VAR
      PrepaymentMgt@1000 : Codeunit 441;
      ConfirmManagement@1001 : Codeunit 27;
    BEGIN
      //**4PS Made Global
      IF ApprovalsMgmt.PrePostApprovalCheckPurch(Rec) THEN BEGIN
        IF PrepaymentMgt.TestPurchasePrepayment(Rec) THEN
          ERROR(PrepaymentInvoicesNotPaidErr,"Document Type","No.");
        IF PrepaymentMgt.TestPurchasePayment(Rec) THEN
          IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text054,"Document Type","No."),TRUE) THEN
            EXIT(FALSE);
        EXIT(TRUE);
      END;
    END;

    [External]
    PROCEDURE IsApprovedForPostingBatch@51() : Boolean;
    VAR
      PrepaymentMgt@1000 : Codeunit 441;
    BEGIN
      IF ApprovalsMgmt.PrePostApprovalCheckPurch(Rec) THEN BEGIN
        IF PrepaymentMgt.TestPurchasePrepayment(Rec) THEN
          EXIT(FALSE);
        IF PrepaymentMgt.TestPurchasePayment(Rec) THEN
          EXIT(FALSE);
        EXIT(TRUE);
      END;
    END;

    PROCEDURE DeleteInwardHeader@1070000();
    VAR
      InwHead@1070000 : Record 11128010;
      InwRegReverse@1070001 : Codeunit 11128013;
    BEGIN
      //NAVSE
      InwHead.RESET;
      InwHead.SETCURRENTKEY("Document Type","Document No.");
      InwHead.SETRANGE("Document Type","Document Type");
      InwHead.SETRANGE("Document No.","No.");

      IF InwHead.FIND('-') THEN BEGIN
        REPEAT
          IF InwHead.Status = InwHead.Status::Posted THEN
            InwRegReverse.RUN(InwHead) ;

        UNTIL InwHead.NEXT = 0;
        InwHead.DELETEALL(TRUE);
      END;
    END;

    PROCEDURE UpdateInwardHeader@1070001();
    VAR
      InwHead@1070000 : Record 11128010;
    BEGIN
      //NAVSE
      InwHead.RESET;
      InwHead.SETCURRENTKEY("Document Type","Document No.");
      InwHead.SETRANGE("Document Type","Document Type");
      InwHead.SETRANGE("Document No.","No.");
      IF InwHead.FIND('-') THEN
        REPEAT
          InwHead."Posting Date" := "Posting Date";
          InwHead."Vendor Invoice No." := "Vendor Invoice No.";
          InwHead."Currency Code" := "Currency Code";
          InwHead."VAT Bus. Posting Group" := "VAT Bus. Posting Group";
          InwHead."Gen. Bus. Posting Group" := "Gen. Bus. Posting Group";
          //191128 ORANGO.PR
          InwHead."Due Date" := "Due Date";
          //191128 ORANGO.PR
          InwHead.MODIFY;
        UNTIL InwHead.NEXT = 0;
    END;

    PROCEDURE IsTotalValid@36() : Boolean;
    VAR
      IncomingDocument@1002 : Record 130;
      PurchaseLine@1001 : Record 39;
      TempTotalPurchaseLine@1000 : TEMPORARY Record 39;
      GeneralLedgerSetup@1005 : Record 98;
      DocumentTotals@1003 : Codeunit 57;
      VATAmount@1004 : Decimal;
      IsHandled@1006 : Boolean;
    BEGIN
      OnBeforeIsTotalValid(Rec,IsHandled);
      IF IsHandled THEN
        EXIT(TRUE);

      IF NOT IncomingDocument.GET("Incoming Document Entry No.") THEN
        EXIT(TRUE);

      IF IncomingDocument."Amount Incl. VAT" = 0 THEN
        EXIT(TRUE);

      PurchaseLine.SETRANGE("Document Type","Document Type");
      PurchaseLine.SETRANGE("Document No.","No.");
      IF NOT PurchaseLine.FINDFIRST THEN
        EXIT(TRUE);

      GeneralLedgerSetup.GET;
      IF (IncomingDocument."Currency Code" <> PurchaseLine."Currency Code") AND
         (IncomingDocument."Currency Code" <> GeneralLedgerSetup."LCY Code")
      THEN
        EXIT(TRUE);

      TempTotalPurchaseLine.INIT;
      DocumentTotals.PurchaseCalculateTotalsWithInvoiceRounding(PurchaseLine,VATAmount,TempTotalPurchaseLine);

      EXIT(IncomingDocument."Amount Incl. VAT" = TempTotalPurchaseLine."Amount Including VAT");
    END;

    [External]
    PROCEDURE SendToPosting@57(PostingCodeunitID@1000 : Integer) IsSuccess : Boolean;
    VAR
      ErrorMessageMgt@1001 : Codeunit 28;
      ErrorMessageHandler@1002 : Codeunit 29;
    BEGIN
      IF NOT IsApprovedForPosting THEN
        EXIT;

      COMMIT;
      ErrorMessageMgt.Activate(ErrorMessageHandler);
      IsSuccess := CODEUNIT.RUN(PostingCodeunitID,Rec);
      IF NOT IsSuccess THEN
        ErrorMessageHandler.ShowErrors;
    END;

    [External]
    PROCEDURE CancelBackgroundPosting@33();
    VAR
      PurchasePostViaJobQueue@1000 : Codeunit 98;
    BEGIN
      PurchasePostViaJobQueue.CancelQueueEntry(Rec);
    END;

    [External]
    PROCEDURE AddSpecialOrderToAddress@80(SalesHeader@1000 : Record 36;ShowError@1001 : Boolean);
    VAR
      PurchLine3@1003 : Record 39;
      LocationCode@1004 : Record 14;
    BEGIN
      IF ShowError THEN BEGIN
        PurchLine3.RESET;
        PurchLine3.SETRANGE("Document Type","Document Type"::Order);
        PurchLine3.SETRANGE("Document No.","No.");
        IF NOT PurchLine3.ISEMPTY THEN BEGIN
          LocationCode.GET("Location Code");
          IF "Ship-to Name" <> LocationCode.Name THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Name"),"No.",SalesHeader."No.");
          IF "Ship-to Name 2" <> LocationCode."Name 2" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Name 2"),"No.",SalesHeader."No.");
          IF "Ship-to Address" <> LocationCode.Address THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Address"),"No.",SalesHeader."No.");
          IF "Ship-to Address 2" <> LocationCode."Address 2" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Address 2"),"No.",SalesHeader."No.");
          IF "Ship-to Post Code" <> LocationCode."Post Code" THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Post Code"),"No.",SalesHeader."No.");
          IF "Ship-to City" <> LocationCode.City THEN
            ERROR(Text052,FIELDCAPTION("Ship-to City"),"No.",SalesHeader."No.");
          IF "Ship-to Contact" <> LocationCode.Contact THEN
            ERROR(Text052,FIELDCAPTION("Ship-to Contact"),"No.",SalesHeader."No.");
        END ELSE
          SetShipToForSpecOrder;
      END;
    END;

    [External]
    PROCEDURE InvoicedLineExists@56() : Boolean;
    VAR
      PurchLine@1000 : Record 39;
    BEGIN
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.SETFILTER(Type,'<>%1',PurchLine.Type::" ");
      PurchLine.SETFILTER("Quantity Invoiced",'<>%1',0);
      EXIT(NOT PurchLine.ISEMPTY);
    END;

    [External]
    PROCEDURE CreateDimSetForPrepmtAccDefaultDim@44();
    VAR
      PurchaseLine@1001 : Record 39;
      TempPurchaseLine@1002 : TEMPORARY Record 39;
    BEGIN
      PurchaseLine.SETRANGE("Document Type","Document Type");
      PurchaseLine.SETRANGE("Document No.","No.");
      PurchaseLine.SETFILTER("Prepmt. Amt. Inv.",'<>%1',0);
      IF PurchaseLine.FINDSET THEN
        REPEAT
          CollectParamsInBufferForCreateDimSet(TempPurchaseLine,PurchaseLine);
        UNTIL PurchaseLine.NEXT = 0;
      TempPurchaseLine.RESET;
      TempPurchaseLine.MARKEDONLY(FALSE);
      IF TempPurchaseLine.FINDSET THEN
        REPEAT
          PurchaseLine.CreateDim(DATABASE::"G/L Account",TempPurchaseLine."No.",
            DATABASE::Job,TempPurchaseLine."Job No.",
            DATABASE::"Responsibility Center",TempPurchaseLine."Responsibility Center",
            DATABASE::"Work Center",TempPurchaseLine."Work Center No.",
            0,'',0,'',0,''); //**4PS.n
        UNTIL TempPurchaseLine.NEXT = 0;
    END;

    LOCAL PROCEDURE CollectParamsInBufferForCreateDimSet@49(VAR TempPurchaseLine@1000 : TEMPORARY Record 39;PurchaseLine@1001 : Record 39);
    VAR
      GenPostingSetup@1002 : Record 252;
      DefaultDimension@1003 : Record 352;
    BEGIN
      TempPurchaseLine.SETRANGE("Gen. Bus. Posting Group",PurchaseLine."Gen. Bus. Posting Group");
      TempPurchaseLine.SETRANGE("Gen. Prod. Posting Group",PurchaseLine."Gen. Prod. Posting Group");
      IF NOT TempPurchaseLine.FINDFIRST THEN BEGIN
        GenPostingSetup.GET(PurchaseLine."Gen. Bus. Posting Group",PurchaseLine."Gen. Prod. Posting Group");
        GenPostingSetup.TESTFIELD("Purch. Prepayments Account");
        DefaultDimension.SETRANGE("Table ID",DATABASE::"G/L Account");
        DefaultDimension.SETRANGE("No.",GenPostingSetup."Purch. Prepayments Account");
        InsertTempPurchaseLineInBuffer(TempPurchaseLine,PurchaseLine,
          GenPostingSetup."Purch. Prepayments Account",DefaultDimension.ISEMPTY);
      END ELSE
        IF NOT TempPurchaseLine.MARK THEN BEGIN
          TempPurchaseLine.SETRANGE("Job No.",PurchaseLine."Job No.");
          TempPurchaseLine.SETRANGE("Responsibility Center",PurchaseLine."Responsibility Center");
          TempPurchaseLine.SETRANGE("Work Center No.",PurchaseLine."Work Center No.");
          IF TempPurchaseLine.ISEMPTY THEN
            InsertTempPurchaseLineInBuffer(TempPurchaseLine,PurchaseLine,TempPurchaseLine."No.",FALSE)
        END;
    END;

    LOCAL PROCEDURE InsertTempPurchaseLineInBuffer@35(VAR TempPurchaseLine@1000 : TEMPORARY Record 39;PurchaseLine@1001 : Record 39;AccountNo@1002 : Code[20];DefaultDimenstionsNotExist@1003 : Boolean);
    BEGIN
      TempPurchaseLine.INIT;
      TempPurchaseLine."Line No." := PurchaseLine."Line No.";
      TempPurchaseLine."No." := AccountNo;
      TempPurchaseLine."Job No." := PurchaseLine."Job No.";
      TempPurchaseLine."Responsibility Center" := PurchaseLine."Responsibility Center";
      TempPurchaseLine."Work Center No." := PurchaseLine."Work Center No.";
      TempPurchaseLine."Gen. Bus. Posting Group" := PurchaseLine."Gen. Bus. Posting Group";
      TempPurchaseLine."Gen. Prod. Posting Group" := PurchaseLine."Gen. Prod. Posting Group";
      TempPurchaseLine.MARK := DefaultDimenstionsNotExist;
      TempPurchaseLine.INSERT;
    END;

    LOCAL PROCEDURE TransferItemChargeAssgntPurchToTemp@170(VAR ItemChargeAssgntPurch@1000 : Record 5805;VAR TempItemChargeAssgntPurch@1001 : TEMPORARY Record 5805);
    BEGIN
      ItemChargeAssgntPurch.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntPurch.SETRANGE("Document No.","No.");
      IF ItemChargeAssgntPurch.FINDSET THEN BEGIN
        REPEAT
          TempItemChargeAssgntPurch := ItemChargeAssgntPurch;
          TempItemChargeAssgntPurch.INSERT;
        UNTIL ItemChargeAssgntPurch.NEXT = 0;
        ItemChargeAssgntPurch.DELETEALL;
      END;
    END;

    [External]
    PROCEDURE OpenPurchaseOrderStatistics@60();
    BEGIN
      CalcInvDiscForHeader;
      CreateDimSetForPrepmtAccDefaultDim;
      COMMIT;
      PAGE.RUNMODAL(PAGE::"Purchase Order Statistics",Rec);
    END;

    [External]
    PROCEDURE GetCardpageID@58() : Integer;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Quote:
          EXIT(PAGE::"Purchase Quote");
        "Document Type"::Order:
          EXIT(PAGE::"Purchase Order");
        "Document Type"::Invoice:
          EXIT(PAGE::"Purchase Invoice");
        "Document Type"::"Credit Memo":
          EXIT(PAGE::"Purchase Credit Memo");
        "Document Type"::"Blanket Order":
          EXIT(PAGE::"Blanket Purchase Order");
        "Document Type"::"Return Order":
          EXIT(PAGE::"Purchase Return Order");
      END;
    END;

    [Integration(TRUE)]
    PROCEDURE OnCheckPurchasePostRestrictions@54();
    BEGIN
    END;

    [Integration(TRUE)]
    LOCAL PROCEDURE OnCheckPurchaseReleaseRestrictions@55();
    BEGIN
    END;

    [External]
    PROCEDURE CheckPurchaseReleaseRestrictions@105();
    VAR
      ApprovalsMgmt@1000 : Codeunit 1535;
    BEGIN
      OnCheckPurchaseReleaseRestrictions;
      ApprovalsMgmt.PrePostApprovalCheckPurch(Rec);
    END;

    [External]
    PROCEDURE SetStatus@53(NewStatus@1000 : Option);
    BEGIN
      Status := NewStatus;
      MODIFY;
    END;

    [External]
    PROCEDURE TriggerOnAfterPostPurchaseDoc@116(VAR GenJnlPostLine@1001 : Codeunit 12;PurchRcpHdrNo@1002 : Code[20];RetShptHdrNo@1003 : Code[20];PurchInvHdrNo@1004 : Code[20];PurchCrMemoHdrNo@1005 : Code[20]);
    VAR
      PurchPost@1000 : Codeunit 90;
    BEGIN
      PurchPost.OnAfterPostPurchaseDoc(Rec,GenJnlPostLine,PurchRcpHdrNo,RetShptHdrNo,PurchInvHdrNo,PurchCrMemoHdrNo,FALSE);
    END;

    [External]
    PROCEDURE DeferralHeadersExist@38() : Boolean;
    VAR
      DeferralHeader@1000 : Record 1701;
      DeferralUtilities@1001 : Codeunit 1720;
    BEGIN
      DeferralHeader.SETRANGE("Deferral Doc. Type",DeferralUtilities.GetPurchDeferralDocType);
      DeferralHeader.SETRANGE("Gen. Jnl. Template Name",'');
      DeferralHeader.SETRANGE("Gen. Jnl. Batch Name",'');
      DeferralHeader.SETRANGE("Document Type","Document Type");
      DeferralHeader.SETRANGE("Document No.","No.");
      EXIT(NOT DeferralHeader.ISEMPTY);
    END;

    LOCAL PROCEDURE ConfirmUpdateDeferralDate@85();
    BEGIN
      IF GetHideValidationDialog OR NOT GUIALLOWED THEN
        Confirmed := TRUE
      ELSE
        Confirmed := CONFIRM(DeferralLineQst,FALSE,FIELDCAPTION("Posting Date"));
      IF Confirmed THEN
        UpdatePurchLinesByFieldNo(PurchLine.FIELDNO("Deferral Code"),FALSE);
    END;

    [External]
    PROCEDURE IsCreditDocType@110() : Boolean;
    VAR
      CreditDocType@1000 : Boolean;
    BEGIN
      CreditDocType := "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"];
      OnBeforeIsCreditDocType(Rec,CreditDocType);
      EXIT(CreditDocType);
    END;

    [External]
    PROCEDURE SetBuyFromVendorFromFilter@186();
    VAR
      BuyFromVendorNo@1000 : Code[20];
    BEGIN
      BuyFromVendorNo := GetFilterVendNo;
      IF BuyFromVendorNo = '' THEN BEGIN
        FILTERGROUP(2);
        BuyFromVendorNo := GetFilterVendNo;
        FILTERGROUP(0);
      END;
      IF BuyFromVendorNo <> '' THEN
        VALIDATE("Buy-from Vendor No.",BuyFromVendorNo);
    END;

    [External]
    PROCEDURE CopyBuyFromVendorFilter@59();
    VAR
      BuyFromVendorFilter@1000 : Text;
    BEGIN
      BuyFromVendorFilter := GETFILTER("Buy-from Vendor No.");
      IF BuyFromVendorFilter <> '' THEN BEGIN
        FILTERGROUP(2);
        SETFILTER("Buy-from Vendor No.",BuyFromVendorFilter);
        FILTERGROUP(0)
      END;
    END;

    LOCAL PROCEDURE GetFilterVendNo@64() : Code[20];
    BEGIN
      IF GETFILTER("Buy-from Vendor No.") <> '' THEN
        IF GETRANGEMIN("Buy-from Vendor No.") = GETRANGEMAX("Buy-from Vendor No.") THEN
          EXIT(GETRANGEMAX("Buy-from Vendor No."));
    END;

    [External]
    PROCEDURE HasBuyFromAddress@65() : Boolean;
    BEGIN
      CASE TRUE OF
        "Buy-from Address" <> '':
          EXIT(TRUE);
        "Buy-from Address 2" <> '':
          EXIT(TRUE);
        "Buy-from City" <> '':
          EXIT(TRUE);
        "Buy-from Country/Region Code" <> '':
          EXIT(TRUE);
        "Buy-from County" <> '':
          EXIT(TRUE);
        "Buy-from Post Code" <> '':
          EXIT(TRUE);
        "Buy-from Contact" <> '':
          EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    [External]
    PROCEDURE HasShipToAddress@103() : Boolean;
    BEGIN
      CASE TRUE OF
        "Ship-to Address" <> '':
          EXIT(TRUE);
        "Ship-to Address 2" <> '':
          EXIT(TRUE);
        "Ship-to City" <> '':
          EXIT(TRUE);
        "Ship-to Country/Region Code" <> '':
          EXIT(TRUE);
        "Ship-to County" <> '':
          EXIT(TRUE);
        "Ship-to Post Code" <> '':
          EXIT(TRUE);
        "Ship-to Contact" <> '':
          EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    [External]
    PROCEDURE HasPayToAddress@66() : Boolean;
    BEGIN
      CASE TRUE OF
        "Pay-to Address" <> '':
          EXIT(TRUE);
        "Pay-to Address 2" <> '':
          EXIT(TRUE);
        "Pay-to City" <> '':
          EXIT(TRUE);
        "Pay-to Country/Region Code" <> '':
          EXIT(TRUE);
        "Pay-to County" <> '':
          EXIT(TRUE);
        "Pay-to Post Code" <> '':
          EXIT(TRUE);
        "Pay-to Contact" <> '':
          EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE HasItemChargeAssignment@171() : Boolean;
    VAR
      ItemChargeAssgntPurch@1000 : Record 5805;
    BEGIN
      ItemChargeAssgntPurch.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntPurch.SETRANGE("Document No.","No.");
      ItemChargeAssgntPurch.SETFILTER("Amount to Assign",'<>%1',0);
      EXIT(NOT ItemChargeAssgntPurch.ISEMPTY);
    END;

    LOCAL PROCEDURE CopyBuyFromVendorAddressFieldsFromVendor@62(VAR BuyFromVendor@1000 : Record 23;ForceCopy@1001 : Boolean);
    BEGIN
      IF BuyFromVendorIsReplaced OR ShouldCopyAddressFromBuyFromVendor(BuyFromVendor) OR ForceCopy THEN BEGIN
        "Buy-from Address" := BuyFromVendor.Address;
        "Buy-from Address 2" := BuyFromVendor."Address 2";
        "Buy-from City" := BuyFromVendor.City;
        "Buy-from Post Code" := BuyFromVendor."Post Code";
        "Buy-from County" := BuyFromVendor.County;
        "Buy-from Country/Region Code" := BuyFromVendor."Country/Region Code";

        //**4PS.sn
        VALIDATE("Country of Origin","Buy-from Country/Region Code");
        "Buy-from Contact" := BuyFromVendor.Contact;
        "Buy-from Contact Person No." := '';
        UpdateEMailForPurchOrderForContactPerson;
        "Buy-from Phone No." := BuyFromVendor."Phone No.";
        "Buy-from Fax No." := BuyFromVendor."Fax No.";
        //**4PS.en

        OnAfterCopyBuyFromVendorAddressFieldsFromVendor(Rec,BuyFromVendor);
      END;
    END;

    LOCAL PROCEDURE CopyShipToVendorAddressFieldsFromVendor@98(VAR BuyFromVendor@1000 : Record 23;ForceCopy@1001 : Boolean);
    BEGIN
      IF BuyFromVendorIsReplaced OR (NOT HasShipToAddress) OR ForceCopy THEN BEGIN
        "Ship-to Address" := BuyFromVendor.Address;
        "Ship-to Address 2" := BuyFromVendor."Address 2";
        "Ship-to City" := BuyFromVendor.City;
        "Ship-to Post Code" := BuyFromVendor."Post Code";
        "Ship-to County" := BuyFromVendor.County;
        VALIDATE("Ship-to Country/Region Code",BuyFromVendor."Country/Region Code");
        OnAfterCopyShipToVendorAddressFieldsFromVendor(Rec,BuyFromVendor);
      END;
    END;

    LOCAL PROCEDURE CopyPayToVendorAddressFieldsFromVendor@63(VAR PayToVendor@1000 : Record 23;ForceCopy@1001 : Boolean);
    BEGIN
      IF PayToVendorIsReplaced OR ShouldCopyAddressFromPayToVendor(PayToVendor) OR ForceCopy THEN BEGIN
        "Pay-to Address" := PayToVendor.Address;
        "Pay-to Address 2" := PayToVendor."Address 2";
        "Pay-to City" := PayToVendor.City;
        "Pay-to Post Code" := PayToVendor."Post Code";
        "Pay-to County" := PayToVendor.County;
        "Pay-to Country/Region Code" := PayToVendor."Country/Region Code";
        OnAfterCopyPayToVendorAddressFieldsFromVendor(Rec,PayToVendor);
      END;
    END;

    [External]
    PROCEDURE SetShipToAddress@117(ShipToName@1000 : Text[100];ShipToName2@1001 : Text[50];ShipToAddress@1002 : Text[100];ShipToAddress2@1003 : Text[50];ShipToCity@1004 : Text[30];ShipToPostCode@1005 : Code[20];ShipToCounty@1006 : Text[30];ShipToCountryRegionCode@1007 : Code[10]);
    BEGIN
      "Ship-to Name" := ShipToName;
      "Ship-to Name 2" := ShipToName2;
      "Ship-to Address" := ShipToAddress;
      "Ship-to Address 2" := ShipToAddress2;
      "Ship-to City" := ShipToCity;
      "Ship-to Post Code" := ShipToPostCode;
      "Ship-to County" := ShipToCounty;
      "Ship-to Country/Region Code" := ShipToCountryRegionCode;
    END;

    LOCAL PROCEDURE ShouldCopyAddressFromBuyFromVendor@101(BuyFromVendor@1000 : Record 23) : Boolean;
    BEGIN
      EXIT((NOT HasBuyFromAddress) AND BuyFromVendor.HasAddress);
    END;

    LOCAL PROCEDURE ShouldCopyAddressFromPayToVendor@102(PayToVendor@1000 : Record 23) : Boolean;
    BEGIN
      EXIT((NOT HasPayToAddress) AND PayToVendor.HasAddress);
    END;

    LOCAL PROCEDURE ShouldLookForVendorByName@182(VendorNo@1000 : Code[20]) : Boolean;
    VAR
      Vendor@1001 : Record 23;
    BEGIN
      IF VendorNo = '' THEN
        EXIT(TRUE);

      IF NOT Vendor.GET(VendorNo) THEN
        EXIT(TRUE);

      EXIT(NOT Vendor."Disable Search by Name");
    END;

    LOCAL PROCEDURE BuyFromVendorIsReplaced@96() : Boolean;
    BEGIN
      EXIT((xRec."Buy-from Vendor No." <> '') AND (xRec."Buy-from Vendor No." <> "Buy-from Vendor No."));
    END;

    LOCAL PROCEDURE PayToVendorIsReplaced@97() : Boolean;
    BEGIN
      EXIT((xRec."Pay-to Vendor No." <> '') AND (xRec."Pay-to Vendor No." <> "Pay-to Vendor No."));
    END;

    LOCAL PROCEDURE UpdatePayToAddressFromBuyFromAddress@61(FieldNumber@1000 : Integer);
    BEGIN
      IF ("Order Address Code" = '') AND PayToAddressEqualsOldBuyFromAddress THEN
        CASE FieldNumber OF
          FIELDNO("Pay-to Address"):
            IF xRec."Buy-from Address" = "Pay-to Address" THEN
              "Pay-to Address" := "Buy-from Address";
          FIELDNO("Pay-to Address 2"):
            IF xRec."Buy-from Address 2" = "Pay-to Address 2" THEN
              "Pay-to Address 2" := "Buy-from Address 2";
          FIELDNO("Pay-to City"), FIELDNO("Pay-to Post Code"):
            BEGIN
              IF xRec."Buy-from City" = "Pay-to City" THEN
                "Pay-to City" := "Buy-from City";
              IF xRec."Buy-from Post Code" = "Pay-to Post Code" THEN
                "Pay-to Post Code" := "Buy-from Post Code";
              IF xRec."Buy-from County" = "Pay-to County" THEN
                "Pay-to County" := "Buy-from County";
              IF xRec."Buy-from Country/Region Code" = "Pay-to Country/Region Code" THEN
                "Pay-to Country/Region Code" := "Buy-from Country/Region Code";
            END;
          FIELDNO("Pay-to County"):
            IF xRec."Buy-from County" = "Pay-to County" THEN
              "Pay-to County" := "Buy-from County";
          FIELDNO("Pay-to Country/Region Code"):
            IF  xRec."Buy-from Country/Region Code" = "Pay-to Country/Region Code" THEN
              "Pay-to Country/Region Code" := "Buy-from Country/Region Code";
        END;
    END;

    LOCAL PROCEDURE PayToAddressEqualsOldBuyFromAddress@67() : Boolean;
    BEGIN
      IF (xRec."Buy-from Address" = "Pay-to Address") AND
         (xRec."Buy-from Address 2" = "Pay-to Address 2") AND
         (xRec."Buy-from City" = "Pay-to City") AND
         (xRec."Buy-from County" = "Pay-to County") AND
         (xRec."Buy-from Post Code" = "Pay-to Post Code") AND
         (xRec."Buy-from Country/Region Code" = "Pay-to Country/Region Code")
      THEN
        EXIT(TRUE);
    END;

    [External]
    PROCEDURE ConfirmCloseUnposted@104() : Boolean;
    VAR
      InstructionMgt@1000 : Codeunit 1330;
    BEGIN
      IF Status <> Status::Closed THEN //**4PS.n
        IF PurchLinesExist THEN
          IF InstructionMgt.IsUnpostedEnabledForRecord(Rec) THEN
            EXIT(InstructionMgt.ShowConfirm(DocumentNotPostedClosePageQst,InstructionMgt.QueryPostOnCloseCode));
      EXIT(TRUE)
    END;

    [External]
    PROCEDURE InitFromPurchHeader@109(SourcePurchHeader@1000 : Record 38);
    BEGIN
      "Document Date" := SourcePurchHeader."Document Date";
      "Expected Receipt Date" := SourcePurchHeader."Expected Receipt Date";
      "Shortcut Dimension 1 Code" := SourcePurchHeader."Shortcut Dimension 1 Code";
      "Shortcut Dimension 2 Code" := SourcePurchHeader."Shortcut Dimension 2 Code";
      "Dimension Set ID" := SourcePurchHeader."Dimension Set ID";
      "Location Code" := SourcePurchHeader."Location Code";
      SetShipToAddress(
        SourcePurchHeader."Ship-to Name",SourcePurchHeader."Ship-to Name 2",SourcePurchHeader."Ship-to Address",
        SourcePurchHeader."Ship-to Address 2",SourcePurchHeader."Ship-to City",SourcePurchHeader."Ship-to Post Code",
        SourcePurchHeader."Ship-to County",SourcePurchHeader."Ship-to Country/Region Code");
      "Ship-to Contact" := SourcePurchHeader."Ship-to Contact";

      OnInitFromPurchHeader(Rec,SourcePurchHeader);
    END;

    LOCAL PROCEDURE InitFromVendor@68(VendorNo@1000 : Code[20];VendorCaption@1001 : Text) : Boolean;
    BEGIN
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      IF VendorNo = '' THEN BEGIN
        IF NOT PurchLine.ISEMPTY THEN
          ERROR(Text005,VendorCaption);
        TempPurchHeader := Rec; //**4PS.n
        INIT;
        GetPurchSetup;
        "No. Series" := xRec."No. Series";
        OnInitFromVendorOnBeforeInitRecord(Rec,xRec);
        InitRecord;
        InitNoSeries;
        GetTempPurchHeader; //**4PS.n
        EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE InitFromContact@69(ContactNo@1000 : Code[20];VendorNo@1001 : Code[20];ContactCaption@1002 : Text) : Boolean;
    BEGIN
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      IF (ContactNo = '') AND (VendorNo = '') THEN BEGIN
        IF NOT PurchLine.ISEMPTY THEN
          ERROR(Text005,ContactCaption);
        TempPurchHeader := Rec; //**4PS.n
        INIT;
        GetPurchSetup;
        "No. Series" := xRec."No. Series";
        OnInitFromContactOnBeforeInitRecord(Rec,xRec);
        InitRecord;
        InitNoSeries;
        GetTempPurchHeader; //**4PS.n
        EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE LookupContact@122(VendorNo@1000 : Code[20];ContactNo@1003 : Code[20];VAR Contact@1001 : Record 5050);
    VAR
      ContactBusinessRelation@1002 : Record 5054;
    BEGIN
      IF ContactBusinessRelation.FindByRelation(ContactBusinessRelation."Link to Table"::Vendor,VendorNo) THEN
        Contact.SETRANGE("Company No.",ContactBusinessRelation."Contact No.")
      ELSE
        Contact.SETRANGE("Company No.",'');
      IF ContactNo <> '' THEN
        IF Contact.GET(ContactNo) THEN ;
    END;

    [Internal]
    PROCEDURE SendRecords@75();
    VAR
      DocumentSendingProfile@1000 : Record 60;
      ReportSelections@1001 : Record 77;
      DocTxt@1002 : Text[150];
    BEGIN
      CheckMixedDropShipment;

      GetReportSelectionsUsageFromDocumentType(ReportSelections.Usage,DocTxt);

      DocumentSendingProfile.SendVendorRecords(
        ReportSelections.Usage,Rec,DocTxt,"Buy-from Vendor No.","No.",
        FIELDNO("Buy-from Vendor No."),FIELDNO("No."));
    END;

    [External]
    PROCEDURE PrintRecords@74(ShowRequestForm@1002 : Boolean);
    VAR
      DocumentSendingProfile@1001 : Record 60;
      DummyReportSelections@1000 : Record 77;
    BEGIN
      CheckMixedDropShipment;

      DocumentSendingProfile.TrySendToPrinterVendor(
      //DummyReportSelections.Usage::"P.Order",Rec,FIELDNO("Buy-from Vendor No."),ShowRequestForm); //**4PS.o
        DummyReportSelections.Usage::"P.Order",Rec,FIELDNO("Buy-from Vendor No."),ShowRequestForm,ShowRequestForm); //**4PS.n
    END;

    [External]
    PROCEDURE SendProfile@73(VAR DocumentSendingProfile@1000 : Record 60);
    VAR
      DummyReportSelections@1001 : Record 77;
    BEGIN
      CheckMixedDropShipment;

      DocumentSendingProfile.SendVendor(
        DummyReportSelections.Usage::"P.Order",Rec,"No.","Buy-from Vendor No.",
        PurchOrderDocTxt,FIELDNO("Buy-from Vendor No."),FIELDNO("No."));
    END;

    LOCAL PROCEDURE CheckMixedDropShipment@84();
    BEGIN
      IF HasMixedDropShipment THEN
        ERROR(MixedDropshipmentErr);
    END;

    LOCAL PROCEDURE HasMixedDropShipment@83() : Boolean;
    VAR
      PurchaseLine@1000 : Record 39;
      HasDropShipmentLines@1001 : Boolean;
    BEGIN
      PurchaseLine.SETRANGE("Document Type","Document Type");
      PurchaseLine.SETRANGE("Document No.","No.");
      PurchaseLine.SETFILTER("No.",'<>%1','');
      PurchaseLine.SETFILTER(Type,'%1|%2',PurchaseLine.Type::Item,PurchaseLine.Type::"Fixed Asset");
      PurchaseLine.SETRANGE("Drop Shipment",TRUE);

      HasDropShipmentLines := NOT PurchaseLine.ISEMPTY;

      PurchaseLine.SETRANGE("Drop Shipment",FALSE);

      EXIT(HasDropShipmentLines AND NOT PurchaseLine.ISEMPTY);
    END;

    LOCAL PROCEDURE SetDefaultPurchaser@76();
    VAR
      UserSetup@1000 : Record 91;
    BEGIN
      IF NOT UserSetup.GET(USERID) THEN
        EXIT;

      IF UserSetup."Salespers./Purch. Code" <> '' THEN
        IF SalespersonPurchaser.GET(UserSetup."Salespers./Purch. Code") THEN
          IF NOT SalespersonPurchaser.VerifySalesPersonPurchaserPrivacyBlocked(SalespersonPurchaser) THEN
            VALIDATE("Purchaser Code",UserSetup."Salespers./Purch. Code");
    END;

    [External]
    PROCEDURE OnAfterValidateBuyFromVendorNo@77(VAR PurchaseHeader@1000 : Record 38;VAR xPurchaseHeader@1001 : Record 38);
    BEGIN
      IF PurchaseHeader.GETFILTER("Buy-from Vendor No.") = xPurchaseHeader."Buy-from Vendor No." THEN
        IF PurchaseHeader."Buy-from Vendor No." <> xPurchaseHeader."Buy-from Vendor No." THEN
          PurchaseHeader.SETRANGE("Buy-from Vendor No.");
    END;

    [External]
    PROCEDURE BatchConfirmUpdateDeferralDate@78(VAR BatchConfirm@1000 : ' ,Skip,Update';ReplacePostingDate@1001 : Boolean;PostingDateReq@1002 : Date);
    BEGIN
      IF (NOT ReplacePostingDate) OR (PostingDateReq = "Posting Date") OR (BatchConfirm = BatchConfirm::Skip) THEN
        EXIT;

      IF NOT DeferralHeadersExist THEN
        EXIT;

      "Posting Date" := PostingDateReq;
      CASE BatchConfirm OF
        BatchConfirm::" ":
          BEGIN
            ConfirmUpdateDeferralDate;
            IF Confirmed THEN
              BatchConfirm := BatchConfirm::Update
            ELSE
              BatchConfirm := BatchConfirm::Skip;
          END;
        BatchConfirm::Update:
          UpdatePurchLinesByFieldNo(PurchLine.FIELDNO("Deferral Code"),FALSE);
      END;
      COMMIT;
    END;

    [External]
    PROCEDURE SetAllowSelectNoSeries@86();
    BEGIN
      SelectNoSeriesAllowed := TRUE;
    END;

    LOCAL PROCEDURE ModifyPayToVendorAddress@194();
    VAR
      Vendor@1000 : Record 23;
    BEGIN
      GetPurchSetup;
      IF PurchSetup."Ignore Updated Addresses" THEN
        EXIT;
      IF IsCreditDocType THEN
        EXIT;
      IF ("Pay-to Vendor No." <> "Buy-from Vendor No.") AND Vendor.GET("Pay-to Vendor No.") THEN
        IF HasPayToAddress AND HasDifferentPayToAddress(Vendor) THEN
          ShowModifyAddressNotification(GetModifyPayToVendorAddressNotificationId,
            ModifyVendorAddressNotificationLbl,ModifyVendorAddressNotificationMsg,
            'CopyPayToVendorAddressFieldsFromSalesDocument',"Pay-to Vendor No.",
            "Pay-to Name",FIELDNAME("Pay-to Vendor No."));
    END;

    LOCAL PROCEDURE ModifyVendorAddress@150();
    VAR
      Vendor@1000 : Record 23;
    BEGIN
      GetPurchSetup;
      IF PurchSetup."Ignore Updated Addresses" THEN
        EXIT;
      IF IsCreditDocType THEN
        EXIT;
      IF Vendor.GET("Buy-from Vendor No.") AND HasBuyFromAddress AND HasDifferentBuyFromAddress(Vendor) THEN
        ShowModifyAddressNotification(GetModifyVendorAddressNotificationId,
          ModifyVendorAddressNotificationLbl,ModifyVendorAddressNotificationMsg,
          'CopyBuyFromVendorAddressFieldsFromSalesDocument',"Buy-from Vendor No.",
          "Buy-from Vendor Name",FIELDNAME("Buy-from Vendor No."));
    END;

    LOCAL PROCEDURE ShowModifyAddressNotification@157(NotificationID@1001 : GUID;NotificationLbl@1004 : Text;NotificationMsg@1005 : Text;NotificationFunctionTok@1006 : Text;VendorNumber@1002 : Code[20];VendorName@1003 : Text[100];VendorNumberFieldName@1008 : Text);
    VAR
      MyNotifications@1009 : Record 1518;
      NotificationLifecycleMgt@1007 : Codeunit 1511;
      ModifyVendorAddressNotification@1000 : Notification;
    BEGIN
      IF NOT MyNotifications.IsEnabled(NotificationID) THEN
        EXIT;

      ModifyVendorAddressNotification.ID := NotificationID;
      ModifyVendorAddressNotification.MESSAGE := STRSUBSTNO(NotificationMsg,VendorName);
      ModifyVendorAddressNotification.ADDACTION(NotificationLbl,CODEUNIT::"Document Notifications",NotificationFunctionTok);
      ModifyVendorAddressNotification.ADDACTION(
        DontShowAgainActionLbl,CODEUNIT::"Document Notifications",'HidePurchaseNotificationForCurrentUser');
      ModifyVendorAddressNotification.SCOPE := NOTIFICATIONSCOPE::LocalScope;
      ModifyVendorAddressNotification.SETDATA(FIELDNAME("Document Type"),FORMAT("Document Type"));
      ModifyVendorAddressNotification.SETDATA(FIELDNAME("No."),"No.");
      ModifyVendorAddressNotification.SETDATA(VendorNumberFieldName,VendorNumber);
      NotificationLifecycleMgt.SendNotification(ModifyVendorAddressNotification,RECORDID);
    END;

    [External]
    PROCEDURE RecallModifyAddressNotification@148(NotificationID@1001 : GUID);
    VAR
      MyNotifications@1002 : Record 1518;
      ModifyVendorAddressNotification@1000 : Notification;
    BEGIN
      IF IsCreditDocType OR (NOT MyNotifications.IsEnabled(NotificationID)) THEN
        EXIT;
      ModifyVendorAddressNotification.ID := NotificationID;
      ModifyVendorAddressNotification.RECALL;
    END;

    [External]
    PROCEDURE GetModifyVendorAddressNotificationId@193() : GUID;
    BEGIN
      EXIT('CF3D0CD3-C54A-47D1-8A3F-57A6CCBA8DDE');
    END;

    [External]
    PROCEDURE GetModifyPayToVendorAddressNotificationId@191() : GUID;
    BEGIN
      EXIT('16E45B3A-CB9F-4B2C-9F08-2BCE39E9E980');
    END;

    [External]
    PROCEDURE GetShowExternalDocAlreadyExistNotificationId@92() : GUID;
    BEGIN
      EXIT('D87F624C-D3BE-4E6B-A369-D18AE269181A');
    END;

    [External]
    PROCEDURE GetLineInvoiceDiscountResetNotificationId@233() : GUID;
    BEGIN
      EXIT('3DC9C8BC-0512-4A49-B587-256C308EBCAA');
    END;

    [External]
    PROCEDURE SetModifyVendorAddressNotificationDefaultState@196();
    VAR
      MyNotifications@1000 : Record 1518;
    BEGIN
      MyNotifications.InsertDefault(GetModifyVendorAddressNotificationId,
        ModifyBuyFromVendorAddressNotificationNameTxt,ModifyBuyFromVendorAddressNotificationDescriptionTxt,TRUE);
    END;

    [External]
    PROCEDURE SetModifyPayToVendorAddressNotificationDefaultState@197();
    VAR
      MyNotifications@1000 : Record 1518;
    BEGIN
      MyNotifications.InsertDefault(GetModifyPayToVendorAddressNotificationId,
        ModifyPayToVendorAddressNotificationNameTxt,ModifyPayToVendorAddressNotificationDescriptionTxt,TRUE);
    END;

    [External]
    PROCEDURE SetShowExternalDocAlreadyExistNotificationDefaultState@87(DefaultState@1001 : Boolean);
    VAR
      MyNotifications@1000 : Record 1518;
    BEGIN
      MyNotifications.InsertDefault(GetShowExternalDocAlreadyExistNotificationId,
        ShowDocAlreadyExistNotificationNameTxt,ShowDocAlreadyExistNotificationDescriptionTxt,DefaultState);
    END;

    [External]
    PROCEDURE DontNotifyCurrentUserAgain@141(NotificationID@1001 : GUID);
    VAR
      MyNotifications@1000 : Record 1518;
    BEGIN
      IF NOT MyNotifications.Disable(NotificationID) THEN
        CASE NotificationID OF
          GetModifyVendorAddressNotificationId:
            MyNotifications.InsertDefault(NotificationID,ModifyBuyFromVendorAddressNotificationNameTxt,
              ModifyBuyFromVendorAddressNotificationDescriptionTxt,FALSE);
          GetModifyPayToVendorAddressNotificationId:
            MyNotifications.InsertDefault(NotificationID,ModifyPayToVendorAddressNotificationNameTxt,
              ModifyPayToVendorAddressNotificationDescriptionTxt,FALSE);
        END;
    END;

    LOCAL PROCEDURE HasDifferentBuyFromAddress@195(Vendor@1000 : Record 23) : Boolean;
    BEGIN
      EXIT(("Buy-from Address" <> Vendor.Address) OR
        ("Buy-from Address 2" <> Vendor."Address 2") OR
        ("Buy-from City" <> Vendor.City) OR
        ("Buy-from Country/Region Code" <> Vendor."Country/Region Code") OR
        ("Buy-from County" <> Vendor.County) OR
        ("Buy-from Post Code" <> Vendor."Post Code") OR
        ("Buy-from Contact" <> Vendor.Contact));
    END;

    LOCAL PROCEDURE HasDifferentPayToAddress@192(Vendor@1000 : Record 23) : Boolean;
    BEGIN
      EXIT(("Pay-to Address" <> Vendor.Address) OR
        ("Pay-to Address 2" <> Vendor."Address 2") OR
        ("Pay-to City" <> Vendor.City) OR
        ("Pay-to Country/Region Code" <> Vendor."Country/Region Code") OR
        ("Pay-to County" <> Vendor.County) OR
        ("Pay-to Post Code" <> Vendor."Post Code") OR
        ("Pay-to Contact" <> Vendor.Contact));
    END;

    LOCAL PROCEDURE FindPostedDocumentWithSameExternalDocNo@88(VAR VendorLedgerEntry@1000 : Record 25;ExternalDocumentNo@1001 : Code[35]) : Boolean;
    VAR
      VendorMgt@1002 : Codeunit 1312;
    BEGIN
      VendorMgt.SetFilterForExternalDocNo(
        VendorLedgerEntry,GetGenJnlDocumentType,ExternalDocumentNo,"Pay-to Vendor No.","Document Date");
      EXIT(VendorLedgerEntry.FINDFIRST);
    END;

    [External]
    PROCEDURE FilterPartialReceived@108();
    VAR
      PurchaseHeaderOriginal@1000 : Record 38;
      ReceiveFilter@1004 : Text;
      IsMarked@1003 : Boolean;
      ReceiveValue@1001 : Boolean;
    BEGIN
      ReceiveFilter := GETFILTER(Receive);
      SETRANGE(Receive);
      EVALUATE(ReceiveValue,ReceiveFilter);

      PurchaseHeaderOriginal := Rec;
      IF FINDSET THEN
        REPEAT
          IF NOT HasReceivedLines THEN
            IsMarked := NOT ReceiveValue
          ELSE
            IsMarked := ReceiveValue;
          MARK(IsMarked);
        UNTIL NEXT = 0;

      Rec := PurchaseHeaderOriginal;
      MARKEDONLY(TRUE);
    END;

    [External]
    PROCEDURE FilterPartialInvoiced@307();
    VAR
      PurchaseHeaderOriginal@1000 : Record 38;
      InvoiceFilter@1004 : Text;
      IsMarked@1003 : Boolean;
      InvoiceValue@1001 : Boolean;
    BEGIN
      InvoiceFilter := GETFILTER(Invoice);
      SETRANGE(Invoice);
      EVALUATE(InvoiceValue,InvoiceFilter);

      PurchaseHeaderOriginal := Rec;
      IF FINDSET THEN
        REPEAT
          IF NOT HasInvoicedLines THEN
            IsMarked := NOT InvoiceValue
          ELSE
            IsMarked := InvoiceValue;
          MARK(IsMarked);
        UNTIL NEXT = 0;

      Rec := PurchaseHeaderOriginal;
      MARKEDONLY(TRUE);
    END;

    LOCAL PROCEDURE HasReceivedLines@126() : Boolean;
    VAR
      PurchaseLine@1002 : Record 39;
    BEGIN
      PurchaseLine.SETRANGE("Document Type","Document Type");
      PurchaseLine.SETRANGE("Document No.","No.");
      PurchaseLine.SETFILTER("No.",'<>%1','');
      PurchaseLine.SETFILTER("Quantity Received",'<>%1',0);
      EXIT(NOT PurchaseLine.ISEMPTY);
    END;

    LOCAL PROCEDURE HasInvoicedLines@123() : Boolean;
    VAR
      PurchaseLine@1002 : Record 39;
    BEGIN
      PurchaseLine.SETRANGE("Document Type","Document Type");
      PurchaseLine.SETRANGE("Document No.","No.");
      PurchaseLine.SETFILTER("No.",'<>%1','');
      PurchaseLine.SETFILTER("Quantity Invoiced",'<>%1',0);
      EXIT(NOT PurchaseLine.ISEMPTY);
    END;

    LOCAL PROCEDURE ShowExternalDocAlreadyExistNotification@89(VendorLedgerEntry@1000 : Record 25);
    VAR
      NotificationLifecycleMgt@1002 : Codeunit 1511;
      DocAlreadyExistNotification@1001 : Notification;
    BEGIN
      IF NOT IsDocAlreadyExistNotificationEnabled THEN
        EXIT;

      DocAlreadyExistNotification.ID := GetShowExternalDocAlreadyExistNotificationId;
      DocAlreadyExistNotification.MESSAGE :=
        STRSUBSTNO(PurchaseAlreadyExistsTxt,VendorLedgerEntry."Document Type",VendorLedgerEntry."External Document No.");
      DocAlreadyExistNotification.ADDACTION(ShowVendLedgEntryTxt,CODEUNIT::"Document Notifications",'ShowVendorLedgerEntry');
      DocAlreadyExistNotification.SCOPE := NOTIFICATIONSCOPE::LocalScope;
      DocAlreadyExistNotification.SETDATA(FIELDNAME("Document Type"),FORMAT("Document Type"));
      DocAlreadyExistNotification.SETDATA(FIELDNAME("No."),"No.");
      DocAlreadyExistNotification.SETDATA(VendorLedgerEntry.FIELDNAME("Entry No."),FORMAT(VendorLedgerEntry."Entry No."));
      NotificationLifecycleMgt.SendNotificationWithAdditionalContext(
        DocAlreadyExistNotification,RECORDID,GetShowExternalDocAlreadyExistNotificationId);
    END;

    LOCAL PROCEDURE GetGenJnlDocumentType@90() : Integer;
    VAR
      RefGenJournalLine@1000 : Record 81;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::"Blanket Order",
        "Document Type"::Quote,
        "Document Type"::Invoice,
        "Document Type"::Order:
          EXIT(RefGenJournalLine."Document Type"::Invoice);
        ELSE
          EXIT(RefGenJournalLine."Document Type"::"Credit Memo");
      END;
    END;

    LOCAL PROCEDURE RecallExternalDocAlreadyExistsNotification@39();
    VAR
      NotificationLifecycleMgt@1000 : Codeunit 1511;
    BEGIN
      IF NOT IsDocAlreadyExistNotificationEnabled THEN
        EXIT;

      NotificationLifecycleMgt.RecallNotificationsForRecordWithAdditionalContext(
        RECORDID,GetShowExternalDocAlreadyExistNotificationId,TRUE);
    END;

    LOCAL PROCEDURE IsDocAlreadyExistNotificationEnabled@91() : Boolean;
    VAR
      InstructionMgt@1000 : Codeunit 1330;
    BEGIN
      EXIT(InstructionMgt.IsMyNotificationEnabled(GetShowExternalDocAlreadyExistNotificationId));
    END;

    [External]
    PROCEDURE ShipToAddressEqualsCompanyShipToAddress@111() : Boolean;
    VAR
      CompanyInformation@1000 : Record 79;
    BEGIN
      CompanyInformation.GET;
      EXIT(IsShipToAddressEqualToCompanyShipToAddress(Rec,CompanyInformation));
    END;

    LOCAL PROCEDURE IsShipToAddressEqualToCompanyShipToAddress@113(PurchaseHeader@1000 : Record 38;CompanyInformation@1001 : Record 79) : Boolean;
    BEGIN
      EXIT(
        (PurchaseHeader."Ship-to Address" = CompanyInformation."Ship-to Address") AND
        (PurchaseHeader."Ship-to Address 2" = CompanyInformation."Ship-to Address 2") AND
        (PurchaseHeader."Ship-to City" = CompanyInformation."Ship-to City") AND
        (PurchaseHeader."Ship-to County" = CompanyInformation."Ship-to County") AND
        (PurchaseHeader."Ship-to Post Code" = CompanyInformation."Ship-to Post Code") AND
        (PurchaseHeader."Ship-to Country/Region Code" = CompanyInformation."Ship-to Country/Region Code") AND
        (PurchaseHeader."Ship-to Name" = CompanyInformation."Ship-to Name"));
    END;

    [External]
    PROCEDURE BuyFromAddressEqualsShipToAddress@94() : Boolean;
    BEGIN
      EXIT(
        ("Ship-to Address" = "Buy-from Address") AND
        ("Ship-to Address 2" = "Buy-from Address 2") AND
        ("Ship-to City" = "Buy-from City") AND
        ("Ship-to County" = "Buy-from County") AND
        ("Ship-to Post Code" = "Buy-from Post Code") AND
        ("Ship-to Country/Region Code" = "Buy-from Country/Region Code") AND
        ("Ship-to Name" = "Buy-from Vendor Name"));
    END;

    [External]
    PROCEDURE BuyFromAddressEqualsPayToAddress@163() : Boolean;
    BEGIN
      EXIT(
        ("Pay-to Address" = "Buy-from Address") AND
        ("Pay-to Address 2" = "Buy-from Address 2") AND
        ("Pay-to City" = "Buy-from City") AND
        ("Pay-to County" = "Buy-from County") AND
        ("Pay-to Post Code" = "Buy-from Post Code") AND
        ("Pay-to Country/Region Code" = "Buy-from Country/Region Code") AND
        ("Pay-to Contact No." = "Buy-from Contact No.") AND
        ("Pay-to Contact" = "Buy-from Contact"));
    END;

    LOCAL PROCEDURE SetPurchaserCode@933(PurchaserCodeToCheck@1000 : Code[20];VAR PurchaserCodeToAssign@1001 : Code[20]);
    BEGIN
      IF PurchaserCodeToCheck <> '' THEN BEGIN
        IF SalespersonPurchaser.GET(PurchaserCodeToCheck) THEN
          IF SalespersonPurchaser.VerifySalesPersonPurchaserPrivacyBlocked(SalespersonPurchaser) THEN
            PurchaserCodeToAssign := ''
          ELSE
            PurchaserCodeToAssign := PurchaserCodeToCheck;
      END ELSE
        PurchaserCodeToAssign := '';
    END;

    [External]
    PROCEDURE ValidatePurchaserOnPurchHeader@912(PurchaseHeader2@1000 : Record 38;IsTransaction@1001 : Boolean;IsPostAction@1002 : Boolean);
    BEGIN
      IF PurchaseHeader2."Purchaser Code" <> '' THEN
        IF SalespersonPurchaser.GET(PurchaseHeader2."Purchaser Code") THEN
          IF SalespersonPurchaser.VerifySalesPersonPurchaserPrivacyBlocked(SalespersonPurchaser) THEN BEGIN
            IF IsTransaction THEN
              ERROR(SalespersonPurchaser.GetPrivacyBlockedTransactionText(SalespersonPurchaser,IsPostAction,FALSE));
            IF NOT IsTransaction THEN
              ERROR(SalespersonPurchaser.GetPrivacyBlockedGenericText(SalespersonPurchaser,FALSE));
          END;
    END;

    LOCAL PROCEDURE GetReportSelectionsUsageFromDocumentType@124(VAR ReportSelectionsUsage@1000 : Option;VAR DocTxt@1001 : Text[150]);
    VAR
      ReportSelections@1002 : Record 77;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Order:
          BEGIN
            ReportSelectionsUsage := ReportSelections.Usage::"P.Order";
            DocTxt := PurchOrderDocTxt;
          END;
        "Document Type"::Quote:
          BEGIN
            ReportSelectionsUsage := ReportSelections.Usage::"P.Quote";
            DocTxt := PurchQuoteDocTxt;
          END;
      END;
    END;

    LOCAL PROCEDURE RevertCurrencyCodeAndPostingDate@167();
    BEGIN
      "Currency Code" := xRec."Currency Code";
      "Posting Date" := xRec."Posting Date";
      MODIFY;
    END;

    LOCAL PROCEDURE ValidateEmptySellToCustomerAndLocation@42();
    VAR
      SaveLocationCode@1100525000 : Code[10];
    BEGIN
      IF xRec."Sell-to Customer No." <> '' THEN //**4PS.n
        VALIDATE("Sell-to Customer No.",'');

      //**4PS.sn
      IF (Deliver = Deliver::Location) THEN BEGIN
       GetVend(xRec."Buy-from Vendor No.");
       IF "Location Code" = Vend."Location Code" THEN
         SaveLocationCode := Vend."Location Code";
       GetVend("Buy-from Vendor No.");
      END;

      IF (SaveLocationCode <> '') OR (Vend."Location Code" <> '') OR (Deliver <> Deliver::Location) THEN
      //**4PS.en
        UpdateLocationCode(Vend."Location Code");
    END;

    [External]
    PROCEDURE CheckForBlockedLines@220();
    VAR
      CurrentPurchLine@1001 : Record 39;
      Item@1000 : Record 27;
    BEGIN
      CurrentPurchLine.SETCURRENTKEY("Document Type","Document No.",Type);
      CurrentPurchLine.SETRANGE("Document Type","Document Type");
      CurrentPurchLine.SETRANGE("Document No.","No.");
      CurrentPurchLine.SETRANGE(Type,CurrentPurchLine.Type::Item);
      CurrentPurchLine.SETFILTER("No.",'<>''''');

      IF CurrentPurchLine.FINDSET THEN
        REPEAT
          Item.GET(CurrentPurchLine."No.");
          Item.TESTFIELD(Blocked,FALSE);
        UNTIL CurrentPurchLine.NEXT = 0;
    END;

    [External]
    PROCEDURE TestStatusOpen@134();
    VAR
      WorkFlowSetup4PSConstruct@1100525000 : Record 11229316;
    BEGIN
      OnBeforeTestStatusOpen;

      IF StatusCheckSuspended THEN
        EXIT;

      //**4PS
      IF Status = Status::"Pending Approval" THEN BEGIN
        WorkFlowSetup4PSConstruct.GET;
        IF WorkFlowSetup4PSConstruct."Purch. Invoice Modify Allowed" THEN
          EXIT;
      END;

      TESTFIELD(Status,Status::Open);

      OnAfterTestStatusOpen;
    END;

    [External]
    PROCEDURE SuspendStatusCheck@133(Suspend@1000 : Boolean);
    BEGIN
      StatusCheckSuspended := Suspend;
    END;

    LOCAL PROCEDURE UpdateInboundWhseHandlingTime@169();
    BEGIN
      IF "Location Code" = '' THEN BEGIN
        IF InvtSetup.GET THEN
          "Inbound Whse. Handling Time" := InvtSetup."Inbound Whse. Handling Time";
      END ELSE BEGIN
        IF Location.GET("Location Code") THEN;
        "Inbound Whse. Handling Time" := Location."Inbound Whse. Handling Time";
      END;
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAddShipToAddress@158(VAR PurchaseHeader@1000 : Record 38;SalesHeader@1001 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitRecord@138(VAR PurchHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitNoSeries@140(VAR PurchHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterChangePricesIncludingVAT@187(VAR PurchaseHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCheckBuyFromVendor@152(VAR PurchaseHeader@1000 : Record 38;xPurchaseHeader@1001 : Record 38;Vendor@1002 : Record 23);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCheckPayToVendor@156(VAR PurchaseHeader@1000 : Record 38;xPurchaseHeader@1001 : Record 38;Vendor@1002 : Record 23);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterConfirmPurchPrice@166(VAR PurchaseHeader@1000 : Record 38;VAR PurchaseLine@1001 : Record 39;VAR RecalculateLines@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCopyBuyFromVendorFieldsFromVendor@114(VAR PurchaseHeader@1000 : Record 38;Vendor@1001 : Record 23;xPurchaseHeader@1002 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCopyBuyFromVendorAddressFieldsFromVendor@130(VAR PurchaseHeader@1000 : Record 38;BuyFromVendor@1001 : Record 23);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCopyPayToVendorAddressFieldsFromVendor@132(VAR PurchaseHeader@1000 : Record 38;PayToVendor@1001 : Record 23);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCopyShipToVendorAddressFieldsFromVendor@131(VAR PurchaseHeader@1000 : Record 38;BuyFromVendor@1001 : Record 23);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterRecreatePurchLine@93(VAR PurchLine@1000 : Record 39;VAR TempPurchLine@1001 : TEMPORARY Record 39);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterDeleteAllTempPurchLines@155();
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetNoSeriesCode@107(VAR PurchHeader@1000 : Record 38;PurchSetup@1001 : Record 312;VAR NoSeriesCode@1002 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetPostingNoSeriesCode@175(PurchaseHeader@1000 : Record 38;VAR PostingNos@1001 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetPrepaymentPostingNoSeriesCode@178(PurchaseHeader@1000 : Record 38;VAR PostingNos@1001 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetPurchSetup@177(PurchaseHeader@1000 : Record 38;VAR PurchasesPayablesSetup@1001 : Record 312;CalledByFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetShipToForSpecOrder@129(VAR PurchaseHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterTestNoSeries@136(VAR PurchHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterTransferSavedFields@181(VAR DestinationPurchaseLine@1000 : Record 39;SourcePurchaseLine@1001 : Record 39);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateBuyFromVend@128(VAR PurchaseHeader@1000 : Record 38;Contact@1001 : Record 5050);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateBuyFromCont@143(VAR PurchaseHeader@1000 : Record 38;Vendor@1001 : Record 23;Contact@1002 : Record 5050);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdatePayToCont@144(VAR PurchaseHeader@1000 : Record 38;Vendor@1001 : Record 23;Contact@1002 : Record 5050);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdatePayToVend@162(VAR PurchaseHeader@1000 : Record 38;Contact@1001 : Record 5050);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateShipToAddress@137(VAR PurchHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateCurrencyFactor@127(VAR PurchaseHeader@1000 : Record 38;HideValidationDialog@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAppliesToDocNoOnLookup@106(VAR PurchaseHeader@1000 : Record 38;VendorLedgerEntry@1001 : Record 25);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnUpdatePurchLinesByChangedFieldName@139(PurchHeader@1000 : Record 38;VAR PurchLine@1001 : Record 39;ChangedFieldName@1002 : Text[100];ChangedFieldNo@1003 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateDimTableIDs@164(VAR PurchaseHeader@1000 : Record 38;CallingFieldNo@1001 : Integer;VAR TableID@1003 : ARRAY [10] OF Integer;VAR No@1002 : ARRAY [10] OF Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterValidateShortcutDimCode@125(VAR PurchHeader@1000 : Record 38;xPurchHeader@1001 : Record 38;FieldNumber@1003 : Integer;VAR ShortcutDimCode@1002 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterTransferExtendedTextForPurchaseLineRecreation@165(VAR PurchLine@1000 : Record 39;VAR TempPurchaseLine@1001 : TEMPORARY Record 39);
    BEGIN
    END;

    [Integration(TRUE)]
    PROCEDURE OnValidatePurchaseHeaderPayToVendorNo@1215(Vendor@1214 : Record 23;VAR PurchaseHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeConfirmUpdateCurrencyFactor@184(PurchaseHeader@1000 : Record 38;VAR HideValidationDialog@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeInitInsert@168(VAR PurchaseHeader@1000 : Record 38;VAR xPurchaseHeader@1001 : Record 38;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeInitRecord@151(VAR PurchaseHeader@1000 : Record 38;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeIsCreditDocType@146(PurchaseHeader@1000 : Record 38;VAR CreditDocType@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeIsTotalValid@174(VAR PurchaseHeader@1000 : Record 38;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateCurrencyFactor@95(VAR PurchaseHeader@1000 : Record 38;VAR Updated@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeRecreatePurchLines@199(VAR PurchHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeSetSecurityFilterOnRespCenter@147(VAR PurchaseHeader@1000 : Record 38;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeTestNoSeries@149(VAR PurchaseHeader@1000 : Record 38;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateAllLineDim@236(VAR PurchaseHeader@1000 : Record 38;NewParentDimSetID@1002 : Integer;OldParentDimSetID@1001 : Integer;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateLocationCode@161(VAR PurchaseHeader@1000 : Record 38;LocationCode@1001 : Code[10];VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdatePurchLinesByFieldNo@173(VAR PurchaseHeader@1000 : Record 38;ChangedFieldNo@1001 : Integer;VAR AskQuestion@1002 : Boolean;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateShipToAddress@179(VAR PurchaseHeader@1000 : Record 38;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateDimOnBeforeUpdateLines@356(VAR PurchaseHeader@1000 : Record 38;xPurchaseHeader@1001 : Record 38;CurrentFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnRecreatePurchLinesOnAfterValidateType@344(VAR PurchaseLine@1000 : Record 39;TempPurchaseLine@1001 : TEMPORARY Record 39);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnRecreatePurchLinesOnBeforeInsertPurchLine@112(VAR PurchaseLine@1000 : Record 39;VAR TempPurchaseLine@1001 : TEMPORARY Record 39);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnRecreatePurchLinesOnBeforeTempPurchLineInsert@118(VAR TempPurchaseLine@1000 : TEMPORARY Record 39;PurchaseLine@1001 : Record 39);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateBuyFromVendorNoBeforeRecreateLines@115(VAR PurchaseHeader@1000 : Record 38;CallingFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration(TRUE)]
    LOCAL PROCEDURE OnBeforeTestStatusOpen@135();
    BEGIN
    END;

    [Integration(TRUE)]
    LOCAL PROCEDURE OnAfterTestStatusOpen@142();
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdatePurchLines@145(VAR PurchaseHeader@1000 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnInitFromPurchHeader@180(VAR PurchaseHeader@1000 : Record 38;SourcePurchaseHeader@1001 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnInitFromContactOnBeforeInitRecord@185(VAR PurchaseHeader@1000 : Record 38;xPurchaseHeader@1001 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnInitFromVendorOnBeforeInitRecord@183(VAR PurchaseHeader@1000 : Record 38;xPurchaseHeader@1001 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnInitInsertOnBeforeInitRecord@172(VAR PurchaseHeader@1000 : Record 38;VAR xPurchaseHeader@1001 : Record 38);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnRecreatePurchLinesOnBeforeConfirm@211(VAR PurchaseHeader@1000 : Record 38;xPurchaseHeader@1001 : Record 38;ChangedFieldName@1002 : Text[100];HideValidationDialog@1003 : Boolean;VAR Confirmed@1004 : Boolean;VAR IsHandled@1005 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidatePaymentTermsCodeOnBeforeCalcDueDate@224(VAR PurchaseHeader@1000 : Record 38;VAR xPurchaseHeader@1001 : Record 38;CalledByFieldNo@1002 : Integer;CallingFieldNo@1003 : Integer;VAR IsHandled@1004 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidatePaymentTermsCodeOnBeforeCalcPmtDiscDate@225(VAR PurchaseHeader@1000 : Record 38;VAR xPurchaseHeader@1001 : Record 38;CalledByFieldNo@1002 : Integer;CallingFieldNo@1003 : Integer;VAR IsHandled@1004 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidatePaytoVendorNoBeforeRecreateLines@120(VAR PurchaseHeader@1001 : Record 38;CallingFieldNo@1000 : Integer);
    BEGIN
    END;

    PROCEDURE LookupContactPerson@1210190001();
    VAR
      ContBussRelRec@1210190032 : Record 5054;
      Contact@1210190033 : Record 5050;
      ContactFrm@1210190000 : Page 5052;
    BEGIN
      //**4PS
      CLEAR(ContactFrm);
      ContactFrm.LOOKUPMODE(TRUE);
      IF "Buy-from Contact No." = '' THEN BEGIN
        ContBussRelRec.SETRANGE("Link to Table",ContBussRelRec."Link to Table"::Vendor);
        ContBussRelRec.SETRANGE("No.","Buy-from Vendor No.");
        IF NOT ContBussRelRec.FIND('-') THEN
          EXIT;
      END ELSE
        ContBussRelRec."Contact No." := "Buy-from Contact No.";

      Contact.SETRANGE(Type,Contact.Type::Person);
      Contact.SETRANGE("Company No.",ContBussRelRec."Contact No.");
      ContactFrm.SETTABLEVIEW(Contact);
      ContactFrm.SetCompanyNoForNewRec(ContBussRelRec."Contact No.");
      IF ContactFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
        ContactFrm.GETRECORD(Contact);
        "Buy-from Contact Person No." := Contact."No.";
        "Buy-from Contact" := Contact.Name;
        UpdateEMailForPurchOrderForContactPerson;
      END;
    END;

    PROCEDURE InitIcmStatus@1210190003();
    BEGIN
      //**4PS
      CALCFIELDS("ICM Login Code");
      IF "ICM Login Code" = '' THEN
        "ICM Status" := "ICM Status"::Manual
      ELSE
        "ICM Status" := "ICM Status"::Create;

      VALIDATE("ICM Status");  //check Lead Time + Expected Receipt Date

      CLEAR("ICF Status");
      IF "ICM Login Code" = '' THEN
        CLEAR("ICM Procedure")
      ELSE
        "ICM Procedure" := "ICM Procedure"::Send;  //InitValue
      "ICM File Created on" := 0D;
      "ICM File Created" := FALSE;
      "ICM Order Confirm. Received" := FALSE;
      "ICM Order Confirm. Received on" := 0D;
      "ICM File Sent" := FALSE;
    END;

    PROCEDURE CheckPurchOrderTypeAllowed@1210190004();
    VAR
      lvPurchLineRec@1210190000 : Record 39;
      lvProjRec@1210190001 : Record 11072003;
      lvServOrderRec@1210190002 : Record 11012823;
    BEGIN
      //**4PS
      lvPurchLineRec.SETRANGE("Document Type", "Document Type");
      lvPurchLineRec.SETRANGE("Document No.", "No.");
      IF lvPurchLineRec.FINDFIRST THEN BEGIN
        IF ("Purchase Order Type" <> "Purchase Order Type"::"Blanket Order") THEN BEGIN
          CALCFIELDS("Blanket Scheme");
          IF "Blanket Scheme" THEN
            FIELDERROR("Purchase Order Type", Text11012011);
        END;

        IF ("Purchase Order Type" = "Purchase Order Type"::"Return Order") THEN BEGIN
          IF NOT "Amounts only" THEN BEGIN
            lvPurchLineRec.SETFILTER(Quantity, '>%1', 0);
            IF lvPurchLineRec.FINDFIRST THEN
              FIELDERROR("Purchase Order Type", STRSUBSTNO(Text11012012, lvPurchLineRec.FIELDCAPTION(Quantity)));
            lvPurchLineRec.SETRANGE(Quantity);
          END ELSE BEGIN
            lvPurchLineRec.SETFILTER("Line Amount", '>%1', 0);
            IF lvPurchLineRec.FINDFIRST THEN
              FIELDERROR("Purchase Order Type", STRSUBSTNO(Text11012012, lvPurchLineRec.FIELDCAPTION("Line Amount")));
            lvPurchLineRec.SETRANGE("Line Amount");
          END;
        END;

        IF ("Purchase Order Type" = "Purchase Order Type"::"Blanket Order") THEN BEGIN
          lvPurchLineRec.SETFILTER(Quantity, '<%1', 0);
          IF lvPurchLineRec.FINDFIRST THEN
            FIELDERROR("Purchase Order Type", Text11012013);
          lvPurchLineRec.SETRANGE(Quantity);
        END;

        IF ("Purchase Order Type" <> "Purchase Order Type"::"Return Order") THEN BEGIN
          lvPurchLineRec.SETFILTER("Return Reason Code", '<>%1', '');
          IF lvPurchLineRec.FINDFIRST THEN
            FIELDERROR("Purchase Order Type", Text11012014);
          lvPurchLineRec.SETRANGE("Return Reason Code");
        END;
      END;

      IF ("Purchase Order Type" <> xRec."Purchase Order Type") AND
         (xRec."Purchase Order Type" = "Purchase Order Type"::"Return Order")
      THEN BEGIN
        IF "Job No." <> '' THEN BEGIN
          lvProjRec.GET("Job No.");
          lvProjRec.CheckProjectStatus(2);
        END;
        IF "Service Order No." <> '' THEN BEGIN
          lvServOrderRec.GET("Service Order No.");
          lvServOrderRec.CheckStatus(2);
        END;
        //
        lvPurchLineRec.SETFILTER("Job No.", '<>%1', '');
        IF lvPurchLineRec.FINDSET THEN BEGIN
          REPEAT
            IF lvPurchLineRec."Receiving Company" = '' THEN
              lvProjRec.CHANGECOMPANY(COMPANYNAME)
            ELSE
              lvProjRec.CHANGECOMPANY(lvPurchLineRec."Receiving Company");
            lvProjRec.GET(lvPurchLineRec."Job No.");
            lvProjRec.CheckProjectStatus(2);
          UNTIL lvPurchLineRec.NEXT = 0;
        END;
        lvPurchLineRec.SETRANGE("Job No.");
        //
        lvPurchLineRec.SETFILTER("Service Order No.", '<>%1', '');
        IF lvPurchLineRec.FINDSET THEN BEGIN
          REPEAT
            IF lvPurchLineRec."Receiving Company" = '' THEN
              lvServOrderRec.CHANGECOMPANY(COMPANYNAME)
            ELSE
              lvServOrderRec.CHANGECOMPANY(lvPurchLineRec."Receiving Company");
            lvServOrderRec.GET(lvPurchLineRec."Service Order No.");
            lvServOrderRec.CheckStatus(2);
          UNTIL lvPurchLineRec.NEXT = 0;
        END;
        lvPurchLineRec.SETRANGE("Service Order No.");
      END;
    END;

    PROCEDURE CheckResetToReceiveBlanktOrder@1100525002();
    VAR
      lvPurchLineRec@1100525000 : Record 39;
    BEGIN
      //**4PS
      IF ("Purchase Order Type" <> "Purchase Order Type"::"Blanket Order") THEN
        EXIT;

      lvPurchLineRec.SETRANGE("Document Type", "Document Type");
      lvPurchLineRec.SETRANGE("Document No.", "No.");
      lvPurchLineRec.SETFILTER("Qty. to Receive", '<>%1', 0);
      IF lvPurchLineRec.FINDSET(TRUE,FALSE) THEN BEGIN
        REPEAT
          lvPurchLineRec.VALIDATE("Qty. to Receive", 0);
          lvPurchLineRec.MODIFY(TRUE);
        UNTIL lvPurchLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckAskForNoSeries@1210190008(IDocType@1210190001 : Option;VAR ONewNoSeries@1210190035 : Code[10]);
    VAR
      lvNoSeriesRelRec@1210190000 : Record 310;
      lvDefaultNoSeries@1210190034 : Code[10];
    BEGIN
      //**4PS
      ONewNoSeries := '';
      PurchSetup.GET;
      CASE IDocType OF
        "Document Type"::Quote:
          lvDefaultNoSeries := PurchSetup."Quote Nos.";
        "Document Type"::Order:
          lvDefaultNoSeries := PurchSetup."Order Nos.";
        "Document Type"::"Blanket Order":
          lvDefaultNoSeries := PurchSetup."Blanket Order Nos.";
      END;
      IF lvDefaultNoSeries = '' THEN
        EXIT;

      ONewNoSeries := lvDefaultNoSeries;

      lvNoSeriesRelRec.SETRANGE(Code, lvDefaultNoSeries);
      IF NOT lvNoSeriesRelRec.FIND('-') THEN
        EXIT;

      IF NoSeriesMgt.SelectSeries(lvDefaultNoSeries, '', ONewNoSeries) THEN BEGIN
        IF ONewNoSeries <> '' THEN BEGIN
          NoSeriesMgt.TestSeries(lvDefaultNoSeries, ONewNoSeries);
          EXIT;
        END;
      END;

      ERROR(Text11012018);
    END;

    PROCEDURE GetNoForSelectedNoSeries@1210190010(VAR IPurchHeadRec@1210190000 : Record 38);
    VAR
      lvDefaultNoSeries@1210190001 : Code[10];
    BEGIN
      //**4PS
      PurchSetup.GET;
      CASE IPurchHeadRec."Document Type" OF
        "Document Type"::Quote:
          lvDefaultNoSeries := PurchSetup."Quote Nos.";
        "Document Type"::Order:
          lvDefaultNoSeries := PurchSetup."Order Nos.";
        "Document Type"::"Blanket Order":
          lvDefaultNoSeries := PurchSetup."Blanket Order Nos.";
      END;
      IF IPurchHeadRec."No. Series" <> '' THEN
        lvDefaultNoSeries := IPurchHeadRec."No. Series";
      NoSeriesMgt.InitSeries(
        lvDefaultNoSeries,'',IPurchHeadRec."Posting Date",IPurchHeadRec."No.",IPurchHeadRec."No. Series");

      IF IPurchHeadRec."No." = '' THEN
        ERROR(Text11012019);
    END;

    PROCEDURE CheckDeleteCompQuoteAllowed@1210190007();
    VAR
      lvLinkedQuoteRec@1210190000 : Record 11020214;
    BEGIN
      //**4PS
      lvLinkedQuoteRec.SETRANGE(Type, lvLinkedQuoteRec.Type::"Linked Quote");
      lvLinkedQuoteRec.SETRANGE("Comparison Quote", xRec."Comparison Quote");
      IF lvLinkedQuoteRec.FIND('-') THEN
        ERROR(Text11012017, FIELDCAPTION("Comparison Quote"), lvLinkedQuoteRec."Quote No.");
    END;

    PROCEDURE UpdateComparisonQuoteLinks@1210190006(IMode@1210190000 : Code[10]);
    VAR
      lvCompQuoteRec@1210190001 : Record 11020214;
    BEGIN
      //**4PS
      CASE IMode OF
        'INSERT':
          lvCompQuoteRec.UpdateOnInsertQuoteDoc("Comparison Quote", "No.");
        'MODIFY':
          lvCompQuoteRec.UpdateOnModifyQuoteDoc("Comparison Quote", "No.", xRec."Comparison Quote");
        'DELETE':
          lvCompQuoteRec.UpdateOnDeleteQuoteDoc("Comparison Quote", "No.");
      END;
    END;

    PROCEDURE Delete4PSAdditions@1100485000();
    VAR
      PurchHeadExtensionRec@1100525000 : Record 11020398;
      PurchaseLineExtension@1100525001 : Record 11020644;
      WarrantyDataPurchaseOrder@1210190001 : Record 11020665;
      SCOrderVariation@1100529600 : Record 11229369;
      PurchReqLine@1100529601 : Record 11229331;
      SignhostDocument@1100528400 : Record 11229468;
      SignhostSigner@1100528401 : Record 11229467;
      SignhostSignerRejectionText@1100528402 : Record 11072462;
    BEGIN
      //**4PS
      ReminderHeader.SETRANGE("Document Type", "Document Type");
      ReminderHeader.SETRANGE("Document No.", "No.");
      ReminderHeader.DELETEALL(TRUE);

      PurchHeadExtensionRec.SETRANGE("Document Type", "Document Type");
      PurchHeadExtensionRec.SETRANGE("Document No.", "No.");
      PurchHeadExtensionRec.DELETEALL;

      PurchaseLineExtension.RESET;
      PurchaseLineExtension.SETRANGE("Document Type", "Document Type");
      PurchaseLineExtension.SETRANGE("Document No.", "No.");
      IF NOT PurchaseLineExtension.ISEMPTY THEN
        PurchaseLineExtension.DELETEALL;

      PurchReqLine.SETRANGE("Document Type", "Document Type");
      PurchReqLine.SETRANGE("Document No.", "No.");
      PurchReqLine.MODIFYALL("Document Type", 0);
      PurchReqLine.MODIFYALL("Document No.", '');
      PurchReqLine.MODIFYALL("Document Line No.", 0);

      SignhostDocument.SETRANGE("Record ID", RECORDID);
      SignhostDocument.DELETEALL;

      SignhostSigner.SETRANGE("Record ID", RECORDID);
      SignhostSigner.DELETEALL;

      SignhostSignerRejectionText.SETRANGE("Record ID", RECORDID);
      SignhostSignerRejectionText.DELETEALL;

      CASE "Document Type" OF
        //**4PS Document relations and purchase texts added to Blanket Order
        "Document Type"::"Blanket Order":
          BEGIN
            DocRelRec.SETRANGE("Document Type",DocRelRec."Document Type"::"Blanket Order");
            DocRelRec.SETRANGE("No.","No.");
            DocRelRec.DELETEALL;
            ParRec.SETRANGE(Type,ParRec.Type::BlanketOrder);
            ParRec.SETRANGE("No.","No.");
            ParRec.DELETEALL;
            PurchTxtRec.SETRANGE("Line Type",PurchTxtRec."Line Type"::"Blanket Order");
            PurchTxtRec.SETRANGE("No.","No.");
            PurchTxtRec.DELETEALL;
          END;
        "Document Type"::Quote:
          BEGIN
            DocRelRec.SETRANGE("Document Type",DocRelRec."Document Type"::"Purchase Quote");
            DocRelRec.SETRANGE("No.","No.");
            DocRelRec.DELETEALL;
            ParRec.SETRANGE(Type,ParRec.Type::Quote);
            ParRec.SETRANGE("No.","No.");
            ParRec.DELETEALL;
            IF ("Document Type" = "Document Type"::Quote) AND ("Comparison Quote" <> '') THEN
              UpdateComparisonQuoteLinks('DELETE');
          END;
        "Document Type"::Order:
          BEGIN
            DocRelRec.SETRANGE("Document Type",DocRelRec."Document Type"::"Purchase Order");
            DocRelRec.SETRANGE("No.","No.");
            DocRelRec.DELETEALL;
            ParRec.SETRANGE(Type,ParRec.Type::Order);
            ParRec.SETRANGE("No.","No.");
            ParRec.DELETEALL;
            PurchRcptHeader.RESET;
            PurchRcptHeader.SETCURRENTKEY("Order No.");
            PurchRcptHeader.SETRANGE("Order No.","No.");
            PurchRcptHeader.DELETEALL(TRUE);
            WarrantyDataPurchaseOrder.SETRANGE("Document No.","No.");
            WarrantyDataPurchaseOrder.DELETEALL(TRUE);
            SCOrderVariation.SETRANGE("Purchase Order Number", "No.");
            SCOrderVariation.DELETEALL;
          END;
      END;
    END;

    PROCEDURE DetermineRemovalContribution@1100485002();
    VAR
      lvPurchLineRec@1100485003 : Record 39;
      lvPurchLineRec2@1100485002 : Record 39;
      lvItemRec@1100485001 : Record 27;
      lvTradeItemRec@1100485000 : Record 11012317;
      lvPostingSetup@1100485006 : Record 252;
      DimensionValue@1100525000 : Record 349;
      lvCostObject@1100485004 : Code[20];
      lvRemovalContribution@1100485005 : Decimal;
    BEGIN
      //**4PS
      lvPurchLineRec.SETRANGE("Document Type", "Document Type");
      lvPurchLineRec.SETRANGE("Document No.", "No.");
      lvPurchLineRec.SETRANGE("Removal Contribution", TRUE);
      lvPurchLineRec.SETRANGE("Quantity Received", 0);
      lvPurchLineRec.SETFILTER("Receipt No.", '%1', '');
      IF lvPurchLineRec.FINDSET THEN
        REPEAT
          lvPurchLineRec.SuspendStatusCheck(TRUE);
          lvPurchLineRec.DELETE(TRUE);
        UNTIL lvPurchLineRec.NEXT = 0;

      lvPurchLineRec.SETRANGE("Removal Contribution", FALSE);
      IF lvPurchLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          lvCostObject := '';
          lvRemovalContribution := 0;

          IF lvPurchLineRec."Trade Item" <> '' THEN BEGIN
            lvTradeItemRec.GET(lvPurchLineRec."Vendor (Trade Item)", lvPurchLineRec."Trade Item");
            lvCostObject := lvTradeItemRec."Cost Object (Removal)";
            lvRemovalContribution := lvTradeItemRec."Removal Contribution";
            IF lvRemovalContribution <> 0 THEN
              lvTradeItemRec.TESTFIELD("Cost Object (Removal)");
          END ELSE BEGIN
            IF lvPurchLineRec."Item No." <> '' THEN BEGIN
              lvItemRec.GET(lvPurchLineRec."Item No.");
              lvCostObject := lvItemRec."Cost Object (Removal)";
              lvRemovalContribution := lvItemRec."Removal Contribution";
              IF lvRemovalContribution <> 0 THEN
                lvItemRec.TESTFIELD("Cost Object (Removal)");
            END;
          END;

          IF lvRemovalContribution <> 0 THEN BEGIN
            lvPurchLineRec2.INIT;
            lvPurchLineRec2."Removal Contribution" := TRUE;
            lvPurchLineRec2.SuspendStatusCheck(TRUE);
            lvPurchLineRec2."Document Type" := lvPurchLineRec."Document Type";
            lvPurchLineRec2."Document No." := lvPurchLineRec."Document No.";
            lvPurchLineRec2."Line No." := lvPurchLineRec."Line No.";
            REPEAT
              lvPurchLineRec2."Line No." := lvPurchLineRec2."Line No." + 1;
            UNTIL lvPurchLineRec2.INSERT;

            lvPurchLineRec2."Attached to Line No." := lvPurchLineRec."Line No.";
            lvPurchLineRec2.Type := lvPurchLineRec2.Type::"G/L Account";
            lvPurchLineRec2."Receiving Company" := lvPurchLineRec."Receiving Company";
            lvPurchLineRec2."Additional Cost (Service)" := lvPurchLineRec."Additional Cost (Service)";
            lvPurchLineRec2.VALIDATE("Job No.", lvPurchLineRec."Job No.");
            lvPurchLineRec2.VALIDATE(Element, lvPurchLineRec.Element);
            lvPurchLineRec2."Extension Contract" := lvPurchLineRec."Extension Contract";
            lvPurchLineRec2.VALIDATE("Service Order No.", lvPurchLineRec."Service Order No.");
            lvPurchLineRec2.VALIDATE("Service Contract No.", lvPurchLineRec."Service Contract No.");
            lvPurchLineRec2."Service Location No." := lvPurchLineRec."Service Location No.";
            IF lvPurchLineRec2."No." = '' THEN BEGIN
              lvPostingSetup.GET(lvPurchLineRec."Gen. Bus. Posting Group", lvPurchLineRec."Gen. Prod. Posting Group");
              lvPostingSetup.TESTFIELD(lvPostingSetup."Purch. Account Removal Contr.");
              lvPurchLineRec2.VALIDATE("No.", lvPostingSetup."Purch. Account Removal Contr.");
              lvPurchLineRec2."Location Code" := lvPurchLineRec."Location Code";
              lvPurchLineRec2."Bin Code" := lvPurchLineRec."Bin Code";
            END;
            lvPurchLineRec2.Description := '';
            DimMgt.GetDimValueRec(2, lvCostObject, DimensionValue, TRUE, '');
            lvPurchLineRec2."Cost Type" := DimensionValue."Cost Type" + 1;
            lvPurchLineRec2.VALIDATE("Shortcut Dimension 2 Code", lvCostObject);
            lvPurchLineRec2."Additional Cost (Service)" := lvPurchLineRec."Additional Cost (Service)";
            IF lvPurchLineRec."Shortcut Dimension 1 Code" <> '' THEN
              lvPurchLineRec2.VALIDATE("Shortcut Dimension 1 Code", lvPurchLineRec."Shortcut Dimension 1 Code");
            lvPurchLineRec2.VALIDATE("Gen. Prod. Posting Group", lvPurchLineRec."Gen. Prod. Posting Group");
            lvPurchLineRec2.VALIDATE("VAT Prod. Posting Group", lvPurchLineRec."VAT Prod. Posting Group");
            lvPurchLineRec2.VALIDATE("VAT Bus. Posting Group", lvPurchLineRec."VAT Bus. Posting Group");
            lvPurchLineRec2.VALIDATE(Quantity, lvPurchLineRec.Quantity * lvPurchLineRec."Qty. per Unit of Measure");

            IF (lvPurchLineRec2."Document Type" = lvPurchLineRec2."Document Type"::Order) THEN
              lvPurchLineRec2.VALIDATE(
                "Qty. to Receive", lvPurchLineRec."Qty. to Receive"  * lvPurchLineRec."Qty. per Unit of Measure");

            lvPurchLineRec2.VALIDATE("Direct Unit Cost", lvRemovalContribution);
            lvPurchLineRec2."Expected Receipt Date" := lvPurchLineRec."Expected Receipt Date";
            lvPurchLineRec2."Planned Receipt Date" := lvPurchLineRec."Planned Receipt Date";
            lvPurchLineRec2."Promised Receipt Date" := lvPurchLineRec."Promised Receipt Date";
            lvPurchLineRec2."Requested Receipt Date" := lvPurchLineRec."Requested Receipt Date";
            lvPurchLineRec2."Return Reason Code" := lvPurchLineRec."Return Reason Code";
            lvPurchLineRec2.MODIFY(TRUE);
          END;
        UNTIL lvPurchLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateVATData@1100485001();
    VAR
      CompanyInfo@1100485000 : Record 79;
      Location@1100485001 : Record 14;
    BEGIN
      //**4PS.sn
      "Company VAT Registration No." := '';
      IF Deliver = Deliver::Location THEN
        IF Location.GET("Ship-to Location") THEN
          IF Location."VAT Registration No." <> '' THEN
            "Company VAT Registration No." := Location."VAT Registration No.";
      IF "Company VAT Registration No." = '' THEN BEGIN
        CompanyInfo.GET;
        "Company VAT Registration No." := CompanyInfo."VAT Registration No.";
      END;
      VALIDATE("Country of Destination","Ship-to Country/Region Code");
      //**4PS.en
    END;

    PROCEDURE UpdateVATGroup@1100485004();
    VAR
      CountryOrigin@1100485000 : Record 9;
      CountryDestination@1100485001 : Record 9;
      GLSetup@1100485002 : Record 98;
    BEGIN
      //**4PS
      GetVend("Buy-from Vendor No.");
      "VAT Bus. Posting Group" := Vend."VAT Bus. Posting Group";

      GLSetup.GET;
      IF NOT GLSetup."Extended Purch. VAT Determ." THEN
        EXIT;

      IF "Country of Destination" = '' THEN
        EXIT;

      CountryDestination.GET("Country of Destination");
      CountryDestination.TESTFIELD("VAT Bus. Posting Group");
      CountryDestination.TESTFIELD("VAT Bus. Posting Group EU");
      CountryDestination.TESTFIELD("VAT Bus. Posting Group Imp/Exp");

      IF "Country of Origin" = "Country of Destination" THEN
        "VAT Bus. Posting Group" := CountryDestination."VAT Bus. Posting Group"
      ELSE
        IF CountryOrigin.GET("Country of Origin") AND
           (CountryOrigin."Intrastat Code" <> '') AND
           (CountryDestination."Intrastat Code" <> '')
        THEN
          "VAT Bus. Posting Group" := CountryDestination."VAT Bus. Posting Group EU"
        ELSE
          "VAT Bus. Posting Group" := CountryDestination."VAT Bus. Posting Group Imp/Exp";
    END;

    PROCEDURE DistrPurchLinesOverSubProjects@1100485003(PurchaseHeader@1100485000 : Record 38);
    VAR
      PurchaseLine@1100485001 : Record 39;
      MaxLine@1100485002 : Integer;
      Job@1100485003 : Record 11072003;
    BEGIN
      //**4PS
      PurchaseHeader.TESTFIELD("Amounts only", TRUE);
      PurchaseHeader.TESTFIELD(Status, Status::Open);
      MaxLine := 0;
      PurchaseLine.SETRANGE("Document Type", PurchaseHeader."Document Type");
      PurchaseLine.SETRANGE("Document No.", PurchaseHeader."No.");
      IF PurchaseLine.FINDLAST THEN
        MaxLine := PurchaseLine."Line No.";
      PurchaseLine.SETRANGE("Receiving Company", '');
      PurchaseLine.SETFILTER("Job No.", '<>%1', '');
      PurchaseLine.SETRANGE("Amnt. Received", 0);
      IF PurchaseLine.FINDSET(TRUE, TRUE) THEN
        REPEAT
          Job.GET(PurchaseLine."Job No.");
          IF (Job."Single/Main/Sub Project" = Job."Single/Main/Sub Project"::"Main Project") THEN
            IF GeneratePurchaseLines(PurchaseHeader, PurchaseLine, MaxLine) THEN
              PurchaseLine.DELETE(TRUE);

        UNTIL PurchaseLine.NEXT = 0;
    END;

    LOCAL PROCEDURE GeneratePurchaseLines@1100498000(IPurchaseHeader@1100498000 : Record 38;IPurchaseLine@1100485001 : Record 39;VAR PurchaseLineNo@1100485005 : Integer) : Boolean;
    VAR
      PurchaseLine@1100498001 : Record 39;
      BudgetLine@1100498002 : Record 11012001;
      Job@1100498003 : Record 11072003;
      TotalAmount@1100485000 : Decimal;
    BEGIN
      //**4PS
      TotalAmount := 0;

      Job.RESET;
      Job.SETCURRENTKEY("Main Project");
      Job.SETRANGE("Main Project", IPurchaseLine."Job No.");
      Job.SETRANGE("Single/Main/Sub Project", Job."Single/Main/Sub Project"::"Sub Project");
      Job.SETFILTER("Project Status", '<%1', Job."Project Status"::"Administrative Finished");
      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",IPurchaseLine."Shortcut Dimension 2 Code");
          BudgetLine.CALCSUMS("Amount (LCY)");
          TotalAmount := TotalAmount + BudgetLine."Amount (LCY)";
        UNTIL Job.NEXT = 0;
      IF TotalAmount = 0 THEN
        EXIT(FALSE);

      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",IPurchaseLine."Shortcut Dimension 2 Code");
          BudgetLine.CALCSUMS("Amount (LCY)");

          PurchaseLineNo := PurchaseLineNo + 10000;
          PurchaseLine.INIT;
          PurchaseLine.VALIDATE("Document Type",IPurchaseHeader."Document Type");
          PurchaseLine.VALIDATE("Document No.",IPurchaseHeader."No.");
          PurchaseLine.VALIDATE("Line No." ,PurchaseLineNo);
          PurchaseLine.Description := Job.Description;
          PurchaseLine.INSERT(TRUE);
          PurchaseLine.VALIDATE("Job No.", Job."No.");
          PurchaseLine.VALIDATE("Shortcut Dimension 2 Code", IPurchaseLine."Shortcut Dimension 2 Code");
          PurchaseLine.VALIDATE("Buy-from Vendor No.", IPurchaseHeader."Buy-from Vendor No.");
          PurchaseLine.VALIDATE("Direct Unit Cost",IPurchaseLine."Direct Unit Cost" * (BudgetLine."Amount (LCY)" / TotalAmount));
          PurchaseLine.VALIDATE("Line Discount %", IPurchaseLine."Line Discount %");
          PurchaseLine.VALIDATE("VAT Bus. Posting Group", IPurchaseLine."VAT Bus. Posting Group");
          PurchaseLine.VALIDATE("VAT Prod. Posting Group", IPurchaseLine."VAT Prod. Posting Group");
          IF IPurchaseHeader."Amounts only"THEN
            PurchaseLine.InitAmntToReceive
          ELSE
            PurchaseLine.InitQtyToReceive;
          PurchaseLine.Description := IPurchaseLine.Description;
          PurchaseLine."Description 2" := IPurchaseLine."Description 2";
          PurchaseLine.MODIFY(TRUE);
        UNTIL Job.NEXT = 0;

      EXIT(TRUE);
    END;

    PROCEDURE CheckInwardLines@1100485005(lvPurchHeader@1100485000 : Code[20];lvUsePurchHeader@1100485001 : Boolean);
    VAR
      lvInwardRec@1100485002 : Record 11020350;
      lvInwardForm@1100485003 : Page 11072420;
    BEGIN
      //**4PS
      lvInwardRec.SETRANGE(Posted, FALSE);
      IF lvUsePurchHeader THEN BEGIN
        lvInwardRec.SETCURRENTKEY(Posted, "Purchase Order No.");
        lvInwardRec.SETRANGE("Purchase Order No.", lvPurchHeader);
      END;
      IF lvInwardRec.COUNT > 0 THEN BEGIN
        IF CONFIRM(Text11012022, TRUE) THEN BEGIN
          lvInwardRec.SETCURRENTKEY(Posted, "Job No.");
          lvInwardForm.SETTABLEVIEW(lvInwardRec);
          lvInwardForm.RUNMODAL;
        END;
      END;
    END;

    PROCEDURE ShowInwardLines@1100525001();
    VAR
      lvInwardRec@1100525001 : Record 11020350;
      lvInwardForm@1100525000 : Page 11072420;
    BEGIN
      //**4PS
      lvInwardRec.SETCURRENTKEY(Posted, "Purchase Order No.");
      lvInwardRec.SETRANGE("Purchase Order No.", "No.");
      lvInwardForm.SETTABLEVIEW(lvInwardRec);
      lvInwardForm.RUNMODAL;
    END;

    LOCAL PROCEDURE ValidateLocationCode@1100525000();
    BEGIN
      //**4PS
      UpdateDeliver(FIELDNO("Location Code"));
    END;

    PROCEDURE CheckVendorInvoiceNo@1100525003(IVendInvNo@1100525001 : Code[35];IFromVendCredMemNo@1100525003 : Boolean;IErrorMode@1100525000 : Boolean) : Boolean;
    VAR
      lvVendInvNoCaptionTxt@1100525002 : Text[1024];
    BEGIN
      //**4PS
      // The source code of OnValidate from fields 68/69 is moved to this new function
      PurchSetup.GET;

      IF IVendInvNo <> '' THEN BEGIN
        PurchHeader.RESET;
        PurchHeader.SETCURRENTKEY("Document Type","Buy-from Vendor No.","No.");
        IF NOT IFromVendCredMemNo THEN BEGIN
          PurchHeader.SETRANGE("Document Type","Document Type"::Invoice);
          PurchHeader.SETRANGE("Vendor Invoice No.",IVendInvNo);
          lvVendInvNoCaptionTxt := FIELDCAPTION("Vendor Invoice No.");
        END ELSE BEGIN
          PurchHeader.SETRANGE("Document Type","Document Type"::"Credit Memo");
          PurchHeader.SETRANGE("Vendor Cr. Memo No.",IVendInvNo);
          lvVendInvNoCaptionTxt := FIELDCAPTION("Vendor Cr. Memo No.");
        END;
        PurchHeader.SETRANGE("Buy-from Vendor No.","Buy-from Vendor No.");
        PurchHeader.SETFILTER(PurchHeader."No.",'<> %1',"No.");
        IF PurchSetup."Check Dupl. Vend. Invoice Nos." = PurchSetup."Check Dupl. Vend. Invoice Nos."::"In Calendar Year" THEN
          PurchHeader.SETRANGE("Document Date", CALCDATE('<-CY>', "Document Date"), CALCDATE('<CY>', "Document Date"))
        ELSE
          PurchHeader.SETRANGE("Document Date");
        IF PurchHeader.FINDFIRST THEN BEGIN
          IF NOT IErrorMode THEN
            EXIT(FALSE);
          ERROR(Text11012000,
            lvVendInvNoCaptionTxt, IVendInvNo,
            STRSUBSTNO('%1',"Document Type"), "No.",
            STRSUBSTNO('%1',PurchHeader."Document Type"), PurchHeader."No.");
        END;
        PurchHeader.RESET;

        VendLedgEntry.RESET;
        VendLedgEntry.SETCURRENTKEY("External Document No.");
        IF NOT IFromVendCredMemNo THEN
          VendLedgEntry.SETRANGE("Document Type",VendLedgEntry."Document Type"::Invoice)
        ELSE
          VendLedgEntry.SETRANGE("Document Type",VendLedgEntry."Document Type"::"Credit Memo");
        VendLedgEntry.SETRANGE("Vendor No.","Buy-from Vendor No.");
        VendLedgEntry.SETRANGE("External Document No.",IVendInvNo);
        IF PurchSetup."Check Dupl. Vend. Invoice Nos." = PurchSetup."Check Dupl. Vend. Invoice Nos."::"In Calendar Year" THEN
          VendLedgEntry.SETRANGE("Document Date", CALCDATE('<-CY>', "Document Date"), CALCDATE('<CY>', "Document Date"))
        ELSE
          VendLedgEntry.SETRANGE("Document Date");
        IF VendLedgEntry.FINDFIRST THEN BEGIN
          IF NOT IErrorMode THEN
            EXIT(FALSE);
          ERROR(Text11012000,
            lvVendInvNoCaptionTxt, IVendInvNo,
            STRSUBSTNO('%1',"Document Type"), "No.",
            STRSUBSTNO('%1',VendLedgEntry."Document Type"), VendLedgEntry."Document No.");
        END;
        VendLedgEntry.RESET;
      END;
      EXIT(TRUE);
    END;

    PROCEDURE GetDefaultOrderAddress@1100525004();
    BEGIN
      //**4PS
      IF ("Document Type" = "Document Type"::Order) OR ("Document Type" = "Document Type"::Quote) THEN BEGIN
        OrderAddr.SETRANGE("Vendor No.","Buy-from Vendor No.");
        OrderAddr.SETRANGE("Default Order Address", TRUE);
        IF OrderAddr.FINDFIRST THEN
          "Order Address Code" := OrderAddr.Code;
      END;
    END;

    PROCEDURE GetOrderAddressByDepartment@1100528704(VAR OrderAddressCode@1100528705 : Code[10]);
    VAR
      OrderAddress@1100528704 : Record 224;
      Job@1100528703 : Record 11072003;
      ServiceOrder@1100528702 : Record 11012823;
      UserSetup@1100528701 : Record 91;
      DepartmentCode@1100528700 : Code[20];
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Quote, "Document Type"::Order, "Document Type"::"Blanket Order"]) THEN
        EXIT;

      IF ("Job No." <> '') THEN
        IF Job.GET("Job No.") THEN
          DepartmentCode := Job."Global Dimension 1 Code";

      IF (DepartmentCode = '') AND ("Service Order No." <> '') THEN
        IF ServiceOrder.GET("Service Order No.") THEN
          DepartmentCode := ServiceOrder."Global Dimension 1 Code";

      IF (DepartmentCode = '') THEN
        IF UserSetup.GET(USERID) THEN
          DepartmentCode := UserSetup."Department Code";

      IF (DepartmentCode <> '') THEN BEGIN
        OrderAddress.SETRANGE("Vendor No.", "Buy-from Vendor No.");
        OrderAddress.SETRANGE("Global Dimension 1 Code", DepartmentCode);
        IF OrderAddress.FINDFIRST THEN
          OrderAddressCode := OrderAddress.Code;
      END;
    END;

    PROCEDURE UpdateOrderAddressByDepartment@1100528700();
    VAR
      OrderAddressCode@1100528700 : Code[10];
    BEGIN
      //**4PS
      GetOrderAddressByDepartment(OrderAddressCode);
      IF OrderAddressCode <> '' THEN
        VALIDATE("Order Address Code", OrderAddressCode);
    END;

    PROCEDURE CreatePurchaseOrder@1100525005(lvProject@1100525000 : Code[20];lvServOrder@1100525001 : Code[20]);
    VAR
      PurchHeader@1100485000 : Record 38;
      UserMgt@1100485001 : Codeunit 5700;
    BEGIN
      //**4PS
      PurchHeader.INIT;

      //**4PS.sn DPA
      IF DPA_IsActive THEN
        DPA_Management.SetDepartmentCodeUser(PurchHeader.TABLENAME, PurchHeader."Shortcut Dimension 1 Code");
      //**4PS.en DPA

      PurchHeader."Responsibility Center" := UserMgt.GetPurchasesDefault();
      PurchHeader."Document Type" := PurchHeader."Document Type"::Order;
      PurchHeader.INSERT(TRUE);
      IF lvProject <> '' THEN BEGIN
        PurchHeader.SetCurrFieldNo(FIELDNO("Job No."));
        PurchHeader.VALIDATE("Job No.",lvProject);
        PurchHeader.SetCurrFieldNo(0);
      END;
      IF lvServOrder <> '' THEN BEGIN
        PurchHeader.SetCurrFieldNo(FIELDNO("Service Order No."));
        PurchHeader.VALIDATE("Service Order No.", lvServOrder);
        PurchHeader.SetCurrFieldNo(0);
      END;

      //**4PS.sn DPA
      IF DPA_IsActive THEN
        DPA_Management.SetDepartmentCodeNoSeries(
          PurchHeader.TABLENAME,
          PurchHeader."Shortcut Dimension 1 Code",
          PurchHeader."No. Series",
          '' );
      //**4PS.en DPA

      PurchHeader.MODIFY(TRUE);

      COMMIT; // Commit and runmodal are necessary to show new order in page with markedonly filter.
      PAGE.RUNMODAL(PAGE::"Purchase Order", PurchHeader);
    END;

    PROCEDURE MarkPurchaseOrdersOfProject@1100528404(ProjectNo@1100528400 : Code[20]);
    BEGIN
      //**4PS
      MarkPurchaseHeadersOfProject(ProjectNo, "Document Type"::Order);
    END;

    PROCEDURE MarkPurchaseQuotesOfProject@1100528405(ProjectNo@1100528400 : Code[20]);
    BEGIN
      //**4PS
      MarkPurchaseHeadersOfProject(ProjectNo, "Document Type"::Quote);
    END;

    LOCAL PROCEDURE MarkPurchaseHeadersOfProject@1100528406(ProjectNo@1100528400 : Code[20];DocumentType@1100528404 : Integer);
    VAR
      PurchaseHeader@1100528405 : Record 38;
      PurchaseLine@1100528402 : Record 39;
    BEGIN
      //**4PS
      IF ProjectNo = '' THEN
        EXIT;

      PurchaseHeader.SETCURRENTKEY("Document Type", "Job No.");
      PurchaseHeader.SETRANGE("Document Type", DocumentType);
      PurchaseHeader.SETRANGE("Job No.", ProjectNo);
      IF PurchaseHeader.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseHeader."No.") THEN
            MARK(TRUE);
        UNTIL PurchaseHeader.NEXT = 0;

      PurchaseLine.SETCURRENTKEY("Document Type","Job No.");
      PurchaseLine.SETRANGE("Document Type", DocumentType);
      PurchaseLine.SETRANGE("Job No.", ProjectNo);
      IF PurchaseLine.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseLine."Document No.") THEN
            MARK(TRUE);
        UNTIL PurchaseLine.NEXT = 0;
    END;

    PROCEDURE MarkPurchaseOrdersOfServiceOrder@1100528408(ServiceOrderNo@1100528400 : Code[20]);
    BEGIN
      //**4PS
      MarkPurchaseHeadersOfServiceOrder(ServiceOrderNo, "Document Type"::Order);
    END;

    LOCAL PROCEDURE MarkPurchaseHeadersOfServiceOrder@1100528407(ServiceOrderNo@1100528400 : Code[20];DocumentType@1100528404 : Integer);
    VAR
      PurchaseHeader@1100527000 : Record 38;
      PurchaseLine@1100528402 : Record 39;
    BEGIN
      //**4PS
      IF ServiceOrderNo = '' THEN
        EXIT;

      PurchaseHeader.SETRANGE("Document Type", DocumentType);
      PurchaseHeader.SETRANGE("Service Order No.", ServiceOrderNo);
      IF PurchaseHeader.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseHeader."No.") THEN
            MARK(TRUE);
        UNTIL PurchaseHeader.NEXT = 0;

      PurchaseLine.SETCURRENTKEY("Document Type", "Service Order No.");
      PurchaseLine.SETRANGE("Document Type", DocumentType);
      PurchaseLine.SETRANGE("Service Order No.", ServiceOrderNo);
      IF PurchaseLine.FINDSET THEN BEGIN
        REPEAT
          IF GET(DocumentType, PurchaseLine."Document No.") THEN
            MARK(TRUE);
        UNTIL PurchaseLine.NEXT = 0;
      END;
    END;

    PROCEDURE LookupVendor@1100525006(xPurchaseHeader@1100525002 : Record 38);
    VAR
      Vendor@1100525000 : Record 23;
      VendorList@1100525001 : Page 27;
    BEGIN
      //**4PS
      xRec := xPurchaseHeader;
      IF StrategicPurchMgt.IsLimitedPurchaser("Document Type") THEN BEGIN
        Vendor.FILTERGROUP(10);
        Vendor.SETFILTER("Blanket Contract Type",'<>%1',Vendor."Blanket Contract Type"::"No Contract");
        IF Vendor.FINDSET THEN
          REPEAT
            Vendor.MARK(StrategicPurchMgt.VendorHasContract(Vendor));
          UNTIL Vendor.NEXT = 0;
        Vendor.MARKEDONLY(TRUE);
        Vendor.FILTERGROUP(0);
        IF Vendor.GET("Buy-from Vendor No.") THEN;
        IF PAGE.RUNMODAL(0,Vendor) = ACTION::LookupOK THEN
          VALIDATE("Buy-from Vendor No.",Vendor."No.");
      END ELSE BEGIN
        VendorList.LOOKUPMODE(TRUE);
        IF Vendor.GET("Buy-from Vendor No.") THEN
          VendorList.SETRECORD(Vendor);
        IF VendorList.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VendorList.GETRECORD(Vendor);
          VALIDATE("Buy-from Vendor No.",Vendor."No.");
        END;
      END;
    END;

    PROCEDURE SetSkipStrategicPurchaseCheck@1100525007(SetTo@1100525000 : Boolean);
    BEGIN
      SkipStrategicPurchCheck := SetTo;
    END;

    PROCEDURE FillJournalTemplate@1100525008();
    VAR
      lvGenJournalTemplateRec@1100525000 : Record 80;
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"]) THEN
        EXIT;

      PurchSetup.GET;
      IF (PurchSetup."Approve Purchase Invoices") THEN
        IF PurchSetup."Determine Approval Template" = PurchSetup."Determine Approval Template"::Vendor THEN BEGIN
          IF "Buy-from Vendor No." <> '' THEN BEGIN
            GetVend("Buy-from Vendor No.");
            Vend.TESTFIELD("Inv.Appr.Journal Template");
            "Inv.Appr.Journal Template" := Vend."Inv.Appr.Journal Template";
          END;
        END ELSE BEGIN
          IF "Shortcut Dimension 1 Code" <> '' THEN BEGIN
            lvGenJournalTemplateRec.SETRANGE("Global Dimension 1 Code","Shortcut Dimension 1 Code");
            lvGenJournalTemplateRec.SETRANGE(Type,lvGenJournalTemplateRec.Type::"Purch.Invoice Approval");
            lvGenJournalTemplateRec.FINDFIRST;
            "Inv.Appr.Journal Template" := lvGenJournalTemplateRec.Name;
          END;
        END;
    END;

    PROCEDURE HandleShipmentInstruction@1100525009(iAction@1100525001 : Integer;VAR varText1@1100525004 : Text[250];VAR varText2@1100525005 : Text[250]);
    VAR
      PurchCommLineRec@1100525000 : Record 43;
      i@1100525003 : Integer;
      LastLine@1100525002 : Integer;
      PurchCode@1100525006 : Code[20];
      MaxLen@1100525007 : Integer;
    BEGIN
      //**4PS
      PurchCode := 'SHIPMINSTR';
      MaxLen := 38;

      IF iAction = 0 THEN BEGIN  //read
        varText1 := '';
        varText2 := '';
        PurchCommLineRec.SETRANGE("Document Type", "Document Type");
        PurchCommLineRec.SETRANGE("No.", "No.");
        PurchCommLineRec.SETRANGE("Document Line No.", 0);
        PurchCommLineRec.SETRANGE(Code, PurchCode);
        IF PurchCommLineRec.FINDSET THEN BEGIN
          REPEAT
            i := i + 1;
            IF i = 1 THEN
              varText1 := COPYSTR(PurchCommLineRec.Comment, 1, MaxLen);
            IF i = 2 THEN
              varText2 := COPYSTR(PurchCommLineRec.Comment, 1, MaxLen);
          UNTIL PurchCommLineRec.NEXT = 0;
        END;
      END;

      IF iAction = 1 THEN BEGIN  //store
        PurchCommLineRec.SETRANGE("Document Type", "Document Type");
        PurchCommLineRec.SETRANGE("No.", "No.");
        PurchCommLineRec.SETRANGE("Document Line No.", 0);
        PurchCommLineRec.SETRANGE(Code, PurchCode);
        PurchCommLineRec.DELETEALL;
        PurchCommLineRec.SETRANGE(Code);
        IF PurchCommLineRec.FINDLAST THEN
          LastLine := PurchCommLineRec."Line No.";
        REPEAT
          i := i + 1;
          PurchCommLineRec.INIT;
          PurchCommLineRec."Document Type" := "Document Type";
          PurchCommLineRec."No." := "No.";
          PurchCommLineRec."Document Line No." := 0;
          PurchCommLineRec."Line No." := LastLine + i;
          PurchCommLineRec.Code := PurchCode;
          PurchCommLineRec.Date := TODAY;
          IF i = 1 THEN
            PurchCommLineRec.Comment := COPYSTR(varText1, 1, MaxLen);
          IF i = 2 THEN
            PurchCommLineRec.Comment := COPYSTR(varText2, 1, MaxLen);
          IF PurchCommLineRec.Comment <> '' THEN
            PurchCommLineRec.INSERT;
        UNTIL i = 2;
      END;
    END;

    PROCEDURE HandlePhoneICM@1100525011(iAction@1100525001 : Integer;VAR varText1@1100525004 : Text[250]);
    VAR
      PurchCommLineRec@1100525000 : Record 43;
      i@1100525003 : Integer;
      LastLine@1100525002 : Integer;
      PurchCode@1100525006 : Code[20];
      MaxLen@1100525007 : Integer;
    BEGIN
      //**4PS
      PurchCode := 'PHONE-ICM';
      MaxLen := 13;

      IF iAction = 0 THEN BEGIN  //read
        varText1 := '';
        PurchCommLineRec.SETRANGE("Document Type", "Document Type");
        PurchCommLineRec.SETRANGE("No.", "No.");
        PurchCommLineRec.SETRANGE("Document Line No.", 0);
        PurchCommLineRec.SETRANGE(Code, PurchCode);
        IF PurchCommLineRec.FINDSET THEN BEGIN
          REPEAT
            i := i + 1;
            IF i = 1 THEN
              varText1 := COPYSTR(PurchCommLineRec.Comment, 1, MaxLen);
          UNTIL PurchCommLineRec.NEXT = 0;
        END;
      END;

      IF iAction = 1 THEN BEGIN  //store
        PurchCommLineRec.SETRANGE("Document Type", "Document Type");
        PurchCommLineRec.SETRANGE("No.", "No.");
        PurchCommLineRec.SETRANGE("Document Line No.", 0);
        PurchCommLineRec.SETRANGE(Code, PurchCode);
        PurchCommLineRec.DELETEALL;
        PurchCommLineRec.SETRANGE(Code);
        IF PurchCommLineRec.FINDLAST THEN
          LastLine := PurchCommLineRec."Line No.";
        REPEAT
          i := i + 1;
          PurchCommLineRec.INIT;
          PurchCommLineRec."Document Type" := "Document Type";
          PurchCommLineRec."No." := "No.";
          PurchCommLineRec."Document Line No." := 0;
          PurchCommLineRec."Line No." := LastLine + i;
          PurchCommLineRec.Code := PurchCode;
          PurchCommLineRec.Date := TODAY;
          IF i = 1 THEN
            PurchCommLineRec.Comment := COPYSTR(varText1, 1, MaxLen);
          IF PurchCommLineRec.Comment <> '' THEN
            PurchCommLineRec.INSERT;
        UNTIL i = 2;
      END;
    END;

    PROCEDURE LookupRelatedOrder@1100525012();
    VAR
      lvPurchHeader@1100525000 : Record 38;
    BEGIN
      //**4PS
      lvPurchHeader.SETCURRENTKEY("Document Type", "Buy-from Vendor No.", "No.");
      lvPurchHeader.SETRANGE("Document Type", lvPurchHeader."Document Type"::Order);
      //setfilter is used in stead of setrange because when Vendor No. or Job No.is empty no filter must be set.
      lvPurchHeader.SETFILTER("Buy-from Vendor No.", "Buy-from Vendor No.");
      lvPurchHeader.SETFILTER("Job No.", "Job No.");
      lvPurchHeader.SETFILTER("Service Order No.", "Service Order No.");
      IF "Related Purch. Order No." = '' THEN
        lvPurchHeader.SETFILTER(Status, '%1|%2', lvPurchHeader.Status::Open, lvPurchHeader.Status::Released);
      lvPurchHeader."Document Type" := lvPurchHeader."Document Type"::Order;
      lvPurchHeader.SETRANGE("No.", "Related Purch. Order No.");
      IF lvPurchHeader.FINDFIRST THEN;
      lvPurchHeader.SETRANGE("No.");
      IF PAGE.RUNMODAL(PAGE::"Purchase List", lvPurchHeader) = ACTION::LookupOK THEN
        VALIDATE("Related Purch. Order No.", lvPurchHeader."No.");
    END;

    PROCEDURE GetReceiptsRelatedOrderAutomat@1100525010(PurchHeadRec@1100525001 : Record 38) : Boolean;
    VAR
      PurchLineRec@1100525000 : Record 39;
      lvText001@1100525002 : TextConst 'ENU=Get all Receipt Lines of %1 ''%2''?;NOR=Hente alle mottaksrader for %1 ''%2''?;SVE=Vill du h„mta alla inleveransrader f”r %1 ''%2''?';
      PurchOrder@1100525003 : Record 38;
      PurchasesPayablesSetup@1100528600 : Record 312;
    BEGIN
      //**4PS
      IF (PurchHeadRec."No." = '') OR (PurchHeadRec.Status <> PurchHeadRec.Status::Open) OR
         (NOT (PurchHeadRec."Document Type" IN
          [PurchHeadRec."Document Type"::Invoice, PurchHeadRec."Document Type"::"Credit Memo"])) OR
         (PurchHeadRec."Related Purch. Order No." = '') OR
         (NOT "Invoice Lines Input")
      THEN
        EXIT(FALSE);

      PurchLineRec.SETRANGE("Document Type", PurchHeadRec."Document Type");
      PurchLineRec.SETRANGE("Document No.", PurchHeadRec."No.");
      IF NOT PurchLineRec.ISEMPTY THEN  //* Only if no lines present yet.
        EXIT(FALSE);

      PurchOrder.GET(PurchOrder."Document Type"::Order, PurchHeadRec."Related Purch. Order No.");
      IF PurchOrder."Purchase Order Type" = PurchOrder."Purchase Order Type"::"Blanket Order" THEN
        EXIT(FALSE);

      PurchasesPayablesSetup.GET;
      IF PurchasesPayablesSetup."Allow Post Receipt during Reg." THEN
        IF NOT PurchOrder.ReceivedPurchLinesExist THEN
          IF CONFIRM(Text11012032, FALSE) THEN BEGIN
            COMMIT;
            ShowPurchaseLines(PurchOrder."No.");
          END;

      IF NOT CONFIRM(
        lvText001, FALSE, PurchHeadRec.FIELDCAPTION("Related Purch. Order No."), PurchHeadRec."Related Purch. Order No.")
      THEN
        EXIT(FALSE);

      PurchLineRec."Document Type" := PurchHeadRec."Document Type";
      PurchLineRec."Document No." := PurchHeadRec."No.";
      PurchLineRec."Item Type" := '<' + PurchHeadRec.FIELDNAME("Related Purch. Order No.") + '>'; // Use flowfield to pass indicator
      CODEUNIT.RUN(CODEUNIT::"Purch.-Get Receipt", PurchLineRec);
      EXIT(TRUE);
    END;

    PROCEDURE GetReceivedInvoicedAmounts@1210190000(VAR AmountOrdered@1210190006 : Decimal;VAR AmountOrderedInclVAT@1210190008 : Decimal;VAR AmountReceived@1100525002 : Decimal;VAR AmountInvoiced@1100525003 : Decimal;VAR AmountRecNotInvoiced@1100525005 : Decimal;VAR AmountToInvoice@1100525004 : Decimal;VAR AmountLCY@1100527650 : Decimal;Select@1210190002 : 'All,Project,ServiceOrder';ProjectNo@1210190003 : Code[20];ServiceOrderNo@1210190004 : Code[20]);
    VAR
      PurchLine@1210190007 : Record 39;
      PurchCredMemoHeader@1100525000 : Record 124;
      PurchCredMemoLine@1100525001 : Record 125;
      PurchInvLine@1210190000 : Record 123;
      PurchOrderControlLine@1100409000 : Record 11020221;
      CorrespondingInvLineFound@1210190001 : Boolean;
      CorrAmtInvDiff@1100409001 : Decimal;
      PurchOrderControlLineAmtRcdNotInvoiced@1100528400 : Decimal;
    BEGIN
      //**4PS
      AmountOrdered := 0;
      AmountOrderedInclVAT := 0;
      AmountReceived := 0;
      AmountInvoiced := 0;
      AmountRecNotInvoiced := 0;
      AmountToInvoice := 0;
      AmountLCY := 0;

      IF "Document Type" <> "Document Type"::Order THEN
        EXIT;
      IF "No." = '' THEN
        EXIT;

      PurchLine.SETRANGE("Document Type", "Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      CASE Select OF
        Select::All:
          BEGIN
            PurchLine.CALCSUMS(Amount, "Amount Including VAT", "Amnt. Received", "Amnt. Invoiced", "Amount (LCY)");
            AmountOrdered := PurchLine.Amount;
            AmountOrderedInclVAT := PurchLine."Amount Including VAT";
            AmountReceived := PurchLine."Amnt. Received";
            AmountInvoiced := PurchLine."Amnt. Invoiced";
            AmountLCY := PurchLine."Amount (LCY)";
          END;
        Select::Project,Select::ServiceOrder:
          BEGIN
            IF Select = Select::Project THEN
              PurchLine.SETRANGE("Job No.", ProjectNo)
            ELSE
              PurchLine.SETRANGE("Service Order No.", ServiceOrderNo);
            IF PurchLine.FINDSET THEN
              REPEAT
                AmountOrdered := AmountOrdered + PurchLine.Amount;
                AmountOrderedInclVAT := AmountOrderedInclVAT + PurchLine."Amount Including VAT";
                AmountReceived := AmountReceived + PurchLine."Amnt. Received";
                AmountInvoiced := AmountInvoiced + PurchLine."Amnt. Invoiced";
                AmountLCY += PurchLine."Amount (LCY)";
              UNTIL PurchLine.NEXT = 0;
          END;
      END;

      //Subtract credit (document copy of invoice)
      PurchCredMemoHeader.SETCURRENTKEY("Related Purch. Order No.");
      PurchCredMemoHeader.SETRANGE("Related Purch. Order No.", "No.");
      IF PurchCredMemoHeader.FINDSET THEN
        REPEAT
          PurchCredMemoLine.SETRANGE("Document No.", PurchCredMemoHeader."No.");
          PurchCredMemoLine.SETFILTER(Type, '<>%1', PurchCredMemoLine.Type::" ");
          PurchCredMemoLine.SETFILTER("Receipt No.", '<>%1', '');
          CASE Select OF
            Select::Project:
              PurchCredMemoLine.SETRANGE("Job No.", ProjectNo);
            Select::ServiceOrder:
              PurchCredMemoLine.SETRANGE("Service Order No.", ServiceOrderNo);
          END;
          PurchCredMemoLine.SETRANGE("Approval Entry", TRUE);
          IF PurchCredMemoLine.ISEMPTY THEN BEGIN  //Do not count if there are approval lines with ReceiptNo filled
            PurchCredMemoLine.SETRANGE("Approval Entry");
            PurchCredMemoLine.SETFILTER("Receipt No.", '%1', '');
            IF PurchCredMemoLine.FINDSET THEN
              REPEAT
                CorrespondingInvLineFound := FALSE;
                IF PurchCredMemoHeader."Applies-to Doc. Type" = PurchCredMemoHeader."Applies-to Doc. Type"::Invoice THEN BEGIN
                  PurchInvLine.SETRANGE("Document No.", PurchCredMemoHeader."Applies-to Doc. No.");
                  PurchInvLine.SETRANGE(Type, PurchCredMemoLine.Type);
                  PurchInvLine.SETRANGE("No.", PurchCredMemoLine."No.");
                  CASE Select OF
                    Select::Project:
                      PurchInvLine.SETRANGE("Job No.", PurchCredMemoLine."Job No.");
                    Select::ServiceOrder:
                      PurchInvLine.SETRANGE("Service Order No.", PurchCredMemoLine."Service Order No.");
                  END;
                  PurchInvLine.SETRANGE("Shortcut Dimension 2 Code", PurchCredMemoLine."Shortcut Dimension 2 Code");
                  PurchInvLine.SETRANGE("Direct Unit Cost", PurchCredMemoLine."Direct Unit Cost");
                  CorrespondingInvLineFound := NOT PurchInvLine.ISEMPTY;
                END;
                IF CorrespondingInvLineFound THEN
                  AmountInvoiced := AmountInvoiced - PurchCredMemoLine.Amount;
              UNTIL PurchCredMemoLine.NEXT = 0;
          END;
        UNTIL PurchCredMemoHeader.NEXT = 0;

      PurchOrderControlLine.SETRANGE("Order No.", "No.");
      CASE Select OF
        Select::Project:
          PurchOrderControlLine.SETRANGE("Project No.", ProjectNo);
        Select::ServiceOrder:
          PurchOrderControlLine.SETRANGE("Service Order No.", ServiceOrderNo);
      END;
      IF PurchOrderControlLine.FINDSET THEN BEGIN
        REPEAT
          PurchOrderControlLineAmtRcdNotInvoiced := GetAmtRcdNotInvoicedFromPurchOrderControlLine(PurchOrderControlLine);
          AmountRecNotInvoiced := AmountRecNotInvoiced + PurchOrderControlLineAmtRcdNotInvoiced;
          IF PurchOrderControlLine."Line Type" = PurchOrderControlLine."Line Type"::Correction THEN
            CorrAmtInvDiff := CorrAmtInvDiff + PurchOrderControlLineAmtRcdNotInvoiced;
        UNTIL PurchOrderControlLine.NEXT = 0;
      END;
      IF Status < Status::Closed THEN
        AmountToInvoice := AmountOrdered - AmountInvoiced + CorrAmtInvDiff;
    END;

    LOCAL PROCEDURE GetAmtRcdNotInvoicedFromPurchOrderControlLine@1100528421(PurchaseOrderControlLine@1100528400 : Record 11020221) AmtRcdNotInvoiced : Decimal;
    VAR
      PurchaseHeader@1100528401 : Record 38;
      Currency@1100528403 : Record 4;
    BEGIN
      //**4PS
      AmtRcdNotInvoiced := PurchaseOrderControlLine."Amt. Rcd. Not Invoiced";
      IF NOT PurchaseHeader.GET(PurchaseHeader."Document Type"::Order, PurchaseOrderControlLine."Order No.") THEN
        EXIT;
      IF PurchaseHeader."Currency Code" = '' THEN
        EXIT;
      IF NOT Currency.GET(PurchaseHeader."Currency Code") THEN
        Currency.InitRoundingPrecision;
      AmtRcdNotInvoiced := ROUND(
        PurchaseOrderControlLine."Amt. Rcd. Not Invoiced" * PurchaseHeader."Currency Factor",
        Currency."Amount Rounding Precision");
    END;

    PROCEDURE CreateDocPhases@1100525016();
    VAR
      PurchPlanMgt@1100525001 : Codeunit 11012242;
    BEGIN
      //**4PS
      PurchPlanMgt.CreateDocPhases(Rec);
    END;

    PROCEDURE FinishPhase@1100525013(CurrField@1100525001 : Integer);
    VAR
      PurchPlanMgt@1100525000 : Codeunit 11012242;
    BEGIN
      //**4PS
      PurchPlanMgt.FinishPhaseCheck(Rec, CurrField);
    END;

    PROCEDURE FinishManualPhase@1100525018();
    BEGIN
      //**4PS
      IF NOT CONFIRM(Text11012024, TRUE) THEN
        EXIT;

      FinishPhase(-1);
    END;

    PROCEDURE OnePhaseBack@1210190011();
    VAR
      PurchPlanMgt@1210190000 : Codeunit 11012242;
    BEGIN
      //**4PS
      IF NOT CONFIRM(Text11012027, FALSE) THEN
        EXIT;

      PurchPlanMgt.OnePhaseBack(Rec);
    END;

    PROCEDURE BackToFirstPhase@1100525033();
    VAR
      PurchPlanMgt@1210190000 : Codeunit 11012242;
      DocumentPhase@1100525000 : Record 11020418;
    BEGIN
      //**4PS
      IF NOT CONFIRM(Text11012037, FALSE) THEN
        EXIT;
      DocumentPhase.SETRANGE("Document Type", "Document Type");
      DocumentPhase.SETRANGE("Document No.", "No.");
      DocumentPhase.SETRANGE("Purchase Plan", "Purchase Plan");
      DocumentPhase.SETFILTER(Status, '%1..', DocumentPhase.Status::Finished);
      WHILE NOT DocumentPhase.ISEMPTY DO
        PurchPlanMgt.OnePhaseBack(Rec);
    END;

    PROCEDURE DPA_SetDefaultDpmtFromNoSeries@1100000995(xRecRef@1100525002 : RecordRef);
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      xRecRef.SETTABLE(xRec);
      DPA_Management.SetDepartmentCodeNoSeries(
        TABLENAME,
        "Shortcut Dimension 1 Code",
        "No. Series",
        xRec."No. Series" );
    END;

    LOCAL PROCEDURE DPA_OnInsert@1100000991();
    VAR
      Dimension1Code@1100528400 : Code[20];
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      Dimension1Code :=
        DPA_Management.GetNoSeriesDepartmentCode(
          "No. Series",
          xRec."No. Series",
          DATABASE::"Purchase Header");
      IF Dimension1Code <> '' THEN
        "Shortcut Dimension 1 Code" := Dimension1Code;

      IF "Shortcut Dimension 1 Code" <> '' THEN BEGIN
        SkipModify := TRUE;
        VALIDATE("Shortcut Dimension 1 Code");
        SkipModify := FALSE;
      END;
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(38) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 38');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Purchase Header", "Shortcut Dimension 1 Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Shortcut Dimension 1 Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Shortcut Dimension 1 Code");
    END;

    PROCEDURE GetDefaultPurchasePlan@1100525017();
    BEGIN
      //**4PS
      PurchSetup.GET;
      CASE "Document Type" OF
        "Document Type"::Quote:
          VALIDATE("Purchase Plan", PurchSetup."Default Purchase Plan Quote");
        "Document Type"::Order:
          CASE "Purchase Order Type" OF
            "Purchase Order Type"::"Purchase Order":
              IF "Hours Hire Order Type" = "Hours Hire Order Type"::Employee THEN BEGIN
                VALIDATE("Purchase Plan", PurchSetup."Default Purchase Plan Hour Acc");
              END ELSE BEGIN
                IF "ICM Status" = "ICM Status"::Manual THEN
                  VALIDATE("Purchase Plan", PurchSetup."Default Purchase Plan Order")
                ELSE
                  VALIDATE("Purchase Plan", PurchSetup."Default Purchase Plan ICM Ord.");
              END;
            "Purchase Order Type"::"Blanket Order":
              VALIDATE("Purchase Plan", PurchSetup."Default Purchase Plan Blanket");
            "Purchase Order Type"::"Return Order":
              VALIDATE("Purchase Plan", PurchSetup."Default Purchase Plan Return");
          END;
      END;
    END;

    LOCAL PROCEDURE DetermineContractApplicable@1100525019(Vendor@1100525000 : Record 23) : Boolean;
    BEGIN
      //**4PS
      PurchSetup.GET;
      EXIT(
        PurchSetup."On Hold No Contract" AND
        Vendor."On Hold No Contract" AND
        ("Document Type" = "Document Type"::Order));
    END;

    PROCEDURE LetterOfCreditIsApplicable@1100525020() : Boolean;
    VAR
      PurchaseLine@1100525000 : Record 39;
    BEGIN
      //**4PS
      IF "Document Type" <> "Document Type"::Order THEN
        EXIT;

      PurchSetup.GET;
      IF (NOT PurchSetup."On Hold No Letter of Credit") OR
         (PurchSetup."Min. Amt. Letter of Credit" = 0)
      THEN
        EXIT;

      PurchaseLine.SETRANGE("Document Type", "Document Type"::Order);
      PurchaseLine.SETRANGE("Document No.", "No.");
      IF NOT PurchaseLine.FINDFIRST THEN
        EXIT;

      PurchaseLine.CALCFIELDS("Balance Excl. VAT");
      EXIT(PurchaseLine."Balance Excl. VAT" >= PurchSetup."Min. Amt. Letter of Credit");
    END;

    PROCEDURE DetermineOnHoldCode@1100525021() : Code[3];
    VAR
      CommonPurchInvFunctions@1100528400 : Codeunit 11229296;
      RelatedPurchOrderNoCausingOnHold@1100528401 : Code[20];
    BEGIN
      //**4PS
      IF ("Document Type" = "Document Type"::Order) AND Receive AND Invoice THEN BEGIN
        EXIT(DetermineOnHoldCodeForInvoice("On Hold"));
      END;

      IF "Document Type" <> "Document Type"::Invoice THEN
        EXIT("On Hold");

      EXIT(CommonPurchInvFunctions.DetermineOnHoldCodeBasedOnOrdersRelatedToInvoice(
        Rec, TRUE, RelatedPurchOrderNoCausingOnHold));
    END;

    PROCEDURE DetermineOnHoldCodeForInvoice@1100525022(CurrentOnHoldCode@1100525000 : Code[3]) : Code[3];
    VAR
      CommonPurchInvFunctions@1100528400 : Codeunit 11229296;
      OnHoldCodeDefault@1100528401 : Code[3];
    BEGIN
      //**4PS
      IF CommonPurchInvFunctions.CurrentOnHoldCodeMustBeKept(CurrentOnHoldCode) THEN
        EXIT(CurrentOnHoldCode);

      OnHoldCodeDefault := DetermineOnHoldCodeDefault;
      IF OnHoldCodeDefault <> '' THEN
        EXIT(OnHoldCodeDefault);

      EXIT(CurrentOnHoldCode);
    END;

    PROCEDURE DetermineOnHoldCodeDefault@1100528800() : Code[3];
    VAR
      OnHoldCodeNoContract@1100528400 : Code[3];
      OnHoldCodeNoLetterOfCr@1100528401 : Code[3];
    BEGIN
      //**4PS
      OnHoldCodeNoContract := DetermineOnHoldNoContract;
      IF OnHoldCodeNoContract <> '' THEN
        EXIT(OnHoldCodeNoContract);

      OnHoldCodeNoLetterOfCr := DetermineOnHoldNoLetterOfCr;
      IF OnHoldCodeNoLetterOfCr <> '' THEN
        EXIT(OnHoldCodeNoLetterOfCr);

      EXIT('');
    END;

    PROCEDURE DetermineOnHoldNoContract@1100528402() : Code[3];
    BEGIN
      //**4PS
      PurchSetup.GET;

      IF PurchSetup."On Hold No Contract" AND
         "Contract Applicable" AND
         ("Return Date Signed Contract" = 0D)
      THEN BEGIN
        PurchSetup.TESTFIELD("On Hold Code No Contract");
        EXIT(PurchSetup."On Hold Code No Contract");
      END;
    END;

    PROCEDURE DetermineOnHoldNoLetterOfCr@1100528403() : Code[3];
    BEGIN
      //**4PS
      PurchSetup.GET;

      IF LetterOfCreditIsApplicable AND
         ("Return Date Letter of Credit" = 0D)
      THEN BEGIN
        PurchSetup.TESTFIELD("On Hold Code No Letter of Cr.");
        EXIT(PurchSetup."On Hold Code No Letter of Cr.");
      END;
    END;

    PROCEDURE ChangeProjectInWarrantyData@1210190002();
    VAR
      WarrantyDataPurchaseOrder@1210190000 : Record 11020665;
    BEGIN
      //**4PS
      WarrantyDataPurchaseOrder.SETRANGE("Document Type","Document Type");
      WarrantyDataPurchaseOrder.SETRANGE("Document No.","No.");

      IF WarrantyDataPurchaseOrder.FINDSET(TRUE) THEN
        REPEAT
          IF WarrantyDataPurchaseOrder."Job No." <> "Job No." THEN BEGIN
            WarrantyDataPurchaseOrder."Job No." := "Job No.";
            WarrantyDataPurchaseOrder.MODIFY(TRUE);
          END;
        UNTIL WarrantyDataPurchaseOrder.NEXT = 0;
    END;

    PROCEDURE GetAddressFromSalesOrder@1210190005(SalesHeader@1210190000 : Record 36);
    BEGIN
      //**4PS
      "Ship-to Project" := '';
      Deliver := Deliver::"Custom Address";
      "Ship-to Location" := '';
      "Ship-to Code" := SalesHeader."Ship-to Code";
      "Ship-to Name" := SalesHeader."Ship-to Name";
      "Ship-to Name 2" := SalesHeader."Ship-to Name 2";
      "Ship-to Address" := SalesHeader."Ship-to Address";
      "Ship-to Address 2" := SalesHeader."Ship-to Address 2";
      "Ship-to City" := SalesHeader."Ship-to City";
      "Ship-to Post Code" := SalesHeader."Ship-to Post Code";
      "Ship-to County" := SalesHeader."Ship-to County";
      "Ship-to Country/Region Code" := SalesHeader."Ship-to Country/Region Code";
      "Ship-to Contact" := SalesHeader."Ship-to Contact";
    END;

    PROCEDURE SendOrderElectronic@1210190009(SelectSendOption@1100528701 : Boolean);
    VAR
      PurchaseHeader@1210190002 : Record 38;
      Vendor@1210190001 : Record 23;
      SelectSendOptionPurchOrder@1210190004 : Page 11125021;
      CreateICMFiles@1210190000 : Report 11012308;
      CreateICKFiles@1100528700 : Report 11012323;
      SendPurchOrderGS1@1210190003 : Report 11012480;
      GS1Interface@1100525000 : Codeunit 11012480;
      DocumentPrint@1100528404 : Codeunit 229;
      ChangeStatus@1100528403 : 'None,Released,Closed';
      DirectPostOrder@1100528402 : 'According to Vendor,Not';
      IsQuote@1100528400 : Boolean;
      ElectronicOrderType@1100528401 : Integer;
    BEGIN
      //**4PS
      PurchaseHeader.COPY(Rec);
      PurchaseHeader.SETRECFILTER;
      IsQuote := (PurchaseHeader."Document Type" = PurchaseHeader."Document Type"::Quote);

      IF NOT SelectSendOption AND
         IsQuote AND
         (PurchaseHeader."Buy-from Vendor No." = '')
      THEN
        // When Buy-from Vendor No. = '' purchase quotes cannot be sent by ICM/ICF or GS1, therefore
        // E-mail is the only possibility.
        // If no E-Mail address can be found, an error message will be given by report Purchase - E-Mail Quote.
        ElectronicOrderType := Vendor."Electronic Order Type"::"E-mail"
      ELSE BEGIN
        Vendor.GET(PurchaseHeader."Buy-from Vendor No.");
        ElectronicOrderType := Vendor."Electronic Order Type";

        IF (NOT Vendor.PurchaseOrdersAreSentByEMail AND
           (Vendor."Electronic Order Type" <> Vendor."Electronic Order Type"::"ICM/ICF") AND
           (Vendor."Electronic Order Type" <> Vendor."Electronic Order Type"::"GS1 (SOAP)") AND
           (Vendor."Electronic Order Type" <> Vendor."Electronic Order Type"::"GS1 (XML-RPC)") AND
           (Vendor."Electronic Order Type" <> Vendor."Electronic Order Type"::"GS1 INSBOU"))
        THEN BEGIN
          IF GUIALLOWED THEN MESSAGE(Text11012026,
            Vendor.TABLECAPTION, Vendor.FIELDCAPTION("Electronic Order Type"),
            Vendor."Electronic Order Type");
          ERROR('');
        END;
      END;

      IF SelectSendOption THEN BEGIN
        IF NOT IsQuote THEN BEGIN
          SelectSendOptionPurchOrder.SetSelectICM(ElectronicOrderType = Vendor."Electronic Order Type"::"ICM/ICF");
          SelectSendOptionPurchOrder.SetSelectEmail(OrderIsSentByEMail(ElectronicOrderType));
        END ELSE BEGIN
          SelectSendOptionPurchOrder.SetSelectICK(ElectronicOrderType = Vendor."Electronic Order Type"::"ICM/ICF");
          SelectSendOptionPurchOrder.SetSelectEmail(OrderIsSentByEMail(ElectronicOrderType));
        END;
        SelectSendOptionPurchOrder.SetSelectGS1SOAP(ElectronicOrderType = Vendor."Electronic Order Type"::"GS1 (SOAP)");
        SelectSendOptionPurchOrder.SetSelectGS1XMLRPC(ElectronicOrderType = Vendor."Electronic Order Type"::"GS1 (XML-RPC)");
        SelectSendOptionPurchOrder.SetSelectGS1INSBOU(ElectronicOrderType = Vendor."Electronic Order Type"::"GS1 INSBOU");

        IF (SelectSendOptionPurchOrder.RUNMODAL <> ACTION::LookupOK) THEN
          EXIT;
      END;

      IF ((NOT SelectSendOption) AND OrderIsSentByEMail(ElectronicOrderType)) OR
         (SelectSendOptionPurchOrder.GetSelectEmail)
      THEN BEGIN
        IF IsQuote THEN
          DocumentPrint.EmailPurchHeader(
            PurchaseHeader, FALSE, ChangeStatus::None, DirectPostOrder::"Not", FALSE, FALSE)
        ELSE
          REPORT.RUNMODAL(REPORT::"Purchase - E-Mail Order", TRUE, FALSE, PurchaseHeader);
      END;

      IF ((NOT SelectSendOption) AND (NOT IsQuote) AND (ElectronicOrderType = Vendor."Electronic Order Type"::"ICM/ICF")) OR
         (SelectSendOptionPurchOrder.GetSelectICM)
      THEN BEGIN
        PurchaseHeader.CALCFIELDS("ICM Login Code");  //C062889
        IF PurchaseHeader."ICM Login Code" = '' THEN
          IF GUIALLOWED THEN ERROR(Text11012025);

        CreateICMFiles.SetSendToVendor(TRUE);
        PurchaseHeader.SETRANGE("Buy-from Vendor No.", PurchaseHeader."Buy-from Vendor No.");
        PurchaseHeader.SETRANGE("ICM Status", PurchaseHeader."ICM Status"::Create);
        CreateICMFiles.SETTABLEVIEW(PurchaseHeader);
        CreateICMFiles.RUNMODAL;
      END;

      IF ((NOT SelectSendOption) AND (IsQuote) AND (ElectronicOrderType = Vendor."Electronic Order Type"::"ICM/ICF")) OR
         (SelectSendOptionPurchOrder.GetSelectICK)
      THEN BEGIN
        PurchaseHeader.CALCFIELDS("ICM Login Code");  //C062889
        IF PurchaseHeader."ICM Login Code" = '' THEN
          IF GUIALLOWED THEN ERROR(Text11012025);

        PurchaseHeader.SETRANGE("Buy-from Vendor No.", PurchaseHeader."Buy-from Vendor No.");
        PurchaseHeader.SETRANGE("ICM Status", PurchaseHeader."ICM Status"::Create);
        CreateICKFiles.SETTABLEVIEW(PurchaseHeader);
        CreateICKFiles.RUNMODAL;
      END;

      IF ((NOT SelectSendOption) AND (ElectronicOrderType = Vendor."Electronic Order Type"::"GS1 (SOAP)")) OR
         (SelectSendOptionPurchOrder.GetSelectGS1SOAP)
      THEN BEGIN
        SendPurchOrderGS1.SetIsSOAP;
        SendPurchOrderGS1.SETTABLEVIEW(PurchaseHeader);
        SendPurchOrderGS1.RUNMODAL;
      END;

      IF ((NOT SelectSendOption) AND (ElectronicOrderType = Vendor."Electronic Order Type"::"GS1 (XML-RPC)")) OR
         (SelectSendOptionPurchOrder.GetSelectGS1XMLRPC)
      THEN BEGIN
        SendPurchOrderGS1.SetIsRPC;
        SendPurchOrderGS1.SETTABLEVIEW(PurchaseHeader);
        SendPurchOrderGS1.RUNMODAL;
      END;

      IF ((NOT SelectSendOption) AND (ElectronicOrderType = Vendor."Electronic Order Type"::"GS1 INSBOU")) OR
         (SelectSendOptionPurchOrder.GetSelectGS1INSBOU)
      THEN BEGIN
        IF (PurchaseHeader.COUNT <> 1) THEN
          ERROR(Text11012036, PurchaseHeader.TABLECAPTION);
        GS1Interface.SendPuchaseOder(PurchaseHeader."Document Type", PurchaseHeader."No.");
      END;
    END;

    LOCAL PROCEDURE OrderIsSentByEMail@1100528411(ElectronicOrderType@1100528400 : Integer) : Boolean;
    VAR
      Vendor@1100528401 : Record 23;
    BEGIN
      //**4PS
      EXIT(
        (ElectronicOrderType = Vendor."Electronic Order Type"::"E-mail") OR
        (ElectronicOrderType = Vendor."Electronic Order Type"::"E-Mail Contact Person"));
    END;

    PROCEDURE HasDocumentLinks@1100528400() : Boolean;
    VAR
      DocumentLinkMgt@1100525000 : Codeunit 11012401;
      RecRef@1100525001 : RecordRef;
    BEGIN
      RecRef.GETTABLE(Rec);
      EXIT(DocumentLinkMgt.EntityHasDocumentLinks(RecRef));
    END;

    PROCEDURE CheckIfGS1ErrorLogsExist@1100528300() : Boolean;
    VAR
      GS1ErrorLog@1210190000 : Record 11072078;
    BEGIN
      //**4PS
      GS1ErrorLog.SETCURRENTKEY("Document Type", "Document No.", "Line No.");
      GS1ErrorLog.SETRANGE("Document Type", "Document Type");
      GS1ErrorLog.SETRANGE("Document No.", "No.");
      EXIT(NOT GS1ErrorLog.ISEMPTY);
    END;

    LOCAL PROCEDURE UpdateOnHoldOfRelatedInvoices@1100528401();
    VAR
      lPurchInvHeader@1100528400 : Record 122;
      CommonPurchInvFunctions@1100528401 : Codeunit 11229296;
      NewOnHoldCode@1100528402 : Code[3];
    BEGIN
      //**4PS
      PurchSetup.GET;
      MarkRelatedInvoices(lPurchInvHeader);
      lPurchInvHeader.MARKEDONLY(TRUE);
      IF lPurchInvHeader.FINDSET THEN BEGIN
        REPEAT
          IF NOT ((lPurchInvHeader."On Hold" <> PurchSetup."On Hold Code No Contract") AND
                  (lPurchInvHeader."On Hold" <> PurchSetup."On Hold Code No Letter of Cr.") AND
                  (lPurchInvHeader."On Hold" <> ''))
          THEN BEGIN
            NewOnHoldCode := CommonPurchInvFunctions.DetermineOnHoldCodeOfInvoiceRelatedToCurrentOrder(
              lPurchInvHeader, Rec);
            IF NewOnHoldCode <> lPurchInvHeader."On Hold" THEN
              lPurchInvHeader.UpdateOnHoldOfPurchaseInvoice(lPurchInvHeader."No.", NewOnHoldCode, TRUE);
          END;
        UNTIL lPurchInvHeader.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE MarkRelatedInvoices@1100528414(VAR PurchInvHeader@1100528400 : Record 122);
    VAR
      PurchRcptLine@1100528401 : Record 121;
      PurchInvLine@1100528402 : Record 123;
    BEGIN
      //**4PS
      PurchInvHeader.SETCURRENTKEY("Related Purch. Order No.");
      PurchInvHeader.SETRANGE("Related Purch. Order No.", "No.");
      IF PurchInvHeader.FINDSET THEN
        REPEAT
          PurchInvHeader.MARK(TRUE);
        UNTIL PurchInvHeader.NEXT = 0;
      PurchInvHeader.SETRANGE("Related Purch. Order No.");

      PurchRcptLine.SETCURRENTKEY("Order No.");
      PurchRcptLine.SETRANGE("Order No.", "No.");
      IF PurchRcptLine.FINDSET THEN
        REPEAT
          PurchInvLine.SETCURRENTKEY("Receipt No.");
          PurchInvLine.SETRANGE("Receipt No.", PurchRcptLine."Document No.");
          PurchInvLine.SETRANGE("Receipt Line No.", PurchRcptLine."Line No.");
          IF PurchInvLine.FINDSET THEN
            REPEAT
              IF PurchInvHeader.GET(PurchInvLine."Document No.") THEN
                PurchInvHeader.MARK(TRUE);
            UNTIL PurchInvLine.NEXT = 0;
        UNTIL PurchRcptLine.NEXT = 0;
    END;

    PROCEDURE EditDocuments@1100528702(DocumentType@1100528702 : Option;DocumentTemplateTypeFilter@1210190003 : Text[250];ContactNo@1210190004 : Code[20];ContactPersonNo@1210190005 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120];EnableSignhost@1100528400 : Boolean);
    VAR
      PurchaseLine@1100528701 : Record 39;
      Job@1100528704 : Record 11072003;
      ServiceOrder@1100528706 : Record 11012823;
      ResponsibilityCenter@1100528705 : Record 5714;
      ProjectNo@1100528703 : Code[20];
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      //**4PS
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      ProjectNo := "Job No.";
      IF ProjectNo = '' THEN BEGIN
        PurchaseLine.SETRANGE("Document Type", DocumentType);
        PurchaseLine.SETRANGE("Document No.", "No.");
        IF PurchaseLine.FINDSET THEN
          REPEAT
            ProjectNo := PurchaseLine."Job No.";
          UNTIL (PurchaseLine.NEXT = 0) OR (ProjectNo <> '');
      END;

      IF ProjectNo <> '' THEN BEGIN
        Job.GET(ProjectNo);
        RecRef.GETTABLE(Job);
        DocumentLinkRIDs[2] := RecRef.RECORDID;
      END ELSE BEGIN
        IF "Service Order No." <> '' THEN BEGIN
          ServiceOrder.GET("Service Order No.");
          RecRef.GETTABLE(ServiceOrder);
          DocumentLinkRIDs[2] := RecRef.RECORDID;
        END;
      END;

      IF ResponsibilityCenter.GET("Responsibility Center") THEN BEGIN
        RecRef.GETTABLE(ResponsibilityCenter);
        DocumentLinkRIDs[3] := RecRef.RECORDID;
      END;

      IF EnableSignhost THEN
        DocumentMailing.EditDocumentsSignHost(
          DocumentTemplateTypeFilter, DocumentLinkRIDs,
          "Shortcut Dimension 1 Code", ContactNo, ContactPersonNo)
      ELSE
        DocumentMailing.EditDocuments(
          DocumentTemplateTypeFilter, DocumentLinkRIDs,
          "Shortcut Dimension 1 Code", ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE HandleSelectedBankAccount@1100409000(VAR PurchaseHeader@1100409002 : Record 38;BankAccountNo@1100409000 : Text[30]);
    VAR
      VendorBankAccount@1100409001 : Record 288;
      Vendor@1100409004 : Record 23;
      TempVendor@1100409003 : TEMPORARY Record 23;
      LookForIBAN@1100529100 : Boolean;
      ValidateVendor@1100529101 : Boolean;
    BEGIN
      //**4PS
      IF BankAccountNo = '' THEN
        EXIT;
      VendorBankAccount.SETCURRENTKEY("Bank Account No.");
      VendorBankAccount.SETRANGE("Bank Account No.", BankAccountNo);
      IF VendorBankAccount.ISEMPTY THEN BEGIN
        LookForIBAN := TRUE;
        VendorBankAccount.SETCURRENTKEY(IBAN);
        VendorBankAccount.SETRANGE(IBAN, BankAccountNo);
        VendorBankAccount.SETRANGE("Bank Account No.");
      END;
      VendorBankAccount.FINDSET;
      REPEAT
        IF Vendor.GET(VendorBankAccount."Vendor No.") THEN BEGIN
          IF Vendor."Pay-to Vendor No." = '' THEN BEGIN
            TempVendor := Vendor;
            IF TempVendor.INSERT THEN;
          END;
          Vendor.RESET;
          Vendor.SETRANGE("Pay-to Vendor No.", VendorBankAccount."Vendor No.");
          IF Vendor.FINDSET THEN
            REPEAT
              TempVendor := Vendor;
              IF TempVendor.INSERT THEN;
            UNTIL Vendor.NEXT = 0;
        END;
      UNTIL VendorBankAccount.NEXT = 0;

      CASE TempVendor.COUNT OF
        0: MESSAGE(Text11012031, BankAccountNo);
        1: ValidateVendor := TRUE;
        ELSE
          IF TempVendor.COUNT > 1 THEN BEGIN
            MESSAGE(STRSUBSTNO(Text11012028, BankAccountNo));
            ValidateVendor := PAGE.RUNMODAL(0,TempVendor) = ACTION::LookupOK;
          END;
      END;

      IF ValidateVendor THEN BEGIN
        PurchaseHeader.VALIDATE("Buy-from Vendor No.", TempVendor."No.");

        IF (TempVendor."Pay-to Vendor No." <> '') AND (TempVendor."Pay-to Vendor No." <> TempVendor."No.") THEN
          VendorBankAccount.SETRANGE("Vendor No.", TempVendor."Pay-to Vendor No.")
        ELSE
          VendorBankAccount.SETRANGE("Vendor No.", TempVendor."No.");

        IF LookForIBAN THEN
          VendorBankAccount.SETRANGE(IBAN, BankAccountNo)
        ELSE
          VendorBankAccount.SETRANGE("Bank Account No.", BankAccountNo);

        IF VendorBankAccount.FINDFIRST THEN;

      END;
    END;

    PROCEDURE DirectPosting@1100528600();
    VAR
      lvPurchHeaderRec@1100485000 : Record 38;
      lvVendorRec@1100485001 : Record 23;
      lvPurchPostCU@1100485003 : Codeunit 90;
    BEGIN
      //**4PS
      lvPurchHeaderRec.COPY(Rec);
      IF lvPurchHeaderRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvPurchHeaderRec.Status <> lvPurchHeaderRec.Status::Closed THEN BEGIN
            IF lvVendorRec.GET(lvPurchHeaderRec."Buy-from Vendor No.") THEN BEGIN
              IF lvVendorRec."Direct Post Order ICM" THEN BEGIN
                lvPurchHeaderRec.Receive := TRUE;
                CLEAR(lvPurchPostCU);
                lvPurchPostCU.SetNoErrorNothingToPost(TRUE);
                lvPurchPostCU.RUN(lvPurchHeaderRec);
              END;
            END;
          END;
        UNTIL lvPurchHeaderRec.NEXT = 0;
      END;
    END;

    PROCEDURE ShowPurchOrderDetails@1100409001();
    VAR
      PurchaseLineDetail@1100409000 : Record 11020660;
    BEGIN
      //**4PS
      CASE "Document Type" OF
        "Document Type"::Invoice,
        "Document Type"::"Credit Memo":
          PurchaseLineDetail.ShowList(PurchaseLineDetail."Line Type"::"Purchase Order", "Related Purch. Order No.");
      END;
    END;

    PROCEDURE CreateExtDocument@1100409002(DocumentType@1100409002 : Option;DocumentTypeCode@1100409001 : Code[20];ContactNo@1210190004 : Code[20];ContactPersonNo@1210190005 : Code[20];DocGroup@1100409003 : Code[20]) DocumentNo : Code[20];
    VAR
      PurchaseLine@1100528701 : Record 39;
      Job@1100528704 : Record 11072003;
      ServiceOrder@1100528706 : Record 11012823;
      ResponsibilityCenter@1100528705 : Record 5714;
      ProjectNo@1100528703 : Code[20];
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      //**4PS
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      ProjectNo := "Job No.";
      IF ProjectNo = '' THEN BEGIN
        PurchaseLine.SETRANGE("Document Type", DocumentType);
        PurchaseLine.SETRANGE("Document No.", "No.");
        IF PurchaseLine.FINDSET THEN
          REPEAT
            ProjectNo := PurchaseLine."Job No.";
          UNTIL (PurchaseLine.NEXT = 0) OR (ProjectNo <> '');
      END;

      IF ProjectNo <> '' THEN BEGIN
        Job.GET(ProjectNo);
        RecRef.GETTABLE(Job);
        DocumentLinkRIDs[2] := RecRef.RECORDID;
      END ELSE BEGIN
        IF "Service Order No." <> '' THEN BEGIN
          ServiceOrder.GET("Service Order No.");
          RecRef.GETTABLE(ServiceOrder);
          DocumentLinkRIDs[2] := RecRef.RECORDID;
        END;
      END;

      IF ResponsibilityCenter.GET("Responsibility Center") THEN BEGIN
        RecRef.GETTABLE(ResponsibilityCenter);
        DocumentLinkRIDs[3] := RecRef.RECORDID;
      END;

      IF FORMAT(DocumentLinkRIDs[1]) = '' THEN
        ERROR('');
    END;

    PROCEDURE FillReferenceICM@1210190017() : Text[35];
    VAR
      ServiceOrder@1100525000 : Record 11012823;
    BEGIN
      //**4PS
      IF "Document Type" <> "Document Type"::Order THEN
        EXIT;

      PurchSetup.GET;
      IF PurchSetup."Reference (ICM) Based on" <> PurchSetup."Reference (ICM) Based on"::Formula THEN
        EXIT;

      CASE TRUE OF
          ((CurrFieldNo = FIELDNO("No.")) AND (STRPOS(PurchSetup."General Reference ICM", '%1') <>0)),
          ((CurrFieldNo = FIELDNO("Job No.")) AND (STRPOS(PurchSetup."General Reference ICM", '%2') <>0)),
          ((CurrFieldNo = FIELDNO("Service Order No.")) AND (STRPOS(PurchSetup."General Reference ICM", '%3') <>0)),
          ((CurrFieldNo = FIELDNO("Purchaser Code")) AND (STRPOS(PurchSetup."General Reference ICM", '%4') <>0)),
          ((CurrFieldNo = FIELDNO("Name Purchaser")) AND (STRPOS(PurchSetup."General Reference ICM", '%5') <>0)),
          ((CurrFieldNo = FIELDNO("Project Description")) AND (STRPOS(PurchSetup."General Reference ICM", '%6') <>0)),
          ((CurrFieldNo = FIELDNO("Service Order Description")) AND (STRPOS(PurchSetup."General Reference ICM", '%7') <>0)),
          (CurrFieldNo = 0):
          BEGIN

            IF (STRPOS(PurchSetup."General Reference ICM", '%9') <>0) AND ("Service Order No." <> '') THEN
              ServiceOrder.GET("Service Order No.");

            CALCFIELDS("Name Purchaser","Project Description","Service Order Description");
            "Reference (ICM)" := COPYSTR(
              STRSUBSTNO(PurchSetup."General Reference ICM",
                "No.",                                       //%1
                "Job No.",                                   //%2
                "Service Order No.",                         //%3
                "Purchaser Code",                            //%4
                "Name Purchaser",                            //%5
                "Project Description",                       //%6
                "Service Order Description",                 //%7
                GetNameAbbrevationEmployee,                  //%8
                ServiceOrder.Name),                          //%9
                1,
                MAXSTRLEN("Reference (ICM)"));
          END;
      END;
    END;

    PROCEDURE LastThreePositionsOK@1100529102(AccountNo@1100529100 : Text[50]) : Boolean;
    VAR
      CheckItTxt@1100529101 : Text[3];
    BEGIN
      //**4PS
      IF STRLEN(AccountNo) > 2 THEN BEGIN
        CheckItTxt := COPYSTR(AccountNo, STRLEN(AccountNo) - 2 , 3);
        IF "Bank No. Check" = CheckItTxt THEN
          EXIT(TRUE);
      END;
    END;

    PROCEDURE GetPurchOrderPlantOrderNo@1100529000(PurchOrderNo@1100529001 : Code[20]) : Code[20];
    VAR
      PurchLine@1100529000 : Record 39;
    BEGIN
      //**4PS
      IF PurchOrderNo <> '' THEN BEGIN
        PurchLine.SETRANGE("Document Type", "Document Type"::Order);
        PurchLine.SETRANGE("Document No.", PurchOrderNo);
        PurchLine.SETFILTER("Plant Order No.", '<>%1', '');
        IF PurchLine.FINDFIRST THEN
          EXIT(PurchLine."Plant Order No.");
      END;
      EXIT('');
    END;

    PROCEDURE UpdatePostingAndDocDate@1100525024(AlwaysReplaceDates@1100525002 : Boolean;NewPostingDate@1100525000 : Date);
    VAR
      PurchSetup@1100525001 : Record 312;
    BEGIN
      //**4PS
      PurchSetup.GET;
      IF AlwaysReplaceDates THEN BEGIN
        PurchSetup."Replace Posting Date" := TRUE;
        PurchSetup."Replace Document Date" := TRUE;
      END;

      IF PurchSetup."Replace Posting Date" OR PurchSetup."Replace Document Date" THEN BEGIN
        IF NewPostingDate = 0D THEN
          NewPostingDate := WORKDATE;

        IF PurchSetup."Replace Posting Date" OR ("Posting Date" = 0D) THEN
          IF NewPostingDate <> "Posting Date" THEN
            "Posting Date" := NewPostingDate;

        IF PurchSetup."Replace Document Date" OR ("Document Date" = 0D) THEN
          IF "Document Date" <> NewPostingDate THEN
            VALIDATE("Document Date",NewPostingDate);
      END;
    END;

    LOCAL PROCEDURE GetTempPurchHeader@1100525025();
    BEGIN
      //**4PS
      "Doc. No. Occurrence" := TempPurchHeader."Doc. No. Occurrence";
      "Ext. Document ID" := TempPurchHeader."Ext. Document ID";
      "Input by" := TempPurchHeader."Input by";
      "Input Date" := TempPurchHeader."Input Date";
      "Extra Receipts Allowed" := TempPurchHeader."Extra Receipts Allowed";
      "Purchase Order Correction" := TempPurchHeader."Purchase Order Correction";
    END;

    PROCEDURE GetNameAbbrevationEmployee@1100525026() : Text[30];
    VAR
      Employee@1100525000 : Record 5200;
      Job@1100525001 : Record 11072003;
      ServiceOrder@1100525002 : Record 11012823;
    BEGIN
      //**4PS
      IF "Job No." <> '' THEN BEGIN
        IF Job.GET("Job No.") AND (Job."Project Manager" <> '') THEN BEGIN
          IF Employee.GET(Job."Project Manager") THEN BEGIN
          END;
        END;
      END ELSE BEGIN
        IF "Service Order No." <> '' THEN BEGIN
          IF ServiceOrder.GET("Service Order No.") AND (ServiceOrder."Order Manager" <> '')THEN BEGIN
            IF Employee.GET(ServiceOrder."Order Manager") THEN BEGIN
            END;
          END;
        END;
      END;

      IF Employee."Name Abbreviation" <> '' THEN
        EXIT(Employee."Name Abbreviation");
    END;

    PROCEDURE GetEMailOrder@1100528701() : Text[80];
    VAR
      OrderAddress@1100528702 : Record 224;
      Vendor@1100528700 : Record 23;
      Contact@1100528400 : Record 5050;
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote]) THEN
        EXIT;

      IF "E-Mail for Purch. Order" <> '' THEN
        EXIT("E-Mail for Purch. Order");

      IF "Order Address Code" <> '' THEN
        IF OrderAddress.GET("Buy-from Vendor No.", "Order Address Code") THEN
          IF OrderAddress."E-Mail for Purch. Order" <> '' THEN
            EXIT(OrderAddress."E-Mail for Purch. Order");

      IF Vendor.GET("Buy-from Vendor No.") THEN
        EXIT(Vendor."E-Mail for Purch. Order");

      IF Contact.GET("Buy-from Contact No.") THEN
        EXIT(Contact."E-Mail for Purch. Order");
    END;

    PROCEDURE GetEMailOrderReceipt@1100529602() : Text[80];
    VAR
      OrderAddress@1100528702 : Record 224;
      Vendor@1100528700 : Record 23;
    BEGIN
      //**4PS
      IF "Document Type" <> "Document Type"::Order THEN
        EXIT;

      IF "Order Address Code" <> '' THEN
        IF OrderAddress.GET("Buy-from Vendor No.", "Order Address Code") THEN
          IF OrderAddress."E-Mail for Purch. Receipt" <> '' THEN
            EXIT(OrderAddress."E-Mail for Purch. Receipt");

      IF Vendor.GET("Buy-from Vendor No.") THEN
        IF Vendor."E-Mail for Purch. Receipt" <> '' THEN
          EXIT(Vendor."E-Mail for Purch. Receipt");
    END;

    LOCAL PROCEDURE GetExpectedReceiptDate@1100525027();
    VAR
      InventSetup@1100525000 : Record 313;
      CustomizedCalendarChange@1100525001 : Record 11072016;
      CalendarMgmt@1100525002 : Codeunit 7600;
      DeliveryPeriod@1100525003 : DateFormula;
      NewExpectedReceiptDate@1100525004 : Date;
    BEGIN
      //**4PS
      DeliveryPeriod := "Lead Time Calculation";
      IF FORMAT(DeliveryPeriod) = '' THEN BEGIN
        InventSetup.GET;
        DeliveryPeriod := InventSetup."Delivery Period";
      END;
      IF FORMAT(DeliveryPeriod) <> '' THEN BEGIN
        NewExpectedReceiptDate := CalendarMgmt.CalcDateBOC(
           '+' + FORMAT(DeliveryPeriod), TODAY,
           CustomizedCalendarChange."Source Type"::Company, '', '',
           CustomizedCalendarChange."Source Type"::Vendor, "Buy-from Vendor No.", '', FALSE);
        VALIDATE("Expected Receipt Date", NewExpectedReceiptDate);
      END;
    END;

    PROCEDURE ShowPurchaseLines@1100528602(IRelatedPurchaseHeaderNo@1100528600 : Code[20]) : Boolean;
    VAR
      PurchaseHeader@1100528601 : Record 38;
    BEGIN
      PurchaseHeader.GET("Document Type"::Order, IRelatedPurchaseHeaderNo);
      EXIT(PAGE.RUNMODAL(PAGE::"Purchase Order Receipt", PurchaseHeader) = ACTION::LookupOK);
    END;

    PROCEDURE SetCurrFieldNo@1100409003(NewCurrFieldNo@1100409000 : Integer);
    BEGIN
      //**4PS
      CurrFieldNo := NewCurrFieldNo;
    END;

    LOCAL PROCEDURE CheckPurchPlanPermission@1100409004();
    VAR
      Approver@1100409000 : Record 11012229;
    BEGIN
      //**4PS
      IF CurrFieldNo = 0 THEN
        EXIT;

      IF "Document Type" <> "Document Type"::Order THEN
        EXIT;

      IF xRec."Purchase Plan" = '' THEN
        EXIT;

      IF "Purchase Plan" = xRec."Purchase Plan" THEN
        EXIT;

      IF "Purchase Order Type" <> xRec."Purchase Order Type" THEN
        IF NOT PurchLinesExist THEN
          EXIT;

      CALCFIELDS("Order Approval Entry Present");
      IF NOT "Order Approval Entry Present" THEN
        EXIT;

      IF Approver.GET(USERID) THEN
        IF Approver."Super Approver Purchase Orders" THEN
          EXIT;

      ERROR(Text11012035,FIELDCAPTION("Purchase Plan"));
    END;

    LOCAL PROCEDURE UpdateEMailForPurchOrderForContactPerson@1100528410();
    VAR
      Contact@1100528400 : Record 5050;
    BEGIN
      //**4PS
      IF ("Electronic Order Type" <> "Electronic Order Type"::"E-Mail Contact Person") AND
         ("Electronic Order Type" <> "Electronic Order Type"::"ICM/ICF")  THEN
        EXIT;

      IF "Buy-from Contact Person No." <> '' THEN BEGIN
        IF Contact.GET("Buy-from Contact Person No.") THEN
          "E-Mail for Purch. Order" := Contact."E-Mail"
        ELSE
          "E-Mail for Purch. Order" := '';
      END ELSE
        IF "Buy-from Contact No." <> '' THEN BEGIN
          Contact.SETRANGE("No.", "Buy-from Contact No.");
          Contact.SETRANGE(Type, Contact.Type::Person);
          IF Contact.FINDFIRST THEN
            "E-Mail for Purch. Order" := Contact."E-Mail"
          ELSE
            "E-Mail for Purch. Order" := '';
        END;

      IF ("Buy-from Contact Person No." = '') AND
         ("Buy-from Contact No." = '')
      THEN
        "E-Mail for Purch. Order" := '';
    END;

    PROCEDURE "**** ExFlow ****"@12013596();
    BEGIN
    END;

    PROCEDURE ExFlowStatusFromPO@12013597() : Text[50];
    BEGIN
      // ExFlow
      IF NOT DocHead.READPERMISSION THEN
        EXIT;

      DocHead.RESET;
      IF DocHead.SETCURRENTKEY("Document No.") THEN;
      DocHead.SETRANGE("Document Type", "Document Type");
      DocHead.SETRANGE("Document No.", "No.");
      IF DocHead.FINDFIRST THEN BEGIN
        DocHead.CALCFIELDS(Rejected,"Hold by Approver");
        IF DocHead.Rejected THEN
          EXIT(DocHead.FIELDCAPTION(Rejected));
        IF DocHead."Hold by Approver" THEN
          EXIT(DocHead.FIELDCAPTION("Hold by Approver"));

        EXIT(FORMAT(DocHead.Status));
      END;
    END;

    PROCEDURE ExFlowStatusDrillDownFromPO@12013598();
    BEGIN
      // ExFlow
      IF NOT DocHead.READPERMISSION THEN
        EXIT;

      DocHead.RESET;
      DocHead.SETCURRENTKEY("Document No.");
      DocHead.SETRANGE("Document Type", "Document Type");
      DocHead.SETRANGE("Document No.", "No.");
      IF DocHead.FINDFIRST THEN
        PAGE.RUNMODAL(0,DocHead);
    END;

    PROCEDURE ExFlowFormat@12013599() : Integer;
    BEGIN
      // ExFlow
      IF NOT DocLine.READPERMISSION THEN
        EXIT;

      DocLine.RESET;
      DocLine.SETCURRENTKEY("Document No.");
      DocLine.SETRANGE("Document Type","Document Type");
      DocLine.SETRANGE("Document No.","No.");
      DocLine.SETRANGE(Flowstatus,DocLine.Flowstatus::Rejected);
      IF DocLine.FINDFIRST THEN
        EXIT(255);

      EXIT(0);
    END;

    PROCEDURE OnAssistShipToLocation@1100525028();
    VAR
      PlantLocation@1100525000 : Record 11012554;
    BEGIN
      //**4PS
      CASE Deliver OF
        Deliver::"Plant Location":
          BEGIN
            PlantLocation.SETRANGE(Depot, TRUE);
            IF "Ship-to Location" <> '' THEN BEGIN
              PlantLocation.SETRANGE(Code, "Ship-to Location");
              IF PlantLocation.FINDFIRST THEN;
              PlantLocation.SETRANGE(Code);  //Reset filter
            END;
            IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN BEGIN
              IF (PlantLocation.Code <> '') AND (PlantLocation.Code <> "Ship-to Location") THEN
                VALIDATE("Ship-to Location", PlantLocation.Code);
            END;
          END;
      ELSE
        TESTFIELD(Deliver, Deliver::"Plant Location");
      END;
    END;

    PROCEDURE CheckIfNoQuoteConsentLinesAvailable@1100528412();
    VAR
      ProjectPurchaseAction@1100528400 : Record 11012026;
      PurchasesPayablesSetup@1100528401 : Record 312;
    BEGIN
      //**4PS
      IF "Document Type" <> "Document Type"::Quote THEN
        EXIT;
      IF NOT PurchasesPayablesSetup.GET THEN
        EXIT;

      IF "Purchase Action" <> '' THEN BEGIN
        IF ProjectPurchaseAction.GET("Job No.", "Purchase Action") THEN
          ProjectPurchaseAction.CheckIfNoConsentLinesAvailable;
      END;

      CALCFIELDS("Quote Approval Entry Present");
      TESTFIELD("Quote Approval Entry Present", FALSE);
    END;

    PROCEDURE CheckIfMakingOrderAllowedForQuoteStatus@1100528413();
    VAR
      PurchasesPayablesSetup@1100528400 : Record 312;
    BEGIN
      //**4PS
      IF "Document Type" <> "Document Type"::Quote THEN
        EXIT;

      IF Status = Status::Closed THEN
        FIELDERROR(Status);

      IF ApprovalsMgmt.IsPurchaseApprovalsWorkflowEnabled(Rec) AND ((PurchHeader.Status = PurchHeader.Status::Open) OR (PurchHeader.Status = PurchHeader.Status::"Pending Approval") ) THEN
        ERROR(Text11012038);

      IF NOT PurchasesPayablesSetup.GET THEN
        EXIT;
      IF NOT PurchasesPayablesSetup."Release Purch. Quotes Required" THEN
        EXIT;

      IF Status = Status::Open THEN
        FIELDERROR(Status);
    END;

    PROCEDURE RelatedOrderHasOpenConsentLines@1100528415() : Boolean;
    VAR
      PurchaseHeader@1100528400 : Record 38;
    BEGIN
      //**4PS
      IF "Related Purch. Order No." = '' THEN
        EXIT;

      IF PurchaseHeader.GET(PurchaseHeader."Document Type"::Order, "Related Purch. Order No.") THEN BEGIN
        PurchaseHeader.CALCFIELDS("Order Approval Entry Present");
        EXIT(PurchaseHeader."Order Approval Entry Present");
      END;
    END;

    PROCEDURE SetFilterOnInputBy@1100525029();
    BEGIN
      //**4PS
      PurchSetup.GET;
      IF PurchSetup."Registration per User" THEN
        SETRANGE("Input by", USERID)
      ELSE
        SETRANGE("Input by");
    END;

    PROCEDURE GetPurchaseActionBudget@1100528416() PurchaseActionBudget : Decimal;
    VAR
      ProjectPurchaseAction@1100528400 : Record 11012026;
    BEGIN
      //**4PS
      IF ProjectPurchaseAction.GET("Job No.", "Purchase Action") THEN BEGIN
        ProjectPurchaseAction.CALCFIELDS("Purchase Budget");
        PurchaseActionBudget := ProjectPurchaseAction."Purchase Budget";
      END;
    END;

    PROCEDURE UpdateEMailSentByAndOn@1100525030();
    BEGIN
      //**4PS
      "E-Mail Sent on" := TODAY;
      "E-Mail Sent by" := USERID;
      MODIFY;
    END;

    PROCEDURE UpdateEMailReceiptSentByAndOn@1100525031();
    VAR
      PurchaseHeaderExtension@1100525000 : Record 11020398;
      PurchaseHeaderExtensionExists@1100525001 : Boolean;
    BEGIN
      //**4PS
      PurchaseHeaderExtensionExists := PurchaseHeaderExtension.GET("Document Type", "No.");
      IF NOT PurchaseHeaderExtensionExists THEN
        PurchaseHeaderExtension.GetPurchHeadExtension("Document Type", "No.");
      PurchaseHeaderExtension."E-Mail Receipt Sent on" := TODAY;
      PurchaseHeaderExtension."E-Mail Receipt Sent by" := USERID;
      IF NOT PurchaseHeaderExtensionExists THEN
        PurchaseHeaderExtension.INSERT
      ELSE
        PurchaseHeaderExtension.MODIFY;
    END;

    PROCEDURE CalcTotalOrderAmountLCY@1100528417() TotalOrderAmountLCY : Decimal;
    VAR
      PurchLineLoc@1100529600 : Record 39;
    BEGIN
      //**4PS
      IF "Currency Code" = '' THEN BEGIN
        CALCFIELDS(Amount);
        TotalOrderAmountLCY := Amount;
      END ELSE BEGIN
        PurchLineLoc.SETRANGE("Document Type", "Document Type");
        PurchLineLoc.SETRANGE("Document No.", "No.");
        PurchLineLoc.CALCSUMS("Amount (LCY)");
        TotalOrderAmountLCY := PurchLineLoc."Amount (LCY)";
      END;
    END;

    PROCEDURE CalcTotalPurchaseBudgetAmountLCY@1100528418() TotalPurchaseBudgetAmountLCY : Decimal;
    VAR
      TempProjectPurchaseAction@1100528402 : TEMPORARY Record 11012026;
    BEGIN
      //**4PS
      GetProjectPurchaseActions(TempProjectPurchaseAction);
      IF TempProjectPurchaseAction.FINDSET THEN
        REPEAT
          TempProjectPurchaseAction.CALCFIELDS("Purchase Budget");
          TotalPurchaseBudgetAmountLCY += TempProjectPurchaseAction."Purchase Budget";
        UNTIL TempProjectPurchaseAction.NEXT = 0;
    END;

    LOCAL PROCEDURE GetProjectPurchaseActions@1100528420(VAR TempProjectPurchaseAction@1100528400 : TEMPORARY Record 11012026);
    VAR
      ProjectPurchaseAction@1100528402 : Record 11012026;
      PurchaseLine@1100528401 : Record 39;
    BEGIN
      //**4PS
      IF ("Job No." <> '') AND ("Purchase Action" <> '') THEN
        IF ProjectPurchaseAction.GET("Job No.", "Purchase Action") THEN BEGIN
          TempProjectPurchaseAction.COPY(ProjectPurchaseAction);
          TempProjectPurchaseAction.INSERT;
        END;
      PurchaseLine.SETRANGE("Document Type", "Document Type");
      PurchaseLine.SETRANGE("Document No.", "No.");
      PurchaseLine.SETFILTER("Job No.", '<>%1', '');
      PurchaseLine.SETFILTER("Purchase Action", '<>%1', '');
      IF PurchaseLine.FINDSET THEN
        REPEAT
          IF NOT TempProjectPurchaseAction.GET(PurchaseLine."Job No.", PurchaseLine."Purchase Action") THEN
            IF ProjectPurchaseAction.GET(PurchaseLine."Job No.", PurchaseLine."Purchase Action") THEN BEGIN
              TempProjectPurchaseAction.COPY(ProjectPurchaseAction);
              TempProjectPurchaseAction.INSERT;
            END;
        UNTIL PurchaseLine.NEXT = 0;
    END;

    LOCAL PROCEDURE GetDate@1100528419() : Date;
    BEGIN
      //**4PS
      IF "Posting Date" <> 0D THEN
        EXIT("Posting Date");
      EXIT(WORKDATE);
    END;

    LOCAL PROCEDURE UpdateVendorByPurchaseRequisition@1100529600();
    VAR
      VendorbyPurchaseRequisition@1100529600 : Record 11229332;
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote]) THEN
        EXIT;
      IF "Purchase Requisition No." = '' THEN
        EXIT;

      VendorbyPurchaseRequisition.SETRANGE("Purchase Requisition No.", "Purchase Requisition No.");
      IF "Document Type" = "Document Type"::Order THEN
        VendorbyPurchaseRequisition.SETRANGE("Activate for", VendorbyPurchaseRequisition."Activate for"::Order)
      ELSE
        VendorbyPurchaseRequisition.SETRANGE("Activate for", VendorbyPurchaseRequisition."Activate for"::Quote);
      IF VendorbyPurchaseRequisition.FINDSET THEN
        REPEAT
          IF (VendorbyPurchaseRequisition.Type = VendorbyPurchaseRequisition.Type::Vendor) AND
             (VendorbyPurchaseRequisition."Vendor No." = "Buy-from Vendor No.")
          THEN BEGIN
            VendorbyPurchaseRequisition."Activate for" := VendorbyPurchaseRequisition."Activate for"::" ";
            VendorbyPurchaseRequisition.MODIFY;
            EXIT;
          END;

          IF (VendorbyPurchaseRequisition.Type = VendorbyPurchaseRequisition.Type::Contact) AND
             (VendorbyPurchaseRequisition."Vendor No." = "Buy-from Contact No.")
          THEN BEGIN
            VendorbyPurchaseRequisition."Activate for" := VendorbyPurchaseRequisition."Activate for"::" ";
            VendorbyPurchaseRequisition.MODIFY;
            EXIT;
          END;
        UNTIL VendorbyPurchaseRequisition.NEXT = 0;
    END;

    PROCEDURE CheckLocationBlocked@1100527000(ILocationCode@1100527000 : Code[10]);
    VAR
      Location@1100527001 : Record 14;
    BEGIN
      //**4PS
      IF Location.GET(ILocationCode) THEN
        Location.TESTFIELD(Blocked,FALSE);
    END;

    PROCEDURE GenerateRetentionLine@1100528501();
    VAR
      PurchLine@1100525000 : Record 39;
      SubcontracterContract@1100525003 : Record 11020635;
      RetentionBaseAmount@1100525002 : Decimal;
      RetentionAmount@1100525004 : Decimal;
      NewLineNo@1100525006 : Integer;
    BEGIN
      //**4PS
      TestStatusOpen;
      TESTFIELD("Document Type","Document Type"::Invoice);
      TESTFIELD("Subcontract No.");

      //Delete existing retention first
      DeleteGeneratedRetentionLines;

      //Find NewLineNo
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      IF NOT PurchLine.FINDLAST THEN
        EXIT;
      NewLineNo := PurchLine."Line No." + 10000;

      //Count Retention Base Amount
      IF PurchLine.FINDSET THEN
        REPEAT
          IF PurchLine."VAT Calculation Type" <> PurchLine."VAT Calculation Type"::"Full VAT" THEN
            IF "Amounts only" THEN
              RetentionBaseAmount += ROUND(PurchLine."Direct Unit Cost",Currency."Amount Rounding Precision") - PurchLine."Line Discount Amount"
            ELSE
              RetentionBaseAmount += ROUND(PurchLine.Quantity * PurchLine."Direct Unit Cost",Currency."Amount Rounding Precision") - PurchLine."Line Discount Amount";
        UNTIL PurchLine.NEXT = 0;

      IF RetentionBaseAmount = 0 THEN
        EXIT;

      SubcontracterContract.GET("Buy-from Vendor No.","Subcontract No.");
      IF "Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET("Currency Code");

      //Calculate 1st Retention Amount
      RetentionAmount :=
        ROUND(SubcontracterContract."Retention %" / 100 * RetentionBaseAmount, Currency."Amount Rounding Precision");

      //Add 1st Retention Line
      InsertRetentionLine(NewLineNo,RetentionAmount);

      //Calculate 2nd Retention Amount
      RetentionAmount :=
        ROUND(SubcontracterContract."Retention % 2" / 100 * RetentionBaseAmount,Currency."Amount Rounding Precision");

      IF RetentionAmount = 0 THEN
        EXIT;

      //Add 2nd Retention Line
      NewLineNo := NewLineNo + 10000;
      InsertRetentionLine(NewLineNo,RetentionAmount);
    END;

    LOCAL PROCEDURE InsertRetentionLine@1100528500(NewLineNo@1100525001 : Integer;RetentionAmount@1100525005 : Decimal);
    VAR
      PurchLine@1100525002 : Record 39;
      Vendor@1100525003 : Record 23;
      VendorPostingGroup@1100525004 : Record 93;
      GLAccount@1100525006 : Record 15;
    BEGIN
      //**4PS
      Vendor.GET("Buy-from Vendor No.");
      Vendor.TESTFIELD("Vendor Posting Group");
      VendorPostingGroup.GET(Vendor."Vendor Posting Group");
      VendorPostingGroup.TESTFIELD("Retention Suspense Acc.");
      GLAccount.GET(VendorPostingGroup."Retention Suspense Acc.");
      GLAccount.TESTFIELD("Gen. Prod. Posting Group");

      PurchLine.INIT;
      PurchLine."Document Type" := "Document Type";
      PurchLine."Document No." := "No.";
      PurchLine."Line No." := NewLineNo;
      PurchLine."Generated Retention Line" := TRUE;
      PurchLine.InitRecord; //Must be after setting "Generated Retention Line"
      PurchLine."Job No." := '';
      PurchLine.Type := PurchLine.Type::"G/L Account";
      PurchLine.VALIDATE("No.",VendorPostingGroup."Retention Suspense Acc.");
      PurchLine."Gen. Bus. Posting Group" := "Gen. Bus. Posting Group";;
      PurchLine."Gen. Prod. Posting Group" := GLAccount."Gen. Prod. Posting Group";
      PurchLine."VAT Bus. Posting Group" := "VAT Bus. Posting Group";
      PurchLine."VAT Prod. Posting Group" := "VAT Prod. Posting Group";
      PurchLine.VALIDATE("VAT Prod. Posting Group");
      IF NOT "Amounts only" THEN
        PurchLine.VALIDATE(Quantity,1);
      PurchLine.VALIDATE("Line Amount",-RetentionAmount);
      PurchLine."Posting Date" := "Posting Date";
      PurchLine.Description := GLAccount.Name;
      PurchLine."Reason Code" := "Reason Code";
      PurchLine."System-Created Entry" := TRUE;
      PurchLine.INSERT(TRUE);
    END;

    PROCEDURE DeleteGeneratedRetentionLines@1100525032();
    VAR
      PurchLine@1100525000 : Record 39;
    BEGIN
      //**4PS
      PurchLine.RESET;
      PurchLine.SETRANGE("Document Type","Document Type");
      PurchLine.SETRANGE("Document No.","No.");
      PurchLine.SETRANGE("Generated Retention Line",TRUE);
      IF NOT PurchLine.ISEMPTY THEN
        PurchLine.DELETEALL(TRUE);
    END;

    PROCEDURE MarkPurchaseQuotesOfProjectAndEstimate@1100525034(ProjectNo@1100525000 : Code[20];EstimateNo@1100525001 : Code[20]);
    BEGIN
      //**4PS
      IF (ProjectNo='') AND (EstimateNo='') THEN
        EXIT;

      IF (ProjectNo<>'') AND (EstimateNo='') THEN BEGIN
        MarkPurchaseHeadersOfProject(ProjectNo,"Document Type"::Quote);
      END;

      IF (ProjectNo='') AND (EstimateNo<>'') THEN BEGIN
        MarkPurchaseHeadersOfEstimate(EstimateNo,"Document Type"::Quote);
      END;

      IF (ProjectNo<>'') AND (EstimateNo<>'') THEN BEGIN
        MarkPurchaseHeadersOfProjectAndEstimate(ProjectNo,EstimateNo,"Document Type"::Quote);
      END;
    END;

    LOCAL PROCEDURE MarkPurchaseHeadersOfProjectAndEstimate@1100525035(ProjectNo@1100525001 : Code[20];EstimateNo@1100525000 : Code[20];DocumentType@1100525002 : Integer);
    VAR
      PurchaseHeader@1100525004 : Record 38;
      PurchaseLine@1100525003 : Record 39;
    BEGIN
      //**4PS
      IF (ProjectNo='') AND (EstimateNo='') THEN
        EXIT;

      PurchaseHeader.SETCURRENTKEY("Document Type", "Job No.");
      PurchaseHeader.SETRANGE("Document Type", DocumentType);
      PurchaseHeader.SETRANGE("Job No.", ProjectNo);
      PurchaseHeader.SETRANGE("Estimate No.", EstimateNo);
      IF PurchaseHeader.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseHeader."No.") THEN
            MARK(TRUE);
        UNTIL PurchaseHeader.NEXT = 0;

      PurchaseLine.SETCURRENTKEY("Document Type","Job No.");
      PurchaseLine.SETRANGE("Document Type", DocumentType);
      PurchaseLine.SETRANGE("Job No.", ProjectNo);
      PurchaseLine.SETRANGE("Estimate No.", EstimateNo);
      IF PurchaseLine.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseLine."Document No.") THEN
            MARK(TRUE);
        UNTIL PurchaseLine.NEXT = 0;
    END;

    LOCAL PROCEDURE MarkPurchaseHeadersOfEstimate@1100525036(EstimateNo@1100525000 : Code[20];DocumentType@1100525001 : Integer);
    VAR
      PurchaseHeader@1100525002 : Record 38;
      PurchaseLine@1100525003 : Record 39;
    BEGIN
      //**4PS
      IF (EstimateNo = '') THEN
        EXIT;

      PurchaseHeader.SETCURRENTKEY("Document Type", "No.");
      PurchaseHeader.SETRANGE("Document Type", DocumentType);
      PurchaseHeader.SETRANGE("Estimate No.", EstimateNo);
      IF PurchaseHeader.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseHeader."No.") THEN
            MARK(TRUE);
        UNTIL PurchaseHeader.NEXT = 0;

      PurchaseLine.SETCURRENTKEY("Document Type","No.");
      PurchaseLine.SETRANGE("Document Type", DocumentType);
      PurchaseLine.SETRANGE("Estimate No.", EstimateNo);
      IF PurchaseLine.FINDSET THEN
        REPEAT
          IF GET(DocumentType, PurchaseLine."Document No.") THEN
            MARK(TRUE);
        UNTIL PurchaseLine.NEXT = 0;
    END;

    PROCEDURE SendRecordSelectionWithOptions@1100529900();
    VAR
      CreateICMFiles@1100528207 : Report 11012308;
      CreateICKFiles@1100528206 : Report 11012323;
      SelectSentOptionPurchOrder@1100528200 : Page 11125021;
      PurchaseHeader2@1100528210 : Record 38;
      PurchaseHeader@1100528201 : Record 38;
      IsQuote@1100528202 : Boolean;
      DocumentPrint@1100528203 : Codeunit 229;
      ChangeStatus@1100528204 : 'None,Released,Closed';
      DirectPostOrder@1100528205 : 'According to Vendor,Not';
      SendPurchOrderGS1@1100528209 : Report 11012480;
      INSBOUInterface@1100528208 : Codeunit 11012480;
      PurchaseEMailOrder@1100528211 : Report 11012036;
      Vendor@1100528212 : Record 23;
    BEGIN
      //**4PS Only Type::Order not Prepared for Type::Quote
      SelectSentOptionPurchOrder.SetSelectAllFields;

      IF (SelectSentOptionPurchOrder.RUNMODAL <> ACTION::LookupOK) THEN
        EXIT;

      IF SelectSentOptionPurchOrder.GetSelectGS1INSBOU THEN BEGIN
        PurchaseHeader.COPY(Rec);
        PurchaseHeader2.COPY(Rec);
        IF PurchaseHeader2.FINDSET THEN BEGIN
          REPEAT
            PurchaseHeader.GET(PurchaseHeader2."Document Type",PurchaseHeader2."No.");
            PurchaseHeader.SETRECFILTER;
            INSBOUInterface.SendPuchaseOder(PurchaseHeader."Document Type", PurchaseHeader."No.");
          UNTIL PurchaseHeader2.NEXT = 0;
        END;
        EXIT;
      END;

      IF NOT SelectSentOptionPurchOrder.GetSelectSendOrderElectronicOption THEN BEGIN
        PurchaseHeader.COPY(Rec);
        IF PurchaseHeader.FINDSET THEN BEGIN

          IF SelectSentOptionPurchOrder.GetSelectEmail THEN BEGIN
            PurchaseEMailOrder.USEREQUESTPAGE := FALSE;
            PurchaseEMailOrder.SetRecordsMarked(TRUE);
            PurchaseEMailOrder.SETTABLEVIEW(PurchaseHeader);
            PurchaseEMailOrder.RUNMODAL;
          END;

          IF SelectSentOptionPurchOrder.GetSelectICM THEN BEGIN
            PurchaseHeader.CALCFIELDS("ICM Login Code");  //C062889
            IF PurchaseHeader."ICM Login Code" = '' THEN
              IF GUIALLOWED THEN ERROR(Text11012025);
            CreateICMFiles.SetSendToVendor(TRUE);
            PurchaseHeader.SETRANGE("Buy-from Vendor No.", PurchaseHeader."Buy-from Vendor No.");
            PurchaseHeader.SETRANGE("ICM Status", PurchaseHeader."ICM Status"::Create);
            CreateICMFiles.SETTABLEVIEW(PurchaseHeader);
            CreateICMFiles.RUNMODAL;
          END;

          IF SelectSentOptionPurchOrder.GetSelectGS1SOAP  THEN BEGIN
            SendPurchOrderGS1.SetIsSOAP;
            SendPurchOrderGS1.SETTABLEVIEW(PurchaseHeader);
            SendPurchOrderGS1.RUNMODAL;
          END;

          IF SelectSentOptionPurchOrder.GetSelectGS1XMLRPC  THEN BEGIN
            SendPurchOrderGS1.SetIsRPC;
            SendPurchOrderGS1.SETTABLEVIEW(PurchaseHeader);
            SendPurchOrderGS1.RUNMODAL;
          END;

          IF SelectSentOptionPurchOrder.GetSelectGS1INSBOU THEN BEGIN
            IF (PurchaseHeader.COUNT <> 1) THEN
              ERROR(Text11012036, PurchaseHeader.TABLECAPTION);
            INSBOUInterface.SendPuchaseOder(PurchaseHeader."Document Type", PurchaseHeader."No.");
          END;

          IF SelectSentOptionPurchOrder.GetSelectPrint THEN BEGIN
            PurchaseHeader.PrintRecords(TRUE);
          END;
        END;
        EXIT;
      END;

      IF SelectSentOptionPurchOrder.GetSelectSendOrderElectronicOption THEN BEGIN
        PurchaseHeader.COPY(Rec);
        PurchaseHeader2.COPY(Rec);
        IF PurchaseHeader2.FINDSET THEN BEGIN
          REPEAT
            PurchaseHeader.GET(PurchaseHeader2."Document Type",PurchaseHeader2."No.");
            PurchaseHeader.SETRECFILTER;
            IsQuote := (PurchaseHeader."Document Type" = PurchaseHeader."Document Type"::Quote);
            Vendor.GET(PurchaseHeader."Buy-from Vendor No.");

            IF (OrderIsSentByEMail(Vendor."Electronic Order Type"))  THEN BEGIN
              IF IsQuote THEN
                DocumentPrint.EmailPurchHeader(
                  PurchaseHeader, FALSE, ChangeStatus::None, DirectPostOrder::"Not", FALSE, FALSE)
              ELSE BEGIN
                REPORT.RUNMODAL(REPORT::"Purchase - E-Mail Order", TRUE, FALSE, PurchaseHeader);
              END;
            END;

            IF (Vendor."Electronic Order Type" = Vendor."Electronic Order Type"::"ICM/ICF") THEN BEGIN
              IF NOT IsQuote THEN BEGIN
                PurchaseHeader.CALCFIELDS("ICM Login Code");  //C062889
                IF PurchaseHeader."ICM Login Code" = '' THEN
                  IF GUIALLOWED THEN ERROR(Text11012025);
                CreateICMFiles.SetSendToVendor(TRUE);
                PurchaseHeader.SETRANGE("Buy-from Vendor No.", PurchaseHeader."Buy-from Vendor No.");
                PurchaseHeader.SETRANGE("ICM Status", PurchaseHeader."ICM Status"::Create);
                CreateICMFiles.SETTABLEVIEW(PurchaseHeader);
                CreateICMFiles.RUNMODAL;
              END;
            END;

            IF (Vendor."Electronic Order Type" = Vendor."Electronic Order Type"::"ICM/ICF") THEN BEGIN
              IF IsQuote THEN BEGIN
                PurchaseHeader.CALCFIELDS("ICM Login Code");  //C062889
                IF PurchaseHeader."ICM Login Code" = '' THEN
                  IF GUIALLOWED THEN ERROR(Text11012025);
                PurchaseHeader.SETRANGE("Buy-from Vendor No.", PurchaseHeader."Buy-from Vendor No.");
                PurchaseHeader.SETRANGE("ICM Status", PurchaseHeader."ICM Status"::Create);
                CreateICKFiles.SETTABLEVIEW(PurchaseHeader);
                CreateICKFiles.RUNMODAL;
              END;
            END;

            IF (Vendor."Electronic Order Type" = Vendor."Electronic Order Type"::"GS1 (SOAP)")  THEN BEGIN
              SendPurchOrderGS1.SetIsSOAP;
              SendPurchOrderGS1.SETTABLEVIEW(PurchaseHeader);
              SendPurchOrderGS1.RUNMODAL;
            END;

            IF (Vendor."Electronic Order Type" = Vendor."Electronic Order Type"::"GS1 (XML-RPC)")  THEN BEGIN
              SendPurchOrderGS1.SetIsRPC;
              SendPurchOrderGS1.SETTABLEVIEW(PurchaseHeader);
              SendPurchOrderGS1.RUNMODAL;
            END;

            IF (Vendor."Electronic Order Type" = Vendor."Electronic Order Type"::"GS1 INSBOU") OR
              SelectSentOptionPurchOrder.GetSelectGS1INSBOU THEN BEGIN
              INSBOUInterface.SendPuchaseOder(PurchaseHeader."Document Type", PurchaseHeader."No.");
            END;

            IF (Vendor."Electronic Order Type" = Vendor."Electronic Order Type"::Standard) THEN BEGIN
              PurchaseHeader.PrintRecords(TRUE);
            END;

          UNTIL PurchaseHeader2.NEXT = 0;
        END;
        EXIT;
      END;
    END;

    LOCAL PROCEDURE CheckRelatedReceiptsExist@1100528104();
    VAR
      PurchRcptHeader@1100528100 : Record 120;
    BEGIN
      //**4PS
      IF ("Document Type" <> "Document Type"::Order) OR ("No." = '') THEN
        EXIT;

      PurchRcptHeader.SETRANGE("Order No.", "No.");
      IF NOT PurchRcptHeader.ISEMPTY THEN
        ERROR(Text11012039);
    END;

    PROCEDURE DetermineBuyFromVendorNoWithGLN@1100528502(GLN@1100528500 : Code[13]) : Code[20];
    VAR
      ETIMVendorLocalMgt@1100528501 : Record 11012313;
      Vendor@1100528502 : Record 23;
    BEGIN
      //**4PS
      IF GLN <> '' THEN BEGIN
        Vendor.SETRANGE(GLN, GLN);
        IF Vendor.COUNT = 1 THEN BEGIN
          Vendor.FINDFIRST;
          EXIT(Vendor."No.");
        END;

        IF ETIMVendorLocalMgt.GET(GLN) THEN
          EXIT(ETIMVendorLocalMgt."Vendor (Purchase)");
      END;
      EXIT('');
    END;

    PROCEDURE IsDocumentCaptureActive@1100528203() : Boolean;
    BEGIN
      //**4PS
      IF NOT DCSetupRead THEN BEGIN
        DCSetupRead := TRUE;
        IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DocumentCaptureSetup) THEN
          EXIT(FALSE);
        IF DocumentCaptureSetup.GET THEN;
      END;
      EXIT(DocumentCaptureSetup."Document Nos." <> '');
    END;

    PROCEDURE CheckSignhostSignersBeforeReleasingPurchaseOrder@1100528422();
    VAR
      SignhostSigner@1100528400 : Record 11229467;
    BEGIN
      //**4PS
      IF "Document Type" <> "Document Type"::Order THEN
        EXIT;
      SignhostSigner.SETRANGE("Record ID", RECORDID);
      IF SignhostSigner.ISEMPTY THEN
        EXIT;

      SignhostSigner.SETFILTER("Word Document No.", '<>%1', '');
      SignhostSigner.FINDSET;
      REPEAT
        SignhostSigner.TESTFIELD("Signed Date-Time");
      UNTIL SignhostSigner.NEXT = 0;
    END;

    PROCEDURE CalcTotalRiskCoverageLCY@1100529601(VAR TotalRiskCoverage@1100529601 : Decimal;VAR TotalRiskCoverageWithdraw@1100529602 : Decimal);
    VAR
      LocPurchaseLine@1100529600 : Record 39;
    BEGIN
      //**4PS
      LocPurchaseLine.SETRANGE("Document Type", "Document Type");
      LocPurchaseLine.SETRANGE("Document No.", "No.");
      LocPurchaseLine.CALCSUMS("Risc Coverage Amount (LCY)", "Release Risc Coverage (LCY)");
      TotalRiskCoverage := LocPurchaseLine."Risc Coverage Amount (LCY)";
      TotalRiskCoverageWithdraw := LocPurchaseLine."Release Risc Coverage (LCY)";
    END;

    PROCEDURE ChooseTradeName@1100527450();
    VAR
      Vendor@1100527452 : Record 23;
      ContactTradename@1100527451 : Record 11229299;
      ContactTradenames@1100527450 : Page 11229488;
    BEGIN
      //**4PS
      IF NOT Vendor.GET("Buy-from Vendor No.") THEN
        ERROR(Text11012040);
      Vendor.GetTradename(ContactTradename);
      ContactTradenames.EDITABLE(FALSE);
      ContactTradenames.SETTABLEVIEW(ContactTradename);
      ContactTradenames.LOOKUPMODE := TRUE;
      IF ContactTradenames.RUNMODAL = ACTION::LookupOK THEN BEGIN
        ContactTradenames.GETRECORD(ContactTradename);
        IF "Document Type" = "Document Type"::"Credit Memo" THEN
          IF "Ship-to Name" = "Buy-from Vendor Name" THEN
            "Ship-to Name" := ContactTradename.Tradename;
        "Buy-from Vendor Name" := ContactTradename.Tradename;
        IF "Pay-to Vendor No." = "Buy-from Vendor No." THEN
          "Pay-to Name" := ContactTradename.Tradename;
      END;
    END;

    PROCEDURE ShowSignhostSigners@1100528409();
    VAR
      Contact@1100528404 : Record 5050;
      ContactBusinessRelation@1100528400 : Record 5054;
      SignhostSigner@1100528403 : Record 11229467;
      SignhostSigners@1100528402 : Page 11129726;
      ContactCompanyNoFilter@1100528401 : Text;
    BEGIN
      //**4PS
      IF Contact.GET("Buy-from Contact No.") THEN
        ContactCompanyNoFilter := Contact."Company No."
      ELSE
        IF ContactBusinessRelation.FindByRelation(
          ContactBusinessRelation."Link to Table"::Vendor, "Buy-from Vendor No.")
        THEN
          ContactCompanyNoFilter := ContactBusinessRelation."Contact No.";

      SignhostSigner.SETRANGE("Record ID", RECORDID);
      SignhostSigner.SETRANGE("Word Document No.", '');
      SignhostSigners.SETTABLEVIEW(SignhostSigner);
      SignhostSigners.SetContactCompanyNoFilter(ContactCompanyNoFilter);
      SignhostSigners.RUN;
    END;

    PROCEDURE NoOfSignhostDocuments@1100528424() : Integer;
    VAR
      SignhostDocument@1100528400 : Record 11229468;
    BEGIN
      //**4PS
      SetPurchaseHeaderFilterOnSignhostDocument(SignhostDocument);
      EXIT(SignhostDocument.COUNT);
    END;

    PROCEDURE DrillDownOnNoOfSignhostDocuments@1100528425();
    VAR
      SignhostDocument@1100528400 : Record 11229468;
    BEGIN
      //**4PS
      SetPurchaseHeaderFilterOnSignhostDocument(SignhostDocument);
      PAGE.RUN(0, SignhostDocument);
    END;

    LOCAL PROCEDURE SetPurchaseHeaderFilterOnSignhostDocument@1100528423(VAR SignhostDocument@1100528400 : Record 11229468);
    BEGIN
      //**4PS
      SignhostDocument.SETRANGE("Record ID", RECORDID);
    END;

    LOCAL PROCEDURE UpdateDeliver@1100528503(CallingFieldNo@1100528500 : Integer);
    VAR
      Project@1100528501 : Record 11072003;
      ServiceOrder@1100528502 : Record 11012823;
      ServiceLocation@1100528503 : Record 11012801;
    BEGIN
      //**4PS
      CASE CallingFieldNo OF
        FIELDNO("Ship-to Code"):
          BEGIN
            IF "Ship-to Code" <> '' THEN BEGIN
              IF Deliver <> Deliver::"Customer Ship-to Address" THEN
                VALIDATE(Deliver,Deliver::"Customer Ship-to Address");
            END ELSE
              IF Deliver <> Deliver::"Customer Address" THEN
                VALIDATE(Deliver,Deliver::"Customer Address")
          END;
        FIELDNO("Ship-to Project"):
          BEGIN
            IF "Ship-to Project" <> '' THEN BEGIN
              Project.GET("Ship-to Project");
              CASE Project.Deliver OF
                Project.Deliver::" ",Project.Deliver::"Project Location":
                  BEGIN
                    VALIDATE(Deliver,Deliver::"Project Location");
                    VALIDATE("Ship-to Location",Project."Ship To Location");
                  END;
                Project.Deliver::Location:
                  BEGIN
                    VALIDATE(Deliver,Deliver::Location);
                    VALIDATE("Ship-to Location",Project."Ship To Location");
                  END;
              END;
            END ELSE BEGIN
              IF Deliver = Deliver::Location THEN BEGIN
                IF "Ship-to Location" <> '' THEN
                  VALIDATE("Ship-to Location");
              END ELSE BEGIN
                IF Deliver = Deliver::"Project Location" THEN BEGIN
                  "Ship-to Location" := '';
                  VALIDATE(Deliver,Deliver::"Default (Company Address)");
                END;
              END;
            END;
          END;
        FIELDNO("Service Order No."):
          BEGIN
            IF "Service Order No." <> '' THEN BEGIN
              ServiceOrder.GET("Service Order No.");
              IF ServiceLocation.GET(ServOrderRec."Service Location No.") THEN BEGIN
                CASE ServiceLocation.Deliver OF
                  ServiceLocation.Deliver::" ":
                    BEGIN
                      "Ship-to Location" := '';
                      VALIDATE(Deliver,Deliver::"Default (Company Address)");
                    END;
                  ServiceLocation.Deliver::Location:
                    BEGIN
                      VALIDATE(Deliver,Deliver::Location);
                      VALIDATE("Ship-to Location",ServiceLocation."Ship To Location");
                    END;
                  ServiceLocation.Deliver::"Service Loc. Ship-to Address":
                    BEGIN
                      VALIDATE(Deliver,Deliver::"Service Location");
                      VALIDATE("Ship-to Location",ServiceLocation."Ship To Location");
                    END;
                END;
              END;
            END ELSE BEGIN
              IF Deliver = Deliver::Location THEN BEGIN
                IF "Ship-to Location" <> '' THEN
                  VALIDATE("Ship-to Location");
              END ELSE BEGIN
                IF Deliver = Deliver::"Service Location" THEN BEGIN
                  "Ship-to Location" := '';
                  VALIDATE(Deliver,Deliver::"Default (Company Address)");
                END;
              END;
            END;
          END;
        FIELDNO("Location Code"):
          BEGIN
            IF Deliver > Deliver::Location THEN
              EXIT;

            IF (Deliver = Deliver::"Default (Company Address)") AND ("Ship-to Project" <> '') THEN
              EXIT;

            IF ("Ship-to Location" <> "Location Code") THEN BEGIN
              "Ship-to Location" := "Location Code";
              IF "Location Code" = '' THEN
                VALIDATE(Deliver,Deliver::"Default (Company Address)")
              ELSE
                VALIDATE(Deliver,Deliver::Location);
              VALIDATE("Ship-to Location","Location Code");
            END;
          END;
      END;
    END;

    BEGIN
    {
      4PS
      30-09-2000, Andre Overeem: WKA fields and default VAT Prod. Posting Group added.
                                   Purchase invoice registration added.
      08-01-2001, Andre Overeem: Seperate No. Series for Lend in orders added.
      07-11-2001 Andre Overeem: Number of Hours default set to 1, when Payment Agreement <>'' is.
      4PS01 Jan ter Harmsel Call 51. Extra Option in Status field::Closed. Only closed (purchase)orders can be deleted.
      21-06-2005, Henk Sebens: Purchase Responsibility Center Filter and default seperated.
      29-07-2005, D. Borkent: Do not make Location empty when deliver=location.
      4PS02 JD Melding C-007868, 24-11-2006, Separate default On Hold Codes for Credit Memos
      4PS03 JD Melding C-008964, 08-12-2006, Make it possible to have a Contact of type Person as a Vendor.
      4PS04 GB Melding 12083, 03-06-2008, Make it possible to change vendor without readrights Managemind
      4PS05 JD 29-06-2008, Improvements for intrastat
      4PS06 HBK 13-07-09: Added field "Consumption per Location"
      4PS07 24-09-2009 PS Status options Pending Approval,Pending Prepayment removed (set empty).
      4PS08 KK 19-11-2010, On hold when no contract returned or when no letter of credit returned.
      4PS, 11-12-13, C009135, Expected Receipt Date is now automatically filled for non-ICM vendors too.

      4PS 20-09-16 UKR-C27159 VAKAT: BI032 checkbox Back-to-back - Added field
                                     Triger Related Purch. Order No. OnValidate changed

      4PS 29-03-18 DP01917 OLKOL: Fields "Approval Comment" Added
      Not allowed to add more fields to this table

      140530 ITERO.DL 4PS-039 Department authorization R2
      140630 Itero.WvG SYM-021 extended IVendInvNo to 35 in CheckVendorInvoiceNo
      141208 ITERO.DL SYM-037 Invoices manually posted does not generate INVREC-files, flag for export is pre-set directly, new field added "Export to Symbrio"
      141217 ITERO.DL SYM-037 added 'Export to Symbrio Type'
      150819 ITERO.MH Added field "Payment Reference NO"
      160707 ITERO.DL JobUpdatePurchLines local yes->no

      --- ExFlow --->
      Field 12013591 : ExFlow Document Type
      Field 12013601 : New Line
      Field 12013603 : Approve
      Field 12013604 : Remaining Amount
      Field 12013605 : Gross Invoice Amount ExFlow
      Field 12013606 : Import VAT Amount
      Field 12013609 : Requisition No.
      Field 12013610 : Remaining to Invoice
      Field 12013613 : Propose VAT Line
      Field 12013622 : Prepayment Order No.
      Field 12013638 : Block Document
      Field 12013640 : Receipt No. Mandatory
      Code           : OnModify, OnDelete,Posting Date - OnValidate(), Purchaser Code - OnValidate()
                       UpdatePurchLines(),RecreatePurchLines()
      Keys           : Vendor Invoice No. and Vendor Cr. Memo No.
      Globals
      Functions       : ExFlowStatusFromPO,ExFlowStatusDrillDownFromPO,ExFlowFormat
      161207 ITERO.WG Merge Version 4.11
      <-- ExFlow ---
      NAVFI: removed field "Invoice Message 2", reduced size of "Invoice Message" from 250 -> 128, due to full table-definition
      PEB *** Begin ***
      PEB0012 "Note of Goods" field added
      PEB0025 "Gross Invioce Amount" and Rounding
      PEB0052 Fixed "External Document No." from Vendor
      PEB
      PEB *** End ***

      160929 ITERO.DL RFC148 added OCR
      171214 ITERO.DL pure285848 permission issue
      190828 ORANGO.LP CER GAP 15 New field "Document Sent By"
      191128 REK #26301 ORANGO.PR New Code in function "UpdateInwardHeader"
      191105 ORANGO.LP 4PSSE CER GAP 13 New field "Fast Order"
    }
    END.
  }
}

