OBJECT Table 11012005 Project Principal
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    DataCaptionFields=Project No.,Principal,Principal Name;
    OnInsert=VAR
               lvProjSetupRec@1100525000 : Record 315;
             BEGIN
               TESTFIELD(Principal);

               IF ProjRec.GET("Project No.") THEN BEGIN
                 "Main Project No." := ProjRec."Main Project";
                 "Invoice Text Installments" := ProjRec.Text;
                 IF ("Price List" = '') THEN
                   "Price List" := ProjRec."Price List";
                 IF ("Ref. Date Unit Price" = 0D) THEN
                   "Ref. Date Unit Price" := ProjRec."Ref. Date Unit Price";
               END;

               lvProjSetupRec.GET;
               IF ProjRec."Internal Project" THEN BEGIN
                 TESTFIELD(Principal, lvProjSetupRec."Principal Internal Project");
               END ELSE BEGIN
                 IF Principal = lvProjSetupRec."Principal Internal Project" THEN BEGIN
                   ERROR(Text011, FIELDCAPTION(Principal), Principal);
                 END;
               END;

               ProjRec.CheckProjectStatus(ExtraStepProjectStatus());

               InitRecord;
               GetDefaultSalesSurcharges;

               BuildRelationalStructure('INSERT');
               ProjectSiteMgt.LogProjectPrincipal(1, Rec);

               "Date/Time Last Modified" := CURRENTDATETIME; // 4PSHM 140131
             END;

    OnModify=BEGIN
               BuildRelationalStructure('MODIFY');
               ProjectSiteMgt.LogProjectPrincipal(2, Rec);

               "Date/Time Last Modified" := CURRENTDATETIME; // 4PSHM 140131
             END;

    OnDelete=VAR
               ProjInstalmRec@11012000 : Record 11012018;
               ProjCostPlusRec@1210190001 : Record 11012019;
               CommissionRec@11012001 : Record 11012020;
               ProjPrincHourRateRec@11012002 : Record 11012024;
               lvPrinTenderElemRec@1210190003 : Record 11012470;
               lvInstalMotRec@1210190002 : Record 11012471;
               ExtraConfirm@1210190000 : Boolean;
               lvCommentRec@1100485000 : Record 11020314;
             BEGIN
               IF NOT gDelCompleteProject THEN BEGIN
                 IF ProjRec.GET("Project No.") THEN
                   IF ProjRec."Project Status" >= ProjRec."Project Status"::Finished THEN
                     ExtraConfirm := FALSE
                   ELSE
                     ExtraConfirm := TRUE;

                 ProjCostPlusRec.SETRANGE("Project No.","Project No.");
                 ProjCostPlusRec.SETRANGE(Principal,Principal);
                 IF ProjCostPlusRec.FINDSET THEN BEGIN
                   REPEAT
                     ProjCostPlusRec.CALCFIELDS("Invoiced Price", "Invoice in Process");
                     IF ProjCostPlusRec."Invoiced Price" + ProjCostPlusRec."Invoice in Process" <> 0 THEN
                       ERROR(Text007);
                   UNTIL ProjCostPlusRec.NEXT = 0;
                 END;

                 ProjInstalmRec.SETRANGE("Project No.","Project No.");
                 ProjInstalmRec.SETRANGE(Principal,Principal);
                 IF ProjInstalmRec.FINDSET THEN BEGIN
                   REPEAT
                     ProjInstalmRec.CALCFIELDS("Invoiced Price (LCY)", "Invoice in Process (LCY)");
                     IF ProjInstalmRec."Invoiced Price (LCY)" + ProjInstalmRec."Invoice in Process (LCY)" <> 0 THEN
                       ERROR(Text004);
                   UNTIL ProjInstalmRec.NEXT = 0;
                   IF ExtraConfirm THEN
                     IF CONFIRM(Text005, FALSE) = FALSE THEN
                       ERROR(Text001);
                 END;
               END;

               ProjInstalmRec.SETRANGE("Project No.","Project No.");
               ProjInstalmRec.SETRANGE(Principal,Principal);
               IF ProjInstalmRec.FINDSET(TRUE, FALSE) THEN BEGIN
                 REPEAT
                   ProjInstalmRec.DeleteInstallment(ProjInstalmRec."Project No.",
                                                    ProjInstalmRec.Principal,
                                                    ProjInstalmRec."Plot No.",
                                                    ProjInstalmRec."Installment No.",
                                                    gDelCompleteProject);
                 UNTIL ProjInstalmRec.NEXT = 0;
               END;

               CommissionRec.SETRANGE("Project No.","Project No.");
               CommissionRec.SETRANGE(Principal,Principal);
               CommissionRec.DELETEALL(TRUE);

               ProjPrincHourRateRec.SETRANGE("Project No.","Project No.");
               ProjPrincHourRateRec.SETRANGE(Principal,Principal);
               ProjPrincHourRateRec.DELETEALL(TRUE);

               lvInstalMotRec.SETRANGE("Project No.","Project No.");
               lvInstalMotRec.SETRANGE(Principal,Principal);
               IF lvInstalMotRec.FINDSET(TRUE, FALSE) THEN BEGIN
                 REPEAT
                   lvInstalMotRec.SetGlobalDeleteCompleteProject(gDelCompleteProject);
                   lvInstalMotRec.DELETE(TRUE);
                 UNTIL lvInstalMotRec.NEXT = 0;
               END;

               lvPrinTenderElemRec.SETRANGE("Project No.","Project No.");
               lvPrinTenderElemRec.SETRANGE(Principal,Principal);
               lvPrinTenderElemRec.DELETEALL;

               lvCommentRec.SETRANGE("Table1 Name", lvCommentRec."Table1 Name"::Job);
               lvCommentRec.SETRANGE("Table1 No.", "Project No.");
               lvCommentRec.SETRANGE("Table2 Name", lvCommentRec."Table2 Name"::"Project Principal");
               lvCommentRec.SETRANGE("Table2 No.", Principal);
               lvCommentRec.SETRANGE("Table3 Name", 0);
               lvCommentRec.DELETEALL(TRUE);

               CustSurchRec.RESET;
               CustSurchRec.SETRANGE("Record Type", CustSurchRec."Record Type"::ProjCust);
               CustSurchRec.SETRANGE("Customer No.", Principal);
               CustSurchRec.SETRANGE(Code, "Project No.");
               CustSurchRec.DELETEALL;

               BuildRelationalStructure('DELETE');
               ProjectSiteMgt.LogProjectPrincipal(3, Rec);
             END;

    OnRename=BEGIN
               IF (Principal <> xRec.Principal) THEN BEGIN
                 ProjEntryRec.SETCURRENTKEY("Job No.");
                 ProjEntryRec.SETRANGE("Job No.", "Project No.");
                 ProjEntryRec.SETRANGE(Principal, xRec.Principal);
                 ProjEntryRec.SETRANGE("Entry Type", ProjEntryRec."Entry Type"::Sale);
                 IF ProjEntryRec.FIND('-') THEN BEGIN
                   IF CONFIRM(Text006, FALSE) = FALSE THEN
                     ERROR(Text001);
                 END;
                 GetDefaultSalesSurcharges;
                 BuildRelationalStructure('MODIFY');
               END;
             END;

    CaptionML=[ENU=Project Principal;
               NOR=Prosjektoppdragsgiver;
               SVE=Projektuppdragsgivare];
    LookupPageID=Page11012016;
    DrillDownPageID=Page11012016;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Settlement Method");
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr];
                                                   NotBlank=Yes }
    { 20  ;   ;Principal           ;Code20        ;TableRelation=Customer.No.;
                                                   OnValidate=BEGIN
                                                                IF SkipValidation THEN
                                                                  EXIT;

                                                                CustomerRec.GET(Principal);
                                                                IF CustomerRec.Blocked IN [CustomerRec.Blocked::Invoice, CustomerRec.Blocked::All] THEN
                                                                  ERROR(Text012, FIELDCAPTION(Principal), Principal);

                                                                IF Principal <> xRec.Principal THEN BEGIN
                                                                  "Contact Person No." := '';
                                                                  CALCFIELDS("Contact No.");
                                                                  IF CustomerRec."Primary Contact No." <> "Contact No." THEN
                                                                    "Contact Person No." := CustomerRec."Primary Contact No.";
                                                                  CALCFIELDS("Contact Person Name");
                                                                END;

                                                                "Cost Object" := CustomerRec."Cost Object";
                                                                "VAT Bus. Posting Group" := CustomerRec."VAT Bus. Posting Group";
                                                                "VAT Prod. Posting Group" := CustomerRec."VAT Prod. Posting Group";
                                                                IF ProjRec.GET("Project No.") THEN;
                                                                IF ((CustomerRec."% Labor" <> 0) OR
                                                                   (CustomerRec."% to B Account" <> 0 ) ) AND
                                                                   (ProjRec."Contract Type" = ProjRec."Contract Type"::Subcontracting)
                                                                THEN BEGIN
                                                                  "% Labor" := CustomerRec."% Labor";
                                                                  "% to B Account" := CustomerRec."% to B Account";
                                                                  "Specific WKA Percentages" := TRUE;
                                                                END;

                                                                IF CustomerRec."Bill-to Customer No." = '' THEN
                                                                  VALIDATE("Bill-to Customer No.", CustomerRec."No.")
                                                                ELSE
                                                                  VALIDATE("Bill-to Customer No.", CustomerRec."Bill-to Customer No.");

                                                                IF (CustomerRec."Currency Code" <> '') THEN
                                                                 IF  (CONFIRM(Text013, FALSE, CustomerRec."Currency Code") = TRUE) THEN
                                                                   VALIDATE("Currency Code", CustomerRec."Currency Code");
                                                              END;

                                                   CaptionML=[ENU=Principal;
                                                              NOR=Oppdragsgiver;
                                                              SVE=Uppdragsgivare];
                                                   NotBlank=Yes }
    { 21  ;   ;Principal Name      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Principal)));
                                                   CaptionML=[ENU=Principal Name;
                                                              NOR=Oppdragsgivers navn;
                                                              SVE=Uppdragsgivarens namn];
                                                   Editable=No }
    { 22  ;   ;Principal Reference ;Text50        ;CaptionML=[ENU=Principal Reference;
                                                              NOR=Oppdragsgiverreferanse;
                                                              SVE=Uppdragsgivarreferens] }
    { 23  ;   ;Contact No.         ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Contact Business Relation"."Contact No." WHERE (Link to Table=CONST(Customer),
                                                                                                                       No.=FIELD(Principal)));
                                                   CaptionML=[ENU=Contact;
                                                              NOR=Kontaktperson;
                                                              SVE=Kontaktperson];
                                                   Editable=No }
    { 24  ;   ;Contact Person No.  ;Code20        ;TableRelation=IF (Contact No.=FILTER(<>'')) Contact.No. WHERE (Type=CONST(Person),
                                                                                                                  Company No.=FIELD(Contact No.))
                                                                                                                  ELSE IF (Contact No.=FILTER('')) Contact.No. WHERE (Company No.=CONST(____________________),
                                                                                                                                                                      Type=CONST(Person));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Contact Person Name");
                                                                IF CurrFieldNo = FIELDNO("Contact Person No.") THEN
                                                                  VALIDATE("Bill-to Contact Person","Contact Person No.");
                                                              END;

                                                   CaptionML=[ENU=Contact Person No.;
                                                              NOR=Kontaktperson;
                                                              SVE=Kontaktperson] }
    { 25  ;   ;Settlement Method   ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Settlement Method" WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Settlement Method;
                                                              NOR=Oppgj›rsmetode;
                                                              SVE=Avr„kningsmetod];
                                                   OptionCaptionML=[ENU=Fixed Price,Cost Plus;
                                                                    NOR=Fast pris,L›pende;
                                                                    SVE=Fast pris,L”pande];
                                                   OptionString=Fixed Price,Cost Plus;
                                                   Editable=No }
    { 28  ;   ;Contact Person Name ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact Person No.)));
                                                   CaptionML=[ENU=Contact Person Name;
                                                              NOR=Kontaktpersonens navn;
                                                              SVE=Kontaktpersonens namn];
                                                   Editable=No }
    { 30  ;   ;Contract Amount (LCY);Decimal      ;OnValidate=BEGIN
                                                                TESTFIELD("Installments per Plot",FALSE);

                                                                ValidateContractAmountLCY;
                                                              END;

                                                   CaptionML=[ENU=Contract Amount (LCY);
                                                              NOR=Kontraktsbel›p (NOK);
                                                              SVE=Avtalsbelopp (BVA)];
                                                   AutoFormatType=1 }
    { 31  ;   ;Contract Amount     ;Decimal       ;OnValidate=VAR
                                                                CurrencyDate@1100525000 : Date;
                                                                Currency2@1100528200 : Record 4;
                                                              BEGIN
                                                                TESTFIELD("Installments per Plot",FALSE);

                                                                ProjRec.GET("Project No.");
                                                                ProjRec.CheckProjectStatus(ExtraStepProjectStatus());

                                                                IF ("Contract Amount" <> xRec."Contract Amount") AND "Installments Generated" THEN
                                                                  MESSAGE(Text000);

                                                                Currency2.InitRoundingPrecision;
                                                                IF "Currency Code" <> '' THEN BEGIN
                                                                  CurrencyDate := GetCurrencyDate;
                                                                  //C063484.sn
                                                                  "Contract Amount (LCY)" :=
                                                                    ROUND(
                                                                      CurrencyExchangeRateRec.ExchangeAmtFCYToLCY(
                                                                        1, "Project No.", CurrencyDate, "Currency Code", "Contract Amount",
                                                                        CurrencyExchangeRateRec.ExchangeRate(1, "Project No.", CurrencyDate, "Currency Code",TRUE),TRUE),
                                                                      Currency2."Amount Rounding Precision");
                                                                  //C063484.en
                                                                END ELSE BEGIN
                                                                  "Contract Amount (LCY)" := ROUND("Contract Amount",Currency2."Amount Rounding Precision");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Contract Amount;
                                                              NOR=Kontraktsbel›p;
                                                              SVE=Kontraktsbelopp];
                                                   AutoFormatType=1 }
    { 32  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                VALIDATE("Contract Amount");
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod] }
    { 35  ;   ;Plot Price          ;Decimal       ;OnValidate=BEGIN
                                                                ProjRec.GET("Project No.");
                                                                ProjRec.CheckProjectStatus(ExtraStepProjectStatus());
                                                                TESTFIELD("Installments per Plot",FALSE);
                                                                IF ("Plot Price" <> xRec."Plot Price") AND "Installments Generated" THEN
                                                                  MESSAGE(Text000);
                                                              END;

                                                   CaptionML=[ENU=Plot Price;
                                                              NOR=Tegningpris;
                                                              SVE=Ritningspris];
                                                   AutoFormatType=1 }
    { 37  ;   ;VAT Amount Long Lease;Decimal      ;CaptionML=[ENU=VAT Amount Long Lease;
                                                              NOR=Mva.-bel›p, lang leasingavtale;
                                                              SVE=Momsbelopp, l†ngt leasingavtal];
                                                   BlankZero=Yes;
                                                   AutoFormatType=1 }
    { 40  ;   ;Installments per Plot;Boolean      ;OnValidate=VAR
                                                                Plot@1100527550 : Record 11012500;
                                                              BEGIN
                                                                IF "Installments per Plot" THEN BEGIN
                                                                  TESTFIELD("Installment Scheme",'');
                                                                  TESTFIELD("Generate Installments",FALSE);

                                                                  CALCFIELDS("Building Price Plot Nos.", "Additional Costs Nos.", "Plot Price Plot Nos.");
                                                                  "Contract Amount (LCY)" := "Building Price Plot Nos." + "Additional Costs Nos.";
                                                                  ValidateContractAmountLCY;
                                                                  "Plot Price" := "Plot Price Plot Nos.";
                                                                  "VAT Amount Long Lease" := 0;
                                                                END ELSE
                                                                  IF xRec."Installments per Plot" <> "Installments per Plot" THEN BEGIN
                                                                    Plot.SETRANGE("Project No.", "Project No.");
                                                                    Plot.SETRANGE("Installments Generated", TRUE);
                                                                    IF NOT Plot.ISEMPTY THEN
                                                                      ERROR(Text015);
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Installments per Plot;
                                                              NOR=Avdrag per tegning;
                                                              SVE=Betalplaner per Ritning] }
    { 60  ;   ;Installment Scheme  ;Code10        ;TableRelation="Installment Scheme".Code WHERE (Type=CONST(Project));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Installments per Plot",FALSE);
                                                              END;

                                                   CaptionML=[ENU=Installment Scheme;
                                                              NOR=Betalingsplan;
                                                              SVE=Betalplan] }
    { 70  ;   ;Generate Installments;Boolean      ;OnValidate=BEGIN
                                                                TESTFIELD("Installments per Plot",FALSE);
                                                              END;

                                                   CaptionML=[ENU=Generate Installments;
                                                              NOR=Generer avdrag;
                                                              SVE=Generera avbetalningar] }
    { 80  ;   ;Installments Generated;Boolean     ;CaptionML=[ENU=Installments Generated;
                                                              NOR=Genererte avdrag;
                                                              SVE=Avbetalningar genererade] }
    { 90  ;   ;Generation Date     ;Date          ;CaptionML=[ENU=Generation Date;
                                                              NOR=Genereringsdato;
                                                              SVE=Genererandedatum];
                                                   Editable=No }
    { 100 ;   ;Alternative Bill-to Address;Code10 ;TableRelation="Ship-to Address".Code WHERE (Customer No.=FIELD(Bill-to Customer No.),
                                                                                               Billing Address=CONST(Yes));
                                                   OnValidate=BEGIN
                                                                CheckInvoiceAddress;
                                                              END;

                                                   CaptionML=[ENU=Alternative Bill-to Address;
                                                              NOR=Alternativ Faktureringsadresse;
                                                              SVE=Alternativ faktureringsadress] }
    { 110 ;   ;Cost Plus Customer  ;Boolean       ;OnValidate=BEGIN
                                                                IF "Cost Plus Customer" THEN BEGIN
                                                                  ProjPrincipalRec.RESET;
                                                                  ProjPrincipalRec.SETFILTER("Project No.","Project No.");
                                                                  ProjPrincipalRec.SETFILTER(Principal,'<>%1',Principal);
                                                                  ProjPrincipalRec.SETRANGE("Cost Plus Customer", TRUE);
                                                                  IF ProjPrincipalRec.FIND('-') THEN
                                                                    ERROR(Text002,FIELDCAPTION("Cost Plus Customer"),ProjPrincipalRec.Principal);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Cost Plus Customer;
                                                              NOR=P†slagsh†ntering p† kunde;
                                                              SVE=Sj„lvkostnad, kund] }
    { 120 ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group";
                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Moms produktbokf›ringsmal;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 125 ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              NOR=Moms Bevegelsebokf›ringsmal;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 130 ;   ;Surcharge % Labor   ;Decimal       ;CaptionML=[ENU=Surcharge % Labor;
                                                              NOR=Tilleggsgebyrsprosent, arbeidskraft;
                                                              SVE=Till„ggsavgiftsprocent, arbetskraft] }
    { 140 ;   ;Surcharge % Material;Decimal       ;CaptionML=[ENU=Surcharge % Material;
                                                              NOR=Tilleggsgebyrsprosent, Materiale;
                                                              SVE=Till„ggsavgiftsprocent, material] }
    { 150 ;   ;Surcharge % Subcontr.;Decimal      ;CaptionML=[ENU=Surcharge % Subcontracting;
                                                              NOR=Tilleggsgebyrsprosent, underentrepen›r;
                                                              SVE=Till„ggsavgiftsprocent, Underentreprenad] }
    { 160 ;   ;Surcharge % Plant   ;Decimal       ;CaptionML=[ENU=Surcharge % Plant;
                                                              NOR=Tilleggsgebyrsprosent, maskin;
                                                              SVE=Till„ggsavgiftsprocent, Maskin] }
    { 170 ;   ;Surcharge % Sundry  ;Decimal       ;CaptionML=[ENU=Surcharge % Sundry;
                                                              NOR=P†slagssatser, diverse;
                                                              SVE=Till„ggsavgift %, diverse] }
    { 210 ;   ;Cost Object         ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Revenue),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              NOR=Kostobjekt;
                                                              SVE=Kostnadsobjekt];
                                                   CaptionClass='1,1,2' }
    { 230 ;   ;Meeting Date        ;Date          ;CaptionML=[ENU=Meeting Date;
                                                              NOR=M›tedato;
                                                              SVE=M”tesdatum] }
    { 240 ;   ;Meeting Time        ;Text30        ;CaptionML=[ENU=Meeting Time;
                                                              NOR=M›tetid;
                                                              SVE=M”testid] }
    { 250 ;   ;Invoice Text Installments;Text250  ;CaptionML=[ENU=Invoice Text Installments;
                                                              NOR=Fakturatekst, avdrag;
                                                              SVE=Fakturatext, avbetalningar] }
    { 255 ;   ;Invoice Text Cost Plus;Text250     ;CaptionML=[ENU=Invoice Text Cost Plus;
                                                              NOR=Fakturatekst, selvkost;
                                                              SVE=Fakturatext, sj„lvkostnad] }
    { 260 ;   ;No. of Plots Bought ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count(Plot WHERE (Project No.=FIELD(Project No.),
                                                                                 Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=No. of Plots Bought;
                                                              NOR=Antall tegninger kj›pt;
                                                              SVE=Antal Ritningar som har k”pts];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 270 ;   ;First Plot No.      ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Min(Plot."Plot No." WHERE (Project No.=FIELD(Project No.),
                                                                                          Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=First Plot No.;
                                                              NOR=F›rste tegningnr;
                                                              SVE=F”rsta Ritningnr];
                                                   Editable=No }
    { 280 ;   ;Total Extension Contract;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Extension Contract"."Contract Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                                       Principal=FIELD(Principal),
                                                                                                                       Status=FILTER(Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total Extension Contract;
                                                              NOR=ETA-kontrakt Totalt;
                                                              SVE=ŽTA-kontrakt totalt];
                                                   Editable=No }
    { 300 ;   ;Building Price Plot Nos.;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum(Plot."Building Price" WHERE (Project No.=FIELD(Project No.),
                                                                                                Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=Building Price Plot Nos.;
                                                              NOR=Byggepris, tegningnr.;
                                                              SVE=Byggnadspris, Ritningnr];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 305 ;   ;Additional Costs Nos.;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum(Plot."Additional Costs" WHERE (Project No.=FIELD(Project No.),
                                                                                                  Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=Additional Costs Plot Nos.;
                                                              NOR=Tilleggskoster, tegningnr;
                                                              SVE=Till„ggskostnader, Ritningnr];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 310 ;   ;Plot Price Plot Nos.;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum(Plot."Plot Price" WHERE (Project No.=FIELD(Project No.),
                                                                                            Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=Plot Price Plot Nos.;
                                                              NOR=Tegningpris, tegningnr;
                                                              SVE=Ritning pris, Ritningnr];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 315 ;   ;Plot Mod. Options Plot Nos.;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum(Option."Contract Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                   Principal=FIELD(Principal),
                                                                                                   Modular=CONST(Yes),
                                                                                                   Status=FILTER(Order|Invoice)));
                                                   CaptionML=ENU=Plot Mod. Options Plot Nos.;
                                                   Editable=No }
    { 320 ;   ;Installm.Motivation Method;Option  ;OnValidate=VAR
                                                                TenderParagraphbyPrincipal@1100527300 : Record 11012470;
                                                              BEGIN
                                                                ProjRec.GET("Project No.");
                                                                IF ProjRec.RAW THEN BEGIN
                                                                  IF "Installm.Motivation Method" IN ["Installm.Motivation Method"::Points, "Installm.Motivation Method"::Percentages] THEN
                                                                    FIELDERROR("Installm.Motivation Method", STRSUBSTNO(Text010,"Installm.Motivation Method",ProjRec.FIELDCAPTION(RAW)));
                                                                END;

                                                                IF "Installm.Motivation Method" <> xRec."Installm.Motivation Method" THEN BEGIN
                                                                  CASE "Installm.Motivation Method" OF
                                                                    "Installm.Motivation Method"::Percentages:
                                                                      "Number of Points" := 100;
                                                                    ELSE
                                                                      "Number of Points" := 0;
                                                                  END;
                                                                  TenderParagraphbyPrincipal.CalcPointsPercentageForCurrentProjectPrincipal(Rec);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Installm.Motivation Method;
                                                              SVE=Metod f”r avbetalningsmotivation];
                                                   OptionCaptionML=[ENU=" ,Points,Percentages,Element Quantity";
                                                                    NOR=" ,Poeng,Prosent,Elementantall";
                                                                    SVE=" ,Po„ng,Procent,Elementantal"];
                                                   OptionString=[ ,Points,Percentages,Element Quantity];
                                                   Description=Should be equal to options of table 11012004 (field 800) }
    { 330 ;   ;Number of Points    ;Decimal       ;OnValidate=VAR
                                                                TenderParagraphbyPrincipal@1100527300 : Record 11012470;
                                                              BEGIN
                                                                IF "Number of Points" <> xRec."Number of Points" THEN
                                                                  TenderParagraphbyPrincipal.CalcPointsPercentageForCurrentProjectPrincipal(Rec);
                                                              END;

                                                   CaptionML=[ENU=Number of Points;
                                                              NOR=Antall poeng;
                                                              SVE=Antal po„ng] }
    { 340 ;   ;Invoice Installm.Motivation as;Option;
                                                   OnValidate=BEGIN
                                                                IF "Invoice Installm.Motivation as" <> xRec."Invoice Installm.Motivation as" THEN  BEGIN
                                                                  IF "Invoice Installm.Motivation as" <> "Invoice Installm.Motivation as"::"Fixed Installment Amounts" THEN BEGIN
                                                                    "Fixed Installment Amount (LCY)" := 0;
                                                                    "Fixed Installment Amount (FCY)" := 0;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Invoice Installm.Motivation as;
                                                              SVE=Betalplansfaktura. Motivation som];
                                                   OptionCaptionML=[ENU=Installment per Motivation,Fixed Installment Amounts;
                                                                    SVE=Betalplan per motivation,fasta avbetalningsbelopp];
                                                   OptionString=Installment per Motivation,Fixed Installment Amounts }
    { 344 ;   ;Direct Settle Underrun Settlin;Boolean;
                                                   OnValidate=BEGIN
                                                                IF "Direct Settle Underrun Settlin" THEN BEGIN
                                                                  ProjRec.GET("Project No.");
                                                                  ProjRec.TESTFIELD(RAW, TRUE);
                                                                END;

                                                                IF "Direct Settle Underrun Settlin" <> xRec."Direct Settle Underrun Settlin" THEN
                                                                  IF InstallmentOverviewExists THEN
                                                                    ERROR(Text014);
                                                              END;

                                                   CaptionML=ENU=Direct Settle Underrun (Settling) }
    { 345 ;   ;Direct Settle Underrun;Boolean     ;OnValidate=BEGIN
                                                                IF "Direct Settle Underrun" THEN BEGIN
                                                                  ProjRec.GET("Project No.");
                                                                  ProjRec.TESTFIELD(RAW, TRUE);
                                                                END;

                                                                IF "Direct Settle Underrun" <> xRec."Direct Settle Underrun" THEN
                                                                  IF InstallmentOverviewExists THEN
                                                                    ERROR(Text014);
                                                              END;

                                                   CaptionML=ENU=Direct Settle Underrun (Non Settling) }
    { 346 ;   ;Fictitious Amount Open (LCY);Decimal;
                                                   OnValidate=VAR
                                                                TenderElem@1100525000 : Record 11012470;
                                                                RaisePerc@1100525001 : Decimal;
                                                                CurrencyDate@1100529500 : Date;
                                                              BEGIN
                                                                IF NOT SkipValidateFCY THEN BEGIN
                                                                  CurrencyDate := GetCurrencyDate;
                                                                  "Fictitious Amount Open (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Fictitious Amount Open (LCY)", TRUE, FALSE, "Currency Code", "Project No.", Principal, CurrencyDate);
                                                                END;

                                                                ProjRec.GET("Project No.");
                                                                IF "Fictitious Amount Open (LCY)" <> 0 THEN
                                                                  ProjRec.TESTFIELD(RAW, TRUE);

                                                                IF ProjRec.RAW AND ("Fictitious Amount Open (LCY)" <> xRec."Fictitious Amount Open (LCY)") THEN BEGIN
                                                                  TenderElem.SETRANGE("Project No.", "Project No.");
                                                                  TenderElem.SETRANGE(Principal, Principal);
                                                                  TenderElem.SETRANGE("Contract No.", '');
                                                                  IF TenderElem.FINDFIRST THEN BEGIN
                                                                    RaisePerc := TenderElem.CalcRaisePerc(FALSE, "Fictitious Amount Open (LCY)");
                                                                    "Calc. Raise % Settlement Price" := RaisePerc;
                                                                    IF "Fixed Raise %" = FALSE THEN BEGIN
                                                                      IF "Act. Raise % Settlement Price" <> RaisePerc THEN
                                                                        VALIDATE("Act. Raise % Settlement Price", RaisePerc);
                                                                    END;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Fictitious Amount for Open (LCY);
                                                   MinValue=0;
                                                   BlankZero=Yes }
    { 347 ;   ;Fictitious Amount Open (FCY);Decimal;
                                                   OnValidate=VAR
                                                                CurrencyDate@1100529500 : Date;
                                                              BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                CurrencyDate := GetCurrencyDate;
                                                                VALIDATE("Fictitious Amount Open (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Fictitious Amount Open (FCY)", TRUE, FALSE, "Currency Code", "Project No.", Principal, CurrencyDate));
                                                              END;

                                                   CaptionML=ENU=Fictitious Amount for Open;
                                                   MinValue=0;
                                                   BlankZero=Yes }
    { 350 ;   ;Fixed Installment Amount (LCY);Decimal;
                                                   OnValidate=VAR
                                                                CurrencyDate@1100529500 : Date;
                                                              BEGIN
                                                                IF NOT SkipValidateFCY THEN BEGIN
                                                                  CurrencyDate := GetCurrencyDate;
                                                                  "Fixed Installment Amount (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Fixed Installment Amount (LCY)", TRUE, FALSE, "Currency Code", "Project No.", Principal, CurrencyDate);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Fixed Installment Amount (LCY);
                                                              SVE=Fast avbetalningsbelopp (BVA)] }
    { 351 ;   ;Fixed Installment Amount (FCY);Decimal;
                                                   OnValidate=VAR
                                                                CurrencyDate@1100529500 : Date;
                                                              BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                CurrencyDate := GetCurrencyDate;
                                                                VALIDATE("Fixed Installment Amount (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Fixed Installment Amount (FCY)", TRUE, FALSE, "Currency Code", "Project No.", Principal, CurrencyDate));
                                                              END;

                                                   CaptionML=[ENU=Fixed Installment Amount;
                                                              NOR=Fast avdragsbel›p;
                                                              SVE=Fast avbetalningsbelopp] }
    { 360 ;   ;Public notary       ;Code20        ;TableRelation=Customer.No.;
                                                   CaptionML=[ENU=Public notary;
                                                              NOR=Notarius publicus;
                                                              SVE=Notarius publicus] }
    { 370 ;   ;Withhold %          ;Decimal       ;CaptionML=[ENU=Withhold % Last Installment;
                                                              NOR=Tilbakehold % Forrige Avdrag;
                                                              SVE=Inneh†ll % av senaste avbetalning] }
    { 380 ;   ;Notary Case Number  ;Text30        ;CaptionML=[ENU=Notary Case Number;
                                                              NOR=Notariens Saksnummer;
                                                              SVE=Notariens „rendenummer] }
    { 390 ;   ;Specific WKA Percentages;Boolean   ;OnValidate=BEGIN
                                                                IF NOT "Specific WKA Percentages" THEN BEGIN
                                                                  "% Labor" := 0;
                                                                  "% to B Account":= 0;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Specific WKA Percentages;
                                                              NOR=Spesifike WKA-Prosentsatser;
                                                              SVE=Specifika WKA-procentsatser] }
    { 400 ;   ;% Labor             ;Decimal       ;CaptionML=[ENU=% Labor;
                                                              NOR=% arbeidskraft;
                                                              SVE=Procent, arbetskraft];
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   AutoFormatType=1 }
    { 410 ;   ;% to B Account      ;Decimal       ;CaptionML=[ENU=% to B Account;
                                                              NOR=% til B-konto;
                                                              SVE=Procent till B-konto];
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 415 ;   ;WKA Period          ;Text50        ;CaptionML=[ENU=WKA Period;
                                                              NOR=WKA-periode;
                                                              SVE=WKA-period] }
    { 418 ;   ;Order No. Customer  ;Text50        ;OnValidate=BEGIN
                                                                SyncProject;
                                                              END;

                                                   CaptionML=[ENU=Order No. Customer;
                                                              NOR=Ordrenr, (Kunde);
                                                              SVE=Ordernr, (kund)] }
    { 420 ;   ;Order Date          ;Date          ;OnValidate=BEGIN
                                                                SyncProject;
                                                                VALIDATE("Contract Amount");
                                                              END;

                                                   CaptionML=[ENU=Order Date;
                                                              NOR=Ordredato;
                                                              SVE=Orderdatum] }
    { 430 ;   ;Specific Payment Terms Code;Code10 ;TableRelation="Payment Terms";
                                                   CaptionML=[ENU=Specific Payment Terms Code;
                                                              NOR=Betalingsvilk†rskode;
                                                              SVE=Betalningsvillkorskod] }
    { 440 ;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Main Project No.;
                                                              NOR=Hovedprosjektnr.;
                                                              SVE=Huvudprojektnr] }
    { 450 ;   ;Bill-to Contact Person;Code20      ;TableRelation=Contact.No. WHERE (Company No.=FIELD(Bill-to Contact No.),
                                                                                    Type=CONST(Person));
                                                   OnValidate=BEGIN
                                                                IF "Bill-to Contact Person" <> '' THEN
                                                                  TESTFIELD("Bill-to Customer No.");

                                                                CALCFIELDS("Bill-to Contact Person Name");
                                                              END;

                                                   CaptionML=[ENU=Bill-to Contact Person;
                                                              NOR=Faktura til Kontaktperson;
                                                              SVE=Faktura till kontaktperson] }
    { 451 ;   ;Bill-to Contact Person Name;Text100;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Bill-to Contact Person)));
                                                   CaptionML=[ENU=Bill-to Contact Person Name;
                                                              NOR=Faktura til Kontaktperson, navn;
                                                              SVE=Faktura till kontaktperson, namn];
                                                   Editable=No }
    { 460 ;   ;Collect Installment Invoice By;Option;
                                                   CaptionML=[ENU=Collect Installment Invoice By;
                                                              SVE=Samla in avbetalningsfaktura efter];
                                                   OptionCaptionML=[ENU=Project,Principal,Plot,Contract Amount/Extensions;
                                                                    NOR=Prosjekt,Oppdragsgiver,Tegning,Kontraktsbel›p/ETA;
                                                                    SVE=Projekt,Uppdragsgivare,Ritning,Kontraktsbelopp/ŽTA];
                                                   OptionString=Project,Principal,Plot,Contract Amount/Extensions }
    { 469 ;   ;Fixed Raise %       ;Boolean       ;CaptionML=ENU=Fixed Raise % }
    { 470 ;   ;Act. Raise % Settlement Price;Decimal;
                                                   OnValidate=VAR
                                                                RAWCalculations@1100485000 : Codeunit 11012164;
                                                                UpdateSettlementPrice@1100528900 : Boolean;
                                                              BEGIN
                                                                TESTFIELD("Fixed Raise %",FALSE);
                                                                ProjRec.GET("Project No.");
                                                                IF ProjRec.RAW THEN BEGIN
                                                                  "Act. Raise % Settlement Price" := ROUND("Act. Raise % Settlement Price", 0.1);
                                                                  UpdateSettlementPrice := TRUE;
                                                                END;
                                                                IF UpdateSettlementPrice THEN BEGIN
                                                                  IF MODIFY THEN;  //next function activates CalcSettlementPrice and GetRaisePerc (TenderParagraphByPrincipal)
                                                                  RAWCalculations.CalculateSettlementPrices("Project No.", Principal, '',"Act. Raise % Settlement Price");
                                                                  UpdateSettlementPrice := FALSE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Actual Raise % Settlement Price;
                                                              NOR=k % oppgj›rspris;
                                                              SVE=H”j procentavr„kningspris] }
    { 471 ;   ;Calc. Raise % Settlement Price;Decimal;
                                                   CaptionML=ENU=Calculated Raise % Settlement Price;
                                                   Editable=No }
    { 472 ;   ;Contractor Fee      ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Fixed Raise %",FALSE);
                                                                ProjRec.GET("Project No.");
                                                                IF ProjRec.RAW THEN
                                                                  "Contractor Fee" := ROUND("Contractor Fee", 0.1);
                                                              END;

                                                   CaptionML=ENU=Contractor Fee;
                                                   BlankZero=Yes }
    { 475 ;   ;Surcharge %         ;Decimal       ;CaptionML=[ENU=Percentage Surcharge;
                                                              NOR=Prosent (tilleggsgebyr);
                                                              SVE=Procent (till„ggsavgift)] }
    { 480 ;   ;Adviser             ;Code20        ;TableRelation=Contact;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo > 0 THEN
                                                                  CALCFIELDS("Name Adviser");
                                                              END;

                                                   CaptionML=[ENU=Adviser;
                                                              NOR=R†dgiver;
                                                              SVE=Projekt”r] }
    { 485 ;   ;Name Adviser        ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Adviser)));
                                                   CaptionML=[ENU=Name Adviser;
                                                              NOR=R†dgivers navn;
                                                              SVE=Projekt”rens namn];
                                                   Editable=No }
    { 490 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line Extended" WHERE (Table1 Name=CONST(Job),
                                                                                                    Table1 No.=FIELD(Project No.),
                                                                                                    Table2 Name=CONST(Project Principal),
                                                                                                    Table2 No.=FIELD(Principal)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 500 ;   ;Tender Paragraph Scheme;Code10     ;TableRelation="Tender Paragraph Scheme.";
                                                   CaptionML=[ENU=Tender Paragraph Scheme;
                                                              NOR=Tilbudsavsnittskjema;
                                                              SVE=Anbudsstyckeschema] }
    { 501 ;   ;Quantity (Tender Paragraph);Decimal;CaptionML=[ENU=Quantity (Tender Paragraph);
                                                              NOR=Antall (Tilbudsavsnitt);
                                                              SVE=Antal (anbudsstycke)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 502 ;   ;Unit of Measure (Tender Par);Code10;TableRelation="Unit of Measure";
                                                   CaptionML=[ENU=Unit of Measure (Tender Paragraph);
                                                              NOR=Enhet (Tilbudsavsnitt);
                                                              SVE=Enhet (anbudsstycke)] }
    { 510 ;   ;Bill-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=VAR
                                                                BillToCustomer@1210190000 : Record 18;
                                                              BEGIN
                                                                IF "Bill-to Customer No." <> xRec."Bill-to Customer No." THEN BEGIN
                                                                  IF "Bill-to Customer No." <> '' THEN BEGIN
                                                                    BillToCustomer.GET("Bill-to Customer No.");
                                                                    BillToCustomer.CheckCustomerStatus("Bill-to Customer No.");

                                                                    GetDefaultSalesSurcharges;

                                                                    //>>4PS ORANGO.EE 181026 RFC-1056
                                                                    IF BillToCustomer."Sales Discount Term Group" <> '' THEN BEGIN
                                                                      ProjRec.VALIDATE("Sales Discount Term Percent", BillToCustomer."Sales Discount Term Percent");
                                                                      ProjRec.VALIDATE("Sales Discount Term Group 1", BillToCustomer."Sales Discount Term Group");
                                                                    END;

                                                                    IF BillToCustomer."Sales Discount Term Percent" <> 0 THEN BEGIN
                                                                      ProjRec.VALIDATE("Sales Discount Term Group 1", BillToCustomer."Sales Discount Term Group");
                                                                      ProjRec.VALIDATE("Sales Discount Term Percent", BillToCustomer."Sales Discount Term Percent");
                                                                    END;
                                                                    //<<4PS

                                                                    ProjRec.VALIDATE("Purch Discount Term Group 1", BillToCustomer."Purch Discount Term Group");
                                                                    ProjRec.VALIDATE("Sales Discount Term Group 1", BillToCustomer."Sales Discount Term Group");

                                                                    ProjRec."Calculate B Amounts based on" := BillToCustomer."Calculate B Amounts based on";

                                                                    IF BillToCustomer."VAT Prod. Posting Group" <> '' THEN
                                                                      ProjRec."VAT Prod. P. Group Inst. Int." := BillToCustomer."VAT Prod. Posting Group";

                                                                    IF "Invoice Text Installments" = '' THEN
                                                                      "Invoice Text Installments" := BillToCustomer."Invoice Text Installments";
                                                                  END;

                                                                  "Bill-to Contact Person" := '';
                                                                  CALCFIELDS("Bill-to Contact No.");
                                                                  IF BillToCustomer."Primary Contact No." <> "Bill-to Contact No." THEN
                                                                    "Bill-to Contact Person" := BillToCustomer."Primary Contact No.";
                                                                  CALCFIELDS("Bill-to Contact Person Name");
                                                                END;

                                                                CheckInvoiceAddress;
                                                              END;

                                                   CaptionML=[ENU=Bill-to Customer No.;
                                                              NOR=Faktureringskundenr;
                                                              SVE=Faktureringskundnr] }
    { 520 ;   ;Bill-to Name        ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Name;
                                                              NOR=Faktureringsnavn;
                                                              SVE=Faktureringsnamn];
                                                   Editable=No }
    { 530 ;   ;Bill-to Name 2      ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Name 2" WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Name 2;
                                                              NOR=Faktureringsnavn 2;
                                                              SVE=Faktureringsnamn 2];
                                                   Editable=No }
    { 540 ;   ;Bill-to Address     ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Address WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Address;
                                                              NOR=Faktureringsadresse;
                                                              SVE=Faktureringsadress];
                                                   Editable=No }
    { 550 ;   ;Bill-to Address 2   ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Address 2" WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Address 2;
                                                              NOR=Faktureringsadresse 2;
                                                              SVE=Faktureringsadress 2];
                                                   Editable=No }
    { 560 ;   ;Bill-to Post Code   ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Post Code" WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Post Code;
                                                              NOR=Faktura til-postnr.;
                                                              SVE=Faktureras postnr];
                                                   Editable=No }
    { 570 ;   ;Bill-to City        ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.City WHERE (No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to City;
                                                              NOR=Faktureringsby;
                                                              SVE=Faktureras ort];
                                                   Editable=No }
    { 580 ;   ;Bill-to Contact No. ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Contact Business Relation"."Contact No." WHERE (Link to Table=CONST(Customer),
                                                                                                                       No.=FIELD(Bill-to Customer No.)));
                                                   CaptionML=[ENU=Bill-to Contact No.;
                                                              NOR=Faktura til-kontaktnr.;
                                                              SVE=Faktureringskontaktnr];
                                                   Editable=No }
    { 590 ;   ;Price List          ;Code10        ;TableRelation="Price List".Code WHERE (Customer No.=FIELD(Principal),
                                                                                          Status=CONST(Open));
                                                   OnValidate=VAR
                                                                lvPriceListRec@1100485000 : Record 11020422;
                                                              BEGIN
                                                                IF "Price List" <> '' THEN BEGIN
                                                                  lvPriceListRec.GET(Principal, "Price List");
                                                                  lvPriceListRec.TESTFIELD(Status, lvPriceListRec.Status::Open);
                                                                  "Ref. Date Unit Price" := lvPriceListRec."Start Date";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Price List;
                                                              NOR=Prisliste;
                                                              SVE=Prislista] }
    { 600 ;   ;Ref. Date Unit Price;Date          ;CaptionML=[ENU=Reference Date Unit Price;
                                                              NOR=Referansedato for enhetspris;
                                                              SVE=Referensdatum f”r enhetspris] }
    { 610 ;   ;Direct Debit Mandate ID;Code35     ;TableRelation="SEPA Direct Debit Mandate" WHERE (Customer No.=FIELD(Bill-to Customer No.),
                                                                                                    Closed=CONST(No),
                                                                                                    Blocked=CONST(No),
                                                                                                    Mandate for Filter=CONST(Project),
                                                                                                    No. Mandate for Filter=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                IF "Direct Debit Mandate ID" <> '' THEN
                                                                  TESTFIELD("Bill-to Customer No.");
                                                              END;

                                                   CaptionML=[ENU=Direct Debit Mandate ID;
                                                              NOR=ID for Direct Debit-belastningsfullmakt;
                                                              SVE=Medgivande-ID f”r autogiro] }
    { 620 ;   ;Payment Method Code (Inv.);Code10  ;TableRelation="Payment Method";
                                                   CaptionML=[ENU=Payment Method Code (Invoicing);
                                                              SVE=Betalningss„ttkod (fakturering)] }
    { 630 ;   ;Estimated Amount    ;Decimal       ;OnValidate=BEGIN
                                                                IF "Estimated Amount" <> 0 THEN BEGIN
                                                                  CALCFIELDS("Settlement Method");
                                                                  TESTFIELD("Settlement Method", "Settlement Method"::"Cost Plus");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Estimated Amount;
                                                              NOR=Kalkulert bel›p;
                                                              SVE=Kalkylerat belopp];
                                                   BlankZero=Yes;
                                                   AutoFormatType=1 }
    { 635 ;   ;Estimate Date       ;Date          ;OnValidate=BEGIN
                                                                IF "Estimate Date" <> 0D THEN BEGIN
                                                                  CALCFIELDS("Settlement Method");
                                                                  TESTFIELD("Settlement Method", "Settlement Method"::"Cost Plus");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Estimate Date;
                                                              NOR=Kalkyledato;
                                                              SVE=Kalkyldatum] }
    { 690 ;   ;Starting Date Invoice Period;Date  ;OnValidate=BEGIN
                                                                CheckFirstDateOfWeek("Starting Date Invoice Period");
                                                              END;

                                                   CaptionML=ENU=Starting Date Invoice Period }
    { 691 ;   ;Date Formula Invoice Period;DateFormula;
                                                   CaptionML=ENU=Date Formula Invoice Period }
    { 700 ;   ;Summary Cost (RAW)  ;Option        ;CaptionML=ENU=Summary Cost (RAW);
                                                   OptionCaptionML=ENU=Amount,Percentage (Order),Percentage (Detail);
                                                   OptionString=Amount,Percentage (Order),Percentage (Detail) }
    { 710 ;   ;Percentage (Discount);Decimal      ;OnValidate=BEGIN
                                                                CheckElementExists(FIELDNO("Percentage (Surcharge)"));
                                                              END;

                                                   CaptionML=ENU=Percentage (Discount);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 720 ;   ;Percentage (Surcharge);Decimal     ;OnValidate=BEGIN
                                                                CheckElementExists(FIELDNO("Percentage (Surcharge)"));
                                                              END;

                                                   CaptionML=[ENU=Percentage (Surcharge);
                                                              NOR=Prosent (Tilleggsgebyr);
                                                              SVE=Procent (till„ggsavgift)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 721 ;   ;Percentage (Profit/Risk);Decimal   ;OnValidate=BEGIN
                                                                CheckElementExists(FIELDNO("Percentage (Profit/Risk)"));
                                                              END;

                                                   CaptionML=[ENU=Percentage (Profit/Risk);
                                                              NOR=Prosent (Fortjeneste/risk);
                                                              SVE=Procent (vinst/risk)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 722 ;   ;Percentage (ExecutionCost);Decimal ;OnValidate=BEGIN
                                                                CheckElementExists(FIELDNO("Percentage (ExecutionCost)"));
                                                              END;

                                                   CaptionML=ENU=Percentage (Execution Cost);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 723 ;   ;Percentage (ContractorFee);Decimal ;OnValidate=BEGIN
                                                                CheckElementExists(FIELDNO("Percentage (ContractorFee)"));
                                                              END;

                                                   CaptionML=ENU=Percentage (Contractor Fee);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 730 ;   ;Apply Perc. (Discount);Boolean     ;CaptionML=ENU=Apply Percentage (Discount) }
    { 740 ;   ;Apply Perc. (Surcharge);Boolean    ;CaptionML=ENU=Apply Percentage (Surcharge) }
    { 741 ;   ;Apply Perc. (Profit/Risk);Boolean  ;CaptionML=ENU=Apply Percentage (Profit/Risk) }
    { 742 ;   ;Apply Perc. (ExecutionCost);Boolean;CaptionML=ENU=Apply Percentage (Execution Cost) }
    { 743 ;   ;Apply Perc. (ContractorFee);Boolean;CaptionML=ENU=Apply Percentage (Contractor Fee) }
    { 750 ;   ;Ext. Contract Install. Scheme;Code10;
                                                   TableRelation="Installment Scheme" WHERE (Type=CONST(Project));
                                                   CaptionML=[ENU=Extension Contract Installment Scheme;
                                                              SVE=Betalplan f”r ŽTA] }
    { 11128230;;Method Last Installment;Option    ;OnValidate=BEGIN
                                                                // SESB.I022 KD 17.07.2013 >>
                                                                IF "Method Last Installment" <> xRec."Method Last Installment" THEN
                                                                  IF "Method Last Installment" = "Method Last Installment"::" " THEN BEGIN
                                                                    "Withheld Perc. Final Installm." := 0;
                                                                    "Withheld Perc. Contract Amount" := 0;
                                                                  END;
                                                                // SESB.I022 KD 17.07.2013 <<
                                                              END;

                                                   CaptionML=[ENU=Method Last Installment;
                                                              NOR=Fakturametode;
                                                              SVE=Slutfakturametod];
                                                   OptionCaptionML=[ENU=" ,Depot,Guarantee,Final Installment";
                                                                    NOR=" ,Depot,Garanti,Sluttfaktura";
                                                                    SVE=" ,Dep†,Garanti,Slutfaktura"];
                                                   OptionString=[ ,Depot,Guarantee,Final Installment];
                                                   Description=SESB.I022 }
    { 11128231;;Withheld Perc. Final Installm.;Decimal;
                                                   CaptionML=[ENU=Withheld Perc. per Installment;
                                                              NOR=Tilbakeholdt Prosent per avdrag;
                                                              SVE=Inneh†llet % per avbetalning];
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   Description=SESB.I022 }
    { 11128232;;Withheld Perc. Contract Amount;Decimal;
                                                   CaptionML=[ENU=Withheld Perc. Contract Amount;
                                                              NOR=Tilbakeholdt Prosent Kontraktsbel›p;
                                                              SVE=Inneh†llet % kontraktsbelopp];
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   Description=SESB.I022 }
    { 11128270;;Cost Price Behaviour;Boolean      ;OnValidate=BEGIN
                                                                CustomerRec.GET(Principal);
                                                                CustomerRec.TESTFIELD("Item Price Cost Plus Project",CustomerRec."Item Price Cost Plus Project"::GrossMin);
                                                              END;

                                                   CaptionML=[ENU=Apply cost price if price list not used;
                                                              NOR=Bruk kostpris hvis prisliste ikke er i bruk;
                                                              SVE=Applicera sj„lvkostnadspris om prislista inte anv„nds] }
    { 11128271;;Date/Time Last Modified;DateTime  ;CaptionML=[ENU=Date/Time Last Modified;
                                                              NOR=Dato/tid sist endret;
                                                              SVE=Senast „ndrad datum/tid] }
    { 11128272;;ROT Fixed Amount   ;Decimal       ;CaptionML=[ENU=ROT Fixed Amount;
                                                              NOR=ROT Í fast bel›p;
                                                              SVE=ROT avdragsbelopp] }
    { 11128280;;CostSurcharge % Labor;Decimal     ;CaptionML=[ENU=Cost Price adjustment % Labour;
                                                              NOR=Justering % selvkost arbeidskraft;
                                                              SVE=Justering % sj„lvkostnad arbetskraft] }
    { 11128281;;CostSurcharge % Material;Decimal  ;CaptionML=[ENU=Cost Price adjustment % Material;
                                                              NOR=Justering % selvkost materiale;
                                                              SVE=Justering % sj„lvkostnad material] }
    { 11128282;;CostSurcharge % Subcontr.;Decimal ;CaptionML=[ENU=Cost Price adjustment % Subcontracting;
                                                              NOR=Justering % selvkost underentrepren›r;
                                                              SVE=Justering % sj„lvkostnad, Underentreprenad] }
    { 11128283;;CostSurcharge % Plant;Decimal     ;CaptionML=[ENU=Cost Price adjustment % Plant;
                                                              NOR=Justering % selvkost maskin;
                                                              SVE=Justering % sj„lvkostnad maskin] }
    { 11128284;;CostSurcharge % Sundry;Decimal    ;CaptionML=[ENU=Cost Price adjustment % Sundry;
                                                              NOR=Justering % selvkost diverse;
                                                              SVE=Justering % sj„lvkostnad diverse] }
    { 11128285;;National customer  ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."National customer" WHERE (No.=FIELD(Principal)));
                                                   CaptionML=[ENU=National contract;
                                                              NOR=Nasjonal avtale;
                                                              SVE=Nationellt avtal] }
    { 11128900;;Retention %        ;Decimal       ;CaptionML=[ENU=Retention %;
                                                              NOR=Gjenv‘rende %;
                                                              SVE=Kvarst†ende procent];
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   Description=4PSNA }
    { 11128910;;Retention % 2      ;Decimal       ;CaptionML=[ENU=Retention % 2;
                                                              NOR=Gjenv‘rende % 2;
                                                              SVE=Kvarst†ende procent 2];
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   Description=4PSNA }
    { 11128920;;Retention Payment Terms Code;Code10;
                                                   TableRelation="Payment Terms";
                                                   CaptionML=[ENU=Retention Payment Terms Code;
                                                              NOR=Betalingsvilk†rskode for gjenv‘rende;
                                                              SVE=Kvarst†ende betalningsvillkorskod];
                                                   Description=4PSNA }
    { 11128930;;Retention Payment Terms Code 2;Code10;
                                                   TableRelation="Payment Terms";
                                                   CaptionML=[ENU=Retention Payment Terms Code 2;
                                                              NOR=Betalingsvilk†rskode 2 for gjenv‘rende;
                                                              SVE=Kvarst†ende betalningsvillkorskod 2];
                                                   Description=4PSNA }
  }
  KEYS
  {
    {    ;Project No.,Principal                   ;SumIndexFields=Contract Amount (LCY);
                                                   Clustered=Yes }
    {    ;Principal,Project No.                   ;SumIndexFields=Contract Amount (LCY) }
    {    ;Main Project No.,Project No.            ;SumIndexFields=Contract Amount (LCY) }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;Project No.,Principal,Principal Name,Contact No.,Contact Person No.,Contact Person Name }
  }
  CODE
  {
    VAR
      Text000@11012004 : TextConst 'ENU=Project Installments generated. Change them manually.;NOR=Prosjektavdrag er Generert. Endre dem manuelt.;SVE=Projektavbetalningar har genererats. Žndra dem manuellt.';
      Text001@1210190002 : TextConst 'ENU=Process stopped;NOR=Prosessen har stoppet;SVE=Processen har stannat';
      Text002@11012006 : TextConst 'ENU=%1 for this Project is %2.;NOR=%1 for dette prosjektet er %2.;SVE=%1 f”r det h„r projektet „r %2.';
      CustomerRec@11012000 : Record 18;
      ProjPrincipalRec@11012002 : Record 11012005;
      ProjEntryRec@1210190005 : Record 11072005;
      ProjRec@11012003 : Record 11072003;
      Text004@1210190000 : TextConst 'ENU="Invoiced Installment present; process stopped";NOR="Fakturert Avdrag tilstede; prosessen stoppet";SVE="Fakturerad aktuell avbetalning; processen stoppades"';
      Text005@1210190001 : TextConst 'ENU="Installments present; continue ?";NOR=Betalingsplaner finnes, fortsette?;SVE=Betalplaner finns, forts„tta?';
      Text006@1210190006 : TextConst 'ENU="Job Entry for Sales Invoice present; continue ?";NOR=Jobbtransaksjon finnes for salgsfaktura, fortsette?;SVE=Jobbtransaktion finns f”r f”rs„ljningsfaktura. Forts„tta?';
      gDelCompleteProject@1210190007 : Boolean;
      Text007@1210190008 : TextConst 'ENU="Invoiced Cost Plus Entry present; process stopped";NOR="Fakturert selvkosttransaksjon finnes; prosessen stoppet";SVE="Fakturerad aktuell redovisad sj„lvkostnad; processen stoppades"';
      Text010@1100485000 : TextConst 'ENU=''%1'' not allowed on Project with %2;NOR=%1'' er ikke tillatt for prosjekt med %2;SVE=''%1'' „r inte till†tet f”r projekt med %2';
      CustSurchRec@1100485001 : Record 11020367;
      Text011@1100525000 : TextConst 'ENU=%1 %2 only allowed on internal Project.;NOR=%1 %2 tillates kun for internt prosjekt.;SVE=%1 %2 till†ts endast f”r internt projekt.';
      CurrencyExchangeRateRec@1100525001 : Record 330;
      SkipValidation@1100525002 : Boolean;
      SkipCopySalesSurcharges@1210190003 : Boolean;
      ProjectSiteMgt@1100528300 : Codeunit 11012282;
      Text012@1100409000 : TextConst 'ENU=%1 %2 is blocked.;NOR=%1 %2 er blokkert.;SVE=%1 %2 „r sp„rrad.';
      Text013@1100525003 : TextConst 'ENU=Copy Currency %1 from de Customer to the Principal;NOR=Kopier Valuta %1 fra Kunde til Oppdragsgiver';
      Text014@1100528700 : TextConst 'ENU=Changing not allowed. Installment overview already exists.';
      SkipValidateFCY@1100525004 : Boolean;
      ProjectCurrencyExchangeRate@1100525005 : Record 11020628;
      Text015@1100527550 : TextConst 'ENU=Installments already present.';

    PROCEDURE GetDefaultSalesSurcharges@1();
    VAR
      lvCustRec@1100485002 : Record 18;
    BEGIN
      IF Principal = '' THEN
        EXIT;

      IF (Principal <> xRec.Principal) OR
         ("Bill-to Customer No." <> xRec."Bill-to Customer No.") THEN
      BEGIN
        IF "Bill-to Customer No." <> '' THEN
          lvCustRec.GET("Bill-to Customer No.")
        ELSE
          lvCustRec.GET(Principal);
        CopySalesSurcharges(lvCustRec);
        IF "Invoice Text Installments" = '' THEN
          "Invoice Text Installments" := lvCustRec."Invoice Text Installments";
        IF "Invoice Text Cost Plus" = '' THEN
          "Invoice Text Cost Plus" := lvCustRec."Invoice Text Cost Plus";
      END;
    END;

    PROCEDURE CopySalesSurcharges@1100525000(lvCustRec@1100525000 : Record 18);
    VAR
      lvCustSurchRec@1100525002 : Record 11020367;
      lvCustSurchRec2@1100525001 : Record 11020367;
    BEGIN
      "Surcharge % Labor" := lvCustRec."Surcharge % Labor";
      "Surcharge % Material" := lvCustRec."Surcharge % Material";
      "Surcharge % Subcontr." := lvCustRec."Surcharge % Subcontr.";
      "Surcharge % Plant" := lvCustRec."Surcharge % Plant";
      "Surcharge % Sundry" := lvCustRec."Surcharge % Sundry";

      IF SkipCopySalesSurcharges THEN
        SkipCopySalesSurcharges := FALSE
      ELSE BEGIN
        lvCustSurchRec2.SETRANGE("Record Type", lvCustSurchRec2."Record Type"::ProjCust);
        lvCustSurchRec2.SETRANGE("Customer No.", xRec.Principal);
        lvCustSurchRec2.SETRANGE(Code, "Project No.");
        lvCustSurchRec2.DELETEALL;

        lvCustSurchRec.SETRANGE("Record Type", lvCustSurchRec."Record Type"::Customer);
        lvCustSurchRec.SETRANGE("Customer No.", Principal);
        IF lvCustSurchRec.FINDSET(FALSE,FALSE) THEN BEGIN
          REPEAT
            lvCustSurchRec2 := lvCustSurchRec;
            lvCustSurchRec2."Record Type" := lvCustSurchRec2."Record Type"::ProjCust;
            lvCustSurchRec2."Customer No." := Principal;
            lvCustSurchRec2.Code := "Project No.";
            IF lvCustSurchRec2.INSERT THEN;
          UNTIL lvCustSurchRec.NEXT = 0;
        END;
      END;

      //code below doubles with getdefaultssalessurcharges related to external call
      IF "Invoice Text Installments" = '' THEN
        "Invoice Text Installments" := lvCustRec."Invoice Text Installments";
      IF "Invoice Text Cost Plus" = '' THEN
         "Invoice Text Cost Plus" := lvCustRec."Invoice Text Cost Plus";
    END;

    PROCEDURE InitRecord@1210190000();
    VAR
      lvProjSetupRec@1100525000 : Record 315;
    BEGIN
      lvProjSetupRec.GET;
      "Installments Generated" := FALSE;
      "Generation Date" := 0D;
      VALIDATE("Installments per Plot");
      CALCFIELDS("Settlement Method");
      IF "Settlement Method" = "Settlement Method"::"Cost Plus" THEN BEGIN
        //First Principal is Cost Plus Customer
        ProjPrincipalRec.RESET;
        ProjPrincipalRec.SETFILTER("Project No.","Project No.");
        IF ProjPrincipalRec.ISEMPTY THEN
          "Cost Plus Customer" := TRUE;
      END;
      "Collect Installment Invoice By" := lvProjSetupRec."Default Collect Inst. Inv. By";
    END;

    PROCEDURE SetDeleteCompleteProject@1210190003();
    BEGIN
      gDelCompleteProject := TRUE;
    END;

    PROCEDURE GenerateTenderParagraphs@1100525001();
    VAR
      TenderParagraphbyPrincipal@1100525001 : Record 11012470;
    BEGIN
      TenderParagraphbyPrincipal.GenerateTenderParagraphsByScheme("Project No.", Principal, '');
    END;

    PROCEDURE CheckInvoiceAddress@1210190002();
    VAR
      AdrsRec@1210190000 : Record 222;
    BEGIN
      IF AdrsRec.GET("Bill-to Customer No.", "Alternative Bill-to Address") THEN BEGIN
        "Bill-to Name" := AdrsRec.Name;
        "Bill-to Name 2" := AdrsRec."Name 2";
        "Bill-to Address" := AdrsRec.Address;
        "Bill-to Address 2" := AdrsRec."Address 2";
        "Bill-to Post Code" := AdrsRec."Post Code";
        "Bill-to City" := AdrsRec.City;
        VALIDATE("Bill-to Contact Person", AdrsRec."Contact No.");
      END ELSE
        CALCFIELDS("Bill-to Name","Bill-to Name 2","Bill-to Address","Bill-to Address 2","Bill-to Post Code","Bill-to City");
    END;

    PROCEDURE BuildRelationalStructure@1100525008(Action@1100525000 : Text[30]);
    VAR
      RelationalStructureMgt@1100525001 : Codeunit 11012238;
    BEGIN
      RelationalStructureMgt.BuildFromPrincipal(Rec, xRec, Action);
    END;

    LOCAL PROCEDURE SyncProject@1100525002();
    BEGIN
      IF ("Order No. Customer" <> xRec."Order No. Customer") OR
         ("Order Date" <> xRec."Order Date") THEN
      BEGIN
        ProjRec.GET("Project No.");
        IF ProjRec."Order No. Customer" = xRec."Order No. Customer" THEN BEGIN
          ProjRec."Order No. Customer" := "Order No. Customer";
          ProjRec."Commision Date Principal" := "Order Date";
          ProjRec.MODIFY;
        END;
      END;
    END;

    PROCEDURE ValidateContractAmountLCY@1100530000();
    VAR
      CurrencyDate@1100530001 : Date;
      Currency2@1100530000 : Record 4;
    BEGIN
      ProjRec.GET("Project No.");
      ProjRec.CheckProjectStatus(ExtraStepProjectStatus());

      IF ("Contract Amount (LCY)" <> xRec."Contract Amount (LCY)") AND "Installments Generated" THEN
        MESSAGE(Text000);

      Currency2.InitRoundingPrecision;
      IF "Currency Code" <> '' THEN BEGIN
        CurrencyDate := GetCurrencyDate;
        "Contract Amount" :=
          ROUND(
            CurrencyExchangeRateRec.ExchangeAmtLCYToFCY(
              1, "Project No.", CurrencyDate, "Currency Code", "Contract Amount (LCY)",
              CurrencyExchangeRateRec.ExchangeRate(1, "Project No.", CurrencyDate, "Currency Code",TRUE),TRUE),
            Currency2."Amount Rounding Precision");
      END ELSE
        "Contract Amount" := ROUND("Contract Amount (LCY)",Currency2."Amount Rounding Precision");
    END;

    PROCEDURE SetSkipValidation@1100525003();
    BEGIN
      SkipValidation := TRUE;
    END;

    PROCEDURE SetSkipCopySalesSurcharges@1210190001(Skip@1210190000 : Boolean);
    BEGIN
      SkipCopySalesSurcharges := Skip;
    END;

    PROCEDURE EditDocuments@1100528702(DocumentTemplateTypeFilter@1210190003 : Text[250];ContactNo@1210190004 : Code[20];ContactPersonNo@1210190005 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      Job@1210190006 : Record 11072003;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      IF Job.GET("Project No.") THEN BEGIN
        RecRef.GETTABLE(Job);
        DocumentLinkRIDs[2] := RecRef.RECORDID;
      END;

      DocumentMailing.EditDocuments(
        DocumentTemplateTypeFilter, DocumentLinkRIDs, '', ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE ExtraStepProjectStatus@1210190004() : Integer;
    VAR
      ProjSetupRec@1210190000 : Record 315;
    BEGIN
      ProjSetupRec.GET;
      IF ProjSetupRec."Provisions at Closure" THEN
        EXIT(-1);
      EXIT(0);
    END;

    PROCEDURE ShowDetails@1100528600();
    VAR
      Customer@1100528600 : Record 18;
    BEGIN
      Customer.GET(Principal);
      PAGE.RUN(PAGE::"Customer Card", Customer);
    END;

    PROCEDURE InstallmentOverviewExists@1100528700() : Boolean;
    VAR
      InstallmentOverview@1100528700 : Record 11012265;
    BEGIN
      InstallmentOverview.SETRANGE("Project No.", "Project No.");
      InstallmentOverview.SETRANGE(Principal, Principal);
      EXIT(NOT InstallmentOverview.ISEMPTY);
    END;

    LOCAL PROCEDURE GetCurrencyDate@1100525004() CurrencyDate : Date;
    BEGIN
      CurrencyDate := "Order Date";
      IF (CurrencyDate = 0D) THEN
        CurrencyDate := ProjRec."Starting Date";
      IF (CurrencyDate = 0D) THEN
        CurrencyDate := TODAY;
      EXIT(CurrencyDate);
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      SkipValidateFCY := ISkipValidateFCY;
    END;

    PROCEDURE UpdateTenderElementCurrencyData@1100525031(iProject@1100525001 : Code[20];iPrincipal@1100525004 : Code[20]);
    VAR
      ProjectPrincipal@1100525002 : Record 11012005;
      TenderParagraphbyPrincipal@1100525000 : Record 11012470;
      InstallmentMotivationLine@1100525005 : Record 11012472;
      InstallmentOverviewLine@1100525006 : Record 11012266;
    BEGIN
      ProjectPrincipal.GET(iProject, iPrincipal);

      WITH TenderParagraphbyPrincipal DO BEGIN
        SETFILTER("Project No.", iProject);
        SETFILTER(Principal, iPrincipal);
        IF FINDSET THEN BEGIN
          REPEAT
            VALIDATE("Unit Price (FCY)"); //including CalcRelatedFields (TotalAmount+SettlementPrice)
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END;

      WITH InstallmentMotivationLine DO BEGIN
        SETFILTER("Project No.", iProject);
        SETFILTER(Principal, iPrincipal);
        IF FINDSET THEN BEGIN
          REPEAT
            VALIDATE("Production Value (FCY)");
            VALIDATE("Production Value Cum. (FCY)");
            VALIDATE("Excess Prod. Value Cum. (FCY)");
            GetLineTotal;
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END;

      WITH InstallmentOverviewLine DO BEGIN
        SETFILTER("Project No.", iProject);
        SETFILTER(Principal, iPrincipal);
        IF FINDSET THEN BEGIN
          REPEAT
            VALIDATE("Production Value Cum. (FCY)");
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetExtensionAmount@1100529600(VAR ExtensionAmount@1100529603 : Decimal;VAR ExtensionAmountLCY@1100529604 : Decimal);
    VAR
      ExtensionContract@1100529600 : Record 11012004;
      Currency@1100529602 : Record 4;
      CurrencyDate@1100529601 : Date;
    BEGIN
      ExtensionAmount := 0;
      ExtensionAmountLCY := 0;

      ExtensionContract.SETRANGE("Project No.", "Project No.");
      ExtensionContract.SETRANGE(Principal, Principal);
      IF ExtensionContract.ISEMPTY THEN
        EXIT;

      ExtensionContract.CALCSUMS("Expected Contract Amount");
      ExtensionAmountLCY := ExtensionContract."Expected Contract Amount";
      IF "Currency Code" = '' THEN
        ExtensionAmount := ExtensionAmountLCY
      ELSE BEGIN
        Currency.Initialize("Currency Code");

        ExtensionContract.FINDSET;
        REPEAT
          CurrencyDate := ExtensionContract."Contract Date";
          IF CurrencyDate = 0D THEN
            CurrencyDate := TODAY;
          ExtensionAmount += ROUND(
            CurrencyExchangeRateRec.ExchangeAmtLCYToFCY(
              1, "Project No.", CurrencyDate, "Currency Code",
              ExtensionContract."Expected Contract Amount",
              CurrencyExchangeRateRec.ExchangeRate(1, "Project No.", CurrencyDate, "Currency Code", TRUE), TRUE),
            Currency."Amount Rounding Precision");
        UNTIL ExtensionContract.NEXT = 0;
      END;
    END;

    PROCEDURE CheckElementExists@1100525012(FieldNo@1100525000 : Integer);
    VAR
      TenderParagraphbyPrincipal@1100525002 : Record 11012470;
    BEGIN
      CASE FieldNo OF
        Rec.FIELDNO("Percentage (Discount)"):
          TenderParagraphbyPrincipal.CheckElementExists(TenderParagraphbyPrincipal.FIELDNO("Percentage (Discount)"), "Project No.", Principal, '');
        Rec.FIELDNO("Percentage (Surcharge)"):
          TenderParagraphbyPrincipal.CheckElementExists(TenderParagraphbyPrincipal.FIELDNO("Percentage (Surcharge)"), "Project No.", Principal, '');
        Rec.FIELDNO("Percentage (Profit/Risk)"):
          TenderParagraphbyPrincipal.CheckElementExists(TenderParagraphbyPrincipal.FIELDNO("Percentage (Profit/Risk)"), "Project No.", Principal, '');
        Rec.FIELDNO("Percentage (ExecutionCost)"):
          TenderParagraphbyPrincipal.CheckElementExists(TenderParagraphbyPrincipal.FIELDNO("Percentage (ExecutionCost)"), "Project No.", Principal, '');
        Rec.FIELDNO("Percentage (ContractorFee)"):
          TenderParagraphbyPrincipal.CheckElementExists(TenderParagraphbyPrincipal.FIELDNO("Percentage (ContractorFee)"), "Project No.", Principal, '');
      END;
    END;

    PROCEDURE CheckFirstDateOfWeek@1100525005(VAR StartDate@1100525000 : Date);
    VAR
      DayNo@1100525001 : Integer;
    BEGIN
      IF StartDate = 0D THEN EXIT;

      DayNo := DATE2DWY(StartDate,1);
      IF DayNo <> 1 THEN
        StartDate := StartDate - DayNo + 1;
    END;

    PROCEDURE GetOptionsContractAmount@1100527000() : Decimal;
    VAR
      Job@1100527000 : Record 11072003;
    BEGIN
      Job.GET("Project No.");
      Job.CALCFIELDS("Options Contract Amount");
      EXIT(Job."Options Contract Amount");
    END;

    PROCEDURE GetSummaryEntriesPercentage@1100527201() : Decimal;
    VAR
      SubTotal@1100527200 : Decimal;
      AmountSummaryEntries@1100527201 : Decimal;
      SummaryEntriesPercentage@1100527208 : Decimal;
      TenderParagraphByPrincipal@1100527202 : Record 11012470;
    BEGIN
      TenderParagraphByPrincipal.SETRANGE("Project No.", "Project No.");
      TenderParagraphByPrincipal.SETRANGE(Principal, Principal);
      TenderParagraphByPrincipal.SETFILTER("No.", '<>9*');
      TenderParagraphByPrincipal.SETRANGE("Contract No.",'');

      TenderParagraphByPrincipal.CALCSUMS("Total Amount (LCY)");
      SubTotal := TenderParagraphByPrincipal."Total Amount (LCY)";

      AmountSummaryEntries := GetSummaryEntriesAmount;

      IF SubTotal <> 0 THEN
        SummaryEntriesPercentage := ROUND(((AmountSummaryEntries / SubTotal) * 100), 0.1)
      ELSE
        EXIT;

      CLEAR(TenderParagraphByPrincipal);
      EXIT(SummaryEntriesPercentage);
    END;

    PROCEDURE GetSummaryEntriesAmount@1100527200() : Decimal;
    VAR
      AmountSummaryEntries@1100527201 : Decimal;
      EstimateSetupRAW@1100527204 : Record 11125673;
      ExecutionCostNo@1100527205 : Code[10];
      ProfitRiskNo@1100527206 : Code[10];
      SurchargeNo@1100527207 : Code[10];
      TenderParagraphByPrincipal@1100527200 : Record 11012470;
    BEGIN
      CLEAR(TenderParagraphByPrincipal);
      TenderParagraphByPrincipal.SETRANGE("Project No.", "Project No.");
      TenderParagraphByPrincipal.SETRANGE(Principal, Principal);
      TenderParagraphByPrincipal.SETRANGE("Contract No.",'');

      IF EstimateSetupRAW.GET THEN BEGIN
        SurchargeNo := EstimateSetupRAW."Paragraph No.(GeneralCost)";
        ExecutionCostNo := EstimateSetupRAW."Paragraph No.(ExecutionCost)";
        ProfitRiskNo := EstimateSetupRAW."Paragraph No.(Profit/Risk)";
      END ELSE
        EXIT(0);

      TenderParagraphByPrincipal.SETFILTER("No.", '%1|%2|%3', SurchargeNo, ExecutionCostNo, ProfitRiskNo);

      TenderParagraphByPrincipal.CALCSUMS("Total Amount (LCY)");
      AmountSummaryEntries := TenderParagraphByPrincipal."Total Amount (LCY)";

      CLEAR(TenderParagraphByPrincipal);
      EXIT(AmountSummaryEntries);
    END;

    PROCEDURE GetExpectedContractAmountLCY@1100528900() Result : Decimal;
    VAR
      CurrencyDate@1100528906 : Date;
      Currency2@1100528905 : Record 4;
      ProjectInstallment@1100528904 : Record 11012018;
      TotalContractInvoiced@1100528903 : Decimal;
      TotalContractInvoicedLCY@1100528902 : Decimal;
      ContractAmountRemaining@1100528901 : Decimal;
      ContractAmountRemainingLCY@1100528900 : Decimal;
    BEGIN
      //C063484: previously used at OnValidate(ContractAmountLCY)
      Currency2.InitRoundingPrecision;
      CurrencyDate := GetCurrencyDate;

      TotalContractInvoiced := 0;
      TotalContractInvoicedLCY := 0;

      ProjectInstallment.SETRANGE("Project No.", "Project No.");
      ProjectInstallment.SETRANGE(Principal, Principal);
      ProjectInstallment.SETFILTER("Extension Contract", '%1', '');
      ProjectInstallment.SETRANGE("Advance Payment", FALSE);
      IF ProjectInstallment.FINDSET THEN BEGIN
        REPEAT
          ProjectInstallment.CALCFIELDS("Invoice in Process","Invoice in Process (LCY)","Invoiced Price","Invoiced Price (LCY)");
          IF (ProjectInstallment."Invoice in Process" <> 0) OR (ProjectInstallment."Invoiced Price" <> 0) THEN BEGIN
            TotalContractInvoiced := TotalContractInvoiced + ProjectInstallment."Invoice in Process" + ProjectInstallment."Invoiced Price";
            TotalContractInvoicedLCY := TotalContractInvoicedLCY + ProjectInstallment."Invoice in Process (LCY)" + ProjectInstallment."Invoiced Price (LCY)";
          END;
        UNTIL ProjectInstallment.NEXT = 0;
      END;

      ContractAmountRemaining := "Contract Amount" - TotalContractInvoiced;
      ContractAmountRemainingLCY :=
        ROUND(
          CurrencyExchangeRateRec.ExchangeAmtFCYToLCY(
            1, "Project No.", CurrencyDate, "Currency Code", ContractAmountRemaining,
            CurrencyExchangeRateRec.ExchangeRate(1, "Project No.", CurrencyDate, "Currency Code",TRUE),TRUE),
          Currency2."Amount Rounding Precision");

      Result := ContractAmountRemainingLCY + TotalContractInvoicedLCY;

      EXIT(Result);
    END;

    BEGIN
    {
      4PS01 JD July, 21 2008 Call C-012772 Rounding of Settlement Prices is not correct
      4PS, 17-06-2014, C015923, SumIndexFields Contract Amount (LCY),Plot Price removed for better performance :)
      -SE EVRY-
      LAHE 130117 "Cost Price Behaviour"

      SESB.I022 Final Instalment
         KD 17.07.2013 Field 11128230 "Method Last Instalment" added
         KD 17.07.2013 Field 11128231 "Withheld Perc. Final Instalm." added
         KD 17.07.2013 Field 11128232 "Withheld Perc. Contract Amount" added

      ITERO.DJ ENH007 140123 added new caption to field "cost price behaviour"

      ITERO.MH 4PSHM 140131 New field "Date/Time Last Modified" and with triggers on onInsert() and onModify()
      ITERO.DJ 140325 ENH020 added field ROT fixed amount
      160317 ITERO.AC RFC082 Added new CostSurcharge fields
      181026 ORANGO.EE RFC-1056 - Check Sales Discount Term Group and Sales Discount Term Percent
      190124 ITERO.SB RFC-1164 Added field "National customer" (flowfield)
    }
    END.
  }
}

