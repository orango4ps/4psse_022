OBJECT XMLport 11012391 Import CUF-Budget
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Import CUF Budget;
               SVE=Import CUF Budget];
    Direction=Import;
    DefaultFieldsValidation=No;
    TextEncoding=WINDOWS;
    OnPreXMLport=BEGIN
                   LineCounter := 0;

                   BudgetRec.SETRANGE("Project No.", ProjectCde);
                   BudgetRec.SETRANGE("Extension Contract", ExtensionCde);
                   BudgetRec.SETRANGE(Adjustment, AdjustmentCde);
                   BudgetRec.SETRANGE(Option, OptionCde);
                   BudgetRec.SETRANGE("Settlement Quantity Code", SettlementQuantityCde);
                   IF BudgetRec.FINDLAST THEN
                     LineCounter := BudgetRec."Line No.";

                   IF (OptionCde = '') OR (ProjectCde <> '') THEN
                     ProjRec.GET(ProjectCde);
                 END;

    OnPostXMLport=VAR
                    lvSumSheetRec@1100525000 : Record 11012064;
                  BEGIN
                    WITH "Budget Line" DO BEGIN
                      IF OptionCde <> '' THEN BEGIN
                        BudgetRec.SETRANGE("Project No.", ProjectCde);
                        BudgetRec.SETRANGE(Adjustment, '');
                        BudgetRec.SETRANGE("Extension Contract", '');
                        BudgetRec.SETRANGE(Option, OptionCde);
                        BudgetRec.SETRANGE("Settlement Quantity Code", '');
                        BudgetRec.SETRANGE("Extension Contract Status", "Extension Contract Status"::Expired);
                        BudgetRec.DELETEALL(TRUE);
                      END;
                      IF SettlementQuantityCde <> '' THEN BEGIN
                        BudgetRec.SETRANGE("Project No.", ProjectCde);
                        BudgetRec.SETRANGE(Adjustment, '');
                        BudgetRec.SETRANGE("Extension Contract", '');
                        BudgetRec.SETRANGE(Option, '');
                        BudgetRec.SETRANGE("Settlement Quantity Code", SettlementQuantityCde);
                        BudgetRec.SETRANGE("Extension Contract Status", "Extension Contract Status"::Expired);
                        BudgetRec.DELETEALL(TRUE);
                      END;
                      lvSumSheetRec."Project No." := ProjectCde;
                      lvSumSheetRec."Contract No." := ExtensionCde;
                      lvSumSheetRec."Plot No." := PlotCde;
                      lvSumSheetRec."House Model" := HouseModelCde;
                      lvSumSheetRec."Main Group" := MainGroupCde;
                      lvSumSheetRec.Group := GroupCde;
                      lvSumSheetRec."Sub Group" := SubGroupCde;
                      lvSumSheetRec.Option := OptionCde;
                      lvSumSheetRec."Settlement Quantity Code" := SettlementQuantityCde;
                      IF OptionCde <> '' THEN BEGIN
                        lvSumSheetRec.ReCalcOptionSummaryLines();
                        lvSumSheetRec.UpdateOptBudgetLines();
                      END ELSE BEGIN
                        IF SettlementQuantityCde <> '' THEN BEGIN
                          lvSumSheetRec.ReCalcSettlQuanSummaryLines();
                          lvSumSheetRec.UpdateSettlQuanBudgLines();
                        END ELSE BEGIN
                          lvSumSheetRec.ReCalcSummaryLines(AdjustmentCde);
                          lvSumSheetRec.UpdateBudgetLines(TRUE,AdjustmentCde);
                        END;
                      END;
                      CheckUpdateOption();
                      CheckUpdateSettlQuantity();
                    END;
                  END;

    Format=Fixed Text;
    UseRequestPage=No;
  }
  ELEMENTS
  {
    { [{7C87238C-DB20-42C3-A89C-7538718D7BA2}];  ;Root                ;Element ;Text     }

    { [{08683A69-A7D8-41A0-BB45-553CA5168DC5}];1 ;BudgetLine          ;Element ;Table   ;
                                                  SourceTable=Table11012001;
                                                  SourceTableView=SORTING(Field1,Field31,Field33,Field38,Field14);
                                                  Import::OnAfterInitRecord=BEGIN
                                                                              "Budget Line".INIT;
                                                                              CLEAR(RecordType);
                                                                              CLEAR(Post);
                                                                              CLEAR(MaterialTxt);
                                                                              CLEAR(PlantTxt);
                                                                              CLEAR(SubcontractingTxt);
                                                                              CLEAR(Sort);
                                                                            END;

                                                  Import::OnBeforeInsertRecord=BEGIN
                                                                                 WITH "Budget Line" DO BEGIN

                                                                                 IF (RecordType <> 'BB') AND (RecordType <> 'BC') AND (RecordType <> 'BS') THEN
                                                                                   currXMLport.SKIP;

                                                                                 LineCreated := FALSE;
                                                                                 LineCounter := LineCounter + 10000;
                                                                                 "Line No." := LineCounter;
                                                                                 "Project No." := ProjectCde;
                                                                                 FillMainProject;
                                                                                 "Extension Contract" := ExtensionCde;
                                                                                 Adjustment := AdjustmentCde;
                                                                                 Option := OptionCde;
                                                                                 "Settlement Quantity Code" := SettlementQuantityCde;
                                                                                 "Time Quantity" := 1;
                                                                                 CLEAR("Option Line Type");
                                                                                 "Department Code" := ProjRec."Global Dimension 1 Code";

                                                                                 RecRef.GETTABLE("Budget Line");
                                                                                 XMLportStatusDialogMgt.ShowImportStatus(RecRef);

                                                                                 GetVersionDate;
                                                                                 UpdateExtContractStatus;

                                                                                 IF Option <> '' THEN BEGIN
                                                                                   "Extension Contract Status" := "Extension Contract Status"::Expired;
                                                                                   OptionRec.SETRANGE("Project No.","Project No.");
                                                                                   OptionRec.SETRANGE("Plot No.","Plot No.");
                                                                                   OptionRec.SETRANGE("House Model",HouseModelCde);
                                                                                   OptionRec.SETRANGE("Main Group",MainGroupCde);
                                                                                   OptionRec.SETRANGE(Group,GroupCde);
                                                                                   OptionRec.SETRANGE("Sub Group",SubGroupCde);
                                                                                   OptionRec.SETRANGE(Option,Option);
                                                                                   IF OptionRec.FINDFIRST THEN
                                                                                     "Version Date" := OptionRec."Version Date";
                                                                                 END;

                                                                                 IF "Settlement Quantity Code" <> '' THEN BEGIN
                                                                                   "Extension Contract Status" := "Extension Contract Status"::Expired;
                                                                                   SettlementQuantityRec.SETRANGE("Project No.","Project No.");
                                                                                   SettlementQuantityRec.SETRANGE("House Model",HouseModelCde);
                                                                                   SettlementQuantityRec.SETRANGE(Code, "Settlement Quantity Code");
                                                                                   IF SettlementQuantityRec.FINDFIRST THEN
                                                                                     "Version Date" := SettlementQuantityRec."Version Date";
                                                                                 END;

                                                                                 IF Element = '' THEN
                                                                                   Element := COPYSTR(Post, 1, MAXSTRLEN(Element));
                                                                                 IF NOT ElemRec.GET("Project No.", Element) THEN
                                                                                   Element := '';
                                                                                 FillElementPhaseCodeBasedOnElement;

                                                                                 "Cost Object" := Sort;

                                                                                 GetDefaultPurchAction;
                                                                                 "Cost Type" := "Cost Type"::Sundry;
                                                                                 Quantity := Quantity / 1000;

                                                                                 DimMgt.GetDimValueRec(2, Sort, DimValRec, FALSE,'');
                                                                                 IF (Norm <> 0) OR (Material <> 0) OR (Subcontracting <> 0) OR (Plant <> 0) THEN BEGIN
                                                                                   IF (DimValRec.Code = '') THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text999, FIELDCAPTION("Cost Object"), Sort));
                                                                                   IF (DimValRec.Code <> '') AND DimValRec.Blocked THEN
                                                                                     StoreMessage("Budget Line".Description, STRSUBSTNO(Text013,Sort));
                                                                                 END;

                                                                                 IF Norm <> 0 THEN BEGIN
                                                                                   "Cost Type" := "Cost Type"::Labor;
                                                                                   IF (DimValRec.Code <> '') AND (DimValRec."Cost Type" <> "Cost Type") THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text001, "Cost Type", DimValRec.Code));
                                                                                   Norm := Norm / 1000;
                                                                                   "Rate (LCY)" := "Rate (LCY)" / 100;
                                                                                   "Price (LCY)" := 0;
                                                                                   "Amount (LCY)" := 0;
                                                                                   "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                   FillDefaultFscType();
                                                                                   CalcTotals;
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                     INSERT
                                                                                   ELSE
                                                                                     AssignOptionBudget;
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   LineCreated := TRUE;
                                                                                 END;

                                                                                 IF Material <> 0 THEN BEGIN
                                                                                   "Cost Type" := "Cost Type"::Material;
                                                                                   IF (DimValRec.Code <> '') AND (DimValRec."Cost Type" <> "Cost Type") THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text001, "Cost Type", DimValRec.Code));
                                                                                   IF LineCreated THEN BEGIN
                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                   END;
                                                                                   "Price (LCY)" := Material / 100;
                                                                                   Norm := 0;
                                                                                   "Rate (LCY)" := 0;
                                                                                   "Rate Code" := '';
                                                                                   CalcTotals;
                                                                                   "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                   FillDefaultFscType();
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                     INSERT
                                                                                   ELSE
                                                                                     AssignOptionBudget;
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   LineCreated := TRUE;
                                                                                 END;

                                                                                 IF Plant <> 0 THEN BEGIN
                                                                                   "Cost Type" := "Cost Type"::Plant;
                                                                                   IF (DimValRec.Code <> '') AND (DimValRec."Cost Type" <> "Cost Type") THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text001, "Cost Type", DimValRec.Code));
                                                                                   IF LineCreated THEN BEGIN
                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                   END;
                                                                                   "Price (LCY)" := Plant / 100;
                                                                                   Norm := 0;
                                                                                   "Rate (LCY)" := 0;
                                                                                   "Rate Code" := '';
                                                                                   CalcTotals;
                                                                                   "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                   FillDefaultFscType();
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                     INSERT
                                                                                   ELSE
                                                                                     AssignOptionBudget;
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   LineCreated := TRUE;
                                                                                 END;

                                                                                 IF Subcontracting <> 0 THEN BEGIN
                                                                                   "Cost Type" := "Cost Type"::Subcontracting;
                                                                                   IF (DimValRec.Code <> '') AND (DimValRec."Cost Type" <> "Cost Type") THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text001, "Cost Type", DimValRec.Code));
                                                                                   IF LineCreated THEN BEGIN
                                                                                     LineCounter := LineCounter + 10000;
                                                                                     "Line No." := LineCounter;
                                                                                   END;
                                                                                   "Price (LCY)" := Subcontracting / 100;
                                                                                   Norm := 0;
                                                                                   "Rate (LCY)" := 0;
                                                                                   "Rate Code" := '';
                                                                                   CalcTotals;
                                                                                   "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                   FillDefaultFscType();
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                     INSERT
                                                                                   ELSE
                                                                                     AssignOptionBudget;
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   LineCreated := TRUE;
                                                                                 END;

                                                                                 IF (Norm = 0) AND (Material = 0) AND (Subcontracting = 0) AND (Plant = 0) THEN BEGIN
                                                                                   Norm := 0;
                                                                                   "Rate (LCY)" := 0;
                                                                                   "Rate Code" := '';
                                                                                   "Price (LCY)" := 0;
                                                                                   "Amount (LCY)" := 0;
                                                                                   CalcTotals;
                                                                                   "Cost Component" := DefaultCostComponent("Cost Object", "Project No.");
                                                                                   FillDefaultFscType();
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN
                                                                                     INSERT
                                                                                   ELSE
                                                                                     AssignOptionBudget;
                                                                                   IF (OptionCde = '') AND (SettlementQuantityCde = '') THEN UpdateCostControlStatus(0);
                                                                                   LineCreated := TRUE;
                                                                                 END;

                                                                                 IF "Unit of Measure" <> '' THEN
                                                                                   IF NOT UnitRec.GET("Unit of Measure") THEN
                                                                                     StoreMessage(Description, STRSUBSTNO(Text999, FIELDCAPTION("Unit of Measure"), "Unit of Measure"));

                                                                                 currXMLport.SKIP;

                                                                                 END;
                                                                               END;
                                                                                }

    { [{55F79B36-FFC8-4B1A-A4A1-D798752F7296}];2 ;RecordType          ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=3 }

    { [{362401F6-9B00-45A5-8F41-1E422C2D5FBC}];2 ;Filler1             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{41F26CED-8A21-41F6-899A-F5A4ADA692C4}];2 ;Post                ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=16 }

    { [{F874F8D3-4A0C-41B7-A70F-9D402D2CFF28}];2 ;Filler2             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{8E211DF7-1275-42B6-92F3-5BD923530CA0}];2 ;Description         ;Element ;Field   ;
                                                  DataType=Text;
                                                  SourceField=Budget Line::Description;
                                                  MinOccurs=Zero;
                                                  Width=40 }

    { [{546C32D8-3238-4566-AC3F-BE97B1C387D0}];2 ;Filler3             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{21AED4C1-5BED-4E55-BE2D-7A5003DAC644}];2 ;UnitOfMeasure       ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Unit of Measure;
                                                  MinOccurs=Zero;
                                                  Width=5 }

    { [{AC128943-20A3-45D5-BBBF-0145898EC932}];2 ;Filler4             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{7F500A1A-B331-41F0-851B-373D080C300A}];2 ;Quantity            ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Quantity;
                                                  MinOccurs=Zero;
                                                  Width=12 }

    { [{A0D3251C-4256-416D-A926-1E70FF3FD560}];2 ;Filler5             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{286DFB2F-DEE3-471D-919C-64BECAAAEE22}];2 ;Norm                ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Norm;
                                                  MinOccurs=Zero;
                                                  Width=11 }

    { [{CC3CAEE7-11D9-400E-A5E3-2AD4230831EE}];2 ;Filler6             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{1CFC41DC-622D-4630-B1A8-9DFC4FB42007}];2 ;Rate                ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Rate (LCY);
                                                  MinOccurs=Zero;
                                                  Width=10 }

    { [{B67301DF-AE7A-4797-8D49-B70119DE68C7}];2 ;Filler7             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{BE36D02B-F305-498C-85AF-280F14151893}];2 ;MaterialTxt         ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Import::OnAfterAssignVariable=BEGIN
                                                                                  FillEmptyTextWithZero(MaterialTxt);
                                                                                  EVALUATE(Material, MaterialTxt);
                                                                                END;

                                                  Width=14 }

    { [{2B84C99D-72F8-4DE5-AB2E-DAB7AE1612B7}];2 ;Filler8             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{013AEDB1-0DD9-4CE3-82E6-AF0A38DB6072}];2 ;PlantTxt            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Import::OnAfterAssignVariable=BEGIN
                                                                                  FillEmptyTextWithZero(PlantTxt);
                                                                                  EVALUATE(Plant, PlantTxt);
                                                                                END;

                                                  Width=14 }

    { [{6C43F76B-F725-4924-9E86-418E040EB7AC}];2 ;Filler9             ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{41A2193E-6BD4-48E3-99D9-01178F266BD3}];2 ;SubcontractingTxt   ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Import::OnAfterAssignVariable=BEGIN
                                                                                  FillEmptyTextWithZero(SubcontractingTxt);
                                                                                  EVALUATE(Subcontracting, SubcontractingTxt);
                                                                                END;

                                                  Width=14 }

    { [{3301CD0C-D10E-4364-92EB-900F15771242}];2 ;Filler10            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{C5810055-7832-41A9-B2D0-361ACB8E3F12}];2 ;Element             ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Element;
                                                  MinOccurs=Zero;
                                                  Width=16 }

    { [{EFACE76B-BC3A-482A-9AE0-DC93F60A5836}];2 ;Filler11            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{1653D151-6E9B-4E92-A87E-AF5EAA6666AC}];2 ;Sort                ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=16 }

  }
  EVENTS
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      BudgetRec@1100525024 : Record 11012001;
      ProjRec@1100525023 : Record 11072003;
      DimValRec@1100525022 : Record 349;
      ElemRec@1100525021 : Record 11012010;
      OptionBudgetRec@1100525020 : Record 11012503;
      OptionRec@1100525019 : Record 11012502;
      UnitRec@1100525018 : Record 204;
      RecRef@1100525014 : RecordRef;
      LineCounter@1100525017 : Integer;
      LineCreated@1100525016 : Boolean;
      Material@1100525015 : Decimal;
      Plant@1100525012 : Decimal;
      Subcontracting@1100525013 : Decimal;
      AdjustmentCde@1100525010 : Code[10];
      ExtensionCde@1100525009 : Code[10];
      HouseModelCde@1100525008 : Code[20];
      MainGroupCde@1100525007 : Code[20];
      GroupCde@1100525006 : Code[20];
      SubGroupCde@1100525005 : Code[20];
      OptionCde@1100525004 : Code[20];
      ProjectCde@1100525003 : Code[20];
      DimMgt@1100525001 : Codeunit 408;
      XMLportStatusDialogMgt@1100525025 : Codeunit 11130006;
      PlotCde@1100525000 : Code[20];
      Text001@1100525011 : TextConst 'ENU=Cost type %1 does not match Cost Object %2;SVE=Kostnadstypen %1 matchar inte kostnadsobjektet %2';
      Text013@1210190000 : TextConst 'ENU=Cost Object %1 is blocked;SVE=Kostnadsobjekt %1 „r blockerad';
      Text999@1100525002 : TextConst 'ENU=%1 %2 not present;SVE=%1 %2 finns inte';
      SettlementQuantityCde@1100528205 : Code[20];
      FromSettlementQuantity@1100528204 : Boolean;
      SettlementQuantityRec@1100528203 : Record 11072243;
      SettlementQuantityBudgetRec@1100528202 : Record 11072244;

    PROCEDURE DetermineSelection@1(Project1Cde@11012000 : Code[20];Adjustment1Cde@11012001 : Code[10];Extension1Cde@11012002 : Code[10];HouseModel1Cde@1210190003 : Code[20];MainGroup1Cde@1210190002 : Code[20];Group1Cde@1210190001 : Code[20];SubGroup1Cde@1210190000 : Code[20];Option1Cde@11012003 : Code[20];Plot1Cde@1100485000 : Code[20]);
    BEGIN
      ProjectCde := Project1Cde;
      AdjustmentCde := Adjustment1Cde;
      ExtensionCde := Extension1Cde;
      HouseModelCde := HouseModel1Cde;
      MainGroupCde := MainGroup1Cde;
      GroupCde := Group1Cde;
      SubGroupCde := SubGroup1Cde;
      OptionCde := Option1Cde;
      PlotCde := Plot1Cde;
    END;

    PROCEDURE AssignOptionBudget@3();
    VAR
      "Entry No."@11012000 : Integer;
    BEGIN
      IF SettlementQuantityCde <> '' THEN BEGIN
        AssignSettlQuantityBudget;
        EXIT;
      END;

      BudgetRec.COPY("Budget Line");

      OptionBudgetRec.SETRANGE("Project No.",ProjectCde);
      IF PlotCde <> '' THEN
        OptionBudgetRec.SETRANGE("Plot No.",PlotCde)
      ELSE
        OptionBudgetRec.SETFILTER("Plot No.",'%1','');
      OptionBudgetRec.SETRANGE("House Model",HouseModelCde);
      OptionBudgetRec.SETRANGE("Main Group",MainGroupCde);
      OptionBudgetRec.SETRANGE(Group,GroupCde);
      OptionBudgetRec.SETRANGE("Sub Group",SubGroupCde);
      OptionBudgetRec.SETRANGE(Option,OptionCde);
      IF NOT OptionBudgetRec.FINDLAST THEN
        "Entry No." := 10000
      ELSE
        "Entry No." := OptionBudgetRec."Line No." + 10000;

      OptionBudgetRec.INIT;
      OptionBudgetRec."Project No." := BudgetRec."Project No.";
      OptionBudgetRec."Plot No." := PlotCde;
      OptionBudgetRec."House Model" := HouseModelCde;
      OptionBudgetRec."Main Group" := MainGroupCde;
      OptionBudgetRec.Group := GroupCde;
      OptionBudgetRec."Sub Group" := SubGroupCde;
      OptionBudgetRec.Option := BudgetRec.Option;
      OptionBudgetRec.Element := BudgetRec.Element;
      OptionBudgetRec."Cost Object" := BudgetRec."Cost Object";
      OptionBudgetRec."Cost Component" := BudgetRec."Cost Component";
      OptionBudgetRec.Description := BudgetRec.Description;
      OptionBudgetRec.Quantity := BudgetRec.Quantity;
      OptionBudgetRec."Unit of Measure" := BudgetRec."Unit of Measure";
      OptionBudgetRec.Norm := BudgetRec.Norm;
      OptionBudgetRec."Rate Code" := BudgetRec."Rate Code";
      OptionBudgetRec.Rate := BudgetRec."Rate (LCY)";
      OptionBudgetRec.Hours := BudgetRec.Hours;
      OptionBudgetRec.Amount := BudgetRec."Amount (LCY)";
      OptionBudgetRec."Line No." := "Entry No.";
      OptionBudgetRec."Total Amount" := BudgetRec."Total Amount";
      OptionBudgetRec."Total Hours" := BudgetRec."Total Hours";
      OptionBudgetRec."Cost Type" := BudgetRec."Cost Type";
      OptionBudgetRec.Price := BudgetRec."Price (LCY)";
      OptionBudgetRec."Time Quantity" := BudgetRec."Time Quantity";
      OptionBudgetRec."Unit of Time" := BudgetRec."Unit of Time";
      OptionBudgetRec.Chapter := BudgetRec.Chapter;
      OptionBudgetRec.Paragraph := BudgetRec.Paragraph;

      OptionBudgetRec.CheckInsertSummarySheet(FALSE);  //* Must be done before INSERT, because of test 'only when first'.
      OptionBudgetRec.INSERT;
    END;

    PROCEDURE AssignSettlQuantityBudget@1100528205();
    VAR
      LastLino@11012000 : Integer;
    BEGIN
      BudgetRec.COPY("Budget Line");

      SettlementQuantityBudgetRec.SETRANGE("Project No.",ProjectCde);
      SettlementQuantityBudgetRec.SETRANGE("House Model",HouseModelCde);
      SettlementQuantityBudgetRec.SETRANGE("Settlement Quantity Code", SettlementQuantityCde);
      IF NOT SettlementQuantityBudgetRec.FINDLAST THEN
        LastLino := 10000
      ELSE
        LastLino := SettlementQuantityBudgetRec."Line No." + 10000;

      SettlementQuantityBudgetRec.INIT;
      SettlementQuantityBudgetRec."Project No." := BudgetRec."Project No.";
      SettlementQuantityBudgetRec."Settlement Quantity Code":= BudgetRec."Settlement Quantity Code";
      SettlementQuantityBudgetRec."House Model" := HouseModelCde;
      SettlementQuantityBudgetRec."Line No." := LastLino;
      SettlementQuantityBudgetRec.Element := BudgetRec.Element;
      SettlementQuantityBudgetRec."Cost Type" := BudgetRec."Cost Type";
      SettlementQuantityBudgetRec."Cost Object" := BudgetRec."Cost Object";
      SettlementQuantityBudgetRec.Description := BudgetRec.Description;
      SettlementQuantityBudgetRec."Cost Component" := BudgetRec."Cost Component";
      SettlementQuantityBudgetRec.Quantity := BudgetRec.Quantity;
      SettlementQuantityBudgetRec."Unit of Measure" := BudgetRec."Unit of Measure";
      SettlementQuantityBudgetRec.Norm := BudgetRec.Norm;
      SettlementQuantityBudgetRec."Rate Code" := BudgetRec."Rate Code";
      SettlementQuantityBudgetRec.Rate := BudgetRec."Rate (LCY)";
      SettlementQuantityBudgetRec.Hours := BudgetRec.Hours;
      SettlementQuantityBudgetRec.Amount := BudgetRec."Amount (LCY)";
      SettlementQuantityBudgetRec."Total Amount" := BudgetRec."Total Amount";
      SettlementQuantityBudgetRec."Total Hours" := BudgetRec."Total Hours";
      SettlementQuantityBudgetRec.Price := BudgetRec."Price (LCY)";
      SettlementQuantityBudgetRec."Time Quantity" := BudgetRec."Time Quantity";
      SettlementQuantityBudgetRec."Unit of Time" := BudgetRec."Unit of Time";
      SettlementQuantityBudgetRec.Chapter := BudgetRec.Chapter;
      SettlementQuantityBudgetRec.Paragraph := BudgetRec.Paragraph;

      SettlementQuantityBudgetRec.CheckInsertSummarySheet(FALSE);  //* Must be done before INSERT, because of test 'only when first'.
      SettlementQuantityBudgetRec.INSERT;
    END;

    PROCEDURE StoreMessage@5(lvDesc@11012000 : Text[100];lvMess@11012001 : Text[80]);
    VAR
      ErrorRec@1210190000 : Record 11012051;
      lvError@11012002 : Integer;
    BEGIN
      WITH ErrorRec DO BEGIN
        SETRANGE("User ID", USERID);
        SETRANGE("Source Type", "Source Type"::"Import Budget");
        IF FINDLAST THEN
          lvError := "Line No." + 1
        ELSE
          lvError := 1;

        INIT;
        "User ID" := USERID;
        "Source Type" := "Source Type"::"Import Budget";
        "Line No." := lvError;
        "Project No." := ProjRec."No.";
        "Error message" := lvMess;
        Description := lvDesc;
        INSERT;
      END;
    END;

    PROCEDURE CheckUpdateOption@1100485000();
    VAR
      lvDummyOptionSurchRec@1100485001 : Record 11012512;
      lvBuyerMgtCU@1100485000 : Codeunit 11012500;
    BEGIN
      IF OptionCde = '' THEN
        EXIT;

      lvBuyerMgtCU.BmCalcSurchargesUpdateOption(
        ProjectCde, PlotCde, HouseModelCde, MainGroupCde, GroupCde, SubGroupCde, OptionCde, FALSE, lvDummyOptionSurchRec);
    END;

    PROCEDURE DefaultCostComponent@1100485001(lvCostObject@1100485000 : Code[20];lvProject@1100485001 : Code[20]) lvCostComponent : Code[20];
    VAR
      lvDimValRec@1100485002 : Record 349;
    BEGIN
      lvCostComponent := '';
      IF lvCostObject <> '' THEN BEGIN
        DimMgt.GetDimValueRec(2, lvCostObject, lvDimValRec, FALSE, lvProject);
        IF NOT lvDimValRec.Blocked THEN
          lvCostComponent := lvDimValRec."Cost Component";
      END;
    END;

    PROCEDURE FillEmptyTextWithZero@1100525013(VAR Text@1100525000 : Text[1024]);
    BEGIN
      IF DELCHR(Text,'<>=',' ') = '' THEN
        Text := '0';
    END;

    PROCEDURE SetDefaultsSettlQuantity@1100528203(ISettlementQuantityCde@11012000 : Code[20]);
    BEGIN
      IF SettlementQuantityRec.WRITEPERMISSION AND SettlementQuantityBudgetRec.WRITEPERMISSION THEN BEGIN
        FromSettlementQuantity := TRUE;
        SettlementQuantityCde := ISettlementQuantityCde;
      END ELSE BEGIN
        FromSettlementQuantity := FALSE;
        SettlementQuantityCde := '';
      END;
    END;

    PROCEDURE CheckUpdateSettlQuantity@1100528200();
    VAR
      lvDummySettlementQuantitySurcharge@1100485001 : Record 11072247;
      lvSettlementQuantityManagement@1100485000 : Codeunit 11071690;
    BEGIN
      IF SettlementQuantityCde = '' THEN
        EXIT;

      lvSettlementQuantityManagement.MMRCalcSurchargesUpdateSettlQuan(
        ProjectCde, HouseModelCde, SettlementQuantityCde, FALSE,lvDummySettlementQuantitySurcharge)
    END;

    BEGIN
    END.
  }
}

