OBJECT Table 37 Sales Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.05,4PS14.00,NAVSE.FI.DK.NO,4PSSE;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               //**4PS.sn
               GetSalesHeader;
               IF SalesHeader.Status = SalesHeader.Status::Closed THEN
                 SalesHeader.FIELDERROR(Status);
               //**4PS.en
               TestStatusOpen;
               IF Quantity <> 0 THEN BEGIN
                 OnBeforeVerifyReservedQty(Rec,xRec,0);
                 ReserveSalesLine.VerifyQuantity(Rec,xRec);
               END;
               LOCKTABLE;
               SalesHeader."No." := '';
               IF Type = Type::Item THEN
                 IF SalesHeader.InventoryPickConflict("Document Type","Document No.",SalesHeader."Shipping Advice") THEN
                   ERROR(Text056,SalesHeader."Shipping Advice");
               IF ("Deferral Code" <> '') AND (GetDeferralAmount <> 0) THEN
                 UpdateDeferralAmounts;

               //**4PS.sn
               IF "Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"] THEN BEGIN
                 "Project Invoice" := SalesHeader."Project Invoice";
                 "Service Invoice" := SalesHeader."Service Invoice";
                 "Installment Invoice" := SalesHeader."Installment Invoice";
               END;
               IF "Rental Unit" = '' THEN
                 "Rental Unit Invoice" := FALSE
               ELSE
                 "Rental Unit Invoice" := TRUE;
               //**4PS.en
             END;

    OnModify=BEGIN
               //**4PS.sn
               GetSalesHeader;
               IF SalesHeader.Status = SalesHeader.Status::Closed THEN
                 SalesHeader.FIELDERROR(Status);
               IF (SalesHeader.Status = SalesHeader.Status::Released) AND
                  ("Document Type" = "Document Type"::Order) AND
                  (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated")
               THEN
                 SalesHeader.FIELDERROR(Status);
               IF "System-Created Entry" AND NOT "Removal Contribution" THEN BEGIN
                 SalesSetup.GET;
                 IF NOT SalesSetup."Generated Invoices Editable" THEN BEGIN
                   TESTFIELD("Project Invoice",FALSE);
                   IF Type <> Type::" " THEN
                     TESTFIELD("Service Invoice", FALSE);
                 END;
                 IF NOT (SalesHeader."Document Type" IN [SalesHeader."Document Type"::Invoice, SalesHeader."Document Type"::"Credit Memo", SalesHeader."Document Type"::"Invoice Proposal"]) THEN
                   TESTFIELD("Plant Invoice",FALSE);
               END;
               IF "Rental Unit" = '' THEN
                 "Rental Unit Invoice" := FALSE
               ELSE
                 "Rental Unit Invoice" := TRUE;
               ModifyForLogisticsSeparated;
               //**4PS.en

               IF ("Document Type" = "Document Type"::"Blanket Order") AND
                  ((Type <> xRec.Type) OR ("No." <> xRec."No."))
               THEN BEGIN
                 SalesLine2.RESET;
                 SalesLine2.SETCURRENTKEY("Document Type","Blanket Order No.","Blanket Order Line No.");
                 SalesLine2.SETRANGE("Blanket Order No.","Document No.");
                 SalesLine2.SETRANGE("Blanket Order Line No.","Line No.");
                 IF SalesLine2.FINDSET THEN
                   REPEAT
                     SalesLine2.TESTFIELD(Type,Type);
                     SalesLine2.TESTFIELD("No.","No.");
                   UNTIL SalesLine2.NEXT = 0;
               END;

               //IF ((Quantity <> 0) OR (xRec.Quantity <> 0)) AND ItemExists(xRec."No.") AND NOT FullReservedQtyIsForAsmToOrder THEN //**4PS.o DP00121
               IF ((Quantity <> 0) OR (xRec.Quantity <> 0)) AND (ItemExists(xRec."No.") OR NSItemExists(xRec."Item No.")) AND //**4PS.n DP00121
                  NOT FullReservedQtyIsForAsmToOrder THEN //**4PS.n DP00121
                 ReserveSalesLine.VerifyChange(Rec,xRec);

               //**4PS.sn
               IF xRec."Additional Cost (Service)" = "Additional Cost (Service)" THEN
                 CheckAdditionalCostService;

               IF ("Deferral Code" <> '') AND (GetDeferralAmount <> 0) AND (Description <> xRec.Description) THEN
                 UpdateDeferralAmounts;
               //**4PS.en
               //>>IME171
               DimMgt.SetDimensionValueChainsBool(TRUE);
               IF "Shortcut Dimension 1 Code" <> '' THEN ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
               IF "Shortcut Dimension 2 Code" <> '' THEN ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
               DimMgt.SetDimensionValueChainsBool(FALSE);
               //<<IME171
             END;

    OnDelete=VAR
               SalesCommentLine@1001 : Record 44;
               CapableToPromise@1000 : Codeunit 99000886;
               JobCreateInvoice@1002 : Codeunit 11072007;
               lvProjCostPlusRec@1100525001 : Record 11012019;
               lvContractObjectRec@1100526200 : Record 11071702;
               lvContractInstallmentRec@1100526201 : Record 11071707;
               lvServiceContractRec@1100528600 : Record 11012812;
               CollectiveListSCInvLine@1100528602 : Record 11071931;
               ProjectCollectiveList@1100528200 : Record 11071875;
               SalesRecipe@1100525002 : Record 11229788;
               RetentionLedgerEntry@10009000 : Record 11020636;
               PBCollectInstallOverview@1100528603 : Record 11072319;
               PBInstallmentOverviewMgt@1100528601 : Codeunit 11012887;
               AmountToInvoice@1100285000 : Decimal;
             BEGIN
               TestStatusOpen;

               //**4PS.sn
               IF ("Document Type" = "Document Type"::Order) AND (NOT StatusCheckSuspended) THEN
                 TESTFIELD("Quantity Invoiced", 0);

               IF PlantOrderIsProcessed(TRUE) THEN;

               GetSalesHeader;
               IF ("Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"]) AND
                  (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated")
               THEN BEGIN
                 IF ("Item No." <> '') OR
                    (("Plant Type" <> '') AND ("Relate to" <> "Relate to"::Rental)) OR
                    (("Relate to" = "Relate to"::Transport) AND
                     (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated"))
                 THEN BEGIN
                   SalesLine2.RESET;
                   SalesLine2.SETRANGE("Document Type", SalesLine2."Document Type"::Order);
                   SalesLine2.SETRANGE("Document No.", SalesHeader."Related Sales Order No.");
                   SalesLine2.SETRANGE("Line No.", "Line No.");
                   IF SalesLine2.FINDFIRST THEN BEGIN
                     IF "Document Type" = "Document Type"::"Credit Memo" THEN
                       SalesLine2."Quantity Invoiced" := SalesLine2."Quantity Invoiced" + Quantity
                     ELSE
                       SalesLine2."Quantity Invoiced" := SalesLine2."Quantity Invoiced" - Quantity;
                     IF SalesLine2."Quantity Invoiced" < 0 THEN
                       SalesLine2."Quantity Invoiced" := 0;
                     SalesLine2.MODIFY;
                     IF ("Item No." <> '') AND ("Arrival Date" = 0D) THEN BEGIN
                       SalesRentalRemovalLine.SETRANGE("Document No.", SalesLine2."Document No.");
                       SalesRentalRemovalLine.SETRANGE("Document Line No.", SalesLine2."Line No.");
                       SalesRentalRemovalLine.SETRANGE("Removed Item Invoiced", TRUE);
                       SalesRentalRemovalLine.MODIFYALL("Removed Item Invoiced", FALSE);
                     END;
                   END;
                 END;
               END;
               //**4PS.en


               IF (Quantity <> 0) AND ItemExists("No.") THEN BEGIN
                 ReserveSalesLine.DeleteLine(Rec);
                 CALCFIELDS("Reserved Qty. (Base)");
                 TESTFIELD("Reserved Qty. (Base)",0);
                 IF "Shipment No." = '' THEN
                   TESTFIELD("Qty. Shipped Not Invoiced",0);
                 IF "Return Receipt No." = '' THEN
                   TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                 WhseValidateSourceLine.SalesLineDelete(Rec);
               END;

               IF ("Document Type" = "Document Type"::Order) AND (Quantity <> "Quantity Invoiced") THEN
                 TESTFIELD("Prepmt. Amt. Inv.","Prepmt Amt Deducted");

               CleanDropShipmentFields;
               CleanSpecialOrderFieldsAndCheckAssocPurchOrder;
               CatalogItemMgt.DelNonStockSales(Rec);

               IF "Document Type" = "Document Type"::"Blanket Order" THEN BEGIN
                 SalesLine2.RESET;
                 SalesLine2.SETCURRENTKEY("Document Type","Blanket Order No.","Blanket Order Line No.");
                 SalesLine2.SETRANGE("Blanket Order No.","Document No.");
                 SalesLine2.SETRANGE("Blanket Order Line No.","Line No.");
                 IF SalesLine2.FINDFIRST THEN
                   SalesLine2.TESTFIELD("Blanket Order Line No.",0);
               END;

               IF Type = Type::Item THEN BEGIN
                 ATOLink.DeleteAsmFromSalesLine(Rec);
                 DeleteItemChargeAssgnt("Document Type","Document No.","Line No.");
               END;

               IF Type = Type::"Charge (Item)" THEN
                 DeleteChargeChargeAssgnt("Document Type","Document No.","Line No.");

               CapableToPromise.RemoveReqLines("Document No.","Line No.",0,FALSE);

               IF "Line No." <> 0 THEN BEGIN
                 SalesLine2.RESET;
                 SalesLine2.SETRANGE("Document Type","Document Type");
                 SalesLine2.SETRANGE("Document No.","Document No.");
                 SalesLine2.SETRANGE("Attached to Line No.","Line No.");
                 SalesLine2.SETFILTER("Line No.",'<>%1',"Line No.");
                 SalesLine2.DELETEALL(TRUE);
               END;

               IF "Job Contract Entry No." <> 0 THEN
                 JobCreateInvoice.DeleteSalesLine(Rec);

               SalesCommentLine.SETRANGE("Document Type","Document Type");
               SalesCommentLine.SETRANGE("No.","Document No.");
               SalesCommentLine.SETRANGE("Document Line No.","Line No.");
               IF NOT SalesCommentLine.ISEMPTY THEN
                 SalesCommentLine.DELETEALL;

               //**4PS.sn
               RetentionLedgerEntry.RESET;
               RetentionLedgerEntry.SETCURRENTKEY("Applied Document No.","Applied Line No.","Applied Document Type","Subcontract Type");
               RetentionLedgerEntry.SETRANGE("Applied Document No.","Document No.");
               RetentionLedgerEntry.SETRANGE("Applied Line No.","Line No.");
               RetentionLedgerEntry.SETRANGE("Applied Line No.","Line No.");
               RetentionLedgerEntry.SETRANGE("Subcontract Type",RetentionLedgerEntry."Subcontract Type"::Customer);
               RetentionLedgerEntry.SETRANGE("Related No.","Bill-to Customer No.");
               IF RetentionLedgerEntry.FINDSET(TRUE) THEN
                 REPEAT
                   RetentionLedgerEntry."Applies-to ID" := '';
                   RetentionLedgerEntry."Applied Document Type" := 0;
                   RetentionLedgerEntry."Applied Document No." := '';
                   RetentionLedgerEntry."Applied Line No." := 0;
                   RetentionLedgerEntry.Comment := '';
                   RetentionLedgerEntry.MODIFY;
                 UNTIL RetentionLedgerEntry.NEXT = 0;
               //**4PS.en

               // In case we have roundings on VAT or Sales Tax, we should update some other line
               IF (Type <> Type::" ") AND ("Line No." <> 0) AND ("Attached to Line No." = 0) AND ("Job Contract Entry No." = 0 ) AND
                  (Quantity <> 0) AND (Amount <> 0) AND (Amount <> "Amount Including VAT") AND NOT StatusCheckSuspended
               THEN BEGIN
                 Quantity := 0;
                 "Quantity (Base)" := 0;
                 "Line Discount Amount" := 0;
                 "Inv. Discount Amount" := 0;
                 "Inv. Disc. Amount to Invoice" := 0;
                 UpdateAmounts;
               END;

               IF "Deferral Code" <> '' THEN
                 DeferralUtilities.DeferralCodeOnDelete(
                   DeferralUtilities.GetSalesDeferralDocType,'','',
                   "Document Type","Document No.","Line No.");

               //**4PS.sn DP00481
               SalesRecipe.SETRANGE("Sales Document Type", "Document Type" );
               SalesRecipe.SETRANGE("Sales Document No.", "Document No.");
               SalesRecipe.SETRANGE("Sales Line No.", "Line No.");
               SalesRecipe.DELETEALL(TRUE);
               //**4PS.en DP00481

               //**4PS.sn
               IF "Project Invoice" THEN BEGIN
                 IF "Installment Invoice" THEN BEGIN
                   //Restore Installment Amounts to be invoiced
                   IF ProjInstalmRec.GET("Job No.","Sell-to Customer No.","Plot No.","Installment No.") THEN BEGIN
                     ProjInstalmRec.SetSuspendAmountCheck;
                     //*C-027814.so
                     //ProjInstalmRec.CALCFIELDS("Invoiced Price", "Invoice in Process", "Credit Memo in Process");
                     //ProjInstalmRec."Invoice Price" :=
                     //  ProjInstalmRec."Installment Amount" - ProjInstalmRec."Invoiced Price" -
                     //  ProjInstalmRec."Invoice in Process" - ProjInstalmRec."Credit Memo in Process";
                     //*C-027814.eo
                     IF "Document Type" = "Document Type"::"Credit Memo" THEN
                       ProjInstalmRec."Invoice Price" := ProjInstalmRec."Invoice Price" - Amount - RetentionAmount(0)
                     ELSE
                       ProjInstalmRec."Invoice Price" := ProjInstalmRec."Invoice Price" + Amount + RetentionAmount(0);
                     IF (ProjInstalmRec."Invoice Price" <> 0) AND
                        (((ProjInstalmRec."Installment Amount" >= 0) AND (ProjInstalmRec."Invoice Price" < 0)) OR
                         ((ProjInstalmRec."Installment Amount" <  0) AND (ProjInstalmRec."Invoice Price" > 0)))
                     THEN
                       ProjInstalmRec."Invoice Price" := 0;
                     IF (ProjInstalmRec.Points > 0) AND (ProjInstalmRec."Installment Amount" <> 0) THEN
                       ProjInstalmRec."Points to be invoiced" :=
                         ROUND(ProjInstalmRec."Invoice Price" / ProjInstalmRec."Installment Amount" * ProjInstalmRec.Points , 1);
                     ProjInstalmRec.VALIDATE("Invoice Price");
                     ProjInstalmRec.Chargeable := TRUE;  //C009275
                     ProjInstalmRec.MODIFY;
                   END;
                 END ELSE BEGIN
                   //Restore cost plus lines status as to be invoiced
                   IF CostPlusRec.GET(
                        "Job No.","Sell-to Customer No.","Commission No.","Settl.Sheet No.","Cost Plus Line No.") AND
               //     ("Document Type" <> "Document Type"::"Credit Memo") //C032087.o
                      (NOT "Copy of Document") //C032087.n
                   THEN BEGIN
                     IF CostPlusRec."Removal Contribution" = FALSE THEN BEGIN
                       CostPlusRec.Invoiced := FALSE;
                       CostPlusRec.Chargeable := TRUE;
                       CostPlusRec.MODIFY;
                       //
                       lvProjCostPlusRec.SETRANGE("Project No.", "Job No.");
                       lvProjCostPlusRec.SETRANGE(Principal, "Sell-to Customer No.");
                       lvProjCostPlusRec.SETRANGE("Commission No.", "Commission No.");
                       lvProjCostPlusRec.SETRANGE("Settl.Sheet No.", "Settl.Sheet No.");
                       lvProjCostPlusRec.SETRANGE("Removal Contribution", TRUE);
                       lvProjCostPlusRec.SETRANGE("Attached to Line No. (RC)", "Cost Plus Line No.");
                       IF lvProjCostPlusRec.FINDSET THEN BEGIN
                         REPEAT
                           lvProjCostPlusRec.Invoiced := FALSE;
                           lvProjCostPlusRec.Chargeable := TRUE;
                           lvProjCostPlusRec.MODIFY;
                         UNTIL lvProjCostPlusRec.NEXT = 0;

                         // Reset Collective List status
                         IF CostPlusRec."Collective List No." <> '' THEN
                           IF ProjectCollectiveList.GET(CostPlusRec."Collective List No.") THEN BEGIN
                             IF ProjectCollectiveList.Status <> ProjectCollectiveList.Status::Open THEN BEGIN
                               ProjectCollectiveList.Status := ProjectCollectiveList.Status::Open;
                               ProjectCollectiveList.MODIFY(TRUE);
                             END;
                           END;

                       END;
                     END;
                   END;
                 END;
               END;

               IF "Service Invoice" AND NOT "Copy of Document" THEN BEGIN
                 IF NOT lvServiceContractRec.GET("Service Contract No.") THEN
                   lvServiceContractRec.INIT;
                 IF "Document Type" <> "Document Type"::"Invoice Proposal" THEN BEGIN
                   IF "Installment Invoice" THEN BEGIN
                     //Restore Installment Amounts to be invoiced
                     IF lvContractInstallmentRec.GET("Service Contract No.", "Installment Line No.") THEN BEGIN
                       IF lvContractInstallmentRec."Last Invoiced Until" = "Prev. Invoiced Until" THEN BEGIN
                         lvContractInstallmentRec."Invoiced Until" := "Prev. Invoiced Until";
                         lvContractInstallmentRec."Last Invoiced Until" := "Prev. Last Invoiced Until";
                         lvContractInstallmentRec.Chargeable := TRUE;
                         lvContractInstallmentRec.MODIFY(TRUE);
                       END;
                     END;
                   END ELSE BEGIN
                     //Restore status of appropriate records as to be invoiced
                     IF ServCostPlusRec.GET("Service Order No.", "Cost Plus Line No.") THEN
                       MakeServiceCostPlusChargeable(ServCostPlusRec)
                     ELSE BEGIN
                       IF NOT IsConsumptionInvoice(Rec) AND NOT IsPBInstallmentOverviewInvoice(Rec) THEN BEGIN
                         CASE "Collective-List Line Type" OF
                           "Collective-List Line Type"::" ":
                             BEGIN
                               IF lvContractObjectRec.GET("Service Contract No.", "Object No.") THEN BEGIN
                                 lvContractObjectRec."Invoiced Until" := "Prev. Invoiced Until";
                                 lvContractObjectRec."Last Invoiced Until" := "Prev. Last Invoiced Until";
                                 lvContractObjectRec.MODIFY(TRUE);
                                 lvServiceContractRec."Invoiced Until" := lvServiceContractRec."Last Invoiced Until";
                                 lvServiceContractRec.MODIFY(TRUE);
                               END;
                             END;
                           "Collective-List Line Type"::Dynamic:
                             BEGIN
                               CollectiveListSCInvLine.SETCURRENTKEY("Service Contract No.");
                               CollectiveListSCInvLine.SETRANGE("Service Contract No.", "Service Contract No.");
                               CollectiveListSCInvLine.SETRANGE("Service Object No.", "Object No.");
                               CollectiveListSCInvLine.SETRANGE("Line No.", "Coll.-List SC Inv. Line No.");
                               IF NOT CollectiveListSCInvLine.ISEMPTY THEN
                                 CollectiveListSCInvLine.MODIFYALL(Invoiced, FALSE, TRUE);
                             END;
                           "Collective-List Line Type"::Installment:
                             BEGIN
                               CollectiveListSCInvLine.SETCURRENTKEY("Service Contract No.");
                               CollectiveListSCInvLine.SETRANGE("Service Contract No.", "Service Contract No.");
                               CollectiveListSCInvLine.SETRANGE("Installment Line No.", "Installment Line No.");
                               CollectiveListSCInvLine.SETRANGE("Line No.", "Coll.-List SC Inv. Line No.");
                               IF NOT CollectiveListSCInvLine.ISEMPTY THEN
                                 CollectiveListSCInvLine.MODIFYALL(Invoiced, FALSE, TRUE);
                             END;
                         END;
                       END ELSE
                         IF IsPBInstallmentOverviewInvoice(Rec) THEN
                           IF PBCollectInstallOverview.GET("PB Install. Collect. Over. No.") THEN
                             PBInstallmentOverviewMgt.RevertProcessedStatusInstallmentCollectionOverview(PBCollectInstallOverview);
                     END;
                   END;
                 END ELSE BEGIN
                 //**4PSmg, 21-04-11: M26893
                   IF "Installment Invoice" THEN BEGIN
                     IF lvContractInstallmentRec.GET("Service Contract No.", "Installment Line No.") THEN BEGIN
                       IF lvContractInstallmentRec."Last Invoiced Until" = "Prev. Invoiced Until" THEN BEGIN
                         lvContractInstallmentRec."Invoiced Until" := "Prev. Invoiced Until";
                         lvContractInstallmentRec."Last Invoiced Until" := "Prev. Last Invoiced Until";
                         lvContractInstallmentRec.Chargeable := TRUE;
                         lvContractInstallmentRec.MODIFY(TRUE);
                       END;
                     END;
                   END ELSE BEGIN
                     IF NOT IsConsumptionInvoice(Rec) THEN BEGIN
                       IF lvContractObjectRec.GET("Service Contract No.", "Object No.") THEN BEGIN
                         IF lvContractObjectRec."Last Invoiced Until" = "Prev. Invoiced Until" THEN BEGIN
                           lvContractObjectRec."Invoiced Until" := "Prev. Invoiced Until";
                           lvContractObjectRec."Last Invoiced Until" := "Prev. Last Invoiced Until";
                           lvContractObjectRec.MODIFY(TRUE);
                         END;
                       END;
                       IF lvServiceContractRec."No." <> '' THEN BEGIN
                         lvServiceContractRec."Invoiced Until" := lvServiceContractRec."Last Invoiced Until";
                         lvServiceContractRec.MODIFY(TRUE);
                       END;
                     END;
                   END;
                 END;
               END;

               IF "Plant Invoice" AND ("Service Order No." <> '') AND NOT "Copy of Document" THEN
                 IF ServCostPlusRec.GET("Service Order No.", "Cost Plus Line No.") THEN
                   MakeServiceCostPlusChargeable(ServCostPlusRec);
               //**4PS.en
             END;

    OnRename=BEGIN
               ERROR(Text001,TABLECAPTION);
             END;

    CaptionML=[ENU=Sales Line;
               NOR=Salgslinje;
               SVE=F”rs„ljningsrad];
    LookupPageID=Page11012065;
    DrillDownPageID=Page11012065;
  }
  FIELDS
  {
    { 1   ;   ;Document Type       ;Option        ;CaptionML=[ENU=Document Type;
                                                              NOR=Bilagstype;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=[ENU=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order,Invoice Proposal;
                                                                    NOR=Tilbud,Ordre,Faktura,Kreditnota,Rammeordre,Ordreretur;
                                                                    SVE=Offert,Order,Faktura,Kreditnota,Avropsorder,Returorder,Fakturaf”rslag];
                                                   OptionString=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order,Invoice Proposal;
                                                   Description=[4PS: Raam  -> Afroep  ] }
    { 2   ;   ;Sell-to Customer No.;Code20        ;TableRelation=Customer;
                                                   CaptionML=[ENU=Sell-to Customer No.;
                                                              NOR=Salg til-kundenr.;
                                                              SVE=F”rs.kundnr];
                                                   Editable=No }
    { 3   ;   ;Document No.        ;Code20        ;TableRelation="Sales Header".No. WHERE (Document Type=FIELD(Document Type));
                                                   CaptionML=[ENU=Document No.;
                                                              NOR=Bilagsnr.;
                                                              SVE=Dokumentnr] }
    { 4   ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 5   ;   ;Type                ;Option        ;OnValidate=VAR
                                                                TempSalesLine@1000 : TEMPORARY Record 37;
                                                              BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                GetSalesHeader;

                                                                TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Shipment No.",'');

                                                                TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                TESTFIELD("Return Qty. Received",0);
                                                                TESTFIELD("Return Receipt No.",'');

                                                                TESTFIELD("Prepmt. Amt. Inv.",0);

                                                                CheckAssocPurchOrder(FIELDCAPTION(Type));

                                                                IF Type <> xRec.Type THEN BEGIN
                                                                  //**4PS.sn
                                                                  IF "Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"] THEN BEGIN
                                                                    GetSalesHeader;
                                                                    IF SalesHeader."Project Invoice" THEN
                                                                      TESTFIELD(Type,Type::" "); //Only textlines allowed to change
                                                                  END;
                                                                  //**4PS.en
                                                                  CASE xRec.Type OF
                                                                    Type::Item:
                                                                      BEGIN
                                                                        ATOLink.DeleteAsmFromSalesLine(Rec);
                                                                        IF Quantity <> 0 THEN BEGIN
                                                                          SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);
                                                                          CALCFIELDS("Reserved Qty. (Base)");
                                                                          TESTFIELD("Reserved Qty. (Base)",0);
                                                                          //**4PS.sn DP00121
                                                                          CALCFIELDS("Reserved NS Qty. (Base)");
                                                                          TESTFIELD("Reserved NS Qty. (Base)",0);
                                                                          //**4PS.en
                                                                          ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                          WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                          OnValidateTypeOnAfterCheckItem(Rec,xRec);
                                                                        END;
                                                                      END;
                                                                    Type::"Fixed Asset":
                                                                      IF Quantity <> 0 THEN
                                                                        SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);
                                                                    Type::"Charge (Item)":
                                                                      DeleteChargeChargeAssgnt("Document Type","Document No.","Line No.");
                                                                  END;
                                                                  IF xRec."Deferral Code" <> '' THEN
                                                                    DeferralUtilities.RemoveOrSetDeferralSchedule('',
                                                                      DeferralUtilities.GetSalesDeferralDocType,'','',
                                                                      xRec."Document Type",xRec."Document No.",xRec."Line No.",
                                                                      xRec.GetDeferralAmount,xRec."Posting Date",'',xRec."Currency Code",TRUE);
                                                                END;
                                                                AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);
                                                                TempSalesLine := Rec;
                                                                IF NOT ("Project Invoice" OR "Service Invoice" OR "Plant Invoice" OR SalesLogisticsSepaRentContract) THEN BEGIN //**4PS.n
                                                                  INIT;
                                                                  IF xRec."Line Amount" <> 0 THEN
                                                                    "Recalculate Invoice Disc." := TRUE;
                                                                END; //**4PS.n
                                                                Type := TempSalesLine.Type;
                                                                "System-Created Entry" := TempSalesLine."System-Created Entry";
                                                                "Currency Code" := SalesHeader."Currency Code";

                                                                OnValidateTypeOnCopyFromTempSalesLine(Rec,TempSalesLine);

                                                                IF Type = Type::Item THEN
                                                                  "Allow Item Charge Assignment" := TRUE
                                                                ELSE
                                                                  "Allow Item Charge Assignment" := FALSE;
                                                                IF Type = Type::Item THEN BEGIN
                                                                  IF SalesHeader.InventoryPickConflict("Document Type","Document No.",SalesHeader."Shipping Advice") THEN
                                                                    ERROR(Text056,SalesHeader."Shipping Advice");
                                                                  IF SalesHeader.WhseShpmntConflict("Document Type","Document No.",SalesHeader."Shipping Advice") THEN
                                                                    ERROR(Text052,SalesHeader."Shipping Advice");
                                                                END;

                                                                //**4PS.sn
                                                                IF NOT ("Project Invoice" OR "Service Invoice" OR "Plant Invoice" OR SalesLogisticsSepaRentContract) THEN
                                                                  GetTemporarySalesLine(TempSalesLine);
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Type;
                                                              NOR=Type;
                                                              SVE=Typ];
                                                   OptionCaptionML=[ENU=" ,G/L Account,Item,Resource,Fixed Asset,Charge (Item)";
                                                                    NOR=" ,Finanskonto,Vare,Ressurs,Aktiva,Gebyr (vare)";
                                                                    SVE=" ,Redov.konto,Artikel,Resurs,Anl.tillg†ng,Omkostnad (artikel)"];
                                                   OptionString=[ ,G/L Account,Item,Resource,Fixed Asset,Charge (Item)] }
    { 6   ;   ;No.                 ;Code20        ;TableRelation=IF (Type=CONST(" ")) "Standard Text"
                                                                 ELSE IF (Type=CONST(G/L Account),
                                                                          System-Created Entry=CONST(No)) "G/L Account" WHERE (Direct Posting=CONST(Yes),
                                                                                                                               Account Type=CONST(Posting),
                                                                                                                               Blocked=CONST(No))
                                                                                                                               ELSE IF (Type=CONST(G/L Account),
                                                                                                                                        System-Created Entry=CONST(Yes)) "G/L Account"
                                                                                                                                        ELSE IF (Type=CONST(Resource)) Resource
                                                                                                                                        ELSE IF (Type=CONST(Fixed Asset)) "Fixed Asset"
                                                                                                                                        ELSE IF (Type=CONST("Charge (Item)")) "Item Charge"
                                                                                                                                        ELSE IF (Type=CONST(Item),
                                                                                                                                                 Document Type=FILTER(<>Credit Memo&<>Return Order)) Item WHERE (Blocked=CONST(No),
                                                                                                                                                                                                                 Sales Blocked=CONST(No))
                                                                                                                                                                                                                 ELSE IF (Type=CONST(Item),
                                                                                                                                                                                                                          Document Type=FILTER(Credit Memo|Return Order)) Item WHERE (Blocked=CONST(No));
                                                   OnValidate=VAR
                                                                TempSalesLine@1003 : TEMPORARY Record 37;
                                                                FindRecordMgt@1000 : Codeunit 703;
                                                                IsHandled@1001 : Boolean;
                                                                l_Customer@1100285000 : Record 18;
                                                              BEGIN
                                                                GetSalesSetup;
                                                                IF SalesSetup."Create Item from Item No." THEN
                                                                  "No." := FindRecordMgt.FindNoFromTypedValue(Type,"No.",NOT "System-Created Entry");

                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                CheckItemAvailable(FIELDNO("No."));

                                                                IF (xRec."No." <> "No.") AND (Quantity <> 0) THEN BEGIN
                                                                  TESTFIELD("Qty. to Asm. to Order (Base)",0);
                                                                  CALCFIELDS("Reserved Qty. (Base)");
                                                                  TESTFIELD("Reserved Qty. (Base)",0);
                                                                  IF Type = Type::Item THEN
                                                                    WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                  OnValidateNoOnAfterVerifyChange(Rec,xRec);
                                                                END;

                                                                TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Shipment No.",'');

                                                                TESTFIELD("Prepmt. Amt. Inv.",0);

                                                                TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                TESTFIELD("Return Qty. Received",0);
                                                                TESTFIELD("Return Receipt No.",'');

                                                                IF "No." = '' THEN
                                                                  ATOLink.DeleteAsmFromSalesLine(Rec);
                                                                CheckAssocPurchOrder(FIELDCAPTION("No."));
                                                                AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);

                                                                OnValidateNoOnBeforeInitRec(Rec,xRec,CurrFieldNo);
                                                                TempSalesLine := Rec;
                                                                IF NOT ("Project Invoice" OR "Service Invoice" OR "Plant Invoice" OR SalesLogisticsSepaRentContract) THEN BEGIN //**4PS.n
                                                                  INIT;
                                                                  IF xRec."Line Amount" <> 0 THEN
                                                                    "Recalculate Invoice Disc." := TRUE;
                                                                END; //**4PS.n
                                                                Type := TempSalesLine.Type;
                                                                "No." := TempSalesLine."No.";
                                                                OnValidateNoOnCopyFromTempSalesLine(Rec,TempSalesLine);
                                                                IF "No." = '' THEN
                                                                  EXIT;

                                                                IF HasTypeToFillMandatoryFields THEN
                                                                  Quantity := TempSalesLine.Quantity;

                                                                "System-Created Entry" := TempSalesLine."System-Created Entry";
                                                                IF NOT ("Project Invoice" OR "Service Invoice" OR "Plant Invoice" OR SalesLogisticsSepaRentContract) THEN  //**4PS.n
                                                                  GetTemporarySalesLine(TempSalesLine);  //**4PS.n
                                                                GetSalesHeader;
                                                                InitHeaderDefaults(SalesHeader);
                                                                OnValidateNoOnAfterInitHeaderDefaults(SalesHeader,TempSalesLine);

                                                                CALCFIELDS("Substitution Available");

                                                                "Promised Delivery Date" := SalesHeader."Promised Delivery Date";
                                                                "Requested Delivery Date" := SalesHeader."Requested Delivery Date";
                                                                //**4PS.sn
                                                                IF "Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"] THEN
                                                                  "Shipment Date" := SalesHeader."Shipment Date"
                                                                ELSE BEGIN
                                                                //**4PS.en
                                                                  "Shipment Date" :=
                                                                    CalendarMgmt.CalcDateBOC(
                                                                      '',SalesHeader."Shipment Date",CalChange."Source Type"::Location,"Location Code",'',
                                                                      CalChange."Source Type"::"Shipping Agent","Shipping Agent Code","Shipping Agent Service Code",FALSE);

                                                                  UpdateShippingTime; //**4PS.n
                                                                  IsHandled := FALSE;
                                                                  OnValidateNoOnBeforeUpdateDates(Rec,xRec,SalesHeader,CurrFieldNo,IsHandled,TempSalesLine);
                                                                  IF NOT IsHandled THEN
                                                                    UpdateDates;
                                                                END; //**4PS.n

                                                                OnAfterAssignHeaderValues(Rec,SalesHeader);

                                                                CASE Type OF
                                                                  Type::" ":
                                                                    CopyFromStandardText;
                                                                  Type::"G/L Account":
                                                                    CopyFromGLAccount;
                                                                  Type::Item:
                                                                    CopyFromItem;
                                                                  Type::Resource:
                                                                    CopyFromResource;
                                                                  Type::"Fixed Asset":
                                                                    CopyFromFixedAsset;
                                                                  Type::"Charge (Item)":
                                                                    CopyFromItemCharge;
                                                                END;

                                                                OnAfterAssignFieldsForNo(Rec,xRec,SalesHeader);

                                                                IF HasTypeToFillMandatoryFields AND (Type <> Type::"Fixed Asset") THEN
                                                                  VALIDATE("VAT Prod. Posting Group");

                                                                UpdatePrepmtSetupFields;

                                                                IF HasTypeToFillMandatoryFields THEN BEGIN
                                                                  VALIDATE("Unit of Measure Code");
                                                                  IF Quantity <> 0 THEN BEGIN
                                                                    InitOutstanding;
                                                                    IF IsCreditDocType THEN
                                                                      InitQtyToReceive
                                                                    ELSE
                                                                      InitQtyToShip;
                                                                    InitQtyToAsm;
                                                                    UpdateWithWarehouseShip;
                                                                  END;
                                                                  UpdateUnitPrice(FIELDNO("No."));
                                                                END;

                                                                OnValidateNoOnAfterUpdateUnitPrice(Rec,xRec);

                                                                CreateDim(
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Service Order","Service Order No.", //**4PS.n
                                                                  DATABASE::"Service-Contract","Service Contract No.", //**4PS.n
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Service Group", GetServiceObjectGroup); //**4PS.n

                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  IF Type = Type::Item THEN
                                                                    IF (Quantity <> 0) AND ItemExists(xRec."No.") THEN BEGIN
                                                                      ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                      WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                    END;
                                                                  GetDefaultBin;
                                                                  AutoAsmToOrder;
                                                                  DeleteItemChargeAssgnt("Document Type","Document No.","Line No.");
                                                                  IF Type = Type::"Charge (Item)" THEN
                                                                    DeleteChargeChargeAssgnt("Document Type","Document No.","Line No.");
                                                                END;

                                                                UpdateItemCrossRef;

                                                                PostingSetupMgt.CheckGenPostingSetupSalesAccount("Gen. Bus. Posting Group","Gen. Prod. Posting Group");
                                                                PostingSetupMgt.CheckGenPostingSetupCOGSAccount("Gen. Bus. Posting Group","Gen. Prod. Posting Group");
                                                                PostingSetupMgt.CheckVATPostingSetupSalesAccount("VAT Bus. Posting Group","VAT Prod. Posting Group");

                                                                //PSSE, construction tax (Byggmoms), corrected 02-01-2013
                                                                IF SalesHeader.GET("Document Type","Document No.") THEN
                                                                  IF l_Customer.GET(SalesHeader."Bill-to Customer No.") THEN
                                                                    IF l_Customer."VAT Prod. Posting Grp to lines" THEN
                                                                      VALIDATE("VAT Prod. Posting Group",l_Customer."VAT Prod. Posting Group");
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr.;
                                                              SVE=Nr];
                                                   CaptionClass=GetCaptionClass(FIELDNO("No.")) }
    { 7   ;   ;Location Code       ;Code10        ;TableRelation=Location WHERE (Use As In-Transit=CONST(No),
                                                                                 Project Filter=FIELD(Job No.));
                                                   OnValidate=VAR
                                                                Item@1000 : Record 27;
                                                                IsHandled@1001 : Boolean;
                                                              BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;

                                                                CheckLocationBlocked("Location Code"); //**4PS.n

                                                                CheckAssocPurchOrder(FIELDCAPTION("Location Code"));
                                                                IF "Location Code" <> '' THEN
                                                                  IF IsNonInventoriableItem THEN BEGIN
                                                                    GetItem(Item);
                                                                    Item.TESTFIELD(Type,Item.Type::Inventory);
                                                                  END;
                                                                IF xRec."Location Code" <> "Location Code" THEN BEGIN
                                                                  IF NOT FullQtyIsForAsmToOrder THEN BEGIN
                                                                    CALCFIELDS("Reserved Qty. (Base)");
                                                                    TESTFIELD("Reserved Qty. (Base)","Qty. to Asm. to Order (Base)");
                                                                  END;
                                                                  TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                  TESTFIELD("Shipment No.",'');
                                                                  TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                  TESTFIELD("Return Receipt No.",'');
                                                                END;

                                                                GetSalesHeader;
                                                                IsHandled := FALSE;
                                                                OnValidateLocationCodeOnBeforeSetShipmentDate(Rec,IsHandled);
                                                                IF NOT IsHandled THEN
                                                                  //**4PS.sn
                                                                  IF "Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"] THEN
                                                                    "Shipment Date" := SalesHeader."Shipment Date"
                                                                  ELSE
                                                                  //**4PS.en
                                                                    "Shipment Date" :=
                                                                      CalendarMgmt.CalcDateBOC(
                                                                        '',SalesHeader."Shipment Date",CalChange."Source Type"::Location,"Location Code",
                                                                        '',CalChange."Source Type"::"Shipping Agent","Shipping Agent Code","Shipping Agent Service Code",
                                                                        FALSE);

                                                                CheckItemAvailable(FIELDNO("Location Code"));

                                                                IF NOT "Drop Shipment" THEN BEGIN
                                                                  IF "Location Code" = '' THEN BEGIN
                                                                    IF InvtSetup.GET THEN
                                                                      "Outbound Whse. Handling Time" := InvtSetup."Outbound Whse. Handling Time";
                                                                  END ELSE
                                                                    IF Location.GET("Location Code") THEN
                                                                      "Outbound Whse. Handling Time" := Location."Outbound Whse. Handling Time";
                                                                END ELSE
                                                                  EVALUATE("Outbound Whse. Handling Time",'<0D>');

                                                                IF "Location Code" <> xRec."Location Code" THEN BEGIN
                                                                  InitItemAppl(TRUE);
                                                                  GetDefaultBin;
                                                                  InitQtyToAsm;
                                                                  AutoAsmToOrder;
                                                                  IF Quantity <> 0 THEN BEGIN
                                                                    IF NOT "Drop Shipment" THEN
                                                                      UpdateWithWarehouseShip;
                                                                    IF NOT FullReservedQtyIsForAsmToOrder THEN
                                                                      ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                    WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                  END;
                                                                  PostingSetupMgt.CheckInvtPostingSetupInventoryAccount("Location Code","Posting Group");
                                                                END;

                                                                //**4PS.sn
                                                                //*C007227.so
                                                                //CreateDim(
                                                                //  DATABASE::Item, "Item No.",
                                                                //  DATABASE::"Plant Type", "Plant Type",
                                                                //  DATABASE::Job,"Job No.",
                                                                //  DATABASE::"Service Order","Service Order No.",
                                                                //  DATABASE::"Service-Contract","Service Contract No.",
                                                                //  DATABASE::"Responsibility Center","Responsibility Center",
                                                                //  DATABASE::Location,"Location Code");  //**4PS.n
                                                                //*C007227.eo
                                                                //**4PS.en

                                                                UpdateDates;

                                                                //**4PS.so
                                                                //IF (Type = Type::Item) AND ("No." <> '') THEN
                                                                //  GetUnitCost;  //for SKU price not relevant (ItemCostMgt.UpdateSKUFromItem)
                                                                //**4PS.eo

                                                                CheckWMS;

                                                                IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                  ValidateReturnReasonCode(FIELDNO("Location Code"));

                                                                UpdateShelfNo; //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Location Code;
                                                              NOR=Lokasjonskode;
                                                              SVE=Lagerst„llekod];
                                                   Description=BIN }
    { 8   ;   ;Posting Group       ;Code20        ;TableRelation=IF (Type=CONST(Item)) "Inventory Posting Group"
                                                                 ELSE IF (Type=CONST(Fixed Asset)) "FA Posting Group";
                                                   CaptionML=[ENU=Posting Group;
                                                              NOR=Bokf›ringsgruppe;
                                                              SVE=Bokf”ringsmall];
                                                   Editable=No }
    { 10  ;   ;Shipment Date       ;Date          ;OnValidate=VAR
                                                                CheckDateConflict@1000 : Codeunit 99000815;
                                                              BEGIN
                                                                TestStatusOpen;
                                                                WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                IF CurrFieldNo <> 0 THEN
                                                                  AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);

                                                                IF "Shipment Date" <> 0D THEN BEGIN
                                                                  IF CurrFieldNo IN [
                                                                                     FIELDNO("Planned Shipment Date"),
                                                                                     FIELDNO("Planned Delivery Date"),
                                                                                     FIELDNO("Shipment Date"),
                                                                                     FIELDNO("Shipping Time"),
                                                                                     FIELDNO("Outbound Whse. Handling Time"),
                                                                                     FIELDNO("Requested Delivery Date")]
                                                                  THEN
                                                                    CheckItemAvailable(FIELDNO("Shipment Date"));

                                                                  IF ("Shipment Date" < WORKDATE) AND HasTypeToFillMandatoryFields THEN
                                                                    IF NOT (GetHideValidationDialog OR HasBeenShown) AND GUIALLOWED THEN BEGIN
                                                                      MESSAGE(
                                                                        Text014,
                                                                        FIELDCAPTION("Shipment Date"),"Shipment Date",WORKDATE);
                                                                      HasBeenShown := TRUE;
                                                                    END;
                                                                END;

                                                                AutoAsmToOrder;
                                                                IF (xRec."Shipment Date" <> "Shipment Date") AND
                                                                   (Quantity <> 0) AND
                                                                   NOT StatusCheckSuspended
                                                                THEN
                                                                  CheckDateConflict.SalesLineCheck(Rec,CurrFieldNo <> 0);

                                                                //**4PS.sn
                                                                IF "Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"] THEN
                                                                  "Shipment Date" := SalesHeader."Shipment Date"
                                                                ELSE BEGIN
                                                                //**4PS.en
                                                                  IF NOT PlannedShipmentDateCalculated THEN
                                                                    "Planned Shipment Date" := CalcPlannedShptDate(FIELDNO("Shipment Date"));
                                                                  IF NOT PlannedDeliveryDateCalculated THEN
                                                                    "Planned Delivery Date" := CalcPlannedDeliveryDate(FIELDNO("Shipment Date"));
                                                                END; //**4PS.n
                                                              END;

                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Shipment Date;
                                                              NOR=Forsendelsesdato;
                                                              SVE=Utleveransdatum] }
    { 11  ;   ;Description         ;Text100       ;OnValidate=VAR
                                                                Item@1000 : Record 27;
                                                                ApplicationAreaMgmtFacade@1004 : Codeunit 9179;
                                                                FindRecordMgt@1005 : Codeunit 703;
                                                                IdentityManagement@1007 : Codeunit 9801;
                                                                ReturnValue@1001 : Text[50];
                                                                DescriptionIsNo@1002 : Boolean;
                                                                DefaultCreate@1003 : Boolean;
                                                                Confirmed@1006 : Boolean;
                                                                IsHandled@1008 : Boolean;
                                                              BEGIN
                                                                EXIT; //**4PS.n and also switched off the table relation

                                                                IF Type = Type::" " THEN
                                                                  EXIT;

                                                                CASE Type OF
                                                                  Type::Item:
                                                                    BEGIN
                                                                      IF (STRLEN(Description) <= MAXSTRLEN(Item."No.")) AND ("No." <> '') THEN
                                                                        DescriptionIsNo := Item.GET(Description)
                                                                      ELSE
                                                                        DescriptionIsNo := FALSE;
                                                                      IF ("No." <> '') AND (NOT DescriptionIsNo) AND (Description <> '') THEN BEGIN
                                                                        Item.SETRANGE(Description,Description);
                                                                        IF Item.FINDFIRST THEN
                                                                          Confirmed := IdentityManagement.IsInvAppId
                                                                        ELSE BEGIN
                                                                          Item.SETFILTER(Description,'''@' + CONVERTSTR(Description,'''','?') + '''');
                                                                          IF NOT Item.FINDFIRST THEN
                                                                            EXIT;
                                                                        END;
                                                                        IF Item."No." = "No." THEN
                                                                          EXIT;
                                                                        IF GUIALLOWED THEN
                                                                          IF NOT IdentityManagement.IsInvAppId THEN
                                                                            Confirmed := CONFIRM(AnotherItemWithSameDescrQst,FALSE,Item."No.",Item.Description);
                                                                        IF IdentityManagement.IsInvAppId OR Confirmed THEN
                                                                          VALIDATE("No.",Item."No.");
                                                                        EXIT;
                                                                      END;

                                                                      GetSalesSetup;
                                                                      DefaultCreate := ("No." = '') AND SalesSetup."Create Item from Description";
                                                                      IF Item.TryGetItemNoOpenCard(
                                                                           ReturnValue,Description,DefaultCreate,NOT GetHideValidationDialog,NOT IdentityManagement.IsInvAppId)
                                                                      THEN
                                                                        CASE ReturnValue OF
                                                                          '':
                                                                            BEGIN
                                                                              LookupRequested := TRUE;
                                                                              Description := xRec.Description;
                                                                            END;
                                                                          "No.":
                                                                            Description := xRec.Description;
                                                                          ELSE BEGIN
                                                                            CurrFieldNo := FIELDNO("No.");
                                                                            VALIDATE("No.",COPYSTR(ReturnValue,1,MAXSTRLEN(Item."No.")));
                                                                          END;
                                                                        END;
                                                                    END;
                                                                  ELSE
                                                                    IF "No." = '' THEN BEGIN
                                                                      IsHandled := FALSE;
                                                                      OnBeforeFindNoByDescription(Rec,xRec,CurrFieldNo,IsHandled);
                                                                      IF NOT IsHandled THEN BEGIN
                                                                        ReturnValue := FindRecordMgt.FindNoByDescription(Type,Description,TRUE);
                                                                        IF ReturnValue <> '' THEN BEGIN
                                                                          CurrFieldNo := FIELDNO("No.");
                                                                          VALIDATE("No.",COPYSTR(ReturnValue,1,MAXSTRLEN("No.")));
                                                                        END;
                                                                      END;
                                                                    END;
                                                                END;

                                                                IsHandled := FALSE;
                                                                OnValidateDescriptionOnBeforeCannotFindDescrError(Rec,xRec,IsHandled);
                                                                IF NOT IsHandled THEN
                                                                  IF ("No." = '') AND GUIALLOWED AND ApplicationAreaMgmtFacade.IsFoundationEnabled THEN
                                                                    IF "Document Type" IN
                                                                       ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::Quote,"Document Type"::"Credit Memo"]
                                                                    THEN
                                                                      ERROR(CannotFindDescErr,Type,Description);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 12  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              NOR=Beskrivelse 2;
                                                              SVE=Beskrivning 2] }
    { 13  ;   ;Unit of Measure     ;Text50        ;TableRelation=IF (Type=FILTER(<>' ')) "Unit of Measure".Description;
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=Enhet;
                                                              SVE=Enhet] }
    { 15  ;   ;Quantity            ;Decimal       ;OnValidate=VAR
                                                                Item@1001 : Record 27;
                                                                ItemLedgEntry@1000 : Record 32;
                                                              BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;

                                                                CheckAssocPurchOrder(FIELDCAPTION(Quantity));

                                                                IF "Shipment No." <> '' THEN
                                                                  CheckShipmentRelation
                                                                ELSE
                                                                  IF "Return Receipt No." <> '' THEN
                                                                    CheckRetRcptRelation;

                                                                "Quantity (Base)" := CalcBaseQty(Quantity);

                                                                OnValidateQuantityOnAfterCalcBaseQty(Rec,xRec);

                                                                IF IsCreditDocType THEN BEGIN
                                                                  IF (Quantity * "Return Qty. Received" < 0) OR
                                                                     ((ABS(Quantity) < ABS("Return Qty. Received")) AND ("Return Receipt No." = ''))
                                                                  THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text003,FIELDCAPTION("Return Qty. Received")));
                                                                  IF ("Quantity (Base)" * "Return Qty. Received (Base)" < 0) OR
                                                                     ((ABS("Quantity (Base)") < ABS("Return Qty. Received (Base)")) AND ("Return Receipt No." = ''))
                                                                  THEN
                                                                    FIELDERROR("Quantity (Base)",STRSUBSTNO(Text003,FIELDCAPTION("Return Qty. Received (Base)")));
                                                                END ELSE BEGIN
                                                                  IF (Quantity * "Quantity Shipped" < 0) OR
                                                                     ((ABS(Quantity) < ABS("Quantity Shipped")) AND ("Shipment No." = ''))
                                                                  THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text003,FIELDCAPTION("Quantity Shipped")));
                                                                  IF ("Quantity (Base)" * "Qty. Shipped (Base)" < 0) OR
                                                                     ((ABS("Quantity (Base)") < ABS("Qty. Shipped (Base)")) AND ("Shipment No." = ''))
                                                                  THEN
                                                                    FIELDERROR("Quantity (Base)",STRSUBSTNO(Text003,FIELDCAPTION("Qty. Shipped (Base)")));
                                                                END;

                                                                IF (Type = Type::"Charge (Item)") AND (CurrFieldNo <> 0) THEN BEGIN
                                                                  IF (Quantity = 0) AND ("Qty. to Assign" <> 0) THEN
                                                                    FIELDERROR("Qty. to Assign",STRSUBSTNO(Text009,FIELDCAPTION(Quantity),Quantity));
                                                                  IF (Quantity * "Qty. Assigned" < 0) OR (ABS(Quantity) < ABS("Qty. Assigned")) THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text003,FIELDCAPTION("Qty. Assigned")));
                                                                END;

                                                                AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);
                                                                IF (xRec.Quantity <> Quantity) OR (xRec."Quantity (Base)" <> "Quantity (Base)") THEN BEGIN
                                                                  InitOutstanding;
                                                                  IF IsCreditDocType THEN
                                                                    InitQtyToReceive
                                                                  ELSE
                                                                    InitQtyToShip;
                                                                  InitQtyToAsm;
                                                                  SetDefaultQuantity;
                                                                END;

                                                                IF Item."Logistics on Component Level" = FALSE THEN  //**4PS.n
                                                                  CheckItemAvailable(FIELDNO(Quantity));

                                                                IF (Quantity * xRec.Quantity < 0) OR (Quantity = 0) THEN
                                                                  InitItemAppl(FALSE);

                                                                //IF (Type = Type::Item) AND (CurrFieldNo <> FIELDNO("No.")) THEN BEGIN //**4PS,o
                                                                IF ((Type = Type::Item) OR ("Item No." <> '')) AND (CurrFieldNo <> FIELDNO("No.")) AND (NOT "Plant Invoice") THEN BEGIN //**4PS.n
                                                                  UpdateUnitPrice(FIELDNO(Quantity));
                                                                  IF (xRec.Quantity <> Quantity) OR (xRec."Quantity (Base)" <> "Quantity (Base)") THEN BEGIN
                                                                    OnBeforeVerifyReservedQty(Rec,xRec,FIELDNO(Quantity));
                                                                    ReserveSalesLine.VerifyQuantity(Rec,xRec);
                                                                    IF NOT "Drop Shipment" THEN
                                                                      UpdateWithWarehouseShip;
                                                                    WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                    IF ("Quantity (Base)" * xRec."Quantity (Base)" <= 0) AND ("No." <> '') THEN BEGIN
                                                                      GetItem(Item);
                                                                      OnValidateQuantityOnBeforeGetUnitCost(Rec,Item);
                                                                      IF (Item."Costing Method" = Item."Costing Method"::Standard) AND NOT IsShipment THEN
                                                                        GetUnitCost;
                                                                    END;
                                                                  END;
                                                                  VALIDATE("Qty. to Assemble to Order");
                                                                  IF (Quantity = "Quantity Invoiced") AND (CurrFieldNo <> 0) THEN
                                                                    CheckItemChargeAssgnt;
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);
                                                                END ELSE
                                                                  VALIDATE("Line Discount %");

                                                                IF (xRec.Quantity <> Quantity) AND (Quantity = 0) AND
                                                                   ((Amount <> 0) OR ("Amount Including VAT" <> 0) OR ("VAT Base Amount" <> 0))
                                                                THEN BEGIN
                                                                  Amount := 0;
                                                                  "Amount Including VAT" := 0;
                                                                  "VAT Base Amount" := 0;
                                                                END;

                                                                UpdatePrePaymentAmounts;

                                                                CheckWMS;

                                                                UpdatePlanned;
                                                                IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                  ValidateReturnReasonCode(FIELDNO(Quantity));

                                                                //**4PS.sn
                                                                IF CurrFieldNo = FIELDNO(Quantity) THEN
                                                                  UpdateQuantityRemovalContribution(CurrFieldNo);  //C057041
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5 }
    { 16  ;   ;Outstanding Quantity;Decimal       ;CaptionML=[ENU=Outstanding Quantity;
                                                              NOR=Restantall;
                                                              SVE=Restnoterat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 17  ;   ;Qty. to Invoice     ;Decimal       ;OnValidate=BEGIN
                                                                IF "Qty. to Invoice" = MaxQtyToInvoice THEN
                                                                  InitQtyToInvoice
                                                                ELSE
                                                                  "Qty. to Invoice (Base)" := CalcBaseQty("Qty. to Invoice");
                                                                IF ("Qty. to Invoice" * Quantity < 0) OR
                                                                   (ABS("Qty. to Invoice") > ABS(MaxQtyToInvoice))
                                                                THEN
                                                                  ERROR(
                                                                    Text005,
                                                                    MaxQtyToInvoice);
                                                                IF ("Qty. to Invoice (Base)" * "Quantity (Base)" < 0) OR
                                                                   (ABS("Qty. to Invoice (Base)") > ABS(MaxQtyToInvoiceBase))
                                                                THEN
                                                                  ERROR(
                                                                    Text006,
                                                                    MaxQtyToInvoiceBase);
                                                                "VAT Difference" := 0;
                                                                CalcInvDiscToInvoice;
                                                                CalcPrepaymentToDeduct;
                                                              END;

                                                   CaptionML=[ENU=Qty. to Invoice;
                                                              NOR=Fakturer (antall);
                                                              SVE=Ant. att fakturera];
                                                   DecimalPlaces=0:5 }
    { 18  ;   ;Qty. to Ship        ;Decimal       ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                                IsHandled@1001 : Boolean;
                                                                Item@1100525000 : Record 27;
                                                              BEGIN
                                                                GetLocation("Location Code");
                                                                IF (CurrFieldNo <> 0) AND
                                                                // (Type = Type::Item) AND //**4PS.o
                                                                   ((Type = Type::Item) OR ("Item No." <> '')) AND //**4PS.n
                                                                   (NOT "Drop Shipment")
                                                                THEN BEGIN
                                                                  IF Location."Require Shipment" AND
                                                                     ("Qty. to Ship" <> 0)
                                                                  THEN
                                                                    CheckWarehouse;
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;
                                                                OnValidateQtyToShipOnAfterCheck(Rec,CurrFieldNo);

                                                                //**4PS.sn
                                                                IF ("Item No." <> '') AND ("Document Type" = "Document Type"::Order) AND  ("Qty. to Ship" <> 0) THEN BEGIN
                                                                  GetItem(Item);
                                                                  Item.TESTFIELD("Logistics on Component Level",FALSE);
                                                                END;
                                                                //**4PS.en

                                                                IF "Qty. to Ship" = "Outstanding Quantity" THEN
                                                                BEGIN                        //**4PS.n
                                                                  OnlyCheckForOpen := TRUE;  //**4PS.n
                                                                  InitQtyToShip
                                                                END                          //**4PS.n
                                                                ELSE BEGIN
                                                                  "Qty. to Ship (Base)" := CalcBaseQty("Qty. to Ship");
                                                                  CheckServItemCreation;
                                                                  InitQtyToInvoice;
                                                                END;

                                                                IsHandled := FALSE;
                                                                OnValidateQtyToShipAfterInitQty(Rec,xRec,CurrFieldNo,IsHandled);
                                                                IF NOT IsHandled THEN BEGIN
                                                                  IF ((("Qty. to Ship" < 0) XOR (Quantity < 0)) AND (Quantity <> 0) AND ("Qty. to Ship" <> 0)) OR
                                                                     (ABS("Qty. to Ship") > ABS("Outstanding Quantity")) OR
                                                                     (((Quantity < 0) XOR ("Outstanding Quantity" < 0)) AND (Quantity <> 0) AND ("Outstanding Quantity" <> 0))
                                                                  THEN
                                                                    ERROR(Text007,"Outstanding Quantity");
                                                                  IF ((("Qty. to Ship (Base)" < 0) XOR ("Quantity (Base)" < 0)) AND ("Qty. to Ship (Base)" <> 0) AND ("Quantity (Base)" <> 0)) OR
                                                                     (ABS("Qty. to Ship (Base)") > ABS("Outstanding Qty. (Base)")) OR
                                                                     ((("Quantity (Base)" < 0) XOR ("Outstanding Qty. (Base)" < 0)) AND ("Quantity (Base)" <> 0) AND ("Outstanding Qty. (Base)" <> 0))
                                                                  THEN
                                                                    ERROR(Text008,"Outstanding Qty. (Base)");
                                                                END;

                                                                IF (CurrFieldNo <> 0) AND (Type = Type::Item) AND ("Qty. to Ship" < 0) THEN
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);

                                                                ATOLink.UpdateQtyToAsmFromSalesLine(Rec);

                                                                //**4PS.sn
                                                                IF CurrFieldNo = FIELDNO("Qty. to Ship") THEN
                                                                  UpdateQuantityRemovalContribution(CurrFieldNo);  //C057041
                                                                //**4PS.en
                                                              END;

                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Qty. to Ship;
                                                              NOR=Levere (antall);
                                                              SVE=Ant. att utleverera];
                                                   DecimalPlaces=0:5 }
    { 22  ;   ;Unit Price          ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Line Discount %");
                                                              END;

                                                   CaptionML=[ENU=Unit Price;
                                                              NOR=Salgspris;
                                                              SVE=A-pris];
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Unit Price")) }
    { 23  ;   ;Unit Cost (LCY)     ;Decimal       ;OnValidate=VAR
                                                                Item@1000 : Record 27;
                                                              BEGIN
                                                                IF (CurrFieldNo = FIELDNO("Unit Cost (LCY)")) AND
                                                                   ("Unit Cost (LCY)" <> xRec."Unit Cost (LCY)")
                                                                THEN
                                                                  CheckAssocPurchOrder(FIELDCAPTION("Unit Cost (LCY)"));

                                                                IF (CurrFieldNo = FIELDNO("Unit Cost (LCY)")) AND
                                                                   (Type = Type::Item) AND ("No." <> '') AND ("Quantity (Base)" <> 0)
                                                                THEN BEGIN
                                                                  TestJobPlanningLine;
                                                                  GetItem(Item);
                                                                  IF (Item."Costing Method" = Item."Costing Method"::Standard) AND NOT IsShipment THEN BEGIN
                                                                    IF IsCreditDocType THEN
                                                                      ERROR(
                                                                        Text037,
                                                                        FIELDCAPTION("Unit Cost (LCY)"),Item.FIELDCAPTION("Costing Method"),
                                                                        Item."Costing Method",FIELDCAPTION(Quantity));
                                                                    ERROR(
                                                                      Text038,
                                                                      FIELDCAPTION("Unit Cost (LCY)"),Item.FIELDCAPTION("Costing Method"),
                                                                      Item."Costing Method",FIELDCAPTION(Quantity));
                                                                  END;
                                                                END;

                                                                GetSalesHeader;
                                                                IF SalesHeader."Currency Code" <> '' THEN BEGIN
                                                                  Currency.TESTFIELD("Unit-Amount Rounding Precision");
                                                                  "Unit Cost" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtLCYToFCY(
                                                                        1, //**4PS.n
                                                                        "Job No.", //**4PS.n
                                                                        GetDate,SalesHeader."Currency Code",
                                                                //      "Unit Cost (LCY)",SalesHeader."Currency Factor"), //**4PS.o
                                                                        "Unit Cost (LCY)",SalesHeader."Currency Factor",TRUE), //**4PS.n
                                                                      Currency."Unit-Amount Rounding Precision")
                                                                END ELSE
                                                                  "Unit Cost" := "Unit Cost (LCY)";
                                                              END;

                                                   CaptionML=[ENU=Unit Cost (LCY);
                                                              NOR=Enhetskost (NOK);
                                                              SVE=Styckkostnad (BVA)];
                                                   AutoFormatType=2 }
    { 25  ;   ;VAT %               ;Decimal       ;CaptionML=[ENU=VAT %;
                                                              NOR=Mva-%;
                                                              SVE=Momssats %];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 27  ;   ;Line Discount %     ;Decimal       ;OnValidate=BEGIN
                                                                ValidateLineDiscountPercent(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Line Discount %;
                                                              NOR=Linjerabatt-%;
                                                              SVE=Radrabatt %];
                                                   DecimalPlaces=0:5;
                                                   MaxValue=100 }
    { 28  ;   ;Line Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                GetSalesHeader;
                                                                "Line Discount Amount" := ROUND("Line Discount Amount",Currency."Amount Rounding Precision");
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                TESTFIELD(Quantity);
                                                                IF xRec."Line Discount Amount" <> "Line Discount Amount" THEN
                                                                  UpdateLineDiscPct;
                                                                "Inv. Discount Amount" := 0;
                                                                "Inv. Disc. Amount to Invoice" := 0;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Line Discount Amount;
                                                              NOR=Linjerabattbel›p;
                                                              SVE=Radrabatt];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 29  ;   ;Amount              ;Decimal       ;OnValidate=BEGIN
                                                                Amount := ROUND(Amount,Currency."Amount Rounding Precision");

                                                                //**4PS.sn
                                                                IF "Manually VAT Posting" THEN
                                                                  "VAT Base Amount" := Amount
                                                                ELSE
                                                                //**4PS.en
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Normal VAT",
                                                                  "VAT Calculation Type"::"Reverse Charge VAT":
                                                                    BEGIN
                                                                      "VAT Base Amount" :=
                                                                        ROUND(Amount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                                                                      "Amount Including VAT" :=
                                                                        ROUND(Amount + "VAT Base Amount" * "VAT %" / 100,Currency."Amount Rounding Precision");
                                                                    END;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    IF Amount <> 0 THEN
                                                                      FIELDERROR(Amount,
                                                                        STRSUBSTNO(
                                                                          Text009,FIELDCAPTION("VAT Calculation Type"),
                                                                          "VAT Calculation Type"));
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    BEGIN
                                                                      SalesHeader.TESTFIELD("VAT Base Discount %",0);
                                                                      "VAT Base Amount" := ROUND(Amount,Currency."Amount Rounding Precision");
                                                                      "Amount Including VAT" :=
                                                                        Amount +
                                                                        SalesTaxCalculate.CalculateTax(
                                                                          "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                                                                          "VAT Base Amount","Quantity (Base)",SalesHeader."Currency Factor");
                                                                      OnAfterSalesTaxCalculate(Rec,SalesHeader,Currency);
                                                                      UpdateVATPercent("VAT Base Amount","Amount Including VAT" - "VAT Base Amount");
                                                                      "Amount Including VAT" := ROUND("Amount Including VAT",Currency."Amount Rounding Precision");
                                                                    END;
                                                                END;

                                                                "Line VAT Amount" := "Amount Including VAT" - Amount;   //**4PS.n

                                                                InitOutstandingAmount;
                                                              END;

                                                   CaptionML=[ENU=Amount;
                                                              NOR=Bel›p;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 30  ;   ;Amount Including VAT;Decimal       ;OnValidate=BEGIN
                                                                //**4PS.sn
                                                                IF CurrFieldNo = FIELDNO("Amount Including VAT") THEN
                                                                  TESTFIELD("Manually VAT Posting",TRUE);
                                                                //**4PS.en

                                                                "Amount Including VAT" := ROUND("Amount Including VAT",Currency."Amount Rounding Precision");

                                                                //**4PS.sn
                                                                IF "Manually VAT Posting" THEN
                                                                  "VAT Base Amount" := Amount
                                                                ELSE
                                                                //**4PS.en

                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Normal VAT",
                                                                  "VAT Calculation Type"::"Reverse Charge VAT":
                                                                    BEGIN
                                                                      Amount :=
                                                                        ROUND(
                                                                          "Amount Including VAT" /
                                                                          (1 + (1 - SalesHeader."VAT Base Discount %" / 100) * "VAT %" / 100),
                                                                          Currency."Amount Rounding Precision");
                                                                      "VAT Base Amount" :=
                                                                        ROUND(Amount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                                                                    END;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    BEGIN
                                                                      Amount := 0;
                                                                      "VAT Base Amount" := 0;
                                                                    END;
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    BEGIN
                                                                      SalesHeader.TESTFIELD("VAT Base Discount %",0);
                                                                      Amount :=
                                                                        SalesTaxCalculate.ReverseCalculateTax(
                                                                          "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                                                                          "Amount Including VAT","Quantity (Base)",SalesHeader."Currency Factor");
                                                                      OnAfterSalesTaxCalculateReverse(Rec,SalesHeader,Currency);
                                                                      UpdateVATPercent(Amount,"Amount Including VAT" - Amount);
                                                                      Amount := ROUND(Amount,Currency."Amount Rounding Precision");
                                                                      "VAT Base Amount" := Amount;
                                                                    END;
                                                                END;

                                                                //**4PS.sn
                                                                UpdateAmountLCY;
                                                                "Line VAT Amount" := "Amount Including VAT" - Amount;
                                                                //**4PS.en

                                                                InitOutstandingAmount;
                                                              END;

                                                   CaptionML=[ENU=Amount Including VAT;
                                                              NOR=Bel›p inkl. mva.;
                                                              SVE=Belopp inkl. moms];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 32  ;   ;Allow Invoice Disc. ;Boolean       ;InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Allow Invoice Disc." <> xRec."Allow Invoice Disc." THEN BEGIN
                                                                  IF NOT "Allow Invoice Disc." THEN BEGIN
                                                                    "Inv. Discount Amount" := 0;
                                                                    "Inv. Disc. Amount to Invoice" := 0;
                                                                  END;
                                                                  UpdateAmounts;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Allow Invoice Disc.;
                                                              NOR=Tillat fakturarabatt;
                                                              SVE=Ber„kna fakturarabatt] }
    { 34  ;   ;Gross Weight        ;Decimal       ;CaptionML=[ENU=Gross Weight;
                                                              NOR=Bruttovekt;
                                                              SVE=Bruttovikt];
                                                   DecimalPlaces=0:5 }
    { 35  ;   ;Net Weight          ;Decimal       ;CaptionML=[ENU=Net Weight;
                                                              NOR=Nettovekt;
                                                              SVE=Nettovikt];
                                                   DecimalPlaces=0:5 }
    { 36  ;   ;Units per Parcel    ;Decimal       ;CaptionML=[ENU=Units per Parcel;
                                                              NOR=Antall per kolli;
                                                              SVE=Antal per kolli];
                                                   DecimalPlaces=0:5 }
    { 37  ;   ;Unit Volume         ;Decimal       ;CaptionML=[ENU=Unit Volume;
                                                              NOR=Volum;
                                                              SVE=Volym];
                                                   DecimalPlaces=0:5 }
    { 38  ;   ;Appl.-to Item Entry ;Integer       ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                                ItemTrackingLines@1001 : Page 6510;
                                                              BEGIN
                                                                IF "Appl.-to Item Entry" <> 0 THEN BEGIN
                                                                  AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);

                                                                  TESTFIELD(Type,Type::Item);
                                                                  TESTFIELD(Quantity);
                                                                  IF IsCreditDocType THEN BEGIN
                                                                    IF Quantity > 0 THEN
                                                                      FIELDERROR(Quantity,Text030);
                                                                  END ELSE BEGIN
                                                                    IF Quantity < 0 THEN
                                                                      FIELDERROR(Quantity,Text029);
                                                                  END;
                                                                  ItemLedgEntry.GET("Appl.-to Item Entry");
                                                                  ItemLedgEntry.TESTFIELD(Positive,TRUE);
                                                                  IF ItemLedgEntry.TrackingExists THEN
                                                                    ERROR(Text040,ItemTrackingLines.CAPTION,FIELDCAPTION("Appl.-to Item Entry"));
                                                                  IF ABS("Qty. to Ship (Base)") > ItemLedgEntry.Quantity THEN
                                                                    ERROR(ShippingMoreUnitsThanReceivedErr,ItemLedgEntry.Quantity,ItemLedgEntry."Document No.");

                                                                  VALIDATE("Unit Cost (LCY)",CalcUnitCost(ItemLedgEntry));

                                                                  "Location Code" := ItemLedgEntry."Location Code";

                                                                  //**4PS.sn
                                                                  CreateDim(
                                                                    DimMgt.TypeToTableID3(Type),"No.",
                                                                    DATABASE::"Plant Type", "Plant Type",
                                                                    DATABASE::Job,"Job No.",
                                                                    DATABASE::"Service Order","Service Order No.",
                                                                    DATABASE::"Service-Contract","Service Contract No.",
                                                                    DATABASE::"Responsibility Center","Responsibility Center",
                                                                    //DATABASE::Location,"Location Code");  //*C007227.o
                                                                    DATABASE::"Service Group", GetServiceObjectGroup);
                                                                  //**4PS.en

                                                                  IF NOT ItemLedgEntry.Open THEN
                                                                    MESSAGE(Text042,"Appl.-to Item Entry");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              SelectItemEntry(FIELDNO("Appl.-to Item Entry"));
                                                            END;

                                                   AccessByPermission=TableData 27=R;
                                                   CaptionML=[ENU=Appl.-to Item Entry;
                                                              NOR=Utligningsvarepost;
                                                              SVE=Koppla till artikell”pnr] }
    { 40  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1),
                                                                                               Blocked=CONST(No));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                                ATOLink.UpdateAsmDimFromSalesLine(Rec);
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 1 Code;
                                                              NOR=Snarveisdimensjon 1 - kode;
                                                              SVE=Genv„g dimension 1 kod];
                                                   CaptionClass='1,2,1' }
    { 41  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2),
                                                                                               Blocked=CONST(No),
                                                                                               Project Filter=FIELD(Job No.));
                                                   OnValidate=VAR
                                                                CurrCostObject@1100525000 : Code[20];
                                                              BEGIN
                                                                //**4PS.sn
                                                                IF "Shortcut Dimension 2 Code" <> '' THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2,"Shortcut Dimension 2 Code",DimVal,TRUE,"Job No.");
                                                                  DimVal.TESTFIELD(Blocked, FALSE);
                                                                  DimVal.TESTFIELD("Proj. Rel. Cost Object Blocked",FALSE);
                                                                  CheckAdditionalCostService;
                                                                  CurrCostObject := "Shortcut Dimension 2 Code";
                                                                  IF ("Item No." = '') AND ("Basic Item" = '') AND ("Trade Item" = '') THEN BEGIN
                                                                    Description := DimVal.Name;
                                                                    "Cost Component" := DimVal."Cost Component";
                                                                    // **4PS.n --> Obtain Revenue Account based on "Cost Type"
                                                                    IF ("Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"]) THEN BEGIN
                                                                      GetProjTypeRevenueAccount(FALSE, TRUE);
                                                                      GetServTypeRevenueAccount();
                                                                    END;
                                                                    IF (CurrFieldNo <> 0) AND (Type = Type::"G/L Account") THEN BEGIN
                                                                      VALIDATE("Unit Price",DimVal."Sales Price");
                                                                      VALIDATE("Unit of Measure Code",DimVal."Unit of Measure");
                                                                      UpdateUnitPrice(FIELDNO("Shortcut Dimension 2 Code"));
                                                                    END;
                                                                  END ELSE
                                                                    UpdateUnitPrice(FIELDNO("Shortcut Dimension 2 Code"));
                                                                  //**4PS01.sn
                                                                  IF (DimVal.Element <> '') AND ("Job No." <> '') THEN
                                                                    VALIDATE(Element, DimVal.Element);
                                                                  //**4PS01.en
                                                                  IF "Shortcut Dimension 2 Code" <> CurrCostObject THEN
                                                                    "Shortcut Dimension 2 Code" := CurrCostObject;
                                                                  IF CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code") THEN
                                                                    UpdateVatProdPostingGrp;
                                                                END;
                                                                CheckCostCompServOrderType; //** 4PS03.n
                                                                //**4PS.en

                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                                ATOLink.UpdateAsmDimFromSalesLine(Rec);
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 2 Code;
                                                              NOR=Snarveisdimensjon 2 - kode;
                                                              SVE=Genv„g dimension 2 kod];
                                                   CaptionClass='1,2,2' }
    { 42  ;   ;Customer Price Group;Code10        ;TableRelation="Customer Price Group";
                                                   OnValidate=BEGIN
                                                                //IF Type = Type::Item THEN //**4PS.o
                                                                IF (Type = Type::Item) OR ("Item No." <> '') THEN //**4PS.n
                                                                  UpdateUnitPrice(FIELDNO("Customer Price Group"));
                                                              END;

                                                   CaptionML=[ENU=Customer Price Group;
                                                              NOR=Kundeprisgruppe;
                                                              SVE=Kund prisgrupp];
                                                   Editable=No }
    { 45  ;   ;Job No.             ;Code20        ;TableRelation=Job;
                                                   OnValidate=BEGIN
                                                                //**4PS.sn
                                                                TestStatusOpen;
                                                                CheckProjServPlantLoanAllowed(FIELDNO("Job No."));
                                                                TESTFIELD("Drop Shipment",FALSE);
                                                                IF (xRec."Job No." <> "Job No.") AND (Quantity <> 0) THEN BEGIN
                                                                  CALCFIELDS("Reserved Qty. (Base)");
                                                                  TESTFIELD("Reserved Qty. (Base)",0);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;

                                                                IF Type IN [Type::"Fixed Asset",Type::"Charge (Item)"] THEN
                                                                  IF "Job No." <> '' THEN
                                                                    FIELDERROR(
                                                                      "Job No.",STRSUBSTNO(Text11012007,FIELDCAPTION(Type),Type));
                                                                IF ("Shortcut Dimension 1 Code" <> '') AND ("Job No." <> '') AND
                                                                   (CurrFieldNo = FIELDNO("Job No.")) AND ("Job No." <> xRec."Job No.") THEN
                                                                  "Shortcut Dimension 1 Code" := '';

                                                                FillSystemCreatedEntry;

                                                                //** DP0121
                                                                IF "Job No." <> xRec."Job No." THEN
                                                                  IF (Quantity <> 0) AND NSItemExists(xRec."Item No.") THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                //**4PS.en

                                                                CreateDim(
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Plant Type", "Plant Type",
                                                                  DATABASE::"Service Order","Service Order No.", //**4PS.n 09-06-2010
                                                                  DATABASE::"Service-Contract","Service Contract No.", //**4PS.n 09-06-2010
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                  DATABASE::"Service Group", GetServiceObjectGroup);


                                                                IF "Job No." <> '' THEN BEGIN
                                                                  //ProjSetupRec.GET;
                                                                  Type := Type::"G/L Account";
                                                                  ProjRec.GET("Job No.");

                                                                  //IF ("Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"]) AND
                                                                  //   (ProjRec."Blocking Code" <> '') AND
                                                                  //   ((ProjRec."Project Status" = ProjRec."Project Status"::"Technical Finished") OR
                                                                  //    (ProjRec."Project Status" = ProjRec."Project Status"::"Administrative Finished"))
                                                                  //THEN
                                                                  //  lvBlockingCodeRec.CheckBlocked(ProjRec."Blocking Code", lvBlockingCodeRec.Switch::"Sales Invoice", ProjRec);
                                                                  //IF (ProjSetupRec."Provisions at Closure") AND
                                                                  //   (("Document Type" > "Document Type"::Order) AND
                                                                  //    ("Document Type" <> "Document Type"::"Blanket Order"))
                                                                  //THEN
                                                                  //  ProjRec.CheckProjectStatus(-1)
                                                                  //ELSE
                                                                  //  ProjRec.CheckProjectStatus(1);
                                                                  CheckProjStatus(ProjRec);
                                                                  ProjRec.TESTFIELD("Project Type");
                                                                  GetProjTypeRevenueAccount(FALSE,FALSE);
                                                                  IF NOT ProjPrincipRec.GET("Job No.", "Sell-to Customer No.") THEN
                                                                    ProjPrincipRec.INIT;

                                                                  GetSalesHeader;
                                                                  IF NOT SalesHeader."Extended VAT Determination" THEN
                                                                    IF (ProjPrincipRec."VAT Bus. Posting Group" <> '') THEN
                                                                      VALIDATE("VAT Bus. Posting Group",ProjPrincipRec."VAT Bus. Posting Group")
                                                                    ELSE BEGIN
                                                                      IF (ProjRec."VAT Bus. Posting Group" = '') THEN
                                                                        ERROR(Text11012002, ProjRec.FIELDCAPTION("VAT Bus. Posting Group"), "Job No.", ProjPrincipRec.Principal);
                                                                      VALIDATE("VAT Bus. Posting Group",ProjRec."VAT Bus. Posting Group");
                                                                    END;

                                                                  IF "Installment Invoice" = FALSE THEN BEGIN
                                                                    IF NOT PlantRelatedInvoice("Job No.", SalesHeader) THEN
                                                                      ProjPrincipRec.GET("Job No.", "Sell-to Customer No.");
                                                                  END;
                                                                  IF CurrFieldNo = FIELDNO("Job No.") THEN
                                                                    UpdateVatProdPostingGrp;
                                                                END ELSE BEGIN
                                                                  "No." := '';
                                                                  IF ("Item No." <> '') AND (Type = Type::"G/L Account") THEN BEGIN
                                                                    Type := Type::Item;
                                                                    VALIDATE("No.", "Item No.");  //beware of recursion between validate triggers
                                                                  END;
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                                  "Rental Unit" := '';
                                                                  "Rental Unit Line Type" := 0;
                                                                END;
                                                                IF ("Shortcut Dimension 2 Code" <> '') AND
                                                                   ("Item No." = '') AND ("Basic Item" = '') AND ("Trade Item" = '') AND
                                                                   (CurrFieldNo = FIELDNO("Job No.")) AND ("Job No." <> xRec."Job No.") THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2,"Shortcut Dimension 2 Code",DimVal,FALSE,"Job No.");
                                                                  Description := DimVal.Name;
                                                                END;
                                                                WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                CALCFIELDS("Job Description");
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr.;
                                                              SVE=Projektnr];
                                                   Editable=Yes }
    { 52  ;   ;Work Type Code      ;Code10        ;TableRelation="Work Type";
                                                   OnValidate=VAR
                                                                WorkType@1000 : Record 200;
                                                              BEGIN
                                                                IF Type = Type::Resource THEN BEGIN
                                                                  TestStatusOpen;
                                                                  IF WorkType.GET("Work Type Code") THEN
                                                                    VALIDATE("Unit of Measure Code",WorkType."Unit of Measure Code");
                                                                  UpdateUnitPrice(FIELDNO("Work Type Code"));
                                                                  VALIDATE("Unit Price");
                                                                  FindResUnitCost;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Work Type Code;
                                                              NOR=Arbeidstypekode;
                                                              SVE=Arbetstypkod] }
    { 56  ;   ;Recalculate Invoice Disc.;Boolean  ;CaptionML=[ENU=Recalculate Invoice Disc.;
                                                              NOR=Beregn fakturarabatt p† nytt;
                                                              SVE=Ber„kna om fakturarabatt];
                                                   Editable=No }
    { 57  ;   ;Outstanding Amount  ;Decimal       ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF SalesHeader."Currency Code" <> '' THEN
                                                                  "Outstanding Amount (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(
                                                                        1, //**4PS.n
                                                                        "Job No.", //**4PS.n
                                                                        GetDate,"Currency Code",
                                                                //      "Outstanding Amount",SalesHeader."Currency Factor"), //**4PS.o
                                                                        "Outstanding Amount",SalesHeader."Currency Factor",TRUE), //**4PS.n
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Outstanding Amount (LCY)" :=
                                                                    ROUND("Outstanding Amount",Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Outstanding Amount;
                                                              NOR=Utest†ende bel›p;
                                                              SVE=Utest†ende belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 58  ;   ;Qty. Shipped Not Invoiced;Decimal  ;CaptionML=[ENU=Qty. Shipped Not Invoiced;
                                                              NOR=Antall levert, ikke fakturert;
                                                              SVE=Ant. levererat ej fakturerat];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 59  ;   ;Shipped Not Invoiced;Decimal       ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF SalesHeader."Currency Code" <> '' THEN
                                                                  "Shipped Not Invoiced (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(
                                                                        1, //**4PS.n
                                                                        "Job No.", //**4PS.n
                                                                        GetDate,"Currency Code",
                                                                //      "Shipped Not Invoiced",SalesHeader."Currency Factor"), //**4PS.o
                                                                        "Shipped Not Invoiced",SalesHeader."Currency Factor",TRUE), //**4PS.n
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Shipped Not Invoiced (LCY)" :=
                                                                    ROUND("Shipped Not Invoiced",Currency2."Amount Rounding Precision");

                                                                CalculateNotShippedInvExlcVatLCY;
                                                              END;

                                                   CaptionML=[ENU=Shipped Not Invoiced;
                                                              NOR=Levert, ikke fakturert;
                                                              SVE=Levererat ej fakturerat];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 60  ;   ;Quantity Shipped    ;Decimal       ;AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Quantity Shipped;
                                                              NOR=Levert (antall);
                                                              SVE=Utlevererat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 61  ;   ;Quantity Invoiced   ;Decimal       ;CaptionML=[ENU=Quantity Invoiced;
                                                              NOR=Fakturert (antall);
                                                              SVE=Fakturerat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 63  ;   ;Shipment No.        ;Code20        ;CaptionML=[ENU=Shipment No.;
                                                              NOR=F›lgeseddelnr.;
                                                              SVE=Utleveransnr];
                                                   Editable=No }
    { 64  ;   ;Shipment Line No.   ;Integer       ;CaptionML=[ENU=Shipment Line No.;
                                                              NOR=F›lges.linjenr.;
                                                              SVE=Utleveransradnr];
                                                   Editable=No }
    { 67  ;   ;Profit %            ;Decimal       ;CaptionML=[ENU=Profit %;
                                                              NOR=Bruttofortjeneste-%;
                                                              SVE=Vinst %];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 68  ;   ;Bill-to Customer No.;Code20        ;TableRelation=Customer;
                                                   CaptionML=[ENU=Bill-to Customer No.;
                                                              NOR=Faktura til-kundenr.;
                                                              SVE=Faktureringskundnr];
                                                   Editable=No }
    { 69  ;   ;Inv. Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                CalcInvDiscToInvoice;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Inv. Discount Amount;
                                                              NOR=Fakturarabattbel›p;
                                                              SVE=Fakturarabatt];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Inv. Discount Amount")) }
    { 71  ;   ;Purchase Order No.  ;Code20        ;TableRelation=IF (Drop Shipment=CONST(Yes)) "Purchase Header".No. WHERE (Document Type=CONST(Order));
                                                   OnValidate=BEGIN
                                                                IF (xRec."Purchase Order No." <> "Purchase Order No.") AND (Quantity <> 0) THEN BEGIN
                                                                  ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Purchase Order No.;
                                                              NOR=Bestillingsnr.;
                                                              SVE=Ink”psordernr];
                                                   Editable=No }
    { 72  ;   ;Purch. Order Line No.;Integer      ;TableRelation=IF (Drop Shipment=CONST(Yes)) "Purchase Line"."Line No." WHERE (Document Type=CONST(Order),
                                                                                                                                 Document No.=FIELD(Purchase Order No.));
                                                   OnValidate=BEGIN
                                                                IF (xRec."Purch. Order Line No." <> "Purch. Order Line No.") AND (Quantity <> 0) THEN BEGIN
                                                                  ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Purch. Order Line No.;
                                                              NOR=Bestillingslinjenr.;
                                                              SVE=Radnr p† ink”psorder];
                                                   Editable=No }
    { 73  ;   ;Drop Shipment       ;Boolean       ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type","Document Type"::Order);
                                                                TESTFIELD(Type,Type::Item);
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Job No.",'');
                                                                TESTFIELD("Qty. to Asm. to Order (Base)",0);

                                                                IF "Drop Shipment" THEN
                                                                  TESTFIELD("Special Order",FALSE);

                                                                CheckAssocPurchOrder(FIELDCAPTION("Drop Shipment"));

                                                                IF "Special Order" THEN
                                                                  Reserve := Reserve::Never
                                                                ELSE
                                                                  IF "Drop Shipment" THEN BEGIN
                                                                    Reserve := Reserve::Never;
                                                                    EVALUATE("Outbound Whse. Handling Time",'<0D>');
                                                                    EVALUATE("Shipping Time",'<0D>');
                                                                    UpdateDates;
                                                                    "Bin Code" := '';
                                                                  END ELSE
                                                                    SetReserveWithoutPurchasingCode;

                                                                CheckItemAvailable(FIELDNO("Drop Shipment"));

                                                                AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);
                                                                IF (xRec."Drop Shipment" <> "Drop Shipment") AND (Quantity <> 0) THEN BEGIN
                                                                  IF NOT "Drop Shipment" THEN BEGIN
                                                                    InitQtyToAsm;
                                                                    AutoAsmToOrder;
                                                                    UpdateWithWarehouseShip
                                                                  END ELSE
                                                                    InitQtyToShip;
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                  IF NOT FullReservedQtyIsForAsmToOrder THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 223=R;
                                                   CaptionML=[ENU=Drop Shipment;
                                                              NOR=Direkte levering;
                                                              SVE=Direktutleverans];
                                                   Editable=Yes }
    { 74  ;   ;Gen. Bus. Posting Group;Code20     ;TableRelation="Gen. Business Posting Group";
                                                   OnValidate=BEGIN
                                                                IF xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group" THEN
                                                                  IF GenBusPostingGrp.ValidateVatBusPostingGroup(GenBusPostingGrp,"Gen. Bus. Posting Group") THEN
                                                                    VALIDATE("VAT Bus. Posting Group",GenBusPostingGrp."Def. VAT Bus. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Gen. Bus. Posting Group;
                                                              NOR=Bokf›ringsgruppe - firma;
                                                              SVE=Gen. r”relsebokf”ringsmall] }
    { 75  ;   ;Gen. Prod. Posting Group;Code20    ;TableRelation="Gen. Product Posting Group";
                                                   OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                IF xRec."Gen. Prod. Posting Group" <> "Gen. Prod. Posting Group" THEN
                                                                  IF GenProdPostingGrp.ValidateVatProdPostingGroup(GenProdPostingGrp,"Gen. Prod. Posting Group") THEN
                                                                    VALIDATE("VAT Prod. Posting Group",GenProdPostingGrp."Def. VAT Prod. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Gen. Prod. Posting Group;
                                                              NOR=Bokf›ringsgruppe - vare;
                                                              SVE=Produktbokf”ringsmall] }
    { 77  ;   ;VAT Calculation Type;Option        ;CaptionML=[ENU=VAT Calculation Type;
                                                              NOR=Mva-beregningstype;
                                                              SVE=Momsber„kningstyp];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    NOR=Normal mva.,Snudd avregning,Full mva.,Salgsmva.;
                                                                    SVE=Normal moms,Omv„nd EG-moms,Enbart moms,Oms„ttningsskatt];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                   Editable=No }
    { 78  ;   ;Transaction Type    ;Code10        ;TableRelation="Transaction Type";
                                                   CaptionML=[ENU=Transaction Type;
                                                              NOR=Transaksjonsart;
                                                              SVE=EU transaktionstyp] }
    { 79  ;   ;Transport Method    ;Code10        ;TableRelation="Transport Method";
                                                   CaptionML=[ENU=Transport Method;
                                                              NOR=Transportm†te;
                                                              SVE=Transports„tt] }
    { 80  ;   ;Attached to Line No.;Integer       ;TableRelation="Sales Line"."Line No." WHERE (Document Type=FIELD(Document Type),
                                                                                                Document No.=FIELD(Document No.));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              NOR=Knyttet til linjenr.;
                                                              SVE=Bifogad till radnr];
                                                   Editable=No }
    { 81  ;   ;Exit Point          ;Code10        ;TableRelation="Entry/Exit Point";
                                                   CaptionML=[ENU=Exit Point;
                                                              NOR=Utpunkt;
                                                              SVE=Utf”rselplats] }
    { 82  ;   ;Area                ;Code10        ;TableRelation=Area;
                                                   CaptionML=[ENU=Area;
                                                              NOR=Omr†de;
                                                              SVE=Omr†de] }
    { 83  ;   ;Transaction Specification;Code10   ;TableRelation="Transaction Specification";
                                                   CaptionML=[ENU=Transaction Specification;
                                                              NOR=Transaksjonsspesifikasjon;
                                                              SVE=EU transaktionsspecifikation] }
    { 84  ;   ;Tax Category        ;Code10        ;CaptionML=[ENU=Tax Category;
                                                              NOR=Avgiftskategori;
                                                              SVE=Momskategori] }
    { 85  ;   ;Tax Area Code       ;Code20        ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Area Code;
                                                              NOR=Mva-omr†dekode;
                                                              SVE=Skatteomr†deskod] }
    { 86  ;   ;Tax Liable          ;Boolean       ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Liable;
                                                              NOR=Skyldig mva.;
                                                              SVE=Skattepliktig] }
    { 87  ;   ;Tax Group Code      ;Code20        ;TableRelation="Tax Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                ValidateTaxGroupCode;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Group Code;
                                                              NOR=Mva-gruppekode;
                                                              SVE=Skattegruppskod] }
    { 88  ;   ;VAT Clause Code     ;Code20        ;TableRelation="VAT Clause";
                                                   CaptionML=[ENU=VAT Clause Code;
                                                              NOR=Mva-setningskode;
                                                              SVE=Kod f”r momsklausul] }
    { 89  ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=VAR
                                                                lGLSetup@1100285400 : Record 98;
                                                              BEGIN
                                                                //**4PS.sn
                                                                GetSalesHeader;
                                                                IF SalesHeader."Extended VAT Determination" THEN
                                                                  "VAT Bus. Posting Group" := SalesHeader."VAT Bus. Posting Group";
                                                                VALIDATE("VAT Prod. Posting Group");
                                                                //**4PS.en

                                                                lGLSetup.GET;
                                                                IF lGLSetup."Norwegian Localization Active" THEN
                                                                  NorwegianVATTools.InitVATCode_SalesLine(Rec);  //NAVNO
                                                              END;

                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              NOR=Mva-bokf›ringsgruppe - firma;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 90  ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=VAR
                                                                IsHandled@1000 : Boolean;
                                                                lGLSetup@1100285400 : Record 98;
                                                              BEGIN
                                                                TestStatusOpen;
                                                                //**4PS.sn
                                                                //VATPostingSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group");

                                                                IF NOT VATPostingSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group") THEN
                                                                  VATPostingSetup.INIT;
                                                                //**4PS.en
                                                                "VAT Difference" := 0;

                                                                GetSalesHeader;
                                                                "VAT %" := VATPostingSetup."VAT %";
                                                                "VAT Calculation Type" := VATPostingSetup."VAT Calculation Type";
                                                                "Manually VAT Posting" := VATPostingSetup.Manually;        //**4PS.n
                                                                "VAT Identifier" := VATPostingSetup."VAT Identifier";
                                                                "VAT Clause Code" := VATPostingSetup."VAT Clause Code";

                                                                IsHandled := FALSE;
                                                                OnValidateVATProdPostingGroupOnBeforeCheckVATCalcType(Rec,VATPostingSetup,IsHandled);
                                                                IF NOT IsHandled THEN
                                                                  CASE "VAT Calculation Type" OF
                                                                    "VAT Calculation Type"::"Reverse Charge VAT",
                                                                    "VAT Calculation Type"::"Sales Tax":
                                                                      "VAT %" := 0;
                                                                    "VAT Calculation Type"::"Full VAT":
                                                                      BEGIN
                                                                        TESTFIELD(Type,Type::"G/L Account");
                                                                        TESTFIELD("No.",VATPostingSetup.GetSalesAccount(FALSE));
                                                                      END;
                                                                  END;

                                                                IF SalesHeader."Prices Including VAT" AND (Type IN [Type::Item,Type::Resource]) THEN
                                                                  "Unit Price" :=
                                                                    ROUND(
                                                                      "Unit Price" * (100 + "VAT %") / (100 + xRec."VAT %"),
                                                                      Currency."Unit-Amount Rounding Precision");
                                                                UpdateAmounts;

                                                                lGLSetup.GET;
                                                                IF lGLSetup."Norwegian Localization Active" THEN
                                                                  NorwegianVATTools.InitVATCode_SalesLine(Rec);  //NAVNO
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Mva-bokf›ringsgruppe - vare;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 91  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod];
                                                   Editable=No }
    { 92  ;   ;Outstanding Amount (LCY);Decimal   ;CaptionML=[ENU=Outstanding Amount (LCY);
                                                              NOR=Utest†ende bel›p (NOK);
                                                              SVE=Utest†ende belopp (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 93  ;   ;Shipped Not Invoiced (LCY);Decimal ;CaptionML=[ENU=Shipped Not Invoiced (LCY) Incl. VAT;
                                                              NOR=Levert, ikke fakturert (NOK), inkl. mva.;
                                                              SVE=Levererat ej fakturerat (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 94  ;   ;Shipped Not Inv. (LCY) No VAT;Decimal;
                                                   FieldClass=Normal;
                                                   CaptionML=[ENU=Shipped Not Invoiced (LCY);
                                                              NOR=Levert, ikke fakturert (NOK);
                                                              SVE=Levererat ej fakturerat (BVA)];
                                                   Editable=No }
    { 95  ;   ;Reserved Quantity   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Reservation Entry".Quantity WHERE (Source ID=FIELD(Document No.),
                                                                                                        Source Ref. No.=FIELD(Line No.),
                                                                                                        Source Type=CONST(37),
                                                                                                        Source Subtype=FIELD(Document Type),
                                                                                                        Reservation Status=CONST(Reservation)));
                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Reserved Quantity;
                                                              NOR=Reservert antall;
                                                              SVE=Reserverat antal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 96  ;   ;Reserve             ;Option        ;OnValidate=VAR
                                                                Item@1000 : Record 27;
                                                              BEGIN
                                                                IF Reserve <> Reserve::Never THEN BEGIN
                                                                  TESTFIELD(Type,Type::Item);
                                                                  TESTFIELD("No.");
                                                                END;
                                                                CALCFIELDS("Reserved Qty. (Base)");
                                                                IF (Reserve = Reserve::Never) AND ("Reserved Qty. (Base)" > 0) THEN
                                                                  TESTFIELD("Reserved Qty. (Base)",0);

                                                                IF "Drop Shipment" OR "Special Order" THEN
                                                                  TESTFIELD(Reserve,Reserve::Never);
                                                                IF xRec.Reserve = Reserve::Always THEN BEGIN
                                                                  GetItem(Item);
                                                                  IF Item.Reserve = Item.Reserve::Always THEN
                                                                    TESTFIELD(Reserve,Reserve::Always);
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 27=R;
                                                   CaptionML=[ENU=Reserve;
                                                              NOR=Reserver;
                                                              SVE=Reservera];
                                                   OptionCaptionML=[ENU=Never,Optional,Always;
                                                                    NOR=Aldri,Alternativt,Alltid;
                                                                    SVE=Aldrig,Valfri,Alltid];
                                                   OptionString=Never,Optional,Always }
    { 97  ;   ;Blanket Order No.   ;Code20        ;TableRelation="Sales Header".No. WHERE (Document Type=CONST(Blanket Order));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Quantity Shipped",0);
                                                                IF "Blanket Order No." = '' THEN
                                                                  "Blanket Order Line No." := 0
                                                                ELSE
                                                                  VALIDATE("Blanket Order Line No.");
                                                              END;

                                                   OnLookup=BEGIN
                                                              BlanketOrderLookup;
                                                            END;

                                                   TestTableRelation=No;
                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Blanket Order No.;
                                                              NOR=Rammeordrenr.;
                                                              SVE=Avropsordernr];
                                                   Description=[4PS: Raam  -> Afroep  ] }
    { 98  ;   ;Blanket Order Line No.;Integer     ;TableRelation="Sales Line"."Line No." WHERE (Document Type=CONST(Blanket Order),
                                                                                                Document No.=FIELD(Blanket Order No.));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Quantity Shipped",0);
                                                                IF "Blanket Order Line No." <> 0 THEN BEGIN
                                                                  SalesLine2.GET("Document Type"::"Blanket Order","Blanket Order No.","Blanket Order Line No.");
                                                                  SalesLine2.TESTFIELD(Type,Type);
                                                                  SalesLine2.TESTFIELD("No.","No.");
                                                                  SalesLine2.TESTFIELD("Bill-to Customer No.","Bill-to Customer No.");
                                                                  SalesLine2.TESTFIELD("Sell-to Customer No.","Sell-to Customer No.");
                                                                  IF "Drop Shipment" THEN BEGIN
                                                                    SalesLine2.TESTFIELD("Variant Code","Variant Code");
                                                                    SalesLine2.TESTFIELD("Location Code","Location Code");
                                                                    SalesLine2.TESTFIELD("Unit of Measure Code","Unit of Measure Code");
                                                                  END ELSE BEGIN
                                                                    VALIDATE("Variant Code",SalesLine2."Variant Code");
                                                                    VALIDATE("Location Code",SalesLine2."Location Code");
                                                                    VALIDATE("Unit of Measure Code",SalesLine2."Unit of Measure Code");
                                                                  END;
                                                                  VALIDATE("Unit Price",SalesLine2."Unit Price");
                                                                  VALIDATE("Line Discount %",SalesLine2."Line Discount %");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              BlanketOrderLookup;
                                                            END;

                                                   TestTableRelation=No;
                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Blanket Order Line No.;
                                                              NOR=Rammeordrelinjenr.;
                                                              SVE=Avropsorder radnr];
                                                   Description=[4PS: Raam  -> Afroep  ] }
    { 99  ;   ;VAT Base Amount     ;Decimal       ;CaptionML=[ENU=VAT Base Amount;
                                                              NOR=Mva-grunnlagsbel›p;
                                                              SVE=Nettobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 100 ;   ;Unit Cost           ;Decimal       ;CaptionML=[ENU=Unit Cost;
                                                              NOR=Enhetskost;
                                                              SVE=Styckkostnad];
                                                   Editable=No;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 101 ;   ;System-Created Entry;Boolean       ;CaptionML=[ENU=System-Created Entry;
                                                              NOR=Opprettet automatisk;
                                                              SVE=Systemkreerad trans.];
                                                   Editable=No }
    { 103 ;   ;Line Amount         ;Decimal       ;OnValidate=VAR
                                                                MaxLineAmount@1000 : Decimal;
                                                              BEGIN
                                                                TESTFIELD(Type);
                                                                TESTFIELD(Quantity);
                                                                TESTFIELD("Unit Price");
                                                                GetSalesHeader;

                                                                "Line Amount" := ROUND("Line Amount",Currency."Amount Rounding Precision");

                                                                //MaxLineAmount := ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision"); //**4PS.o
                                                                MaxLineAmount := ROUND(Quantity * DimensionalFactor * "Unit Price" * RentalFactor,Currency."Amount Rounding Precision"); //**4PS.n

                                                                IF "Line Amount" < 0 THEN
                                                                  IF "Line Amount" < MaxLineAmount THEN
                                                                    ERROR(LineAmountInvalidErr);

                                                                IF "Line Amount" > 0 THEN
                                                                  IF "Line Amount" > MaxLineAmount THEN
                                                                    ERROR(LineAmountInvalidErr);

                                                                VALIDATE("Line Discount Amount",MaxLineAmount - "Line Amount");

                                                                //**4PS.en
                                                                UpdateAmountLCY;
                                                                "Line VAT Amount" := "Amount Including VAT" - Amount;
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Line Amount;
                                                              NOR=Linjebel›p;
                                                              SVE=Radbelopp];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Line Amount")) }
    { 104 ;   ;VAT Difference      ;Decimal       ;CaptionML=[ENU=VAT Difference;
                                                              NOR=Mva-differanse;
                                                              SVE=Momsdifferens];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 105 ;   ;Inv. Disc. Amount to Invoice;Decimal;
                                                   CaptionML=[ENU=Inv. Disc. Amount to Invoice;
                                                              NOR=F.rabt.bel som skal faktureres;
                                                              SVE=Fakturarabatt att fakturera];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 106 ;   ;VAT Identifier      ;Code20        ;CaptionML=[ENU=VAT Identifier;
                                                              NOR=Mva-type;
                                                              SVE=Moms-ID];
                                                   Editable=No }
    { 107 ;   ;IC Partner Ref. Type;Option        ;OnValidate=VAR
                                                                Item@1000 : Record 27;
                                                              BEGIN
                                                                IF "IC Partner Code" <> '' THEN
                                                                  "IC Partner Ref. Type" := "IC Partner Ref. Type"::"G/L Account";
                                                                IF "IC Partner Ref. Type" <> xRec."IC Partner Ref. Type" THEN
                                                                  "IC Partner Reference" := '';
                                                                IF "IC Partner Ref. Type" = "IC Partner Ref. Type"::"Common Item No." THEN BEGIN
                                                                  GetItem(Item);
                                                                  Item.TESTFIELD("Common Item No.");
                                                                  "IC Partner Reference" := Item."Common Item No.";
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 410=R;
                                                   CaptionML=[ENU=IC Partner Ref. Type;
                                                              NOR=Referansetype for KI-partner;
                                                              SVE=Ref.typ f”r konc.int. partner];
                                                   OptionCaptionML=[ENU=" ,G/L Account,Item,,,Charge (Item),Cross Reference,Common Item No.";
                                                                    NOR=" ,Finanskonto,Vare,,,Gebyr (vare),Kryssreferanse,Felles varenr.";
                                                                    SVE=" ,Redovisningskonto,Artikel,,,Debitering (artikel),Korsreferens,Gemensamt artikelnr"];
                                                   OptionString=[ ,G/L Account,Item,,,Charge (Item),Cross Reference,Common Item No.] }
    { 108 ;   ;IC Partner Reference;Code20        ;OnLookup=VAR
                                                              ICGLAccount@1000 : Record 410;
                                                              Item@1002 : Record 27;
                                                              ItemCrossReference@1001 : Record 5717;
                                                            BEGIN
                                                              IF "No." <> '' THEN
                                                                CASE "IC Partner Ref. Type" OF
                                                                  "IC Partner Ref. Type"::"G/L Account":
                                                                    BEGIN
                                                                      IF ICGLAccount.GET("IC Partner Reference") THEN;
                                                                      IF PAGE.RUNMODAL(PAGE::"IC G/L Account List",ICGLAccount) = ACTION::LookupOK THEN
                                                                        VALIDATE("IC Partner Reference",ICGLAccount."No.");
                                                                    END;
                                                                  "IC Partner Ref. Type"::Item:
                                                                    BEGIN
                                                                      IF Item.GET("IC Partner Reference") THEN;
                                                                      IF PAGE.RUNMODAL(PAGE::"Item List",Item) = ACTION::LookupOK THEN
                                                                        VALIDATE("IC Partner Reference",Item."No.");
                                                                    END;
                                                                  "IC Partner Ref. Type"::"Cross Reference":
                                                                    BEGIN
                                                                      ItemCrossReference.RESET;
                                                                      ItemCrossReference.SETCURRENTKEY("Cross-Reference Type","Cross-Reference Type No.");
                                                                      ItemCrossReference.SETFILTER(
                                                                        "Cross-Reference Type",'%1|%2',
                                                                        ItemCrossReference."Cross-Reference Type"::Customer,
                                                                        ItemCrossReference."Cross-Reference Type"::" ");
                                                                      ItemCrossReference.SETFILTER("Cross-Reference Type No.",'%1|%2',"Sell-to Customer No.",'');
                                                                      IF PAGE.RUNMODAL(PAGE::"Cross Reference List",ItemCrossReference) = ACTION::LookupOK THEN
                                                                        VALIDATE("IC Partner Reference",ItemCrossReference."Cross-Reference No.");
                                                                    END;
                                                                END;
                                                            END;

                                                   AccessByPermission=TableData 410=R;
                                                   CaptionML=[ENU=IC Partner Reference;
                                                              NOR=Referanse for KI-partner;
                                                              SVE=Konc.int. partnerreferens] }
    { 109 ;   ;Prepayment %        ;Decimal       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                UpdatePrepmtSetupFields;

                                                                IF HasTypeToFillMandatoryFields THEN
                                                                  UpdateAmounts;
                                                                UpdateBaseAmounts(Amount,"Amount Including VAT","VAT Base Amount");
                                                              END;

                                                   CaptionML=[ENU=Prepayment %;
                                                              NOR=Forskuddsprosent;
                                                              SVE=F”rskottsbetalning %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 110 ;   ;Prepmt. Line Amount ;Decimal       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                PrePaymentLineAmountEntered := TRUE;
                                                                TESTFIELD("Line Amount");
                                                                IF "Prepmt. Line Amount" < "Prepmt. Amt. Inv." THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text044,"Prepmt. Amt. Inv."));
                                                                IF "Prepmt. Line Amount" > "Line Amount" THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,"Line Amount"));
                                                                IF "System-Created Entry" AND NOT IsServiceCharge THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,0));
                                                                VALIDATE("Prepayment %",ROUND("Prepmt. Line Amount" * 100 / "Line Amount",0.00001));
                                                              END;

                                                   CaptionML=[ENU=Prepmt. Line Amount;
                                                              NOR=Linjebel›p for forskudd;
                                                              SVE=Radbelopp, f”rskottsbetalning];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt. Line Amount")) }
    { 111 ;   ;Prepmt. Amt. Inv.   ;Decimal       ;CaptionML=[ENU=Prepmt. Amt. Inv.;
                                                              NOR=Fakturert forskuddsbel›p;
                                                              SVE=Fakturabelopp, f”rskottsbetalning];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt. Amt. Inv.")) }
    { 112 ;   ;Prepmt. Amt. Incl. VAT;Decimal     ;CaptionML=[ENU=Prepmt. Amt. Incl. VAT;
                                                              NOR=Forskuddsbel›p inkl. mva;
                                                              SVE=F”rskottsbetalningsbelopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 113 ;   ;Prepayment Amount   ;Decimal       ;CaptionML=[ENU=Prepayment Amount;
                                                              NOR=Forskuddsbel›p;
                                                              SVE=F”rskottsbetalningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 114 ;   ;Prepmt. VAT Base Amt.;Decimal      ;CaptionML=[ENU=Prepmt. VAT Base Amt.;
                                                              NOR=Mva-grunnlagsbel›p for forskudd;
                                                              SVE=Nettobelopp, f”rskottsbetalning];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 115 ;   ;Prepayment VAT %    ;Decimal       ;CaptionML=[ENU=Prepayment VAT %;
                                                              NOR=Mva-prosent for forskudd;
                                                              SVE=Moms f”r f”rskottsbetalning %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   Editable=No }
    { 116 ;   ;Prepmt. VAT Calc. Type;Option      ;CaptionML=[ENU=Prepmt. VAT Calc. Type;
                                                              NOR=Mva-beregningstype for forskudd;
                                                              SVE=Momsber„kningstyp, f”rskottsbetalning];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    NOR=Normal mva.,Snudd avregning,Full mva.,Salgsmva.;
                                                                    SVE=Normal moms,Omv„nd EG-moms,Enbart moms,Oms„ttningsskatt];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                   Editable=No }
    { 117 ;   ;Prepayment VAT Identifier;Code20   ;CaptionML=[ENU=Prepayment VAT Identifier;
                                                              NOR=Mva-type for forskudd;
                                                              SVE=Moms-ID, f”rskottsbetalning];
                                                   Editable=No }
    { 118 ;   ;Prepayment Tax Area Code;Code20    ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Area Code;
                                                              NOR=Mva-omr†dekode for forskudd;
                                                              SVE=Skatteomr†deskod, f”rskottsbetalning] }
    { 119 ;   ;Prepayment Tax Liable;Boolean      ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Liable;
                                                              NOR=Skyldig mva for forskudd;
                                                              SVE=Skattepliktig f”rskottsbetalning] }
    { 120 ;   ;Prepayment Tax Group Code;Code20   ;TableRelation="Tax Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Group Code;
                                                              NOR=Mva-gruppekode for forskudd;
                                                              SVE=Skattegruppskod, f”rskottsbetalning] }
    { 121 ;   ;Prepmt Amt to Deduct;Decimal       ;OnValidate=BEGIN
                                                                IF "Prepmt Amt to Deduct" > "Prepmt. Amt. Inv." - "Prepmt Amt Deducted" THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text045,"Prepmt. Amt. Inv." - "Prepmt Amt Deducted"));

                                                                IF "Prepmt Amt to Deduct" > "Qty. to Invoice" * "Unit Price" THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text045,"Qty. to Invoice" * "Unit Price"));

                                                                IF ("Prepmt. Amt. Inv." - "Prepmt Amt to Deduct" - "Prepmt Amt Deducted") >
                                                                   (Quantity - "Qty. to Invoice" - "Quantity Invoiced") * "Unit Price"
                                                                THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text044,
                                                                      "Prepmt. Amt. Inv." - "Prepmt Amt Deducted" - (Quantity - "Qty. to Invoice" - "Quantity Invoiced") * "Unit Price"));
                                                              END;

                                                   CaptionML=[ENU=Prepmt Amt to Deduct;
                                                              NOR=Forskuddsbel›p til fradrag;
                                                              SVE=F”rskottsbetalning att dra av];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt Amt to Deduct")) }
    { 122 ;   ;Prepmt Amt Deducted ;Decimal       ;CaptionML=[ENU=Prepmt Amt Deducted;
                                                              NOR=Fratrukket forskuddsbel›p;
                                                              SVE=Avdragen f”rskottsbetalning];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt Amt Deducted")) }
    { 123 ;   ;Prepayment Line     ;Boolean       ;CaptionML=[ENU=Prepayment Line;
                                                              NOR=Forskuddslinje;
                                                              SVE=F”rskottsbetalningsrad];
                                                   Editable=No }
    { 124 ;   ;Prepmt. Amount Inv. Incl. VAT;Decimal;
                                                   CaptionML=[ENU=Prepmt. Amount Inv. Incl. VAT;
                                                              NOR=Fakturert forskuddsbel›p inkl. mva;
                                                              SVE=Fakturerad f”rskottsbetalning inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 129 ;   ;Prepmt. Amount Inv. (LCY);Decimal  ;CaptionML=[ENU=Prepmt. Amount Inv. (LCY);
                                                              NOR=Fakturert forskuddsbel›p (NOK);
                                                              SVE=Fakturerad f”rskottsbetalning (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;IC Partner Code     ;Code20        ;TableRelation="IC Partner";
                                                   OnValidate=BEGIN
                                                                IF "IC Partner Code" <> '' THEN BEGIN
                                                                  TESTFIELD(Type,Type::"G/L Account");
                                                                  GetSalesHeader;
                                                                  SalesHeader.TESTFIELD("Sell-to IC Partner Code",'');
                                                                  SalesHeader.TESTFIELD("Bill-to IC Partner Code",'');
                                                                  VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::"G/L Account");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=IC Partner Code;
                                                              NOR=KI-partnerkode;
                                                              SVE=Konc.int. partnerkod] }
    { 132 ;   ;Prepmt. VAT Amount Inv. (LCY);Decimal;
                                                   CaptionML=[ENU=Prepmt. VAT Amount Inv. (LCY);
                                                              NOR=Fakturert mva-forskuddsbel›p (NOK);
                                                              SVE=Fakturerad f”rskottsbetalning av moms (BVA)];
                                                   Editable=No }
    { 135 ;   ;Prepayment VAT Difference;Decimal  ;CaptionML=[ENU=Prepayment VAT Difference;
                                                              NOR=Mva-differanse for forskudd;
                                                              SVE=F”rskottsbetalning momsdifferens];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 136 ;   ;Prepmt VAT Diff. to Deduct;Decimal ;CaptionML=[ENU=Prepmt VAT Diff. to Deduct;
                                                              NOR=Mva-diff. for forskudd til fradrag;
                                                              SVE=F”rskottsbet. momsdiff att dra av];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 137 ;   ;Prepmt VAT Diff. Deducted;Decimal  ;CaptionML=[ENU=Prepmt VAT Diff. Deducted;
                                                              NOR=Fratrukket mva-diff. for forskudd;
                                                              SVE=F”rskottsbet. momsdiff. avdragen];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 145 ;   ;Pmt. Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD(Quantity);
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Pmt. Discount Amount;
                                                              NOR=Kontantrabattbel›p];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 180 ;   ;Line Discount Calculation;Option   ;CaptionML=[ENU=Line Discount Calculation;
                                                              NOR=Beregning av linjerabatt];
                                                   OptionCaptionML=[ENU=None,%,Amount;
                                                                    NOR=Ingen,%,Bel›p;
                                                                    SVE=Ingen,%,Belopp];
                                                   OptionString=None,%,Amount }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnValidate=BEGIN
                                                                DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
                                                              END;

                                                   OnLookup=BEGIN
                                                              ShowDimensions;
                                                            END;

                                                   CaptionML=[ENU=Dimension Set ID;
                                                              NOR=Dimensjonssett-ID;
                                                              SVE=Dimensionsupps„ttnings-ID];
                                                   Editable=No }
    { 900 ;   ;Qty. to Assemble to Order;Decimal  ;OnValidate=VAR
                                                                SalesLineReserve@1000 : Codeunit 99000832;
                                                              BEGIN
                                                                WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);

                                                                "Qty. to Asm. to Order (Base)" := CalcBaseQty("Qty. to Assemble to Order");

                                                                IF "Qty. to Asm. to Order (Base)" <> 0 THEN BEGIN
                                                                  TESTFIELD("Drop Shipment",FALSE);
                                                                  TESTFIELD("Special Order",FALSE);
                                                                  IF "Qty. to Asm. to Order (Base)" < 0 THEN
                                                                    FIELDERROR("Qty. to Assemble to Order",STRSUBSTNO(Text009,FIELDCAPTION("Quantity (Base)"),"Quantity (Base)"));
                                                                  TESTFIELD("Appl.-to Item Entry",0);

                                                                  CASE "Document Type" OF
                                                                    "Document Type"::"Blanket Order",
                                                                    "Document Type"::Quote:
                                                                      IF ("Quantity (Base)" = 0) OR ("Qty. to Asm. to Order (Base)" <= 0) OR SalesLineReserve.ReservEntryExist(Rec) THEN
                                                                        TESTFIELD("Qty. to Asm. to Order (Base)",0)
                                                                      ELSE
                                                                        IF "Quantity (Base)" <> "Qty. to Asm. to Order (Base)" THEN
                                                                          FIELDERROR("Qty. to Assemble to Order",STRSUBSTNO(Text031,0,"Quantity (Base)"));
                                                                    "Document Type"::Order:
                                                                      ;
                                                                    ELSE
                                                                      TESTFIELD("Qty. to Asm. to Order (Base)",0);
                                                                  END;
                                                                END;

                                                                CheckItemAvailable(FIELDNO("Qty. to Assemble to Order"));
                                                                IF NOT (CurrFieldNo IN [FIELDNO(Quantity),FIELDNO("Qty. to Assemble to Order")]) THEN
                                                                  GetDefaultBin;
                                                                AutoAsmToOrder;
                                                              END;

                                                   AccessByPermission=TableData 90=R;
                                                   CaptionML=[ENU=Qty. to Assemble to Order;
                                                              NOR=Ant. som skal monteres til ordre;
                                                              SVE=Antal att montera mot kundorder];
                                                   DecimalPlaces=0:5 }
    { 901 ;   ;Qty. to Asm. to Order (Base);Decimal;
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Assemble to Order","Qty. to Asm. to Order (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Asm. to Order (Base);
                                                              NOR=Ant. som skal monteres til ordre (lagerenhet);
                                                              SVE=Antal att montera mot kundorder (bas)];
                                                   DecimalPlaces=0:5 }
    { 902 ;   ;ATO Whse. Outstanding Qty.;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding" WHERE (Source Type=CONST(37),
                                                                                                                       Source Subtype=FIELD(Document Type),
                                                                                                                       Source No.=FIELD(Document No.),
                                                                                                                       Source Line No.=FIELD(Line No.),
                                                                                                                       Assemble to Order=FILTER(Yes)));
                                                   AccessByPermission=TableData 90=R;
                                                   CaptionML=[ENU=ATO Whse. Outstanding Qty.;
                                                              NOR=Restantall for ATO-lager;
                                                              SVE=ATO Restnot. antal i lager];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 903 ;   ;ATO Whse. Outstd. Qty. (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding (Base)" WHERE (Source Type=CONST(37),
                                                                                                                              Source Subtype=FIELD(Document Type),
                                                                                                                              Source No.=FIELD(Document No.),
                                                                                                                              Source Line No.=FIELD(Line No.),
                                                                                                                              Assemble to Order=FILTER(Yes)));
                                                   AccessByPermission=TableData 90=R;
                                                   CaptionML=[ENU=ATO Whse. Outstd. Qty. (Base);
                                                              NOR=Restantall for ATO-lager (lagerenhet);
                                                              SVE=ATO Restnot. antal i lager (bas)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1001;   ;Job Task No.        ;Code20        ;TableRelation="Job Task"."Job Task No." WHERE (Job No.=FIELD(Job No.));
                                                   CaptionML=[ENU=Job Task No.;
                                                              NOR=Prosjektoppgavenr.;
                                                              SVE=Projektaktivitetsnr];
                                                   Editable=No }
    { 1002;   ;Job Contract Entry No.;Integer     ;OnValidate=VAR
                                                                JobPlanningLine@1001 : Record 11020401;
                                                              BEGIN
                                                                JobPlanningLine.SETCURRENTKEY("Job Contract Entry No.");
                                                                JobPlanningLine.SETRANGE("Job Contract Entry No.","Job Contract Entry No.");
                                                                JobPlanningLine.FINDFIRST;
                                                                CreateDim(
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DATABASE::Job,JobPlanningLine."Job No.",
                                                                  DATABASE::"Service Order","Service Order No.", //**4PS.n 09-06-2010
                                                                  DATABASE::"Service-Contract","Service Contract No.", //**4PS.n 09-06-2010
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                  DATABASE::"Service Group", GetServiceObjectGroup);
                                                              END;

                                                   AccessByPermission=TableData 11072003=R;
                                                   CaptionML=[ENU=Job Contract Entry No.;
                                                              NOR=L›penr. for prosjektkontrakt;
                                                              SVE=L”pnr f”r projektkontrakt];
                                                   Editable=No }
    { 1300;   ;Posting Date        ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Sales Header"."Posting Date" WHERE (Document Type=FIELD(Document Type),
                                                                                                           No.=FIELD(Document No.)));
                                                   CaptionML=[ENU=Posting Date;
                                                              NOR=Bokf›ringsdato;
                                                              SVE=Bokf”ringsdatum] }
    { 1700;   ;Deferral Code       ;Code10        ;TableRelation="Deferral Template"."Deferral Code";
                                                   OnValidate=VAR
                                                                DeferralPostDate@1000 : Date;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                OnGetDeferralPostDate(SalesHeader,DeferralPostDate,Rec);
                                                                IF DeferralPostDate = 0D THEN
                                                                  DeferralPostDate := SalesHeader."Posting Date";

                                                                DeferralUtilities.DeferralCodeOnValidate(
                                                                  "Deferral Code",DeferralUtilities.GetSalesDeferralDocType,'','',
                                                                  "Document Type","Document No.","Line No.",
                                                                  GetDeferralAmount,DeferralPostDate,
                                                                  Description,SalesHeader."Currency Code");

                                                                IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                  "Returns Deferral Start Date" :=
                                                                    DeferralUtilities.GetDeferralStartDate(DeferralUtilities.GetSalesDeferralDocType,
                                                                      "Document Type","Document No.","Line No.","Deferral Code",SalesHeader."Posting Date");
                                                              END;

                                                   CaptionML=[ENU=Deferral Code;
                                                              NOR=Periodiseringskode;
                                                              SVE=Periodiseringskod] }
    { 1702;   ;Returns Deferral Start Date;Date   ;OnValidate=VAR
                                                                DeferralHeader@1000 : Record 1701;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                IF DeferralHeader.GET(DeferralUtilities.GetSalesDeferralDocType,'','',"Document Type","Document No.","Line No.") THEN
                                                                  DeferralUtilities.CreateDeferralSchedule("Deferral Code",DeferralUtilities.GetSalesDeferralDocType,'','',
                                                                    "Document Type","Document No.","Line No.",GetDeferralAmount,
                                                                    DeferralHeader."Calc. Method","Returns Deferral Start Date",
                                                                    DeferralHeader."No. of Periods",TRUE,
                                                                    DeferralHeader."Schedule Description",FALSE,
                                                                    //SalesHeader."Currency Code"); //**4PS.o
                                                                    SalesHeader."Currency Code",Description); //**4PS.n
                                                              END;

                                                   CaptionML=[ENU=Returns Deferral Start Date;
                                                              NOR=Startdato for periodisering av returer;
                                                              SVE=Returens periodiseringsstartdatum] }
    { 5402;   ;Variant Code        ;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Variant".Code WHERE (Item No.=FIELD(No.));
                                                   OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                IF "Variant Code" <> '' THEN
                                                                  //TESTFIELD(Type,Type::Item);  //**4PS.o
                                                                  TESTFIELD("Item No.");         //**4PS.n
                                                                TestStatusOpen;
                                                                CheckAssocPurchOrder(FIELDCAPTION("Variant Code"));

                                                                IF xRec."Variant Code" <> "Variant Code" THEN BEGIN
                                                                  TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                  TESTFIELD("Shipment No.",'');

                                                                  TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                  TESTFIELD("Return Receipt No.",'');
                                                                  InitItemAppl(FALSE);
                                                                END;

                                                                OnValidateVariantCodeOnAfterChecks(Rec,xRec,CurrFieldNo);

                                                                CheckItemAvailable(FIELDNO("Variant Code"));

                                                                //**4PS.so
                                                                //IF Type = Type::Item THEN BEGIN
                                                                //  GetUnitCost;  //for SKU price not relevant (ItemCostMgt.UpdateSKUFromItem)
                                                                //  UpdateUnitPrice((FIELDNO("Variant Code")));
                                                                //END;
                                                                //**4PS.eo

                                                                GetDefaultBin;
                                                                InitQtyToAsm;
                                                                AutoAsmToOrder;
                                                                IF (xRec."Variant Code" <> "Variant Code") AND (Quantity <> 0) THEN BEGIN
                                                                  IF NOT FullReservedQtyIsForAsmToOrder THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;

                                                                UpdateItemCrossRef;
                                                              END;

                                                   CaptionML=[ENU=Variant Code;
                                                              NOR=Variantkode;
                                                              SVE=Variantkod];
                                                   Description=4PS: TableRelation modified }
    { 5403;   ;Bin Code            ;Code20        ;TableRelation=IF (Document Type=FILTER(Order|Invoice),
                                                                     Quantity=FILTER(>=0),
                                                                     Qty. to Asm. to Order (Base)=CONST(0)) "Bin Content"."Bin Code" WHERE (Location Code=FIELD(Location Code),
                                                                                                                                            Item No.=FIELD(Item No.),
                                                                                                                                            Variant Code=FIELD(Variant Code))
                                                                                                                                            ELSE IF (Document Type=FILTER(Return Order|Credit Memo),
                                                                                                                                                     Quantity=FILTER(<0)) "Bin Content"."Bin Code" WHERE (Location Code=FIELD(Location Code),
                                                                                                                                                                                                          Item No.=FIELD(Item No.),
                                                                                                                                                                                                          Variant Code=FIELD(Variant Code))
                                                                                                                                                                                                          ELSE Bin.Code WHERE (Location Code=FIELD(Location Code));
                                                   OnValidate=VAR
                                                                WMSManagement@1001 : Codeunit 7302;
                                                              BEGIN
                                                                IF "Bin Code" <> '' THEN BEGIN
                                                                  IF NOT IsInbound AND ("Quantity (Base)" <> 0) AND ("Qty. to Asm. to Order (Base)" = 0) THEN
                                                                  //check Item No. instead of No; skip bin content for quantity=0
                                                                  //WMSManagement.FindBinContent("Location Code","Bin Code","No.","Variant Code",'')  //**4PS.o
                                                                    WMSManagement.FindBinContent("Location Code","Bin Code","Item No.","Variant Code",'')  //**4PS.n
                                                                  ELSE
                                                                    WMSManagement.FindBin("Location Code","Bin Code",'');
                                                                END;

                                                                IF "Drop Shipment" THEN
                                                                  CheckAssocPurchOrder(FIELDCAPTION("Bin Code"));

                                                                //TESTFIELD(Type,Type::Item);  //**4PS.o
                                                                TESTFIELD("Location Code");

                                                                //IF (Type = Type::Item) AND ("Bin Code" <> '') THEN BEGIN  //**4PS.o
                                                                IF ("Item No." <> '') AND ("Bin Code" <> '') THEN BEGIN  //**4PS.n
                                                                  TESTFIELD("Drop Shipment",FALSE);
                                                                  GetLocation("Location Code");
                                                                  Location.TESTFIELD("Bin Mandatory");
                                                                  CheckWarehouse;
                                                                END;
                                                                ATOLink.UpdateAsmBinCodeFromSalesLine(Rec);
                                                              END;

                                                   OnLookup=VAR
                                                              WMSManagement@1002 : Codeunit 7302;
                                                              BinCode@1000 : Code[20];
                                                            BEGIN
                                                              IF NOT IsInbound AND ("Quantity (Base)" <> 0) THEN
                                                              //check Item No. instead of No; skip bin content for quantity=0
                                                              //BinCode := WMSManagement.BinContentLookUp("Location Code","No.","Variant Code",'',"Bin Code")  //**4PS.o
                                                                BinCode := WMSManagement.BinContentLookUp("Location Code","Item No.","Variant Code",'',"Bin Code")  //**4PS.n
                                                              ELSE
                                                              //BinCode := WMSManagement.BinLookUp("Location Code","No.","Variant Code",'');  //**4PS.o
                                                                BinCode := WMSManagement.BinLookUpSpecific("Location Code","Item No.","Variant Code",'',"Job No.","Service Order No.","Bin Code");  //**4PS.n

                                                              IF BinCode <> '' THEN
                                                                VALIDATE("Bin Code",BinCode);
                                                            END;

                                                   CaptionML=[ENU=Bin Code;
                                                              NOR=Hyllekode;
                                                              SVE=Lagerplatskod];
                                                   Description=4PS: TableRelation modified }
    { 5404;   ;Qty. per Unit of Measure;Decimal   ;InitValue=1;
                                                   CaptionML=[ENU=Qty. per Unit of Measure;
                                                              NOR=Antall per enhet;
                                                              SVE=Antal per enhet];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5405;   ;Planned             ;Boolean       ;CaptionML=[ENU=Planned;
                                                              NOR=Planlagt;
                                                              SVE=Planerad];
                                                   Editable=No }
    { 5407;   ;Unit of Measure Code;Code10        ;TableRelation=IF (Type=CONST(Item),
                                                                     No.=FILTER(<>'')) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.))
                                                                     ELSE IF (Type=CONST(Resource),
                                                                              No.=FILTER(<>'')) "Resource Unit of Measure".Code WHERE (Resource No.=FIELD(No.))
                                                                              ELSE "Unit of Measure";
                                                   OnValidate=VAR
                                                                Item@1002 : Record 27;
                                                                UnitOfMeasureTranslation@1000 : Record 5402;
                                                                ResUnitofMeasure@1001 : Record 205;
                                                                IdentityManagement@1161 : Codeunit 9801;
                                                                lvTradeItemRec@1100525000 : Record 11012317;
                                                                lvOldQtyPerUnitOfMeasure@1100485000 : Decimal;
                                                              BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Qty. Shipped (Base)",0);
                                                                TESTFIELD("Return Qty. Received",0);
                                                                TESTFIELD("Return Qty. Received (Base)",0);
                                                                IF "Unit of Measure Code" <> xRec."Unit of Measure Code" THEN BEGIN
                                                                  TESTFIELD("Shipment No.",'');
                                                                  TESTFIELD("Return Receipt No.",'');
                                                                END;

                                                                CheckAssocPurchOrder(FIELDCAPTION("Unit of Measure Code"));

                                                                //**4PS.sn
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure Code") THEN BEGIN
                                                                  CheckItemUnitConversion;  //T007321
                                                                  UpdateUnitPrice(FIELDNO("Unit of Measure Code"));
                                                                END;
                                                                //**4PS.en

                                                                IF "Unit of Measure Code" = '' THEN
                                                                  "Unit of Measure" := ''
                                                                ELSE BEGIN
                                                                  IF NOT UnitOfMeasure.GET("Unit of Measure Code") THEN
                                                                    UnitOfMeasure.INIT;
                                                                  "Unit of Measure" := UnitOfMeasure.Description;
                                                                  GetSalesHeader;
                                                                  IF SalesHeader."Language Code" <> '' THEN BEGIN
                                                                    UnitOfMeasureTranslation.SETRANGE(Code,"Unit of Measure Code");
                                                                    UnitOfMeasureTranslation.SETRANGE("Language Code",SalesHeader."Language Code");
                                                                    IF UnitOfMeasureTranslation.FINDFIRST THEN
                                                                      "Unit of Measure" := UnitOfMeasureTranslation.Description;
                                                                  END ELSE
                                                                    IF IdentityManagement.IsInvAppId THEN
                                                                      "Unit of Measure" := UnitOfMeasure.GetDescriptionInCurrentLanguage;
                                                                END;
                                                                DistIntegration.EnterSalesItemCrossRef(Rec);
                                                                CASE Type OF
                                                                  Type::Item,
                                                                  Type::"G/L Account": //**4PS.n
                                                                    BEGIN
                                                                      IF "Item No." <> '' THEN BEGIN  //**4PS.n
                                                                        GetItem(Item);
                                                                        GetUnitCost;
                                                                        UpdateUnitPrice(FIELDNO("Unit of Measure Code"));
                                                                        CheckItemAvailable(FIELDNO("Unit of Measure Code"));
                                                                        "Gross Weight" := Item."Gross Weight" * "Qty. per Unit of Measure";
                                                                        "Net Weight" := Item."Net Weight" * "Qty. per Unit of Measure";
                                                                        "Unit Volume" := Item."Unit Volume" * "Qty. per Unit of Measure";
                                                                        "Units per Parcel" :=
                                                                          ROUND(Item."Units per Parcel" / "Qty. per Unit of Measure",UOMMgt.QtyRndPrecision);
                                                                        OnAfterAssignItemUOM(Rec,Item);
                                                                        IF (xRec."Unit of Measure Code" <> "Unit of Measure Code") AND (Quantity <> 0) THEN
                                                                          WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                        IF "Qty. per Unit of Measure" > xRec."Qty. per Unit of Measure" THEN
                                                                          InitItemAppl(FALSE);
                                                                      //**4PS.sn
                                                                      END ELSE BEGIN
                                                                        IF (NOT "Plant Invoice") AND ("Plant Type" <> '') THEN BEGIN
                                                                          lvOldQtyPerUnitOfMeasure := "Qty. per Unit of Measure";
                                                                          PlantQtyPerUnitOfMeasure("Unit of Measure Code");
                                                                          IF lvOldQtyPerUnitOfMeasure <> "Qty. per Unit of Measure" THEN
                                                                            VALIDATE("Unit Price", "Unit Price" * "Qty. per Unit of Measure" / lvOldQtyPerUnitOfMeasure);
                                                                        END ELSE BEGIN
                                                                          "Qty. per Unit of Measure" := 1;
                                                                        END;
                                                                      //**4PS.en
                                                                      END;
                                                                    END;
                                                                  Type::Resource:
                                                                    BEGIN
                                                                      IF "Unit of Measure Code" = '' THEN BEGIN
                                                                        GetResource;
                                                                        "Unit of Measure Code" := Resource."Base Unit of Measure";
                                                                      END;
                                                                      ResUnitofMeasure.GET("No.","Unit of Measure Code");
                                                                      "Qty. per Unit of Measure" := ResUnitofMeasure."Qty. per Unit of Measure";
                                                                      OnAfterAssignResourceUOM(Rec,Resource,ResUnitofMeasure);
                                                                      UpdateUnitPrice(FIELDNO("Unit of Measure Code"));
                                                                      FindResUnitCost;
                                                                    END;
                                                                //Type::"G/L Account",Type::"Fixed Asset",Type::"Charge (Item)",Type::" ": //**4PS.o
                                                                  Type::"Fixed Asset",Type::"Charge (Item)",Type::" ":  //**4PS.n
                                                                    "Qty. per Unit of Measure" := 1;
                                                                END;

                                                                IF lvTradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN        //**4PS04.n
                                                                  "Net Weight":= lvTradeItemRec.GetNetWeight("Unit of Measure Code");  //**4PS04.n

                                                                VALIDATE(Quantity);
                                                              END;

                                                   CaptionML=[ENU=Unit of Measure Code;
                                                              NOR=Enhetskode;
                                                              SVE=Enhetskod] }
    { 5415;   ;Quantity (Base)     ;Decimal       ;OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE(Quantity,"Quantity (Base)");
                                                                UpdateUnitPrice(FIELDNO("Quantity (Base)"));
                                                              END;

                                                   CaptionML=[ENU=Quantity (Base);
                                                              NOR=Antall (lagerenhet);
                                                              SVE=Antal (bas)];
                                                   DecimalPlaces=0:5 }
    { 5416;   ;Outstanding Qty. (Base);Decimal    ;CaptionML=[ENU=Outstanding Qty. (Base);
                                                              NOR=Restantall (lagerenhet);
                                                              SVE=Restnoterat antal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5417;   ;Qty. to Invoice (Base);Decimal     ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Invoice","Qty. to Invoice (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Invoice (Base);
                                                              NOR=Ant. som skal fakt. (l.enh.);
                                                              SVE=Ant. att faktureras (bas)];
                                                   DecimalPlaces=0:5 }
    { 5418;   ;Qty. to Ship (Base) ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Ship","Qty. to Ship (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Ship (Base);
                                                              NOR=Antall som skal leveres (l.enh);
                                                              SVE=Ant. att utlevereras (bas)];
                                                   DecimalPlaces=0:5 }
    { 5458;   ;Qty. Shipped Not Invd. (Base);Decimal;
                                                   CaptionML=[ENU=Qty. Shipped Not Invd. (Base);
                                                              NOR=Ant.levert ikke fakt. (lagenh);
                                                              SVE=Ant. levererat ej faktrd (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5460;   ;Qty. Shipped (Base) ;Decimal       ;CaptionML=[ENU=Qty. Shipped (Base);
                                                              NOR=Antall levert (lagerenhet);
                                                              SVE=Ant. levererat (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5461;   ;Qty. Invoiced (Base);Decimal       ;CaptionML=[ENU=Qty. Invoiced (Base);
                                                              NOR=Antall fakturert (lagerenhet);
                                                              SVE=Fakturerat antal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5495;   ;Reserved Qty. (Base);Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Reservation Entry"."Quantity (Base)" WHERE (Source ID=FIELD(Document No.),
                                                                                                                 Source Ref. No.=FIELD(Line No.),
                                                                                                                 Source Type=CONST(37),
                                                                                                                 Source Subtype=FIELD(Document Type),
                                                                                                                 Reservation Status=CONST(Reservation)));
                                                   AccessByPermission=TableData 110=R;
                                                   CaptionML=[ENU=Reserved Qty. (Base);
                                                              NOR=Reservert antall (lagerenhet);
                                                              SVE=Reserverat antal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5600;   ;FA Posting Date     ;Date          ;AccessByPermission=TableData 5600=R;
                                                   CaptionML=[ENU=FA Posting Date;
                                                              NOR=Aktivabokf.dato;
                                                              SVE=Anl. bokf”ringsdatum] }
    { 5602;   ;Depreciation Book Code;Code10      ;TableRelation="Depreciation Book";
                                                   OnValidate=BEGIN
                                                                GetFAPostingGroup;
                                                              END;

                                                   CaptionML=[ENU=Depreciation Book Code;
                                                              NOR=Avskrivningstabl†kode;
                                                              SVE=Avskrivningsregelkod] }
    { 5605;   ;Depr. until FA Posting Date;Boolean;AccessByPermission=TableData 5600=R;
                                                   CaptionML=[ENU=Depr. until FA Posting Date;
                                                              NOR=Avskr. frem til aktivabokf.dato;
                                                              SVE=Avskr. till anl. bokf.datum] }
    { 5612;   ;Duplicate in Depreciation Book;Code10;
                                                   TableRelation="Depreciation Book";
                                                   OnValidate=BEGIN
                                                                "Use Duplication List" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Duplicate in Depreciation Book;
                                                              NOR=Duplikat i avskrivningstabl†;
                                                              SVE=Dubblett i avskrivningsregel] }
    { 5613;   ;Use Duplication List;Boolean       ;OnValidate=BEGIN
                                                                "Duplicate in Depreciation Book" := '';
                                                              END;

                                                   AccessByPermission=TableData 5600=R;
                                                   CaptionML=[ENU=Use Duplication List;
                                                              NOR=Bruk duplikatoversikt;
                                                              SVE=Anv„nd dubblettlista] }
    { 5700;   ;Responsibility Center;Code10       ;TableRelation="Responsibility Center";
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Service Order","Service Order No.", //**4PS.n 09-06-2010
                                                                  DATABASE::"Service-Contract","Service Contract No.", //**4PS.n 09-06-2010
                                                                  //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                  DATABASE::"Service Group", GetServiceObjectGroup);
                                                              END;

                                                   CaptionML=[ENU=Responsibility Center;
                                                              NOR=Ansvarssenter;
                                                              SVE=Ansvarsenhet];
                                                   Editable=No }
    { 5701;   ;Out-of-Stock Substitution;Boolean  ;CaptionML=[ENU=Out-of-Stock Substitution;
                                                              NOR=Tomt p† lager-erstatning;
                                                              SVE=Ej i lager ers„ttning];
                                                   Editable=No }
    { 5702;   ;Substitution Available;Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Item Substitution" WHERE (Type=CONST(Item),
                                                                                                No.=FIELD(No.),
                                                                                                Substitute Type=CONST(Item)));
                                                   CaptionML=[ENU=Substitution Available;
                                                              NOR=Erstatning mulig;
                                                              SVE=Ers„ttning tillg„nglig];
                                                   Editable=No }
    { 5703;   ;Originally Ordered No.;Code20      ;TableRelation=IF (Type=CONST(Item)) Item;
                                                   AccessByPermission=TableData 5715=R;
                                                   CaptionML=[ENU=Originally Ordered No.;
                                                              NOR=Opprinnelig ordreant.;
                                                              SVE=Ursprungligen best„llt nr] }
    { 5704;   ;Originally Ordered Var. Code;Code10;TableRelation=IF (Type=CONST(Item)) "Item Variant".Code WHERE (Item No.=FIELD(Originally Ordered No.));
                                                   AccessByPermission=TableData 5715=R;
                                                   CaptionML=[ENU=Originally Ordered Var. Code;
                                                              NOR=Opprin. best. variant - kode;
                                                              SVE=Ursprungligen best„llt var.kod] }
    { 5705;   ;Cross-Reference No. ;Code20        ;OnValidate=VAR
                                                                ItemCrossReference@1000 : Record 5717;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                "Sell-to Customer No." := SalesHeader."Sell-to Customer No.";
                                                                ValidateCrossReferenceNo(ItemCrossReference,TRUE);
                                                              END;

                                                   OnLookup=BEGIN
                                                              CrossReferenceNoLookUp;
                                                            END;

                                                   AccessByPermission=TableData 5717=R;
                                                   CaptionML=[ENU=Cross-Reference No.;
                                                              NOR=Kryssreferansenr.;
                                                              SVE=Tv„rreferensnr] }
    { 5706;   ;Unit of Measure (Cross Ref.);Code10;TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.));
                                                   AccessByPermission=TableData 5717=R;
                                                   CaptionML=[ENU=Unit of Measure (Cross Ref.);
                                                              NOR=Enhet (kryssref.);
                                                              SVE=Enhet (tv„rref.)] }
    { 5707;   ;Cross-Reference Type;Option        ;CaptionML=[ENU=Cross-Reference Type;
                                                              NOR=Kryssreferansetype;
                                                              SVE=Tv„rreferens typ];
                                                   OptionCaptionML=[ENU=" ,Customer,Vendor,Bar Code";
                                                                    NOR=" ,Kunde,Leverand›r,Strekkode";
                                                                    SVE=" ,Kund,Leverant”r,Streckkod"];
                                                   OptionString=[ ,Customer,Vendor,Bar Code] }
    { 5708;   ;Cross-Reference Type No.;Code30    ;CaptionML=[ENU=Cross-Reference Type No.;
                                                              NOR=Kryssreferansetypenr.;
                                                              SVE=Tv„rreferens typnr] }
    { 5709;   ;Item Category Code  ;Code20        ;TableRelation="Item Category";
                                                   CaptionML=[ENU=Item Category Code;
                                                              NOR=Varekategorikode;
                                                              SVE=Artikelkategorikod] }
    { 5710;   ;Nonstock            ;Boolean       ;AccessByPermission=TableData 5718=R;
                                                   CaptionML=[ENU=Catalog;
                                                              NOR=Katalog;
                                                              SVE=Ej lagerf”rd];
                                                   Editable=No }
    { 5711;   ;Purchasing Code     ;Code10        ;TableRelation=Purchasing;
                                                   OnValidate=VAR
                                                                PurchasingCode@1000 : Record 5721;
                                                                ShippingAgentServices@1001 : Record 5790;
                                                              BEGIN
                                                                TestStatusOpen;
                                                                //**4PS.sn
                                                                //TESTFIELD(Type,Type::Item);
                                                                IF "Trade Item" = '' THEN TESTFIELD("Item No.");  //C002114
                                                                //**4PS.en
                                                                CheckAssocPurchOrder(FIELDCAPTION(Type));

                                                                IF PurchasingCode.GET("Purchasing Code") THEN BEGIN
                                                                  "Drop Shipment" := PurchasingCode."Drop Shipment";
                                                                  "Special Order" := PurchasingCode."Special Order";
                                                                  IF "Drop Shipment" OR "Special Order" THEN BEGIN
                                                                    TESTFIELD("Qty. to Asm. to Order (Base)",0);
                                                                    CALCFIELDS("Reserved Qty. (Base)");
                                                                    TESTFIELD("Reserved Qty. (Base)",0);
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);

                                                                    IF (Quantity <> 0) AND (Quantity = "Quantity Shipped") THEN
                                                                      ERROR(SalesLineCompletelyShippedErr);
                                                                    Reserve := Reserve::Never;
                                                                    IF "Drop Shipment" THEN BEGIN
                                                                      EVALUATE("Outbound Whse. Handling Time",'<0D>');
                                                                      EVALUATE("Shipping Time",'<0D>');
                                                                      UpdateDates;
                                                                      "Bin Code" := '';
                                                                    END;
                                                                  END ELSE
                                                                    SetReserveWithoutPurchasingCode;
                                                                END ELSE BEGIN
                                                                  "Drop Shipment" := FALSE;
                                                                  "Special Order" := FALSE;
                                                                  SetReserveWithoutPurchasingCode;
                                                                END;

                                                                IF ("Purchasing Code" <> xRec."Purchasing Code") AND
                                                                   (NOT "Drop Shipment") AND
                                                                   ("Drop Shipment" <> xRec."Drop Shipment")
                                                                THEN BEGIN
                                                                  IF "Location Code" = '' THEN BEGIN
                                                                    IF InvtSetup.GET THEN
                                                                      "Outbound Whse. Handling Time" := InvtSetup."Outbound Whse. Handling Time";
                                                                  END ELSE
                                                                    IF Location.GET("Location Code") THEN
                                                                      "Outbound Whse. Handling Time" := Location."Outbound Whse. Handling Time";
                                                                  IF ShippingAgentServices.GET("Shipping Agent Code","Shipping Agent Service Code") THEN
                                                                    "Shipping Time" := ShippingAgentServices."Shipping Time"
                                                                  ELSE BEGIN
                                                                    GetSalesHeader;
                                                                    "Shipping Time" := SalesHeader."Shipping Time";
                                                                  END;
                                                                  UpdateDates;
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 223=R;
                                                   CaptionML=[ENU=Purchasing Code;
                                                              NOR=Kj›pskode;
                                                              SVE=Ink”pskod] }
    { 5712;   ;Product Group Code  ;Code10        ;TableRelation="Product Group".Code WHERE (Item Category Code=FIELD(Item Category Code));
                                                   ValidateTableRelation=No;
                                                   ObsoleteState=Removed;
                                                   ObsoleteReason=Product Groups became first level children of Item Categories.;
                                                   CaptionML=[ENU=Product Group Code;
                                                              NOR=Produktgruppekode;
                                                              SVE=Produktgruppkod] }
    { 5713;   ;Special Order       ;Boolean       ;AccessByPermission=TableData 223=R;
                                                   CaptionML=[ENU=Special Order;
                                                              NOR=Spesialbestilling;
                                                              SVE=Specialorder];
                                                   Editable=No }
    { 5714;   ;Special Order Purchase No.;Code20  ;TableRelation=IF (Special Order=CONST(Yes)) "Purchase Header".No. WHERE (Document Type=CONST(Order));
                                                   AccessByPermission=TableData 223=R;
                                                   CaptionML=[ENU=Special Order Purchase No.;
                                                              NOR=Spesialbestillingsnr.;
                                                              SVE=Specialorderink”psnr] }
    { 5715;   ;Special Order Purch. Line No.;Integer;
                                                   TableRelation=IF (Special Order=CONST(Yes)) "Purchase Line"."Line No." WHERE (Document Type=CONST(Order),
                                                                                                                                 Document No.=FIELD(Special Order Purchase No.));
                                                   AccessByPermission=TableData 223=R;
                                                   CaptionML=[ENU=Special Order Purch. Line No.;
                                                              NOR=Spesialbestilling - bestillingslinjenr.;
                                                              SVE=Specialorderink”p radnr] }
    { 5749;   ;Whse. Outstanding Qty.;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding" WHERE (Source Type=CONST(37),
                                                                                                                       Source Subtype=FIELD(Document Type),
                                                                                                                       Source No.=FIELD(Document No.),
                                                                                                                       Source Line No.=FIELD(Line No.)));
                                                   AccessByPermission=TableData 14=R;
                                                   CaptionML=[ENU=Whse. Outstanding Qty.;
                                                              NOR=Restantall - lager;
                                                              SVE=Restnot. antal i lager];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 5750;   ;Whse. Outstanding Qty. (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding (Base)" WHERE (Source Type=CONST(37),
                                                                                                                              Source Subtype=FIELD(Document Type),
                                                                                                                              Source No.=FIELD(Document No.),
                                                                                                                              Source Line No.=FIELD(Line No.)));
                                                   AccessByPermission=TableData 14=R;
                                                   CaptionML=[ENU=Whse. Outstanding Qty. (Base);
                                                              NOR=Restantall - lager (lag.enhet);
                                                              SVE=Restnot. antal i lager (bas)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 5752;   ;Completely Shipped  ;Boolean       ;CaptionML=[ENU=Completely Shipped;
                                                              NOR=Fullstendig levert;
                                                              SVE=F„rdigt levererat];
                                                   Editable=No }
    { 5790;   ;Requested Delivery Date;Date       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF ("Requested Delivery Date" <> xRec."Requested Delivery Date") AND
                                                                   ("Promised Delivery Date" <> 0D)
                                                                THEN
                                                                  ERROR(
                                                                    Text028,
                                                                    FIELDCAPTION("Requested Delivery Date"),
                                                                    FIELDCAPTION("Promised Delivery Date"));

                                                                IF "Requested Delivery Date" <> 0D THEN
                                                                  VALIDATE("Planned Delivery Date","Requested Delivery Date")
                                                                ELSE BEGIN
                                                                  GetSalesHeader;
                                                                  VALIDATE("Shipment Date",SalesHeader."Shipment Date");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Requested Delivery Date;
                                                              NOR=nsket leveringsdato;
                                                              SVE=Beg„rt leveransdatum] }
    { 5791;   ;Promised Delivery Date;Date        ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Promised Delivery Date" <> 0D THEN
                                                                  VALIDATE("Planned Delivery Date","Promised Delivery Date")
                                                                ELSE
                                                                  VALIDATE("Requested Delivery Date");
                                                              END;

                                                   AccessByPermission=TableData 99000880=R;
                                                   CaptionML=[ENU=Promised Delivery Date;
                                                              NOR=Lovet leveringsdato;
                                                              SVE=Lovat leveransdatum] }
    { 5792;   ;Shipping Time       ;DateFormula   ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Drop Shipment" THEN
                                                                  DateFormularZero("Shipping Time",FIELDNO("Shipping Time"),FIELDCAPTION("Shipping Time"));
                                                                UpdateDates;

                                                                //**4PS.sn
                                                                IF (FORMAT("Shipping Time") = '') OR
                                                                   (CurrFieldNo = FIELDNO("Shipping Time"))
                                                                THEN
                                                                  CheckDeliveryTime(CurrFieldNo);

                                                                BalanceDatesAndDeliveryPeriod(FIELDNO("Shipping Time"));
                                                                //**4PS.en
                                                              END;

                                                   AccessByPermission=TableData 99000880=R;
                                                   CaptionML=[ENU=Shipping Time;
                                                              NOR=Leveringstid;
                                                              SVE=Leveranstid] }
    { 5793;   ;Outbound Whse. Handling Time;DateFormula;
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Drop Shipment" THEN
                                                                  DateFormularZero("Outbound Whse. Handling Time",
                                                                    FIELDNO("Outbound Whse. Handling Time"),FIELDCAPTION("Outbound Whse. Handling Time"));
                                                                UpdateDates;
                                                              END;

                                                   AccessByPermission=TableData 14=R;
                                                   CaptionML=[ENU=Outbound Whse. Handling Time;
                                                              NOR=Utg†ende lagerh†ndteringstid;
                                                              SVE=Avg†ende lagerhanteringstid] }
    { 5794;   ;Planned Delivery Date;Date         ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Planned Delivery Date" <> 0D THEN BEGIN
                                                                  PlannedDeliveryDateCalculated := TRUE;

                                                                  VALIDATE("Planned Shipment Date",CalcPlannedDate);

                                                                  IF "Planned Shipment Date" > "Planned Delivery Date" THEN
                                                                    "Planned Delivery Date" := "Planned Shipment Date";
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 99000880=R;
                                                   CaptionML=[ENU=Planned Delivery Date;
                                                              NOR=Planlagt lev.dato;
                                                              SVE=Planerat leveransdatum] }
    { 5795;   ;Planned Shipment Date;Date         ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Planned Shipment Date" <> 0D THEN BEGIN
                                                                  PlannedShipmentDateCalculated := TRUE;

                                                                  VALIDATE("Shipment Date",CalcShipmentDate);
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 99000880=R;
                                                   CaptionML=[ENU=Planned Shipment Date;
                                                              NOR=Planlagt forsendelsesdato;
                                                              SVE=Planerat utleveransdatum] }
    { 5796;   ;Shipping Agent Code ;Code10        ;TableRelation="Shipping Agent";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Shipping Agent Code" <> xRec."Shipping Agent Code" THEN
                                                                  VALIDATE("Shipping Agent Service Code",'');
                                                              END;

                                                   AccessByPermission=TableData 5790=R;
                                                   CaptionML=[ENU=Shipping Agent Code;
                                                              NOR=Transport›rkode;
                                                              SVE=Spedit”rkod] }
    { 5797;   ;Shipping Agent Service Code;Code10 ;TableRelation="Shipping Agent Services".Code WHERE (Shipping Agent Code=FIELD(Shipping Agent Code));
                                                   OnValidate=VAR
                                                                ShippingAgentServices@1000 : Record 5790;
                                                              BEGIN
                                                                TestStatusOpen;
                                                                IF "Shipping Agent Service Code" <> xRec."Shipping Agent Service Code" THEN
                                                                  EVALUATE("Shipping Time",'<>');

                                                                IF "Drop Shipment" THEN BEGIN
                                                                  EVALUATE("Shipping Time",'<0D>');
                                                                  UpdateDates;
                                                                END ELSE
                                                                  IF ShippingAgentServices.GET("Shipping Agent Code","Shipping Agent Service Code") THEN
                                                                    "Shipping Time" := ShippingAgentServices."Shipping Time"
                                                                  ELSE BEGIN
                                                                    GetSalesHeader;
                                                                    "Shipping Time" := SalesHeader."Shipping Time";
                                                                  END;

                                                                IF ShippingAgentServices."Shipping Time" <> xRec."Shipping Time" THEN
                                                                  VALIDATE("Shipping Time","Shipping Time");
                                                              END;

                                                   AccessByPermission=TableData 5790=R;
                                                   CaptionML=[ENU=Shipping Agent Service Code;
                                                              NOR=Transport›rservicekode;
                                                              SVE=Spedit”r servicekod] }
    { 5800;   ;Allow Item Charge Assignment;Boolean;
                                                   InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                CheckItemChargeAssgnt;
                                                              END;

                                                   AccessByPermission=TableData 5800=R;
                                                   CaptionML=[ENU=Allow Item Charge Assignment;
                                                              NOR=Tillat varegebyrtilordning;
                                                              SVE=Till†t art.omkost.f”rdelning] }
    { 5801;   ;Qty. to Assign      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Charge Assignment (Sales)"."Qty. to Assign" WHERE (Document Type=FIELD(Document Type),
                                                                                                                            Document No.=FIELD(Document No.),
                                                                                                                            Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Qty. to Assign;
                                                              NOR=Ant. som skal tilordnes;
                                                              SVE=Ant. att distribuera];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5802;   ;Qty. Assigned       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Charge Assignment (Sales)"."Qty. Assigned" WHERE (Document Type=FIELD(Document Type),
                                                                                                                           Document No.=FIELD(Document No.),
                                                                                                                           Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Qty. Assigned;
                                                              NOR=Ant. tilordnet;
                                                              SVE=Ant. tilldelat];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5803;   ;Return Qty. to Receive;Decimal     ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                                IsHandled@1001 : Boolean;
                                                              BEGIN
                                                                IF (CurrFieldNo <> 0) AND
                                                                   (Type = Type::Item) AND
                                                                   ("Return Qty. to Receive" <> 0) AND
                                                                   (NOT "Drop Shipment")
                                                                THEN
                                                                  CheckWarehouse;

                                                                OnValidateReturnQtyToReceiveOnAfterCheck(Rec,CurrFieldNo);

                                                                IF "Return Qty. to Receive" = Quantity - "Return Qty. Received" THEN
                                                                  InitQtyToReceive
                                                                ELSE BEGIN
                                                                  "Return Qty. to Receive (Base)" := CalcBaseQty("Return Qty. to Receive");
                                                                  InitQtyToInvoice;
                                                                END;

                                                                IsHandled := FALSE;
                                                                OnValidateQtyToReturnAfterInitQty(Rec,xRec,CurrFieldNo,IsHandled);
                                                                IF NOT IsHandled THEN BEGIN
                                                                  IF ("Return Qty. to Receive" * Quantity < 0) OR
                                                                     (ABS("Return Qty. to Receive") > ABS("Outstanding Quantity")) OR
                                                                     (Quantity * "Outstanding Quantity" < 0)
                                                                  THEN
                                                                    ERROR(Text020,"Outstanding Quantity");
                                                                  IF ("Return Qty. to Receive (Base)" * "Quantity (Base)" < 0) OR
                                                                     (ABS("Return Qty. to Receive (Base)") > ABS("Outstanding Qty. (Base)")) OR
                                                                     ("Quantity (Base)" * "Outstanding Qty. (Base)" < 0)
                                                                  THEN
                                                                    ERROR(Text021,"Outstanding Qty. (Base)");
                                                                END;

                                                                //IF (CurrFieldNo <> 0) AND (Type = Type::Item) AND ("Return Qty. to Receive" > 0) THEN //**4PS.o
                                                                IF (CurrFieldNo <> 0) AND ("Item No." <> '') AND ("Return Qty. to Receive" > 0) THEN //**4PS.n
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);
                                                              END;

                                                   AccessByPermission=TableData 6660=R;
                                                   CaptionML=[ENU=Return Qty. to Receive;
                                                              NOR=Returant. som skal mottas;
                                                              SVE=Inlevereras antal];
                                                   DecimalPlaces=0:5 }
    { 5804;   ;Return Qty. to Receive (Base);Decimal;
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Return Qty. to Receive","Return Qty. to Receive (Base)");
                                                              END;

                                                   CaptionML=[ENU=Return Qty. to Receive (Base);
                                                              NOR=Returant. som skal mottas (lag.enh);
                                                              SVE=Returantal till inlevns (bas)];
                                                   DecimalPlaces=0:5 }
    { 5805;   ;Return Qty. Rcd. Not Invd.;Decimal ;CaptionML=[ENU=Return Qty. Rcd. Not Invd.;
                                                              NOR=Returant. mottatt, ikke fakt.;
                                                              SVE=Inlevrd. returantal ej faktrd];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5806;   ;Ret. Qty. Rcd. Not Invd.(Base);Decimal;
                                                   CaptionML=[ENU=Ret. Qty. Rcd. Not Invd.(Base);
                                                              NOR=Ret.ant. mott., ikke fakt. (l.enh);
                                                              SVE=Inlevrd. ret.ant ej faktrd bas];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5807;   ;Return Rcd. Not Invd.;Decimal      ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF SalesHeader."Currency Code" <> '' THEN
                                                                  "Return Rcd. Not Invd. (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(
                                                                        1, //**4PS.n
                                                                        "Job No.", //**4PS.n
                                                                        GetDate,"Currency Code",
                                                                //      "Return Rcd. Not Invd.",SalesHeader."Currency Factor"), //**4PS.o
                                                                        "Return Rcd. Not Invd.",SalesHeader."Currency Factor",TRUE), //**4PS.n
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Return Rcd. Not Invd. (LCY)" :=
                                                                    ROUND("Return Rcd. Not Invd.",Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Return Rcd. Not Invd.;
                                                              NOR=Retur mott., ikke fakt.;
                                                              SVE=Inlevrd. retur ej faktrd];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 5808;   ;Return Rcd. Not Invd. (LCY);Decimal;CaptionML=[ENU=Return Rcd. Not Invd. (LCY);
                                                              NOR=Retur mott., ikke fakt. (NOK);
                                                              SVE=Inlevrd. retur ej faktrd (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 5809;   ;Return Qty. Received;Decimal       ;AccessByPermission=TableData 6660=R;
                                                   CaptionML=[ENU=Return Qty. Received;
                                                              NOR=Returant. mottatt;
                                                              SVE=Inlevererat returantal];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5810;   ;Return Qty. Received (Base);Decimal;CaptionML=[ENU=Return Qty. Received (Base);
                                                              NOR=Returant. mottatt (l.enh);
                                                              SVE=Inlevererat returantal (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5811;   ;Appl.-from Item Entry;Integer      ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                              BEGIN
                                                                IF "Appl.-from Item Entry" <> 0 THEN BEGIN
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);
                                                                  VALIDATE("Unit Cost (LCY)",CalcUnitCost(ItemLedgEntry));
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              SelectItemEntry(FIELDNO("Appl.-from Item Entry"));
                                                            END;

                                                   AccessByPermission=TableData 27=R;
                                                   CaptionML=[ENU=Appl.-from Item Entry;
                                                              NOR=Utlignet fra-varepost;
                                                              SVE=Koppla fr†n artikell”pnr];
                                                   MinValue=0 }
    { 5909;   ;BOM Item No.        ;Code20        ;TableRelation=Item;
                                                   CaptionML=[ENU=BOM Item No.;
                                                              NOR=Stykklistevarenr.;
                                                              SVE=Strukturartikelnr] }
    { 6600;   ;Return Receipt No.  ;Code20        ;CaptionML=[ENU=Return Receipt No.;
                                                              NOR=Returseddelnr.;
                                                              SVE=Returinleveransnr];
                                                   Editable=No }
    { 6601;   ;Return Receipt Line No.;Integer    ;CaptionML=[ENU=Return Receipt Line No.;
                                                              NOR=Returseddellinjenr.;
                                                              SVE=Returinleverans radnr];
                                                   Editable=No }
    { 6608;   ;Return Reason Code  ;Code10        ;TableRelation="Return Reason";
                                                   OnValidate=BEGIN
                                                                ValidateReturnReasonCode(FIELDNO("Return Reason Code"));
                                                              END;

                                                   CaptionML=[ENU=Return Reason Code;
                                                              NOR=Retur†rsakskode;
                                                              SVE=Returorsakskod] }
    { 6610;   ;Copied From Posted Doc.;Boolean    ;DataClassification=SystemMetadata;
                                                   CaptionML=[ENU=Copied From Posted Doc.;
                                                              NOR=Overf›rt fra bokf›rte dok.] }
    { 7001;   ;Allow Line Disc.    ;Boolean       ;InitValue=Yes;
                                                   CaptionML=[ENU=Allow Line Disc.;
                                                              NOR=Tillat linjerabatt;
                                                              SVE=Till†t radrabatt] }
    { 7002;   ;Customer Disc. Group;Code20        ;TableRelation="Customer Discount Group";
                                                   OnValidate=BEGIN
                                                                //IF Type = Type::Item THEN //**4PS.o
                                                                IF (Type = Type::Item) OR ("Item No." <> '') THEN //**4PS.n
                                                                  UpdateUnitPrice(FIELDNO("Customer Disc. Group"))
                                                              END;

                                                   CaptionML=[ENU=Customer Disc. Group;
                                                              NOR=Kunderabattgruppe;
                                                              SVE=Kundrabattgrupp] }
    { 7003;   ;Subtype             ;Option        ;CaptionML=[ENU=Subtype;
                                                              NOR=Undertype];
                                                   OptionCaptionML=[ENU=" ,Item - Inventory,Item - Service,Comment";
                                                                    NOR=" ,Vare - Beholdning,Vare - Service,Kommentar"];
                                                   OptionString=[ ,Item - Inventory,Item - Service,Comment] }
    { 7004;   ;Price description   ;Text80        ;CaptionML=[ENU=Price description;
                                                              NOR=Prisbeskrivelse] }
    { 7010;   ;Attached Doc Count  ;Integer       ;FieldClass=FlowField;
                                                   InitValue=0;
                                                   CalcFormula=Count("Document Attachment" WHERE (Table ID=CONST(37),
                                                                                                  No.=FIELD(Document No.),
                                                                                                  Document Type=FIELD(Document Type),
                                                                                                  Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Attached Doc Count;
                                                              NOR=Opptelling for vedlagt dokument];
                                                   BlankNumbers=DontBlank }
    { 10604;  ;VAT Code            ;Code10        ;TableRelation="VAT Code".Code;
                                                   OnValidate=BEGIN
                                                                NorwegianVATTools.InitPostingGrps_SalesLine(Rec);
                                                              END;

                                                   CaptionML=[ENU=VAT Code;
                                                              NOR=Mva-kode;
                                                              SVE=Momskod];
                                                   Description=NAVNO }
    { 10605;  ;Account Code NO     ;Text30        ;OnValidate=BEGIN
                                                                IF (Type = Type::" ") AND ("Account Code NO" <> '') THEN
                                                                  ERROR(Text13600,FIELDCAPTION("Account Code NO"),FIELDCAPTION(Type),Type);
                                                              END;

                                                   CaptionML=[ENU=Account Code;
                                                              NOR=Kontokode;
                                                              SVE=Kontokod (DK)];
                                                   Description=NAVNO }
    { 11200;  ;Auto. Acc. Group    ;Code10        ;TableRelation="Automatic Acc. Header";
                                                   CaptionML=[ENU=Auto. Acc. Group;
                                                              SVE=Automatkonteringsmall];
                                                   Description=NAVSE,NAVFI }
    { 13600;  ;Account Code DK     ;Text30        ;OnValidate=BEGIN
                                                                IF (Type = Type::" ") AND ("Account Code DK" <> '') THEN
                                                                  ERROR(Text13600,FIELDCAPTION("Account Code DK"),FIELDCAPTION(Type),Type);
                                                              END;

                                                   CaptionML=[ENU=Account Code;
                                                              SVE=Kontokod (DK)];
                                                   Description=NAVDK }
    { 11012000;;Project Invoice    ;Boolean       ;CaptionML=[ENU=Project Invoice;
                                                              NOR=Prosjektfaktura;
                                                              SVE=Projektfaktura];
                                                   Editable=No }
    { 11012010;;Installment Invoice;Boolean       ;CaptionML=[ENU=Installment Invoice;
                                                              NOR=Avdragsfaktura;
                                                              SVE=Betalplansfaktura];
                                                   Editable=No }
    { 11012015;;Production Motivation Date;Date   ;TableRelation="Unit Price Production Mot."."Production Date" WHERE (Project No.=FIELD(Job No.));
                                                   CaptionML=[ENU=Production Motivation Date;
                                                              NOR=Produksjonsmotivasjonsdato;
                                                              SVE=Datum f”r Produktionsorsak];
                                                   Editable=No }
    { 11012016;;Production Motivation Code;Code10 ;CaptionML=[ENU=Production Motivation Code;
                                                              NOR=Produksjonsmotivasjonskode;
                                                              SVE=Produktionsorsakskod];
                                                   Editable=No }
    { 11012020;;Installment No.    ;Code10        ;TableRelation=IF (Installment Invoice=CONST(Yes)) "Project Installment"."Installment No." WHERE (Project No.=FIELD(Job No.),
                                                                                                                                                    Principal=FIELD(Sell-to Customer No.),
                                                                                                                                                    Plot No.=FIELD(Plot No.));
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Installment No.;
                                                              NOR=Betalingsplansnummer;
                                                              SVE=Betalplansnummer];
                                                   Editable=No }
    { 11012021;;Installment Motivation;Date       ;TableRelation="Installment Motivation"."Production Date" WHERE (Project No.=FIELD(Job No.),
                                                                                                                   Principal=FIELD(Sell-to Customer No.));
                                                   CaptionML=[ENU=Installment Motivation;
                                                              NOR=Avdragsmotivasjon;
                                                              SVE=Upparbetade m„ngder] }
    { 11012024;;House Model        ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FIELD(Job No.));
                                                   CaptionML=[ENU=House Model;
                                                              NOR=Husmodell;
                                                              SVE=Husmodell];
                                                   NotBlank=Yes }
    { 11012025;;Plot No.           ;Code10        ;TableRelation=IF (Installment Invoice=CONST(Yes)) Plot."Plot No." WHERE (Project No.=FIELD(Job No.));
                                                   CaptionML=[ENU=Plot No.;
                                                              NOR=Tegningnr;
                                                              SVE=Ritningnr];
                                                   Editable=No }
    { 11012026;;Main Group         ;Code20        ;TableRelation="Option Main Group".Code WHERE (Project No.=FIELD(Job No.),
                                                                                                 Plot No.=FIELD(Plot No.));
                                                   CaptionML=[ENU=Main Group;
                                                              NOR=Hovedgruppe;
                                                              SVE=Huvudgrupp];
                                                   NotBlank=Yes }
    { 11012027;;Group              ;Code20        ;TableRelation="Option Group".Code WHERE (Project No.=FIELD(Job No.),
                                                                                            Plot No.=FIELD(Plot No.));
                                                   CaptionML=[ENU=Group;
                                                              NOR=Gruppe;
                                                              SVE=Grupp];
                                                   NotBlank=Yes }
    { 11012028;;Sub Group          ;Code20        ;TableRelation="Option Sub Group".Code WHERE (Project No.=FIELD(Job No.),
                                                                                                Plot No.=FIELD(Plot No.));
                                                   CaptionML=[ENU=Sub Group;
                                                              NOR=Undergruppe;
                                                              SVE=Undergrupp];
                                                   NotBlank=Yes }
    { 11012029;;Option             ;Code20        ;TableRelation=Option.Option WHERE (Project No.=FIELD(Job No.),
                                                                                      Plot No.=FIELD(Plot No.),
                                                                                      House Model=FIELD(House Model),
                                                                                      Main Group=FIELD(Main Group),
                                                                                      Group=FIELD(Group),
                                                                                      Sub Group=FIELD(Sub Group));
                                                   CaptionML=[ENU=Option;
                                                              NOR=Alternativ;
                                                              SVE=Alternativ];
                                                   NotBlank=Yes }
    { 11012030;;Commission No.     ;Code20        ;TableRelation=IF (Project Invoice=CONST(Yes),
                                                                     Installment Invoice=CONST(No)) Commission.No. WHERE (Project No.=FIELD(Job No.),
                                                                                                                          Principal=FIELD(Sell-to Customer No.));
                                                   CaptionML=[ENU=Commission No.;
                                                              NOR=Oppdragsnr.;
                                                              SVE=Uppdragsnr.];
                                                   Editable=No }
    { 11012035;;Commission Date    ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Commission."Commission Date" WHERE (Project No.=FIELD(Job No.),
                                                                                                          Principal=FIELD(Sell-to Customer No.),
                                                                                                          No.=FIELD(Commission No.)));
                                                   CaptionML=[ENU=Commission Date;
                                                              NOR=Oppdragsdato;
                                                              SVE=Uppdragsdatum];
                                                   Editable=No }
    { 11012040;;Settl.Sheet No.    ;Code10        ;TableRelation=IF (Project Invoice=CONST(Yes),
                                                                     Installment Invoice=CONST(No)) "Settlement Sheet".No. WHERE (Project No.=FIELD(Job No.),
                                                                                                                                  Principal=FIELD(Sell-to Customer No.),
                                                                                                                                  Commission No.=FIELD(Commission No.));
                                                   CaptionML=[ENU=Settl.Sheet No.;
                                                              NOR=Avregningsarknr;
                                                              SVE=Avr„kningsarknr];
                                                   Editable=No }
    { 11012050;;Cost Plus Line No. ;Integer       ;TableRelation=IF (Project Invoice=CONST(Yes),
                                                                     Installment Invoice=CONST(No)) "Project Cost Plus Entry"."Line No." WHERE (Project No.=FIELD(Job No.),
                                                                                                                                                Principal=FIELD(No.),
                                                                                                                                                Commission No.=FIELD(Commission No.),
                                                                                                                                                Settl.Sheet No.=FIELD(Settl.Sheet No.));
                                                   CaptionML=[ENU=Cost Plus Line No.;
                                                              NOR=Radnr for selvkost;
                                                              SVE=Radnr f”r redovisag sj„lvkostnad];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012051;;Wage Component Cost Plus Line;Code10;
                                                   TableRelation="Wage Component".Code;
                                                   CaptionML=[ENU=Wage Component Cost Plus Line;
                                                              NOR=Selvkostsrad for l›nnsart;
                                                              SVE=Sj„lvkostnadsrad f”r l”neart];
                                                   Editable=No }
    { 11012052;;Description Wage Comp CP Line;Text30;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Wage Component".Description WHERE (Code=FIELD(Wage Component Cost Plus Line)));
                                                   CaptionML=[ENU=Description Wage Comp CP Line;
                                                              NOR=Beskrivelse av CP-rad for l›nnsart;
                                                              SVE=Beskrivning, l”neart CP-rad];
                                                   Editable=No }
    { 11012055;;Hour Rate Cost Plus Line;Code20   ;TableRelation="Hour Rate".Code;
                                                   CaptionML=[ENU=Hour Rate Cost Plus Line;
                                                              NOR=Selvkostsrad for timesats;
                                                              SVE=Sj„lvkostnadsrader f”r timtaxa];
                                                   Editable=No }
    { 11012056;;Description Hour Rate CP Line;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Hour Rate".Description WHERE (Code=FIELD(Hour Rate Cost Plus Line)));
                                                   CaptionML=[ENU=Description Hour Rate CP Line;
                                                              NOR=Beskrivelse av CP-rad for timesats;
                                                              SVE=Beskrivning, timtaxa CP-rad];
                                                   Editable=No }
    { 11012060;;Amount (LCY)       ;Decimal       ;CaptionML=[ENU=Amount (LCY);
                                                              NOR=Bel›p (NOK);
                                                              SVE=Belopp (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 11012070;;Element            ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Job No.));
                                                   OnValidate=VAR
                                                                ProjElemRec@11012000 : Record 11012010;
                                                                ElementFormat@11012001 : Codeunit 11012022;
                                                              BEGIN
                                                                ElementFormat.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN BEGIN
                                                                  ProjElemRec.GET("Job No.",Element);
                                                                  ProjElemRec.CheckProjectElementBlocked;  //call: 6564
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 11012080;;Extension Contract ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Job No.));
                                                   OnValidate=VAR
                                                                ExtContrRec@1210190000 : Record 11012004;
                                                              BEGIN
                                                                //**4PS.sn
                                                                IF ExtContrRec.GET("Job No.","Extension Contract") THEN
                                                                  IF ExtContrRec.Status < ExtContrRec.Status::"Invoicing Allowed" THEN
                                                                    ERROR(Text11012001,"Job No.","Extension Contract");
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=ŽTA] }
    { 11012085;;Dimensional Factor ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Line Discount %");
                                                              END;

                                                   CaptionML=ENU=Dimensional Factor;
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   BlankZero=Yes }
    { 11012090;;Failure No.        ;Code20        ;TableRelation=IF (Project Invoice=CONST(Yes),
                                                                     Installment Invoice=CONST(No)) Commission."Failure No." WHERE (Project No.=FIELD(Job No.),
                                                                                                                                    Principal=FIELD(Sell-to Customer No.),
                                                                                                                                    No.=FIELD(Commission No.));
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Failure No.;
                                                              NOR=Feilnr.;
                                                              SVE=Felnr];
                                                   Editable=No }
    { 11012100;;Supervisor Name    ;Text50        ;CaptionML=[ENU=Supervisor Name;
                                                              NOR=Arbeidslederens navn;
                                                              SVE=Arbetsledarens namn];
                                                   Editable=No }
    { 11012120;;Cost Type Cost Plus Line;Option   ;CaptionML=[ENU=Cost Type Cost Plus Line;
                                                              NOR=Kostnadstype, selvkostrad;
                                                              SVE=Kostnadstyp, sj„lvkostnadsrad];
                                                   OptionCaptionML=[ENU=Labor,Material,Subcontracting,Plant,Sundry,Revenue;
                                                                    NOR=Arbeidskraft,Materiale,Underentrepen›r,Maskin,Diverse,Inntekt;
                                                                    SVE=Arbetskraft,Material,Underentreprenad,Maskin,Diverse,Int„kt];
                                                   OptionString=Labor,Material,Subcontracting,Plant,Sundry,Revenue;
                                                   Editable=No }
    { 11012121;;Cost Object Cost Plus Line;Code20 ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Cost Object Cost Plus Line;
                                                              NOR=Kostnadsobjekt, selvkostsrad;
                                                              SVE=Kostnadsobjekt, sj„lvkostnadsrad] }
    { 11012122;;Description Cost Obj CP Line;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Code=FIELD(Cost Object Cost Plus Line),
                                                                                                    Global Dimension No.=CONST(2)));
                                                   CaptionML=[ENU=Description Cost Obj CP Line;
                                                              NOR=Beskrivelse av CP-rad for kostnadsobjekt;
                                                              SVE=Beskrivning, kostnadsobj. CP-rad];
                                                   Editable=No }
    { 11012130;;Item No.           ;Code20        ;TableRelation=Item.No.;
                                                   OnValidate=VAR
                                                                lvItemLogisticsRec@1100485000 : Record 27;
                                                              BEGIN
                                                                //**4PS
                                                                CheckItemAvailable(FIELDNO("Item No."));  //mve, 12-03-2014 - C009270
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  IF ("Job No." = '') AND ("Service Order No." = '') THEN BEGIN
                                                                    Type := Type::Item;
                                                                    VALIDATE("No.", "Item No.");  //beware of recursion between validate triggers
                                                                  END;
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                                  UpdateUnitPrice(FIELDNO("Item No.")); //mve, 12-03-2014 - C009270
                                                                  GetDefaultBin;
                                                                  UpdateVatProdPostingGrp;
                                                                END;

                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." = '') AND
                                                                   ("Job No." = '') AND ("Service Order No." = '') THEN
                                                                    VALIDATE("No.", "Item No.");

                                                                //** DP0121
                                                                IF "Item No." <> xRec."Item No." THEN BEGIN
                                                                  IF (Quantity <> 0) AND NSItemExists(xRec."Item No.") THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  GetSalesHeader;
                                                                  IF (SalesHeader."Language Code" <> '') AND
                                                                     ("Item No." <> '')
                                                                  THEN
                                                                    GetItemTranslation;
                                                                END;

                                                                IF ("Item No." <> '') THEN BEGIN
                                                                  TESTFIELD("Plant Type", '');
                                                                  TESTFIELD("Plant Set Code", '');
                                                                  IF SalesLogisticsSeparated() THEN BEGIN
                                                                    //* Item should also be present in logistic company
                                                                    lvItemLogisticsRec.CHANGECOMPANY(CompanyLogistics);
                                                                    lvItemLogisticsRec.GET("Item No.");  //* Should also be present in logistic company
                                                                  END;
                                                                  IF SalesLogisticsSepaRentContract() THEN BEGIN
                                                                    IF ("Arrival Date" = 0D) THEN
                                                                      IF NOT ItemIsRemovalOnly THEN BEGIN
                                                                        SalesHeader.GET("Document Type","Document No."); //Function GetSalesHeader returns old data
                                                                        VALIDATE("Arrival Date", SalesHeader."Arrival Date");
                                                                      END;
                                                                    CreateDim(                                                      //* 13473
                                                                      DATABASE::Item, "Item No.",
                                                                      DATABASE::"Plant Type", "Plant Type",
                                                                      DATABASE::Job,"Job No.",
                                                                      DATABASE::"Service Order","Service Order No.", //**4PS.n 09-06-2010
                                                                      DATABASE::"Service-Contract","Service Contract No.", //**4PS.n 09-06-2010
                                                                      DATABASE::"Responsibility Center","Responsibility Center",
                                                                      //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                      DATABASE::"Service Group", GetServiceObjectGroup);
                                                                  END;
                                                                END;

                                                                OnValidateItemNo(Rec, xRec);//4PSSE
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              NOR=Artikkelnr;
                                                              SVE=Artikelnr] }
    { 11012131;;Basic Item         ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  ValidateItem((ItemTypeOpt::"Basic Item"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              NOR=Fabrikantartikkel;
                                                              SVE=Basartikel] }
    { 11012132;;Trade Item         ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
                                                                  ValidateItem((ItemTypeOpt::"Trade Item"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              NOR=Katalogartikkel;
                                                              SVE=Anskaffningsartikel] }
    { 11012134;;Manufacturer       ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              NOR=Produsent;
                                                              SVE=Tillverkare] }
    { 11012135;;Vendor (Trade Item);Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                lvExecValidate@1100485000 : Boolean;
                                                                TradeItemRec@1100525000 : Record 11012317;
                                                              BEGIN
                                                                //**4PS
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              NOR=Leverand›r (katalogartikkel);
                                                              SVE=Leverant”r (skaffningsartikel)] }
    { 11012140;;Balance Incl. VAT  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Sales Line"."Amount Including VAT" WHERE (Document No.=FIELD(Document No.)));
                                                   CaptionML=[ENU=Balance Incl. VAT;
                                                              NOR=Saldo inkl. Mva;
                                                              SVE=Balans inkl. Moms];
                                                   Editable=No;
                                                   AutoFormatExpr="Currency Code" }
    { 11012150;;Balance Excl. VAT  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Sales Line".Amount WHERE (Document No.=FIELD(Document No.)));
                                                   CaptionML=[ENU=Balance Excl. VAT;
                                                              NOR=Saldo eks. Mva;
                                                              SVE=Balans exkl. moms];
                                                   Editable=No;
                                                   AutoFormatExpr="Currency Code" }
    { 11012160;;Points             ;Integer       ;CaptionML=[ENU=Points;
                                                              NOR=Poeng;
                                                              SVE=Po„ng];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012170;;Employee No.       ;Code20        ;TableRelation=Employee;
                                                   OnValidate=BEGIN
                                                                IF "Job No." <> '' THEN
                                                                  GetProjTypeRevenueAccount(FALSE,FALSE);
                                                              END;

                                                   CaptionML=[ENU=Employee No.;
                                                              NOR=Ansattnr;
                                                              SVE=Anst„llningsnr] }
    { 11012180;;Sales Surcharge Overtime %;Decimal;CaptionML=[ENU=Sales Surcharge Overtime %;
                                                              NOR=Salgstilleggsgebyr for overtid %;
                                                              SVE=F”rs„ljningstill„ggsavgiftsprocent f”r ”vertid];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 11012190;;Surcharge % (Project CP);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Cost Plus Entry"."Surcharge %" WHERE (Line No.=FIELD(Cost Plus Line No.),
                                                                                                                     Project No.=FIELD(Job No.),
                                                                                                                     Commission No.=FIELD(Commission No.),
                                                                                                                     Settl.Sheet No.=FIELD(Settl.Sheet No.),
                                                                                                                     Principal=FIELD(Sell-to Customer No.)));
                                                   CaptionML=[ENU=Surcharge % (Project CP);
                                                              NOR=Tilleggsgebyr % (prosjekt-CP);
                                                              SVE=Till„ggsavgiftsprocent (projekt CP)];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012200;;Text               ;Text250       ;OnValidate=BEGIN
                                                                "Text Block" := Text <> '';
                                                              END;

                                                   CaptionML=[ENU=Text;
                                                              NOR=Tekst;
                                                              SVE=Ben„mning] }
    { 11012201;;Text Block         ;Boolean       ;CaptionML=[ENU=Text Block;
                                                              NOR=Tekstblokk;
                                                              SVE=Textblock];
                                                   Editable=No }
    { 11012202;;Job Description    ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Job No.)));
                                                   CaptionML=[ENU=Job Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 11012220;;Cost Entry No. Project Ledger;Integer;
                                                   TableRelation="Job Ledger Entry";
                                                   CaptionML=[ENU=Cost Entry No. Project Ledger;
                                                              NOR=Kosttransaksjonsnr, prosjekttransaksjon;
                                                              SVE=Kostnadstransaktionsnr, projektreskontra] }
    { 11012221;;Cost Entry No. Service Ledger;Integer;
                                                   TableRelation="Service-Ledger Entry";
                                                   CaptionML=[ENU=Cost Entry No. Service Ledger;
                                                              NOR=Kostpostnr, servicepost;
                                                              SVE=Kostnadstransaktionsnr, servicereskontra] }
    { 11012250;;Cost Component     ;Code20        ;TableRelation="Cost Component".Code;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                ValidateCostComponent;
                                                              END;

                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadskomponent] }
    { 11012255;;Cost Type          ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value"."Cost Type" WHERE (Code=FIELD(Shortcut Dimension 2 Code),
                                                                                                           Global Dimension No.=CONST(2)));
                                                   CaptionML=[ENU=Cost Type;
                                                              NOR=Kostnadstype;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=Labor,Material,Subcontracting,Plant,Sundry,Revenue;
                                                                    NOR=Arbeidskraft,Materiale,Underentrepen›r,Maskin,Diverse,Inntekt;
                                                                    SVE=Arbetskraft,Material,Underentreprenad,Maskin,Diverse,Int„kt];
                                                   OptionString=Labor,Material,Subcontracting,Plant,Sundry,Revenue;
                                                   Editable=No }
    { 11012300;;Gross Price (FCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Gross Price (FCY)") THEN
                                                                  CalculateLCYFromFCY(FIELDNO("Gross Price (FCY)"), TRUE);  //C041255
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              NOR=Bruttopris;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 11012301;;Gross Price (LCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                CalculateFCYFromLCY(FIELDNO("Gross Price (LCY)"));  //C041255
                                                                IF CurrFieldNo = FIELDNO("Gross Price (LCY)") THEN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                VALIDATE("Basic Price (LCY)", "Gross Price (LCY)" * (100 - "Sales Discount % (Item)")/100);
                                                              END;

                                                   CaptionML=[ENU=Gross Price (LCY);
                                                              NOR=Bruttopris (NOK);
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   Description=C041255;
                                                   AutoFormatType=2 }
    { 11012310;;Purchase Discount % (Item);Decimal;CaptionML=[ENU=Purchase Discount % (Item);
                                                              NOR=Innkj›psrabatt % (Artikkel);
                                                              SVE=Ink”psrabattprocent (artikel)];
                                                   MaxValue=100;
                                                   BlankZero=Yes }
    { 11012320;;Execution Date     ;Date          ;CaptionML=[ENU=Execution Date;
                                                              NOR=Gjennomf›ringsdato;
                                                              SVE=Utf”randedatum] }
    { 11012330;;Sales Discount % (Item);Decimal   ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Sales Discount % (Item)") THEN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                VALIDATE("Basic Price (LCY)", "Gross Price (LCY)" * (100 - "Sales Discount % (Item)")/100);
                                                              END;

                                                   CaptionML=[ENU=Sales Discount % (Item);
                                                              NOR=Salgsrabatt % (Artikkel);
                                                              SVE=F”rs„ljningsrabattprocent (artikel)];
                                                   MaxValue=100;
                                                   BlankZero=Yes }
    { 11012335;;Sales Condition Present;Boolean   ;CaptionML=[ENU=Sales Condition Present;
                                                              SVE=F”rs„ljningsvillkor Present];
                                                   Description=DP01339;
                                                   Editable=No }
    { 11012336;;Price Specification Leading;Boolean;
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Price Specification Leading") THEN BEGIN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                  FindSalesPrice;  //DP01339
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Price Specification Leading;
                                                   Description=DP01339 }
    { 11012340;;Basic Price (FCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Basic Price (FCY)") THEN
                                                                  CalculateLCYFromFCY(FIELDNO("Basic Price (FCY)"), TRUE);  //C041255
                                                              END;

                                                   CaptionML=[ENU=Basic Price;
                                                              NOR=Grunnpris;
                                                              SVE=Grundpris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 11012341;;Basic Price (LCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                CalculateFCYFromLCY(FIELDNO("Basic Price (LCY)"));  //C041255
                                                                IF CurrFieldNo = FIELDNO("Basic Price (LCY)") THEN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                VALIDATE("Surcharge %");
                                                                VALIDATE("Discount % (Contract)");
                                                                GetSalesDiscount;  //DP01339
                                                              END;

                                                   CaptionML=[ENU=Basic Price (LCY);
                                                              NOR=Basispris (NOK);
                                                              SVE=Grundpris];
                                                   BlankZero=Yes;
                                                   Description=C041255;
                                                   AutoFormatType=2 }
    { 11012350;;Surcharge %        ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Surcharge %") THEN BEGIN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                  IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlantNumber) THEN
                                                                    PlantNumber.CheckExternalPostNoSurcharge("Plant Type", "Plant No.", TRUE);
                                                                END;
                                                                "Sales Price (LCY)" := "Basic Price (LCY)" * (1 + "Surcharge %"/100);
                                                                "Sales Price (LCY)" := ROUND("Sales Price (LCY)", Currency."Unit-Amount Rounding Precision");  //C041753
                                                                CalculateFCYFromLCY(FIELDNO("Sales Price (LCY)"));  //C041255
                                                                VALIDATE("Surcharge Amount (LCY)");
                                                                VALIDATE("Discount % (Contract)");
                                                              END;

                                                   CaptionML=[ENU=Surcharge %;
                                                              NOR=Tilleggsgebyrsprosent;
                                                              SVE=Till„ggsavgiftsprocent];
                                                   BlankZero=Yes }
    { 11012355;;Surcharge Amount (FCY);Decimal    ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Surcharge Amount (FCY)") THEN BEGIN
                                                                  IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlantNumber) THEN
                                                                    PlantNumber.CheckExternalPostNoSurcharge("Plant Type", "Plant No.", TRUE);
                                                                  CalculateLCYFromFCY(FIELDNO("Surcharge Amount (FCY)"), TRUE);  //C041255
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Surcharge Amount;
                                                              NOR=Tilleggsgebyrsbel›p;
                                                              SVE=Till„ggsbelopp];
                                                   BlankZero=Yes }
    { 11012356;;Surcharge Amount (LCY);Decimal    ;OnValidate=BEGIN
                                                                //**4PS
                                                                CalculateFCYFromLCY(FIELDNO("Surcharge Amount (LCY)"));  //C041255
                                                                IF CurrFieldNo = FIELDNO("Surcharge Amount (LCY)") THEN BEGIN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                  IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlantNumber) THEN
                                                                    PlantNumber.CheckExternalPostNoSurcharge("Plant Type", "Plant No.", TRUE);
                                                                  IF "Basic Price (LCY)" <> 0 THEN BEGIN
                                                                    VALIDATE("Sales Price (LCY)", "Basic Price (LCY)" + "Surcharge Amount (LCY)");  //DP01339
                                                                    "Surcharge %" := ("Sales Price (LCY)"/"Basic Price (LCY)" -1) * 100;
                                                                  END ELSE BEGIN
                                                                    "Surcharge %" := 0;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  "Surcharge Amount (LCY)" := "Sales Price (LCY)" - "Basic Price (LCY)";
                                                                  CalculateFCYFromLCY(FIELDNO("Surcharge Amount (LCY)"));  //C041255
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Surcharge Amount (LCY);
                                                              SVE=Till„ggsavgiftsbelopp (BVA)];
                                                   BlankZero=Yes;
                                                   Description=C041255 }
    { 11012360;;Sales Price (FCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF CurrFieldNo = FIELDNO("Sales Price (FCY)") THEN
                                                                  CalculateLCYFromFCY(FIELDNO("Sales Price (FCY)"), TRUE);  //C041255
                                                              END;

                                                   CaptionML=[ENU=Sales Price;
                                                              NOR=Salgspris;
                                                              SVE=F”rs„ljningspris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 11012361;;Sales Price (LCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS
                                                                CalculateFCYFromLCY(FIELDNO("Sales Price (LCY)"));  //C041255
                                                                IF CurrFieldNo = FIELDNO("Sales Price (LCY)") THEN BEGIN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                  IF "Basic Price (LCY)" <> 0 THEN
                                                                    "Surcharge %" := ("Sales Price (LCY)"/"Basic Price (LCY)" -1) * 100
                                                                  ELSE
                                                                    "Surcharge %" := 0;
                                                                  VALIDATE("Surcharge Amount (LCY)");
                                                                END;
                                                                VALIDATE("Discount % (Contract)");
                                                              END;

                                                   CaptionML=[ENU=Sales Price (LCY);
                                                              NOR=Totalt i salgspris;
                                                              SVE=Totalt i f”rs„ljningspris];
                                                   BlankZero=Yes;
                                                   Description=C041255;
                                                   AutoFormatType=2 }
    { 11012370;;Discount % (Contract);Decimal     ;OnValidate=BEGIN
                                                                //**4PS
                                                                //DP01339.sn
                                                                IF CurrFieldNo = FIELDNO("Discount % (Contract)") THEN
                                                                  CheckPriceSpecificationAllowed;  //DP01339
                                                                IF "Price Specification Leading" THEN
                                                                  "Line Discount %" := 0;
                                                                "Unit Price" := "Sales Price (FCY)" * (1 - "Discount % (Contract)"/100);  //C041255
                                                                "Unit Price" := "Unit Price" * "Qty. per Unit of Measure";  //T007321
                                                                "Unit Price" := ROUND("Unit Price", Currency."Unit-Amount Rounding Precision");
                                                                VALIDATE("Unit Price");
                                                                //DP01339.en
                                                              END;

                                                   CaptionML=[ENU=Discount % (Contract);
                                                              NOR=Rabatt % (Kontrakt);
                                                              SVE=Rabattprocent (kontrakt)];
                                                   MaxValue=100;
                                                   BlankZero=Yes }
    { 11012380;;Service Contract No.;Code20       ;TableRelation=Service-Contract.No.;
                                                   OnValidate=VAR
                                                                LedgerbyServTypeCustGr@1100529600 : Record 11072322;
                                                              BEGIN
                                                                //**4PS: validate en lookup section cleared due to changed relation
                                                                IF "Service Contract No." = '' THEN BEGIN
                                                                  IF "Item No." <> '' THEN BEGIN
                                                                    Type := Type::Item;
                                                                    "No." := "Item No.";
                                                                  END ELSE BEGIN
                                                                    "No." := '';
                                                                  END;
                                                                  FillSystemCreatedEntry;
                                                                END ELSE BEGIN
                                                                  ServContrRec.GET("Service Contract No.");
                                                                  ServContrRec.TESTFIELD(Status, ServContrRec.Status::"Invoicing Allowed");

                                                                  GetSalesHeader;

                                                                  Type := Type::"G/L Account";
                                                                  ServContrRec.TESTFIELD("Service Type");
                                                                  ServTypeRec.GET(ServContrRec."Service Type");
                                                                  IF NOT LedgerbyServTypeCustGr.GET(ServTypeRec.Code, SalesHeader."Customer Posting Group") THEN
                                                                    CLEAR(LedgerbyServTypeCustGr);
                                                                  IF LedgerbyServTypeCustGr."WIP Account Revenue" = '' THEN
                                                                    ServTypeRec.TESTFIELD("WIP Account Revenue");
                                                                  FillSystemCreatedEntry;

                                                                  IF LedgerbyServTypeCustGr."WIP Account Revenue" = '' THEN
                                                                    VALIDATE("No.", ServTypeRec."WIP Account Revenue")
                                                                  ELSE
                                                                    VALIDATE("No.", LedgerbyServTypeCustGr."WIP Account Revenue");
                                                                  VALIDATE("Shortcut Dimension 1 Code", ServContrRec."Global Dimension 1 Code");
                                                                END;

                                                                //**4PS.n
                                                                //** 09-06-2010 sn
                                                                CreateDim(
                                                                  DATABASE::"Service-Contract","Service Contract No.",
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                  DATABASE::"Service Group", GetServiceObjectGroup);

                                                                //** 09-06-2010 en
                                                              END;

                                                   CaptionML=[ENU=Service Contract No.;
                                                              NOR=Servicekontraktnr;
                                                              SVE=Servicekontraktnr] }
    { 11012390;;Service Order No.  ;Code20        ;TableRelation="Service Order";
                                                   OnValidate=VAR
                                                                ServiceOrderCostPlusEntry@1100528600 : Record 11012825;
                                                                ServiceCollectiveListMgt@1100528601 : Codeunit 11012850;
                                                              BEGIN
                                                                //**4PS
                                                                CheckProjServPlantLoanAllowed(FIELDNO("Service Order No."));
                                                                IF "Service Order No." = '' THEN BEGIN
                                                                  "Service Location No." := '';
                                                                  "Service Contract No." := '';
                                                                  "Service Control Year" := 0;
                                                                  "Base Service Order No." := '';
                                                                  "Cost Plus Line No." := 0;
                                                                  IF "Item No." <> '' THEN BEGIN
                                                                    Type := Type::Item;
                                                                    "No." := "Item No.";
                                                                    END ELSE BEGIN
                                                                    "No." := '';
                                                                  END;
                                                                  FillSystemCreatedEntry;
                                                                END ELSE BEGIN
                                                                  ServOrderRec.GET("Service Order No.");
                                                                  ServOrderRec.CheckStatus(1);
                                                                  ServOrderRec.TestServiceContractMandatory;
                                                                  GetSalesHeader;

                                                                  IF CurrFieldNo = FIELDNO("Service Order No.") THEN
                                                                    IF ("Service Order No." <> xRec."Service Order No.") AND (xRec."Service Order No." <> '') THEN
                                                                      "Cost Plus Line No." := 0;

                                                                  IF "Cost Plus Line No." = 0 THEN BEGIN
                                                                    IF ServOrderRec.UseBilltoAsSelltoCustomer THEN
                                                                      ServOrderRec.TESTFIELD("Bill-to Customer No.", SalesHeader."Sell-to Customer No.")
                                                                    ELSE
                                                                      ServOrderRec.TESTFIELD("Customer No.", SalesHeader."Sell-to Customer No.");
                                                                  END ELSE BEGIN
                                                                    ServiceOrderCostPlusEntry.GET("Service Order No.", "Cost Plus Line No.");
                                                                    IF ServOrderRec.UseBilltoAsSelltoCustomer THEN
                                                                      ServiceOrderCostPlusEntry.TESTFIELD("Bill-to Customer No.", SalesHeader."Sell-to Customer No.")
                                                                    ELSE
                                                                      ServiceOrderCostPlusEntry.TESTFIELD("Customer No.", SalesHeader."Sell-to Customer No.");
                                                                  END;

                                                                  Type := Type::"G/L Account";
                                                                  "Service Location No." := ServOrderRec."Service Location No.";
                                                                  "Service Contract No." := ServOrderRec."Service Contract No.";
                                                                  IF NOT "System-Created Entry" THEN
                                                                    FillSystemCreatedEntry;

                                                                  CheckAdditionalCostService;
                                                                  VALIDATE("VAT Prod. Posting Group", ServOrderRec."VAT Prod. Posting Group");

                                                                  "Base Service Order No." := ServOrderRec."Base Service Order No.";
                                                                END;

                                                                //** DP0121
                                                                IF "Service Order No." <> xRec."Service Order No." THEN
                                                                  IF (Quantity <> 0) AND NSItemExists(xRec."Item No.") THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                //

                                                                IF "Shortcut Dimension 2 Code" <> '' THEN
                                                                  VALIDATE("Shortcut Dimension 2 Code");
                                                                CheckCostCompServOrderType; //** 4PS03.n

                                                                //**4PS.n
                                                                //** 09-06-2010 sn
                                                                CreateDim(
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DATABASE::"Service-Contract","Service Contract No.",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                  DATABASE::"Service Group", GetServiceObjectGroup);

                                                                //** 09-06-2010 en
                                                              END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr;
                                                              SVE=Serviceordernr] }
    { 11012395;;Base Service Order No.;Code20     ;TableRelation="Service Order".No.;
                                                   CaptionML=[ENU=Base Service Order No.;
                                                              NOR=Baseserviceordrenr;
                                                              SVE=Basserviceordernr];
                                                   Editable=No }
    { 11012400;;Object No.         ;Code20        ;TableRelation=Service-Object;
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Service Group", GetServiceObjectGroup,
                                                                  DATABASE::"Service-Contract","Service Contract No.",
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::"Plant Type", "Plant Type", //**4PS.n
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                              END;

                                                   CaptionML=[ENU=Object No.;
                                                              NOR=Objektnr.;
                                                              SVE=Objektnr];
                                                   Description=S&O CONS }
    { 11012410;;Reserved NS Qty. (Base);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("NS Reservation Entry"."Quantity (Base)" WHERE (Source Type=CONST(37),
                                                                                                                   Source Subtype=FIELD(Document Type),
                                                                                                                   Source ID=FIELD(Document No.),
                                                                                                                   Source Ref. No.=FIELD(Line No.),
                                                                                                                   Reservation Status=CONST(Reservation)));
                                                   CaptionML=[ENU=Reserved Non-stock Qty. (Base);
                                                              NOR=Reservert antall ikke p† lager (lag.enh);
                                                              SVE=Reserverat antal ej lagerf”rda (bas)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 11012420;;Service Control Period Date;Date  ;OnValidate=BEGIN
                                                                IF "Service Control Period Date" <> 0D THEN
                                                                  IF "Service Order No." = '' THEN
                                                                    TESTFIELD("Service Contract No.");
                                                              END;

                                                   CaptionML=[ENU=Service Control Period Date;
                                                              NOR=Servicekontrollperiode, dato;
                                                              SVE=Servicekontroll datumperiod] }
    { 11012430;;Batch Seq. No.     ;Code20        ;TableRelation="Invoice Proposal Batch Seq.";
                                                   CaptionML=ENU=Batch Seq. No.;
                                                   Editable=No }
    { 11012440;;Work Order No.     ;Code20        ;TableRelation="Work Order";
                                                   OnValidate=VAR
                                                                WorkOrderInfoManagement@1100528600 : Codeunit 11229278;
                                                              BEGIN
                                                                WorkOrderInfoManagement.TestWorkOrderWithinCompanyPlanGroup("Work Order No.");
                                                              END;

                                                   CaptionML=[ENU=Work Order No.;
                                                              SVE=Arbetsorder nr] }
    { 11012450;;Skip Revenue Division;Boolean     ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Skip Revenue Division;
                                                   Editable=No }
    { 11012460;;Invoice From       ;Date          ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Invoice From;
                                                              SVE=Faktura fr†n];
                                                   Editable=No }
    { 11012470;;Invoiced Until     ;Date          ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Invoiced Until;
                                                              SVE=Fakturerad till];
                                                   Editable=No }
    { 11012480;;Shelf No.          ;Code20        ;CaptionML=[ENU=Shelf No.;
                                                              SVE=Hyllnr];
                                                   Editable=No }
    { 11012490;;Loan Code          ;Code10        ;TableRelation="Loan Header";
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                GetAndValidateLoanAccount;
                                                              END;

                                                   CaptionML=ENU=Loan Code }
    { 11012491;;Loan Type          ;Option        ;OnValidate=BEGIN
                                                                //**4PS
                                                                GetAndValidateLoanAccount;
                                                              END;

                                                   CaptionML=ENU=Loan Type;
                                                   OptionCaptionML=ENU=" ,Granted/Received,Depreciation/Capital Appreciation,Repayment,Loan Provision,Interest Payment,Interest Payment Provision,Interest";
                                                   OptionString=[ ,Granted/Received,Depreciation/Capital Appreciation,Repayment,Loan Provision,Interest Payment,Interest Payment Provision,Interest] }
    { 11012500;;Alternative No.    ;Integer       ;CaptionML=[ENU=Alternative No.;
                                                              NOR=Alternativnr.;
                                                              SVE=Alternativnr];
                                                   MinValue=0 }
    { 11012501;;Optional           ;Boolean       ;CaptionML=[ENU=Optional;
                                                              NOR=Valgfritt;
                                                              SVE=Valfritt] }
    { 11012510;;Plant in Other Company;Boolean    ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Sales Header" WHERE (Document Type=FIELD(Document Type),
                                                                                           No.=FIELD(Document No.),
                                                                                           Sales Document Type=CONST(Sales Logistics Separated)));
                                                   CaptionML=[ENU=Plant in Other Company;
                                                              NOR=Maskin i annet selskap;
                                                              SVE=Maskin i annat f”retag];
                                                   Editable=No }
    { 11012511;;Arrival Date       ;Date          ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Plant Type" = '') AND ("Plant Set Code" = '') THEN BEGIN
                                                                  IF ItemIsRemovalOnly THEN
                                                                    "Arrival Date" := 0D
                                                                  ELSE
                                                                    "Removal Date" := 0D;
                                                                  "Rental Starting Date" := 0D;
                                                                  "Rental Ending Date" := 0D;
                                                                  DeterminePlantNoOfTimeUnits();
                                                                END ELSE BEGIN
                                                                  IF ("Rental Starting Date" < "Arrival Date") OR ("Rental Starting Date" = xRec."Arrival Date") THEN
                                                                    VALIDATE("Rental Starting Date", "Arrival Date");
                                                                  IF ("Removal Date" < "Arrival Date") AND ("Removal Date" <> 0D) THEN
                                                                    VALIDATE("Removal Date", "Arrival Date");
                                                                END;
                                                                "Shipment Date" := "Arrival Date";
                                                              END;

                                                   CaptionML=[ENU=Arrival Date;
                                                              NOR=Ankomstdato;
                                                              SVE=Ankomstdatum] }
    { 11012512;;Removal Date       ;Date          ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Plant Type" = '') AND ("Plant Set Code" = '') THEN BEGIN
                                                                  IF NOT ItemIsRemovalOnly THEN
                                                                    "Removal Date" := 0D;
                                                                END ELSE BEGIN
                                                                  IF ("Removal Date" < "Arrival Date") AND ("Removal Date" <> 0D) THEN
                                                                    FIELDERROR("Removal Date", STRSUBSTNO(Text11012003,FIELDCAPTION("Arrival Date")));
                                                                  IF ("Rental Ending Date" > "Removal Date") OR ("Rental Ending Date" = 0D) OR ("Rental Ending Date" = xRec."Removal Date") THEN
                                                                    VALIDATE("Rental Ending Date", "Removal Date");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Removal Date;
                                                              NOR=Fjerningsdato;
                                                              SVE=Borttagningsdatum] }
    { 11012513;;Rental Starting Date;Date         ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Plant Type" = '') AND ("Plant Set Code" = '') THEN
                                                                  "Rental Starting Date" := 0D
                                                                ELSE BEGIN
                                                                  IF "Rental Starting Date" < "Arrival Date" THEN
                                                                    FIELDERROR("Rental Starting Date", STRSUBSTNO(Text11012003,FIELDCAPTION("Arrival Date")));
                                                                  IF ("Rental Starting Date" > "Removal Date") AND ("Removal Date" <> 0D)THEN
                                                                    VALIDATE("Removal Date", "Rental Starting Date");
                                                                  IF ("Rental Starting Date" > "Rental Ending Date") AND ("Rental Ending Date" <> 0D) THEN
                                                                    VALIDATE("Rental Ending Date", "Rental Starting Date");
                                                                END;

                                                                DeterminePlantNoOfTimeUnits();
                                                              END;

                                                   CaptionML=[ENU=Rental Starting Date;
                                                              NOR=Startdato for Leie;
                                                              SVE=Startdatum f”r uthyrning] }
    { 11012514;;Rental Ending Date ;Date          ;OnValidate=BEGIN
                                                                //**4PS
                                                                IF ("Plant Type" = '') AND ("Plant Set Code" = '') THEN
                                                                  "Rental Ending Date" := 0D
                                                                ELSE BEGIN
                                                                  IF "Rental Ending Date" > "Removal Date" THEN
                                                                    FIELDERROR("Rental Ending Date", STRSUBSTNO(Text11012004,FIELDCAPTION("Removal Date")));
                                                                  IF ("Rental Ending Date" < "Rental Starting Date") AND ("Rental Ending Date" <> 0D) THEN
                                                                    FIELDERROR("Rental Ending Date", STRSUBSTNO(Text11012003,FIELDCAPTION("Rental Starting Date")));
                                                                  IF ("Rental Ending Date" < "Arrival Date") AND ("Rental Ending Date" <> 0D) THEN
                                                                    FIELDERROR("Rental Ending Date", STRSUBSTNO(Text11012003,FIELDCAPTION("Arrival Date")));
                                                                END;

                                                                DeterminePlantNoOfTimeUnits();
                                                              END;

                                                   CaptionML=[ENU=Rental Ending Date;
                                                              NOR=Sluttdato for Leleie;
                                                              SVE=Slutdatum f”r uthyrning] }
    { 11012542;;Arrival Order Line ;Integer       ;CaptionML=[ENU=Arrival Order Line;
                                                              NOR=Ankomstordrerad;
                                                              SVE=Ankomstorderrad];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012543;;Removal Order Line ;Integer       ;CaptionML=[ENU=Removal Order Line;
                                                              NOR=Fjerningsordrerad;
                                                              SVE=Borttagningsorderrad];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012544;;Plant Rental Split No.;Integer    ;CaptionML=[ENU=Plant Rental Split No.;
                                                              NOR=Maskinleiedeling, nr;
                                                              SVE=Maskinuthyrningsdelning, nr] }
    { 11012545;;Plant Set Code     ;Code10        ;TableRelation="Plant Set";
                                                   OnValidate=VAR
                                                                lvPlantSetRec@1100485000 : Record 11012587;
                                                              BEGIN
                                                                //**4PS
                                                                IF "Plant Invoice" THEN
                                                                  EXIT;

                                                                IF ("Plant Set Code" = '') THEN BEGIN
                                                                  VALIDATE("Arrival Date");
                                                                  EXIT;
                                                                END;

                                                                TESTFIELD("Item No.", '');
                                                                TESTFIELD("Plant Type", '');
                                                                CheckSellBillToCustomer;

                                                                IF ("Plant Set Code" <> xRec."Plant Set Code") THEN BEGIN
                                                                  lvPlantSetRec.GET("Plant Set Code");
                                                                  Description := lvPlantSetRec.Description;
                                                                  "Unit of Measure Code" := lvPlantSetRec."Unit of Measure";
                                                                  GetPlantRentalRate();
                                                                  VALIDATE("Unit of Measure Code");
                                                                  IF Quantity = 0 THEN
                                                                    VALIDATE(Quantity, 1);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Plant Set;
                                                              NOR=Maskinkombinasjon;
                                                              SVE=Maskinkombination] }
    { 11012546;;Plant Rental First Invoiced;Boolean;
                                                   CaptionML=[ENU=First Invoice of Rental Line (Plant);
                                                              NOR=F›rste faktura for leierad (Maskin);
                                                              SVE=F”rsta faktura f”r uthyrningsrad (Maskin)] }
    { 11012547;;Plant Rate Unit of Measure;Code10 ;FieldClass=Normal;
                                                   TableRelation="Unit of Measure";
                                                   CaptionML=[ENU=Rate Unit of Measure;
                                                              NOR=M†leenhet for Avgift;
                                                              SVE=Avgiftsenhet];
                                                   Editable=No }
    { 11012548;;Plant Qty. per Rate Unit;Decimal  ;InitValue=1;
                                                   CaptionML=[ENU=Qty. per Rate Unit;
                                                              NOR=Antall per satsenhet;
                                                              SVE=Antal per avgiftsenhet];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   Editable=No }
    { 11012549;;Plant Rate Code    ;Code10        ;OnLookup=VAR
                                                              PlantRateCodeRec@1100525000 : Record 11020502;
                                                            BEGIN
                                                              //**4PS
                                                              PlantRateCodeRec.LookupPlantRateCode("Plant Location", "Plant Rate Code", FALSE, '', 0);
                                                            END;

                                                   CaptionML=[ENU=Plant Rate Code;
                                                              NOR=Maskinens satskode;
                                                              SVE=Maskinens avgiftskoder];
                                                   Editable=No }
    { 11012550;;Plant Invoice      ;Boolean       ;CaptionML=[ENU=Plant Invoice;
                                                              NOR=Maskinfaktura;
                                                              SVE=Maskinfaktura];
                                                   Editable=No }
    { 11012551;;Plant Invoice Origin;Option       ;CaptionML=[ENU=Plant Invoice Origin;
                                                              NOR=Maskinfaktura, Opprinnelse;
                                                              SVE=Maskinfaktura, ursprung];
                                                   OptionCaptionML=[ENU=,Plant Inventory,Plant Order,Exit Order,Rental Correction,Plant Hours,Transport Order,Returned Loss,Service Order,Rental Agreement,Surcharge,Service Cost,External Rent Invoice;
                                                                    SVE=,Maskinlager,Maskinorder,Slutorder,Uthyrningskorrigering,Maskintimmar,Transportorder,Returnerad f”rlust,Serviceorder,Hyresavtal,Till„ggsavgift,Servicekostnad,Extern hyresfaktura];
                                                   OptionString=,Plant Inventory,Plant Order,Exit Order,Rental Correction,Plant Hours,Transport Order,Returned Loss,Service Order,RentalAgreement,Surcharge,Service Cost,ExternalRentInvoice;
                                                   BlankZero=Yes;
                                                   Description=Options must be the same in the tables 37, 113, 115, 11012572, 11020501, 11071889, 11072056 !!!!;
                                                   Editable=No }
    { 11012552;;Relate to          ;Option        ;CaptionML=[ENU=Relate to;
                                                              NOR=Relater til;
                                                              SVE=Relatera till];
                                                   OptionCaptionML=[ENU=,Rental,Sales,Missing,Scrap,Buy Back,Hours,Transport,Sundry Costs,Plant Hours,Damage,Job Order,Load/Unload,Item,Item Buy-Back;
                                                                    NOR=,Leie,Salg,Mangler,Utrangeres,Tilbakekj›p,Timer,Transport,Diversekoster,Maskintimer,Skade,Jobbordre,Lasting/Avlasting,Artikkel,Artikkel Tilbakekj›p;
                                                                    SVE=,Uthyrning,F”rs„ljning,Saknas,Skrot,terk”p,Timmar,Transport,Diversekostnader,Maskintimmar,Skada,Arbetsorder,Lastning/avlastning,Artikel,Artikel†terk”p];
                                                   OptionString=,Rental,Sales,Missing,Scrap,Buy Back,Hours,Transport,Sundry Costs,Plant Hours,Damage,Job Order,Load/Unload,Item,ItemBuyBack;
                                                   BlankZero=Yes;
                                                   Description=Options must be the same in the tables 37, 113, 115, 11012572, 11020501, 11071889, 11072056 !!!!;
                                                   Editable=No }
    { 11012553;;Plant Location     ;Code20        ;TableRelation="Plant Location";
                                                   CaptionML=[ENU=Plant Location;
                                                              NOR=Maskinplassering;
                                                              SVE=Maskinplats];
                                                   Editable=No }
    { 11012554;;Plant Location Description;Text100;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Location".Description WHERE (Code=FIELD(Plant Location)));
                                                   CaptionML=[ENU=Plant Location Description;
                                                              NOR=Beskrivelse av maskinplassering;
                                                              SVE=Beskrivning av Maskinplats];
                                                   Editable=No }
    { 11012555;;Plant Type         ;Code20        ;TableRelation="Plant Type";
                                                   OnValidate=VAR
                                                                lvPlantTypeRec@1100485000 : Record 11012551;
                                                                lvPlantTypeLogisticsRec@1100485001 : Record 11012551;
                                                              BEGIN
                                                                //**4PS
                                                                CheckProjServPlantLoanAllowed(FIELDNO("Plant Type"));
                                                                IF "Plant Invoice" OR SalesLogisticsSepaRentContract OR ResourceRequestInvoice THEN BEGIN
                                                                  IF "Plant Invoice" THEN
                                                                    FillSystemCreatedEntry;
                                                                  CreateDim(
                                                                    DATABASE::"Plant Type", "Plant Type",
                                                                    DimMgt.TypeToTableID3(Type),"No.",
                                                                    DATABASE::Job,"Job No.",
                                                                    DATABASE::"Service Order","Service Order No.", //**4PS.n 09-06-2010
                                                                    DATABASE::"Service-Contract","Service Contract No.", //**4PS.n 09-06-2010
                                                                    DATABASE::"Responsibility Center","Responsibility Center",
                                                                    //DATABASE::Location,"Location Code");  //**4PS.n  //*C007227.o
                                                                    DATABASE::"Service Group", GetServiceObjectGroup);
                                                                  IF "Plant Invoice" OR ResourceRequestInvoice THEN
                                                                    EXIT;
                                                                END;

                                                                IF "Plant Type" = '' THEN BEGIN
                                                                  "Plant No." := '';
                                                                  VALIDATE("Arrival Date");
                                                                  EXIT;
                                                                END ELSE
                                                                  "Blocked for Invoicing" := FALSE;

                                                                TESTFIELD("Item No.", '');
                                                                TESTFIELD("Plant Set Code", '');
                                                                CheckSellBillToCustomer;

                                                                IF SalesLogisticsSepaRentContract() THEN BEGIN
                                                                  //* Plant Type should ALSO be present in logistic company
                                                                  lvPlantTypeLogisticsRec.CHANGECOMPANY(CompanyLogistics);
                                                                  lvPlantTypeLogisticsRec.GET("Plant Type");
                                                                  IF lvPlantTypeLogisticsRec."Rental Type" = lvPlantTypeLogisticsRec."Rental Type"::"Sales/Buy Back" THEN
                                                                    lvPlantTypeLogisticsRec.FIELDERROR("Rental Type");
                                                                  lvPlantTypeLogisticsRec.TESTFIELD(Blocked, FALSE);

                                                                  SalesHeader.GET("Document Type","Document No."); //Function GetSalesHeader returns old data
                                                                  Type := Type::"G/L Account";
                                                                  IF "Arrival Date" = 0D THEN BEGIN
                                                                    "Arrival Date" := SalesHeader."Arrival Date";
                                                                    "Rental Starting Date" := SalesHeader."Rental Starting Date";
                                                                  END ELSE BEGIN
                                                                    IF ("Rental Starting Date" = 0D) AND ("Arrival Date" = SalesHeader."Arrival Date") THEN
                                                                      "Rental Starting Date" := SalesHeader."Rental Starting Date";
                                                                  END;
                                                                  IF "Removal Date" = 0D THEN BEGIN
                                                                    "Removal Date" := SalesHeader."Removal Date";
                                                                    "Rental Ending Date" := SalesHeader."Rental Ending Date";
                                                                  END;
                                                                  VALIDATE("Arrival Date");
                                                                  VALIDATE("Removal Date");
                                                                  DeterminePlantNoOfTimeUnits();
                                                                  lvPlantTypeRec.GET("Plant Type");
                                                                  lvPlantTypeRec.TESTFIELD(Blocked, FALSE);
                                                                  "Unit Cost (LCY)" := lvPlantTypeRec."Current Price";
                                                                END;

                                                                IF ("Plant Type" <> xRec."Plant Type") THEN BEGIN
                                                                  "Plant No." := '';
                                                                  lvPlantTypeRec.GET("Plant Type");
                                                                  //Description := lvPlantTypeRec.Description; //**4PS.o
                                                                  Description := GetTranslatedPlantDesc(MAXSTRLEN(Description));  //**4PS.n
                                                                  IF lvPlantTypeRec."Rate Unit of Measure" = '' THEN
                                                                    "Unit of Measure Code" := lvPlantTypeRec."Unit of Measure"
                                                                  ELSE
                                                                    "Unit of Measure Code" := lvPlantTypeRec."Rate Unit of Measure";
                                                                  GetPlantRentalRate();
                                                                  VALIDATE("Unit of Measure Code");
                                                                  IF (Quantity = 0) AND (NOT lvPlantTypeRec.Bulk) THEN
                                                                    VALIDATE(Quantity, 1);
                                                                  GetPlantRentalDiscount();

                                                                  IF SalesLogisticsSepaRentContract() THEN BEGIN
                                                                    VALIDATE("VAT Prod. Posting Group", lvPlantTypeRec."VAT Prod. Posting Group");
                                                                    VALIDATE("VAT Bus. Posting Group", SalesHeader."VAT Bus. Posting Group");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp] }
    { 11012556;;Plant No.          ;Code10        ;TableRelation=IF (Plant No.=FILTER(<>0),
                                                                     Plant in Other Company=CONST(No)) "Plant Number".No. WHERE (Plant Type=FIELD(Plant Type));
                                                   OnValidate=VAR
                                                                lvPlantNoRec@1100485000 : Record 11012552;
                                                                lvPlantTypeRec@1100485001 : Record 11012551;
                                                                lvText11012001@1100485002 : TextConst 'ENU=Plant No. is not present with No. in the palnt inventory.;NOR=Maskinnr stemmer ikke med nr i maskinlagret.;SVE=Maskinnr f”rekommer inte med nr i Maskinlagret.';
                                                              BEGIN
                                                                //**4PS
                                                                IF "Plant Invoice" OR ResourceRequestInvoice THEN
                                                                  EXIT;

                                                                Description := GetTranslatedPlantDesc(MAXSTRLEN(Description));   //**4PS.n
                                                                IF ("Plant No." = '') THEN BEGIN
                                                                  IF ("Plant Type" <> '') AND (xRec."Plant No." <> '') THEN BEGIN
                                                                    lvPlantTypeRec.GET("Plant Type");
                                                                    Description := lvPlantTypeRec.Description;
                                                                    GetPlantRentalRate();
                                                                    GetPlantRentalDiscount();
                                                                  END;
                                                                  EXIT;
                                                                END;

                                                                TESTFIELD("Plant Type");

                                                                IF SalesLogisticsSeparated() THEN
                                                                  lvPlantNoRec.CHANGECOMPANY(CompanyLogistics);
                                                                lvPlantNoRec.GET("Plant Type", "Plant No.");
                                                                IF "Plant No." <> lvPlantNoRec."Stock No." THEN
                                                                  ERROR(lvText11012001);

                                                                IF ("Plant No." <> xRec."Plant No.") THEN BEGIN
                                                                  //Description := lvPlantNoRec.Description; //**4PS.o

                                                                  GetPlantRentalRate();
                                                                  GetPlantRentalDiscount();
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Plant No.;
                                                              NOR=Maskinnr.;
                                                              SVE=Maskinnr] }
    { 11012557;;Bulk               ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Type".Bulk WHERE (Code=FIELD(Plant Type)));
                                                   CaptionML=[ENU=Bulk;
                                                              NOR=Bulk;
                                                              SVE=Bulk];
                                                   Editable=No }
    { 11012558;;Number of Time Units;Decimal      ;CaptionML=[ENU=No. of Time Units;
                                                              NOR=Antall tidsenheter;
                                                              SVE=Antal tidsenheter];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012559;;Arrival Order Type ;Option        ;CaptionML=[ENU=Arrival Order Type;
                                                              NOR=Ankomstordretype;
                                                              SVE=Ankomstordertyp];
                                                   OptionCaptionML=[ENU=,Plant Order,Exit-order,Rental Correction,Transport Order,Returned Loss,Rental Agreement;
                                                                    NOR=,Maskinordre,Sluttordre,Korreksjonstransaksjon for Utleie,Transportordre,Returnert Tap;
                                                                    SVE=,Maskinorder,Avsluta order,R„ttningstransaktion f”r uthyrning,Transportorder,Returnerad f”rlust,Hyresavtal];
                                                   OptionString=,Plant Order,Exit-order,Rental Correction,Transport Order,Returned Loss,RentalAgreement;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012560;;Arrival Order      ;Code20        ;TableRelation=IF (Arrival Order Type=CONST(Plant Order)) "Plant Order"
                                                                 ELSE IF (Arrival Order Type=CONST(Exit-order)) "Exit Order"
                                                                 ELSE IF (Arrival Order Type=CONST(Returned Loss)) "Returned Loss Order"
                                                                 ELSE IF (Arrival Order Type=CONST(Rental Correction)) "Rental Correction"
                                                                 ELSE IF (Arrival Order Type=CONST(Transport Order)) "Posted Plant Transport Order";
                                                   OnLookup=VAR
                                                              PlantLookupMgt@1100409000 : Codeunit 11012590;
                                                            BEGIN
                                                              //**4PS
                                                              PlantLookupMgt.SalesLineArrivalOrder(Rec);
                                                            END;

                                                   CaptionML=[ENU=Arrival Order;
                                                              NOR=Ankomstordre;
                                                              SVE=Ankomstorder];
                                                   Editable=No }
    { 11012561;;Removal Order Type ;Option        ;CaptionML=[ENU=Removal Order Type;
                                                              NOR=Fjerningsordretype;
                                                              SVE=Borttagning av ordertyp];
                                                   OptionCaptionML=[ENU=,Plant Order,Exit-order,Rental Correction,Transport Order;
                                                                    NOR=,Maskinordre,Sluttordre,Korreksjonstransaksjon for utleie,Transportordre;
                                                                    SVE=,Maskinorder,Avsluta order,R„ttningstransaktion f”r uthyrning,Transportorder];
                                                   OptionString=,Plant Order,Exit-order,Rental Correction,Transport Order;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 11012562;;Removal Order      ;Code20        ;TableRelation=IF (Removal Order Type=CONST(Plant Order)) "Plant Order"
                                                                 ELSE IF (Removal Order Type=CONST(Exit-order)) "Exit Order"
                                                                 ELSE IF (Removal Order Type=CONST(Rental Correction)) "Rental Correction"
                                                                 ELSE IF (Removal Order Type=CONST(Transport Order)) "Posted Plant Transport Order";
                                                   OnLookup=VAR
                                                              PlantLookupMgt@1100409000 : Codeunit 11012590;
                                                            BEGIN
                                                              //**4PS
                                                              PlantLookupMgt.SalesLineRemovalOrder(Rec);
                                                            END;

                                                   CaptionML=[ENU=Removal Order;
                                                              NOR=Fjerningsordre;
                                                              SVE=Uttagsorder];
                                                   Editable=No }
    { 11012563;;Rental Period      ;Text30        ;CaptionML=[ENU=Rental Period;
                                                              NOR=Leieperiode til dato;
                                                              SVE=Uthyrningsperiod];
                                                   Editable=No }
    { 11012564;;Rate Type          ;Option        ;CaptionML=[ENU=Rate Type;
                                                              NOR=Avgiftstype;
                                                              SVE=Avgiftstyp];
                                                   OptionCaptionML=[ENU=" ,day,wk,,mth";
                                                                    NOR=" ,dag,uke,,mnd.";
                                                                    SVE=" ,dag,vka,,m†n."];
                                                   OptionString=[ ,Day,Week,,Month];
                                                   Editable=No }
    { 11012565;;Service Invoice    ;Boolean       ;CaptionML=[ENU=Service Invoice;
                                                              NOR=Servicefaktura;
                                                              SVE=Servicefaktura] }
    { 11012566;;Service Location No.;Code20       ;TableRelation="Service Location".No.;
                                                   CaptionML=[ENU=Service Location No.;
                                                              NOR=Servicelokasjon Nr.;
                                                              SVE=Serviceplatsnr] }
    { 11012569;;Rental Unit        ;Code20        ;TableRelation="Rental Unit"."Rental Unit" WHERE (Project No.=FIELD(Job No.));
                                                   OnValidate=BEGIN
                                                                //**4PS
                                                                IF "Rental Unit" = '' THEN
                                                                  "Rental Unit Line Type" := 0;
                                                                //ELSE BEGIN
                                                                //  IF "Rental Unit Line Type" = 0 THEN
                                                                //    "Rental Unit Line Type" := "Rental Unit Line Type"::Rent;  //*C017909.o
                                                                //END;

                                                                IF "Job No." <> '' THEN
                                                                  GetProjTypeRevenueAccount(FALSE,FALSE);
                                                              END;

                                                   CaptionML=[ENU=Rental Unit;
                                                              NOR=Leieenhet;
                                                              SVE=Uthyrningsenhet] }
    { 11012570;;Rental Unit Invoice;Boolean       ;CaptionML=[ENU=Rental Unit Invoice;
                                                              NOR=Leieenhetsfaktura;
                                                              SVE=Uthyrningsenhetsfaktura];
                                                   Editable=No }
    { 11012571;;Last Installment   ;Boolean       ;CaptionML=[ENU=Last Installment;
                                                              NOR=Forrige avdrag;
                                                              SVE=Senaste avbetalning];
                                                   Editable=No }
    { 11012572;;Rental Unit Line Type;Option      ;OnValidate=BEGIN
                                                                //**4PS
                                                                //IF "Rental Unit" = '' THEN            //*C017909.so
                                                                //  "Rental Unit Line Type" := 0
                                                                //ELSE
                                                                //  TESTFIELD("Rental Unit Line Type"); //*C017909.eo
                                                                IF "Rental Unit Line Type" <> 0 THEN    //*C017909.n
                                                                  TESTFIELD("Rental Unit");

                                                                IF "Job No." <> '' THEN
                                                                  GetProjTypeRevenueAccount(FALSE,FALSE);
                                                              END;

                                                   CaptionML=[ENU=Rental Unit Line Type;
                                                              NOR=Leieenhetsradtype;
                                                              SVE=Uthyrningsenhetsradtyp];
                                                   OptionCaptionML=[ENU=" ,Rent,Service Cost,Utilities,One-off Costs,Deposit";
                                                                    NOR=" ,Leie,Servicekost,Verkt›y";
                                                                    SVE=" ,Hyra,Servicekostnad,Verktyg,Eng†ngskostnad,Deposition"];
                                                   OptionString=[ ,Rent,ServiceCost,Utilities,One-off Costs,Deposit] }
    { 11012573;;Rental Package Date;Date          ;TableRelation="Rental Package"."Starting Date" WHERE (Project No.=FIELD(Job No.),
                                                                                                         Rental Unit=FIELD(Rental Unit));
                                                   CaptionML=ENU=Rental Package Date }
    { 11012580;;Line VAT Amount    ;Decimal       ;CaptionML=[ENU=Line VAT Amount;
                                                              NOR=Mva-bel›p for rad;
                                                              SVE=Momsbelopp f”r rad];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 11012590;;Source Document    ;Code20        ;CaptionML=[ENU=Source Document;
                                                              NOR=Kildedokument;
                                                              SVE=K„lldokument];
                                                   Editable=No }
    { 11012600;;Additional Cost (Service);Boolean ;OnValidate=BEGIN
                                                                //**4PS
                                                                ValidateAdditionalCost;
                                                              END;

                                                   CaptionML=[ENU=Additional Cost (Service);
                                                              NOR=Tilleggskoster (service);
                                                              SVE=Till„ggskostnader (service)] }
    { 11012601;;Removal Contribution;Boolean      ;CaptionML=[ENU=Removal Contribution;
                                                              NOR=Fjerningsbidrag;
                                                              SVE=Borttagningsbidrag] }
    { 11012602;;Add. Cost Changed Manually;Boolean;CaptionML=ENU=Add. Cost Changed Manually }
    { 11012610;;Recipe Group       ;Code10        ;TableRelation="Recipe Group".No.;
                                                   OnValidate=BEGIN
                                                                //**4PS DP00481
                                                                IF ("Recipe Group" = '') AND (Recipe <> '') THEN
                                                                  Recipe := '';
                                                              END;

                                                   CaptionML=[ENU=Recipe Group;
                                                              NOR=Maltype;
                                                              SVE=Malltyp];
                                                   Description=DP00481 }
    { 11012611;;Recipe             ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Recipe Group));
                                                   OnValidate=VAR
                                                                BaseRecipeRec@1210190000 : Record 11020581;
                                                                SalesRecipe@1100525000 : Record 11229788;
                                                              BEGIN
                                                                //**4PS DP00481
                                                                IF (Recipe <> xRec.Recipe) AND (Recipe <> '') THEN BEGIN
                                                                  BaseRecipeRec.GET("Recipe Group", Recipe);
                                                                  BaseRecipeRec.TESTFIELD(Blocked, FALSE);
                                                                END;
                                                                IF Recipe <> xRec.Recipe THEN BEGIN
                                                                  IF SalesRecipe.GET("Document Type", "Document No.", "Line No.") THEN BEGIN
                                                                    SalesRecipe.DELETE(TRUE);
                                                                  END;
                                                                  IF (Recipe <> '') THEN BEGIN
                                                                    BaseRecipeRec.GET("Recipe Group", Recipe);
                                                                    Type := Type::"G/L Account";
                                                                    Description := COPYSTR(BaseRecipeRec.Description, 1, MAXSTRLEN(Description));
                                                                    "Description 2" := COPYSTR(BaseRecipeRec.Description, MAXSTRLEN(Description) + 1);
                                                                    "Unit of Measure" := BaseRecipeRec."Unit of Measure";
                                                                  END;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Recipe;
                                                              NOR=Mal;
                                                              SVE=Mall];
                                                   Description=DP00481 }
    { 11012630;;Principal Reference;Text50        ;CaptionML=[ENU=Principal Reference;
                                                              NOR=Oppdragsgiverreferanse;
                                                              SVE=Uppdragsgivarreferens] }
    { 11012640;;Order No. Customer ;Text50        ;CaptionML=[ENU=Order No. Customer;
                                                              NOR=Ordrenr, (Kunde);
                                                              SVE=Ordernr, (kund)] }
    { 11012660;;Commision Date Customer;Date      ;CaptionML=[ENU=Commision Date Principal;
                                                              NOR=Kommisjonsdato, oppdragsgiver;
                                                              SVE=Provisionsdatum, uppdragsgivare] }
    { 11012670;;Plant Location Address Code;Code20;OnValidate=VAR
                                                                PlantLocationAddressRec@1100485000 : Record 11012590;
                                                              BEGIN
                                                                IF ("Plant Location Address Code" <> '') THEN BEGIN
                                                                  GetSalesHeader;
                                                                  SalesHeader.TESTFIELD("Plant Location Code");
                                                                  IF SalesLogisticsSeparated() THEN
                                                                    PlantLocationAddressRec.CHANGECOMPANY(CompanyLogistics);
                                                                  PlantLocationAddressRec.GET(SalesHeader."Plant Location Code", "Plant Location Address Code");
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              PlantLocationAddressRec@1100485000 : Record 11012590;
                                                            BEGIN
                                                              GetSalesHeader;
                                                              IF SalesHeader."Plant Location Code" = '' THEN
                                                                EXIT;

                                                              IF SalesLogisticsSeparated() THEN
                                                                PlantLocationAddressRec.CHANGECOMPANY(CompanyLogistics);
                                                              PlantLocationAddressRec.FILTERGROUP(10);
                                                              PlantLocationAddressRec.SETRANGE(Location, SalesHeader."Plant Location Code");
                                                              PlantLocationAddressRec.FILTERGROUP(0);
                                                              IF PAGE.RUNMODAL(PAGE::"Plant Location Addresses",PlantLocationAddressRec) = ACTION::LookupOK THEN
                                                                VALIDATE("Plant Location Address Code", PlantLocationAddressRec."Address Code");
                                                            END;

                                                   CaptionML=[ENU=Plant Location Address Code;
                                                              NOR=Adressekode, maskinplassering;
                                                              SVE=Adresskod, Maskinplats];
                                                   Description=Only for Sales Rental Contract and Sales Logistics Separated }
    { 11012680;;Blocked for Invoicing;Boolean     ;OnValidate=BEGIN
                                                                TESTFIELD("Plant Type", '');
                                                              END;

                                                   CaptionML=[ENU=Blocked for Invoicing;
                                                              NOR=Sperret for fakturering;
                                                              SVE=Sp„rrat f”r fakturering] }
    { 11012685;;Part of Line       ;Integer       ;TableRelation="Sales Line"."Line No." WHERE (Document Type=FIELD(Document Type),
                                                                                                Document No.=FIELD(Document No.));
                                                   OnValidate=BEGIN
                                                                DetermineBOMLevel("Part of Line","Level BOM");
                                                              END;

                                                   CaptionML=[ENU=Part of Line;
                                                              NOR=Del av Rad;
                                                              SVE=Del av rad] }
    { 11012690;;Original Quantity  ;Decimal       ;OnValidate=BEGIN
                                                                //**4PS.sn
                                                                IF NOT ((Type = Type::" ") AND ("BOM Item No." <> '')) THEN
                                                                  FIELDERROR(
                                                                    "Original Quantity",STRSUBSTNO(Text11012007,FIELDCAPTION(Type),Type));
                                                              END;

                                                   CaptionML=[ENU=Original Quantity;
                                                              NOR=Originalt antall;
                                                              SVE=Ursprungligt antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 11012695;;Level BOM          ;Integer       ;CaptionML=[ENU=Level BOM;
                                                              NOR=Niv† Í stykkliste;
                                                              SVE=Niv†struktur];
                                                   Description=Level after explode BOM-Item;
                                                   Editable=No }
    { 11012700;;Service Warranty Code;Code10      ;TableRelation="Service Warranty";
                                                   CaptionML=[ENU=Service Warranty Code;
                                                              NOR=Servicegarantikode;
                                                              SVE=Servicegarantikod] }
    { 11012705;;Serial No.         ;Code40        ;CaptionML=[ENU=Serial No.;
                                                              NOR=Serienr;
                                                              SVE=Serienr];
                                                   Description=DP00121 }
    { 11012706;;Lot No.            ;Code20        ;CaptionML=[ENU=Lot No.;
                                                              NOR=Partinr;
                                                              SVE=Partinr];
                                                   Description=DP00121 }
    { 11012710;;Service Price Book Code;Code20    ;CaptionML=[ENU=Service Price Book Code;
                                                              SVE=SM-enhetspriskod];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012720;;SUP Index Date     ;Date          ;CaptionML=[ENU=SUP Index Date;
                                                              SVE=Indexdatum f”r SM-enhetspris];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012730;;SUP Extention      ;Boolean       ;CaptionML=[ENU=Service Unit Price Extention;
                                                              SVE=Anknytning f”r SM-enhetspris];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012740;;SUP Production Date;Date          ;CaptionML=[ENU=SUP Production Date;
                                                              SVE=Produktionsregistreringsdatum];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012750;;SUP Room           ;Code20        ;TableRelation="SUP Room";
                                                   CaptionML=[ENU=Service Unit Price Room;
                                                              NOR=Service, Enhetspris Rom;
                                                              SVE=SM-enhetspris rum];
                                                   Editable=No }
    { 11012760;;Service Unit Price Code;Code20    ;CaptionML=[ENU=Service Unit Price Code;
                                                              SVE=SM-enhetsprislinjekod] }
    { 11012770;;PB Install. Collect. Over. No.;Code20;
                                                   TableRelation="PB Install. Collect. Overview";
                                                   CaptionML=ENU=Price Book Installment Collection Overview No.;
                                                   Editable=No }
    { 11012780;;Advance Payment    ;Boolean       ;CaptionML=ENU=Advance Payment;
                                                   Editable=No }
    { 11012790;;Plant Group        ;Code20        ;TableRelation="Plant Group";
                                                   CaptionML=ENU=Plant Group }
    { 11012800;;IsPlantService     ;Boolean       ;CaptionML=ENU=Is Plant Service }
    { 11012820;;Extra Shipment Line;Boolean       ;CaptionML=[ENU=Extra Shipment Line;
                                                              NOR=Ekstra forsendelsesrad;
                                                              SVE=Extra utleveransrad] }
    { 11012830;;Manually VAT Posting;Boolean      ;CaptionML=[ENU=Manually VAT Posting;
                                                              NOR=Manuell Momsbokf›ring;
                                                              SVE=Manuell momsbokf”ring] }
    { 11012840;;Service Control Year;Integer      ;CaptionML=[ENU=Service Control Year;
                                                              NOR=Servicekontroll†r;
                                                              SVE=Servicekontroll†r];
                                                   Editable=No }
    { 11012850;;Attached to Line No. (RC);Integer ;TableRelation="Sales Line"."Line No." WHERE (Document Type=FIELD(Document Type),
                                                                                                Document No.=FIELD(Document No.));
                                                   CaptionML=[ENU=Attached to Line No. (Removal Contribution);
                                                              NOR=Vedlagt Radnr (Fjerningsbidrag);
                                                              SVE=Bifogad till radnr (borttagningsbidrag)];
                                                   Editable=No }
    { 11012860;;Copy of Document   ;Boolean       ;CaptionML=ENU=Copy of Document;
                                                   Editable=No }
    { 11012870;;Service Category   ;Code10        ;TableRelation="Service Category".Code WHERE (Service Contract No.=FIELD(Service Contract No.));
                                                   CaptionML=[ENU=Service Category;
                                                              SVE=Servicekategori] }
    { 11012880;;Country/Region of Origin Code;Code10;
                                                   TableRelation=Country/Region;
                                                   CaptionML=[ENU=Country/Region of Origin Code;
                                                              NOR=Opprinnelsesland/-region - kode;
                                                              SVE=Kod f”r tillverkningsland/-region];
                                                   Description=DP01986 }
    { 11012890;;Dsp Assignment Id  ;Text50        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=DSP Assignment ID;
                                                   Editable=No }
    { 11012900;;Service Order Object No.;Code20   ;TableRelation="Service Order Object"."Object No." WHERE (Service Order No.=FIELD(Service Order No.));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Service Order Object No.;
                                                   Editable=No }
    { 11012901;;Service Order Object Descr;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Object.Description WHERE (No.=FIELD(Service Order Object No.)));
                                                   CaptionML=ENU=Service Order Object Description;
                                                   Editable=No }
    { 11012970;;Tariff No.         ;Code20        ;TableRelation="Tariff Number";
                                                   CaptionML=[ENU=Tariff No.;
                                                              NOR=EU toll statistikknr;
                                                              SVE=EU tull statistiknr] }
    { 11012980;;Unit Price Code    ;Code20        ;CaptionML=[ENU=Unit Price Code;
                                                              NOR=Enhetspriskode;
                                                              SVE=Enhetspriskod] }
    { 11012990;;Prev. Last Invoiced Until;Date    ;CaptionML=[ENU=Previous Last Invoiced Until;
                                                              NOR=Forrige 'sist fakturerte frem til';
                                                              SVE=F”reg†ende Senaste fakturerad tills];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012991;;Transfer Order No. ;Code20        ;TableRelation="Transfer Header";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Transfer Order No.;
                                                              SVE=™verf”ringsordernr] }
    { 11012992;;Prev. Invoiced Until;Date         ;CaptionML=[ENU=Previous Invoiced Until;
                                                              NOR=Forrige fakturert Frem til;
                                                              SVE=F”reg†ende fakturerat till];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012995;;Installment Line No.;Integer      ;CaptionML=[ENU=Installment Line No.;
                                                              NOR=Avdragsradnr;
                                                              SVE=Betalplansradnr];
                                                   Description=S&O CONS;
                                                   Editable=No }
    { 11012997;;Collective-List Line Type;Option  ;CaptionML=[ENU=Collective-List Line Type;
                                                              NOR=Radtype for samlingsfaktura;
                                                              SVE=Samlingsfaktura radtyp];
                                                   OptionCaptionML=[ENU=" ,Dynamic,Installment,Cost Plus Entry";
                                                                    NOR=" ,Dynamisk,Avbetaling,Selvkosttransaksjon";
                                                                    SVE=" ,Dynamisk,Avbetalning,Redovisad sj„lvkostnad"];
                                                   OptionString=[ ,Dynamic,Installment,Cost Plus Entry] }
    { 11012998;;Coll.-List SC Inv. Line No.;Integer;
                                                   CaptionML=[ENU=Collective-List Service Contract Invoicng Line No.;
                                                              NOR=Samlingsfaktura servicekontrakt, fakturaradnr.;
                                                              SVE=Samlingsfaktura servicekontrakt fakturaradnr.];
                                                   Editable=No }
    { 11012999;;Collective List No.;Code20        ;TableRelation="Service Collective-List";
                                                   CaptionML=[ENU=Collective List No.;
                                                              NOR=Samlingsfaktura nr.;
                                                              SVE=Samlingsfaktura nr.];
                                                   Editable=No }
    { 11128020;;Withheld Amount    ;Decimal       ;CaptionML=[ENU=Withheld Amount;
                                                              NOR=Tilbakeholdt bel›p;
                                                              SVE=Erh†llet belopp];
                                                   Description=NAVSE }
    { 11128900;;Applies-to Retention ID;Integer   ;CaptionML=[ENU=Applies-to Retention ID;
                                                              NOR=Utlignings-gjenv‘rende-ID;
                                                              SVE=G„ller kvarst†ende ID];
                                                   Description=4PSNA }
    { 12047958;;Charge Type        ;Option        ;CaptionML=[ENU=Charge Type;
                                                              NOR=Gebyrtype;
                                                              SVE=Debiteringstyp];
                                                   OptionCaptionML=[ENU=" ,Rounding,Freight,Service Fee,Packing Fee";
                                                                    SVE=" ,™resutj„mning,Frakt,Expedition,Emballage"];
                                                   OptionString=[ ,Rounding,Freight,Service Fee,Packing Fee];
                                                   Description=PEB0019 (12047958);
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Document Type,Document No.,Line No.     ;Clustered=Yes }
    { No ;Document No.,Line No.,Document Type      }
    {    ;Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date;
                                                   SumIndexFields=Outstanding Qty. (Base) }
    {    ;Document Type,Bill-to Customer No.,Currency Code,Document No.;
                                                   SumIndexFields=Outstanding Amount,Shipped Not Invoiced,Outstanding Amount (LCY),Shipped Not Invoiced (LCY),Return Rcd. Not Invd. (LCY) }
    {    ;Document Type,Type,No.,Variant Code,Drop Shipment,Shortcut Dimension 1 Code,Shortcut Dimension 2 Code,Location Code,Shipment Date;
                                                   SumIndexFields=Outstanding Qty. (Base);
                                                   MaintainSIFTIndex=No }
    { No ;Document Type,Bill-to Customer No.,Shortcut Dimension 1 Code,Shortcut Dimension 2 Code,Currency Code,Document No.;
                                                   SumIndexFields=Outstanding Amount,Shipped Not Invoiced,Outstanding Amount (LCY),Shipped Not Invoiced (LCY) }
    {    ;Document Type,Blanket Order No.,Blanket Order Line No. }
    {    ;Document Type,Document No.,Location Code;SumIndexFields=Amount,Amount Including VAT,Outstanding Amount,Shipped Not Invoiced,Outstanding Amount (LCY),Shipped Not Invoiced (LCY);
                                                   MaintainSQLIndex=No }
    {    ;Document Type,Shipment No.,Shipment Line No. }
    {    ;Type,No.,Variant Code,Drop Shipment,Location Code,Document Type,Shipment Date;
                                                   MaintainSQLIndex=No }
    {    ;Document Type,Sell-to Customer No.,Shipment No.,Document No.;
                                                   SumIndexFields=Outstanding Amount (LCY) }
    { No ;Job Contract Entry No.                   }
    { No ;Document Type,Document No.,Qty. Shipped Not Invoiced }
    { No ;Document Type,Document No.,Type,No.      }
    {    ;Recalculate Invoice Disc.                }
    {    ;Qty. Shipped Not Invoiced                }
    {    ;Qty. Shipped (Base)                      }
    {    ;Shipment Date,Outstanding Quantity       }
    {    ;Document Type,Project Invoice,Installment Invoice,Job No.,Sell-to Customer No.,Installment No.,Plot No.;
                                                   SumIndexFields=Amount (LCY),Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Document Type,Project Invoice,Installment Invoice,Job No.,Sell-to Customer No.,Commission No.,Settl.Sheet No.,Cost Plus Line No.;
                                                   SumIndexFields=Amount (LCY),Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Document Type,Service Invoice,Service Contract No.,Installment Line No.;
                                                   SumIndexFields=Amount (LCY),Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Document Type,Service Invoice,Service Order No.,Base Service Order No.,Cost Plus Line No.,Additional Cost (Service);
                                                   SumIndexFields=Amount (LCY),Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Document Type,Job No.,Extension Contract }
    {    ;Document Type,Document No.,Service Contract No.,Service Location No.,Service Order No.,Line No.;
                                                   MaintainSQLIndex=No }
    {    ;Document Type,Document No.,Cost Type Cost Plus Line;
                                                   MaintainSQLIndex=No }
    {    ;Document Type,Collective List No.        }
    {    ;Batch Seq. No.                           }
  }
  FIELDGROUPS
  {
    { 1   ;Brick               ;No.,Description,Line Amount,Quantity,Unit of Measure Code,Price description }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=You cannot delete the order line because it is associated with purchase order %1 line %2.;NOR=Du kan ikke slette ordrelinjen fordi den er tilknyttet bestilling %1, linje %2.;SVE=Du kan inte ta bort orderraden eftersom den „r kopplad till ink”psorder %1 rad %2.';
      Text001@1001 : TextConst 'ENU=You cannot rename a %1.;NOR=Du kan ikke gi nytt navn til en %1.;SVE=Du kan inte byta namn p† %1.';
      Text002@1002 : TextConst 'ENU=You cannot change %1 because the order line is associated with purchase order %2 line %3.;NOR=Du kan ikke endre %1 fordi ordrelinjen er tilknyttet bestilling %2, linje %3.;SVE=Du kan inte „ndra %1 eftersom orderraden „r kopplad till ink”psorder %2 rad %3.';
      Text003@1003 : TextConst 'ENU=must not be less than %1;NOR=kan ikke v‘re mindre enn %1;SVE=f†r inte vara mindre „n %1';
      Text005@1004 : TextConst 'ENU=You cannot invoice more than %1 units.;NOR=Du kan ikke fakturere mer enn %1 enheter.;SVE=Du kan inte fakturera mer „n %1 stycken.';
      Text006@1005 : TextConst 'ENU=You cannot invoice more than %1 base units.;NOR=Du kan ikke fakturere mer enn %1 lagerenheter.;SVE=Du kan inte fakturera mer „n %1 basenheter.';
      Text007@1006 : TextConst 'ENU=You cannot ship more than %1 units.;NOR=Du kan ikke levere mer enn %1 enheter.;SVE=Du kan inte leverera mer „n %1 stycken.';
      Text008@1007 : TextConst 'ENU=You cannot ship more than %1 base units.;NOR=Du kan ikke levere mer enn %1 lagerenheter.;SVE=Du kan inte leverera mer „n %1 basenheter.';
      Text009@1008 : TextConst 'ENU=" must be 0 when %1 is %2";NOR=" m† v‘re 0 n†r %1 er %2";SVE=" m†ste vara 0 n„r %1 „r %2"';
      ManualReserveQst@1010 : TextConst 'ENU=Automatic reservation is not possible.\Do you want to reserve items manually?;NOR=Det er ikke mulig † reservere automatisk.\Vil du reservere varene manuelt?;SVE=Automatisk reservation „r inte m”jlig.\Vill du reservera artiklarna manuellt?';
      Text014@1013 : TextConst 'ENU=%1 %2 is before work date %3;NOR=%1 %2 er f›r arbeidsdatoen %3;SVE=%1 %2 „r f”re arbetsdatumet %3';
      Text016@1040 : TextConst 'ENU="%1 is required for %2 = %3.";NOR="%1 kreves for %2 = %3.";SVE="%1 kr„vs f”r %2 = %3."';
      WhseRequirementMsg@1044 : TextConst '@@@="%1=Document";ENU=%1 is required for this line. The entered information may be disregarded by warehouse activities.;NOR=%1 kreves for denne linjen. Den angitte informasjonen kan bli oversett av lageraktiviteter.;SVE=\Den registrerade informationen kommer kanske inte att beaktas av dist.lager †tg„rder.';
      Text020@1019 : TextConst 'ENU=You cannot return more than %1 units.;NOR=Du kan ikke returnere mer enn %1 enheter.;SVE=Du kan inte returnera mer „n %1 stycken.';
      Text021@1020 : TextConst 'ENU=You cannot return more than %1 base units.;NOR=Du kan ikke returnere mer enn %1 lagerenheter.;SVE=Du kan inte returnera mer „n %1 (bas) stycken.';
      Text026@1025 : TextConst 'ENU=You cannot change %1 if the item charge has already been posted.;NOR=Du kan ikke endre %1 hvis varegebyret allerede er bokf›rt.;SVE=Du kan inte „ndra %1 om artikelomkostnaden redan har bokf”rts.';
      CurrExchRate@1030 : Record 330;
      SalesHeader@1031 : Record 36;
      SalesLine2@1032 : Record 37;
      TmpChrgRec@1100525003 : TEMPORARY Record 11229771;
      GLAcc@1035 : Record 15;
      Resource@1400 : Record 156;
      Currency@1037 : Record 4;
      Res@1043 : Record 156;
      ResCost@1045 : Record 202;
      VATPostingSetup@1048 : Record 325;
      GenBusPostingGrp@1050 : Record 250;
      GenProdPostingGrp@1051 : Record 251;
      UnitOfMeasure@1054 : Record 204;
      NonstockItem@1058 : Record 5718;
      SKU@1060 : Record 5700;
      ItemCharge@1061 : Record 5800;
      InvtSetup@1063 : Record 313;
      Location@1064 : Record 14;
      ATOLink@1016 : Record 904;
      SalesSetup@1065 : Record 311;
      TempItemTemplate@1099 : TEMPORARY Record 1301;
      CalChange@1052 : Record 11072016;
      ConfigTemplateHeader@1057 : Record 8618;
      TempErrorMessage@1036 : TEMPORARY Record 700;
      PriceCalcMgt@1071 : Codeunit 7000;
      CustCheckCreditLimit@1074 : Codeunit 312;
      ItemCheckAvail@1075 : Codeunit 311;
      SalesTaxCalculate@1076 : Codeunit 398;
      ReserveSalesLine@1079 : Codeunit 99000832;
      UOMMgt@1080 : Codeunit 5402;
      AddOnIntegrMgt@1081 : Codeunit 5403;
      DimMgt@1082 : Codeunit 408;
      ItemSubstitutionMgt@1085 : Codeunit 5701;
      DistIntegration@1086 : Codeunit 5702;
      CatalogItemMgt@1087 : Codeunit 5703;
      WhseValidateSourceLine@1088 : Codeunit 5777;
      TransferExtendedText@1100 : Codeunit 378;
      DeferralUtilities@1026 : Codeunit 1720;
      CalendarMgmt@1056 : Codeunit 7600;
      PostingSetupMgt@1068 : Codeunit 48;
      FullAutoReservation@1092 : Boolean;
      StatusCheckSuspended@1094 : Boolean;
      HasBeenShown@1018 : Boolean;
      PlannedShipmentDateCalculated@1012 : Boolean;
      PlannedDeliveryDateCalculated@1070 : Boolean;
      Text028@1098 : TextConst 'ENU=You cannot change the %1 when the %2 has been filled in.;NOR=Du kan ikke endre %1 n†r %2 er fyllt ut.;SVE=Du kan inte „ndra %1 n„r %2 har fyllts i.';
      Text029@1021 : TextConst 'ENU=must be positive;NOR=m† v‘re positiv;SVE=m†ste vara positivt';
      Text030@1042 : TextConst 'ENU=must be negative;NOR=m† v‘re negativ;SVE=m†ste vara negativt';
      Text031@1093 : TextConst 'ENU=You must either specify %1, %2 or %3.;NOR=Du m† angi %1 eller %2.;SVE=Du m†ste antingen ange %1 eller %2.';
      Text034@1084 : TextConst 'ENU=The value of %1 field must be a whole number for the item included in the service item group if the %2 field in the Service Item Groups window contains a check mark.;NOR=Verdien i feltet %1 m† v‘re et helt tall for varen som er inkludert i servicevaregruppen, hvis det er et merke i feltet %2 i vinduet Servicevaregrupper.;SVE=V„rdet i f„ltet %1 m†ste vara ett heltal f”r artikeln i serviceartikelgruppen om f„ltet %2 i f”nstret Serviceartikelgrupper „r markerat.';
      Text035@1083 : TextConst 'ENU="Warehouse ";NOR="Lager ";SVE="Dist.lager "';
      Text036@1090 : TextConst 'ENU="Inventory ";NOR="Beholdning ";SVE="Lager "';
      HideValidationDialog@1109 : Boolean;
      Text037@1009 : TextConst 'ENU=You cannot change %1 when %2 is %3 and %4 is positive.;NOR=Du kan ikke endre %1 n†r %2 er %3 og %4 er positiv.;SVE=Det g†r inte att „ndra %1 om %2 „r %3 och %4 „r positivt.';
      Text038@1014 : TextConst 'ENU=You cannot change %1 when %2 is %3 and %4 is negative.;NOR=Du kan ikke endre %1 n†r %2 er %3 og %4 er negativ.;SVE=Det g†r inte att „ndra %1 n„r %2 „r %3 och %4 „r negativt.';
      Text039@1034 : TextConst 'ENU=%1 units for %2 %3 have already been returned. Therefore, only %4 units can be returned.;NOR=%1 enheter for %2 %3 er allerede returnert. Derfor kan bare %4 enheter returneres.;SVE=%1 enheter f”r %2 %3 har redan returnerats. D„rf”r g†r det bara att returnera %4 enheter.';
      Text040@1039 : TextConst 'ENU=You must use form %1 to enter %2, if item tracking is used.;NOR=Du m† bruke skjemaet %1 til † registrere %2 hvis varesporing brukes.;SVE=Du m†ste anv„nda formul„ret %1 f”r att ange %2 om artikelsp†rning anv„nds.';
      Text042@1055 : TextConst 'ENU=When posting the Applied to Ledger Entry %1 will be opened first;NOR=Ved bokf›ring av utligning †pnes posten %1 f›rst;SVE=N„r den kopplade transaktionen bokf”rs ”ppnas %1 f”rst';
      ShippingMoreUnitsThanReceivedErr@1047 : TextConst 'ENU=You cannot ship more than the %1 units that you have received for document no. %2.;NOR=Du kan ikke levere mer enn de %1 enhetene som er mottatt for bilagsnummer %2.;SVE=Du kan inte utleverera fler „n de %1 enheter som har inlevererats f”r dokumentnr %2.';
      Text044@1103 : TextConst 'ENU=cannot be less than %1;NOR=kan ikke v‘re mindre enn %1;SVE=f†r inte vara mindre „n %1';
      Text045@1104 : TextConst 'ENU=cannot be more than %1;NOR=kan ikke v‘re mer enn %1;SVE=f†r inte vara st”rre „n %1';
      Text046@1105 : TextConst 'ENU=You cannot return more than the %1 units that you have shipped for %2 %3.;NOR=Du kan ikke returnere mer enn de %1 enhetene som er levert for %2 %3.;SVE=Det g†r inte att returnera fler „n de %1 enheter som du har levererat f”r %2 %3.';
      Text047@1106 : TextConst 'ENU=must be positive when %1 is not 0.;NOR=m† v‘re positiv n†r %1 ikke er 0.;SVE=m†ste vara positivt n„r %1 „r skilt fr†n 0.';
      Text048@1108 : TextConst 'ENU=You cannot use item tracking on a %1 created from a %2.;NOR=Du kan ikke bruke varesporing p† %1 som er opprettet fra %2.;SVE=Det g†r inte att anv„nda artikelsp†rning p† %1 som har skapats fr†n %2.';
      Text049@1139 : TextConst 'ENU=cannot be %1.;NOR=kan ikke v‘re %1.;SVE=kan inte vara %1.';
      Text051@1141 : TextConst 'ENU=You cannot use %1 in a %2.;NOR=Du kan ikke bruke %1 i %2.;SVE=Det g†r inte att anv„nda %1 i %2.';
      PrePaymentLineAmountEntered@1015 : Boolean;
      Text052@1022 : TextConst 'ENU=You cannot add an item line because an open warehouse shipment exists for the sales header and Shipping Advice is %1.\\You must add items as new lines to the existing warehouse shipment or change Shipping Advice to Partial.;NOR=Du kan ikke legge til en varelinje fordi det finnes en †pen lagerlevering for salgshodet og Leverings›nske er %1\.\Du m† legge til varer som nye linjer i den eksisterende lagerleveringen eller endre Leverings›nske til Delvis.;SVE=Det g†r inte att l„gga till en artikelrad eftersom det finns en ”ppen lagerutleverans f”r f”rs„ljningshuvudet och eftersom leveranstypen „r %1.\\Du m†ste l„gga till artiklarna som nya rader i den befintliga lagerutleveransen eller „ndra leveranstypen till Delvis.';
      Text053@1017 : TextConst 'ENU=You have changed one or more dimensions on the %1, which is already shipped. When you post the line with the changed dimension to General Ledger, amounts on the Inventory Interim account will be out of balance when reported per dimension.\\Do you want to keep the changed dimension?;NOR=Du har endret ‚n eller flere dimensjoner p† %1, som allerede er levert. N†r du bokf›rer linjen med den endrede dimensjonen i Finans, vil bel›p p† den midlertidige lagerkontoen v‘re i ubalanse n†r de rapporteres per dimensjon.\\Vil du beholde den endrede dimensjonen?;SVE=Du har „ndrat en eller flera dimensioner i %1, som redan levererats. N„r du bokf”r raden med den „ndrade dimensionen i redovisningen kommer summorna p† kontot f”r interimlager inte att st„mma n„r de rapporteras per dimension.\\Vill du beh†lla den „ndrade dimensionen?';
      Text054@1023 : TextConst 'ENU=Cancelled.;NOR=Avbrutt.;SVE=Avbruten.';
      Text055@1024 : TextConst '@@@=Quantity Invoiced must not be greater than the sum of Qty. Assigned and Qty. to Assign.;ENU=%1 must not be greater than the sum of %2 and %3.;NOR=%1 m† ikke v‘re st›rre enn summen av %2 og %3.;SVE=%1 f†r inte vara st”rre „n summan av %2 och %3.';
      Text056@1011 : TextConst 'ENU=You cannot add an item line because an open inventory pick exists for the Sales Header and because Shipping Advice is %1.\\You must first post or delete the inventory pick or change Shipping Advice to Partial.;NOR=Du kan ikke legge til en varelinje fordi det finnes et †pent lagerplukk for salgshodet og Leverings›nske er %1.\\Du m† f›rst bokf›re eller slette lagerplukket eller endre leverings›nske til Delvis.;SVE=Det g†r inte att l„gga till en artikelrad eftersom det finns en ”ppen lagerplockning f”r f”rs„ljningshuvudet och eftersom leveranstypen „r %1.\\Du m†ste f”rst bokf”ra eller ta bort lagerplockningen eller „ndra leveranstypen till Delvis.';
      Text057@1027 : TextConst 'ENU=must have the same sign as the shipment;NOR=m† ha samme fortegn som f›lgeseddelen;SVE=m†ste ha samma tecken som utleveransen';
      Text058@1028 : TextConst 'ENU=The quantity that you are trying to invoice is greater than the quantity in shipment %1.;NOR=Antallet du pr›ver † fakturere, er st›rre enn antallet i f›lgeseddel %1.;SVE=Antalet som du f”rs”ker att fakturera „r st”rre „n antalet i utleveransen %1.';
      Text059@1029 : TextConst 'ENU=must have the same sign as the return receipt;NOR=m† ha samme fortegn som returseddelen;SVE=m†ste ha samma tecken som returinleveransen';
      Text060@1041 : TextConst 'ENU=The quantity that you are trying to invoice is greater than the quantity in return receipt %1.;NOR=Antallet du pr›ver † fakturere, er st›rre enn antallet i returseddel %1.;SVE=Antalet som du f”rs”ker att fakturera „r st”rre „n antalet i returinleveransen %1.';
      ItemChargeAssignmentErr@1097 : TextConst 'ENU=You can only assign Item Charges for Line Types of Charge (Item).;NOR=Du kan bare tilordne varegebyr for linjer av typen Gebyr (vare).';
      AnotherItemWithSameDescrQst@1049 : TextConst '@@@="%1=Item no., %2=item description";ENU=We found an item with the description "%2" (No. %1).\Did you mean to change the current item to %1?;NOR=Vi fant en vare med beskrivelsen %2 (nr. %1).\Vil du endre gjeldende vare til %1?;SVE=Vi hittade en artikel med beskrivningen "%2" (nr %1).\Vill du byta aktuell artikel mot %1?';
      SalesLineCompletelyShippedErr@1053 : TextConst 'ENU=You cannot change the purchasing code for a sales line that has been completely shipped.;NOR=Du kan ikke endre kj›pskoden for en salgslinje som er fullstendig levert.;SVE=Det g†r inte att „ndra ink”pskoden f”r en f”rs„ljningsrad som „r fullst„ndigt levererad.';
      SalesSetupRead@1067 : Boolean;
      LookupRequested@1059 : Boolean;
      FreightLineDescriptionTxt@1033 : TextConst 'ENU=Freight Amount;NOR=Fraktbel›p;SVE=Fraktbelopp';
      CannotFindDescErr@1200 : TextConst '@@@="%1 = Type caption %2 = Description";ENU=Cannot find %1 with Description %2.\\Make sure to use the correct type.;NOR=Finner ikke %1 med beskrivelsen %2.\\Pass p† at du bruker riktig type.';
      PriceDescriptionTxt@1038 : TextConst '@@@={Locked};ENU=x%1 (%2%3/%4);NOR=x%1 (%2%3/%4)';
      PriceDescriptionWithLineDiscountTxt@1066 : TextConst '@@@={Locked};ENU=x%1 (%2%3/%4) - %5%;NOR=x%1 (%2%3/%4) - %5%';
      SelectNonstockItemErr@1062 : TextConst 'ENU=You can only select a catalog item for an empty line.;NOR=Du kan bare velge en katalogvare for en tom linje.';
      EstimateLbl@1072 : TextConst 'ENU=Estimate;NOR=Estimat;SVE=Kalkyl';
      CommentLbl@1046 : TextConst 'ENU=Comment;NOR=Merknad;SVE=Kommentar';
      LineDiscountPctErr@1073 : TextConst 'ENU=The value in the Line Discount % field must be between 0 and 100.;NOR=Verdien i feltet Linjerabatt % m† v‘re mellom 0 og 100.';
      SalesBlockedErr@1077 : TextConst 'ENU=You cannot sell this item because the Sales Blocked check box is selected on the item card.;NOR=Du kan ikke selge denne varen fordi det er merket av for Salg sperret p† varekortet.';
      CannotChangePrepaidServiceChargeErr@1078 : TextConst 'ENU=You cannot change the line because it will affect service charges that are already invoiced as part of a prepayment.;NOR=Du kan ikke endre linjen fordi den p†virker tjenestegebyrer som allerede er fakturert som en del av et forskudd.';
      LineAmountInvalidErr@1089 : TextConst 'ENU=You have set the line amount to a value that results in a discount that is not valid. Consider increasing the unit price instead.;NOR=Du har satt linjebel›pet til en verdi som f›rer til en rabatt som er ugyldig. Vurder i stedet † ›ke salgsprisen.';
      LineInvoiceDiscountAmountResetTok@1096 : TextConst '@@@=%1 - Record ID;ENU=The value in the Inv. Discount Amount field in %1 has been cleared.;NOR=Verdien i feltet Fakturarabattbel›p i %1 er fjernet.';
      UnitPriceChangedMsg@1091 : TextConst '@@@="%1 = Type caption %2 = No.";ENU=The unit price for %1 %2 that was copied from the posted document has been changed.;NOR=Salgsprisen for %1 %2 som ble kopiert fra det bokf›rte dokumentet, er endret.';
      ProjSetupRec@1210190009 : Record 315;
      ProjRec@11012047 : Record 11072003;
      ProjTypeRec@11012048 : Record 11012009;
      ProjectTypeExtension@1100529601 : Record 11229469;
      ProjPrincipRec@11012050 : Record 11012005;
      ProjInstalmRec@1210190010 : Record 11012018;
      CostPlusRec@1210190011 : Record 11012019;
      DimVal@11012000 : Record 349;
      Text11012001@1210190000 : TextConst 'ENU=Status of Project %1 Extension %2 is lower then Invoicing Allowed.;NOR=Status for prosjekt %1 ETA %2 er lavere enn ''Fakturering tillatt''.;SVE=Status f”r projektet %1 ŽTA %2 „r l„gre „n till†ten fakturering.';
      ServOrderRec@1210190006 : Record 11012823;
      ServContrRec@1210190017 : Record 11012812;
      ServTypeRec@1210190004 : Record 11012814;
      ServCostPlusRec@1210190007 : Record 11012825;
      SalesRentalRemovalLine@1100485007 : Record 11012789;
      PlantNumber@1100529600 : Record 11012552;
      ItemTypeOpt@1210190015 : 'Item,Basic Item,Trade Item,Trade Vendor';
      ValidateCu@1210190016 : Codeunit 11012033;
      OnlyCheckForOpen@1210190018 : Boolean;
      Text11012002@1100485000 : TextConst 'ENU=%1 must be filled for Project ''%2'' or for Project Principal ''%3''.;NOR=%1 m† fylles ut for prosjekt ''%2'' eller for prosjektoppdragsgiver ''%3''.;SVE=%1 m†ste fyllas i f”r projekt ''%2'' eller f”r projektuppdragsgivare ''%3''.';
      UpdateVATAmountsSuspended@1100485001 : Boolean;
      Text11012003@1100485002 : TextConst 'ENU=may not be before the %1;NOR=kan ikke v‘re f›r %1;SVE=f†r inte vara f”re %1';
      Text11012004@1100485003 : TextConst 'ENU=may not be after the %1;NOR=kan ikke v‘re etter %1;SVE=f†r inte vara efter %1';
      CompanyLogistics@1100485004 : Text[30];
      Text11012005@1100485005 : TextConst 'ENU=%1 van %2 %3 set to zero.;NOR=%1 av %2 %3 er satt til null.;SVE=%1 av %2 %3 „r inst„llt p† noll.';
      Text11012006@1100485006 : TextConst 'ENU=You cannot delete orderline %1 because a plant orders exists for this orderline.;NOR=Du kan ikke fjerne ordrerad %1 fordi en maskinordre finnes for denne ordreraden.;SVE=Du kan inte ta bort orderrad %1 eftersom en Maskinsorder finns f”r denna orderrad.';
      Text11012007@1100525000 : TextConst 'ENU="must not be specified when %1 = %2";NOR="skal ikke spesifiseres n†r %1 = %2";SVE="ska inte specificeras n„r %1 = %2"';
      DPA_Management@1100000999 : Codeunit 11012783;
      Text11012008@1100525001 : TextConst 'ENU=Item Tracking can not be used for Invoicing Cost Plus Entries.';
      TmpSalesRecipeLine@1100525002 : TEMPORARY Record 11229789;
      Text11012009@1100528600 : TextConst 'ENU=Sales Line %1 cannot be deleted because subsequent lines exist';
      Text11012010@1100528400 : TextConst 'ENU=Compressing lines of %1 %2 is not allowed.';
      Text11012011@1100528401 : TextConst 'ENU=%1 of %2 %3 should be filled.';
      Text11012012@1100528402 : TextConst 'ENU=%1 of %2 %3 should be %4.';
      Text11012013@1100528403 : TextConst 'ENU=%1 %2 not found.';
      Text11012014@1100528404 : TextConst 'ENU=No. of Objects:';
      ConvertFCYtoLCY@1100525004 : ARRAY [10] OF Boolean;
      ItemNoFieldCaptionTxt@1100525005 : TextConst 'ENU=Item;SVE=Artikel';
      FPSLicenseManagement@1100525006 : Codeunit 11229289;
      NorwegianVATTools@1080000 : Codeunit 11128500;
      Text13600@1101100000 : TextConst 'ENU=You cannot enter %1 if %2 is "%3".;NOR=Du kan ikke angi %1 om %2 er "%3".;SVE=Du kan inte ange %1 om %2 „r "%3".';
      Text10600@1080003 : TextConst 'ENU=You cannot enter %1 if %2 is "%3".;NOR=Du kan ikke angi %1 hvis %2 er %3.;SVE=Du kan inte ange %1 om %2 „r "%3".';

    [External]
    PROCEDURE InitOutstanding@16();
    BEGIN
      IF IsCreditDocType THEN BEGIN
        "Outstanding Quantity" := Quantity - "Return Qty. Received";
        "Outstanding Qty. (Base)" := "Quantity (Base)" - "Return Qty. Received (Base)";
        "Return Qty. Rcd. Not Invd." := "Return Qty. Received" - "Quantity Invoiced";
        "Ret. Qty. Rcd. Not Invd.(Base)" := "Return Qty. Received (Base)" - "Qty. Invoiced (Base)";
      END ELSE BEGIN
        "Outstanding Quantity" := Quantity - "Quantity Shipped";
        "Outstanding Qty. (Base)" := "Quantity (Base)" - "Qty. Shipped (Base)";
        "Qty. Shipped Not Invoiced" := "Quantity Shipped" - "Quantity Invoiced";
        "Qty. Shipped Not Invd. (Base)" := "Qty. Shipped (Base)" - "Qty. Invoiced (Base)";
      END;
      OnAfterInitOutstandingQty(Rec);
      UpdatePlanned;
      "Completely Shipped" := (Quantity <> 0) AND ("Outstanding Quantity" = 0);
      InitOutstandingAmount;

      OnAfterInitOutstanding(Rec);
    END;

    [External]
    PROCEDURE InitOutstandingAmount@17();
    VAR
      AmountInclVAT@1000 : Decimal;
    BEGIN
      IF Quantity = 0 THEN BEGIN
        "Outstanding Amount" := 0;
        "Outstanding Amount (LCY)" := 0;
        "Shipped Not Invoiced" := 0;
        "Shipped Not Invoiced (LCY)" := 0;
        "Return Rcd. Not Invd." := 0;
        "Return Rcd. Not Invd. (LCY)" := 0;
      END ELSE BEGIN
        GetSalesHeader;
        AmountInclVAT := "Amount Including VAT";
        VALIDATE(
          "Outstanding Amount",
          ROUND(
            AmountInclVAT * "Outstanding Quantity" / Quantity,
            Currency."Amount Rounding Precision"));
        IF IsCreditDocType THEN
          VALIDATE(
            "Return Rcd. Not Invd.",
            ROUND(
              AmountInclVAT * "Return Qty. Rcd. Not Invd." / Quantity,
              Currency."Amount Rounding Precision"))
        ELSE
          VALIDATE(
            "Shipped Not Invoiced",
            ROUND(
              AmountInclVAT * "Qty. Shipped Not Invoiced" / Quantity,
              Currency."Amount Rounding Precision"));
      END;

      OnAfterInitOutstandingAmount(Rec,SalesHeader,Currency);
    END;

    [External]
    PROCEDURE InitQtyToShip@15();
    BEGIN
      GetSalesSetup;
      //**4PS.so
      //IF (SalesSetup."Default Quantity to Ship" = SalesSetup."Default Quantity to Ship"::Remainder) OR
      //   ("Document Type" = "Document Type"::Invoice)
      //THEN BEGIN
      //  "Qty. to Ship" := "Outstanding Quantity";
      //  "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
      //END ELSE
      //  IF "Qty. to Ship" <> 0 THEN
      //    "Qty. to Ship (Base)" := CalcBaseQty("Qty. to Ship");
      //**4PS.eo
      //**4PS.sn
      IF OnlyCheckForOpen THEN BEGIN
        IF ("Qty. to Ship" * Quantity) >= ("Outstanding Quantity" * Quantity) THEN
          "Qty. to Ship" := "Outstanding Quantity";
        "Qty. to Ship (Base)" := CalcBaseQty("Qty. to Ship");
        IF ("Qty. to Ship (Base)" * Quantity) >= ("Outstanding Qty. (Base)" * Quantity) THEN
          "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
        OnlyCheckForOpen := FALSE;
      END ELSE BEGIN
        IF (("Document Type" = "Document Type"::Order) OR
            ("Document Type" = "Document Type"::"Blanket Order")) AND
            NOT DirectDelivery THEN
        BEGIN
          "Qty. to Ship" := 0;
          "Qty. to Ship (Base)" := 0;
        END ELSE BEGIN
          "Qty. to Ship" := "Outstanding Quantity";
          "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
        END;
      END;
      //**4PS.en
      CheckServItemCreation;

      OnAfterInitQtyToShip(Rec,CurrFieldNo);

      InitQtyToInvoice;
    END;

    [External]
    PROCEDURE InitQtyToReceive@5803();
    BEGIN
      GetSalesSetup;
      IF (SalesSetup."Default Quantity to Ship" = SalesSetup."Default Quantity to Ship"::Remainder) OR
         ("Document Type" = "Document Type"::"Credit Memo")
      THEN BEGIN
        "Return Qty. to Receive" := "Outstanding Quantity";
        "Return Qty. to Receive (Base)" := "Outstanding Qty. (Base)";
      END ELSE
        IF "Return Qty. to Receive" <> 0 THEN
          "Return Qty. to Receive (Base)" := CalcBaseQty("Return Qty. to Receive");

      OnAfterInitQtyToReceive(Rec,CurrFieldNo);

      InitQtyToInvoice;
    END;

    [External]
    PROCEDURE InitQtyToInvoice@13();
    BEGIN
      "Qty. to Invoice" := MaxQtyToInvoice;
      "Qty. to Invoice (Base)" := MaxQtyToInvoiceBase;
      "VAT Difference" := 0;

      OnBeforeCalcInvDiscToInvoice(Rec,CurrFieldNo);
      CalcInvDiscToInvoice;
      IF SalesHeader."Document Type" <> SalesHeader."Document Type"::Invoice THEN
        CalcPrepaymentToDeduct;

      OnAfterInitQtyToInvoice(Rec,CurrFieldNo);
    END;

    LOCAL PROCEDURE InitItemAppl@40(OnlyApplTo@1000 : Boolean);
    BEGIN
      "Appl.-to Item Entry" := 0;
      IF NOT OnlyApplTo THEN
        "Appl.-from Item Entry" := 0;
    END;

    [External]
    PROCEDURE MaxQtyToInvoice@18() : Decimal;
    VAR
      MaxQty@1002 : Decimal;
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeMaxQtyToInvoice(Rec,MaxQty,IsHandled);
      IF IsHandled THEN
        EXIT(MaxQty);

      IF "Prepayment Line" THEN
        EXIT(1);

      IF IsCreditDocType THEN
        EXIT("Return Qty. Received" + "Return Qty. to Receive" - "Quantity Invoiced");

      EXIT("Quantity Shipped" + "Qty. to Ship" - "Quantity Invoiced");
    END;

    [External]
    PROCEDURE MaxQtyToInvoiceBase@19() : Decimal;
    VAR
      MaxQtyBase@1001 : Decimal;
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeMaxQtyToInvoiceBase(Rec,MaxQtyBase,IsHandled);
      IF IsHandled THEN
        EXIT(MaxQtyBase);

      IF IsCreditDocType THEN
        EXIT("Return Qty. Received (Base)" + "Return Qty. to Receive (Base)" - "Qty. Invoiced (Base)");

      EXIT("Qty. Shipped (Base)" + "Qty. to Ship (Base)" - "Qty. Invoiced (Base)");
    END;

    LOCAL PROCEDURE CalcBaseQty@14(Qty@1000 : Decimal) : Decimal;
    BEGIN
      TESTFIELD("Qty. per Unit of Measure");
      EXIT(ROUND(Qty * "Qty. per Unit of Measure",UOMMgt.QtyRndPrecision));
    END;

    [External]
    PROCEDURE CalcLineAmount@163() LineAmount : Decimal;
    BEGIN
      LineAmount := "Line Amount" - "Inv. Discount Amount";

      OnAfterCalcLineAmount(Rec,LineAmount);
    END;

    LOCAL PROCEDURE CopyFromStandardText@131();
    VAR
      StandardText@1000 : Record 7;
    BEGIN
      StandardText.GET("No.");
      Description := StandardText.Description;
      "Allow Item Charge Assignment" := FALSE;
      OnAfterAssignStdTxtValues(Rec,StandardText);
    END;

    LOCAL PROCEDURE CopyFromGLAccount@142();
    BEGIN
      GLAcc.GET("No.");
      GLAcc.CheckGLAcc;
      IF NOT "System-Created Entry" THEN
        GLAcc.TESTFIELD("Direct Posting",TRUE);
      //Description := GLAcc.Name; //**4PS.o

      //**4PS.sn
      IF ("Job No." = '') AND ("Service Order No." = '') AND ("Plant Type" = '') AND
         (Recipe = '') AND
         ("Trade Item" = '') AND ("Item No." = '') AND ("Shortcut Dimension 2 Code" = '')
      THEN BEGIN
        SalesHeader.GET("Document Type","Document No.");
        IF "No." <> GetCPGInvRoundAcc(SalesHeader) THEN
          Description := SalesHeader."Bill-to Name";  //previously filled with GLAcc.Name;
      END;
      //**4PS.en

      IF GLAcc."Gen. Prod. Posting Group" <> '' THEN  //**4PS.n
        "Gen. Prod. Posting Group" := GLAcc."Gen. Prod. Posting Group";
      IF GLAcc."VAT Prod. Posting Group" <> '' THEN  //**4PS.n
        "VAT Prod. Posting Group" := GLAcc."VAT Prod. Posting Group";
      IF GLAcc."Tax Group Code" <> '' THEN  //**4PS.n
        "Tax Group Code" := GLAcc."Tax Group Code";
      //"Allow Invoice Disc." := FALSE;  //**4PS.o
      //**4PS.sn
      IF ("Project Invoice" OR "Plant Invoice") THEN  //**4PS.n
        "Allow Invoice Disc." := FALSE;
      //**4PS.en
      "Allow Item Charge Assignment" := FALSE;
      "Auto. Acc. Group" := GLAcc."Auto. Acc. Group";  //NAVSE
      InitDeferralCode;
      OnAfterAssignGLAccountValues(Rec,GLAcc);
    END;

    LOCAL PROCEDURE CopyFromItem@144();
    VAR
      Item@1001 : Record 27;
      PrepaymentMgt@1000 : Codeunit 441;
      IsHandled@1002 : Boolean;
    BEGIN
      "Item No." := "No."; //**4PS.n

      GetItem(Item);
      IsHandled := FALSE;
      OnBeforeCopyFromItem(Rec,Item,IsHandled);

      CheckIfItemIsBlocked(Item); //**4PS.n

      IF NOT IsHandled THEN BEGIN
        Item.TESTFIELD(Blocked,FALSE);
        Item.TESTFIELD("Gen. Prod. Posting Group");
        IF Item."Sales Blocked" AND NOT IsCreditDocType THEN
          ERROR(SalesBlockedErr);
        IF Item.Type = Item.Type::Inventory THEN BEGIN
          Item.TESTFIELD("Inventory Posting Group");
          "Posting Group" := Item."Inventory Posting Group";
        END;
      END;

      OnCopyFromItemOnAfterCheck(Rec,Item);

      Description := Item.Description;
      "Description 2" := Item."Description 2";
      //**4PS.sn
      "Shortcut Dimension 2 Code" := Item."Global Dimension 2 Code";
      "Country/Region of Origin Code" := Item."Country/Region of Origin Code";
      "Unit of Measure Code" := Item."Sales Unit of Measure"; //before GetUnitCost
      //**4PS.en

      GetUnitCost;
      "Allow Invoice Disc." := Item."Allow Invoice Disc.";
      "Units per Parcel" := Item."Units per Parcel";
      "Gen. Prod. Posting Group" := Item."Gen. Prod. Posting Group";
      "VAT Prod. Posting Group" := Item."VAT Prod. Posting Group";
      "Tax Group Code" := Item."Tax Group Code";
      "Item Category Code" := Item."Item Category Code";
      Nonstock := Item."Created From Nonstock Item";
      "Profit %" := Item."Profit %";
      "Allow Item Charge Assignment" := TRUE;
      PrepaymentMgt.SetSalesPrepaymentPct(Rec,SalesHeader."Posting Date");
      IF Item.Type = Item.Type::Inventory THEN
        PostingSetupMgt.CheckInvtPostingSetupInventoryAccount("Location Code","Posting Group");

      IF SalesHeader."Language Code" <> '' THEN
        GetItemTranslation;

      IF Item.Reserve = Item.Reserve::Optional THEN
        Reserve := SalesHeader.Reserve
      ELSE
        Reserve := Item.Reserve;

      "Unit of Measure Code" := Item."Sales Unit of Measure";
      OnAfterCopyFromItem(Rec,Item);

      InitDeferralCode;
      SetDefaultItemQuantity;

      ValidateItem(ItemTypeOpt::Item); //**4PS.n

      OnAfterAssignItemValues(Rec,Item);
    END;

    LOCAL PROCEDURE CopyFromResource@146();
    BEGIN
      Res.GET("No.");
      Res.CheckResourcePrivacyBlocked(FALSE);
      Res.TESTFIELD(Blocked,FALSE);
      Res.TESTFIELD("Gen. Prod. Posting Group");
      Description := Res.Name;
      "Description 2" := Res."Name 2";
      "Unit of Measure Code" := Res."Base Unit of Measure";
      "Unit Cost (LCY)" := Res."Unit Cost";
      "Gen. Prod. Posting Group" := Res."Gen. Prod. Posting Group";
      "VAT Prod. Posting Group" := Res."VAT Prod. Posting Group";
      "Tax Group Code" := Res."Tax Group Code";
      "Allow Item Charge Assignment" := FALSE;
      FindResUnitCost;
      InitDeferralCode;
      OnAfterAssignResourceValues(Rec,Res);
    END;

    LOCAL PROCEDURE CopyFromFixedAsset@148();
    VAR
      FixedAsset@1000 : Record 5600;
    BEGIN
      FixedAsset.GET("No.");
      FixedAsset.TESTFIELD(Inactive,FALSE);
      FixedAsset.TESTFIELD(Blocked,FALSE);
      "Depreciation Book Code" := '';  //**4PS.n
      GetFAPostingGroup;
      Description := FixedAsset.Description;
      "Description 2" := FixedAsset."Description 2";
      "Allow Invoice Disc." := FALSE;
      "Allow Item Charge Assignment" := FALSE;
      OnAfterAssignFixedAssetValues(Rec,FixedAsset);
    END;

    LOCAL PROCEDURE CopyFromItemCharge@150();
    BEGIN
      ItemCharge.GET("No.");
      Description := ItemCharge.Description;
      "Gen. Prod. Posting Group" := ItemCharge."Gen. Prod. Posting Group";
      "VAT Prod. Posting Group" := ItemCharge."VAT Prod. Posting Group";
      "Tax Group Code" := ItemCharge."Tax Group Code";
      "Allow Invoice Disc." := FALSE;
      "Allow Item Charge Assignment" := FALSE;
      OnAfterAssignItemChargeValues(Rec,ItemCharge);
    END;

    LOCAL PROCEDURE SelectItemEntry@8(CurrentFieldNo@1000 : Integer);
    VAR
      ItemLedgEntry@1001 : Record 32;
      SalesLine3@1002 : Record 37;
    BEGIN
      ItemLedgEntry.SETRANGE("Item No.","No.");
      IF "Location Code" <> '' THEN
        ItemLedgEntry.SETRANGE("Location Code","Location Code");
      ItemLedgEntry.SETRANGE("Variant Code","Variant Code");

      IF CurrentFieldNo = FIELDNO("Appl.-to Item Entry") THEN BEGIN
        ItemLedgEntry.SETCURRENTKEY("Item No.",Open);
        ItemLedgEntry.SETRANGE(Positive,TRUE);
        ItemLedgEntry.SETRANGE(Open,TRUE);
      END ELSE BEGIN
        ItemLedgEntry.SETCURRENTKEY("Item No.",Positive);
        ItemLedgEntry.SETRANGE(Positive,FALSE);
        ItemLedgEntry.SETFILTER("Shipped Qty. Not Returned",'<0');
      END;
      IF PAGE.RUNMODAL(PAGE::"Item Ledger Entries",ItemLedgEntry) = ACTION::LookupOK THEN BEGIN
        SalesLine3 := Rec;
        IF CurrentFieldNo = FIELDNO("Appl.-to Item Entry") THEN
          SalesLine3.VALIDATE("Appl.-to Item Entry",ItemLedgEntry."Entry No.")
        ELSE
          SalesLine3.VALIDATE("Appl.-from Item Entry",ItemLedgEntry."Entry No.");
        CheckItemAvailable(CurrentFieldNo);
        Rec := SalesLine3;
      END;
    END;

    [External]
    PROCEDURE SetSalesHeader@24(NewSalesHeader@1000 : Record 36);
    BEGIN
      SalesHeader := NewSalesHeader;

      IF SalesHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE BEGIN
        SalesHeader.TESTFIELD("Currency Factor");
        Currency.GET(SalesHeader."Currency Code");
        Currency.TESTFIELD("Amount Rounding Precision");
      END;
    END;

    [External]
    PROCEDURE GetSalesHeader@1();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      OnBeforeGetSalesHeader(Rec,SalesHeader,IsHandled);
      IF IsHandled THEN
        EXIT;

      TESTFIELD("Document No.");
      IF ("Document Type" <> SalesHeader."Document Type") OR ("Document No." <> SalesHeader."No.") THEN BEGIN
        SalesHeader.GET("Document Type","Document No.");
        IF SalesHeader."Currency Code" = '' THEN
          Currency.InitRoundingPrecision
        ELSE BEGIN
          SalesHeader.TESTFIELD("Currency Factor");
          Currency.GET(SalesHeader."Currency Code");
          Currency.TESTFIELD("Amount Rounding Precision");
        END;
      END;

      OnAfterGetSalesHeader(Rec,SalesHeader,Currency);
    END;

    LOCAL PROCEDURE GetItem@9(VAR Item@1000 : Record 27);
    BEGIN
      //**4PS.sn
      IF "Item No." <> '' THEN BEGIN
        Item.GET("Item No.");
        EXIT;
      END;
      //**4PS.en
      TESTFIELD("No.");
      Item.GET("No.");
    END;

    LOCAL PROCEDURE GetResource@49();
    BEGIN
      TESTFIELD("No.");
      IF "No." <> Resource."No." THEN
        Resource.GET("No.");
    END;

    [External]
    PROCEDURE UpdateUnitPrice@2(CalledByFieldNo@1000 : Integer);
    VAR
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdateUnitPrice(Rec,xRec,CalledByFieldNo,CurrFieldNo,IsHandled);
      IF IsHandled THEN
        EXIT;

      GetSalesHeader;
      TESTFIELD("Qty. per Unit of Measure");

      CASE Type OF
        Type::Item,
        Type::Resource,
        Type::"G/L Account": //**4PS.n
          BEGIN
            IsHandled := FALSE;
            OnUpdateUnitPriceOnBeforeFindPrice(SalesHeader,Rec,CalledByFieldNo,CurrFieldNo,IsHandled);
            IF NOT IsHandled THEN BEGIN
              //**4PS.so
              //IF NOT ("Copied From Posted Doc." AND IsCreditDocType) THEN
              //  PriceCalcMgt.FindSalesLineLineDisc(SalesHeader,Rec);
              //PriceCalcMgt.FindSalesLinePrice(SalesHeader,Rec,CalledByFieldNo);
              //**4PS.eo

              //**4PS.sn
              IF (Type = Type::"G/L Account") AND (("Item No." = '') OR "Plant Invoice") THEN EXIT;
              IF ("Settl.Sheet No." = '') AND ("Cost Plus Line No." = 0) THEN BEGIN
                IF "Price Specification Leading" THEN BEGIN
                  "Line Discount %" := 0;
                  IF CalledByFieldNo <> FIELDNO("Item No.") THEN
                    FindSalesPrice;
                END ELSE
                  FindSalesPrice;
              END;
              //**4PS.en
            END;
          END;
      END;

      IF "Copied From Posted Doc." AND IsCreditDocType AND ("Appl.-from Item Entry" <> 0) THEN
        IF xRec."Unit Price" <> "Unit Price" THEN
          IF GUIALLOWED THEN
            ShowMessageOnce(STRSUBSTNO(UnitPriceChangedMsg,Type,"No."));

      VALIDATE("Unit Price");

      OnAfterUpdateUnitPrice(Rec,xRec,CalledByFieldNo,CurrFieldNo);
    END;

    LOCAL PROCEDURE ShowMessageOnce@229(MessageText@1000 : Text);
    BEGIN
      TempErrorMessage.SetContext(Rec);
      IF TempErrorMessage.FindRecord(RECORDID,0,TempErrorMessage."Message Type"::Warning,MessageText) = 0 THEN BEGIN
        TempErrorMessage.LogMessage(Rec,0,TempErrorMessage."Message Type"::Warning,MessageText);
        MESSAGE(MessageText);
      END;
    END;

    [External]
    PROCEDURE FindResUnitCost@5();
    BEGIN
      ResCost.INIT;
      ResCost.Code := "No.";
      ResCost."Work Type Code" := "Work Type Code";
      CODEUNIT.RUN(CODEUNIT::"Resource-Find Cost",ResCost);
      OnAfterFindResUnitCost(Rec,ResCost);
      VALIDATE("Unit Cost (LCY)",ResCost."Unit Cost" * "Qty. per Unit of Measure");
    END;

    [External]
    PROCEDURE UpdatePrepmtSetupFields@102();
    VAR
      GenPostingSetup@1001 : Record 252;
      GLAcc@1000 : Record 15;
      IsHandled@1002 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdatePrepmtSetupFields(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF ("Prepayment %" <> 0) AND (Type <> Type::" ") THEN BEGIN
        TESTFIELD("Document Type","Document Type"::Order);
        TESTFIELD("No.");
        IF CurrFieldNo = FIELDNO("Prepayment %") THEN
          IF "System-Created Entry" AND NOT IsServiceCharge THEN
            FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,0));
        IF "System-Created Entry" AND NOT IsServiceCharge THEN
          "Prepayment %" := 0;
        GenPostingSetup.GET("Gen. Bus. Posting Group","Gen. Prod. Posting Group");
        IF GenPostingSetup."Sales Prepayments Account" <> '' THEN BEGIN
          GLAcc.GET(GenPostingSetup."Sales Prepayments Account");
          VATPostingSetup.GET("VAT Bus. Posting Group",GLAcc."VAT Prod. Posting Group");
          VATPostingSetup.TESTFIELD("VAT Calculation Type","VAT Calculation Type");
        END ELSE
          CLEAR(VATPostingSetup);
        "Prepayment VAT %" := VATPostingSetup."VAT %";
        "Prepmt. VAT Calc. Type" := VATPostingSetup."VAT Calculation Type";
        "Prepayment VAT Identifier" := VATPostingSetup."VAT Identifier";
        IF "Prepmt. VAT Calc. Type" IN
           ["Prepmt. VAT Calc. Type"::"Reverse Charge VAT","Prepmt. VAT Calc. Type"::"Sales Tax"]
        THEN
          "Prepayment VAT %" := 0;
        "Prepayment Tax Group Code" := GLAcc."Tax Group Code";
      END;
    END;

    LOCAL PROCEDURE UpdatePrepmtAmounts@197();
    VAR
      RemLineAmountToInvoice@1000 : Decimal;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdatePrepmtAmounts(Rec,SalesHeader,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF "Prepayment %" <> 0 THEN BEGIN
        IF Quantity < 0 THEN
          FIELDERROR(Quantity,STRSUBSTNO(Text047,FIELDCAPTION("Prepayment %")));
        IF "Unit Price" < 0 THEN
          FIELDERROR("Unit Price",STRSUBSTNO(Text047,FIELDCAPTION("Prepayment %")));
      END;
      IF SalesHeader."Document Type" <> SalesHeader."Document Type"::Invoice THEN BEGIN
        "Prepayment VAT Difference" := 0;
        IF NOT PrePaymentLineAmountEntered THEN
          "Prepmt. Line Amount" := ROUND("Line Amount" * "Prepayment %" / 100,Currency."Amount Rounding Precision");
        IF "Prepmt. Line Amount" < "Prepmt. Amt. Inv." THEN BEGIN
          IF IsServiceCharge THEN
            ERROR(CannotChangePrepaidServiceChargeErr);
          FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text049,"Prepmt. Amt. Inv."));
        END;
        PrePaymentLineAmountEntered := FALSE;
        IF "Prepmt. Line Amount" <> 0 THEN BEGIN
          RemLineAmountToInvoice :=
            ROUND("Line Amount" * (Quantity - "Quantity Invoiced") / Quantity,Currency."Amount Rounding Precision");
          IF RemLineAmountToInvoice < ("Prepmt. Line Amount" - "Prepmt Amt Deducted") THEN
            FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,RemLineAmountToInvoice + "Prepmt Amt Deducted"));
        END;
      END ELSE
        IF (CurrFieldNo <> 0) AND ("Line Amount" <> xRec."Line Amount") AND
           ("Prepmt. Amt. Inv." <> 0) AND ("Prepayment %" = 100)
        THEN BEGIN
          IF "Line Amount" < xRec."Line Amount" THEN
            FIELDERROR("Line Amount",STRSUBSTNO(Text044,xRec."Line Amount"));
          FIELDERROR("Line Amount",STRSUBSTNO(Text045,xRec."Line Amount"));
        END;
    END;

    [External]
    PROCEDURE UpdateAmounts@3();
    VAR
      VATBaseAmount@1003 : Decimal;
      LineAmountChanged@1002 : Boolean;
    BEGIN
      IF Type = Type::" " THEN
        EXIT;
      GetSalesHeader;
      VATBaseAmount := "VAT Base Amount";
      "Recalculate Invoice Disc." := TRUE;

      //**4PS.so
      //IF "Line Amount" <> xRec."Line Amount" THEN BEGIN
      //  "VAT Difference" := 0;
      //  LineAmountChanged := TRUE;
      //END;
      //IF "Line Amount" <> ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") - "Line Discount Amount" THEN BEGIN
      //  "Line Amount" := ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") - "Line Discount Amount";
      //  "VAT Difference" := 0;
      //  LineAmountChanged := TRUE;
      //END;
      //**4PS.eo
      //**4PS.sn
      IF "Line Amount" <> ROUND(Quantity * DimensionalFactor * "Unit Price" * RentalFactor, Currency."Amount Rounding Precision")
        - "Line Discount Amount" - RetentionAmount(0) THEN BEGIN
        "Line Amount" := ROUND(Quantity * DimensionalFactor * "Unit Price" * RentalFactor,Currency."Amount Rounding Precision") - "Line Discount Amount" - RetentionAmount(0);
        "VAT Difference" := 0;
        LineAmountChanged := TRUE;
      END;
      //**4PS.en

      IF NOT "Prepayment Line" THEN
        UpdatePrepmtAmounts;

      OnAfterUpdateAmounts(Rec,xRec,CurrFieldNo);

      UpdateVATAmounts;

      //**4PS.sn
      UpdateAmountLCY;
      "Line VAT Amount" := "Amount Including VAT" - Amount;
      //**4PS.en

      InitOutstandingAmount;
      CheckCreditLimit;

      IF Type = Type::"Charge (Item)" THEN
        UpdateItemChargeAssgnt;

      CalcPrepaymentToDeduct;
      IF VATBaseAmount <> "VAT Base Amount" THEN
        LineAmountChanged := TRUE;

      IF LineAmountChanged THEN BEGIN
        UpdateDeferralAmounts;
        LineAmountChanged := FALSE;
      END;

      OnAfterUpdateAmountsDone(Rec,xRec,CurrFieldNo);
    END;

    [External]
    PROCEDURE UpdateVATAmounts@38();
    VAR
      SalesLine2@1000 : Record 37;
      TotalLineAmount@1005 : Decimal;
      TotalInvDiscAmount@1004 : Decimal;
      TotalAmount@1001 : Decimal;
      TotalAmountInclVAT@1002 : Decimal;
      TotalQuantityBase@1003 : Decimal;
    BEGIN
      OnBeforeUpdateVATAmounts(Rec);

      GetSalesHeader;

      IF UpdateVATAmountsSuspended THEN EXIT; //**4PS.n

      SalesLine2.SETRANGE("Document Type","Document Type");
      SalesLine2.SETRANGE("Document No.","Document No.");
      SalesLine2.SETFILTER("Line No.",'<>%1',"Line No.");
      SalesLine2.SETRANGE("VAT Identifier","VAT Identifier");
      SalesLine2.SETRANGE("Tax Group Code","Tax Group Code");

      IF "Line Amount" = "Inv. Discount Amount" THEN BEGIN
        Amount := 0;
        "VAT Base Amount" := 0;
        "Amount Including VAT" := 0;
        IF (Quantity = 0) AND (xRec.Quantity <> 0) AND (xRec.Amount <> 0) THEN BEGIN
          IF "Line No." <> 0 THEN
            MODIFY;
          SalesLine2.SETFILTER(Amount,'<>0');
          IF SalesLine2.FIND('<>') THEN BEGIN
            SalesLine2.ValidateLineDiscountPercent(FALSE);
            SalesLine2.MODIFY;
          END;
        END;
      END ELSE BEGIN
        //**4PS.sn
        IF "Manually VAT Posting" THEN BEGIN
          IF SalesHeader."Prices Including VAT" THEN
            "Amount Including VAT" :=
              ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") -
              "Line Discount Amount" - "Inv. Discount Amount"
          ELSE BEGIN
            Amount :=
              ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") -
              "Line Discount Amount" - "Inv. Discount Amount";
           "VAT Base Amount" := Amount;
          END;
        END ELSE BEGIN
        //**4PS.en

        TotalLineAmount := 0;
        TotalInvDiscAmount := 0;
        TotalAmount := 0;
        TotalAmountInclVAT := 0;
        TotalQuantityBase := 0;
        IF ("VAT Calculation Type" = "VAT Calculation Type"::"Sales Tax") OR
           (("VAT Calculation Type" IN
             ["VAT Calculation Type"::"Normal VAT","VAT Calculation Type"::"Reverse Charge VAT"]) AND ("VAT %" <> 0))
        THEN
          IF NOT SalesLine2.ISEMPTY THEN BEGIN
            SalesLine2.CALCSUMS("Line Amount","Inv. Discount Amount",Amount,"Amount Including VAT","Quantity (Base)");
            TotalLineAmount := SalesLine2."Line Amount";
            TotalInvDiscAmount := SalesLine2."Inv. Discount Amount";
            TotalAmount := SalesLine2.Amount;
            TotalAmountInclVAT := SalesLine2."Amount Including VAT";
            TotalQuantityBase := SalesLine2."Quantity (Base)";
            OnAfterUpdateTotalAmounts(Rec,SalesLine2,TotalAmount,TotalAmountInclVAT,TotalLineAmount,TotalInvDiscAmount);
          END;

        IF SalesHeader."Prices Including VAT" THEN
          CASE "VAT Calculation Type" OF
            "VAT Calculation Type"::"Normal VAT",
            "VAT Calculation Type"::"Reverse Charge VAT":
              BEGIN
                Amount :=
                  ROUND(
                    (TotalLineAmount - TotalInvDiscAmount + CalcLineAmount) / (1 + "VAT %" / 100),
                    Currency."Amount Rounding Precision") -
                  TotalAmount;
                "VAT Base Amount" :=
                  ROUND(
                    Amount * (1 - SalesHeader."VAT Base Discount %" / 100),
                    Currency."Amount Rounding Precision");
                "Amount Including VAT" :=
                  TotalLineAmount + "Line Amount" -
                  ROUND(
                    (TotalAmount + Amount) * (SalesHeader."VAT Base Discount %" / 100) * "VAT %" / 100,
                    Currency."Amount Rounding Precision",Currency.VATRoundingDirection) -
                  TotalAmountInclVAT - TotalInvDiscAmount - "Inv. Discount Amount";
              END;
            "VAT Calculation Type"::"Full VAT":
              BEGIN
                Amount := 0;
                "VAT Base Amount" := 0;
              END;
            "VAT Calculation Type"::"Sales Tax":
              BEGIN
                SalesHeader.TESTFIELD("VAT Base Discount %",0);
                Amount :=
                  SalesTaxCalculate.ReverseCalculateTax(
                    "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                    TotalAmountInclVAT + "Amount Including VAT",TotalQuantityBase + "Quantity (Base)",
                    SalesHeader."Currency Factor") -
                  TotalAmount;
                OnAfterSalesTaxCalculateReverse(Rec,SalesHeader,Currency);
                UpdateVATPercent(Amount,"Amount Including VAT" - Amount);
                Amount := ROUND(Amount,Currency."Amount Rounding Precision");
                "VAT Base Amount" := Amount;
              END;
          END
        ELSE
          CASE "VAT Calculation Type" OF
            "VAT Calculation Type"::"Normal VAT",
            "VAT Calculation Type"::"Reverse Charge VAT":
              BEGIN
                Amount := ROUND(CalcLineAmount,Currency."Amount Rounding Precision");
                "VAT Base Amount" :=
                  ROUND(Amount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                "Amount Including VAT" :=
                  TotalAmount + Amount +
                  ROUND(
                    (TotalAmount + Amount) * (1 - SalesHeader."VAT Base Discount %" / 100) * "VAT %" / 100,
                    Currency."Amount Rounding Precision",Currency.VATRoundingDirection) -
                  TotalAmountInclVAT;
              END;
            "VAT Calculation Type"::"Full VAT":
              BEGIN
                Amount := 0;
                "VAT Base Amount" := 0;
                "Amount Including VAT" := CalcLineAmount;
              END;
            "VAT Calculation Type"::"Sales Tax":
              BEGIN
                Amount := ROUND(CalcLineAmount,Currency."Amount Rounding Precision");
                "VAT Base Amount" := Amount;
                "Amount Including VAT" :=
                  TotalAmount + Amount +
                  ROUND(
                    SalesTaxCalculate.CalculateTax(
                      "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                      TotalAmount + Amount,TotalQuantityBase + "Quantity (Base)",
                      SalesHeader."Currency Factor"),Currency."Amount Rounding Precision") -
                  TotalAmountInclVAT;
                OnAfterSalesTaxCalculate(Rec,SalesHeader,Currency);
                UpdateVATPercent("VAT Base Amount","Amount Including VAT" - "VAT Base Amount");
              END;
          END;
      END;
      END; //**4PS.n

      OnAfterUpdateVATAmounts(Rec);
    END;

    [External]
    PROCEDURE CheckItemAvailable@4(CalledByFieldNo@1000 : Integer);
    VAR
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCheckItemAvailable(Rec,CalledByFieldNo,IsHandled,CurrFieldNo);
      IF IsHandled THEN
        EXIT;

      IF Reserve = Reserve::Always THEN
        EXIT;

      IF "Shipment Date" = 0D THEN BEGIN
        GetSalesHeader;
        IF SalesHeader."Shipment Date" <> 0D THEN
          VALIDATE("Shipment Date",SalesHeader."Shipment Date")
        ELSE
          VALIDATE("Shipment Date",WORKDATE);
      END;

      IF ((CalledByFieldNo = CurrFieldNo) OR (CalledByFieldNo = FIELDNO("Shipment Date"))) AND GUIALLOWED AND
         ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
         (Type = Type::Item) AND ("No." <> '') AND
         ("Outstanding Quantity" > 0) AND
         ("Job Contract Entry No." = 0) AND
         NOT "Special Order"
      THEN BEGIN
      //**4PS.so
      //IF ItemCheckAvail.SalesLineCheck(Rec) THEN
      //  ItemCheckAvail.RaiseUpdateInterruptedError;
      //**4PS.eo
      //**4PS.sn
        SalesLine2 := Rec;
        GetSalesHeader;
        IF SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated" THEN BEGIN
          SalesLine2."Location Code" := SalesHeader."Location Code Logistics";
          ItemCheckAvail.SetCompany(GetCompanyLogistics);
        END ELSE
          ItemCheckAvail.SetCompany('');
        IF ItemCheckAvail.SalesLineCheck(SalesLine2) THEN
          ItemCheckAvail.RaiseUpdateInterruptedError;
      END;
      //**4PS.en
    END;

    LOCAL PROCEDURE CheckCreditLimit@204();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      IF (CurrFieldNo <> 0) AND
         NOT ((Type = Type::Item) AND (CurrFieldNo = FIELDNO("No.")) AND (Quantity <> 0) AND
              ("Qty. per Unit of Measure" <> xRec."Qty. per Unit of Measure")) AND
         CheckCreditLimitCondition AND
         (("Outstanding Amount" + "Shipped Not Invoiced") > 0) AND
         (CurrFieldNo <> FIELDNO("Blanket Order No.")) AND
         (CurrFieldNo <> FIELDNO("Blanket Order Line No."))
      THEN BEGIN
        IsHandled := FALSE;
        OnUpdateAmountOnBeforeCheckCreditLimit(Rec,IsHandled);
        IF NOT IsHandled THEN
          CustCheckCreditLimit.SalesLineCheck(Rec);
      END;
    END;

    LOCAL PROCEDURE CheckCreditLimitCondition@186() : Boolean;
    VAR
      RunCheck@1000 : Boolean;
    BEGIN
      RunCheck := "Document Type" <= "Document Type"::Invoice;
      OnAfterCheckCreditLimitCondition(Rec,RunCheck);
      EXIT(RunCheck);
    END;

    [External]
    PROCEDURE ShowReservation@10();
    VAR
      Reservation@1000 : Page 498;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeShowReservation(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      TESTFIELD(Reserve);
      CLEAR(Reservation);
      Reservation.SetSalesLine(Rec);
      Reservation.RUNMODAL;
      UpdatePlanned;
    END;

    [External]
    PROCEDURE ShowReservationEntries@21(Modal@1000 : Boolean);
    VAR
      ReservEntry@1001 : Record 337;
      ReservEngineMgt@1002 : Codeunit 99000831;
      IsHandled@1003 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeShowReservationEntries(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      ReservEngineMgt.InitFilterAndSortingLookupFor(ReservEntry,TRUE);
      ReserveSalesLine.FilterReservFor(ReservEntry,Rec);
      IF Modal THEN
        PAGE.RUNMODAL(PAGE::"Reservation Entries",ReservEntry)
      ELSE
        PAGE.RUN(PAGE::"Reservation Entries",ReservEntry);
    END;

    [External]
    PROCEDURE AutoReserve@11();
    VAR
      SalesSetup@1003 : Record 311;
      ReservMgt@1002 : Codeunit 99000845;
      ConfirmManagement@1004 : Codeunit 27;
      QtyToReserve@1000 : Decimal;
      QtyToReserveBase@1001 : Decimal;
      IsHandled@1005 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeAutoReserve(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");

      ReserveSalesLine.ReservQuantity(Rec,QtyToReserve,QtyToReserveBase);
      IF QtyToReserveBase <> 0 THEN BEGIN
        ReservMgt.SetSalesLine(Rec);
        TESTFIELD("Shipment Date");
        ReservMgt.AutoReserve(FullAutoReservation,'',"Shipment Date",QtyToReserve,QtyToReserveBase);
        FIND;
        SalesSetup.GET;
        IF (NOT FullAutoReservation) AND (NOT SalesSetup."Skip Manual Reservation") THEN BEGIN
          COMMIT;
          IF ConfirmManagement.ConfirmProcessUI(ManualReserveQst,TRUE) THEN BEGIN
            ShowReservation;
            FIND;
          END;
        END;
      END;

      OnAfterAutoReserve(Rec);
    END;

    [External]
    PROCEDURE AutoAsmToOrder@82();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeAutoAsmToOrder(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      ATOLink.UpdateAsmFromSalesLine(Rec);

      OnAfterAutoAsmToOrder(Rec);
    END;

    LOCAL PROCEDURE GetDate@22() : Date;
    BEGIN
      GetSalesHeader;
      IF SalesHeader."Posting Date" <> 0D THEN
        EXIT(SalesHeader."Posting Date");
      EXIT(WORKDATE);
    END;

    [External]
    PROCEDURE CalcPlannedDeliveryDate@92(CurrFieldNo@1000 : Integer) PlannedDeliveryDate : Date;
    VAR
      OrgDateExpression@1100525000 : Text[30];
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      PlannedDeliveryDate := "Planned Delivery Date";
      OnBeforeCalcPlannedDeliveryDate(Rec,PlannedDeliveryDate,CurrFieldNo,IsHandled);
      IF IsHandled THEN
        EXIT(PlannedDeliveryDate);

      IF "Shipment Date" = 0D THEN
        EXIT("Planned Delivery Date");

      //**4PS.sn
      IF CheckQuantityInventory THEN
        OrgDateExpression := FORMAT("Outbound Whse. Handling Time")
      ELSE
        OrgDateExpression := FORMAT("Shipping Time");
      //**4PS.en

      CASE CurrFieldNo OF
        FIELDNO("Shipment Date"):
          EXIT(CalendarMgmt.CalcDateBOC(
            //FORMAT("Shipping Time"), //**4PS.o
              OrgDateExpression, //**4PS.n
              "Planned Shipment Date",
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              CalChange."Source Type"::Customer,
              "Sell-to Customer No.",
              '',
              TRUE));
        FIELDNO("Planned Delivery Date"):
          EXIT(CalendarMgmt.CalcDateBOC2(
            //FORMAT("Shipping Time"), //**4PS.o
              OrgDateExpression, //**4PS.n
              "Planned Delivery Date",
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              CalChange."Source Type"::Location,
              "Location Code",
              '',
              TRUE));
      END;
    END;

    [External]
    PROCEDURE CalcPlannedShptDate@93(CurrFieldNo@1000 : Integer) PlannedShipmentDate : Date;
    VAR
      IsHandled@1001 : Boolean;
    BEGIN
      OnBeforeCalcPlannedShptDate(Rec,PlannedShipmentDate,CurrFieldNo,IsHandled);
      IF IsHandled THEN
        EXIT(PlannedShipmentDate);

      IF "Shipment Date" = 0D THEN
        EXIT("Planned Shipment Date");

      CASE CurrFieldNo OF
        FIELDNO("Shipment Date"):
          EXIT(CalendarMgmt.CalcDateBOC(
              FORMAT("Outbound Whse. Handling Time"),
              "Shipment Date",
              CalChange."Source Type"::Location,
              "Location Code",
              '',
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              TRUE));
        FIELDNO("Planned Delivery Date"):
          EXIT(CalendarMgmt.CalcDateBOC(
              FORMAT(''),
              "Planned Delivery Date",
              CalChange."Source Type"::Customer,
              "Sell-to Customer No.",
              '',
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              TRUE));
      END;
    END;

    [External]
    PROCEDURE CalcShipmentDate@111() : Date;
    VAR
      ShipmentDate@1000 : Date;
      IsHandled@1001 : Boolean;
    BEGIN
      IF "Planned Shipment Date" = 0D THEN
        EXIT("Shipment Date");

      IsHandled := FALSE;
      OnCalcShipmentDateOnPlannedShipmentDate(Rec,ShipmentDate,IsHandled);
      IF IsHandled THEN
        EXIT(ShipmentDate);

      IF FORMAT("Outbound Whse. Handling Time") <> '' THEN
        EXIT(
          CalendarMgmt.CalcDateBOC2(
            FORMAT("Outbound Whse. Handling Time"),
            "Planned Shipment Date",
            CalChange."Source Type"::Location,
            "Location Code",
            '',
            CalChange."Source Type"::"Shipping Agent",
            "Shipping Agent Code",
            "Shipping Agent Service Code",
            FALSE));

      EXIT(
        CalendarMgmt.CalcDateBOC(
          FORMAT(FORMAT('')),
          "Planned Shipment Date",
          CalChange."Source Type"::"Shipping Agent",
          "Shipping Agent Code",
          "Shipping Agent Service Code",
          CalChange."Source Type"::Location,
          "Location Code",
          '',
          FALSE));
    END;

    [External]
    PROCEDURE SignedXX@20(Value@1000 : Decimal) : Decimal;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Quote,
        "Document Type"::Order,
        "Document Type"::Invoice,
        "Document Type"::"Blanket Order":
          EXIT(-Value);
        "Document Type"::"Return Order",
        "Document Type"::"Credit Memo":
          EXIT(Value);
      END;
    END;

    LOCAL PROCEDURE BlanketOrderLookup@23();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeBlanketOrderLookup(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      SalesLine2.RESET;
      SalesLine2.SETCURRENTKEY("Document Type",Type,"No.");
      SalesLine2.SETRANGE("Document Type","Document Type"::"Blanket Order");
      SalesLine2.SETRANGE(Type,Type);
      SalesLine2.SETRANGE("No.","No.");
      SalesLine2.SETRANGE("Bill-to Customer No.","Bill-to Customer No.");
      SalesLine2.SETRANGE("Sell-to Customer No.","Sell-to Customer No.");
      IF PAGE.RUNMODAL(PAGE::"Sales Lines",SalesLine2) = ACTION::LookupOK THEN BEGIN
        SalesLine2.TESTFIELD("Document Type","Document Type"::"Blanket Order");
        "Blanket Order No." := SalesLine2."Document No.";
        VALIDATE("Blanket Order Line No.",SalesLine2."Line No.");
      END;

      OnAfterBlanketOrderLookup(Rec);
    END;

    [External]
    PROCEDURE ShowDimensions@25() IsChanged : Boolean;
    VAR
      OldDimSetID@1000 : Integer;
    BEGIN
      OldDimSetID := "Dimension Set ID";
      DimMgt.SetTableID(DATABASE::"Sales Line"); //**4PS.n
      "Dimension Set ID" :=
        DimMgt.EditDimensionSet("Dimension Set ID",STRSUBSTNO('%1 %2 %3',"Document Type","Document No.","Line No."));
      VerifyItemLineDim;
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
      ATOLink.UpdateAsmDimFromSalesLine(Rec);
      IsChanged := OldDimSetID <> "Dimension Set ID";
    END;

    [External]
    PROCEDURE OpenItemTrackingLines@6500();
    VAR
      Job@1000 : Record 11072003;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeOpenItemTrackingLines(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      //**4PS.sn
      IF "Cost Plus Line No." <> 0 THEN
        ERROR(Text11012008);

      IF Type = Type::"G/L Account" THEN
        TESTFIELD("Item No.")
      ELSE BEGIN
      //**4PS.en
        TESTFIELD(Type,Type::Item);
        TESTFIELD("No.");
      END; //**4PS.n
      TESTFIELD("Quantity (Base)");
      IF "Job Contract Entry No." <> 0 THEN
        ERROR(Text048,TABLECAPTION,Job.TABLECAPTION);
      ReserveSalesLine.CallItemTracking(Rec);
    END;

    [External]
    PROCEDURE CreateDim@26(Type1@1000 : Integer;No1@1001 : Code[20];Type2@1002 : Integer;No2@1003 : Code[20];Type3@1004 : Integer;No3@1005 : Code[20];Type4@1100485001 : Integer;No4@1100485000 : Code[20];Type5@1100525001 : Integer;No5@1100525000 : Code[20];Type6@1100525003 : Integer;No6@1100525002 : Code[20];Type7@1100528600 : Integer;No7@1100528601 : Code[20]);
    VAR
      SourceCodeSetup@1006 : Record 242;
      TableID@1007 : ARRAY [10] OF Integer;
      No@1008 : ARRAY [10] OF Code[20];
      Dim1@1100409001 : Code[20];
      Dim2@1100409000 : Code[20];
    BEGIN
      SourceCodeSetup.GET;
      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;

      //**4PS.sn
      TableID[4] := Type4;
      No[4] := No4;
      TableID[5] := Type5;  //** 4PS.n 09-06-2010 sn
      No[5] := No5;
      TableID[6] := Type6;
      No[6] := No6;         //** 4PS.n 09-0609-06-2010 en
      TableID[7] := Type7;
      No[7] := No7;
      //**4PS.en

      OnAfterCreateDimTableIDs(Rec,CurrFieldNo,TableID,No);

      //**4PS.sn
      Dim1 := "Shortcut Dimension 1 Code";
      Dim2 := "Shortcut Dimension 2 Code";
      DimMgt.SetSkipDepartmentAuthorization("Plant Invoice");
      //**4PS.en

      //"Shortcut Dimension 1 Code" := ''; //**4PS.o Must be kept for Department Authorization
      "Shortcut Dimension 2 Code" := '';
      GetSalesHeader;
      "Dimension Set ID" :=
        DimMgt.GetRecDefaultDimID(
          Rec,CurrFieldNo,TableID,No,SourceCodeSetup.Sales,
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",SalesHeader."Dimension Set ID",DATABASE::Customer);
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
      ATOLink.UpdateAsmDimFromSalesLine(Rec);

      //**4PS.sn
      DimMgt.SetSkipDepartmentAuthorization(FALSE);
      IF (Dim1 <> '') AND ("Shortcut Dimension 1 Code" = '') THEN BEGIN
        "Shortcut Dimension 1 Code" := Dim1;
        ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
      END;

      IF (Dim2 <> '') AND
         (("Shortcut Dimension 2 Code" = '') OR
          (CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")))
      THEN BEGIN
        "Shortcut Dimension 2 Code" := Dim2;
        ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
      END;
      IF ("Shortcut Dimension 2 Code" <> Dim2) AND ("Shortcut Dimension 2 Code" <> '') THEN
        VALIDATE("Shortcut Dimension 2 Code");
      //**4PS.en
    END;

    [External]
    PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      //**4PS.sn
      IF (FieldNumber = 1) AND (NOT "Plant Invoice") THEN
        DimMgt.CheckDepartmentAuthorization(DATABASE::"Sales Line", ShortcutDimCode);
      //**4PS.en
      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");
      VerifyItemLineDim;
    END;

    [External]
    PROCEDURE LookupShortcutDimCode@28(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      DimMgt.LookupDimValueCode(FieldNumber,ShortcutDimCode);
      ValidateShortcutDimCode(FieldNumber,ShortcutDimCode);
    END;

    [External]
    PROCEDURE ShowShortcutDimCode@27(VAR ShortcutDimCode@1000 : ARRAY [8] OF Code[20]);
    BEGIN
      DimMgt.GetShortcutDimensions("Dimension Set ID",ShortcutDimCode);
    END;

    [External]
    PROCEDURE SelectMultipleItems@180();
    VAR
      ItemListPage@1000 : Page 31;
      SelectionFilter@1001 : Text;
    BEGIN
      IF IsCreditDocType THEN
        SelectionFilter := ItemListPage.SelectActiveItems
      ELSE
        SelectionFilter := ItemListPage.SelectActiveItemsForSale;
      IF SelectionFilter <> '' THEN
        AddItems(SelectionFilter);
    END;

    LOCAL PROCEDURE AddItems@181(SelectionFilter@1000 : Text);
    VAR
      Item@1001 : Record 27;
      SalesLine@1002 : Record 37;
      LastSalesLine@1003 : Record 37;
    BEGIN
      OnBeforeAddItems(Rec);

      SalesHeader.GET("Document Type","Document No.");  //**4PS

      InitNewLine(SalesLine);
      Item.SETFILTER("No.",SelectionFilter);
      IF Item.FINDSET THEN
        REPEAT
          SalesLine.INIT;
          SalesLine."Line No." += 10000;
          //**4PS.sn
          IF (SalesHeader."Job No." <> '') OR (SalesHeader."Service Order No." <> '') THEN BEGIN
            SalesLine.VALIDATE(Type,Type::"G/L Account");
            IF (SalesHeader."Job No." <> '') THEN
              SalesLine.VALIDATE("Job No.", SalesHeader."Job No.");
            IF (SalesHeader."Service Order No." <> '') THEN
              SalesLine.VALIDATE("Service Order No.", SalesHeader."Service Order No.");
            SalesLine.VALIDATE("Item No.",Item."No.");
          END ELSE BEGIN
            SalesLine.VALIDATE(Type,Type::Item);
            SalesLine.VALIDATE("No.",Item."No.");
          END;
          //**4PS.en
          SalesLine.INSERT(TRUE);
          IF TransferExtendedText.SalesCheckIfAnyExtText(SalesLine,FALSE) THEN BEGIN
            TransferExtendedText.InsertSalesExtTextRetLast(SalesLine,LastSalesLine);
            SalesLine."Line No." := LastSalesLine."Line No."
          END;
          OnAfterAddItem(SalesLine,LastSalesLine);
        UNTIL Item.NEXT = 0;
    END;

    LOCAL PROCEDURE InitNewLine@183(VAR NewSalesLine@1001 : Record 37);
    VAR
      SalesLine@1000 : Record 37;
    BEGIN
      NewSalesLine.COPY(Rec);
      SalesLine.SETRANGE("Document Type",NewSalesLine."Document Type");
      SalesLine.SETRANGE("Document No.",NewSalesLine."Document No.");
      IF SalesLine.FINDLAST THEN
        NewSalesLine."Line No." := SalesLine."Line No."
      ELSE
        NewSalesLine."Line No." := 0;
    END;

    [Internal]
    PROCEDURE ShowItemSub@30();
    VAR
      IsHandled@1000 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeShowItemSub(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      CLEAR(SalesHeader);
      TestStatusOpen;
      ItemSubstitutionMgt.ItemSubstGet(Rec);
      IF TransferExtendedText.SalesCheckIfAnyExtText(Rec,TRUE) THEN
        TransferExtendedText.InsertSalesExtText(Rec);

      OnAfterShowItemSub(Rec);
    END;

    [External]
    PROCEDURE ShowNonstock@32();
    BEGIN
      TESTFIELD(Type,Type::Item);
      IF "No." <> '' THEN
        ERROR(SelectNonstockItemErr);
      IF PAGE.RUNMODAL(PAGE::"Catalog Item List",NonstockItem) = ACTION::LookupOK THEN BEGIN
        NonstockItem.TESTFIELD("Item Template Code");
        ConfigTemplateHeader.SETRANGE(Code,NonstockItem."Item Template Code");
        ConfigTemplateHeader.FINDFIRST;
        TempItemTemplate.InitializeTempRecordFromConfigTemplate(TempItemTemplate,ConfigTemplateHeader);
        TempItemTemplate.TESTFIELD("Gen. Prod. Posting Group");
        TempItemTemplate.TESTFIELD("Inventory Posting Group");

        "No." := NonstockItem."Entry No.";
        CatalogItemMgt.NonStockSales(Rec);
        VALIDATE("No.","No.");
        VALIDATE("Unit Price",NonstockItem."Unit Price");

        OnAfterShowNonStock(Rec,NonstockItem);
      END;
    END;

    LOCAL PROCEDURE GetSalesSetup@100();
    BEGIN
      IF NOT SalesSetupRead THEN
        SalesSetup.GET;
      SalesSetupRead := TRUE;
    END;

    LOCAL PROCEDURE GetFAPostingGroup@6();
    VAR
      LocalGLAcc@1000 : Record 15;
      FASetup@1001 : Record 5603;
      FAPostingGr@1002 : Record 5606;
      FADeprBook@1003 : Record 5612;
      FixedAsset@1100525000 : Record 5600;
    BEGIN
      IF (Type <> Type::"Fixed Asset") OR ("No." = '') THEN
        EXIT;
      //**4PS.sn
      IF "Depreciation Book Code" = '' THEN
        "Depreciation Book Code" := FixedAsset.GetFA_MainDeprBook("No.",TRUE);
      //**4PS.en
      IF "Depreciation Book Code" = '' THEN BEGIN
        FASetup.GET;
        "Depreciation Book Code" := FASetup."Default Depr. Book";
        IF NOT FADeprBook.GET("No.","Depreciation Book Code") THEN
          "Depreciation Book Code" := '';
        IF "Depreciation Book Code" = '' THEN
          EXIT;
      END;
      FADeprBook.GET("No.","Depreciation Book Code");
      FADeprBook.TESTFIELD("FA Posting Group");
      FAPostingGr.GET(FADeprBook."FA Posting Group");
      LocalGLAcc.GET(FAPostingGr.GetAcquisitionCostAccountOnDisposal);
      LocalGLAcc.CheckGLAcc;
      LocalGLAcc.TESTFIELD("Gen. Prod. Posting Group");
      "Posting Group" := FADeprBook."FA Posting Group";
      "Gen. Prod. Posting Group" := LocalGLAcc."Gen. Prod. Posting Group";
      "Tax Group Code" := LocalGLAcc."Tax Group Code";
      VALIDATE("VAT Prod. Posting Group",LocalGLAcc."VAT Prod. Posting Group");
    END;

    [External]
    PROCEDURE GetCaptionClass@34(FieldNumber@1000 : Integer) : Text[80];
    VAR
      SalesLineCaptionClassMgmt@1001 : Codeunit 345;
    BEGIN
      EXIT(SalesLineCaptionClassMgmt.GetSalesLineCaptionClass(Rec,FieldNumber));
    END;

    LOCAL PROCEDURE GetSKU@5806() : Boolean;
    BEGIN
      IF (SKU."Location Code" = "Location Code") AND
         (SKU."Item No." = "No.") AND
         (SKU."Variant Code" = "Variant Code")
      THEN
        EXIT(TRUE);
      IF SKU.GET("Location Code","No.","Variant Code") THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    [External]
    PROCEDURE GetUnitCost@5808();
    VAR
      Item@1000 : Record 27;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeGetUnitCost(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      //**4PS.so
      //TESTFIELD(Type,Type::Item);
      //TESTFIELD("No.");
      //**4PS.eo

      GetItem(Item);
      "Qty. per Unit of Measure" := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Unit of Measure Code");
      IF GetSKU THEN
        VALIDATE("Unit Cost (LCY)",SKU."Unit Cost" * "Qty. per Unit of Measure")
      ELSE
        VALIDATE("Unit Cost (LCY)",Item."Unit Cost" * "Qty. per Unit of Measure");

      OnAfterGetUnitCost(Rec,Item);
    END;

    LOCAL PROCEDURE CalcUnitCost@5809(ItemLedgEntry@1000 : Record 32) : Decimal;
    VAR
      ValueEntry@1001 : Record 5802;
      UnitCost@1004 : Decimal;
    BEGIN
      WITH ValueEntry DO BEGIN
        SETCURRENTKEY("Item Ledger Entry No.");
        SETRANGE("Item Ledger Entry No.",ItemLedgEntry."Entry No.");
        IF IsNonInventoriableItem THEN BEGIN
          CALCSUMS("Cost Amount (Non-Invtbl.)");
          UnitCost := "Cost Amount (Non-Invtbl.)" / ItemLedgEntry.Quantity;
        END ELSE BEGIN
          CALCSUMS("Cost Amount (Actual)","Cost Amount (Expected)");
          UnitCost :=
            ("Cost Amount (Expected)" + "Cost Amount (Actual)") / ItemLedgEntry.Quantity;
        END;
      END;

      EXIT(ABS(UnitCost * "Qty. per Unit of Measure"));
    END;

    [External]
    PROCEDURE ShowItemChargeAssgnt@5801();
    VAR
      ItemChargeAssgntSales@1003 : Record 5809;
      AssignItemChargeSales@1001 : Codeunit 5807;
      ItemChargeAssgnts@1000 : Page 5814;
      ItemChargeAssgntLineAmt@1002 : Decimal;
      IsHandled@1004 : Boolean;
    BEGIN
      GET("Document Type","Document No.","Line No.");
      TESTFIELD("No.");
      TESTFIELD(Quantity);

      IF Type <> Type::"Charge (Item)" THEN
        ERROR(ItemChargeAssignmentErr);

      GetSalesHeader;
      Currency.Initialize(SalesHeader."Currency Code");
      IF ("Inv. Discount Amount" = 0) AND ("Line Discount Amount" = 0) AND
         (NOT SalesHeader."Prices Including VAT")
      THEN
        ItemChargeAssgntLineAmt := "Line Amount"
      ELSE
        IF SalesHeader."Prices Including VAT" THEN
          ItemChargeAssgntLineAmt :=
            ROUND(CalcLineAmount / (1 + "VAT %" / 100),Currency."Amount Rounding Precision")
        ELSE
          ItemChargeAssgntLineAmt := CalcLineAmount;

      ItemChargeAssgntSales.RESET;
      ItemChargeAssgntSales.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Document No.","Document No.");
      ItemChargeAssgntSales.SETRANGE("Document Line No.","Line No.");
      ItemChargeAssgntSales.SETRANGE("Item Charge No.","No.");
      IF NOT ItemChargeAssgntSales.FINDLAST THEN BEGIN
        ItemChargeAssgntSales."Document Type" := "Document Type";
        ItemChargeAssgntSales."Document No." := "Document No.";
        ItemChargeAssgntSales."Document Line No." := "Line No.";
        ItemChargeAssgntSales."Item Charge No." := "No.";
        ItemChargeAssgntSales."Unit Cost" :=
          ROUND(ItemChargeAssgntLineAmt / Quantity,Currency."Unit-Amount Rounding Precision");
      END;

      IsHandled := FALSE;
      OnShowItemChargeAssgntOnBeforeCalcItemCharge(Rec,ItemChargeAssgntLineAmt,Currency,IsHandled);
      IF NOT IsHandled THEN
        ItemChargeAssgntLineAmt :=
          ROUND(ItemChargeAssgntLineAmt * ("Qty. to Invoice" / Quantity),Currency."Amount Rounding Precision");

      IF IsCreditDocType THEN
        AssignItemChargeSales.CreateDocChargeAssgn(ItemChargeAssgntSales,"Return Receipt No.")
      ELSE
        AssignItemChargeSales.CreateDocChargeAssgn(ItemChargeAssgntSales,"Shipment No.");
      CLEAR(AssignItemChargeSales);
      COMMIT;

      ItemChargeAssgnts.Initialize(Rec,ItemChargeAssgntLineAmt);
      ItemChargeAssgnts.RUNMODAL;
      CALCFIELDS("Qty. to Assign");
    END;

    [External]
    PROCEDURE UpdateItemChargeAssgnt@5807();
    VAR
      ItemChargeAssgntSales@1003 : Record 5809;
      ShareOfVAT@1000 : Decimal;
      TotalQtyToAssign@1001 : Decimal;
      TotalAmtToAssign@1002 : Decimal;
    BEGIN
      IF "Document Type" = "Document Type"::"Blanket Order" THEN
        EXIT;

      CALCFIELDS("Qty. Assigned","Qty. to Assign");
      IF ABS("Quantity Invoiced") > ABS(("Qty. Assigned" + "Qty. to Assign")) THEN
        ERROR(Text055,FIELDCAPTION("Quantity Invoiced"),FIELDCAPTION("Qty. Assigned"),FIELDCAPTION("Qty. to Assign"));

      ItemChargeAssgntSales.RESET;
      ItemChargeAssgntSales.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Document No.","Document No.");
      ItemChargeAssgntSales.SETRANGE("Document Line No.","Line No.");
      ItemChargeAssgntSales.CALCSUMS("Qty. to Assign");
      TotalQtyToAssign := ItemChargeAssgntSales."Qty. to Assign";
      IF (CurrFieldNo <> 0) AND (Amount <> xRec.Amount) AND
         NOT ((Quantity <> xRec.Quantity) AND (TotalQtyToAssign = 0))
      THEN BEGIN
        ItemChargeAssgntSales.SETFILTER("Qty. Assigned",'<>0');
        IF NOT ItemChargeAssgntSales.ISEMPTY THEN
          ERROR(Text026,
            FIELDCAPTION(Amount));
        ItemChargeAssgntSales.SETRANGE("Qty. Assigned");
      END;

      IF ItemChargeAssgntSales.FINDSET(TRUE) THEN BEGIN
        GetSalesHeader;
        TotalAmtToAssign := CalcTotalAmtToAssign(TotalQtyToAssign);
        REPEAT
          ShareOfVAT := 1;
          IF SalesHeader."Prices Including VAT" THEN
            ShareOfVAT := 1 + "VAT %" / 100;
          IF Quantity <> 0 THEN
            IF ItemChargeAssgntSales."Unit Cost" <>
               ROUND(CalcLineAmount / Quantity / ShareOfVAT,Currency."Unit-Amount Rounding Precision")
            THEN
              ItemChargeAssgntSales."Unit Cost" :=
                ROUND(CalcLineAmount / Quantity / ShareOfVAT,Currency."Unit-Amount Rounding Precision");
          IF TotalQtyToAssign <> 0 THEN BEGIN
            ItemChargeAssgntSales."Amount to Assign" :=
              ROUND(ItemChargeAssgntSales."Qty. to Assign" / TotalQtyToAssign * TotalAmtToAssign,
                Currency."Amount Rounding Precision");
            TotalQtyToAssign -= ItemChargeAssgntSales."Qty. to Assign";
            TotalAmtToAssign -= ItemChargeAssgntSales."Amount to Assign";
          END;
          ItemChargeAssgntSales.MODIFY;
        UNTIL ItemChargeAssgntSales.NEXT = 0;
        CALCFIELDS("Qty. to Assign");
      END;
    END;

    LOCAL PROCEDURE DeleteItemChargeAssgnt@5802(DocType@1000 : Option;DocNo@1001 : Code[20];DocLineNo@1002 : Integer);
    VAR
      ItemChargeAssgntSales@1003 : Record 5809;
    BEGIN
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Type",DocType);
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. No.",DocNo);
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Line No.",DocLineNo);
      IF NOT ItemChargeAssgntSales.ISEMPTY THEN
        ItemChargeAssgntSales.DELETEALL(TRUE);
    END;

    LOCAL PROCEDURE DeleteChargeChargeAssgnt@5804(DocType@1000 : Option;DocNo@1001 : Code[20];DocLineNo@1002 : Integer);
    VAR
      ItemChargeAssgntSales@1003 : Record 5809;
    BEGIN
      IF DocType <> "Document Type"::"Blanket Order" THEN
        IF "Quantity Invoiced" <> 0 THEN BEGIN
          CALCFIELDS("Qty. Assigned");
          TESTFIELD("Qty. Assigned","Quantity Invoiced");
        END;

      ItemChargeAssgntSales.RESET;
      ItemChargeAssgntSales.SETRANGE("Document Type",DocType);
      ItemChargeAssgntSales.SETRANGE("Document No.",DocNo);
      ItemChargeAssgntSales.SETRANGE("Document Line No.",DocLineNo);
      IF NOT ItemChargeAssgntSales.ISEMPTY THEN
        ItemChargeAssgntSales.DELETEALL;

      OnAfterDeleteChargeChargeAssgnt(Rec,xRec,CurrFieldNo);
    END;

    LOCAL PROCEDURE CheckItemChargeAssgnt@5800();
    VAR
      ItemChargeAssgntSales@1000 : Record 5809;
    BEGIN
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. No.","Document No.");
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Line No.","Line No.");
      ItemChargeAssgntSales.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Document No.","Document No.");
      IF ItemChargeAssgntSales.FINDSET THEN BEGIN
        TESTFIELD("Allow Item Charge Assignment");
        REPEAT
          ItemChargeAssgntSales.TESTFIELD("Qty. to Assign",0);
        UNTIL ItemChargeAssgntSales.NEXT = 0;
      END;
    END;

    [External]
    PROCEDURE TestStatusOpen@33();
    BEGIN
      IF StatusCheckSuspended THEN
        EXIT;

      GetSalesHeader;
      OnBeforeTestStatusOpen(Rec,SalesHeader);

      IF NOT "System-Created Entry" THEN
        IF HasTypeToFillMandatoryFields THEN
          SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);

      OnAfterTestStatusOpen(Rec,SalesHeader);
    END;

    [External]
    PROCEDURE SuspendStatusCheck@39(Suspend@1000 : Boolean);
    BEGIN
      StatusCheckSuspended := Suspend;
    END;

    [External]
    PROCEDURE UpdateVATOnLines@36(QtyType@1000 : 'General,Invoicing,Shipping';VAR SalesHeader@1001 : Record 36;VAR SalesLine@1002 : Record 37;VAR VATAmountLine@1003 : Record 290) LineWasModified : Boolean;
    VAR
      TempVATAmountLineRemainder@1004 : TEMPORARY Record 290;
      Currency@1005 : Record 4;
      NewAmount@1006 : Decimal;
      NewAmountIncludingVAT@1007 : Decimal;
      NewVATBaseAmount@1008 : Decimal;
      VATAmount@1009 : Decimal;
      VATDifference@1010 : Decimal;
      InvDiscAmount@1011 : Decimal;
      LineAmountToInvoice@1012 : Decimal;
      LineAmountToInvoiceDiscounted@1013 : Decimal;
      DeferralAmount@1014 : Decimal;
    BEGIN
      LineWasModified := FALSE;
      IF QtyType = QtyType::Shipping THEN
        EXIT;
      IF SalesHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(SalesHeader."Currency Code");

      TempVATAmountLineRemainder.DELETEALL;

      WITH SalesLine DO BEGIN
        SETRANGE("Document Type",SalesHeader."Document Type");
        SETRANGE("Document No.",SalesHeader."No.");
        LOCKTABLE;
        IF FINDSET THEN
          REPEAT
            //**4PS.so
            //IF NOT ZeroAmountLine(QtyType,) THEN BEGIN
            //  DeferralAmount := GetDeferralAmount;
            //  VATAmountLine.GET("VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"Line Amount" >= 0);
            //**4PS.eo
            //**4PS.sn
            IF NOT ZeroAmountLine(QtyType, SalesHeader, SalesLine) THEN BEGIN //Standard bugfix
              DeferralAmount := GetDeferralAmount;
              VATAmountLine.GET("VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,FALSE);
            //**4PS.en
              IF VATAmountLine.Modified THEN BEGIN
                IF NOT TempVATAmountLineRemainder.GET(
                //     "VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"Line Amount" >= 0) //**4PS.o
                     "VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,FALSE) //**4PS.n
                THEN BEGIN
                  TempVATAmountLineRemainder := VATAmountLine;
                  TempVATAmountLineRemainder.INIT;
                  TempVATAmountLineRemainder.INSERT;
                END;
                IF QtyType = QtyType::General THEN
                  LineAmountToInvoice := "Line Amount"
                ELSE
                  LineAmountToInvoice :=
                    ROUND("Line Amount" * "Qty. to Invoice" / Quantity,Currency."Amount Rounding Precision");

                IF "Allow Invoice Disc." THEN BEGIN
                  IF (VATAmountLine."Inv. Disc. Base Amount" = 0) OR (LineAmountToInvoice = 0) THEN
                    InvDiscAmount := 0
                  ELSE BEGIN
                    LineAmountToInvoiceDiscounted :=
                      VATAmountLine."Invoice Discount Amount" * LineAmountToInvoice /
                      VATAmountLine."Inv. Disc. Base Amount";
                    TempVATAmountLineRemainder."Invoice Discount Amount" :=
                      TempVATAmountLineRemainder."Invoice Discount Amount" + LineAmountToInvoiceDiscounted;
                    InvDiscAmount :=
                      ROUND(
                        TempVATAmountLineRemainder."Invoice Discount Amount",Currency."Amount Rounding Precision");
                    TempVATAmountLineRemainder."Invoice Discount Amount" :=
                      TempVATAmountLineRemainder."Invoice Discount Amount" - InvDiscAmount;
                  END;
                  IF QtyType = QtyType::General THEN BEGIN
                    "Inv. Discount Amount" := InvDiscAmount;
                    CalcInvDiscToInvoice;
                  END ELSE
                    "Inv. Disc. Amount to Invoice" := InvDiscAmount;
                END ELSE
                  InvDiscAmount := 0;

                IF QtyType = QtyType::General THEN
                  IF SalesHeader."Prices Including VAT" THEN BEGIN
                    IF (VATAmountLine.CalcLineAmount = 0) OR ("Line Amount" = 0) THEN BEGIN
                      VATAmount := 0;
                      NewAmountIncludingVAT := 0;
                    END ELSE BEGIN
                      VATAmount :=
                        TempVATAmountLineRemainder."VAT Amount" +
                        VATAmountLine."VAT Amount" * CalcLineAmount / VATAmountLine.CalcLineAmount;
                      NewAmountIncludingVAT :=
                        TempVATAmountLineRemainder."Amount Including VAT" +
                        VATAmountLine."Amount Including VAT" * CalcLineAmount / VATAmountLine.CalcLineAmount;
                    END;
                    OnUpdateVATOnLinesOnBeforeCalculateNewAmount(
                      Rec,SalesHeader,VATAmountLine,TempVATAmountLineRemainder,NewAmountIncludingVAT,VATAmount);
                    NewAmount :=
                      ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision") -
                      ROUND(VATAmount,Currency."Amount Rounding Precision");
                    NewVATBaseAmount :=
                      ROUND(
                        NewAmount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                  END ELSE BEGIN
                    IF "VAT Calculation Type" = "VAT Calculation Type"::"Full VAT" THEN BEGIN
                      VATAmount := CalcLineAmount;
                      NewAmount := 0;
                      NewVATBaseAmount := 0;
                    END ELSE BEGIN
                      NewAmount := CalcLineAmount;
                      NewVATBaseAmount :=
                        ROUND(
                          NewAmount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                      //**4PS.sn
                      IF "Manually VAT Posting" THEN
                        VATAmount := "Amount Including VAT" - "VAT Base Amount"
                      ELSE
                      //**4PS.en
                        IF VATAmountLine."VAT Base" = 0 THEN
                          VATAmount := 0
                        ELSE
                          VATAmount :=
                            TempVATAmountLineRemainder."VAT Amount" +
                            VATAmountLine."VAT Amount" * NewAmount / VATAmountLine."VAT Base";
                    END;
                    OnUpdateVATOnLinesOnBeforeCalculateNewAmount(
                      Rec,SalesHeader,VATAmountLine,TempVATAmountLineRemainder,NewAmount,VATAmount);
                    NewAmountIncludingVAT := NewAmount + ROUND(VATAmount,Currency."Amount Rounding Precision");
                  END
                ELSE BEGIN
                  IF VATAmountLine.CalcLineAmount = 0 THEN
                    VATDifference := 0
                  ELSE
                    VATDifference :=
                      TempVATAmountLineRemainder."VAT Difference" +
                      VATAmountLine."VAT Difference" * (LineAmountToInvoice - InvDiscAmount) / VATAmountLine.CalcLineAmount;
                  IF LineAmountToInvoice = 0 THEN
                    "VAT Difference" := 0
                  ELSE
                    "VAT Difference" := ROUND(VATDifference,Currency."Amount Rounding Precision");
                END;
                IF QtyType = QtyType::General THEN
                  UpdateBaseAmounts(NewAmount,ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision"),NewVATBaseAmount);
                InitOutstanding;
                IF Type = Type::"Charge (Item)" THEN
                  UpdateItemChargeAssgnt;
                MODIFY;
                LineWasModified := TRUE;

                IF ("Deferral Code" <> '') AND (DeferralAmount <> GetDeferralAmount) THEN
                  UpdateDeferralAmounts;

                TempVATAmountLineRemainder."Amount Including VAT" :=
                  NewAmountIncludingVAT - ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision");
                TempVATAmountLineRemainder."VAT Amount" := VATAmount - NewAmountIncludingVAT + NewAmount;
                TempVATAmountLineRemainder."VAT Difference" := VATDifference - "VAT Difference";
                TempVATAmountLineRemainder.MODIFY;
              END;
            END;
          UNTIL NEXT = 0;
      END;

      OnAfterUpdateVATOnLines(SalesHeader,SalesLine,VATAmountLine,QtyType);
    END;

    [External]
    PROCEDURE CalcVATAmountLines@35(QtyType@1000 : 'General,Invoicing,Shipping';VAR SalesHeader@1001 : Record 36;VAR SalesLine@1002 : Record 37;VAR VATAmountLine@1003 : Record 290);
    VAR
      TotalVATAmount@1011 : Decimal;
      QtyToHandle@1006 : Decimal;
      AmtToHandle@1015 : Decimal;
      RoundingLineInserted@1010 : Boolean;
    BEGIN
      IF IsCalcVATAmountLinesHandled(SalesHeader,SalesLine,VATAmountLine) THEN
        EXIT;

      Currency.Initialize(SalesHeader."Currency Code");

      VATAmountLine.DELETEALL;

      WITH SalesLine DO BEGIN
        SETRANGE("Document Type",SalesHeader."Document Type");
        SETRANGE("Document No.",SalesHeader."No.");
        IF FINDSET THEN
          REPEAT
            //IF NOT ZeroAmountLine(QtyType,) THEN BEGIN //**4PS.o
            IF NOT ZeroAmountLine(QtyType, SalesHeader, SalesLine) THEN BEGIN //**4PS.n Standard bugfix
              IF (Type = Type::"G/L Account") AND NOT "Prepayment Line" THEN
                RoundingLineInserted := ("No." = GetCPGInvRoundAcc(SalesHeader)) OR RoundingLineInserted;
              IF "VAT Calculation Type" IN
                 ["VAT Calculation Type"::"Reverse Charge VAT","VAT Calculation Type"::"Sales Tax"]
              THEN
                "VAT %" := 0;
              IF NOT VATAmountLine.GET(
                 //"VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"Line Amount" >= 0) //**4PS.o
                   "VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,FALSE) //**4PS.n

              THEN
                VATAmountLine.InsertNewLine(
                //"VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"VAT %","Line Amount" >= 0,FALSE); //**4PS.o
                  "VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"VAT %",FALSE,FALSE); //**4PS.n

              CASE QtyType OF
                QtyType::General:
                  BEGIN
                    VATAmountLine.Quantity += "Quantity (Base)";
                    VATAmountLine.SumLine(
                      "Line Amount","Inv. Discount Amount","VAT Difference","Allow Invoice Disc.","Prepayment Line");
                  END;
                QtyType::Invoicing:
                  BEGIN
                    CASE TRUE OF
                      ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
                      (NOT SalesHeader.Ship) AND SalesHeader.Invoice AND (NOT "Prepayment Line"):
                        IF "Shipment No." = '' THEN BEGIN
                          QtyToHandle := GetAbsMin("Qty. to Invoice","Qty. Shipped Not Invoiced");
                          VATAmountLine.Quantity += GetAbsMin("Qty. to Invoice (Base)","Qty. Shipped Not Invd. (Base)");
                        END ELSE BEGIN
                          QtyToHandle := "Qty. to Invoice";
                          VATAmountLine.Quantity += "Qty. to Invoice (Base)";
                        END;
                      IsCreditDocType AND (NOT SalesHeader.Receive) AND SalesHeader.Invoice
                      AND (SalesHeader."Sales Document Type"<>SalesHeader."Sales Document Type"::"Sales Logistics Separated"): //**4PS.n
                        IF "Return Receipt No." = '' THEN BEGIN
                          QtyToHandle := GetAbsMin("Qty. to Invoice","Return Qty. Rcd. Not Invd.");
                          VATAmountLine.Quantity += GetAbsMin("Qty. to Invoice (Base)","Ret. Qty. Rcd. Not Invd.(Base)");
                        END ELSE BEGIN
                          QtyToHandle := "Qty. to Invoice";
                          VATAmountLine.Quantity += "Qty. to Invoice (Base)";
                        END;
                      ELSE
                        BEGIN
                        QtyToHandle := "Qty. to Invoice";
                        VATAmountLine.Quantity += "Qty. to Invoice (Base)";
                      END;
                    END;
                    AmtToHandle := GetLineAmountToHandleInclPrepmt(QtyToHandle);
                    IF SalesHeader."Invoice Discount Calculation" <> SalesHeader."Invoice Discount Calculation"::Amount THEN
                      VATAmountLine.SumLine(
                        AmtToHandle,ROUND("Inv. Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision"),
                        "VAT Difference","Allow Invoice Disc.","Prepayment Line")
                    ELSE
                      VATAmountLine.SumLine(
                        AmtToHandle,"Inv. Disc. Amount to Invoice","VAT Difference","Allow Invoice Disc.","Prepayment Line");
                  END;
                QtyType::Shipping:
                  BEGIN
                    IF "Document Type" IN
                       ["Document Type"::"Return Order","Document Type"::"Credit Memo"]
                    THEN BEGIN
                      QtyToHandle := "Return Qty. to Receive";
                      VATAmountLine.Quantity += "Return Qty. to Receive (Base)";
                    END ELSE BEGIN
                      QtyToHandle := "Qty. to Ship";
                      VATAmountLine.Quantity += "Qty. to Ship (Base)";
                    END;
                    AmtToHandle := GetLineAmountToHandleInclPrepmt(QtyToHandle);
                    VATAmountLine.SumLine(
                      AmtToHandle,ROUND("Inv. Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision"),
                      "VAT Difference","Allow Invoice Disc.","Prepayment Line");
                  END;
              END;
              TotalVATAmount += "Amount Including VAT" - Amount;
              OnCalcVATAmountLinesOnAfterCalcLineTotals(VATAmountLine,SalesHeader,SalesLine,Currency,QtyType,TotalVATAmount);
            END;
          UNTIL NEXT = 0;
      END;

      VATAmountLine.UpdateLines(
        TotalVATAmount,Currency,SalesHeader."Currency Factor",SalesHeader."Prices Including VAT",
        SalesHeader."VAT Base Discount %",SalesHeader."Tax Area Code",SalesHeader."Tax Liable",SalesHeader."Posting Date");

      IF RoundingLineInserted AND (TotalVATAmount <> 0) THEN
        IF GetVATAmountLineOfMaxAmt(VATAmountLine,SalesLine) THEN BEGIN
          VATAmountLine."VAT Amount" += TotalVATAmount;
          VATAmountLine."Amount Including VAT" += TotalVATAmount;
          VATAmountLine."Calculated VAT Amount" += TotalVATAmount;
          VATAmountLine.MODIFY;
        END;

      OnAfterCalcVATAmountLines(SalesHeader,SalesLine,VATAmountLine,QtyType);
    END;

    [External]
    PROCEDURE GetCPGInvRoundAcc@71(VAR SalesHeader@1000 : Record 36) : Code[20];
    VAR
      Cust@1002 : Record 18;
      CustTemplate@1003 : Record 5105;
      CustPostingGroup@1004 : Record 92;
    BEGIN
      GetSalesSetup;
      IF SalesSetup."Invoice Rounding" THEN
        IF Cust.GET(SalesHeader."Bill-to Customer No.") THEN
          CustPostingGroup.GET(Cust."Customer Posting Group")
        ELSE
          IF CustTemplate.GET(SalesHeader."Sell-to Customer Template Code") THEN
            CustPostingGroup.GET(CustTemplate."Customer Posting Group");

      EXIT(CustPostingGroup."Invoice Rounding Account");
    END;

    LOCAL PROCEDURE GetVATAmountLineOfMaxAmt@231(VAR VATAmountLine@1001 : Record 290;SalesLine@1000 : Record 37) : Boolean;
    VAR
      VATAmount1@1002 : Decimal;
      VATAmount2@1003 : Decimal;
      IsPositive1@1004 : Boolean;
      IsPositive2@1005 : Boolean;
    BEGIN
      IF VATAmountLine.GET(SalesLine."VAT Identifier",SalesLine."VAT Calculation Type",SalesLine."Tax Group Code",FALSE,FALSE) THEN BEGIN
        VATAmount1 := VATAmountLine."VAT Amount";
        IsPositive1 := VATAmountLine.Positive;
      END;
      IF VATAmountLine.GET(SalesLine."VAT Identifier",SalesLine."VAT Calculation Type",SalesLine."Tax Group Code",FALSE,TRUE) THEN BEGIN
        VATAmount2 := VATAmountLine."VAT Amount";
        IsPositive2 := VATAmountLine.Positive;
      END;
      IF ABS(VATAmount1) >= ABS(VATAmount2) THEN
        EXIT(
          VATAmountLine.GET(SalesLine."VAT Identifier",SalesLine."VAT Calculation Type",SalesLine."Tax Group Code",FALSE,IsPositive1));
      EXIT(
        VATAmountLine.GET(SalesLine."VAT Identifier",SalesLine."VAT Calculation Type",SalesLine."Tax Group Code",FALSE,IsPositive2));
    END;

    LOCAL PROCEDURE CalcInvDiscToInvoice@37();
    VAR
      OldInvDiscAmtToInv@1000 : Decimal;
    BEGIN
      GetSalesHeader;
      OldInvDiscAmtToInv := "Inv. Disc. Amount to Invoice";
      IF Quantity = 0 THEN
        VALIDATE("Inv. Disc. Amount to Invoice",0)
      ELSE
        VALIDATE(
          "Inv. Disc. Amount to Invoice",
          ROUND(
            "Inv. Discount Amount" * "Qty. to Invoice" / Quantity,
            Currency."Amount Rounding Precision"));

      IF OldInvDiscAmtToInv <> "Inv. Disc. Amount to Invoice" THEN BEGIN
        "Amount Including VAT" := "Amount Including VAT" - "VAT Difference";
        "VAT Difference" := 0;
      END;
    END;

    [External]
    PROCEDURE UpdateWithWarehouseShip@41();
    BEGIN
      IF Type = Type::Item THEN
        CASE TRUE OF
          ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND (Quantity >= 0):
      //    IF Location.RequireShipment("Location Code") THEN //**4PS.o
            //**4PS.sn
            IF (Location.RequireShipment("Location Code")) OR
               (("Document Type" = "Document Type"::Order) AND NOT DirectDelivery)
            THEN
            //**4PS.en
              VALIDATE("Qty. to Ship",0)
            ELSE
              VALIDATE("Qty. to Ship","Outstanding Quantity");
          ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND (Quantity < 0):
      //    IF Location.RequireReceive("Location Code") THEN //**4PS.o
            //**4PS.sn
            IF (Location.RequireReceive("Location Code")) OR
               (("Document Type" = "Document Type"::Order) AND NOT DirectDelivery)
            THEN
            //**4PS.en
              VALIDATE("Qty. to Ship",0)
            ELSE
              VALIDATE("Qty. to Ship","Outstanding Quantity");
          ("Document Type" = "Document Type"::"Return Order") AND (Quantity >= 0):
            IF Location.RequireReceive("Location Code") THEN
              VALIDATE("Return Qty. to Receive",0)
            ELSE
              VALIDATE("Return Qty. to Receive","Outstanding Quantity");
          ("Document Type" = "Document Type"::"Return Order") AND (Quantity < 0):
            IF Location.RequireShipment("Location Code") THEN
              VALIDATE("Return Qty. to Receive",0)
            ELSE
              VALIDATE("Return Qty. to Receive","Outstanding Quantity");
        END;
      SetDefaultQuantity;
    END;

    LOCAL PROCEDURE CheckWarehouse@46();
    VAR
      Location2@1002 : Record 14;
      WhseSetup@1000 : Record 5769;
      ShowDialog@1001 : ' ,Message,Error';
      DialogText@1003 : Text[50];
    BEGIN
      GetLocation("Location Code");
      IF "Location Code" = '' THEN BEGIN
        WhseSetup.GET;
        Location2."Require Shipment" := WhseSetup."Require Shipment";
        Location2."Require Pick" := WhseSetup."Require Pick";
        Location2."Require Receive" := WhseSetup."Require Receive";
        Location2."Require Put-away" := WhseSetup."Require Put-away";
      END ELSE
        Location2 := Location;

      DialogText := Text035;
      IF ("Document Type" IN ["Document Type"::Order,"Document Type"::"Return Order"]) AND
         Location2."Directed Put-away and Pick"
      THEN BEGIN
        ShowDialog := ShowDialog::Error;
        IF (("Document Type" = "Document Type"::Order) AND (Quantity >= 0)) OR
           (("Document Type" = "Document Type"::"Return Order") AND (Quantity < 0))
        THEN
          DialogText :=
            DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Shipment"))
        ELSE
          DialogText :=
            DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Receive"));
      END ELSE BEGIN
        IF (("Document Type" = "Document Type"::Order) AND (Quantity >= 0) AND
            (Location2."Require Shipment" OR Location2."Require Pick")) OR
           (("Document Type" = "Document Type"::"Return Order") AND (Quantity < 0) AND
            (Location2."Require Shipment" OR Location2."Require Pick"))
        THEN BEGIN
          IF WhseValidateSourceLine.WhseLinesExist(
               DATABASE::"Sales Line",
               "Document Type",
               "Document No.",
               "Line No.",
               0,
               Quantity)
          THEN
            ShowDialog := ShowDialog::Error
          ELSE
            IF Location2."Require Shipment" THEN
              //ShowDialog := ShowDialog::Message; //**4PS.o
              ShowDialog := ShowDialog::Error; //**4PS.n
          IF Location2."Require Shipment" THEN
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Shipment"))
          ELSE BEGIN
            DialogText := Text036;
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Pick"));
          END;
        END;

        IF (("Document Type" = "Document Type"::Order) AND (Quantity < 0) AND
            (Location2."Require Receive" OR Location2."Require Put-away")) OR
           (("Document Type" = "Document Type"::"Return Order") AND (Quantity >= 0) AND
            (Location2."Require Receive" OR Location2."Require Put-away"))
        THEN BEGIN
          IF WhseValidateSourceLine.WhseLinesExist(
               DATABASE::"Sales Line",
               "Document Type",
               "Document No.",
               "Line No.",
               0,
               Quantity)
          THEN
            ShowDialog := ShowDialog::Error
          ELSE
            IF Location2."Require Receive" THEN
              ShowDialog := ShowDialog::Message;
          IF Location2."Require Receive" THEN
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Receive"))
          ELSE BEGIN
            DialogText := Text036;
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Put-away"));
          END;
        END;
      END;

      OnCheckWarehouseOnBeforeShowDialog(Rec,Location2,ShowDialog,DialogText);

      CASE ShowDialog OF
        ShowDialog::Message:
          MESSAGE(WhseRequirementMsg,DialogText);
        ShowDialog::Error:
          ERROR(Text016,DialogText,FIELDCAPTION("Line No."),"Line No.");
      END;

      HandleDedicatedBin(TRUE);
    END;

    LOCAL PROCEDURE UpdateDates@43();
    BEGIN
      IF CurrFieldNo = 0 THEN BEGIN
        PlannedShipmentDateCalculated := FALSE;
        PlannedDeliveryDateCalculated := FALSE;
        //**4PS.sn
        IF "Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"] THEN BEGIN
          "Shipment Date" := SalesHeader."Shipment Date";
          EXIT;
        END;
        //**4PS.en
      END;
      IF "Promised Delivery Date" <> 0D THEN
        VALIDATE("Promised Delivery Date")
      ELSE
        IF "Requested Delivery Date" <> 0D THEN
          VALIDATE("Requested Delivery Date")
        ELSE
          VALIDATE("Shipment Date");

      OnAfterUpdateDates(Rec);
    END;

    [External]
    PROCEDURE GetItemTranslation@42();
    VAR
      ItemTranslation@1000 : Record 30;
    BEGIN
      GetSalesHeader;

      //**4PS.sn
      IF "Item No." <> '' THEN BEGIN
        IF ItemTranslation.GET("Item No.","Variant Code",SalesHeader."Language Code") THEN BEGIN
          Description := ItemTranslation.Description;
          IF ItemTranslation."Description 2" <> '' THEN
            "Description 2" := ItemTranslation."Description 2";
          OnAfterGetItemTranslation(Rec,SalesHeader,ItemTranslation);
        END;
      END ELSE
      //**4PS.en
        IF ItemTranslation.GET("No.","Variant Code",SalesHeader."Language Code") THEN BEGIN
          Description := ItemTranslation.Description;
          IF ItemTranslation."Description 2" <> '' THEN //**4PS.n
            "Description 2" := ItemTranslation."Description 2";
          OnAfterGetItemTranslation(Rec,SalesHeader,ItemTranslation);
        END;

      OnAfterGetItemTranslation(Rec,SalesHeader,ItemTranslation);
    END;

    LOCAL PROCEDURE GetLocation@7300(LocationCode@1000 : Code[10]);
    BEGIN
      IF LocationCode = '' THEN
        CLEAR(Location)
      ELSE
        IF Location.Code <> LocationCode THEN
          Location.GET(LocationCode);
    END;

    [External]
    PROCEDURE PriceExists@44() : Boolean;
    BEGIN
      IF "Document No." <> '' THEN BEGIN
        GetSalesHeader;
        EXIT(PriceCalcMgt.SalesLinePriceExists(SalesHeader,Rec,TRUE));
      END;
      EXIT(FALSE);
    END;

    [External]
    PROCEDURE LineDiscExists@45() : Boolean;
    BEGIN
      IF "Document No." <> '' THEN BEGIN
        GetSalesHeader;
        EXIT(PriceCalcMgt.SalesLineLineDiscExists(SalesHeader,Rec,TRUE));
      END;
      EXIT(FALSE);
    END;

    [External]
    PROCEDURE RowID1@47() : Text[250];
    VAR
      ItemTrackingMgt@1000 : Codeunit 6500;
    BEGIN
      EXIT(ItemTrackingMgt.ComposeRowID(DATABASE::"Sales Line","Document Type",
          "Document No.",'',0,"Line No."));
    END;

    LOCAL PROCEDURE UpdateItemCrossRef@48();
    BEGIN
      DistIntegration.EnterSalesItemCrossRef(Rec);
      UpdateICPartner;

      OnAfterUpdateItemCrossRef(Rec);
    END;

    LOCAL PROCEDURE GetDefaultBin@50();
    VAR
      WMSManagement@1000 : Codeunit 7302;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeGetDefaultBin(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      //IF Type <> Type::Item THEN  //**4PS.o
      IF "Item No." = '' THEN  //**4PS.n
        EXIT;

      "Bin Code" := '';
      IF "Drop Shipment" THEN
        EXIT;

      //IF ("Location Code" <> '') AND ("No." <> '') THEN BEGIN  //**4PS.o
      IF ("Location Code" <> '') AND ("Item No." <> '') THEN BEGIN  //**4PS.n
        GetLocation("Location Code");
        IF Location."Bin Mandatory" AND NOT Location."Directed Put-away and Pick" THEN BEGIN
          IF ("Qty. to Assemble to Order" > 0) OR IsAsmToOrderRequired THEN
            IF GetATOBin(Location,"Bin Code") THEN
              EXIT;

          //WMSManagement.GetDefaultBin("No.","Variant Code","Location Code","Bin Code");  //**4PS.o
          //**4PS.sn
          "Bin Code" := WMSManagement.GetDefaultBinLocation(
            "Job No.","Service Order No.","Location Code","Item No.","Variant Code",TRUE);
          //**4PS.en
          HandleDedicatedBin(FALSE);
        END;
      END;
    END;

    [External]
    PROCEDURE GetATOBin@89(Location@1001 : Record 14;VAR BinCode@1002 : Code[20]) : Boolean;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF NOT Location."Require Shipment" THEN
        BinCode := Location."Asm.-to-Order Shpt. Bin Code";
      IF BinCode <> '' THEN
        EXIT(TRUE);

      IF AsmHeader.GetFromAssemblyBin(Location,BinCode) THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    [External]
    PROCEDURE IsInbound@97() : Boolean;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Order,"Document Type"::Invoice,"Document Type"::Quote,"Document Type"::"Blanket Order":
          EXIT("Quantity (Base)" < 0);
        "Document Type"::"Return Order","Document Type"::"Credit Memo":
          EXIT("Quantity (Base)" > 0);
      END;

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE HandleDedicatedBin@70(IssueWarning@1001 : Boolean);
    VAR
      WhseIntegrationMgt@1002 : Codeunit 7317;
    BEGIN
      IF NOT IsInbound AND ("Quantity (Base)" <> 0) THEN
        WhseIntegrationMgt.CheckIfBinDedicatedOnSrcDoc("Location Code","Bin Code",IssueWarning);
    END;

    [External]
    PROCEDURE CheckAssocPurchOrder@51(TheFieldCaption@1000 : Text[250]);
    VAR
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCheckAssocPurchOrder(Rec,TheFieldCaption,IsHandled,xRec);
      IF IsHandled THEN
        EXIT;

      IF TheFieldCaption = '' THEN BEGIN // If sales line is being deleted
        IF "Purch. Order Line No." <> 0 THEN
          ERROR(Text000,"Purchase Order No.","Purch. Order Line No.");
        IF "Special Order Purch. Line No." <> 0 THEN
          CheckPurchOrderLineDeleted("Special Order Purchase No.","Special Order Purch. Line No.");
      END ELSE BEGIN
        IF "Purch. Order Line No." <> 0 THEN
          ERROR(Text002,TheFieldCaption,"Purchase Order No.","Purch. Order Line No.");

        IF "Special Order Purch. Line No." <> 0 THEN
          ERROR(Text002,TheFieldCaption,"Special Order Purchase No.","Special Order Purch. Line No.");
      END;
    END;

    LOCAL PROCEDURE CheckPurchOrderLineDeleted@209(PurchaseOrderNo@1001 : Code[20];PurchaseLineNo@1002 : Integer);
    VAR
      PurchaseLine@1000 : Record 39;
    BEGIN
      IF PurchaseLine.GET(PurchaseLine."Document Type"::Order,PurchaseOrderNo,PurchaseLineNo) THEN
        ERROR(Text000,PurchaseOrderNo,PurchaseLineNo);
    END;

    [External]
    PROCEDURE CrossReferenceNoLookUp@53();
    VAR
      ItemCrossReference@1000 : Record 5717;
      ICGLAcc@1001 : Record 410;
    BEGIN
      CASE Type OF
        Type::Item:
          BEGIN
            GetSalesHeader;
            ItemCrossReference.RESET;
            ItemCrossReference.SETCURRENTKEY("Cross-Reference Type","Cross-Reference Type No.");
            ItemCrossReference.SETFILTER(
              "Cross-Reference Type",'%1|%2',
              ItemCrossReference."Cross-Reference Type"::Customer,
              ItemCrossReference."Cross-Reference Type"::" ");
            ItemCrossReference.SETFILTER("Cross-Reference Type No.",'%1|%2',SalesHeader."Sell-to Customer No.",'');
            IF PAGE.RUNMODAL(PAGE::"Cross Reference List",ItemCrossReference) = ACTION::LookupOK THEN BEGIN
              "Cross-Reference No." := ItemCrossReference."Cross-Reference No.";
              ValidateCrossReferenceNo(ItemCrossReference,FALSE);
              PriceCalcMgt.FindSalesLineLineDisc(SalesHeader,Rec);
              PriceCalcMgt.FindSalesLinePrice(SalesHeader,Rec,FIELDNO("Cross-Reference No."));
              OnCrossReferenceNoLookupOnBeforeValidateUnitPrice(SalesHeader,Rec);
              VALIDATE("Unit Price");
            END;
          END;
        Type::"G/L Account",Type::Resource:
          BEGIN
            GetSalesHeader;
            SalesHeader.TESTFIELD("Sell-to IC Partner Code");
            IF PAGE.RUNMODAL(PAGE::"IC G/L Account List",ICGLAcc) = ACTION::LookupOK THEN
              "Cross-Reference No." := ICGLAcc."No.";
          END;
      END;
    END;

    LOCAL PROCEDURE ValidateCrossReferenceNo@211(ItemCrossReference@1001 : Record 5717;SearchItem@1000 : Boolean);
    VAR
      ReturnedItemCrossReference@1002 : Record 5717;
    BEGIN
      ReturnedItemCrossReference.INIT;
      IF "Cross-Reference No." <> '' THEN BEGIN
        IF SearchItem THEN
          DistIntegration.ICRLookupSalesItem(Rec,ReturnedItemCrossReference,CurrFieldNo <> 0)
        ELSE
          ReturnedItemCrossReference := ItemCrossReference;

        OnBeforeCrossReferenceNoAssign(Rec,ReturnedItemCrossReference);

        IF "No." <> ReturnedItemCrossReference."Item No." THEN
          VALIDATE("No.",ReturnedItemCrossReference."Item No.");
        IF ReturnedItemCrossReference."Variant Code" <> '' THEN
          VALIDATE("Variant Code",ReturnedItemCrossReference."Variant Code");

        IF ReturnedItemCrossReference."Unit of Measure" <> '' THEN
          VALIDATE("Unit of Measure Code",ReturnedItemCrossReference."Unit of Measure");
      END;

      "Unit of Measure (Cross Ref.)" := ReturnedItemCrossReference."Unit of Measure";
      "Cross-Reference Type" := ReturnedItemCrossReference."Cross-Reference Type";
      "Cross-Reference Type No." := ReturnedItemCrossReference."Cross-Reference Type No.";
      "Cross-Reference No." := ReturnedItemCrossReference."Cross-Reference No.";

      IF (ReturnedItemCrossReference.Description <> '') OR (ReturnedItemCrossReference."Description 2" <> '') THEN BEGIN
        Description := ReturnedItemCrossReference.Description;
        "Description 2" := ReturnedItemCrossReference."Description 2";
      END;

      UpdateUnitPrice(FIELDNO("Cross-Reference No."));
      UpdateICPartner;

      OnAfterValidateCrossReferenceNo(Rec,ItemCrossReference);
    END;

    LOCAL PROCEDURE CheckServItemCreation@52();
    VAR
      Item@1001 : Record 27;
      ServItemGroup@1000 : Record 5904;
    BEGIN
      IF CurrFieldNo = 0 THEN
        EXIT;
      IF Type <> Type::Item THEN
        EXIT;
      GetItem(Item);
      IF Item."Service Item Group" = '' THEN
        EXIT;
      IF ServItemGroup.GET(Item."Service Item Group") THEN
        IF ServItemGroup."Create Service Item" THEN
          IF "Qty. to Ship (Base)" <> ROUND("Qty. to Ship (Base)",1) THEN
            ERROR(
              Text034,
              FIELDCAPTION("Qty. to Ship (Base)"),
              ServItemGroup.FIELDCAPTION("Create Service Item"));
    END;

    [External]
    PROCEDURE ItemExists@54(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      Item2@1001 : Record 27;
    BEGIN
      IF Type = Type::Item THEN
        IF NOT Item2.GET(ItemNo) THEN
          EXIT(FALSE);
      EXIT(TRUE);
    END;

    [External]
    PROCEDURE IsShipment@55() : Boolean;
    BEGIN
      EXIT(SignedXX("Quantity (Base)") < 0);
    END;

    LOCAL PROCEDURE GetAbsMin@56(QtyToHandle@1000 : Decimal;QtyHandled@1001 : Decimal) : Decimal;
    BEGIN
      IF ABS(QtyHandled) < ABS(QtyToHandle) THEN
        EXIT(QtyHandled);

      EXIT(QtyToHandle);
    END;

    [External]
    PROCEDURE SetHideValidationDialog@57(NewHideValidationDialog@1000 : Boolean);
    BEGIN
      HideValidationDialog := NewHideValidationDialog;
    END;

    [External]
    PROCEDURE GetHideValidationDialog@123() : Boolean;
    VAR
      IdentityManagement@1000 : Codeunit 9801;
    BEGIN
      EXIT(HideValidationDialog OR IdentityManagement.IsInvAppId);
    END;

    LOCAL PROCEDURE CheckApplFromItemLedgEntry@157(VAR ItemLedgEntry@1000 : Record 32);
    VAR
      ItemTrackingLines@1003 : Page 6510;
      QtyNotReturned@1002 : Decimal;
      QtyReturned@1004 : Decimal;
    BEGIN
      IF "Appl.-from Item Entry" = 0 THEN
        EXIT;

      IF "Shipment No." <> '' THEN
        EXIT;

      TESTFIELD(Type,Type::Item);
      TESTFIELD(Quantity);
      IF IsCreditDocType THEN BEGIN
        IF Quantity < 0 THEN
          FIELDERROR(Quantity,Text029);
      END ELSE BEGIN
        IF Quantity > 0 THEN
          FIELDERROR(Quantity,Text030);
      END;

      ItemLedgEntry.GET("Appl.-from Item Entry");
      ItemLedgEntry.TESTFIELD(Positive,FALSE);
      ItemLedgEntry.TESTFIELD("Item No.","No.");
      ItemLedgEntry.TESTFIELD("Variant Code","Variant Code");
      IF ItemLedgEntry.TrackingExists THEN
        ERROR(Text040,ItemTrackingLines.CAPTION,FIELDCAPTION("Appl.-from Item Entry"));

      IF ABS("Quantity (Base)") > -ItemLedgEntry.Quantity THEN
        ERROR(
          Text046,
          -ItemLedgEntry.Quantity,ItemLedgEntry.FIELDCAPTION("Document No."),
          ItemLedgEntry."Document No.");

      IF IsCreditDocType THEN
       IF NOT (("Document Type" = "Document Type"::"Credit Memo") AND ("Return Receipt No." <> '')) THEN BEGIN //**4PS.n
        IF ABS("Outstanding Qty. (Base)") > -ItemLedgEntry."Shipped Qty. Not Returned" THEN BEGIN
          QtyNotReturned := ItemLedgEntry."Shipped Qty. Not Returned";
          QtyReturned := ItemLedgEntry.Quantity - ItemLedgEntry."Shipped Qty. Not Returned";
          IF "Qty. per Unit of Measure" <> 0 THEN BEGIN
            QtyNotReturned :=
              ROUND(ItemLedgEntry."Shipped Qty. Not Returned" / "Qty. per Unit of Measure",UOMMgt.QtyRndPrecision);
            QtyReturned :=
              ROUND(
                (ItemLedgEntry.Quantity - ItemLedgEntry."Shipped Qty. Not Returned") /
                "Qty. per Unit of Measure",UOMMgt.QtyRndPrecision);
          END;
          ERROR(
            Text039,
            -QtyReturned,ItemLedgEntry.FIELDCAPTION("Document No."),
            ItemLedgEntry."Document No.",-QtyNotReturned);
        END;
       END;  //**4PS.n
    END;

    [External]
    PROCEDURE CalcPrepaymentToDeduct@63();
    BEGIN
      IF ("Qty. to Invoice" <> 0) AND ("Prepmt. Amt. Inv." <> 0) THEN BEGIN
        GetSalesHeader;
        IF ("Prepayment %" = 100) AND NOT IsFinalInvoice THEN
          "Prepmt Amt to Deduct" := GetLineAmountToHandle("Qty. to Invoice")
        ELSE
          "Prepmt Amt to Deduct" :=
            ROUND(
              ("Prepmt. Amt. Inv." - "Prepmt Amt Deducted") *
              "Qty. to Invoice" / (Quantity - "Quantity Invoiced"),Currency."Amount Rounding Precision")
      END ELSE
        "Prepmt Amt to Deduct" := 0
    END;

    [External]
    PROCEDURE IsFinalInvoice@116() : Boolean;
    BEGIN
      EXIT("Qty. to Invoice" = Quantity - "Quantity Invoiced");
    END;

    [External]
    PROCEDURE GetLineAmountToHandle@117(QtyToHandle@1002 : Decimal) : Decimal;
    VAR
      LineAmount@1001 : Decimal;
      LineDiscAmount@1000 : Decimal;
    BEGIN
      IF "Line Discount %" = 100 THEN
        EXIT(0);

      GetSalesHeader;

      IF "Prepmt Amt to Deduct" = 0 THEN
      //LineAmount := ROUND(QtyToHandle * "Unit Price",Currency."Amount Rounding Precision") //**4PS.o
        LineAmount := ROUND(QtyToHandle * "Unit Price" * DimensionalFactor * RentalFactor,Currency."Amount Rounding Precision") //**4PS.n
      ELSE BEGIN
      //LineAmount := ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision"); //**4PS.o
        LineAmount := ROUND(Quantity * "Unit Price" * DimensionalFactor * RentalFactor,Currency."Amount Rounding Precision"); //**4PS.n
        LineAmount := ROUND(QtyToHandle * LineAmount / Quantity,Currency."Amount Rounding Precision");
      END;

      IF QtyToHandle <> Quantity THEN
        LineDiscAmount := ROUND(LineAmount * "Line Discount %" / 100,Currency."Amount Rounding Precision")
      ELSE
        LineDiscAmount := "Line Discount Amount";

      OnAfterGetLineAmountToHandle(Rec,QtyToHandle,LineAmount,LineDiscAmount);
      EXIT(LineAmount - LineDiscAmount);
    END;

    [External]
    PROCEDURE GetLineAmountToHandleInclPrepmt@265(QtyToHandle@1002 : Decimal) : Decimal;
    BEGIN
      IF "Line Discount %" = 100 THEN
        EXIT(0);
      IF ("Prepayment %" = 100) AND NOT "Prepayment Line" AND ("Prepmt Amt to Deduct" <> 0) THEN
        EXIT("Prepmt Amt to Deduct");
      EXIT(GetLineAmountToHandle(QtyToHandle));
    END;

    [External]
    PROCEDURE GetLineAmountExclVAT@349() : Decimal;
    BEGIN
      IF "Document No." = '' THEN
        EXIT(0);
      GetSalesHeader;
      IF NOT SalesHeader."Prices Including VAT" THEN
        EXIT("Line Amount");

      EXIT(ROUND("Line Amount" / (1 + "VAT %" / 100),Currency."Amount Rounding Precision"));
    END;

    [External]
    PROCEDURE GetLineAmountInclVAT@351() : Decimal;
    BEGIN
      IF "Document No." = '' THEN
        EXIT(0);
      GetSalesHeader;
      IF SalesHeader."Prices Including VAT" THEN
        EXIT("Line Amount");

      EXIT(ROUND("Line Amount" * (1 + "VAT %" / 100),Currency."Amount Rounding Precision"));
    END;

    [External]
    PROCEDURE SetHasBeenShown@59();
    BEGIN
      HasBeenShown := TRUE;
    END;

    LOCAL PROCEDURE TestJobPlanningLine@60();
    VAR
      JobPostLine@1000 : Codeunit 11072006;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeTestJobPlanningLine(Rec,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF "Job Contract Entry No." = 0 THEN
        EXIT;

      JobPostLine.TestSalesLine(Rec);
    END;

    [External]
    PROCEDURE BlockDynamicTracking@58(SetBlock@1000 : Boolean);
    BEGIN
      ReserveSalesLine.Block(SetBlock);
    END;

    [External]
    PROCEDURE InitQtyToShip2@7();
    BEGIN
      "Qty. to Ship" := "Outstanding Quantity";
      "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";

      OnAfterInitQtyToShip2(Rec,CurrFieldNo);

      ATOLink.UpdateQtyToAsmFromSalesLine(Rec);

      CheckServItemCreation;

      "Qty. to Invoice" := MaxQtyToInvoice;
      "Qty. to Invoice (Base)" := MaxQtyToInvoiceBase;
      "VAT Difference" := 0;

      OnInitQtyToShip2OnBeforeCalcInvDiscToInvoice(Rec,xRec);

      CalcInvDiscToInvoice;

      CalcPrepaymentToDeduct;
    END;

    [External]
    PROCEDURE ShowLineComments@61();
    VAR
      SalesCommentLine@1000 : Record 44;
      SalesCommentSheet@1001 : Page 67;
    BEGIN
      TESTFIELD("Document No.");
      TESTFIELD("Line No.");
      SalesCommentLine.SETRANGE("Document Type","Document Type");
      SalesCommentLine.SETRANGE("No.","Document No.");
      SalesCommentLine.SETRANGE("Document Line No.","Line No.");
      SalesCommentSheet.SETTABLEVIEW(SalesCommentLine);
      SalesCommentSheet.RUNMODAL;
    END;

    PROCEDURE LineCommentPresent@1210190001() : Boolean;
    VAR
      SalesCommentLine@1210190000 : Record 44;
    BEGIN
      //**4PS
      EXIT(SalesCommentLine.CommentPresent("Document Type", "Document No.", "Line No."));
    END;

    [External]
    PROCEDURE SetDefaultQuantity@62();
    BEGIN
      GetSalesSetup;
      IF SalesSetup."Default Quantity to Ship" = SalesSetup."Default Quantity to Ship"::Blank THEN BEGIN
        IF ("Document Type" = "Document Type"::Order) OR ("Document Type" = "Document Type"::Quote) THEN BEGIN
          "Qty. to Ship" := 0;
          "Qty. to Ship (Base)" := 0;
          "Qty. to Invoice" := 0;
          "Qty. to Invoice (Base)" := 0;
        END;
        IF "Document Type" = "Document Type"::"Return Order" THEN BEGIN
          "Return Qty. to Receive" := 0;
          "Return Qty. to Receive (Base)" := 0;
          "Qty. to Invoice" := 0;
          "Qty. to Invoice (Base)" := 0;
        END;
      END;

      OnAfterSetDefaultQuantity(Rec,xRec);
    END;

    LOCAL PROCEDURE SetReserveWithoutPurchasingCode@198();
    VAR
      Item@1000 : Record 27;
    BEGIN
      GetItem(Item);
      IF Item.Reserve = Item.Reserve::Optional THEN BEGIN
        GetSalesHeader;
        Reserve := SalesHeader.Reserve;
      END ELSE
        Reserve := Item.Reserve;

      OnAfterSetReserveWithoutPurchasingCode(Rec,SalesHeader,Item);
    END;

    LOCAL PROCEDURE SetDefaultItemQuantity@122();
    BEGIN
      GetSalesSetup;
      IF SalesSetup."Default Item Quantity" THEN BEGIN
        VALIDATE(Quantity,1);
        CheckItemAvailable(CurrFieldNo);
      END;
    END;

    [External]
    PROCEDURE UpdatePrePaymentAmounts@64();
    VAR
      ShipmentLine@1000 : Record 111;
      SalesOrderLine@1001 : Record 37;
      SalesOrderHeader@1002 : Record 36;
    BEGIN
      IF ("Document Type" <> "Document Type"::Invoice) OR ("Prepayment %" = 0) THEN
        EXIT;

      IF NOT ShipmentLine.GET("Shipment No.","Shipment Line No.") THEN BEGIN
        "Prepmt Amt to Deduct" := 0;
        "Prepmt VAT Diff. to Deduct" := 0;
      END ELSE
        IF SalesOrderLine.GET(SalesOrderLine."Document Type"::Order,ShipmentLine."Order No.",ShipmentLine."Order Line No.") THEN BEGIN
          IF ("Prepayment %" = 100) AND (Quantity <> SalesOrderLine.Quantity - SalesOrderLine."Quantity Invoiced") THEN
            "Prepmt Amt to Deduct" := "Line Amount"
          ELSE
            "Prepmt Amt to Deduct" :=
              ROUND((SalesOrderLine."Prepmt. Amt. Inv." - SalesOrderLine."Prepmt Amt Deducted") *
                Quantity / (SalesOrderLine.Quantity - SalesOrderLine."Quantity Invoiced"),Currency."Amount Rounding Precision");
          "Prepmt VAT Diff. to Deduct" := "Prepayment VAT Difference" - "Prepmt VAT Diff. Deducted";
          SalesOrderHeader.GET(SalesOrderHeader."Document Type"::Order,SalesOrderLine."Document No.");
        END ELSE BEGIN
          "Prepmt Amt to Deduct" := 0;
          "Prepmt VAT Diff. to Deduct" := 0;
        END;

      GetSalesHeader;
      SalesHeader.TESTFIELD("Prices Including VAT",SalesOrderHeader."Prices Including VAT");
      IF SalesHeader."Prices Including VAT" THEN BEGIN
        "Prepmt. Amt. Incl. VAT" := "Prepmt Amt to Deduct";
        "Prepayment Amount" :=
          ROUND(
            "Prepmt Amt to Deduct" / (1 + ("Prepayment VAT %" / 100)),
            Currency."Amount Rounding Precision");
      END ELSE BEGIN
        "Prepmt. Amt. Incl. VAT" :=
          ROUND(
            "Prepmt Amt to Deduct" * (1 + ("Prepayment VAT %" / 100)),
            Currency."Amount Rounding Precision");
        "Prepayment Amount" := "Prepmt Amt to Deduct";
      END;
      "Prepmt. Line Amount" := "Prepmt Amt to Deduct";
      "Prepmt. Amt. Inv." := "Prepmt. Line Amount";
      "Prepmt. VAT Base Amt." := "Prepayment Amount";
      "Prepmt. Amount Inv. Incl. VAT" := "Prepmt. Amt. Incl. VAT";
      "Prepmt Amt Deducted" := 0;
    END;

    [External]
    PROCEDURE ZeroAmountLine@65(QtyType@1000 : 'General,Invoicing,Shipping';SalesHeader@1100525001 : Record 36;SalesLine@1100525000 : Record 37) : Boolean;
    BEGIN
      WITH SalesLine DO BEGIN //**4PS.n
        IF NOT HasTypeToFillMandatoryFields THEN
          EXIT(TRUE);
        IF Quantity = 0 THEN
          EXIT(TRUE);
        IF "Unit Price" = 0 THEN
          EXIT(TRUE);
        IF QtyType = QtyType::Invoicing THEN
          IF "Qty. to Invoice" = 0 THEN
            EXIT(TRUE);
      //**4PS.sn
        IF ((SalesHeader."Document Type" = SalesHeader."Document Type"::Quote) AND
            (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated") AND
            ("Alternative No." <> SalesHeader."Elected Alternative No.")) THEN
          EXIT(TRUE);
      END;
      //**4PS.en
      EXIT(FALSE);
    END;

    [External]
    PROCEDURE FilterLinesWithItemToPlan@69(VAR Item@1000 : Record 27;DocumentType@1001 : Option);
    BEGIN
      RESET;
      SETCURRENTKEY("Document Type",Type,"No.","Variant Code","Drop Shipment","Location Code","Shipment Date");
      SETRANGE("Document Type",DocumentType);
      SETRANGE(Type,Type::Item);
      SETRANGE("No.",Item."No.");
      SETFILTER("Variant Code",Item.GETFILTER("Variant Filter"));
      SETFILTER("Location Code",Item.GETFILTER("Location Filter"));
      SETFILTER("Drop Shipment",Item.GETFILTER("Drop Shipment Filter"));
      SETFILTER("Shortcut Dimension 1 Code",Item.GETFILTER("Global Dimension 1 Filter"));
      SETFILTER("Shortcut Dimension 2 Code",Item.GETFILTER("Global Dimension 2 Filter"));
      SETFILTER("Shipment Date",Item.GETFILTER("Date Filter"));
      SETFILTER("Outstanding Qty. (Base)",'<>0');

      OnAfterFilterLinesWithItemToPlan(Rec,Item,DocumentType);
    END;

    [External]
    PROCEDURE FindLinesWithItemToPlan@66(VAR Item@1000 : Record 27;DocumentType@1001 : Option) : Boolean;
    BEGIN
      FilterLinesWithItemToPlan(Item,DocumentType);
      EXIT(FIND('-'));
    END;

    [External]
    PROCEDURE LinesWithItemToPlanExist@67(VAR Item@1000 : Record 27;DocumentType@1001 : Option) : Boolean;
    BEGIN
      FilterLinesWithItemToPlan(Item,DocumentType);
      EXIT(NOT ISEMPTY);
    END;

    LOCAL PROCEDURE DateFormularZero@73(VAR DateFormularValue@1001 : DateFormula;CalledByFieldNo@1002 : Integer;CalledByFieldCaption@1003 : Text[250]);
    VAR
      DateFormularZero@1000 : DateFormula;
    BEGIN
      EVALUATE(DateFormularZero,'<0D>');
      IF (DateFormularValue <> DateFormularZero) AND (CalledByFieldNo = CurrFieldNo) THEN
        ERROR(Text051,CalledByFieldCaption,FIELDCAPTION("Drop Shipment"));
      EVALUATE(DateFormularValue,'<0D>');
    END;

    LOCAL PROCEDURE InitQtyToAsm@76();
    BEGIN
      OnBeforeInitQtyToAsm(Rec,CurrFieldNo);

      IF NOT IsAsmToOrderAllowed THEN BEGIN
        "Qty. to Assemble to Order" := 0;
        "Qty. to Asm. to Order (Base)" := 0;
        EXIT;
      END;

      IF ((xRec."Qty. to Asm. to Order (Base)" = 0) AND IsAsmToOrderRequired AND ("Qty. Shipped (Base)" = 0)) OR
         ((xRec."Qty. to Asm. to Order (Base)" <> 0) AND
          (xRec."Qty. to Asm. to Order (Base)" = xRec."Quantity (Base)")) OR
         ("Qty. to Asm. to Order (Base)" > "Quantity (Base)")
      THEN BEGIN
        "Qty. to Assemble to Order" := Quantity;
        "Qty. to Asm. to Order (Base)" := "Quantity (Base)";
      END;

      OnAfterInitQtyToAsm(Rec,CurrFieldNo)
    END;

    [External]
    PROCEDURE AsmToOrderExists@72(VAR AsmHeader@1000 : Record 900) : Boolean;
    VAR
      ATOLink@1001 : Record 904;
    BEGIN
      IF NOT ATOLink.AsmExistsForSalesLine(Rec) THEN
        EXIT(FALSE);
      EXIT(AsmHeader.GET(ATOLink."Assembly Document Type",ATOLink."Assembly Document No."));
    END;

    [External]
    PROCEDURE FullQtyIsForAsmToOrder@74() : Boolean;
    BEGIN
      IF "Qty. to Asm. to Order (Base)" = 0 THEN
        EXIT(FALSE);
      EXIT("Quantity (Base)" = "Qty. to Asm. to Order (Base)");
    END;

    LOCAL PROCEDURE FullReservedQtyIsForAsmToOrder@75() : Boolean;
    BEGIN
      IF "Qty. to Asm. to Order (Base)" = 0 THEN
        EXIT(FALSE);
      CALCFIELDS("Reserved Qty. (Base)");
      EXIT("Reserved Qty. (Base)" = "Qty. to Asm. to Order (Base)");
    END;

    [External]
    PROCEDURE QtyBaseOnATO@86() : Decimal;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF AsmToOrderExists(AsmHeader) THEN
        EXIT(AsmHeader."Quantity (Base)");
      EXIT(0);
    END;

    [External]
    PROCEDURE QtyAsmRemainingBaseOnATO@90() : Decimal;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF AsmToOrderExists(AsmHeader) THEN
        EXIT(AsmHeader."Remaining Quantity (Base)");
      EXIT(0);
    END;

    [External]
    PROCEDURE QtyToAsmBaseOnATO@88() : Decimal;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF AsmToOrderExists(AsmHeader) THEN
        EXIT(AsmHeader."Quantity to Assemble (Base)");
      EXIT(0);
    END;

    [External]
    PROCEDURE IsAsmToOrderAllowed@77() : Boolean;
    BEGIN
      IF NOT ("Document Type" IN ["Document Type"::Quote,"Document Type"::"Blanket Order","Document Type"::Order]) THEN
        EXIT(FALSE);
      IF Quantity < 0 THEN
        EXIT(FALSE);
      IF Type <> Type::Item THEN
        EXIT(FALSE);
      IF "No." = '' THEN
        EXIT(FALSE);
      IF "Drop Shipment" OR "Special Order" THEN
        EXIT(FALSE);
      EXIT(TRUE)
    END;

    [External]
    PROCEDURE IsAsmToOrderRequired@81() : Boolean;
    VAR
      Item@1000 : Record 27;
      Result@1002 : Boolean;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      Result := FALSE;
      OnBeforeIsAsmToOrderRequired(Rec,Result,IsHandled);
      IF IsHandled THEN
        EXIT(Result);

      IF (Type <> Type::Item) OR ("No." = '') THEN
        EXIT(FALSE);
      GetItem(Item);
      IF GetSKU THEN
        EXIT(SKU."Assembly Policy" = SKU."Assembly Policy"::"Assemble-to-Order");
      EXIT(Item."Assembly Policy" = Item."Assembly Policy"::"Assemble-to-Order");
    END;

    [External]
    PROCEDURE CheckAsmToOrder@85(AsmHeader@1001 : Record 900);
    BEGIN
      TESTFIELD("Qty. to Assemble to Order",AsmHeader.Quantity);
      TESTFIELD("Document Type",AsmHeader."Document Type");
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.",AsmHeader."Item No.");
      TESTFIELD("Location Code",AsmHeader."Location Code");
      TESTFIELD("Unit of Measure Code",AsmHeader."Unit of Measure Code");
      TESTFIELD("Variant Code",AsmHeader."Variant Code");
      TESTFIELD("Shipment Date",AsmHeader."Due Date");
      IF "Document Type" = "Document Type"::Order THEN BEGIN
        AsmHeader.CALCFIELDS("Reserved Qty. (Base)");
        AsmHeader.TESTFIELD("Reserved Qty. (Base)",AsmHeader."Remaining Quantity (Base)");
      END;
      TESTFIELD("Qty. to Asm. to Order (Base)",AsmHeader."Quantity (Base)");
      IF "Outstanding Qty. (Base)" < AsmHeader."Remaining Quantity (Base)" THEN
        AsmHeader.FIELDERROR("Remaining Quantity (Base)",STRSUBSTNO(Text045,AsmHeader."Remaining Quantity (Base)"));
    END;

    [External]
    PROCEDURE ShowAsmToOrderLines@80();
    VAR
      ATOLink@1000 : Record 904;
    BEGIN
      ATOLink.ShowAsmToOrderLines(Rec);
    END;

    [External]
    PROCEDURE FindOpenATOEntry@96(LotNo@1003 : Code[50];SerialNo@1004 : Code[50]) : Integer;
    VAR
      PostedATOLink@1002 : Record 914;
      ItemLedgEntry@1001 : Record 32;
    BEGIN
      TESTFIELD("Document Type","Document Type"::Order);
      IF PostedATOLink.FindLinksFromSalesLine(Rec) THEN
        REPEAT
          ItemLedgEntry.SETRANGE("Document Type",ItemLedgEntry."Document Type"::"Posted Assembly");
          ItemLedgEntry.SETRANGE("Document No.",PostedATOLink."Assembly Document No.");
          ItemLedgEntry.SETRANGE("Document Line No.",0);
          ItemLedgEntry.SetTrackingFilter(SerialNo,LotNo);
          ItemLedgEntry.SETRANGE(Open,TRUE);
          IF ItemLedgEntry.FINDFIRST THEN
            EXIT(ItemLedgEntry."Entry No.");
        UNTIL PostedATOLink.NEXT = 0;
    END;

    [External]
    PROCEDURE RollUpAsmCost@83();
    BEGIN
      ATOLink.RollUpCost(Rec);
    END;

    [External]
    PROCEDURE RollupAsmPrice@84();
    BEGIN
      GetSalesHeader;
      ATOLink.RollUpPrice(SalesHeader,Rec);
    END;

    LOCAL PROCEDURE UpdateICPartner@78();
    VAR
      ICPartner@1000 : Record 413;
      ItemCrossReference@1001 : Record 5717;
    BEGIN
      IF SalesHeader."Send IC Document" AND
         (SalesHeader."IC Direction" = SalesHeader."IC Direction"::Outgoing) AND
         (SalesHeader."Bill-to IC Partner Code" <> '')
      THEN
        CASE Type OF
          Type::" ",Type::"Charge (Item)":
            BEGIN
              "IC Partner Ref. Type" := Type;
              "IC Partner Reference" := "No.";
            END;
          Type::"G/L Account":
            BEGIN
              "IC Partner Ref. Type" := Type;
              "IC Partner Reference" := GLAcc."Default IC Partner G/L Acc. No";
            END;
          Type::Item:
            BEGIN
              IF SalesHeader."Sell-to IC Partner Code" <> '' THEN
                ICPartner.GET(SalesHeader."Sell-to IC Partner Code")
              ELSE
                ICPartner.GET(SalesHeader."Bill-to IC Partner Code");
              CASE ICPartner."Outbound Sales Item No. Type" OF
                ICPartner."Outbound Sales Item No. Type"::"Common Item No.":
                  VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::"Common Item No.");
                ICPartner."Outbound Sales Item No. Type"::"Internal No.",
                ICPartner."Outbound Sales Item No. Type"::"Cross Reference":
                  BEGIN
                    IF ICPartner."Outbound Sales Item No. Type" = ICPartner."Outbound Sales Item No. Type"::"Internal No." THEN
                      VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::Item)
                    ELSE
                      VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::"Cross Reference");
                    ItemCrossReference.SETRANGE("Cross-Reference Type",ItemCrossReference."Cross-Reference Type"::Customer);
                    ItemCrossReference.SETRANGE("Cross-Reference Type No.","Sell-to Customer No.");
                    ItemCrossReference.SETRANGE("Item No.","No.");
                    ItemCrossReference.SETRANGE("Variant Code","Variant Code");
                    ItemCrossReference.SETRANGE("Unit of Measure","Unit of Measure Code");
                    IF ItemCrossReference.FINDFIRST THEN
                      "IC Partner Reference" := ItemCrossReference."Cross-Reference No."
                    ELSE
                      "IC Partner Reference" := "No.";
                  END;
              END;
            END;
          Type::"Fixed Asset":
            BEGIN
              "IC Partner Ref. Type" := "IC Partner Ref. Type"::" ";
              "IC Partner Reference" := '';
            END;
          Type::Resource:
            BEGIN
              Resource.GET("No.");
              "IC Partner Ref. Type" := "IC Partner Ref. Type"::"G/L Account";
              "IC Partner Reference" := Resource."IC Partner Purch. G/L Acc. No.";
            END;
        END;
    END;

    [External]
    PROCEDURE OutstandingInvoiceAmountFromShipment@12(SellToCustomerNo@1000 : Code[20]) : Decimal;
    VAR
      SalesLine@1001 : Record 37;
    BEGIN
      SalesLine.SETCURRENTKEY("Document Type","Sell-to Customer No.","Shipment No.");
      SalesLine.SETRANGE("Document Type",SalesLine."Document Type"::Invoice);
      SalesLine.SETRANGE("Sell-to Customer No.",SellToCustomerNo);
      SalesLine.SETFILTER("Shipment No.",'<>%1','');
      SalesLine.CALCSUMS("Outstanding Amount (LCY)");
      EXIT(SalesLine."Outstanding Amount (LCY)");
    END;

    LOCAL PROCEDURE CheckShipmentRelation@94();
    VAR
      SalesShptLine@1001 : Record 111;
    BEGIN
      SalesShptLine.GET("Shipment No.","Shipment Line No.");
      IF (Quantity * SalesShptLine."Qty. Shipped Not Invoiced") < 0 THEN
        FIELDERROR("Qty. to Invoice",Text057);
      IF ABS(Quantity) > ABS(SalesShptLine."Qty. Shipped Not Invoiced") THEN
        ERROR(Text058,SalesShptLine."Document No.");
    END;

    LOCAL PROCEDURE CheckRetRcptRelation@95();
    VAR
      ReturnRcptLine@1000 : Record 6661;
    BEGIN
      ReturnRcptLine.GET("Return Receipt No.","Return Receipt Line No.");
      IF (Quantity * (ReturnRcptLine.Quantity - ReturnRcptLine."Quantity Invoiced")) < 0 THEN
        FIELDERROR("Qty. to Invoice",Text059);
      IF ABS(Quantity) > ABS(ReturnRcptLine.Quantity - ReturnRcptLine."Quantity Invoiced") THEN
        ERROR(Text060,ReturnRcptLine."Document No.");
    END;

    LOCAL PROCEDURE VerifyItemLineDim@87();
    BEGIN
      IF IsShippedReceivedItemDimChanged THEN
        ConfirmShippedReceivedItemDimChange;
    END;

    [External]
    PROCEDURE IsShippedReceivedItemDimChanged@113() : Boolean;
    BEGIN
      EXIT(("Dimension Set ID" <> xRec."Dimension Set ID") AND (Type = Type::Item) AND
        (("Qty. Shipped Not Invoiced" <> 0) OR ("Return Rcd. Not Invd." <> 0)));
    END;

    LOCAL PROCEDURE IsServiceCharge@177() : Boolean;
    VAR
      CustomerPostingGroup@1001 : Record 92;
    BEGIN
      IF Type <> Type::"G/L Account" THEN
        EXIT(FALSE);

      GetSalesHeader;
      CustomerPostingGroup.GET(SalesHeader."Customer Posting Group");
      EXIT(CustomerPostingGroup."Service Charge Acc." = "No.");
    END;

    [External]
    PROCEDURE ConfirmShippedReceivedItemDimChange@114() : Boolean;
    VAR
      ConfirmManagement@1000 : Codeunit 27;
    BEGIN
      IF NOT ConfirmManagement.ConfirmProcess(STRSUBSTNO(Text053,TABLECAPTION),TRUE) THEN
        ERROR(Text054);

      EXIT(TRUE);
    END;

    [External]
    PROCEDURE InitType@91();
    BEGIN
      IF "Document No." <> '' THEN BEGIN
        IF NOT SalesHeader.GET("Document Type","Document No.") THEN
          EXIT;
        IF (SalesHeader.Status = SalesHeader.Status::Released) AND
           (xRec.Type IN [xRec.Type::Item,xRec.Type::"Fixed Asset"])
        THEN
          Type := Type::" "
        ELSE
          Type := xRec.Type;
      END;
    END;

    LOCAL PROCEDURE CheckWMS@98();
    BEGIN
      IF CurrFieldNo <> 0 THEN
        CheckLocationOnWMS;
    END;

    [External]
    PROCEDURE CheckLocationOnWMS@101();
    VAR
      DialogText@1001 : Text;
    BEGIN
      IF Type = Type::Item THEN BEGIN
        DialogText := Text035;
        IF "Quantity (Base)" <> 0 THEN
          CASE "Document Type" OF
            "Document Type"::Invoice:
              IF "Shipment No." = '' THEN
                IF Location.GET("Location Code") AND Location."Directed Put-away and Pick" THEN BEGIN
                  DialogText += Location.GetRequirementText(Location.FIELDNO("Require Shipment"));
                  ERROR(Text016,DialogText,FIELDCAPTION("Line No."),"Line No.");
                END;
            "Document Type"::"Credit Memo":
              IF "Return Receipt No." = '' THEN
                IF Location.GET("Location Code") AND Location."Directed Put-away and Pick" THEN BEGIN
                  DialogText += Location.GetRequirementText(Location.FIELDNO("Require Receive"));
                  ERROR(Text016,DialogText,FIELDCAPTION("Line No."),"Line No.");
                END;
          END;
      END;
    END;

    [External]
    PROCEDURE IsNonInventoriableItem@195() : Boolean;
    VAR
      Item@1000 : Record 27;
    BEGIN
      IF Type <> Type::Item THEN
        EXIT(FALSE);
      IF "No." = '' THEN
        EXIT(FALSE);
      GetItem(Item);
      EXIT(Item.IsNonInventoriableType);
    END;

    [External]
    PROCEDURE IsInventoriableItem@196() : Boolean;
    VAR
      Item@1000 : Record 27;
    BEGIN
      IF Type <> Type::Item THEN
        EXIT(FALSE);
      IF "No." = '' THEN
        EXIT(FALSE);
      GetItem(Item);
      EXIT(Item.IsInventoriableType);
    END;

    LOCAL PROCEDURE ValidateReturnReasonCode@99(CallingFieldNo@1000 : Integer);
    VAR
      ReturnReason@1001 : Record 6635;
      IsHandled@1002 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeValidateReturnReasonCode(Rec,CallingFieldNo,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF CallingFieldNo = 0 THEN
        EXIT;
      IF "Return Reason Code" = '' THEN BEGIN
        IF (Type = Type::Item) AND ("No." <> '') THEN
          GetUnitCost;
        UpdateUnitPrice(CallingFieldNo);
      END;

      IF ReturnReason.GET("Return Reason Code") THEN BEGIN
        IF (CallingFieldNo <> FIELDNO("Location Code")) AND (ReturnReason."Default Location Code" <> '') THEN
          VALIDATE("Location Code",ReturnReason."Default Location Code");
        IF ReturnReason."Inventory Value Zero" THEN
          VALIDATE("Unit Cost (LCY)",0)
        ELSE
          IF "Unit Price" = 0 THEN
            UpdateUnitPrice(CallingFieldNo);
      END;

      OnAfterValidateReturnReasonCode(Rec,CallingFieldNo);
    END;

    [Internal]
    PROCEDURE ValidateLineDiscountPercent@226(DropInvoiceDiscountAmount@1000 : Boolean);
    BEGIN
      TestJobPlanningLine;
      TestStatusOpen;
      "Line Discount Amount" :=
        ROUND(
        //ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") * //**4PS.o
          ROUND(Quantity * "Unit Price" * DimensionalFactor * RentalFactor,Currency."Amount Rounding Precision") * //**4PS.n
          "Line Discount %" / 100,Currency."Amount Rounding Precision");
      IF DropInvoiceDiscountAmount THEN BEGIN
        "Inv. Discount Amount" := 0;
        "Inv. Disc. Amount to Invoice" := 0;
      END;
      UpdateAmounts;
    END;

    [External]
    PROCEDURE HasTypeToFillMandatoryFields@103() : Boolean;
    BEGIN
      EXIT(Type <> Type::" ");
    END;

    [External]
    PROCEDURE GetDeferralAmount@104() DeferralAmount : Decimal;
    BEGIN
      IF "VAT Base Amount" <> 0 THEN
        DeferralAmount := "VAT Base Amount"
      ELSE
        DeferralAmount := CalcLineAmount;
    END;

    LOCAL PROCEDURE UpdateDeferralAmounts@105();
    VAR
      AdjustStartDate@1000 : Boolean;
      DeferralPostDate@1001 : Date;
    BEGIN
      GetSalesHeader;
      OnGetDeferralPostDate(SalesHeader,DeferralPostDate,Rec);
      IF DeferralPostDate = 0D THEN
        DeferralPostDate := SalesHeader."Posting Date";
      AdjustStartDate := TRUE;
      IF "Document Type" = "Document Type"::"Return Order" THEN BEGIN
        IF "Returns Deferral Start Date" = 0D THEN
          "Returns Deferral Start Date" := SalesHeader."Posting Date";
        DeferralPostDate := "Returns Deferral Start Date";
        AdjustStartDate := FALSE;
      END;

      DeferralUtilities.RemoveOrSetDeferralSchedule(
        "Deferral Code",DeferralUtilities.GetSalesDeferralDocType,'','',
        "Document Type","Document No.","Line No.",
        GetDeferralAmount,DeferralPostDate,Description,SalesHeader."Currency Code",AdjustStartDate);
    END;

    [External]
    PROCEDURE UpdatePriceDescription@147();
    VAR
      Currency@1000 : Record 4;
    BEGIN
      "Price description" := '';
      IF Type IN [Type::"Charge (Item)",Type::"Fixed Asset",Type::Item,Type::Resource] THEN BEGIN
        IF "Line Discount %" = 0 THEN
          "Price description" := STRSUBSTNO(
              PriceDescriptionTxt,Quantity,Currency.ResolveGLCurrencySymbol("Currency Code"),
              "Unit Price","Unit of Measure")
        ELSE
          "Price description" := STRSUBSTNO(
              PriceDescriptionWithLineDiscountTxt,Quantity,Currency.ResolveGLCurrencySymbol("Currency Code"),
              "Unit Price","Unit of Measure","Line Discount %")
      END;
    END;

    LOCAL PROCEDURE UpdateVATPercent@248(BaseAmount@1000 : Decimal;VATAmount@1001 : Decimal);
    BEGIN
      IF BaseAmount <> 0 THEN
        "VAT %" := ROUND(100 * VATAmount / BaseAmount,0.00001)
      ELSE
        "VAT %" := 0;
    END;

    PROCEDURE ShowDeferrals@106(PostingDate@1000 : Date;CurrencyCode@1001 : Code[10]) : Boolean;
    BEGIN
      EXIT(DeferralUtilities.OpenLineScheduleEdit(
          "Deferral Code",DeferralUtilities.GetSalesDeferralDocType,'','',
          "Document Type","Document No.","Line No.",
          GetDeferralAmount,PostingDate,Description,CurrencyCode));
    END;

    LOCAL PROCEDURE InitHeaderDefaults@107(SalesHeader@1000 : Record 36);
    BEGIN
      IF SalesHeader."Document Type" = SalesHeader."Document Type"::Quote THEN BEGIN
        IF (SalesHeader."Sell-to Customer No." = '') AND
           (SalesHeader."Sell-to Contact No." = '') AND //**4PS.n
           (SalesHeader."Sell-to Customer Template Code" = '')
        THEN
          ERROR(
            Text031,
            SalesHeader.FIELDCAPTION("Sell-to Customer No."),
            SalesHeader.FIELDCAPTION("Sell-to Contact No."), //**4PS.n
            SalesHeader.FIELDCAPTION("Sell-to Customer Template Code"));
        IF (SalesHeader."Bill-to Customer No." = '') AND
           (SalesHeader."Bill-to Contact No." = '') AND //**4PS.n
           (SalesHeader."Bill-to Customer Template Code" = '')
        THEN
          ERROR(
            Text031,
            SalesHeader.FIELDCAPTION("Bill-to Customer No."),
            SalesHeader.FIELDCAPTION("Bill-to Contact No."), //**4PS.n
            SalesHeader.FIELDCAPTION("Bill-to Customer Template Code"));
      END ELSE
        IF NOT PlantRelatedInvoice(SalesHeader."Job No.", SalesHeader) THEN //**4PS.n
          SalesHeader.TESTFIELD("Sell-to Customer No.");

      //**4PS.sn  (as in T39)
      IF "Shortcut Dimension 1 Code" = '' THEN
        "Shortcut Dimension 1 Code" := SalesHeader."Shortcut Dimension 1 Code";
      IF "Shortcut Dimension 2 Code" = '' THEN
        "Shortcut Dimension 2 Code" := SalesHeader."Shortcut Dimension 2 Code";
      //**4PS.en

      "Sell-to Customer No." := SalesHeader."Sell-to Customer No.";
      "Currency Code" := SalesHeader."Currency Code";
      IF NOT IsNonInventoriableItem THEN
        "Location Code" := SalesHeader."Location Code";
      "Customer Price Group" := SalesHeader."Customer Price Group";
      "Customer Disc. Group" := SalesHeader."Customer Disc. Group";
      "Allow Line Disc." := SalesHeader."Allow Line Disc.";
      "Transaction Type" := SalesHeader."Transaction Type";
      "Transport Method" := SalesHeader."Transport Method";
      "Bill-to Customer No." := SalesHeader."Bill-to Customer No.";
      "Gen. Bus. Posting Group" := SalesHeader."Gen. Bus. Posting Group";
      "VAT Bus. Posting Group" := SalesHeader."VAT Bus. Posting Group";
      "Exit Point" := SalesHeader."Exit Point";
      Area := SalesHeader.Area;
      "Transaction Specification" := SalesHeader."Transaction Specification";
      "Tax Area Code" := SalesHeader."Tax Area Code";
      "Tax Liable" := SalesHeader."Tax Liable";
      //**4PS.so
      //IF NOT "System-Created Entry" AND ("Document Type" = "Document Type"::Order) AND HasTypeToFillMandatoryFields OR
      //  IsServiceCharge
      //**4PS.eo
      //**4PS.sn
      IF ("Document Type" = "Document Type"::Order) AND HasTypeToFillMandatoryFields THEN
        IF NOT "System-Created Entry" OR ("Service Contract No." <> '') OR ("Job No." <> '') THEN
      //**4PS.en
          "Prepayment %" := SalesHeader."Prepayment %";
      "Prepayment Tax Area Code" := SalesHeader."Tax Area Code";
      "Prepayment Tax Liable" := SalesHeader."Tax Liable";
      "Responsibility Center" := SalesHeader."Responsibility Center";

      "Shipping Agent Code" := SalesHeader."Shipping Agent Code";
      "Shipping Agent Service Code" := SalesHeader."Shipping Agent Service Code";
      "Outbound Whse. Handling Time" := SalesHeader."Outbound Whse. Handling Time";
      "Shipping Time" := SalesHeader."Shipping Time";
      "Account Code DK" := SalesHeader."Account Code DK";  //NAVDK
      "Account Code NO" := SalesHeader."Account Code NO";  //NAVNO

      OnAfterInitHeaderDefaults(Rec,SalesHeader);
    END;

    LOCAL PROCEDURE InitDeferralCode@108();
    VAR
      Item@1000 : Record 27;
    BEGIN
      IF "Document Type" IN
         ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::"Credit Memo","Document Type"::"Return Order"]
      THEN
        CASE Type OF
          Type::"G/L Account":
            VALIDATE("Deferral Code",GLAcc."Default Deferral Template Code");
          Type::Item:
            BEGIN
              GetItem(Item);
              VALIDATE("Deferral Code",Item."Default Deferral Template Code");
            END;
          Type::Resource:
            VALIDATE("Deferral Code",Res."Default Deferral Template Code");
        END;
    END;

    [External]
    PROCEDURE DefaultDeferralCode@109();
    VAR
      Item@1000 : Record 27;
    BEGIN
      CASE Type OF
        Type::"G/L Account":
          BEGIN
            GLAcc.GET("No.");
            InitDeferralCode;
          END;
        Type::Item:
          BEGIN
            GetItem(Item);
            InitDeferralCode;
          END;
        Type::Resource:
          BEGIN
            Res.GET("No.");
            InitDeferralCode;
          END;
      END;
    END;

    [External]
    PROCEDURE IsCreditDocType@110() : Boolean;
    BEGIN
      EXIT("Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"]);
    END;

    LOCAL PROCEDURE IsFullyInvoiced@224() : Boolean;
    BEGIN
      EXIT(("Qty. Shipped Not Invd. (Base)" = 0) AND ("Qty. Shipped (Base)" = "Quantity (Base)"))
    END;

    LOCAL PROCEDURE CleanDropShipmentFields@112();
    BEGIN
      IF ("Purch. Order Line No." <> 0) AND IsFullyInvoiced THEN
        IF CleanPurchaseLineDropShipmentFields THEN BEGIN
          "Purchase Order No." := '';
          "Purch. Order Line No." := 0;
        END;
    END;

    LOCAL PROCEDURE CleanSpecialOrderFieldsAndCheckAssocPurchOrder@125();
    BEGIN
      IF ("Special Order Purch. Line No." <> 0) AND IsFullyInvoiced THEN
        IF CleanPurchaseLineSpecialOrderFields THEN BEGIN
          "Special Order Purchase No." := '';
          "Special Order Purch. Line No." := 0;
        END;
      CheckAssocPurchOrder('');
    END;

    LOCAL PROCEDURE CleanPurchaseLineDropShipmentFields@155() : Boolean;
    VAR
      PurchaseLine@1000 : Record 39;
    BEGIN
      IF PurchaseLine.GET(PurchaseLine."Document Type"::Order,"Purchase Order No.","Purch. Order Line No.") THEN BEGIN
        IF PurchaseLine."Qty. Received (Base)" < "Qty. Shipped (Base)" THEN
          EXIT(FALSE);

        PurchaseLine."Sales Order No." := '';
        PurchaseLine."Sales Order Line No." := 0;
        PurchaseLine.MODIFY;
      END;

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE CleanPurchaseLineSpecialOrderFields@219() : Boolean;
    VAR
      PurchaseLine@1000 : Record 39;
    BEGIN
      IF PurchaseLine.GET(PurchaseLine."Document Type"::Order,"Special Order Purchase No.","Special Order Purch. Line No.") THEN BEGIN
        IF PurchaseLine."Qty. Received (Base)" < "Qty. Shipped (Base)" THEN
          EXIT(FALSE);

        PurchaseLine."Special Order" := FALSE;
        PurchaseLine."Special Order Sales No." := '';
        PurchaseLine."Special Order Sales Line No." := 0;
        PurchaseLine.MODIFY;
      END;

      EXIT(TRUE);
    END;

    [External]
    PROCEDURE CanEditUnitOfMeasureCode@115() : Boolean;
    VAR
      ItemUnitOfMeasure@1000 : Record 5404;
    BEGIN
      IF (Type = Type::Item) AND ("No." <> '') THEN BEGIN
        ItemUnitOfMeasure.SETRANGE("Item No.","No.");
        EXIT(ItemUnitOfMeasure.COUNT > 1);
      END;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE ValidateTaxGroupCode@79();
    VAR
      TaxDetail@1001 : Record 322;
    BEGIN
      IF ("Tax Area Code" <> '') AND ("Tax Group Code" <> '') THEN
        TaxDetail.ValidateTaxSetup("Tax Area Code","Tax Group Code","Posting Date");
    END;

    [External]
    PROCEDURE InsertFreightLine@121(VAR FreightAmount@1000 : Decimal);
    VAR
      SalesLine@1001 : Record 37;
      FreightAmountQuantity@1002 : Integer;
    BEGIN
      IF FreightAmount <= 0 THEN BEGIN
        FreightAmount := 0;
        EXIT;
      END;

      FreightAmountQuantity := 1;

      SalesSetup.GET;
      SalesSetup.TESTFIELD("Freight G/L Acc. No.");

      TESTFIELD("Document Type");
      TESTFIELD("Document No.");

      SalesLine.SETRANGE("Document Type","Document Type");
      SalesLine.SETRANGE("Document No.","Document No.");
      SalesLine.SETRANGE(Type,SalesLine.Type::"G/L Account");
      SalesLine.SETRANGE("No.",SalesSetup."Freight G/L Acc. No.");
      // "Quantity Shipped" will be equal to 0 until FreightAmount line successfully shipped
      SalesLine.SETRANGE("Quantity Shipped",0);
      IF SalesLine.FINDFIRST THEN BEGIN
        SalesLine.VALIDATE(Quantity,FreightAmountQuantity);
        SalesLine.VALIDATE("Unit Price",FreightAmount);
        SalesLine.MODIFY;
      END ELSE BEGIN
        SalesLine.SETRANGE(Type);
        SalesLine.SETRANGE("No.");
        SalesLine.SETRANGE("Quantity Shipped");
        SalesLine.FINDLAST;
        SalesLine."Line No." += 10000;
        SalesLine.INIT;
        SalesLine.VALIDATE(Type,SalesLine.Type::"G/L Account");
        SalesLine.VALIDATE("No.",SalesSetup."Freight G/L Acc. No.");
        SalesLine.VALIDATE(Description,FreightLineDescriptionTxt);
        SalesLine.VALIDATE(Quantity,FreightAmountQuantity);
        SalesLine.VALIDATE("Unit Price",FreightAmount);
        SalesLine.INSERT;
      END;
    END;

    LOCAL PROCEDURE CalcTotalAmtToAssign@154(TotalQtyToAssign@1000 : Decimal) TotalAmtToAssign : Decimal;
    BEGIN
      TotalAmtToAssign := CalcLineAmount * TotalQtyToAssign / Quantity;
      IF SalesHeader."Prices Including VAT" THEN
        TotalAmtToAssign := TotalAmtToAssign / (1 + "VAT %" / 100) - "VAT Difference";

      TotalAmtToAssign := ROUND(TotalAmtToAssign,Currency."Amount Rounding Precision");
    END;

    [External]
    PROCEDURE IsLookupRequested@119() Result : Boolean;
    BEGIN
      Result := LookupRequested;
      LookupRequested := FALSE;
    END;

    [External]
    PROCEDURE TestItemFields@120(ItemNo@1000 : Code[20];VariantCode@1001 : Code[10];LocationCode@1002 : Code[10]);
    BEGIN
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.",ItemNo);
      TESTFIELD("Variant Code",VariantCode);
      TESTFIELD("Location Code",LocationCode);
    END;

    [External]
    PROCEDURE CalculateNotShippedInvExlcVatLCY@118();
    VAR
      Currency2@1000 : Record 4;
    BEGIN
      Currency2.InitRoundingPrecision;
      "Shipped Not Inv. (LCY) No VAT" :=
        ROUND("Shipped Not Invoiced (LCY)" / (1 + "VAT %" / 100),Currency2."Amount Rounding Precision");
    END;

    [External]
    PROCEDURE ClearSalesHeader@124();
    BEGIN
      CLEAR(SalesHeader);
    END;

    [External]
    PROCEDURE SendLineInvoiceDiscountResetNotification@323();
    VAR
      NotificationLifecycleMgt@1003 : Codeunit 1511;
      NotificationToSend@1000 : Notification;
    BEGIN
      IF ("Inv. Discount Amount" = 0) AND (xRec."Inv. Discount Amount" <> 0) AND ("Line Amount" <> 0) THEN BEGIN
        NotificationToSend.ID := SalesHeader.GetLineInvoiceDiscountResetNotificationId;
        NotificationToSend.MESSAGE := STRSUBSTNO(LineInvoiceDiscountAmountResetTok,RECORDID);

        NotificationLifecycleMgt.SendNotification(NotificationToSend,RECORDID);
      END;
    END;

    [External]
    PROCEDURE GetDocumentTypeDescription@156() : Text;
    VAR
      IdentityManagement@1000 : Codeunit 9801;
    BEGIN
      IF IdentityManagement.IsInvAppId AND ("Document Type" = "Document Type"::Quote) THEN
        EXIT(EstimateLbl);

      EXIT(FORMAT("Document Type"));
    END;

    [External]
    PROCEDURE FormatType@149() : Text[20];
    BEGIN
      IF Type = Type::" " THEN
        EXIT(CommentLbl);

      EXIT(FORMAT(Type));
    END;

    [External]
    PROCEDURE RenameNo@133(LineType@1000 : Option;OldNo@1001 : Code[20];NewNo@1002 : Code[20]);
    BEGIN
      RESET;
      SETRANGE(Type,LineType);
      SETRANGE("No.",OldNo);
      MODIFYALL("No.",NewNo,TRUE);
    END;

    [External]
    PROCEDURE UpdatePlanned@151() : Boolean;
    BEGIN
      TESTFIELD("Qty. per Unit of Measure");
      CALCFIELDS("Reserved Quantity");
      IF Planned = ("Reserved Quantity" = "Outstanding Quantity") THEN
        EXIT(FALSE);
      Planned := NOT Planned;
      EXIT(TRUE);
    END;

    [External]
    PROCEDURE AssignedItemCharge@153() : Boolean;
    BEGIN
      EXIT((Type = Type::"Charge (Item)") AND ("No." <> '') AND ("Qty. to Assign" < Quantity));
    END;

    LOCAL PROCEDURE UpdateLineDiscPct@189();
    VAR
      LineDiscountPct@1000 : Decimal;
      IsHandled@1001 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeUpdateLineDiscPct(Rec,IsHandled,Currency);
      IF IsHandled THEN
        EXIT;

      //**4PS.so
      //IF ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") <> 0 THEN BEGIN
      //  LineDiscountPct := ROUND(
      //      "Line Discount Amount" / ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") * 100,
      //      0.00001);
      //**4PS.eo
      //**4PS.sn
      IF ROUND(Quantity * DimensionalFactor * "Unit Price" * RentalFactor,Currency."Amount Rounding Precision") <> 0 THEN BEGIN
        LineDiscountPct := ROUND(
            "Line Discount Amount" / ROUND(Quantity * DimensionalFactor * "Unit Price" * RentalFactor,Currency."Amount Rounding Precision") * 100,
            0.00001);
      //**4PS.en
        IF NOT (LineDiscountPct IN [0..100]) THEN
          ERROR(LineDiscountPctErr);
        "Line Discount %" := LineDiscountPct;
      END ELSE
        "Line Discount %" := 0;

      OnAfterUpdateLineDiscPct(Rec);
    END;

    LOCAL PROCEDURE UpdateBaseAmounts@173(NewAmount@1000 : Decimal;NewAmountIncludingVAT@1001 : Decimal;NewVATBaseAmount@1002 : Decimal);
    BEGIN
      Amount := NewAmount;
      "Amount Including VAT" := NewAmountIncludingVAT;
      "VAT Base Amount" := NewVATBaseAmount;
      IF NOT SalesHeader."Prices Including VAT" AND (Amount > 0) AND (Amount < "Prepmt. Line Amount") THEN
        "Prepmt. Line Amount" := Amount;
      IF SalesHeader."Prices Including VAT" AND ("Amount Including VAT" > 0) AND ("Amount Including VAT" < "Prepmt. Line Amount") THEN
        "Prepmt. Line Amount" := "Amount Including VAT";
    END;

    [External]
    PROCEDURE CalcPlannedDate@218() : Date;
    BEGIN
      IF FORMAT("Shipping Time") <> '' THEN
        EXIT(CalcPlannedDeliveryDate(FIELDNO("Planned Delivery Date")));

      EXIT(CalcPlannedShptDate(FIELDNO("Planned Delivery Date")));
    END;

    LOCAL PROCEDURE IsCalcVATAmountLinesHandled@192(SalesHeader@1001 : Record 36;VAR SalesLine@1002 : Record 37;VAR VATAmountLine@1003 : Record 290) IsHandled : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCalcVATAmountLines(SalesHeader,SalesLine,VATAmountLine,IsHandled);
      EXIT(IsHandled);
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignFieldsForNo@158(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37;SalesHeader@1002 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignHeaderValues@134(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignStdTxtValues@135(VAR SalesLine@1000 : Record 37;StandardText@1001 : Record 7);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignGLAccountValues@138(VAR SalesLine@1000 : Record 37;GLAccount@1001 : Record 15);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignItemValues@136(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignItemChargeValues@137(VAR SalesLine@1000 : Record 37;ItemCharge@1001 : Record 5800);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignResourceValues@139(VAR SalesLine@1000 : Record 37;Resource@1001 : Record 156);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignFixedAssetValues@140(VAR SalesLine@1000 : Record 37;FixedAsset@1001 : Record 5600);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignItemUOM@141(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAssignResourceUOM@143(VAR SalesLine@1001 : Record 37;Resource@1000 : Record 156;ResourceUOM@1002 : Record 205);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAutoReserve@208(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCopyFromItem@230(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterDeleteChargeChargeAssgnt@267(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37;CurrentFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterFilterLinesWithItemToPlan@217(VAR SalesLine@1000 : Record 37;VAR Item@1001 : Record 27;DocumentType@1002 : Option);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterFindResUnitCost@214(VAR SalesLine@1000 : Record 37;VAR ResourceCost@1001 : Record 202);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetItemTranslation@329(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;ItemTranslation@1002 : Record 30);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetSalesHeader@241(VAR SalesLine@1000 : Record 37;VAR SalesHeader@1001 : Record 36;VAR Currency@1002 : Record 4);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetUnitCost@172(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitQtyToAsm@223(VAR SalesLine@1000 : Record 37;CallingFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterShowNonStock@263(VAR SalesLine@1000 : Record 37;NonstockItem@1001 : Record 5718);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateLineDiscPct@232(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateUnitPrice@126(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;CalledByFieldNo@1002 : Integer;CurrFieldNo@1003 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAddItem@268(VAR SalesLine@1000 : Record 37;LastSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeAddItems@252(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeAutoReserve@235(SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCalcInvDiscToInvoice@220(VAR SalesLine@1000 : Record 37;CallingFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCalcPlannedShptDate@261(VAR SalesLine@1000 : Record 37;VAR PlannedShipmentDate@1001 : Date;CallingFieldNo@1002 : Integer;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCalcVATAmountLines@190(SalesHeader@1002 : Record 36;VAR SalesLine@1001 : Record 37;VAR VATAmountLine@1000 : Record 290;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCheckAssocPurchOrder@175(VAR SalesLine@1000 : Record 37;FieldCaption@1001 : Text[250];VAR IsHandled@1002 : Boolean;xSalesLine@1003 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCheckItemAvailable@225(SalesLine@1000 : Record 37;CalledByFieldNo@1001 : Integer;VAR IsHandled@1002 : Boolean;CurrentFieldNo@1003 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCopyFromItem@222(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCrossReferenceNoAssign@193(VAR SalesLine@1000 : Record 37;ItemCrossReference@1001 : Record 5717);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeFindNoByDescription@260(SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;VAR CurrentFieldNo@1002 : Integer;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeGetDefaultBin@216(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeGetSalesHeader@262(VAR SalesLine@1000 : Record 37;VAR SalesHeader@1001 : Record 36;VAR IsHanded@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeGetUnitCost@333(SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeInitQtyToAsm@221(VAR SalesLine@1000 : Record 37;CallingFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeIsAsmToOrderRequired@314(SalesLine@1000 : Record 37;VAR Result@1001 : Boolean;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeMaxQtyToInvoice@332(SalesLine@1000 : Record 37;VAR MaxQty@1001 : Decimal;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeMaxQtyToInvoiceBase@234(SalesLine@1000 : Record 37;VAR MaxQty@1001 : Decimal;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeShowItemSub@238(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeShowReservation@242(SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeShowReservationEntries@240(SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeTestJobPlanningLine@237(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeTestStatusOpen@205(VAR SalesLine@1000 : Record 37;VAR SalesHeader@1001 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdatePrepmtAmounts@245(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdatePrepmtSetupFields@236(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateLineDiscPct@429(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean;Currency@1002 : Record 4);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateUnitPrice@127(VAR SalesLine@1003 : Record 37;xSalesLine@1002 : Record 37;CalledByFieldNo@1001 : Integer;CurrFieldNo@1000 : Integer;VAR Handled@1004 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeUpdateVATAmounts@206(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeValidateReturnReasonCode@227(VAR SalesLine@1000 : Record 37;CallingFieldNo@1001 : Integer;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeVerifyReservedQty@145(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;CalledByFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitHeaderDefaults@161(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitOutstanding@215(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitOutstandingQty@202(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitOutstandingAmount@132(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;Currency@1002 : Record 4);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitQtyToInvoice@128(VAR SalesLine@1000 : Record 37;CurrFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitQtyToShip@129(VAR SalesLine@1000 : Record 37;CurrFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitQtyToShip2@315(VAR SalesLine@1000 : Record 37;CurrFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitQtyToReceive@130(VAR SalesLine@1000 : Record 37;CurrFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcLineAmount@251(VAR SalesLine@1000 : Record 37;VAR LineAmount@1001 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcVATAmountLines@170(VAR SalesHeader@1003 : Record 36;VAR SalesLine@1002 : Record 37;VAR VATAmountLine@1001 : Record 290;QtyType@1000 : 'General,Invoicing,Shipping');
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterGetLineAmountToHandle@171(SalesLine@1000 : Record 37;QtyToHandle@1001 : Decimal;VAR LineAmount@1002 : Decimal;VAR LineDiscAmount@1003 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSalesTaxCalculate@249(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;Currency@1002 : Record 4);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSalesTaxCalculateReverse@246(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;Currency@1002 : Record 4);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetReserveWithoutPurchasingCode@233(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;Item@1002 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateAmounts@152(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1002 : Record 37;CurrentFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateAmountsDone@165(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37;CurrentFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateDates@200(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateItemCrossRef@257(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateVATAmounts@199(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateVATOnLines@162(VAR SalesHeader@1002 : Record 36;VAR SalesLine@1001 : Record 37;VAR VATAmountLine@1000 : Record 290;QtyType@1003 : 'General,Invoicing,Shipping');
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterValidateCrossReferenceNo@258(SalesLine@1000 : Record 37;ItemCrossReference@1001 : Record 5717);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateDimTableIDs@164(VAR SalesLine@1000 : Record 37;CallingFieldNo@1001 : Integer;VAR TableID@1003 : ARRAY [10] OF Integer;VAR No@1002 : ARRAY [10] OF Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterShowItemSub@166(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterValidateReturnReasonCode@174(VAR SalesLine@1000 : Record 37;CallingFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnInitQtyToShip2OnBeforeCalcInvDiscToInvoice@239(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnShowItemChargeAssgntOnBeforeCalcItemCharge@194(VAR SalesLine@1000 : Record 37;VAR ItemChargeAssgntLineAmt@1001 : Decimal;Currency@1002 : Record 4;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnUpdateUnitPriceOnBeforeFindPrice@191(SalesHeader@1000 : Record 36;VAR SalesLine@1001 : Record 37;CalledByFieldNo@1002 : Integer;CallingFieldNo@1003 : Integer;VAR IsHandled@1004 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateLocationCodeOnBeforeSetShipmentDate@201(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateTypeOnAfterCheckItem@188(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateTypeOnCopyFromTempSalesLine@167(VAR SalesLine@1000 : Record 37;VAR TempSalesLine@1001 : TEMPORARY Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateNoOnAfterInitHeaderDefaults@269(VAR SalesHeader@1000 : Record 36;VAR TempSalesLine@1001 : TEMPORARY Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateNoOnAfterUpdateUnitPrice@255(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateNoOnAfterVerifyChange@187(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateNoOnCopyFromTempSalesLine@168(VAR SalesLine@1000 : Record 37;VAR TempSalesLine@1001 : TEMPORARY Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateNoOnBeforeInitRec@31(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;CallingFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateNoOnBeforeUpdateDates@210(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;SalesHeader@1002 : Record 36;CallingFieldNo@1003 : Integer;VAR IsHandled@1004 : Boolean;VAR TempSalesLine@1005 : TEMPORARY Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateQuantityOnAfterCalcBaseQty@256(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateQuantityOnBeforeGetUnitCost@254(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateQtyToShipAfterInitQty@244(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37;CallingFieldNo@1002 : Integer;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateQtyToShipOnAfterCheck@270(VAR SalesLine@1000 : Record 37;CurrentFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateQtyToReturnAfterInitQty@250(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37;CallingFieldNo@1002 : Integer;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateReturnQtyToReceiveOnAfterCheck@273(VAR SalesLine@1000 : Record 37;CurrentFieldNo@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateVariantCodeOnAfterChecks@213(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;CallingFieldNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateVATProdPostingGroupOnBeforeCheckVATCalcType@259(VAR SalesLine@1000 : Record 37;VATPostingSetup@1001 : Record 325;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterTestStatusOpen@169(VAR SalesLine@1000 : Record 37;VAR SalesHeader@1001 : Record 36);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetDefaultQuantity@176(VAR SalesLine@1000 : Record 37;VAR xSalesLine@1001 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateTotalAmounts@68(VAR SalesLine@1000 : Record 37;SalesLine2@1001 : Record 37;VAR TotalAmount@1003 : Decimal;VAR TotalAmountInclVAT@1002 : Decimal;VAR TotalLineAmount@1005 : Decimal;VAR TotalInvDiscAmount@1004 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCheckWarehouseOnBeforeShowDialog@247(SalesLine@1000 : Record 37;Location@1001 : Record 14;ShowDialog@1004 : ' ,Message,Error';VAR DialogText@1003 : Text[50]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcShipmentDateOnPlannedShipmentDate@253(SalesLine@1000 : Record 37;VAR ShipmentDate@1001 : Date;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCopyFromItemOnAfterCheck@243(VAR SalesLine@1000 : Record 37;Item@1001 : Record 27);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnGetDeferralPostDate@159(SalesHeader@1000 : Record 36;VAR DeferralPostingDate@1001 : Date;SalesLine@1002 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterAutoAsmToOrder@179(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeAutoAsmToOrder@178(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterBlanketOrderLookup@182(VAR SalesLine@1000 : Record 37);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeBlanketOrderLookup@184(VAR SalesLine@1000 : Record 37;IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCalcPlannedDeliveryDate@203(VAR SalesLine@1000 : Record 37;VAR PlannedDeliveryDate@1001 : Date;CallingFieldNo@1002 : Integer;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeOpenItemTrackingLines@212(SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCheckCreditLimitCondition@185(SalesLine@1000 : Record 37;VAR RunCheck@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnUpdateAmountOnBeforeCheckCreditLimit@207(VAR SalesLine@1000 : Record 37;VAR IsHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnUpdateVATOnLinesOnBeforeCalculateNewAmount@264(VAR SalesLine@1000 : Record 37;SalesHeader@1001 : Record 36;VATAmountLine@1003 : Record 290;VATAmountLineReminder@1002 : Record 290;VAR NewAmount@1004 : Decimal;VAR VATAmount@1005 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateDescriptionOnBeforeCannotFindDescrError@451(VAR SalesLine@1000 : Record 37;xSalesLine@1001 : Record 37;VAR IsHandled@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcVATAmountLinesOnAfterCalcLineTotals@266(VAR VATAmountLine@1000 : Record 290;SalesHeader@1001 : Record 36;SalesLine@1002 : Record 37;Currency@1003 : Record 4;QtyType@1004 : 'General,Invoicing,Shipping';VAR TotalVATAmount@1005 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCrossReferenceNoLookupOnBeforeValidateUnitPrice@228(SalesHeader@1000 : Record 36;VAR SalesLine@1001 : Record 37);
    BEGIN
    END;

    PROCEDURE ShowDeferralSchedule@160();
    BEGIN
      GetSalesHeader;
      ShowDeferrals(SalesHeader."Posting Date",SalesHeader."Currency Code");
    END;

    PROCEDURE GetTemporarySalesLine@6503(TempSalesLine@1100525000 : TEMPORARY Record 37);
    BEGIN
      //**4PS
      "Job No." := TempSalesLine."Job No.";
      "Employee No." := TempSalesLine."Employee No." ;
      "Shortcut Dimension 1 Code" := TempSalesLine."Shortcut Dimension 1 Code";
      "Shortcut Dimension 2 Code" := TempSalesLine."Shortcut Dimension 2 Code";
      "Dimension Set ID" := TempSalesLine."Dimension Set ID";
      Description := TempSalesLine.Description;
      "Description 2" := TempSalesLine."Description 2";
      "Unit of Measure Code" := TempSalesLine."Unit of Measure Code";
      "Project Invoice" := TempSalesLine."Project Invoice";
      "Installment Invoice" := TempSalesLine."Installment Invoice";
      "Service Invoice" := TempSalesLine."Service Invoice";
      "Item No." := TempSalesLine."Item No.";
      "Basic Item" := TempSalesLine."Basic Item";
      "Trade Item" := TempSalesLine."Trade Item";
      Manufacturer := TempSalesLine.Manufacturer;
      "Vendor (Trade Item)" := TempSalesLine."Vendor (Trade Item)";
      "Service Contract No." := TempSalesLine."Service Contract No.";
      "Service Order No." := TempSalesLine."Service Order No.";
      "Service Location No." := TempSalesLine."Service Location No.";
      "Service Control Year" := TempSalesLine."Service Control Year";
      "Additional Cost (Service)" := TempSalesLine."Additional Cost (Service)";
      "Removal Contribution" := TempSalesLine."Removal Contribution";
      Element := TempSalesLine.Element;
      "Job Description" := TempSalesLine."Job Description";
      "Cost Component" := TempSalesLine."Cost Component";
      "Extension Contract" := TempSalesLine."Extension Contract";
      "Qty. per Unit of Measure" := TempSalesLine."Qty. per Unit of Measure";
      "Unit of Measure Code" := TempSalesLine."Unit of Measure Code";
      "Unit of Measure" := TempSalesLine."Unit of Measure";
      "Unit Price" := TempSalesLine."Unit Price";
      "Line Discount %" := TempSalesLine."Line Discount %";
      "Line Discount Amount" := TempSalesLine."Line Discount Amount"; //C016399
      "Plant Set Code" := TempSalesLine."Plant Set Code";
      "Plant Type" := TempSalesLine."Plant Type";
      "Plant No." := TempSalesLine."Plant No.";
      "Plant Rental Split No." := TempSalesLine."Plant Rental Split No.";
      "Number of Time Units" := TempSalesLine."Number of Time Units";
      "Balance Excl. VAT" := TempSalesLine."Balance Excl. VAT";
      "Balance Incl. VAT" := TempSalesLine."Balance Incl. VAT";
      "Blanket Order No." := TempSalesLine."Blanket Order No.";
      "Blanket Order Line No." := TempSalesLine."Blanket Order Line No.";
      "Location Code" := TempSalesLine."Location Code";
      "Bin Code" := TempSalesLine."Bin Code";
      "Return Reason Code" := TempSalesLine."Return Reason Code";
      "Rental Unit" := TempSalesLine."Rental Unit";
      "Rental Package Date" := TempSalesLine."Rental Package Date";
      "Rental Unit Line Type" := TempSalesLine."Rental Unit Line Type";
      VALIDATE(Text, TempSalesLine.Text);
      "Additional Cost (Service)" := TempSalesLine."Additional Cost (Service)";
      "Removal Contribution" := TempSalesLine."Removal Contribution";
      "Part of Line" := TempSalesLine."Part of Line";
      "BOM Item No." := TempSalesLine."BOM Item No.";
      "Recipe Group" := TempSalesLine."Recipe Group";  //DP00491
      Recipe := TempSalesLine.Recipe;                  //DP00491
      "Dimensional Factor" := TempSalesLine."Dimensional Factor"; //DP01519
      //C041434.sn
      "Unit Cost (LCY)" := TempSalesLine."Unit Cost (LCY)";  //C055716
      "Gross Price (FCY)" := TempSalesLine."Gross Price (FCY)";
      "Gross Price (LCY)" := TempSalesLine."Gross Price (LCY)";
      "Purchase Discount % (Item)" := TempSalesLine."Purchase Discount % (Item)";
      "Sales Discount % (Item)" := TempSalesLine."Sales Discount % (Item)";
      "Sales Condition Present" := TempSalesLine."Sales Condition Present";
      "Price Specification Leading" := TempSalesLine."Price Specification Leading";
      "Basic Price (FCY)" := TempSalesLine."Basic Price (FCY)";
      "Basic Price (LCY)" := TempSalesLine."Basic Price (LCY)";
      "Surcharge %" := TempSalesLine."Surcharge %";
      "Surcharge Amount (FCY)" := TempSalesLine."Surcharge Amount (FCY)";
      "Surcharge Amount (LCY)" := TempSalesLine."Surcharge Amount (LCY)";
      "Sales Price (FCY)" := TempSalesLine."Sales Price (FCY)";
      "Sales Price (LCY)" := TempSalesLine."Sales Price (LCY)";
      "Discount % (Contract)" := TempSalesLine."Discount % (Contract)";
      //C041434.en
      "Add. Cost Changed Manually" := TempSalesLine."Add. Cost Changed Manually";
      "Loan Code" := TempSalesLine."Loan Code";
      "Loan Type" := TempSalesLine."Loan Type";
      "Attached to Line No." := TempSalesLine."Attached to Line No.";  //C057041
    END;

    PROCEDURE CheckProjStatus@1100525003(ProjRec@1100525000 : Record 11072003);
    VAR
      lvBlockingCodeRec@1100525001 : Record 11012027;
    BEGIN
      //**4PS
      ProjSetupRec.GET;
      IF ("Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"]) AND
         (ProjRec."Blocking Code" <> '') AND
         (
          (ProjRec."Project Status" = ProjRec."Project Status"::"Technical Finished") OR
          (ProjRec."Project Status" = ProjRec."Project Status"::"Administrative Finished") OR
          ((ProjRec."Project Status" = ProjRec."Project Status"::Finished) AND ProjSetupRec."Provisions at Closure")
         )
      THEN
        lvBlockingCodeRec.CheckBlocked(ProjRec."Blocking Code", lvBlockingCodeRec.Switch::"Sales Invoice", ProjRec, TRUE)
      ELSE BEGIN
        IF (ProjSetupRec."Provisions at Closure") AND
           (("Document Type" > "Document Type"::Order) AND
            ("Document Type" <> "Document Type"::"Blanket Order"))
        THEN
          ProjRec.CheckProjectStatus(-1)
        ELSE
          ProjRec.CheckProjectStatus(1);
      END;
    END;

    PROCEDURE ValidateItem@6505(TypeArtOpt@1210190001 : 'Item,Basic Item,Trade Item');
    VAR
      SaveBasicItem@1210190021 : Code[20];
      SaveTradeItem@1210190022 : Code[20];
      SaveManufacturer@1210190025 : Code[20];
      SaveVendor@1210190026 : Code[20];
      SaveDesc@1210190019 : Text[100];
      ItemRec@1210190020 : Record 27;
      TradeItemRec@1100525000 : Record 11012317;
      WMSManagement@1210190000 : Codeunit 7302;
      SalesAccount@1100529900 : Code[20];
      StockkeepingUnit@1100527300 : Record 5700;
    BEGIN
      //**4PS
      TESTFIELD(Recipe, '');  //C048237
      "Price Specification Leading" := FALSE;  //DP01339 (ItemSwitch)
      FindCostPrice(TypeArtOpt);  //DP01339
      CheckCostCompServOrderType; //** 4PS03.n

      IF "Item No." = '' THEN BEGIN
        Type := Type::"G/L Account";
        IF Type <> xRec.Type THEN
          "No." := '';
      END;

      IF ("Job No." = '') AND ("Service Order No." = '') AND ("Item No." <> '') AND ("Item No." <> "No.") THEN BEGIN
        Type := Type::Item;
        SaveBasicItem := "Basic Item";
        SaveManufacturer := Manufacturer;
        SaveTradeItem := "Trade Item";
        SaveVendor := "Vendor (Trade Item)";
        SaveDesc := Description;
        VALIDATE("No.", "Item No.");  //beware of recursion between validate triggers
        //If trade-item selected with basic-item and variant of trade-item with same basic-item is
        //copied as inventory-item: do not reset chosen trade-item by validate of item
        "Basic Item" := SaveBasicItem;
        Manufacturer := SaveManufacturer;
        "Trade Item" := SaveTradeItem;
        "Vendor (Trade Item)" := SaveVendor;
        Description := SaveDesc;
      END;

      VALIDATE("Unit Cost (LCY)");
      FindSalesPrice;  //DP01339

      VALIDATE("Shortcut Dimension 2 Code");
      IF ItemRec.GET("Item No.") THEN BEGIN
        CheckIfItemIsBlocked(ItemRec);
        SaveDesc := Description;
        VALIDATE("Unit of Measure Code", ItemRec."Sales Unit of Measure");
        Description := SaveDesc;
        VALIDATE(Text, ItemRec.Text);
        "Tariff No." := ItemRec."Tariff No.";
        UpdateShelfNo;
      END ELSE BEGIN
        VALIDATE("Unit of Measure Code", "Unit of Measure Code");
      END;

      IF TypeArtOpt = TypeArtOpt::"Trade Item" THEN BEGIN
        IF TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
          "Tariff No." := TradeItemRec."CBS Code";
          "Net Weight" := TradeItemRec.GetNetWeight("Unit of Measure Code");
          IF GetSalesAccountForNonInventoryTradeItem(
            TradeItemRec, SalesAccount)
          THEN BEGIN
            IF Type =  Type::"G/L Account" THEN
              VALIDATE("No.", SalesAccount); //DP01383
          END;
        END;
      END;

      CheckDeliveryTime(FIELDNO("Item No."));  //**4PS.n

      IF ("Location Code" <> '') AND ("Item No." = '') THEN BEGIN
        GetLocation("Location Code");
        IF Location."Bin Mandatory" AND NOT Location."Directed Put-away and Pick" THEN
          "Bin Code" := WMSManagement.GetDefaultBinLocation(
            "Job No.","Service Order No.","Location Code","Item No.","Variant Code",TRUE);
      END;
    END;

    PROCEDURE RentalFactor@11012000() : Decimal;
    BEGIN
      //**4PS
      IF ("Plant Invoice" AND ("Relate to" = "Relate to"::Rental)) THEN
        EXIT("Number of Time Units");

      IF ("Document Type" IN ["Document Type"::Quote, "Document Type"::Order,
          "Document Type"::Invoice, "Document Type"::"Credit Memo"]) AND
         (("Plant Type" <> '') OR ("Plant Set Code" <> '')) AND ("Rental Starting Date" <> 0D)
      THEN BEGIN
        IF SalesLogisticsSepaRentContract() THEN
          EXIT("Number of Time Units");
        IF (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated") THEN
          EXIT("Number of Time Units");
      END;

      EXIT(1);
    END;

    PROCEDURE FillSystemCreatedEntry@1210190007();
    BEGIN
      //**4PS
      "System-Created Entry" :=
        ("Service Order No." <> '') OR //mg, 21-07-11
        ("Service Contract No." <> '') OR
        ("Job No." <> '') OR
        (("Plant Type" <> '') AND "Plant Invoice") OR
        ("Loan Code" <> '');
    END;

    PROCEDURE GetProjTypeRevenueAccount@1210190000(InterestInstallment@1100485000 : Boolean;CalledFromCostObject@1100525000 : Boolean);
    VAR
      LedgerbyProjTypeCustGr@1100529600 : Record 11229378;
    BEGIN
      //**4PS
      IF ("Job No."  = '') OR (Type = Type::" ") THEN
        EXIT;

      IF ReleaseRetention THEN
        EXIT;

      ProjSetupRec.GET;
      ProjRec.GET("Job No.");
      ProjTypeRec.GET(ProjRec."Project Type");
      ProjectTypeExtension.GetProjectTypeExtension(ProjTypeRec.Code);

      GetSalesHeader;
      IF NOT LedgerbyProjTypeCustGr.GET(ProjRec."Project Type", SalesHeader."Customer Posting Group") THEN
        CLEAR(LedgerbyProjTypeCustGr);

      IF "Advance Payment" THEN BEGIN
        ProjTypeRec.TESTFIELD("Advance Payment Account");
        "No." := ProjTypeRec."Advance Payment Account";
      END ELSE BEGIN
        DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimVal, FALSE, "Job No.");
        IF (ProjRec."Project Status" >= ProjRec."Project Status"::Finished) AND ProjSetupRec."Provisions at Closure" THEN BEGIN
          IF (NOT ProjSetupRec."Rental Units active") OR ("Rental Unit" = '') OR ("Rental Unit Line Type" = 0) THEN BEGIN  //*C017909.c
            IF LedgerbyProjTypeCustGr."Provision Account Revenue" <> '' THEN
              "No." := LedgerbyProjTypeCustGr."Provision Account Revenue"
            ELSE
              "No." := ProjTypeRec.GetWipAcc(ProjTypeRec.Code, DimVal."Cost Type", ProjRec."Project Status",
                                     ProjSetupRec."Provisions at Closure", COMPANYNAME, DimVal."Cost Type", '', '')
          END ELSE BEGIN
            ProjTypeRec.TESTFIELD("Provision Account Rental UR");
            "No." := ProjTypeRec."Provision Account Rental UR";
          END;
        END ELSE BEGIN
          IF (NOT ProjSetupRec."Rental Units active") OR ("Rental Unit" = '') OR ("Rental Unit Line Type" = 0) THEN BEGIN  //*C017909.c
            IF (DimVal."Cost Type" = DimVal."Cost Type"::Revenue) AND ("Cost Object Cost Plus Line" <> '') THEN BEGIN
              "No." := ProjTypeRec.GetWipRevenueAcc("Cost Type Cost Plus Line", InterestInstallment, COMPANYNAME, SalesHeader."Customer Posting Group");
            END ELSE BEGIN
              //**dp01739.sn
              IF (DimVal."Cost Type" <> DimVal."Cost Type"::Revenue) AND
                 (ProjSetupRec."Fill Allowed Cost" = ProjSetupRec."Fill Allowed Cost"::"No restriction")
              THEN
                "No." := ProjTypeRec.GetWipAcc(ProjTypeRec.Code, DimVal."Cost Type", ProjRec."Project Status",
                                       ProjSetupRec."Provisions at Closure", COMPANYNAME, DimVal."Cost Type", '', '')
              ELSE
              //**dp01739.en
                "No." := ProjTypeRec.GetWipRevenueAcc(DimVal."Cost Type", InterestInstallment, COMPANYNAME, SalesHeader."Customer Posting Group");
            END;
          END ELSE BEGIN
            CASE "Rental Unit Line Type" OF
              "Rental Unit Line Type"::ServiceCost:
                IF LedgerbyProjTypeCustGr."Rental Unit Service Cost Rev." <> '' THEN
                  "No." := LedgerbyProjTypeCustGr."Rental Unit Service Cost Rev."
                ELSE BEGIN
                  ProjTypeRec.TESTFIELD("Rental Unit Service Cost Rev.");
                  "No." := ProjTypeRec."Rental Unit Service Cost Rev.";
                END;
              "Rental Unit Line Type"::Utilities:
                IF LedgerbyProjTypeCustGr."Rental Unit Acc Utilities Rev." <> '' THEN
                  "No." := LedgerbyProjTypeCustGr."Rental Unit Acc Utilities Rev."
                ELSE BEGIN
                  ProjTypeRec.TESTFIELD("Rental Unit Acc Utilities Rev.");
                  "No." := ProjTypeRec."Rental Unit Acc Utilities Rev.";
                END;
              "Rental Unit Line Type"::"One-off Costs":
                BEGIN
                  ProjectTypeExtension.TESTFIELD("Rental Unit One-off Cost Rev.");
                  "No." := ProjectTypeExtension."Rental Unit One-off Cost Rev.";
                END;
              "Rental Unit Line Type"::Deposit:
                BEGIN
                  ProjectTypeExtension.TESTFIELD("Rental Unit Deposit Revenue");
                  "No." := ProjectTypeExtension."Rental Unit Deposit Revenue";
                END;
              ELSE
                IF LedgerbyProjTypeCustGr."Rental Unit Account Revenue" <> '' THEN
                  "No." := LedgerbyProjTypeCustGr."Rental Unit Account Revenue"
                ELSE BEGIN
                  ProjTypeRec.TESTFIELD("Rental Unit Account Revenue");
                  "No." := ProjTypeRec."Rental Unit Account Revenue";
                END;
            END;
          END;
        END;
      END;
      IF NOT (CalledFromCostObject AND ("Service Order No." + "Service Contract No." <> '')) THEN
        VALIDATE("No.");
    END;

    PROCEDURE GetServTypeRevenueAccount@1100485000();
    VAR
      ServContract@1100485001 : Record 11012812;
      ServOrder@1100485002 : Record 11012823;
      ServType@1100485000 : Record 11012814;
      ServiceCategory@1100529600 : Record 11071985;
      VatGrp@1100485003 : Code[20];
    BEGIN
      //**4PS
      IF ("Service Order No." + "Service Contract No." = '') OR (Type = Type::" ") THEN
        EXIT;

      IF "Service Order No." <> '' THEN BEGIN
        ServOrder.GET("Service Order No.");
        //C016204
        IF ServOrder.IsPlantServiceOrder THEN
          EXIT;
        //
        IF "Additional Cost (Service)" = TRUE THEN
          ServType.GET(ServOrder."Service Type (Other)")
        ELSE
          ServType.GET(ServOrder."Service Type");
        VatGrp := ServOrder."VAT Prod. Posting Group";
      END ELSE BEGIN
        ServContract.GET("Service Contract No.");
        IF NOT ServiceCategory.GetServiceType("Service Contract No.", "Service Category", "Additional Cost (Service)", ServType) THEN
          IF "Additional Cost (Service)" THEN
            ServType.GET(ServContract."Service Type (Other)")
          ELSE
            ServType.GET(ServContract."Service Type");
        VatGrp := ServContract."VAT Prod. Posting Group";
      END;

      GetSalesHeader;
      DimMgt.GetDimValueRec(2,"Shortcut Dimension 2 Code",DimVal,FALSE,"Job No.");
      IF (DimVal."Cost Type" = DimVal."Cost Type"::Revenue) AND ("Cost Object Cost Plus Line" <> '') THEN BEGIN
        "No." := ServType.GetWipRevenueAcc("Cost Type Cost Plus Line", COMPANYNAME, SalesHeader."Customer Posting Group");
      END ELSE BEGIN
        "No." := ServType.GetWipRevenueAcc(DimVal."Cost Type", COMPANYNAME, SalesHeader."Customer Posting Group");
      END;

      VALIDATE("No.");
      VALIDATE("VAT Prod. Posting Group", VatGrp);
    END;

    PROCEDURE AccountDescription@1210190011() : Text[100];
    BEGIN
      //**4PS
      IF ("No." = '') OR (Type <> Type::"G/L Account") THEN
        EXIT('');

      GLAcc.GET("No.");
      EXIT(GLAcc.Name);
    END;

    PROCEDURE UpdateAmountLCY@1210190004();
    VAR
      Currency2@11012000 : Record 4;
    BEGIN
      //**4PS
      Currency2.InitRoundingPrecision;
      IF SalesHeader."Currency Code" <> '' THEN
        "Amount (LCY)" :=
          ROUND(
            CurrExchRate.ExchangeAmtFCYToLCY(
              1, //**4PS.n
              "Job No.", //**4PS.n
              GetDate,"Currency Code",
              "Line Amount",SalesHeader."Currency Factor",TRUE),
            Currency2."Amount Rounding Precision")
      ELSE
        "Amount (LCY)" :=
          ROUND("Line Amount",Currency2."Amount Rounding Precision");
    END;

    LOCAL PROCEDURE HandleLookupItemUnit@1210190008();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      //**4PS
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure Code") THEN
        VALIDATE("Unit of Measure Code", lvUnit);
    END;

    PROCEDURE InitRecord@1210190005();
    VAR
      SalesHeaderExtension@1100528400 : Record 11071868;
      lvVatBusPostGroup@1100485000 : Code[10];
    BEGIN
      //**4PS
      IF "Document No." = '' THEN BEGIN
        CLEAR(SalesHeader);
        EXIT;
      END;

      SalesHeader.GET("Document Type", "Document No.");
      IF (SalesHeader.Status <> SalesHeader.Status::Open) OR
         ((SalesHeader."Document Type" IN [SalesHeader."Document Type"::Invoice, SalesHeader."Document Type"::"Credit Memo"]) AND
          (SalesHeader."Project Invoice" OR SalesHeader."Plant Invoice" OR SalesHeader."Service Invoice"))
      THEN
        EXIT;

      "Dimension Set ID" := SalesHeader."Dimension Set ID";
      IF ("Shortcut Dimension 1 Code" <> '') AND //* Can be filled by DPA
         (SalesHeader."Shortcut Dimension 1 Code" <> "Shortcut Dimension 1 Code") THEN
        ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");

      IF SalesHeader."Job No." <> '' THEN BEGIN
        ProjSetupRec.GET;
        IF ProjRec.GET(SalesHeader."Job No.") THEN BEGIN
          IF NOT ProjPrincipRec.GET(SalesHeader."Job No.", SalesHeader."Sell-to Customer No.") THEN
            ProjPrincipRec.INIT;
          IF NOT SalesHeader."Extended VAT Determination" THEN //hs, 29-10-2007
            IF (ProjPrincipRec."VAT Bus. Posting Group" <> '') THEN
              lvVatBusPostGroup := ProjPrincipRec."VAT Bus. Posting Group"
            ELSE
              lvVatBusPostGroup := ProjRec."VAT Bus. Posting Group";
          IF (ProjRec.Blocked < ProjRec.Blocked::All) AND (ProjRec."Project Type" <> '') AND (lvVatBusPostGroup <> '') THEN BEGIN
            IF "Installment Invoice" OR
               ProjPrincipRec.GET(SalesHeader."Job No.",SalesHeader."Sell-to Customer No.") THEN BEGIN
              IF "Document Type" <= "Document Type"::Order THEN BEGIN
                IF ProjRec."Project Status" < (ProjRec."Project Status"::"Technical Finished") THEN
                  VALIDATE("Job No.", SalesHeader."Job No.");
              END ELSE BEGIN
                IF (ProjSetupRec."Provisions at Closure") AND
                   (("Document Type" > "Document Type"::Order) AND
                   ("Document Type" <> "Document Type"::"Blanket Order"))
                THEN BEGIN
                  IF ProjRec."Project Status" < (ProjRec."Project Status"::Archive) THEN
                    VALIDATE("Job No.", SalesHeader."Job No.");
                END ELSE
                  IF ProjRec."Project Status" < (ProjRec."Project Status"::"Administrative Finished") THEN
                    VALIDATE("Job No.", SalesHeader."Job No.");
              END;
            END;
          END;
        END;
      END;

      IF SalesHeader."Service Order No." <> '' THEN
        IF ServOrderRec.GET(SalesHeader."Service Order No.") THEN
          IF "Document Type" <= "Document Type"::Order THEN
            IF ServOrderRec.Status < ServOrderRec.Status::"Technical Finished" THEN
              VALIDATE("Service Order No.", SalesHeader."Service Order No.");

      IF SalesHeaderExtension.GET("Document Type", "Document No.") THEN
        IF SalesHeaderExtension."Service Location No." <> '' THEN
          VALIDATE("Service Location No.", SalesHeaderExtension."Service Location No.");
    END;

    PROCEDURE DirectDelivery@1210190006() : Boolean;
    VAR
      lvCustRec@1100485000 : Record 18;
    BEGIN
      //**4PS
      GetSalesHeader;
      IF lvCustRec.GET(SalesHeader."Sell-to Customer No.") THEN
        CASE lvCustRec."Direct Delivery" OF
          lvCustRec."Direct Delivery"::No: EXIT(FALSE);
          lvCustRec."Direct Delivery"::Yes: EXIT(TRUE);
          lvCustRec."Direct Delivery"::"Yes - project/service only":
            EXIT(("Job No." <> '') OR ("Service Order No." <> ''));
        END
      ELSE BEGIN
        SalesSetup.GET;
        CASE SalesSetup."Direct Delivery" OF
          SalesSetup."Direct Delivery"::No: EXIT(FALSE);
          SalesSetup."Direct Delivery"::Yes: EXIT(TRUE);
          SalesSetup."Direct Delivery"::"Yes - project/service only":
            EXIT(("Job No." <> '') OR ("Service Order No." <> ''));
        END;
      END;
    END;

    PROCEDURE PlantRelatedInvoice@1100485001(IProjNo@1100485001 : Code[20];ISalesHeaderRec@1100485002 : Record 36) : Boolean;
    VAR
      lvProjRec@1100485000 : Record 11072003;
    BEGIN
      //**4PS
      IF ISalesHeaderRec."Plant Invoice" THEN
        EXIT(TRUE);

      IF ISalesHeaderRec."Project Invoice" AND (IProjNo <> '') THEN BEGIN
        IF lvProjRec.GET(IProjNo) THEN BEGIN
          IF (lvProjRec."Small Project" AND lvProjRec."Plant Job Order") THEN
            EXIT(TRUE);
        END;
      END;

      EXIT(FALSE);
    END;

    PROCEDURE SuspendUpdateVATAmounts@1100485002(lUpdateVATAmountsSuspended@1100485000 : Boolean);
    BEGIN
      //**4PS
      UpdateVATAmountsSuspended := lUpdateVATAmountsSuspended;
    END;

    PROCEDURE SalesLogisticsSeparated@1100485012() : Boolean;
    BEGIN
      //**4PS
      IF ("Document Type" IN ["Document Type"::Quote, "Document Type"::Order]) THEN BEGIN
        GetSalesHeader;
        IF (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated") THEN
          EXIT(SalesLogisticsSepaRentContract());
      END;

      EXIT(FALSE);
    END;

    PROCEDURE SalesLogisticsSepaRentContract@1100485006() : Boolean;
    VAR
      PlantMgtCompRec@1100485000 : Record 11020586;
    BEGIN
      //**4PS
      //* 'Sales/logistic separated' (Rental quotes/-orders) or 'Rental Contracts'
      GetSalesHeader;
      IF (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated") AND
         ("Document Type" IN ["Document Type"::Quote, "Document Type"::Order])
      THEN BEGIN
        IF CompanyLogistics = '' THEN BEGIN
          PlantMgtCompRec."Plant Company" := PlantMgtCompRec.GetPlantCompanySalesRental(TRUE);
          CompanyLogistics := PlantMgtCompRec."Plant Company";
        END;
        EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    PROCEDURE GetCompanyLogistics@1100485007() : Text[50];
    BEGIN
      //**4PS
      IF SalesLogisticsSepaRentContract THEN
        EXIT(CompanyLogistics)
      ELSE
        EXIT('');
    END;

    PROCEDURE LookupPlantType@1100485009(IEditable@1100485000 : Boolean);
    VAR
      lvPlantTypeRec@1100485001 : Record 11012551;
    BEGIN
      //**4PS.n
      IF SalesLogisticsSeparated() THEN
        lvPlantTypeRec.CHANGECOMPANY(CompanyLogistics);
      lvPlantTypeRec.Code := "Plant Type";
      IF NOT IEditable THEN
        PAGE.RUNMODAL(0, lvPlantTypeRec)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, lvPlantTypeRec) = ACTION::LookupOK THEN
          VALIDATE("Plant Type", lvPlantTypeRec.Code);
      END;
    END;

    PROCEDURE LookupPlantNo@1100485005(IEditable@1100485000 : Boolean);
    VAR
      lvPlantNoRec@1100485002 : Record 11012552;
    BEGIN
      //**4PS.n
      IF SalesLogisticsSeparated() THEN
        lvPlantNoRec.CHANGECOMPANY(CompanyLogistics);
      lvPlantNoRec."Plant Type" := "Plant Type";
      lvPlantNoRec."No." := "Plant No.";
      IF NOT IEditable THEN
        PAGE.RUNMODAL(0, lvPlantNoRec)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, lvPlantNoRec) = ACTION::LookupOK THEN
          VALIDATE("Plant No.", lvPlantNoRec."No.");
      END;
    END;

    PROCEDURE DeterminePlantNoOfTimeUnits@1100485011();
    VAR
      lvPlantLocRec@1100485001 : Record 11012554;
      lvCalcRentalPeriodsCU@1100485000 : Codeunit 11012568;
      lvRateType@1100485005 : Option;
      lvPlantType@1100485002 : Code[20];
      lvPlantNo@1100485004 : Code[10];
      lvWholeWeeks@1100485006 : Integer;
      lvRemainingDays@1100485003 : Integer;
    BEGIN
      //**4PS.n
      IF "Plant Invoice" THEN
        EXIT;

      IF ("Plant Type" = '') AND ("Plant Set Code" = '') THEN BEGIN
        "Number of Time Units" := 0;
        "Rate Type" := "Rate Type"::" ";
        EXIT;
      END;

      IF SalesLogisticsSeparated() THEN BEGIN
        lvCalcRentalPeriodsCU.SetCompany(CompanyLogistics);
        lvPlantLocRec.CHANGECOMPANY(CompanyLogistics);
      END;
      IF (SalesHeader."Plant Location Code" = '') OR (NOT lvPlantLocRec.GET(SalesHeader."Plant Location Code")) THEN
        lvPlantLocRec.INIT;

      lvPlantType := "Plant Type";
      lvPlantNo := "Plant No.";

      "Number of Time Units" :=
        lvCalcRentalPeriodsCU.NumberRentalPeriods(
          lvPlantLocRec, "Rental Starting Date", "Rental Ending Date", lvPlantType, lvPlantNo, lvRateType);
      "Rate Type" := lvRateType + 1;
      IF "Rate Type" = "Rate Type"::Week THEN BEGIN
        SalesSetup.GET;
        IF SalesSetup."Min. Days To Invoice one Week" > 0 THEN BEGIN
          //Round to whole
          lvWholeWeeks := (7 * "Number of Time Units") DIV 7;
          lvRemainingDays := ROUND((7 * "Number of Time Units") MOD 7, 1);
          IF lvRemainingDays >= SalesSetup."Min. Days To Invoice one Week" THEN
            "Number of Time Units" := lvWholeWeeks + 1
          ELSE
            "Number of Time Units" := lvWholeWeeks;
        END;
      END;

      UpdateAmounts;
    END;

    PROCEDURE GetPlantRentalRate@1100485003();
    VAR
      lvSearchRateCU@1100485002 : Codeunit 11012567;
      lvRefDate@1100485000 : Date;
      lvRate@1100485001 : Decimal;
      lvPlantLoc@1100485004 : Code[20];
    BEGIN
      //**4PS.n
      IF "Plant Invoice" THEN
        EXIT;
      IF ("Plant Type" = '') AND ("Plant Set Code" = '') THEN
        EXIT;

      GetSalesHeader;
      IF "Rental Starting Date" <> 0D THEN
        lvRefDate := "Rental Starting Date"
      ELSE
        lvRefDate := SalesHeader."Shipment Date";

      IF ("Plant Type" <> '') THEN BEGIN
        //* Function in codeunit always gives Rate in the inventory unit of the Plant.
        //* So convert to unit of sales line.
        //* Because location is probably unknown, and there are no rates per location in the sales company,
        //* add the customer number from the header. At "Sales Logistics Separated" and "Rental Contract" always
        //* external rates, therefor not add the location (you never work there with rates per location).
        lvPlantLoc := SalesHeader."Plant Location Code";
        IF (SalesHeader."Sales Document Type" = SalesHeader."Sales Document Type"::"Sales Logistics Separated") THEN
          lvPlantLoc := '';
        lvRate := lvSearchRateCU.RateWithCust(
          lvPlantLoc, SalesHeader."Sell-to Customer No.",
          "Plant Type", "Plant No.", '',lvRefDate, 0, 0, '');
        PlantQtyPerUnitOfMeasure("Unit of Measure Code");
        VALIDATE("Unit Price", lvRate * "Qty. per Unit of Measure");
      END;
    END;

    PROCEDURE GetPlantRentalDiscount@1100485023();
    VAR
      lvSearchRateCU@1100485002 : Codeunit 11012567;
      lvRefDate@1100525000 : Date;
    BEGIN
      //**4PS.n
      IF "Plant Invoice" THEN
        EXIT;
      IF ("Plant Type" = '') THEN
        EXIT;

      IF SalesLogisticsSeparated() THEN  //* 'Line discount percentage' will be used for difference between the offer amount
        EXIT;                            //* and total quote-/orderlines. So (for know) this way

      GetSalesHeader;
      IF "Rental Starting Date" <> 0D THEN
        lvRefDate := "Rental Starting Date"
      ELSE
        lvRefDate := SalesHeader."Shipment Date";

      VALIDATE("Line Discount %", lvSearchRateCU.RentalDiscount(
        SalesHeader."Plant Location Code", SalesHeader."Sell-to Customer No.", "Plant Type", "Plant No.", lvRefDate));
    END;

    PROCEDURE PlantQtyPerUnitOfMeasure@1100485008(IRateUnit@1100485000 : Code[10]);
    VAR
      lvPlantUnitsRec@1100485002 : Record 11012599;
      lvPlantTypeRec@1100485005 : Record 11012551;
    BEGIN
      //**4PS.n
      IF "Plant Type" = '' THEN
        EXIT;
      IF ResourceRequestInvoice THEN
        EXIT;

      lvPlantTypeRec.GET("Plant Type");
      IF (IRateUnit = '') OR (IRateUnit = lvPlantTypeRec."Unit of Measure") THEN
        "Qty. per Unit of Measure" := 1
      ELSE BEGIN
        lvPlantUnitsRec.GET("Plant Type", IRateUnit);
        lvPlantUnitsRec.TESTFIELD("Qty. per Unit of Measure");
        "Qty. per Unit of Measure" := lvPlantUnitsRec."Qty. per Unit of Measure";
      END;
    END;

    PROCEDURE ModifyForLogisticsSeparated@1100485004();
    BEGIN
      //**4PS.n
      IF NOT ("Document Type" IN ["Document Type"::Quote, "Document Type"::Order]) THEN
        EXIT;

      IF ("Line Amount" = xRec."Line Amount") AND ("Alternative No." = xRec."Alternative No.") THEN
        EXIT;

      IF NOT CheckModifyForLogSepAllowed(TRUE) THEN
        EXIT;

      IF NOT SalesLogisticsSeparated() THEN
        EXIT;

      ResetOfferedAmount("Alternative No.");
      IF "Alternative No." <> xRec."Alternative No." THEN
        ResetOfferedAmount(xRec."Alternative No.");
    END;

    PROCEDURE CheckModifyForLogSepAllowed@1100485017(lShowError@1100485000 : Boolean) lModifyAllowed : Boolean;
    VAR
      lvPlantOrderRec@1100485001 : Record 11012556;
      lvText001@1100485002 : TextConst 'ENU=Modify orderline not allowed, plant order ''%1'' has status ''%2''.;NOR=Det er ikke tillatt † endre ordreraden. Maskinordre ''%1'' har status ''%2''.;SVE=Det „r inte till†tet att „ndra orderraden. Maskinorder ''%1'' har statusv„rdet ''%2''.';
    BEGIN
      //**4PS
      lModifyAllowed := TRUE;
      IF ("Document Type" = "Document Type"::Order) AND ("Arrival Order" <> '') THEN BEGIN
        IF SalesLogisticsSepaRentContract() THEN BEGIN
          lvPlantOrderRec.CHANGECOMPANY(CompanyLogistics);
          IF ("Arrival Order" <> '') THEN BEGIN
            IF lvPlantOrderRec.GET("Arrival Order") THEN BEGIN
              IF lvPlantOrderRec.Status <> lvPlantOrderRec.Status::Open THEN
                IF ("Item No." <> xRec."Item No.") OR
                   (Manufacturer <> xRec.Manufacturer) OR
                   ("Basic Item" <> xRec."Basic Item") OR
                   ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") OR
                   ("Trade Item" <> xRec."Trade Item") OR
                   ("Variant Code" <> xRec."Variant Code") OR
                   ("Plant Type" <> xRec."Plant Type") OR
                   ("Plant No." <> xRec."Plant No.") OR
                   (Type <> xRec.Type) OR
                   ("Arrival Date" <> xRec."Arrival Date") OR
                   ("Rental Starting Date" <> xRec."Rental Starting Date") OR
                   (Quantity <> xRec.Quantity) OR
                   ("Unit of Measure Code" <> xRec. "Unit of Measure Code") THEN
                BEGIN
                  lModifyAllowed := FALSE;
                  IF lShowError THEN
                    ERROR(lvText001, lvPlantOrderRec."No.", lvPlantOrderRec.Status);
                END;
            END;
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE ResetOfferedAmount@1100485024(AlternativeInt@1100485000 : Integer);
    VAR
      lvAltOfferAmountRec@1100485001 : Record 11012786;
    BEGIN
      //**4PS
      IF lvAltOfferAmountRec.GET("Document Type","Document No.",AlternativeInt) THEN BEGIN
        IF lvAltOfferAmountRec."Offer Amount" <> 0 THEN BEGIN
          lvAltOfferAmountRec."Offer Amount" := 0;
          lvAltOfferAmountRec.MODIFY;
          MESSAGE(
            Text11012005, lvAltOfferAmountRec.FIELDCAPTION("Offer Amount"),
            FIELDCAPTION("Alternative No."),AlternativeInt);
          VALIDATE("Line Discount %", 0);
          lvAltOfferAmountRec.DistributeOfferAmounts("Document Type", "Document No.", "Line No.", FALSE, 0);
        END;
      END;
    END;

    PROCEDURE GetTranslatedPlantDesc@1100485010(MaxLen@1100529000 : Integer) : Text;
    VAR
      lvPlantNoRec@1100485000 : Record 11012552;
      lvPlantTypeRec@1100485003 : Record 11012551;
      lvPlantTransRec@1100485001 : Record 11012542;
    BEGIN
      //**4PS
      IF ("Plant Type" <> '') THEN BEGIN
        GetSalesHeader;
        IF (SalesHeader."Language Code" <> '') THEN
          IF "Plant No." <> '' THEN
            IF lvPlantTransRec.GET(lvPlantTransRec.Type::PlantNo,"Plant Type","Plant No.",SalesHeader."Language Code") THEN
              IF lvPlantTransRec.Translation <> '' THEN
                EXIT(COPYSTR(lvPlantTransRec.Translation, 1, MaxLen));
          IF lvPlantTransRec.GET(lvPlantTransRec.Type::PlantType,"Plant Type",'',SalesHeader."Language Code") THEN
            IF lvPlantTransRec.Translation <> '' THEN
              EXIT(COPYSTR(lvPlantTransRec.Translation, 1, MaxLen));

        IF "Plant No." <> '' THEN
          IF lvPlantNoRec.GET("Plant Type", "Plant No.") THEN
            EXIT(lvPlantNoRec.Description);

        IF lvPlantTypeRec.GET("Plant Type") THEN
          EXIT(lvPlantTypeRec.Description);
      END;

      EXIT('');
    END;

    PROCEDURE CheckSellBillToCustomer@1100485013();
    BEGIN
      //**4PS
      GetSalesHeader;
      IF SalesHeader."Document Type" = SalesHeader."Document Type"::Quote THEN BEGIN
        IF (SalesHeader."Sell-to Customer No." = '') AND
           (SalesHeader."Sell-to Contact No." = '') AND
           (SalesHeader."Sell-to Customer Template Code" = '')
        THEN
          ERROR(
            Text031,
            SalesHeader.FIELDCAPTION("Sell-to Customer No."),
            SalesHeader.FIELDCAPTION("Sell-to Contact No."),
            SalesHeader.FIELDCAPTION("Sell-to Customer Template Code"));
        IF (SalesHeader."Bill-to Customer No." = '') AND
           (SalesHeader."Bill-to Contact No." = '') AND
           (SalesHeader."Bill-to Customer Template Code" = '')
        THEN
          ERROR(
            Text031,
            SalesHeader.FIELDCAPTION("Bill-to Customer No."),
            SalesHeader.FIELDCAPTION("Bill-to Contact No."), //**4PS.n
            SalesHeader.FIELDCAPTION("Bill-to Customer Template Code"));
      END ELSE
        IF NOT PlantRelatedInvoice(SalesHeader."Job No.", SalesHeader) THEN
          SalesHeader.TESTFIELD("Sell-to Customer No.");

      "Sell-to Customer No." := SalesHeader."Sell-to Customer No.";
    END;

    PROCEDURE PlantOrderIsProcessed@1100485018(iShowError@1100485001 : Boolean) : Boolean;
    VAR
      lvPlantOrderRec@1100485000 : Record 11012556;
    BEGIN
      //**4PS
      IF ("Document Type" = "Document Type"::Order) AND (Type <> Type::" ") THEN
        IF SalesLogisticsSeparated THEN
          IF "Arrival Order" <> '' THEN BEGIN
            lvPlantOrderRec.CHANGECOMPANY(GetCompanyLogistics);
            IF lvPlantOrderRec.GET("Arrival Order") THEN
              IF lvPlantOrderRec.Status <> lvPlantOrderRec.Status::Open THEN
                IF iShowError THEN
                  ERROR(Text11012006, "Line No.")
                ELSE
                  EXIT(TRUE);
          END;

      EXIT(FALSE);
    END;

    PROCEDURE ItemIsRemovalOnly@1100485019() : Boolean;
    VAR
      lvRemovalItemRec@1100485000 : Record 11012545;
    BEGIN
      //**4PS
      IF "Item No." = '' THEN
        EXIT(FALSE);

      EXIT(lvRemovalItemRec.GET("Item No."));
    END;

    PROCEDURE GetSurchargePerc@1100485020() : Decimal;
    VAR
      Customer@1100485001 : Record 18;
      ProjectPrincipal@1100485002 : Record 11012005;
      ServiceContract@1100525001 : Record 11012812;
      ServiceOrderExtension@1100525000 : Record 11071727;
      ProjSetup@1100528900 : Record 315;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      SESetup@1100285102 : Record 11128004;
      Cust@1100285101 : Record 18;
      UCLCY@1100285100 : Decimal;
    BEGIN
      //Orango 200430
      IF SESetup.GET(SESetup."Line type"::Setup,'SURCHARGE','SPECIAL') THEN BEGIN
        IF SESetup."Value (bool)" THEN BEGIN
        "Sales Condition Present" := ValidateCu.GetSalesDiscountSurcharge(
          SalesHeader."Bill-to Customer No.", "Item No.", "Basic Item", "Trade Item",
          Manufacturer, "Vendor (Trade Item)", UCLCY, "Surcharge %", "Basic Price (LCY)", WORKDATE, '',
          '', '', '','');
          IF "Surcharge %" <> 0 THEN BEGIN
          "Sales Condition Present" := ValidateCu.GetSalesDiscountSurcharge(
            SalesHeader."Bill-to Customer No.", "Item No.", "Basic Item", "Trade Item",
            Manufacturer, "Vendor (Trade Item)", UCLCY, "Surcharge %", "Unit Cost (LCY)", WORKDATE, '',
            '', '', '','');

            VALIDATE("Basic Price (LCY)","Unit Cost (LCY)");
            EXIT("Surcharge %");
          END ELSE BEGIN
            IF Cust.GET(SalesHeader."Bill-to Customer No.") THEN BEGIN
              "Surcharge %" :=  Cust."Surcharge % Purchase Price";
              IF "Surcharge %" <> 0 THEN BEGIN
                VALIDATE("Basic Price (LCY)","Unit Cost (LCY)");
                EXIT("Surcharge %");
              END;
            END ELSE BEGIN
              IF "Surcharge %" = 0 THEN
                VALIDATE("Basic Price (LCY)");
            END;
          END;
        END;
      END;
      //ORANGO 200430
      //**4PS
      IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlantNumber) THEN BEGIN
        IF NOT PlantNumber.CheckExternalPostNoSurcharge("Plant Type", "Plant No.", FALSE) THEN
          EXIT(0)
      END;
      //DP01339.sn
      ProjSetup.GET;
      IF ProjSetup."Apply SurchMat PriceZero Only" THEN
        IF "Trade Item" + "Basic Item" + "Item No." <> '' THEN
          IF "Sales Condition Present" THEN
            EXIT(0);
      //DP01339.en
      IF "Service Order No." <> '' THEN BEGIN
        ServOrderRec.GET("Service Order No.");
        //DP01339.sn
        //function on ServiceOrderCostPlus supports more options
        IF ServiceOrderExtension.GET("Service Order No.") THEN
          EXIT(ServiceOrderExtension."Surcharge % Material");
        //DP01339.en
        IF ServiceContract.GET(ServOrderRec."Service Contract No.") THEN
          EXIT(ServiceContract."Surcharge % Material");
      END ELSE BEGIN
        IF "Job No." <> '' THEN BEGIN
          IF ProjectPrincipal.GET("Job No.","Sell-to Customer No.") THEN
            EXIT(ProjectPrincipal."Surcharge % Material");
        END;
      END;
      GetSalesHeader;  //C041434
      IF Customer.GET(SalesHeader."Sell-to Customer No.") THEN  //C041434
        EXIT(Customer."Surcharge % Material");
      EXIT("Surcharge %");
    END;

    PROCEDURE CheckCostCompServOrderType@1100485021();
    VAR
      lvCostCompRec@1100485000 : Record 11012012;
    BEGIN
      //**4PS
      DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimVal, FALSE, "Job No.");
      lvCostCompRec.CheckDefaultCostComponent("Service Order No.", "Cost Component", '', DimVal."Cost Type",
        "Additional Cost (Service)");
    END;

    PROCEDURE GetReferenceData@1100485022(VAR lvRefDate@1100485000 : Date;VAR lvDiscRef1@1100485001 : Code[20];VAR lvDiscRef2@1100485002 : Code[20];VAR lvRefPrio@1100525001 : Code[10];lvDiscType@1100525000 : 'Purchase,Sales');
    VAR
      Customer@1100528900 : Record 18;
    BEGIN
      //**4PS
      //C041255.sn
      GetSalesHeader;
      IF "Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"] THEN
        lvRefDate := SalesHeader."Posting Date"
      ELSE
        lvRefDate := SalesHeader."Order Date";
      //C041255.en
      IF "Service Order No." <>'' THEN BEGIN
        ServOrderRec.GET("Service Order No.");
        IF ServContrRec.GET(ServOrderRec."Service Contract No.") THEN
          lvRefPrio := ValidateCu.GetRefPrioServContract(ServContrRec, lvDiscType);  //DP01339
        ValidateCu.GetRefDiscServOrder(ServOrderRec, lvDiscRef1, lvDiscRef2, lvDiscType);  //DP01339
      END ELSE BEGIN
        IF "Job No." <>'' THEN BEGIN
          ProjRec.GET("Job No.");
          lvRefPrio := ValidateCu.GetRefPrioProject(ProjRec, lvDiscType);
          ValidateCu.GetRefDiscProject(ProjRec, lvDiscRef1, lvDiscRef2, lvDiscType);  //DP01339
        END ELSE BEGIN
          Customer.GET(SalesHeader."Bill-to Customer No.");
          ValidateCu.GetRefDiscCustomer(Customer, lvDiscRef1, lvDiscRef2, lvDiscType);  //C062378
        END;
      END;
    END;

    PROCEDURE GetLinePrice@1100525000() : Decimal;
    BEGIN
      //**4PS
      IF Quantity = 0 THEN
        EXIT("Line Amount")
      ELSE
        EXIT("Line Amount"/Quantity);
    END;

    PROCEDURE CheckAdditionalCostService@1100525006();
    VAR
      LedgerbyServTypeCustGr@1100529600 : Record 11072322;
    BEGIN
      //**4PS
      IF "Service Order No." = '' THEN EXIT;
      IF NOT ServOrderRec.GET("Service Order No.") THEN EXIT;

      IF NOT "Add. Cost Changed Manually" THEN
        "Additional Cost (Service)" :=
          ServOrderRec.GetAdditionalCostService("Service Order No.","Shortcut Dimension 2 Code","Cost Type"+1,'', Rec);
      IF ("Service Order No." <> xRec."Service Order No.") OR
          ("Additional Cost (Service)" <> xRec."Additional Cost (Service)") THEN BEGIN
        GetSalesHeader;
        IF "Additional Cost (Service)" THEN BEGIN
          ServTypeRec.GET(ServOrderRec."Service Type (Other)");
          IF NOT LedgerbyServTypeCustGr.GET(ServTypeRec.Code, SalesHeader."Customer Posting Group") THEN
            CLEAR(LedgerbyServTypeCustGr);
          IF LedgerbyServTypeCustGr."WIP Account Revenue" <> '' THEN
            VALIDATE("No.", LedgerbyServTypeCustGr."WIP Account Revenue")
          ELSE BEGIN
            ServTypeRec.TESTFIELD("WIP Account Revenue");
            VALIDATE("No.", ServTypeRec."WIP Account Revenue");
          END;
          VALIDATE("Shortcut Dimension 1 Code", ServOrderRec."Department Code (Other)")
        END ELSE BEGIN
          ServTypeRec.GET(ServOrderRec."Service Type");
          IF NOT LedgerbyServTypeCustGr.GET(ServTypeRec.Code, SalesHeader."Customer Posting Group") THEN
            CLEAR(LedgerbyServTypeCustGr);
          IF LedgerbyServTypeCustGr."WIP Account Revenue" <> '' THEN
            VALIDATE("No.", LedgerbyServTypeCustGr."WIP Account Revenue")
          ELSE BEGIN
            ServTypeRec.TESTFIELD("WIP Account Revenue");
            VALIDATE("No.", ServTypeRec."WIP Account Revenue");
          END;
          VALIDATE("Shortcut Dimension 1 Code", ServOrderRec."Global Dimension 1 Code");
        END;
      END;

      IF (CurrFieldNo = FIELDNO("Service Order No.")) OR (CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")) THEN BEGIN
        IF xRec."Shortcut Dimension 2 Code" = '' THEN
          xRec."Cost Type":= -1  //disable default option
        ELSE
          xRec.CALCFIELDS("Cost Type");
        CALCFIELDS("Cost Type");
        IF ("Service Order No." <> xRec."Service Order No.") OR
           ("Cost Type" <> xRec."Cost Type") THEN BEGIN
          VALIDATE("Cost Component");
        END;
      END;
    END;

    PROCEDURE ValidateAdditionalCost@1100525002();
    VAR
      CostCompRec@1100525001 : Record 11012012;
      SaveCostComp@1100525000 : Text[30];
      SaveDesc@1100525002 : Text[100];
    BEGIN
      //**4PS
      SaveCostComp := "Cost Component";
      SaveDesc := Description;
      IF CurrFieldNo = FIELDNO("Additional Cost (Service)") THEN
        "Add. Cost Changed Manually" := TRUE;
      TESTFIELD("Service Order No.");
      VALIDATE("Service Order No.");
      Description := SaveDesc;
      IF CurrFieldNo <> FIELDNO("Additional Cost (Service)") THEN EXIT;

      IF CostCompRec.GET(SaveCostComp) THEN BEGIN
         "Cost Component" := SaveCostComp;
         IF ("Additional Cost (Service)" = TRUE) THEN BEGIN
           IF (CostCompRec."Cost Component (Add.Cost)" <> '') THEN
             "Cost Component" := CostCompRec."Cost Component (Add.Cost)";
         END ELSE BEGIN
           CostCompRec.SETRANGE("Cost Component (Add.Cost)", SaveCostComp);
           IF CostCompRec.FINDSET THEN BEGIN
             REPEAT
               IF (CostCompRec."Cost Component (Add.Cost)" = SaveCostComp) THEN
                 "Cost Component" := CostCompRec.Code;
             UNTIL CostCompRec.NEXT = 0;
           END;
         END;
      END;
    END;

    PROCEDURE ValidateCostComponent@1100525001();
    VAR
      CostCompRec@1100525000 : Record 11012012;
      CostCompRec2@1100525001 : Record 11012012;
    BEGIN
      //**4PS
      IF CurrFieldNo <> FIELDNO("Cost Component") THEN EXIT;

      IF CostCompRec.GET("Cost Component") THEN BEGIN
        IF CostCompRec."Additional Cost (Service)" THEN BEGIN
          CostCompRec2.SETRANGE("Cost Component (Add.Cost)", "Cost Component");
          IF NOT CostCompRec2.FINDFIRST THEN EXIT;
        END ELSE BEGIN
          IF CostCompRec."Cost Component (Add.Cost)" = '' THEN EXIT;
        END;
        "Additional Cost (Service)" := CostCompRec."Additional Cost (Service)";
      END;
    END;

    LOCAL PROCEDURE GetAndValidateLoanAccount@1100528504();
    VAR
      LoanHeader@1100528502 : Record 11020587;
      LoanAccountCode@1100528503 : Code[20];
    BEGIN
      //**4PS
      TestStatusOpen;
      CheckProjServPlantLoanAllowed(FIELDNO("Loan Code"));

      IF "Loan Code" <> '' THEN
        Type := Type::"G/L Account";

      FillSystemCreatedEntry;

      IF "Loan Code" <> '' THEN
        LoanAccountCode := LoanHeader.GetLoanAccountCode("Loan Code","Loan Type");

      IF LoanAccountCode <> '' THEN
        VALIDATE("No.",LoanAccountCode)
      ELSE
        IF "No." <> '' THEN
          VALIDATE("No.");

      IF "Loan Code" <> '' THEN
        CreateDim(
          DATABASE::"Loan Header","Loan Code",
          DimMgt.TypeToTableID3(Type),"No.",
          DATABASE::"Responsibility Center","Responsibility Center",
          0,'',
          0,'',
          0,'',
          0,'');
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
      FPSLicenseManagement@1100528500 : Codeunit 11229289;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(37) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 37');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Sales Line", "Shortcut Dimension 1 Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Shortcut Dimension 1 Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Shortcut Dimension 1 Code");
    END;

    PROCEDURE ChangeQuantityExplodedLines@1100525004(QuantityFactor@1100525000 : Decimal);
    VAR
      SalesLine2@1100525001 : Record 37;
    BEGIN
      //**4PS
      SalesLine2.RESET;
      SalesLine2.SETRANGE("Document Type","Document Type");
      SalesLine2.SETRANGE("Document No.","Document No.");
      SalesLine2.SETRANGE("Part of Line","Line No.");
      SalesLine2.SETFILTER("Line No.", '<>%1', "Line No.");
      IF SalesLine2.FINDSET(TRUE, FALSE) THEN
        REPEAT
          IF NOT ((SalesLine2.Type = SalesLine2.Type::" ") AND (SalesLine2."Original Quantity" = 0)) THEN BEGIN
            IF SalesLine2.Type = SalesLine2.Type::" " THEN BEGIN
              SalesLine2.ChangeQuantityExplodedLines(QuantityFactor);
              SalesLine2."Original Quantity" := QuantityFactor * SalesLine2."Original Quantity";
            END ELSE
              SalesLine2.VALIDATE(Quantity, QuantityFactor * SalesLine2.Quantity);
            SalesLine2.MODIFY;
          END;
        UNTIL SalesLine2.NEXT = 0;
    END;

    PROCEDURE DetermineBOMLevel@1100525005(LineNo@1100525000 : Integer;VAR BOMLevel@1100525002 : Integer);
    VAR
      SalesLine3@1100525001 : Record 37;
    BEGIN
      //**4PS
      SalesLine3.SETRANGE("Document Type","Document Type");
      SalesLine3.SETRANGE("Document No.","Document No.");
      SalesLine3.SETRANGE("Line No.",LineNo);
      IF SalesLine3.FINDFIRST THEN
        BOMLevel := SalesLine3."Level BOM" + 1;
    END;

    PROCEDURE GetCustomerName@1100528300() : Text[100];
    VAR
      Customer@1100528300 : Record 18;
    BEGIN
      //**4PS.n
      IF (Customer.GET("Sell-to Customer No.")) THEN
        EXIT(Customer.Name);

      EXIT('');
    END;

    PROCEDURE GetUoMDescription@1100528301() : Text[50];
    VAR
      UnitOfMeasure@1100528300 : Record 204;
    BEGIN
      //**4PS.n
      IF (UnitOfMeasure.GET("Unit of Measure Code")) THEN
        EXIT(UnitOfMeasure.Description);

      EXIT('');
    END;

    PROCEDURE GetCurrencyDescription@1100528302() : Text[30];
    VAR
      Currency@1100528300 : Record 4;
    BEGIN
      //**4PS.n
      IF (Currency.GET("Currency Code")) THEN
        EXIT(Currency.Description);

      EXIT('');
    END;

    PROCEDURE GetReturnReasonCodeDescription@1100528303() : Text[100];
    VAR
      ReturnReason@1100528300 : Record 6635;
    BEGIN
      //**4PS.n
      IF (ReturnReason.GET("Return Reason Code")) THEN
        EXIT(ReturnReason.Description);

      EXIT('');
    END;

    LOCAL PROCEDURE CheckIfItemIsBlocked@1100528304(Item@1100528300 : Record 27);
    BEGIN
      //**4PS.n
      IF "Document Type" IN ["Document Type"::Quote, "Document Type"::Order, "Document Type"::"Blanket Order",
         "Document Type"::"Return Order"]
      THEN
        Item.TESTFIELD("Sales Blocked",FALSE);

      Item.TESTFIELD(Blocked,FALSE);
    END;

    PROCEDURE NSItemExists@1100528601(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      Item2@1001 : Record 27;
    BEGIN
      //**4PS DP00121
      IF Type = Type::"G/L Account" THEN
        IF Item2.GET(ItemNo) THEN
          EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE CopyRecipe@1100525012();
    VAR
      BaseRecipe@1100525001 : Record 11020581;
      BaseRecipeLine@1100525003 : Record 11020582;
      SalesRecipe@1100525002 : Record 11229788;
      SalesRecipeLine@1100525006 : Record 11229789;
      ChildRcp@1100525000 : Boolean;
      TmpChrgRec@1100525005 : TEMPORARY Record 11229771;
      ChrgPresent@1100525004 : Boolean;
    BEGIN
      //**4PS DP00481
      BaseRecipe.GET("Recipe Group",Recipe);

      IF SalesRecipe.GET("Document Type", "Document No.", "Line No.", "Recipe Group", Recipe) THEN
        SalesRecipe.DELETE(TRUE);

      SalesRecipe.TRANSFERFIELDS(BaseRecipe);
      SalesRecipe."Sales Document Type" := "Document Type";
      SalesRecipe."Sales Document No." := "Document No.";
      SalesRecipe."Sales Line No." := "Line No.";
      SalesRecipe."Recipe Group" := "Recipe Group";
      SalesRecipe."No." := Recipe;
      SalesRecipe.INSERT(TRUE);

      BaseRecipeLine.SETRANGE("Recipe Group","Recipe Group");
      BaseRecipeLine.SETRANGE(Recipe,Recipe);
      IF BaseRecipeLine.FINDSET(FALSE, FALSE) THEN
        REPEAT
          CopyRecipeLine(TmpChrgRec, ChrgPresent, BaseRecipeLine, ChildRcp, SalesRecipe,SalesRecipeLine);
        UNTIL BaseRecipeLine.NEXT = 0;

      IF ChrgPresent THEN
        SalesRecipeLine.CheckRecipeCharge2(TmpChrgRec);

      IF ChildRcp THEN
        ExplodeRecipe;

      CalculateSalesRecipe;  //C051724
    END;

    PROCEDURE CopyRecipeLine@1210190019(VAR TmpChrgRec@1100525006 : Record 11229771;VAR ChrgPresent@1100525005 : Boolean;BaseRecipeLine@1100525000 : Record 11020582;VAR ChildRcp@1210190001 : Boolean;VAR SalesRecipe@1100525002 : Record 11229788;VAR SalesRecipeLine@1100525007 : Record 11229789);
    VAR
      TestRecipeLine@1100525001 : Record 11229789;
      ChrgRec1@1100525004 : Record 11229771;
    BEGIN
      //**4PS DP00481
      SalesRecipeLine.SetSkipCalculateTotals(TRUE);

      SalesRecipeLine.TRANSFERFIELDS(BaseRecipeLine);

      SalesRecipeLine."Sales Document Type" := SalesRecipe."Sales Document Type";
      SalesRecipeLine."Sales Document No." :=  SalesRecipe."Sales Document No.";
      SalesRecipeLine."Sales Line No." := SalesRecipe."Sales Line No.";
      SalesRecipeLine."Recipe Group" := SalesRecipe."Recipe Group";
      SalesRecipeLine.Recipe := SalesRecipe."No.";

      SalesRecipeLine."Line No." := BaseRecipeLine."Line No.";

      SalesRecipeLine."Purchase Route Reference" := '';

      IF SalesRecipeLine."Trade Item" <> '' THEN BEGIN
        IF SalesRecipeLine."Price Agreement" = FALSE THEN
          SalesRecipeLine."Trade Item" := '';
        SalesRecipeLine.VALIDATE("Trade Item", BaseRecipeLine."Trade Item");
      END ELSE BEGIN
        IF SalesRecipeLine."Basic Item" <> '' THEN BEGIN
          IF SalesRecipeLine."Price Agreement" = FALSE THEN
            SalesRecipeLine."Basic Item" := '';
          SalesRecipeLine.VALIDATE("Basic Item", BaseRecipeLine."Basic Item");
        END ELSE BEGIN
          IF SalesRecipeLine."Item No." <> '' THEN BEGIN
            IF SalesRecipeLine."Price Agreement" = FALSE THEN
              SalesRecipeLine."Item No." := '';
            SalesRecipeLine.VALIDATE("Item No.", BaseRecipeLine."Item No.");
          END;
        END;
      END;

      TestRecipeLine := SalesRecipeLine;
      SalesRecipeLine.VALIDATE("Unit of Measure", BaseRecipeLine."Unit of Measure");
      IF TestRecipeLine."Unit of Measure" <> SalesRecipeLine."Unit of Measure" THEN BEGIN
        SalesRecipeLine.CheckItemUnitConversion(SalesRecipeLine, TestRecipeLine);
        SalesRecipeLine.VALIDATE(Quantity, BaseRecipeLine.Quantity);
      END;

      SalesRecipeLine.VALIDATE("Rate Code");
      IF BaseRecipeLine."Sub Operation Code" <> '' THEN
        SalesRecipeLine."Sub Operation Code" := BaseRecipeLine."Sub Operation Code";
      SalesRecipeLine.VALIDATE("Sub Operation Code");
      SalesRecipeLine."Cost Object Price" := BaseRecipeLine."Cost Object Price";
      SalesRecipeLine.Description := BaseRecipeLine.Description;
      SalesRecipeLine."Cost Component" := BaseRecipeLine."Cost Component";
      SalesRecipeLine.InitAdjustmentFactor;
      IF SalesRecipeLine."Item No." + SalesRecipeLine."Basic Item" + SalesRecipeLine."Trade Item" = '' THEN BEGIN
        IF BaseRecipeLine."Purchase Discount %" <> 0 THEN
          SalesRecipeLine.VALIDATE("Purchase Discount %", BaseRecipeLine."Purchase Discount %");
        IF BaseRecipeLine."Sales Discount %" <> 0 THEN
          SalesRecipeLine.VALIDATE("Sales Discount %", BaseRecipeLine."Sales Discount %");
      END;

      SalesRecipeLine.SetSkipCalculateTotals(FALSE);
      SalesRecipeLine.CalculateTotals;

      SalesRecipeLine.INSERT;

      IF SalesRecipeLine."Recipe (Child)" <> '' THEN
        ChildRcp := TRUE;

      //Search origanal Surcharge Line :
      IF BaseRecipeLine."Surcharge Type" <> BaseRecipeLine."Surcharge Type"::" " THEN BEGIN
          ChrgRec1.SETFILTER("Estimate No.", '%1', '');
          ChrgRec1.SETFILTER("Sub-Estimate No.", '%1', '');
          ChrgRec1.SETFILTER("Part Group", '%1', '');
          ChrgRec1.SETFILTER(Part, '%1', '');
          ChrgRec1.SETRANGE("Recipe Line", 0);
          ChrgRec1.SETFILTER("Sales Document No.", '%1', '');
          ChrgRec1.SETRANGE("Recipe Group", BaseRecipeLine."Recipe Group");
          ChrgRec1.SETRANGE(Recipe, BaseRecipeLine.Recipe);
          ChrgRec1.SETRANGE("Surcharge Line", BaseRecipeLine."Line No.");
          IF ChrgRec1.FINDSET(FALSE, FALSE) THEN
            REPEAT
              CopyChrgLine(ChrgRec1, TmpChrgRec, ChrgPresent);
            UNTIL ChrgRec1.NEXT = 0;
      END;
    END;

    PROCEDURE CopyChrgLine@1210190017(StdChrgRec@1210190003 : Record 11229771;VAR TmpChrgRec@1210190001 : Record 11229771;VAR ChrgPresent@1210190000 : Boolean);
    VAR
      ChrgRec2@1210190002 : Record 11229771;
    BEGIN
      //**4PS DP00481
      ChrgRec2.INIT;
      ChrgRec2."Estimate No." := '';
      ChrgRec2."Sub-Estimate No." := '';
      ChrgRec2."Part Group" := '';
      ChrgRec2.Part := '';
      ChrgRec2."Recipe Group" := "Recipe Group";
      ChrgRec2.Recipe := Recipe;
      ChrgRec2."Recipe Line" := 0;
      ChrgRec2."Sales Document Type" := "Document Type";
      ChrgRec2."Sales Document No." := "Document No.";
      ChrgRec2."Sales Line No." := "Line No.";
      ChrgRec2."Basic Line" := StdChrgRec."Basic Line";
      ChrgRec2."Surcharge Line" := StdChrgRec."Surcharge Line";
      ChrgRec2.INSERT;
      ChrgPresent := TRUE;
      TmpChrgRec := ChrgRec2;
      TmpChrgRec.INSERT;
    END;

    PROCEDURE ExplodeRecipe@1100525015();
    VAR
      SalesRecipe@1100529500 : Record 11229788;
      SalesRecipeLine@1100485004 : Record 11229789;
      EstChrgRec@1100525000 : Record 11229771;
      LastLino@1100485000 : Integer;
      CurrLevel@1100485001 : Integer;
    BEGIN
      //**4PS DP00481
      TmpSalesRecipeLine.DELETEALL;
      TmpChrgRec.DELETEALL;
      TmpSalesRecipeLine.RESET;

      CurrLevel := -1;
      LastLino := 0;

      SalesRecipeLine.SETRANGE("Sales Document Type", "Document Type");
      SalesRecipeLine.SETRANGE("Sales Document No.", "Document No.");
      SalesRecipeLine.SETRANGE("Sales Line No.", "Line No.");
      SalesRecipeLine.SETRANGE("Recipe Group", "Recipe Group");
      SalesRecipeLine.SETRANGE(Recipe, Recipe);

      IF SalesRecipeLine.FINDSET THEN BEGIN
        SalesRecipeLine.SetFromEstimateLineDelete(TRUE);
        REPEAT
          IF (SalesRecipeLine."Recipe (Child)" = '') OR (SalesRecipeLine."Recipe Exploded") THEN BEGIN  //C023235
            TmpSalesRecipeLine.TRANSFERFIELDS(SalesRecipeLine);
            TmpSalesRecipeLine."Line No." := LastLino + 10000;
            LastLino := TmpSalesRecipeLine."Line No.";
            TmpSalesRecipeLine.INSERT;
          END ELSE BEGIN
            ProcessRecipeChild(SalesRecipeLine."Recipe Group (Child)", SalesRecipeLine."Recipe (Child)",
              SalesRecipeLine.Quantity, LastLino, CurrLevel, SalesRecipeLine);
          END;
          SalesRecipeLine.DELETE(TRUE);
        UNTIL SalesRecipeLine.NEXT = 0;
      END;

      IF TmpChrgRec.FIND('-') THEN BEGIN
        REPEAT
          EstChrgRec := TmpChrgRec;
          EstChrgRec.INSERT;
        UNTIL TmpChrgRec.NEXT = 0;
      END;

      IF TmpSalesRecipeLine.FIND('-') THEN BEGIN
        REPEAT
          SalesRecipeLine := TmpSalesRecipeLine;
          SalesRecipeLine."Recipe Group" := "Recipe Group";
          SalesRecipeLine.Recipe := Recipe;
          IF TmpSalesRecipeLine."Rate Code" <> '' THEN
            SalesRecipeLine.VALIDATE("Rate Code", TmpSalesRecipeLine."Rate Code");
          SalesRecipeLine.UpdateSalesQuantity;
          SalesRecipeLine.UpdateSalesNorm;

          SalesRecipeLine.DetermineNormGroup;
          SalesRecipeLine.VALIDATE("Sub Operation Code");

          SalesRecipeLine.CalculateTotals;
          SalesRecipeLine.INSERT;
          IF SalesRecipeLine."Surcharge Type" <> SalesRecipeLine."Surcharge Type"::" " THEN
            SalesRecipeLine.CheckRecipeCharge;

        UNTIL TmpSalesRecipeLine.NEXT = 0;
      END;

      //C033781.sn
      IF SalesRecipe.GET("Document Type","Document No.","Line No.","Recipe Group",Recipe) THEN BEGIN
        IF SalesRecipe."Surcharge % Labor" <> 0 THEN
          SalesRecipe.UpdateSurcharge(0);
        IF SalesRecipe."Surcharge % Material" <> 0 THEN
          SalesRecipe.UpdateSurcharge(1);
        IF SalesRecipe."Surcharge % Subcontracting" <> 0 THEN
          SalesRecipe.UpdateSurcharge(2);
        IF SalesRecipe."Surcharge % Plant" <> 0 THEN
          SalesRecipe.UpdateSurcharge(3);
        IF SalesRecipe."Surcharge % Sundry" <> 0 THEN
          SalesRecipe.UpdateSurcharge(4);
      END;
      //C033781.en
    END;

    PROCEDURE ProcessRecipeChild@1100525016(iRcpGrp@1100485000 : Code[20];iRcp@1100485001 : Code[20];iQuan@1100485004 : Decimal;VAR LastLino@1100485005 : Integer;VAR varLevel@1100485006 : Integer;SalesRecipeLine@1100485007 : Record 11229789);
    VAR
      RcpRec@1100485002 : Record 11020581;
      BaseRecipeLine2@1100485003 : Record 11020582;
      ChrgRec1@1100525000 : Record 11229771;
      ChrgRec2@1100525001 : Record 11229771;
      TmpLineRec@1100525002 : TEMPORARY Record 11020582;
      HeaderLine@1100525003 : Integer;
      EstSetup@1100529500 : Record 11012150;
    BEGIN
      //**4PS DP00481
      varLevel := varLevel + 1;
      IF RcpRec.GET(iRcpGrp, iRcp) THEN BEGIN
        TmpSalesRecipeLine.INIT;

        TmpSalesRecipeLine."Sales Document Type" := SalesRecipeLine."Sales Document Type";
        TmpSalesRecipeLine."Sales Document No." :=  SalesRecipeLine."Sales Document No.";
        TmpSalesRecipeLine."Sales Line No." := SalesRecipeLine."Sales Line No.";
        TmpSalesRecipeLine."Recipe Group" := SalesRecipeLine."Recipe Group";
        TmpSalesRecipeLine.Recipe := SalesRecipeLine.Recipe;

        TmpSalesRecipeLine."Line No." := LastLino + 10000;
        LastLino := TmpSalesRecipeLine."Line No.";

        HeaderLine := TmpSalesRecipeLine."Line No.";
        TmpSalesRecipeLine."Recipe Group (Child)" := iRcpGrp;
        TmpSalesRecipeLine."Recipe (Child)" := iRcp;
        TmpSalesRecipeLine."Recipe Header" := TRUE;
        TmpSalesRecipeLine."Recipe Exploded" := TRUE;
        TmpSalesRecipeLine."Recipe Level" := varLevel;
        TmpSalesRecipeLine.Description := RcpRec.Description;
        TmpSalesRecipeLine."Unit of Measure" := RcpRec."Unit of Measure";

        TmpSalesRecipeLine.VALIDATE("Rate Code", '');
        IF TmpSalesRecipeLine.INSERT THEN
          TmpSalesRecipeLine.Quantity := 0;
        TmpSalesRecipeLine.Quantity := TmpSalesRecipeLine.Quantity + iQuan;
        TmpSalesRecipeLine."Ignore Recipe Quantity" := SalesRecipeLine."Ignore Recipe Quantity";
          //C033781.sn
        TmpSalesRecipeLine."Surcharge % Labor" := SalesRecipeLine."Surcharge % Labor";
        TmpSalesRecipeLine."Surcharge % Price" := 0;
        TmpSalesRecipeLine."Recipe Surcharge % Material" := SalesRecipeLine."Recipe Surcharge % Material";
        TmpSalesRecipeLine."Recipe Surcharge % Subc." := SalesRecipeLine."Recipe Surcharge % Subc.";
        TmpSalesRecipeLine."Recipe Surcharge % Plant" := SalesRecipeLine."Recipe Surcharge % Plant";
        TmpSalesRecipeLine."Recipe Surcharge % Sundry" := SalesRecipeLine."Recipe Surcharge % Sundry";
        //C033781.en
        TmpSalesRecipeLine.MODIFY;
      END;

      BaseRecipeLine2.SETRANGE("Recipe Group", iRcpGrp);
      BaseRecipeLine2.SETRANGE(Recipe, iRcp);
      IF BaseRecipeLine2.FINDSET THEN BEGIN
        REPEAT
          TmpSalesRecipeLine.TRANSFERFIELDS(BaseRecipeLine2);

          TmpSalesRecipeLine."Sales Document Type" := SalesRecipeLine."Sales Document Type";
          TmpSalesRecipeLine."Sales Document No." :=  SalesRecipeLine."Sales Document No.";
          TmpSalesRecipeLine."Sales Line No." := SalesRecipeLine."Sales Line No.";
          TmpSalesRecipeLine."Recipe Group" := SalesRecipeLine."Recipe Group";
          TmpSalesRecipeLine.Recipe := SalesRecipeLine.Recipe;

          IF BaseRecipeLine2."Recipe (Child)" <> '' THEN BEGIN
            IF NOT TmpSalesRecipeLine."Ignore Recipe Quantity" THEN
              ProcessRecipeChild(BaseRecipeLine2."Recipe Group (Child)", BaseRecipeLine2."Recipe (Child)",
                iQuan * BaseRecipeLine2.Quantity, LastLino, varLevel, SalesRecipeLine)
            ELSE
              ProcessRecipeChild(BaseRecipeLine2."Recipe Group (Child)", BaseRecipeLine2."Recipe (Child)",
                BaseRecipeLine2.Quantity, LastLino, varLevel, SalesRecipeLine);
          END ELSE BEGIN
            TmpSalesRecipeLine."Recipe Group" := SalesRecipeLine."Recipe Group";
            TmpSalesRecipeLine.Recipe := SalesRecipeLine.Recipe;
            TmpSalesRecipeLine."Line No." := LastLino + 10000;
            LastLino := TmpSalesRecipeLine."Line No.";
            TmpSalesRecipeLine."Attached to Line No." := HeaderLine;
            TmpSalesRecipeLine."Recipe Group (Child)" := iRcpGrp;
            TmpSalesRecipeLine."Recipe (Child)" := iRcp;
            TmpSalesRecipeLine."Recipe Header" := FALSE;
            TmpSalesRecipeLine."Recipe Level" := varLevel + 1;
            IF TmpSalesRecipeLine.INSERT THEN
              TmpSalesRecipeLine.Quantity := 0;
            IF BaseRecipeLine2."Surcharge Type" <> BaseRecipeLine2."Surcharge Type"::" " THEN
              BaseRecipeLine2.Quantity := BaseRecipeLine2.Quantity * BaseRecipeLine2."Surcharge %"/100;
            IF NOT TmpSalesRecipeLine."Ignore Recipe Quantity" THEN
              TmpSalesRecipeLine.Quantity := TmpSalesRecipeLine.Quantity + iQuan * BaseRecipeLine2.Quantity
            ELSE
              TmpSalesRecipeLine.Quantity := TmpSalesRecipeLine.Quantity + BaseRecipeLine2.Quantity;
            TmpSalesRecipeLine."Ignore Recipe Quantity" :=
              TmpSalesRecipeLine."Ignore Recipe Quantity" OR SalesRecipeLine."Ignore Recipe Quantity";

            //C033781.sn
            IF BaseRecipeLine2."Surcharge % Labor" <> 0 THEN
              TmpSalesRecipeLine."Surcharge % Labor" := BaseRecipeLine2."Surcharge % Labor";
            IF BaseRecipeLine2."Surcharge % Price" <> 0 THEN
              TmpSalesRecipeLine."Surcharge % Price" := BaseRecipeLine2."Surcharge % Price";

            EstSetup.GET;
            IF EstSetup."Apply Surcharge Recipe Header" = EstSetup."Apply Surcharge Recipe Header"::Default THEN BEGIN
              //get default from recipe header (child)
              IF TmpSalesRecipeLine."Surcharge % Labor" = 0 THEN
                TmpSalesRecipeLine."Surcharge % Labor" := SalesRecipeLine."Surcharge % Labor";
              IF TmpSalesRecipeLine."Surcharge % Price" = 0 THEN BEGIN
                IF TmpSalesRecipeLine."Cost Type (Price)" = TmpSalesRecipeLine."Cost Type (Price)"::Material THEN
                  TmpSalesRecipeLine."Surcharge % Price" := SalesRecipeLine."Recipe Surcharge % Material";
                IF TmpSalesRecipeLine."Cost Type (Price)" = TmpSalesRecipeLine."Cost Type (Price)"::Subcontracting THEN
                  TmpSalesRecipeLine."Surcharge % Price" := SalesRecipeLine."Recipe Surcharge % Subc.";
                IF TmpSalesRecipeLine."Cost Type (Price)" = TmpSalesRecipeLine."Cost Type (Price)"::Plant THEN
                  TmpSalesRecipeLine."Surcharge % Price" := SalesRecipeLine."Recipe Surcharge % Plant";
                IF TmpSalesRecipeLine."Cost Type (Price)" = TmpSalesRecipeLine."Cost Type (Price)"::Sundry THEN
                  TmpSalesRecipeLine."Surcharge % Price" := SalesRecipeLine."Recipe Surcharge % Sundry";
              END;
            END;
            //C033781.en

            TmpSalesRecipeLine.MODIFY;

            //search original surcharge line:
            IF BaseRecipeLine2."Surcharge Type" = BaseRecipeLine2."Surcharge Type"::" " THEN BEGIN
              TmpLineRec := BaseRecipeLine2;
              TmpLineRec.Quantity := LastLino;
              TmpLineRec.INSERT;
            END ELSE BEGIN
              ChrgRec1.SETCURRENTKEY("Recipe Group", Recipe);
              ChrgRec1.SETFILTER("Estimate No.", '%1', '');
              ChrgRec1.SETFILTER("Sub-Estimate No.", '%1', '');
              ChrgRec1.SETFILTER("Part Group", '%1', '');
              ChrgRec1.SETFILTER(Part, '%1', '');
              ChrgRec1.SETRANGE("Recipe Line", 0);
              ChrgRec1.SETFILTER("Sales Document No.",'%1', '');
              ChrgRec1.SETRANGE("Recipe Group", BaseRecipeLine2."Recipe Group");
              ChrgRec1.SETRANGE(Recipe, BaseRecipeLine2.Recipe);
              ChrgRec1.SETRANGE("Surcharge Line", BaseRecipeLine2."Line No.");
              IF ChrgRec1.FINDSET(FALSE, FALSE) THEN BEGIN
                REPEAT
                  ChrgRec2.INIT;
                  ChrgRec2."Sales Document Type" := SalesRecipeLine."Sales Document Type";
                  ChrgRec2."Sales Document No." :=  SalesRecipeLine."Sales Document No.";
                  ChrgRec2."Sales Line No." := SalesRecipeLine."Sales Line No.";
                  ChrgRec2."Recipe Group" := SalesRecipeLine."Recipe Group";
                  ChrgRec2.Recipe := SalesRecipeLine.Recipe;
                  TmpLineRec.SETRANGE("Line No.", ChrgRec1."Basic Line");
                  IF TmpLineRec.FINDFIRST THEN
                    ChrgRec2."Basic Line" := TmpLineRec.Quantity
                  ELSE
                    ChrgRec2."Basic Line" := 0;
                  ChrgRec2."Surcharge Line" := TmpSalesRecipeLine."Line No.";
                  TmpChrgRec := ChrgRec2;
                  IF NOT TmpChrgRec.INSERT THEN BEGIN
                    TmpChrgRec := ChrgRec2;
                  END;
                UNTIL ChrgRec1.NEXT = 0;
              END;
            END;

          END;
        UNTIL BaseRecipeLine2.NEXT = 0;
      END;
      varLevel := varLevel - 1;
    END;

    PROCEDURE EditSalesRecipe@1100525007();
    VAR
      SalesRecipeCard@1100525000 : Page 11125077;
      SalesRecipe@1100525001 : Record 11229788;
    BEGIN
      //**4PS DP00481
      SalesHeader.GET("Document Type", "Document No.");

      IF SalesRecipe.GET("Document Type", "Document No.", "Line No.", "Recipe Group", Recipe) THEN BEGIN
        SalesRecipeCard.SETTABLEVIEW(SalesRecipe);
        SalesRecipeCard.SETRECORD(SalesRecipe);
        SalesRecipeCard.EDITABLE(SalesHeader.Status = SalesHeader.Status::Open);
        SalesRecipeCard.RUNMODAL;
      END;

      CalculateSalesRecipe;  //C051724
    END;

    PROCEDURE CalculateSalesRecipe@1100528502();
    VAR
      SalesRecipe@1100525001 : Record 11229788;
    BEGIN
      //**4PS C051724
      SalesHeader.GET("Document Type", "Document No.");
      IF SalesHeader.Status <> SalesHeader.Status::Open THEN EXIT;

      IF SalesRecipe.GET("Document Type", "Document No.", "Line No.", "Recipe Group", Recipe) THEN BEGIN
        SalesRecipe.CALCFIELDS("Sales Amount", "Cost Amount");
        //DP02114.sn
        IF SalesHeader."Currency Code" <> '' THEN BEGIN
          Currency.TESTFIELD("Unit-Amount Rounding Precision");
          SalesRecipe."Sales Amount" :=
            ROUND(
              CurrExchRate.ExchangeAmtLCYToFCY(
                1,
                "Job No.",
                GetDate,SalesHeader."Currency Code",
                SalesRecipe."Sales Amount",SalesHeader."Currency Factor",TRUE),
              Currency."Unit-Amount Rounding Precision")
        END;
        //DP02114.en
        VALIDATE("Unit Price", SalesRecipe."Sales Amount");
        VALIDATE("Unit Cost (LCY)", SalesRecipe."Cost Amount");
      END;
    END;

    PROCEDURE CopySalesRecipe@1100528503(SalesLineFrom@1100528500 : Record 37;SalesLineTo@1100528501 : Record 37);
    VAR
      SalesRecipeFrom@1100528502 : Record 11229788;
      SalesRecipeLineFrom@1100528503 : Record 11229789;
      SalesRecipeTo@1100528505 : Record 11229788;
      SalesRecipeLineTo@1100528504 : Record 11229789;
    BEGIN
      //**4PS C051724
      SalesRecipeFrom.SETRANGE("Sales Document Type", SalesLineFrom."Document Type");
      SalesRecipeFrom.SETRANGE("Sales Document No.", SalesLineFrom."Document No.");
      SalesRecipeFrom.SETRANGE("Sales Line No.", SalesLineFrom."Line No.");
      SalesRecipeFrom.SETRANGE("Recipe Group", SalesLineFrom."Recipe Group");
      SalesRecipeFrom.SETRANGE("No.", SalesLineFrom.Recipe);
      IF NOT SalesRecipeFrom.FINDSET THEN EXIT;

      SalesRecipeTo := SalesRecipeFrom;
      SalesRecipeTo."Sales Document Type" := SalesLineTo."Document Type";
      SalesRecipeTo."Sales Document No." := SalesLineTo."Document No.";
      SalesRecipeTo."Sales Line No." := SalesLineTo."Line No.";
      SalesRecipeTo.INSERT;

      SalesRecipeLineFrom.SETRANGE("Sales Document Type", SalesRecipeFrom."Sales Document Type");
      SalesRecipeLineFrom.SETRANGE("Sales Document No.", SalesRecipeFrom."Sales Document No.");
      SalesRecipeLineFrom.SETRANGE("Sales Line No.", SalesRecipeFrom."Sales Line No.");
      SalesRecipeLineFrom.SETRANGE("Recipe Group", SalesRecipeFrom."Recipe Group");
      SalesRecipeLineFrom.SETRANGE(Recipe, SalesRecipeFrom."No.");
      IF SalesRecipeLineFrom.FINDSET THEN BEGIN
        REPEAT
          SalesRecipeLineTo := SalesRecipeLineFrom;
          SalesRecipeLineTo."Sales Document Type" := SalesRecipeTo."Sales Document Type";
          SalesRecipeLineTo."Sales Document No." := SalesRecipeTo."Sales Document No.";
          SalesRecipeLineTo."Sales Line No." := SalesRecipeTo."Sales Line No.";
          SalesRecipeLineTo."Recipe Group" := SalesRecipeTo."Recipe Group";
          SalesRecipeLineTo.Recipe := SalesRecipeTo."No.";
          SalesRecipeLineTo.INSERT;
        UNTIL SalesRecipeLineFrom.NEXT = 0;
      END;
    END;

    PROCEDURE IsConsumptionInvoice@1100528800(ISalesLine@1100528800 : Record 37) : Boolean;
    BEGIN
      GetSalesHeader;
      IF SalesHeader."Consumption Invoice" = TRUE THEN
        EXIT(TRUE);
    END;

    LOCAL PROCEDURE IsPBInstallmentOverviewInvoice@1100528603(ISalesLine@1100528600 : Record 37) : Boolean;
    BEGIN
      EXIT(ISalesLine."PB Install. Collect. Over. No." <> '');
    END;

    PROCEDURE GetServiceObjectGroup@1100528600() : Code[10];
    VAR
      ServiceObject@1100528600 : Record 11071691;
    BEGIN
      IF NOT "Service Invoice" THEN
        EXIT;
      IF "Object No." = '' THEN
        EXIT;
      IF NOT ServiceObject.GET("Object No.") THEN
        ServiceObject.INIT;
      ServiceObject.CALCFIELDS("Object Group");
      EXIT(ServiceObject."Object Group");
    END;

    PROCEDURE CheckSubsequentSalesLines@1100528602(VAR ISalesLine@1100528600 : Record 37);
    VAR
      SalesHeader@1100528605 : Record 36;
      SalesLine@1100528602 : Record 37;
      SalesLine2@1100528601 : Record 37;
      OrigSalesLine@1100528603 : Record 37;
      LastLineNoChecked@1100528604 : Integer;
    BEGIN
      SalesLine.COPY(ISalesLine);
      OrigSalesLine.COPY(ISalesLine);
      IF SalesLine.FINDSET THEN BEGIN
        SalesLine.TESTFIELD("Document Type", SalesLine."Document Type"::"Invoice Proposal");
        SalesLine.TESTFIELD("Service Invoice", TRUE);
        SalesHeader.GET(SalesLine."Document Type", SalesLine."Document No.");
        SalesHeader.TESTFIELD("Consumption Invoice", FALSE);
        REPEAT
          SalesLine2.RESET;
          SalesLine2.SETRANGE("Document Type", SalesLine."Document Type");
          SalesLine2.SETRANGE("Document No.", SalesLine."Document No.");
          SalesLine2.SETRANGE("Service Contract No.", SalesLine."Service Contract No.");
          SalesLine2.SETRANGE("Object No.", SalesLine."Object No.");
          SalesLine2.SETRANGE("Installment Line No.", SalesLine."Installment Line No.");
          SalesLine2.SETFILTER("Prev. Invoiced Until", '>%1', SalesLine."Prev. Invoiced Until");
          IF SalesLine2.FINDSET THEN BEGIN
            LastLineNoChecked := SalesLine."Line No.";
            REPEAT
              OrigSalesLine := SalesLine2;
              IF NOT OrigSalesLine.FIND('=') THEN
                ERROR(Text11012009, LastLineNoChecked);
              LastLineNoChecked := SalesLine2."Line No.";
            UNTIL SalesLine2.NEXT = 0;
          END;
        UNTIL SalesLine.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE MakeServiceCostPlusChargeable@1100528401(ServiceOrderCostPlusEntry@1100528403 : Record 11012825);
    VAR
      ServiceLedgerEntry@1100528400 : Record 11012819;
    BEGIN
      //**4PS
      IF "Copy of Document" THEN
        EXIT;

      IF ServiceOrderCostPlusEntry."Removal Contribution" THEN
        EXIT;

      ServiceLedgerEntry.SETCURRENTKEY("Service Order No.", "Cost Plus Line No.");
      ServiceLedgerEntry.SETRANGE("Service Order No.", ServiceOrderCostPlusEntry."Service Order No.");
      ServiceLedgerEntry.SETRANGE("Cost Plus Line No.", ServiceOrderCostPlusEntry."Line No.");
      IF ServiceLedgerEntry.ISEMPTY THEN BEGIN
        ServiceOrderCostPlusEntry.Invoiced := FALSE;
        ServiceOrderCostPlusEntry.Chargeable := TRUE;
        ServiceOrderCostPlusEntry.MODIFY;
        MakeServRemovalContrChargeable(
          ServiceOrderCostPlusEntry."Service Order No.", ServiceOrderCostPlusEntry."Line No.");
      END;

      IF ServiceOrderCostPlusEntry."Collective List No." <> '' THEN
        ReopenServiceCollectiveList(ServiceOrderCostPlusEntry."Collective List No.");
    END;

    LOCAL PROCEDURE MakeServRemovalContrChargeable@1100528416(ServiceOrderNo@1100528400 : Code[20];CostPlusLineNo@1100528401 : Integer);
    VAR
      ServiceOrderCostPlusEntry@1100528402 : Record 11012825;
    BEGIN
      //**4PS
      ServiceOrderCostPlusEntry.SETRANGE("Service Order No.", ServiceOrderNo);
      ServiceOrderCostPlusEntry.SETRANGE("Removal Contribution", TRUE);
      ServiceOrderCostPlusEntry.SETRANGE("Attached to Line No. (RC)", CostPlusLineNo);
      IF ServiceOrderCostPlusEntry.FINDSET THEN
        REPEAT
          ServiceOrderCostPlusEntry.Invoiced := FALSE;
          ServiceOrderCostPlusEntry.Chargeable := TRUE;
          ServiceOrderCostPlusEntry.MODIFY;
        UNTIL ServiceOrderCostPlusEntry.NEXT = 0;
    END;

    LOCAL PROCEDURE ReopenServiceCollectiveList@1100528409(CollectiveListNo@1100528400 : Code[20]);
    VAR
      ServiceCollectiveList@1100528401 : Record 11071730;
    BEGIN
      //**4PS
      IF NOT ServiceCollectiveList.GET(CollectiveListNo) THEN
        EXIT;

      IF ServiceCollectiveList.Status <> ServiceCollectiveList.Status::Open THEN BEGIN
        ServiceCollectiveList.Status := ServiceCollectiveList.Status::Open;
        ServiceCollectiveList.MODIFY(TRUE);
      END;
    END;

    PROCEDURE OrderLineCompletelyShippedAndInvoiced@1100528400() : Boolean;
    BEGIN
      //**4PS
      CASE "Document Type" OF
        "Document Type"::Order:
          EXIT(
            (Quantity = "Quantity Shipped") AND
            (Quantity = "Quantity Invoiced"));
        "Document Type"::"Return Order":
          EXIT(
            (Quantity = "Return Qty. Received") AND
            (Quantity = "Quantity Invoiced"));
      END;
    END;

    PROCEDURE AddToCompressedLines@1100528402(SalesHeader@1100528401 : Record 36);
    VAR
      CompressedSalesLine@1100528400 : Record 37;
    BEGIN
      //**4PS
      CheckIfCompressingIsAllowed(SalesHeader);
      CompressedSalesLine.SETRANGE("Document Type", "Document Type");
      CompressedSalesLine.SETRANGE("Document No.", "Document No.");
      CompressedSalesLine.SETRANGE(Type, Type);
      CompressedSalesLine.SETRANGE("No.", "No.");
      CompressedSalesLine.SETRANGE("Service Contract No.", "Service Contract No.");
      CompressedSalesLine.SETRANGE("Service Control Period Date", "Service Control Period Date");
      CompressedSalesLine.SETRANGE(Description, GetObjectGroupDescription);
      CompressedSalesLine.SETFILTER("Description 2", GetInvoicedFromToOfDescription2 + '*');
      CompressedSalesLine.SETRANGE("Currency Code", "Currency Code");
      CompressedSalesLine.SETRANGE("VAT Bus. Posting Group", "VAT Bus. Posting Group");
      CompressedSalesLine.SETRANGE("VAT Prod. Posting Group", "VAT Prod. Posting Group");
      CompressedSalesLine.SETRANGE("VAT Identifier", "VAT Identifier");
      CompressedSalesLine.SETRANGE("Gen. Bus. Posting Group", "Gen. Bus. Posting Group");
      CompressedSalesLine.SETRANGE("Gen. Prod. Posting Group", "Gen. Prod. Posting Group");
      CompressedSalesLine.SETRANGE("Shortcut Dimension 1 Code", "Shortcut Dimension 1 Code");
      CompressedSalesLine.SETRANGE("Shortcut Dimension 2 Code", "Shortcut Dimension 2 Code");
      CompressedSalesLine.SETRANGE("Dimension Set ID", "Dimension Set ID");

      IF CompressedSalesLine.FINDFIRST THEN
        ModifyCompressedSalesLine(CompressedSalesLine)
      ELSE
        InsertCompressedSalesLine(CompressedSalesLine);
    END;

    LOCAL PROCEDURE CompressingIsAllowed@1100528405(VAR ReasonComprNotAllowed@1100528401 : Text) : Boolean;
    VAR
      ServiceContract@1100528400 : Record 11012812;
    BEGIN
      //**4PS
      IF NOT "Service Invoice" THEN BEGIN
        ReasonComprNotAllowed := STRSUBSTNO(
          Text11012012, FIELDCAPTION("Service Invoice"), TABLECAPTION, "Line No.", TRUE);
        EXIT(FALSE);
      END;
      IF "Installment Invoice" THEN BEGIN
        ReasonComprNotAllowed := STRSUBSTNO(
          Text11012012, FIELDCAPTION("Installment Invoice"), TABLECAPTION, "Line No.", FALSE);
        EXIT(FALSE);
      END;
      IF "Service Contract No." = '' THEN BEGIN
        ReasonComprNotAllowed := STRSUBSTNO(
          Text11012011, FIELDCAPTION("Service Contract No."), TABLECAPTION, "Line No.");
        EXIT(FALSE);
      END;
      IF ServiceContract.GET("Service Contract No.") THEN BEGIN
        IF ServiceContract."Invoice Type" <> ServiceContract."Invoice Type"::Dynamic THEN BEGIN
          ReasonComprNotAllowed := STRSUBSTNO(
            Text11012012, ServiceContract.FIELDCAPTION("Invoice Type"), ServiceContract.TABLECAPTION,
            ServiceContract."No.", ServiceContract."Invoice Type"::Dynamic);
          EXIT(FALSE);
        END;
      END ELSE BEGIN
        ReasonComprNotAllowed := STRSUBSTNO(
          Text11012013, ServiceContract.TABLECAPTION, "Service Contract No.");
        EXIT(FALSE);
      END;
      IF Type <> Type::"G/L Account" THEN BEGIN
        ReasonComprNotAllowed := STRSUBSTNO(
          Text11012012, FIELDCAPTION(Type), TABLECAPTION, "Line No.", Type::"G/L Account");
        EXIT(FALSE);
      END;
      IF "Object No." = '' THEN BEGIN
        ReasonComprNotAllowed := STRSUBSTNO(
          Text11012011, FIELDCAPTION("Object No."), TABLECAPTION, "Line No.");
        EXIT(FALSE);
      END;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE CheckIfCompressingIsAllowed@1100528406(SalesHeader@1100528400 : Record 36);
    VAR
      ReasonComprNotAllowed@1100528401 : Text;
    BEGIN
      //**4PS
      IF NOT CompressingIsAllowed(ReasonComprNotAllowed) THEN BEGIN
        ERROR(
          STRSUBSTNO('%1 %2',
          STRSUBSTNO(Text11012010, SalesHeader.TABLECAPTION, SalesHeader."No."),
          ReasonComprNotAllowed));
      END;
    END;

    LOCAL PROCEDURE GetObjectGroupDescription@1100528418() : Text;
    VAR
      ServiceObject@1100528400 : Record 11071691;
      StandardObject@1100528401 : Record 11020334;
      ServiceGroup@1100528402 : Record 11012830;
    BEGIN
      //**4PS
      IF ServiceObject.GET("Object No.") THEN
        IF StandardObject.GET(ServiceObject."Standard Object No.") THEN
          IF ServiceGroup.GET(StandardObject."Object Group", '') THEN
            EXIT(ServiceGroup.Description);
    END;

    LOCAL PROCEDURE GetInvoicedFromToOfDescription2@1100528403() InvoicedFromTo : Text[50];
    VAR
      ParenthesisFoundAtPos@1100528400 : Integer;
    BEGIN
      //**4PS
      // (Invoiced Quantity: <Quantity>) must be removed from Description 2 when lines are compressed.
      ParenthesisFoundAtPos := STRPOS("Description 2", '(');
      IF ParenthesisFoundAtPos > 2 THEN
        InvoicedFromTo := COPYSTR("Description 2", 1, ParenthesisFoundAtPos - 2)
      ELSE
        InvoicedFromTo := "Description 2";
    END;

    LOCAL PROCEDURE ModifyCompressedSalesLine@1100528427(CompressedSalesLine@1100528400 : Record 37);
    BEGIN
      //**4PS
      CompressedSalesLine.SuspendStatusCheck(TRUE);
      CompressedSalesLine.VALIDATE("Unit Price", "Line Amount" + CompressedSalesLine."Unit Price");
      CompressedSalesLine."Description 2" := ComposeDescr2OfCompressedSalesLine(
        CompressedSalesLine);
      CompressedSalesLine.MODIFY;
    END;

    LOCAL PROCEDURE InsertCompressedSalesLine@1100528428(CompressedSalesLine@1100528400 : Record 37);
    BEGIN
      //**4PS
      CompressedSalesLine := Rec;
      CompressedSalesLine.SuspendStatusCheck(TRUE);
      CompressedSalesLine.VALIDATE(Quantity, 1);
      CompressedSalesLine.VALIDATE("Unit Price", "Line Amount");
      CompressedSalesLine.Description := GetObjectGroupDescription;
      CompressedSalesLine."Description 2" := '';
      CompressedSalesLine."Description 2" := ComposeDescr2OfCompressedSalesLine(
        CompressedSalesLine);
      CompressedSalesLine."Object No." := '';
      CompressedSalesLine."Service Location No." := '';
      CompressedSalesLine."Line No." := GetLastLineNo + 10000;
      CompressedSalesLine.INSERT;
    END;

    LOCAL PROCEDURE ComposeDescr2OfCompressedSalesLine@1100528414(CompressedSalesLine@1100528400 : Record 37) Description2 : Text[50];
    VAR
      DescrWithoutQty@1100528401 : Text;
      CurrentQtyTxt@1100528403 : Text;
      MaxQty@1100528402 : Integer;
      MaxNoOfDigitsOfQty@1100528404 : Integer;
      StartPosOfQty@1100528405 : Integer;
      EndPosOfQty@1100528406 : Integer;
      CurrentQty@1100528407 : Integer;
      Qty@1100528408 : Integer;
    BEGIN
      //**4PS
      DescrWithoutQty := STRSUBSTNO('%1 (%2 %3)', GetInvoicedFromToOfDescription2, Text11012014, '');
      MaxNoOfDigitsOfQty := MAXSTRLEN(CompressedSalesLine."Description 2") - STRLEN(DescrWithoutQty);
      IF MaxNoOfDigitsOfQty > 9 THEN
        MaxNoOfDigitsOfQty := 9; // POWER(10, 10) will result in an overflow.
      MaxQty := POWER(10, MaxNoOfDigitsOfQty) - 1;

      StartPosOfQty := STRPOS(CompressedSalesLine."Description 2", '(') + STRLEN(Text11012014) + 2;
      EndPosOfQty := STRPOS(CompressedSalesLine."Description 2", ')') - 1;
      IF EndPosOfQty > 0 THEN
        CurrentQtyTxt := COPYSTR(
          CompressedSalesLine."Description 2", StartPosOfQty, EndPosOfQty + 1 - StartPosOfQty)
      ELSE
        CurrentQtyTxt := '0';

      IF EVALUATE(CurrentQty, CurrentQtyTxt) THEN
        Qty := CurrentQty + GetServiceObjectQuantity
      ELSE
        Qty := GetServiceObjectQuantity;

      IF Qty > MaxQty THEN
        Description2 := STRSUBSTNO('%1 (%2>%3)', GetInvoicedFromToOfDescription2, Text11012014, MaxQty)
      ELSE
        Description2 := STRSUBSTNO('%1 (%2 %3)', GetInvoicedFromToOfDescription2, Text11012014, Qty);
    END;

    LOCAL PROCEDURE GetLastLineNo@1100528438() : Integer;
    VAR
      SalesLine@1100528400 : Record 37;
    BEGIN
      //**4PS
      SalesLine.SETRANGE("Document Type", "Document Type");
      SalesLine.SETRANGE("Document No.", "Document No.");
      IF SalesLine.FINDLAST THEN
        EXIT(SalesLine."Line No.");
    END;

    LOCAL PROCEDURE GetServiceObjectQuantity@1100528407() : Integer;
    VAR
      ServiceObject@1100528400 : Record 11071691;
      ContractObject@1100528602 : Record 11071702;
    BEGIN
      //**4PS
      IF "Service Contract No." = '' THEN BEGIN
        IF ServiceObject.GET("Object No.") THEN
          EXIT(ServiceObject.Quantity);
      END ELSE BEGIN
        IF NOT ContractObject.GET("Service Contract No.", "Object No.") THEN
          ContractObject.INIT;
        EXIT(ContractObject.GetQuantity("Posting Date"));
      END;
    END;

    PROCEDURE RetentionAmount@1100528500(AmountOption@1100528502 : 'Both Retentions,Retention 1,Retention 2') RetentionAmnt : Decimal;
    VAR
      RetentionBaseAmount@1100528500 : Decimal;
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"]) THEN
        EXIT;
      IF "VAT Calculation Type" = "VAT Calculation Type"::"Full VAT" THEN
        EXIT;

      IF ("Document No." = '') OR ("No." = '') THEN
        EXIT(0);

      IF "Advance Payment" THEN
        EXIT(0);

      GetSalesHeader;
      IF (SalesHeader."Retention %" = 0) AND (SalesHeader."Retention % 2" = 0) THEN
        EXIT;
      IF ReleaseRetention THEN
        EXIT;

      RetentionBaseAmount := ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") - "Line Discount Amount";

      CASE AmountOption OF
        AmountOption::"Retention 1":
          RetentionAmnt := ROUND(
            SalesHeader."Retention %" / 100 * RetentionBaseAmount, Currency."Amount Rounding Precision");
        AmountOption::"Retention 2":
          RetentionAmnt := ROUND(
            SalesHeader."Retention % 2" / 100 * RetentionBaseAmount, Currency."Amount Rounding Precision");
        AmountOption::"Both Retentions":
          RetentionAmnt :=
            ROUND(SalesHeader."Retention %" / 100 * RetentionBaseAmount, Currency."Amount Rounding Precision") +
            ROUND(SalesHeader."Retention % 2" / 100 * RetentionBaseAmount, Currency."Amount Rounding Precision");
      END;
    END;

    PROCEDURE RetentionAmountLCY@10009000(AmountOption@1100528502 : 'Both Retentions,Retention 1,Retention 2') RetentionAmntLCY : Decimal;
    VAR
      Currency2@1100529500 : Record 4;
      RetentionAmnt@10009000 : Decimal;
    BEGIN
      //**4PS
      RetentionAmnt := Rec.RetentionAmount(AmountOption);

      IF SalesHeader."Currency Code" = '' THEN
        RetentionAmntLCY := RetentionAmnt
      ELSE BEGIN
        Currency2.InitRoundingPrecision;
        RetentionAmntLCY := ROUND(
          CurrExchRate.ExchangeAmtFCYToLCY(
            1,"Job No.",
            SalesHeader."Posting Date",
            SalesHeader."Currency Code",
            RetentionAmnt,
            SalesHeader."Currency Factor",
            TRUE),
          Currency2."Amount Rounding Precision");
      END;
    END;

    PROCEDURE ReleaseRetention@1100528501() : Boolean;
    VAR
      CustPostingGrp@1100409000 : Record 92;
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"]) THEN
        EXIT;
      IF "Advance Payment" THEN
        EXIT(FALSE);

      GetSalesHeader;
      IF SalesHeader."Bill-to Customer No." = '' THEN
        EXIT(FALSE);

      SalesHeader.TESTFIELD("Customer Posting Group");

      CustPostingGrp.GET(SalesHeader."Customer Posting Group");

      EXIT(
        ("No." = CustPostingGrp."Retention Suspense Acc.") AND
        (CustPostingGrp."Retention Suspense Acc." <> ''));
    END;

    PROCEDURE GetServiceObjectDescription@1100528404() : Text[100];
    VAR
      ServiceObject@1100528400 : Record 11071691;
    BEGIN
      //**4PS
      IF ServiceObject.GET("Object No.") THEN
        EXIT(ServiceObject.Description);
    END;

    PROCEDURE HandleAssistEditTradeItem@1100528200() : Boolean;
    VAR
      WebshopItemMgt@1100528300 : Codeunit 11012306;
      RecRef@1100528301 : RecordRef;
    BEGIN
      //**4PS
      RecRef.GETTABLE(Rec);
      WebshopItemMgt.RunModalDialogForMultipleItems("Vendor (Trade Item)", "Trade Item", RecRef);
      EXIT(TRUE);
    END;

    PROCEDURE HandleLookupItem@1100528201(lvFieldNo@1100525004 : Integer) lvRefresh : Boolean;
    VAR
      ItemRec@1100525001 : Record 27;
      ItemFrm@1100525000 : Page 31;
      BasicItemRec@1100525007 : Record 11012316;
      BasicItemFrm@1100525006 : Page 11012333;
      TradeItemRec@1100525010 : Record 11012317;
      TradeItemFrm@1100525009 : Page 11012334;
      lvTempSalesLine@1100525008 : TEMPORARY Record 37;
      lvRefDate@1100525005 : Date;
      lvDiscRef1@1100525003 : Code[20];
      lvDiscRef2@1100525002 : Code[20];
      lvRefPrio@1100525014 : Code[10];
      lvDiscType@1100525013 : 'Purchase,Sales';
      g_ItemCode@1100525012 : Code[20];
      g_Vendor@1100525011 : Code[20];
    BEGIN
      //**4PS
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2, lvRefPrio, lvDiscType::Purchase);  //DP01339
      IF lvFieldNo = FIELDNO("Item No.") THEN BEGIN
        ItemFrm.LOOKUPMODE(TRUE);
        ItemFrm.DetermineInterface(DATABASE::"Sales Line",
          "Document No.",Element,"Job No.","Service Order No.","Document Type",'','',"Line No.",'','');
        IF ItemRec.GET("Item No.") THEN
          ItemFrm.SETRECORD(ItemRec);
        IF ItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          xRec := Rec;
          ItemFrm.GETRECORD(ItemRec);
          VALIDATE("Item No.",ItemRec."No.");
        END ELSE BEGIN
          lvRefresh := ItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Basic Item") THEN BEGIN
        CLEAR(BasicItemFrm);
        BasicItemFrm.LOOKUPMODE(TRUE);
        BasicItemFrm.SetSelection(DATABASE::"Sales Line",
          "Document No.",Element,"Job No.","Service Order No.","Document Type",'','',"Line No.",'','');
        BasicItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);
        BasicItemRec.InitLookup(BasicItemRec, "Basic Item", Manufacturer);
        BasicItemFrm.SETRECORD(BasicItemRec);
        IF BasicItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          xRec := Rec;
          BasicItemFrm.GETRECORD(BasicItemRec);
          Manufacturer := BasicItemRec.Manufacturer;
          VALIDATE("Basic Item", BasicItemRec."Product Code");
        END ELSE BEGIN
          lvRefresh := BasicItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Trade Item") THEN BEGIN
        IF "Item No." <> '' THEN BEGIN
          lvTempSalesLine.INIT;
          lvTempSalesLine."Document Type" := "Document Type";
          lvTempSalesLine."Document No." := "Document No.";
          lvTempSalesLine.VALIDATE("Item No.","Item No.");
          g_ItemCode := lvTempSalesLine."Trade Item";
          g_Vendor := lvTempSalesLine."Vendor (Trade Item)";
        END ELSE BEGIN
          g_ItemCode := '';
          g_Vendor := '';
        END;

        CLEAR(TradeItemFrm);
        TradeItemFrm.LOOKUPMODE(TRUE);
        TradeItemFrm.SetSelection(DATABASE::"Sales Line",
          "Document No.",Element,GetFilterVendor,"Job No.","Document Type","Service Order No.",'',"Line No.",'','',
          "Vendor (Trade Item)","Trade Item",Manufacturer,"Basic Item", g_ItemCode, g_Vendor);
        TradeItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);
        TradeItemRec.InitLookup(TradeItemRec, "Basic Item", Manufacturer, "Trade Item", "Vendor (Trade Item)");
        TradeItemFrm.SETRECORD(TradeItemRec);
        IF TradeItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          xRec := Rec;
          TradeItemFrm.GETRECORD(TradeItemRec);
          Manufacturer := TradeItemRec.Manufacturer;
          "Basic Item" := TradeItemRec."Product Code";
          "Vendor (Trade Item)" := TradeItemRec.Vendor;
          VALIDATE("Trade Item", TradeItemRec."Item Code");
        END ELSE BEGIN
          lvRefresh := TradeItemFrm.CheckMultiCopy;
        END;
      END;

      EXIT(lvRefresh);
    END;

    PROCEDURE GetFilterVendor@1100528206() VendorFilter@11012000 : Text[250];
    VAR
      VendorRelationRec@1100485000 : Record 11012313;
      InventorySetup@1210190000 : Record 313;
    BEGIN
      //**4PS
      VendorFilter := "Vendor (Trade Item)";
      IF VendorFilter = '' THEN BEGIN
        InventorySetup.GET;
        IF InventorySetup."Vendor Filter" = InventorySetup."Vendor Filter"::Hard THEN BEGIN
          VendorRelationRec.SETRANGE("Display Trade Items", TRUE);
          IF VendorRelationRec.FINDSET THEN
            REPEAT
              IF VendorFilter = '' THEN
                VendorFilter := VendorRelationRec.Code
              ELSE
                IF STRLEN(VendorFilter) + STRLEN(VendorRelationRec.Code) < MAXSTRLEN(VendorFilter) THEN
                  VendorFilter := VendorFilter + '|' + VendorRelationRec.Code;
            UNTIL VendorRelationRec.NEXT = 0;
        END;
      END;
      EXIT(VendorFilter);
    END;

    PROCEDURE ResourceRequestInvoice@1100529000() : Boolean;
    VAR
      SalesHead@1100529000 : Record 36;
    BEGIN
      //**4PS
      IF ("Document No." <> '') AND ("Document Type" IN ["Document Type"::Invoice, "Document Type"::"Credit Memo"]) THEN BEGIN
        IF SalesHead.GET("Document Type", "Document No.") THEN
          EXIT(SalesHead."Collective List No. (Res.Req.)" <> '');
      END;
      EXIT(FALSE);
    END;

    PROCEDURE TestFieldResourceRequestInvoice@1100529001(TestValue@1100529000 : Boolean);
    VAR
      SalesHead@1100529001 : Record 36;
      lvText000@1100529002 : TextConst 'ENU=Resource Requist Invoice must be %1 (%2 is ''%3'') in %4, %5 ''%6''';
    BEGIN
      //**4PS
      IF ResourceRequestInvoice <> TestValue THEN BEGIN
        SalesHead.GET("Document Type", "Document No.");
        ERROR(lvText000,
          TestValue, SalesHead.FIELDCAPTION("Collective List No. (Res.Req.)"), SalesHead."Collective List No. (Res.Req.)",
          SalesHead.TABLECAPTION, SalesHead.FIELDCAPTION("No."), "Document No.");
      END;
    END;

    LOCAL PROCEDURE GetSalesAccountForNonInventoryTradeItem@1100525017(TradeItem@1100528401 : Record 11012317;VAR SalesAccount@1100529901 : Code[20]) : Boolean;
    VAR
      GeneralPostingSetup@1100525000 : Record 252;
    BEGIN
      //**4PS
      IF "Project Invoice" OR "Service Invoice" OR "Plant Invoice" THEN EXIT(FALSE);
      IF ("Job No." <> '') OR ("Service Order No." <> '') THEN EXIT(FALSE);
      IF "Item No." <> '' THEN EXIT(FALSE);
      IF TradeItem.GetItemCode <> '' THEN EXIT(FALSE);

      IF GeneralPostingSetup.GET(GetGenBusPostingGroup, TradeItem."Gen. Prod. Posting Group") THEN BEGIN
        IF GeneralPostingSetup."Sales Account" = '' THEN
          EXIT(FALSE);
        SalesAccount := GeneralPostingSetup."Sales Account";
        EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE GetGenBusPostingGroup@1100528417() : Code[10];
    BEGIN
      //**4PS
      IF "Gen. Bus. Posting Group" <> '' THEN
        EXIT("Gen. Bus. Posting Group");
      GetSalesHeader;
      EXIT(SalesHeader."Gen. Bus. Posting Group");
    END;

    LOCAL PROCEDURE FindCostPrice@1100528901(TypeArtOpt@1100528905 : 'Item,Basic Item,Trade Item');
    VAR
      Customer@1100525000 : Record 18;
      RefDate@1100528904 : Date;
      DiscRef1@1100528903 : Code[20];
      DiscRef2@1100528902 : Code[20];
      RefPrio@1100528901 : Code[10];
      DiscType@1100528900 : 'Purchase,Sales';
      DummyDat@1100528906 : Date;
    BEGIN
      //**4PS DP01339
      //C041255: redesign (LCY/FCY)
      GetReferenceData(RefDate, DiscRef1, DiscRef2, RefPrio, DiscType::Purchase);
      ValidateCu.SetQuantity(Quantity);
      ValidateCu.ValidateItem(TypeArtOpt,"Trade Item", "Item No.", Manufacturer, "Vendor (Trade Item)",
        "Basic Item", "Shortcut Dimension 2 Code", Description, "Unit of Measure Code", "Unit Cost (LCY)",
        "Purchase Discount % (Item)", DummyDat, "Gross Price (LCY)", "Description 2", "Cost Component",
        DiscRef1, DiscRef2, RefDate, RefPrio);
      //C043052.sn
      Customer.GET(SalesHeader."Bill-to Customer No.");
      IF Customer."Item Price Sales Line" = Customer."Item Price Sales Line"::CostPrice THEN BEGIN
        "Basic Price (LCY)" := "Unit Cost (LCY)";
      END ELSE BEGIN
        "Basic Price (LCY)" := "Gross Price (LCY)";
      END;
      //C043052.en
      CalculateFCYFromLCY(FIELDNO("Basic Price (LCY)"));
      CalculateFCYFromLCY(FIELDNO("Gross Price (LCY)"));
    END;

    LOCAL PROCEDURE FindSalesPrice@1100528900();
    VAR
      ProjSetup@1100528901 : Record 315;
      Customer@1100528902 : Record 18;
      RefDate@1100528907 : Date;
      DiscRef1@1100528906 : Code[20];
      DiscRef2@1100528905 : Code[20];
      RefPrio@1100528904 : Code[10];
      DiscType@1100528903 : 'Purchase,Sales';
      SalesDiscount@1100528900 : Decimal;
      BasicPrice@1100525000 : Decimal;
      GrossPrice@1100525001 : Decimal;
    BEGIN
      //**4PS DP01339
      //C041255: redesign (LCY/FCY)
      IF "Project Invoice" OR "Service Invoice" OR "Plant Invoice" THEN EXIT;
      GetSalesHeader;
      "Currency Code" := SalesHeader."Currency Code";  //C051724
      ProjSetup.GET;
      Customer.GET(SalesHeader."Bill-to Customer No.");
      GetReferenceData(RefDate, DiscRef1, DiscRef2, RefPrio, DiscType::Sales);
      ValidateCu.SetQuantity(Quantity);
      GrossPrice := "Gross Price (LCY)";
      "Sales Condition Present" := ValidateCu.GetSalesPrice(
        SalesHeader."Bill-to Customer No.", "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
        BasicPrice, SalesDiscount, GrossPrice, RefDate, '', DiscRef1, DiscRef2, RefPrio);  //(GrossPrice=VAR)
      IF Customer."Item Price Sales Line" = Customer."Item Price Sales Line"::GrossMin THEN BEGIN //C041255
        "Gross Price (LCY)" := GrossPrice;
        CalculateFCYFromLCY(FIELDNO("Gross Price (LCY)"));
        "Basic Price (LCY)" := BasicPrice;
        CalculateFCYFromLCY(FIELDNO("Basic Price (LCY)"));
      END ELSE BEGIN
        IF (ProjSetup."Apply SalesPrice for SurchMat") AND ("Sales Condition Present") THEN BEGIN
          "Gross Price (LCY)" := GrossPrice;
          CalculateFCYFromLCY(FIELDNO("Gross Price (LCY)"));
          "Basic Price (LCY)" := BasicPrice;
          CalculateFCYFromLCY(FIELDNO("Basic Price (LCY)"));
        END;
      END;
      IF "Sales Condition Present" THEN
        VALIDATE("Sales Discount % (Item)", SalesDiscount)
      ELSE
        GetSalesDiscount;
      VALIDATE("Surcharge %", GetSurchargePerc);
      "Allow Line Disc." := FALSE;  //avoid usage DiscountPercentage for SalesDiscount and LineDiscount
      VALIDATE("Line Discount %", 0);
    END;

    LOCAL PROCEDURE GetSalesDiscount@1100528902();
    BEGIN
      //**4PS DP01339
      IF "Gross Price (LCY)" <> 0 THEN
        "Sales Discount % (Item)" := (("Gross Price (LCY)" - "Basic Price (LCY)") / "Gross Price (LCY)") * 100;
    END;

    LOCAL PROCEDURE CalculateFCYFromLCY@1100525023(iField@1100525003 : Integer);
    VAR
      ProjectCurrencyExchangeRate@1100525005 : Record 11020628;
      OrigValue@1100525004 : Decimal;
      DestValue@1100525002 : Decimal;
      CurrencyCode@1100525006 : Code[10];
      SalesExchange@1100525001 : Boolean;
      PriceRounding@1100525000 : Boolean;
    BEGIN
      //**4PS C041255
      CASE iField OF
        FIELDNO("Gross Price (LCY)"):
          BEGIN
            IF ConvertFCYtoLCY[1] = TRUE THEN EXIT;
            OrigValue := "Gross Price (LCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := TRUE;
          END;
        FIELDNO("Basic Price (LCY)"):
          BEGIN
            IF ConvertFCYtoLCY[2] = TRUE THEN EXIT;
            OrigValue := "Basic Price (LCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := TRUE;
          END;
        FIELDNO("Surcharge Amount (LCY)"):
          BEGIN
            IF ConvertFCYtoLCY[3] = TRUE THEN EXIT;
            OrigValue := "Surcharge Amount (LCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := FALSE;
          END;
        FIELDNO("Sales Price (LCY)"):
          BEGIN
            IF ConvertFCYtoLCY[4] = TRUE THEN EXIT;
            OrigValue := "Sales Price (LCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := TRUE;
          END;
      END;
      IF CurrencyCode <> '' THEN BEGIN
        DestValue := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY(
          OrigValue, SalesExchange, PriceRounding, CurrencyCode, "Job No.", "Sell-to Customer No.", TODAY);
      END ELSE BEGIN
        DestValue := OrigValue;
      END;
      CASE iField OF
        FIELDNO("Gross Price (LCY)"): "Gross Price (FCY)" := DestValue;
        FIELDNO("Basic Price (LCY)"): "Basic Price (FCY)" := DestValue;
        FIELDNO("Surcharge Amount (LCY)"): "Surcharge Amount (FCY)" := DestValue;
        FIELDNO("Sales Price (LCY)"): "Sales Price (FCY)" := DestValue;
      END;
    END;

    LOCAL PROCEDURE CalculateLCYFromFCY@1100525020(iField@1100525003 : Integer;ValidateLCYField@1100529600 : Boolean);
    VAR
      ProjectCurrencyExchangeRate@1100525000 : Record 11020628;
      OrigValue@1100525004 : Decimal;
      DestValue@1100525005 : Decimal;
      CurrencyCode@1100525001 : Code[10];
      SalesExchange@1100525007 : Boolean;
      PriceRounding@1100525008 : Boolean;
    BEGIN
      //**4PS C041255
      CASE iField OF
        FIELDNO("Gross Price (FCY)"):
          BEGIN
            IF ConvertFCYtoLCY[1] = TRUE THEN EXIT;
            OrigValue := "Gross Price (FCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := TRUE;
          END;
        FIELDNO("Basic Price (FCY)"):
          BEGIN
            IF ConvertFCYtoLCY[2] = TRUE THEN EXIT;
            OrigValue := "Basic Price (FCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := TRUE;
          END;
        FIELDNO("Surcharge Amount (FCY)"):
          BEGIN
            IF ConvertFCYtoLCY[3] = TRUE THEN EXIT;
            OrigValue := "Surcharge Amount (FCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := FALSE;
          END;
        FIELDNO("Sales Price (FCY)"):
          BEGIN
            IF ConvertFCYtoLCY[4] = TRUE THEN EXIT;
            OrigValue := "Sales Price (FCY)";
            CurrencyCode := "Currency Code";
            SalesExchange := TRUE;
            PriceRounding := TRUE;
          END;
      END;
      IF CurrencyCode <> '' THEN BEGIN
        DestValue := ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY(
          OrigValue, SalesExchange, PriceRounding, CurrencyCode, "Job No.", "Sell-to Customer No.", TODAY);
      END ELSE BEGIN
        DestValue := OrigValue;
      END;
      CASE iField OF
        FIELDNO("Gross Price (FCY)"):
          IF ValidateLCYField THEN BEGIN
            ConvertFCYtoLCY[1] := TRUE;
            VALIDATE("Gross Price (LCY)", DestValue);
            ConvertFCYtoLCY[1] := FALSE;
          END ELSE
            "Gross Price (LCY)" := DestValue;
        FIELDNO("Basic Price (FCY)"):
          IF ValidateLCYField THEN BEGIN
            ConvertFCYtoLCY[2] := TRUE;
            VALIDATE("Basic Price (LCY)", DestValue);
            ConvertFCYtoLCY[2] := FALSE;
          END ELSE
            "Basic Price (LCY)" := DestValue;
        FIELDNO("Surcharge Amount (FCY)"):
          IF ValidateLCYField THEN BEGIN
            ConvertFCYtoLCY[3] := TRUE;
            VALIDATE("Surcharge Amount (LCY)", DestValue);
            ConvertFCYtoLCY[3] := FALSE;
          END ELSE
            "Surcharge Amount (LCY)" := DestValue;
        FIELDNO("Sales Price (FCY)"):
          IF ValidateLCYField THEN BEGIN
            ConvertFCYtoLCY[4] := TRUE;
            VALIDATE("Sales Price (LCY)", DestValue);
            ConvertFCYtoLCY[4] := FALSE;
          END ELSE
            "Sales Price (LCY)" := DestValue;
      END;
    END;

    PROCEDURE AssistEditSalesCondition@1100525027();
    VAR
      RefDate@1100525005 : Date;
      DiscRef1@1100525004 : Code[20];
      DiscRef2@1100525003 : Code[20];
      RefPrio@1100525002 : Code[10];
      DiscType@1100525001 : 'Purchase,Sales';
      ValidateCu@1100525006 : Codeunit 11012033;
    BEGIN
      //**4PS DP01339
      GetSalesHeader;
      GetReferenceData(RefDate, DiscRef1, DiscRef2, RefPrio, DiscType::Sales);
      ValidateCu.SetQuantity(Quantity);
      ValidateCu.ShowSalesCondition(
        SalesHeader."Bill-to Customer No.", "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
        "Basic Price (LCY)", "Sales Discount % (Item)", "Gross Price (LCY)", RefDate, '', DiscRef1, DiscRef2, RefPrio);
    END;

    LOCAL PROCEDURE CheckPriceSpecificationAllowed@1100528906();
    BEGIN
      //**4PS DP01339
      TESTFIELD("Project Invoice", FALSE);
      TESTFIELD("Service Invoice", FALSE);
      TESTFIELD("Plant Invoice", FALSE);
      IF (CurrFieldNo = FIELDNO("Gross Price (LCY)")) OR
         (CurrFieldNo = FIELDNO("Gross Price (FCY)")) OR
         (CurrFieldNo = FIELDNO("Sales Discount % (Item)")) OR
         (CurrFieldNo = FIELDNO("Basic Price (LCY)")) OR
         (CurrFieldNo = FIELDNO("Basic Price (FCY)")) OR
         (CurrFieldNo = FIELDNO("Surcharge %")) OR
         (CurrFieldNo = FIELDNO("Surcharge Amount (LCY)")) OR
         (CurrFieldNo = FIELDNO("Surcharge Amount (FCY)")) OR
         (CurrFieldNo = FIELDNO("Sales Price (LCY)")) OR
         (CurrFieldNo = FIELDNO("Sales Price (FCY)")) OR
         (CurrFieldNo = FIELDNO("Discount % (Contract)")) THEN
        "Price Specification Leading" := TRUE;
    END;

    PROCEDURE CheckLocationBlocked@1100527000(ILocationCode@1100527000 : Code[10]);
    VAR
      Location@1100527001 : Record 14;
    BEGIN
      //**4PS
      IF Location.GET(ILocationCode) THEN
        Location.TESTFIELD(Blocked,FALSE);
    END;

    PROCEDURE UnitOfMeasureCodeDiffersFromPackagingUnitOfNonInventoryTradeItem@1100528408() : Boolean;
    VAR
      TradeItem@1100528400 : Record 11012317;
    BEGIN
      //**4PS
      IF "Vendor (Trade Item)" = '' THEN
        EXIT(FALSE);
      IF "Trade Item" = '' THEN
        EXIT(FALSE);
      IF "Item No." <> '' THEN
        EXIT(FALSE);

      IF TradeItem.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
        IF TradeItem.GetItemCode <> '' THEN
          EXIT(FALSE);
        IF TradeItem."Packaging Unit" <> "Unit of Measure Code" THEN
          EXIT(TRUE);
      END;
    END;

    PROCEDURE DimensionalFactor@1100529900() : Decimal;
    BEGIN
      //DP01519
      IF "Dimensional Factor" = 0 THEN
        EXIT(1);

      EXIT("Dimensional Factor");
    END;

    PROCEDURE CheckDeliveryTime@1100485015(lvFieldNo@1100485005 : Integer);
    VAR
      ItemLoc@1100529601 : Record 27;
      lvPeriod@1100485000 : Text[30];
      lvOrderDate@1100485001 : Date;
      lvShipmentDate@1100485002 : Date;
      lvExpectedDate@1100485003 : Date;
      lvText000@1100485004 : TextConst 'ENU=can not be delivered before %1 (%2), expected %3.;SVE=Artikeln kan inte levereras f”re %1 (%2), f”rv„ntad %3.';
      MessageTxtLoc@1100529600 : Text;
    BEGIN
      //**4PS
      IF NOT ("Document Type" IN ["Document Type"::Quote, "Document Type"::Order]) THEN
        EXIT;

      IF lvFieldNo = FIELDNO("Item No.") THEN
        UpdateShippingTime
      ELSE
        lvPeriod := FORMAT("Shipping Time");

      GetSalesHeader;

      lvOrderDate := "Planned Shipment Date";
      IF lvOrderDate = 0D THEN
        lvOrderDate := SalesHeader."Order Date";
      IF lvOrderDate = 0D THEN  //Order date will no be filled for quote
        lvOrderDate := SalesHeader."Document Date";
      IF lvOrderDate = 0D THEN
        lvOrderDate := TODAY;

      lvShipmentDate := SalesHeader."Shipment Date";
      IF lvPeriod = '' THEN
        lvExpectedDate := lvShipmentDate
      ELSE
        lvExpectedDate := CalendarMgmt.CalcDateBOC(
          '+' + lvPeriod, lvOrderDate,
          CalChange."Source Type"::Customer, "Sell-to Customer No.", '',
          CalChange."Source Type"::Location, "Location Code", '', FALSE);

      IF SalesHeader."Shipment Date" = 0D THEN BEGIN
        "Shipment Date" := lvExpectedDate;
        "Planned Shipment Date" := lvOrderDate;
        IF lvFieldNo <> FIELDNO("Shipping Time") THEN
          EVALUATE("Shipping Time", lvPeriod);
      END;

      IF (lvExpectedDate > lvShipmentDate) AND (lvShipmentDate <> 0D) THEN BEGIN
        IF lvFieldNo <> 0 THEN BEGIN
          MessageTxtLoc := ItemNoFieldCaptionTxt;
          IF "Item No." <> '' THEN BEGIN
            MessageTxtLoc := MessageTxtLoc + ' ' + "Item No.";
            IF ItemLoc.GET("Item No.") THEN
              IF ItemLoc.Description <> '' THEN
                MessageTxtLoc := MessageTxtLoc + ' ' + ItemLoc.Description;
          END;
          MessageTxtLoc := MessageTxtLoc + ' ' + STRSUBSTNO(lvText000,SalesHeader.FIELDCAPTION("Shipment Date"),SalesHeader."Shipment Date",lvExpectedDate);
          MESSAGE(MessageTxtLoc);
        END;
      END;
    END;

    PROCEDURE UpdateShippingTime@1100527902();
    VAR
      Item@1100525000 : Record 27;
    BEGIN
      //**4PS
      IF Type = Type::Item THEN BEGIN
        GetSalesHeader;
        GetItem(Item);

        "Shipping Time" := Item."Lead Time Calculation";
        IF FORMAT("Shipping Time") = '' THEN
          "Shipping Time" := SalesHeader."Shipping Time";
      END;
    END;

    PROCEDURE BalanceDatesAndDeliveryPeriod@1100528315(FromFieldNo@1210190000 : Integer);
    VAR
      FieldToCalculate@1210190001 : 'None,PlannedDeliveryDate,PlannedShipmentDate';
    BEGIN
      //**4PS
      CASE FromFieldNo OF
        FIELDNO("Planned Shipment Date") :
          BEGIN
            IF ("Planned Shipment Date" <> 0D) AND ("Planned Shipment Date" < TODAY) THEN
              "Planned Shipment Date" := TODAY;
            FieldToCalculate := FieldToCalculate::PlannedDeliveryDate;
          END;
        FIELDNO("Shipping Time") :
          BEGIN
            IF (FORMAT("Shipping Time") <> '') THEN
              FieldToCalculate := FieldToCalculate::PlannedShipmentDate;
          END;
        FIELDNO("Planned Delivery Date") :
          BEGIN
            IF ("Planned Delivery Date" <> 0D) AND ("Planned Delivery Date" < TODAY) THEN
              "Planned Delivery Date" := TODAY;
            IF ("Planned Delivery Date" <> xRec."Planned Delivery Date") THEN
              FieldToCalculate := FieldToCalculate::PlannedShipmentDate;
          END;
      END;

      CASE FieldToCalculate OF
        FieldToCalculate::PlannedDeliveryDate :
          BEGIN
            IF (FORMAT("Shipping Time") <> '') THEN
              "Planned Delivery Date" := CalendarMgmt.CalcDateBOC(
                 '+' + FORMAT("Shipping Time"), "Planned Shipment Date",
                 CalChange."Source Type"::Company, '', '',
                 CalChange."Source Type"::Customer, "Sell-to Customer No.", '', FALSE);
          END;
      END;
    END;

    LOCAL PROCEDURE UpdateVatProdPostingGrp@1100527300();
    VAR
      VatProdPostingGrp@1100527300 : Code[10];
      ProjSetup@1100527301 : Record 315;
      ProjectPrincipal@1100527302 : Record 11012005;
      ItemLoc@1100527303 : Record 27;
      DimensionValue@1100527304 : Record 349;
    BEGIN
      //**4PS
      IF "Job No." = '' THEN
        EXIT;

      VatProdPostingGrp := '';

      ProjSetup.GET;

      IF ProjSetup."Source VAT Prod. Posting Group" = ProjSetup."Source VAT Prod. Posting Group"::"Item/CostObject" THEN BEGIN
        IF "Item No." <> '' THEN
          IF ItemLoc.GET("Item No.") THEN
            VatProdPostingGrp := ItemLoc."VAT Prod. Posting Group";

        IF VatProdPostingGrp = '' THEN
          IF "Shortcut Dimension 2 Code" <> '' THEN BEGIN
            DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimensionValue, FALSE, '');
            VatProdPostingGrp := DimensionValue."VAT Prod. Posting Group";
          END;
      END;

      IF VatProdPostingGrp = '' THEN
        IF ProjectPrincipal.GET("Job No.", "Sell-to Customer No.") THEN
          VatProdPostingGrp := ProjectPrincipal."VAT Prod. Posting Group";

      VALIDATE("VAT Prod. Posting Group", VatProdPostingGrp);
    END;

    LOCAL PROCEDURE CheckProjServPlantLoanAllowed@1100528510(ActualFieldNo@1100528500 : Integer);
    BEGIN
      //**4PS
      CASE ActualFieldNo OF
        FIELDNO("Service Contract No."):
          IF "Service Contract No." <> '' THEN
            TESTFIELD("Loan Code",'');
        FIELDNO("Service Order No."):
          IF "Service Order No." <> '' THEN
            TESTFIELD("Loan Code",'');
        FIELDNO("Job No."):
          IF "Job No." <> '' THEN
            TESTFIELD("Loan Code",'');
        FIELDNO("Plant Type"):
          IF "Plant Type" <> '' THEN
            TESTFIELD("Loan Code",'');
        FIELDNO("Loan Code"):
          BEGIN
            IF "Loan Code" <> '' THEN BEGIN
              TESTFIELD("Job No.",'');
              TESTFIELD("Service Contract No.",'');
              TESTFIELD("Service Order No.",'');
              TESTFIELD("Plant Type",'');
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE CheckItemUnitConversion@1100528505();
    BEGIN
      //**4PS
      IF "Trade Item" <> '' THEN
        ItemTypeOpt := ItemTypeOpt::"Trade Item"
      ELSE
        IF "Basic Item" <> '' THEN
          ItemTypeOpt := ItemTypeOpt::"Basic Item"
        ELSE
          IF "Item No." <> '' THEN
            ItemTypeOpt := ItemTypeOpt::Item;

      ValidateCu.ValidateUnit(ItemTypeOpt,
        "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
        Quantity,"Unit of Measure Code","Qty. per Unit of Measure");  //T007321
    END;

    LOCAL PROCEDURE CheckQuantityInventory@1100525011() : Boolean;
    VAR
      BinContent@1100525000 : Record 7302;
    BEGIN
      //**4PS
      IF Location.GET("Location Code") THEN
        IF Location."Bin Mandatory" THEN
          IF BinContent.GET("Location Code", "Bin Code", "Item No.", "Variant Code", "Unit of Measure Code") THEN BEGIN
            BinContent.CALCFIELDS(Quantity);
            IF BinContent.Quantity <> 0 THEN
              EXIT(TRUE);
          END;
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE UpdateShelfNo@1100527303();
    VAR
      Item@1100527300 : Record 27;
      StockkeepingUnit@1100527301 : Record 5700;
    BEGIN
      //**4PS
      IF Item.GET("Item No.") THEN BEGIN
        "Shelf No." := Item."Shelf No.";
        IF "Shelf No." = '' THEN BEGIN
          StockkeepingUnit.SETRANGE("Item No.", "Item No.");
          StockkeepingUnit.SETRANGE("Location Code", "Location Code");
          IF StockkeepingUnit.FINDFIRST THEN
            "Shelf No." := StockkeepingUnit."Shelf No.";
        END;
      END;
    END;

    PROCEDURE LookupUnitOfMeasureCode@1100528903();
    VAR
      UnitOfMeasure@1000 : Record 204;
    BEGIN
      //**4PS
      //C056784: required for trade item (removed by upgrade to bc13; backported from hf17)
      IF NOT CanEditUnitOfMeasureCode THEN
        EXIT;

      IF ("Item No." <> '') OR ("Trade Item" <> '') OR  //C044784
         ((Type = Type::Item) AND ("No." <> '')) THEN BEGIN
        HandleLookupItemUnit;
      END ELSE
        IF PAGE.RUNMODAL(0,UnitOfMeasure) = ACTION::LookupOK THEN
          VALIDATE("Unit of Measure Code",UnitOfMeasure.Code);
    END;

    LOCAL PROCEDURE UpdateQuantityRemovalContribution@1100527650(CalledByFieldNo@1100527653 : Integer);
    VAR
      SalesSetup@1100528902 : Record 311;
      SalesLine@1100527650 : Record 37;
      Item@1100527654 : Record 27;
      TradeItem@1100528900 : Record 11012317;
      RemovalContribution@1100528901 : Decimal;
    BEGIN
      //**4PS
      //C057041: redesign C052168
      IF "Line No." = 0 THEN EXIT;
      IF "Removal Contribution" THEN EXIT;

      SalesSetup.GET;
      IF SalesSetup."Charge Removal Contribution" = FALSE THEN EXIT;

      IF "Trade Item" <> '' THEN BEGIN
        IF NOT TradeItem.GET("Vendor (Trade Item)", "Trade Item") THEN EXIT;
        RemovalContribution := TradeItem."Removal Contribution";
      END ELSE BEGIN
        IF "Item No." <> '' THEN BEGIN
          IF NOT Item.GET("Item No.") THEN EXIT;
          RemovalContribution := Item."Removal Contribution";
        END;
      END;

      IF RemovalContribution = 0 THEN EXIT;

      SalesLine.SETRANGE("Document Type", "Document Type");
      SalesLine.SETRANGE("Document No.", "Document No.");
      SalesLine.SETRANGE("Attached to Line No.", "Line No.");
      SalesLine.SETRANGE("Removal Contribution", TRUE);
      IF SalesLine.FINDFIRST THEN BEGIN
        CASE CalledByFieldNo OF
          FIELDNO("Qty. to Ship") : BEGIN
            SalesLine."Qty. to Ship" := "Qty. to Ship";
            SalesLine.VALIDATE("Qty. to Ship");
            SalesLine.MODIFY;
          END;
          FIELDNO(Quantity) : BEGIN
            SalesLine.Quantity := Quantity;
            SalesLine.VALIDATE(Quantity);
            SalesLine.MODIFY;
          END;
        END;
      END;
    END;

    [Integration]
    LOCAL PROCEDURE OnValidateItemNo@1101285000(VAR Rec@1101285000 : Record 37;VAR xRec@1101285001 : Record 37);
    BEGIN
    END;

    BEGIN
    {
      4PS01 JD 09-10-07 Call 5091, Fill Element from cost object
      4PS02 JD 07-02-08 Call 9828, How item prices are calculated is not visible on sales line
      4PS03 JD 14-02-08 Fill Cost component from SOType or Cost object
      4PS04 JD 29-06-2008, Improvements for intrastat
      4PS05 JD 3-11-2008, Call 12697 add Line Price to some forms

      140905 ITERO.DL IME171 Dimensions are not extended due to lack of VALIDATEs
      151207 ITERO.WG IME339 Added code from 4PS call C023319
      160312 ITERO.LP NAVSE New field 11128020 "Withheld Amount". Handling of restored Installment values.
      170829 ITERO.DL pure275173 withheld amount and re-invoicing

      190321 ORANGO.WG #23515 Problem with JobOffice
      200430 ORANGO.PR Certego Pricefuntion Added Code in GetSurchargePerc()
    }
    END.
  }
}

