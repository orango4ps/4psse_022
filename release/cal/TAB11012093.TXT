OBJECT Table 11012093 Project Preclosure Result
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               CheckOldPreclosureResultReversed;
             END;

    OnModify=BEGIN
               CheckOldPreclosureResultReversed;
               IF Posted THEN
                 ERROR(Text001, "Project No.", "Posting Date");
             END;

    OnDelete=BEGIN
               IF Posted THEN
                 IF Project.GET("Project No.") THEN
                   IF Project."Project Status" < Project."Project Status"::Finished THEN
                     ERROR(Text001, "Project No.", "Posting Date");
             END;

    OnRename=BEGIN
               IF Posted THEN
                 ERROR(Text001, "Project No.", "Posting Date");
             END;

    CaptionML=[ENU=Preclosure Result/Provision Loss;
               NOR=Prosjektevaluering;
               SVE=Projektv„rdering/F”rlust p† avs„ttning];
    PasteIsValid=No;
    DrillDownPageID=Page11012281;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No. WHERE (Project Status=FILTER(..Technical Finished));
                                                   OnValidate=VAR
                                                                LocProjectPreclosureResult@1100528240 : Record 11012093;
                                                              BEGIN
                                                                Project.GET("Project No.");
                                                                IF Project."Preclosure Result" = Project."Preclosure Result"::No THEN
                                                                  Project.FIELDERROR("Preclosure Result");
                                                                DimMgt.CheckDepartmentAuthorization(DATABASE::"Project Preclosure Result", Project."Global Dimension 1 Code");
                                                                "Global Dimension 1 Code" := Project."Global Dimension 1 Code";

                                                                //C000501
                                                                IF "Prognosis Date" = 0D THEN
                                                                  "Prognosis Level" := Project."Prognosis Level";

                                                                IF CurrFieldNo > 0 THEN
                                                                  CALCFIELDS("Project Description");

                                                                IF CurrFieldNo > 0 THEN
                                                                  IF NOT LocProjectPreclosureResult.GET(xRec."Project No.", xRec."Posting Date", xRec."Line No.") THEN BEGIN
                                                                    LocProjectPreclosureResult.RESET;
                                                                    LocProjectPreclosureResult.SETCURRENTKEY("Project No.", "Line No.");
                                                                    LocProjectPreclosureResult.SETRANGE("Project No.", "Project No.");
                                                                    IF LocProjectPreclosureResult.FINDLAST THEN
                                                                      "Line No." := LocProjectPreclosureResult."Line No." + 10000
                                                                    ELSE
                                                                      "Line No." := 10000;  //Select new lineno.
                                                                  END;
                                                                //190604 ORANGO.EE >>
                                                                "Site Manager" := Project."Site Manager";
                                                                "Name Site Manager" := Project.SiteManagerName;
                                                                //<<
                                                              END;

                                                   OnLookup=BEGIN
                                                              CLEAR(Project);
                                                              Project.SETCURRENTKEY("Project Status");
                                                              Project.SETFILTER("Project Status", '..%1', Project."Project Status"::"Technical Finished");
                                                              Project."No." := "Project No.";
                                                              IF Project.GET("Project No.") THEN;
                                                              IF PAGE.RUNMODAL(0, Project, Project."No.") = ACTION::LookupOK THEN
                                                                VALIDATE("Project No.", Project."No.");
                                                              Project.RESET;
                                                            END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr];
                                                   NotBlank=Yes }
    { 15  ;   ;Project Description ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 20  ;   ;Posting Date        ;Date          ;OnValidate=VAR
                                                                LocProjectPreclosureResult@1210190000 : Record 11012093;
                                                              BEGIN
                                                                LocProjectPreclosureResult.SETRANGE("Project No.", "Project No.");
                                                                LocProjectPreclosureResult.SETFILTER("Line No.", '<>%1', "Line No.");
                                                                LocProjectPreclosureResult.SETFILTER("Posting Date", '>%1', "Posting Date");
                                                                IF LocProjectPreclosureResult.FINDLAST THEN
                                                                  ERROR(Text002, "Project No.", "Posting Date");  //On later date already filled, posted false or true
                                                                LocProjectPreclosureResult.SETRANGE("Posting Date", "Posting Date");
                                                                LocProjectPreclosureResult.SETRANGE(Posted, FALSE);
                                                                IF LocProjectPreclosureResult.FINDLAST THEN
                                                                  ERROR(Text003, "Project No.", "Posting Date");  //On same date already filled, posted false

                                                                LocProjectPreclosureResult.RESET;
                                                                LocProjectPreclosureResult.SETRANGE("Project No.", "Project No.");
                                                                LocProjectPreclosureResult.SETFILTER("Posting Date", '..%1', "Posting Date");
                                                                LocProjectPreclosureResult.SETFILTER("Line No.", '..%1', "Line No.");
                                                                IF LocProjectPreclosureResult.FINDLAST THEN BEGIN
                                                                  "Units Saleable" := LocProjectPreclosureResult."Units Saleable";
                                                                  "Units Sold" := LocProjectPreclosureResult."Units Sold";
                                                                  "Progress %" := LocProjectPreclosureResult."Progress %";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Posting Date;
                                                              NOR=Bokf›ringsdato;
                                                              SVE=Bokf”ringsdatum];
                                                   NotBlank=Yes }
    { 25  ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 30  ;   ;Actual Cost         ;Decimal       ;CaptionML=[ENU=Actual Cost;
                                                              NOR=Faktisk kost;
                                                              SVE=Faktisk kostnad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 40  ;   ;Contract Amount     ;Decimal       ;CaptionML=[ENU=Contract Amount;
                                                              NOR=Kontraktsbel›p;
                                                              SVE=Kontraktsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 50  ;   ;Units Saleable      ;Decimal       ;CaptionML=[ENU=Units Saleable;
                                                              NOR=Salgbare Enheter;
                                                              SVE=S„ljbara enheter];
                                                   AutoFormatType=1 }
    { 60  ;   ;Units Sold          ;Decimal       ;CaptionML=[ENU=Units Sold;
                                                              NOR=Solgte Enheter;
                                                              SVE=S†lda enheter];
                                                   AutoFormatType=1 }
    { 63  ;   ;Sales Progress      ;Decimal       ;CaptionML=[ENU=Sales Progress;
                                                              NOR=Salgsfremdrift;
                                                              SVE=F”rs„ljningsf”rlopp] }
    { 65  ;   ;Progress % Base     ;Decimal       ;CaptionML=[ENU=Cumulative Progress % Base;
                                                              NOR=Akkumulert Fremgang  %, Base;
                                                              SVE=Upparbetningsgrad %, bas];
                                                   DecimalPlaces=2:5;
                                                   Editable=No }
    { 70  ;   ;Progress %          ;Decimal       ;CaptionML=[ENU=Cumulative Progress %;
                                                              NOR=Akkumulert Fremdrift %;
                                                              SVE=Upparbetningsgrad %];
                                                   DecimalPlaces=2:5;
                                                   Editable=No }
    { 75  ;   ;Progress % Actual   ;Decimal       ;OnValidate=VAR
                                                                CalcPreclResult@1100409000 : Decimal;
                                                                PreclosureMethod@1100528200 : 'Net,Gross,GrossPL';
                                                              BEGIN
                                                                //*C001798.n
                                                                TESTFIELD(Posted, FALSE);

                                                                "Calculated Preclosure Result" := 0;
                                                                "Calculated Preclosure Revenue" := 0;
                                                                "Calculated Preclosure Cost" := 0;
                                                                "Calculated Revenue Accrual" := 0;
                                                                "Calculated Cost Accrual" := 0;
                                                                "Calculated Provision Loss" := 0;

                                                                "Corrected Preclosure Result" := 0;
                                                                "Corrected Preclosure Revenue" := 0;
                                                                "Corrected Preclosure Cost" := 0;
                                                                "Corrected Revenue Accrual" := 0;
                                                                "Corrected Cost Accrual" := 0;
                                                                "Corrected Provision Loss" := 0;

                                                                PreclosureMethod := PreclosureMethodJob("Project No.");

                                                                IF PreclosureMethod IN [PreclosureMethod::Gross, PreclosureMethod::GrossPL] THEN BEGIN
                                                                  IF "Prognosis Financial Result" >= 0 THEN BEGIN
                                                                    "Calculated Provision Loss" := 0
                                                                  END ELSE BEGIN
                                                                    FindDampingRatioPercentage;
                                                                    "Calculated Provision Loss" := ROUND("Prognosis Financial Result" * (1 - "Progress % Actual" / 100));
                                                                  END;
                                                                END;
                                                                CASE PreclosureMethod OF
                                                                  PreclosureMethod::Net:
                                                                    BEGIN
                                                                      IF "Prognosis Financial Result" <= 0 THEN
                                                                        CalcPreclResult := "Prognosis Financial Result"
                                                                      ELSE BEGIN
                                                                        FindDampingRatioPercentage;
                                                                        CalcPreclResult := ROUND("Progress % Actual" * "Prognosis Financial Result" / 100);
                                                                      END;
                                                                      CalcPreclResult -= "Closed Results";

                                                                      IF CalcPreclResult > 0 THEN BEGIN
                                                                        "Calculated Preclosure Result" := CalcPreclResult;
                                                                        "Calculated Provision Loss" := 0;
                                                                      END ELSE BEGIN
                                                                        IF "Prognosis Financial Result" <= 0 THEN BEGIN
                                                                          "Calculated Preclosure Result" := 0;
                                                                          "Calculated Provision Loss" := CalcPreclResult;
                                                                        END ELSE BEGIN
                                                                          "Calculated Preclosure Result" := CalcPreclResult;
                                                                          "Calculated Provision Loss" := 0;
                                                                        END;
                                                                      END;
                                                                      VALIDATE("Corrected Final Result", "Prognosis Financial Result");
                                                                      VALIDATE("Corrected Preclosure Result", "Calculated Preclosure Result");
                                                                    END;

                                                                  PreclosureMethod::Gross:
                                                                    BEGIN
                                                                      "Calculated Preclosure Revenue" := ROUND("Progress % Actual" * "Prognosis Total Revenues" / 100) - "Closed Revenues";
                                                                      "Calculated Preclosure Cost" := ROUND("Progress % Actual" * "Prognosis Total Cost" / 100) - "Closed Costs";
                                                                      VALIDATE("Corrected Preclosure Revenue", "Calculated Preclosure Revenue");
                                                                      VALIDATE("Corrected Preclosure Cost", "Calculated Preclosure Cost");
                                                                    END;

                                                                  PreclosureMethod::GrossPL:
                                                                    BEGIN
                                                                      "Calculated Preclosure Revenue" := ROUND("Progress % Actual" * "Prognosis Total Revenues" / 100);
                                                                      "Calculated Preclosure Cost" := ROUND("Progress % Actual" * "Prognosis Total Cost" / 100);
                                                                      "Calculated Revenue Accrual" := ROUND(("Progress % Actual" / 100 * "Prognosis Total Revenues") - "Revenue Amount");
                                                                      "Calculated Cost Accrual"    := ROUND(("Progress % Actual" / 100 * "Prognosis Total Cost") - "Actual Cost");
                                                                      VALIDATE("Corrected Revenue Accrual", "Calculated Revenue Accrual");
                                                                      VALIDATE("Corrected Cost Accrual", "Calculated Cost Accrual");
                                                                    END;
                                                                END;

                                                                VALIDATE("Corrected Provision Loss", "Calculated Provision Loss");
                                                              END;

                                                   CaptionML=[ENU=Cumulative Progress % Actual;
                                                              NOR=Akkumulert Fremgang  %, Faktisk];
                                                   DecimalPlaces=2:5;
                                                   BlankZero=Yes }
    { 80  ;   ;Expected Final Result;Decimal      ;CaptionML=[ENU=Expected Final Result;
                                                              NOR=Forventet Sluttresultat;
                                                              SVE=F”rv„ntat slutresultat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 85  ;   ;Corrected Final Result;Decimal     ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Corrected Final Result") THEN BEGIN
                                                                  TestIfCorrectMethod(0);
                                                                END;

                                                                IF "Corrected Final Result" < 0 THEN BEGIN
                                                                  "Corrected Preclosure Result" := 0;
                                                                  "Corrected Provision Loss" := "Corrected Final Result";
                                                                END ELSE BEGIN
                                                                  "Corrected Provision Loss" := 0;
                                                                  "Corrected Preclosure Result" := ROUND("Progress % Actual" * "Corrected Final Result" / 100) ;
                                                                END;

                                                                CalcTotalResultCorrected(0);
                                                              END;

                                                   CaptionML=[ENU=Corrected Final Result;
                                                              NOR=Rettet Sluttresultat;
                                                              SVE=R„ttat slutresultat];
                                                   AutoFormatType=1 }
    { 90  ;   ;Calculated Preclosure Result;Decimal;
                                                   FieldClass=Normal;
                                                   CaptionML=[ENU=Calculated Preclosure Result;
                                                              NOR=Estimert resultat (Pr›veregnskap);
                                                              SVE=Ber„knat resultat (preclosure)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 92  ;   ;Corrected Preclosure Result;Decimal;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Corrected Preclosure Result") THEN BEGIN
                                                                  TestIfCorrectMethod(0);
                                                                  TESTFIELD("Corrected Provision Loss", 0);
                                                                END;

                                                                {
                                                                IF "Corrected Preclosure Result" < 0 THEN
                                                                  "Corrected Final Result" := "Corrected Preclosure Result"
                                                                ELSE BEGIN
                                                                  IF "Progress % Actual" <> 0 THEN
                                                                    "Corrected Final Result" := 100 * "Corrected Preclosure Result" / "Progress % Actual"
                                                                  ELSE
                                                                    "Corrected Final Result" := "Corrected Preclosure Result";
                                                                END;
                                                                }

                                                                CalcTotalResultCorrected(0);
                                                              END;

                                                   CaptionML=[ENU=Corrected Preclosure Result;
                                                              NOR=R„ttat resultat (Preclosure);
                                                              SVE=R„ttat resultat (preclosure)];
                                                   AutoFormatType=1 }
    { 95  ;   ;Previous Actual Precl. Result;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Preclosure Result" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                 Posted=CONST(Yes),
                                                                                                                                 Correction Posted=CONST(No)));
                                                   CaptionML=[ENU=Previous Actual Precl. Result;
                                                              NOR=Forrige faktiskt resultat (Preclosure);
                                                              SVE=F”reg†ende faktiskt resultat (preclosure)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 100 ;   ;Actual Preclosure Result;Decimal   ;FieldClass=Normal;
                                                   CaptionML=[ENU=Actual Preclosure Result;
                                                              NOR=Reelle pr›veregnskapsresultater;
                                                              SVE=Periodiserat resultat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 105 ;   ;Posting Allowed     ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Posting Allowed;
                                                              NOR=Bokf›ring tillatt;
                                                              SVE=Bokf”ring till†ten] }
    { 110 ;   ;Posted              ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Posted;
                                                              NOR=Bokf›rt;
                                                              SVE=Bokf”rd];
                                                   Editable=No }
    { 120 ;   ;Account Sales       ;Code20        ;TableRelation="G/L Account".No.;
                                                   CaptionML=[ENU=Account Salest;
                                                              NOR=Salgskonto;
                                                              SVE=F”rs„ljningskonto];
                                                   Editable=No }
    { 130 ;   ;Balance Account Sales;Code20       ;TableRelation="G/L Account".No.;
                                                   CaptionML=[ENU=Balance Account Sales;
                                                              NOR=Balansekonto salg;
                                                              SVE=Balanskonto f”rs„ljning];
                                                   Editable=No }
    { 140 ;   ;Comment             ;Text50        ;CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar] }
    { 150 ;   ;User ID             ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Posted by;
                                                              NOR=Bokf›rt av;
                                                              SVE=Bokf”rt av];
                                                   Editable=No }
    { 160 ;   ;Process Date        ;Date          ;CaptionML=[ENU=Posted on Date;
                                                              NOR=Bokf›rt den;
                                                              SVE=Bokf”rt den];
                                                   Editable=No }
    { 170 ;   ;G/L Register No. Sales;Integer     ;CaptionML=[ENU=G/L Register No. Sales;
                                                              NOR=Hovedboksregisternr, salg;
                                                              SVE=Redovisningsregisternr, f”rs„ljning] }
    { 180 ;   ;Document No.        ;Code20        ;CaptionML=[ENU=Document No.;
                                                              NOR=Dokumentnr.;
                                                              SVE=Verifikationsnr];
                                                   Description=Used For Exchange }
    { 190 ;   ;Progress Date       ;Date          ;CaptionML=[ENU=Progress Date;
                                                              NOR=Fremdriftsdato;
                                                              SVE=F”rloppsdatum];
                                                   Editable=No }
    { 200 ;   ;Prognosis Date      ;Date          ;CaptionML=[ENU=Prognosis Date;
                                                              NOR=Prognosedato;
                                                              SVE=Prognosdatum];
                                                   Editable=No }
    { 205 ;   ;Prognosis Level     ;Option        ;CaptionML=[ENU=Prognosis Level;
                                                              NOR=Prognoseniv†;
                                                              SVE=Prognosniv†];
                                                   OptionCaptionML=[ENU=Detailed,Element,Rough;
                                                                    NOR=Detaljert,Element,Grov;
                                                                    SVE=Detaljerad,Element,Grov];
                                                   OptionString=Detailed,Element,Rough;
                                                   Editable=No }
    { 210 ;   ;Calculated Turnover ;Decimal       ;CaptionML=[ENU=Calculated Turnover;
                                                              NOR=Beregnet Omsetning;
                                                              SVE=Ber„knad oms„ttning];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 220 ;   ;Prev. Actual Preclosure Rev.;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Preclosure Revenue" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                  Posted=CONST(Yes),
                                                                                                                                  Correction Posted=CONST(No)));
                                                   CaptionML=[ENU=Prev. Actual Preclosure Rev.;
                                                              NOR=Forrige Omsetning;
                                                              SVE=F”reg†ende oms„ttning];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 230 ;   ;Actual Preclosure Revenue;Decimal  ;CaptionML=[ENU=Actual Preclosure Revenue;
                                                              NOR=Omsetning;
                                                              SVE=Oms„ttning];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Calculated Cost     ;Decimal       ;CaptionML=[ENU=Calculated Cost;
                                                              NOR=Beregnet Kostnad;
                                                              SVE=Kalkylerad kostnad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Corrected Preclosure Cost;Decimal  ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Corrected Preclosure Cost") THEN
                                                                  TestIfCorrectMethod(1);
                                                                IF "Corrected Preclosure Revenue" - "Corrected Preclosure Cost" + "Corrected Provision Loss" > 0 THEN
                                                                  "Corrected Provision Loss" := 0;
                                                                CalcTotalResultCorrected(1);
                                                              END;

                                                   CaptionML=[ENU=Corrected Preclosure Cost;
                                                              NOR=Rettet Kostnad;
                                                              SVE=R„ttad kostnad];
                                                   AutoFormatType=1 }
    { 260 ;   ;Prev. Actual Preclosure Cost;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Preclosure Cost" WHERE (Project No.=FIELD(Project No.),
                                                                                                                               Posted=CONST(Yes),
                                                                                                                               Correction Posted=CONST(No)));
                                                   CaptionML=[ENU=Prev. Actual Preclosure Cost;
                                                              NOR=Forrige kost;
                                                              SVE=F”reg†ende kostnad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Actual Preclosure Cost;Decimal     ;CaptionML=[ENU=Actual Preclosure Cost;
                                                              NOR=Kostnader;
                                                              SVE=Kostnader];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Account Cost        ;Code20        ;TableRelation="G/L Account".No.;
                                                   CaptionML=[ENU=Account Cost;
                                                              NOR=Kontokost;
                                                              SVE=Kontokostnad];
                                                   Editable=No }
    { 290 ;   ;Balance Account Cost;Code20        ;TableRelation="G/L Account".No.;
                                                   CaptionML=[ENU=Balance Account Cost;
                                                              NOR=Balansekonto Kostnad;
                                                              SVE=Balanskonto kostnader];
                                                   Editable=No }
    { 300 ;   ;G/L Register No. Cost;Integer      ;CaptionML=[ENU=G/L Register No. Cost;
                                                              NOR=Hovedboksregisternr. kostnad;
                                                              SVE=Redovisningsregisternr, kostnad] }
    { 310 ;   ;Result Type         ;Option        ;CaptionML=[ENU=Result Type;
                                                              NOR=Resultattype;
                                                              SVE=Resultattyp];
                                                   OptionCaptionML=[ENU=Preclosure Result,Provision Loss;
                                                                    NOR=Pr›veregnskapsresultat,Tap p† avsetning;
                                                                    SVE=Projektv„rdering,F”rlust p† avs„ttning];
                                                   OptionString=Preclosure Result,Provision Loss }
    { 320 ;   ;Calculated Provision;Decimal       ;CaptionML=[ENU=Calculated Provision;
                                                              NOR=Beregnet Avsetning;
                                                              SVE=Ber„knad avs„ttning];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 340 ;   ;Actual Provision    ;Decimal       ;CaptionML=[ENU=Actual Provision;
                                                              NOR=Faktisk Avsetning;
                                                              SVE=Verklig avs„ttning];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 350 ;   ;Previous Actual Provision;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Provision" WHERE (Project No.=FIELD(Project No.),
                                                                                                                         Posted=CONST(Yes)));
                                                   CaptionML=[ENU=Previous Actual Provision;
                                                              NOR=Forrige Faktiske Avsettning;
                                                              SVE=F”reg†ende faktisk avs„ttning];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 360 ;   ;Prognosis Total Cost;Decimal       ;CaptionML=[ENU=Prognosis Total Cost;
                                                              NOR=Prognose for totale kostnader;
                                                              SVE=Prognos totala kostnader];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 370 ;   ;Prognosis Total Revenues;Decimal   ;CaptionML=[ENU=Prognosis Total Revenues;
                                                              NOR=Prognose totalinntekter;
                                                              SVE=Prognos totala int„kter];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 380 ;   ;Prognosis Financial Result;Decimal ;CaptionML=[ENU=Prognosis Financial Result;
                                                              NOR=Resultatprognose, finans;
                                                              SVE=Prognos finansiellt resultat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 400 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Global dimensjon 1 kode;
                                                              SVE=Global dimension 1 kod];
                                                   Editable=No;
                                                   CaptionClass='1,1,1' }
    { 410 ;   ;Period Filter       ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Period Filter;
                                                              NOR=Periodefilter;
                                                              SVE=Periodfilter] }
    { 415 ;   ;Line Filter         ;Integer       ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Line Filter;
                                                              NOR=Radfilter] }
    { 420 ;   ;Purchase Result     ;Decimal       ;CaptionML=[ENU=Purchase Result;
                                                              NOR=Innkj›psresultat;
                                                              SVE=Ink”psresultat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 430 ;   ;Project Status      ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Project Status" WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Status;
                                                              NOR=Prosjektstatus;
                                                              SVE=Projekt- status];
                                                   OptionCaptionML=[ENU=Estimation,Preparation,Production,Technical Finished,Administrative Finished,Finished,Archive,Archived;
                                                                    NOR=Kalkulering,Forberedelse,Produksjon,Teknisk ferdig,Administrativt ferdig,Ferdig,Arkiv,Arkivert;
                                                                    SVE=Kalkyl,F”rberedelse,Produktion,Tekniskt f„rdig,Administrativt f„rdig,F„rdig,Arkiv,Arkiverad];
                                                   OptionString=Estimation,Preparation,Production,Technical Finished,Administrative Finished,Finished,Archive,Archived;
                                                   Editable=No }
    { 440 ;   ;Project Manager     ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Project Manager" WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Manager;
                                                              NOR=Prosjektleder;
                                                              SVE=Platschef];
                                                   Editable=No }
    { 450 ;   ;Name Project Manager;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Project Manager)));
                                                   CaptionML=[ENU=Name Project Manager;
                                                              NOR=Prosjektlederens navn;
                                                              SVE=Platschefens namn];
                                                   Editable=No }
    { 460 ;   ;Project Type        ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Project Type" WHERE (No.=FIELD(Project No.)));
                                                   TableRelation="Project Type".Code;
                                                   CaptionML=[ENU=Project Type;
                                                              NOR=Prosjekttype;
                                                              SVE=Projekttyp];
                                                   Editable=No }
    { 470 ;   ;Prognosis Revenue   ;Decimal       ;CaptionML=[ENU=Prognosis Revenue;
                                                              NOR=Prognostiserte inntekter;
                                                              SVE=Prognostiserade int„kter];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 570 ;   ;Revenue Amount      ;Decimal       ;CaptionML=ENU=Revenue Amount;
                                                   Editable=No }
    { 580 ;   ;Calculated Preclosure Revenue;Decimal;
                                                   CaptionML=[ENU=Calculated Preclosure Revenue;
                                                              NOR=Kalkulert prelim. inntekt;
                                                              SVE=Ber„knade provredovisningsint„kter];
                                                   Editable=No }
    { 590 ;   ;Calculated Preclosure Cost;Decimal ;CaptionML=[ENU=Calculated Preclosure Cost;
                                                              NOR=Kalkulert prelim. kostnad;
                                                              SVE=Ber„knad provredovisningskostnad];
                                                   Editable=No }
    { 610 ;   ;Calculated Revenue Accrual;Decimal ;CaptionML=ENU=Calculated Revenue Accrual;
                                                   Editable=No }
    { 620 ;   ;Corrected Revenue Accrual;Decimal  ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Corrected Revenue Accrual") THEN
                                                                  TestIfCorrectMethod(2);
                                                                IF "Revenue Amount" + "Corrected Revenue Accrual" - "Actual Cost" - "Corrected Cost Accrual" + "Corrected Provision Loss" > 0 THEN
                                                                  "Corrected Provision Loss" := 0;
                                                                CalcTotalResultCorrected(2);
                                                              END;

                                                   CaptionML=ENU=Corrected Revenue Accrual }
    { 630 ;   ;Previous Revenue Accrual;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Revenue Accrual" WHERE (Project No.=FIELD(Project No.),
                                                                                                                               Posted=CONST(Yes),
                                                                                                                               Correction Posted=CONST(No)));
                                                   CaptionML=ENU=Previous Revenue Accrual;
                                                   Editable=No }
    { 640 ;   ;Actual Revenue Accrual;Decimal     ;CaptionML=ENU=Actual Revenue Accrual;
                                                   Editable=No }
    { 660 ;   ;Calculated Cost Accrual;Decimal    ;CaptionML=ENU=Calculated Cost Accrual;
                                                   Editable=No }
    { 670 ;   ;Corrected Cost Accrual;Decimal     ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Corrected Cost Accrual") THEN
                                                                  TestIfCorrectMethod(2);
                                                                IF "Revenue Amount" + "Corrected Revenue Accrual" - "Actual Cost" - "Corrected Cost Accrual" + "Corrected Provision Loss" > 0 THEN
                                                                  "Corrected Provision Loss" := 0;
                                                                CalcTotalResultCorrected(2);
                                                              END;

                                                   CaptionML=ENU=Corrected Cost Accrual }
    { 680 ;   ;Previous Cost Accrual;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Cost Accrual" WHERE (Project No.=FIELD(Project No.),
                                                                                                                            Posted=CONST(Yes),
                                                                                                                            Correction Posted=CONST(No)));
                                                   CaptionML=ENU=Previous Cost Accrual;
                                                   Editable=No }
    { 690 ;   ;Actual Cost Accrual ;Decimal       ;CaptionML=ENU=Actual Cost Accrual;
                                                   Editable=No }
    { 700 ;   ;Correction Posted   ;Boolean       ;CaptionML=[ENU=Correction Posted;
                                                              NOR=Bokf›rt;
                                                              SVE=Bokf”rd];
                                                   Editable=No }
    { 701 ;   ;Correction Posted by;Code50        ;CaptionML=[ENU=Correction Posted by;
                                                              NOR=Bokf›rt av;
                                                              SVE=Bokf”rt av];
                                                   Editable=No }
    { 702 ;   ;Correction Posted on;Date          ;CaptionML=[ENU=Correction Posted on;
                                                              NOR=Bokf›rt den;
                                                              SVE=Bokf”rt den];
                                                   Editable=No }
    { 710 ;   ;Calculated Provision Loss;Decimal  ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Calculated Provision Loss;
                                                   Editable=No }
    { 720 ;   ;Corrected Provision Loss;Decimal   ;OnValidate=VAR
                                                                PreclosureMethod@1100529600 : 'Net,Gross,GrossPL';
                                                              BEGIN
                                                                PreclosureMethod := PreclosureMethodJob("Project No.");
                                                                IF CurrFieldNo = FIELDNO("Corrected Provision Loss") THEN BEGIN
                                                                  IF "Corrected Provision Loss" > 0 THEN
                                                                    ERROR(Text005, FIELDCAPTION("Corrected Provision Loss"));
                                                                  IF PreclosureMethod = PreclosureMethod::Net THEN
                                                                    TESTFIELD("Corrected Preclosure Result", 0);
                                                                  IF "Total Result Corrected" > 0 THEN
                                                                    ERROR(Text005, FIELDCAPTION("Total Result Corrected"));
                                                                END ELSE
                                                                  IF "Corrected Provision Loss" > 0 THEN
                                                                    "Corrected Provision Loss" := 0;

                                                                CalcTotalResultCorrected(PreclosureMethod);

                                                                IF CurrFieldNo = FIELDNO("Corrected Provision Loss") THEN BEGIN
                                                                  IF "Total Result Corrected" > 0 THEN
                                                                    ERROR(Text005, FIELDCAPTION("Total Result Corrected"));
                                                                END ELSE
                                                                  IF "Total Result Corrected" > 0 THEN BEGIN
                                                                    "Corrected Provision Loss" := 0;
                                                                    CalcTotalResultCorrected(PreclosureMethod);
                                                                  END;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Corrected Provision Loss }
    { 730 ;   ;Actual Provision Loss;Decimal      ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Actual Provision Loss;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 740 ;   ;Previous Actual Provision Loss;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Project Preclosure Result"."Actual Provision Loss" WHERE (Project No.=FIELD(Project No.),
                                                                                                                              Posted=CONST(Yes),
                                                                                                                              Correction Posted=CONST(No)));
                                                   CaptionML=ENU=Previous Actual Provision Loss;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 750 ;   ;Corrected Preclosure Revenue;Decimal;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Corrected Preclosure Revenue") THEN
                                                                  TestIfCorrectMethod(1);
                                                                IF "Corrected Preclosure Revenue" - "Corrected Preclosure Cost" + "Corrected Provision Loss" > 0 THEN
                                                                  "Corrected Provision Loss" := 0;
                                                                CalcTotalResultCorrected(1);
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Corrected Preclosure Revenue;
                                                              SVE=Korrigerad provredovisningsint„kter];
                                                   AutoFormatType=1 }
    { 760 ;   ;Account Provision Loss;Code20      ;TableRelation="G/L Account".No.;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Account Provision Loss;
                                                   Editable=No }
    { 770 ;   ;Balance Account Provision Loss;Code20;
                                                   TableRelation="G/L Account".No.;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Balance Account Provision Loss;
                                                   Editable=No }
    { 780 ;   ;G/L Reg. No. Provision Loss;Integer;TableRelation="G/L Register";
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=G/L Reg. No. Provision Loss;
                                                   Editable=No }
    { 790 ;   ;Total Result Corrected;Decimal     ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Total Result Corrected;
                                                   Editable=No }
    { 800 ;   ;Received/Not Invoiced;Decimal      ;CaptionML=[ENU=Received/Not Invoiced;
                                                              SVE=Mottaget/inte fakturerat];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 810 ;   ;Closed Costs        ;Decimal       ;CaptionML=[ENU=Closed Costs;
                                                              SVE=Upparbetade kostnader];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 820 ;   ;Closed Revenues     ;Decimal       ;CaptionML=[ENU=Closed Revenues;
                                                              SVE=Upparbetade int„kter];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 830 ;   ;Closed Results      ;Decimal       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Closed Results;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 840 ;   ;Project Damping Ratio Code;Code10  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Damping Ratio Code" WHERE (No.=FIELD(Project No.)));
                                                   TableRelation="Damping Ratio Project"."Damping Ratio Code";
                                                   CaptionML=ENU=Project Damping Ratio Code }
    { 11128000;;Invoiced Amount    ;Decimal       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Invoiced Amount;
                                                              SVE=Fakturerat belopp] }
    { 11128001;;Site Manager       ;Code20        ;TableRelation=Employee;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Site Manager;
                                                              NOR=Prosjektleder;
                                                              SVE=Arbetschef] }
    { 11128002;;Name Site Manager  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Site Manager)));
                                                   CaptionML=[ENU=Name Site Manager;
                                                              NOR=Prosjektlederens navn;
                                                              SVE=Arbetschefs namn];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Project No.,Posting Date,Line No.       ;Clustered=Yes }
    {    ;Project No.,Posted                      ;SumIndexFields=Actual Preclosure Result,Actual Provision,Actual Preclosure Revenue,Actual Preclosure Cost }
    {    ;Project No.,Line No.                     }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      JobsSetup@1100525000 : Record 315;
      Project@11012006 : Record 11072003;
      Text001@1210190002 : TextConst 'ENU=Already posted Project %1 Posting Date %2;NOR=Allerede bokf›rt prosjekt %1, Bokf›ringsdato %2;SVE="Redan bokf”rt projekt %1, bokf”ringsdatum %2 "';
      DimMgt@1100525004 : Codeunit 408;
      DPA_Management@1100000999 : Codeunit 11012783;
      Text002@1100528240 : TextConst 'ENU=Already Project %1 at Posting Date later than %2;NOR=Allerede prosjekt %1 p† Bokf›ringsdato senere enn %2';
      Text003@1100528241 : TextConst 'ENU="Already Project %1 at Posting Date %2 ";NOR=Allerede prosjekt %1 p† Bokf›ringsdato %2';
      Text004@1100529600 : TextConst 'ENU=Posted service interim result (old) must first be reversed. See installation instruction release/hotfix.';
      Text005@1100529602 : TextConst 'ENU=%1 must be negative.;SVE=%1 m†ste vara negativt.';
      HasGotJobsSetup@1100529604 : Boolean;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012093) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012093');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Project Preclosure Result", "Global Dimension 1 Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Global Dimension 1 Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Global Dimension 1 Code");
    END;

    LOCAL PROCEDURE TestIfCorrectMethod@1100528602(IMethodPreclosureResults@1100528602 : 'Net,Gross,GrossPL');
    VAR
      Job@1100528600 : Record 11072003;
      ProjectType@1100528601 : Record 11012009;
    BEGIN
      IF NOT Job.GET("Project No.") THEN
        EXIT;
      IF NOT ProjectType.GET(Job."Project Type") THEN
        EXIT;
      ProjectType.TESTFIELD("Method Preclosure Results", IMethodPreclosureResults);
    END;

    LOCAL PROCEDURE GetProjectType@1100528609(IJobNo@1100528600 : Code[20];VAR OProjectType@1100528601 : Record 11012009);
    VAR
      Job@1100528602 : Record 11072003;
    BEGIN
      Job.GET(IJobNo);
      Job.TESTFIELD("Project Type");
      OProjectType.GET(Job."Project Type");
    END;

    PROCEDURE PreclosureMethodJob@1100528605(IJobNo@1100528600 : Code[20]) : Integer;
    VAR
      ProjectType@1100528601 : Record 11012009;
    BEGIN
      GetProjectType(IJobNo, ProjectType);
      EXIT(ProjectType."Method Preclosure Results");
    END;

    PROCEDURE CheckOldPreclosureResultReversed@1100529600();
    VAR
      JobsSetup@1100529600 : Record 315;
    BEGIN
      JobsSetup.GET;
      IF JobsSetup."Old Preclosure Result Present" THEN
        ERROR(Text004);
    END;

    LOCAL PROCEDURE CalcTotalResultCorrected@1100529683(PreclosureMethod@1100529670 : 'Net,Gross,GrossPL');
    BEGIN
      CASE PreclosureMethod OF
        PreclosureMethod::Net:
          "Total Result Corrected" := "Corrected Preclosure Result" + "Corrected Provision Loss";
        PreclosureMethod::Gross:
          "Total Result Corrected" := "Corrected Preclosure Revenue" - "Corrected Preclosure Cost" + "Corrected Provision Loss";
        PreclosureMethod::GrossPL:
          "Total Result Corrected" := "Revenue Amount" + "Corrected Revenue Accrual" - "Actual Cost" - "Corrected Cost Accrual" + "Corrected Provision Loss";
      END;
    END;

    LOCAL PROCEDURE FindDampingRatioPercentage@1100529601();
    VAR
      DampingRatioProject@1100529600 : Record 11072019;
    BEGIN
      CALCFIELDS("Project Damping Ratio Code");
      IF "Project Damping Ratio Code" <> '' THEN
        DampingRatioProject.SETRANGE("Damping Ratio Code", "Project Damping Ratio Code")
      ELSE BEGIN
        GetJobsSetup;
        IF JobsSetup."Damping Ratio Code" = '' THEN
          EXIT;
        DampingRatioProject.SETRANGE("Damping Ratio Code", JobsSetup."Damping Ratio Code");
      END;
      DampingRatioProject.SETFILTER("Until Production", '>=%1', ROUND("Progress % Actual", 1, '>'));
      IF DampingRatioProject.ISEMPTY THEN
        EXIT;
      DampingRatioProject.FINDFIRST;
      IF DampingRatioProject.Formula <> '' THEN
        "Progress % Actual" := DampingRatioProject.EvaluateFormula(DampingRatioProject.Formula, "Progress % Actual" / 100)
      ELSE
        "Progress % Actual" := "Progress % Actual" * DampingRatioProject.Ratio;
    END;

    LOCAL PROCEDURE GetJobsSetup@1100529606();
    BEGIN
      IF HasGotJobsSetup THEN
        EXIT;
      JobsSetup.GET;
      HasGotJobsSetup := TRUE;
    END;

    PROCEDURE GetPrevProjectPreclosureResult@1100529603(VAR PrevProjectPreclosureResult@1100529600 : Record 11012093);
    BEGIN
      PrevProjectPreclosureResult.RESET;
      PrevProjectPreclosureResult.SETRANGE("Project No.", "Project No.");
      PrevProjectPreclosureResult.SETFILTER("Posting Date", '<%1', "Posting Date");
      PrevProjectPreclosureResult.SETRANGE(Posted, TRUE);
      IF PrevProjectPreclosureResult.ISEMPTY THEN BEGIN
        CLEAR(PrevProjectPreclosureResult);
        EXIT;
      END;
      PrevProjectPreclosureResult.FINDLAST;
    END;

    [External]
    PROCEDURE CheckPreclResultPresent011@1100285100(ShowErrorMessage@1100285100 : Boolean) : Boolean;
    VAR
      ProjectPreclResultRec@1100285101 : Record 11012093;
    BEGIN
      //4PSSE from old version
      ProjectPreclResultRec.RESET;
      ProjectPreclResultRec.SETRANGE("Project No.", "Project No.");
      ProjectPreclResultRec.SETRANGE("Result Type", ProjectPreclResultRec."Result Type"::"Preclosure Result");
      ProjectPreclResultRec.SETFILTER("Posting Date", '<>%1', xRec."Posting Date");
      IF NOT ProjectPreclResultRec.ISEMPTY THEN
        IF ShowErrorMessage THEN
          ERROR(Text002,"Project No.")
        ELSE
          EXIT(TRUE);

      EXIT(FALSE);
    END;

    BEGIN
    END.
  }
}

