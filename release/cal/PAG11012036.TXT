OBJECT Page 11012036 Hour Accounting Subform
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Lines;
               NOR=Rader;
               SVE=Rader];
    SourceTable=Table11012039;
    DelayedInsert=Yes;
    PageType=ListPart;
    AutoSplitKey=Yes;
    RefreshOnActivate=Yes;
    OnInit=BEGIN
             ServiceEnabled := TRUE;

             ProjectNoEditable := TRUE;
             ExtensionContractEditable := TRUE;
             RentalUnitEditable := TRUE;
             PlantFieldsEditable := TRUE;
             PlantRateCodeEditable := TRUE;
             ElementEditable := TRUE;
             CostComponentEditable := TRUE;
             WageComponentEditable := TRUE;
             AmountEditable := TRUE;
             PostingDateEditable := TRUE;
             CostCodeEditable := TRUE;
             ServiceDataEditable := TRUE;
             ResourceRequestEditable := TRUE;
             PostingEnabled := TRUE;
           END;

    OnOpenPage=BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**FILTER NOT SET, ONLY FILTERTYPE FOR INPUT OF DEPARTMENT CODE
                 //**4PS Generated Code.en01
                 ServiceEnabled := FPSLicenseManagement.LicenseAndReadPermissionForTable(ServiceSetup);

                 IF JobsSetup.GET THEN;
                 IF ServiceSetup.GET THEN;

                 //C019758.sn
                 IF UserSetup.GET(USERID) THEN BEGIN
                   CopyButtonVisible := NOT UserSetup."Access own Hours only";
                   IF UserSetup."Access own Hours only" THEN
                     PostingEnabled := UserSetup."Posting Hours allowed";
                 END;
                 //C019758.en
               END;

    OnAfterGetRecord=BEGIN
                       SetControlAppearance;
                       OnAfterGetCurrRecord;
                     END;

    OnNewRecord=VAR
                  EmplRec@1100294002 : Record 5200;
                  HourAccLine@1100294001 : Record 11012039;
                BEGIN
                  // SESB.I029 ASH 03.07.2013 >>
                  IF NOT HourAccLine.GET(xRec.Year,xRec.Week,xRec."Employee No.",xRec."Line No.") THEN BEGIN
                    IF ("Employee No." <> '') AND EmplRec.GET("Employee No.") THEN
                      Type := EmplRec."Default Line Type";
                  END ELSE
                  // SESB.I029 ASH 03.07.2013 <<
                    Type := xRec.Type;
                  IF (Type = Type::Plant) AND (xRec."Plant Rate Code" <> '') THEN
                    "Plant Rate Code" := xRec."Plant Rate Code";
                  "Connection No." := 0;

                  //RFC150
                  IF (Type = Type::Project) AND ("Team Code"='') THEN
                    IF EmplRec.GET("Employee No.") THEN
                      IF (EmplRec."User Default Team Code" <> '') THEN
                        "Team Code" := EmplRec."User Default Team Code";

                  //180823, #14887
                  IF "Line No." = 0 THEN "Line No." := GetLastLineNo + 10000;

                  OnAfterGetCurrRecord;
                END;

    OnInsertRecord=BEGIN
                     "Connection No." := 0;
                   END;

    OnModifyRecord=BEGIN
                     IF NOT LineIsEditable THEN BEGIN
                       CurrPage.UPDATE(FALSE);
                       EXIT(FALSE);
                     END;
                   END;

    OnDeleteRecord=BEGIN
                     IF NOT LineIsEditable THEN BEGIN
                       CurrPage.UPDATE(FALSE);
                       EXIT(FALSE);
                     END;
                   END;

    ActionList=ACTIONS
    {
      { 1100528700;  ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1100528702;1 ;Action    ;
                      CaptionML=[ENU=Copy Line to All Employees;
                                 SVE=Kopiera rad];
                      Visible=CopyButtonVisible;
                      Image=Copy;
                      OnAction=VAR
                                 CopyHourAccountingLine@1100528700 : Report 11020253;
                               BEGIN
                                 CopyHourAccountingLine.SetHourAccountingLine(Rec);
                                 CopyHourAccountingLine.RUNMODAL;
                               END;
                                }
      { 1100528204;1 ;ActionGroup;
                      CaptionML=[ENU=&Line;
                                 NOR=&Linje;
                                 SVE=Ra&d];
                      Image=Line }
      { 1100528203;2 ;Action    ;
                      Name=Comment;
                      CaptionML=[ENU=Approval Comments;
                                 NOR=Godkjenningsmerknader;
                                 SVE=GodkÑnnandekommentarer];
                      Promoted=Yes;
                      Visible=FALSE;
                      Image=ViewComments;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalComments@1100528400 : Page 660;
                                 HourAccounting@1100528200 : Record 11012038;
                                 ApprovalsMgmt@1100525000 : Codeunit 1535;
                                 ApprovalEntry@1100525001 : Record 454;
                               BEGIN
                                 HourAccounting.GET(Year,Week,"Employee No.");

                                 IF NOT ApprovalsMgmt.LineFindOpenApprovalEntryForCurrUser(ApprovalEntry,HourAccounting.RECORDID,"Line No.") THEN BEGIN
                                   ApprovalEntry.RESET;
                                   ApprovalEntry.SETRANGE("Table ID", 11012038);
                                   ApprovalEntry.SETRANGE("Record ID to Approve", HourAccounting.RECORDID);
                                   ApprovalEntry.SETRANGE("Document Line No.","Line No.");
                                   IF NOT ApprovalEntry.FINDFIRST THEN
                                     EXIT;
                                   ApprovalComments.EDITABLE(FALSE);
                                 END;

                                 ApprovalComments.SetfilterRecordIDAndLineNo(HourAccounting.RECORDID, 11012038, ApprovalEntry."Document Type"::"Hour Accounting", '',"Line No.");
                                 ApprovalComments.SetUpLine(ApprovalEntry);
                                 ApprovalComments.SetWorkflowStepInstanceID(ApprovalEntry."Workflow Step Instance ID");
                                 ApprovalComments.RUNMODAL;
                               END;
                                }
      { 1100528202;2 ;Action    ;
                      CaptionML=[ENU=Approval Entries;
                                 NOR=Godkjenningstransaksjoner;
                                 SVE=GodkÑnnandetransaktioner];
                      Visible=FALSE;
                      Image=Confirm;
                      RunPageMode=View;
                      OnAction=VAR
                                 ApprovalEntry@1100525000 : Record 454;
                                 ApprovalEntries@1100525001 : Page 658;
                                 HourAccounting@1100525002 : Record 11012038;
                               BEGIN
                                 HourAccounting.GET(Year,Week,"Employee No.");
                                 ApprovalEntry.FILTERGROUP(2);
                                 ApprovalEntry.SETRANGE("Table ID", 11012038);
                                 ApprovalEntry.SETRANGE("Record ID to Approve", HourAccounting.RECORDID);
                                 ApprovalEntry.SETRANGE("Document Line No.","Line No.");
                                 ApprovalEntries.SETTABLEVIEW(ApprovalEntry);
                                 ApprovalEntry.FILTERGROUP(0);
                                 ApprovalEntries.RUNMODAL;
                               END;
                                }
      { 1100528405;1 ;ActionGroup;
                      CaptionML=[ENU=Approval;
                                 NOR=Godkjenning;
                                 SVE=GodkÑnnande] }
      { 1100528404;2 ;Action    ;
                      Name=Approve;
                      CaptionML=[ENU=Approve;
                                 NOR=Godkjenn;
                                 SVE=GodkÑnn];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Approve;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                                 ApprovalEntry@1100528400 : Record 454;
                                 HourAccountingLine@1100525000 : Record 11012039;
                               BEGIN
                                 HourAccounting.GET(Year,Week,"Employee No.");
                                 CurrPage.SETSELECTIONFILTER(HourAccountingLine);
                                 IF HourAccountingLine.FINDSET THEN BEGIN
                                   REPEAT
                                     IF ApprovalsMgmt.LineFindOpenApprovalEntryForCurrUser(ApprovalEntry,HourAccounting.RECORDID,HourAccountingLine."Line No.") THEN
                                       ApprovalsMgmt.LineApproveRecordApprovalRequest(HourAccounting.RECORDID,HourAccountingLine."Line No.");
                                   UNTIL HourAccountingLine.NEXT=0;
                                 END;
                               END;
                                }
      { 1100528403;2 ;Action    ;
                      Name=Reject;
                      CaptionML=[ENU=Reject;
                                 NOR=Avvis;
                                 SVE=Avvisa];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      PromotedIsBig=Yes;
                      Image=Reject;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                                 ApprovalEntry@1100528400 : Record 454;
                                 HourAccountingLine@1100525000 : Record 11012039;
                               BEGIN
                                 HourAccounting.GET(Year,Week,"Employee No.");
                                 CurrPage.SETSELECTIONFILTER(HourAccountingLine);
                                 IF HourAccountingLine.FINDSET THEN BEGIN
                                   REPEAT
                                     IF ApprovalsMgmt.LineFindOpenApprovalEntryForCurrUser(ApprovalEntry,HourAccounting.RECORDID,HourAccountingLine."Line No.") THEN
                                       ApprovalsMgmt.LineRejectRecordApprovalRequest(HourAccounting.RECORDID,HourAccountingLine."Line No.");
                                   UNTIL HourAccountingLine.NEXT=0;
                                 END;
                               END;
                                }
      { 1100528402;2 ;Action    ;
                      Name=Delegate;
                      CaptionML=[ENU=Delegate;
                                 NOR=Deleger;
                                 SVE=Delegera];
                      Promoted=Yes;
                      Visible=OpenApprovalEntriesExistForCurrUser;
                      Image=Delegate;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 ApprovalsMgmt@1000 : Codeunit 1535;
                                 ApprovalEntry@1100528400 : Record 454;
                                 HourAccountingLine@1100525000 : Record 11012039;
                               BEGIN
                                 HourAccounting.GET(Year,Week,"Employee No.");
                                 CurrPage.SETSELECTIONFILTER(HourAccountingLine);
                                 IF HourAccountingLine.FINDSET THEN BEGIN
                                   REPEAT
                                     IF ApprovalsMgmt.LineFindOpenApprovalEntryForCurrUser(ApprovalEntry,HourAccounting.RECORDID,HourAccountingLine."Line No.") THEN
                                       ApprovalsMgmt.LineDelegateRecordApprovalRequest(HourAccounting.RECORDID,HourAccountingLine."Line No.");
                                   UNTIL HourAccountingLine.NEXT=0;
                                 END;
                               END;
                                }
      { 1100525009;1 ;ActionGroup;
                      CaptionML=[ENU=F&unctions;
                                 NOR=Fu&nksjon;
                                 SVE=Fu&nktion];
                      Image=Action }
      { 1100525006;2 ;Action    ;
                      Name=Release;
                      CaptionML=[ENU=Re&lease;
                                 NOR=&Frigi;
                                 SVE=&SlÑpp];
                      Visible=FALSE;
                      Image=ReleaseDoc;
                      OnAction=VAR
                                 HourAccountingLine@1100525000 : Record 11012039;
                               BEGIN
                                 HourAccountingLine.COPY(Rec);
                                 CurrPage.SETSELECTIONFILTER(HourAccountingLine);
                                 HourAccountingLine.Release;
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100525007;2 ;Action    ;
                      Name=Reopen;
                      CaptionML=[ENU=Re&open;
                                 NOR=&èpne pÜ nytt;
                                 SVE=ôppna &igen];
                      Visible=FALSE;
                      Image=ReOpen;
                      OnAction=VAR
                                 HourAccountingLine@1100525000 : Record 11012039;
                               BEGIN
                                 HourAccountingLine.COPY(Rec);
                                 CurrPage.SETSELECTIONFILTER(HourAccountingLine);
                                 HourAccountingLine.Reopen;
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100294002;1 ;Action    ;
                      Name=<Action1100294003>;
                      CaptionML=[ENU=Line Co&mments;
                                 NOR=Linjeko&mmentarer;
                                 SVE=Radkommentarer];
                      Image=ViewComments;
                      OnAction=BEGIN
                                 ShowLineComments;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                GroupType=Repeater }

    { 1100485902;2;Field  ;
                SourceExpr="Hour Set";
                Visible=FALSE }

    { 1100528200;2;Field  ;
                SourceExpr=Status }

    { 1210190014;2;Field  ;
                SourceExpr=Type;
                OnValidate=BEGIN
                             SetFieldsEditable;
                           END;
                            }

    { 2   ;2   ;Field     ;
                SourceExpr="Receiving Company";
                Visible=FALSE;
                OnValidate=BEGIN
                             SetFieldsEditable;
                           END;
                            }

    { 1210190012;2;Field  ;
                SourceExpr="Cost Code";
                Editable=CostCodeEditable;
                OnValidate=BEGIN
                             SetFieldsEditable; //C011429

                             //>>ENH032
                             CostCodeOnValidate;
                             //>>ENH032

                             CurrPage.SAVERECORD;
                           END;

                OnLookup=BEGIN
                           // SESB.I028 VKO 03.07.2013 >>
                           LookupCostCodes;
                           SetFieldsEditable;

                           // SESB.I028 VKO 03.07.2013 <<
                           //>>ENH032
                           IF "Cost Code" <> '' THEN
                             CostCodeOnValidate;
                           //<<ENH032

                           CurrPage.SAVERECORD;
                         END;
                          }

    { 1100527550;2;Field  ;
                CaptionML=ENU=Cost Code Description;
                SourceExpr=GetCostCodeDescription;
                Visible=FALSE;
                Editable=FALSE }

    { 1210190000;2;Field  ;
                SourceExpr="Service Order No.";
                Enabled=ServiceEnabled;
                Editable=ServiceDataEditable }

    { 1100485012;2;Field  ;
                DrillDown=No;
                CaptionML=ENU=Service Order Description;
                SourceExpr=GetServiceOrderDescription;
                Visible=FALSE;
                Editable=FALSE }

    { 1210190002;2;Field  ;
                SourceExpr="Service Location No.";
                Enabled=ServiceEnabled;
                Editable=ServiceDataEditable }

    { 1100525002;2;Field  ;
                DrillDown=No;
                SourceExpr="Service Location Description";
                Visible=FALSE }

    { 1100485010;2;Field  ;
                SourceExpr="Additional Cost (Service)";
                Visible=FALSE }

    { 4   ;2   ;Field     ;
                SourceExpr="Project No.";
                Editable=ProjectNoEditable;
                OnValidate=BEGIN
                             SetFieldsEditable;
                           END;

                OnLookup=BEGIN
                           LookupProjectNo;
                           SetFieldsEditable;
                             CurrPage.UPDATE;
                         END;
                          }

    { 11012000;2;Field    ;
                DrillDown=No;
                CaptionML=ENU=Project Description;
                SourceExpr=GetProjectDescription;
                Visible=FALSE;
                Editable=FALSE }

    { 1100285000;2;Field  ;
                SourceExpr="Project Principal Name" }

    { 1100530000;2;Field  ;
                DrillDown=No;
                CaptionML=ENU=Project City;
                SourceExpr=GetProjectCity;
                Visible=FALSE;
                Editable=FALSE }

    { 1100528001;2;Field  ;
                SourceExpr="Hour Line Template Code";
                Visible=FALSE;
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr="Extension Contract";
                Visible=FALSE;
                Editable=ExtensionContractEditable }

    { 1100528500;2;Field  ;
                CaptionML=ENU=Extension Contract Description;
                SourceExpr=GetExtensionContractDescription();
                Visible=FALSE }

    { 1100485002;2;Field  ;
                SourceExpr="Rental Unit";
                Visible=FALSE;
                Editable=RentalUnitEditable }

    { 1210190010;2;Field  ;
                SourceExpr="Estimate No.";
                Visible=FALSE }

    { 1100527001;2;Field  ;
                CaptionML=[ENU=Estimate Description;
                           NOR=Kalkylebeskrivelse;
                           SVE=Kalkylbeskrivning];
                SourceExpr=GetEstimateDescription;
                Visible=FALSE;
                Editable=FALSE }

    { 1210190008;2;Field  ;
                SourceExpr="Try-out No.";
                Visible=FALSE }

    { 1100529200;2;Field  ;
                CaptionML=ENU=Try-Out Description;
                SourceExpr=GetTryOutDescription;
                Visible=FALSE;
                Editable=FALSE }

    { 1100485904;2;Field  ;
                SourceExpr="Plant Location";
                Visible=FALSE;
                Editable=PlantFieldsEditable }

    { 1100485906;2;Field  ;
                SourceExpr="Plant Type";
                Visible=FALSE;
                Editable=PlantFieldsEditable }

    { 1100485908;2;Field  ;
                SourceExpr="Plant No.";
                Visible=FALSE;
                Editable=PlantFieldsEditable }

    { 1100528501;2;Field  ;
                Name=PlantNoDescription;
                CaptionML=ENU=Plant Description;
                SourceExpr=GetPlantDescription;
                Visible=False }

    { 1100485914;2;Field  ;
                SourceExpr="Job Notice No.";
                Visible=FALSE }

    { 1100485912;2;Field  ;
                SourceExpr="Plant Rate Code";
                Visible=FALSE;
                Editable=PlantRateCodeEditable }

    { 1100485910;2;Field  ;
                SourceExpr="Cost Component Plant";
                Visible=FALSE;
                Editable=PlantFieldsEditable }

    { 1100529600;2;Field  ;
                SourceExpr="Resource Req. Receiv. Company";
                Visible=FALSE;
                Editable=ResourceRequestEditable }

    { 1100529000;2;Field  ;
                SourceExpr="Resource Request No.";
                Visible=FALSE;
                Editable=ResourceRequestEditable }

    { 1100529001;2;Field  ;
                DrillDown=No;
                CaptionML=[ENU=Request Description;
                           SVE=FîrfrÜgan beskrivning];
                SourceExpr=ResourceRequestDescription();
                Visible=FALSE }

    { 6   ;2   ;Field     ;
                SourceExpr=Element;
                Editable=ElementEditable }

    { 1100525000;2;Field  ;
                DrillDown=No;
                CaptionML=ENU=Element Description;
                SourceExpr=GetElementDescription;
                Visible=FALSE;
                Editable=FALSE }

    { 1100409000;2;Field  ;
                SourceExpr="Department Code";
                OnValidate=BEGIN
                             //**4PS Generated Code. Do Not Change.sn03
                             DPA_ChkDepartmentCodeAllowed(DPA_IsHardFilter);
                             //**4PS Generated Code.en03
                           END;
                            }

    { 10  ;2   ;Field     ;
                SourceExpr="Cost Object";
                LookupPageID=Cost Object List;
                OnValidate=BEGIN
                             SetFieldsEditable;
                           END;

                OnLookup=BEGIN
                           LookupCostObject;
                           SetFieldsEditable;
                         END;
                          }

    { 1100485014;2;Field  ;
                SourceExpr="Cost Component";
                Editable=CostComponentEditable }

    { 1100485000;2;Field  ;
                DrillDown=No;
                CaptionML=ENU=Cost Object Description;
                SourceExpr=GetCostObjectDescription;
                CaptionClass='1,11012000,2, , ' + Text001;
                Visible=FALSE;
                Editable=FALSE }

    { 12  ;2   ;Field     ;
                SourceExpr="Wage Component";
                Editable=WageComponentEditable;
                OnValidate=VAR
                             "***ITERO***"@1100285002 : Integer;
                             Employee@1100285000 : Record 5200;
                             LabourRuleWageComponent@1100285001 : Record 11128232;
                           BEGIN
                             //>>141104 4PS035
                             WageComponentOnValidate;
                             //<<141104 4PS035
                             SetFieldsEditable;

                             //>> 4PS-011 ITERO.SB 131007 Check if wage comp. is connected to the labour rule of the employee
                             //>>ITERO.DJ IME068 131114
                             Employee.GET("Employee No.");
                             IF Employee."Labour Rule" <> '' THEN BEGIN
                               LabourRuleWageComponent.SETRANGE("Labour Rule Code",Employee."Labour Rule");
                               LabourRuleWageComponent.SETRANGE("Wage Component Code", "Wage Component");
                               IF NOT LabourRuleWageComponent.FINDSET THEN
                                 ERROR(Text002);

                             END;
                             //<<ITERO.DJ 131114
                             //<< 4PS-011
                           END;

                OnLookup=BEGIN
                           // SESB.I028 VKO 03.07.2013 >>
                           LookupWageComponent;
                           SetFieldsEditable;
                           // SESB.I028 VKO 03.07.2013 <<
                         END;
                          }

    { 1100285100;2;Field  ;
                SourceExpr="Component Type";
                Visible=FALSE }

    { 1210190020;2;Field  ;
                DrillDown=No;
                SourceExpr=Description;
                Visible=FALSE }

    { 1210190026;2;Field  ;
                SourceExpr=Chargeable;
                Visible=FALSE }

    { 1100525005;2;Field  ;
                SourceExpr="Start Kilometer";
                Visible=FALSE;
                Editable=KMEditable;
                OnValidate=BEGIN
                             IF "Start Kilometer" < "End Kilometer" THEN
                               VALIDATE(Quantity, "End Kilometer" - "Start Kilometer")
                             ELSE
                               VALIDATE(Quantity, 0);
                           END;
                            }

    { 1100525004;2;Field  ;
                SourceExpr="End Kilometer";
                Visible=FALSE;
                Editable=KMEditable;
                OnValidate=BEGIN
                             IF "Start Kilometer" < "End Kilometer" THEN
                               VALIDATE(Quantity, "End Kilometer" - "Start Kilometer")
                             ELSE
                               VALIDATE(Quantity, 0);
                           END;
                            }

    { 1210190018;2;Field  ;
                SourceExpr=Quantity;
                Editable=QuantityEditable }

    { 1100285103;2;Field  ;
                SourceExpr="Unit Cost (LCY)";
                Visible=FALSE;
                HideValue="Amount (LCY)HideValue" }

    { 1100285101;2;Field  ;
                SourceExpr="Unit Cost";
                Visible=FALSE;
                HideValue="Amount (LCY)HideValue" }

    { 1210190022;2;Field  ;
                SourceExpr="Amount (LCY)";
                Editable=AmountEditable;
                HideValue="Amount (LCY)HideValue" }

    { 1100285102;2;Field  ;
                SourceExpr=Amount;
                Visible=FALSE;
                Editable=AmountEditable;
                HideValue="Amount (LCY)HideValue" }

    { 1100485006;2;Field  ;
                SourceExpr="Posting Date";
                Visible=FALSE;
                Editable=PostingDateEditable }

    { 1100525001;2;Field  ;
                SourceExpr="Start Time";
                Visible=FALSE }

    { 1100525003;2;Field  ;
                SourceExpr="End Time";
                Visible=FALSE }

    { 14  ;2   ;Field     ;
                SourceExpr=Monday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 16  ;2   ;Field     ;
                SourceExpr=Tuesday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 18  ;2   ;Field     ;
                SourceExpr=Wednesday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 20  ;2   ;Field     ;
                SourceExpr=Thursday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 22  ;2   ;Field     ;
                SourceExpr=Friday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 24  ;2   ;Field     ;
                SourceExpr=Saturday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 26  ;2   ;Field     ;
                SourceExpr=Sunday;
                Editable=HoursEditable;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD; //T003308
                           END;
                            }

    { 28  ;2   ;Field     ;
                SourceExpr="Total Line";
                Visible=FALSE }

    { 1210190024;2;Field  ;
                SourceExpr="Cost Plus Entry Created";
                Visible=FALSE;
                Editable=FALSE }

    { 1100485008;2;Field  ;
                SourceExpr=Correction;
                Visible=FALSE }

    { 32  ;2   ;Field     ;
                SourceExpr=Comment;
                Visible=FALSE }

    { 1100485016;2;Field  ;
                SourceExpr="Department Code Employee";
                Visible=FALSE }

    { 1100485023;2;Field  ;
                SourceExpr="Cost Price Found at";
                Visible=FALSE }

    { 1100485018;2;Field  ;
                SourceExpr="Reason Code";
                Visible=FALSE }

    { 1100528000;2;Field  ;
                CaptionML=[ENU=Address;
                           NOR=Adresse;
                           SVE=Adress];
                SourceExpr=GetServiceOrProjectAddress;
                Visible=FALSE;
                Editable=FALSE }

    { 1100528400;2;Field  ;
                CaptionML=[ENU=Approval by;
                           SVE=GodkÑnnande av];
                SourceExpr=ApprovalManagement4PSConstr.GetNextApproverNameHourLine(Rec);
                Visible=FALSE }

    { 1100528401;2;Field  ;
                CaptionML=[ENU=Approved by;
                           NOR=Godkjent av;
                           SVE=GodkÑnt av];
                SourceExpr=ApprovalManagement4PSConstr.GetLastApproverNameHourLine(Rec);
                Visible=FALSE }

    { 1100528300;2;Field  ;
                SourceExpr="Address From";
                Visible=false }

    { 1100528301;2;Field  ;
                SourceExpr="Address To";
                Visible=false }

    { 1100528302;2;Field  ;
                SourceExpr="Post Code From";
                Visible=false }

    { 1100528303;2;Field  ;
                SourceExpr="Post Code To";
                Visible=false }

    { 1100528304;2;Field  ;
                SourceExpr="City From";
                Visible=false }

    { 1100528305;2;Field  ;
                SourceExpr="City To";
                Visible=false }

    { 1100528306;2;Field  ;
                SourceExpr="Country/Region Code From";
                Visible=false }

    { 1100528307;2;Field  ;
                SourceExpr="Country/Region Code To";
                Visible=false }

    { 1100528308;2;Field  ;
                SourceExpr="Departure Date";
                Visible=false }

    { 1100528309;2;Field  ;
                SourceExpr="Departure Time";
                Visible=false }

    { 1100528310;2;Field  ;
                SourceExpr="Arrival Date";
                Visible=false }

    { 1100528311;2;Field  ;
                SourceExpr="Arrival Time";
                Visible=false }

    { 1100294000;2;Field  ;
                SourceExpr="Team Code" }

    { 1100294001;2;Field  ;
                Name=Text Block;
                CaptionML=[ENU=Text Block;
                           NOR=Tekstblokk;
                           SVE=Textblock];
                SourceExpr=CommentLineExist }

    { 1100294003;2;Field  ;
                SourceExpr=Changed;
                Visible=FALSE }

    { 1100294005;2;Field  ;
                SourceExpr=Denied }

    { 1100294006;2;Field  ;
                SourceExpr="Denied By" }

    { 1100294007;2;Field  ;
                SourceExpr="Deny Comment" }

  }
  CODE
  {
    VAR
      JobsSetup@1100525010 : Record 315;
      ServiceSetup@1210190001 : Record 11012800;
      UserSetup@1100409001 : Record 91;
      DimMgt@1100485001 : Codeunit 408;
      DimValRec@1100485002 : Record 349;
      DPA_IsHardFilter@1100000999 : Boolean;
      ServiceEnabled@19076448 : Boolean INDATASET;
      "Amount (LCY)HideValue"@19047794 : Boolean INDATASET;
      ProjectNoEditable@1100525000 : Boolean INDATASET;
      ExtensionContractEditable@1100525001 : Boolean INDATASET;
      PlantFieldsEditable@1100525015 : Boolean INDATASET;
      PlantRateCodeEditable@1100525002 : Boolean INDATASET;
      RentalUnitEditable@1100525003 : Boolean INDATASET;
      ElementEditable@1100525004 : Boolean INDATASET;
      CostComponentEditable@1100525005 : Boolean INDATASET;
      WageComponentEditable@1100285500 : Boolean INDATASET;
      AmountEditable@1100525007 : Boolean INDATASET;
      PostingDateEditable@1100525008 : Boolean INDATASET;
      QuantityEditable@1100525011 : Boolean INDATASET;
      HoursEditable@1100525012 : Boolean INDATASET;
      CostCodeEditable@1100525013 : Boolean INDATASET;
      ServiceDataEditable@1100525014 : Boolean INDATASET;
      ResourceRequestEditable@1100529000 : Boolean INDATASET;
      CopyButtonVisible@1100409000 : Boolean;
      LabourRuleCostCode@1100294001 : Record 11128231;
      LabourRuleWageComponent@1100294000 : Record 11128232;
      Text002@1100285000 : TextConst 'ENU=Wage Component is not connected to labour rule of the employee;NOR=Lõnns Komponent er ikke koblet til arbeidsregel den ansatte;SVE=Lînearten Ñr ej knuten till kod fîr arbetsmarknadsregler';
      Text003@1100285001 : TextConst 'ENU=Cost Code is not connected to labour rule of the employee;NOR=Kostnadskode er ikke koblet til arbeidsregel den ansatte;SVE=Kostnadskoden Ñr ej knuten till kod fîr arbetsmarknadsregler';
      KMEditable@1100525006 : Boolean INDATASET;
      ApprovalManagement4PSConstr@1100528400 : Codeunit 11125349;
      HourAccounting@1100528401 : Record 11012038;
      OpenApprovalEntriesExistForCurrUser@1100528403 : Boolean INDATASET;
      OpenApprovalEntriesExist@1100528402 : Boolean;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      PostingEnabled@1100527550 : Boolean;
      Text001@1100529600 : TextConst 'ENU=Description';
      CostAmountEditable@1100285100 : Boolean;

    PROCEDURE GetHoursFromEmployeeAbsence@1100485000(iHourAccountingRec@1100485000 : Record 11012038);
    BEGIN
      GetHoursFromEmployeeAbsence(iHourAccountingRec);
    END;

    PROCEDURE GetHoursFromPostedHours@1100485001(iHourAccountingRec@1100485000 : Record 11012038);
    BEGIN
      GetHoursFromPostedHours(iHourAccountingRec);
    END;

    PROCEDURE GetProjAndServiceOrderData@1100485003(iHourAccountingRec@1100485000 : Record 11012038);
    BEGIN
      GetProjAndServiceOrderData(iHourAccountingRec);
    END;

    LOCAL PROCEDURE OnAfterGetCurrRecord@19077479();
    BEGIN
      xRec := Rec;

      CALCFIELDS("Total Monday", "Total Tuesday", "Total Wednesday", "Total Thursday", "Total Friday",
        "Total Saturday", "Total Sunday");
      CALCFIELDS("Overtime Monday", "Overtime Tuesday", "Overtime Wednesday", "Overtime Thursday", "Overtime Friday",
        "Overtime Saturday", "Overtime Sunday", "Overtime Hours");
      CALCFIELDS("Norm Hours", "Norm Days", "Normal Hours", "Posted Normal Hours");
      CALCFIELDS("Component Type");

      SetFieldsEditable;
    END;

    PROCEDURE SetFieldsEditable@1100525007();
    VAR
      PlantSetup@1100525000 : Record 11012550;
    BEGIN
      CALCFIELDS("Component Type", "Travel Expenses");

      PostingDateEditable := CompTypeEditable;

      // SESB.I038 ASH 04.07.2013 >>
      // QuantityEditable := ("Component Type" = "Component Type"::Expenses ) AND ("Wage Component" <>'');
      QuantityEditable :=
        ("Component Type" IN ["Component Type"::Expenses,"Component Type"::"Expense hours"]) AND
        ("Wage Component" <>'');
      // SESB.I038 ASH 04.07.2013 <<

      KMEditable := ("Travel Expenses" AND QuantityEditable);

      AmountEditable := QuantityEditable;

      // SESB.I038 ASH 04.07.2013 >>
      // HoursEditable := ("Component Type" = "Component Type"::Hours );
      HoursEditable := ("Component Type" IN ["Component Type"::Hours,"Component Type"::"Expense hours","Component Type"::Addition]);
      // SESB.I038 ASH 04.07.2013 <<

      IF "Cost Object" <> '' THEN BEGIN
        DimValRec.CHANGECOMPANY("Receiving Company");
        DimMgt.SetCompany("Receiving Company");
        DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, FALSE, '');
        AmountEditable := (
          ("Component Type" IN ["Component Type"::Expenses,"Component Type"::"Expense hours","Component Type"::Addition]) AND // SESB.I038 ASH 04.07.2013
          (DimValRec.Code <> '') AND
          NOT (DimValRec."Fixed at Hours Accounting")
                         );
      END;
      CostAmountEditable := "Component Type" = "Component Type"::Addition;  //190905

      WageComponentEditable := ("Cost Type" <> "Cost Type"::Plant);

      CostComponentEditable := (
        (("Project No." <> '') AND JobsSetup."Cost Component Editable") OR
        (("Service Order No." <> '') AND ServiceSetup."Cost Component Editable") OR
        (("Project No." = '') AND ("Service Order No." = ''))
                                );

      IF Type <> Type::Plant THEN
        ElementEditable := ("Project No." <> '')
      ELSE
        ElementEditable := (CheckPlantLocLinkedToProject());

      CostCodeEditable := (Type = Type::Indirect);

      PlantFieldsEditable := FALSE;
      PlantRateCodeEditable := FALSE;
      IF FPSLicenseManagement.LicenseAndReadPermissionForTable(PlantSetup) THEN BEGIN
        IF "Receiving Company" <> '' THEN
          PlantSetup.CHANGECOMPANY("Receiving Company");
        IF PlantSetup.GET THEN BEGIN
          PlantFieldsEditable := (Type = Type::Plant);
          PlantRateCodeEditable := (PlantFieldsEditable AND PlantSetup."Rate Codes");
        END;
      END;

      ServiceDataEditable := (Type = Type::Service);

      RentalUnitEditable := ("Project No." <> '');
      ExtensionContractEditable := ("Project No." <> '');

      ProjectNoEditable := ((Type = Type::Project) AND ("Connection No." = 0));
      //* IF connection then changing not allowed, because by saving the project-hour accounting line
      //* will be deleted.

      "Amount (LCY)HideValue" := ("Component Type" <> "Component Type"::Expenses); //to prevent showing people's salary
      ResourceRequestEditable := (Type <> Type::Indirect);
      // SESB.I038 ASH 04.07.2013 >>
      "Amount (LCY)HideValue" := NOT ("Component Type" IN ["Component Type"::Expenses,"Component Type"::"Expense hours","Component Type"::Addition]);
      // SESB.I038 ASH 04.07.2013 <<

      //RFC256
      IF UserSetup.GET(USERID) THEN
        IF UserSetup."Show amounts in HourAcc" THEN
          "Amount (LCY)HideValue" := FALSE;
    END;

    PROCEDURE GetHoursFromChangeRequestTasks@1100528300(iHourAccountingRec@1100485000 : Record 11012038);
    BEGIN
      Rec.GetHoursFromChangeRequestTasks(iHourAccountingRec);
    END;

    LOCAL PROCEDURE SetControlAppearance@5();
    VAR
      ApprovalsMgmt@1002 : Codeunit 1535;
    BEGIN
      HourAccounting.GET(Year,Week,"Employee No.");
      OpenApprovalEntriesExistForCurrUser := ApprovalsMgmt.LineHasOpenApprovalEntriesForCurrentUser(HourAccounting.RECORDID, "Line No.");
      OpenApprovalEntriesExist := ApprovalsMgmt.LineHasOpenApprovalEntries(HourAccounting.RECORDID, "Line No.");
    END;

    PROCEDURE LookupCostCodes@1100294001();
    VAR
      NewCostCode@1100294000 : Code[10];
    BEGIN
      // SESB.I028 VKO 03.07.2013 >>
      IF CostCodeEditable THEN BEGIN
        NewCostCode := LabourRuleCostCode.LookupCostCodeWithFilter("Employee No.");
        IF NewCostCode <> '' THEN
          VALIDATE("Cost Code",NewCostCode);
      END ELSE
        LabourRuleCostCode.LookupCostCodeWithFilter("Employee No.");
      // SESB.I028 VKO 03.07.2013 <<
    END;

    PROCEDURE LookupWageComponent@1100294004();
    VAR
      NewWageComponentCode@1100294000 : Code[10];
      SeSetup@1000000000 : Record 11128004;
      TextRFC1097@1000000001 : TextConst 'NOR=Du kan ikke endre lõnnstypen for indirekte linjer;SVE=Du kan ej Ñndra pÜ lînearten fîr indirekta rader;ENG=You cannot change the salary type for indirect lines';
    BEGIN
      // SESB.I028 VKO 03.07.2013 >>
      IF WageComponentEditable THEN BEGIN
        NewWageComponentCode := LabourRuleWageComponent.LookupWageComponentWithFilter("Employee No.");
        IF NewWageComponentCode <> '' THEN
          VALIDATE("Wage Component",NewWageComponentCode);
      END ELSE
        LabourRuleWageComponent.LookupWageComponentWithFilter("Employee No.");
      // SESB.I028 VKO 03.07.2013 <<
      //ORANGO.PR
      //RFC-1097
      IF SeSetup.GET(SeSetup."Line type"::Setup,'TIME','INDIRECT') THEN BEGIN
        IF SeSetup."Value (bool)" AND (Type = Type::Indirect) AND ("Wage Component" <> '') THEN BEGIN
          ERROR('%1',TextRFC1097);
          "Wage Component" := xRec."Wage Component";
          EXIT;
        END;
      END;
      //RFC-1097
      //ORANGO.PR
    END;

    PROCEDURE CostCodeOnValidate@1100285500();
    VAR
      "***ITERO***"@1100285502 : Integer;
      Employee@1100285501 : Record 5200;
      LabourRuleCostCode@1100285500 : Record 11128231;
    BEGIN
      //>> ITERO.SB 131007 4PS-011 Check if cost code is connected to the labour rule of the employee
      //>>141104 4PS035
      IF JobsSetup."Filter Cost&Wage on Lab. Code" THEN BEGIN
      //<<141104 4PS035
        Employee.GET("Employee No.");
        IF Employee."Labour Rule" <> '' THEN BEGIN
          LabourRuleCostCode.SETRANGE("Labour Rule Code",Employee."Labour Rule");
          LabourRuleCostCode.SETRANGE("Cost Code","Cost Code");
          IF NOT LabourRuleCostCode.FINDSET THEN
            ERROR(Text003);
        END;
      END;
      //<<
    END;

    PROCEDURE WageComponentOnValidate@1();
    VAR
      Employee@1000 : Record 5200;
      SeSetup@1100583000 : Record 11128004;
      TextRFC1097@1100583001 : TextConst 'NOR=Du kan ikke endre lõnnstypen for indirekte linjer;SVE=Du kan ej Ñndra pÜ lînearten fîr indirekta rader;ENG=You cannot change the salary type for indirect lines';
    BEGIN
      //>> 4PS-011 ITERO.SB 131007 Check if wage comp. is connected to the labour rule of the employee
      //>>ITERO.DJ IME068 131114
      //>>141104 4PS035
      IF JobsSetup."Filter Cost&Wage on Lab. Code" THEN BEGIN
      //<<141104 4PS035
        Employee.GET("Employee No.");
        IF Employee."Labour Rule" <> '' THEN BEGIN
          LabourRuleWageComponent.SETRANGE("Labour Rule Code",Employee."Labour Rule");
          LabourRuleWageComponent.SETRANGE("Wage Component Code", "Wage Component");
          IF NOT LabourRuleWageComponent.FINDSET THEN
            ERROR(Text002);
        END;
      END;
      //<<ITERO.DJ 131114
      //<< 4PS-011
      //ORANGO.PR
      //RFC-1097
      IF SeSetup.GET(SeSetup."Line type"::Setup,'TIME','INDIRECT') THEN BEGIN
        IF SeSetup."Value (bool)" AND (Type = Type::Indirect) AND ("Wage Component" <> '') THEN BEGIN
          ERROR('%1',TextRFC1097);
          "Wage Component" := xRec."Wage Component";
          EXIT;
        END;
      END;
      //RFC-1097
      //ORANGO.PR
    END;

    BEGIN
    {
      SESB.I028 Cost Codes and Wage Component filter
         VKO 03.07.2013 Trigger "Cost Code - OnLookup" changed
         VKO 03.07.2013 Trigger "Wage Component - OnLookup" changed
         VKO 03.07.2013 Trigger LookupCostCode added
         VKO 03.07.2013 Trigger LookupWageComponent added

      SESB.I029 Default value type of time
         ASH 03.07.2013 Trigger "Form - OnNewRecord" changed

      SESB.I037 Enter LAG Number
         ASH 04.07.2013 Control "Team Code" added

      SESB.I038 New Wage Component type
         ASH 04.07.2013 Trigger SetFieldsEditable changed

      SESB.I039 Extend no of characters in hour line
         ASH 05.07.2013 Control "Text Block" added
         ASH 05.07.2013 Action "Line Comments" added

      SESB.I031 Work Flow - Approval of hours
         ASH 17.07.2013 Control Changed added
         ASH 17.07.2013 Control Status added

      SESB.I035.I036 FD Message when dissaproving-correcting hours
         VKO 29.07.2013 Control "Denied" added
         VKO 29.07.2013 Control "Denied By" added
         VKO 29.07.2013 Control "Deny Comment" added

      4PS-011 ITERO.SB 131007 Check if wage comp. is connected to the labour rule of the employee
      ITERO.SB 131007 4PS-011 Check if wage comp. & cost code is connected to the labour rule of the employee
      ITERO.DJ 131114 IME068 Change to check if wage component is connected to the labour rule of the employee
      ITERO.DL 140408 ENH032 same controls for CostCode OnValidate and OnLookup
      141104 ITERO.WG 4PS035 Added trigger WageComponentOnValidate, changed trigger CostCodeOnValidate

      170825 ITERO.WG Pure275070 Changed LookupCostCode till LookupCostCodes, same funktion is in table as well.
      190117 ORANGO.DL RFC256 new fields added: "Component Type", "Unit Cost", "Amount (LCY)",  Amount with Visible=FALSE;
                              show amounts based on user setup
      190131 ORANGO.DL RFC226 Added "Addition" in Wage Component Type Filter
      190723 ORANGO.DL RFC226 corrections in SetFieldsEditable
      190905 ORANGO.DL RFC226 open "Unit Cost (LCY)" for editing
    }
    END.
  }
}

