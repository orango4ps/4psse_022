OBJECT XMLport 11012380 Import GL Entries Paymaster
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Import GL Entries Paymaster;
               SVE=Importera redovisningstransaktioner Paymaster];
    Direction=Import;
    DefaultFieldsValidation=No;
    TextEncoding=WINDOWS;
    OnInitXMLport=BEGIN
                    GLSetup.GET;
                    HumanResourcesSetup.GET;
                    HumanResourcesSetup.TESTFIELD("Salary Application",HumanResourcesSetup."Salary Application"::Paymaster);
                    IF HumanResourcesSetup."Length Company Paymaster" = 0 THEN
                      HumanResourcesSetup."Length Company Paymaster" := 4;

                    currXMLport.FILENAME := HumanResourcesSetup."Pathname Files from Salary";
                  END;

    OnPostXMLport=BEGIN
                    WITH "Gen. Journal Line" DO BEGIN
                    WHILE BufferRec.FIND('-') DO BEGIN
                      BufferRec.SETRANGE(Company, BufferRec.Company);
                      BufferRec.SETRANGE("Journal Template Name", BufferRec."Journal Template Name");
                      BufferRec.SETRANGE("Journal Batch Name", BufferRec."Journal Batch Name");
                      BufferRec.SETRANGE(Post, BufferRec.Post);
                      BufferRec.SETRANGE("Account No.", BufferRec."Account No.");
                      BufferRec.SETRANGE("Balance Account No.", BufferRec."Balance Account No.");
                      BufferRec.SETRANGE(Project, BufferRec.Project);
                      BufferRec.SETRANGE("Department Code", BufferRec."Department Code");
                      BufferRec.SETRANGE("Cost Object", BufferRec."Cost Object");

                      CumAmount := 0;
                      REPEAT
                        CumAmount := CumAmount + BufferRec.Amount;
                      UNTIL BufferRec.NEXT = 0;

                      "Gen. Journal Line".CHANGECOMPANY(BufferRec.Company);

                      PostRec.CHANGECOMPANY(BufferRec.Company);
                      PostRec.LOCKTABLE;
                      PostRec.SETRANGE("Journal Template Name", BufferRec."Journal Template Name");
                      PostRec.SETRANGE("Journal Batch Name", BufferRec."Journal Batch Name");
                      IF NOT PostRec.FIND('+') THEN PostRec.INIT;

                      INIT;
                      "Journal Template Name" := BufferRec."Journal Template Name";
                      "Journal Batch Name" := BufferRec."Journal Batch Name";
                      "Line No." := PostRec."Line No." + 10000;
                      "Posting Date" := BufferRec."Posting Date";
                      "Document Date" := BufferRec."Posting Date";
                      "Document No." := BufferRec."Document No.";
                      "Source Code" := BufferRec."Source Code";
                      "Reason Code" := BufferRec."Reason Code";
                      "Wage Component" := BufferRec."Wage Component";
                      Amount := CumAmount;
                      "Job No." := BufferRec.Project;
                      Description := BufferRec.Description;
                      "Shortcut Dimension 2 Code" := BufferRec."Cost Object";
                      "Shortcut Dimension 1 Code" := BufferRec."Department Code";
                      IF BufferRec.Post = '' THEN
                         "Account No." := BufferRec."Account No."
                      ELSE
                         "Account No." := BufferRec.Post;
                      "Bal. Account No." := BufferRec."Balance Account No.";
                      "Account Type" := "Account Type"::"G/L Account";
                      "Bal. Account Type" := "Bal. Account Type"::"G/L Account";
                      "System-Created Entry" := TRUE;
                      "Amount (LCY)" := Amount;
                      IF Amount > 0 THEN
                        "Debit Amount" := Amount
                      ELSE
                        "Credit Amount" := -Amount;
                      CASE TRUE OF
                        ("Account No." <> '') AND ("Bal. Account No." <> ''):
                          "Balance (LCY)" := 0;
                        "Bal. Account No." <> '':
                          "Balance (LCY)" := -"Amount (LCY)";
                        ELSE
                          "Balance (LCY)" := "Amount (LCY)";
                      END;

                      IF NOT GlAccRec.GET("Account No.") THEN GlAccRec.INIT;
                      IF GlAccRec."Import Posting Information" = TRUE THEN BEGIN
                        "Gen. Posting Type" := GlAccRec."Gen. Posting Type";
                        "Gen. Bus. Posting Group" := GlAccRec."Gen. Bus. Posting Group";
                        "Gen. Prod. Posting Group" := GlAccRec."Gen. Prod. Posting Group";
                        "VAT Bus. Posting Group" := GlAccRec."VAT Bus. Posting Group";
                        "VAT Prod. Posting Group" := GlAccRec."VAT Prod. Posting Group";
                        "Tax Area Code" := GlAccRec."Tax Area Code";
                        "Tax Liable" := GlAccRec."Tax Liable";
                        "Tax Group Code" := GlAccRec."Tax Group Code";
                      END;

                      IF NOT GlAccRec.GET("Bal. Account No.") THEN GlAccRec.INIT;
                      IF GlAccRec."Import Posting Information" = TRUE THEN BEGIN
                        "Bal. Gen. Posting Type" := GlAccRec."Gen. Posting Type";
                        "Bal. Gen. Bus. Posting Group" := GlAccRec."Gen. Bus. Posting Group";
                        "Bal. Gen. Prod. Posting Group" := GlAccRec."Gen. Prod. Posting Group";
                        "Bal. VAT Bus. Posting Group" := GlAccRec."VAT Bus. Posting Group";
                        "Bal. VAT Prod. Posting Group" := GlAccRec."VAT Prod. Posting Group";
                        "Bal. Tax Area Code" := GlAccRec."Tax Area Code";
                        "Bal. Tax Liable" := GlAccRec."Tax Liable";
                        "Bal. Tax Group Code" := GlAccRec."Tax Group Code";
                      END;

                      IF VATPostSetup.GET("VAT Bus. Posting Group", "VAT Prod. Posting Group") THEN BEGIN
                        "VAT Calculation Type" := VATPostSetup."VAT Calculation Type";
                        IF "VAT Calculation Type" = "VAT Calculation Type"::"Normal VAT" THEN
                          "VAT %" := VATPostSetup."VAT %";
                        CASE "VAT Calculation Type" OF
                          "VAT Calculation Type"::"Normal VAT",
                          "VAT Calculation Type"::"Reverse Charge VAT":
                            "VAT Amount" := Amount - ROUND(Amount / (1 + "VAT %" / 100), 0.01);
                          "VAT Calculation Type"::"Full VAT":
                            "VAT Amount" := Amount;
                        END;
                      END;
                      "Amount (LCY)" := Amount;
                      "VAT Base Amount" := Amount - "VAT Amount";
                      "VAT Amount (LCY)" := "VAT Amount";
                      "VAT Base Amount (LCY)" := "Amount (LCY)" - "VAT Amount (LCY)";

                      IF VATPostSetup.GET("Bal. VAT Bus. Posting Group", "Bal. VAT Prod. Posting Group") THEN BEGIN
                        "Bal. VAT Calculation Type" := VATPostSetup."VAT Calculation Type";
                        IF "Bal. VAT Calculation Type" = "Bal. VAT Calculation Type"::"Normal VAT" THEN
                          "Bal. VAT %" := VATPostSetup."VAT %";
                        CASE "Bal. VAT Calculation Type" OF
                          "Bal. VAT Calculation Type"::"Normal VAT",
                          "Bal. VAT Calculation Type"::"Reverse Charge VAT":
                            "Bal. VAT Amount" := -(Amount - ROUND(Amount / (1 + "Bal. VAT %" / 100), 0.01));
                          "Bal. VAT Calculation Type"::"Full VAT":
                            "Bal. VAT Amount" := -Amount;
                        END;
                      END;
                      "Bal. VAT Base Amount" := -(Amount + "Bal. VAT Amount");
                      "Bal. VAT Amount (LCY)" := "Bal. VAT Amount";
                      "Bal. VAT Base Amount (LCY)" := -("Amount (LCY)" + "Bal. VAT Amount (LCY)");
                      "Origin Salary Application" := TRUE;

                      IF "Shortcut Dimension 1 Code" <> '' THEN BEGIN
                        DimMgt.SetCompany("Receiving Company");
                        DimMgt.ValidateShortcutDimValues(1,"Shortcut Dimension 1 Code","Dimension Set ID");
                        DimMgt.SetCompany(COMPANYNAME);
                      END;
                      IF "Shortcut Dimension 2 Code" <> '' THEN BEGIN
                        DimMgt.SetCompany("Receiving Company");
                        DimMgt.ValidateShortcutDimValues(2,"Shortcut Dimension 2 Code","Dimension Set ID");
                        DimMgt.SetCompany(COMPANYNAME);
                      END;

                      INSERT;

                      BufferRec.DELETEALL;
                      BufferRec.RESET;
                    END;

                    END;

                    OldFile := currXMLport.FILENAME;
                    NewFile := HumanResourcesSetup.DetermineBackupFile(OldFile);
                    IF NewFile <> OldFile THEN
                      FileMgt.RenameClientFile(OldFile, NewFile, TRUE);
                  END;

    Format=Fixed Text;
  }
  ELEMENTS
  {
    { [{C2B224DB-36EF-4567-9B0F-2FDE76449EF2}];  ;Root                ;Element ;Text     }

    { [{E92E7BEF-2B05-4CF8-9705-5FC0CCF89A62}];1 ;GenJournalLine      ;Element ;Table   ;
                                                  SourceTable=Table81;
                                                  SourceTableView=SORTING(Field1,Field51,Field2);
                                                  Import::OnAfterInitRecord=BEGIN
                                                                              "Gen. Journal Line".INIT;
                                                                              CLEAR(JournalTemplate);
                                                                              CLEAR(DocumentNo);
                                                                              CLEAR(Year);
                                                                              CLEAR(Period);
                                                                              CLEAR(Date);
                                                                              CLEAR(AccountName);
                                                                              CLEAR(BalanceAccountName);
                                                                              CLEAR(Department);
                                                                              CLEAR(WageCode);
                                                                              CLEAR(Desc);
                                                                              CLEAR(RunNo);
                                                                              CLEAR(HoursTxt);
                                                                              CLEAR(HourSign);
                                                                              CLEAR(ValueTxt);
                                                                              CLEAR(AmountSign);
                                                                              CLEAR(CompanyAndAdministration);
                                                                            END;

                                                  Import::OnBeforeInsertRecord=BEGIN
                                                                                 WITH "Gen. Journal Line" DO BEGIN

                                                                                 Company := COPYSTR(CompanyAndAdministration, 1, HumanResourcesSetup."Length Company Paymaster");
                                                                                 Administration := COPYSTR(CompanyAndAdministration, HumanResourcesSetup."Length Company Paymaster" + 1);
                                                                                 DetermineCompany;

                                                                                 JobsSetup.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 HumanResourcesSetupRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 JnlTemplRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 JnlTemplRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 JnlPaymRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 WageRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 ProjRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 PtypRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 DimValRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 PostRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 GlAccRec.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 VATPostSetup.CHANGECOMPANY(CompRec."Navision Company");
                                                                                 "Gen. Journal Line".CHANGECOMPANY(CompRec."Navision Company");

                                                                                 HumanResourcesSetupRec.GET;
                                                                                 HumanResourcesSetupRec.TESTFIELD("Salary Application",HumanResourcesSetupRec."Salary Application"::Paymaster);

                                                                                 JobsSetup.GET;

                                                                                 IF NOT JnlPaymRec.GET(JournalTemplate) THEN
                                                                                   ERROR(Text005,CompRec."Navision Company");

                                                                                 IF NOT JnlTemplRec.GET(JnlPaymRec."GL Entry Journal Templ. (NAV)") THEN
                                                                                   JnlTemplRec.INIT;
                                                                                 IF NOT JnlBatchRec.GET(JnlPaymRec."GL Entry Journal Templ. (NAV)", JnlPaymRec."GL Entry Journal Batch (NAV)") THEN
                                                                                   JnlBatchRec.INIT;

                                                                                 IF DocNo = '' THEN BEGIN
                                                                                   NoSeriesMgt.SetFromOtherCompany(CompRec."Navision Company");
                                                                                   IF JnlBatchRec."No. Series" <> '' THEN
                                                                                     DocNo := NoSeriesMgt.GetNextNo(JnlBatchRec."No. Series",0D,FALSE)
                                                                                   ELSE
                                                                                     IF JnlTemplRec."No. Series" <> '' THEN
                                                                                       DocNo := NoSeriesMgt.GetNextNo(JnlTemplRec."No. Series",0D,FALSE);
                                                                                 END;

                                                                                 IF NOT WageRec.GET(WageCode) THEN WageRec.INIT;

                                                                                 IF WageRec.Project <> '' THEN BEGIN
                                                                                   DimValRec.GET(GLSetup."Shortcut Dimension 2 Code", WageRec."Cost Object");
                                                                                   ProjRec.GET(WageRec.Project);
                                                                                   PtypRec.GET(ProjRec."Project Type");

                                                                                   IF (JobsSetup."Provisions at Closure") AND
                                                                                      (ProjRec."Project Status" >= ProjRec."Project Status"::Finished) THEN
                                                                                   BEGIN
                                                                                     CASE DimValRec."Cost Type" OF
                                                                                       DimValRec."Cost Type"::Labor :
                                                                                         WageRec."Account No." := PtypRec."Provision Account Labor";
                                                                                       DimValRec."Cost Type"::Material :
                                                                                         WageRec."Account No." := PtypRec."Provision Account Material";
                                                                                       DimValRec."Cost Type"::Subcontracting :
                                                                                         WageRec."Account No." := PtypRec."Provision Account Subcontr.";
                                                                                       DimValRec."Cost Type"::Plant :
                                                                                         WageRec."Account No." := PtypRec."Provision Account Plant";
                                                                                       DimValRec."Cost Type"::Sundry :
                                                                                         WageRec."Account No." := PtypRec."Provision Account Sundry";
                                                                                       DimValRec."Cost Type"::Revenue :
                                                                                         WageRec."Account No." := PtypRec."Provision Account Revenue";
                                                                                     END;
                                                                                   END ELSE BEGIN
                                                                                     CASE DimValRec."Cost Type" OF
                                                                                       DimValRec."Cost Type"::Labor :
                                                                                         WageRec."Account No." := PtypRec."WIP Account Labor";
                                                                                       DimValRec."Cost Type"::Material :
                                                                                         WageRec."Account No." := PtypRec."WIP Account Material";
                                                                                       DimValRec."Cost Type"::Subcontracting :
                                                                                         WageRec."Account No." := PtypRec."WIP Account Subcontracting";
                                                                                       DimValRec."Cost Type"::Plant :
                                                                                         WageRec."Account No." := PtypRec."WIP Account Plant";
                                                                                       DimValRec."Cost Type"::Sundry :
                                                                                         WageRec."Account No." := PtypRec."WIP Account Sundry";
                                                                                       DimValRec."Cost Type"::Revenue :
                                                                                         WageRec."Account No." := PtypRec."WIP Account Revenue";
                                                                                     END;
                                                                                   END;
                                                                                 END;

                                                                                 IF WageRec."Account No." = '' THEN BEGIN
                                                                                   StripZero(AccountName, MaxLenAcc);
                                                                                   WageRec."Account No." := AccountName;
                                                                                 END;
                                                                                 IF WageRec."Balance Account No." = '' THEN BEGIN
                                                                                   StripZero(BalanceAccountName, MaxLenAcc);
                                                                                   WageRec."Balance Account No." := BalanceAccountName;
                                                                                 END;
                                                                                 IF WageRec."Department Code" = '' THEN BEGIN
                                                                                   IF HumanResourcesSetup."Split Department (Paymaster)" THEN BEGIN
                                                                                     WageRec."Cost Object" := COPYSTR(Department,1,HumanResourcesSetup."Split Department from Position"-1);
                                                                                     Department := COPYSTR(
                                                                                       Department,HumanResourcesSetup."Split Department from Position",
                                                                                       8-(HumanResourcesSetup."Split Department from Position"-1));
                                                                                   END;
                                                                                   StripZero(Department, MaxLenDep);
                                                                                   WageRec."Department Code" := Department;
                                                                                 END;
                                                                                 IF WageRec.Description = '' THEN
                                                                                   WageRec.Description := Desc;

                                                                                 IF HumanResourcesSetupRec."Compress Journal Entries" = TRUE THEN BEGIN
                                                                                   BufferRec.LOCKTABLE;
                                                                                   LineCounter := LineCounter + 10000;
                                                                                 END ELSE BEGIN
                                                                                   PostRec.LOCKTABLE;
                                                                                   PostRec.SETRANGE("Journal Template Name", JnlPaymRec."GL Entry Journal Templ. (NAV)");
                                                                                   PostRec.SETRANGE("Journal Batch Name", JnlPaymRec."GL Entry Journal Batch (NAV)");
                                                                                   IF NOT PostRec.FIND('+') THEN PostRec.INIT;
                                                                                   LineCounter := PostRec."Line No." + 10000;
                                                                                 END;

                                                                                 filler := Date;
                                                                                 StripZero(filler, 0);
                                                                                 IF filler <> '' THEN BEGIN
                                                                                   EVALUATE(BookYear,COPYSTR(Date,5,2));
                                                                                   EVALUATE(BookMonth,COPYSTR(Date,3,2));
                                                                                   EVALUATE(BookDay,COPYSTR(Date,1,2));
                                                                                   PostingDate := DMY2DATE(BookDay,BookMonth,BookYear+2000);
                                                                                 END ELSE BEGIN
                                                                                   PostingDate := 0D;
                                                                                 END;

                                                                                 Value := Value / 100.0;
                                                                                 IF AmountSign = '-' THEN Value := (Value * -1.0);

                                                                                 ShowStatus(
                                                                                   JnlPaymRec."GL Entry Journal Templ. (NAV)",
                                                                                   JnlPaymRec."GL Entry Journal Batch (NAV)",
                                                                                   LineCounter);

                                                                                 IF HumanResourcesSetupRec."Compress Journal Entries" = TRUE THEN BEGIN
                                                                                   WITH BufferRec DO BEGIN
                                                                                     INIT;
                                                                                     Company := CompRec."Navision Company";
                                                                                     "Journal Template Name" := JnlPaymRec."GL Entry Journal Templ. (NAV)";
                                                                                     "Journal Batch Name" := JnlPaymRec."GL Entry Journal Batch (NAV)";
                                                                                     "Entry No." := LineCounter;
                                                                                     "Posting Date" := PostingDate;
                                                                                     IF DocNo <> '' THEN
                                                                                       "Document No." := DocNo
                                                                                     ELSE
                                                                                       "Document No." := DocumentNo;
                                                                                     "Source Code" := JnlTemplRec."Source Code";
                                                                                     IF JnlBatchRec."Reason Code" <> '' THEN
                                                                                       "Reason Code" := JnlBatchRec."Reason Code"
                                                                                     ELSE
                                                                                       "Reason Code" := JnlTemplRec."Reason Code";
                                                                                     "Wage Component" := WageCode;
                                                                                     Amount := Value;
                                                                                     Project := WageRec.Project;
                                                                                     IF EntryDesc <> '' THEN
                                                                                       Description := EntryDesc
                                                                                     ELSE
                                                                                       Description := WageRec.Description;
                                                                                     "Cost Object" := WageRec."Cost Object";
                                                                                     "Department Code" := WageRec."Department Code";
                                                                                     "Account No." := WageRec."Account No.";
                                                                                     "Balance Account No." := WageRec."Balance Account No.";
                                                                                     IF ("Account No." <> '') AND ("Balance Account No." = '') THEN BEGIN
                                                                                       Post := "Account No.";
                                                                                       "Account No." := '';
                                                                                     END;
                                                                                     IF ("Account No." = '') AND ("Balance Account No." <> '') THEN BEGIN
                                                                                       Post := "Balance Account No.";
                                                                                       "Balance Account No." := '';
                                                                                       Amount := -Amount;
                                                                                     END;

                                                                                     INSERT;
                                                                                     Post := '';
                                                                                   END;
                                                                                   currXMLport.SKIP;
                                                                                 END ELSE BEGIN
                                                                                   INIT;
                                                                                   "Journal Template Name" := JnlPaymRec."GL Entry Journal Templ. (NAV)";
                                                                                   "Journal Batch Name" := JnlPaymRec."GL Entry Journal Batch (NAV)";
                                                                                   "Line No." := LineCounter;
                                                                                   "Posting Date" := PostingDate;
                                                                                   "Document Date" := PostingDate;
                                                                                   IF DocNo <> '' THEN
                                                                                     "Document No." := DocNo
                                                                                   ELSE
                                                                                     "Document No." := DocumentNo;
                                                                                   "Source Code" := JnlTemplRec."Source Code";
                                                                                   IF JnlBatchRec."Reason Code" <> '' THEN
                                                                                     "Reason Code" := JnlBatchRec."Reason Code"
                                                                                   ELSE
                                                                                     "Reason Code" := JnlTemplRec."Reason Code";
                                                                                   "Wage Component" := WageCode;
                                                                                   Amount := Value;
                                                                                   "Job No." := WageRec.Project;
                                                                                   IF EntryDesc <> '' THEN
                                                                                     Description := EntryDesc
                                                                                   ELSE
                                                                                     Description := WageRec.Description;
                                                                                   "Shortcut Dimension 2 Code" := WageRec."Cost Object";
                                                                                   "Shortcut Dimension 1 Code" := WageRec."Department Code";
                                                                                   "Account No." := WageRec."Account No.";
                                                                                   "Bal. Account No." := WageRec."Balance Account No.";
                                                                                   "Account Type" := "Account Type"::"G/L Account";
                                                                                   "Bal. Account Type" := "Bal. Account Type"::"G/L Account";
                                                                                   "System-Created Entry" := TRUE;
                                                                                   "Amount (LCY)" := Amount;
                                                                                   IF Amount > 0 THEN
                                                                                     "Debit Amount" := Amount
                                                                                   ELSE
                                                                                     "Credit Amount" := -Amount;
                                                                                   CASE TRUE OF
                                                                                     ("Account No." <> '') AND ("Bal. Account No." <> ''):
                                                                                       "Balance (LCY)" := 0;
                                                                                     "Bal. Account No." <> '':
                                                                                       "Balance (LCY)" := -"Amount (LCY)";
                                                                                     ELSE
                                                                                       "Balance (LCY)" := "Amount (LCY)";
                                                                                   END;

                                                                                   IF NOT GlAccRec.GET("Account No.") THEN GlAccRec.INIT;
                                                                                   IF GlAccRec."Import Posting Information" = TRUE THEN BEGIN
                                                                                     "Gen. Posting Type" := GlAccRec."Gen. Posting Type";
                                                                                     "Gen. Bus. Posting Group" := GlAccRec."Gen. Bus. Posting Group";
                                                                                     "Gen. Prod. Posting Group" := GlAccRec."Gen. Prod. Posting Group";
                                                                                     "VAT Bus. Posting Group" := GlAccRec."VAT Bus. Posting Group";
                                                                                     "VAT Prod. Posting Group" := GlAccRec."VAT Prod. Posting Group";
                                                                                     "Tax Area Code" := GlAccRec."Tax Area Code";
                                                                                     "Tax Liable" := GlAccRec."Tax Liable";
                                                                                     "Tax Group Code" := GlAccRec."Tax Group Code";
                                                                                   END;

                                                                                   IF NOT GlAccRec.GET("Bal. Account No.") THEN GlAccRec.INIT;
                                                                                   IF GlAccRec."Import Posting Information" = TRUE THEN BEGIN
                                                                                     "Bal. Gen. Posting Type" := GlAccRec."Gen. Posting Type";
                                                                                     "Bal. Gen. Bus. Posting Group" := GlAccRec."Gen. Bus. Posting Group";
                                                                                     "Bal. Gen. Prod. Posting Group" := GlAccRec."Gen. Prod. Posting Group";
                                                                                     "Bal. VAT Bus. Posting Group" := GlAccRec."VAT Bus. Posting Group";
                                                                                     "Bal. VAT Prod. Posting Group" := GlAccRec."VAT Prod. Posting Group";
                                                                                     "Bal. Tax Area Code" := GlAccRec."Tax Area Code";
                                                                                     "Bal. Tax Liable" := GlAccRec."Tax Liable";
                                                                                     "Bal. Tax Group Code" := GlAccRec."Tax Group Code";
                                                                                   END;

                                                                                   IF VATPostSetup.GET("VAT Bus. Posting Group", "VAT Prod. Posting Group") THEN BEGIN
                                                                                     "VAT Calculation Type" := VATPostSetup."VAT Calculation Type";
                                                                                     IF "VAT Calculation Type" = "VAT Calculation Type"::"Normal VAT" THEN
                                                                                       "VAT %" := VATPostSetup."VAT %";
                                                                                     CASE "VAT Calculation Type" OF
                                                                                       "VAT Calculation Type"::"Normal VAT",
                                                                                       "VAT Calculation Type"::"Reverse Charge VAT":
                                                                                          "VAT Amount" := Amount - ROUND(Amount / (1 + "VAT %" / 100), 0.01);
                                                                                       "VAT Calculation Type"::"Full VAT":
                                                                                         "VAT Amount" := Amount;
                                                                                     END;
                                                                                   END;
                                                                                   "Amount (LCY)" := Amount;
                                                                                   "VAT Base Amount" := Amount - "VAT Amount";
                                                                                   "VAT Amount (LCY)" := "VAT Amount";
                                                                                   "VAT Base Amount (LCY)" := "Amount (LCY)" - "VAT Amount (LCY)";

                                                                                   IF VATPostSetup.GET("Bal. VAT Bus. Posting Group", "Bal. VAT Prod. Posting Group") THEN BEGIN
                                                                                     "Bal. VAT Calculation Type" := VATPostSetup."VAT Calculation Type";
                                                                                     IF "Bal. VAT Calculation Type" = "Bal. VAT Calculation Type"::"Normal VAT" THEN
                                                                                       "Bal. VAT %" := VATPostSetup."VAT %";
                                                                                     CASE "Bal. VAT Calculation Type" OF
                                                                                       "Bal. VAT Calculation Type"::"Normal VAT",
                                                                                       "Bal. VAT Calculation Type"::"Reverse Charge VAT":
                                                                                         "Bal. VAT Amount" := -(Amount - ROUND(Amount / (1 + "Bal. VAT %" / 100), 0.01));
                                                                                       "Bal. VAT Calculation Type"::"Full VAT":
                                                                                         "Bal. VAT Amount" := -Amount;
                                                                                     END;
                                                                                   END;
                                                                                   "Bal. VAT Base Amount" := -(Amount + "Bal. VAT Amount");
                                                                                   "Bal. VAT Amount (LCY)" := "Bal. VAT Amount";
                                                                                   "Bal. VAT Base Amount (LCY)" := -("Amount (LCY)" + "Bal. VAT Amount (LCY)");
                                                                                   "Origin Salary Application" := TRUE;

                                                                                   IF "Shortcut Dimension 1 Code" <> '' THEN BEGIN
                                                                                     DimMgt.SetCompany("Receiving Company");
                                                                                     DimMgt.ValidateShortcutDimValues(1,"Shortcut Dimension 1 Code","Dimension Set ID");
                                                                                     DimMgt.SetCompany(COMPANYNAME);
                                                                                   END;
                                                                                   IF "Shortcut Dimension 2 Code" <> '' THEN BEGIN
                                                                                     DimMgt.SetCompany("Receiving Company");
                                                                                     DimMgt.ValidateShortcutDimValues(2,"Shortcut Dimension 2 Code","Dimension Set ID");
                                                                                     DimMgt.SetCompany(COMPANYNAME);
                                                                                   END;

                                                                                   INSERT;
                                                                                 END;

                                                                                 currXMLport.SKIP;

                                                                                 END;
                                                                               END;
                                                                                }

    { [{C17FECFA-12D1-414F-ACDB-BCE1D3121E53}];2 ;JournalTemplate     ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=2 }

    { [{40BCE1A7-8E06-4736-AF67-A5CE0282118A}];2 ;DocumentNo          ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=6 }

    { [{32379775-AA9B-462F-8491-57BF023714F1}];2 ;Year                ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=2 }

    { [{8D0B2E91-FDDF-4551-A6C1-A86860324564}];2 ;Period              ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=2 }

    { [{579CF36B-CC2C-4555-AF69-13CB38F5D762}];2 ;Date                ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=6 }

    { [{956D1F43-9204-4C88-896C-E17AEE212CA7}];2 ;AccountName         ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=6 }

    { [{85270870-D7BE-400E-9823-2306CEA6E1AA}];2 ;BalanceAccountName  ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=6 }

    { [{0CD2E6F6-AEB7-45CE-BDEA-CE11E199C338}];2 ;Department          ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=8 }

    { [{3D51B0AA-43BA-453A-BA22-A5F89D1C9C7D}];2 ;WageCode            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=3 }

    { [{0A532D22-62B3-4695-BD0A-9538E47E3618}];2 ;Desc                ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=15 }

    { [{6DD6B5F1-A798-4C7B-A701-C10A30728E89}];2 ;RunNo               ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=3 }

    { [{BC61E2F0-17B3-459B-A211-26645F3B2F56}];2 ;HoursTxt            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Import::OnAfterAssignVariable=BEGIN
                                                                                  FillEmptyTextWithZero(HoursTxt);
                                                                                  HoursTxt := CONVERTSTR(HoursTxt, '.', ',');
                                                                                  EVALUATE(hours, HoursTxt);
                                                                                END;

                                                  Width=11 }

    { [{01B4E887-083B-4A1D-B60F-104291EEE256}];2 ;HourSign            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{4CF307DC-96CA-4CD3-8224-1A295F8B8F30}];2 ;ValueTxt            ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Import::OnAfterAssignVariable=BEGIN
                                                                                  FillEmptyTextWithZero(ValueTxt);
                                                                                  ValueTxt := CONVERTSTR(ValueTxt, '.', ',');
                                                                                  EVALUATE(Value, ValueTxt);
                                                                                END;

                                                  Width=11 }

    { [{669F61CE-D6A7-44E6-9CD5-F2C5ADF32290}];2 ;AmountSign          ;Element ;Text    ;
                                                  MinOccurs=Zero;
                                                  Width=1 }

    { [{A6EEC740-2208-47E3-A56E-EDB7DCA8E616}];2 ;CompanyAndAdministration;Element;Text ;
                                                  MinOccurs=Zero;
                                                  Width=7 }

  }
  EVENTS
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
      SaveValues=Yes;
    }
    CONTROLS
    {
      { 1100528405;;Container;
                  ContainerType=ContentArea }

      { 1100528404;1;Group  ;
                  CaptionML=[ENU=Options;
                             SVE=Alternativ];
                  GroupType=Group }

      { 1100528403;2;Field  ;
                  Name=EntryDesc;
                  CaptionML=[ENU=Entry Description;
                             SVE=Transaktionsbeskrivning];
                  SourceExpr=EntryDesc }

      { 1100528402;2;Field  ;
                  Name=RemZero;
                  CaptionML=[ENU=Remove Zero Prefix;
                             SVE=Ta bort nollprefix];
                  OptionCaptionML=[ENU=All,Upto Maximum Used Field Length;
                                   SVE=Alla,Upp till maximalt anvnd fltlngd];
                  SourceExpr=RemZero;
                  OnValidate=BEGIN
                               IF RemZero = RemZero::All THEN BEGIN
                                 MaxLenAcc := 0;
                                 MaxLenDep := 0;
                               END ELSE BEGIN
                                 MaxLenAcc := MAXSTRLEN(GlAccRec."No.");
                                 MaxLenDep := MAXSTRLEN(DimValRec.Code);
                               END;
                             END;
                              }

      { 1100528401;2;Field  ;
                  Name=MaxLenAcc;
                  CaptionML=[ENU=Account No.;
                             SVE=Nr];
                  SourceExpr=MaxLenAcc;
                  OnValidate=BEGIN
                               IF RemZero = RemZero::All THEN
                                 MaxLenAcc := 0;
                             END;
                              }

      { 1100528400;2;Field  ;
                  Name=MaxLenDep;
                  CaptionML=[ENU=Department Code;
                             SVE=Mottagande avdelningskod];
                  SourceExpr=MaxLenDep;
                  OnValidate=BEGIN
                               IF RemZero = RemZero::All THEN
                                 MaxLenDep := 0;
                             END;
                              }

    }
  }
  CODE
  {
    VAR
      GLSetup@1100528448 : Record 98;
      HumanResourcesSetup@1100528447 : Record 5218;
      VATPostSetup@1100528446 : Record 325;
      JnlPaymRec@1100528445 : Record 11012376;
      JnlTemplRec@1100528444 : Record 80;
      JnlBatchRec@1100528443 : Record 232;
      CompRec@1100528442 : Record 11012375;
      WageRec@1100528441 : Record 11012377;
      HumanResourcesSetupRec@1100525001 : Record 5218;
      JobsSetup@1100525002 : Record 315;
      PostRec@1100528439 : Record 81;
      ProjRec@1100528438 : Record 11072003;
      PtypRec@1100528437 : Record 11012009;
      GlAccRec@1100528436 : Record 15;
      BufferRec@1100528435 : Record 11012378;
      DimValRec@1100528433 : Record 349;
      FileMgt@1100528416 : Codeunit 419;
      XMLportStatusDialogMgt@1100528417 : Codeunit 11130006;
      DimMgt@1100525000 : Codeunit 408;
      LineCounter@1100528432 : Integer;
      BookYear@1100528431 : Integer;
      BookMonth@1100528430 : Integer;
      BookDay@1100528429 : Integer;
      PostingDate@1100528428 : Date;
      Company@1100528425 : Text[30];
      Administration@1100528424 : Text[30];
      DocNo@1100528420 : Code[20];
      hours@1100528411 : Decimal;
      Value@1100528409 : Decimal;
      CumAmount@1100528408 : Decimal;
      EntryDesc@1100528407 : Text[30];
      OldFile@1100528406 : Text[100];
      NewFile@1100528405 : Text[250];
      filler@1100528404 : Text[30];
      NoSeriesMgt@1100528403 : Codeunit 396;
      RemZero@1100528402 : 'All,Field Length';
      MaxLenAcc@1100528401 : Integer;
      MaxLenDep@1100528400 : Integer;
      Text001@1100528414 : TextConst 'ENU=Navision Company can not be determined via Company and Administration from Paymaster;SVE=Navision-fretaget kan inte faststllas via fretag och administration frn Paymaster';
      Text005@1100528410 : TextConst 'ENU=Journal Paymaster not attached to Navision GL Entry Journal Template for Company %1;SVE=Paymaster-journal r inte bifogad till journalmall fr Navision GL-transaktion fr fretag %1';

    PROCEDURE StripZero@1(VAR convtext@11012000 : Text[30];LenFld@1210190000 : Integer);
    VAR
      Position@11012001 : Integer;
    BEGIN
      Position := STRPOS(convtext,'0');
      WHILE Position = 1 DO BEGIN
        IF LenFld <> 0 THEN
          IF STRLEN(convtext) = LenFld THEN
            EXIT;
        convtext := DELSTR(convtext,Position,1);
        Position := STRPOS(convtext,'0');
      END;
    END;

    PROCEDURE DetermineCompany@1210190001();
    BEGIN
      CompRec.SETRANGE("Company Salary Application", Company);
      CompRec.SETRANGE(Administration, Administration);
      IF NOT CompRec.FIND('-') THEN
        ERROR(Text001);
    END;

    PROCEDURE FillEmptyTextWithZero@1100525013(VAR Text@1100525000 : Text[1024]);
    BEGIN
      IF DELCHR(Text,'<>=',' ') = '' THEN
        Text := '0';
    END;

    LOCAL PROCEDURE ShowStatus@1100409000(JournalTemplateName@1100409000 : Code[10];JournalBatchName@1100409001 : Code[10];LineNo@1100409002 : Integer);
    VAR
      GenJournalLine@1100409004 : Record 81;
      RecRef@1100409003 : RecordRef;
    BEGIN
      GenJournalLine."Journal Template Name" := JournalTemplateName;
      GenJournalLine."Journal Batch Name" := JournalBatchName;
      GenJournalLine."Line No." := LineNo;
      RecRef.GETTABLE(GenJournalLine);
      XMLportStatusDialogMgt.ShowImportStatus(RecRef);
    END;

    PROCEDURE InitXMLPort@1100529500(iEntryDesc@1100529503 : Text[30];iRemZero@1100529502 : 'All,Field Length';iMaxLenAcc@1100529501 : Integer;iMaxLenDep@1100529500 : Integer);
    BEGIN
      EntryDesc := iEntryDesc;
      RemZero := iRemZero;
      MaxLenAcc := iMaxLenAcc;
      MaxLenDep := iMaxLenDep;
    END;

    BEGIN
    END.
  }
}

