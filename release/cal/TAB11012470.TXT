OBJECT Table 11012470 Tender Paragraph by Principal
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Project No.,Contract No.,Principal,Principal Name;
    OnInsert=BEGIN
               IF "Contract No." <> '' THEN BEGIN
                 ExtensionContract.GET("Project No.", "Contract No.");
                 Revision := ExtensionContract.Revision;
                 //DP01488.sn
                 "Apply Perc. (Discount)" := ExtensionContract."Apply Perc. (Discount)";
                 "Apply Perc. (Surcharge)" := ExtensionContract."Apply Perc. (Surcharge)";
                 "Apply Perc. (Profit/Risk)" := ExtensionContract."Apply Perc. (Profit/Risk)";
                 "Apply Perc. (ExecutionCost)" := ExtensionContract."Apply Perc. (ExecutionCost)";
                 "Apply Perc. (ContractorFee)" := ExtensionContract."Apply Perc. (ContractorFee)";  //DP01490
                 //DP01488.en
                 IF "Settlement Type" = "Settlement Type"::" " THEN
                   "Settlement Type" := "Settlement Type"::Settling;  //DP01491a
                 IF "VAT Prod. Posting Group" = '' THEN
                   "VAT Prod. Posting Group" := ExtensionContract."VAT Prod. Posting Group";
               END ELSE BEGIN
                 ProjRec.GET("Project No.");
                 Revision := ProjRec.Revision;
                 //DP01488.sn
                 ProjectPrincipal.GET("Project No.", Principal);
                 "Apply Perc. (Discount)" := ProjectPrincipal."Apply Perc. (Discount)";
                 "Apply Perc. (Surcharge)" := ProjectPrincipal."Apply Perc. (Surcharge)";
                 "Apply Perc. (Profit/Risk)" := ProjectPrincipal."Apply Perc. (Profit/Risk)";
                 "Apply Perc. (ExecutionCost)" := ProjectPrincipal."Apply Perc. (ExecutionCost)";
                 "Apply Perc. (ContractorFee)" := ProjectPrincipal."Apply Perc. (ContractorFee)";  //DP01490
                 //DP01488.en
                 IF "VAT Prod. Posting Group" = '' THEN
                   "VAT Prod. Posting Group" := ProjectPrincipal."VAT Prod. Posting Group";
               END;
               SetCurrencyCode;  //DP00886
             END;

    OnModify=VAR
               TenderElementVATSpec@1100525001 : Record 11012476;
             BEGIN
               TenderElementVATSpec.SETRANGE("Project No.","Project No.");
               TenderElementVATSpec.SETRANGE(Principal,Principal);
               TenderElementVATSpec.SETRANGE("Contract No.","Contract No.");
               TenderElementVATSpec.SETRANGE("Tender Paragraph","No.");
               IF TenderElementVATSpec.FINDFIRST THEN
                 TenderElementVATSpec.CheckTotals();
             END;

    OnDelete=VAR
               lvTendElemTextRec@1100485000 : Record 11012475;
               lvVATSpecRec@1100525000 : Record 11012476;
               TenderParagPlanActivity@1100529400 : Record 11229303;
               TenderParagraphDistribution@1100529600 : Record 11012479;
             BEGIN
               lvTendElemTextRec.SETRANGE("Project No.", "Project No.");
               lvTendElemTextRec.SETRANGE(Principal, Principal);
               lvTendElemTextRec.SETRANGE("Contract No.", "Contract No.");
               lvTendElemTextRec.SETRANGE("Tender Paragraph", "No.");
               lvTendElemTextRec.DELETEALL;

               lvVATSpecRec.SETRANGE("Project No.", "Project No.");
               lvVATSpecRec.SETRANGE(Principal, Principal);
               lvVATSpecRec.SETRANGE("Contract No.", "Contract No.");
               lvVATSpecRec.SETRANGE("Tender Paragraph", "No.");
               lvVATSpecRec.DELETEALL;

               //**4PS.sn BI018 KD 07-10-16
               TenderParagPlanActivity.SETRANGE("Project No.","Project No.");
               TenderParagPlanActivity.SETRANGE(Principal,Principal);
               TenderParagPlanActivity.SETRANGE("Contract No.","Contract No.");
               TenderParagPlanActivity.SETRANGE("No.","No.");
               IF TenderParagPlanActivity.FINDSET THEN
                 TenderParagPlanActivity.DELETEALL;
               //**4PS.en BI018 KD 07-10-16

               TenderParagraphDistribution.SETRANGE("Project No.", "Project No.");
               TenderParagraphDistribution.SETRANGE(Principal, Principal);
               TenderParagraphDistribution.SETRANGE("Contract No.", "Contract No.");
               TenderParagraphDistribution.SETRANGE("Tender Paragraph", "No.");
               TenderParagraphDistribution.DELETEALL;
             END;

    OnRename=VAR
               TenderParagPlanActivity@1100529400 : Record 11229303;
               TenderParagPlanActivity2@1100529401 : Record 11229303;
             BEGIN
               //**4PS.sn BI018 KD 07-10-16
               TenderParagPlanActivity.SETRANGE("Project No.",xRec."Project No.");
               TenderParagPlanActivity.SETRANGE(Principal,xRec.Principal);
               TenderParagPlanActivity.SETRANGE("Contract No.",xRec."Contract No.");
               TenderParagPlanActivity.SETRANGE("No.",xRec."No.");
               IF TenderParagPlanActivity.FINDSET THEN BEGIN
                 REPEAT
                   IF NOT TenderParagPlanActivity2.GET("Project No.",Principal,"Contract No.","No.",TenderParagPlanActivity."Project Planning Activity No.") THEN BEGIN
                     TenderParagPlanActivity2 := TenderParagPlanActivity;
                     TenderParagPlanActivity2."Project No." := "Project No.";
                     TenderParagPlanActivity2.Principal := Principal;
                     TenderParagPlanActivity2."Contract No." := "Contract No.";
                     TenderParagPlanActivity2."No." := "No.";
                     TenderParagPlanActivity2.INSERT;
                   END;
                 UNTIL TenderParagPlanActivity.NEXT = 0;
                 TenderParagPlanActivity.DELETEALL;
               END;
               //**4PS.en BI018 KD 07-10-16
             END;

    CaptionML=[ENU=Tender Paragraph by Principal;
               NOR=Tilbudsavsnitt etter Oppdragsgiver;
               SVE=Anbudsstycke efter uppdragsgivare];
    LookupPageID=Page11012473;
    DrillDownPageID=Page11012473;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr];
                                                   NotBlank=Yes }
    { 20  ;   ;Principal           ;Code20        ;TableRelation="Project Principal".Principal WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Principal;
                                                              NOR=Oppdragsgiver;
                                                              SVE=Uppdragsgivare];
                                                   NotBlank=Yes }
    { 25  ;   ;Contract No.        ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Extension Contract No.;
                                                              NOR=ETA-nr;
                                                              SVE=ŽTA-nr] }
    { 35  ;   ;No.                 ;Text20        ;OnValidate=BEGIN
                                                                //DP01485.sn
                                                                IF ("No." <> xRec."No.") THEN BEGIN
                                                                  CheckSameNumber;
                                                                  GetSummaryCharges;  //DP01490
                                                                END;
                                                                //DP01485.en
                                                                IF ("No." <> xRec."No.") OR (Description = '') THEN BEGIN
                                                                  IF STRLEN("No.") <= MAXSTRLEN(TenderParagraph."Tender Paragraph") THEN BEGIN
                                                                    IF TenderParagraph.GET(TenderParagraph.Type::Job,"Project No.",'','',"No.") THEN
                                                                      Description := TenderParagraph.Description
                                                                    ELSE BEGIN
                                                                      IF TenderParagraph.GET(TenderParagraph.Type::Document,'','','',"No.") THEN
                                                                        Description := TenderParagraph.Description;
                                                                    END;
                                                                  END;
                                                                END;
                                                                IF IsRAWProject THEN
                                                                  CASE STRLEN("No.") OF
                                                                    1: Layout := Layout::Chapter;
                                                                    2: Layout := Layout::Paragraph;
                                                                    3: Layout := Layout::"Sub-Paragraph";
                                                                    4: Layout := Layout::"Sub-Sub-Paragraph";
                                                                    ELSE BEGIN
                                                                      Layout := Layout::Detail;
                                                                      CASE COPYSTR("No.", 1, 2) OF
                                                                        '91': Type := Type::OneTime;
                                                                        '92': Type := Type::Execution;
                                                                        '93': Type := Type::Surcharge;
                                                                        '94': Type := Type::Surcharge;
                                                                        '95': Type := Type::Estimate;
                                                                        '96': Type := Type::Contributions;
                                                                        '97', '98', '99': Type := Type::" ";
                                                                        ELSE
                                                                          Type := Type::Normal;
                                                                      END;
                                                                      //IF "No." = '918870' THEN
                                                                      //  Type := Type::Discount;  //DP01491a
                                                                      IF "No." = '919990' THEN
                                                                        ERROR(Text004, "No.", TABLECAPTION);
                                                                    END;
                                                                  END
                                                                ELSE
                                                                  Type := Type::Normal;

                                                                IF "Settle Excess" AND NOT ((Type = Type::" ") OR (Type = Type::Normal)) THEN
                                                                  VALIDATE("Settle Excess", FALSE);
                                                                IF CurrFieldNo <> 0 THEN
                                                                  VALIDATE(Type);  //don't do this validation during execution of xmlports, takes to much time
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph;
                                                              NOR=Tilbudsavsnitt;
                                                              SVE=Anbudsstycke];
                                                   NotBlank=Yes }
    { 40  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 50  ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                RAWValidateEURParagraphs(TRUE);

                                                                //negative Quantity gives problem in Installement Motivation
                                                                IF (Quantity < 0) THEN
                                                                  FIELDERROR(Quantity,Text003);

                                                                CalcRelatedFields(FIELDNO(Quantity));
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal] }
    { 60  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure";
                                                   OnValidate=BEGIN
                                                                RAWValidateEURParagraphs(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=Enhet;
                                                              SVE=M†ttenhet] }
    { 70  ;   ;Number of Points/Percentage;Decimal;OnValidate=BEGIN
                                                                CalcRelatedFields(FIELDNO("Number of Points/Percentage"));
                                                              END;

                                                   CaptionML=[ENU=Number of Points/Percentage;
                                                              NOR=Antall poeng/prosent;
                                                              SVE=Antal po„ng/procent] }
    { 80  ;   ;Unit Price (LCY)    ;Decimal       ;OnValidate=BEGIN
                                                                RAWValidateEURParagraphs(FALSE);
                                                                CalcRelatedFields(FIELDNO("Unit Price (LCY)"));

                                                                IF NOT SkipValidateFCY THEN
                                                                  "Unit Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Unit Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D);  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Unit Price (LCY);
                                                              NOR=A-pris (NOK);
                                                              SVE=A-pris (BVA)];
                                                   Description=DP00886;
                                                   AutoFormatType=2 }
    { 81  ;   ;Unit Price (FCY)    ;Decimal       ;OnValidate=BEGIN
                                                                //DP00886
                                                                RAWValidateEURParagraphs(TRUE);  //DP01488
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Unit Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Unit Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D));
                                                              END;

                                                   CaptionML=[ENU=Unit Price;
                                                              NOR=Enhetspris;
                                                              SVE=A-pris];
                                                   Description=DP00886;
                                                   AutoFormatType=2 }
    { 90  ;   ;Total Amount (LCY)  ;Decimal       ;OnValidate=BEGIN
                                                                CalcRelatedFields(FIELDNO("Total Amount (LCY)"));
                                                                RAWValidateEURParagraphs(FALSE);

                                                                IF NOT SkipValidateFCY THEN
                                                                  "Total Amount (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Total Amount (LCY)", FALSE, FALSE, "Currency Code", "Project No.", Principal, 0D);  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Total Amount (LCY);
                                                              NOR=Bel›p i alt (NOK);
                                                              SVE=Totalt belopp (BVA)];
                                                   Description=DP00886;
                                                   Editable=No }
    { 91  ;   ;Total Amount (FCY)  ;Decimal       ;OnValidate=BEGIN
                                                                //DP00886
                                                                RAWValidateEURParagraphs(TRUE);  //DP01488
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Total Amount (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Total Amount (FCY)", FALSE, FALSE, "Currency Code", "Project No.", Principal, 0D));
                                                              END;

                                                   CaptionML=[ENU=Total Amount;
                                                              NOR=Totalt bel›p;
                                                              SVE=Total Amount];
                                                   Description=DP00886;
                                                   Editable=No }
    { 95  ;   ;Element             ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                ElementFormat.FormatElem(Element,2,'');
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 100 ;   ;Total Points/Percentage;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Tender Paragraph by Principal"."Number of Points/Percentage" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                        Principal=FIELD(Principal),
                                                                                                                                        Contract No.=FIELD(Contract No.)));
                                                   CaptionML=[ENU=Total Points/Percentage;
                                                              NOR=Totalpoeng/prosent;
                                                              SVE=Totalpo„ng/procent];
                                                   Editable=No }
    { 110 ;   ;Contract Price (LCY);Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Principal"."Contract Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                                         Principal=FIELD(Principal)));
                                                   CaptionML=ENU=Contract Price (LCY);
                                                   Description=DP00886;
                                                   Editable=No }
    { 111 ;   ;Contract Price (FCY);Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Principal"."Contract Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                                   Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=Contract Price;
                                                              NOR=Kontraktpris;
                                                              SVE=Kontraktpris];
                                                   Description=DP00886;
                                                   Editable=No }
    { 120 ;   ;Total Tender Paragraphs (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Tender Paragraph by Principal"."Total Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                                               Principal=FIELD(Principal),
                                                                                                                               Contract No.=FIELD(Contract No.)));
                                                   CaptionML=ENU=Total Tender Paragraphs (LCY);
                                                   Description=DP00886;
                                                   Editable=No }
    { 121 ;   ;Total Tender Paragraphs (FCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Tender Paragraph by Principal"."Total Amount (FCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                                               Principal=FIELD(Principal),
                                                                                                                               Contract No.=FIELD(Contract No.)));
                                                   CaptionML=[ENU=Total Tender Paragraphs;
                                                              NOR=AMA-Koder totalt;
                                                              SVE=AMA koder totalt];
                                                   Description=DP00886;
                                                   Editable=No }
    { 130 ;   ;Total Quant.Points/Percentage;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Principal"."Number of Points" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Principal=FIELD(Principal)));
                                                   CaptionML=[ENU=Total Quantity Points/Percentage;
                                                              NOR=Totalt antall Poeng/Prosent;
                                                              SVE=Totalt antal po„ng/procent];
                                                   Editable=No }
    { 140 ;   ;Principal Name      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Principal)));
                                                   CaptionML=[ENU=Principal Name;
                                                              NOR=Oppdragsgivers navn;
                                                              SVE=Uppdragsgivarens namn];
                                                   Editable=No }
    { 150 ;   ;Ext. Contract Price (LCY);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Extension Contract"."Contract Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                                          Contract No.=FIELD(Contract No.)));
                                                   CaptionML=ENU=Extension Contract Price (LCY);
                                                   Description=DP00886;
                                                   Editable=No }
    { 151 ;   ;Ext. Contract Price (FCY);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Extension Contract"."Contract Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Contract No.=FIELD(Contract No.)));
                                                   CaptionML=ENU=Extension Contract Price;
                                                   Description=DP00886;
                                                   Editable=No }
    { 160 ;   ;Ext.Cont.Tot.Quant.Points/Perc;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Extension Contract"."Number of Points" WHERE (Project No.=FIELD(Project No.),
                                                                                                                     Contract No.=FIELD(Contract No.)));
                                                   CaptionML=[ENU=Total Quantity Points/Percentage Ext.;
                                                              NOR=Totalt antall poeng/prosent ETA.;
                                                              SVE=Totalt antal po„ng/procent ŽTA.];
                                                   Editable=No }
    { 170 ;   ;Revision            ;Boolean       ;CaptionML=[ENU=Revision;
                                                              NOR=Revisjon;
                                                              SVE=Revidering] }
    { 180 ;   ;Settlement Type     ;Option        ;OnValidate=BEGIN
                                                                //validate unit price to recalculate the settlement price
                                                                VALIDATE("Unit Price (LCY)");
                                                              END;

                                                   CaptionML=[ENU=Settlement Type;
                                                              NOR=Oppgj›rstype;
                                                              SVE=Avr„kningstyp];
                                                   OptionCaptionML=[ENU=" ,Non Settling,Settling,Approved,Reduction,Open";
                                                                    NOR=" ,Ingen avregning,Avregning,Godkjenn,Reduksjon,pen";
                                                                    SVE=" ,Ingen avr„kning,Avr„kning,Godk„nd,Reduktion,™ppen"];
                                                   OptionString=[ ,Non Settling,Settling,Approved,Reduction,Open] }
    { 190 ;   ;Text                ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Tender Paragraph Text" WHERE (Project No.=FIELD(Project No.),
                                                                                                    Principal=FIELD(Principal),
                                                                                                    Contract No.=FIELD(Contract No.),
                                                                                                    Tender Paragraph=FIELD(No.)));
                                                   CaptionML=[ENU=Text;
                                                              NOR=Tekst;
                                                              SVE=Ben„mning] }
    { 195 ;   ;Tender Paragraph Text;Text80       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Tender Paragraph Text".Text WHERE (Project No.=FIELD(Project No.),
                                                                                                          Principal=FIELD(Principal),
                                                                                                          Contract No.=FIELD(Contract No.),
                                                                                                          Tender Paragraph=FIELD(No.)));
                                                   CaptionML=[ENU=Tender Paragraph Text;
                                                              SVE=Anbudsstycketext];
                                                   Editable=No }
    { 200 ;   ;Settle Excess       ;Boolean       ;OnValidate=BEGIN
                                                                IF "Settle Excess" AND NOT ((Type = Type::" ") OR (Type = Type::Normal)) THEN
                                                                  ERROR(Text005, FIELDCAPTION("Settle Excess"), FIELDCAPTION(Type),  Type);

                                                                //validate unit price to recalculate the settlement price
                                                                VALIDATE("Unit Price (LCY)");
                                                              END;

                                                   CaptionML=[ENU=Settle Under-/Overrun;
                                                              NOR=Fastsett Under-/Overstyring;
                                                              SVE=Fastst„lla under-/”verk”rning] }
    { 210 ;   ;Settlement Price (LCY);Decimal     ;OnValidate=VAR
                                                                lvInstallmentMotLineRec@1100485000 : Record 11012472;
                                                                lvCURAW@1100485001 : Codeunit 11012164;
                                                              BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Settlement Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Settlement Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D);  //DP00886

                                                                //when Settlement Price change, recalculate production on installment motivation.
                                                                IF IsRAWProject THEN BEGIN
                                                                  IF ("Settlement Price (LCY)" <> xRec."Settlement Price (LCY)") AND
                                                                      (CurrFieldNo <> 0)THEN BEGIN //last condition is there because if "Settle Excess" is turned on from the
                                                                                                  //Installment Motivation the production should not be calculated
                                                                    MODIFY(TRUE); //C041137.n  Settlement Price (LCY) is used in flowfields op InstallmentMotlineRec
                                                                    //recalculate amounts with new price
                                                                    lvInstallmentMotLineRec.SETRANGE("Project No.", "Project No.");
                                                                    lvInstallmentMotLineRec.SETRANGE(Principal, Principal);
                                                                    lvInstallmentMotLineRec.SETRANGE("Extension Contract", "Contract No.");
                                                                    lvInstallmentMotLineRec.SETRANGE("Tender Paragraph No.", "No.");
                                                                    IF lvInstallmentMotLineRec.FINDFIRST THEN
                                                                      REPEAT
                                                                        lvInstallmentMotLineRec.CALCFIELDS("Settlement Price (LCY)", "Unit Price (LCY)", "Settle Excess");  //DP00886
                                                                        lvCURAW.CalculateProduction(Rec, lvInstallmentMotLineRec);
                                                                        lvInstallmentMotLineRec.MODIFY;
                                                                      UNTIL lvInstallmentMotLineRec.NEXT = 0;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Settlement Price (LCY);
                                                   Description=DP00886 }
    { 211 ;   ;Settlement Price (FCY);Decimal     ;OnValidate=BEGIN
                                                                //DP00886
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Settlement Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Settlement Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D));
                                                              END;

                                                   CaptionML=[ENU=Settlement Price;
                                                              NOR=Oppgj›rspris;
                                                              SVE=Avr„kningspris];
                                                   Description=DP00886 }
    { 220 ;   ;Type                ;Option        ;OnValidate=BEGIN
                                                                ProjectPrincipal.GET("Project No.", Principal);
                                                                IF NOT MODIFY THEN //first write, record will be read below
                                                                  //maybe not inserted yet
                                                                  EXIT;

                                                                CalcAKPerc();
                                                              END;

                                                   CaptionML=[ENU=Type;
                                                              NOR=Radtype;
                                                              SVE=Radtyp];
                                                   OptionCaptionML=ENU=" ,Normal,Surcharge,Estimate,One-time Costs,Contributions,Extra-Contract,Execution Costs,Discount";
                                                   OptionString=[ ,Normal,Surcharge,Estimate,OneTime,Contributions,Extra-Contract,Execution,Discount];
                                                   Editable=No }
    { 230 ;   ;Layout              ;Option        ;CaptionML=[ENU=Layout;
                                                              NOR=Utseende;
                                                              SVE=Layout];
                                                   OptionCaptionML=[ENU=Chapter,Paragraph,Sub-Paragraph,Sub-Sub-Paragraph,Detail;
                                                                    NOR=Kapittel,Avsnitt,Underavsnitt,Under-underavsnitt,Detaljer;
                                                                    SVE=Kapitel,Stycke,Understycke,Under-understycke,Detaljer];
                                                   OptionString=Chapter,Paragraph,Sub-Paragraph,Sub-Sub-Paragraph,Detail }
    { 240 ;   ;Finished            ;Boolean       ;OnValidate=VAR
                                                                lvTendElemRec@1100485001 : Record 11012470;
                                                                i@1100485000 : Integer;
                                                              BEGIN
                                                                IF Finished AND NOT ((Type = Type::" ") OR (Type = Type::Normal)) THEN
                                                                  ERROR(Text005, FIELDCAPTION(Finished), FIELDCAPTION(Type), Type);

                                                                IF IsRAWProject THEN BEGIN
                                                                  IF Finished AND (Layout = Layout::Detail) THEN BEGIN
                                                                    //if needed, also set accompanying headers to Finished
                                                                    //Check on all 4 levels
                                                                    FOR i := 4 DOWNTO 1 DO BEGIN
                                                                      lvTendElemRec.SETRANGE("Project No.", "Project No.");
                                                                      lvTendElemRec.SETRANGE(Principal, Principal);
                                                                      lvTendElemRec.SETFILTER("No.", '%1&<>%2', COPYSTR("No.",1,i) + '*', "No.");
                                                                      lvTendElemRec.SETRANGE(Finished, FALSE);
                                                                      lvTendElemRec.SETRANGE(Layout, Layout::Detail);
                                                                      IF NOT lvTendElemRec.FINDFIRST THEN BEGIN
                                                                        //on this level no entries anymore not ready, set headers also to finished
                                                                        lvTendElemRec.SETRANGE(Finished);
                                                                        lvTendElemRec.SETFILTER(Layout, '<>%1', Layout::Detail);
                                                                        lvTendElemRec.SETFILTER(Type, '%1|%2', Type::Normal, Type::" ");
                                                                        IF lvTendElemRec.FINDFIRST THEN BEGIN
                                                                          REPEAT
                                                                            lvTendElemRec.Finished := TRUE;
                                                                            lvTendElemRec.MODIFY;
                                                                          UNTIL lvTendElemRec.NEXT = 0;
                                                                        END;
                                                                      END ELSE BEGIN
                                                                        EXIT;
                                                                      END;
                                                                    END;
                                                                  END;

                                                                  IF (Layout <> Layout::Detail) THEN BEGIN
                                                                    IF CONFIRM(Text002, FALSE, "No.", Description, FIELDCAPTION(Finished), Finished) THEN BEGIN
                                                                      //set all below this header to Finished
                                                                      lvTendElemRec.SETRANGE("Project No.", "Project No.");
                                                                      lvTendElemRec.SETRANGE(Principal, Principal);
                                                                      lvTendElemRec.SETFILTER("No.", '%1&<>%2', "No." + '*', "No.");
                                                                      lvTendElemRec.SETFILTER(Type, '%1|%2', Type::Normal, Type::" ");
                                                                      IF lvTendElemRec.FINDFIRST THEN BEGIN
                                                                        REPEAT
                                                                          lvTendElemRec.Finished := Finished;
                                                                          lvTendElemRec.MODIFY;
                                                                        UNTIL lvTendElemRec.NEXT = 0;
                                                                      END;
                                                                    END;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Finished;
                                                              NOR=Ferdig;
                                                              SVE=Avslutad] }
    { 250 ;   ;Deviant Settlement Price;Boolean   ;CaptionML=[ENU=Deviant Settlement Price;
                                                              NOR=Avvikende oppgj›rspris;
                                                              SVE=Avvikande avr„kningspris] }
    { 260 ;   ;Basic Price Settl.Excess (LCY);Decimal;
                                                   OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN  //db, 15-02-18
                                                                  "Basic Price Settl.Excess (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Basic Price Settl.Excess (LCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D);

                                                                CalcRelatedFields(FIELDNO("Unit Price (LCY)"));  //db, 09-10-17
                                                              END;

                                                   CaptionML=ENU=Basic Price Settle Excess (LCY);
                                                   Description=DP01490;
                                                   AutoFormatType=2 }
    { 261 ;   ;Basic Price Settl.Excess (FCY);Decimal;
                                                   OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);  //db, 15-02-18
                                                                VALIDATE("Basic Price Settl.Excess (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Basic Price Settl.Excess (FCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D));
                                                              END;

                                                   CaptionML=ENU=Basic Price Settle Excess;
                                                   Description=DP01490;
                                                   AutoFormatType=2 }
    { 300 ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                VALIDATE("Unit Price (LCY)");  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod];
                                                   Description=DP00886;
                                                   Editable=No }
    { 305 ;   ;Approved            ;Boolean       ;CaptionML=[ENU=Approved;
                                                              NOR=Godkjent;
                                                              SVE=Godk„nd];
                                                   Description=DP01485 }
    { 310 ;   ;Apply Perc. (Discount);Boolean     ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckInputSummaryFields;
                                                              END;

                                                   CaptionML=ENU=Apply Percentage (Discount);
                                                   Description=DP01488 }
    { 320 ;   ;Apply Perc. (Surcharge);Boolean    ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckInputSummaryFields;
                                                              END;

                                                   CaptionML=ENU=Apply Percentage (Surcharge);
                                                   Description=DP01488 }
    { 321 ;   ;Apply Perc. (Profit/Risk);Boolean  ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckInputSummaryFields;
                                                              END;

                                                   CaptionML=ENU=Apply Percentage (Profit/Risk);
                                                   Description=DP01488 }
    { 322 ;   ;Apply Perc. (ExecutionCost);Boolean;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckInputSummaryFields;
                                                              END;

                                                   CaptionML=ENU=Apply Percentage (Execution Cost);
                                                   Description=DP01488 }
    { 323 ;   ;Apply Perc. (ContractorFee);Boolean;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckInputSummaryFields;
                                                              END;

                                                   CaptionML=ENU=Apply Percentage (Contractor Fee);
                                                   Description=DP01490 }
    { 330 ;   ;Percentage (Discount);Decimal      ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckElementExists(FIELDNO("Percentage (Discount)"), "Project No.", Principal, "Contract No.");
                                                                CheckInputSummaryFields;
                                                                IF "Percentage (Discount)" <> 0 THEN
                                                                  TESTFIELD("Apply Perc. (Discount)", TRUE);  //db, 30-10-2017
                                                              END;

                                                   CaptionML=ENU=Percentage (Discount);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01488 }
    { 340 ;   ;Percentage (Surcharge);Decimal     ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckElementExists(FIELDNO("Percentage (Surcharge)"), "Project No.", Principal, "Contract No.");
                                                                CheckInputSummaryFields;
                                                                IF "Percentage (Surcharge)" <> 0 THEN
                                                                  TESTFIELD("Apply Perc. (Surcharge)", TRUE);  //db, 30-10-2017
                                                              END;

                                                   CaptionML=[ENU=Percentage (Surcharge);
                                                              NOR=Prosent (Tilleggsgebyr);
                                                              SVE=Procent (till„ggsavgift)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01488 }
    { 341 ;   ;Percentage (Profit/Risk);Decimal   ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckElementExists(FIELDNO("Percentage (Profit/Risk)"), "Project No.", Principal, "Contract No.");
                                                                CheckInputSummaryFields;
                                                                IF "Percentage (Profit/Risk)" <> 0 THEN
                                                                  TESTFIELD("Apply Perc. (Profit/Risk)", TRUE);  //db, 30-10-2017
                                                              END;

                                                   CaptionML=[ENU=Percentage (Profit/Risk);
                                                              NOR=Prosent (Fortjeneste/risk);
                                                              SVE=Procent (vinst/risk)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01488 }
    { 342 ;   ;Percentage (ExecutionCost);Decimal ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckElementExists(FIELDNO("Percentage (ExecutionCost)"), "Project No.", Principal, "Contract No.");
                                                                CheckInputSummaryFields;
                                                                IF "Percentage (ExecutionCost)" <> 0 THEN
                                                                  TESTFIELD("Apply Perc. (ExecutionCost)", TRUE);  //db, 30-10-2017
                                                              END;

                                                   CaptionML=ENU=Percentage (Execution Cost);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01488 }
    { 343 ;   ;Percentage (ContractorFee);Decimal ;OnValidate=BEGIN
                                                                //DP01488
                                                                CheckElementExists(FIELDNO("Percentage (ContractorFee)"), "Project No.", Principal, "Contract No.");
                                                                CheckInputSummaryFields;
                                                                IF "Percentage (ContractorFee)" <> 0 THEN
                                                                  TESTFIELD("Apply Perc. (ContractorFee)", TRUE);  //db, 30-10-2017
                                                                IF CurrFieldNo = FIELDNO("Percentage (ContractorFee)") THEN
                                                                  CalcSettlementPrice;  //C055159
                                                              END;

                                                   CaptionML=ENU=Percentage (Contractor Fee);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01490 }
    { 400 ;   ;VAT Prod. Posting Group;Code20     ;TableRelation="VAT Product Posting Group";
                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Moms produktbokf›ringsmal;
                                                              SVE=Moms produktbokf”ringsmall] }
  }
  KEYS
  {
    {    ;Project No.,Principal,Contract No.,No.  ;SumIndexFields=Total Amount (LCY),Number of Points/Percentage;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Project No.,Principal,Contract No.,Type ;SumIndexFields=Total Amount (LCY) }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ProjSetup@1210190002 : Record 315;
      TenderParagraph@1210190000 : Record 11012072;
      ProjectPrincipal@1210190001 : Record 11012005;
      Text000@1210190004 : TextConst 'ENU=is not filled;NOR=er ikke fylt ut;SVE=„r inte ifylld';
      ProjRec@1100485002 : Record 11072003;
      ExtensionContract@1100485003 : Record 11012004;
      ElementFormat@1100485000 : Codeunit 11012022;
      Text001@1100485004 : TextConst 'ENU=Standard Tender Paragraphs,Project Tender Paragraphs;NOR=Standardtilbudsavsnitt,Prosjekttilbudsavsnitt;SVE=Standardanbudsstycken,Projektanbudsstycken';
      Text002@1100485005 : TextConst 'ENU=Do you want to set the value of %3 to %4 of al Tender Paragraphs under %1 (%2)?;NOR=Vil du stille inn Verdien %3 til %4 for alle tilbudsavsnitt under %1 (%2)?;SVE=Vill du st„lla in v„rdet %3 till %4 f”r alla anbudsstycken under %1 (%2)?';
      gRAWCU@1100525000 : Codeunit 11012164;
      Text003@1100525001 : TextConst 'ENU=must be positive.;NOR=m† v‘re positiv.;SVE=m†ste vara positivt.';
      Text004@1100525002 : TextConst 'ENU=Paragraph %1 is a subtotal and is not allowed in %2.;NOR=Avsnitt %1 er en subtotal og er ikke tillatt i %2.;SVE=Stycke %1 „r en subtotal och „r inte till†tet i %2.';
      Text005@1100525003 : TextConst 'ENU=You cannot put lines on %1 if %2 is %3.;NOR=Du kan ikke sette rader p† %1 om %2 er %3.;SVE=Du kan inte s„tta rader p† %1 om %2 „r %3.';
      Text006@1100525004 : TextConst 'ENU="Note: Tender elements with %1 ''%2'' present but %3 not filled yet for %4 ''%5-%6'' "';
      SkipValidateFCY@1100525005 : Boolean;
      ProjectCurrencyExchangeRate@1100525006 : Record 11020628;
      Text022@1100528900 : TextConst 'ENU=cannot be set because Tender Paragraph %1 does not exist';
      Text028@1100529400 : TextConst 'ENU=Replace existed Planning Activity lines with the selected?';
      Text029@1100529401 : TextConst 'ENU=Delete %1 records in %2 table';
      Text099@1100525007 : TextConst 'ENU=already exist';

    PROCEDURE CalcRelatedFields@1210190003(IFieldNo@1210190000 : Integer);
    BEGIN
      ProjectPrincipal.GET("Project No.", Principal);
      IF "Contract No." = '' THEN BEGIN
        IF ProjectPrincipal."Installm.Motivation Method" = ProjectPrincipal."Installm.Motivation Method"::" " THEN
          ProjectPrincipal.FIELDERROR("Installm.Motivation Method",Text000);
        IF ProjectPrincipal."Installm.Motivation Method" <> ProjectPrincipal."Installm.Motivation Method"::"Element Quantity" THEN  //db, 05-10-17
          ProjectPrincipal.TESTFIELD("Contract Amount (LCY)");
      END ELSE BEGIN
        ExtensionContract.GET("Project No.", "Contract No.");
        IF ExtensionContract."Installm.Motivation Method" = ExtensionContract."Installm.Motivation Method"::" " THEN
          ExtensionContract.FIELDERROR("Installm.Motivation Method",Text000);
        IF ExtensionContract."Installm.Motivation Method" <> ExtensionContract."Installm.Motivation Method"::"Element Quantity" THEN  //db, 05-10-17
          ExtensionContract.TESTFIELD("Contract Amount (LCY)");
      END;

      CASE IFieldNo OF
        FIELDNO(Quantity):
          BEGIN
            IF (Quantity <> 0) AND ("Total Amount (LCY)" <> 0) AND ("Unit Price (LCY)" = 0) AND
               (
                (("Contract No." = '') AND
                 (
                  (ProjectPrincipal."Installm.Motivation Method" = ProjectPrincipal."Installm.Motivation Method"::Points) OR
                  (ProjectPrincipal."Installm.Motivation Method" = ProjectPrincipal."Installm.Motivation Method"::Percentages)
                 )
                ) OR
                (("Contract No." <> '') AND
                 (
                  (ExtensionContract."Installm.Motivation Method" = ExtensionContract."Installm.Motivation Method"::Points) OR
                  (ExtensionContract."Installm.Motivation Method" = ExtensionContract."Installm.Motivation Method"::Percentages)
                 )
                )
               ) THEN
              CalcUnitPrice()
            ELSE BEGIN
              CalcTotalAmount1();
              CalcPointsPercentage();
            END;
          END;
        FIELDNO("Unit Price (LCY)"):
          BEGIN
            CalcTotalAmount1();
            CalcPointsPercentage();
            CalcSettlementPrice();
          END;
        FIELDNO("Total Amount (LCY)"):
          BEGIN
            CalcUnitPrice();
            CalcPointsPercentage();
            CalcRaisePerc(TRUE, ProjectPrincipal."Fictitious Amount Open (LCY)");  //C001959.c (Parameters added)
            CalcAKPerc();
          END;
        FIELDNO("Number of Points/Percentage"):
          BEGIN
            CalcTotalAmount2();
            CalcUnitPrice();
          END;
      END;
    END;

    PROCEDURE CalcUnitPrice@1210190000();
    BEGIN
      IF Quantity <> 0 THEN
        "Unit Price (LCY)" := ROUND("Total Amount (LCY)" / Quantity)
      ELSE
        "Unit Price (LCY)" := 0;
      "Unit Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Unit Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D);  //DP00886
    END;

    PROCEDURE CalcTotalAmount1@1210190001();
    VAR
      ChargePercentage@1100528900 : Decimal;
      SummaryFactor@1100528901 : Decimal;
    BEGIN
      IF "Contract No." = '' THEN BEGIN
        CASE ProjectPrincipal."Installm.Motivation Method" OF
          ProjectPrincipal."Installm.Motivation Method"::Points,
          ProjectPrincipal."Installm.Motivation Method"::Percentages:
            BEGIN
              IF Quantity = 0 THEN
                "Unit Price (LCY)" := 0;
              IF (Quantity <> 0) AND ("Unit Price (LCY)" <> 0) THEN
                "Total Amount (LCY)" := ROUND(Quantity * "Unit Price (LCY)");
            END;
          ProjectPrincipal."Installm.Motivation Method"::"Element Quantity":
            "Total Amount (LCY)" := ROUND(Quantity * "Unit Price (LCY)");
        END;
      END ELSE BEGIN
        //DP01490.sn
        ChargePercentage := "Percentage (Surcharge)" + "Percentage (Profit/Risk)" + "Percentage (ExecutionCost)" +
          "Percentage (ContractorFee)" - "Percentage (Discount)";
        SummaryFactor := (100 + ChargePercentage)/100;
        //DP01490.en
        CASE ExtensionContract."Installm.Motivation Method" OF
          ExtensionContract."Installm.Motivation Method"::Points,
          ExtensionContract."Installm.Motivation Method"::Percentages:
            BEGIN
              IF Quantity = 0 THEN
                "Unit Price (LCY)" := 0;
              IF (Quantity <> 0) AND ("Unit Price (LCY)" <> 0) THEN
                "Total Amount (LCY)" := ROUND(Quantity * "Unit Price (LCY)" * SummaryFactor);  //DP01490
            END;
          ExtensionContract."Installm.Motivation Method"::"Element Quantity":
            "Total Amount (LCY)" := ROUND(Quantity * "Unit Price (LCY)" * SummaryFactor);  //DP01490
        END;
      END;
      IF "Unit Price (LCY)" = 0 THEN "Unit Price (FCY)" := 0;  //DP00886
      "Total Amount (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Total Amount (LCY)", FALSE, FALSE, "Currency Code", "Project No.", Principal, 0D);  //DP00886
      CalcRaisePerc(TRUE, ProjectPrincipal."Fictitious Amount Open (LCY)");  //C001959.c (Parameters added)
      CalcAKPerc();
      CalcPlanningActivityLines;  //UKR-C21179
    END;

    PROCEDURE CalcTotalAmount2@1210190002();
    BEGIN
      IF "Contract No." = '' THEN BEGIN
        CASE ProjectPrincipal."Installm.Motivation Method" OF
          ProjectPrincipal."Installm.Motivation Method"::Points:
            BEGIN
              ProjectPrincipal.TESTFIELD("Number of Points");
              "Total Amount (LCY)" :=
                  ROUND(("Number of Points/Percentage" / ProjectPrincipal."Number of Points") * ProjectPrincipal."Contract Amount (LCY)");
            END;
          ProjectPrincipal."Installm.Motivation Method"::Percentages:
            "Total Amount (LCY)" := ROUND(("Number of Points/Percentage" / 100) * ProjectPrincipal."Contract Amount (LCY)");
        END;
      END ELSE BEGIN
        CASE ExtensionContract."Installm.Motivation Method" OF
          ExtensionContract."Installm.Motivation Method"::Points:
            BEGIN
              ExtensionContract.TESTFIELD("Number of Points");
              "Total Amount (LCY)" :=
                  ROUND(("Number of Points/Percentage" / ExtensionContract."Number of Points") * ExtensionContract."Contract Amount (LCY)");
            END;
          ExtensionContract."Installm.Motivation Method"::Percentages:
            "Total Amount (LCY)" := ROUND(("Number of Points/Percentage" / 100) * ExtensionContract."Contract Amount (LCY)");
        END;
      END;
      "Total Amount (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Total Amount (LCY)", FALSE, TRUE, "Currency Code", "Project No.", Principal, 0D);  //DP00886
      CalcRaisePerc(TRUE, ProjectPrincipal."Fictitious Amount Open (LCY)");  //C001959.c (Parameters added)
      CalcAKPerc();
      CalcPlanningActivityLines;  //UKR-C21179
    END;

    PROCEDURE CalcPointsPercentage@1210190004();
    BEGIN
      IF "Contract No." = '' THEN BEGIN
        CASE ProjectPrincipal."Installm.Motivation Method" OF
          ProjectPrincipal."Installm.Motivation Method"::Points:
            BEGIN
              ProjectPrincipal.TESTFIELD("Contract Amount (LCY)");
              "Number of Points/Percentage" :=
                  ROUND(("Total Amount (LCY)" / ProjectPrincipal."Contract Amount (LCY)") * ProjectPrincipal."Number of Points");
            END;
          ProjectPrincipal."Installm.Motivation Method"::Percentages:
            BEGIN
              ProjectPrincipal.TESTFIELD("Contract Amount (LCY)");
              "Number of Points/Percentage" := ROUND(("Total Amount (LCY)" / ProjectPrincipal."Contract Amount (LCY)") * 100);
            END;
        END;
      END ELSE BEGIN
        CASE ExtensionContract."Installm.Motivation Method" OF
          ExtensionContract."Installm.Motivation Method"::Points:
            BEGIN
              ExtensionContract.TESTFIELD("Contract Amount (LCY)");
              "Number of Points/Percentage" :=
                  ROUND(("Total Amount (LCY)" / ExtensionContract."Contract Amount (LCY)") * ExtensionContract."Number of Points");
            END;
          ExtensionContract."Installm.Motivation Method"::Percentages:
            BEGIN
              ExtensionContract.TESTFIELD("Contract Amount (LCY)");
              "Number of Points/Percentage" := ROUND(("Total Amount (LCY)" / ExtensionContract."Contract Amount (LCY)") * 100);
            END;
        END;
      END;
    END;

    PROCEDURE CalcSettlementPrice@1100485001();
    VAR
      ProjectPrincipal@1100485000 : Record 11012005;
      BasicPrice@1100525000 : Decimal;
    BEGIN
      IF NOT IsRAWProject THEN
        EXIT;

      //Attention: same calculation exists in CU RAW Calculations (function CalculateSettlementPrices)
      IF "Deviant Settlement Price" THEN
        //do not update manually changed settlement price
        EXIT;

      SkipValidateFCY := FALSE;  //C055159: update Settlement Price (FCY)
      IF (("Settlement Type" = "Settlement Type"::Settling) OR
          (("Settlement Type" = "Settlement Type"::"Non Settling") AND "Settle Excess")) THEN BEGIN
        IF ProjectPrincipal.GET("Project No.", Principal) THEN BEGIN
          IF "Basic Price Settl.Excess (LCY)" <> 0 THEN
            VALIDATE("Settlement Price (LCY)","Basic Price Settl.Excess (LCY)")
          ELSE BEGIN
            IF "Basic Price Settl.Excess (LCY)" <> 0 THEN
              BasicPrice := "Basic Price Settl.Excess (LCY)"
            ELSE
              BasicPrice := "Unit Price (LCY)";
            VALIDATE("Settlement Price (LCY)", ROUND(BasicPrice * (GetRaisePerc/100 + 1), 0.01));
          END;
        END;
      END ELSE BEGIN
        IF ("Settlement Type" = "Settlement Type"::Open) THEN BEGIN
          VALIDATE("Settlement Price (LCY)", "Unit Price (LCY)");
        END ELSE BEGIN
          VALIDATE("Settlement Price (LCY)", 0);
        END;
      END;
    END;

    PROCEDURE CalcRaisePerc@1100485002(WithUpdate@1100525000 : Boolean;FictAmt@1100525001 : Decimal) : Decimal;
    VAR
      lvTenderElemRec@1100485000 : Record 11012470;
      lvTotalAmountSurcharge@1100485001 : Decimal;
      lvTotalAmount@1100485003 : Decimal;
      lvRaisePerc@1210190000 : Decimal;
    BEGIN
      //Pre: ProjectPrincipal already current
      //Update "Raise % Settlement Price", should be equal to percentage of
      //profit and risk part of total. RAW Standard 01.03.03 sub 01

      IF NOT IsRAWProject THEN
        EXIT;

      //first write, record will be read below and in lvProjectPrincipal.VALIDATE("Raise % Settlement Price", updated
      IF NOT MODIFY THEN
        //is maybe not inserted yet
        EXIT;
      lvTotalAmountSurcharge := 0;
      lvTotalAmount := 0;
      //mg.sc, 01-09-11: M28896
      lvTenderElemRec.SETCURRENTKEY("Project No.", Principal, "Contract No.", Type);
      lvTenderElemRec.SETRANGE("Project No.", "Project No.");
      lvTenderElemRec.SETRANGE(Principal, Principal);
      lvTenderElemRec.SETFILTER("Contract No.", '%1', '');  //DP01490: RaisePerc based on original amount for project without extension
      lvTenderElemRec.SETFILTER(Type, '%1', lvTenderElemRec.Type::Surcharge);
      lvTenderElemRec.CALCSUMS("Total Amount (LCY)");
      lvTotalAmountSurcharge := lvTenderElemRec."Total Amount (LCY)";
      //mg.ec, 01-09-11: M28896

      lvTenderElemRec.SETFILTER(Type, '%1', lvTenderElemRec.Type::Normal);
      //mg.sc, 01-09-11: M28896
      lvTenderElemRec.CALCSUMS("Total Amount (LCY)");
      lvTotalAmount := lvTenderElemRec."Total Amount (LCY)";
      IF "Contract No." = '' THEN  //C001959.n
        lvTotalAmount := lvTotalAmount + FictAmt;  //C001959.n
      IF (lvTotalAmount <> 0) THEN BEGIN
        lvRaisePerc := ROUND(100 * lvTotalAmountSurcharge/lvTotalAmount, 0.1);
        //DP01491a.sn
        IF WithUpdate THEN BEGIN
          ProjectPrincipal."Calc. Raise % Settlement Price" := lvRaisePerc;
          IF ProjectPrincipal."Fixed Raise %" = FALSE THEN BEGIN
          //ProjectPrincipal."Contractor Fee" := lvRaisePerc; //C041137.o
            IF ProjectPrincipal."Act. Raise % Settlement Price" <> lvRaisePerc THEN
              ProjectPrincipal.VALIDATE("Act. Raise % Settlement Price", lvRaisePerc);
          END;
          ProjectPrincipal.MODIFY;
        END;
        //DP01491a.en
      END;
      //mg.ec, 01-09-11: M28896

      EXIT(lvRaisePerc);  //C001959.n
    END;

    PROCEDURE CalcAKPerc@1100525000();
    BEGIN
      //Pre: - record is already written in database (in 2 cases in CalcRaisPerc)
      //     - ProjectPrincipal already current

      IF NOT IsRAWProject THEN
        EXIT;

      gRAWCU.CalculateAKPerc("Project No.", Principal,ProjectPrincipal."Surcharge %");
      ProjectPrincipal.MODIFY;
    END;

    PROCEDURE LookupTenderParagraph@1100485000();
    VAR
      lvParRec@1100485004 : Record 11012072;
      lvProjParRec@1100485003 : Record 11012072;
      lvParFrm@1100485002 : Page 11012132;
      lvProjParFrm@1100485001 : Page 11020346;
      lvProjLevel@1100485000 : Boolean;
    BEGIN
      lvProjLevel := FALSE;
      lvProjParRec.SETRANGE(Type, lvProjParRec.Type::Job);
      lvProjParRec.SETRANGE("No.", "Project No.");
      IF lvProjParRec.FINDFIRST THEN BEGIN
        CASE STRMENU(Text001, 2) OF
          0: EXIT;
          2: lvProjLevel := TRUE;
        END;
      END;

      lvParRec.Type := lvParRec.Type::Document;
      lvParRec."No." := '';
      lvParRec."Purchase Action" := '';
      lvParRec."Document No." := '';
      IF STRLEN("No.") <= MAXSTRLEN(TenderParagraph."Tender Paragraph") THEN
        lvParRec."Tender Paragraph" := "No.";
      IF NOT lvProjLevel THEN BEGIN
        lvParFrm.SETRECORD(lvParRec);
        lvParFrm.LOOKUPMODE(TRUE);
        IF lvParFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          lvParFrm.GETRECORD(lvParRec);
          VALIDATE("No.",lvParRec."Tender Paragraph");
        END;
      END ELSE BEGIN
        lvParRec.SETRANGE("No.", "Project No.");
        lvProjParFrm.SETTABLEVIEW(lvParRec);
        lvParRec.Type := lvParRec.Type::Job;
        lvParRec."No." := "Project No.";
        lvProjParFrm.SETRECORD(lvParRec);
        lvProjParFrm.LOOKUPMODE(TRUE);
        IF lvProjParFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          lvProjParFrm.GETRECORD(lvParRec);
          VALIDATE("No.",lvParRec."Tender Paragraph");
        END;
      END;
    END;

    PROCEDURE RAWValidateEURParagraphs@1100525001(ApplyLCY@1100528900 : Boolean);
    VAR
      lvDummyDec@1100525000 : Decimal;
      UnitPrice@1100528901 : Decimal;
    BEGIN
      //db, 30-05-17: check on EUR dependent on calling field (LCY/FCY) (DP01488)
      IF ApplyLCY THEN
        UnitPrice := "Unit Price (LCY)"
      ELSE
        UnitPrice := "Unit Price (FCY)";

      IF IsRAWProject THEN BEGIN
        IF ("Unit of Measure" = EUR()) THEN BEGIN
          IF (Quantity = 1) THEN BEGIN
            IF UnitPrice >= 0 THEN  BEGIN
              //1 EUR 20   -> 20 EUR 1
              //1 EUR 0    -> 0  EUR 1
              lvDummyDec := Quantity;
              Quantity := UnitPrice;
              UnitPrice := lvDummyDec;
            END ELSE BEGIN;
              //1 EUR -20   -> 20 EUR -1
              lvDummyDec := Quantity;
              Quantity := -1 * UnitPrice;
              UnitPrice := -1 * lvDummyDec;
            END;
          END;
          IF (Quantity < 0)  THEN BEGIN
            //-1 EUR 20   -> 20 EUR -1
            //-300 EUR 1 -> 300 EUR 1
            Quantity := -1 * Quantity;
            UnitPrice := -1 * UnitPrice;
          END;
        END;
      END;

      IF ApplyLCY THEN
        "Unit Price (LCY)" := UnitPrice
      ELSE
        "Unit Price (FCY)" := UnitPrice;
    END;

    PROCEDURE EUR@1100525002() : Code[10];
    BEGIN
      //In RAW the euro paragraphs have a special meaning. Therefore this code must be checked
      EXIT('EUR');
    END;

    PROCEDURE FillDefaultSettleExcess@1210190005();
    BEGIN
      //C-026862.n
      IF ("Project No." <> '') AND NOT IsRAWProject THEN
        EXIT;

      ProjSetup.GET;
      "Settle Excess" := ProjSetup."Def. Settle Excess(Tender Par)";
    END;

    PROCEDURE CheckFictAmtFilledForOpen@1100525003();
    VAR
      ProjPrin@1100525001 : Record 11012005;
      TenderElem@1100525000 : Record 11012470;
    BEGIN
      //C001959
      IF ProjPrin.GET("Project No.", Principal) THEN BEGIN
        IF ProjPrin."Fictitious Amount Open (LCY)" = 0 THEN BEGIN
          TenderElem.SETRANGE("Project No.", "Project No.");
          TenderElem.SETRANGE(Principal, Principal);
          TenderElem.SETRANGE("Settlement Type", TenderElem."Settlement Type"::Open);
          IF TenderElem.FINDFIRST THEN
            MESSAGE(Text006,
              TenderElem.FIELDCAPTION("Settlement Type"), TenderElem."Settlement Type",
              ProjPrin.FIELDCAPTION("Fictitious Amount Open (LCY)"), ProjPrin.TABLECAPTION, "Project No.", Principal);
        END;
      END;
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      //DP00886
      SkipValidateFCY := ISkipValidateFCY;
    END;

    LOCAL PROCEDURE SetCurrencyCode@1100525004();
    VAR
      ProjectPrincipal@1100525000 : Record 11012005;
      Job@1100525001 : Record 11072003;
    BEGIN
      //DP00886
      IF ProjectPrincipal.GET("Project No.", Principal) THEN BEGIN
        "Currency Code" := ProjectPrincipal."Currency Code";
      END ELSE BEGIN
        Job.GET("Project No.");
        "Currency Code" := Job."Currency Code";
      END;
    END;

    LOCAL PROCEDURE CalcPlanningActivityLines@1100525013();
    VAR
      TenderParagrPlanActivityRec@1100525001 : Record 11229303;
    BEGIN
      //UKR-C21179 (BI018)
      TenderParagrPlanActivityRec.SETRANGE("Project No.","Project No.");
      TenderParagrPlanActivityRec.SETRANGE(Principal,Principal);
      TenderParagrPlanActivityRec.SETRANGE("Contract No.","Contract No.");
      TenderParagrPlanActivityRec.SETRANGE("No.","No.");
      IF TenderParagrPlanActivityRec.ISEMPTY THEN
        EXIT;

      TenderParagrPlanActivityRec.FINDSET;
      REPEAT
        TenderParagrPlanActivityRec.Amount := ROUND("Total Amount (LCY)" * TenderParagrPlanActivityRec.Percentage / 100);
        TenderParagrPlanActivityRec.Quantity := ROUND(Quantity * TenderParagrPlanActivityRec.Percentage / 100);
        TenderParagrPlanActivityRec.MODIFY;
      UNTIL TenderParagrPlanActivityRec.NEXT=0;
    END;

    PROCEDURE GetTenderParPlanningActivitiesForDisplay@1100528604(VAR pTenderParPlaningActivityNo@1100529400 : Code[30];VAR pTenderParPlaningActivityDesc@1100529401 : Text[50]);
    VAR
      TenderParagPlanActivity@1100525000 : Record 11229303;
      NoOfLines@1100525001 : Integer;
    BEGIN
      //UKR-C21179 (BI018)
      CLEAR(pTenderParPlaningActivityNo);
      CLEAR(pTenderParPlaningActivityDesc);
      TenderParagPlanActivity.SETRANGE("Project No.","Project No.");
      TenderParagPlanActivity.SETRANGE(Principal,Principal);
      TenderParagPlanActivity.SETRANGE("Contract No.","Contract No.");
      TenderParagPlanActivity.SETRANGE("No.","No.");
      IF TenderParagPlanActivity.ISEMPTY THEN BEGIN
        EXIT;
      END;

      NoOfLines := TenderParagPlanActivity.COUNT;
      IF NoOfLines = 1 THEN BEGIN
        TenderParagPlanActivity.FINDFIRST;
        pTenderParPlaningActivityNo := TenderParagPlanActivity."Project Planning Activity No.";
        TenderParagPlanActivity.CALCFIELDS("Project Plan. Act. Description");
        pTenderParPlaningActivityDesc := TenderParagPlanActivity."Project Plan. Act. Description";
      END ELSE BEGIN
        pTenderParPlaningActivityNo := STRSUBSTNO('[%1]',NoOfLines);
      END;
    END;

    PROCEDURE ReplaceTenderParPlanningActivities@1100529400(VAR pProjectPlanningActivity@1100529400 : Record 11012431) : Boolean;
    VAR
      TenderParagPlanActivity@1100529402 : Record 11229303;
      NoOfLines@1100529401 : Integer;
    BEGIN
      //UKR-C21179 (BI018)
      IF NOT pProjectPlanningActivity.FINDSET THEN
        EXIT(FALSE);

      TenderParagPlanActivity.SETRANGE("Project No.","Project No.");
      TenderParagPlanActivity.SETRANGE(Principal,Principal);
      TenderParagPlanActivity.SETRANGE("Contract No.","Contract No.");
      TenderParagPlanActivity.SETRANGE("No.","No.");
      NoOfLines := TenderParagPlanActivity.COUNT;
      IF NoOfLines > 0 THEN BEGIN
        IF NoOfLines > 1 THEN
          IF NOT CONFIRM(Text028) THEN
            EXIT(FALSE);
        TenderParagPlanActivity.DELETEALL;
      END;

      NoOfLines := pProjectPlanningActivity.COUNT;

      REPEAT
        TenderParagPlanActivity.INIT;
        TenderParagPlanActivity.VALIDATE("Project No.","Project No.");
        TenderParagPlanActivity.VALIDATE(Principal,Principal);
        TenderParagPlanActivity.VALIDATE("Contract No.","Contract No.");
        TenderParagPlanActivity.VALIDATE("No.","No.");
        TenderParagPlanActivity.VALIDATE("Project Planning Activity No.",pProjectPlanningActivity."No.");
        IF NoOfLines = 1 THEN
          TenderParagPlanActivity.VALIDATE(Percentage, 100);
        TenderParagPlanActivity.INSERT;
      UNTIL pProjectPlanningActivity.NEXT = 0;
      EXIT(TRUE);
    END;

    PROCEDURE TenderParPlanningActivityNoOnLookup@1100529402(VAR pProjectPlanningActivity@1100529402 : Record 11012431) : Boolean;
    VAR
      ProjectPlanningActivityList@1100529404 : Page 11072312;
      ProjectPlanningActivity@1100529403 : Record 11012431;
    BEGIN
      //C21179 (BI018)
      CLEAR(pProjectPlanningActivity);
      ProjectPlanningActivity.FILTERGROUP(2);
      ProjectPlanningActivity.SETRANGE("Project No.","Project No.");
      ProjectPlanningActivity.FILTERGROUP(0);
      ProjectPlanningActivityList.EDITABLE(FALSE);
      ProjectPlanningActivityList.LOOKUPMODE(TRUE);
      ProjectPlanningActivityList.SETTABLEVIEW(ProjectPlanningActivity);
      IF ProjectPlanningActivityList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        ProjectPlanningActivityList.SETSELECTIONFILTER(ProjectPlanningActivity);
        pProjectPlanningActivity.COPY(ProjectPlanningActivity);
        EXIT(TRUE);
      END;
    END;

    PROCEDURE TenderParPlanningActivityNoOnValidate@1100529403(TenderParPlaningActivityNo@1100529401 : Code[30]);
    VAR
      TenderParagPlanActivity@1100529400 : Record 11229303;
      ProjectPlanningActivity@1100529402 : Record 11012431;
      PrevTenderParPlaningActivityNo@1100529403 : Code[30];
      PrevTenderParPlaningActivityDesc@1100529404 : Text[50];
      NoOfLines@1100529405 : Integer;
    BEGIN
      //C21179 (BI018)
      GetTenderParPlanningActivitiesForDisplay(PrevTenderParPlaningActivityNo,PrevTenderParPlaningActivityDesc);
      IF PrevTenderParPlaningActivityNo = TenderParPlaningActivityNo THEN
          EXIT;
      IF (PrevTenderParPlaningActivityNo <> '') AND (TenderParPlaningActivityNo = '') THEN BEGIN
        TenderParagPlanActivity.SETRANGE("Project No.","Project No.");
        TenderParagPlanActivity.SETRANGE(Principal,Principal);
        TenderParagPlanActivity.SETRANGE("Contract No.","Contract No.");
        TenderParagPlanActivity.SETRANGE("No.","No.");
        NoOfLines := TenderParagPlanActivity.COUNT;
        IF NoOfLines = 0 THEN
          EXIT;
        IF NoOfLines > 1 THEN
          IF NOT CONFIRM(STRSUBSTNO(Text029,NoOfLines,TenderParagPlanActivity.TABLECAPTION)) THEN
            EXIT;
        TenderParagPlanActivity.DELETEALL;
        EXIT;
      END;
      IF NOT ProjectPlanningActivity.GET(TenderParPlaningActivityNo) THEN
        ERROR('');
      ProjectPlanningActivity.SETRECFILTER;
      ReplaceTenderParPlanningActivities(ProjectPlanningActivity);
    END;

    PROCEDURE TenderParPlanningActivityNoOnAssistEdit@1100529404();
    VAR
      TenderParagPlanActivity@1100529401 : Record 11229303;
      TenderParagPlanActivities@1100529400 : Page 11229493;
    BEGIN
      //C21179 (BI018)
      TenderParagPlanActivity.FILTERGROUP(2);
      TenderParagPlanActivity.SETRANGE("Project No.","Project No.");
      TenderParagPlanActivity.SETRANGE(Principal,Principal);
      TenderParagPlanActivity.SETRANGE("Contract No.","Contract No.");
      TenderParagPlanActivity.SETRANGE("No.","No.");
      TenderParagPlanActivity.FILTERGROUP(0);

      TenderParagPlanActivity.SETRANGE("Project No.","Project No.");
      TenderParagPlanActivity.SETRANGE(Principal,Principal);
      TenderParagPlanActivity.SETRANGE("Contract No.","Contract No.");
      TenderParagPlanActivity.SETRANGE("No.","No.");

      TenderParagPlanActivities.SETTABLEVIEW(TenderParagPlanActivity);
      TenderParagPlanActivities.SetCheckAmountOnClose(TRUE);
      TenderParagPlanActivities.RUNMODAL;
    END;

    LOCAL PROCEDURE CheckSameNumber@1100525005();
    VAR
      TenderParagraphbyPrincipal@1100525000 : Record 11012470;
    BEGIN
      //DP01485
      TenderParagraphbyPrincipal.SETRANGE("Project No.", "Project No.");
      TenderParagraphbyPrincipal.SETRANGE(Principal, Principal);
      TenderParagraphbyPrincipal.SETRANGE("Contract No.", "Contract No.");
      TenderParagraphbyPrincipal.SETRANGE("No.", "No.");
      IF TenderParagraphbyPrincipal.FINDFIRST THEN
        TenderParagraphbyPrincipal.FIELDERROR("No.", Text099);
      IF "No." < '9' THEN BEGIN
        //paragraph for extension should not exist on project (unless for summary)
        TenderParagraphbyPrincipal.SETRANGE("Contract No.");
        IF TenderParagraphbyPrincipal.FINDFIRST THEN
          TenderParagraphbyPrincipal.FIELDERROR("No.", Text099);
      END;
    END;

    PROCEDURE RecalculateSummaryCost@1100528900(ProjectNo@1100528905 : Code[20];CustomerNo@1100528906 : Code[20];ContractNo@1100528907 : Code[20]);
    VAR
      EstimateRAWSetup@1100528904 : Record 11125673;
      ProjectPrincipal@1100528902 : Record 11012005;
      ExtensionContract@1100528903 : Record 11012004;
      TenderParagraphbyPrincipal@1100528900 : Record 11012470;
      AmountDiscount@1100528914 : Decimal;
      AmountSurcharge@1100528915 : Decimal;
      AmountProfitRisk@1100528916 : Decimal;
      AmountExecutionCost@1100528917 : Decimal;
      PercentageDiscount@1100528913 : Decimal;
      PercentageSurcharge@1100528910 : Decimal;
      PercentageProfitRisk@1100528911 : Decimal;
      PercentageExecutionCost@1100528912 : Decimal;
      PercentageContractorFee@1100525000 : Decimal;
      BaseAmountDiscount@1100528919 : Decimal;
      BaseAmountSurcharge@1100528918 : Decimal;
      BaseAmountProfitRisk@1100528909 : Decimal;
      BaseAmountExecutionCost@1100528908 : Decimal;
      DetailedAmount@1100528920 : Boolean;
    BEGIN
      //DP01488
      IF NOT IsRAWProject THEN EXIT;  //C049782

      IF ContractNo <> '' THEN BEGIN
        ExtensionContract.GET(ProjectNo, ContractNo);
        IF ExtensionContract."Summary Cost (RAW)" = ExtensionContract."Summary Cost (RAW)"::Amount THEN
          EXIT;
        DetailedAmount := (ExtensionContract."Summary Cost (RAW)" = ExtensionContract."Summary Cost (RAW)"::"Percentage (Detail)");
        PercentageDiscount := ExtensionContract."Percentage (Discount)";
        PercentageSurcharge := ExtensionContract."Percentage (Surcharge)";
        PercentageProfitRisk := ExtensionContract."Percentage (Profit/Risk)";
        PercentageExecutionCost := ExtensionContract."Percentage (ExecutionCost)";
        PercentageContractorFee := ExtensionContract."Percentage (ContractorFee)";  //DP01490
      END ELSE BEGIN
        ProjectPrincipal.GET(ProjectNo, CustomerNo);
        IF ProjectPrincipal."Summary Cost (RAW)" = ProjectPrincipal."Summary Cost (RAW)"::Amount THEN
          EXIT;
        DetailedAmount := (ProjectPrincipal."Summary Cost (RAW)" = ProjectPrincipal."Summary Cost (RAW)"::"Percentage (Detail)");
        PercentageDiscount := ProjectPrincipal."Percentage (Discount)";
        PercentageSurcharge := ProjectPrincipal."Percentage (Surcharge)";
        PercentageProfitRisk := ProjectPrincipal."Percentage (Profit/Risk)";
        PercentageExecutionCost := ProjectPrincipal."Percentage (ExecutionCost)";
        PercentageContractorFee := ProjectPrincipal."Percentage (ContractorFee)";  //DP01490
      END;

      //C049782: licence-check
      IF EstimateRAWSetup.GET THEN BEGIN
        EstimateRAWSetup.TESTFIELD("Paragraph No.(Discount)");
        EstimateRAWSetup.TESTFIELD("Paragraph No.(GeneralCost)");
        EstimateRAWSetup.TESTFIELD("Paragraph No.(Profit/Risk)");
        EstimateRAWSetup.TESTFIELD("Paragraph No.(ExecutionCost)");
      END ELSE
        EXIT;

      TenderParagraphbyPrincipal.SETRANGE("Project No.", ProjectNo);
      TenderParagraphbyPrincipal.SETRANGE(Principal, CustomerNo);
      IF ContractNo <> '' THEN BEGIN
        TenderParagraphbyPrincipal.SETRANGE("Contract No.", ContractNo);
        //TenderParagraphbyPrincipal.SETRANGE(Approved, TRUE);  //DP01485+1490
      END ELSE BEGIN
        TenderParagraphbyPrincipal.SETFILTER("Contract No.", '%1', '');
      END;
      TenderParagraphbyPrincipal.SETFILTER("No.", '<%1', '9');
      IF TenderParagraphbyPrincipal.FINDSET THEN BEGIN
        REPEAT
          IF TenderParagraphbyPrincipal."Apply Perc. (Discount)" THEN BEGIN
            BaseAmountDiscount := BaseAmountDiscount + TenderParagraphbyPrincipal."Total Amount (FCY)";
            AmountDiscount := AmountDiscount + (TenderParagraphbyPrincipal."Total Amount (FCY)" * TenderParagraphbyPrincipal."Percentage (Discount)"/100);
          END;
          IF TenderParagraphbyPrincipal."Apply Perc. (Surcharge)" THEN BEGIN
            BaseAmountSurcharge := BaseAmountSurcharge + TenderParagraphbyPrincipal."Total Amount (FCY)";
            AmountSurcharge := AmountSurcharge + (TenderParagraphbyPrincipal."Total Amount (FCY)" * TenderParagraphbyPrincipal."Percentage (Surcharge)"/100);
          END;
          IF TenderParagraphbyPrincipal."Apply Perc. (Profit/Risk)" THEN BEGIN
            BaseAmountProfitRisk := BaseAmountProfitRisk + TenderParagraphbyPrincipal."Total Amount (FCY)";
            AmountProfitRisk := AmountProfitRisk + (TenderParagraphbyPrincipal."Total Amount (FCY)" * TenderParagraphbyPrincipal."Percentage (Profit/Risk)"/100);
          END;
          IF TenderParagraphbyPrincipal."Apply Perc. (ExecutionCost)" THEN BEGIN
            BaseAmountExecutionCost := BaseAmountExecutionCost + TenderParagraphbyPrincipal."Total Amount (FCY)";
            AmountExecutionCost := AmountExecutionCost + (TenderParagraphbyPrincipal."Total Amount (FCY)" * TenderParagraphbyPrincipal."Percentage (ExecutionCost)"/100);
          END;
          IF ContractNo <> '' THEN BEGIN
            TenderParagraphbyPrincipal.VALIDATE("Unit Price (FCY)");  //DP01490: recalculate amount including surcharge
            TenderParagraphbyPrincipal.MODIFY;
          END;
        UNTIL TenderParagraphbyPrincipal.NEXT = 0;
      END;
      IF (ContractNo <> '') THEN EXIT;  //DP01490: skip UpdateSummaryParagraph

      IF PercentageDiscount <> 0 THEN BEGIN
        IF DetailedAmount THEN BEGIN
          IF BaseAmountDiscount = 0 THEN
            PercentageDiscount := 0
          ELSE
            PercentageDiscount := (AmountDiscount / BaseAmountDiscount) * 100;
        END;
        UpdateSummaryParagrah(ProjectNo, CustomerNo, ContractNo,
          EstimateRAWSetup."Paragraph No.(Discount)", -1, AmountDiscount, PercentageDiscount, 1);
      END;

      IF PercentageSurcharge <> 0 THEN BEGIN
        IF DetailedAmount THEN BEGIN
          IF BaseAmountSurcharge = 0 THEN
            PercentageSurcharge := 0
          ELSE
            PercentageSurcharge := (AmountSurcharge / BaseAmountSurcharge) * 100;
        END;
        UpdateSummaryParagrah(ProjectNo, CustomerNo, ContractNo,
          EstimateRAWSetup."Paragraph No.(GeneralCost)", 1, AmountSurcharge, PercentageSurcharge, 2);
      END;

      IF PercentageProfitRisk <> 0 THEN BEGIN
        IF DetailedAmount THEN BEGIN
          IF BaseAmountProfitRisk = 0 THEN
            PercentageProfitRisk := 0
          ELSE
            PercentageProfitRisk := (AmountProfitRisk / BaseAmountProfitRisk) * 100;
        END;
        UpdateSummaryParagrah(ProjectNo, CustomerNo, ContractNo,
          EstimateRAWSetup."Paragraph No.(Profit/Risk)", 1, AmountProfitRisk, PercentageProfitRisk, 3);
      END;

      IF PercentageExecutionCost <> 0 THEN BEGIN
        IF DetailedAmount THEN BEGIN
          IF BaseAmountExecutionCost = 0 THEN
            PercentageExecutionCost := 0
          ELSE
            PercentageExecutionCost := (AmountExecutionCost / BaseAmountExecutionCost) * 100;
        END;
        UpdateSummaryParagrah(ProjectNo, CustomerNo, ContractNo,
          EstimateRAWSetup."Paragraph No.(ExecutionCost)", 1, AmountExecutionCost, PercentageExecutionCost, 4);
      END;
    END;

    LOCAL PROCEDURE UpdateSummaryParagrah@1100528901(ProjectNo@1100528902 : Code[20];CustomerNo@1100528901 : Code[20];ContractNo@1100528900 : Code[20];ParagraphNo@1100528903 : Code[20];iFactor@1100528906 : Decimal;iAmount@1100528907 : Decimal;iPercentage@1100528908 : Decimal;iSurchargeType@1100528905 : Integer);
    VAR
      TenderParagraphbyPrincipal@1100528904 : Record 11012470;
      TenderParagraphVATSpec@1100528909 : Record 11012476;
    BEGIN
      //DP01488
      TenderParagraphbyPrincipal.SETRANGE("Project No.", ProjectNo);
      TenderParagraphbyPrincipal.SETRANGE(Principal, CustomerNo);
      IF ContractNo <> '' THEN
        TenderParagraphbyPrincipal.SETRANGE("Contract No.", ContractNo)
      ELSE
        TenderParagraphbyPrincipal.SETFILTER("Contract No.", '%1', '');
      TenderParagraphbyPrincipal.SETRANGE("No.", ParagraphNo);
      IF NOT TenderParagraphbyPrincipal.FINDSET THEN EXIT;

      TenderParagraphbyPrincipal.VALIDATE("Total Amount (FCY)", (iAmount * iFactor));
      TenderParagraphbyPrincipal.Quantity := iFactor * TenderParagraphbyPrincipal."Total Amount (FCY)";
      TenderParagraphbyPrincipal.VALIDATE("Unit Price (FCY)", iFactor);
      TenderParagraphbyPrincipal."Unit of Measure" := EUR();
      CASE iSurchargeType OF
        1: TenderParagraphbyPrincipal."Percentage (Discount)" := iPercentage;
        2: TenderParagraphbyPrincipal."Percentage (Surcharge)" := iPercentage;
        3: TenderParagraphbyPrincipal."Percentage (Profit/Risk)" := iPercentage;
        4: TenderParagraphbyPrincipal."Percentage (ExecutionCost)" := iPercentage;
      END;
      TenderParagraphbyPrincipal.MODIFY;
      //
      TenderParagraphVATSpec.SETRANGE("Project No.", ProjectNo);
      TenderParagraphVATSpec.SETRANGE(Principal, CustomerNo);
      IF ContractNo <> '' THEN
        TenderParagraphVATSpec.SETRANGE("Contract No.", ContractNo)
      ELSE
        TenderParagraphVATSpec.SETFILTER("Contract No.", '%1', '');
      TenderParagraphVATSpec.SETRANGE("Tender Paragraph", ParagraphNo);
      IF TenderParagraphVATSpec.FINDFIRST THEN BEGIN
        TenderParagraphVATSpec.Amount := TenderParagraphbyPrincipal."Total Amount (FCY)";
        TenderParagraphVATSpec.MODIFY;
      END;
    END;

    PROCEDURE CheckElementExists@1100525012(CalledByFieldNo@1100525000 : Integer;ProjectNo@1100528902 : Code[20];CustomerNo@1100528901 : Code[20];ContractNo@1100528900 : Code[20]);
    VAR
      EstimateRAWSetup@1100525003 : Record 11125673;
      TenderParagraphbyPrincipal@1100525002 : Record 11012470;
    BEGIN
      //DP01488
      IF ContractNo <> '' THEN EXIT;  //DP01490: apply surcharge in Line Total for Extension Contract
      IF NOT IsRAWProject THEN EXIT;  //C049782

      //C049782: licence-check
      IF NOT EstimateRAWSetup.GET THEN
        EXIT;

      TenderParagraphbyPrincipal.SETRANGE("Project No.", ProjectNo);
      TenderParagraphbyPrincipal.SETRANGE(Principal, CustomerNo);
      TenderParagraphbyPrincipal.SETRANGE("Contract No.", ContractNo);

      CASE CalledByFieldNo OF
        Rec.FIELDNO("Percentage (Discount)"):
          BEGIN
            EstimateRAWSetup.TESTFIELD("Paragraph No.(Discount)");
            TenderParagraphbyPrincipal.SETRANGE("No.", EstimateRAWSetup."Paragraph No.(Discount)");
            IF TenderParagraphbyPrincipal.ISEMPTY THEN BEGIN
              TenderParagraphbyPrincipal."Project No." := ProjectNo;
              TenderParagraphbyPrincipal.Principal := CustomerNo;
              TenderParagraphbyPrincipal."Contract No." := ContractNo;
              TenderParagraphbyPrincipal."No." := EstimateRAWSetup."Paragraph No.(Discount)";
              TenderParagraphbyPrincipal.FIELDERROR("Percentage (Discount)", STRSUBSTNO(Text022, EstimateRAWSetup."Paragraph No.(Discount)"));
            END;
          END;
        Rec.FIELDNO("Percentage (Surcharge)"):
          BEGIN
            EstimateRAWSetup.TESTFIELD("Paragraph No.(GeneralCost)");
            TenderParagraphbyPrincipal.SETRANGE("No.", EstimateRAWSetup."Paragraph No.(GeneralCost)");
            IF TenderParagraphbyPrincipal.ISEMPTY THEN BEGIN
              TenderParagraphbyPrincipal."Project No." := ProjectNo;
              TenderParagraphbyPrincipal.Principal := CustomerNo;
              TenderParagraphbyPrincipal."Contract No." := ContractNo;
              TenderParagraphbyPrincipal."No." := EstimateRAWSetup."Paragraph No.(GeneralCost)";
              TenderParagraphbyPrincipal.FIELDERROR("Percentage (Surcharge)", STRSUBSTNO(Text022, EstimateRAWSetup."Paragraph No.(GeneralCost)"));
            END;
          END;
        Rec.FIELDNO("Percentage (Profit/Risk)"):
          BEGIN
            EstimateRAWSetup.TESTFIELD("Paragraph No.(Profit/Risk)");
            TenderParagraphbyPrincipal.SETRANGE("No.", EstimateRAWSetup."Paragraph No.(Profit/Risk)");
            IF TenderParagraphbyPrincipal.ISEMPTY THEN BEGIN
              TenderParagraphbyPrincipal."Project No." := ProjectNo;
              TenderParagraphbyPrincipal.Principal := CustomerNo;
              TenderParagraphbyPrincipal."Contract No." := ContractNo;
              TenderParagraphbyPrincipal."No." := EstimateRAWSetup."Paragraph No.(Profit/Risk)";
              TenderParagraphbyPrincipal.FIELDERROR("Percentage (Profit/Risk)", STRSUBSTNO(Text022, EstimateRAWSetup."Paragraph No.(Profit/Risk)"));
            END;
          END;
        Rec.FIELDNO("Percentage (ExecutionCost)"):
          BEGIN
            EstimateRAWSetup.TESTFIELD("Paragraph No.(ExecutionCost)");
            TenderParagraphbyPrincipal.SETRANGE("No.", EstimateRAWSetup."Paragraph No.(ExecutionCost)");
            IF TenderParagraphbyPrincipal.ISEMPTY THEN BEGIN
              TenderParagraphbyPrincipal."Project No." := ProjectNo;
              TenderParagraphbyPrincipal.Principal := CustomerNo;
              TenderParagraphbyPrincipal."Contract No." := ContractNo;
              TenderParagraphbyPrincipal."No." := EstimateRAWSetup."Paragraph No.(ExecutionCost)";
              TenderParagraphbyPrincipal.FIELDERROR("Percentage (ExecutionCost)", STRSUBSTNO(Text022, EstimateRAWSetup."Paragraph No.(ExecutionCost)"));
            END;
          END;
      END;
    END;

    PROCEDURE GenerateSummaryElements@1100528903(ProjectNo@1100528902 : Code[20];CustomerNo@1100528903 : Code[20];ContractNo@1100528904 : Code[20]);
    VAR
      EstimateRAWSetup@1100528901 : Record 11125673;
      TenderParagraphbyPrincipal@1100528900 : Record 11012470;
      ElementNo@1100528906 : Code[20];
      DescriptionTxt@1100528907 : Text[50];
      i@1100528905 : Integer;
    BEGIN
      //DP01488
      "Project No." := ProjectNo;  //C055159
      IF NOT IsRAWProject THEN EXIT;  //C049782
      //C049782: licence-check
      IF NOT EstimateRAWSetup.GET THEN
        EXIT;

      REPEAT
        i := i + 1;
        CASE i OF
          1: BEGIN
               ElementNo := EstimateRAWSetup."Paragraph No.(Discount)";
               DescriptionTxt := EstimateRAWSetup.GetCaptionElement(EstimateRAWSetup.FIELDNO("Paragraph No.(Discount)"));
             END;
          2: BEGIN
               ElementNo := EstimateRAWSetup."Paragraph No.(GeneralCost)";
               DescriptionTxt := EstimateRAWSetup.GetCaptionElement(EstimateRAWSetup.FIELDNO("Paragraph No.(GeneralCost)"));
             END;
          3: BEGIN
               ElementNo := EstimateRAWSetup."Paragraph No.(Profit/Risk)";
               DescriptionTxt := EstimateRAWSetup.GetCaptionElement(EstimateRAWSetup.FIELDNO("Paragraph No.(Profit/Risk)"));
             END;
          4: BEGIN
               ElementNo := EstimateRAWSetup."Paragraph No.(ExecutionCost)";
               DescriptionTxt := EstimateRAWSetup.GetCaptionElement(EstimateRAWSetup.FIELDNO("Paragraph No.(ExecutionCost)"));
             END;
        END;
        TenderParagraphbyPrincipal.SETRANGE("Project No.", ProjectNo);
        TenderParagraphbyPrincipal.SETRANGE(Principal, CustomerNo);
        TenderParagraphbyPrincipal.SETRANGE("Contract No.", ContractNo);
        TenderParagraphbyPrincipal.SETRANGE("No.", ElementNo);
        IF NOT TenderParagraphbyPrincipal.FINDFIRST THEN BEGIN
          TenderParagraphbyPrincipal."Project No." := ProjectNo;
          TenderParagraphbyPrincipal.Principal := CustomerNo;
          TenderParagraphbyPrincipal."Contract No." := ContractNo;
          TenderParagraphbyPrincipal.VALIDATE("No.", ElementNo);
          TenderParagraphbyPrincipal.Description := DescriptionTxt;
          TenderParagraphbyPrincipal."Unit of Measure" := EUR();
          TenderParagraphbyPrincipal.INSERT;
        END;
      UNTIL i > 4;
    END;

    LOCAL PROCEDURE CheckInputSummaryFields@1100528902();
    VAR
      EstimateRAWSetup@1100528900 : Record 11125673;
    BEGIN
      //DP01488
      IF NOT IsRAWProject THEN EXIT;  //C049782
      //C049782: licence-check
      IF NOT EstimateRAWSetup.GET THEN
        EXIT;
      IF ("No." = EstimateRAWSetup."Paragraph No.(Discount)") OR
         ("No." = EstimateRAWSetup."Paragraph No.(GeneralCost)") OR
         ("No." = EstimateRAWSetup."Paragraph No.(Profit/Risk)") OR
         ("No." = EstimateRAWSetup."Paragraph No.(ExecutionCost)") THEN BEGIN
        TESTFIELD("Apply Perc. (Discount)", FALSE);
        TESTFIELD("Apply Perc. (Surcharge)", FALSE);
        TESTFIELD("Apply Perc. (Profit/Risk)", FALSE);
        TESTFIELD("Apply Perc. (ExecutionCost)", FALSE);
        IF (CurrFieldNo = FIELDNO("Percentage (Discount)")) OR
           (CurrFieldNo = FIELDNO("Percentage (Surcharge)")) OR
           (CurrFieldNo = FIELDNO("Percentage (Profit/Risk)")) OR
           (CurrFieldNo = FIELDNO("Percentage (ExecutionCost)")) THEN BEGIN
          ERROR('');
        END;
      END ELSE BEGIN
        GetDefaultSummaryFields;
      END;
    END;

    LOCAL PROCEDURE GetDefaultSummaryFields@1100528906();
    VAR
      ExtensionContract@1100528901 : Record 11012004;
      ProjectPrincipal@1100528900 : Record 11012005;
    BEGIN
      //DP01488
      IF NOT IsRAWProject THEN EXIT;  //C049782
      IF "Contract No." <> '' THEN BEGIN
        ExtensionContract.GET("Project No.", "Contract No.");
        ExtensionContract.TESTFIELD("Summary Cost (RAW)", ExtensionContract."Summary Cost (RAW)"::"Percentage (Detail)");
        CASE CurrFieldNo OF
          FIELDNO("Apply Perc. (Discount)"):
            IF "Apply Perc. (Discount)" THEN
              "Percentage (Discount)" := ExtensionContract."Percentage (Discount)"
            ELSE
              "Percentage (Discount)" := 0;
          FIELDNO("Apply Perc. (Surcharge)"):
            IF "Apply Perc. (Surcharge)" THEN
              "Percentage (Surcharge)" := ExtensionContract."Percentage (Surcharge)"
            ELSE
              "Percentage (Surcharge)" := 0;
          FIELDNO("Apply Perc. (Profit/Risk)"):
            IF "Apply Perc. (Profit/Risk)" THEN
              "Percentage (Profit/Risk)" := ExtensionContract."Percentage (Profit/Risk)"
            ELSE
              "Percentage (Profit/Risk)" := 0;
          FIELDNO("Apply Perc. (ExecutionCost)"):
            IF "Apply Perc. (ExecutionCost)" THEN
              "Percentage (ExecutionCost)" := ExtensionContract."Percentage (ExecutionCost)"
            ELSE
              "Percentage (ExecutionCost)" := 0;
          FIELDNO("Apply Perc. (ContractorFee)"):  //DP01490
            IF "Apply Perc. (ContractorFee)" THEN
              "Percentage (ContractorFee)" := ExtensionContract."Percentage (ContractorFee)"
            ELSE
              "Percentage (ContractorFee)" := 0;
        END;
        VALIDATE("Unit Price (FCY)");  //DP01490: recalculate amount including surcharge
      END ELSE BEGIN
        ProjectPrincipal.GET("Project No.", Principal);
        ProjectPrincipal.TESTFIELD("Summary Cost (RAW)", ProjectPrincipal."Summary Cost (RAW)"::"Percentage (Detail)");
        CASE CurrFieldNo OF
          FIELDNO("Apply Perc. (Discount)"):
            IF "Apply Perc. (Discount)" THEN
              "Percentage (Discount)" := ProjectPrincipal."Percentage (Discount)"
            ELSE
              "Percentage (Discount)" := 0;
          FIELDNO("Apply Perc. (Surcharge)"):
            IF "Apply Perc. (Surcharge)" THEN
              "Percentage (Surcharge)" := ProjectPrincipal."Percentage (Surcharge)"
            ELSE
              "Percentage (Surcharge)" := 0;
          FIELDNO("Apply Perc. (Profit/Risk)"):
            IF "Apply Perc. (Profit/Risk)" THEN
              "Percentage (Profit/Risk)" := ProjectPrincipal."Percentage (Profit/Risk)"
            ELSE
              "Percentage (Profit/Risk)" := 0;
          FIELDNO("Apply Perc. (ExecutionCost)"):
            IF "Apply Perc. (ExecutionCost)" THEN
              "Percentage (ExecutionCost)" := ProjectPrincipal."Percentage (ExecutionCost)"
            ELSE
              "Percentage (ExecutionCost)" := 0;
          FIELDNO("Apply Perc. (ContractorFee)"):  //DP01490
            IF "Apply Perc. (ContractorFee)" THEN
              "Percentage (ContractorFee)" := ProjectPrincipal."Percentage (ContractorFee)"
            ELSE
              "Percentage (ContractorFee)" := 0;
        END;
      END;
    END;

    LOCAL PROCEDURE GetSummaryCharges@1100525006();
    VAR
      ExtensionContract@1100525000 : Record 11012004;
    BEGIN
      //DP01490
      IF ExtensionContract.GET("Project No.", "Contract No.") THEN BEGIN
        "Apply Perc. (Discount)" := ExtensionContract."Apply Perc. (Discount)";
        "Apply Perc. (Surcharge)" := ExtensionContract."Apply Perc. (Surcharge)";
        "Apply Perc. (Profit/Risk)" := ExtensionContract."Apply Perc. (Profit/Risk)";
        "Apply Perc. (ExecutionCost)" := ExtensionContract."Apply Perc. (ExecutionCost)";
        "Apply Perc. (ContractorFee)" := ExtensionContract."Apply Perc. (ContractorFee)";
        "Percentage (Discount)" := ExtensionContract."Percentage (Discount)";
        "Percentage (Surcharge)" := ExtensionContract."Percentage (Surcharge)";
        "Percentage (Profit/Risk)" := ExtensionContract."Percentage (Profit/Risk)";
        "Percentage (ExecutionCost)" := ExtensionContract."Percentage (ExecutionCost)";
        "Percentage (ContractorFee)" := ExtensionContract."Percentage (ContractorFee)";
      END;
    END;

    PROCEDURE GetRaisePerc@1100528500() RaisePerc : Decimal;
    BEGIN
      //C041137
      IF NOT ProjectPrincipal.GET("Project No.", Principal) THEN
        EXIT;
      IF COPYSTR("No.", 1, 2) = '95' THEN EXIT;  //DP01841

      IF "Contract No." <> '' THEN BEGIN
        ExtensionContract.GET("Project No.", "Contract No.");
        IF ExtensionContract."Summary Cost (RAW)" = ExtensionContract."Summary Cost (RAW)"::"Percentage (Detail)" THEN  //C055159
          RaisePerc := "Percentage (ContractorFee)"
        ELSE
          RaisePerc := ExtensionContract."Percentage (ContractorFee)";
        IF RaisePerc = 0 THEN
          RaisePerc := ProjectPrincipal."Contractor Fee";
      END ELSE BEGIN
        //RaisePerc := ProjectPrincipal."Percentage (ContractorFee)";  //C055159: for project apply ActualRaise%
      END;
      IF RaisePerc = 0 THEN
        RaisePerc := ProjectPrincipal."Act. Raise % Settlement Price";
    END;

    LOCAL PROCEDURE IsRAWProject@1100528501() : Boolean;
    BEGIN
      //C041137
      IF ProjRec.GET("Project No.") THEN
        EXIT(ProjRec.RAW);

      EXIT(FALSE);
    END;

    PROCEDURE CalcPointsPercentageForCurrentProjectPrincipal@1100527300(CurrentProjectPrincipal@1100527300 : Record 11012005);
    BEGIN
      SETRANGE("Project No.", CurrentProjectPrincipal."Project No.");
      SETRANGE(Principal, CurrentProjectPrincipal.Principal);
      SETRANGE("Contract No.", '');
      IF FINDSET THEN BEGIN
        ProjectPrincipal.COPY(CurrentProjectPrincipal);
        REPEAT
          CalcPointsPercentage;
          MODIFY;
        UNTIL NEXT = 0;
      END;
    END;

    PROCEDURE GenerateTenderParagraphsByScheme@1100528904(ProjectNo@1100528902 : Code[20];CustomerNo@1100528903 : Code[20];ContractNo@1100528904 : Code[20]);
    VAR
      ProjectPrincipal@1100528905 : Record 11012005;
      ExtensionContract@1100528906 : Record 11012004;
      TenderParagraphScheme@1100528901 : Record 11012477;
      TenderParagraphSchemeLine@1100525000 : Record 11012478;
      TenderParagraphbyPrincipal@1100525001 : Record 11012470;
      lvText000@1100525002 : TextConst 'ENU=Already Tender Paragraphs generated for Project Principal';
      lvText001@1100525003 : TextConst 'ENU=Tender Paragraph Scheme copied: %1 lines created';
      NumberOfPoints@1100528900 : Decimal;
      SchemeCode@1100528907 : Code[10];
      InvoiceMethod@1100528908 : ' ,Points,Percentages,Element Quantity';
      BaseQuantity@1100528909 : Decimal;
      UnitOfMeasure@1100528910 : Code[10];
      ContractAmount@1100528911 : Decimal;
      CurrencyCode@1100528912 : Code[10];
    BEGIN
      //C056215
      IF ContractNo = '' THEN BEGIN
        ProjectPrincipal.GET(ProjectNo, CustomerNo);
        ProjectPrincipal.TESTFIELD("Tender Paragraph Scheme");
        ProjectPrincipal.TESTFIELD("Quantity (Tender Paragraph)");
        SchemeCode := ProjectPrincipal."Tender Paragraph Scheme";
        InvoiceMethod := ProjectPrincipal."Installm.Motivation Method";
        NumberOfPoints := ProjectPrincipal."Number of Points";
        BaseQuantity := ProjectPrincipal."Quantity (Tender Paragraph)";
        UnitOfMeasure := ProjectPrincipal."Unit of Measure (Tender Par)";
        CurrencyCode := ProjectPrincipal."Currency Code";
        IF CurrencyCode <> '' THEN
          ContractAmount := ProjectPrincipal."Contract Amount"
        ELSE
          ContractAmount := ProjectPrincipal."Contract Amount (LCY)";
      END ELSE BEGIN
        ExtensionContract.GET(ProjectNo, ContractNo);
        //diekus (18/7): voorlopig niet uitgewerkt (velden ontbreken bij meerwerkcontract)
        ExtensionContract.TESTFIELD("Tender Paragraph Scheme");
        ExtensionContract.TESTFIELD("Quantity (Tender Paragraph)");
        SchemeCode := ExtensionContract."Tender Paragraph Scheme";
        InvoiceMethod := ExtensionContract."Installm.Motivation Method";
        NumberOfPoints := ExtensionContract."Number of Points";
        BaseQuantity := ExtensionContract."Quantity (Tender Paragraph)";
        UnitOfMeasure := ExtensionContract."Unit of Measure (Tender Par)";
        CurrencyCode := ExtensionContract."Currency Code";
        IF CurrencyCode <> '' THEN
          ContractAmount := ExtensionContract."Contract Amount"
        ELSE
          ContractAmount := ExtensionContract."Contract Amount (LCY)";
      END;

      IF InvoiceMethod = InvoiceMethod::"Element Quantity" THEN BEGIN
        TenderParagraphScheme.GET(SchemeCode);
        TenderParagraphScheme.CALCFIELDS("Number of Points/Percentage");
        NumberOfPoints := TenderParagraphScheme."Number of Points/Percentage";
      END;
      IF NumberOfPoints = 0 THEN EXIT;

      TenderParagraphbyPrincipal.SETRANGE("Project No.", ProjectNo);
      TenderParagraphbyPrincipal.SETRANGE(Principal, CustomerNo);
      TenderParagraphbyPrincipal.SETFILTER("Contract No.", ContractNo);
      IF TenderParagraphbyPrincipal.FINDFIRST THEN
        ERROR(lvText000);

      TenderParagraphSchemeLine.SETRANGE(Scheme, SchemeCode);
      IF TenderParagraphSchemeLine.FINDSET THEN BEGIN
        REPEAT
          TenderParagraphbyPrincipal."Project No." := ProjectNo;
          TenderParagraphbyPrincipal.Principal := CustomerNo;
          TenderParagraphbyPrincipal."Contract No." := ContractNo;
          TenderParagraphbyPrincipal.FillDefaultSettleExcess();
          TenderParagraphbyPrincipal.VALIDATE("No.", TenderParagraphSchemeLine."Tender Paragraph");
          TenderParagraphbyPrincipal.INSERT(TRUE);
          TenderParagraphbyPrincipal.Description := TenderParagraphSchemeLine.Description;
          TenderParagraphbyPrincipal.Quantity := BaseQuantity;
          TenderParagraphbyPrincipal."Unit of Measure" := UnitOfMeasure;
          IF InvoiceMethod <> InvoiceMethod::"Element Quantity" THEN
            TenderParagraphbyPrincipal."Number of Points/Percentage" := TenderParagraphSchemeLine."Number of Points/Percentage";
          IF CurrencyCode <> '' THEN BEGIN
            TenderParagraphbyPrincipal.VALIDATE("Total Amount (FCY)", ContractAmount * (TenderParagraphSchemeLine."Number of Points/Percentage" / NumberOfPoints));
            TenderParagraphbyPrincipal.VALIDATE("Unit Price (FCY)", TenderParagraphbyPrincipal."Total Amount (FCY)" / TenderParagraphbyPrincipal.Quantity);
          END ELSE BEGIN
            TenderParagraphbyPrincipal.VALIDATE("Total Amount (LCY)", ContractAmount * (TenderParagraphSchemeLine."Number of Points/Percentage" / NumberOfPoints));
            TenderParagraphbyPrincipal.VALIDATE("Unit Price (LCY)", TenderParagraphbyPrincipal."Total Amount (LCY)" / TenderParagraphbyPrincipal.Quantity);
          END;
          TenderParagraphbyPrincipal.MODIFY;
        UNTIL TenderParagraphSchemeLine.NEXT = 0;
      END;

      MESSAGE(lvText001, TenderParagraphSchemeLine.COUNT);
    END;

    BEGIN
    {
      db, 04-10-16: Field <Tender Paragraph OLD> removed
      4PS 27-07-2016 UKR-C21179 OTRO: Link 1 Tender Paragraph line to mult planning act (DP01144 BI018)
    }
    END.
  }
}

