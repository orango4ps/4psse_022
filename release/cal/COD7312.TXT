OBJECT Codeunit 7312 Create Pick
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVW114.04,4PS14.00;
  }
  PROPERTIES
  {
    Permissions=TableData 6550=rimd;
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      WhseActivHeader@1003 : Record 5766;
      TempWhseActivLine@1001 : TEMPORARY Record 5767;
      TempWhseItemTrackingLine@1033 : TEMPORARY Record 6550;
      TempTotalWhseItemTrackingLine@1036 : TEMPORARY Record 6550;
      SourceWhseItemTrackingLine@1047 : Record 6550;
      WhseShptLine@1016 : Record 7321;
      WhseInternalPickLine@1004 : Record 7334;
      ProdOrderCompLine@1028 : Record 5407;
      AssemblyLine@1055 : Record 901;
      WhseWkshLine@1006 : Record 7326;
      WhseSetup@1008 : Record 5769;
      Location@1000 : Record 14;
      WhseSetupLocation@1044 : Record 14;
      Item@1002 : Record 27;
      Bin@1020 : Record 7354;
      BinType@1026 : Record 7303;
      SKU@1019 : Record 5700;
      WhseMgt@1030 : Codeunit 5775;
      WhseAvailMgt@1053 : Codeunit 7314;
      ItemTrackingMgt@1017 : Codeunit 6500;
      UOMMgt@1054 : Codeunit 5402;
      WhseSource@1005 : 'Pick Worksheet,Shipment,Movement Worksheet,Internal Pick,Production,Assembly';
      SortPick@1011 : ' ,Item,Document,Shelf/Bin No.,Due Date,Ship-To,Bin Ranking,Action Type';
      WhseDocType@1024 : 'Put-away,Pick,Movement';
      SourceSubType@1041 : Option;
      SourceNo@1040 : Code[20];
      AssignedID@1010 : Code[50];
      ShippingAgentCode@1022 : Code[10];
      ShippingAgentServiceCode@1021 : Code[10];
      ShipmentMethodCode@1018 : Code[10];
      TransferRemQtyToPickBase@1200 : Decimal;
      TempNo@1007 : Integer;
      MaxNoOfLines@1015 : Integer;
      BreakbulkNo@1023 : Integer;
      TempLineNo@1029 : Integer;
      MaxNoOfSourceDoc@1014 : Integer;
      SourceType@1042 : Integer;
      SourceLineNo@1039 : Integer;
      SourceSubLineNo@1038 : Integer;
      LastWhseItemTrkgLineNo@1048 : Integer;
      WhseItemTrkgLineCount@1049 : Integer;
      PerZone@1013 : Boolean;
      Text000@1012 : TextConst 'ENU=Nothing to handle. %1.;NOR=Ingenting † h†ndtere. %1.;SVE=Inget att hantera. %1.';
      PerBin@1032 : Boolean;
      DoNotFillQtytoHandle@1025 : Boolean;
      BreakbulkFilter@1031 : Boolean;
      WhseItemTrkgExists@1034 : Boolean;
      SNRequired@1035 : Boolean;
      LNRequired@1027 : Boolean;
      CrossDock@1043 : Boolean;
      ReservationExists@1046 : Boolean;
      ReservedForItemLedgEntry@1045 : Boolean;
      CalledFromPickWksh@1009 : Boolean;
      CalledFromMoveWksh@1050 : Boolean;
      CalledFromWksh@1051 : Boolean;
      ReqFEFOPick@1052 : Boolean;
      HasExpiredItems@1037 : Boolean;
      CannotBeHandledReasons@1059 : ARRAY [20] OF Text;
      TotalQtyPickedBase@1056 : Decimal;
      BinIsNotForPickTxt@1057 : TextConst '@@@=%1: Field("Bin Code");ENU=The quantity to be picked is in bin %1, which is not set up for picking;NOR=Antallet som skal plukkes, er p† hylle %1, som ikke er konfigurert for plukking;SVE=Antalet att plocka ligger p† lagerplatsen %1, som inte „r inst„lld f”r plockning';
      BinIsForReceiveOrShipTxt@1058 : TextConst '@@@=%1: Field("Bin Code");ENU=The quantity to be picked is in bin %1, which is set up for receiving or shipping;NOR=Antallet som skal plukkes, er p† hylle %1, som er konfigurert for mottak eller levering;SVE=Antalet att plocka ligger p† lagerplatsen %1, som inte „r inst„lld f”r inleverans eller leverans';
      QtyReservedNotFromInventoryTxt@1060 : TextConst 'ENU=The quantity to be picked is not in inventory yet. You must first post the supply from which the source document is reserved;NOR=Antallet som skal plukkes, er enn† ikke p† lager. Du m† f›rst bokf›re forsyningen som kildedokumentet er reservert fra';

    [External]
    PROCEDURE CreateTempLine@29(LocationCode@1002 : Code[10];ItemNo@1003 : Code[20];VariantCode@1004 : Code[10];UnitofMeasureCode@1005 : Code[10];FromBinCode@1000 : Code[20];ToBinCode@1007 : Code[20];QtyPerUnitofMeasure@1010 : Decimal;VAR TotalQtytoPick@1001 : Decimal;VAR TotalQtytoPickBase@1000000000 : Decimal);
    VAR
      QtyToPick@1006 : Decimal;
      RemQtyToPick@1008 : Decimal;
      i@1012 : Integer;
      RemQtyToPickBase@1000000002 : Decimal;
      QtyToPickBase@1000000001 : Decimal;
      QtyToTrackBase@1009 : Decimal;
      QtyBaseMaxAvailToPick@1011 : Decimal;
      TotalItemTrackedQtyToPick@1013 : Decimal;
      TotalItemTrackedQtyToPickBase@1014 : Decimal;
      NewQtyToHandle@1015 : Decimal;
    BEGIN
      TotalQtyPickedBase := 0;
      GetLocation(LocationCode);

      IF Location."Directed Put-away and Pick" THEN
        QtyBaseMaxAvailToPick := // Total qty (excl. Receive bin content) that are not assigned to any activity/ order
          CalcTotalQtyOnBinType('',LocationCode,ItemNo,VariantCode) -
          CalcTotalQtyAssgndOnWhse(LocationCode,ItemNo,VariantCode) +
          CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::"Put-away",LocationCode,ItemNo,VariantCode) -
          CalcTotalQtyOnBinType(GetBinTypeFilter(0),LocationCode,ItemNo,VariantCode) // Receive area
      ELSE
        QtyBaseMaxAvailToPick :=
          CalcAvailableQty(ItemNo,VariantCode) -
          CalcPickQtyAssigned(LocationCode,ItemNo,VariantCode,UnitofMeasureCode,FromBinCode,TempWhseItemTrackingLine);

      CheckReservation(
        QtyBaseMaxAvailToPick,SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,Location."Always Create Pick Line",
        QtyPerUnitofMeasure,TotalQtytoPick,TotalQtytoPickBase);

      OnAfterCreateTempLineCheckReservation(
        LocationCode,ItemNo,VariantCode,UnitofMeasureCode,QtyPerUnitofMeasure,TotalQtytoPick,TotalQtytoPickBase,
        SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,LastWhseItemTrkgLineNo,TempWhseItemTrackingLine);

      RemQtyToPick := TotalQtytoPick;
      RemQtyToPickBase := TotalQtytoPickBase;
      ItemTrackingMgt.CheckWhseItemTrkgSetup(ItemNo,SNRequired,LNRequired,FALSE);

      ReqFEFOPick := FALSE;
      HasExpiredItems := FALSE;
      IF PickAccordingToFEFO(LocationCode) OR
         PickStrictExpirationPosting(ItemNo)
      THEN BEGIN
        QtyToTrackBase := RemQtyToPickBase;
        IF UndefinedItemTrkg(QtyToTrackBase) THEN BEGIN
          CreateTempItemTrkgLines(ItemNo,VariantCode,QtyToTrackBase,TRUE);
          CreateTempItemTrkgLines(ItemNo,VariantCode,TransferRemQtyToPickBase,FALSE);
        END;
      END;
      IF TotalQtytoPickBase <> 0 THEN BEGIN
        TempWhseItemTrackingLine.RESET;
        TempWhseItemTrackingLine.SETFILTER("Qty. to Handle",'<> 0');
        IF TempWhseItemTrackingLine.FIND('-') THEN BEGIN
          REPEAT
            IF TempWhseItemTrackingLine."Qty. to Handle (Base)" <> 0 THEN BEGIN
              IF TempWhseItemTrackingLine."Qty. to Handle (Base)" > RemQtyToPickBase THEN BEGIN
                TempWhseItemTrackingLine."Qty. to Handle (Base)" := RemQtyToPickBase;
                TempWhseItemTrackingLine.MODIFY;
              END;
              NewQtyToHandle :=
                ROUND(RemQtyToPick / RemQtyToPickBase * TempWhseItemTrackingLine."Qty. to Handle (Base)",UOMMgt.QtyRndPrecision);
              IF TempWhseItemTrackingLine."Qty. to Handle" <> NewQtyToHandle THEN BEGIN
                TempWhseItemTrackingLine."Qty. to Handle" := NewQtyToHandle;
                OnBeforeTempWhseItemTrackingLineModify(TempWhseItemTrackingLine);
                TempWhseItemTrackingLine.MODIFY;
              END;

              QtyToPick := TempWhseItemTrackingLine."Qty. to Handle";
              QtyToPickBase := TempWhseItemTrackingLine."Qty. to Handle (Base)";
              TotalItemTrackedQtyToPick += QtyToPick;
              TotalItemTrackedQtyToPickBase += QtyToPickBase;

              CreateTempLine2(
                LocationCode,ItemNo,VariantCode,UnitofMeasureCode,FromBinCode,ToBinCode,
                QtyPerUnitofMeasure,QtyToPick,TempWhseItemTrackingLine,QtyToPickBase);
              RemQtyToPickBase -= TempWhseItemTrackingLine."Qty. to Handle (Base)" - QtyToPickBase;
              RemQtyToPick -= TempWhseItemTrackingLine."Qty. to Handle" - QtyToPick;
            END;
          UNTIL (TempWhseItemTrackingLine.NEXT = 0) OR (RemQtyToPickBase <= 0);
          RemQtyToPick := Minimum(RemQtyToPick,TotalQtytoPick - TotalItemTrackedQtyToPick);
          RemQtyToPickBase := Minimum(RemQtyToPickBase,TotalQtytoPickBase - TotalItemTrackedQtyToPickBase);
          TotalQtytoPick := RemQtyToPick;
          TotalQtytoPickBase := RemQtyToPickBase;

          SaveTempItemTrkgLines;
          CLEAR(TempWhseItemTrackingLine);
          WhseItemTrkgExists := FALSE;
        END;
        IF TotalQtytoPickBase <> 0 THEN
          IF NOT HasExpiredItems THEN BEGIN
            IF SNRequired THEN BEGIN
              FOR i := 1 TO TotalQtytoPick DO BEGIN
                QtyToPick := 1;
                QtyToPickBase := 1;
                CreateTempLine2(LocationCode,ItemNo,VariantCode,UnitofMeasureCode,
                  FromBinCode,ToBinCode,QtyPerUnitofMeasure,QtyToPick,TempWhseItemTrackingLine,QtyToPickBase);
              END;
              TotalQtytoPick := 0;
              TotalQtytoPickBase := 0;
            END ELSE
              CreateTempLine2(LocationCode,ItemNo,VariantCode,UnitofMeasureCode,
                FromBinCode,ToBinCode,QtyPerUnitofMeasure,TotalQtytoPick,TempWhseItemTrackingLine,TotalQtytoPickBase);
          END;
      END;
    END;

    LOCAL PROCEDURE CreateTempLine2@21(LocationCode@1002 : Code[10];ItemNo@1003 : Code[20];VariantCode@1004 : Code[10];UnitofMeasureCode@1005 : Code[10];FromBinCode@1000 : Code[20];ToBinCode@1007 : Code[20];QtyPerUnitofMeasure@1010 : Decimal;VAR TotalQtytoPick@1001 : Decimal;VAR TempWhseItemTrackingLine@1006 : TEMPORARY Record 6550;VAR TotalQtytoPickBase@1000000000 : Decimal);
    VAR
      QtytoPick@1016 : Decimal;
      QtytoPickBase@1000000001 : Decimal;
      QtyAvailableBase@1008 : Decimal;
      IsHandled@1009 : Boolean;
    BEGIN
      GetLocation(LocationCode);
      IF Location."Bin Mandatory" THEN BEGIN
        IF NOT Location."Directed Put-away and Pick" THEN BEGIN
          QtyAvailableBase :=
            CalcAvailableQty(ItemNo,VariantCode) -
            CalcPickQtyAssigned(LocationCode,ItemNo,VariantCode,UnitofMeasureCode,'',TempWhseItemTrackingLine);

          IF QtyAvailableBase > 0 THEN BEGIN
            IF TotalQtytoPickBase > QtyAvailableBase THEN
              TotalQtytoPickBase := QtyAvailableBase;
            CalcBWPickBin(
              LocationCode,ItemNo,VariantCode,UnitofMeasureCode,
              QtyPerUnitofMeasure,TotalQtytoPick,TotalQtytoPickBase,TempWhseItemTrackingLine);
          END;
          EXIT;
        END;

        IsHandled := FALSE;
        OnCreateTempLine2OnBeforeDirectedPutAwayAndPick(
          LocationCode,ItemNo,VariantCode,UnitofMeasureCode,FromBinCode,ToBinCode,QtyPerUnitofMeasure,
          TotalQtytoPick,TotalQtytoPickBase,TempWhseItemTrackingLine,WhseSource,IsHandled);
        IF IsHandled THEN
          EXIT;

        IF (WhseSource = WhseSource::"Movement Worksheet") AND (FromBinCode <> '') THEN BEGIN
          InsertTempActivityLineFromMovWkshLine(
            LocationCode,ItemNo,VariantCode,FromBinCode,
            QtyPerUnitofMeasure,TotalQtytoPick,TempWhseItemTrackingLine,TotalQtytoPickBase);
          EXIT;
        END;

        IF (ReservationExists AND ReservedForItemLedgEntry) OR NOT ReservationExists THEN BEGIN
          IF Location."Use Cross-Docking" THEN
            CalcPickBin(
              LocationCode,ItemNo,VariantCode,UnitofMeasureCode,
              ToBinCode,QtyPerUnitofMeasure,
              TotalQtytoPick,TempWhseItemTrackingLine,TRUE,TotalQtytoPickBase);
          IF TotalQtytoPickBase > 0 THEN
            CalcPickBin(
              LocationCode,ItemNo,VariantCode,UnitofMeasureCode,
              ToBinCode,QtyPerUnitofMeasure,
              TotalQtytoPick,TempWhseItemTrackingLine,FALSE,TotalQtytoPickBase);
        END;
        IF (TotalQtytoPickBase > 0) AND Location."Always Create Pick Line" THEN BEGIN
          UpdateQuantitiesToPick(
            TotalQtytoPickBase,
            QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,
            QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,
            TotalQtytoPick,TotalQtytoPickBase);

          CreateTempActivityLine(
            LocationCode,'',UnitofMeasureCode,QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,1,0);
          CreateTempActivityLine(
            LocationCode,ToBinCode,UnitofMeasureCode,QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,2,0);
        END;
        EXIT;
      END;

      QtyAvailableBase :=
        CalcAvailableQty(ItemNo,VariantCode) -
        CalcPickQtyAssigned(LocationCode,ItemNo,VariantCode,UnitofMeasureCode,'',TempWhseItemTrackingLine);

      IF QtyAvailableBase > 0 THEN BEGIN
        UpdateQuantitiesToPick(
          QtyAvailableBase,
          QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,
          QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,
          TotalQtytoPick,TotalQtytoPickBase);

        CreateTempActivityLine(LocationCode,'',UnitofMeasureCode,QtyPerUnitofMeasure,QtytoPick,QtytoPickBase,0,0);
      END;
    END;

    LOCAL PROCEDURE InsertTempActivityLineFromMovWkshLine@19(LocationCode@1007 : Code[10];ItemNo@1006 : Code[20];VariantCode@1005 : Code[10];FromBinCode@1003 : Code[20];QtyPerUnitofMeasure@1001 : Decimal;VAR TotalQtytoPick@1000 : Decimal;VAR TempWhseItemTrackingLine@1012 : TEMPORARY Record 6550;VAR TotalQtyToPickBase@1000000000 : Decimal);
    VAR
      FromBinContent@1008 : Record 7302;
      FromItemUOM@1011 : Record 5404;
      FromQtyToPick@1017 : Decimal;
      FromQtyToPickBase@1016 : Decimal;
      ToQtyToPick@1015 : Decimal;
      ToQtyToPickBase@1014 : Decimal;
      QtyAvailableBase@1013 : Decimal;
    BEGIN
      QtyAvailableBase := TotalQtyToPickBase;

      IF WhseWkshLine."From Unit of Measure Code" <> WhseWkshLine."Unit of Measure Code" THEN BEGIN
        FromBinContent.GET(
          LocationCode,FromBinCode,ItemNo,VariantCode,WhseWkshLine."From Unit of Measure Code");
        FromBinContent.SetFilterOnUnitOfMeasure;
        FromBinContent.CALCFIELDS("Quantity (Base)","Pick Quantity (Base)","Negative Adjmt. Qty. (Base)");

        QtyAvailableBase :=
          FromBinContent."Quantity (Base)" - FromBinContent."Pick Quantity (Base)" -
          FromBinContent."Negative Adjmt. Qty. (Base)" -
          CalcPickQtyAssigned(
            LocationCode,ItemNo,VariantCode,
            WhseWkshLine."From Unit of Measure Code",
            WhseWkshLine."From Bin Code",TempWhseItemTrackingLine);

        FromItemUOM.GET(ItemNo,FromBinContent."Unit of Measure Code");

        BreakbulkNo := BreakbulkNo + 1;
      END;

      UpdateQuantitiesToPick(
        QtyAvailableBase,
        WhseWkshLine."Qty. per From Unit of Measure",FromQtyToPick,FromQtyToPickBase,
        QtyPerUnitofMeasure,ToQtyToPick,ToQtyToPickBase,
        TotalQtytoPick,TotalQtyToPickBase);

      CreateBreakBulkTempLines(
        WhseWkshLine."Location Code",
        WhseWkshLine."From Unit of Measure Code",
        WhseWkshLine."Unit of Measure Code",
        FromBinCode,
        WhseWkshLine."To Bin Code",
        WhseWkshLine."Qty. per From Unit of Measure",
        WhseWkshLine."Qty. per Unit of Measure",
        BreakbulkNo,
        ToQtyToPick,ToQtyToPickBase,FromQtyToPick,FromQtyToPickBase);

      TotalQtyToPickBase := 0;
      TotalQtytoPick := 0;
    END;

    LOCAL PROCEDURE CalcMaxQtytoPlace@33(VAR QtytoHandle@1001 : Decimal;QtyOutstanding@1003 : Decimal;VAR QtytoHandleBase@1000000000 : Decimal;QtyOutstandingBase@1000000001 : Decimal);
    VAR
      WhseActivLine2@1004 : Record 5767;
    BEGIN
      WhseActivLine2.COPY(TempWhseActivLine);
      WITH TempWhseActivLine DO BEGIN
        SETCURRENTKEY(
          "Whse. Document No.","Whse. Document Type","Activity Type","Whse. Document Line No.");
        SETRANGE("Whse. Document Type","Whse. Document Type");
        SETRANGE("Whse. Document No.","Whse. Document No.");
        SETRANGE("Activity Type","Activity Type");
        SETRANGE("Whse. Document Line No.","Whse. Document Line No.");
        SETRANGE("Source Type","Source Type");
        SETRANGE("Source Subtype","Source Subtype");
        SETRANGE("Source No.","Source No.");
        SETRANGE("Source Line No.","Source Line No.");
        SETRANGE("Source Subline No.","Source Subline No.");
        SETRANGE("Action Type","Action Type"::Place);
        SETRANGE("Breakbulk No.",0);
        IF FIND('-') THEN BEGIN
          CALCSUMS(Quantity);
          IF QtyOutstanding < Quantity + QtytoHandle THEN
            QtytoHandle := QtyOutstanding - Quantity;
          IF QtytoHandle < 0 THEN
            QtytoHandle := 0;
          CALCSUMS("Qty. (Base)");
          IF QtyOutstandingBase < "Qty. (Base)" + QtytoHandleBase THEN
            QtytoHandleBase := QtyOutstandingBase - "Qty. (Base)";
          IF QtytoHandleBase < 0 THEN
            QtytoHandleBase := 0;
        END;
      END;
      TempWhseActivLine.COPY(WhseActivLine2);
    END;

    LOCAL PROCEDURE CalcBWPickBin@36(LocationCode@1017 : Code[10];ItemNo@1016 : Code[20];VariantCode@1015 : Code[10];UnitofMeasureCode@1014 : Code[10];QtyPerUnitofMeasure@1012 : Decimal;VAR TotalQtyToPick@1000 : Decimal;VAR TotalQtytoPickBase@1010 : Decimal;VAR TempWhseItemTrackingLine@1009 : TEMPORARY Record 6550);
    VAR
      WhseSource2@1001 : Option;
      ToBinCode@1003 : Code[20];
      DefaultBin@1005 : Boolean;
      CrossDockBin@1004 : Boolean;
    BEGIN
      // Basic warehousing

      IF (WhseSource = WhseSource::Shipment) AND WhseShptLine."Assemble to Order" THEN
        WhseSource2 := WhseSource::Assembly
      ELSE
        WhseSource2 := WhseSource;

      IF TotalQtytoPickBase > 0 THEN
        CASE WhseSource2 OF
          WhseSource::"Pick Worksheet":
            ToBinCode := WhseWkshLine."To Bin Code";
          WhseSource::Shipment:
            ToBinCode := WhseShptLine."Bin Code";
          WhseSource::Production:
            ToBinCode := ProdOrderCompLine."Bin Code";
          WhseSource::Assembly:
            ToBinCode := AssemblyLine."Bin Code";
        END;

      FOR CrossDockBin := TRUE DOWNTO FALSE DO
        FOR DefaultBin := TRUE DOWNTO FALSE DO
          IF TotalQtytoPickBase > 0 THEN
            FindBWPickBin(
              LocationCode,ItemNo,VariantCode,
              ToBinCode,UnitofMeasureCode,QtyPerUnitofMeasure,DefaultBin,CrossDockBin,
              TotalQtyToPick,TotalQtytoPickBase,TempWhseItemTrackingLine);
    END;

    LOCAL PROCEDURE FindBWPickBin@38(LocationCode@1012 : Code[10];ItemNo@1011 : Code[20];VariantCode@1010 : Code[10];ToBinCode@1008 : Code[20];UnitofMeasureCode@1005 : Code[10];QtyPerUnitofMeasure@1013 : Decimal;DefaultBin@1000 : Boolean;CrossDockBin@1014 : Boolean;VAR TotalQtyToPick@1007 : Decimal;VAR TotalQtyToPickBase@1006 : Decimal;VAR TempWhseItemTrackingLine@1004 : TEMPORARY Record 6550);
    VAR
      FromBinContent@1002 : Record 7302;
      QtyAvailableBase@1015 : Decimal;
      QtyToPickBase@1001 : Decimal;
      QtytoPick@1009 : Decimal;
      BinCodeFilterText@1003 : Text[250];
      IsSetCurrentKeyHandled@1016 : Boolean;
      IsHandled@1017 : Boolean;
      EndLoop@1018 : Boolean;
    BEGIN
      IsSetCurrentKeyHandled := FALSE;
      OnBeforeFindBWPickBin(FromBinContent,IsSetCurrentKeyHandled);
      IF NOT IsSetCurrentKeyHandled THEN
        IF CrossDockBin THEN BEGIN
          FromBinContent.SETCURRENTKEY(
            "Location Code","Item No.","Variant Code","Cross-Dock Bin","Qty. per Unit of Measure","Bin Ranking");
          FromBinContent.ASCENDING(FALSE);
        END ELSE
          FromBinContent.SETCURRENTKEY(Default,"Location Code","Item No.","Variant Code","Bin Code");

      WITH FromBinContent DO BEGIN
        SETRANGE(Default,DefaultBin);
        SETRANGE("Cross-Dock Bin",CrossDockBin);
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        GetLocation(LocationCode);
        OnBeforeSetBinCodeFilter(BinCodeFilterText,LocationCode,ItemNo,VariantCode,ToBinCode);
        IF Location."Require Pick" AND (Location."Shipment Bin Code" <> '') THEN
          AddToFilterText(BinCodeFilterText,'&','<>',Location."Shipment Bin Code");
        IF Location."Require Put-away" AND (Location."Receipt Bin Code" <> '') THEN
          AddToFilterText(BinCodeFilterText,'&','<>',Location."Receipt Bin Code");
        IF ToBinCode <> '' THEN
          AddToFilterText(BinCodeFilterText,'&','<>',ToBinCode);
        IF BinCodeFilterText <> '' THEN
          SETFILTER("Bin Code",BinCodeFilterText);
        IF WhseItemTrkgExists THEN BEGIN
          SETRANGE("Lot No. Filter",TempWhseItemTrackingLine."Lot No.");
          SETRANGE("Serial No. Filter",TempWhseItemTrackingLine."Serial No.");
        END;
        IsHandled := FALSE;
        OnFindBWPickBinOnBeforeFindFromBinContent(FromBinContent,SourceType,TotalQtyPickedBase,IsHandled);
        IF NOT IsHandled THEN
          IF FINDSET THEN
            REPEAT
              QtyAvailableBase :=
                CalcQtyAvailToPick(0) -
                CalcPickQtyAssigned(LocationCode,ItemNo,VariantCode,'',"Bin Code",TempWhseItemTrackingLine);

              OnCalcAvailQtyOnFindBWPickBin(
                ItemNo,VariantCode,SNRequired,LNRequired,WhseItemTrkgExists,
                TempWhseItemTrackingLine."Serial No.",TempWhseItemTrackingLine."Lot No.","Location Code","Bin Code",
                SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtyToPickBase,QtyAvailableBase);

              IF QtyAvailableBase > 0 THEN BEGIN
                IF SNRequired THEN
                  QtyAvailableBase := 1;

                UpdateQuantitiesToPick(
                  QtyAvailableBase,
                  QtyPerUnitofMeasure,QtytoPick,QtyToPickBase,
                  QtyPerUnitofMeasure,QtytoPick,QtyToPickBase,
                  TotalQtyToPick,TotalQtyToPickBase);

                CreateTempActivityLine(
                  LocationCode,"Bin Code",UnitofMeasureCode,QtyPerUnitofMeasure,QtytoPick,QtyToPickBase,1,0);
                CreateTempActivityLine(
                  LocationCode,ToBinCode,UnitofMeasureCode,QtyPerUnitofMeasure,QtytoPick,QtyToPickBase,2,0);
              END;
              EndLoop := FALSE;
              IsHandled := FALSE;
              OnFindBWPickBinOnBeforeEndLoop(FromBinContent,TotalQtyToPickBase,EndLoop,IsHandled);
              IF NOT IsHandled THEN
                EndLoop := (NEXT = 0) OR (TotalQtyToPickBase = 0);
            UNTIL EndLoop;
      END;
    END;

    LOCAL PROCEDURE CalcPickBin@37(LocationCode@1008 : Code[10];ItemNo@1007 : Code[20];VariantCode@1006 : Code[10];UnitofMeasureCode@1005 : Code[10];ToBinCode@1004 : Code[20];QtyPerUnitofMeasure@1009 : Decimal;VAR TotalQtytoPick@1002 : Decimal;VAR TempWhseItemTrackingLine@1001 : TEMPORARY Record 6550;CrossDock@1000 : Boolean;VAR TotalQtytoPickBase@1000000000 : Decimal);
    BEGIN
      // Directed put-away and pick
      OnBeforeCalcPickBin(
        TempWhseActivLine,TotalQtytoPick,TotalQtytoPickBase,TempWhseItemTrackingLine,CrossDock,WhseItemTrkgExists,WhseSource,
        LocationCode,ItemNo,VariantCode,UnitofMeasureCode,ToBinCode,QtyPerUnitofMeasure);

      IF TotalQtytoPickBase > 0 THEN BEGIN
        ItemTrackingMgt.CheckWhseItemTrkgSetup(ItemNo,SNRequired,LNRequired,FALSE);
        FindPickBin(
          LocationCode,ItemNo,VariantCode,UnitofMeasureCode,
          ToBinCode,TempWhseActivLine,TotalQtytoPick,TempWhseItemTrackingLine,CrossDock,TotalQtytoPickBase);
        IF (TotalQtytoPickBase > 0) AND Location."Allow Breakbulk" THEN BEGIN
          FindBreakBulkBin(
            LocationCode,ItemNo,VariantCode,UnitofMeasureCode,ToBinCode,
            QtyPerUnitofMeasure,TempWhseActivLine,TotalQtytoPick,TempWhseItemTrackingLine,CrossDock,TotalQtytoPickBase);
          IF TotalQtytoPickBase > 0 THEN
            FindSmallerUOMBin(
              LocationCode,ItemNo,VariantCode,UnitofMeasureCode,ToBinCode,
              QtyPerUnitofMeasure,TotalQtytoPick,TempWhseItemTrackingLine,CrossDock,TotalQtytoPickBase);
        END;
      END;
    END;

    LOCAL PROCEDURE BinContentExists@14(VAR BinContent@1000 : Record 7302;ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];UOMCode@1003 : Code[10];VariantCode@1004 : Code[10];CrossDock@1005 : Boolean;LNRequired@1006 : Boolean;SNRequired@1007 : Boolean) : Boolean;
    BEGIN
      WITH BinContent DO BEGIN
        SETCURRENTKEY("Location Code","Item No.","Variant Code","Cross-Dock Bin","Qty. per Unit of Measure","Bin Ranking");
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        SETRANGE("Cross-Dock Bin",CrossDock);
        SETRANGE("Unit of Measure Code",UOMCode);
        IF WhseSource = WhseSource::"Movement Worksheet" THEN
          SETFILTER("Bin Ranking",'<%1',Bin."Bin Ranking");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No. Filter",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No. Filter",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No. Filter",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No. Filter",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END;
        ASCENDING(FALSE);
        OnAfterBinContentExistsFilter(BinContent);
        EXIT(FINDSET);
      END;
    END;

    LOCAL PROCEDURE BinContentBlocked@78(LocationCode@1001 : Code[10];BinCode@1002 : Code[20];ItemNo@1003 : Code[20];VariantCode@1004 : Code[10];UnitOfMeasureCode@1005 : Code[10]) : Boolean;
    VAR
      BinContent@1000 : Record 7302;
    BEGIN
      WITH BinContent DO BEGIN
        GET(LocationCode,BinCode,ItemNo,VariantCode,UnitOfMeasureCode);
        IF "Block Movement" IN ["Block Movement"::Outbound,"Block Movement"::All] THEN
          EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE BreakBulkPlacingExists@75(VAR TempBinContent@1000 : TEMPORARY Record 7302;ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];UOMCode@1003 : Code[10];VariantCode@1004 : Code[10];CrossDock@1005 : Boolean;LNRequired@1006 : Boolean;SNRequired@1007 : Boolean) : Boolean;
    VAR
      BinContent2@1008 : Record 7302;
      WhseActivLine2@1009 : Record 5767;
    BEGIN
      TempBinContent.RESET;
      TempBinContent.DELETEALL;
      WITH BinContent2 DO BEGIN
        SETCURRENTKEY("Location Code","Item No.","Variant Code","Cross-Dock Bin","Qty. per Unit of Measure","Bin Ranking");
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        SETRANGE("Cross-Dock Bin",CrossDock);
        IF WhseSource = WhseSource::"Movement Worksheet" THEN
          SETFILTER("Bin Ranking",'<%1',Bin."Bin Ranking");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No. Filter",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No. Filter",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No. Filter",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No. Filter",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END;
        ASCENDING(FALSE);
      END;

      WhseActivLine2.COPY(TempWhseActivLine);
      WITH TempWhseActivLine DO BEGIN
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        SETRANGE("Unit of Measure Code",UOMCode);
        SETRANGE("Action Type","Action Type"::Place);
        SETFILTER("Breakbulk No.",'<>0');
        SETRANGE("Bin Code");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No.",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No.",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No.",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No.",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END;
        IF FINDFIRST THEN
          REPEAT
            BinContent2.SETRANGE("Bin Code","Bin Code");
            BinContent2.SETRANGE("Unit of Measure Code",UOMCode);
            IF BinContent2.ISEMPTY THEN BEGIN
              BinContent2.SETRANGE("Unit of Measure Code");
              IF BinContent2.FINDFIRST THEN BEGIN
                TempBinContent := BinContent2;
                TempBinContent.VALIDATE("Unit of Measure Code",UOMCode);
                IF TempBinContent.INSERT THEN;
              END;
            END;
          UNTIL NEXT = 0;
      END;
      TempWhseActivLine.COPY(WhseActivLine2);
      EXIT(NOT TempBinContent.ISEMPTY);
    END;

    LOCAL PROCEDURE FindPickBin@6(LocationCode@1001 : Code[10];ItemNo@1002 : Code[20];VariantCode@1003 : Code[10];UnitofMeasureCode@1004 : Code[10];ToBinCode@1011 : Code[20];VAR TempWhseActivLine2@1000 : TEMPORARY Record 5767;VAR TotalQtytoPick@1005 : Decimal;VAR TempWhseItemTrackingLine@1007 : TEMPORARY Record 6550;CrossDock@1008 : Boolean;VAR TotalQtytoPickBase@1000000000 : Decimal);
    VAR
      FromBinContent@1006 : Record 7302;
      FromQtyToPick@1009 : Decimal;
      FromQtyToPickBase@1000000003 : Decimal;
      ToQtyToPick@1014 : Decimal;
      ToQtyToPickBase@1015 : Decimal;
      TotalAvailQtyToPickBase@1013 : Decimal;
      AvailableQtyBase@1010 : Decimal;
      BinIsForPick@1012 : Boolean;
      BinIsForReplenishment@1016 : Boolean;
    BEGIN
      // Directed put-away and pick
      GetBin(LocationCode,ToBinCode);
      GetLocation(LocationCode);
      WITH FromBinContent DO
        IF BinContentExists(FromBinContent,ItemNo,LocationCode,UnitofMeasureCode,VariantCode,CrossDock,TRUE,TRUE) THEN BEGIN
          TotalAvailQtyToPickBase :=
            CalcTotalAvailQtyToPick(
              LocationCode,ItemNo,VariantCode,
              TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.",
              SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtytoPickBase,FALSE);
          IF TotalAvailQtyToPickBase < 0 THEN
            TotalAvailQtyToPickBase := 0;

          REPEAT
            BinIsForPick := UseForPick(FromBinContent) AND (WhseSource <> WhseSource::"Movement Worksheet");
            BinIsForReplenishment := UseForReplenishment(FromBinContent) AND (WhseSource = WhseSource::"Movement Worksheet");
            IF "Bin Code" <> ToBinCode THEN
              CalcBinAvailQtyToPick(AvailableQtyBase,FromBinContent,TempWhseActivLine2);
            IF BinIsForPick OR BinIsForReplenishment THEN BEGIN
              IF TotalAvailQtyToPickBase < AvailableQtyBase THEN
                AvailableQtyBase := TotalAvailQtyToPickBase;

              IF TotalQtytoPickBase < AvailableQtyBase THEN
                AvailableQtyBase := TotalQtytoPickBase;

              OnCalcAvailQtyOnFindPickBin(
                ItemNo,VariantCode,SNRequired,LNRequired,WhseItemTrkgExists,
                TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.","Location Code","Bin Code",
                SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtytoPickBase,AvailableQtyBase);

              IF AvailableQtyBase > 0 THEN BEGIN
                ToQtyToPickBase := CalcQtyToPickBase(FromBinContent);
                IF AvailableQtyBase > ToQtyToPickBase THEN
                  AvailableQtyBase := ToQtyToPickBase;

                UpdateQuantitiesToPick(
                  AvailableQtyBase,
                  "Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,
                  "Qty. per Unit of Measure",ToQtyToPick,ToQtyToPickBase,
                  TotalQtytoPick,TotalQtytoPickBase);

                CreateTempActivityLine(
                  LocationCode,"Bin Code",UnitofMeasureCode,"Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,1,0);
                CreateTempActivityLine(
                  LocationCode,ToBinCode,UnitofMeasureCode,"Qty. per Unit of Measure",ToQtyToPick,ToQtyToPickBase,2,0);

                TotalAvailQtyToPickBase := TotalAvailQtyToPickBase - ToQtyToPickBase;
              END;
            END ELSE
              EnqueueCannotBeHandledReason(
                GetMessageForUnhandledQtyDueToBin(
                  BinIsForPick,BinIsForReplenishment,WhseSource = WhseSource::"Movement Worksheet",AvailableQtyBase,"Bin Code"));
          UNTIL (NEXT = 0) OR (TotalQtytoPickBase = 0);
        END;
    END;

    LOCAL PROCEDURE FindBreakBulkBin@15(LocationCode@1001 : Code[10];ItemNo@1002 : Code[20];VariantCode@1003 : Code[10];ToUOMCode@1014 : Code[10];ToBinCode@1011 : Code[20];ToQtyPerUOM@1004 : Decimal;VAR TempWhseActivLine2@1012 : TEMPORARY Record 5767;VAR TotalQtytoPick@1005 : Decimal;VAR TempWhseItemTrackingLine@1017 : TEMPORARY Record 6550;CrossDock@1008 : Boolean;VAR TotalQtytoPickBase@1000000000 : Decimal);
    VAR
      FromItemUOM@1000 : Record 5404;
      FromBinContent@1006 : Record 7302;
      FromQtyToPick@1015 : Decimal;
      FromQtyToPickBase@1009 : Decimal;
      ToQtyToPick@1021 : Decimal;
      ToQtyToPickBase@1020 : Decimal;
      QtyAvailableBase@1010 : Decimal;
      TotalAvailQtyToPickBase@1019 : Decimal;
    BEGIN
      // Directed put-away and pick
      GetBin(LocationCode,ToBinCode);

      TotalAvailQtyToPickBase :=
        CalcTotalAvailQtyToPick(
          LocationCode,ItemNo,VariantCode,TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.",
          SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,0,FALSE);

      IF TotalAvailQtyToPickBase < 0 THEN
        TotalAvailQtyToPickBase := 0;

      IF NOT Location."Always Create Pick Line" THEN BEGIN
        IF TotalAvailQtyToPickBase = 0 THEN
          EXIT;

        IF TotalAvailQtyToPickBase < TotalQtytoPickBase THEN BEGIN
          TotalQtytoPickBase := TotalAvailQtyToPickBase;
          TotalQtytoPick := ROUND(TotalQtytoPickBase / ToQtyPerUOM,UOMMgt.QtyRndPrecision);
        END;
      END;

      FromItemUOM.SETCURRENTKEY("Item No.","Qty. per Unit of Measure");
      FromItemUOM.SETRANGE("Item No.",ItemNo);
      FromItemUOM.SETFILTER("Qty. per Unit of Measure",'>=%1',ToQtyPerUOM);
      FromItemUOM.SETFILTER(Code,'<>%1',ToUOMCode);
      IF FromItemUOM.FIND('-') THEN
        WITH FromBinContent DO
          REPEAT
            IF BinContentExists(
                 FromBinContent,ItemNo,LocationCode,FromItemUOM.Code,VariantCode,CrossDock,LNRequired,SNRequired)
            THEN
              REPEAT
                IF ("Bin Code" <> ToBinCode) AND
                   ((UseForPick(FromBinContent) AND (WhseSource <> WhseSource::"Movement Worksheet")) OR
                    (UseForReplenishment(FromBinContent) AND (WhseSource = WhseSource::"Movement Worksheet")))
                THEN BEGIN
                  // Check and use bulk that has previously been broken
                  QtyAvailableBase := CalcBinAvailQtyInBreakbulk(TempWhseActivLine2,FromBinContent,ToUOMCode);

                  OnCalcAvailQtyOnFindBreakBulkBin(
                    TRUE,ItemNo,VariantCode,SNRequired,LNRequired,WhseItemTrkgExists,
                    TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.","Location Code","Bin Code",
                    SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtytoPickBase,QtyAvailableBase);

                  IF QtyAvailableBase > 0 THEN BEGIN
                    UpdateQuantitiesToPick(
                      QtyAvailableBase,
                      ToQtyPerUOM,FromQtyToPick,FromQtyToPickBase,
                      ToQtyPerUOM,ToQtyToPick,ToQtyToPickBase,
                      TotalQtytoPick,TotalQtytoPickBase);

                    CreateBreakBulkTempLines(
                      "Location Code",ToUOMCode,ToUOMCode,
                      "Bin Code",ToBinCode,ToQtyPerUOM,ToQtyPerUOM,
                      0,FromQtyToPick,FromQtyToPickBase,ToQtyToPick,ToQtyToPickBase);
                  END;

                  IF TotalQtytoPickBase <= 0 THEN
                    EXIT;

                  // Now break bulk and use
                  QtyAvailableBase := CalcBinAvailQtyToBreakbulk(TempWhseActivLine2,FromBinContent);

                  OnCalcAvailQtyOnFindBreakBulkBin(
                    FALSE,ItemNo,VariantCode,SNRequired,LNRequired,WhseItemTrkgExists,
                    TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.","Location Code","Bin Code",
                    SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtytoPickBase,QtyAvailableBase);

                  IF QtyAvailableBase > 0 THEN BEGIN
                    FromItemUOM.GET(ItemNo,"Unit of Measure Code");
                    UpdateQuantitiesToPick(
                      QtyAvailableBase,
                      FromItemUOM."Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,
                      ToQtyPerUOM,ToQtyToPick,ToQtyToPickBase,
                      TotalQtytoPick,TotalQtytoPickBase);

                    BreakbulkNo := BreakbulkNo + 1;
                    CreateBreakBulkTempLines(
                      "Location Code","Unit of Measure Code",ToUOMCode,
                      "Bin Code",ToBinCode,FromItemUOM."Qty. per Unit of Measure",ToQtyPerUOM,
                      BreakbulkNo,ToQtyToPick,ToQtyToPickBase,FromQtyToPick,FromQtyToPickBase);
                  END;
                  IF TotalQtytoPickBase <= 0 THEN
                    EXIT;
                END;
              UNTIL NEXT = 0;
          UNTIL FromItemUOM.NEXT = 0;
    END;

    LOCAL PROCEDURE FindSmallerUOMBin@26(LocationCode@1001 : Code[10];ItemNo@1002 : Code[20];VariantCode@1003 : Code[10];UnitofMeasureCode@1014 : Code[10];ToBinCode@1011 : Code[20];QtyPerUnitOfMeasure@1004 : Decimal;VAR TotalQtytoPick@1005 : Decimal;VAR TempWhseItemTrackingLine@1010 : TEMPORARY Record 6550;CrossDock@1000 : Boolean;VAR TotalQtytoPickBase@1000000000 : Decimal);
    VAR
      ItemUOM@1007 : Record 5404;
      FromBinContent@1006 : Record 7302;
      TempFromBinContent@1012 : TEMPORARY Record 7302;
      FromQtyToPick@1018 : Decimal;
      FromQtyToPickBase@1013 : Decimal;
      ToQtyToPick@1015 : Decimal;
      ToQtyToPickBase@1009 : Decimal;
      QtyAvailableBase@1016 : Decimal;
      TotalAvailQtyToPickBase@1017 : Decimal;
    BEGIN
      // Directed put-away and pick
      TotalAvailQtyToPickBase :=
        CalcTotalAvailQtyToPick(
          LocationCode,ItemNo,VariantCode,
          TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.",
          SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,0,FALSE);

      IF TotalAvailQtyToPickBase < 0 THEN
        TotalAvailQtyToPickBase := 0;

      IF NOT Location."Always Create Pick Line" THEN BEGIN
        IF TotalAvailQtyToPickBase = 0 THEN
          EXIT;

        IF TotalAvailQtyToPickBase < TotalQtytoPickBase THEN BEGIN
          TotalQtytoPickBase := TotalAvailQtyToPickBase;
          ItemUOM.GET(ItemNo,UnitofMeasureCode);
          TotalQtytoPick := ROUND(TotalQtytoPickBase / ItemUOM."Qty. per Unit of Measure",UOMMgt.QtyRndPrecision);
        END;
      END;

      GetBin(LocationCode,ToBinCode);

      ItemUOM.SETCURRENTKEY("Item No.","Qty. per Unit of Measure");
      ItemUOM.SETRANGE("Item No.",ItemNo);
      ItemUOM.SETFILTER("Qty. per Unit of Measure",'<%1',QtyPerUnitOfMeasure);
      ItemUOM.SETFILTER(Code,'<>%1',UnitofMeasureCode);
      ItemUOM.ASCENDING(FALSE);
      IF ItemUOM.FIND('-') THEN
        WITH FromBinContent DO
          REPEAT
            IF BinContentExists(FromBinContent,ItemNo,LocationCode,ItemUOM.Code,VariantCode,CrossDock,LNRequired,SNRequired) THEN
              REPEAT
                IF ("Bin Code" <> ToBinCode) AND
                   ((UseForPick(FromBinContent) AND (WhseSource <> WhseSource::"Movement Worksheet")) OR
                    (UseForReplenishment(FromBinContent) AND (WhseSource = WhseSource::"Movement Worksheet")))
                THEN BEGIN
                  CalcBinAvailQtyFromSmallerUOM(QtyAvailableBase,FromBinContent,FALSE);

                  OnCalcAvailQtyOnFindSmallerUOMBin(
                    FALSE,ItemNo,VariantCode,SNRequired,LNRequired,WhseItemTrkgExists,
                    TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.","Location Code","Bin Code",
                    SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtytoPickBase,QtyAvailableBase);

                  IF QtyAvailableBase > 0 THEN BEGIN
                    UpdateQuantitiesToPick(
                      QtyAvailableBase,
                      ItemUOM."Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,
                      QtyPerUnitOfMeasure,ToQtyToPick,ToQtyToPickBase,
                      TotalQtytoPick,TotalQtytoPickBase);

                    CreateTempActivityLine(
                      LocationCode,"Bin Code","Unit of Measure Code",
                      ItemUOM."Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,1,0);
                    CreateTempActivityLine(
                      LocationCode,ToBinCode,UnitofMeasureCode,
                      QtyPerUnitOfMeasure,ToQtyToPick,ToQtyToPickBase,2,0);

                    TotalAvailQtyToPickBase := TotalAvailQtyToPickBase - ToQtyToPickBase;
                  END;
                END;
              UNTIL (NEXT = 0) OR (TotalQtytoPickBase = 0);
            IF TotalQtytoPickBase > 0 THEN
              IF BreakBulkPlacingExists(TempFromBinContent,ItemNo,LocationCode,ItemUOM.Code,VariantCode,CrossDock,LNRequired,SNRequired) THEN
                REPEAT
                  WITH TempFromBinContent DO
                    IF ("Bin Code" <> ToBinCode) AND
                       ((UseForPick(TempFromBinContent) AND (WhseSource <> WhseSource::"Movement Worksheet")) OR
                        (UseForReplenishment(TempFromBinContent) AND (WhseSource = WhseSource::"Movement Worksheet")))
                    THEN BEGIN
                      CalcBinAvailQtyFromSmallerUOM(QtyAvailableBase,TempFromBinContent,TRUE);

                      OnCalcAvailQtyOnFindSmallerUOMBin(
                        TRUE,ItemNo,VariantCode,SNRequired,LNRequired,WhseItemTrkgExists,
                        TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.","Location Code","Bin Code",
                        SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TotalQtytoPickBase,QtyAvailableBase);

                      IF QtyAvailableBase > 0 THEN BEGIN
                        UpdateQuantitiesToPick(
                          QtyAvailableBase,
                          ItemUOM."Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,
                          QtyPerUnitOfMeasure,ToQtyToPick,ToQtyToPickBase,
                          TotalQtytoPick,TotalQtytoPickBase);

                        CreateTempActivityLine(
                          LocationCode,"Bin Code","Unit of Measure Code",
                          ItemUOM."Qty. per Unit of Measure",FromQtyToPick,FromQtyToPickBase,1,0);
                        CreateTempActivityLine(
                          LocationCode,ToBinCode,UnitofMeasureCode,
                          QtyPerUnitOfMeasure,ToQtyToPick,ToQtyToPickBase,2,0);
                        TotalAvailQtyToPickBase := TotalAvailQtyToPickBase - ToQtyToPickBase;
                      END;
                    END;
                UNTIL (TempFromBinContent.NEXT = 0) OR (TotalQtytoPickBase = 0);
          UNTIL (ItemUOM.NEXT = 0) OR (TotalQtytoPickBase = 0);
    END;

    LOCAL PROCEDURE FindWhseActivLine@110(VAR TempWhseActivLine@1000 : TEMPORARY Record 5767;Location@1001 : Record 14;VAR FirstWhseDocNo@1003 : Code[20];VAR LastWhseDocNo@1002 : Code[20]) : Boolean;
    BEGIN
      TempWhseActivLine.SETRANGE("Location Code",TempWhseActivLine."Location Code");
      IF Location."Bin Mandatory" THEN
        TempWhseActivLine.SETRANGE("Action Type",TempWhseActivLine."Action Type"::Take)
      ELSE
        TempWhseActivLine.SETRANGE("Action Type",TempWhseActivLine."Action Type"::" ");

      IF NOT TempWhseActivLine.FIND('-') THEN BEGIN
        OnAfterFindWhseActivLine(FirstWhseDocNo,LastWhseDocNo);
        EXIT(FALSE);
      END;

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE CalcBinAvailQtyToPick@5(VAR QtyToPickBase@1001 : Decimal;VAR BinContent@1002 : Record 7302;VAR TempWhseActivLine@1000 : Record 5767);
    VAR
      AvailableQtyBase@1004 : Decimal;
    BEGIN
      WITH TempWhseActivLine DO BEGIN
        RESET;
        SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Action Type",
          "Variant Code","Unit of Measure Code","Breakbulk No.");
        SETRANGE("Item No.",BinContent."Item No.");
        SETRANGE("Bin Code",BinContent."Bin Code");
        SETRANGE("Location Code",BinContent."Location Code");
        SETRANGE("Unit of Measure Code",BinContent."Unit of Measure Code");
        SETRANGE("Variant Code",BinContent."Variant Code");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No.",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No.",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No.",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No.",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END;

        IF Location."Allow Breakbulk" THEN BEGIN
          SETRANGE("Action Type","Action Type"::Place);
          SETFILTER("Breakbulk No.",'<>0');
          CALCSUMS("Qty. (Base)");
          AvailableQtyBase := "Qty. (Base)";
        END;

        SETRANGE("Action Type","Action Type"::Take);
        SETRANGE("Breakbulk No.",0);
        CALCSUMS("Qty. (Base)");
      END;

      QtyToPickBase := BinContent.CalcQtyAvailToPick(AvailableQtyBase - TempWhseActivLine."Qty. (Base)");
    END;

    LOCAL PROCEDURE CalcBinAvailQtyToBreakbulk@83(VAR TempWhseActivLine2@1001 : Record 5767;VAR BinContent@1000 : Record 7302) QtyToPickBase : Decimal;
    BEGIN
      WITH BinContent DO BEGIN
        SetFilterOnUnitOfMeasure;
        CALCFIELDS("Quantity (Base)","Pick Quantity (Base)","Negative Adjmt. Qty. (Base)");
        QtyToPickBase := "Quantity (Base)" - "Pick Quantity (Base)" - "Negative Adjmt. Qty. (Base)";
      END;
      IF QtyToPickBase <= 0 THEN
        EXIT(0);

      WITH TempWhseActivLine2 DO BEGIN
        SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Action Type",
          "Variant Code","Unit of Measure Code","Breakbulk No.");
        SETRANGE("Action Type","Action Type"::Take);
        SETRANGE("Location Code",BinContent."Location Code");
        SETRANGE("Bin Code",BinContent."Bin Code");
        SETRANGE("Item No.",BinContent."Item No.");
        SETRANGE("Unit of Measure Code",BinContent."Unit of Measure Code");
        SETRANGE("Variant Code",BinContent."Variant Code");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No.",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No.",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No.",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No.",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END ELSE
          ClearTrackingFilter;

        ClearSourceFilter;
        SETRANGE("Breakbulk No.");
        CALCSUMS("Qty. (Base)");
        QtyToPickBase := QtyToPickBase - "Qty. (Base)";
        EXIT(QtyToPickBase);
      END;
    END;

    LOCAL PROCEDURE CalcBinAvailQtyInBreakbulk@18(VAR TempWhseActivLine2@1000 : Record 5767;VAR BinContent@1001 : Record 7302;ToUOMCode@1003 : Code[10]) QtyToPickBase : Decimal;
    BEGIN
      WITH TempWhseActivLine2 DO BEGIN
        IF (MaxNoOfSourceDoc > 1) OR (MaxNoOfLines <> 0) THEN
          EXIT(0);

        SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Action Type",
          "Variant Code","Unit of Measure Code","Breakbulk No.");
        SETRANGE("Action Type","Action Type"::Take);
        SETRANGE("Location Code",BinContent."Location Code");
        SETRANGE("Bin Code",BinContent."Bin Code");
        SETRANGE("Item No.",BinContent."Item No.");
        SETRANGE("Unit of Measure Code",ToUOMCode);
        SETRANGE("Variant Code",BinContent."Variant Code");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No.",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No.",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No.",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No.",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END ELSE BEGIN
          SETRANGE("Lot No.");
          SETRANGE("Serial No.");
        END;
        SETRANGE("Breakbulk No.",0);
        CALCSUMS("Qty. (Base)");
        QtyToPickBase := "Qty. (Base)";

        SETRANGE("Action Type","Action Type"::Place);
        SETFILTER("Breakbulk No.",'<>0');
        SETRANGE("No.",FORMAT(TempNo));
        IF MaxNoOfSourceDoc = 1 THEN BEGIN
          SETRANGE("Source Type",WhseWkshLine."Source Type");
          SETRANGE("Source Subtype",WhseWkshLine."Source Subtype");
          SETRANGE("Source No.",WhseWkshLine."Source No.");
        END;
        CALCSUMS("Qty. (Base)");
        QtyToPickBase := "Qty. (Base)" - QtyToPickBase;
        EXIT(QtyToPickBase);
      END;
    END;

    LOCAL PROCEDURE CalcBinAvailQtyFromSmallerUOM@24(VAR AvailableQtyBase@1001 : Decimal;VAR BinContent@1000 : Record 7302;AllowInitialZero@1002 : Boolean);
    BEGIN
      WITH BinContent DO BEGIN
        SetFilterOnUnitOfMeasure;
        CALCFIELDS("Quantity (Base)","Pick Quantity (Base)","Negative Adjmt. Qty. (Base)");
        AvailableQtyBase := "Quantity (Base)" - "Pick Quantity (Base)" - "Negative Adjmt. Qty. (Base)";
      END;
      IF (AvailableQtyBase < 0) OR ((AvailableQtyBase = 0) AND (NOT AllowInitialZero)) THEN
        EXIT;

      WITH TempWhseActivLine DO BEGIN
        SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Action Type",
          "Variant Code","Unit of Measure Code","Breakbulk No.");

        SETRANGE("Item No.",BinContent."Item No.");
        SETRANGE("Bin Code",BinContent."Bin Code");
        SETRANGE("Location Code",BinContent."Location Code");
        SETRANGE("Action Type","Action Type"::Take);
        SETRANGE("Variant Code",BinContent."Variant Code");
        SETRANGE("Unit of Measure Code",BinContent."Unit of Measure Code");
        IF WhseItemTrkgExists THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No.",TempWhseItemTrackingLine."Lot No.")
          ELSE
            SETFILTER("Lot No.",'%1|%2',TempWhseItemTrackingLine."Lot No.",'');
          IF SNRequired THEN
            SETRANGE("Serial No.",TempWhseItemTrackingLine."Serial No.")
          ELSE
            SETFILTER("Serial No.",'%1|%2',TempWhseItemTrackingLine."Serial No.",'');
        END ELSE BEGIN
          SETRANGE("Lot No.");
          SETRANGE("Serial No.");
        END;
        CALCSUMS("Qty. (Base)");
        AvailableQtyBase := AvailableQtyBase - "Qty. (Base)";

        SETRANGE("Action Type","Action Type"::Place);
        SETFILTER("Breakbulk No.",'<>0');
        CALCSUMS("Qty. (Base)");
        AvailableQtyBase := AvailableQtyBase + "Qty. (Base)";
        RESET;
      END;
    END;

    LOCAL PROCEDURE CreateBreakBulkTempLines@34(LocationCode@1008 : Code[10];FromUOMCode@1007 : Code[10];ToUOMCode@1005 : Code[10];FromBinCode@1006 : Code[20];ToBinCode@1004 : Code[20];FromQtyPerUOM@1009 : Decimal;ToQtyPerUOM@1003 : Decimal;BreakbulkNo2@1010 : Integer;ToQtyToPick@1012 : Decimal;ToQtyToPickBase@1001 : Decimal;FromQtyToPick@1002 : Decimal;FromQtyToPickBase@1000000000 : Decimal);
    VAR
      QtyToBreakBulk@1000000001 : Decimal;
    BEGIN
      // Directed put-away and pick
      IF FromUOMCode <> ToUOMCode THEN BEGIN
        CreateTempActivityLine(
          LocationCode,FromBinCode,FromUOMCode,FromQtyPerUOM,FromQtyToPick,FromQtyToPickBase,1,BreakbulkNo2);

        IF FromQtyToPickBase = ToQtyToPickBase THEN
          QtyToBreakBulk := ToQtyToPick
        ELSE
          QtyToBreakBulk := ROUND(FromQtyToPick * FromQtyPerUOM / ToQtyPerUOM,UOMMgt.QtyRndPrecision);
        CreateTempActivityLine(
          LocationCode,FromBinCode,ToUOMCode,ToQtyPerUOM,QtyToBreakBulk,FromQtyToPickBase,2,BreakbulkNo2);
      END;
      CreateTempActivityLine(LocationCode,FromBinCode,ToUOMCode,ToQtyPerUOM,ToQtyToPick,ToQtyToPickBase,1,0);
      CreateTempActivityLine(LocationCode,ToBinCode,ToUOMCode,ToQtyPerUOM,ToQtyToPick,ToQtyToPickBase,2,0);
    END;

    [External]
    PROCEDURE CreateWhseDocument@4(VAR FirstWhseDocNo@1009 : Code[20];VAR LastWhseDocNo@1008 : Code[20];ShowError@1011 : Boolean);
    VAR
      WhseActivLine@1006 : Record 5767;
      OldNo@1002 : Code[20];
      OldSourceNo@1001 : Code[20];
      OldLocationCode@1010 : Code[10];
      OldBinCode@1007 : Code[20];
      OldZoneCode@1000 : Code[10];
      NoOfLines@1004 : Integer;
      NoOfSourceDoc@1005 : Integer;
      CreateNewHeader@1013 : Boolean;
      WhseDocCreated@1003 : Boolean;
      IsHandled@1012 : Boolean;
    BEGIN
      TempWhseActivLine.RESET;
      IF NOT TempWhseActivLine.FIND('-') THEN BEGIN
        OnCreateWhseDocumentOnBeforeShowError(ShowError);
        IF ShowError THEN
          ERROR(Text000,DequeueCannotBeHandledReason);
        EXIT;
      END;

      OnBeforeCreateWhseDocument(TempWhseActivLine,WhseSource);

      WhseActivHeader.LOCKTABLE;
      IF WhseActivHeader.FINDLAST THEN;
      WhseActivLine.LOCKTABLE;
      IF WhseActivLine.FINDLAST THEN;

      IF WhseSource = WhseSource::"Movement Worksheet" THEN
        TempWhseActivLine.SETRANGE("Activity Type",TempWhseActivLine."Activity Type"::Movement)
      ELSE
        TempWhseActivLine.SETRANGE("Activity Type",TempWhseActivLine."Activity Type"::Pick);

      NoOfLines := 0;
      NoOfSourceDoc := 0;

      REPEAT
        GetLocation(TempWhseActivLine."Location Code");
        IF NOT FindWhseActivLine(TempWhseActivLine,Location,FirstWhseDocNo,LastWhseDocNo) THEN
          EXIT;

        IF PerBin THEN
          TempWhseActivLine.SETRANGE("Bin Code",TempWhseActivLine."Bin Code");
        IF PerZone THEN
          TempWhseActivLine.SETRANGE("Zone Code",TempWhseActivLine."Zone Code");

        OnCreateWhseDocumentOnAfterSetFiltersBeforeLoop(TempWhseActivLine,PerBin,PerZone);

        REPEAT
          IsHandled := FALSE;
          CreateNewHeader := FALSE;
          OnCreateWhseDocumentOnBeforeCreateDocAndLine(TempWhseActivLine,IsHandled,CreateNewHeader);
          IF IsHandled THEN BEGIN
            IF CreateNewHeader THEN BEGIN
              CreateWhseActivHeader(
                TempWhseActivLine."Location Code",FirstWhseDocNo,LastWhseDocNo,
                NoOfSourceDoc,NoOfLines,WhseDocCreated);
              CreateWhseDocLine;
            END ELSE
              CreateNewWhseDoc(
                OldNo,OldSourceNo,OldLocationCode,FirstWhseDocNo,LastWhseDocNo,
                NoOfSourceDoc,NoOfLines,WhseDocCreated);
          END ELSE
            IF PerBin THEN BEGIN
              IF TempWhseActivLine."Bin Code" <> OldBinCode THEN BEGIN
                CreateWhseActivHeader(
                  TempWhseActivLine."Location Code",FirstWhseDocNo,LastWhseDocNo,
                  NoOfSourceDoc,NoOfLines,WhseDocCreated);
                CreateWhseDocLine;
              END ELSE
                CreateNewWhseDoc(
                  OldNo,OldSourceNo,OldLocationCode,FirstWhseDocNo,LastWhseDocNo,
                  NoOfSourceDoc,NoOfLines,WhseDocCreated);
            END ELSE BEGIN
              IF PerZone THEN BEGIN
                IF TempWhseActivLine."Zone Code" <> OldZoneCode THEN BEGIN
                  CreateWhseActivHeader(
                    TempWhseActivLine."Location Code",FirstWhseDocNo,LastWhseDocNo,
                    NoOfSourceDoc,NoOfLines,WhseDocCreated);
                  CreateWhseDocLine;
                END ELSE
                  CreateNewWhseDoc(
                    OldNo,OldSourceNo,OldLocationCode,FirstWhseDocNo,LastWhseDocNo,
                    NoOfSourceDoc,NoOfLines,WhseDocCreated);
              END ELSE
                CreateNewWhseDoc(
                  OldNo,OldSourceNo,OldLocationCode,FirstWhseDocNo,LastWhseDocNo,
                  NoOfSourceDoc,NoOfLines,WhseDocCreated);
            END;

          OldZoneCode := TempWhseActivLine."Zone Code";
          OldBinCode := TempWhseActivLine."Bin Code";
          OldNo := TempWhseActivLine."No.";
          OldSourceNo := TempWhseActivLine."Source No.";
          OldLocationCode := TempWhseActivLine."Location Code";
          OnCreateWhseDocumentOnAfterSaveOldValues(TempWhseActivLine);
        UNTIL TempWhseActivLine.NEXT = 0;
        OnCreateWhseDocumentOnBeforeClearFilters(TempWhseActivLine);
        TempWhseActivLine.SETRANGE("Bin Code");
        TempWhseActivLine.SETRANGE("Zone Code");
        TempWhseActivLine.SETRANGE("Location Code");
        TempWhseActivLine.SETRANGE("Action Type");
        OnCreateWhseDocumentOnAfterSetFiltersAfterLoop(TempWhseActivLine);
        IF NOT TempWhseActivLine.FIND('-') THEN BEGIN
          OnAfterCreateWhseDocument(FirstWhseDocNo,LastWhseDocNo);
          EXIT;
        END;

      UNTIL FALSE;
    END;

    LOCAL PROCEDURE CreateNewWhseDoc@12(OldNo@1001 : Code[20];OldSourceNo@1004 : Code[20];OldLocationCode@1007 : Code[10];VAR FirstWhseDocNo@1005 : Code[20];VAR LastWhseDocNo@1006 : Code[20];VAR NoOfSourceDoc@1002 : Integer;VAR NoOfLines@1000 : Integer;VAR WhseDocCreated@1003 : Boolean);
    BEGIN
      OnBeforeCreateNewWhseDoc(
        TempWhseActivLine,OldNo,OldSourceNo,OldLocationCode,FirstWhseDocNo,LastWhseDocNo,NoOfSourceDoc,NoOfLines,WhseDocCreated);

      IF (TempWhseActivLine."No." <> OldNo) OR
         (TempWhseActivLine."Location Code" <> OldLocationCode)
      THEN BEGIN
        CreateWhseActivHeader(
          TempWhseActivLine."Location Code",FirstWhseDocNo,LastWhseDocNo,
          NoOfSourceDoc,NoOfLines,WhseDocCreated);
        CreateWhseDocLine;
      END ELSE BEGIN
        NoOfLines := NoOfLines + 1;
        IF TempWhseActivLine."Source No." <> OldSourceNo THEN
          NoOfSourceDoc := NoOfSourceDoc + 1;
        IF (MaxNoOfSourceDoc > 0) AND (NoOfSourceDoc > MaxNoOfSourceDoc) THEN
          CreateWhseActivHeader(
            TempWhseActivLine."Location Code",FirstWhseDocNo,LastWhseDocNo,
            NoOfSourceDoc,NoOfLines,WhseDocCreated);
        IF (MaxNoOfLines > 0) AND (NoOfLines > MaxNoOfLines) THEN
          CreateWhseActivHeader(
            TempWhseActivLine."Location Code",FirstWhseDocNo,LastWhseDocNo,
            NoOfSourceDoc,NoOfLines,WhseDocCreated);
        CreateWhseDocLine;
      END;
    END;

    LOCAL PROCEDURE CreateWhseActivHeader@7(LocationCode@1005 : Code[10];VAR FirstWhseDocNo@1004 : Code[20];VAR LastWhseDocNo@1003 : Code[20];VAR NoOfSourceDoc@1001 : Integer;VAR NoOfLines@1002 : Integer;VAR WhseDocCreated@1000 : Boolean);
    BEGIN
      WhseActivHeader.INIT;
      WhseActivHeader."No." := '';
      IF WhseDocType = WhseDocType::Movement THEN
        WhseActivHeader.Type := WhseActivHeader.Type::Movement
      ELSE
        WhseActivHeader.Type := WhseActivHeader.Type::Pick;
      WhseActivHeader."Location Code" := LocationCode;
      IF AssignedID <> '' THEN
        WhseActivHeader.VALIDATE("Assigned User ID",AssignedID);
      WhseActivHeader."Sorting Method" := SortPick;
      WhseActivHeader."Breakbulk Filter" := BreakbulkFilter;
      OnBeforeWhseActivHeaderInsert(WhseActivHeader);
      WhseActivHeader.INSERT(TRUE);

      NoOfLines := 1 ;
      NoOfSourceDoc := 1;

      IF NOT WhseDocCreated THEN BEGIN
        FirstWhseDocNo := WhseActivHeader."No.";
        WhseDocCreated := TRUE;
      END;
      LastWhseDocNo := WhseActivHeader."No.";
    END;

    LOCAL PROCEDURE CreateWhseDocLine@8();
    VAR
      WhseActivLine@1003 : Record 5767;
      LineNo@1002 : Integer;
    BEGIN
      TempWhseActivLine.SETRANGE("Breakbulk No.",0);
      TempWhseActivLine.FIND('-');
      WhseActivLine.SETRANGE("Activity Type",WhseActivHeader.Type);
      WhseActivLine.SETRANGE("No.",WhseActivHeader."No.");
      IF WhseActivLine.FINDLAST THEN
        LineNo := WhseActivLine."Line No."
      ELSE
        LineNo := 0;

      ItemTrackingMgt.CheckWhseItemTrkgSetup(
        TempWhseActivLine."Item No.",SNRequired,LNRequired,FALSE);

      LineNo := LineNo + 10000;
      WhseActivLine.INIT;
      WhseActivLine := TempWhseActivLine;
      WhseActivLine."No." := WhseActivHeader."No.";
      IF NOT (WhseActivLine."Whse. Document Type" IN [
                                                      WhseActivLine."Whse. Document Type"::"Internal Pick",
                                                      WhseActivLine."Whse. Document Type"::"Movement Worksheet"])
      THEN
        WhseActivLine."Source Document" := WhseMgt.GetSourceDocument(WhseActivLine."Source Type",WhseActivLine."Source Subtype");

      IF Location."Bin Mandatory" AND (NOT SNRequired) THEN
        CreateWhseDocTakeLine(WhseActivLine,LineNo)
      ELSE
        TempWhseActivLine.DELETE;

      IF WhseActivLine."Qty. (Base)" <> 0 THEN BEGIN
        WhseActivLine."Line No." := LineNo;
        IF DoNotFillQtytoHandle THEN BEGIN
          WhseActivLine."Qty. to Handle" := 0;
          WhseActivLine."Qty. to Handle (Base)" := 0;
          WhseActivLine.Cubage := 0;
          WhseActivLine.Weight := 0;
        END;
        OnBeforeWhseActivLineInsert(WhseActivLine,WhseActivHeader);
        WhseActivLine.INSERT;
        OnAfterWhseActivLineInsert(WhseActivLine);
      END;

      IF Location."Bin Mandatory" THEN
        CreateWhseDocPlaceLine(WhseActivLine.Quantity,WhseActivLine."Qty. (Base)",LineNo);

      OnAfterCreateWhseDocLine(WhseActivLine);
    END;

    LOCAL PROCEDURE CreateWhseDocTakeLine@25(VAR WhseActivLine@1000 : Record 5767;VAR LineNo@1002 : Integer);
    VAR
      WhseActivLine2@1004 : Record 5767;
      TempWhseActivLine2@1003 : TEMPORARY Record 5767;
      WhseActivLine3@1005 : Record 5767;
    BEGIN
      TempWhseActivLine2.COPY(TempWhseActivLine);
      TempWhseActivLine.SETCURRENTKEY(
        "Whse. Document No.","Whse. Document Type","Activity Type","Whse. Document Line No.","Action Type");
      TempWhseActivLine.DELETE;

      TempWhseActivLine.SETRANGE("Whse. Document Type",TempWhseActivLine2."Whse. Document Type");
      TempWhseActivLine.SETRANGE("Whse. Document No.",TempWhseActivLine2."Whse. Document No.");
      TempWhseActivLine.SETRANGE("Activity Type",TempWhseActivLine2."Activity Type");
      TempWhseActivLine.SETRANGE("Whse. Document Line No.",TempWhseActivLine2."Whse. Document Line No.");
      TempWhseActivLine.SETRANGE("Action Type",TempWhseActivLine2."Action Type"::Take);
      TempWhseActivLine.SetSourceFilter(
        TempWhseActivLine2."Source Type",TempWhseActivLine2."Source Subtype",TempWhseActivLine2."Source No.",
        TempWhseActivLine2."Source Line No.",TempWhseActivLine2."Source Subline No.",FALSE);
      TempWhseActivLine.SETRANGE("No.",TempWhseActivLine2."No.");
      TempWhseActivLine.SETFILTER("Line No.",'>%1',TempWhseActivLine2."Line No.");
      TempWhseActivLine.SETRANGE("Bin Code",TempWhseActivLine2."Bin Code");
      TempWhseActivLine.SETRANGE("Unit of Measure Code",WhseActivLine."Unit of Measure Code");
      TempWhseActivLine.SETRANGE("Zone Code");
      TempWhseActivLine.SETRANGE("Breakbulk No.",0);
      TempWhseActivLine.SetTrackingFilter(TempWhseActivLine2."Serial No.",TempWhseActivLine2."Lot No.");
      OnCreateWhseDocTakeLineOnAfterSetFilters(TempWhseActivLine,TempWhseActivLine2);
      IF TempWhseActivLine.FIND('-') THEN BEGIN
        REPEAT
          WhseActivLine.Quantity := WhseActivLine.Quantity + TempWhseActivLine.Quantity;
        UNTIL TempWhseActivLine.NEXT = 0;
        TempWhseActivLine.DELETEALL;
        WhseActivLine.VALIDATE(Quantity);
      END;

      // insert breakbulk lines
      IF Location."Directed Put-away and Pick" THEN BEGIN
        TempWhseActivLine.ClearSourceFilter;
        TempWhseActivLine.SETRANGE("Line No.");
        TempWhseActivLine.SETRANGE("Unit of Measure Code");
        TempWhseActivLine.SETFILTER("Breakbulk No.",'<>0');
        IF TempWhseActivLine.FIND('-') THEN
          REPEAT
            WhseActivLine2.INIT;
            WhseActivLine2 := TempWhseActivLine;
            WhseActivLine2."No." := WhseActivHeader."No.";
            WhseActivLine2."Line No." := LineNo;
            WhseActivLine2."Source Document" := WhseActivLine."Source Document";

            IF DoNotFillQtytoHandle THEN BEGIN
              WhseActivLine2."Qty. to Handle" := 0;
              WhseActivLine2."Qty. to Handle (Base)" := 0;
              WhseActivLine2.Cubage := 0;
              WhseActivLine2.Weight := 0;
            END;
            OnCreateWhseDocTakeLineOnBeforeWhseActivLineInsert(WhseActivLine2,WhseActivHeader,TempWhseActivLine);
            WhseActivLine2.INSERT;
            OnAfterWhseActivLineInsert(WhseActivLine2);

            TempWhseActivLine.DELETE;
            LineNo := LineNo + 10000;

            WhseActivLine3.COPY(TempWhseActivLine);
            TempWhseActivLine.SETRANGE("Action Type",TempWhseActivLine."Action Type"::Place);
            TempWhseActivLine.SETRANGE("Line No.");
            TempWhseActivLine.SETRANGE("Breakbulk No.",TempWhseActivLine."Breakbulk No.");
            TempWhseActivLine.FIND('-');

            WhseActivLine2.INIT;
            WhseActivLine2 := TempWhseActivLine;
            WhseActivLine2."No." := WhseActivHeader."No.";
            WhseActivLine2."Line No." := LineNo;
            WhseActivLine2."Source Document" := WhseActivLine."Source Document";

            IF DoNotFillQtytoHandle THEN BEGIN
              WhseActivLine2."Qty. to Handle" := 0;
              WhseActivLine2."Qty. to Handle (Base)" := 0;
              WhseActivLine2.Cubage := 0;
              WhseActivLine2.Weight := 0;
            END;

            WhseActivLine2."Original Breakbulk" :=
              WhseActivLine."Qty. (Base)" = WhseActivLine2."Qty. (Base)";
            IF BreakbulkFilter THEN
              WhseActivLine2.Breakbulk := WhseActivLine2."Original Breakbulk";
            WhseActivLine2.INSERT;
            OnAfterWhseActivLineInsert(WhseActivLine2);

            TempWhseActivLine.DELETE;
            LineNo := LineNo + 10000;

            TempWhseActivLine.COPY(WhseActivLine3);
            WhseActivLine."Original Breakbulk" := WhseActivLine2."Original Breakbulk";
            IF BreakbulkFilter THEN
              WhseActivLine.Breakbulk := WhseActivLine."Original Breakbulk";
          UNTIL TempWhseActivLine.NEXT = 0;
      END;

      TempWhseActivLine.COPY(TempWhseActivLine2);
    END;

    LOCAL PROCEDURE CreateWhseDocPlaceLine@27(PickQty@1004 : Decimal;PickQtyBase@1005 : Decimal;VAR LineNo@1001 : Integer);
    VAR
      WhseActivLine@1000 : Record 5767;
      TempWhseActivLine2@1002 : TEMPORARY Record 5767;
      TempWhseActivLine3@1003 : TEMPORARY Record 5767;
    BEGIN
      TempWhseActivLine2.COPY(TempWhseActivLine);
      TempWhseActivLine.SETCURRENTKEY(
        "Whse. Document No.","Whse. Document Type","Activity Type","Whse. Document Line No.","Action Type");
      TempWhseActivLine.SETRANGE("Whse. Document No.",TempWhseActivLine2."Whse. Document No.");
      TempWhseActivLine.SETRANGE("Whse. Document Type",TempWhseActivLine2."Whse. Document Type");
      TempWhseActivLine.SETRANGE("Activity Type",TempWhseActivLine2."Activity Type");
      TempWhseActivLine.SETRANGE("Whse. Document Line No.",TempWhseActivLine2."Whse. Document Line No.");
      TempWhseActivLine.SETRANGE("Source Subline No.",TempWhseActivLine2."Source Subline No.");
      TempWhseActivLine.SETRANGE("No.",TempWhseActivLine2."No.");
      TempWhseActivLine.SETRANGE("Action Type",TempWhseActivLine2."Action Type"::Place);
      TempWhseActivLine.SETFILTER("Line No.",'>%1',TempWhseActivLine2."Line No.");
      TempWhseActivLine.SETRANGE("Bin Code");
      TempWhseActivLine.SETRANGE("Zone Code");
      TempWhseActivLine.SETRANGE("Item No.",TempWhseActivLine2."Item No.");
      TempWhseActivLine.SETRANGE("Variant Code",TempWhseActivLine2."Variant Code");
      TempWhseActivLine.SETRANGE("Breakbulk No.",0);
      TempWhseActivLine.SetTrackingFilter(TempWhseActivLine2."Serial No.",TempWhseActivLine2."Lot No.");
      OnCreateWhseDocPlaceLineOnAfterSetFilters(TempWhseActivLine,TempWhseActivLine2,LineNo);
      IF TempWhseActivLine.FIND('-') THEN
        REPEAT
          LineNo := LineNo + 10000;
          WhseActivLine.INIT;
          WhseActivLine := TempWhseActivLine;

          WITH WhseActivLine DO
            IF (PickQty * "Qty. per Unit of Measure") <> PickQtyBase THEN
              PickQty := ROUND(PickQtyBase / "Qty. per Unit of Measure",UOMMgt.QtyRndPrecision);

          PickQtyBase := PickQtyBase - WhseActivLine."Qty. (Base)";
          PickQty := PickQty - WhseActivLine.Quantity;

          WhseActivLine."No." := WhseActivHeader."No.";
          WhseActivLine."Line No." := LineNo;

          IF NOT (WhseActivLine."Whse. Document Type" IN [
                                                          WhseActivLine."Whse. Document Type"::"Internal Pick",
                                                          WhseActivLine."Whse. Document Type"::"Movement Worksheet"])
          THEN
            WhseActivLine."Source Document" := WhseMgt.GetSourceDocument(WhseActivLine."Source Type",WhseActivLine."Source Subtype");

          TempWhseActivLine.DELETE;
          IF PickQtyBase > 0 THEN BEGIN
            TempWhseActivLine3.COPY(TempWhseActivLine);
            TempWhseActivLine.SETRANGE(
              "Unit of Measure Code",WhseActivLine."Unit of Measure Code");
            TempWhseActivLine.SETFILTER("Line No.",'>%1',TempWhseActivLine."Line No.");
            TempWhseActivLine.SETRANGE("No.",TempWhseActivLine2."No.");
            TempWhseActivLine.SETRANGE("Bin Code",WhseActivLine."Bin Code");
            IF TempWhseActivLine.FIND('-') THEN BEGIN
              REPEAT
                IF TempWhseActivLine."Qty. (Base)" >= PickQtyBase THEN BEGIN
                  WhseActivLine.Quantity := WhseActivLine.Quantity + PickQty;
                  WhseActivLine."Qty. (Base)" := WhseActivLine."Qty. (Base)" + PickQtyBase;
                  PickQty := 0;
                  PickQtyBase := 0;
                END ELSE BEGIN
                  WhseActivLine.Quantity := WhseActivLine.Quantity + TempWhseActivLine.Quantity;
                  WhseActivLine."Qty. (Base)" := WhseActivLine."Qty. (Base)" + TempWhseActivLine."Qty. (Base)";
                  PickQty := PickQty - TempWhseActivLine.Quantity;
                  PickQtyBase := PickQtyBase - TempWhseActivLine."Qty. (Base)";
                  TempWhseActivLine.DELETE;
                END;
              UNTIL (TempWhseActivLine.NEXT = 0) OR (PickQtyBase = 0);
            END ELSE
              IF TempWhseActivLine.DELETE THEN;
            TempWhseActivLine.COPY(TempWhseActivLine3);
          END;

          IF WhseActivLine.Quantity > 0 THEN BEGIN
            TempWhseActivLine3 := WhseActivLine;
            WhseActivLine.VALIDATE(Quantity);
            WhseActivLine."Qty. (Base)" := TempWhseActivLine3."Qty. (Base)";
            WhseActivLine."Qty. Outstanding (Base)" := TempWhseActivLine3."Qty. (Base)";
            WhseActivLine."Qty. to Handle (Base)" := TempWhseActivLine3."Qty. (Base)";
            IF DoNotFillQtytoHandle THEN BEGIN
              WhseActivLine."Qty. to Handle" := 0;
              WhseActivLine."Qty. to Handle (Base)" := 0;
              WhseActivLine.Cubage := 0;
              WhseActivLine.Weight := 0;
            END;
            WhseActivLine.INSERT;
            OnAfterWhseActivLineInsert(WhseActivLine);
          END;
        UNTIL (TempWhseActivLine.NEXT = 0) OR (PickQtyBase = 0);

      TempWhseActivLine.COPY(TempWhseActivLine2);
    END;

    LOCAL PROCEDURE AssignSpecEquipment@10(LocationCode@1000 : Code[10];BinCode@1002 : Code[20];ItemNo@1003 : Code[20];VariantCode@1004 : Code[10]) : Code[10];
    BEGIN
      IF (BinCode <> '') AND
         (Location."Special Equipment" =
          Location."Special Equipment"::"According to Bin")
      THEN BEGIN
        GetBin(LocationCode,BinCode);
        IF Bin."Special Equipment Code" <> '' THEN
          EXIT(Bin."Special Equipment Code");

        GetSKU(LocationCode,ItemNo,VariantCode);
        IF SKU."Special Equipment Code" <> '' THEN
          EXIT(SKU."Special Equipment Code");

        GetItem(ItemNo);
        EXIT(Item."Special Equipment Code");
      END;
      GetSKU(LocationCode,ItemNo,VariantCode);
      IF SKU."Special Equipment Code" <> '' THEN
        EXIT(SKU."Special Equipment Code");

      GetItem(ItemNo);
      IF Item."Special Equipment Code" <> '' THEN
        EXIT(Item."Special Equipment Code");

      GetBin(LocationCode,BinCode);
      EXIT(Bin."Special Equipment Code");
    END;

    LOCAL PROCEDURE CalcAvailableQty@48(ItemNo@1002 : Code[20];VariantCode@1001 : Code[10]) : Decimal;
    VAR
      AvailableQtyBase@1004 : Decimal;
      LineReservedQty@1005 : Decimal;
      QtyReservedOnPickShip@1006 : Decimal;
      WhseSource2@1000 : Option;
    BEGIN
      // For locations with pick/ship and without directed put-away and pick
      GetItem(ItemNo);
      AvailableQtyBase := WhseAvailMgt.CalcInvtAvailQty(Item,Location,VariantCode,TempWhseActivLine);

      IF (WhseSource = WhseSource::Shipment) AND WhseShptLine."Assemble to Order" THEN
        WhseSource2 := WhseSource::Assembly
      ELSE
        WhseSource2 := WhseSource;
      CASE WhseSource2 OF
        WhseSource::"Pick Worksheet",WhseSource::"Movement Worksheet":
          LineReservedQty :=
            WhseAvailMgt.CalcLineReservedQtyOnInvt(
              WhseWkshLine."Source Type",
              WhseWkshLine."Source Subtype",
              WhseWkshLine."Source No.",
              WhseWkshLine."Source Line No.",
              WhseWkshLine."Source Subline No.",
              TRUE,'','',TempWhseActivLine);
        WhseSource::Shipment:
          LineReservedQty :=
            WhseAvailMgt.CalcLineReservedQtyOnInvt(
              WhseShptLine."Source Type",
              WhseShptLine."Source Subtype",
              WhseShptLine."Source No.",
              WhseShptLine."Source Line No.",
              0,
              TRUE,'','',TempWhseActivLine);
        WhseSource::Production:
          LineReservedQty :=
            WhseAvailMgt.CalcLineReservedQtyOnInvt(
              DATABASE::"Prod. Order Component",
              ProdOrderCompLine.Status,
              ProdOrderCompLine."Prod. Order No.",
              ProdOrderCompLine."Prod. Order Line No.",
              ProdOrderCompLine."Line No.",
              TRUE,'','',TempWhseActivLine);
        WhseSource::Assembly:
          LineReservedQty :=
            WhseAvailMgt.CalcLineReservedQtyOnInvt(
              DATABASE::"Assembly Line",
              AssemblyLine."Document Type",
              AssemblyLine."Document No.",
              AssemblyLine."Line No.",
              0,
              TRUE,'','',TempWhseActivLine);
      END;

      QtyReservedOnPickShip := WhseAvailMgt.CalcReservQtyOnPicksShips(Location.Code,ItemNo,VariantCode,TempWhseActivLine);

      EXIT(AvailableQtyBase + LineReservedQty + QtyReservedOnPickShip);
    END;

    LOCAL PROCEDURE CalcPickQtyAssigned@40(LocationCode@1000 : Code[10];ItemNo@1001 : Code[20];VariantCode@1002 : Code[10];UOMCode@1004 : Code[10];BinCode@1005 : Code[20];VAR TempWhseItemTrackingLine@1006 : TEMPORARY Record 6550) PickQtyAssigned : Decimal;
    VAR
      WhseActivLine2@1003 : Record 5767;
    BEGIN
      WhseActivLine2.COPY(TempWhseActivLine);
      WITH TempWhseActivLine DO BEGIN
        RESET;
        SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Action Type","Variant Code",
          "Unit of Measure Code","Breakbulk No.","Activity Type","Lot No.","Serial No.");
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Location Code",LocationCode);
        IF Location."Bin Mandatory" THEN BEGIN
          SETRANGE("Action Type","Action Type"::Take);
          IF BinCode <> '' THEN
            SETRANGE("Bin Code",BinCode)
          ELSE
            SETFILTER("Bin Code",'<>%1','');
        END ELSE BEGIN
          SETRANGE("Action Type","Action Type"::" ");
          SETRANGE("Bin Code",'');
        END;
        SETRANGE("Variant Code",VariantCode);
        IF UOMCode <> '' THEN
          SETRANGE("Unit of Measure Code",UOMCode);
        SETRANGE("Activity Type","Activity Type");
        SETRANGE("Breakbulk No.",0);
        IF WhseItemTrkgExists THEN BEGIN
          IF TempWhseItemTrackingLine."Lot No." <> '' THEN
            SETRANGE("Lot No.",TempWhseItemTrackingLine."Lot No.");
          IF TempWhseItemTrackingLine."Serial No." <> '' THEN
            SETRANGE("Serial No.",TempWhseItemTrackingLine."Serial No.");
        END;
        CALCSUMS("Qty. Outstanding (Base)");
        PickQtyAssigned := "Qty. Outstanding (Base)";
      END;
      TempWhseActivLine.COPY(WhseActivLine2);
      EXIT(PickQtyAssigned);
    END;

    LOCAL PROCEDURE CalcQtyAssignedToPick@73(ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];VariantCode@1003 : Code[10];BinCode@1008 : Code[20];LotNo@1004 : Code[50];LNRequired@1005 : Boolean;SerialNo@1006 : Code[50];SNRequired@1007 : Boolean) : Decimal;
    VAR
      WhseActivLine@1000 : Record 5767;
    BEGIN
      WITH WhseActivLine DO BEGIN
        RESET;
        SETCURRENTKEY(
          "Item No.","Location Code","Activity Type","Bin Type Code",
          "Unit of Measure Code","Variant Code","Breakbulk No.","Action Type");

        SETRANGE("Item No.",ItemNo);
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Activity Type","Activity Type"::Pick);
        SETRANGE("Variant Code",VariantCode);
        SETRANGE("Breakbulk No.",0);
        SETFILTER("Action Type",'%1|%2',"Action Type"::" ","Action Type"::Take);
        SETFILTER("Bin Code",BinCode);
        IF LotNo <> '' THEN
          IF LNRequired THEN
            SETRANGE("Lot No.",LotNo)
          ELSE
            SETFILTER("Lot No.",'%1|%2',LotNo,'');
        IF SerialNo <> '' THEN
          IF SNRequired THEN
            SETRANGE("Serial No.",SerialNo)
          ELSE
            SETFILTER("Serial No.",'%1|%2',SerialNo,'');
        OnCalcQtyAssignedToPickOnAfterSetFilters(WhseActivLine);
        CALCSUMS("Qty. Outstanding (Base)");

        EXIT("Qty. Outstanding (Base)" + CalcBreakbulkOutstdQty(WhseActivLine,LNRequired,SNRequired));
      END;
    END;

    LOCAL PROCEDURE UseForPick@35(FromBinContent@1000 : Record 7302) : Boolean;
    BEGIN
      WITH FromBinContent DO BEGIN
        IF "Block Movement" IN ["Block Movement"::Outbound,"Block Movement"::All] THEN
          EXIT(FALSE);

        GetBinType("Bin Type Code");
        EXIT(BinType.Pick);
      END;
    END;

    LOCAL PROCEDURE UseForReplenishment@60(FromBinContent@1000 : Record 7302) : Boolean;
    BEGIN
      WITH FromBinContent DO BEGIN
        IF "Block Movement" IN ["Block Movement"::Outbound,"Block Movement"::All] THEN
          EXIT(FALSE);

        GetBinType("Bin Type Code");
        EXIT(NOT (BinType.Receive OR BinType.Ship));
      END;
    END;

    LOCAL PROCEDURE GetLocation@3(LocationCode@1000 : Code[10]);
    BEGIN
      IF LocationCode = '' THEN
        Location := WhseSetupLocation
      ELSE
        IF Location.Code <> LocationCode THEN
          Location.GET(LocationCode);
    END;

    LOCAL PROCEDURE GetBinType@62(BinTypeCode@1000 : Code[10]);
    BEGIN
      IF BinTypeCode = '' THEN
        BinType.INIT
      ELSE
        IF BinType.Code <> BinTypeCode THEN
          BinType.GET(BinTypeCode);
    END;

    LOCAL PROCEDURE GetBin@9(LocationCode@1000 : Code[10];BinCode@1002 : Code[20]);
    BEGIN
      IF (Bin."Location Code" <> LocationCode) OR
         (Bin.Code <> BinCode)
      THEN
        IF NOT Bin.GET(LocationCode,BinCode) THEN
          CLEAR(Bin);
    END;

    LOCAL PROCEDURE GetItem@17(ItemNo@1000 : Code[20]);
    BEGIN
      IF Item."No." <> ItemNo THEN
        Item.GET(ItemNo);
    END;

    LOCAL PROCEDURE GetSKU@11(LocationCode@1000 : Code[10];ItemNo@1001 : Code[20];VariantCode@1002 : Code[10]) : Boolean;
    BEGIN
      IF (SKU."Location Code" <> LocationCode) OR
         (SKU."Item No." <> ItemNo) OR
         (SKU."Variant Code" <> VariantCode)
      THEN
        IF NOT SKU.GET(LocationCode,ItemNo,VariantCode) THEN BEGIN
          CLEAR(SKU);
          EXIT(FALSE)
        END;
      EXIT(TRUE);
    END;

    [External]
    PROCEDURE SetValues@1(AssignedID2@1002 : Code[50];WhseDocument2@1001 : 'Pick Worksheet,Shipment,Movement Worksheet,Internal Pick,Production,Assembly';SortPick2@1003 : ' ,Item,Document,Shelf/Bin No.,Due Date,Ship-To,Bin Ranking,Action Type';WhseDocType2@1000 : 'Put-away,Pick,Movement';MaxNoOfSourceDoc2@1005 : Integer;MaxNoOfLines2@1006 : Integer;PerZone2@1004 : Boolean;DoNotFillQtytoHandle2@1009 : Boolean;BreakbulkFilter2@1010 : Boolean;PerBin2@1011 : Boolean);
    BEGIN
      WhseSource := WhseDocument2;
      AssignedID := AssignedID2;
      SortPick := SortPick2;
      WhseDocType := WhseDocType2;
      PerBin := PerBin2;
      IF PerBin THEN
        PerZone := FALSE
      ELSE
        PerZone := PerZone2;
      DoNotFillQtytoHandle := DoNotFillQtytoHandle2;
      MaxNoOfSourceDoc := MaxNoOfSourceDoc2;
      MaxNoOfLines := MaxNoOfLines2;
      BreakbulkFilter := BreakbulkFilter2;
      WhseSetup.GET;
      WhseSetupLocation.GetLocationSetup('',WhseSetupLocation);
      CLEAR(TempWhseActivLine);
      LastWhseItemTrkgLineNo := 0;

      OnAfterSetValues(
        AssignedID,SortPick,MaxNoOfSourceDoc,MaxNoOfLines,PerBin,PerZone,DoNotFillQtytoHandle,BreakbulkFilter,WhseSource);
    END;

    [External]
    PROCEDURE SetWhseWkshLine@2(WhseWkshLine2@1000 : Record 7326;TempNo2@1001 : Integer);
    BEGIN
      WhseWkshLine := WhseWkshLine2;
      TempNo := TempNo2;
      SetSource(
        WhseWkshLine2."Source Type",
        WhseWkshLine2."Source Subtype",
        WhseWkshLine2."Source No.",
        WhseWkshLine2."Source Line No.",
        WhseWkshLine2."Source Subline No.");

      OnAfterSetWhseWkshLine(WhseWkshLine);
    END;

    [External]
    PROCEDURE SetWhseShipment@16(WhseShptLine2@1000 : Record 7321;TempNo2@1001 : Integer;ShippingAgentCode2@1004 : Code[10];ShippingAgentServiceCode2@1003 : Code[10];ShipmentMethodCode2@1002 : Code[10]);
    BEGIN
      WhseShptLine := WhseShptLine2;
      TempNo := TempNo2;
      ShippingAgentCode := ShippingAgentCode2;
      ShippingAgentServiceCode := ShippingAgentServiceCode2;
      ShipmentMethodCode := ShipmentMethodCode2;
      SetSource(
        WhseShptLine2."Source Type",
        WhseShptLine2."Source Subtype",
        WhseShptLine2."Source No.",
        WhseShptLine2."Source Line No.",
        0);

      OnAfterSetWhseShipment(WhseShptLine);
    END;

    [External]
    PROCEDURE SetWhseInternalPickLine@23(WhseInternalPickLine2@1000 : Record 7334;TempNo2@1001 : Integer);
    BEGIN
      WhseInternalPickLine := WhseInternalPickLine2;
      TempNo := TempNo2;

      OnAfterSetWhseInternalPickLine(WhseInternalPickLine);
    END;

    [External]
    PROCEDURE SetProdOrderCompLine@22(ProdOrderCompLine2@1000 : Record 5407;TempNo2@1001 : Integer);
    BEGIN
      ProdOrderCompLine := ProdOrderCompLine2;
      TempNo := TempNo2;
      SetSource(
        DATABASE::"Prod. Order Component",
        ProdOrderCompLine2.Status,
        ProdOrderCompLine2."Prod. Order No.",
        ProdOrderCompLine2."Prod. Order Line No.",
        ProdOrderCompLine2."Line No.");

      OnAfterSetProdOrderCompLine(ProdOrderCompLine);
    END;

    [External]
    PROCEDURE SetAssemblyLine@54(AssemblyLine2@1000 : Record 901;TempNo2@1001 : Integer);
    BEGIN
      AssemblyLine := AssemblyLine2;
      TempNo := TempNo2;
      SetSource(
        DATABASE::"Assembly Line",
        AssemblyLine2."Document Type",
        AssemblyLine2."Document No.",
        AssemblyLine2."Line No.",
        0);

      OnAfterSetAssemblyLine(AssemblyLine);
    END;

    [External]
    PROCEDURE SetTempWhseItemTrkgLine@28(SourceID@1001 : Code[20];SourceType@1002 : Integer;SourceBatchName@1003 : Code[10];SourceProdOrderLine@1004 : Integer;SourceRefNo@1005 : Integer;LocationCode@1006 : Code[10]);
    VAR
      WhseItemTrackingLine@1000 : Record 6550;
    BEGIN
      TempWhseItemTrackingLine.DELETEALL;
      TempWhseItemTrackingLine.INIT;
      WhseItemTrkgLineCount := 0;
      WhseItemTrkgExists := FALSE;
      WhseItemTrackingLine.RESET;
      WhseItemTrackingLine.SETCURRENTKEY(
        "Source ID","Source Type","Source Subtype","Source Batch Name",
        "Source Prod. Order Line","Source Ref. No.","Location Code");
      WhseItemTrackingLine.SETRANGE("Source ID",SourceID);
      WhseItemTrackingLine.SETRANGE("Source Type",SourceType);
      WhseItemTrackingLine.SETRANGE("Source Batch Name",SourceBatchName);
      WhseItemTrackingLine.SETRANGE("Source Prod. Order Line",SourceProdOrderLine);
      WhseItemTrackingLine.SETRANGE("Source Ref. No.",SourceRefNo);
      WhseItemTrackingLine.SETRANGE("Location Code",LocationCode);
      IF WhseItemTrackingLine.FIND('-') THEN
        REPEAT
          IF WhseItemTrackingLine."Qty. to Handle (Base)" > 0 THEN BEGIN
            TempWhseItemTrackingLine := WhseItemTrackingLine;
            TempWhseItemTrackingLine."Entry No." := LastWhseItemTrkgLineNo + 1;
            TempWhseItemTrackingLine.INSERT;
            LastWhseItemTrkgLineNo := TempWhseItemTrackingLine."Entry No.";
            WhseItemTrkgExists := TRUE;
            WhseItemTrkgLineCount += 1;
          END;
        UNTIL WhseItemTrackingLine.NEXT = 0;

      OnAfterCreateTempWhseItemTrackingLines(TempWhseItemTrackingLine);

      SourceWhseItemTrackingLine.INIT;
      SourceWhseItemTrackingLine."Source Type" := SourceType;
      SourceWhseItemTrackingLine."Source ID" := SourceID;
      SourceWhseItemTrackingLine."Source Batch Name" := SourceBatchName;
      SourceWhseItemTrackingLine."Source Prod. Order Line" := SourceProdOrderLine;
      SourceWhseItemTrackingLine."Source Ref. No." := SourceRefNo;
    END;

    LOCAL PROCEDURE SaveTempItemTrkgLines@31();
    VAR
      i@1000 : Integer;
    BEGIN
      IF WhseItemTrkgLineCount = 0 THEN
        EXIT;

      i := 0;
      TempWhseItemTrackingLine.RESET;
      IF TempWhseItemTrackingLine.FIND('-') THEN
        REPEAT
          TempTotalWhseItemTrackingLine := TempWhseItemTrackingLine;
          TempTotalWhseItemTrackingLine.INSERT;
          i += 1;
        UNTIL (TempWhseItemTrackingLine.NEXT = 0) OR (i = WhseItemTrkgLineCount);
    END;

    [External]
    PROCEDURE ReturnTempItemTrkgLines@30(VAR TempWhseItemTrackingLine2@1002 : TEMPORARY Record 6550);
    BEGIN
      IF TempTotalWhseItemTrackingLine.FIND('-') THEN
        REPEAT
          TempWhseItemTrackingLine2 := TempTotalWhseItemTrackingLine;
          TempWhseItemTrackingLine2.INSERT;
        UNTIL TempTotalWhseItemTrackingLine.NEXT = 0;
    END;

    LOCAL PROCEDURE CreateTempItemTrkgLines@51(ItemNo@1005 : Code[20];VariantCode@1004 : Code[10];TotalQtyToPickBase@1002 : Decimal;HasExpiryDate@1220 : Boolean);
    VAR
      EntrySummary@1007 : Record 338;
      DummyEntrySummary2@1200 : Record 338;
      WhseItemTrackingFEFO@1001 : Codeunit 7326;
      TotalAvailQtyToPickBase@1006 : Decimal;
      RemQtyToPickBase@1009 : Decimal;
      QtyToPickBase@1008 : Decimal;
      QtyTracked@1000 : Decimal;
      FromBinContentQty@1102 : Decimal;
      QtyCanBePicked@1003 : Decimal;
      IsHandled@1010 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCreateTempItemTrkgLines(Location,ItemNo,VariantCode,TotalQtyToPickBase,HasExpiryDate,IsHandled);
      IF IsHandled THEN
        EXIT;

      IF NOT HasExpiryDate THEN
        IF TotalQtyToPickBase <= 0 THEN
          EXIT;

      WhseItemTrackingFEFO.SetSource(SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo);
      WhseItemTrackingFEFO.SetCalledFromMovementWksh(CalledFromMoveWksh);
      WhseItemTrackingFEFO.CreateEntrySummaryFEFO(Location,ItemNo,VariantCode,HasExpiryDate);

      RemQtyToPickBase := TotalQtyToPickBase;
      IF HasExpiryDate THEN
        TransferRemQtyToPickBase := TotalQtyToPickBase;
      IF WhseItemTrackingFEFO.FindFirstEntrySummaryFEFO(EntrySummary) THEN BEGIN
        ReqFEFOPick := TRUE;
        REPEAT
          IF ((EntrySummary."Expiration Date" <> 0D) AND HasExpiryDate) OR
             ((EntrySummary."Expiration Date" = 0D) AND (NOT HasExpiryDate))
          THEN BEGIN
            QtyTracked := ItemTrackedQuantity(EntrySummary."Lot No.",EntrySummary."Serial No.");

            IF NOT ((EntrySummary."Serial No." <> '') AND (QtyTracked > 0)) THEN BEGIN
              TotalAvailQtyToPickBase :=
                CalcTotalAvailQtyToPick(
                  Location.Code,ItemNo,VariantCode,
                  EntrySummary."Lot No.",EntrySummary."Serial No.",
                  SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,0,HasExpiryDate);

              IF CalledFromWksh AND (WhseWkshLine."From Bin Code" <> '') THEN BEGIN
                FromBinContentQty :=
                  GetFromBinContentQty(
                    WhseWkshLine."Location Code",WhseWkshLine."From Bin Code",WhseWkshLine."Item No.",
                    WhseWkshLine."Variant Code",WhseWkshLine."From Unit of Measure Code",
                    EntrySummary."Lot No.",EntrySummary."Serial No.");
                IF TotalAvailQtyToPickBase > FromBinContentQty THEN
                  TotalAvailQtyToPickBase := FromBinContentQty;
              END;

              QtyCanBePicked :=
                CalcQtyCanBePicked(Location.Code,ItemNo,VariantCode,
                  EntrySummary."Lot No.",EntrySummary."Serial No.",CalledFromMoveWksh);
              TotalAvailQtyToPickBase := Minimum(TotalAvailQtyToPickBase,QtyCanBePicked);

              TotalAvailQtyToPickBase := TotalAvailQtyToPickBase - QtyTracked;
              QtyToPickBase := 0;

              OnBeforeInsertTempItemTrkgLine(EntrySummary,RemQtyToPickBase,TotalAvailQtyToPickBase);

              IF TotalAvailQtyToPickBase > 0 THEN
                IF TotalAvailQtyToPickBase >= RemQtyToPickBase THEN BEGIN
                  QtyToPickBase := RemQtyToPickBase;
                  RemQtyToPickBase := 0
                END ELSE BEGIN
                  QtyToPickBase := TotalAvailQtyToPickBase;
                  RemQtyToPickBase := RemQtyToPickBase - QtyToPickBase;
                END;

              IF QtyToPickBase > 0 THEN
                InsertTempItemTrkgLine(Location.Code,ItemNo,VariantCode,EntrySummary,QtyToPickBase);
            END;
          END;
        UNTIL NOT WhseItemTrackingFEFO.FindNextEntrySummaryFEFO(EntrySummary) OR (RemQtyToPickBase = 0);
        IF HasExpiryDate THEN
          TransferRemQtyToPickBase := RemQtyToPickBase;
      END;
      IF NOT HasExpiryDate THEN
        IF RemQtyToPickBase > 0 THEN
          IF Location."Always Create Pick Line" THEN
            InsertTempItemTrkgLine(Location.Code,ItemNo,VariantCode,DummyEntrySummary2,RemQtyToPickBase);
      IF NOT HasExpiredItems THEN BEGIN
        HasExpiredItems := WhseItemTrackingFEFO.GetHasExpiredItems;
        EnqueueCannotBeHandledReason(WhseItemTrackingFEFO.GetResultMessageForExpiredItem);
      END;
    END;

    [External]
    PROCEDURE ItemTrackedQuantity@63(LotNo@1003 : Code[50];SerialNo@1002 : Code[50]) : Decimal;
    BEGIN
      WITH TempWhseItemTrackingLine DO BEGIN
        RESET;
        IF (LotNo = '') AND (SerialNo = '') THEN
          IF ISEMPTY THEN
            EXIT(0);

        IF SerialNo <> '' THEN BEGIN
          SETCURRENTKEY("Serial No.","Lot No.");
          SETRANGE("Serial No.",SerialNo);
          IF ISEMPTY THEN
            EXIT(0);

          EXIT(1);
        END;

        IF LotNo <> '' THEN BEGIN
          SETCURRENTKEY("Serial No.","Lot No.");
          SETRANGE("Lot No.",LotNo);
          IF ISEMPTY THEN
            EXIT(0);
        END;

        SETCURRENTKEY(
          "Source ID","Source Type","Source Subtype","Source Batch Name",
          "Source Prod. Order Line","Source Ref. No.","Location Code");
        IF LotNo <> '' THEN
          SETRANGE("Lot No.",LotNo);
        CALCSUMS("Qty. to Handle (Base)");
        EXIT("Qty. to Handle (Base)");
      END;
    END;

    [External]
    PROCEDURE InsertTempItemTrkgLine@59(LocationCode@1003 : Code[10];ItemNo@1002 : Code[20];VariantCode@1000 : Code[10];EntrySummary@1004 : Record 338;QuantityBase@1001 : Decimal);
    BEGIN
      WITH TempWhseItemTrackingLine DO BEGIN
        INIT;
        "Entry No." := LastWhseItemTrkgLineNo + 1;
        "Location Code" := LocationCode;
        "Item No." := ItemNo;
        "Variant Code" := VariantCode;
        "Lot No." := EntrySummary."Lot No.";
        "Serial No." := EntrySummary."Serial No.";
        "Expiration Date" := EntrySummary."Expiration Date";
        "Source ID" := SourceWhseItemTrackingLine."Source ID";
        "Source Type" := SourceWhseItemTrackingLine."Source Type";
        "Source Batch Name" := SourceWhseItemTrackingLine."Source Batch Name";
        "Source Prod. Order Line" := SourceWhseItemTrackingLine."Source Prod. Order Line";
        "Source Ref. No." := SourceWhseItemTrackingLine."Source Ref. No.";
        VALIDATE("Quantity (Base)",QuantityBase);
        OnBeforeTempWhseItemTrkgLineInsert(TempWhseItemTrackingLine,SourceWhseItemTrackingLine,EntrySummary);
        INSERT;
        LastWhseItemTrkgLineNo := "Entry No.";
        WhseItemTrkgExists := TRUE;
      END;
    END;

    LOCAL PROCEDURE TransferItemTrkgFields@13(VAR WhseActivLine2@1000 : Record 5767;TempWhseItemTrackingLine@1001 : TEMPORARY Record 6550);
    VAR
      EntriesExist@1002 : Boolean;
    BEGIN
      IF WhseItemTrkgExists THEN BEGIN
        IF TempWhseItemTrackingLine."Serial No." <> '' THEN
          TempWhseItemTrackingLine.TESTFIELD("Qty. per Unit of Measure",1);
        WhseActivLine2."Serial No." := TempWhseItemTrackingLine."Serial No.";
        WhseActivLine2."Lot No." := TempWhseItemTrackingLine."Lot No.";
        WhseActivLine2."Warranty Date" := TempWhseItemTrackingLine."Warranty Date";
        IF TempWhseItemTrackingLine.TrackingExists THEN
          WhseActivLine2."Expiration Date" :=
            ItemTrackingMgt.ExistingExpirationDate(
              TempWhseItemTrackingLine."Item No.",TempWhseItemTrackingLine."Variant Code",
              TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.",
              FALSE,EntriesExist);
        OnAfterTransferItemTrkgFields(WhseActivLine2,TempWhseItemTrackingLine,EntriesExist);
      END ELSE
        IF SNRequired THEN
          WhseActivLine2.TESTFIELD("Qty. per Unit of Measure",1);
    END;

    [External]
    PROCEDURE SetSource@57(SourceType2@1004 : Integer;SourceSubType2@1003 : Option;SourceNo2@1002 : Code[20];SourceLineNo2@1001 : Integer;SourceSubLineNo2@1000 : Integer);
    BEGIN
      SourceType := SourceType2;
      SourceSubType := SourceSubType2;
      SourceNo := SourceNo2;
      SourceLineNo := SourceLineNo2;
      SourceSubLineNo := SourceSubLineNo2;
    END;

    [External]
    PROCEDURE CheckReservation@45(QtyBaseAvailToPick@1000 : Decimal;SourceType@1005 : Integer;SourceSubType@1004 : Option;SourceNo@1003 : Code[20];SourceLineNo@1002 : Integer;SourceSubLineNo@1001 : Integer;AlwaysCreatePickLine@1011 : Boolean;QtyPerUnitOfMeasure@1013 : Decimal;VAR Quantity@1006 : Decimal;VAR QuantityBase@1008 : Decimal);
    VAR
      ReservEntry@1010 : Record 337;
      WhseManagement@1014 : Codeunit 5775;
      Quantity2@1012 : Decimal;
      QuantityBase2@1009 : Decimal;
      QtyBaseResvdNotOnILE@1015 : Decimal;
      QtyResvdNotOnILE@1016 : Decimal;
      SrcDocQtyBaseToBeFilledByInvt@1017 : Decimal;
      SrcDocQtyToBeFilledByInvt@1018 : Decimal;
    BEGIN
      ReservationExists := FALSE;
      ReservedForItemLedgEntry := FALSE;
      Quantity2 := Quantity;
      QuantityBase2 := QuantityBase;

      SetFiltersOnReservEntry(ReservEntry,SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo);
      IF ReservEntry.FIND('-') THEN BEGIN
        ReservationExists := TRUE;
        REPEAT
          QtyResvdNotOnILE += CalcQtyResvdNotOnILE(ReservEntry."Entry No.",ReservEntry.Positive);
        UNTIL ReservEntry.NEXT = 0;
        QtyBaseResvdNotOnILE := QtyResvdNotOnILE;
        QtyResvdNotOnILE := ROUND(QtyResvdNotOnILE / QtyPerUnitOfMeasure,UOMMgt.QtyRndPrecision);

        WhseManagement.GetOutboundDocLineQtyOtsdg(SourceType,SourceSubType,
          SourceNo,SourceLineNo,SourceSubLineNo,SrcDocQtyToBeFilledByInvt,SrcDocQtyBaseToBeFilledByInvt);
        SrcDocQtyBaseToBeFilledByInvt := SrcDocQtyBaseToBeFilledByInvt - QtyBaseResvdNotOnILE;
        SrcDocQtyToBeFilledByInvt := SrcDocQtyToBeFilledByInvt - QtyResvdNotOnILE;

        IF QuantityBase > SrcDocQtyBaseToBeFilledByInvt THEN BEGIN
          QuantityBase := SrcDocQtyBaseToBeFilledByInvt;
          Quantity := SrcDocQtyToBeFilledByInvt;
        END;

        IF QuantityBase <= SrcDocQtyBaseToBeFilledByInvt THEN
          IF (QuantityBase > QtyBaseAvailToPick) AND (QtyBaseAvailToPick >= 0) THEN BEGIN
            QuantityBase := QtyBaseAvailToPick;
            Quantity := ROUND(QtyBaseAvailToPick / QtyPerUnitOfMeasure,UOMMgt.QtyRndPrecision);
          END;

        ReservedForItemLedgEntry := QuantityBase <> 0;
        IF AlwaysCreatePickLine THEN BEGIN
          Quantity := Quantity2;
          QuantityBase := QuantityBase2;
        END;

        IF Quantity <= 0 THEN
          EnqueueCannotBeHandledReason(GetMessageForUnhandledQtyDueToReserv);
      END ELSE
        ReservationExists := FALSE;
    END;

    [External]
    PROCEDURE CalcTotalAvailQtyToPick@56(LocationCode@1003 : Code[10];ItemNo@1002 : Code[20];VariantCode@1001 : Code[10];LotNo@1013 : Code[50];SerialNo@1019 : Code[50];SourceType@1018 : Integer;SourceSubType@1017 : Option;SourceNo@1016 : Code[20];SourceLineNo@1015 : Integer;SourceSubLineNo@1014 : Integer;NeededQtyBase@1022 : Decimal;RespectLocationBins@1029 : Boolean) : Decimal;
    VAR
      WhseActivLine@1020 : Record 5767;
      TempWhseItemTrackingLine2@1100 : TEMPORARY Record 6550;
      TempTrackingSpecification@1006 : TEMPORARY Record 336;
      TotalAvailQtyBase@1004 : Decimal;
      QtyInWhse@1008 : Decimal;
      QtyOnPickBins@1007 : Decimal;
      QtyOnPutAwayBins@1025 : Decimal;
      QtyOnOutboundBins@1009 : Decimal;
      QtyOnReceiveBins@1000 : Decimal;
      QtyOnDedicatedBins@1026 : Decimal;
      QtyBlocked@1023 : Decimal;
      SubTotal@1010 : Decimal;
      QtyReservedOnPickShip@1011 : Decimal;
      LineReservedQty@1005 : Decimal;
      QtyAssignedPick@1012 : Decimal;
      QtyAssignedToPick@1021 : Decimal;
      AvailableAfterReshuffle@1024 : Decimal;
      QtyOnToBinsBase@1027 : Decimal;
      QtyOnToBinsBaseInPicks@1031 : Decimal;
      ReservedQtyOnInventory@1030 : Decimal;
      ResetWhseItemTrkgExists@1101 : Boolean;
      BinTypeFilter@1028 : Text[1024];
      IsHandled@1032 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforeCalcTotalAvailQtyToPick(
        LocationCode,ItemNo,VariantCode,LotNo,SerialNo,SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,
        NeededQtyBase,RespectLocationBins,CalledFromMoveWksh,CalledFromWksh,TempWhseActivLine,IsHandled,TotalAvailQtyBase);
      IF IsHandled THEN
        EXIT(TotalAvailQtyBase);

      // Directed put-away and pick
      GetLocation(LocationCode);

      ItemTrackingMgt.CheckWhseItemTrkgSetup(ItemNo,SNRequired,LNRequired,FALSE);
      ReservedQtyOnInventory :=
        CalcReservedQtyOnInventory(ItemNo,LocationCode,VariantCode,LotNo,LNRequired,SerialNo,SNRequired);
      QtyAssignedToPick := CalcQtyAssignedToPick(ItemNo,LocationCode,VariantCode,'',LotNo,LNRequired,SerialNo,SNRequired);

      QtyInWhse := SumWhseEntries(ItemNo,LocationCode,VariantCode,LNRequired,LotNo,SNRequired,SerialNo,'','',FALSE);

      // calculate quantity in receipt area and fixed receipt bin at location
      // quantity in pick bins is considered as total quantity on the warehouse excluding receipt area and fixed receipt bin
      CalcQtyOnPickAndReceiveBins(
        QtyOnReceiveBins,QtyOnPickBins,
        ItemNo,LocationCode,VariantCode,LNRequired,LotNo,SNRequired,SerialNo,RespectLocationBins);

      OnAfterCalcQtyOnPickAndReceiveBins(
        SourceType,LocationCode,ItemNo,VariantCode,LotNo,SerialNo,CalledFromPickWksh,CalledFromMoveWksh,CalledFromWksh,
        QtyInWhse,QtyOnPickBins,QtyOnPutAwayBins,QtyOnOutboundBins,QtyOnReceiveBins,QtyOnDedicatedBins,QtyBlocked);

      IF CalledFromMoveWksh THEN BEGIN
        BinTypeFilter := GetBinTypeFilter(4); // put-away only
        IF BinTypeFilter <> '' THEN
          QtyOnPutAwayBins :=
            SumWhseEntries(ItemNo,LocationCode,VariantCode,LNRequired,LotNo,SNRequired,SerialNo,BinTypeFilter,'',FALSE);

        IF WhseWkshLine."To Bin Code" <> '' THEN
          IF NOT IsShipZone(WhseWkshLine."Location Code",WhseWkshLine."To Zone Code") THEN BEGIN
            QtyOnToBinsBase :=
              SumWhseEntries(
                ItemNo,LocationCode,VariantCode,
                LNRequired,LotNo,SNRequired,SerialNo,'',WhseWkshLine."To Bin Code",FALSE);
            QtyOnToBinsBaseInPicks :=
              CalcQtyAssignedToPick(
                ItemNo,LocationCode,VariantCode,WhseWkshLine."To Bin Code",LotNo,LNRequired,SerialNo,SNRequired);
            QtyOnToBinsBase -= Minimum(QtyOnToBinsBase,QtyOnToBinsBaseInPicks);
          END;
      END;

      QtyOnOutboundBins := CalcQtyOnOutboundBins(LocationCode,ItemNo,VariantCode,LotNo,SerialNo,TRUE);

      QtyOnDedicatedBins := WhseAvailMgt.CalcQtyOnDedicatedBins(LocationCode,ItemNo,VariantCode,LotNo,SerialNo);

      QtyBlocked :=
        WhseAvailMgt.CalcQtyOnBlockedITOrOnBlockedOutbndBins(
          LocationCode,ItemNo,VariantCode,LotNo,SerialNo,LNRequired,SNRequired);

      TempWhseItemTrackingLine2.COPY(TempWhseItemTrackingLine);
      IF ReqFEFOPick THEN BEGIN
        TempWhseItemTrackingLine2."Entry No." := TempWhseItemTrackingLine2."Entry No." + 1;
        TempWhseItemTrackingLine2."Lot No." := LotNo;
        TempWhseItemTrackingLine2."Serial No." := SerialNo;
        IF NOT WhseItemTrkgExists THEN BEGIN
          WhseItemTrkgExists := TRUE;
          ResetWhseItemTrkgExists := TRUE;
        END;
      END;

      QtyAssignedPick := CalcPickQtyAssigned(LocationCode,ItemNo,VariantCode,'','',TempWhseItemTrackingLine2);

      IF ResetWhseItemTrkgExists THEN BEGIN
        WhseItemTrkgExists := FALSE;
        ResetWhseItemTrkgExists := FALSE;
      END;

      IF Location."Always Create Pick Line" OR CrossDock THEN BEGIN
        FilterWhsePickLinesWithUndefinedBin(
          WhseActivLine,ItemNo,LocationCode,VariantCode,LNRequired,LotNo,SNRequired,SerialNo);
        WhseActivLine.CALCSUMS("Qty. Outstanding (Base)");
        QtyAssignedPick := QtyAssignedPick - WhseActivLine."Qty. Outstanding (Base)";
      END;

      SubTotal :=
        QtyInWhse - QtyOnPickBins - QtyOnPutAwayBins - QtyOnOutboundBins - QtyOnDedicatedBins - QtyBlocked -
        QtyOnReceiveBins - ABS(ReservedQtyOnInventory);

      IF (SubTotal < 0) OR CalledFromPickWksh OR CalledFromMoveWksh THEN BEGIN
        TempTrackingSpecification."Lot No." := LotNo;
        TempTrackingSpecification."Serial No." := SerialNo;
        QtyReservedOnPickShip :=
          WhseAvailMgt.CalcReservQtyOnPicksShipsWithItemTracking(
            TempWhseActivLine,TempTrackingSpecification,LocationCode,ItemNo,VariantCode);

        LineReservedQty :=
          WhseAvailMgt.CalcLineReservedQtyOnInvt(
            SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,TRUE,'','',TempWhseActivLine);

        IF SubTotal < 0 THEN
          IF ABS(SubTotal) < QtyReservedOnPickShip + LineReservedQty THEN
            QtyReservedOnPickShip := ABS(SubTotal) - LineReservedQty;

        CASE TRUE OF
          CalledFromPickWksh:
            BEGIN
              TotalAvailQtyBase :=
                QtyOnPickBins - QtyAssignedToPick - ABS(ReservedQtyOnInventory) +
                QtyReservedOnPickShip + LineReservedQty;
              MovementFromShipZone(TotalAvailQtyBase,QtyOnOutboundBins + QtyBlocked);
            END;
          CalledFromMoveWksh:
            BEGIN
              TotalAvailQtyBase :=
                QtyOnPickBins + QtyOnPutAwayBins - QtyAssignedToPick - ABS(ReservedQtyOnInventory) +
                QtyReservedOnPickShip + LineReservedQty;
              IF CalledFromWksh THEN
                TotalAvailQtyBase := TotalAvailQtyBase - QtyAssignedPick - QtyOnPutAwayBins;
              MovementFromShipZone(TotalAvailQtyBase,QtyOnOutboundBins + QtyBlocked);
            END;
          ELSE
            TotalAvailQtyBase :=
              QtyOnPickBins -
              QtyAssignedPick - QtyAssignedToPick +
              SubTotal +
              QtyReservedOnPickShip +
              LineReservedQty;
        END
      END ELSE
        TotalAvailQtyBase := QtyOnPickBins - QtyAssignedPick - QtyAssignedToPick;

      IF (NeededQtyBase <> 0) AND (NeededQtyBase > TotalAvailQtyBase) THEN
        IF ReleaseNonSpecificReservations(
             LocationCode,ItemNo,VariantCode,LotNo,SerialNo,NeededQtyBase - TotalAvailQtyBase)
        THEN BEGIN
          AvailableAfterReshuffle :=
            CalcTotalAvailQtyToPick(
              LocationCode,ItemNo,VariantCode,
              TempWhseItemTrackingLine."Lot No.",TempWhseItemTrackingLine."Serial No.",
              SourceType,SourceSubType,SourceNo,SourceLineNo,SourceSubLineNo,0,FALSE);
          EXIT(AvailableAfterReshuffle);
        END;

      EXIT(TotalAvailQtyBase - QtyOnToBinsBase);
    END;

    LOCAL PROCEDURE CalcQtyOnPickAndReceiveBins@109(VAR QtyOnReceiveBins@1009 : Decimal;VAR QtyOnPickBins@1010 : Decimal;ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];VariantCode@1003 : Code[10];IsLNRequired@1004 : Boolean;LotNo@1005 : Code[50];IsSNRequired@1006 : Boolean;SerialNo@1007 : Code[50];RespectLocationBins@1008 : Boolean);
    VAR
      WhseEntry@1000 : Record 7312;
      BinTypeFilter@1011 : Text;
    BEGIN
      GetLocation(LocationCode);

      WITH WhseEntry DO BEGIN
        FilterWhseEntry(WhseEntry,ItemNo,LocationCode,VariantCode,IsLNRequired,LotNo,IsSNRequired,SerialNo,FALSE);
        BinTypeFilter := GetBinTypeFilter(0);
        IF BinTypeFilter <> '' THEN BEGIN
          IF RespectLocationBins AND (Location."Receipt Bin Code" <> '') THEN BEGIN
            SETRANGE("Bin Code",Location."Receipt Bin Code");
            CALCSUMS("Qty. (Base)");
            QtyOnReceiveBins := "Qty. (Base)";

            SETFILTER("Bin Code",'<>%1',Location."Receipt Bin Code");
          END;
          SETFILTER("Bin Type Code",BinTypeFilter); // Receive
          CALCSUMS("Qty. (Base)");
          QtyOnReceiveBins += "Qty. (Base)";

          SETFILTER("Bin Type Code",'<>%1',BinTypeFilter);
        END;
        CALCSUMS("Qty. (Base)");
        QtyOnPickBins := "Qty. (Base)";
      END;
    END;

    [External]
    PROCEDURE CalcQtyOnOutboundBins@43(LocationCode@1003 : Code[10];ItemNo@1002 : Code[20];VariantCode@1001 : Code[10];LotNo@1000 : Code[50];SerialNo@1008 : Code[50];ExcludeDedicatedBinContent@1010 : Boolean) QtyOnOutboundBins : Decimal;
    VAR
      WhseEntry@1005 : Record 7312;
      WhseShptLine@1009 : Record 7321;
    BEGIN
      // Directed put-away and pick
      GetLocation(LocationCode);

      IF Location."Directed Put-away and Pick" THEN
        WITH WhseEntry DO BEGIN
          FilterWhseEntry(
            WhseEntry,ItemNo,LocationCode,VariantCode,TRUE,LotNo,TRUE,SerialNo,ExcludeDedicatedBinContent);
          SETFILTER("Bin Type Code",GetBinTypeFilter(1)); // Shipping area
          CALCSUMS("Qty. (Base)");
          QtyOnOutboundBins := "Qty. (Base)";
          IF Location."Adjustment Bin Code" <> '' THEN BEGIN
            SETRANGE("Bin Type Code");
            SETRANGE("Bin Code",Location."Adjustment Bin Code");
            CALCSUMS("Qty. (Base)");
            QtyOnOutboundBins += "Qty. (Base)";
          END
        END
      ELSE
        IF Location."Require Pick" THEN
          IF Location."Bin Mandatory" AND ((LotNo <> '') OR (SerialNo <> '')) THEN BEGIN
            FilterWhseEntry(WhseEntry,ItemNo,LocationCode,VariantCode,TRUE,LotNo,TRUE,SerialNo,FALSE);
            WITH WhseEntry DO BEGIN
              SETRANGE("Whse. Document Type","Whse. Document Type"::Shipment);
              SETRANGE("Reference Document","Reference Document"::Pick);
              SETFILTER("Qty. (Base)",'>%1',0);
              QtyOnOutboundBins := CalcResidualPickedQty(WhseEntry);
            END
          END ELSE
            WITH WhseShptLine DO BEGIN
              SETRANGE("Item No.",ItemNo);
              SETRANGE("Location Code",LocationCode);
              SETRANGE("Variant Code",VariantCode);
              CALCSUMS("Qty. Picked (Base)","Qty. Shipped (Base)");
              QtyOnOutboundBins := "Qty. Picked (Base)" - "Qty. Shipped (Base)";
            END;
    END;

    LOCAL PROCEDURE CalcQtyCanBePicked@79(LocationCode@1004 : Code[10];ItemNo@1005 : Code[20];VariantCode@1006 : Code[10];LotNo@1009 : Code[50];SerialNo@1010 : Code[50];IsMovement@1001 : Boolean) : Decimal;
    VAR
      IsLNRequired@1007 : Boolean;
      IsSNRequired@1008 : Boolean;
      BinTypeFilter@1002 : Text;
      QtyOnOutboundBins@1003 : Decimal;
    BEGIN
      ItemTrackingMgt.CheckWhseItemTrkgSetup(ItemNo,IsSNRequired,IsLNRequired,FALSE);

      GetLocation(LocationCode);
      IF NOT Location."Directed Put-away and Pick" THEN BEGIN
        BinTypeFilter := '';
        QtyOnOutboundBins := CalcQtyOnOutboundBins(LocationCode,ItemNo,VariantCode,LotNo,SerialNo,TRUE);
      END ELSE
        // movement can be picked from anywhere but receive and ship zones, yet pick only takes the pick zone
        IF IsMovement THEN BEGIN
          BinTypeFilter := STRSUBSTNO('<>%1',GetBinTypeFilter(0));
          QtyOnOutboundBins := CalcQtyOnOutboundBins(LocationCode,ItemNo,VariantCode,LotNo,SerialNo,TRUE);
        END ELSE BEGIN
          BinTypeFilter := GetBinTypeFilter(3);
          QtyOnOutboundBins := 0;
        END;

      EXIT(
        SumWhseEntries(
          ItemNo,LocationCode,VariantCode,IsLNRequired,LotNo,IsSNRequired,SerialNo,BinTypeFilter,'',TRUE) -
        QtyOnOutboundBins);
    END;

    [External]
    PROCEDURE GetBinTypeFilter@41(Type@1000 : 'Receive,Ship,Put Away,Pick,Put Away only') : Text[1024];
    VAR
      BinType@1001 : Record 7303;
      Filter@1002 : Text[1024];
    BEGIN
      WITH BinType DO BEGIN
        CASE Type OF
          Type::Receive:
            SETRANGE(Receive,TRUE);
          Type::Ship:
            SETRANGE(Ship,TRUE);
          Type::"Put Away":
            SETRANGE("Put Away",TRUE);
          Type::Pick:
            SETRANGE(Pick,TRUE);
          Type::"Put Away only":
            BEGIN
              SETRANGE("Put Away",TRUE);
              SETRANGE(Pick,FALSE);
            END;
        END;
        IF FIND('-') THEN
          REPEAT
            Filter := STRSUBSTNO('%1|%2',Filter,Code);
          UNTIL NEXT = 0;
        IF Filter <> '' THEN
          Filter := COPYSTR(Filter,2);
      END;
      EXIT(Filter);
    END;

    [External]
    PROCEDURE CheckOutBound@44(SourceType@1006 : Integer;SourceSubType@1005 : Integer;SourceNo@1004 : Code[20];SourceLineNo@1003 : Integer;SourceSubLineNo@1000 : Integer) : Decimal;
    VAR
      WhseShipLine@1001 : Record 7321;
      WhseActLine@1008 : Record 5767;
      ProdOrderComp@1007 : Record 5407;
      AsmLine@1009 : Record 901;
      OutBoundQty@1002 : Decimal;
    BEGIN
      CASE SourceType OF
        DATABASE::"Sales Line",DATABASE::"Purchase Line",DATABASE::"Transfer Line":
          BEGIN
            WhseShipLine.RESET;
            WhseShipLine.SETCURRENTKEY(
              "Source Type","Source Subtype","Source No.","Source Line No.");
            WhseShipLine.SETRANGE("Source Type",SourceType);
            WhseShipLine.SETRANGE("Source Subtype",SourceSubType);
            WhseShipLine.SETRANGE("Source No.",SourceNo);
            WhseShipLine.SETRANGE("Source Line No.",SourceLineNo);
            IF WhseShipLine.FINDFIRST THEN BEGIN
              WhseShipLine.CALCFIELDS("Pick Qty. (Base)");
              OutBoundQty := WhseShipLine."Pick Qty. (Base)" + WhseShipLine."Qty. Picked (Base)";
            END ELSE BEGIN
              WhseActLine.RESET;
              WhseActLine.SETCURRENTKEY(
                "Source Type","Source Subtype","Source No.","Source Line No.");
              WhseActLine.SETRANGE("Source Type",SourceType);
              WhseActLine.SETRANGE("Source Subtype",SourceSubType);
              WhseActLine.SETRANGE("Source No.",SourceNo);
              WhseActLine.SETRANGE("Source Line No.",SourceLineNo);
              IF WhseActLine.FINDFIRST THEN
                OutBoundQty := WhseActLine."Qty. Outstanding (Base)"
              ELSE
                OutBoundQty := 0;
            END;
          END;
        DATABASE::"Prod. Order Component":
          BEGIN
            ProdOrderComp.RESET;
            ProdOrderComp.SETRANGE(Status,SourceSubType);
            ProdOrderComp.SETRANGE("Prod. Order No.",SourceNo);
            ProdOrderComp.SETRANGE("Prod. Order Line No.",SourceSubLineNo);
            ProdOrderComp.SETRANGE("Line No.",SourceLineNo);
            IF ProdOrderComp.FINDFIRST THEN BEGIN
              ProdOrderComp.CALCFIELDS("Pick Qty. (Base)");
              OutBoundQty := ProdOrderComp."Pick Qty. (Base)" + ProdOrderComp."Qty. Picked (Base)";
            END ELSE
              OutBoundQty := 0;
          END;
        DATABASE::"Assembly Line":
          BEGIN
            IF AsmLine.GET(SourceSubType,SourceNo,SourceLineNo) THEN BEGIN
              AsmLine.CALCFIELDS("Pick Qty. (Base)");
              OutBoundQty := AsmLine."Pick Qty. (Base)" + AsmLine."Qty. Picked (Base)";
            END ELSE
              OutBoundQty := 0;
          END;
      END;
      EXIT(OutBoundQty);
    END;

    [External]
    PROCEDURE SetCrossDock@39(CrossDock2@1000 : Boolean);
    BEGIN
      CrossDock := CrossDock2;
    END;

    [External]
    PROCEDURE GetReservationStatus@46(VAR ReservationExists2@1000 : Boolean;VAR ReservedForItemLedgEntry2@1001 : Boolean);
    BEGIN
      ReservationExists2 := ReservationExists;
      ReservedForItemLedgEntry2 := ReservedForItemLedgEntry;
    END;

    [External]
    PROCEDURE SetCalledFromPickWksh@61(CalledFromPickWksh2@1000 : Boolean);
    BEGIN
      CalledFromPickWksh := CalledFromPickWksh2;
    END;

    [External]
    PROCEDURE SetCalledFromMoveWksh@64(CalledFromMoveWksh2@1000 : Boolean);
    BEGIN
      CalledFromMoveWksh := CalledFromMoveWksh2;
    END;

    LOCAL PROCEDURE CalcQtyToPickBase@49(VAR BinContent@1002 : Record 7302) : Decimal;
    VAR
      WhseEntry@1003 : Record 7312;
      WhseActivLine@1004 : Record 5767;
      WhseJrnl@1005 : Record 7311;
      QtyPlaced@1006 : Decimal;
      QtyTaken@1007 : Decimal;
    BEGIN
      WITH BinContent DO BEGIN
        WhseEntry.SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Variant Code","Unit of Measure Code","Lot No.","Serial No.");
        WhseEntry.SETRANGE("Location Code","Location Code");
        WhseEntry.SETRANGE("Bin Code","Bin Code");
        WhseEntry.SETRANGE("Item No.","Item No.");
        WhseEntry.SETRANGE("Variant Code","Variant Code");
        WhseEntry.SETRANGE("Unit of Measure Code","Unit of Measure Code");
        COPYFILTER("Serial No. Filter",WhseEntry."Serial No.");
        COPYFILTER("Lot No. Filter",WhseEntry."Lot No.");
        WhseEntry.CALCSUMS("Qty. (Base)");

        WhseActivLine.SETCURRENTKEY(
          "Item No.","Bin Code","Location Code",
          "Action Type","Variant Code","Unit of Measure Code","Breakbulk No.","Activity Type","Lot No.","Serial No.");
        WhseActivLine.SETRANGE("Location Code","Location Code");
        WhseActivLine.SETRANGE("Action Type",WhseActivLine."Action Type"::Take);
        WhseActivLine.SETRANGE("Bin Code","Bin Code");
        WhseActivLine.SETRANGE("Item No.","Item No." );
        WhseActivLine.SETRANGE("Variant Code","Variant Code");
        WhseActivLine.SETRANGE("Unit of Measure Code","Unit of Measure Code");
        COPYFILTER("Lot No. Filter",WhseActivLine."Lot No.");
        COPYFILTER("Serial No. Filter",WhseActivLine."Serial No.");
        WhseActivLine.CALCSUMS("Qty. Outstanding (Base)");
        QtyTaken := WhseActivLine."Qty. Outstanding (Base)";

        TempWhseActivLine.COPY(WhseActivLine);
        TempWhseActivLine.CALCSUMS("Qty. Outstanding (Base)");
        QtyTaken += TempWhseActivLine."Qty. Outstanding (Base)";

        TempWhseActivLine.SETRANGE("Action Type",WhseActivLine."Action Type"::Place);
        TempWhseActivLine.CALCSUMS("Qty. Outstanding (Base)");
        QtyPlaced := TempWhseActivLine."Qty. Outstanding (Base)";

        TempWhseActivLine.RESET;

        WhseJrnl.SETCURRENTKEY(
          "Item No.","From Bin Code","Location Code","Entry Type","Variant Code","Unit of Measure Code","Lot No.","Serial No.");
        WhseJrnl.SETRANGE("Location Code","Location Code");
        WhseJrnl.SETRANGE("From Bin Code","Bin Code");
        WhseJrnl.SETRANGE("Item No.","Item No." );
        WhseJrnl.SETRANGE("Variant Code","Variant Code");
        WhseJrnl.SETRANGE("Unit of Measure Code","Unit of Measure Code");
        COPYFILTER("Lot No. Filter",WhseJrnl."Lot No.");
        COPYFILTER("Serial No. Filter",WhseJrnl."Serial No.");
        WhseJrnl.CALCSUMS("Qty. (Absolute, Base)");

        EXIT(WhseEntry."Qty. (Base)" + WhseJrnl."Qty. (Absolute, Base)" + QtyPlaced - QtyTaken);
      END;
    END;

    LOCAL PROCEDURE PickAccordingToFEFO@50(LocationCode@1000 : Code[10]) : Boolean;
    BEGIN
      GetLocation(LocationCode);
      EXIT(Location."Pick According to FEFO" AND (SNRequired OR LNRequired));
    END;

    LOCAL PROCEDURE UndefinedItemTrkg@58(VAR QtyToTrackBase@1000 : Decimal) : Boolean;
    BEGIN
      QtyToTrackBase := QtyToTrackBase - ItemTrackedQuantity('','');
      EXIT(QtyToTrackBase > 0);
    END;

    LOCAL PROCEDURE ReleaseNonSpecificReservations@52(LocationCode@1008 : Code[10];ItemNo@1007 : Code[20];VariantCode@1006 : Code[10];LotNo@1004 : Code[50];SerialNo@1003 : Code[50];QtyToRelease@1000 : Decimal) : Boolean;
    VAR
      LateBindingMgt@1002 : Codeunit 6502;
      xReservedQty@1001 : Decimal;
    BEGIN
      IF QtyToRelease <= 0 THEN
        EXIT;

      IF LNRequired OR SNRequired THEN
        IF Item."Reserved Qty. on Inventory" > 0 THEN BEGIN
          xReservedQty := Item."Reserved Qty. on Inventory";
          LateBindingMgt.ReleaseForReservation(ItemNo,VariantCode,LocationCode,SerialNo,LotNo,QtyToRelease);
          Item.CALCFIELDS("Reserved Qty. on Inventory");
        END;

      EXIT(xReservedQty > Item."Reserved Qty. on Inventory");
    END;

    [External]
    PROCEDURE SetCalledFromWksh@117(NewCalledFromWksh@1000 : Boolean);
    BEGIN
      CalledFromWksh := NewCalledFromWksh;
    END;

    LOCAL PROCEDURE GetFromBinContentQty@118(LocCode@1006 : Code[10];FromBinCode@1005 : Code[20];ItemNo@1004 : Code[20];Variant@1003 : Code[20];UoMCode@1002 : Code[10];LotNo@1001 : Code[50];SerialNo@1000 : Code[50]) : Decimal;
    VAR
      BinContent@1007 : Record 7302;
    BEGIN
      BinContent.GET(LocCode,FromBinCode,ItemNo,Variant,UoMCode);
      BinContent.SETRANGE("Lot No. Filter",LotNo);
      BinContent.SETRANGE("Serial No. Filter",SerialNo);
      BinContent.CALCFIELDS("Quantity (Base)");
      EXIT(BinContent."Quantity (Base)");
    END;

    [External]
    PROCEDURE CreateTempActivityLine@68(LocationCode@1002 : Code[10];BinCode@1003 : Code[20];UOMCode@1004 : Code[10];QtyPerUOM@1005 : Decimal;QtyToPick@1000 : Decimal;QtyToPickBase@1001 : Decimal;ActionType@1006 : Integer;BreakBulkNo@1007 : Integer);
    VAR
      WhseSource2@1008 : Option;
    BEGIN
      IF Location."Directed Put-away and Pick" THEN
        GetBin(LocationCode,BinCode);

      TempLineNo := TempLineNo + 10000;
      WITH TempWhseActivLine DO BEGIN
        RESET;
        INIT;

        "No." := FORMAT(TempNo);
        "Location Code" := LocationCode;
        "Unit of Measure Code" := UOMCode;
        "Qty. per Unit of Measure" := QtyPerUOM;
        "Starting Date" := WORKDATE;
        "Bin Code" := BinCode;
        "Action Type" := ActionType;
        "Breakbulk No." := BreakBulkNo;
        "Line No." := TempLineNo;

        CASE WhseSource OF
          WhseSource::"Pick Worksheet":
            TransferFromPickWkshLine(WhseWkshLine);
          WhseSource::Shipment:
            IF WhseShptLine."Assemble to Order" THEN
              TransferFromATOShptLine(WhseShptLine,AssemblyLine)
            ELSE
              TransferFromShptLine(WhseShptLine);
          WhseSource::"Internal Pick":
            TransferFromIntPickLine(WhseInternalPickLine);
          WhseSource::Production:
            TransferFromCompLine(ProdOrderCompLine);
          WhseSource::Assembly:
            TransferFromAssemblyLine(AssemblyLine);
          WhseSource::"Movement Worksheet":
            TransferFromMovWkshLine(WhseWkshLine);
        END;

        OnCreateTempActivityLineOnAfterTransferFrom(TempWhseActivLine);

        IF (WhseSource = WhseSource::Shipment) AND WhseShptLine."Assemble to Order" THEN
          WhseSource2 := WhseSource::Assembly
        ELSE
          WhseSource2 := WhseSource;
        IF (BreakBulkNo = 0) AND ("Action Type" = "Action Type"::Place) THEN
          CASE WhseSource2 OF
            WhseSource::"Pick Worksheet",WhseSource::"Movement Worksheet":
              CalcMaxQtytoPlace(
                QtyToPick,WhseWkshLine."Qty. to Handle",QtyToPickBase,WhseWkshLine."Qty. to Handle (Base)");
            WhseSource::Shipment:
              BEGIN
                WhseShptLine.CALCFIELDS("Pick Qty.","Pick Qty. (Base)");
                CalcMaxQtytoPlace(
                  QtyToPick,
                  WhseShptLine.Quantity -
                  WhseShptLine."Qty. Picked" -
                  WhseShptLine."Pick Qty.",
                  QtyToPickBase,
                  WhseShptLine."Qty. (Base)" -
                  WhseShptLine."Qty. Picked (Base)" -
                  WhseShptLine."Pick Qty. (Base)");
              END;
            WhseSource::"Internal Pick":
              BEGIN
                WhseInternalPickLine.CALCFIELDS("Pick Qty.","Pick Qty. (Base)");
                CalcMaxQtytoPlace(
                  QtyToPick,
                  WhseInternalPickLine.Quantity -
                  WhseInternalPickLine."Qty. Picked" -
                  WhseInternalPickLine."Pick Qty.",
                  QtyToPickBase,
                  WhseInternalPickLine."Qty. (Base)" -
                  WhseInternalPickLine."Qty. Picked (Base)" -
                  WhseInternalPickLine."Pick Qty. (Base)");
              END;
            WhseSource::Production:
              BEGIN
                ProdOrderCompLine.CALCFIELDS("Pick Qty.","Pick Qty. (Base)");
                CalcMaxQtytoPlace(
                  QtyToPick,
                  ProdOrderCompLine."Expected Quantity" -
                  ProdOrderCompLine."Qty. Picked" -
                  ProdOrderCompLine."Pick Qty.",
                  QtyToPickBase,
                  ProdOrderCompLine."Expected Qty. (Base)" -
                  ProdOrderCompLine."Qty. Picked (Base)" -
                  ProdOrderCompLine."Pick Qty. (Base)");
              END;
            WhseSource::Assembly:
              BEGIN
                AssemblyLine.CALCFIELDS("Pick Qty.","Pick Qty. (Base)");
                CalcMaxQtytoPlace(
                  QtyToPick,
                  AssemblyLine.Quantity -
                  AssemblyLine."Qty. Picked" -
                  AssemblyLine."Pick Qty.",
                  QtyToPickBase,
                  AssemblyLine."Quantity (Base)" -
                  AssemblyLine."Qty. Picked (Base)" -
                  AssemblyLine."Pick Qty. (Base)");
              END;
          END;

        IF (LocationCode <> '') AND (BinCode <> '') THEN BEGIN
          GetBin(LocationCode,BinCode);
          Dedicated := Bin.Dedicated;
        END;
        IF Location."Directed Put-away and Pick" THEN BEGIN
          "Zone Code" := Bin."Zone Code";
          "Bin Ranking" := Bin."Bin Ranking";
          "Bin Type Code" := Bin."Bin Type Code";
          IF Location."Special Equipment" <> Location."Special Equipment"::" " THEN
            "Special Equipment Code" :=
              AssignSpecEquipment(LocationCode,BinCode,"Item No.","Variant Code");
        END;

        VALIDATE(Quantity,QtyToPick);
        IF QtyToPickBase <> 0 THEN BEGIN
          "Qty. (Base)" := QtyToPickBase;
          "Qty. to Handle (Base)" := QtyToPickBase;
          "Qty. Outstanding (Base)" := QtyToPickBase;
        END;

        CASE WhseSource OF
          WhseSource::Shipment:
            BEGIN
              "Shipping Agent Code" := ShippingAgentCode;
              "Shipping Agent Service Code" := ShippingAgentServiceCode;
              "Shipment Method Code" := ShipmentMethodCode;
              "Shipping Advice" := "Shipping Advice";
            END;
          WhseSource::Production,WhseSource::Assembly:
            IF "Shelf No." = '' THEN BEGIN
              Item."No." := "Item No.";
              Item.ItemSKUGet(Item,"Location Code","Variant Code");
              "Shelf No." := Item."Shelf No.";
            END;
          WhseSource::"Movement Worksheet":
            IF (WhseWkshLine."Qty. Outstanding" <> QtyToPick) AND (BreakBulkNo = 0) THEN BEGIN
              "Source Type" := DATABASE::"Whse. Worksheet Line";
              "Source No." := WhseWkshLine."Worksheet Template Name";
              "Source Line No." := "Line No.";
            END;
        END;

        TransferItemTrkgFields(TempWhseActivLine,TempWhseItemTrackingLine);

        IF (BreakBulkNo = 0) AND (ActionType <> 2) THEN
          TotalQtyPickedBase += QtyToPickBase;

        OnBeforeTempWhseActivLineInsert(TempWhseActivLine,ActionType);
        INSERT;
      END;
    END;

    LOCAL PROCEDURE UpdateQuantitiesToPick@65(QtyAvailableBase@1006 : Decimal;FromQtyPerUOM@1007 : Decimal;VAR FromQtyToPick@1005 : Decimal;VAR FromQtyToPickBase@1004 : Decimal;ToQtyPerUOM@1008 : Decimal;VAR ToQtyToPick@1000 : Decimal;VAR ToQtyToPickBase@1001 : Decimal;VAR TotalQtyToPick@1002 : Decimal;VAR TotalQtyToPickBase@1003 : Decimal);
    BEGIN
      UpdateToQtyToPick(QtyAvailableBase,ToQtyPerUOM,ToQtyToPick,ToQtyToPickBase,TotalQtyToPick,TotalQtyToPickBase);
      UpdateFromQtyToPick(QtyAvailableBase,FromQtyPerUOM,FromQtyToPick,FromQtyToPickBase,ToQtyPerUOM,ToQtyToPick,ToQtyToPickBase);
      UpdateTotalQtyToPick(ToQtyToPick,ToQtyToPickBase,TotalQtyToPick,TotalQtyToPickBase)
    END;

    [External]
    PROCEDURE UpdateFromQtyToPick@70(QtyAvailableBase@1008 : Decimal;FromQtyPerUOM@1007 : Decimal;VAR FromQtyToPick@1006 : Decimal;VAR FromQtyToPickBase@1005 : Decimal;ToQtyPerUOM@1001 : Decimal;ToQtyToPick@1002 : Decimal;ToQtyToPickBase@1000 : Decimal);
    BEGIN
      CASE FromQtyPerUOM OF
        ToQtyPerUOM:
          BEGIN
            FromQtyToPick := ToQtyToPick;
            FromQtyToPickBase := ToQtyToPickBase;
          END;
        0..ToQtyPerUOM:
          BEGIN
            FromQtyToPick := ROUND(ToQtyToPickBase / FromQtyPerUOM,UOMMgt.QtyRndPrecision);
            FromQtyToPickBase := ToQtyToPickBase;
          END;
        ELSE
          FromQtyToPick := ROUND(ToQtyToPickBase / FromQtyPerUOM,1,'>');
          FromQtyToPickBase := FromQtyToPick * FromQtyPerUOM;
          IF FromQtyToPickBase > QtyAvailableBase THEN BEGIN
            FromQtyToPickBase := ToQtyToPickBase;
            FromQtyToPick := ROUND(FromQtyToPickBase / FromQtyPerUOM,UOMMgt.QtyRndPrecision);
          END;
      END;
    END;

    LOCAL PROCEDURE UpdateToQtyToPick@71(QtyAvailableBase@1008 : Decimal;ToQtyPerUOM@1004 : Decimal;VAR ToQtyToPick@1003 : Decimal;VAR ToQtyToPickBase@1002 : Decimal;TotalQtyToPick@1001 : Decimal;TotalQtyToPickBase@1000 : Decimal);
    BEGIN
      ToQtyToPickBase := QtyAvailableBase;
      IF ToQtyToPickBase > TotalQtyToPickBase THEN
        ToQtyToPickBase := TotalQtyToPickBase;

      ToQtyToPick := ROUND(ToQtyToPickBase / ToQtyPerUOM,UOMMgt.QtyRndPrecision);
      IF ToQtyToPick > TotalQtyToPick THEN
        ToQtyToPick := TotalQtyToPick;
      IF (ToQtyToPick <> TotalQtyToPick) AND (ToQtyToPickBase = TotalQtyToPickBase) THEN
        IF ABS(1 - ToQtyToPick / TotalQtyToPick) <= UOMMgt.QtyRndPrecision THEN
          ToQtyToPick := TotalQtyToPick;
    END;

    [External]
    PROCEDURE UpdateTotalQtyToPick@72(ToQtyToPick@1003 : Decimal;ToQtyToPickBase@1002 : Decimal;VAR TotalQtyToPick@1001 : Decimal;VAR TotalQtyToPickBase@1000 : Decimal);
    BEGIN
      TotalQtyToPick := TotalQtyToPick - ToQtyToPick;
      TotalQtyToPickBase := TotalQtyToPickBase - ToQtyToPickBase;
    END;

    LOCAL PROCEDURE CalcTotalQtyAssgndOnWhse@20(LocationCode@1002 : Code[10];ItemNo@1001 : Code[20];VariantCode@1000 : Code[10]) : Decimal;
    VAR
      WhseShipmentLine@1010 : Record 7321;
      ProdOrderComp@1011 : Record 5407;
      AsmLine@1004 : Record 901;
      QtyAssgndToWhseAct@1003 : Decimal;
      QtyAssgndToShipment@1009 : Decimal;
      QtyAssgndToProdComp@1007 : Decimal;
      QtyAssgndToAsmLine@1005 : Decimal;
    BEGIN
      QtyAssgndToWhseAct +=
        CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::" ",LocationCode,ItemNo,VariantCode);
      QtyAssgndToWhseAct +=
        CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::"Put-away",LocationCode,ItemNo,VariantCode);
      QtyAssgndToWhseAct +=
        CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::Pick,LocationCode,ItemNo,VariantCode);
      QtyAssgndToWhseAct +=
        CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::Movement,LocationCode,ItemNo,VariantCode);
      QtyAssgndToWhseAct +=
        CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::"Invt. Put-away",LocationCode,ItemNo,VariantCode);
      QtyAssgndToWhseAct +=
        CalcTotalQtyAssgndOnWhseAct(TempWhseActivLine."Activity Type"::"Invt. Pick",LocationCode,ItemNo,VariantCode);

      WITH WhseShipmentLine DO BEGIN
        SETCURRENTKEY("Item No.","Location Code","Variant Code","Due Date");
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        CALCSUMS("Qty. Picked (Base)","Qty. Shipped (Base)");
        QtyAssgndToShipment := "Qty. Picked (Base)" - "Qty. Shipped (Base)";
      END;

      WITH ProdOrderComp DO BEGIN
        SETCURRENTKEY("Item No.","Variant Code","Location Code",Status,"Due Date");
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        SETRANGE(Status,Status::Released);
        CALCSUMS("Qty. Picked (Base)","Expected Qty. (Base)","Remaining Qty. (Base)");
        QtyAssgndToProdComp := "Qty. Picked (Base)" - ("Expected Qty. (Base)" - "Remaining Qty. (Base)");
      END;

      WITH AsmLine DO BEGIN
        SETCURRENTKEY("Document Type",Type,"No.","Variant Code","Location Code");
        SETRANGE("Document Type","Document Type"::Order);
        SETRANGE("Location Code",LocationCode);
        SETRANGE(Type,Type::Item);
        SETRANGE("No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        CALCSUMS("Qty. Picked (Base)","Consumed Quantity (Base)");
        QtyAssgndToAsmLine := CalcQtyPickedNotConsumedBase;
      END;

      EXIT(QtyAssgndToWhseAct + QtyAssgndToShipment + QtyAssgndToProdComp + QtyAssgndToAsmLine);
    END;

    LOCAL PROCEDURE CalcTotalQtyAssgndOnWhseAct@86(ActivityType@1003 : Option;LocationCode@1002 : Code[10];ItemNo@1001 : Code[20];VariantCode@1000 : Code[10]) : Decimal;
    VAR
      WhseActivLine@1004 : Record 5767;
    BEGIN
      WITH WhseActivLine DO BEGIN
        SETCURRENTKEY(
          "Item No.","Location Code","Activity Type","Bin Type Code",
          "Unit of Measure Code","Variant Code","Breakbulk No.","Action Type");
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Variant Code",VariantCode);
        SETRANGE("Activity Type",ActivityType);
        SETRANGE("Breakbulk No.",0);
        SETFILTER("Action Type",'%1|%2',"Action Type"::" ","Action Type"::Take);
        CALCSUMS("Qty. Outstanding (Base)");
        EXIT("Qty. Outstanding (Base)");
      END;
    END;

    LOCAL PROCEDURE CalcTotalQtyOnBinType@104(BinTypeFilter@1004 : Text[1024];LocationCode@1003 : Code[10];ItemNo@1002 : Code[20];VariantCode@1001 : Code[10]) : Decimal;
    BEGIN
      EXIT(SumWhseEntries(ItemNo,LocationCode,VariantCode,FALSE,'',FALSE,'',BinTypeFilter,'',FALSE));
    END;

    LOCAL PROCEDURE SumWhseEntries@93(ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];VariantCode@1003 : Code[10];IsLNRequired@1008 : Boolean;LotNo@1004 : Code[50];IsSNRequired@1009 : Boolean;SerialNo@1005 : Code[50];BinTypeCodeFilter@1006 : Text;BinCodeFilter@1007 : Text;ExcludeDedicatedBins@1010 : Boolean) : Decimal;
    VAR
      WhseEntry@1000 : Record 7312;
    BEGIN
      WITH WhseEntry DO BEGIN
        FilterWhseEntry(
          WhseEntry,ItemNo,LocationCode,VariantCode,IsLNRequired,LotNo,IsSNRequired,SerialNo,ExcludeDedicatedBins);
        SETFILTER("Bin Type Code",BinTypeCodeFilter);
        SETFILTER("Bin Code",BinCodeFilter);

        CALCSUMS("Qty. (Base)");
        EXIT("Qty. (Base)");
      END;
    END;

    [External]
    PROCEDURE CalcBreakbulkOutstdQty@69(VAR WhseActivLine@1000 : Record 5767;LNRequired@1001 : Boolean;SNRequired@1002 : Boolean) : Decimal;
    VAR
      BinContent@1003 : Record 7302;
      WhseActivLine1@1004 : Record 5767;
      WhseActivLine2@1005 : Record 5767;
      TempUOM@1006 : TEMPORARY Record 204;
      QtyOnBreakbulk@1007 : Decimal;
    BEGIN
      WITH WhseActivLine1 DO BEGIN
        COPYFILTERS(WhseActivLine);
        SETFILTER("Breakbulk No.",'<>%1',0);
        SETRANGE("Action Type","Action Type"::Place);
        IF FINDSET THEN BEGIN
          BinContent.SETCURRENTKEY(
            "Location Code","Item No.","Variant Code","Cross-Dock Bin","Qty. per Unit of Measure","Bin Ranking");
          BinContent.SETRANGE("Location Code","Location Code");
          BinContent.SETRANGE("Item No.","Item No.");
          BinContent.SETRANGE("Variant Code","Variant Code");
          BinContent.SETRANGE("Cross-Dock Bin",CrossDock);

          REPEAT
            IF NOT TempUOM.GET("Unit of Measure Code") THEN BEGIN
              TempUOM.INIT;
              TempUOM.Code := "Unit of Measure Code";
              TempUOM.INSERT;
              SETRANGE("Unit of Measure Code","Unit of Measure Code");
              CALCSUMS("Qty. Outstanding (Base)");
              QtyOnBreakbulk += "Qty. Outstanding (Base)";

              // Exclude the qty counted in QtyAssignedToPick
              BinContent.SETRANGE("Unit of Measure Code","Unit of Measure Code");
              IF LNRequired THEN
                BinContent.SETRANGE("Lot No. Filter","Lot No.")
              ELSE
                BinContent.SETFILTER("Lot No. Filter",'%1|%2',"Lot No.",'');
              IF SNRequired THEN
                BinContent.SETRANGE("Serial No. Filter","Serial No.")
              ELSE
                BinContent.SETFILTER("Serial No. Filter",'%1|%2',"Serial No.",'');

              IF BinContent.FINDSET THEN
                REPEAT
                  BinContent.SetFilterOnUnitOfMeasure;
                  BinContent.CALCFIELDS("Quantity (Base)","Pick Quantity (Base)");
                  IF BinContent."Pick Quantity (Base)" > BinContent."Quantity (Base)" THEN
                    QtyOnBreakbulk -= (BinContent."Pick Quantity (Base)" - BinContent."Quantity (Base)");
                UNTIL BinContent.NEXT = 0
              ELSE BEGIN
                WhseActivLine2.COPYFILTERS(WhseActivLine1);
                WhseActivLine2.SETFILTER("Action Type",'%1|%2',"Action Type"::" ","Action Type"::Take);
                WhseActivLine2.SETRANGE("Breakbulk No.",0);
                WhseActivLine2.CALCSUMS("Qty. Outstanding (Base)");
                QtyOnBreakbulk -= WhseActivLine2."Qty. Outstanding (Base)";
              END;
              SETRANGE("Unit of Measure Code");
            END;
          UNTIL NEXT = 0;
        END;
        EXIT(QtyOnBreakbulk);
      END;
    END;

    [External]
    PROCEDURE GetCannotBeHandledReason@189() : Text;
    BEGIN
      EXIT(DequeueCannotBeHandledReason);
    END;

    LOCAL PROCEDURE PickStrictExpirationPosting@47(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      StrictExpirationPosting@1001 : Boolean;
      IsHandled@1002 : Boolean;
    BEGIN
      IsHandled := FALSE;
      OnBeforePickStrictExpirationPosting(ItemNo,SNRequired,LNRequired,StrictExpirationPosting,IsHandled);
      IF IsHandled THEN
        EXIT(StrictExpirationPosting);

      EXIT(ItemTrackingMgt.StrictExpirationPosting(ItemNo) AND (SNRequired OR LNRequired));
    END;

    LOCAL PROCEDURE AddToFilterText@53(VAR TextVar@1000 : Text[250];Separator@1001 : Code[1];Comparator@1002 : Code[2];Addendum@1003 : Code[20]);
    BEGIN
      IF TextVar = '' THEN
        TextVar := Comparator + Addendum
      ELSE
        TextVar += Separator + Comparator + Addendum;
    END;

    [External]
    PROCEDURE CreateAssemblyPickLine@55(AsmLine@1002 : Record 901);
    VAR
      QtyToPickBase@1000 : Decimal;
      QtyToPick@1001 : Decimal;
    BEGIN
      WITH AsmLine DO BEGIN
        TESTFIELD("Qty. per Unit of Measure");
        QtyToPickBase := CalcQtyToPickBase;
        QtyToPick := CalcQtyToPick;
        IF QtyToPick > 0 THEN BEGIN
          SetAssemblyLine(AsmLine,1);
          SetTempWhseItemTrkgLine(
            "Document No.",DATABASE::"Assembly Line",'',0,"Line No.","Location Code");
          CreateTempLine(
            "Location Code","No.","Variant Code","Unit of Measure Code",'',"Bin Code",
            "Qty. per Unit of Measure",QtyToPick,QtyToPickBase);
        END;
      END;
    END;

    LOCAL PROCEDURE MovementFromShipZone@105(VAR TotalAvailQtyBase@1000 : Decimal;QtyOnOutboundBins@1001 : Decimal);
    BEGIN
      IF NOT IsShipZone(WhseWkshLine."Location Code",WhseWkshLine."To Zone Code") THEN
        TotalAvailQtyBase := TotalAvailQtyBase - QtyOnOutboundBins;
    END;

    [External]
    PROCEDURE IsShipZone@66(LocationCode@1003 : Code[10];ZoneCode@1000 : Code[10]) : Boolean;
    VAR
      Zone@1002 : Record 7300;
      BinType@1004 : Record 7303;
    BEGIN
      IF NOT Zone.GET(LocationCode,ZoneCode) THEN
        EXIT(FALSE);
      IF NOT BinType.GET(Zone."Bin Type Code") THEN
        EXIT(FALSE);
      EXIT(BinType.Ship);
    END;

    LOCAL PROCEDURE Minimum@67(a@1000 : Decimal;b@1001 : Decimal) : Decimal;
    BEGIN
      IF a < b THEN
        EXIT(a);

      EXIT(b);
    END;

    [External]
    PROCEDURE CalcQtyResvdNotOnILE@74(ReservEntryNo@1002 : Integer;ReservEntryPositive@1004 : Boolean) QtyResvdNotOnILE : Decimal;
    VAR
      ReservEntry@1003 : Record 337;
    BEGIN
      IF ReservEntry.GET(ReservEntryNo,NOT ReservEntryPositive) THEN
        IF ReservEntry."Source Type" <> DATABASE::"Item Ledger Entry" THEN
          QtyResvdNotOnILE += ReservEntry."Quantity (Base)";

      EXIT(QtyResvdNotOnILE);
    END;

    [External]
    PROCEDURE SetFiltersOnReservEntry@77(VAR ReservEntry@1000 : Record 337;SourceType@1006 : Integer;SourceSubType@1005 : Option;SourceNo@1004 : Code[20];SourceLineNo@1003 : Integer;SourceSubLineNo@1002 : Integer);
    BEGIN
      WITH ReservEntry DO BEGIN
        SETCURRENTKEY(
          "Source ID","Source Ref. No.","Source Type","Source Subtype",
          "Source Batch Name","Source Prod. Order Line","Reservation Status");
        SETRANGE("Source ID",SourceNo);
        IF SourceType = DATABASE::"Prod. Order Component" THEN BEGIN
          SETRANGE("Source Ref. No.",SourceSubLineNo);
          SETRANGE("Source Prod. Order Line",SourceLineNo);
        END ELSE
          SETRANGE("Source Ref. No.",SourceLineNo);
        SETRANGE("Source Type",SourceType);
        SETRANGE("Source Subtype",SourceSubType);
        SETRANGE("Reservation Status","Reservation Status"::Reservation);
      END;
    END;

    [External]
    PROCEDURE GetActualQtyPickedBase@82() : Decimal;
    BEGIN
      EXIT(TotalQtyPickedBase);
    END;

    [External]
    PROCEDURE CalcReservedQtyOnInventory@275(ItemNo@1000 : Code[20];LocationCode@1001 : Code[10];VariantCode@1002 : Code[10];LotNo@1003 : Code[50];LNRequired@1004 : Boolean;SerialNo@1005 : Code[50];SNRequired@1006 : Boolean) ReservedQty : Decimal;
    VAR
      ReservationEntry@1007 : Record 337;
      TempBinContentBuffer@1008 : TEMPORARY Record 7330;
    BEGIN
      ReservedQty := 0;

      WITH ReservationEntry DO BEGIN
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Source Type",DATABASE::"Item Ledger Entry");
        SETRANGE("Source Subtype",0);
        SETRANGE("Reservation Status","Reservation Status"::Reservation);
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Variant Code",VariantCode);
        IF LotNo <> '' THEN BEGIN
          IF LNRequired THEN
            SETRANGE("Lot No.",LotNo)
          ELSE
            SETFILTER("Lot No.",'%1|%2',LotNo,'');
        END;
        IF SerialNo <> '' THEN BEGIN
          IF SNRequired THEN
            SETRANGE("Serial No.",SerialNo)
          ELSE
            SETFILTER("Serial No.",'%1|%2',SerialNo,'');
        END;

        IF FINDSET THEN
          REPEAT
            InsertTempBinContentBuf(
              TempBinContentBuffer,"Location Code",'',"Item No.","Variant Code",'',"Lot No.","Serial No.","Quantity (Base)");
          UNTIL NEXT = 0;

        DistrubuteReservedQtyByBins(TempBinContentBuffer);
        TempBinContentBuffer.CALCSUMS("Qty. to Handle (Base)");
        ReservedQty := TempBinContentBuffer."Qty. to Handle (Base)";
      END;

      OnAfterCalcReservedQtyOnInventory(ItemNo,LocationCode,VariantCode,LotNo,LNRequired,SerialNo,SNRequired,ReservedQty);
    END;

    LOCAL PROCEDURE FilterWhseEntry@76(VAR WarehouseEntry@1000 : Record 7312;ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];VariantCode@1003 : Code[10];IsLNRequired@1007 : Boolean;LotNo@1004 : Code[50];IsSNRequired@1008 : Boolean;SerialNo@1005 : Code[50];ExcludeDedicatedBinContent@1006 : Boolean);
    BEGIN
      WITH WarehouseEntry DO BEGIN
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Variant Code",VariantCode);
        IF LotNo <> '' THEN
          IF IsLNRequired THEN
            SETRANGE("Lot No.",LotNo)
          ELSE
            SETFILTER("Lot No.",'%1|%2',LotNo,'');
        IF SerialNo <> '' THEN
          IF IsSNRequired THEN
            SETRANGE("Serial No.",SerialNo)
          ELSE
            SETFILTER("Serial No.",'%1|%2',SerialNo,'');
        IF ExcludeDedicatedBinContent THEN
          SETRANGE(Dedicated,FALSE);
      END;
    END;

    [External]
    PROCEDURE CalcResidualPickedQty@90(VAR WhseEntry@1000 : Record 7312) Result : Decimal;
    VAR
      WhseEntry2@1001 : Record 7312;
    BEGIN
      IF WhseEntry.FINDSET THEN
        REPEAT
          WhseEntry.SETRANGE("Bin Code",WhseEntry."Bin Code");
          WITH WhseEntry2 DO BEGIN
            COPYFILTERS(WhseEntry);
            SETRANGE("Whse. Document Type");
            SETRANGE("Reference Document");
            SETRANGE("Qty. (Base)");
            CALCSUMS("Qty. (Base)");
            Result += "Qty. (Base)";
          END;
          WhseEntry.FINDLAST;
          WhseEntry.SETRANGE("Bin Code");
        UNTIL WhseEntry.NEXT = 0;
    END;

    LOCAL PROCEDURE DistrubuteReservedQtyByBins@91(VAR TempBinContentBuffer@1000 : TEMPORARY Record 7330);
    VAR
      TempBinContentBufferByBins@1001 : TEMPORARY Record 7330;
      TempBinContentBufferByBlockedBins@1005 : TEMPORARY Record 7330;
      WarehouseEntry@1004 : Record 7312;
      QtyLeftToDistribute@1003 : Decimal;
      QtyInBin@1002 : Decimal;
    BEGIN
      WITH TempBinContentBuffer DO BEGIN
        IF FINDSET THEN
          REPEAT
            QtyLeftToDistribute := "Qty. to Handle (Base)";
            WarehouseEntry.SETCURRENTKEY(
              "Item No.","Bin Code","Location Code","Variant Code","Unit of Measure Code","Lot No.","Serial No.",
              "Entry Type",Dedicated);
            WarehouseEntry.SETRANGE("Location Code","Location Code");
            WarehouseEntry.SETRANGE("Item No.","Item No.");
            WarehouseEntry.SETRANGE("Variant Code","Variant Code");
            WarehouseEntry.SETRANGE("Lot No.","Lot No.");
            WarehouseEntry.SETRANGE("Serial No.","Serial No.");
            GetLocation("Location Code");
            IF Location."Adjustment Bin Code" <> '' THEN BEGIN
              WarehouseEntry.FILTERGROUP(2);
              WarehouseEntry.SETFILTER("Bin Code",'<>%1',Location."Adjustment Bin Code");
              WarehouseEntry.FILTERGROUP(0);
            END;
            WarehouseEntry.SETFILTER("Bin Type Code",'<>%1',GetBinTypeFilter(0));

            IF WarehouseEntry.FINDSET THEN
              REPEAT
                WarehouseEntry.SETRANGE("Bin Code",WarehouseEntry."Bin Code");
                WarehouseEntry.SETRANGE("Unit of Measure Code",WarehouseEntry."Unit of Measure Code");
                WarehouseEntry.CALCSUMS("Qty. (Base)");
                IF WarehouseEntry."Qty. (Base)" > 0 THEN
                  IF NOT BinContentBlocked(
                       "Location Code",WarehouseEntry."Bin Code","Item No.","Variant Code",WarehouseEntry."Unit of Measure Code")
                  THEN BEGIN
                    QtyInBin := Minimum(QtyLeftToDistribute,WarehouseEntry."Qty. (Base)");
                    QtyLeftToDistribute -= QtyInBin;
                    InsertTempBinContentBuf(
                      TempBinContentBufferByBins,
                      "Location Code",WarehouseEntry."Bin Code","Item No.","Variant Code",
                      WarehouseEntry."Unit of Measure Code","Lot No.","Serial No.",QtyInBin);
                  END ELSE
                    InsertTempBinContentBuf(
                      TempBinContentBufferByBlockedBins,
                      "Location Code",WarehouseEntry."Bin Code","Item No.","Variant Code",
                      WarehouseEntry."Unit of Measure Code","Lot No.","Serial No.",WarehouseEntry."Qty. (Base)");
                WarehouseEntry.FINDLAST;
                WarehouseEntry.SETRANGE("Unit of Measure Code");
                WarehouseEntry.SETRANGE("Bin Code");
              UNTIL (WarehouseEntry.NEXT = 0) OR (QtyLeftToDistribute = 0);

            IF (QtyLeftToDistribute > 0) AND TempBinContentBufferByBlockedBins.FINDSET THEN
              REPEAT
                QtyInBin := Minimum(QtyLeftToDistribute,TempBinContentBufferByBlockedBins."Qty. to Handle (Base)");
                QtyLeftToDistribute -= QtyInBin;
                InsertTempBinContentBuf(
                  TempBinContentBufferByBins,
                  "Location Code",TempBinContentBufferByBlockedBins."Bin Code","Item No.","Variant Code",
                  TempBinContentBufferByBlockedBins."Unit of Measure Code","Lot No.","Serial No.",QtyInBin);
              UNTIL (TempBinContentBufferByBlockedBins.NEXT = 0) OR (QtyLeftToDistribute = 0);
          UNTIL NEXT = 0;

        DELETEALL;
        IF TempBinContentBufferByBins.FINDSET THEN
          REPEAT
            IF NOT BlockedBinOrTracking(TempBinContentBufferByBins) THEN BEGIN
              TempBinContentBuffer := TempBinContentBufferByBins;
              INSERT;
            END;
          UNTIL TempBinContentBufferByBins.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE InsertTempBinContentBuf@81(VAR TempBinContentBuffer@1000 : TEMPORARY Record 7330;LocationCode@1001 : Code[10];BinCode@1002 : Code[20];ItemNo@1003 : Code[20];VariantCode@1004 : Code[10];UnitOfMeasureCode@1008 : Code[10];LotNo@1005 : Code[50];SerialNo@1006 : Code[50];QtyBase@1007 : Decimal);
    BEGIN
      WITH TempBinContentBuffer DO
        IF GET(LocationCode,BinCode,ItemNo,VariantCode,UnitOfMeasureCode,LotNo,SerialNo) THEN BEGIN
          "Qty. to Handle (Base)" += QtyBase;
          MODIFY;
        END ELSE BEGIN
          INIT;
          "Location Code" := LocationCode;
          "Bin Code" := BinCode;
          "Item No." := ItemNo;
          "Variant Code" := VariantCode;
          "Unit of Measure Code" := UnitOfMeasureCode;
          "Lot No." := LotNo;
          "Serial No." := SerialNo;
          "Qty. to Handle (Base)" := QtyBase;
          INSERT;
        END;
    END;

    LOCAL PROCEDURE BlockedBinOrTracking@102(BinContentBuffer@1000 : Record 7330) : Boolean;
    VAR
      LotNoInformation@1003 : Record 6505;
      SerialNoInformation@1004 : Record 6504;
    BEGIN
      WITH BinContentBuffer DO BEGIN
        IF BinContentBlocked("Location Code","Bin Code","Item No.","Variant Code","Unit of Measure Code") THEN
          EXIT(TRUE);
        IF LotNoInformation.GET("Item No.","Variant Code","Lot No.") THEN
          IF LotNoInformation.Blocked THEN
            EXIT(TRUE);
        IF SerialNoInformation.GET("Item No.","Variant Code","Serial No.") THEN
          IF SerialNoInformation.Blocked THEN
            EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE GetMessageForUnhandledQtyDueToBin@84(BinIsForPick@1000 : Boolean;BinIsForReplenishment@1001 : Boolean;IsMoveWksh@1002 : Boolean;AvailableQtyBase@1003 : Decimal;BinCode@1004 : Code[20]) : Text[100];
    BEGIN
      IF AvailableQtyBase <= 0 THEN
        EXIT('');
      IF NOT BinIsForPick AND NOT IsMoveWksh THEN
        EXIT(STRSUBSTNO(BinIsNotForPickTxt,BinCode));
      IF NOT BinIsForReplenishment AND IsMoveWksh THEN
        EXIT(STRSUBSTNO(BinIsForReceiveOrShipTxt,BinCode));
    END;

    LOCAL PROCEDURE GetMessageForUnhandledQtyDueToReserv@112() : Text;
    BEGIN
      EXIT(QtyReservedNotFromInventoryTxt);
    END;

    [External]
    PROCEDURE FilterWhsePickLinesWithUndefinedBin@42(VAR WarehouseActivityLine@1000 : Record 5767;ItemNo@1001 : Code[20];LocationCode@1002 : Code[10];VariantCode@1003 : Code[10];IsLNRequired@1004 : Boolean;LotNo@1006 : Code[50];IsSNRequired@1008 : Boolean;SerialNo@1009 : Code[50]);
    VAR
      LotNoFilter@1007 : Text;
      SerialNoFilter@1005 : Text;
    BEGIN
      IF LotNo <> '' THEN
        IF IsLNRequired THEN
          LotNoFilter := LotNo
        ELSE
          LotNoFilter := STRSUBSTNO('%1|%2',LotNo,'');
      IF SerialNo <> '' THEN
        IF IsSNRequired THEN
          SerialNoFilter := SerialNo
        ELSE
          SerialNoFilter := STRSUBSTNO('%1|%2',SerialNo,'');

      WITH WarehouseActivityLine DO BEGIN
        RESET;
        SETCURRENTKEY(
          "Item No.","Bin Code","Location Code","Action Type","Variant Code","Unit of Measure Code","Breakbulk No.","Activity Type");
        SETRANGE("Item No.",ItemNo);
        SETRANGE("Bin Code",'');
        SETRANGE("Location Code",LocationCode);
        SETRANGE("Action Type","Action Type"::Take);
        SETRANGE("Variant Code",VariantCode);
        SETFILTER("Lot No.",LotNoFilter);
        SETFILTER("Serial No.",SerialNoFilter);
        SETRANGE("Breakbulk No.",0);
        SETRANGE("Activity Type","Activity Type"::Pick);
      END;
    END;

    LOCAL PROCEDURE EnqueueCannotBeHandledReason@194(CannotBeHandledReason@1002 : Text);
    VAR
      NewReasonAdded@1001 : Boolean;
      i@1000 : Integer;
    BEGIN
      IF CannotBeHandledReason = '' THEN
        EXIT;

      REPEAT
        i += 1;
        IF CannotBeHandledReasons[i] = '' THEN BEGIN
          CannotBeHandledReasons[i] := CannotBeHandledReason;
          NewReasonAdded := TRUE;
        END;
      UNTIL NewReasonAdded OR (i = ARRAYLEN(CannotBeHandledReasons));
    END;

    LOCAL PROCEDURE DequeueCannotBeHandledReason@195() CannotBeHandledReason : Text;
    BEGIN
      CannotBeHandledReason := CannotBeHandledReasons[1];
      CannotBeHandledReasons[1] := '';
      COMPRESSARRAY(CannotBeHandledReasons);
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcQtyOnPickAndReceiveBins@134(SourceType@1000 : Integer;LocationCode@1012 : Code[10];ItemNo@1011 : Code[20];VariantCode@1010 : Code[10];LotNo@1009 : Code[50];SerialNo@1008 : Code[50];CalledFromPickWksh@1001 : Boolean;CalledFromMoveWksh@1002 : Boolean;CalledFromWksh@1003 : Boolean;VAR QtyInWhse@1004 : Decimal;VAR QtyOnPickBins@1005 : Decimal;VAR QtyOnPutAwayBins@1006 : Decimal;VAR QtyOnOutboundBins@1007 : Decimal;VAR QtyOnReceiveBins@1013 : Decimal;VAR QtyOnDedicatedBins@1014 : Decimal;VAR QtyBlocked@1015 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCalcReservedQtyOnInventory@89(ItemNo@1006 : Code[20];LocationCode@1005 : Code[10];VariantCode@1004 : Code[10];LotNo@1003 : Code[50];LNRequired@1002 : Boolean;SerialNo@1001 : Code[50];SNRequired@1000 : Boolean;VAR ReservedQty@1007 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterWhseActivLineInsert@87(VAR WarehouseActivityLine@1000 : Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateTempLineCheckReservation@80(LocationCode@1008 : Code[10];ItemNo@1007 : Code[20];VariantCode@1006 : Code[10];UnitofMeasureCode@1005 : Code[10];QtyPerUnitofMeasure@1002 : Decimal;VAR TotalQtytoPick@1001 : Decimal;VAR TotalQtytoPickBase@1000 : Decimal;SourceType@1009 : Integer;SourceSubType@1011 : Option;SourceNo@1010 : Code[20];SourceLineNo@1004 : Integer;SourceSubLineNo@1003 : Integer;LastWhseItemTrkgLineNo@1012 : Integer;VAR TempWhseItemTrackingLine@1013 : TEMPORARY Record 6550);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateTempWhseItemTrackingLines@100(VAR TempWhseItemTrackingLine@1000 : TEMPORARY Record 6550);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateWhseDocument@122(VAR FirstWhseDocNo@1000 : Code[20];VAR LastWhseDocNo@1001 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateWhseDocLine@132(VAR WarehouseActivityLine@1000 : Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterFindWhseActivLine@133(VAR FirstWhseDocNo@1001 : Code[20];VAR LastWhseDocNo@1000 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetValues@85(VAR AssignedID@1009 : Code[50];VAR SortPick@1007 : ' ,Item,Document,Shelf/Bin No.,Due Date,Ship-To,Bin Ranking,Action Type';VAR MaxNoOfSourceDoc@1005 : Integer;VAR MaxNoOfLines@1004 : Integer;VAR PerBin@1006 : Boolean;VAR PerZone@1003 : Boolean;VAR DoNotFillQtytoHandle@1002 : Boolean;VAR BreakbulkFilter@1001 : Boolean;VAR WhseSource@1000 : 'Pick Worksheet,Shipment,Movement Worksheet,Internal Pick,Production,Assembly');
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetAssemblyLine@103(VAR AssemblyLine@1000 : Record 901);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetProdOrderCompLine@101(VAR ProdOrderComp@1000 : Record 5407);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetWhseShipment@98(VAR WarehouseShipmentLine@1000 : Record 7321);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetWhseWkshLine@96(VAR WhseWorksheetLine@1000 : Record 7326);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterSetWhseInternalPickLine@116(VAR WhseInternalPickLine@1000 : Record 7334);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterTransferItemTrkgFields@106(VAR WarehouseActivityLine@1000 : Record 5767;WhseItemTrackingLine@1001 : Record 6550;EntriesExist@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterBinContentExistsFilter@88(VAR BinContent@1000 : Record 7302);
    BEGIN
    END;

    [Integration(TRUE)]
    LOCAL PROCEDURE OnBeforeCalcPickBin@94(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767;VAR TotalQtytoPick@1001 : Decimal;VAR TotalQtytoPickBase@1002 : Decimal;VAR TempWhseItemTrackingLine@1004 : TEMPORARY Record 6550;CrossDock@1003 : Boolean;WhseTrackingExists@1005 : Boolean;WhseSource@1012 : 'Pick Worksheet,Shipment,Movement Worksheet,Internal Pick,Production,Assembly';LocationCode@1011 : Code[10];ItemNo@1010 : Code[20];VariantCode@1009 : Code[10];UnitofMeasureCode@1008 : Code[10];ToBinCode@1007 : Code[20];QtyPerUnitofMeasure@1006 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCalcTotalAvailQtyToPick@142(LocationCode@1011 : Code[10];ItemNo@1010 : Code[20];VariantCode@1009 : Code[10];LotNo@1008 : Code[50];SerialNo@1007 : Code[50];SourceType@1006 : Integer;SourceSubType@1005 : Option;SourceNo@1004 : Code[20];SourceLineNo@1003 : Integer;SourceSubLineNo@1002 : Integer;NeededQtyBase@1001 : Decimal;RespectLocationBins@1000 : Boolean;CalledFromMoveWksh@1012 : Boolean;CalledFromWksh@1013 : Boolean;VAR TempWhseActivLine@1014 : TEMPORARY Record 5767;VAR IsHandled@1015 : Boolean;VAR TotalAvailQtyBase@1016 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCreateWhseDocument@125(VAR TempWhseActivLine@1000 : TEMPORARY Record 5767;WhseSource@1001 : 'Pick Worksheet,Shipment,Movement Worksheet,Internal Pick,Production,Assembly');
    BEGIN
    END;

    [Integration(TRUE,TRUE)]
    LOCAL PROCEDURE OnBeforeCreateNewWhseDoc@113(VAR TempWhseActivLine@1000 : TEMPORARY Record 5767;OldNo@1008 : Code[20];OldSourceNo@1007 : Code[20];OldLocationCode@1006 : Code[10];VAR FirstWhseDocNo@1005 : Code[20];VAR LastWhseDocNo@1004 : Code[20];VAR NoOfSourceDoc@1003 : Integer;VAR NoOfLines@1002 : Integer;VAR WhseDocCreated@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeCreateTempItemTrkgLines@139(Location@1000 : Record 14;ItemNo@1004 : Code[20];VariantCode@1003 : Code[10];VAR TotalQtytoPickBase@1002 : Decimal;HasExpiryDate@1001 : Boolean;VAR IsHandled@1005 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeFindBWPickBin@126(VAR BinContent@1000 : Record 7302;VAR IsSetCurrentKeyHandled@1001 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeSetBinCodeFilter@92(VAR BinCodeFilterText@1000 : Text[250];LocationCode@1004 : Code[10];ItemNo@1003 : Code[20];VariantCode@1002 : Code[10];ToBinCode@1001 : Code[20]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforePickStrictExpirationPosting@114(ItemNo@1000 : Code[20];SNRequired@1001 : Boolean;LNRequired@1002 : Boolean;VAR StrictExpirationPosting@1003 : Boolean;VAR IsHandled@1004 : Boolean);
    BEGIN
    END;

    [Integration(TRUE)]
    LOCAL PROCEDURE OnBeforeInsertTempItemTrkgLine@107(VAR EntrySummary@1000 : Record 338;RemQtyToPickBase@1001 : Decimal;VAR TotalAvailQtyToPickBase@1002 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeTempWhseActivLineInsert@111(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767;ActionType@1001 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeTempWhseItemTrkgLineInsert@32(VAR WhseItemTrackingLine@1000 : Record 6550;FromWhseItemTrackingLine@1001 : Record 6550;EntrySummary@1002 : Record 338);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeTempWhseItemTrackingLineModify@138(VAR TempWhseItemTrackingLine@1000 : TEMPORARY Record 6550);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeWhseActivHeaderInsert@123(VAR WarehouseActivityHeader@1000 : Record 5766);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnBeforeWhseActivLineInsert@121(VAR WarehouseActivityLine@1000 : Record 5767;WarehouseActivityHeader@1001 : Record 5766);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcAvailQtyOnFindBWPickBin@99(ItemNo@1000 : Code[20];VariantCode@1001 : Code[10];SNRequired@1002 : Boolean;LNRequired@1003 : Boolean;WhseItemTrkgExists@1004 : Boolean;SerialNo@1005 : Code[50];LotNo@1006 : Code[50];LocationCode@1007 : Code[10];BinCode@1008 : Code[20];SourceType@1009 : Integer;SourceSubType@1010 : Integer;SourceNo@1011 : Code[20];SourceLineNo@1012 : Integer;SourceSubLineNo@1013 : Integer;TotalQtyToPickBase@1014 : Decimal;VAR QtyAvailableBase@1015 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcAvailQtyOnFindPickBin@108(ItemNo@1015 : Code[20];VariantCode@1014 : Code[10];SNRequired@1013 : Boolean;LNRequired@1012 : Boolean;WhseItemTrkgExists@1011 : Boolean;SerialNo@1010 : Code[50];LotNo@1009 : Code[50];LocationCode@1008 : Code[10];BinCode@1007 : Code[20];SourceType@1006 : Integer;SourceSubType@1005 : Integer;SourceNo@1004 : Code[20];SourceLineNo@1003 : Integer;SourceSubLineNo@1002 : Integer;TotalQtyToPickBase@1001 : Decimal;VAR QtyAvailableBase@1000 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcAvailQtyOnFindBreakBulkBin@115(Broken@1016 : Boolean;ItemNo@1015 : Code[20];VariantCode@1014 : Code[10];SNRequired@1013 : Boolean;LNRequired@1012 : Boolean;WhseItemTrkgExists@1011 : Boolean;SerialNo@1010 : Code[50];LotNo@1009 : Code[50];LocationCode@1008 : Code[10];BinCode@1007 : Code[20];SourceType@1006 : Integer;SourceSubType@1005 : Integer;SourceNo@1004 : Code[20];SourceLineNo@1003 : Integer;SourceSubLineNo@1002 : Integer;TotalQtyToPickBase@1001 : Decimal;VAR QtyAvailableBase@1000 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcAvailQtyOnFindSmallerUOMBin@119(Broken@1016 : Boolean;ItemNo@1015 : Code[20];VariantCode@1014 : Code[10];SNRequired@1013 : Boolean;LNRequired@1012 : Boolean;WhseItemTrkgExists@1011 : Boolean;SerialNo@1010 : Code[50];LotNo@1009 : Code[50];LocationCode@1008 : Code[10];BinCode@1007 : Code[20];SourceType@1006 : Integer;SourceSubType@1005 : Integer;SourceNo@1004 : Code[20];SourceLineNo@1003 : Integer;SourceSubLineNo@1002 : Integer;TotalQtyToPickBase@1001 : Decimal;VAR QtyAvailableBase@1000 : Decimal);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCalcQtyAssignedToPickOnAfterSetFilters@141(VAR WarehouseActivityLine@1000 : Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateTempActivityLineOnAfterTransferFrom@137(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateTempLine2OnBeforeDirectedPutAwayAndPick@140(LocationCode@1009 : Code[10];ItemNo@1008 : Code[20];VariantCode@1007 : Code[10];UnitofMeasureCode@1006 : Code[10];FromBinCode@1005 : Code[20];ToBinCode@1004 : Code[20];QtyPerUnitofMeasure@1003 : Decimal;VAR TotalQtytoPick@1002 : Decimal;VAR TotalQtytoPickBase@1000 : Decimal;VAR TempWhseItemTrackingLine@1001 : TEMPORARY Record 6550;WhseSource@1011 : 'Pick Worksheet,Shipment,Movement Worksheet,Internal Pick,Production,Assembly';IsHandled@1010 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocumentOnAfterSaveOldValues@130(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocumentOnAfterSetFiltersAfterLoop@120(VAR TempWhseActivLine@1000 : TEMPORARY Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocumentOnAfterSetFiltersBeforeLoop@129(VAR TempWhseActivLine@1000 : TEMPORARY Record 5767;PerBin@1001 : Boolean;PerZone@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocumentOnBeforeClearFilters@131(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocumentOnBeforeCreateDocAndLine@127(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767;VAR IsHandled@1001 : Boolean;VAR CreateNewHeader@1002 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocumentOnBeforeShowError@124(VAR ShowError@1000 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocTakeLineOnAfterSetFilters@97(VAR TempWarehouseActivityLine@1000 : TEMPORARY Record 5767;WarehouseActivityLine@1001 : Record 5767);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocPlaceLineOnAfterSetFilters@95(VAR TempWarehouseActivityLine@1001 : TEMPORARY Record 5767;WarehouseActivityLine@1000 : Record 5767;LineNo@1002 : Integer);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnFindBWPickBinOnBeforeEndLoop@136(VAR FromBinContent@1000 : Record 7302;VAR TotalQtyToPickBase@1001 : Decimal;VAR EndLoop@1002 : Boolean;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnFindBWPickBinOnBeforeFindFromBinContent@128(VAR FromBinContent@1000 : Record 7302;SourceType@1001 : Integer;VAR TotalQtyToPickBase@1002 : Decimal;VAR IsHandled@1003 : Boolean);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnCreateWhseDocTakeLineOnBeforeWhseActivLineInsert@135(VAR WarehouseActivityLine@1000 : Record 5767;WarehouseActivityHeader@1001 : Record 5766;TempWarehouseActivityLine@1002 : TEMPORARY Record 5767);
    BEGIN
    END;

    BEGIN
    END.
  }
}

