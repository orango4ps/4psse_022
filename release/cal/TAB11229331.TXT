OBJECT Table 11229331 Purchase Requisition Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               TESTFIELD("Purchase Requisition No.");  //C053924
             END;

    OnDelete=VAR
               PurchInspectionLine@1100529400 : Record 11229328;
             BEGIN
               TESTFIELD("Document No.", '');
               TESTFIELD("Document Line No.", 0);

               DeleteCommentLine;

               //**4PS.sn BI006 KD 07-11-16
               PurchInspectionLine.SETRANGE("Document Type", PurchInspectionLine."Document Type"::"Purchase Requisition");
               PurchInspectionLine.SETRANGE("Document No.", "Purchase Requisition No.");
               PurchInspectionLine.SETRANGE("Document Line No.", "Line No.");
               IF PurchInspectionLine.FINDSET THEN
                 PurchInspectionLine.DELETEALL;
               //**4PS.en BI006 KD 07-11-16
             END;

    CaptionML=[ENU=Purchase Requisition Line;
               SVE=Inkîpsrekvisitionsrad];
  }
  FIELDS
  {
    { 10  ;   ;Purchase Requisition No.;Code20    ;TableRelation="Purchase Requisition";
                                                   CaptionML=[ENU=Purchase Requisition No.;
                                                              SVE=Inkîpsrekvisition nr] }
    { 20  ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 30  ;   ;Description         ;Text100       ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 35  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              NOR=Beskrivelse 2;
                                                              SVE=Beskrivning 2] }
    { 40  ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO(Quantity) THEN
                                                                  CheckVendorPricePerQuantity;  //C045045
                                                                CalculateTotal;
                                                                CheckLocationInventory;
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 50  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN BEGIN
                                                                  IF ("Cost Type" = "Cost Type"::Material) THEN
                                                                    IF "Unit of Measure" <>  xRec."Unit of Measure" THEN
                                                                      CheckItemUnitConversion(Rec, xRec);
                                                                  CalculateTotal;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=Enhet;
                                                              SVE=MÜttenhet] }
    { 55  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                CheckCurrencyAgreement;
                                                                VALIDATE("Gross Price (LCY)");
                                                                CalculateTotal;
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod] }
    { 56  ;   ;Currency Agreement  ;Boolean       ;CaptionML=[ENU=Currency Agreement;
                                                              SVE=Valuta avtal] }
    { 60  ;   ;Gross Price (LCY)   ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Gross Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Gross Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);

                                                                CalculateNetPrice;
                                                              END;

                                                   CaptionML=[ENU=Gross Price (LCY);
                                                              NOR=Bruttopris (NOK);
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 65  ;   ;Gross Price (FCY)   ;Decimal       ;OnValidate=VAR
                                                                SaveGrossPrice@1100525000 : Decimal;
                                                              BEGIN
                                                                SaveGrossPrice := "Gross Price (FCY)";
                                                                VALIDATE("Gross Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));
                                                                IF CurrFieldNo = FIELDNO("Gross Price (FCY)") THEN
                                                                  "Gross Price (FCY)" := SaveGrossPrice;  //function CalculateDiscount cleared input on validate GrossPrice
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              NOR=Bruttopris;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 70  ;   ;Discount %          ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNetPrice;
                                                              END;

                                                   CaptionML=[ENU=Discount %;
                                                              NOR=Rabatt-%;
                                                              SVE=Rabatt %];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 80  ;   ;Price (LCY)         ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);

                                                                CalculateDiscount;
                                                                CalculateTotal;
                                                              END;

                                                   CaptionML=[ENU=Price (LCY);
                                                              SVE=Pris (BVA)];
                                                   AutoFormatType=2 }
    { 85  ;   ;Price (FCY)         ;Decimal       ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));
                                                              END;

                                                   CaptionML=[ENU=Price;
                                                              SVE=Pris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 90  ;   ;Amount (LCY)        ;Decimal       ;CaptionML=[ENU=Amount (LCY);
                                                              NOR=Belõp (NOK);
                                                              SVE=Belopp (BVA)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 95  ;   ;Amount (FCY)        ;Decimal       ;CaptionML=[ENU=Amount;
                                                              NOR=Belõp;
                                                              SVE=Belopp];
                                                   Editable=No }
    { 100 ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=VAR
                                                                Job@1100525000 : Record 11072003;
                                                              BEGIN
                                                                TESTFIELD("Service Order No.", '');
                                                                IF Job.GET("Project No.") THEN BEGIN
                                                                  VALIDATE("Global Dimension 1 Code", Job."Global Dimension 1 Code");  //DP01314
                                                                  VALIDATE("Location Code", GetPreferenceLocation(CurrFieldNo));
                                                                END;

                                                                CopyDimensions(DATABASE::Job, "Project No.", xRec."Project No.");
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 105 ;   ;Project Description ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 110 ;   ;Element             ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                ElemRec@1100529400 : Record 11012060;
                                                                ProjElemRec@1100529401 : Record 11012010;
                                                                FormatManagement@1100529402 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem(Element, 2, '');
                                                                IF Element <> '' THEN BEGIN
                                                                  IF "Project No." = '' THEN BEGIN
                                                                    ElemRec.GET(Element);
                                                                  END ELSE BEGIN
                                                                    ProjElemRec.GET("Project No.", Element);
                                                                  END;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 115 ;   ;Element Description ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Element)));
                                                   CaptionML=[ENU=Element Description;
                                                              NOR=Elementbeskrivelse;
                                                              SVE=Elementbeskrivning];
                                                   Editable=No }
    { 120 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=éTA] }
    { 125 ;   ;Extension Contract Description;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Extension Contract".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                              Contract No.=FIELD(Extension Contract)));
                                                   CaptionML=[ENU=Extension Contract Description;
                                                              NOR=Beskrivelse av ETA;
                                                              SVE=Beskrivning av éTA];
                                                   Editable=No }
    { 130 ;   ;G/L Account         ;Code20        ;TableRelation="G/L Account";
                                                   CaptionML=[ENU=G/L Account;
                                                              NOR=Finanskonto;
                                                              SVE=Redovisningskonto] }
    { 140 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnLookup=BEGIN
                                                              ShowDimensions;
                                                            END;

                                                   CaptionML=[ENU=Dimension Set ID;
                                                              NOR=Dimensjonssett-ID;
                                                              SVE=DimensionsuppsÑttnings-ID];
                                                   Editable=No }
    { 200 ;   ;Cost Type           ;Option        ;CaptionML=[ENU=Cost Type;
                                                              NOR=Kostnadstype;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=Material,Subcontracting,Plant,Sundry;
                                                                    NOR=Materiale,Underentrepenõr,Maskin,Diverse;
                                                                    SVE=Material,underentreprenad,Maskin,diverse];
                                                   OptionString=Material,Subcontracting,Plant,Sundry }
    { 210 ;   ;Cost Object         ;Code20        ;TableRelation=IF (Cost Type=CONST(Material)) "Dimension Value".Code WHERE (Cost Type=FILTER(Material),
                                                                                                                              Global Dimension No.=CONST(2),
                                                                                                                              Project Filter=FIELD(Project No.))
                                                                                                                              ELSE IF (Cost Type=CONST(Subcontracting)) "Dimension Value".Code WHERE (Cost Type=FILTER(Subcontracting),
                                                                                                                                                                                                      Global Dimension No.=CONST(2),
                                                                                                                                                                                                      Project Filter=FIELD(Project No.))
                                                                                                                                                                                                      ELSE IF (Cost Type=CONST(Plant)) "Dimension Value".Code WHERE (Cost Type=FILTER(Plant),
                                                                                                                                                                                                                                                                     Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                                     Project Filter=FIELD(Project No.))
                                                                                                                                                                                                                                                                     ELSE IF (Cost Type=CONST(Sundry)) "Dimension Value".Code WHERE (Cost Type=FILTER(Sundry),
                                                                                                                                                                                                                                                                                                                                     Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                                                                                                     Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                lvText000@1100485001 : TextConst 'ENU=Copy Data from new Cost Object?\\;NOR=Kopier data fra nytt Kostnadsobjekt?\\;SVE=Kopiera data frÜn nytt kostnadsobjekt?\\';
                                                                lvText001@1100485000 : TextConst 'ENU=Empty fields only will be updated. Existing data will not be overruled.;NOR=Kun tomme felt vil oppdateres. Eksisterende data vil ikke bli overstyrt.;SVE=Endast tomma fÑlt kommer att uppdateras. Befintliga data kommer inte att ÜsidosÑttas.';
                                                              BEGIN
                                                                IF ("Cost Object" <> '') AND ("Item No." + "Trade Item" + "Basic Item" = '') THEN BEGIN
                                                                  IF xRec."Cost Object" = '' THEN
                                                                    GetDefaultsCostObject()
                                                                  ELSE
                                                                    IF "Cost Object" <> xRec."Cost Object" THEN
                                                                      IF CONFIRM(lvText000 + lvText001) THEN
                                                                        GetDefaultsCostObject();
                                                                END;
                                                                IF (CurrFieldNo = FIELDNO("Cost Object")) THEN
                                                                  SetCostComponent;

                                                                ValidateShortcutDimCode(2, "Cost Object");
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              NOR=Kostnadsobjekt;
                                                              SVE=Kostnadsobjekt];
                                                   NotBlank=Yes;
                                                   CaptionClass='1,1,2' }
    { 215 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   OnValidate=BEGIN
                                                                ValidateCostComponent;
                                                              END;

                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadsdel] }
    { 220 ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Plant Type", '');
                                                                TESTFIELD("FA No.", '');
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                                  IF CurrFieldNo = FIELDNO("Item No.") THEN
                                                                    ValidateVendor;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              NOR=Artikkelnr;
                                                              SVE=Artikelnr] }
    { 230 ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Plant Type", '');
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::"Basic Item");
                                                                  IF CurrFieldNo = FIELDNO("Basic Item") THEN
                                                                    ValidateVendor;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              NOR=Fabrikantartikkel;
                                                              SVE=Basartikel] }
    { 235 ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              NOR=Produsent;
                                                              SVE=Tillverkare] }
    { 240 ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Plant Type", '');
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN
                                                                  ValidateItem(ItemTypeOpt::"Trade Item");
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              NOR=Katalogartikkel;
                                                              SVE=Anskaffningsartikel] }
    { 245 ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                TradeVendorRec@1100525000 : Record 11012304;
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  TradeVendorRec.HandleVendorValidate("Vendor (Trade Item)");
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                  CheckVendorRelation(FIELDNO("Vendor (Trade Item)"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              NOR=Leverandõr (katalogartikkel);
                                                              SVE=Leverantîr (skaffningsartikel)] }
    { 250 ;   ;Vendor              ;Code20        ;TableRelation=IF (Subcontracting Activity=FILTER(='')) Vendor.No.
                                                                 ELSE IF (Subcontracting Activity=FILTER(<>'')) "Subcontracting Activity Price"."Subcontractor No." WHERE (Subcontracting Activity=FIELD(Subcontracting Activity));
                                                   OnValidate=VAR
                                                                VendorRec@1100529400 : Record 23;
                                                                StrategicPurchMgt@1100529800 : Codeunit 11020211;
                                                              BEGIN
                                                                IF Vendor <> '' THEN BEGIN
                                                                  VendorRec.GET(Vendor);
                                                                  IF StrategicPurchMgt.IsLimitedPurchaser(DocType::Order) AND
                                                                    NOT StrategicPurchMgt.VendorHasContract(VendorRec)
                                                                  THEN
                                                                    ERROR(STRSUBSTNO(Text004, Vendor));
                                                                END;

                                                                IF "Subcontracting Activity" <> '' THEN
                                                                  GetSubcontractorActivity(FIELDNO(Vendor));  //DP01958a

                                                                CheckVendorRelation(FIELDNO(Vendor));
                                                                IF CurrFieldNo = FIELDNO(Vendor) THEN
                                                                  CheckVendorPricePerQuantity;  //C045045
                                                                IF Vendor <> '' THEN BEGIN
                                                                  CheckVendorBlocked;
                                                                  IF (CurrFieldNo <> 0) AND
                                                                     ("Cost Object" = '') AND ("Item No." = '') AND ("Basic Item" = '') AND ("Trade Item" = '') THEN
                                                                    IF VendorRec."Subcontractor Type" <> VendorRec."Subcontractor Type"::" " THEN
                                                                      "Cost Type" := "Cost Type"::Subcontracting;
                                                                  IF (Vendor <> xRec.Vendor) AND ("Plant Type" <> '') THEN
                                                                    GetPlantPurchaseOrRentRate();
                                                                END;
                                                                CALCFIELDS("Vendor Name");

                                                                ValidateRelatedTextLines;
                                                              END;

                                                   CaptionML=[ENU=Vendor;
                                                              NOR=Leverandõr;
                                                              SVE=Leverantîr] }
    { 255 ;   ;Vendor Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=[ENU=Vendor Name;
                                                              NOR=Leverandõrsnavn;
                                                              SVE=Leverantîrsnamn];
                                                   Editable=No }
    { 260 ;   ;Plant Type          ;Code20        ;TableRelation="Plant Type";
                                                   OnValidate=VAR
                                                                PlantType@1210190000 : Record 11012551;
                                                              BEGIN
                                                                IF "Plant Type" = '' THEN
                                                                  EXIT;

                                                                TESTFIELD("Item No.", '');
                                                                TESTFIELD("Basic Item", '');
                                                                TESTFIELD("Trade Item" , '');
                                                                IF "Plant Company" <> '' THEN
                                                                  PlantType.CHANGECOMPANY("Plant Company");
                                                                IF ("Plant Type" <> xRec."Plant Type") OR (Description = '') THEN BEGIN
                                                                    PlantType.GET("Plant Type");
                                                                  Description := PlantType.Description;
                                                                  "Unit of Measure" := PlantType."Unit of Measure";
                                                                  "Cost Object" := PlantType."Cost Object";
                                                                  "Cost Type" := "Cost Type"::Plant;
                                                                  "Price (LCY)" := 0;
                                                                  "Gross Price (LCY)" := 0;
                                                                  "Discount %" := 0;
                                                                  IF (xRec."Plant Type" = '') OR
                                                                    ((Transaction <> Transaction::Plant) AND (Transaction <> Transaction::"Purchase Order")) OR
                                                                    ((Transaction = Transaction::"Purchase Order") AND ("Plant Company" <> ''))
                                                                  THEN
                                                                    VALIDATE(Transaction, Transaction::Plant);
                                                                  IF Transaction <> Transaction::"Purchase Order" THEN BEGIN
                                                                    Vendor := '';
                                                                    VALIDATE("Price (LCY)");
                                                                  END ELSE BEGIN
                                                                    FillPlantPurchOrRentPrefVendor();
                                                                    GetPlantPurchaseOrRentRate();
                                                                  END;
                                                                  ValidateShortcutDimCode(2, "Cost Object");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantType;
                                                            END;

                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp] }
    { 265 ;   ;Plant No.           ;Code10        ;TableRelation="Plant Number".No. WHERE (Plant Type=FIELD(Plant Type));
                                                   CaptionML=[ENU=Plant No.;
                                                              NOR=Maskinnr.;
                                                              SVE=Maskinnr] }
    { 270 ;   ;Cost Component Plant;Code10        ;TableRelation="Cost Component Plant";
                                                   OnValidate=BEGIN
                                                                VALIDATE(Transaction, Transaction::"Purchase Order");
                                                              END;

                                                   CaptionML=[ENU=Cost Component Plant;
                                                              NOR=Kostdel, maskin;
                                                              SVE=Kostnadsdel, Maskin] }
    { 280 ;   ;External Text       ;Text250       ;OnValidate=BEGIN
                                                                "External Text Block" := "External Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=External Text;
                                                              NOR=Ekstern Tekst;
                                                              SVE=Extern text] }
    { 285 ;   ;External Text Block ;Boolean       ;CaptionML=[ENU=External Text Block;
                                                              NOR=Ekstern Tekstblokk;
                                                              SVE=Externt textblock];
                                                   Editable=No }
    { 290 ;   ;Comments for Logistics;Text50      ;CaptionML=[ENU=Comments for Logistics;
                                                              NOR=Kommentarer for logistikk;
                                                              SVE=Kommentarer fîr logistik] }
    { 300 ;   ;Purchase Action     ;Code10        ;TableRelation="Project Purchase Action".Code WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Purchase Action;
                                                              NOR=Innkjõpshandling;
                                                              SVE=InkîpsÜtgÑrd] }
    { 310 ;   ;Purchase Route Reference;Code20    ;OnLookup=VAR
                                                              RouteRefMgtCU@1210190000 : Codeunit 11012045;
                                                            BEGIN
                                                              RouteRefMgtCU.ShowReferenceList("Purchase Route Reference");
                                                            END;

                                                   CaptionML=[ENU=Purchase Route Reference;
                                                              NOR=Referanse for Innkjõpsrute;
                                                              SVE=Referens fîr inkîpsfîljd];
                                                   Editable=No }
    { 320 ;   ;Price Agreement     ;Boolean       ;OnValidate=VAR
                                                                PurchSetup@1100529400 : Record 312;
                                                              BEGIN
                                                                PurchSetup.GET;
                                                                IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::" " THEN
                                                                  TESTFIELD("Price Agreement", FALSE);
                                                                IF PurchSetup."Price Agreement" = PurchSetup."Price Agreement"::Company THEN
                                                                  TESTFIELD("Price Agreement", TRUE);
                                                              END;

                                                   CaptionML=[ENU=Price Agreement;
                                                              NOR=Prisavtale;
                                                              SVE=Prisavtal] }
    { 330 ;   ;Requested Receipt Date;Date        ;CaptionML=[ENU=Requested Receipt Date;
                                                              NOR=ùnsket mottaksdato;
                                                              SVE=BegÑrt inleveransdatum] }
    { 340 ;   ;Required on Site Date;Date         ;CaptionML=ENU=Required on Site Date }
    { 350 ;   ;Budget Line         ;Integer       ;CaptionML=[ENU=Budget Line;
                                                              NOR=Budsjettrad;
                                                              SVE=Budgetrad] }
    { 360 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(1, "Global Dimension 1 Code");
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Global dimensjon 1 kode;
                                                              SVE=Global dimension 1 kod];
                                                   CaptionClass='1,1,1' }
    { 370 ;   ;Service Order No.   ;Code20        ;TableRelation="Service Order";
                                                   OnValidate=VAR
                                                                ServiceOrder@1100525000 : Record 11012823;
                                                              BEGIN
                                                                TESTFIELD("Project No.", '');
                                                                IF ServiceOrder.GET("Service Order No.") THEN BEGIN
                                                                  VALIDATE("Global Dimension 1 Code", ServiceOrder."Global Dimension 1 Code");  //DP01314
                                                                  VALIDATE("Location Code", GetPreferenceLocation(CurrFieldNo));
                                                                END;

                                                                CopyDimensions(DATABASE::"Service Order", "Service Order No.", xRec."Service Order No.");
                                                              END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr.;
                                                              SVE=Serviceordernr] }
    { 371 ;   ;Service Order Description;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Description WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Service Order Description;
                                                              SVE=Serviceorder beskrivning];
                                                   Editable=No }
    { 380 ;   ;Line Type           ;Code10        ;TableRelation="Line Type"."Line Type" WHERE (Document Type=CONST(Purchase Requisition));
                                                   CaptionML=[ENU=Line Type;
                                                              NOR=Radtype;
                                                              SVE=Radtyp] }
    { 390 ;   ;Tender Paragraph    ;Text20        ;TableRelation="Project Tender Paragraph"."Tender Paragraph" WHERE (Project No.=FIELD(Project No.),
                                                                                                                      Level=CONST(Tender Paragraph));
                                                   CaptionML=[ENU=Tender Paragraph;
                                                              SVE=Anbudsstycke] }
    { 400 ;   ;Subcontracting Activity;Code10     ;TableRelation="Subcontracting Activity".Code;
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO("Subcontracting Activity"));  //DP01958a
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Subcontracting Activity }
    { 410 ;   ;Purchaser Code      ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=Purchaser Code;
                                                              SVE=Inkîparkod] }
    { 420 ;   ;Shipment Method Code;Code10        ;TableRelation="Shipment Method";
                                                   CaptionML=[ENU=Shipment Method/Incoterm Code;
                                                              SVE=Utleveransvillkorskod] }
    { 421 ;   ;Transport Method    ;Code10        ;TableRelation="Transport Method";
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Transport Method;
                                                              SVE=TransportsÑtt] }
    { 430 ;   ;Deliver             ;Option        ;OnValidate=BEGIN
                                                                IF NOT ValidateShipToLocation(FALSE) THEN
                                                                  IF Deliver <> xRec.Deliver THEN
                                                                    GetDefaultShipToLocation;
                                                              END;

                                                   CaptionML=[ENU=Deliver;
                                                              SVE=Leverera];
                                                   OptionCaptionML=ENU=" ,Location,Project Location,Service Location,Contact Address,Plant Location";
                                                   OptionString=[ ,Location,Project Location,Service Location,Contact Address,Plant Location] }
    { 440 ;   ;Ship To Location    ;Code20        ;TableRelation=IF (Deliver=CONST(Project Location)) "Project Location".Code WHERE (Project No.=FIELD(Project No.))
                                                                 ELSE IF (Deliver=CONST(Location)) Location.Code
                                                                 ELSE IF (Deliver=CONST(Plant Location)) "Plant Location".Code
                                                                 ELSE IF (Deliver=CONST(Contact Address)) Contact.No.
                                                                 ELSE IF (Deliver=CONST(Service Location)) "Service Order Location".Code WHERE (Service Order No.=FIELD(Service Order No.));
                                                   OnValidate=BEGIN
                                                                ValidateShipToLocation(TRUE);
                                                              END;

                                                   CaptionML=[ENU=Ship To Location;
                                                              SVE=Leverera till lagerstÑlle] }
    { 460 ;   ;Back-to-back        ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Back-to-back }
    { 470 ;   ;Plant Company       ;Text30        ;TableRelation=Company;
                                                   OnValidate=VAR
                                                                PlantMgtCompany@1100525001 : Record 11020586;
                                                                TmpPlantMgtCompany@1100525002 : TEMPORARY Record 11020586;
                                                              BEGIN
                                                                IF "Plant Company" = COMPANYNAME THEN
                                                                  "Plant Company" := '';
                                                                IF "Plant Company" <> '' THEN BEGIN
                                                                  PlantMgtCompany.GET("Plant Company");
                                                                  CASE TRUE OF
                                                                    ("Project No." <> ''):
                                                                      BEGIN
                                                                        TESTFIELD("Project No.");
                                                                        IF PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', FALSE) = 0 THEN
                                                                          ERROR(Text001, FIELDCAPTION("Plant Location"),
                                                                            FIELDCAPTION("Project No."), "Project No.", FIELDCAPTION("Plant Company"), "Plant Company");
                                                                      END;
                                                                    ("Service Order No." <> ''):
                                                                      BEGIN
                                                                        TESTFIELD("Service Order No.");
                                                                        IF PlantMgtCompany.GetPlantCompaniesForService("Service Order No.", TmpPlantMgtCompany, '', FALSE) = 0 THEN
                                                                          ERROR(Text001, FIELDCAPTION("Plant Location"),
                                                                            FIELDCAPTION("Service Order No."), "Service Order No.", FIELDCAPTION("Plant Company"), "Plant Company");
                                                                      END;
                                                                    ELSE
                                                                      ERROR(Text002, FIELDCAPTION("Project No."), FIELDCAPTION("Service Order No."));
                                                                  END;
                                                                END;
                                                                IF "Plant Company" <> xRec."Plant Company" THEN BEGIN
                                                                  "Plant Location" := '';
                                                                  "Plant Type" := '';
                                                                END;
                                                                IF "Plant Location" = '' THEN
                                                                  FillDefaultPlantLocation;
                                                                IF ("Plant Type" <> '') AND ("Plant Company" <> '') AND (Transaction <> Transaction::Plant) THEN
                                                                  Transaction := Transaction::Plant;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantCompany;
                                                            END;

                                                   CaptionML=[ENU=Plant Company;
                                                              SVE=Maskinfîretag] }
    { 480 ;   ;Plant Location      ;Code20        ;TableRelation=IF (Plant Company=FILTER('')) "Plant Location";
                                                   OnValidate=VAR
                                                                PlantLocation@1210190000 : Record 11012554;
                                                                PlantMgtCompany@1100529000 : Record 11020586;
                                                              BEGIN
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  IF "Plant Company" = '' THEN
                                                                    PlantMgtCompany.GET(COMPANYNAME)
                                                                  ELSE
                                                                    PlantLocation.CHANGECOMPANY("Plant Company");
                                                                  PlantLocation.GET("Plant Location");
                                                                  CASE TRUE OF
                                                                    ("Project No." <> ''):
                                                                      BEGIN
                                                                        TESTFIELD("Project No.");
                                                                        IF PlantLocation."Project No." <> '' THEN
                                                                          PlantLocation.TESTFIELD("Project No.", "Project No.")
                                                                        ELSE BEGIN
                                                                          PlantLocation.TESTFIELD("Customer No.");
                                                                          PlantLocation.TESTFIELD("Service Order No.", '');
                                                                          PlantLocation.TESTFIELD("Employee No.", '');
                                                                          PlantLocation.TESTFIELD("Plant Type", '');
                                                                        END;
                                                                      END;
                                                                    ("Service Order No." <> ''):
                                                                      BEGIN
                                                                        TESTFIELD("Service Order No.");
                                                                        IF PlantLocation."Service Order No." <> '' THEN
                                                                          PlantLocation.TESTFIELD("Service Order No.", "Service Order No.")
                                                                        ELSE BEGIN
                                                                          PlantLocation.TESTFIELD("Customer No.");
                                                                          PlantLocation.TESTFIELD("Project No.", '');
                                                                          PlantLocation.TESTFIELD("Employee No.", '');
                                                                          PlantLocation.TESTFIELD("Plant Type", '');
                                                                        END;
                                                                      END;
                                                                    ELSE
                                                                      ERROR(Text002, FIELDCAPTION("Project No."), FIELDCAPTION("Service Order No."));
                                                                  END;
                                                                  PlantLocation.TESTFIELD(Depot, FALSE);
                                                                  IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
                                                                    PlantLocation.TESTFIELD("Company Name", '')
                                                                  ELSE
                                                                    PlantLocation.TESTFIELD("Company Name", COMPANYNAME);
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantLocation;
                                                            END;

                                                   CaptionML=[ENU=Plant Location;
                                                              SVE=Maskinutplacering] }
    { 490 ;   ;Hire From           ;Date          ;OnValidate=BEGIN
                                                                IF ("Hire From" <> 0D) AND ("Hire To" <> 0D) THEN
                                                                  IF "Hire From" > "Hire To" THEN
                                                                    ERROR(Text005, FIELDCAPTION("Hire From"), FIELDCAPTION("Hire To"));
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Hire From }
    { 500 ;   ;Hire To             ;Date          ;OnValidate=BEGIN
                                                                IF ("Hire From" <> 0D) AND ("Hire To" <> 0D) THEN
                                                                  IF "Hire From" > "Hire To" THEN
                                                                    ERROR(Text005, FIELDCAPTION("Hire From"), FIELDCAPTION("Hire To"));
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Hire To }
    { 510 ;   ;Transaction         ;Option        ;OnValidate=BEGIN
                                                                IF Transaction <> xRec.Transaction THEN BEGIN
                                                                  IF ("Plant Type" <> '') AND ("Plant Company" <> '') THEN
                                                                    TESTFIELD(Transaction, Transaction::Plant);
                                                                  IF (xRec.Transaction = Transaction::"Purchase Order") AND (Transaction = Transaction::Plant) THEN BEGIN
                                                                    IF "Plant Type" <> '' THEN BEGIN
                                                                      "Price (LCY)" := 0;
                                                                      "Gross Price (LCY)" := 0;
                                                                      "Discount %" := 0;
                                                                      VALIDATE("Price (LCY)");
                                                                    END;
                                                                  END;
                                                                  IF Transaction = Transaction::"Purchase Order" THEN BEGIN
                                                                    IF "Plant Type" <> '' THEN BEGIN
                                                                      FillPlantPurchOrRentPrefVendor();
                                                                      GetPlantPurchaseOrRentRate();
                                                                    END;
                                                                  END;
                                                                  IF Transaction = Transaction::Inventory THEN
                                                                    CheckLocationInventory;
                                                                END;

                                                                IF Transaction = Transaction::"Purchase Order" THEN BEGIN
                                                                  IF TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
                                                                    IF TradeItemRec.Expired THEN
                                                                      IF TradeItemRec."Item Code (Successor)" = '' THEN
                                                                        TradeItemRec.TESTFIELD(Expired, FALSE);
                                                                  END;
                                                                  IF ItemRec.GET("Item No.") THEN BEGIN
                                                                    ItemRec.TESTFIELD("Advice Blocked", FALSE);
                                                                    ItemRec.TESTFIELD(Blocked, FALSE);
                                                                    ItemRec.TESTFIELD("Purchasing Blocked", FALSE);
                                                                  END;
                                                                END;

                                                                IF (Transaction = Transaction::Inventory) THEN BEGIN
                                                                  IF ItemRec.GET("Item No.") THEN BEGIN
                                                                    ItemRec.TESTFIELD("Advice Blocked", FALSE);
                                                                    ItemRec.TESTFIELD(Blocked, FALSE);
                                                                    ItemRec.TESTFIELD("Inventory Blocked", FALSE);
                                                                  END;
                                                                END;

                                                                CheckVendorBlocked;
                                                              END;

                                                   CaptionML=[ENU=Transaction;
                                                              SVE=Transaktion];
                                                   OptionCaptionML=ENU=Purchase Order,Plant,Inventory,Fixed Asset,Blanket Order;
                                                   OptionString=Purchase Order,Plant,Inventory,Fixed Asset,Blanket Order }
    { 520 ;   ;Destination         ;Text50        ;CaptionML=[ENU=Destination;
                                                              SVE=Destination] }
    { 530 ;   ;Document Type       ;Option        ;CaptionML=[ENU=Document Type;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=ENU=Quote,Order,,,Blanket Order,,,,,Plant Request,,,,,Plant Order,,,,,Inventory Order;
                                                   OptionString=Quote,Order,,,Blanket Order,,,,,Plant Request,,,,,Plant Order,,,,,Inventory Order;
                                                   Editable=No }
    { 540 ;   ;Document No.        ;Code20        ;CaptionML=[ENU=Document No.;
                                                              SVE=Dokumentnr];
                                                   Editable=No }
    { 550 ;   ;Document Line No.   ;Integer       ;CaptionML=[ENU=Document Line No.;
                                                              SVE=Dokumentradnr];
                                                   Editable=No }
    { 600 ;   ;Date Ordered        ;Date          ;CaptionML=ENU=Date Ordered;
                                                   Editable=No }
    { 610 ;   ;Ordered by          ;Code50        ;CaptionML=ENU=Ordered by;
                                                   Editable=No }
    { 640 ;   ;FA No.              ;Code20        ;TableRelation="Fixed Asset";
                                                   OnValidate=VAR
                                                                FixedAsset@1100529800 : Record 5600;
                                                              BEGIN
                                                                IF "FA No." <> '' THEN BEGIN
                                                                  TESTFIELD(Transaction, Transaction::"Fixed Asset");
                                                                  TESTFIELD("Item No.", '');
                                                                  FixedAsset.GET("FA No.");
                                                                  FixedAsset.TESTFIELD(Blocked, FALSE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=FA No.;
                                                              SVE=Anl.nr] }
    { 650 ;   ;Order Address Code  ;Code10        ;TableRelation="Order Address".Code WHERE (Vendor No.=FIELD(Vendor));
                                                   CaptionML=[ENU=Order Address Code;
                                                              SVE=Inkîpsadresskod] }
    { 660 ;   ;Location Code       ;Code10        ;TableRelation=Location.Code WHERE (Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                Location@1100529800 : Record 14;
                                                              BEGIN
                                                                IF Location.GET("Location Code") THEN
                                                                  Location.TESTFIELD(Blocked, FALSE);
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Location Code;
                                                              SVE=LagerstÑllekod] }
    { 670 ;   ;Budget Amount (LCY) ;Decimal       ;CaptionML=[ENU=Budget Amount;
                                                              SVE=Budgetbelopp];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Purchase Requisition No.,Line No.       ;Clustered=Yes }
    {    ;Purchase Route Reference                 }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ValidateCu@1100529400 : Codeunit 11012033;
      ProjectCurrencyExchangeRate@1100529407 : Record 11020628;
      ProjRec@1100529404 : Record 11072003;
      ServOrderRec@1100525000 : Record 11012823;
      ServContractRec@1100525001 : Record 11012812;
      ItemRec@1100529401 : Record 27;
      BasicItemRec@1100529402 : Record 11012316;
      TradeItemRec@1100529403 : Record 11012317;
      InventorySetup@1100529805 : Record 313;
      DimMgt@1100529600 : Codeunit 408;
      ItemTypeOpt@1100529405 : 'Item,Basic Item,Trade Item,Trade Vendor';
      SkipValidateFCY@1100529406 : Boolean;
      Text000@1100529408 : TextConst 'ENU=First select Lines;NOR=Velg rad(er) fõrst;SVE=VÑlj rader fîrst';
      CheckVendorPrice@1100525002 : Boolean;
      Text001@1100529800 : TextConst 'ENU=There is no %1 of %2 ''%3'' present in %4 ''%5''.';
      Text002@1100529801 : TextConst 'ENU=%1 or %2 should be filled.;SVE=%1 eller %2 ska fyllas i.';
      Text003@1100529802 : TextConst 'ENU=''%1'' is not present in %2 ''%3''.';
      Text004@1100529803 : TextConst 'ENU=Vendor %1 has no valid Contract.;SVE=Leverantîr %1 har inget giltigt kontrakt.';
      DocType@1100529804 : 'Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order';
      Text005@1100529601 : TextConst 'ENU=%1 cannot be later than %2.';

    PROCEDURE InitRecord@1100529401();
    VAR
      PurchaseRequisition@1100529400 : Record 11229330;
    BEGIN
      "Purchase Route Reference" := '';
      IF PurchaseRequisition.GET("Purchase Requisition No.") THEN BEGIN
        "Project No." := PurchaseRequisition."Project No.";
        "Purchase Action" := PurchaseRequisition."Purchase Action";
        "Requested Receipt Date" := PurchaseRequisition."Requested Receipt Date";
        "Required on Site Date" := PurchaseRequisition."Required on Site Date";
        "Purchaser Code" := PurchaseRequisition."Purchaser Code";
        "Shipment Method Code" := PurchaseRequisition."Shipment Method Code";
        "Transport Method" := PurchaseRequisition."Transport Method";
        Destination := PurchaseRequisition.Destination;
        "Back-to-back" := PurchaseRequisition."Back-to-back";
        Deliver := PurchaseRequisition.Deliver;
        IF PurchaseRequisition."Ship To Location" <> '' THEN
          VALIDATE("Ship To Location", PurchaseRequisition."Ship To Location");
        //DP01314.sn
        "Service Order No." := PurchaseRequisition."Service Order No.";
        VALIDATE("Global Dimension 1 Code", PurchaseRequisition."Global Dimension 1 Code");
        "Dimension Set ID" := PurchaseRequisition."Dimension Set ID";
        IF "Project No." <> '' THEN BEGIN
          ProjRec.GET("Project No.");
          "Currency Code" := ProjRec."Currency Code";
          "Location Code" := GetPreferenceLocation(FIELDNO("Project No."));
          CopyDimensions(DATABASE::Job, "Project No.", '');
        END;
        IF "Service Order No." <> '' THEN BEGIN
          ServOrderRec.GET("Service Order No.");
          "Currency Code" := ServOrderRec."Currency Code";
          "Location Code" := GetPreferenceLocation(FIELDNO("Service Order No."));
          CopyDimensions(DATABASE::"Service Order", "Service Order No.", '');
        END;
        //DP01314.en
      END;
      "Date Ordered" := WORKDATE;
      "Ordered by" := USERID;
    END;

    PROCEDURE DeleteCommentLine@1100529800();
    VAR
      CommentLine@1100529800 : Record 11020634;
      RecRef@1100529801 : RecordRef;
    BEGIN
      RecRef.GETTABLE(Rec);
      CommentLine.RESET;
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::"Purchase Requisition Line");
      CommentLine.SETFILTER("Record ID", FORMAT(RecRef.RECORDID()));
      CommentLine.DELETEALL(TRUE);
    END;

    PROCEDURE CommentLineExist@1210190011() : Boolean;
    VAR
      RecRef@1210190000 : RecordRef;
      CommentLine@1210190001 : Record 11020634;
    BEGIN
      RecRef.GETTABLE(Rec);
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::"Purchase Requisition Line");
      CommentLine.SETFILTER("Record ID", FORMAT(RecRef.RECORDID()));
      IF NOT CommentLine.ISEMPTY THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE ValidateItem@31(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item');
    VAR
      DummyDat@11012001 : Date;
      lvText000@1100485000 : TextConst 'ENU=Trade Item %1 is expired: Vendor %2 suggested %3 as alternative Item.;NOR=Katalogartikkelen %1 har forfalt: leverandõr %2 foreslo %3 som alternativ artikkel.;SVE=Anskaffningsartikeln %1 har fîrfallit: Leverantîr %2 fîreslog %3 som alternativ artikel.';
      lvRefDate@1100485004 : Date;
      lvDiscRef1@1100485003 : Code[20];
      lvDiscRef2@1100485002 : Code[20];
      lvRefPrio@1100525002 : Code[10];
      lvDiscType@1100525001 : 'Purchase,Sales';
      lvLanguage@1100525000 : Code[10];
    BEGIN
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
      IF "Project No." <> '' THEN BEGIN
        ProjRec.GET("Project No.");
        IF NOT "Currency Agreement" THEN
          "Currency Code" := ProjRec."Currency Code";
        lvLanguage := ProjRec."Language Code";
        lvRefPrio := ValidateCu.GetRefPrioProject(ProjRec, lvDiscType::Purchase);
      END;
      IF "Service Order No." <> '' THEN BEGIN  //DP01314
        ServOrderRec.GET("Service Order No.");
        IF NOT ServContractRec.GET(ServOrderRec."Service Contract No.") THEN ServContractRec.INIT;
        IF NOT "Currency Agreement" THEN
          "Currency Code" := ServOrderRec."Currency Code";
        lvLanguage := ServOrderRec."Language Code";
        lvRefPrio := ValidateCu.GetRefPrioServContract(ServContractRec, lvDiscType::Purchase);
      END;
      ValidateCu.SetLanguageCode(lvLanguage);
      //C045045.sn
      ValidateCu.SetQuantity(Quantity);
      //C045045.en
      ValidateCu.ValidateItem(LTypeArtOpt,"Trade Item","Item No.",Manufacturer,"Vendor (Trade Item)",
                              "Basic Item","Cost Object",Description,"Unit of Measure","Price (LCY)",
                              "Discount %",DummyDat,"Gross Price (LCY)","Description 2","Cost Component",
                              lvDiscRef1,lvDiscRef2,lvRefDate,lvRefPrio);

      VALIDATE("Cost Type", "Cost Type"::Material);
      VALIDATE("Cost Component");

      IF "Trade Item" <> '' THEN BEGIN
        TradeItemRec.GET("Vendor (Trade Item)", "Trade Item");
        IF TradeItemRec.Expired THEN BEGIN
          IF TradeItemRec."Item Code (Successor)" = '' THEN BEGIN
            TradeItemRec.TESTFIELD(Expired,FALSE);
          END ELSE BEGIN
            TradeItemRec.CALCFIELDS("Vendor Name");
            ERROR(lvText000, "Trade Item", TradeItemRec."Vendor Name", TradeItemRec."Item Code (Successor)");
          END;
        END;
      END ELSE BEGIN
        IF "Basic Item" <> '' THEN BEGIN
          BasicItemRec.GET(Manufacturer, "Basic Item");
          BasicItemRec.TESTFIELD(Expired,FALSE);
        END ELSE BEGIN
          IF "Item No." <> '' THEN BEGIN
            ItemRec.GET("Item No.");
            ItemRec.TESTFIELD(Blocked,FALSE);
          END;
        END;
      END;

      IF "Item No." <> '' THEN BEGIN
        IF ItemRec.GET("Item No.") THEN BEGIN
          ItemRec.TESTFIELD("Purchasing Blocked",FALSE);
          ItemRec.TESTFIELD("Advice Blocked",FALSE);
          VALIDATE("External Text", ItemRec.Text);
        END;
      END;

      VALIDATE("Gross Price (LCY)");
      CalculateTotal;

      IF (CheckVendorPrice = FALSE) THEN  //C045045
        VALIDATE(Vendor, PreferredVendor);

      ValidateCu.SetVendor(Vendor);
      ValidateCu.GetNavisionItemPrices("Item No.", "Unit of Measure", "Price (LCY)",
        "Discount %", "Gross Price (LCY)", lvRefDate, FALSE);

      ValidateShortcutDimCode(2, "Cost Object");
    END;

    PROCEDURE ValidateVendor@6506();
    VAR
      VendorRec@1210190000 : Record 23;
      lvVendor@1100485000 : Code[20];
      SaveItem@1100525004 : Code[20];
      SaveManufacturer@1100525003 : Code[20];
      SaveBasicItem@1100525002 : Code[20];
      SaveVendor@1100525001 : Code[20];
      SaveTradeItem@1100525000 : Code[20];
      SaveDesc@1100525005 : Text[100];
    BEGIN
      IF ("Basic Item" = '') THEN EXIT;

      lvVendor := '';
      IF ItemRec.GET("Item No.") THEN
        lvVendor := ItemRec."Vendor No.";

      IF NOT ProjRec.GET("Project No.") THEN ProjRec.INIT;
      IF ProjRec."Project Supplier" <> '' THEN
        lvVendor := ProjRec."Project Supplier";

      IF NOT VendorRec.GET(lvVendor) THEN VendorRec.INIT;
      lvVendor := VendorRec."Vendor (Trade Item)";

      SaveItem := "Item No.";
      SaveManufacturer := Manufacturer;
      SaveBasicItem := "Basic Item";
      SaveVendor := "Vendor (Trade Item)";
      SaveTradeItem := "Trade Item";
      SaveDesc := Description;

      IF lvVendor = '' THEN EXIT;
      IF lvVendor = SaveVendor THEN
        IF SaveTradeItem <> '' THEN
          EXIT;

      xRec."Vendor (Trade Item)" := '';
      VALIDATE("Vendor (Trade Item)", lvVendor);

      IF (SaveItem <> "Item No.") THEN BEGIN
        "Item No." := SaveItem;
        Description := SaveDesc;
        IF "Item No." <> '' THEN
          ValidateItem(ItemTypeOpt::Item);
      END;

      IF (SaveManufacturer <> Manufacturer) OR (SaveBasicItem <> "Basic Item") THEN BEGIN
        Manufacturer := SaveManufacturer;
        "Basic Item" := SaveBasicItem;
        Description := SaveDesc;
        IF "Basic Item" <> '' THEN
          ValidateItem(ItemTypeOpt::"Basic Item");
      END;

      IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN BEGIN
        "Vendor (Trade Item)" := SaveVendor;
        "Trade Item" := SaveTradeItem;
        Description := SaveDesc;
        IF "Trade Item" <> '' THEN
          ValidateItem(ItemTypeOpt::"Trade Item");
      END;
    END;

    PROCEDURE PreferredVendor@13() : Code[20];
    VAR
      VendorRelationRec@11012001 : Record 11012313;
    BEGIN
      IF "Trade Item" <> '' THEN BEGIN
        IF VendorRelationRec.GET("Vendor (Trade Item)") THEN
          EXIT(VendorRelationRec."Vendor (Purchase)");
      END;

      IF "Item No." <> '' THEN BEGIN
        IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
        EXIT(ItemRec."Vendor No.");
      END;

      EXIT('');
    END;

    PROCEDURE CheckVendorRelation@1100485004(CalledBy@1100525000 : Integer);
    VAR
      VendorRec@1100485001 : Record 23;
      VendorRelationRec@1100485000 : Record 11012313;
    BEGIN
      IF CalledBy = FIELDNO("Vendor (Trade Item)") THEN
        IF "Vendor (Trade Item)" <> '' THEN
          IF VendorRelationRec.GET("Vendor (Trade Item)") THEN
            IF VendorRelationRec."Vendor (Purchase)" <> '' THEN
              VALIDATE(Vendor, VendorRelationRec."Vendor (Purchase)"); //Validate to check vendor is blocked

      IF CalledBy = FIELDNO(Vendor) THEN
        IF Vendor <> '' THEN
          IF VendorRec.GET(Vendor) THEN
            IF VendorRec."Vendor (Trade Item)" <> '' THEN
              IF "Trade Item" = '' THEN
                "Vendor (Trade Item)" := VendorRec."Vendor (Trade Item)";
    END;

    PROCEDURE CheckVendorBlocked@1100525018();
    VAR
      VendorRec@1100529400 : Record 23;
    BEGIN
      IF Vendor = '' THEN
        EXIT;

      VendorRec.GET(Vendor);
      VendorRec.CheckBlockedVendOnDocs(VendorRec, FALSE);
      VendorRec.TESTFIELD("Block Purchase Order", FALSE);
    END;

    PROCEDURE CheckItemUnitConversion@1210190008(VAR MainNewRec@1210190006 : Record 11229331;MainOldRec@1210190007 : Record 11229331);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
    BEGIN
      WITH MainNewRec DO BEGIN
        UnitFactorOld := 1;
        UnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
            Quantity, "Unit of Measure", UnitFactorNew);
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
              Quantity, "Unit of Measure", UnitFactorNew);
          END ELSE BEGIN
            IF "Item No." <> '' THEN BEGIN
              ItemRec.GET("Item No.");
              UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, MainOldRec."Unit of Measure");
              UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, "Unit of Measure");
              UnitFactor := UnitFactorOld;
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
                Quantity, "Unit of Measure", UnitFactor);
            END;
          END;
        END;
        IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
          IF UnitFactorNew <> UnitFactorOld THEN BEGIN
            IF "Gross Price (LCY)" <> 0 THEN
              VALIDATE("Gross Price (LCY)", ("Gross Price (LCY)" * UnitFactorNew / UnitFactorOld))
            ELSE
              VALIDATE("Price (LCY)", ("Price (LCY)" * UnitFactorNew / UnitFactorOld));
          END;
        END;
      END;
    END;

    PROCEDURE HandleLookupUnit@1210190004();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";
        VALIDATE("Unit of Measure", lvUnit);
      END;
    END;

    PROCEDURE CalculateNetPrice@1210190005();
    BEGIN
      "Price (LCY)" := "Gross Price (LCY)" - (("Gross Price (LCY)"/100) * "Discount %");
      "Price (FCY)" := "Gross Price (FCY)" - (("Gross Price (FCY)"/100) * "Discount %");
      CalculateTotal;
    END;

    PROCEDURE CalculateDiscount@1100525024();
    BEGIN
      IF "Gross Price (LCY)" <> 0 THEN BEGIN
        IF ("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Discount %" = 0) THEN BEGIN
          "Gross Price (LCY)" := "Price (LCY)";
          "Gross Price (FCY)" := "Price (FCY)";
        END ELSE BEGIN
          "Discount %" := (("Gross Price (LCY)" - "Price (LCY)") / "Gross Price (LCY)") * 100;
        END;
      END ELSE BEGIN
        IF "Discount %" <> 100 THEN BEGIN
          "Gross Price (LCY)" := "Price (LCY)" / ((100 - "Discount %") / 100);
          "Gross Price (FCY)" := "Price (FCY)" / ((100 - "Discount %") / 100);
        END ELSE BEGIN
          "Gross Price (LCY)" := "Price (LCY)";
          "Gross Price (FCY)" := "Price (FCY)";
        END;
      END;
    END;

    PROCEDURE CalculateTotal@1100525012();
    VAR
      GLSetup@1100525000 : Record 98;
    BEGIN
      GLSetup.GET;
      "Amount (LCY)" := ROUND((Quantity * "Price (LCY)"), GLSetup."Amount Rounding Precision");
      "Amount (FCY)" := ROUND((Quantity * "Price (FCY)"), GLSetup."Amount Rounding Precision");
    END;

    LOCAL PROCEDURE CheckCurrencyAgreement@1100525025();
    BEGIN
      IF "Currency Code" = '' THEN  BEGIN
        "Currency Agreement" := FALSE;
      END ELSE BEGIN
        IF "Project No." <> '' THEN BEGIN
          ProjRec.GET("Project No.");
          "Currency Agreement" := ("Currency Code" <> ProjRec."Currency Code");
        END;
        IF "Service Order No." <> '' THEN BEGIN  //DP01314
          ServOrderRec.GET("Service Order No.");
          "Currency Agreement" := ("Currency Code" <> ServOrderRec."Currency Code");
        END;
      END;
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      SkipValidateFCY := ISkipValidateFCY;
    END;

    PROCEDURE GetDefaultsCostObject@3();
    VAR
      DimValRec@1100529401 : Record 349;
    BEGIN
      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE, '');

      IF Description = '' THEN
        Description := DimValRec.Name;
      IF "Unit of Measure" = '' THEN
        "Unit of Measure" := DimValRec."Unit of Measure";
      IF "Cost Component" = '' THEN
        "Cost Component" := DimValRec."Cost Component";
    END;

    PROCEDURE GetReferenceData@1100485008(VAR lvRefDate@1100485002 : Date;VAR lvDiscRef1@1100485001 : Code[20];VAR lvDiscRef2@1100485000 : Code[20]);
    BEGIN
      IF "Project No." <> '' THEN BEGIN
        ProjRec.GET("Project No.");
        lvRefDate := ValidateCu.GetRefDateProject(ProjRec);
        lvDiscRef1 := ProjRec."Purch Discount Term Group 1";
        lvDiscRef2 := ProjRec."Purch Discount Term Group 2";
      END;
      IF "Service Order No." <> '' THEN BEGIN  //DP01314
        ServOrderRec.GET("Service Order No.");
        lvRefDate := ValidateCu.GetRefDateServOrder(ServOrderRec);
        lvDiscRef1 := ServOrderRec."Purch Discount Term Group 1";
        lvDiscRef2 := ServOrderRec."Purch Discount Term Group 2";
      END;
    END;

    PROCEDURE ValidateCostComponent@1100525010();
    VAR
      CostCompRec@1100525000 : Record 11012012;
      CostCompRec2@1100525001 : Record 11012012;
    BEGIN
      IF CurrFieldNo <> FIELDNO("Cost Component") THEN EXIT;
      IF CostCompRec.GET("Cost Component") THEN BEGIN
        IF CostCompRec."Additional Cost (Service)" THEN BEGIN
          CostCompRec2.SETRANGE("Cost Component (Add.Cost)", "Cost Component");
          IF NOT CostCompRec2.FINDFIRST THEN EXIT;
        END ELSE BEGIN
          IF CostCompRec."Cost Component (Add.Cost)" = '' THEN EXIT;
        END;
      END;
    END;

    PROCEDURE SetCostComponent@1210190013();
    VAR
      DimensionValue@1210190000 : Record 349;
    BEGIN
      DimensionValue.SETCURRENTKEY(Code, "Global Dimension No.");
      DimensionValue.SETRANGE(Code, "Cost Object");
      DimensionValue.SETRANGE("Global Dimension No.", 2);
      IF (DimensionValue.FINDSET) THEN
        VALIDATE("Cost Component", DimensionValue."Cost Component");
    END;

    LOCAL PROCEDURE FillPlantPurchOrRentPrefVendor@1100525027();
    VAR
      PlantType@1100525001 : Record 11012551;
      PlantVendor@1100525000 : Record 11012596;
    BEGIN
      //C021779
      IF ("Plant Type" = '') THEN
        EXIT;
      IF NOT PlantType.GET("Plant Type") THEN
        EXIT;
      PlantVendor.SETRANGE("Plant Type", "Plant Type");
      IF PlantType.External THEN
        PlantVendor.SETRANGE(Type, PlantVendor.Type::Rent)
      ELSE
        PlantVendor.SETRANGE(Type, PlantVendor.Type::Purchase);
      PlantVendor.SETRANGE("Preferred Vendor", TRUE);
      PlantVendor.SETFILTER("Vendor No.", '<>%1', '');
      IF PlantVendor.FINDFIRST THEN BEGIN
        IF PlantVendor."Vendor No." <> Vendor THEN BEGIN
          Vendor := PlantVendor."Vendor No.";
          VALIDATE(Vendor);
        END;
      END;
    END;

    LOCAL PROCEDURE GetPlantPurchaseOrRentRate@1100525022();
    VAR
      PlantType@1100525003 : Record 11012551;
      PurchHead@1100525001 : Record 38;
      PurchLine@1100525002 : Record 39;
      PurchPriceCalcMgt@1100525000 : Codeunit 7010;
      TypeNo@1100525004 : Integer;
    BEGIN
      //C021779
      IF ("Plant Type" = '') OR (Vendor = '') THEN
        EXIT;
      IF NOT PlantType.GET("Plant Type") THEN
        EXIT;
      IF PlantType.External THEN
        TypeNo := 2   // Rent
      ELSE
        TypeNo := 1;  // Purchase

      IF "Unit of Measure" <> PlantType."Unit of Measure" THEN
        "Unit of Measure" := PlantType."Unit of Measure";

      PurchHead.INIT;
      PurchHead."Document Type" := PurchHead."Document Type"::Order;
      PurchHead."Buy-from Vendor No."  := Vendor;
      PurchHead."Pay-to Vendor No."  := Vendor;
      PurchHead."Currency Code" := '';
      PurchHead."Prices Including VAT" := FALSE;
      PurchHead."Order Date" := TODAY;

      PurchLine.INIT;
      PurchLine."Document Type" := PurchHead."Document Type";
      PurchLine."Buy-from Vendor No."  := Vendor;
      PurchLine."Pay-to Vendor No."  := Vendor;
      PurchLine."Plant Type" := "Plant Type";
      PurchLine."Plant No." := '';
      PurchLine."Receiving Company" := '';
      PurchLine.Quantity := Quantity;
      PurchLine."Qty. per Unit of Measure" := 1;
      PurchLine."Unit of Measure Code" := "Unit of Measure";
      PurchLine."Direct Unit Cost" := 0;
      PurchLine."Line Discount %" := 0;

      "Price (LCY)" := 0;
      IF PurchPriceCalcMgt.FindPurchLinePricePlant(PurchHead, PurchLine, 0, -TypeNo) > 0 THEN BEGIN // Neg. TypeMo
        "Price (LCY)" := PurchLine."Direct Unit Cost";
        IF PurchPriceCalcMgt.FindPurchLineLineDiscPlant(PurchHead, PurchLine, TypeNo) > 0 THEN
          "Price (LCY)" := "Price (LCY)" - (PurchLine."Line Discount %" / 100 * "Price (LCY)");
      END;
      VALIDATE("Price (LCY)");
    END;

    PROCEDURE EditText@1210190000();
    VAR
      TextFrm@1100529400 : Page 11012120;
    BEGIN
      IF "Line No." = 0 THEN EXIT;
      TextFrm.SetSelection(DATABASE::"Purchase Requisition Line", "Purchase Requisition No.", '',
        '', '', '', '', "Line No.", 0);
      TextFrm.RUNMODAL;
      CLEAR(TextFrm);
    END;

    PROCEDURE EditCommentLines@1100529400();
    VAR
      CommentLine@1100529800 : Record 11020634;
      RecRef@1100529801 : RecordRef;
      RID@1100529802 : RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      RID := RecRef.RECORDID();
      CommentLine.EditCommentLines(CommentLine."Table Name"::"Purchase Requisition Line", RID);
    END;

    PROCEDURE AssignBudgetToRequisition@1100529403(VAR BudgetLine@1100529400 : Record 11012001;CheckMarked@1100529406 : Boolean);
    VAR
      PurchaseRequisitionLine@1100529405 : Record 11229331;
      LastLine@1100529404 : Integer;
      CommentLine@1100529403 : Record 11020634;
      OriginRecRef@1100529402 : RecordRef;
      TargetRecRef@1100529401 : RecordRef;
      AdjustmentFactor@1100528900 : Decimal;
    BEGIN
      IF CheckMarked THEN BEGIN
        IF NOT BudgetLine.FINDFIRST THEN BEGIN
          ERROR(Text000);
          EXIT;
        END;
      END;

      PurchaseRequisitionLine.SETRANGE("Purchase Requisition No.", "Purchase Requisition No.");
      IF PurchaseRequisitionLine.FINDLAST THEN
        LastLine := PurchaseRequisitionLine."Line No.";

      IF BudgetLine.FINDSET THEN BEGIN
        REPEAT
          PurchaseRequisitionLine.INIT;
          PurchaseRequisitionLine."Purchase Requisition No." := "Purchase Requisition No.";
          PurchaseRequisitionLine."Line No." := LastLine + 10000;
          LastLine := PurchaseRequisitionLine."Line No.";
          PurchaseRequisitionLine.INSERT(TRUE);
          PurchaseRequisitionLine.InitRecord;
          PurchaseRequisitionLine.Description := BudgetLine.Description;
          PurchaseRequisitionLine."Description 2" := BudgetLine."Description 2";
          PurchaseRequisitionLine.Quantity := BudgetLine.Quantity;
          PurchaseRequisitionLine."Unit of Measure" := BudgetLine."Unit of Measure";
          PurchaseRequisitionLine."Currency Code" := BudgetLine."Currency Code";
          PurchaseRequisitionLine."Currency Agreement" := BudgetLine."Currency Agreement";
          //DP01676.sn
          AdjustmentFactor := 1;
          IF (BudgetLine."Cost Type" = BudgetLine."Cost Type"::Subcontracting) OR
             (BudgetLine."Cost Type" = BudgetLine."Cost Type"::Plant) THEN BEGIN
            IF BudgetLine.Norm <> 0 THEN
               AdjustmentFactor := BudgetLine.Norm;
          END;
          //DP01676.en
          PurchaseRequisitionLine."Gross Price (LCY)" := BudgetLine."Gross Price (LCY)" * AdjustmentFactor;
          PurchaseRequisitionLine."Gross Price (FCY)" := BudgetLine."Gross Price (FCY)" * AdjustmentFactor;
          PurchaseRequisitionLine."Discount %" := BudgetLine."Discount %";
          PurchaseRequisitionLine."Price (LCY)" := BudgetLine."Price (LCY)" * AdjustmentFactor;
          PurchaseRequisitionLine."Price (FCY)" := BudgetLine."Price (FCY)" * AdjustmentFactor;
          PurchaseRequisitionLine."Amount (LCY)" := BudgetLine."Amount (LCY)";
          PurchaseRequisitionLine."Amount (FCY)" := BudgetLine."Amount (FCY)";
          PurchaseRequisitionLine."Budget Amount (LCY)" := BudgetLine."Amount (LCY)";
          PurchaseRequisitionLine."Project No." := BudgetLine."Project No.";
          PurchaseRequisitionLine.Element := BudgetLine.Element;
          PurchaseRequisitionLine."Extension Contract" := BudgetLine."Extension Contract";
          PurchaseRequisitionLine."Cost Type" := BudgetLine."Cost Type" - 1;
          PurchaseRequisitionLine."Cost Object" := BudgetLine."Cost Object";
          PurchaseRequisitionLine."Cost Component" := BudgetLine."Cost Component";
          PurchaseRequisitionLine."Item No." := BudgetLine."Item No.";
          PurchaseRequisitionLine."Basic Item" := BudgetLine."Basic Item";
          PurchaseRequisitionLine.Manufacturer := BudgetLine.Manufacturer;
          PurchaseRequisitionLine."Trade Item" := BudgetLine."Trade Item";
          PurchaseRequisitionLine."Vendor (Trade Item)" := BudgetLine."Vendor (Trade Item)";
          PurchaseRequisitionLine.Vendor := BudgetLine.Vendor;
          PurchaseRequisitionLine."Subcontracting Activity" := BudgetLine."Subcontracting Activity";  //DP01958a
          IF BudgetLine."Plant Company" = '' THEN
            PurchaseRequisitionLine."Plant Type" := BudgetLine."Plant Type";
          //PurchaseRequisitionLine."Plant No." := BudgetLine."Plant No.";
          //PurchaseRequisitionLine."Cost Component Plant" := BudgetLine."Cost Component Plant";
          PurchaseRequisitionLine."External Text" := BudgetLine."External Text";
          PurchaseRequisitionLine."Description 2" := BudgetLine."Description 2";
          PurchaseRequisitionLine."External Text Block" := BudgetLine."External Text Block";
          PurchaseRequisitionLine."Comments for Logistics" := BudgetLine."Comments for Logistics";
          PurchaseRequisitionLine."Purchase Action" := BudgetLine."Purchase Action";
          PurchaseRequisitionLine."Purchase Route Reference" := BudgetLine."Purchase Route Reference";
          PurchaseRequisitionLine."Price Agreement" := BudgetLine."Price Agreement";
          PurchaseRequisitionLine."Budget Line" := BudgetLine."Line No.";
          PurchaseRequisitionLine.ValidateShortcutDimCode(2, PurchaseRequisitionLine."Cost Object");
          PurchaseRequisitionLine.MODIFY;
          //
          OriginRecRef.GETTABLE(BudgetLine);
          TargetRecRef.GETTABLE(PurchaseRequisitionLine);
          CommentLine.CopyCommentLines2(
            CommentLine."Table Name"::Budget,
            CommentLine."Table Name"::"Purchase Requisition Line",
            OriginRecRef, TargetRecRef);
        UNTIL BudgetLine.NEXT = 0;
      END;
    END;

    PROCEDURE AssignServiceBudgetToRequisition@1100527700(VAR ServiceBudgetLine@1100529400 : Record 11012875;CheckMarked@1100529406 : Boolean);
    VAR
      PurchaseRequisitionLine@1100529405 : Record 11229331;
      LastLine@1100529404 : Integer;
      AdjustmentFactor@1100528900 : Decimal;
    BEGIN
      IF CheckMarked THEN BEGIN
        IF NOT ServiceBudgetLine.FINDFIRST THEN BEGIN
          ERROR(Text000);
          EXIT;
        END;
      END;

      PurchaseRequisitionLine.SETRANGE("Purchase Requisition No.", "Purchase Requisition No.");
      IF PurchaseRequisitionLine.FINDLAST THEN
        LastLine := PurchaseRequisitionLine."Line No.";

      IF ServiceBudgetLine.FINDSET THEN BEGIN
        REPEAT
          PurchaseRequisitionLine.INIT;
          PurchaseRequisitionLine."Purchase Requisition No." := "Purchase Requisition No.";
          PurchaseRequisitionLine."Line No." := LastLine + 10000;
          LastLine := PurchaseRequisitionLine."Line No.";
          PurchaseRequisitionLine.INSERT(TRUE);
          PurchaseRequisitionLine.InitRecord;
          PurchaseRequisitionLine.Description := ServiceBudgetLine.Description;
          PurchaseRequisitionLine."Description 2" := ServiceBudgetLine."Description 2";
          PurchaseRequisitionLine.Quantity := ServiceBudgetLine.Quantity;
          PurchaseRequisitionLine."Unit of Measure" := ServiceBudgetLine."Unit of Measure";
          AdjustmentFactor := 1;
          IF (ServiceBudgetLine."Cost Type" = ServiceBudgetLine."Cost Type"::Subcontracting) OR
             (ServiceBudgetLine."Cost Type" = ServiceBudgetLine."Cost Type"::Plant) THEN BEGIN
            IF ServiceBudgetLine.Norm <> 0 THEN
               AdjustmentFactor := ServiceBudgetLine.Norm;
          END;
          PurchaseRequisitionLine."Gross Price (LCY)" := ServiceBudgetLine."Gross Price" * AdjustmentFactor;
          PurchaseRequisitionLine."Gross Price (FCY)" := ServiceBudgetLine."Gross Price" * AdjustmentFactor;
          PurchaseRequisitionLine."Discount %" := ServiceBudgetLine."Discount %";
          PurchaseRequisitionLine."Price (LCY)" := ServiceBudgetLine.Price * AdjustmentFactor;
          PurchaseRequisitionLine."Price (FCY)" := ServiceBudgetLine.Price * AdjustmentFactor;
          PurchaseRequisitionLine."Amount (LCY)" := ServiceBudgetLine.Amount;
          PurchaseRequisitionLine."Amount (FCY)" := ServiceBudgetLine.Amount;
          PurchaseRequisitionLine."Budget Amount (LCY)" := ServiceBudgetLine.Amount;
          PurchaseRequisitionLine."Service Order No." := ServiceBudgetLine."Service Order No.";
          PurchaseRequisitionLine."Cost Type" := ServiceBudgetLine."Cost Type" - 1;
          PurchaseRequisitionLine."Cost Object" := ServiceBudgetLine."Cost Object";
          PurchaseRequisitionLine."Cost Component" := ServiceBudgetLine."Cost Component";
          PurchaseRequisitionLine."Item No." := ServiceBudgetLine."Item No.";
          PurchaseRequisitionLine."Basic Item" := ServiceBudgetLine."Basic Item";
          PurchaseRequisitionLine.Manufacturer := ServiceBudgetLine.Manufacturer;
          PurchaseRequisitionLine."Trade Item" := ServiceBudgetLine."Trade Item";
          PurchaseRequisitionLine."Vendor (Trade Item)" := ServiceBudgetLine."Vendor (Trade Item)";
          PurchaseRequisitionLine.Vendor := ServiceBudgetLine.Vendor;
          PurchaseRequisitionLine."Subcontracting Activity" := ServiceBudgetLine."Subcontracting Activity";  //DP01958a
          IF ServiceBudgetLine."Plant Company" = '' THEN
            PurchaseRequisitionLine."Plant Type" := ServiceBudgetLine."Plant Type";
          PurchaseRequisitionLine."External Text" := ServiceBudgetLine."External Text";
          PurchaseRequisitionLine."Description 2" := ServiceBudgetLine."Description 2";
          PurchaseRequisitionLine."External Text Block" := ServiceBudgetLine."External Text Block";
          PurchaseRequisitionLine."Comments for Logistics" := ServiceBudgetLine."Comments for Logistics";
          PurchaseRequisitionLine."Purchase Route Reference" := ServiceBudgetLine."Purchase Route Reference";
          PurchaseRequisitionLine."Price Agreement" := ServiceBudgetLine."Price Agreement";
          PurchaseRequisitionLine."Budget Line" := ServiceBudgetLine."Line No.";
          PurchaseRequisitionLine.ValidateShortcutDimCode(2, PurchaseRequisitionLine."Cost Object");
          PurchaseRequisitionLine.MODIFY;

        UNTIL ServiceBudgetLine.NEXT = 0;
      END;
    END;

    PROCEDURE HandleLookupItem@1100528900(lvFieldNo@1100525004 : Integer) lvRefresh : Boolean;
    VAR
      ItemRec@1100525012 : Record 27;
      BasicItemRec@1100525011 : Record 11012316;
      TradeItemRec@1100525010 : Record 11012317;
      ItemFrm@1100525009 : Page 31;
      BasicItemFrm@1100525008 : Page 11012333;
      TradeItemFrm@1100525007 : Page 11012334;
      lvRefDate@1100525003 : Date;
      lvDiscRef1@1100525002 : Code[20];
      lvDiscRef2@1100525001 : Code[20];
      g_ItemCode@1100525014 : Code[20];
      g_Vendor@1100525013 : Code[20];
      lvTempRequisitionLine@1100525006 : TEMPORARY Record 11229331;
    BEGIN
      //DP01314
      IF lvFieldNo = FIELDNO("Item No.") THEN BEGIN
        CLEAR(ItemFrm);
        ItemFrm.LOOKUPMODE(TRUE);
        ItemFrm.DetermineInterface(
          DATABASE::"Purchase Requisition Line",
          "Purchase Requisition No.", "Project No.", "Extension Contract", Element, 0, "Service Order No.", '', "Line No.", '', '');
        IF ItemRec.GET("Item No.") THEN
          ItemFrm.SETRECORD(ItemRec);
        IF ItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cost Type", "Cost Type"::Material);
          IF "Cost Type" = "Cost Type"::Material THEN BEGIN
            ItemFrm.GETRECORD(ItemRec);
            VALIDATE("Item No.", ItemRec."No.");
          END;
        END ELSE BEGIN
          lvRefresh := ItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Basic Item") THEN BEGIN
        CLEAR(BasicItemFrm);
        BasicItemFrm.LOOKUPMODE(TRUE);
        BasicItemFrm.SetSelection(DATABASE::"Purchase Requisition Line",
          "Purchase Requisition No.", "Project No.", "Extension Contract", Element, 0, "Service Order No.", '', "Line No.", '', '');

        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
        BasicItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);

        BasicItemRec.InitLookup(BasicItemRec, "Basic Item", Manufacturer);
        BasicItemFrm.SETRECORD(BasicItemRec);

        IF BasicItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cost Type", "Cost Type"::Material);
          IF "Cost Type" = "Cost Type"::Material THEN BEGIN
            BasicItemFrm.GETRECORD(BasicItemRec);
            Manufacturer := BasicItemRec.Manufacturer;
            VALIDATE("Basic Item", BasicItemRec."Product Code");
          END;
        END ELSE BEGIN
          lvRefresh := BasicItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Trade Item") THEN BEGIN
        IF "Item No." <> '' THEN BEGIN
          lvTempRequisitionLine.COPY(Rec);
          lvTempRequisitionLine.VALIDATE("Item No.", "Item No.");
          g_ItemCode := lvTempRequisitionLine."Trade Item";
          g_Vendor := lvTempRequisitionLine."Vendor (Trade Item)";
        END ELSE BEGIN
          g_ItemCode := '';
          g_Vendor := '';
        END;

        CLEAR(TradeItemFrm);
        TradeItemFrm.LOOKUPMODE(TRUE);
        TradeItemFrm.SetSelection(DATABASE::"Purchase Requisition Line",
          "Purchase Requisition No.", "Project No.", "Extension Contract", Element, 0, "Service Order No.", '', "Line No.", '', '',
          "Vendor (Trade Item)", "Trade Item", Manufacturer, "Basic Item", g_ItemCode, g_Vendor);

        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
        TradeItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);

        TradeItemRec.InitLookup(TradeItemRec, "Basic Item", Manufacturer, "Trade Item", "Vendor (Trade Item)");
        TradeItemFrm.SETRECORD(TradeItemRec);

        IF TradeItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cost Type", "Cost Type"::Material);
          IF "Cost Type" = "Cost Type"::Material THEN BEGIN
            TradeItemFrm.GETRECORD(TradeItemRec);
            Manufacturer := TradeItemRec.Manufacturer;
            "Basic Item" := TradeItemRec."Product Code";
            "Vendor (Trade Item)" := TradeItemRec.Vendor;
            VALIDATE("Trade Item", TradeItemRec."Item Code");
          END;
        END ELSE BEGIN
          lvRefresh := TradeItemFrm.CheckMultiCopy;
        END;
      END;
      EXIT(lvRefresh);
    END;

    PROCEDURE ShowDimensions@1100529600();
    VAR
      PurchaseRequisition@1100529600 : Record 11229330;
    BEGIN
      DimMgt.SetTableID(DATABASE::"Purchase Requisition Line");
      IF PurchaseRequisitionIsFixed OR IsProcessed THEN
        DimMgt.ShowDimensionSet("Dimension Set ID", STRSUBSTNO('%1 %2 %3',
                                                    PurchaseRequisition.TABLECAPTION, "Purchase Requisition No.", "Line No."))
      ELSE BEGIN
        "Dimension Set ID" := DimMgt.EditDimensionSet("Dimension Set ID", STRSUBSTNO('%1 %2 %3',
                                                      PurchaseRequisition.TABLECAPTION, "Purchase Requisition No.", "Line No."));
        DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID", "Global Dimension 1 Code", "Cost Object");
      END;
    END;

    PROCEDURE ValidateShortcutDimCode@1100529602(FieldNumber@1100529600 : Integer;VAR ShortcutDimCode@1100529601 : Code[20]);
    BEGIN
      IF FieldNumber = 1 THEN
        DimMgt.CheckDepartmentAuthorization(DATABASE::"Purchase Requisition Line", ShortcutDimCode);
      DimMgt.ValidateShortcutDimValues(FieldNumber, ShortcutDimCode, "Dimension Set ID");
    END;

    PROCEDURE LookupShortcutDimCode@1100529603(FieldNumber@1100529600 : Integer;VAR ShortcutDimCode@1100529601 : Code[20]);
    VAR
      ShortcutDimCodeOld@1100529603 : Code[20];
    BEGIN
      ShortcutDimCodeOld := ShortcutDimCode;
      DimMgt.LookupDimValueCode(FieldNumber, ShortcutDimCode);
      IF PurchaseRequisitionIsFixed THEN
        ShortcutDimCode := ShortcutDimCodeOld
      ELSE
        ValidateShortcutDimCode(FieldNumber, ShortcutDimCode);
    END;

    PROCEDURE ShowShortcutDimCode@1100529604(VAR ShortcutDimCode@1100529600 : ARRAY [8] OF Code[20]);
    BEGIN
      DimMgt.GetShortcutDimensions("Dimension Set ID", ShortcutDimCode);
    END;

    LOCAL PROCEDURE PurchaseRequisitionIsFixed@1100529601() : Boolean;
    VAR
      PurchaseRequisition@1100529600 : Record 11229330;
    BEGIN
      IF "Purchase Requisition No." = '' THEN
        EXIT(FALSE);
      IF NOT PurchaseRequisition.GET("Purchase Requisition No.") THEN
        EXIT(FALSE);
      EXIT(PurchaseRequisition.Fixed);
    END;

    LOCAL PROCEDURE CheckVendorPricePerQuantity@1100525029();
    VAR
      InventorySetup@1100525004 : Record 313;
      PurchaseRequisitionLine@1100525000 : Record 11229331;
      GrossPrice@1100525001 : Decimal;
      DiscountPerc@1100525002 : Decimal;
      CostPrice@1100525003 : Decimal;
    BEGIN
      //C045045
      IF "Item No." = '' THEN EXIT;
      IF "Trade Item" <> '' THEN BEGIN
        InventorySetup.GET;
        IF (InventorySetup."Price Info Trade Item Leading" = TRUE) THEN EXIT;
      END;
      //
      PurchaseRequisitionLine := Rec;
      CheckVendorPrice := TRUE;
      ValidateItem(ItemTypeOpt::Item);
      CheckVendorPrice := FALSE;
      GrossPrice:= "Gross Price (LCY)";
      DiscountPerc := "Discount %";
      CostPrice:= "Price (LCY)";
      Rec := PurchaseRequisitionLine;
      //
      "Gross Price (LCY)" := GrossPrice;
      "Discount %" := DiscountPerc;
      "Price (LCY)" := CostPrice;
      VALIDATE("Gross Price (LCY)");
      CalculateTotal;
    END;

    LOCAL PROCEDURE GetSubcontractorActivity@1100529900(CalledBy@1100528900 : Integer);
    VAR
      SubcontractingActivityPrice@1100529900 : Record 11229373;
    BEGIN
      //DP01492-2
      TESTFIELD("Cost Type", "Cost Type"::Subcontracting);
      SubcontractingActivityPrice.SETRANGE("Subcontracting Activity", "Subcontracting Activity");
      IF CalledBy = FIELDNO("Subcontracting Activity") THEN  //DP01958a
        SubcontractingActivityPrice.SETRANGE("Preferred Subcontractor", TRUE)
      ELSE
        SubcontractingActivityPrice.SETRANGE("Subcontractor No.", Vendor);
      IF SubcontractingActivityPrice.FINDFIRST THEN BEGIN
        VALIDATE("Price (LCY)", SubcontractingActivityPrice.GetPrice(TODAY));
        IF CalledBy = FIELDNO("Subcontracting Activity") THEN BEGIN  //DP01958a
          SubcontractingActivityPrice.CALCFIELDS("Activity Description");
          Description := SubcontractingActivityPrice."Activity Description";
        END;
        "Unit of Measure" := SubcontractingActivityPrice."Unit of Measure";
        "Cost Object" := SubcontractingActivityPrice."Cost Object";
        Vendor := SubcontractingActivityPrice."Subcontractor No.";
      END;
    END;

    PROCEDURE GetVendorPrice@1100525002(iVendor@1100525000 : Code[20];iPrice@1100525004 : Decimal;VAR oCurrency@1100525002 : Code[20]) oPrice : Decimal;
    VAR
      VendorRec@1100525003 : Record 23;
      CurrExchRate@1100525006 : Record 330;
      CurrFactor@1100525005 : Decimal;
      lvText000@1100525001 : TextConst 'ENU=%1 not found;SVE=%1 hittades inte';
      RefDate@1100525007 : Date;
    BEGIN
      //C049675
      oCurrency := '';
      IF VendorRec.GET(iVendor) THEN BEGIN
        oCurrency := VendorRec."Currency Code";
        RefDate := WORKDATE;
        //Type: 0=General, 1=Project, 2=Estimate
        IF ProjRec.GET("Project No.") THEN BEGIN
          IF ProjRec."Reference Date (Currency)" <> 0D THEN
            RefDate := ProjRec."Reference Date (Currency)";
          CurrFactor := CurrExchRate.ExchangeRate(1, "Project No.", RefDate, oCurrency, FALSE);
        END ELSE BEGIN
          CurrFactor := CurrExchRate.ExchangeRate(0, '', RefDate, oCurrency, FALSE);
        END;
        IF CurrFactor = 0 THEN
          ERROR(lvText000, CurrExchRate.TABLECAPTION);
      END;
      IF oCurrency = '' THEN
        oPrice := iPrice
      ELSE
        oPrice := iPrice * CurrFactor;

      EXIT(oPrice);
    END;

    PROCEDURE IsTextLine@1100529801() : Boolean;
    BEGIN
      IF (Quantity <> 0) OR ("Amount (LCY)" <> 0) OR ("Amount (FCY)" <> 0) THEN
        EXIT(FALSE);
      IF ("Item No." <> '') OR ("Basic Item" <> '') OR ("Trade Item" <> '') THEN
        EXIT(FALSE);
      IF ("Plant Type" <> '') OR ("Plant No." <> '') THEN
        EXIT(FALSE);
      IF ("G/L Account" <> '') THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE ValidateRelatedTextLines@1100529803();
    VAR
      PurchReqLine2@1100529800 : Record 11229331;
    BEGIN
      PurchReqLine2.SETRANGE("Purchase Requisition No.", "Purchase Requisition No.");
      PurchReqLine2 := Rec;
      WHILE (PurchReqLine2.NEXT <> 0) AND PurchReqLine2.IsTextLine AND (PurchReqLine2.Vendor = xRec.Vendor) DO BEGIN
        PurchReqLine2.Vendor := Rec.Vendor;
        PurchReqLine2.MODIFY;
      END;
    END;

    LOCAL PROCEDURE ValidateShipToLocation@1100528000(GiveMessage@1100528000 : Boolean) ShipToLocIsValid : Boolean;
    VAR
      ProjLocRec@1100529400 : Record 11012011;
      LocRec@1100529402 : Record 14;
      PlantLocRec@1100528900 : Record 11012554;
      ContactRec@1100528901 : Record 5050;
      ServOrderLocRec@1100525000 : Record 11071688;
      ServiceOrder@1100528400 : Record 11012823;
    BEGIN
      // Copied from Advice Order Line
      ShipToLocIsValid := TRUE;
      CASE Deliver OF
        Deliver::" ":
          BEGIN
            IF "Ship To Location" <> '' THEN
              IF GiveMessage THEN
                ERROR(Text000, FIELDCAPTION(Deliver))
              ELSE
                ShipToLocIsValid := FALSE;
          END;
        Deliver::Location:
          BEGIN
            IF "Ship To Location" = '' THEN
              IF GiveMessage THEN
                ERROR(Text000, FIELDCAPTION("Ship To Location"))
              ELSE
                ShipToLocIsValid := FALSE
            ELSE
              IF GiveMessage THEN
                LocRec.GET("Ship To Location")
              ELSE
                ShipToLocIsValid := LocRec.GET("Ship To Location");
          END;
        Deliver::"Project Location":
          BEGIN
            IF "Ship To Location" = '' THEN
              IF GiveMessage THEN
                ERROR(Text000, FIELDCAPTION("Ship To Location"))
              ELSE
                ShipToLocIsValid := FALSE
            ELSE
              IF GiveMessage THEN
                ProjLocRec.GET("Project No.", "Ship To Location")
              ELSE
                ShipToLocIsValid := ProjLocRec.GET("Project No.", "Ship To Location");
          END;
       Deliver::"Service Location":
          BEGIN
            IF ServiceOrder.GET("Service Order No.") THEN;
            IF ("Ship To Location" <> '') OR
               ServiceOrder.ServiceLocationHasDefaultShipToAddress
            THEN
              IF GiveMessage THEN
                ServOrderLocRec.GET("Service Order No.", "Ship To Location")
              ELSE
                ShipToLocIsValid := ServOrderLocRec.GET("Service Order No.", "Ship To Location");
          END;
        Deliver::"Plant Location":
          BEGIN
            IF "Ship To Location" = '' THEN
              IF GiveMessage THEN
                ERROR(Text000, FIELDCAPTION("Ship To Location"))
              ELSE
                ShipToLocIsValid := FALSE
            ELSE
              IF GiveMessage THEN
                PlantLocRec.GET("Ship To Location")
              ELSE
                ShipToLocIsValid := PlantLocRec.GET("Ship To Location");
          END;
        Deliver::"Contact Address":
          BEGIN
            IF "Ship To Location" = '' THEN
              IF GiveMessage THEN
                ERROR(Text000, FIELDCAPTION("Ship To Location"))
              ELSE
                ShipToLocIsValid := FALSE
            ELSE
              IF GiveMessage THEN
                ContactRec.GET("Ship To Location")
              ELSE
                ShipToLocIsValid := ContactRec.GET("Ship To Location");
          END;
      END;
    END;

    LOCAL PROCEDURE GetDefaultShipToLocation@1100528004();
    VAR
      ProjRec@1100529401 : Record 11072003;
      ProjLocRec@1100529400 : Record 11012011;
      ServOrderRec@1100525002 : Record 11012823;
      ServLocRec@1100525001 : Record 11012801;
      ProjSetup@1100525003 : Record 315;
    BEGIN
      // Copied from Advice Order Line
      "Ship To Location" := '';

      CASE Deliver OF
        Deliver::Location:
          BEGIN
            IF "Project No."<> '' THEN BEGIN
              ProjRec.GET("Project No.");
              IF ProjRec.Deliver = ProjRec.Deliver::Location THEN
                "Ship To Location" := ProjRec."Ship To Location";
            END;
            IF "Service Order No." <> '' THEN BEGIN
              ServOrderRec.GET("Service Order No.");
              IF NOT ServLocRec.GET(ServOrderRec."Service Location No.") THEN
                ServLocRec.INIT;
              IF ServLocRec.Deliver = ServLocRec.Deliver::Location THEN
                "Ship To Location" := ServLocRec."Ship To Location";
            END;
            IF "Ship To Location" = '' THEN BEGIN
              ProjSetup.GET;
              IF ProjSetup.Deliver = ProjSetup.Deliver::Location THEN
                "Ship To Location" := ProjSetup."Ship To Location";
            END;
          END;
        Deliver::"Project Location":
          BEGIN
            ProjRec.GET("Project No.");
            IF ProjRec.Deliver = ProjRec.Deliver::"Project Location" THEN BEGIN
              IF ProjRec."Ship To Location" <> '' THEN
                "Ship To Location" := ProjRec."Ship To Location"
              ELSE BEGIN
                ProjLocRec.SETRANGE("Project No.", "Project No.");
                IF ProjLocRec.FINDFIRST THEN
                  IF ProjLocRec.NEXT = 0 THEN
                    "Ship To Location" := ProjLocRec.Code;
              END;
            END;
          END;
        Deliver::"Service Location":
          IF ServOrderRec.GET("Service Order No.") THEN
            "Ship To Location" := ServOrderRec.GetDefaultServiceOrderLocationCode;
      END;
    END;

    PROCEDURE LookupPlantCompany@1100529002();
    VAR
      PlantMgtCompany@1100525001 : Record 11020586;
      TmpPlantMgtCompany@1100525002 : TEMPORARY Record 11020586;
      EditableMode@1100529000 : Boolean;
      NoOfPlantCompanies@1100525000 : Integer;
    BEGIN
      // Copied from Advice Order Line
      EditableMode := NOT PurchaseRequisitionIsFixed;
      PlantMgtCompany.GetPlantCompany(TRUE, NoOfPlantCompanies, '');
      CASE TRUE OF
        ("Project No." <> ''):
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', FALSE);
        ("Service Order No." <> ''):
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForService("Service Order No.", TmpPlantMgtCompany, '', FALSE);
        ELSE
          ERROR(Text002, FIELDCAPTION("Project No."), FIELDCAPTION("Service Order No."));
      END;

      IF NoOfPlantCompanies = 0 THEN BEGIN
        PlantMgtCompany."Plant Company" := "Plant Company";
        IF PlantMgtCompany."Plant Company" = '' THEN
          PlantMgtCompany."Plant Company" := COMPANYNAME;
        PAGE.RUNMODAL(0, PlantMgtCompany);
      END ELSE BEGIN
        TmpPlantMgtCompany."Plant Company" := "Plant Company";
        IF TmpPlantMgtCompany."Plant Company" = '' THEN
          TmpPlantMgtCompany."Plant Company" := COMPANYNAME;
        IF NOT EditableMode THEN
          PAGE.RUNMODAL(0, TmpPlantMgtCompany)
        ELSE BEGIN
          IF PAGE.RUNMODAL(0, TmpPlantMgtCompany) = ACTION::LookupOK THEN BEGIN
            xRec := Rec;
            IF TmpPlantMgtCompany."Plant Company" <> "Plant Company" THEN
              VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
          END;
        END;
      END;
    END;

    PROCEDURE LookupPlantLocation@1100529001();
    VAR
      PlantLocation@1100525001 : Record 11012554;
      EditableMode@1100529000 : Boolean;
      PlantLocCompany@1100525000 : Text;
    BEGIN
      // Copied from Advice Order Line
      EditableMode := NOT PurchaseRequisitionIsFixed;
      IF ("Project No." = '') AND ("Service Order No." = '') THEN
        ERROR(Text002, FIELDCAPTION("Project No."), FIELDCAPTION("Service Order No."));

      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantLocCompany := COMPANYNAME;
        PlantLocation.CHANGECOMPANY("Plant Company");
      END;
      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.FILTERGROUP(9);
      PlantLocation.SETRANGE(Depot, FALSE);
      PlantLocation.SETRANGE("Company Name", PlantLocCompany);
      IF "Project No." <> '' THEN BEGIN
        PlantLocation.SETRANGE("Project No.", "Project No.");
        PlantLocation.SETRANGE( "Service Order No.", '');
      END;
      IF "Service Order No." <> '' THEN BEGIN
        PlantLocation.SETRANGE("Project No.", '');
        PlantLocation.SETRANGE( "Service Order No.", "Service Order No.");
      END;
      PlantLocation.FILTERGROUP(0);
      PlantLocation.SETRANGE(Code, "Plant Location");
      IF NOT PlantLocation.FINDFIRST THEN BEGIN
        PlantLocation."Company Name" := PlantLocCompany;
        PlantLocation."Project No." := "Project No.";
        PlantLocation."Service Order No." := "Service Order No.";
      END;
      PlantLocation.SETRANGE(Code);
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, PlantLocation)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN BEGIN
          IF PlantLocation.Code <> "Plant Location" THEN
            VALIDATE("Plant Location", PlantLocation.Code);
        END;
      END;
    END;

    PROCEDURE LookupPlantLocationWithAssistEdit@1100525023();
    VAR
      PlantLocation@1100525001 : Record 11012554;
      EditableMode@1100529000 : Boolean;
      PlantLocCompany@1100525000 : Text;
    BEGIN
      // Copied from Advice Order Line
      // Lookup via AssistEdit: Show Plant Locations that are related to a customer
      EditableMode := NOT PurchaseRequisitionIsFixed;
      IF ("Project No." = '') AND ("Service Order No." = '') THEN
        ERROR(Text002, FIELDCAPTION("Project No."), FIELDCAPTION("Service Order No."));

      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantLocCompany := COMPANYNAME;
        PlantLocation.CHANGECOMPANY("Plant Company");
      END;
      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.FILTERGROUP(9);
      PlantLocation.SETRANGE(Depot, FALSE);
      PlantLocation.SETRANGE("Company Name", PlantLocCompany);
      PlantLocation.SETRANGE("Project No.", '');
      PlantLocation.SETRANGE( "Service Order No.", '');
      PlantLocation.SETRANGE("Employee No.", '');
      PlantLocation.SETRANGE("Plant Type", '');
      PlantLocation.SETFILTER("Customer No.", '<>%1', '');
      PlantLocation.FILTERGROUP(0);
      PlantLocation.SETRANGE(Code, "Plant Location");
      IF NOT PlantLocation.FINDFIRST THEN BEGIN
        PlantLocation."Company Name" := PlantLocCompany;
        PlantLocation."Project No." := '';
        PlantLocation."Service Order No." := '';
      END;
      PlantLocation.SETRANGE(Code);
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, PlantLocation)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN BEGIN
          IF PlantLocation.Code <> "Plant Location" THEN
            VALIDATE("Plant Location", PlantLocation.Code);
        END;
      END;
    END;

    PROCEDURE LookupPlantType@1100529003();
    VAR
      PlantType@1100525001 : Record 11012551;
      EditableMode@1100529000 : Boolean;
    BEGIN
      // Copied from Advice Order Line
      EditableMode := NOT PurchaseRequisitionIsFixed;
      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
        PlantType.CHANGECOMPANY("Plant Company");
      PlantType.Code := "Plant Type";
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(0, PlantType)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN BEGIN
          xRec := Rec;
          IF PlantType.Code <> "Plant Type" THEN
            VALIDATE("Plant Type", PlantType.Code);
        END;
      END;
    END;

    LOCAL PROCEDURE FillDefaultPlantCompany@1100529007();
    VAR
      PlantMgtCompany@1100529000 : Record 11020586;
      TmpPlantMgtCompany@1100529001 : TEMPORARY Record 11020586;
      NoOfPlantCompanies@1100529002 : Integer;
    BEGIN
      // Copied from Advice Order Line
      CASE TRUE OF
        ("Project No." <> ''):
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', TRUE);
        ("Service Order No." <> ''):
          NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForService("Service Order No.", TmpPlantMgtCompany, '', TRUE);
      END;
      CASE TRUE OF
        NoOfPlantCompanies = 0:
          VALIDATE("Plant Company", '');
        NoOfPlantCompanies = 1:
          BEGIN
            TmpPlantMgtCompany.FINDFIRST;
            IF TmpPlantMgtCompany."Plant Company" = COMPANYNAME THEN
              VALIDATE("Plant Company", '')
            ELSE
              VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
          END;
        NoOfPlantCompanies > 1:
          BEGIN
            TmpPlantMgtCompany.SETRANGE(Default, TRUE);
            IF NOT TmpPlantMgtCompany.FINDFIRST THEN
              VALIDATE("Plant Company", '')
            ELSE BEGIN
              IF TmpPlantMgtCompany."Plant Company" = COMPANYNAME THEN
                VALIDATE("Plant Company", '')
              ELSE
                VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE FillDefaultPlantLocation@1100529009();
    VAR
      PlantLocation@1100529000 : Record 11012554;
      PlantLocCompany@1100529001 : Text;
    BEGIN
      // Copied from Advice Order Line
      IF ("Project No." <> '') OR
         ("Service Order No." <> '')
      THEN BEGIN
        PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.");
        IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
          PlantLocCompany := COMPANYNAME;
          PlantLocation.CHANGECOMPANY("Plant Company");
        END;
        PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
        PlantLocation.SETRANGE("Company Name", PlantLocCompany);
        IF ("Project No." <> '') THEN BEGIN
          PlantLocation.SETRANGE("Project No.", "Project No.");
          PlantLocation.SETRANGE( "Service Order No.", '');
        END;
        IF ("Service Order No." <> '') THEN BEGIN
          PlantLocation.SETRANGE("Project No.", '');
          PlantLocation.SETRANGE( "Service Order No.", "Service Order No.");
        END;
        IF PlantLocation.FINDFIRST THEN BEGIN
          IF PlantLocation.NEXT = 0 THEN
            VALIDATE("Plant Location", PlantLocation.Code);
        END;
      END ELSE
        ERROR(Text002, FIELDCAPTION("Project No."), FIELDCAPTION("Service Order No."));
    END;

    PROCEDURE CheckItemInPlantCompany@1100529005();
    VAR
      Item@1100529000 : Record 27;
    BEGIN
      IF (Transaction = Transaction::Plant) AND ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) AND ("Item No." <> '') AND ("Plant Type" = '') THEN BEGIN
        //Must also be present in the plant company, so in both companies (current+plant company)
        Item.CHANGECOMPANY("Plant Company");
        IF NOT Item.GET("Item No.") THEN
          FIELDERROR("Item No.", STRSUBSTNO(Text003, "Item No.", FIELDCAPTION("Plant Company"), "Plant Company"));
      END;
    END;

    PROCEDURE IsProcessed@1100529802() : Boolean;
    BEGIN
      IF ("Document No." <> '') OR ("Document Line No." <> 0) THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE CopyDimensions@1100529804(FromTableID@1100529800 : Integer;FromNo@1100529801 : Code[20];PrevNo@1100529601 : Code[20]);
    VAR
      TableID@1100529804 : ARRAY [10] OF Integer;
      No@1100529803 : ARRAY [10] OF Code[20];
      OldInheritDimSetID@1100529600 : Integer;
      NewInheritDimSetID@1100529603 : Integer;
      DummyCode@1100529602 : Code[20];
    BEGIN
      TableID[1] := FromTableID;
      No[1] := FromNo;
      NewInheritDimSetID := DimMgt.GetDefaultDimID(TableID, No, '', DummyCode, DummyCode, 0, 0);
      No[1] := PrevNo;
      OldInheritDimSetID := DimMgt.GetDefaultDimID(TableID, No, '', DummyCode, DummyCode, 0, 0);

      "Dimension Set ID" := DimMgt.GetDeltaDimSetID("Dimension Set ID", NewInheritDimSetID, OldInheritDimSetID);
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Global Dimension 1 Code", "Cost Object");
    END;

    LOCAL PROCEDURE GetPreferenceLocation@1100527701(FromFieldNo@1100527701 : Integer) : Code[10];
    VAR
      PreferenceLocation@1100527700 : Record 11020353;
    BEGIN
      PreferenceLocation.SETCURRENTKEY(Priority);
      IF FromFieldNo = FIELDNO("Project No.") THEN BEGIN
        PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::Job);
        PreferenceLocation.SETRANGE("No.", "Project No.");
      END;
      IF FromFieldNo = FIELDNO("Service Order No.") THEN BEGIN
        PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::"Service Order");
        PreferenceLocation.SETRANGE("No.", "Service Order No.");
      END;
      PreferenceLocation.SETFILTER(Priority, '>=%1', 0);
      IF PreferenceLocation.FINDFIRST THEN
        EXIT(PreferenceLocation."Location Code");
    END;

    PROCEDURE TestStatusOpen@1100529805();
    VAR
      PurchaseRequisition@1100529800 : Record 11229330;
    BEGIN
      PurchaseRequisition.GET("Purchase Requisition No.");
      PurchaseRequisition.TESTFIELD(Status, PurchaseRequisition.Status::Open);
    END;

    PROCEDURE CheckLocationInventory@1100529605();
    VAR
      ProjSetup@1100529606 : Record 315;
      PreferenceLocation@1100529604 : Record 11020353;
      LocRec@1100529600 : Record 14;
      LocationFound@1100529603 : Boolean;
      InventoryPrefLoc@1100529602 : Decimal;
      InventoryLoc@1100529601 : Decimal;
    BEGIN
      //When transaction is Inventory then location will be filled
      //When transaction is not forced set to Purchase, transaction may be set to Inventory and Location wil be filled if item is in stock..
      IF Transaction = Transaction::Plant THEN
        EXIT;
      IF "G/L Account" <> '' THEN
        EXIT;

      CASE TRUE OF
        "Project No." <> '':
          BEGIN
            PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::Job);
            PreferenceLocation.SETRANGE("No.","Project No.");
          END;
        "Service Order No." <> '':
          BEGIN
            PreferenceLocation.SETRANGE(Type, PreferenceLocation.Type::"Service Order");
            PreferenceLocation.SETRANGE("No.","Service Order No.");
          END;
        ELSE
          EXIT;
      END;
      InventorySetup.GET;
      ProjSetup.GET;
      IF "Item No." <> '' THEN
        IF ItemRec.GET("Item No.") THEN;
      PreferenceLocation.SETCURRENTKEY(Priority);
      IF PreferenceLocation.FINDSET THEN BEGIN
        REPEAT
          InventoryLoc := GetInventory(PreferenceLocation."Location Code",ItemRec,FALSE);
          InventoryPrefLoc += InventoryLoc;
          IF (InventoryLoc >= Quantity) AND (InventoryLoc > 0) THEN BEGIN
            LocationFound := TRUE;
            "Location Code" := PreferenceLocation."Location Code";
            Transaction := Transaction::Inventory;
          END;
        UNTIL (PreferenceLocation.NEXT = 0) OR LocationFound;
        IF NOT LocationFound THEN
          IF (InventoryPrefLoc >= Quantity) AND (InventoryPrefLoc > 0) THEN
            Transaction := Transaction::Inventory
          ELSE BEGIN
            InventoryLoc := GetInventory("Location Code",ItemRec,FALSE);
            IF (InventoryLoc >= Quantity) AND (InventoryLoc > 0) THEN
              Transaction := Transaction::Inventory;
          END;
      END ELSE BEGIN
        //Try Current Location First
        IF ("Location Code" = '') AND NOT InventorySetup."Location Mandatory" THEN BEGIN
          ItemRec.SETRANGE("Location Filter", "Location Code");
          ItemRec.CALCFIELDS(Inventory);
          IF (ItemRec.Inventory >= Quantity) AND (ItemRec.Inventory > 0) THEN BEGIN
            LocationFound := TRUE;
            Transaction := Transaction::Inventory;
          END;
        END;
        //
        IF NOT LocationFound THEN
          IF LocRec.FINDSET THEN BEGIN
            REPEAT
              InventoryLoc := GetInventory(LocRec.Code,ItemRec,FALSE);
              IF (InventoryLoc >= Quantity) AND (InventoryLoc > 0) THEN BEGIN
                LocationFound := TRUE;
                "Location Code" := LocRec.Code;
                Transaction := Transaction::Inventory;
              END;
            UNTIL (LocRec.NEXT = 0) OR LocationFound;
          END;
        IF NOT LocationFound THEN BEGIN
          InventoryLoc := GetInventory('', ItemRec, FALSE);
          IF (InventoryLoc >= Quantity) AND (InventoryLoc > 0) THEN BEGIN
            LocationFound := TRUE;
            "Location Code" := '';
            Transaction := Transaction::Inventory;
          END;
          IF NOT LocationFound AND
            (CurrFieldNo <> FIELDNO(Transaction))
          THEN
            Transaction := Transaction::"Purchase Order";
        END;
      END;

      IF NOT LocationFound THEN
        IF Deliver <> Deliver::Location THEN
          "Location Code" := '';
    END;

    PROCEDURE GetInventory@1100525003(Location@1100525000 : Code[10];VAR Item@1100525002 : Record 27;AllLocations@1100525001 : Boolean) Inventory : Decimal;
    VAR
      ItemAvailFormsMgt@1100525005 : Codeunit 353;
    BEGIN
      ItemAvailFormsMgt.SetCompany('');
      EXIT(ItemAvailFormsMgt.GetInventory(Location,Item,AllLocations,"Requested Receipt Date"));
    END;

    BEGIN
    {
      4PS 07-11-16 UKR-C21173 KD: New project inventory screen (BI006) - Changed trigger OnDelete
    }
    END.
  }
}

