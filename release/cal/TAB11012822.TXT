OBJECT Table 11012822 Service Call
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    Permissions=TableData 11012055=i,
                TableData 11012822=d,
                TableData 11012823=i;
    DataCaptionFields=No.,Description;
    OnInsert=VAR
               DispatchSetup@1100528600 : Record 11072270;
               ServiceProcessManagement@1100528601 : Codeunit 11012883;
             BEGIN
               IF ("No." = '') AND (Origin = Origin::Dispatch) THEN BEGIN
                 DispatchSetup.GET;
                 DispatchSetup.TESTFIELD("Service Call Nos.");
                 NoSeriesMgt.InitSeries(DispatchSetup."Service Call Nos.", xRec."No. Series", 0D, "No.", "No. Series");
               END;

               ServSetup.GET;
               IF "No." = '' THEN BEGIN
                 ServSetup.TESTFIELD("Call Nos.");
                 NoSeriesMgt.InitSeries(ServSetup."Call Nos.",xRec."No. Series",0D,"No.","No. Series");
                 //IF ServSetup."Assign To" = ServSetup."Assign To"::User THEN
                 //  IF UserSetup.GET(USERID) THEN
                 //    "Assigned to" := UserSetup."Employee No.";
               END;

               IF ServSetup."Default Call Kind" <> '' THEN
                 "Call Kind" := ServSetup."Default Call Kind";
               IF ServSetup."Default Call Type" <> '' THEN
                 "Call Type" := ServSetup."Default Call Type";

               //C019333.sn
               IF "Assigned to" = '' THEN
                 IF ServSetup."Assign To" = ServSetup."Assign To"::User THEN
                   IF UserSetup.GET(USERID) THEN
                     VALIDATE("Assigned to", UserSetup."Employee No.");
               IF "Order Manager" = '' THEN
                 IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::User THEN
                   IF UserSetup.GET(USERID) THEN
                     VALIDATE("Order Manager", UserSetup.Salesperson);
               //C019333.en

               IF (NOT gUseFilledOrderDateTime) THEN BEGIN
                 IF NOT GUIALLOWED THEN BEGIN
                   "Receiving Date":= TODAY;
                 END ELSE BEGIN
                   "Receiving Date":= WORKDATE;
                 END;
                 "Receiving Time":= TIME;
               END;
               "Received by" := USERID;
               "Next Step" := "Next Step"::" ";
               "Service Order No." := '';
               "Sales Document No." := '';
               "Project (Dest)" := '';
               "Previous Call No." := '';
               Status := Status::Received;
               CheckUpdateDocRefPoint('I');
               VALIDATE("Progress Scheme", ProgSchemeRec.DetermineProgrScheme("No. Series","No."));
               ProgPhaseRec.CheckProgressScheme(ProgPhaseRec.Type::ServCall, "Progress Scheme", "No.", Status, TODAY, TIME);
               UpdateNextDeadline;
               CheckConsignment;

               IF ServSetup."Use Vessel Functionality" THEN
                 "Vessel Service Call" := TRUE;

               //**4PS Generated Code. Do Not Change.sn05
               DPA_OnInsert;
               //**4PS Generated Code.en05

               NormalizePostCodeHouseNo;
               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, FALSE);
             END;

    OnModify=VAR
               ServiceProcessManagement@1100528600 : Codeunit 11012883;
             BEGIN
               "Modified on" := TODAY;
               "Modified by" := USERID;

               CheckUpdateDocRefPoint('M');
               UpdateNextDeadline;
               NormalizePostCodeHouseNo;

               ServiceProcessManagement.CheckAllowedValues(Rec, xRec, FALSE);
             END;

    OnDelete=VAR
               CommentLine@1100485000 : Record 97;
               lvDocRefPointRec@1100485001 : Record 11020296;
               ServiceText@1210190000 : Record 11012882;
               ServSourceProcStepCheck@1100528600 : Record 11072324;
               UpdateAction@1100525000 : 'Insert,Modify,Delete,Rename';
             BEGIN
               DisconnectChain;

               ServActRec.SETRANGE("Service Call No.", "No.");
               ServActRec.DELETEALL(TRUE);

               ServLogRec.SETRANGE("Document Type", ServLogRec."Document Type"::ServCall);
               ServLogRec.SETRANGE("Document No.", "No.");
               ServLogRec.DELETEALL(TRUE);

               ProgPhaseRec.SETRANGE(Type, ProgPhaseRec.Type::ServCall);
               ProgPhaseRec.SETRANGE("Document No.", "No.");
               ProgPhaseRec.DELETEALL(TRUE);

               RefPeriodRec.SETCURRENTKEY(Type, "Document No.");
               RefPeriodRec.SETRANGE(Type, RefPeriodRec.Type::ServCall);
               RefPeriodRec.SETRANGE("Document No.", "No.");
               RefPeriodRec.DELETEALL(TRUE);

               lvDocRefPointRec.SETRANGE(Type, lvDocRefPointRec.Type::ServCall);
               lvDocRefPointRec.SETRANGE("Document No.", "No.");
               IF lvDocRefPointRec.FINDSET() THEN
                 REPEAT
                   lvDocRefPointRec.InsertDocRefPointQueueEntry(UpdateAction::Delete);
                 UNTIL lvDocRefPointRec.NEXT = 0;
               lvDocRefPointRec.DELETEALL;

               CommentLine.SETRANGE("Table Name",CommentLine."Table Name"::"Service Call");
               CommentLine.SETRANGE("No.","No.");
               CommentLine.DELETEALL;

               ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Call");
               ServiceText.SETRANGE("No.","No.");
               ServiceText.DELETEALL;

               ServSourceProcStepCheck.SETRANGE(Type, ServSourceProcStepCheck.Type::"Service Call");
               ServSourceProcStepCheck.SETRANGE("Source No.", "No.");
               ServSourceProcStepCheck.DELETEALL(TRUE);
             END;

    OnRename=BEGIN
               ERROR(Text999);  //db, 07-01-10: MC-018112
             END;

    CaptionML=[ENU=Service Call;
               NOR=Servicesamtale;
               SVE=Servicesamtal];
    LookupPageID=Page11012828;
    DrillDownPageID=Page11012828;
  }
  FIELDS
  {
    { 10  ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                IF "No." <> xRec."No." THEN BEGIN
                                                                  ServSetup.GET;
                                                                  NoSeriesMgt.TestManual(ServSetup."Call Nos.");
                                                                  "No. Series" := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=No.;
                                                              NOR=Nr;
                                                              SVE=Nr] }
    { 20  ;   ;Customer No.        ;Code20        ;TableRelation=Customer.No.;
                                                   OnValidate=VAR
                                                                ServiceContract@1100528600 : Record 11012812;
                                                                lvBillToCust@1100485000 : Code[20];
                                                              BEGIN
                                                                IF CurrFieldNo = FIELDNO("Customer No.") THEN BEGIN
                                                                  IF "Service Location No." <> '' THEN BEGIN
                                                                    ServLocRec.GET("Service Location No.");
                                                                    IF ("Service Contract No." = '') AND (ServLocRec."Customer No." <> '') THEN BEGIN
                                                                      TESTFIELD("Customer No.", ServLocRec."Customer No.")
                                                                    END ELSE
                                                                      IF "Service Contract No." <> '' THEN
                                                                        IF ServiceContract.GET("Service Contract No.") THEN
                                                                          IF ServiceContract."Customer No." <> '' THEN
                                                                            TESTFIELD("Customer No.", ServiceContract."Customer No.");
                                                                  END;
                                                                  CheckOrderNoCustomer;  //db, 16-11-09: M13354
                                                                END;
                                                                IF "Customer No." <> xRec."Customer No." THEN
                                                                  ValidateAddressData(1);

                                                                IF NOT CustRec.GET("Customer No.") THEN CustRec.INIT;
                                                                IF CustRec."Bill-to Customer No." <> '' THEN
                                                                  lvBillToCust := CustRec."Bill-to Customer No."
                                                                ELSE
                                                                  lvBillToCust := "Customer No.";
                                                                IF ("Bill-to Customer No." = '') OR ("Customer No." = '') THEN BEGIN  //db, 23-02-09: M13533
                                                                  VALIDATE("Bill-to Customer No.",lvBillToCust);
                                                                  CheckInvoiceAddress;
                                                                END;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Customer No.;
                                                              NOR=Kundenr;
                                                              SVE=Kundnr] }
    { 21  ;   ;Name                ;Text100       ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Name;
                                                              NOR=Navn;
                                                              SVE=Namn] }
    { 22  ;   ;Address             ;Text100       ;OnValidate=VAR
                                                                lDummy@1210190000 : Text[30];
                                                              BEGIN
                                                              END;

                                                   CaptionML=[ENU=Address;
                                                              NOR=Adresse;
                                                              SVE=Adress] }
    { 23  ;   ;City                ;Text30        ;FieldClass=Normal;
                                                   TableRelation=IF (Country/Region Code=CONST()) "Post Code".City
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code".City WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=BEGIN
                                                                Postcode.ValidateCity(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=City;
                                                              NOR=Poststed;
                                                              SVE=Ort] }
    { 24  ;   ;Post Code           ;Code20        ;TableRelation=IF (Country/Region Code=CONST()) "Post Code"
                                                                 ELSE IF (Country/Region Code=FILTER(<>'')) "Post Code" WHERE (Country/Region Code=FIELD(Country/Region Code));
                                                   OnValidate=VAR
                                                                PostCode@1210190001 : Record 225;
                                                              BEGIN
                                                                PostCode.ValidatePostCode(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) AND GUIALLOWED);
                                                                PostCode.GetTerritoryByPostCodeGroup(City,"Post Code","Territory Code");  //db, 11-02-13: C005566
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Post Code;
                                                              NOR=Postnr;
                                                              SVE=Postnr];
                                                   Editable=Yes }
    { 25  ;   ;Customer Name       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Customer No.)));
                                                   CaptionML=[ENU=Customer Name;
                                                              NOR=Kundnavn;
                                                              SVE=Kundens namn];
                                                   Editable=No }
    { 26  ;   ;Name 2              ;Text50        ;CaptionML=[ENU=Name 2;
                                                              NOR=Navn 2;
                                                              SVE=Namn 2] }
    { 27  ;   ;Address 2           ;Text50        ;OnValidate=VAR
                                                                lDummy@1210190000 : Text[30];
                                                              BEGIN
                                                              END;

                                                   CaptionML=[ENU=Address 2;
                                                              NOR=Adresse 2;
                                                              SVE=Adress 2] }
    { 28  ;   ;County              ;Text30        ;CaptionML=[ENU=County;
                                                              NOR=Delstat;
                                                              SVE=Delstat];
                                                   Editable=Yes }
    { 29  ;   ;Country/Region Code ;Code10        ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Country/Region Code;
                                                              NOR=Lands-/regionkode;
                                                              SVE=Lands-/regionkod] }
    { 30  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 40  ;   ;Contact Name        ;Text100       ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Contact Name;
                                                              NOR=Kontaktnavn;
                                                              SVE=Kontaktnamn] }
    { 45  ;   ;Phone No.           ;Text30        ;OnValidate=BEGIN
                                                                FormatPhoneNumberWhenNotSynced("Phone No.");
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No.;
                                                              NOR=Telefonnr;
                                                              SVE=Telefonnr] }
    { 50  ;   ;Priority            ;Code10        ;TableRelation="Service Priority" WHERE (Contract Filter=FIELD(Service Contract No.));
                                                   OnValidate=BEGIN
                                                                ServLogRec.StoreChange(1, "No.", ServLogRec.FormatDescription(FIELDCAPTION(Priority), FORMAT(xRec.Priority), FORMAT(Priority)));
                                                                CheckDeactivateConsignment;
                                                              END;

                                                   CaptionML=[ENU=Priority;
                                                              NOR=Prioritet;
                                                              SVE=Prioritet] }
    { 55  ;   ;Status              ;Option        ;OnValidate=VAR
                                                                IoTManagement@1100528800 : Codeunit 11130041;
                                                                IoTAction@1100528801 : ' ,,,,Call,,,,ServiceObjectStatus';
                                                              BEGIN
                                                                IF CurrFieldNo = FIELDNO(Status) THEN
                                                                  IF MODIFY(TRUE) THEN
                                                                    ProgPhaseRec.CheckProgressScheme(ProgPhaseRec.Type::ServCall, "Progress Scheme", "No.", Status, TODAY, TIME);

                                                                ServLogRec.StoreChange(1, "No.", ServLogRec.FormatDescription(FIELDCAPTION(Status), FORMAT(xRec.Status), FORMAT(Status)));


                                                                IF xRec.Status <> Status THEN
                                                                  IF (Status = Status::Finished) OR (Status = Status::Cancelled) THEN BEGIN
                                                                    IF "Date Closed" = 0D THEN BEGIN
                                                                      "Date Closed" := TODAY;
                                                                    END;
                                                                  END ELSE
                                                                     "Date Closed" := 0D;

                                                                IF (Origin = Origin::"IoT Event") AND (Status = Status::Finished) AND (Status <> xRec.Status) THEN
                                                                  IoTManagement.CloseCorrespondingIoTActionLogEntries(IoTAction::Call, '', "No.");
                                                              END;

                                                   CaptionML=[ENU=Status;
                                                              NOR=Status;
                                                              SVE=Status];
                                                   OptionCaptionML=[ENU=Received,In Process,Finished,Cancelled;
                                                                    NOR=Mottatt, i prosess,Ferdig,Kansellert;
                                                                    SVE=Mottaget,Under behandling,Avslutat,Avbrutet];
                                                   OptionString=Received,In Process,Finished,Cancelled;
                                                   BlankZero=No }
    { 80  ;   ;Your Reference      ;Text50        ;CaptionML=[ENU=Your Reference;
                                                              NOR=Din referanse;
                                                              SVE=Er referens] }
    { 85  ;   ;E-Mail              ;Text80        ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Email;
                                                              NOR=E-post;
                                                              SVE=E-post] }
    { 90  ;   ;Assigned to         ;Code20        ;TableRelation=Employee.No.;
                                                   OnValidate=VAR
                                                                Employee@1100529600 : Record 5200;
                                                              BEGIN
                                                                Employee.CheckEmployeeStatus("Assigned to", "Receiving Date");
                                                              END;

                                                   CaptionML=[ENU=Assigned to;
                                                              NOR=Tilordnet;
                                                              SVE=Tilldelat till] }
    { 95  ;   ;Next Step           ;Option        ;OnValidate=VAR
                                                                ServiceOrder@1100528600 : Record 11012823;
                                                              BEGIN
                                                                IF ("Service Order No." <> '') OR ("Sales Document No." <> '') OR ("Project (Dest)" <> '') THEN
                                                                  ERROR(Text001, FIELDCAPTION("Next Step"), TransferDocument);

                                                                IF "Next Step" = "Next Step"::ServiceOrder THEN BEGIN
                                                                  IF CustRec.GET("Customer No.") THEN
                                                                    CustRec.CheckBlockedCustomerByTableNo(DATABASE::"Service Order", ServiceOrder.FIELDNO("Customer No."));
                                                                  IF "Customer No." <> "Bill-to Customer No." THEN
                                                                    IF CustRec.GET("Bill-to Customer No.") THEN
                                                                      CustRec.CheckBlockedCustomerByTableNo(DATABASE::"Service Order", ServiceOrder.FIELDNO("Bill-to Customer No."));
                                                                  IF ServContrRec.GET("Service Contract No.") THEN
                                                                    ServContrRec.TESTFIELD(Blocked, FALSE);
                                                                  CheckCreditLimit;
                                                                END;

                                                                IF "Next Step" <> "Next Step"::" " THEN  BEGIN
                                                                  IF CustRec.GET("Customer No.") THEN BEGIN
                                                                    CustRec.CheckCustomerStatus("Customer No.");
                                                                    IF "Customer No." <> "Bill-to Customer No." THEN
                                                                      CustRec.CheckCustomerStatus("Bill-to Customer No.");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Next Step;
                                                              NOR=Neste steg;
                                                              SVE=NÑsta steg];
                                                   OptionCaptionML=ENU=" ,Create Service Order,Create Sales Quote,Create Sales Order,Create Project,Create Small Project,Try-out Quote";
                                                   OptionString=[ ,ServiceOrder,SalesQuote,SalesOrder,Project,SmallProject,TryoutQuote] }
    { 100 ;   ;Receiving Date      ;Date          ;CaptionML=[ENU=Receiving Date;
                                                              NOR=Mottakelsesdato;
                                                              SVE=Mottagningsdatum];
                                                   Editable=No }
    { 105 ;   ;Receiving Time      ;Time          ;CaptionML=[ENU=Receiving Time;
                                                              NOR=Mottakelsestid;
                                                              SVE=Mottagningstid];
                                                   Editable=No }
    { 110 ;   ;Received by         ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190000 : Code[50];
                                                              UserMgt@1210190001 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Received by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Received by;
                                                              NOR=Mottatt av;
                                                              SVE=Mottaget av];
                                                   Editable=No }
    { 120 ;   ;Modified on         ;Date          ;CaptionML=[ENU=Modified on;
                                                              NOR=Endret den;
                                                              SVE=éndrad den];
                                                   Editable=No }
    { 130 ;   ;Modified by         ;Code50        ;TableRelation=User."User Name";
                                                   OnLookup=VAR
                                                              UserCode@1210190000 : Code[50];
                                                              UserMgt@1210190001 : Codeunit 418;
                                                            BEGIN
                                                              UserCode := "Modified by";
                                                              UserMgt.LookupUserID(UserCode);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=éndrad av];
                                                   Editable=No }
    { 140 ;   ;Service Order No.   ;Code20        ;TableRelation="Service Order";
                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr;
                                                              SVE=Serviceordernr];
                                                   Editable=No }
    { 141 ;   ;Service Order Description;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Description WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Service Order Description;
                                                              NOR=Serviceordre Beskrivelse;
                                                              SVE=Serviceorder beskrivning];
                                                   Editable=No }
    { 142 ;   ;Service Order Status;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Order".Status WHERE (No.=FIELD(Service Order No.)));
                                                   CaptionML=[ENU=Service Order Status;
                                                              NOR=Serviceordrestatus;
                                                              SVE=Serviceorderstatus];
                                                   OptionCaptionML=[ENU=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                                    NOR=èpne,,Under behandling,Teknisk ferdig,Administrativt ferdig,Ferdig,Avbrutt;
                                                                    SVE=ôppna,,Under behandling,Tekniskt fÑrdig,Administrativt fÑrdig,FÑrdig,Avbrutet];
                                                   OptionString=Open,,In Process,Technical Finished,Administrative Finished,Finished,Cancelled;
                                                   Editable=No }
    { 150 ;   ;Service Location No.;Code20        ;TableRelation="Service Location";
                                                   OnValidate=BEGIN
                                                                ValidateAddressData(1);
                                                                ValidateOtherData;
                                                                DetermineBilltoCustomerbySC;
                                                                DetermineLimitBudget;
                                                                CheckDimension;
                                                                CheckConsignment;

                                                                UpdateVessel; //kkleermaker.n, 110817, M28697
                                                                FillSubcontractor;
                                                                FillPreferredEmployee;
                                                                IF (CurrFieldNo <> 0) AND (CurrFieldNo <> FIELDNO("Service Contract No.")) THEN BEGIN
                                                                  IF ("Service Contract No." = '') AND ("Plant Location" = '') THEN
                                                                    DetermineContractNo;
                                                                  IF "Object No." = '' THEN
                                                                    DetermineObjectNo;
                                                                END;
                                                                DetermineMasterProject;
                                                                DetermineTenantID;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Service Location No.;
                                                              NOR=Servicelokasjon Nr.;
                                                              SVE=Serviceplatsnr] }
    { 151 ;   ;Service Location Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location".Description WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Service Location Description;
                                                              NOR=Servicelokasjonbeskrivelse;
                                                              SVE=Serviceplatsbeskrivning];
                                                   Editable=No }
    { 152 ;   ;Remote Control      ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Remote Control" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Remote Control;
                                                              NOR=Fjernkontroll;
                                                              SVE=FjÑrrkontroll];
                                                   Editable=No }
    { 153 ;   ;Territory Code      ;Code10        ;TableRelation=Territory;
                                                   OnValidate=BEGIN
                                                                CheckConsignment;
                                                                DetermineServiceCluster;
                                                              END;

                                                   CaptionML=[ENU=Territory Code;
                                                              NOR=Distriktskode;
                                                              SVE=Distriktskod] }
    { 176 ;   ;Plan during Clock Time;Boolean     ;CaptionML=[ENU=Plan during Clock Time;
                                                              NOR=Plan i lõpet av klokketid;
                                                              SVE=Plan under klocktid] }
    { 180 ;   ;Expected Date       ;Date          ;CaptionML=[ENU=Expected Date;
                                                              NOR=Forventet dato;
                                                              SVE=FîrvÑntat datum] }
    { 181 ;   ;Expected Time       ;Time          ;CaptionML=[ENU=Expected Time;
                                                              NOR=Forventet tid;
                                                              SVE=FîrvÑntad tid] }
    { 182 ;   ;Expected Hours      ;Decimal       ;OnValidate=BEGIN
                                                                DetermineLimitBudgetExceeded;
                                                              END;

                                                   CaptionML=[ENU=Expected Hours;
                                                              NOR=Forventede timer;
                                                              SVE=FîrvÑntade timmar] }
    { 190 ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=No. Series;
                                                              NOR=Nr-serie;
                                                              SVE=Nr-serier];
                                                   Editable=No }
    { 191 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line" WHERE (Table Name=CONST(Service Call),
                                                                                           No.=FIELD(No.)));
                                                   CaptionML=[ENU=Comment;
                                                              NOR=Kommentar;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 192 ;   ;Comment (Problem Text);Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Call),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(60)));
                                                   CaptionML=[ENU=Comment Comment (Problem Text);
                                                              NOR=Kommenter kommentar (problemtekst);
                                                              SVE=Kommentera kommentar (problemtext)];
                                                   Editable=No }
    { 193 ;   ;Comment (Internal Text);Boolean    ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Call),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(70)));
                                                   CaptionML=[ENU=Comment (Internal Text);
                                                              NOR=Kommentar (intern tekst);
                                                              SVE=Kommentar (intern text)];
                                                   Editable=No }
    { 194 ;   ;Comment (Solution Text);Boolean    ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Text" WHERE (Table Name=CONST(Service Call),
                                                                                           No.=FIELD(No.),
                                                                                           Table Field=CONST(75)));
                                                   CaptionML=[ENU=Comment (Solution Text);
                                                              NOR=Kommentar (lõsningstekst);
                                                              SVE=Kommentar (lîsningstext)];
                                                   Editable=No }
    { 200 ;   ;Project (Orig)      ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Project No." WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=[ENU=Project (Origin);
                                                              NOR=Prosjekt (opprinnelig);
                                                              SVE=Projekt (ursprung)];
                                                   Editable=No }
    { 202 ;   ;Project (Dest)      ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=[ENU=Project (Destination);
                                                              NOR=Prosjekt (destinasjon);
                                                              SVE=Projekt (destination)];
                                                   Editable=No }
    { 210 ;   ;Calling Contact     ;Text100       ;CaptionML=[ENU=Calling Contact;
                                                              NOR=Samtalekontakt;
                                                              SVE=Samtalskontakt] }
    { 211 ;   ;Calling Account     ;Text100       ;CaptionML=[ENU=Calling Account;
                                                              NOR=Samtalekonto;
                                                              SVE=Samtalskonto] }
    { 212 ;   ;Calling Phone No.   ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Calling Phone No.;
                                                              NOR=Telefon;
                                                              SVE=Telefonnr] }
    { 220 ;   ;Object No.          ;Code20        ;TableRelation=Service-Object;
                                                   OnValidate=VAR
                                                                ServiceObject@1100528600 : Record 11071691;
                                                                ServiceContract@1100528603 : Record 11012812;
                                                                MaintenanceManagementCU@1100528601 : Codeunit 11012829;
                                                                ServiceContractNo@1100528602 : Code[20];
                                                              BEGIN
                                                                IF "Object No." <> '' THEN BEGIN
                                                                  ServiceObject.GET("Object No.");
                                                                  ServiceObject.TESTFIELD(Blocked, FALSE);
                                                                  ServiceObject.CALCFIELDS(Discipline, "Trade Speciality");
                                                                  IF ServiceObject.Discipline <> '' THEN BEGIN
                                                                    VALIDATE(Discipline, ServiceObject.Discipline);
                                                                    VALIDATE("Trade Speciality", ServiceObject."Trade Speciality");
                                                                  END;
                                                                  IF (("Service Location No." <> '') AND NOT ServiceObject.BelongsToServiceLocation("Service Location No.")) OR
                                                                     ("Service Location No." = '')
                                                                  THEN
                                                                    VALIDATE("Service Location No.", ServiceObject.GetPrefServiceLocationNo(FALSE));

                                                                  IF "Service Contract No." = '' THEN BEGIN
                                                                    IF MaintenanceManagementCU.GetNoOfActualContractsForObj("Object No.", TODAY, ServiceContractNo) = 1 THEN
                                                                      VALIDATE("Service Contract No.", ServiceContractNo)
                                                                  END ELSE BEGIN
                                                                    ServiceContract.GET("Service Contract No.");
                                                                    ServiceContract.TestObjectBelongtoContract("Object No.", TODAY);
                                                                  END;
                                                                  FillSubcontractor;
                                                                  DetermineOrderKindByWarranty;
                                                                END;
                                                                FillPreferredEmployee;
                                                                DetermineLimitBudgetExceeded;
                                                                UpdateServiceLocationStructure;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Object No.;
                                                              NOR=Objektnr.;
                                                              SVE=Objektnr] }
    { 221 ;   ;Object Description  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Object.Description WHERE (No.=FIELD(Object No.)));
                                                   CaptionML=[ENU=Object Description;
                                                              NOR=Objektbeskrivelse;
                                                              SVE=Objektbeskrivning];
                                                   Editable=No }
    { 222 ;   ;Object Description 2;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Object."Description 2" WHERE (No.=FIELD(Object No.)));
                                                   CaptionML=ENU=Object Description 2;
                                                   Editable=No }
    { 225 ;   ;Object Customer     ;Code20        ;CaptionML=[ENU=Object Customer;
                                                              NOR=Objektkunde;
                                                              SVE=Objektkund] }
    { 230 ;   ;Sales Document No.  ;Code20        ;CaptionML=[ENU=Sales Document No.;
                                                              NOR=Salgsdokumentnr.;
                                                              SVE=Fîrs.dokumentnr];
                                                   Editable=No }
    { 260 ;   ;Service Contract No.;Code20        ;TableRelation=Service-Contract.No.;
                                                   OnValidate=VAR
                                                                ServiceType@1100528601 : Record 11012814;
                                                                Employee@1100525000 : Record 5200;
                                                                ServiceSetup@1100528602 : Record 11012800;
                                                                ServiceTypeFromSCSourceType@1100528600 : Boolean;
                                                              BEGIN
                                                                TESTFIELD("Plant Location",''); //DP00195
                                                                IF ServContrRec.GET("Service Contract No.") THEN BEGIN
                                                                  ServSetup.GET;
                                                                  //db.sn, 18-12-07
                                                                  IF ServContrRec."Customer No." <> '' THEN //C032186.n
                                                                    VALIDATE("Customer No.", ServContrRec."Customer No.");
                                                                //C022970.so
                                                                //IF ServContrRec."Bill-to Customer No." <> '' THEN  //db, 29-01-08: M13786
                                                                //  VALIDATE("Bill-to Customer No.", ServContrRec."Bill-to Customer No.");  //db, 22-05-08: M11126
                                                                //IF ServContrRec."Alternative Bill-to Address" <> '' THEN
                                                                //  VALIDATE("Alternative Bill-to Address", ServContrRec."Alternative Bill-to Address")
                                                                //ELSE
                                                                //  CheckInvoiceAddress;  //db, 22-05-08: M11126
                                                                //C022970.eo
                                                                //C022970.sn
                                                                   DetermineBilltoCustomerbySC;
                                                                //C022970.en
                                                                  //db.en, 18-12-07
                                                                  CheckContractStatus(ServContrRec);  //db, 10-06-10: M19645

                                                                  DetermineServiceType(ServiceTypeFromSCSourceType);
                                                                  IF "Service Type" = '' THEN
                                                                    VALIDATE("Service Type", ServContrRec."Service Type");
                                                                  IF NOT ServiceType.GET("Service Type") THEN
                                                                    ServiceType.INIT;
                                                                  ServiceSetup.GET;
                                                                  IF NOT ServiceTypeFromSCSourceType OR (ServiceType."Department Code" = '') OR ServiceSetup."Use Dep. Code from Contract" THEN
                                                                    VALIDATE("Global Dimension 1 Code", ServContrRec."Global Dimension 1 Code");
                                                                  CheckDimension;
                                                                  IF "Your Reference" = '' THEN //mg, 20-12-11: M31690
                                                                    "Your Reference" := ServContrRec."Your Reference";
                                                                  IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::ContractMgt THEN
                                                                    "Order Manager" := ServContrRec."Contract Manager";  //C019333
                                                                  IF ServSetup."Assign To" = ServSetup."Assign To"::ContractMgt THEN
                                                                    IF (ServContrRec."Contract Manager" = '') OR Employee.GET(ServContrRec."Contract Manager") THEN
                                                                      "Assigned to" := ServContrRec."Contract Manager";
                                                                  CALCFIELDS("Service Contract Description");
                                                                  DetermineLimitBudget;
                                                                  IF "Object No." = '' THEN
                                                                    DetermineObjectNo;
                                                                END ELSE
                                                                  IF "Service Contract No." = '' THEN
                                                                    VALIDATE("Service Location No.");

                                                                CheckContrDiscPrio;
                                                                FillSubcontractor;
                                                                FillPreferredEmployee;
                                                                DetermineLimitBudgetExceeded;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Service Contract No.;
                                                              NOR=Servicekontraktnr;
                                                              SVE=Servicekontraktnr] }
    { 261 ;   ;Service Contract Description;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Service-Contract.Description WHERE (No.=FIELD(Service Contract No.)));
                                                   CaptionML=[ENU=Service Contract Description;
                                                              NOR=Servicekontraktsbeskrivelse;
                                                              SVE=Servicekontraktsbeskrivning];
                                                   Editable=No }
    { 265 ;   ;Service Type        ;Code20        ;TableRelation="Service Type".Code;
                                                   OnValidate=VAR
                                                                ServiceSetup@1100528600 : Record 11012800;
                                                              BEGIN
                                                                IF ServTypeRec.GET("Service Type") THEN
                                                                  IF ServTypeRec."Department Code" <> '' THEN BEGIN
                                                                    ServiceSetup.GET;
                                                                    IF ("Service Contract No." = '') OR NOT ServiceSetup."Use Dep. Code from Contract" THEN
                                                                      VALIDATE("Global Dimension 1 Code", ServTypeRec."Department Code");
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Service Type;
                                                              NOR=Servicetype;
                                                              SVE=Servicetyp] }
    { 270 ;   ;Order Kind          ;Code10        ;TableRelation="Service Order Indication".Code WHERE (Indication=CONST(Kind));
                                                   OnValidate=BEGIN
                                                                CheckExpectedHours(0, "Order Kind");
                                                                DetermineServiceCluster;
                                                                DetermineCostComponentPlant;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Order Kind;
                                                              NOR=Type ordre;
                                                              SVE=Typ av order] }
    { 275 ;   ;Order Type          ;Code10        ;TableRelation="Service Order Indication".Code WHERE (Indication=CONST(Type));
                                                   OnValidate=BEGIN
                                                                CheckExpectedHours(1, "Order Type");
                                                                DetermineServiceCluster;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Order Type;
                                                              NOR=Ordretype;
                                                              SVE=Typ av order] }
    { 290 ;   ;Mobile Phone No.    ;Text30        ;OnValidate=BEGIN
                                                                FormatPhoneNumberWhenNotSynced("Mobile Phone No.");
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Mobile Phone No.;
                                                              NOR=Mobiltelefonnr;
                                                              SVE=Mobiltelefonnr] }
    { 300 ;   ;Phone No. 2         ;Text30        ;OnValidate=BEGIN
                                                                FormatPhoneNumberWhenNotSynced("Phone No. 2");
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   ExtendedDatatype=Phone No.;
                                                   CaptionML=[ENU=Phone No. 2;
                                                              NOR=Telefonnr 2;
                                                              SVE=Telefonnr 2] }
    { 310 ;   ;Fax No.             ;Text30        ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Fax No.;
                                                              NOR=Telefaxnr;
                                                              SVE=Telefaxnr] }
    { 320 ;   ;Limit Budget Labor  ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Limit Budget Total", "Limit Budget Labor" + "Limit Budget Material");
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Labor;
                                                              NOR=Budsjettgrense, arbeidskraft;
                                                              SVE=BudgetgrÑns, arbetskraft];
                                                   AutoFormatType=1 }
    { 321 ;   ;Limit Budget Hours  ;Decimal       ;OnValidate=BEGIN
                                                                DetermineLimitBudgetExceeded
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Hours;
                                                              NOR=Budsjettgrense, timer;
                                                              SVE=BudgetgrÑns, timmar];
                                                   DecimalPlaces=2:5 }
    { 322 ;   ;Limit Budget Material;Decimal      ;OnValidate=BEGIN
                                                                VALIDATE("Limit Budget Total", "Limit Budget Labor" + "Limit Budget Material");
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Material;
                                                              NOR=Budsjettgrense, Materiale;
                                                              SVE=BudgetgrÑns, material];
                                                   AutoFormatType=1 }
    { 325 ;   ;Limit Budget Total  ;Decimal       ;OnValidate=BEGIN
                                                                IF ("Limit Budget Labor" <> 0) OR ("Limit Budget Material" <> 0) THEN
                                                                  TESTFIELD("Limit Budget Total", "Limit Budget Labor" + "Limit Budget Material");
                                                                DetermineLimitBudgetExceeded;
                                                              END;

                                                   CaptionML=[ENU=Limit Budget Total;
                                                              NOR=Budsjettgrense, Totalt;
                                                              SVE=BudgetgrÑns, totalt];
                                                   AutoFormatType=1 }
    { 330 ;   ;Name Assigned to    ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Assigned to)));
                                                   CaptionML=[ENU=Name Assigned to;
                                                              NOR=Navn tilordnet til;
                                                              SVE=Namn tilldelat till];
                                                   Editable=No }
    { 360 ;   ;Global Dimension 1 Code;Code20     ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=BEGIN
                                                                CheckConsignment;
                                                                ValidateShortcutDimCode(1,"Global Dimension 1 Code");  //db, 19-08-09
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Global dimensjon 1 kode;
                                                              SVE=Global dimension 1 kod];
                                                   CaptionClass='1,1,1' }
    { 370 ;   ;Previous Call No.   ;Code20        ;TableRelation="Service Call".No. WHERE (No.=FIELD(Previous Call No.));
                                                   OnValidate=BEGIN
                                                                CheckParentChildCall;
                                                              END;

                                                   CaptionML=[ENU=Previous Call No.;
                                                              NOR=Forrige samtalenr.;
                                                              SVE=FîregÜende samtalsnr] }
    { 380 ;   ;Progress Scheme     ;Code10        ;TableRelation="Progress Scheme".Code;
                                                   OnValidate=BEGIN
                                                                ProgPhaseRec.EditProgressScheme(ProgPhaseRec.Type::ServCall, "Progress Scheme", "No.");
                                                              END;

                                                   CaptionML=[ENU=Progress Scheme;
                                                              NOR=Fremdriftsskjema;
                                                              SVE=Fîrloppsschema] }
    { 400 ;   ;Discipline          ;Code10        ;TableRelation=Discipline;
                                                   OnValidate=BEGIN
                                                                IF NOT TradeSpecRec.GET(Discipline, "Trade Speciality") THEN
                                                                  TradeSpecRec.INIT;
                                                                IF TradeSpecRec.Discipline <> Discipline THEN
                                                                  "Trade Speciality" := '';
                                                                FillPreferredEmployee;
                                                                FillSubcontractor;
                                                                CheckConsignment;
                                                                DetermineServiceCluster;
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Discipline;
                                                              NOR=Disiplin;
                                                              SVE=Disciplin] }
    { 401 ;   ;Trade Speciality    ;Code10        ;TableRelation="Trade Speciality".Code WHERE (Discipline=FIELD(Discipline));
                                                   OnValidate=BEGIN
                                                                FillPreferredEmployee;
                                                                FillSubcontractor;
                                                                CheckConsignment;  //db, 15-05-11
                                                              END;

                                                   CaptionML=[ENU=Trade Speciality;
                                                              NOR=SNI-nummer;
                                                              SVE=SNI-nummer] }
    { 410 ;   ;Employee No.        ;Code20        ;TableRelation="Resource (WOP)" WHERE (Type=CONST(Employee));
                                                   OnValidate=VAR
                                                                ResourceMgtWorkOrderPlan@1100528600 : Codeunit 11229277;
                                                              BEGIN
                                                                //AssistEditEmployee(0);  //DP00465.o

                                                                IF (Watch = '') AND ("Employee No." = '') THEN BEGIN
                                                                  "Export to FSA" := FALSE;  //db, 07-07-08: M12269
                                                                  "Plan during Clock Time" := FALSE;  //db, 15-06-11: M24526
                                                                END;
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup("Employee No.");
                                                                DetermineLimitBudgetExceeded;
                                                                CALCFIELDS("Employee Name");
                                                              END;

                                                   CaptionML=[ENU=Employee No.;
                                                              NOR=Ansattnr;
                                                              SVE=AnstÑllningsnr];
                                                   Description=DP00465, based on Resource }
    { 415 ;   ;Employee Name       ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Employee No.)));
                                                   CaptionML=[ENU=Employee Name;
                                                              NOR=Navn pÜ ansatt;
                                                              SVE=Namn pÜ anstÑlld];
                                                   Editable=No }
    { 420 ;   ;Subcontractor       ;Code20        ;TableRelation="Resource (WOP)" WHERE (Type=CONST(Subcontractor));
                                                   OnValidate=VAR
                                                                ResourceMgtWorkOrderPlan@1100528600 : Codeunit 11229277;
                                                              BEGIN
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup(Subcontractor);
                                                                CALCFIELDS("Subcontractor Name");
                                                              END;

                                                   CaptionML=[ENU=Subcontractor;
                                                              NOR=Underentreprenõr;
                                                              SVE=Underentreprenîr] }
    { 425 ;   ;Subcontractor Name  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=[ENU=Subcontractor Name;
                                                              NOR=Underentreprenõrens navn;
                                                              SVE=Underentreprenîrens namn];
                                                   Editable=No }
    { 431 ;   ;Next Deadline       ;DateTime      ;CaptionML=[ENU=Next Deadline;
                                                              NOR=Neste deadline;
                                                              SVE=NÑsta deadline];
                                                   Description=W014185;
                                                   Editable=No }
    { 435 ;   ;Next Reference Period;Code10       ;TableRelation="Reference Period".Code WHERE (Type=CONST(ServCall),
                                                                                                Document No.=FIELD(No.));
                                                   CaptionML=[ENU=Next Reference Period;
                                                              NOR=Neste referanseperiode;
                                                              SVE=NÑsta referenspunkt];
                                                   Editable=No }
    { 440 ;   ;Watch               ;Code10        ;TableRelation=Watch;
                                                   OnValidate=VAR
                                                                lvConsTimeRec@1100485000 : Record 11012864;
                                                                lvText000@1100485001 : TextConst 'ENU=Time exceeds %1;NOR=Tid overskrider %1;SVE=Tid îverskrider %1';
                                                                lvConsRosterRec@1100485002 : Record 11012865;
                                                                lvSkipCheck@1100485003 : Boolean;
                                                              BEGIN
                                                                IF NOT CheckConsignmentTime(lvConsTimeRec) THEN BEGIN
                                                                  IF Watch = '' THEN
                                                                    lvSkipCheck := TRUE
                                                                  ELSE
                                                                    MESSAGE(lvText000, lvConsRosterRec.TABLECAPTION);
                                                                END;

                                                                IF lvSkipCheck = FALSE THEN BEGIN
                                                                  IF NOT ServLocRec.GET("Service Location No.") THEN ServLocRec.INIT;
                                                                  IF ServLocRec.Watch <> '' THEN BEGIN
                                                                    //TESTFIELD(Watch, ServLocRec.Watch);  //db, 09-05-07 (default, not required)
                                                                  END ELSE BEGIN
                                                                    IF Watch <> '' THEN
                                                                      AssistEditWatch(FALSE);
                                                                  END;
                                                                END;

                                                                IF (Watch = '') AND ("Employee No." = '') THEN BEGIN
                                                                  "Export to FSA" := FALSE;  //db, 07-07-08: M12269
                                                                  "Plan during Clock Time" := FALSE;  //db, 15-06-11: M24526
                                                                END;

                                                                CALCFIELDS("Watch Description");
                                                              END;

                                                   CaptionML=[ENU=Watch;
                                                              NOR=Observer;
                                                              SVE=Observera] }
    { 441 ;   ;Watch Description   ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Watch.Description WHERE (Code=FIELD(Watch)));
                                                   CaptionML=[ENU=Watch Description;
                                                              NOR=Observer beskrivelse;
                                                              SVE=Beskrivningsobservation];
                                                   Editable=No }
    { 450 ;   ;Order No. Customer  ;Text50        ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Order No. Customer") THEN BEGIN
                                                                  IF Origin = Origin::Dispatch THEN
                                                                    FIELDERROR(Origin);
                                                                  CheckOrderNoCustomer;  //db, 16-11-09: M13354
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Order No. Customer;
                                                              NOR=Ordrenr, (Kunde);
                                                              SVE=Ordernr, (kund)] }
    { 460 ;   ;Export to FSA       ;Boolean       ;OnValidate=VAR
                                                                lvProjSetup@1100485000 : Record 315;
                                                                Resource@1100529000 : Record 11229278;
                                                              BEGIN
                                                                IF NOT "Export to FSA" THEN EXIT;

                                                                lvProjSetup.GET;
                                                                IF (NOT lvProjSetup."Field Service Active") AND (NOT lvProjSetup.IsFSAActive) THEN BEGIN
                                                                  "Export to FSA" := FALSE;  //* No (error)message, just switch off
                                                                  EXIT;
                                                                END;

                                                                //DP00465.sc (Resource io EmplRec)
                                                                IF "Employee No." <> '' THEN BEGIN
                                                                  Resource.GET("Employee No.");
                                                                  Resource.TESTFIELD("Active in FSA", TRUE);
                                                                END;
                                                                //DP00465.ec
                                                              END;

                                                   CaptionML=[ENU=Export to Field Service;
                                                              NOR=Eksporter til Feltservice;
                                                              SVE=Exportera till fÑltservice] }
    { 465 ;   ;Publish on Subcontr. Portal;Boolean;OnValidate=VAR
                                                                CTRLSetup@1100528300 : Record 11125686;
                                                                SubcontPortSetup@1100528301 : Record 11126402;
                                                                ResourceWOP@1100528601 : Record 11229278;
                                                              BEGIN
                                                                IF NOT "Publish on Subcontr. Portal" THEN
                                                                  EXIT;


                                                                IF (NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(CTRLSetup)) THEN
                                                                  CTRLSetup.Active := FALSE
                                                                ELSE
                                                                  CTRLSetup.GET;
                                                                IF (NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(SubcontPortSetup)) THEN
                                                                  SubcontPortSetup."Subcontracting Portal Active" := FALSE
                                                                ELSE
                                                                  SubcontPortSetup.GET('1');
                                                                IF (NOT SubcontPortSetup."Subcontracting Portal Active") AND (NOT CTRLSetup.Active) THEN
                                                                  ERROR(CtrlOrSubContrActiveTxt, SubcontPortSetup.TABLECAPTION,
                                                                    SubcontPortSetup.FIELDCAPTION("Subcontracting Portal Active"), CTRLSetup.TABLECAPTION,
                                                                    CTRLSetup.FIELDCAPTION(Active));

                                                                TESTFIELD(Subcontractor);
                                                                ResourceWOP.GET(Subcontractor);
                                                                ResourceWOP.TESTFIELD(Type, ResourceWOP.Type::Subcontractor);
                                                                ResourceWOP.TESTFIELD(Company, COMPANYNAME);
                                                              END;

                                                   CaptionML=[ENU=Publish Work Orders;
                                                              NOR=Publiser pÜ underentrepenõrportal;
                                                              SVE=Visa pÜ UE portal] }
    { 470 ;   ;Bill-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=BEGIN
                                                                ValidateAddressData(2);
                                                                IF "Service Contract No." = '' THEN
                                                                  DetermineAlternativeBilltoAddress;
                                                              END;

                                                   CaptionML=[ENU=Bill-to Customer No.;
                                                              NOR=Faktureringskundenr;
                                                              SVE=Faktureringskundnr] }
    { 480 ;   ;Alternative Bill-to Address;Code10 ;TableRelation="Ship-to Address".Code WHERE (Customer No.=FIELD(Bill-to Customer No.),
                                                                                               Billing Address=CONST(Yes));
                                                   OnValidate=BEGIN
                                                                CheckInvoiceAddress;
                                                              END;

                                                   CaptionML=[ENU=Alternative Bill-to Address;
                                                              NOR=Alternativ Faktureringsadresse;
                                                              SVE=Alternativ faktureringsadress] }
    { 481 ;   ;Bill-to Name        ;Text100       ;CaptionML=[ENU=Bill-to Name;
                                                              NOR=Faktureringsnavn;
                                                              SVE=Faktureringsnamn];
                                                   Editable=No }
    { 482 ;   ;Bill-to Name 2      ;Text50        ;CaptionML=[ENU=Bill-to Name 2;
                                                              NOR=Faktureringsnavn 2;
                                                              SVE=Faktureringsnamn 2];
                                                   Editable=No }
    { 483 ;   ;Bill-to Address     ;Text100       ;CaptionML=[ENU=Bill-to Address;
                                                              NOR=Faktureringsadresse;
                                                              SVE=Faktureringsadress];
                                                   Editable=No }
    { 484 ;   ;Bill-to Address 2   ;Text50        ;CaptionML=[ENU=Bill-to Address 2;
                                                              NOR=Faktureringsadresse 2;
                                                              SVE=Faktureringsadress 2];
                                                   Editable=No }
    { 485 ;   ;Bill-to Post Code   ;Code20        ;CaptionML=[ENU=Bill-to Post Code;
                                                              NOR=Faktura til-postnr.;
                                                              SVE=Faktureras postnr];
                                                   Editable=No }
    { 486 ;   ;Bill-to City        ;Text30        ;CaptionML=[ENU=Bill-to City;
                                                              NOR=Faktureringsby;
                                                              SVE=Faktureras ort];
                                                   Editable=No }
    { 490 ;   ;Bill-to Contact Name;Text100       ;OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Bill-to Contact Name;
                                                              SVE=Fakturera till kontaktnamn] }
    { 500 ;   ;Latest Reference Period;Code10     ;FieldClass=FlowField;
                                                   CalcFormula=Max("Reference Period".Code WHERE (Type=CONST(ServCall),
                                                                                                  Document No.=FIELD(No.),
                                                                                                  Ending Date-Time=FILTER(<>'')));
                                                   CaptionML=[ENU=Latest Reference Period;
                                                              NOR=Siste referanseperiode;
                                                              SVE=Senaste referensperiod];
                                                   Editable=No }
    { 501 ;   ;Latest Reference Period Time;DateTime;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Max("Reference Period"."Ending Date-Time" WHERE (Type=CONST(ServCall),
                                                                                                                Document No.=FIELD(No.),
                                                                                                                Ending Date-Time=FILTER(<>'')));
                                                   CaptionML=[ENU=Latest Reference Period Time;
                                                              NOR=Siste referanseperiode, tid;
                                                              SVE=Senaste referensperiodtid];
                                                   Editable=No }
    { 505 ;   ;Actual Reference Point;Integer     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Reference Point"."Reference Point" WHERE (Type=CONST(ServCall),
                                                                                                                          Document No.=FIELD(No.),
                                                                                                                          Actual=CONST(Yes)));
                                                   CaptionML=[ENU=Actual Reference Point;
                                                              NOR=Faktisk referansepunkt;
                                                              SVE=Verklig referenspunkt];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 506 ;   ;Actual Reference Point Desc;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Reference Point".Description WHERE (No.=FIELD(Actual Reference Point)));
                                                   CaptionML=[ENU=Actual Reference Point Description;
                                                              NOR=Faktisk referansepunkt, beskrivelse;
                                                              SVE=Verklig referenspunktsbeskrivning];
                                                   Editable=No }
    { 507 ;   ;Actual Reference Point Time;DateTime;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Document Reference Point"."Date-Time (modified)" WHERE (Type=CONST(ServCall),
                                                                                                                               Document No.=FIELD(No.),
                                                                                                                               Actual=CONST(Yes)));
                                                   CaptionML=[ENU=Acutal Reference Point Time;
                                                              NOR=Faktisk referansepunkt, tid;
                                                              SVE=Verklig referenspunktstid];
                                                   Editable=No }
    { 520 ;   ;Prospect            ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Contact Business Relation"."Contact No." WHERE (No.=FIELD(Customer No.),
                                                                                                                       Link to Table=CONST(Customer)));
                                                   CaptionML=[ENU=Prospect;
                                                              NOR=Tiltenkt kunde;
                                                              SVE=TilltÑnkt kund];
                                                   Editable=No }
    { 530 ;   ;Call Kind           ;Code10        ;TableRelation="Service Call Indication".Code WHERE (Indication=CONST(Kind));
                                                   OnValidate=BEGIN
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Call Kind;
                                                              NOR=Samtaletype;
                                                              SVE=Samtalstyp] }
    { 540 ;   ;Call Type           ;Code10        ;TableRelation="Service Call Indication".Code WHERE (Indication=CONST(Type));
                                                   OnValidate=BEGIN
                                                                DetermineProcessStructure;
                                                              END;

                                                   CaptionML=[ENU=Call Type;
                                                              NOR=Samtaletype;
                                                              SVE=SamtalssÑtt] }
    { 580 ;   ;Problem             ;Code10        ;TableRelation="Service Analysis".Code WHERE (Analysis Type=CONST(Problem));
                                                   OnValidate=VAR
                                                                ServiceSetup@1100528600 : Record 11012800;
                                                              BEGIN
                                                                CheckProblemOfPlantPart;
                                                                UpdateCustomerProblem;
                                                                ServiceSetup.GET;
                                                                IF ServiceSetup."Problem Desc. as Call Descr." THEN BEGIN
                                                                  CALCFIELDS("Description Problem");
                                                                  IF ("Description Problem" <> '') THEN
                                                                    VALIDATE(Description, "Description Problem");
                                                                END;
                                                                ApplyProblemCodeAdditionalInfo;
                                                                InsertServiceText(0, Problem, 60);
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupProblem(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Problem;
                                                              NOR=Problem;
                                                              SVE=Problem] }
    { 581 ;   ;Description Problem ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Analysis".Description WHERE (Analysis Type=CONST(Problem),
                                                                                                            Code=FIELD(Problem)));
                                                   CaptionML=[ENU=Description Problem;
                                                              NOR=Beskrivelse av problem;
                                                              SVE=Beskrivning av problem];
                                                   Editable=No }
    { 582 ;   ;Customer Problem    ;Code10        ;TableRelation="Customer Service Analysis".Code WHERE (Analysis Type=CONST(Problem),
                                                                                                         Customer No.=FIELD(Customer No.));
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Description Customer Problem");
                                                              END;

                                                   OnLookup=VAR
                                                              CustomerServiceAnalysis@1100528600 : Record 11071728;
                                                              ServiceOrderInfoMgt@1100528603 : Codeunit 11012841;
                                                            BEGIN
                                                              ServiceOrderInfoMgt.GetFilteredCustomerAnalysis("Customer No.", "Service Contract No.", CustomerServiceAnalysis."Analysis Type"::Problem, CustomerServiceAnalysis);
                                                              IF PAGE.RUNMODAL(0, CustomerServiceAnalysis) = ACTION::LookupOK THEN
                                                                VALIDATE("Customer Problem", CustomerServiceAnalysis.Code);
                                                            END;

                                                   CaptionML=[ENU=Customer Problem;
                                                              NOR=Kundeproblem;
                                                              SVE=Kundproblem] }
    { 583 ;   ;Description Customer Problem;Text50;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Customer Service Analysis".Description WHERE (Analysis Type=CONST(Problem),
                                                                                                                     Customer No.=FIELD(Customer No.),
                                                                                                                     Code=FIELD(Customer Problem)));
                                                   CaptionML=ENU=Description Customer Problem;
                                                   Editable=No }
    { 590 ;   ;Cause               ;Code10        ;TableRelation="Service Analysis".Code WHERE (Analysis Type=CONST(Cause));
                                                   OnLookup=VAR
                                                              ServiceAnalysis@1100525000 : Record 11012842;
                                                              ServiceContractInfoMgt@1100528600 : Codeunit 11012842;
                                                            BEGIN
                                                              GetFilteredAnalysisOnProblem(Problem, ServiceAnalysis."Analysis Type"::Cause, ServiceAnalysis);
                                                              ServiceContractInfoMgt.GetFilteredAnalysisByContract("Service Contract No.", ServiceAnalysis."Analysis Type"::Cause, ServiceAnalysis);
                                                              IF PAGE.RUNMODAL(PAGE::"Service Analysis (Cause)", ServiceAnalysis) = ACTION::LookupOK THEN
                                                                Cause := ServiceAnalysis.Code;
                                                            END;

                                                   CaptionML=[ENU=Cause;
                                                              NOR=èrsak;
                                                              SVE=Orsak] }
    { 591 ;   ;Description Cause   ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Analysis".Description WHERE (Analysis Type=CONST(Cause),
                                                                                                            Code=FIELD(Cause)));
                                                   CaptionML=[ENU=Description Cause;
                                                              NOR=Beskrivelse, Ürsak;
                                                              SVE=Beskrivning, orsak];
                                                   Editable=No }
    { 600 ;   ;Solution            ;Code10        ;TableRelation="Service Analysis".Code WHERE (Analysis Type=CONST(Solution));
                                                   OnLookup=VAR
                                                              ServiceAnalysis@1100525000 : Record 11012842;
                                                              ServiceContractInfoMgt@1100528600 : Codeunit 11012842;
                                                            BEGIN
                                                              GetFilteredAnalysisOnProblem(Problem, ServiceAnalysis."Analysis Type"::Solution, ServiceAnalysis);
                                                              ServiceContractInfoMgt.GetFilteredAnalysisByContract("Service Contract No.", ServiceAnalysis."Analysis Type"::Solution, ServiceAnalysis);
                                                              IF PAGE.RUNMODAL(PAGE::"Service Analysis (Solution)", ServiceAnalysis) = ACTION::LookupOK THEN
                                                                Solution := ServiceAnalysis.Code;
                                                            END;

                                                   CaptionML=[ENU=Solution;
                                                              NOR=Lõsning;
                                                              SVE=Lîsning] }
    { 601 ;   ;Description Solution;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Analysis".Description WHERE (Analysis Type=CONST(Solution),
                                                                                                            Code=FIELD(Solution)));
                                                   CaptionML=[ENU=Description Solution;
                                                              NOR=Beskrivelse, lõsning;
                                                              SVE=Beskrivning av lîsning];
                                                   Editable=No }
    { 610 ;   ;Warranty found at   ;Text50        ;CaptionML=[ENU=Warranty found at;
                                                              NOR=Garanti funnet i;
                                                              SVE=Garantin finns i];
                                                   Editable=No }
    { 620 ;   ;House No.           ;Code20        ;CaptionML=[ENU=House No.;
                                                              NOR=Husnr.;
                                                              SVE=Husnr];
                                                   Description=SERV_CONS }
    { 630 ;   ;House No. Ext.      ;Code10        ;CaptionML=[ENU=House No. Extension;
                                                              NOR=Husnr ETA;
                                                              SVE=Husnr ƒTA];
                                                   Description=SERV_CONS }
    { 650 ;   ;Vessel No.          ;Code20        ;TableRelation=Vessel.No.;
                                                   CaptionML=[ENU=Vessel No.;
                                                              NOR=Kjõretõynr.;
                                                              SVE=Fartygsnr];
                                                   Editable=No }
    { 660 ;   ;Vessel Name         ;Text30        ;FieldClass=Normal;
                                                   CaptionML=[ENU=Vessel Name;
                                                              NOR=Navn pÜ fartõy;
                                                              SVE=Fartygsnamn];
                                                   Editable=No }
    { 670 ;   ;Agent No.           ;Code20        ;TableRelation=Agent;
                                                   CaptionML=[ENU=Agent No.;
                                                              NOR=Agentnr.;
                                                              SVE=Ombudsnr] }
    { 680 ;   ;Port                ;Code10        ;TableRelation=Port.Code;
                                                   CaptionML=[ENU=Port;
                                                              NOR=Havn;
                                                              SVE=Port] }
    { 690 ;   ;Quay Berth          ;Text30        ;CaptionML=[ENU=Quay Berth;
                                                              NOR=Kai;
                                                              SVE=Kajplats] }
    { 700 ;   ;First Possible Starting Time;Time  ;OnValidate=BEGIN
                                                                CheckPlanLimitDateTime;
                                                              END;

                                                   CaptionML=[ENU=First Possible Starting Time;
                                                              NOR=Fõrste mulige tid for oppstart;
                                                              SVE=Fîrsta mîjliga starttid] }
    { 710 ;   ;Last Possible Ending Time;Time     ;OnValidate=BEGIN
                                                                CheckPlanLimitDateTime;
                                                              END;

                                                   CaptionML=[ENU=Last Possible Ending Time;
                                                              NOR=Siste mulige tid for avslutning;
                                                              SVE=Senast mîjliga sluttid] }
    { 720 ;   ;First Possible Starting Date;Date  ;OnValidate=BEGIN
                                                                IF ("First Possible Starting Date" > "Last Possible Ending Date") AND ("Last Possible Ending Date" <> 0D) THEN
                                                                  FIELDERROR("First Possible Starting Date",STRSUBSTNO(Text000,FIELDCAPTION("Last Possible Ending Date")));
                                                                //C036835.so
                                                                //IF "First Possible Starting Date" = 0D THEN
                                                                //  "Last Possible Ending Date" := 0D;
                                                                //C036835.eo
                                                                //IF "Starting Date" < "First Possible Starting Date" THEN
                                                                //  "Starting Date" := "First Possible Starting Date";
                                                                //IF "Ending Date" > "Last Possible Ending Date" THEN
                                                                //  IF ("Ending Date" <> 0D) AND ("Last Possible Ending Date" <> 0D) THEN
                                                                //   "Ending Date" := "Last Possible Ending Date";

                                                                CheckPlanLimitDateTime;
                                                                //CheckPlanDataFSA;
                                                              END;

                                                   CaptionML=[ENU=First Possible Starting Date;
                                                              NOR=Fõrste mulige dato for oppstart;
                                                              SVE=Fîrsta mîjliga startdatum] }
    { 730 ;   ;Last Possible Ending Date;Date     ;OnValidate=BEGIN
                                                                VALIDATE("First Possible Starting Date");
                                                                CheckPlanLimitDateTime;
                                                                //CheckPlanDataFSA;
                                                              END;

                                                   CaptionML=[ENU=Last Possible Ending Date;
                                                              NOR=Siste mulig tid for avslutning;
                                                              SVE=Senast mîjliga slutdatum] }
    { 740 ;   ;Planning Agreement Code;Code10     ;TableRelation="Planning Agreement".Code WHERE (Type=FILTER(Plan|Both));
                                                   CaptionML=[ENU=Planning Agreement Code;
                                                              NOR=Kode for planleggingsavtale;
                                                              SVE=Planeringsavtal, kod];
                                                   Description=SERV_CONS }
    { 750 ;   ;Vessel Service Call ;Boolean       ;CaptionML=[ENU=Vessel Service Call;
                                                              NOR=Servicesamtale for fartõy;
                                                              SVE=Fartyg service begÑran] }
    { 760 ;   ;Decentral Created   ;Boolean       ;CaptionML=[ENU=Decentral Created;
                                                              NOR=Perifer er opprettet;
                                                              SVE=Perifer Ñr skapad];
                                                   Description=Mobile;
                                                   Editable=No }
    { 770 ;   ;Plant Location      ;Code20        ;TableRelation="Plant Location".Code;
                                                   OnValidate=VAR
                                                                PlantLocRec@1100525000 : Record 11012554;
                                                              BEGIN
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  TESTFIELD("Service Contract No.",''); //DP00195
                                                                  PlantLocRec.CHANGECOMPANY("Plant Company");
                                                                  PlantLocRec.GET("Plant Location");
                                                                  IF PlantLocRec."Service Order No." <>'' THEN
                                                                      ERROR(Text016);
                                                                END;
                                                                ValidateOtherData;
                                                                ValidateAddressData(3);
                                                                CheckDimension;
                                                                CheckConsignment;
                                                                UpdateVessel; //kkleermaker.n, 110817, M28697
                                                                FillSubcontractor;
                                                                GetPlantLocationDescription;
                                                                MODIFY;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantLocation;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant Location;
                                                              NOR=Maskinplassering;
                                                              SVE=Maskinplats] }
    { 775 ;   ;Plant Location Description;Text100 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Location".Description WHERE (Code=FIELD(Plant Location)));
                                                   OnLookup=BEGIN
                                                              LookupPlantLocationDescription;
                                                            END;

                                                   CaptionML=[ENU=Plant Location Description;
                                                              NOR=Beskrivelse av maskinplassering;
                                                              SVE=Beskrivning av Maskinplats];
                                                   Editable=No }
    { 780 ;   ;Plant Type          ;Code20        ;TableRelation="Plant Type".Code;
                                                   OnValidate=VAR
                                                                PlantType@1100529000 : Record 11012551;
                                                              BEGIN
                                                                IF "Plant Type" = '' THEN
                                                                  "Plant Number" := ''
                                                                ELSE BEGIN
                                                                  PlantType.CHANGECOMPANY("Plant Company");
                                                                  PlantType.GET("Plant Type");
                                                                END;
                                                                IF (xRec."Plant Type" <> "Plant Type") THEN
                                                                  "Plant Part" := '';
                                                                GetPlantTypeDescription;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantType;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp] }
    { 785 ;   ;Plant Type Description;Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Type".Description WHERE (Code=FIELD(Plant Type)));
                                                   OnLookup=BEGIN
                                                              LookupPlantTypeDescription;
                                                            END;

                                                   CaptionML=[ENU=Plant Type Description;
                                                              NOR=Maskintype Beskrivelse;
                                                              SVE=Maskintyp beskrivning];
                                                   Editable=No }
    { 790 ;   ;Plant Number        ;Code10        ;TableRelation="Plant Number".No. WHERE (Plant Type=FIELD(Plant Type));
                                                   OnValidate=VAR
                                                                PlantNumber@1100529000 : Record 11012552;
                                                                PlantInventory@1100528801 : Record 11012555;
                                                                OPlantLocation@1100528800 : Code[20];
                                                              BEGIN
                                                                IF "Plant Number" <> '' THEN BEGIN
                                                                  PlantNumber.CHANGECOMPANY("Plant Company");
                                                                  PlantNumber.GET("Plant Type", "Plant Number");
                                                                END;
                                                                IF (xRec."Plant Number" <> "Plant Number") THEN
                                                                  "Plant Part" := '';
                                                                IF ("Plant Number" <> '') AND (xRec."Plant Number" <> "Plant Number") THEN BEGIN
                                                                  "Plant Location" := '';
                                                                  PlantInventory.CHANGECOMPANY("Plant Company");
                                                                  IF PlantInventory.GetPlantLocationByPlantNumber("Plant Type", "Plant Number", OPlantLocation) THEN
                                                                    VALIDATE("Plant Location", OPlantLocation);
                                                                END ELSE
                                                                  VALIDATE("Plant Location", '');
                                                                GetPlantNumberDescription;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantNumber();
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Plant Number;
                                                              NOR=Maskinnr.;
                                                              SVE=Maskinnummer] }
    { 795 ;   ;Plant Number Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Number".Description WHERE (Plant Type=FIELD(Plant Type),
                                                                                                        No.=FIELD(Plant Number)));
                                                   OnLookup=BEGIN
                                                              LookupPlantNumberDescription;
                                                            END;

                                                   CaptionML=[ENU=Plant Number Description;
                                                              SVE=Maskinnr beskrivning];
                                                   Editable=No }
    { 800 ;   ;Cost Component Plant;Code10        ;TableRelation="Cost Component Plant".Code;
                                                   OnValidate=VAR
                                                                CostComponentPlant@1100529600 : Record 11012575;
                                                              BEGIN
                                                                IF "Cost Component Plant" <> '' THEN BEGIN
                                                                  CostComponentPlant.CHANGECOMPANY("Plant Company");
                                                                  CostComponentPlant.GET("Cost Component Plant");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupCostComponentPlant;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Cost Component Plant;
                                                              NOR=Kostdel, maskin;
                                                              SVE=Kostnadsdel, Maskin] }
    { 805 ;   ;Plant Part          ;Code30        ;TableRelation="Plant Part";
                                                   OnValidate=VAR
                                                                PlantPartPlantLevel@1100529000 : Record 11229932;
                                                              BEGIN
                                                                IF "Plant Part" <> '' THEN BEGIN
                                                                  TESTFIELD("Plant Type");
                                                                  TESTFIELD("Plant Number");
                                                                  PlantPartPlantLevel.GET(PlantPartPlantLevel.Level::PlantNumber, "Plant Type", "Plant Number", "Plant Part");
                                                                  CheckProblemOfPlantPart;
                                                                END;
                                                                CALCFIELDS("Plant Part Description");
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantPart(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Plant Part;
                                                              NOR=Maskindel;
                                                              SVE=Maskindel] }
    { 806 ;   ;Plant Part Description;Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Plant Part".Description WHERE (Code=FIELD(Plant Part)));
                                                   CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Description];
                                                   Editable=No }
    { 810 ;   ;Alternative Plant Loc Address;Code10;
                                                   TableRelation="Plant Location Address"."Address Code" WHERE (Location=FIELD(Plant Location));
                                                   OnValidate=BEGIN
                                                                ValidateAddressData(3);
                                                              END;

                                                   OnLookup=VAR
                                                              PlantLocationAddressesFrm@1100529901 : Page 11012625;
                                                              PlantLocationAddressRec@1100529900 : Record 11012590;
                                                            BEGIN
                                                              PlantLocationAddressRec.CHANGECOMPANY("Plant Company");
                                                              PlantLocationAddressRec.SETRANGE(Location,"Plant Location");
                                                              PlantLocationAddressesFrm.SETTABLEVIEW(PlantLocationAddressRec);
                                                              PlantLocationAddressesFrm.LOOKUPMODE := TRUE;
                                                              IF PlantLocationAddressesFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                                PlantLocationAddressesFrm.GETRECORD(PlantLocationAddressRec);
                                                                "Alternative Plant Loc Address" := PlantLocationAddressRec."Address Code";
                                                                ValidateAddressData(3);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Alternative Plant Location Address;
                                                              SVE=Alternativ maskinplatsadress] }
    { 820 ;   ;Firm Planned        ;Boolean       ;CaptionML=[ENU=Firm Planned;
                                                              NOR=Fast planlagt;
                                                              SVE=Fast planerad] }
    { 830 ;   ;Communication Text Changed;Boolean ;CaptionML=ENU=Communication Text Changed;
                                                   Editable=No }
    { 840 ;   ;Preferred Employee No.;Code20      ;TableRelation="Resource (WOP)";
                                                   OnValidate=VAR
                                                                ServiceSetup@1100528600 : Record 11012800;
                                                                ResourceMgtWorkOrderPlan@1100528601 : Codeunit 11229277;
                                                              BEGIN
                                                                ServiceSetup.GET;
                                                                ResourceMgtWorkOrderPlan.TestResourceWithinCompanyPlanGroup("Preferred Employee No.");
                                                                IF ("Preferred Employee No." <> '') AND (ServiceSetup."Use Pref. Employee as Employee") THEN
                                                                  VALIDATE("Employee No.", "Preferred Employee No.");
                                                              END;

                                                   CaptionML=[ENU=Preferred Employee;
                                                              NOR=Foretrukket Ansatt;
                                                              SVE=Fîrvald &anstÑlld];
                                                   Editable=No }
    { 850 ;   ;Preferred Employee Name;Text100    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Resource (WOP)".Name WHERE (No.=FIELD(Preferred Employee No.)));
                                                   CaptionML=[ENU=Name Preferred Employee;
                                                              NOR=Navn pÜ Foretrukket Ansatt;
                                                              SVE=Namn pÂ fˆrvald anst‰lld];
                                                   Editable=No }
    { 860 ;   ;Date Closed         ;Date          ;CaptionML=[ENU=Date Closed;
                                                              NOR=Dato Avsluttet;
                                                              SVE=Avslutsdatum];
                                                   Description=SCA }
    { 870 ;   ;Service Location Type;Code20       ;TableRelation="Service Location Type";
                                                   OnValidate=VAR
                                                                ServiceLocation@1100528600 : Record 11012801;
                                                              BEGIN
                                                                IF "Service Location No." <> '' THEN
                                                                  IF ServiceLocation.GET("Service Location No.") THEN
                                                                    IF ServiceLocation."Service Location Type" <> '' THEN
                                                                      TESTFIELD("Service Location Type", ServiceLocation."Service Location Type");
                                                              END;

                                                   CaptionML=[ENU=Service Location Type;
                                                              SVE=Serviceplatstyp] }
    { 875 ;   ;Service Location Type Desc.;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location Type".Description WHERE (Code=FIELD(Service Location Type)));
                                                   CaptionML=ENU=Service Location Type Description;
                                                   Editable=No }
    { 880 ;   ;Room (SUP)          ;Code20        ;TableRelation="SUP Room".Code;
                                                   OnValidate=VAR
                                                                ServiceUnitPriceManagement@1100525000 : Codeunit 11012846;
                                                              BEGIN
                                                                IF "Room (SUP)" <> xRec."Room (SUP)" THEN BEGIN
                                                                  ServiceUnitPriceManagement.ValidateRoom("Customer No.", "Room (SUP)");
                                                                  VALIDATE("Part (SUP)", '');
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceUnitPriceManagement@1100525000 : Codeunit 11012846;
                                                            BEGIN
                                                              ServiceUnitPriceManagement.LookupRoom("Customer No.", "Service Location Type", "Room (SUP)");
                                                              VALIDATE("Room (SUP)");
                                                            END;

                                                   CaptionML=[ENU=Room;
                                                              NOR=Rom;
                                                              SVE=Rum] }
    { 890 ;   ;Part (SUP)          ;Code20        ;TableRelation="SUP Part".Code;
                                                   OnValidate=VAR
                                                                ServiceUnitPriceManagement@1100525000 : Codeunit 11012846;
                                                              BEGIN
                                                                ServiceUnitPriceManagement.ValidatePart("Customer No.", "Part (SUP)");
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceUnitPriceManagement@1100525000 : Codeunit 11012846;
                                                            BEGIN
                                                              ServiceUnitPriceManagement.LookupPart("Customer No.", "Room (SUP)", "Part (SUP)");
                                                              VALIDATE("Part (SUP)");
                                                            END;

                                                   CaptionML=[ENU=Part;
                                                              NOR=Del;
                                                              SVE=Del] }
    { 900 ;   ;Order Manager       ;Code20        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=Order Manager;
                                                              NOR=Ordreleder;
                                                              SVE=Orderchef] }
    { 901 ;   ;Order Manager Name  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Salesperson/Purchaser.Name WHERE (Code=FIELD(Order Manager)));
                                                   CaptionML=[ENU=Order Manager Name;
                                                              NOR=Ordrelederens navn;
                                                              SVE=Orderchefens namn];
                                                   Editable=No }
    { 910 ;   ;Do not show on Service Portal;Boolean;
                                                   CaptionML=ENU=Do not show on Portal }
    { 920 ;   ;Origin              ;Option        ;CaptionML=[ENU=Origin;
                                                              NOR=Utstedt;
                                                              SVE=Ursprung];
                                                   OptionCaptionML=ENU=4PS Construct,4PS Mobile,4PS Service Portal,4PS Service Call App,Dispatch,4PS Field Service App,INSBOU Maint. Instr.,Survey,IoT Event,DSP,4PS Control,,,Other,Scan Application";
                                                   OptionString=4PS Construct,4PS Mobile,4PS Service Portal,4PS Service Call App,Dispatch,4PS Field Service App,INSBOU Maint. Instr.,Survey,IoT Event,DSP,4PS Control,,,Other,Scan Application;
                                                   Description=Same as T11012823:11012710;
                                                   Editable=No }
    { 925 ;   ;Master Company      ;Text30        ;TableRelation=Company;
                                                   OnValidate=VAR
                                                                CheckLicenceIC@1210190000 : Codeunit 11012780;
                                                              BEGIN
                                                                IF "Master Company" <> '' THEN
                                                                  CheckLicenceIC.CheckICEntry("Master Company");
                                                                IF "Master Company" <> xRec."Master Company" THEN BEGIN
                                                                  CheckCompanyIC;
                                                                  "Master Project" := '';
                                                                  "Master Element" := ''
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Master Company;
                                                              SVE=Huvudfîretag] }
    { 930 ;   ;Master Project      ;Code20        ;TableRelation=IF (Master Company=FILTER('')) Job WHERE (Internal Project=CONST(No));
                                                   OnValidate=BEGIN
                                                                IF "Master Project" <> xRec."Master Project" THEN BEGIN
                                                                  CheckCompanyIC;
                                                                  VALIDATE("Master Element", '');
                                                                  IF "Master Project" <> '' THEN BEGIN
                                                                    MasterProjRec.GET("Master Project");
                                                                    IF NOT (MasterProjRec."Project Status" IN [MasterProjRec."Project Status"::Production,
                                                                                                               MasterProjRec."Project Status"::"Technical Finished"]) THEN
                                                                      MasterProjRec.FIELDERROR("Project Status");
                                                                  END;
                                                                  IF NOT MasterProjElemRec.GET("Master Project", "Master Element") THEN
                                                                    "Master Element" := '';
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              OnLookupJobNo(TRUE);
                                                            END;

                                                   CaptionML=[ENU=Master Project;
                                                              NOR=Hovedprosjekt;
                                                              SVE=Originalprojekt] }
    { 940 ;   ;Master Element      ;Code20        ;TableRelation=IF (Master Company=FILTER('')) "Project Element".Element WHERE (Project No.=FIELD(Master Project));
                                                   OnValidate=BEGIN
                                                                IF "Master Element" <> '' THEN BEGIN
                                                                  CheckCompanyIC;
                                                                  IF ServContrRec.GET("Service Contract No.") THEN
                                                                    ServContrRec.TESTFIELD("Internal Contract", TRUE);
                                                                  FormatMgt.FormatElem("Master Element",2,'');
                                                                  MasterProjElemRec.GET("Master Project", "Master Element");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              CheckCompanyIC;
                                                              MasterProjElemRec."Project No." := "Master Project";
                                                              MasterProjElemRec.Element := "Master Element";
                                                              MasterProjElemRec.SETRANGE("Project No.", "Master Project");
                                                              IF PAGE.RUNMODAL(0, MasterProjElemRec) = ACTION::LookupOK THEN
                                                                VALIDATE("Master Element", MasterProjElemRec.Element);
                                                            END;

                                                   CaptionML=[ENU=Master Element;
                                                              NOR=Hovedelement;
                                                              SVE=Originalelement] }
    { 950 ;   ;Limit Budget Exceedance;Boolean    ;CaptionML=[ENU=Limit Budget Exceedance;
                                                              SVE=BudgetgrÑns, îverskridande];
                                                   Editable=No }
    { 960 ;   ;Tenant No.          ;Code20        ;CaptionML=[ENU=Tenant No.;
                                                              SVE=Klientnummer] }
    { 970 ;   ;Commision Date      ;Date          ;CaptionML=[ENU=Commision Date;
                                                              NOR=Provisjonsdato;
                                                              SVE=Provisionsdatum];
                                                   Description=//#C036834.n }
    { 980 ;   ;Service Location Struct. No.;Integer;
                                                   TableRelation="Service Location Structure".No. WHERE (Service Location No.=FIELD(Service Location No.),
                                                                                                         Use for Service Order/Call=CONST(Yes));
                                                   OnValidate=BEGIN
                                                                VALIDATE("Service Loc. Struct. Line No.", '');
                                                              END;

                                                   CaptionML=ENU=Service Location Struct. No.;
                                                   BlankZero=Yes }
    { 990 ;   ;Service Loc. Struct. Line No.;Code20;
                                                   TableRelation="Service Loc. Structure Line".No. WHERE (Service Location No.=FIELD(Service Location No.),
                                                                                                          Structure No.=FIELD(Service Location Struct. No.),
                                                                                                          Object Line=CONST(No));
                                                   CaptionML=ENU=Service Location Structure Line No. }
    { 1000;   ;Service Cluster     ;Code20        ;TableRelation="Service Cluster".Code;
                                                   OnValidate=BEGIN
                                                                ValidateServiceCluster;
                                                                DetermineServiceClusterSeqn;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupServiceCluster;
                                                            END;

                                                   CaptionML=[ENU=Service Cluster;
                                                              SVE=Servicekontraktskluster] }
    { 1010;   ;Service Cluster Seqn.;Integer      ;TableRelation="Service Cluster Seq."."Seq. No." WHERE (Type=CONST(Source Type),
                                                                                                          Type Code=CONST(),
                                                                                                          Source Type=CONST(Call),
                                                                                                          Cluster Code=FIELD(Service Cluster));
                                                   OnValidate=BEGIN
                                                                ValidateServiceClusterSeqn;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupServiceClusterSeqn;
                                                            END;

                                                   CaptionML=ENU=Service Cluster Seqn.;
                                                   BlankZero=Yes }
    { 1020;   ;Plant Company       ;Text30        ;TableRelation="Plant Management Company";
                                                   OnValidate=VAR
                                                                CompanyData@1100529602 : Record 11020674;
                                                              BEGIN
                                                                IF "Plant Company" = COMPANYNAME THEN
                                                                  "Plant Company" := '';
                                                                IF "Plant Company" <> xRec."Plant Company" THEN BEGIN
                                                                  IF "Plant Company" <> '' THEN
                                                                    IF CompanyData.GET("Plant Company") THEN
                                                                      IF CompanyData."Customer No." <> '' THEN
                                                                        VALIDATE("Customer No.", CompanyData."Customer No.");
                                                                  VALIDATE("Plant Location", '');
                                                                  VALIDATE("Plant Type", '');
                                                                  "Cost Component Plant" := '';
                                                                  DetermineCostComponentPlant;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Plant Company;
                                                              SVE=Maskinfîretag] }
    { 1030;   ;Process Structure Code;Code10      ;TableRelation="Service Process Structure".Code WHERE (Type=CONST(Service Call));
                                                   OnValidate=BEGIN
                                                                IF (xRec."Process Structure Code" <> "Process Structure Code") AND ("Process Structure Code" <> '') THEN
                                                                  ApplyDefaultsByProcessStructure;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Process Structure Code }
    { 1040;   ;Tenant Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Name" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Name;
                                                   Editable=No }
    { 1050;   ;Tenant Name 2       ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Name 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Name 2;
                                                   Editable=No }
    { 1060;   ;Tenant Phone        ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone;
                                                   Editable=No }
    { 1070;   ;Tenant Phone 2      ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone 2;
                                                   Editable=No }
    { 1080;   ;Tenant Mobile Phone ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Mobile Phone" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Mobile Phone;
                                                   Editable=No }
    { 1090;   ;Tenant Mobile Phone 2;Text30       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Mobile Phone 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Mobile Phone 2;
                                                   Editable=No }
    { 1100;   ;Tenant E-Mail       ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant E-Mail" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant E-Mail;
                                                   Editable=No }
    { 1110;   ;Tenant E-Mail 2     ;Text80        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant E-Mail 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant E-Mail 2;
                                                   Editable=No }
    { 1120;   ;Tenant Phone Work   ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone Work" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone Work;
                                                   Editable=No }
    { 1130;   ;Tenant Phone Work 2 ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Location"."Tenant Phone Work 2" WHERE (No.=FIELD(Service Location No.)));
                                                   CaptionML=ENU=Tenant Phone Work 2;
                                                   Editable=No }
    { 1140;   ;Calling Account E-mail;Text80      ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Calling Account E-Mail }
    { 11128000;;Contact No. Company;Code20        ;TableRelation=Contact;
                                                   OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Contact No. Company;
                                                              NOR=Kontaktnr;
                                                              SVE=Kontaktnr fîretag] }
    { 11128101;;Contact Name Company;Text100      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Contact No. Company)));
                                                   OnValidate=BEGIN
                                                                SyncServiceLocationData(CurrFieldNo);
                                                              END;

                                                   CaptionML=[ENU=Contact Name Company;
                                                              NOR=Kontaktnavn;
                                                              SVE=Kontaktnamn fîretag];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;No.                                     ;Clustered=Yes }
    {    ;Customer No.                             }
    {    ;Service Contract No.                     }
    {    ;Service Location No.                     }
    {    ;Previous Call No.                        }
    {    ;City,Address                             }
    {    ;Receiving Date,Receiving Time            }
    {    ;Expected Date,Expected Time              }
    {    ;Next Deadline                            }
    {    ;Global Dimension 1 Code                  }
    {    ;Vessel No.                               }
    {    ;Object No.                               }
    {    ;Post Code,House No.                      }
    {    ;Status,Assigned to                       }
    {    ;Status,Receiving Date                    }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ServSetup@1210190001 : Record 11012800;
      UserSetup@1100485002 : Record 91;
      ServLogRec@1100485009 : Record 11012855;
      ServLocRec@1210190006 : Record 11012801;
      ServContrRec@1210190003 : Record 11012812;
      ServDepRec@1100485007 : Record 11012809;
      ServActRec@1210190008 : Record 5080;
      ServTypeRec@1100485000 : Record 11012814;
      ProgSchemeRec@1100485008 : Record 11020250;
      ProgPhaseRec@1100485010 : Record 11020251;
      RefPeriodRec@1100485011 : Record 11020272;
      ProjRec@1210190004 : Record 11072003;
      CustRec@1210190010 : Record 18;
      DimValRec@1210190012 : Record 349;
      Postcode@1210190016 : Record 225;
      TradeSpecRec@1100485003 : Record 11020285;
      ContrPrioRec@1100525001 : Record 11012880;
      DimMgt@1210190011 : Codeunit 408;
      NoSeriesMgt@1210190000 : Codeunit 396;
      CtrlOrSubContrActiveTxt@1100528300 : TextConst 'ENU=%1 %2 or %3 %4 must be active.';
      Text000@1210190007 : TextConst 'ENU=must occur before %1;NOR=mÜ inntreffe fõr %1;SVE=mÜste intrÑffa fîre %1';
      Text001@1100485017 : TextConst 'ENU=Change %1 not allowed: %2 exist.;NOR=Ikke tillatt Ü endre %1: %2 finnes.;SVE=Att Ñndra %1 Ñr inte tillÜtet: %2 finns.';
      Text002@1100485012 : TextConst 'ENU=%1 %2 transfered to %3 %4.;NOR=%1 %2 overfõrt til %3 %4;SVE=%1 %2 îverfîrt till %3 %4.';
      Text004@1100525005 : TextConst 'ENU=Service Contract %1 expires on %2;NOR=Servicekontrakt %1 utgÜr %2;SVE=Servicekontrakt %1 lîper ut den %2';
      Text004a@1100525004 : TextConst 'ENU=%3 before Starting Date %2 of Service Contract %1;NOR=%3 fõr startdato %2 for servicekontrakt %1;SVE=%3 fîre startdatum %2 av servicekontrakt %1';
      Text004b@1100525006 : TextConst 'ENU=Service Contract %1 with Status %1;NOR=Servicekontrakt %1 med status %1;SVE=Servicekontrakt %1 med status %1';
      Text007@1100485005 : TextConst 'ENU=Assignment not accepted: the result would be a never ending chain of Service Calls.;NOR=Oppdraget er ikke akseptert: Resultatet ville blitt en evigvarende kjede av servicesamtaler;SVE=Tilldelning inte godkÑnd: resultatet skulle bli en oÑndlig kedja av servicesamtal.';
      Text010@1100485004 : TextConst 'ENU=Do you want to change the Address and the Communication Data? \\Old: \%1 \%2 \%3 \%4 \%5 \%6 \%7 \\New: \%8 \%9 \%10 \%11 \%12 \%13 \%14;NOR=Vil du endre adressedata? \\Gammel: \%1 \%2 \%3 \%4 \%5 \\Ny: \%6 \%7 \%8 \%9 \%10;SVE=Vill du Ñndra adressdata? \\Gammal: \%1 \%2 \%3 \%4 \%5 \\Nya: \%6 \%7 \%8 \%9 \%10';
      Text011@1100485014 : TextConst 'ENU=%1 is not a valid %2.;NOR=%1 er ikke en gyldig %2.;SVE=%1 kan inte anvÑndas som %2.';
      gUseFilledOrderDateTime@1100485001 : Boolean;
      CheckValidateWatch@1100485016 : Boolean;
      Text013@1100525003 : TextConst 'ENU=Before you can use Online Map, you must fill in the Online Map Setup window.\See Setting Up Online Map in Help.;NOR=Fõr du kan bruke Online Map mÜ du fylle ut vinduet Online Map - Innstillinger.\Se Konfigurasjon av Online Map i Hjelp;SVE=Innan du kan anvÑnda Online Map mÜste du fylla i fînstret Online Map - instÑllning.\Se Konfiguration av Online Map i hjÑlpen';
      Text016@1100525007 : TextConst 'ENU=Plant Location cannot be assigned to a service order;SVE=Maskinplats kan inte tilldelas till en serviceorder';
      Text017@1100528600 : TextConst 'ENU=New Service Portal Call %1 created';
      Text018@1100528601 : TextConst 'ENU=Do you want to change %1: \Old: %2 - %3\New: %4 - %5;SVE=Vill du Ñndra %1: \Gammal: %2 - %3\Ny: %4 - %5';
      Text019@1100528602 : TextConst 'ENU=%1 %2 created.';
      Text020@1100529600 : TextConst 'ENU=Do you want to change %1?;SVE=Vill du Ñndra %1?';
      Text999@1100525002 : TextConst 'ENU=Rename not allowed due to external applications;NOR=Gi nytt navn er ikke tillatt pga eksterne programmer;SVE=Att ge nytt namn Ñr inte tillÜtet pÜ grund av externa program';
      DPA_Management@1100000999 : Codeunit 11012783;
      CurrentGlobalLanguage@1100525000 : Integer;
      MasterProjRec@1100528201 : Record 11072003;
      MasterProjElemRec@1100528200 : Record 11012010;
      FormatMgt@1100528202 : Codeunit 11012022;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      ReferencePointModifiedByEmployee@1100526000 : Code[20];
      DisciplineExists@1100527450 : Boolean;

    PROCEDURE ValidateAddressData@1210190000(lvAction@1100485000 : Integer);
    VAR
      Message@1100527000 : Text;
      Confirmed@1100528500 : Boolean;
    BEGIN
      ServSetup.GET;
      CASE lvAction OF
        1: ValidateServiceLocAddressData;
        2: ValidateBillToCustAddressData;
        3: ValidatePlantLocAddressData;
      END;

      IF CurrFieldNo <> 0 THEN BEGIN
        IF ((xRec.Name + xRec.Address + xRec.City + xRec."Post Code" + xRec."Contact Name" + xRec."Phone No." + xRec."Mobile Phone No." + xRec."E-Mail") <>
            (Name + Address + City + "Post Code" + "Contact Name" + "Phone No." + "Mobile Phone No." + "E-Mail")) AND
           ((xRec.Name + xRec.Address + xRec.City + xRec."Post Code" + xRec."Contact Name" + xRec."Phone No." + xRec."Mobile Phone No." + xRec."E-Mail" <> ''))
        THEN BEGIN
          Message := STRSUBSTNO(Text010, xRec.Name, xRec.Address, (xRec."Post Code" + '  ' + xRec.City), xRec."Contact Name", xRec."Phone No.", xRec."Mobile Phone No.",
                                xRec."E-Mail", Name, Address, ("Post Code" + '  ' + City), "Contact Name", "Phone No.", "Mobile Phone No.", "E-Mail");
          IF GUIALLOWED AND ((CurrFieldNo <> FIELDNO("Customer No.")) OR ((CurrFieldNo = FIELDNO("Customer No.")) AND ("Service Location No." = ''))) THEN
            Confirmed := CONFIRM(Message, TRUE)
          ELSE
            Confirmed := TRUE;
          IF NOT Confirmed THEN BEGIN
            Name := xRec.Name;
            "Name 2" := xRec."Name 2";
            Address := xRec.Address;
            "Address 2" := xRec."Address 2";
            VALIDATE("Post Code", xRec."Post Code");
            City := xRec.City;
            "Country/Region Code" := xRec."Country/Region Code";
            "Contact Name" := xRec."Contact Name";
            "Phone No." := xRec."Phone No.";
            "Phone No. 2" := xRec."Phone No. 2";
            "Mobile Phone No." := xRec."Mobile Phone No.";
            "Fax No." := xRec."Fax No.";
            "E-Mail" := xRec."E-Mail";
            "Territory Code" := xRec."Territory Code";
          END ELSE BEGIN
            xRec.Name := Name;
            xRec."Name 2" := "Name 2";
            xRec.Address := Address;
            xRec."Address 2" := "Address 2";
            xRec.City := City;
            xRec."Country/Region Code" := "Country/Region Code";
            xRec."Post Code" := "Post Code";
            xRec."Contact Name" := "Contact Name";
            xRec."Phone No." := "Phone No.";
            xRec."Phone No. 2" := "Phone No. 2";
            xRec."Mobile Phone No." := "Mobile Phone No.";
            xRec."Fax No." := "Fax No.";
            xRec."E-Mail" := "E-Mail";
            xRec."Territory Code" := "Territory Code";
          END;
        END;
      END;

      CALCFIELDS("Project (Orig)");
    END;

    PROCEDURE ValidateServiceLocAddressData@1100529900();
    BEGIN
      GetCustomerAddressData;

      IF NOT GetServiceLocationAddressData THEN
        IF NOT GetServiceContractAddressData THEN
          GetPlantLocationAddressData;
    END;

    PROCEDURE ValidateBillToCustAddressData@1100529901();
    VAR
      Customer@1100529600 : Record 18;
    BEGIN
      IF "Bill-to Customer No." <> '' THEN BEGIN
        Customer.GET("Bill-to Customer No.");
        IF "Bill-to Customer No." <> "Customer No." THEN
          Customer.CheckBlockedCustomerByTableNo(DATABASE::"Service Call", FIELDNO("Bill-to Customer No."));
        CheckInvoiceAddress;
      END;
    END;

    PROCEDURE ValidatePlantLocAddressData@1100529906();
    BEGIN
      IF NOT GetPlantLocationAddressData THEN
        IF NOT GetServiceLocationAddressData THEN
          IF NOT GetServiceContractAddressData THEN
            GetCustomerAddressData;
    END;

    LOCAL PROCEDURE GetServiceLocationAddressData@1100529610() : Boolean;
    VAR
      Employee@1100525000 : Record 5200;
    BEGIN
      IF "Service Location No." = '' THEN
        EXIT(FALSE);
      ServSetup.GET;

      ServLocRec.GET("Service Location No.");
      ServLocRec.TESTFIELD(Blocked, FALSE);
      Name := COPYSTR(ServLocRec.Description, 1, MAXSTRLEN(Name));
      "Name 2" := COPYSTR(ServLocRec."Description 2", 1, MAXSTRLEN("Name 2"));
      Address := ServLocRec.Address;
      "Address 2" := ServLocRec."Address 2";
      City := ServLocRec.City;
      "Country/Region Code" := ServLocRec."Country/Region Code";
      "Post Code" := ServLocRec."Post Code";
      "Contact Name" := ServLocRec."Contact Name";
      "Bill-to Contact Name" := ServLocRec."Bill-to Contact Name";
      "Phone No." := ServLocRec."Phone No.";
      "Phone No. 2" := ServLocRec."Phone No. 2";
      "Mobile Phone No." := ServLocRec."Mobile Phone No.";
      "Fax No." := ServLocRec."Fax No.";
      "E-Mail" := ServLocRec."E-Mail";
      "Territory Code" := ServLocRec."Territory Code";
      IF "Territory Code" = '' THEN
        Postcode.GetTerritoryByPostCodeGroup(City,"Post Code","Territory Code");  //db, 11-02-13: C005566
      IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::LocationMgt THEN
        "Order Manager" := ServLocRec."Location Manager";  //C019333
      IF ServSetup."Assign To" = ServSetup."Assign To"::LocationMgt THEN
        IF (ServLocRec."Location Manager" = '') OR Employee.GET(ServLocRec."Location Manager") THEN
          "Assigned to" := ServLocRec."Location Manager";
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetServiceContractAddressData@1100529612() : Boolean;
    VAR
      Employee@1100525000 : Record 5200;
    BEGIN
      IF "Service Contract No." = '' THEN
        EXIT(FALSE);
      ServSetup.GET;
      ServContrRec.GET("Service Contract No.");
      ServContrRec.TESTFIELD(Blocked, FALSE);
      ServContrRec.CALCFIELDS(Name, Address, City, "Post Code");
      IF ServContrRec."Customer No." <> '' THEN BEGIN  //db, 23-11-06 (dummy contract)
        Name := ServContrRec.Name;
        "Name 2" := ServContrRec."Name 2";
        Address := ServContrRec.Address;
        "Address 2" := ServContrRec."Address 2";
        City := ServContrRec.City;
        "Country/Region Code" := ServContrRec."Country/Region Code";
        VALIDATE("Post Code", ServContrRec."Post Code");
        "Contact Name" := ServContrRec."Contact Name";
        "Phone No." := ServContrRec."Phone No.";
        "Phone No. 2" := ServContrRec."Phone No. 2";
        "Mobile Phone No." := ServContrRec."Mobile Phone No.";
        "Fax No." := ServContrRec."Fax No.";
        "E-Mail" := ServContrRec."E-Mail";
        //"Territory Code" := ServContrRec."Territory Code";
      END;
      IF ServSetup."Order Manager based on" = ServSetup."Order Manager based on"::ContractMgt THEN
        "Order Manager" := ServContrRec."Contract Manager";  //C019333
      IF ServSetup."Assign To" = ServSetup."Assign To"::ContractMgt THEN
        IF (ServContrRec."Contract Manager" = '') OR Employee.GET(ServContrRec."Contract Manager") THEN
          "Assigned to" := ServContrRec."Contract Manager";
      EXIT(TRUE);
    END;

    PROCEDURE GetPlantLocationAddressData@1100529607() : Boolean;
    VAR
      PlantLocation@1100529901 : Record 11012554;
      PlantLocationAddress@1100529902 : Record 11012590;
    BEGIN
      IF "Plant Location" = '' THEN
        EXIT(FALSE);

      PlantLocation.CHANGECOMPANY("Plant Company");
      PlantLocation.GET("Plant Location");
      PlantLocation.TESTFIELD(Blocked, FALSE);
      Name := COPYSTR(PlantLocation.Description, 1, MAXSTRLEN(Name));
      "Name 2":= COPYSTR(PlantLocation."Description 2", 1, MAXSTRLEN("Name 2"));
      IF "Alternative Plant Loc Address" = '' THEN BEGIN
        Address := PlantLocation.Address;
        "Address 2" := PlantLocation."Address 2";
        City := PlantLocation.City;
        "Country/Region Code" := PlantLocation."Country/Region Code";
        "Post Code" := PlantLocation."Post Code";
        "Contact Name" := PlantLocation.Contact;
        "Phone No." := PlantLocation."Phone No.";
        "Phone No. 2" := PlantLocation."Contact Phone No.";
        "Fax No." := PlantLocation."Fax No.";
        "E-Mail" := PlantLocation."E-Mail";
        "Territory Code" := PlantLocation."Territory Code";
        "Mobile Phone No." := PlantLocation."Mobile Phone No.";
      END ELSE BEGIN
        PlantLocationAddress.CHANGECOMPANY("Plant Company");
        IF PlantLocationAddress.GET("Plant Location", "Alternative Plant Loc Address") THEN BEGIN
          Address := PlantLocationAddress.Address;
          "Address 2" := PlantLocationAddress."Address 2";
          City := PlantLocationAddress.City;
          "Country/Region Code" := '';
          "Post Code" := PlantLocationAddress."Post Code";
          "Contact Name" := PlantLocationAddress.Contact;
          "Phone No." := PlantLocationAddress."Phone No.";
          "Phone No. 2" := '';
          "Fax No." := '';
          "E-Mail" := PlantLocationAddress."E-Mail";
          "Territory Code" := '';
          "Mobile Phone No." := PlantLocationAddress."Mobile Phone No.";
        END;
      END;
      Postcode.GetTerritoryByPostCodeGroup(City, "Post Code", "Territory Code");  //db, 11-02-13: C005566

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE GetCustomerAddressData@1100529603();
    VAR
      BillToCustomerCodeLoc@1100529900 : Code[20];
    BEGIN
      IF "Customer No." = '' THEN
        EXIT;

      CustRec.GET("Customer No.");
      CustRec.CheckBlockedCustomerByTableNo(DATABASE::"Service Call", FIELDNO("Customer No."));
      Name := CustRec.Name;
      "Name 2":= CustRec."Name 2";
      Address := CustRec.Address;
      "Address 2":= CustRec."Address 2";
      City := CustRec.City;
      "Country/Region Code" := CustRec."Country/Region Code";
      "Post Code" := CustRec."Post Code";
      "Contact Name" := CustRec.Contact;
      "Phone No." := CustRec."Phone No.";
      "Phone No. 2" := CustRec."Phone No. 2";
      "Mobile Phone No." := CustRec."Mobile Phone No.";
      "Fax No." := CustRec."Fax No.";
      "E-Mail" := CustRec."E-Mail";
      "Territory Code" := CustRec."Territory Code";
      IF "Territory Code" = '' THEN
        Postcode.GetTerritoryByPostCodeGroup(City,"Post Code","Territory Code");  //db, 11-02-13: C005566
      IF CustRec."Bill-to Customer No." <> '' THEN
        BillToCustomerCodeLoc := CustRec."Bill-to Customer No."
      ELSE
        BillToCustomerCodeLoc := "Customer No.";
      IF "Bill-to Customer No." = '' THEN
        VALIDATE("Bill-to Customer No.", BillToCustomerCodeLoc)
      ELSE BEGIN
        IF (CurrFieldNo = FIELDNO("Customer No.")) AND (BillToCustomerCodeLoc<> "Bill-to Customer No.") THEN BEGIN
          IF (GUIALLOWED) THEN BEGIN
            IF CONFIRM(Text020,FALSE,FIELDCAPTION("Bill-to Customer No.")) THEN BEGIN
              VALIDATE("Bill-to Customer No.", BillToCustomerCodeLoc);
              "Alternative Bill-to Address" := '';
            END;
          END;
        END;
      END;
    END;

    PROCEDURE ValidateOtherData@1210190008();
    VAR
      PlantLocRec@1100529300 : Record 11012554;
      Job@1100528600 : Record 11072003;
      SkipValidateBillToCust@1100529600 : Boolean;
    BEGIN
      IF ServLocRec.GET("Service Location No.") THEN BEGIN
        IF ("Service Contract No." = '') OR (ServContrRec."Customer No." = '') THEN BEGIN
          IF ServLocRec."Customer No." <> '' THEN BEGIN
            "Bill-to Customer No." := '';  //db, 07-02-12: M32854
            VALIDATE("Customer No.", ServLocRec."Customer No.");
          END;
        END ELSE
          VALIDATE("Service Contract No.");
        IF ("Service Contract No." = '') OR (ServContrRec."Bill-to Customer No. (CP)" = '') THEN BEGIN
          IF ServLocRec."Bill-to Customer No." <> '' THEN
            VALIDATE("Bill-to Customer No.", ServLocRec."Bill-to Customer No.");
          IF ("Alternative Bill-to Address" <> ServLocRec."Alternative Bill-to Address") AND (ServLocRec."Alternative Bill-to Address" <> '') THEN
            VALIDATE("Alternative Bill-to Address",ServLocRec."Alternative Bill-to Address");
          SkipValidateBillToCust := TRUE;
        END;
        "Service Location Type" := ServLocRec."Service Location Type";
      END;

      //DP00195 sn.
      PlantLocRec.CHANGECOMPANY("Plant Company");
      IF PlantLocRec.GET("Plant Location") THEN BEGIN
        "Bill-to Customer No." := '';
        IF (PlantLocRec."Company Name" = '') AND (PlantLocRec."Customer No." <> '') THEN
          VALIDATE("Customer No.", PlantLocRec."Customer No.")
        ELSE
          IF (PlantLocRec."Company Name" = '') AND (PlantLocRec."Project No." <> '') THEN BEGIN
            IF NOT Job.GET(PlantLocRec."Project No.") THEN
              Job.INIT;
           IF (Job."Bill-to Customer No." = '') AND (Job."Single/Main/Sub Project" = Job."Single/Main/Sub Project"::"Sub Project") THEN
             IF NOT Job.GET(Job."Main Project") THEN
               Job.INIT;
            IF Job."Bill-to Customer No." <> '' THEN
              VALIDATE("Customer No.", Job."Bill-to Customer No.")
          END ELSE
            VALIDATE("Customer No.", ServSetup."Customer Internal Charge");
      END;
      //DP00195 en.

      IF NOT SkipValidateBillToCust THEN
        IF "Bill-to Customer No." <> "Customer No." THEN
          VALIDATE("Bill-to Customer No.");

      CheckInvoiceAddress;
    END;

    PROCEDURE CheckInvoiceAddress@1100485030();
    VAR
      AdrsRec@1210190000 : Record 222;
    BEGIN
      IF AdrsRec.GET("Bill-to Customer No.", "Alternative Bill-to Address") THEN BEGIN
        "Bill-to Name" := AdrsRec.Name;
        "Bill-to Name 2" := AdrsRec."Name 2";
        "Bill-to Address" := AdrsRec.Address;
        "Bill-to Address 2" := AdrsRec."Address 2";
        "Bill-to Post Code" := AdrsRec."Post Code";
        "Bill-to City" := AdrsRec.City;
      END ELSE BEGIN
        "Alternative Bill-to Address" := '';
        IF NOT CustRec.GET("Bill-to Customer No.") THEN CustRec.INIT;  //db, 23-02-09: M13533
        "Bill-to Name" := CustRec.Name;
        "Bill-to Name 2" := CustRec."Name 2";
        "Bill-to Address" := CustRec.Address;
        "Bill-to Address 2" := CustRec."Address 2";
        "Bill-to Post Code" := CustRec."Post Code";
        "Bill-to City" := CustRec.City;
      END;
    END;

    PROCEDURE NameEmployee@9() : Text[100];
    BEGIN
      //DP00465.o
      //IF EmplRec.GET("Employee No.") THEN
      //  EXIT(EmplRec.FullName)
      //ELSE
      //  EXIT('');

      //DP00465.n
      CALCFIELDS("Employee Name");
      EXIT("Employee Name");
    END;

    PROCEDURE TransferDocument@1210190001() : Code[20];
    VAR
      ServOrderRec@1100485000 : Record 11012823;
      lvCount@1100485001 : Integer;
    BEGIN
      IF "Sales Document No." <> '' THEN
        EXIT("Sales Document No.");

      IF "Project (Dest)" <> '' THEN
        EXIT("Project (Dest)");

      IF "Service Order No." <> '' THEN BEGIN
        ServOrderRec.SETCURRENTKEY("Call No.");
        ServOrderRec.SETRANGE("Call No.", "No.");
        lvCount := ServOrderRec.COUNT;
        IF lvCount = 1 THEN
          EXIT("Service Order No.")
        ELSE
          EXIT(STRSUBSTNO('[%1]', lvCount));
      END;

      EXIT('');
    END;

    PROCEDURE LookupServiceLocation@1210190002();
    VAR
      ContractObject@1100528600 : Record 11071702;
      BuildingObjectRelation@1100528601 : Record 11071820;
      ServiceLocation@1100528603 : Record 11012801;
      ServiceLocation2@1100528602 : Record 11012801;
      ServiceContract@1100525000 : Record 11012812;
    BEGIN
      IF "Service Contract No." <> '' THEN
        ServiceContract.GET("Service Contract No.");
      IF ("Service Contract No." <> '') AND
         (ServiceContract."Contract Form" <> ServiceContract."Contract Form"::"Framework Contract")
      THEN BEGIN
        ContractObject.SETRANGE("Service Contract No.", "Service Contract No.");
        IF "Object No." <> '' THEN
          ContractObject.SETRANGE("Service Object No.", "Object No.");
        IF ContractObject.FINDSET THEN
          REPEAT
            IF ContractObject."Service Location No." <> '' THEN BEGIN
              ServiceLocation."No." := ContractObject."Service Location No.";
              ServiceLocation.MARK(TRUE);
            END ELSE BEGIN
              BuildingObjectRelation.SETCURRENTKEY("Object No.");
              BuildingObjectRelation.SETRANGE("Object No.", ContractObject."Service Object No.");
              BuildingObjectRelation.SETFILTER("Building Code", '<>%1', '');
              IF BuildingObjectRelation.FINDSET THEN BEGIN
                ServiceLocation2.SETCURRENTKEY("Building Code");
                REPEAT
                  ServiceLocation2.SETRANGE("Building Code", BuildingObjectRelation."Building Code");
                  IF ServiceLocation2.FINDSET THEN
                    REPEAT
                      ServiceLocation."No." := ServiceLocation2."No.";
                      ServiceLocation.MARK(TRUE);
                    UNTIL ServiceLocation2.NEXT = 0;
                UNTIL BuildingObjectRelation.NEXT = 0;
              END;
            END;
          UNTIL ContractObject.NEXT = 0;
        ServiceLocation.MARKEDONLY(TRUE);
      END ELSE BEGIN
        IF "Customer No." <> '' THEN BEGIN
          ServiceLocation.SETCURRENTKEY("Customer No.");
          ServiceLocation.SETRANGE("Customer No.", "Customer No.");
        END;
      END;

      ServiceLocation."No." := "Service Location No.";
      IF PAGE.RUNMODAL(PAGE::"Service Location List", ServiceLocation) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Customer No.", ServiceLocation."Customer No.");
        CurrFieldNo := FIELDNO("Service Location No.");  //C026188; force check object-relation (location-contract)
        VALIDATE("Service Location No.", ServiceLocation."No.");
      END;
    END;

    PROCEDURE LookupServiceContract@1210190004();
    VAR
      MaintenanceManagementCU@1100528603 : Codeunit 11012829;
      ServiceContractNo@1100528602 : Code[20];
    BEGIN
      ServContrRec.RESET;
      IF "Object No." <> '' THEN BEGIN
        ServiceContractNo := MaintenanceManagementCU.ShowActualContractsForObject("Object No.", "Customer No.", TODAY, TRUE, "Service Contract No.");
        IF ServiceContractNo <> '' THEN
          VALIDATE("Service Contract No.", ServiceContractNo);
      END ELSE BEGIN
        MaintenanceManagementCU.FilterActualContracts("Service Location No.", "Customer No.", "Service Contract No.", ServContrRec);
        IF PAGE.RUNMODAL(PAGE::"Service Contracts List", ServContrRec) = ACTION::LookupOK THEN
          VALIDATE("Service Contract No.", ServContrRec."No.");
      END;
    END;

    PROCEDURE ShowContact@1210190003(lvCust@1210190001 : Code[20];lvBillToCust@1100529600 : Code[20]);
    VAR
      ContRec@1210190006 : Record 5050;
      ServContRec@1100485000 : Record 11012841;
    BEGIN
      IF "Service Location No." <> '' THEN BEGIN
        ServContRec.SETRANGE("Service Location No.", "Service Location No.");
      END ELSE BEGIN
        IF "Service Contract No." <> '' THEN BEGIN
          ServContRec.SETRANGE("Service Contract No.", "Service Contract No.");
        END ELSE BEGIN
          ServContRec.SETRANGE("Service Location No.", '%1', '');
          ServContRec.SETRANGE("Service Contract No.", '%1', '');
        END;
      END;
      IF ServContRec.FINDFIRST THEN BEGIN
        IF PAGE.RUNMODAL(PAGE::"Service Contacts", ServContRec) = ACTION::LookupOK THEN BEGIN
          "Contact Name" := ServContRec."Contact Name";
          "Phone No." := ServContRec."Phone No.";
          "E-Mail" := ServContRec."E-Mail";
          "Phone No. 2" := ServContRec."Phone No. 2";
          "Mobile Phone No." := ServContRec."Mobile Phone No.";
          "Fax No." := ServContRec."Fax No.";
        END;
      END ELSE BEGIN
        CustRec.ShowContactName2(lvCust, lvBillToCust, ContRec);
        IF ContRec.Name <> '' THEN BEGIN
          "Contact Name" := ContRec.Name;
          "Phone No." := ContRec."Phone No. Work";
          "Phone No. 2" := ContRec."Phone No. Work 2";
          IF "Phone No." = '' THEN
            "Phone No." := ContRec."Phone No.";
          IF "Phone No. 2" = '' THEN
            "Phone No. 2" := ContRec."Phone No. 2";
          "E-Mail" := ContRec."E-Mail";
          "Mobile Phone No." := ContRec."Mobile Phone No.";
          "Fax No." := ContRec."Fax No.";
        END;
      END;
    END;

    PROCEDURE ShowBillToContact@1100529600(BillToCustomerNo@1210190001 : Code[20]);
    VAR
      LocContact@1210190006 : Record 5050;
      LocServiceContact@1100485000 : Record 11012841;
    BEGIN
      IF "Service Location No." <> '' THEN
        LocServiceContact.SETRANGE("Service Location No.", "Service Location No.")
      ELSE
        IF "Service Contract No." <> '' THEN
          LocServiceContact.SETRANGE("Service Contract No.", "Service Contract No.")
        ELSE BEGIN
          LocServiceContact.SETRANGE("Service Location No.", '%1', '');
          LocServiceContact.SETRANGE("Service Contract No.", '%1', '');
        END;

      IF LocServiceContact.FINDFIRST THEN BEGIN
        IF PAGE.RUNMODAL(PAGE::"Service Contacts", LocServiceContact) = ACTION::LookupOK THEN
          "Bill-to Contact Name" := LocServiceContact."Contact Name";
      END ELSE BEGIN
        CustRec.ShowContactName(BillToCustomerNo, LocContact);
        IF LocContact.Name <> '' THEN
          "Bill-to Contact Name" := LocContact.Name;
      END;
    END;

    PROCEDURE AssistEdit@2(OldServCall@11012000 : Record 11012822) : Boolean;
    VAR
      ServCall@1210190000 : Record 11012822;
    BEGIN
      WITH ServCall DO BEGIN
        ServCall := Rec;
        ServSetup.GET;
        ServSetup.TESTFIELD("Call Nos.");
        IF NoSeriesMgt.SelectSeries(ServSetup."Call Nos.",OldServCall."No. Series","No. Series") THEN BEGIN
          NoSeriesMgt.SetSeries("No.");
          IF ServSetup."Assign To" = ServSetup."Assign To"::User THEN
            IF UserSetup.GET(USERID) THEN
              "Assigned to" := UserSetup."Employee No.";
          Rec := ServCall;
          EXIT(TRUE);
        END;
      END;
    END;

    PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    VAR
      DimMgt@1100525000 : Codeunit 408;
      DimValRec@1100525001 : Record 349;
    BEGIN
      //db, 19-08-09: M15896
      IF ShortcutDimCode = '' THEN EXIT;
      DimMgt.ValidateDimValueCode(FieldNumber,ShortcutDimCode);
      DimMgt.GetDimValueRec(FieldNumber, ShortcutDimCode, DimValRec, TRUE,'');
      IF NOT DimMgt.CheckDimValue(DimValRec."Dimension Code",ShortcutDimCode) THEN
        ERROR(DimMgt.GetDimErr);
    END;

    PROCEDURE GenerateServiceOrder@1100528601(IOrderKind@1100528601 : Code[10];IOrderType@1100528605 : Code[10];IDiscipline@1100528602 : Code[10];ITradeSpeciality@1100528603 : Code[10];OrderDateTime@1100528701 : DateTime);
    VAR
      ServOrder@1210190002 : Record 11012823;
      ServOrderExtension@1100528900 : Record 11071727;
      ServiceOrderObject@1100528600 : Record 11071724;
      WorkOrder@1100485002 : Record 11229279;
      lvHumanResSetupRec@1100525000 : Record 5218;
      PlanningAgreement@1100528604 : Record 11071729;
      ContractObject@1210190000 : Record 11071702;
      ServicePackage@1210190001 : Record 11012806;
      ServiceSourceTypeSetup@1100525001 : Record 11071726;
      DocumentReferencePoint@1100525002 : Record 11020296;
      Customer@1100528606 : Record 18;
      DispatchSetup@1100528607 : Record 11072270;
      ServiceOrderIndication@1100528500 : Record 11012837;
      ResourceGroupWOP@1100527450 : Record 11229384;
      MobileSetup@1100528700 : Record 11012676;
    BEGIN
      IF Customer.GET("Customer No.") THEN
        Customer.CheckBlockedCustomerByTableNo(DATABASE::"Service Order", ServOrder.FIELDNO("Customer No."));
      IF "Customer No." <> "Bill-to Customer No." THEN
        IF Customer.GET("Bill-to Customer No.") THEN
          Customer.CheckBlockedCustomerByTableNo(DATABASE::"Service Order", ServOrder.FIELDNO("Bill-to Customer No."));

      ServSetup.GET;

      ServOrder.INIT;
      CLEAR(ServOrder);
      ServOrder.SetReferencePointModifiedByEmployee(ReferencePointModifiedByEmployee);
      ServOrder.Origin := Origin;
      ServOrder."Source Type" := ServOrder."Source Type"::Call;
      CASE ServOrder.Origin OF
        ServOrder.Origin::Dispatch:
          BEGIN
            DispatchSetup.GET;
            DispatchSetup.TESTFIELD("Service Order Nos.");
            ServOrder."No. Series" := DispatchSetup."Service Order Nos.";
          END;
        ServOrder.Origin::"4PS Mobile":
          BEGIN
            MobileSetup.GET;
            MobileSetup.TESTFIELD("Service Order Nos. (Decentral)");
            ServOrder."No. Series" := MobileSetup."Service Order Nos. (Decentral)";
          END;
      ELSE
        IF ServiceSourceTypeSetup.GET(ServOrder."Source Type") THEN
          ServOrder."No. Series" := ServiceSourceTypeSetup."No. Series";
      END;
      IF CheckSeries(ServOrder."No. Series") THEN BEGIN
        ServOrder.AssistEdit(ServOrder);
        IF ServOrder."No." = '' THEN EXIT;
      END ELSE BEGIN
        NoSeriesMgt.InitSeries(ServOrder."No. Series",'',0D,ServOrder."No.",ServOrder."No. Series");
      END;
      ServOrder.Priority := Priority;
      IF (OrderDateTime <> 0DT) THEN BEGIN
        ServOrder.SetUseFilledOrderDateTime(TRUE);
        ServOrder."Order Date" := DT2DATE(OrderDateTime);
        ServOrder."Order Time" := DT2TIME(OrderDateTime);
      END;
      ServOrder."Starting Date" := "Expected Date";
      ServOrder."Starting Time" := "Expected Time";
      ServOrder.INSERT(TRUE);

      ServOrder."Call No." := "No.";
      ServOrder.Description := Description;
      ServOrder.SetSkipDeterminePriceBookFields(("Customer No." <> "Bill-to Customer No.") AND ("Bill-to Customer No." <> ''));
      IF "Service Contract No." = ''  THEN
        ServOrder.VALIDATE("Customer No.", "Customer No.");
      IF ServLocRec.GET("Service Location No.") THEN
        ServOrder.VALIDATE("Service Location No.", "Service Location No.");
      IF "Service Contract No." <> '' THEN //mg, 09-01-13: C004583
        ServOrder.VALIDATE("Service Contract No.", "Service Contract No.");
      ServOrder.SetSkipDeterminePriceBookFields(FALSE);
      IF "Bill-to Customer No." <> '' THEN
        ServOrder.VALIDATE("Bill-to Customer No.", "Bill-to Customer No.");
      IF ServOrder."Customer No." = '' THEN
        ServOrder.VALIDATE("Customer No.", "Customer No.");
      IF "Alternative Bill-to Address" <> '' THEN
        ServOrder.VALIDATE("Alternative Bill-to Address", "Alternative Bill-to Address");
      ServOrder.Name := Name;
      ServOrder."Name 2":= "Name 2";
      ServOrder.Address := Address;
      ServOrder."Address 2" := "Address 2";
      ServOrder.City := City;
      ServOrder."Territory Code" := "Territory Code";
      ServOrder."Post Code" := "Post Code";
      ServOrder.County := County;
      ServOrder."Country/Region Code" := "Country/Region Code";
      ServOrder."Contact Name" := "Contact Name";
      ServOrder."Bill-to Contact Name" := "Bill-to Contact Name";
      ServOrder."Phone No." := "Phone No.";
      ServOrder."Phone No. 2" := "Phone No. 2";
      ServOrder."Mobile Phone No." := "Mobile Phone No.";
      ServOrder."Fax No." := "Fax No.";
      ServOrder."E-Mail" := "E-Mail";
      ServOrder."Your Reference" := "Your Reference";
      ServOrder."Commision Date" := "Commision Date"; //#C036834.n

      IF IOrderKind <> '' THEN BEGIN
        ServOrder.VALIDATE("Order Kind", IOrderKind);
        IF (ServOrder."Service Category" = '') AND ServiceOrderIndication.GET(ServiceOrderIndication.Indication::Kind, IOrderKind) THEN
          ServOrder."Service Category" := ServiceOrderIndication."Service Category";
      END;
      IF IOrderType <> '' THEN
        ServOrder.VALIDATE("Order Type", IOrderType);
      IF "Order Manager" <> '' THEN
        ServOrder."Order Manager" := "Order Manager";  //C019333
      ServOrder."Assigned to" := "Assigned to";
      ServOrder.Watch := Watch;
      ServOrder."Employee No." := "Employee No.";
      IF "Expected Hours" <> 0 THEN BEGIN  //db, 27-08-13: C008975 (default can be set by Order Kind/Type)
        ServOrder."Expected Hours" := "Expected Hours";
        ServOrder."Duration Time":= ServOrder."Expected Hours";  //db, 02-03-15: C020552
      END;
      ServOrder."First Possible Starting Date" := "First Possible Starting Date";
      ServOrder."First Possible Starting Time" := "First Possible Starting Time";
      ServOrder."Last Possible Ending Date" := "Last Possible Ending Date";
      ServOrder."Last Possible Ending Time" := "Last Possible Ending Time";
      ServOrder.VALIDATE("Firm Planned", "Firm Planned");

      ServOrder."Plant Company" := "Plant Company";
      ServOrder."Plant Location" := "Plant Location";
      ServOrder."Plant Type" := "Plant Type";
      ServOrder."Plant Number" := "Plant Number";
      ServOrder."Cost Component Plant" := "Cost Component Plant";
      ServOrder."Alternative Plant Loc Address" := "Alternative Plant Loc Address";

      //db, 11-12-06: concession to Imtech because of transfer message-serv.order without filling planning dates
      IF ServOrder."Starting Date" = 0D THEN
        IF NOT "Vessel Service Call" THEN
          ServOrder."Starting Date" := ServOrder."Order Date"
        ELSE
          ServOrder."Starting Date" := ServOrder."First Possible Starting Date";

      IF ServOrder."Starting Time" = 0T THEN
        IF PlanningAgreement.GET("Planning Agreement Code") THEN
          ServOrder."Starting Time" := PlanningAgreement."Starting Time"
        ELSE
          ServOrder."Starting Time" := ServOrder."First Possible Starting Time";

      lvHumanResSetupRec.GET;

      IF ServOrder."First Possible Starting Date" = 0D THEN
        IF PlanningAgreement.GET("Planning Agreement Code") THEN BEGIN
          ServOrder."First Possible Starting Date" := ServOrder."Starting Date";
          ServOrder."First Possible Starting Time" := PlanningAgreement."Starting Time";

          ServOrder."Last Possible Ending Date" := ServOrder."Starting Date";
          ServOrder."Last Possible Ending Time" := PlanningAgreement."Ending Time";
        END;

      ServOrder."Limit Budget Labor" := "Limit Budget Labor";
      ServOrder."Limit Budget Hours" := "Limit Budget Hours";
      ServOrder."Limit Budget Material" := "Limit Budget Material";
      ServOrder."Limit Budget Total" := "Limit Budget Total";
      IF "Global Dimension 1 Code" <> '' THEN
        ServOrder.VALIDATE("Global Dimension 1 Code", "Global Dimension 1 Code");
      ServOrder.VALIDATE(Discipline, IDiscipline);
      ServOrder.VALIDATE("Trade Speciality", ITradeSpeciality);
      ServOrder."Order No. Customer" := "Order No. Customer";
      ServOrder.Problem := Problem; // don't use validate, this will add another line to problem text lines
      ServOrder.UpdateServAnalysisNotGlobDims;
      ServOrder."Customer Problem" := "Customer Problem";
      ServOrder.Cause := Cause;
      ServOrder.Solution := Solution;
      IF ("Service Contract No." <> '') AND ("Object No." <> '') THEN BEGIN
        ContractObject.GET("Service Contract No.", "Object No.");
        IF ServicePackage.GET(ContractObject."Service Package") THEN BEGIN
          IF ServicePackage."Service Package Call" <> '' THEN
            ServOrder.VALIDATE("Service Package", ServicePackage."Service Package Call")
          ELSE
            ServOrder.VALIDATE("Service Package", ServicePackage.Code);
        END;
      END;
      IF Subcontractor <> '' THEN
        ServOrder.VALIDATE(Subcontractor, Subcontractor);
      FillVesselFieldsOfServiceOrder(ServOrder);
      ServOrder.CheckDurationOnInitServOrder;  //db, 08-08-13: C007836
      IF ("Service Location Type" <> '') OR ("Room (SUP)" <> '') OR ("Part (SUP)" <> '') THEN BEGIN
        ServOrder."Service Location Type" := "Service Location Type";
        ServOrder."Room (SUP)" := "Room (SUP)";
        ServOrder."Part (SUP)" := "Part (SUP)";
      END;
      ServOrder.VALIDATE("Service Cluster", "Service Cluster");
      ServOrder.VALIDATE("Service Cluster Seqn.", "Service Cluster Seqn.");
      ServOrder.MODIFY(TRUE);

      ServOrder.UpdateWorkOrder(FALSE);
      WorkOrder.SETCURRENTKEY("Source Company", "Source Type", "Source No.");
      WorkOrder.SETRANGE("Source Company", COMPANYNAME);
      WorkOrder.SETRANGE("Source Type", WorkOrder."Source Type"::ServiceOrder);
      WorkOrder.SETRANGE("Source No.", ServOrder."No.");
      WorkOrder.MODIFYALL("Plan during Clock Time", "Plan during Clock Time", FALSE);
      ServOrder.UpdateFromWorkOrder();
      IF DisciplineExists THEN BEGIN
        ResourceGroupWOP.SETCURRENTKEY(Type, Company, "Source No.");
        ResourceGroupWOP.SETRANGE(Type, ResourceGroupWOP.Type::Discipline);
        ResourceGroupWOP.SETRANGE(Company, COMPANYNAME);
        ResourceGroupWOP.SETRANGE("Source No.", IDiscipline);
        IF ResourceGroupWOP.FINDFIRST THEN BEGIN
          WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Employee);
          WorkOrder.MODIFYALL("Resource Group No.", ResourceGroupWOP."No.", FALSE);
          WorkOrder.SETRANGE("Resource Type");
        END;
      END;

      IF "Export to FSA" THEN BEGIN
        ServOrder.VALIDATE("Export to FSA", "Export to FSA");
        ServOrder.MODIFY(TRUE);
      END;

      IF ReferencePointModifiedByEmployee <> '' THEN
        DocumentReferencePoint.SetModifiedByEmployee(ReferencePointModifiedByEmployee);
      DocumentReferencePoint.InsertDocRefPointSOCallIntake(ServOrder."No.");  //db, 13-08-15: C023471
      RefPeriodRec.UpdateNorm(RefPeriodRec.Type::ServOrder, ServOrder."No.");

      GET("No.");  //db, 15-08-06 (after change in serv.order message status can be updated)

      "Next Step" := "Next Step"::ServiceOrder;
      "Service Order No." := ServOrder."No.";
      Status := Status::"In Process";
      MODIFY;

      ServOrderExtension.GetServOrderExtension(ServOrder."No.");
      ServOrderExtension."Warranty found at" := "Warranty found at";
      IF "Master Company" <> '' THEN
        ServOrderExtension.VALIDATE("Master Company", "Master Company");
      IF "Master Project" <> '' THEN
        ServOrderExtension.VALIDATE("Master Project", "Master Project");
      IF "Master Element" <> '' THEN
        ServOrderExtension.VALIDATE("Master Element", "Master Element");
      IF "Service Location Struct. No." <> 0 THEN
        ServOrderExtension.VALIDATE("Service Location Struct. No.", "Service Location Struct. No.");
      IF "Service Loc. Struct. Line No." <> '' THEN
        ServOrderExtension.VALIDATE("Service Loc. Struct. Line No.", "Service Loc. Struct. Line No.");
      ServOrderExtension.UpdateServOrderExtension(ServOrder."No.");

      CopyServText;
      CopyPlantPartToServiceOrder(ServOrder, "Plant Part");

      IF "Object No." <> '' THEN BEGIN
        ServiceOrderObject.INIT;
        ServiceOrderObject.VALIDATE("Service Order No.", ServOrder."No.");
        ServiceOrderObject.VALIDATE("Object No.", "Object No.");
        ServiceOrderObject.VALIDATE("Service Contract No.", ServOrder."Service Contract No.");
        ServiceOrderObject.Source := ServiceOrderObject.Source::Calls;
        ServiceOrderObject.INSERT(TRUE);
      END;

      IF "Publish on Subcontr. Portal" THEN BEGIN
        WorkOrder.SETRANGE("Resource Type", WorkOrder."Resource Type"::Subcontractor);
        WorkOrder.SETRANGE("Resource No.", Subcontractor);
        IF WorkOrder.FINDFIRST THEN BEGIN
          WorkOrder.VALIDATE("Publish on Subcontr. Portal", "Publish on Subcontr. Portal");
          WorkOrder.MODIFY(TRUE);
        END;
      END;

      ServLogRec.StoreChange(
        1, "No.", STRSUBSTNO(Text002, TABLECAPTION, "No.", FIELDCAPTION("Service Order No."), "Service Order No."));

      LinkDocumentsToServiceOrder(ServOrder);
      LinkServiceOrderToTryoutSuccessor;
    END;

    PROCEDURE InsertSalesHeader@1(SalesHeader2@1100528401 : Record 36);
    VAR
      SalesHeader@1210190000 : Record 36;
      SalesHeaderExtension@1100528400 : Record 11071868;
      SalespersonPurchaser@1100525000 : Record 13;
    BEGIN
      SalesHeader."Document Type" := SalesHeader2."Document Type";
      SalesHeader."No." := '';
      SalesHeader.INSERT(TRUE);

      SalesHeader.VALIDATE("Sell-to Customer No.", "Customer No.");
      IF ("Vessel Service Call") AND
         (Name <> '') AND
         (Name <>  SalesHeader."Sell-to Customer Name")
      THEN //Name 2 is not present on Vessel Service Call (Object) card.
        SalesHeader."Sell-to Customer Name 2" := Name;
      SalesHeader."Sell-to Address" := Address;
      SalesHeader."Sell-to Post Code" := "Post Code";
      SalesHeader."Sell-to City" := City;
      SalesHeader."Sell-to Contact" := "Contact Name";
      IF "Bill-to Customer No." <> '' THEN
        SalesHeader.VALIDATE("Bill-to Customer No.", "Bill-to Customer No.");
      IF "Alternative Bill-to Address" <> '' THEN
        SalesHeader.VALIDATE("Alternative Bill-to Address", "Alternative Bill-to Address");
      SalesHeader."Posting Description" := Description;
      SalesHeader."Ship-to Name" := Name;
      SalesHeader."Ship-to Address" := Address;
      SalesHeader."Ship-to Post Code" := "Post Code";
      SalesHeader."Ship-to City" := City;
      SalesHeader."Ship-to County" := County;
      SalesHeader."Ship-to Country/Region Code" := "Country/Region Code";

      SalesHeader."Ship-to Contact" := "Contact Name";
      IF SalesHeader2."Salesperson Code" <> '' THEN
        SalesHeader.VALIDATE("Salesperson Code", SalesHeader2."Salesperson Code")
      ELSE
        IF SalespersonPurchaser.GET("Assigned to") THEN
          SalesHeader.VALIDATE("Salesperson Code", "Assigned to");
      SalesHeader."Service Call No." := "No.";
      SalesHeader."Your Reference" := "Your Reference";
      IF "Global Dimension 1 Code" <> '' THEN
        SalesHeader.VALIDATE("Shortcut Dimension 1 Code", "Global Dimension 1 Code");
      IF SalesHeader2."Requested Delivery Date" <> 0D THEN
        SalesHeader.VALIDATE("Requested Delivery Date", SalesHeader2."Requested Delivery Date");
      SalesHeader."Shipping Advice" := SalesHeader2."Shipping Advice";
      IF SalesHeader2."Ship-to Code" <> '' THEN
        SalesHeader.VALIDATE("Ship-to Code", SalesHeader2."Ship-to Code");
      SalesHeader.MODIFY;

      TESTFIELD("Customer No.");
      "Sales Document No." := SalesHeader."No.";
      Status := Status::"In Process";
      MODIFY;

      SalesHeaderExtension.GetSalesHeadExtension(SalesHeader."Document Type", SalesHeader."No.");
      SalesHeaderExtension."Service Location No." := "Service Location No.";
      SalesHeaderExtension.UpdateSalesHeadExtension(SalesHeader."Document Type", SalesHeader."No.");

      ServLogRec.StoreChange(
        1,"No.",STRSUBSTNO(Text002, TABLECAPTION, "No.", FIELDCAPTION("Sales Document No."), "Sales Document No."));
    END;

    PROCEDURE InsertSalesOrderLine@1100528400();
    VAR
      SalesLine@1100528401 : Record 37;
      ServiceObject@1100528402 : Record 11071691;
    BEGIN
      SalesLine."Document Type" := SalesLine."Document Type"::Order;
      SalesLine."Document No." := "Sales Document No.";
      SalesLine."Line No." := GetLastSalesLineNo(SalesLine."Document Type", "Sales Document No.") + 10000;
      SalesLine."Service Location No." := "Service Location No.";
      IF "Object No." <> '' THEN BEGIN
        ServiceObject.GET("Object No.");
        SalesLine.VALIDATE("Object No.", "Object No.");
        SalesLine."Service Warranty Code" := ServiceObject."Warranty Code Customer";
      END;
      IF "Global Dimension 1 Code" <> '' THEN
        SalesLine.VALIDATE("Shortcut Dimension 1 Code", "Global Dimension 1 Code");
      SalesLine.INSERT(TRUE);
    END;

    LOCAL PROCEDURE GetLastSalesLineNo@1100528402(DocumentType@1100528400 : Integer;DocumentNo@1100528402 : Code[20]) : Integer;
    VAR
      SalesLine@1100528401 : Record 37;
    BEGIN
      SalesLine.SETRANGE("Document Type", DocumentType);
      SalesLine.SETRANGE("Document No.", DocumentNo);
      IF SalesLine.FINDLAST THEN
        EXIT(SalesLine."Line No.");
    END;

    PROCEDURE CreateProject@1100485000();
    VAR
      ProjSetup@1100485002 : Record 315;
      ProjRec@1100485000 : Record 11072003;
      ProjCustRec@1100485001 : Record 11012005;
    BEGIN
      ProjSetup.GET;

      ProjRec.INIT;
      ProjRec."No." := '';
      ProjRec."Small Project" := ("Next Step" = "Next Step"::SmallProject);
      IF ProjRec."Small Project" THEN
        ProjRec."No. Series" := ProjSetup."Small Project Nos."
      ELSE
        ProjRec."No. Series" := ProjSetup."Job Nos.";
      IF CheckSeries(ProjRec."No. Series") THEN BEGIN
        ProjRec.AssistEdit(ProjRec);
        IF ProjRec."No." = '' THEN EXIT;
      END;
      ProjRec.VALIDATE(Description, Description);
      ProjRec.INSERT(TRUE);

      IF "Customer No." <> '' THEN BEGIN
        ProjCustRec.INIT;
        ProjCustRec."Project No." := ProjRec."No.";
        ProjCustRec.VALIDATE(Principal, "Customer No.");
        IF "Bill-to Customer No." = "Customer No." THEN
          IF "Alternative Bill-to Address" <> '' THEN
            ProjCustRec.VALIDATE("Alternative Bill-to Address", "Alternative Bill-to Address");
        ProjCustRec.INSERT(TRUE);
        ProjRec.VALIDATE("Bill-to Customer No.", "Customer No.");
      END;

      ProjRec.Address := Address;
      //ProjRec."Address 2" := "Address 2";
      ProjRec.City := City;
      ProjRec."Post Code" := "Post Code";
      //ProjRec.County := County;
      //ProjRec."Country Code":= "Country Code";
      ProjRec.Contact := "Contact Name";
      ProjRec."Phone No." := "Phone No.";
      //ProjRec."Phone No. 2" := "Phone No. 2";
      ProjRec."Mobile Phone No." := "Mobile Phone No.";
      ProjRec."Fax No." := "Fax No.";
      //ProjRec."E-Mail" := "E-Mail";
      ProjRec."Territory Code" := "Territory Code";
      ProjRec.MODIFY;

      "Project (Dest)" := ProjRec."No.";
      Status := Status::"In Process";
      MODIFY;

      ServLogRec.StoreChange(1, "No.", STRSUBSTNO(Text002, TABLECAPTION, "No.", ProjRec.TABLECAPTION, "Project (Dest)"));
    END;

    PROCEDURE DetermineLimitBudget@1210190012();
    BEGIN
      ServSetup.GET;
      IF NOT ServContrRec.GET("Service Contract No.") THEN ServContrRec.INIT;
      IF NOT ServLocRec.GET("Service Location No.") THEN ServLocRec.INIT;

      "Limit Budget Hours" := ServContrRec."Limit Budget Hours";
      "Limit Budget Labor" := ServContrRec."Limit Budget Labor";
      "Limit Budget Material" := ServContrRec."Limit Budget Material";
      "Limit Budget Total" := ServContrRec."Limit Budget Total";

      IF "Limit Budget Labor" < 0 THEN "Limit Budget Labor" := 0;
      IF "Limit Budget Hours" < 0 THEN "Limit Budget Hours" := 0;
      IF "Limit Budget Material" < 0 THEN "Limit Budget Material" := 0;

      IF (ServContrRec."Limit Budget Labor" + ServContrRec."Limit Budget Material" = ServContrRec."Limit Budget Total") THEN
        "Limit Budget Total" := "Limit Budget Labor" + "Limit Budget Material";
      VALIDATE("Limit Budget Total");
    END;

    LOCAL PROCEDURE DetermineLimitBudgetExceeded@1100528606();
    VAR
      LimitBudgetManagement@1100528600 : Codeunit 11012878;
    BEGIN
      LimitBudgetManagement.UpdateServiceCallLimitBudgetExceeded(Rec);
    END;

    PROCEDURE CheckParentChildCall@1210190011();
    VAR
      lvCallRec@1210190000 : Record 11012822;
      lvCall@1210190002 : Code[20];
    BEGIN
      lvCall := "Previous Call No.";
      WHILE lvCall <> '' DO BEGIN
        IF "No." = lvCall THEN
          ERROR(Text007);
        IF NOT lvCallRec.GET(lvCall) THEN EXIT;
        lvCall := lvCallRec."Previous Call No.";
      END;
    END;

    PROCEDURE DisconnectChain@1100485003();
    VAR
      lvCallRec@1100485000 : Record 11012822;
      lvCallRec2@1100485001 : Record 11012822;
    BEGIN
      lvCallRec.SETCURRENTKEY("Previous Call No.");
      lvCallRec.SETRANGE("Previous Call No.", "No.");
      IF lvCallRec.FINDSET THEN BEGIN
        REPEAT
          lvCallRec2 := lvCallRec;
          lvCallRec2."Previous Call No." := "Previous Call No.";
          lvCallRec2.MODIFY;
        UNTIL lvCallRec.NEXT = 0;
      END;
    END;

    PROCEDURE ShowNextCall@1210190015(lvAction@1210190001 : Integer) : Text[30];
    VAR
      lvCallRec@1210190000 : Record 11012822;
      lvCount@1210190002 : Integer;
    BEGIN
      //0=display; 1=lookup

      lvCallRec.SETCURRENTKEY("Previous Call No.");
      IF "No." <> '' THEN BEGIN
        lvCallRec.SETRANGE("Previous Call No.", "No.");
        lvCount := lvCallRec.COUNT;
      END;
      IF lvCount = 0 THEN EXIT('');

      IF lvAction = 0 THEN BEGIN
        IF lvCount = 1 THEN BEGIN
          lvCallRec.FINDFIRST;
          EXIT(lvCallRec."No.");
        END ELSE BEGIN
          EXIT(STRSUBSTNO('[%1]', lvCount));
        END;
      END ELSE BEGIN
        lvCallRec.FINDFIRST;
        REPEAT
          lvCallRec.MARK := TRUE;
        UNTIL lvCallRec.NEXT = 0;
        lvCallRec.MARKEDONLY(TRUE);
        PAGE.RUNMODAL(PAGE::"Service Call List", lvCallRec);
      END;
    END;

    PROCEDURE CheckDimension@1100485015();
    BEGIN
      IF ServLocRec.GET("Service Location No.") THEN
        IF ServLocRec."Global Dimension 1 Code" <> '' THEN
          VALIDATE("Global Dimension 1 Code", ServLocRec."Global Dimension 1 Code");
    END;

    PROCEDURE CheckDepartment@1100485002();
    VAR
      lvDepFound@1100485000 : Boolean;
      lvText000@1100525000 : TextConst 'ENU=%1 %2 not allowed.;NOR=%1 %2 ikke tillatt;SVE=%1 %2 Ñr inte tillÜtna.';
    BEGIN
      //db, 22-09-09: M16458
      IF "Global Dimension 1 Code" = '' THEN
        EXIT;

      IF "Service Contract No." = '' THEN
        EXIT;

      lvDepFound := FALSE;
      IF "Service Contract No." <> '' THEN BEGIN
        ServContrRec.GET("Service Contract No.");
        IF ("Global Dimension 1 Code" = ServContrRec."Global Dimension 1 Code") THEN BEGIN
          lvDepFound := TRUE;
        END ELSE BEGIN
          ServDepRec.SETRANGE("Service Contract No.", "Service Contract No.");
          IF ServDepRec.FINDSET THEN BEGIN
            REPEAT
              IF "Global Dimension 1 Code" = ServDepRec."Global Dimension 1 Code" THEN
                lvDepFound := TRUE;
            UNTIL ServDepRec.NEXT = 0;
          END;
        END;
      END;
      IF lvDepFound = FALSE THEN BEGIN
        IF "Service Location No." <> '' THEN BEGIN
          ServLocRec.GET("Service Location No.");
          IF ("Global Dimension 1 Code" = ServLocRec."Global Dimension 1 Code") THEN
            lvDepFound := TRUE;
        END;
      END;
      IF lvDepFound = FALSE THEN BEGIN
        IF "Customer No." <> '' THEN BEGIN
          CustRec.GET("Customer No.");
          IF "Global Dimension 1 Code" = CustRec."Global Dimension 1 Code" THEN
            lvDepFound := TRUE;
        END;
      END;

      IF lvDepFound = FALSE THEN ERROR(lvText000, FIELDCAPTION("Global Dimension 1 Code"), "Global Dimension 1 Code");
    END;

    PROCEDURE CheckConsignment@1100485006();
    VAR
      lvConsTimeRec@1100485000 : Record 11012864;
      lvConsRosterRec@1100485002 : Record 11012865;
      Resource@1100529000 : Record 11229278;
      ActiveWatch@1100485003 : Text[30];
    BEGIN
      CheckValidateWatch := TRUE;
      ActiveWatch := CheckAvailableWatches;
      CheckValidateWatch := FALSE;

      IF ActiveWatch <> '[1]' THEN BEGIN
        Watch := '';  //db: first empty watch; otherwise will be determined again from Consignment Roster at validation of employee
        IF ActiveWatch <> '' THEN  //db: watch already determined in CheckAvailableWatches
          VALIDATE("Employee No.", '');   //db, 30-08-10: M22460
        EXIT;
      END;

      IF CheckConsignmentTime(lvConsTimeRec) THEN BEGIN
          lvConsRosterRec.SETRANGE("Watch Code", Watch);  //db: watch already determined in CheckAvailableWatches
          lvConsRosterRec.SETRANGE("Consignment Code", lvConsTimeRec."Consignment Code");
          lvConsRosterRec.SETRANGE("Start Date", lvConsTimeRec."Start Date");
          lvConsRosterRec.SETRANGE("Start Time", lvConsTimeRec."Start Time");
          IF lvConsRosterRec.FINDFIRST THEN BEGIN
            //VALIDATE("Employee No.", lvConsRosterRec."Employee No.");  //db, 30-08-10: M22460   //DP00465.o
            //DP00465.sn
            Resource.SETCURRENTKEY(Type, Company, "Source No.");
            Resource.SETRANGE(Type, Resource.Type::Employee);
            Resource.SETRANGE(Company, COMPANYNAME);
            Resource.SETRANGE("Source No.", lvConsRosterRec."Employee No.");
            IF Resource.FINDFIRST THEN BEGIN
              VALIDATE("Employee No.", Resource."No.");
            //DP00465.en
              IF Resource."Active in FSA" THEN
                VALIDATE("Export to FSA", TRUE);  //db, 11-03-08: M11327
              "Plan during Clock Time" := TRUE;  //db, 15-06-11: M24526
            END;
          END;
      //END;
      END;
    END;

    PROCEDURE CheckConsignmentTime@1100485004(VAR VarConsTimeRec@1100485006 : Record 11012864) : Boolean;
    VAR
      lvConsRec@1100485004 : Record 11012863;
      lvConsTimeRec@1100485000 : Record 11012864;
      CheckDT@1100485001 : DateTime;
      StartDT@1100485002 : DateTime;
      EndDT@1100485003 : DateTime;
    BEGIN
      IF "Receiving Date" = 0D THEN BEGIN
        "Receiving Date":= WORKDATE;
        "Receiving Time":= TIME;
      END;

      CheckDT := CREATEDATETIME("Receiving Date", "Receiving Time");
      lvConsTimeRec.SETFILTER("Start Date", '..%1', "Receiving Date");
      lvConsTimeRec.SETFILTER("End Date", '%1..', "Receiving Date");
      IF lvConsTimeRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          StartDT := CREATEDATETIME(lvConsTimeRec."Start Date", lvConsTimeRec."Start Time");
          EndDT := CREATEDATETIME(lvConsTimeRec."End Date", lvConsTimeRec."End Time");
          IF (CheckDT > StartDT) AND (CheckDT < EndDT) THEN BEGIN
            IF lvConsRec.GET(lvConsTimeRec."Consignment Code") THEN BEGIN
              IF lvConsRec.CheckTerritoryAndDepartment("Territory Code", "Global Dimension 1 Code") THEN BEGIN
                VarConsTimeRec := lvConsTimeRec;
                EXIT(TRUE);
              END;
            END;
          END;
        UNTIL lvConsTimeRec.NEXT = 0;
      END;

      EXIT(FALSE);
    END;

    PROCEDURE CheckSeries@1100485007(lvSeries@1100485000 : Code[20]) : Boolean;
    VAR
      SerieRel@1210190000 : Record 310;
    BEGIN
      SerieRel.SETRANGE(Code, lvSeries);

      EXIT(SerieRel.FINDFIRST);
    END;

    PROCEDURE AssistEditWatch@1100485014(Lookup@1100485000 : Boolean);
    VAR
      TmpWatchRec@1210190000 : TEMPORARY Record 11012861;
      WatchRec@1100485002 : Record 11012861;
      WatchFrm@1100485003 : Page 11020352;
    BEGIN
      IF WatchRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          WatchRec.MARK := WatchRec.CheckFilters("Territory Code", "Global Dimension 1 Code", Discipline, "Trade Speciality");
          CheckMarkLocationWatch(WatchRec,TmpWatchRec);
        UNTIL WatchRec.NEXT = 0;
      END;

      IF ContrPrioRec.GET("Service Contract No.", Priority) THEN
        IF ContrPrioRec."Deactivate Consignment" THEN
          WatchRec.CLEARMARKS;  //db, 12-10-09: M16190

      CheckTmpWatch(WatchRec,TmpWatchRec);

      WatchRec.MARKEDONLY := TRUE;
      IF Lookup THEN BEGIN
        CurrFieldNo := FIELDNO(Watch);  //db, 28-06-11 (needed for validate Watch to activate AssisEditEmployee)
        CLEAR(WatchFrm);
        WatchFrm.LOOKUPMODE(TRUE);
        WatchFrm.EDITABLE(FALSE);
        WatchFrm.SETTABLEVIEW(WatchRec);
        IF WatchRec.GET(Watch) THEN
          WatchFrm.SETRECORD(WatchRec);
        IF WatchFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          WatchFrm.GETRECORD(WatchRec);
          VALIDATE(Watch, WatchRec.Code);
        END;
      END ELSE BEGIN
        WatchRec.SETFILTER(Code, Watch);  //db, 16-05-11
        IF WatchRec.FINDFIRST THEN BEGIN
          Watch := WatchRec.Code;
        END ELSE BEGIN
          ERROR(Text011, Watch, FIELDCAPTION(Watch));
        END;
      END;
    END;

    PROCEDURE AssistEditPriority@1100485010();
    VAR
      ServicePriority@1100528800 : Record 11012829;
      ServiceCallInfoMgt@1100528801 : Codeunit 11012855;
    BEGIN
      ServiceCallInfoMgt.GetServicePriorityDS(
        "Service Contract No.",
        "Customer No.",
        Discipline,
        "Trade Speciality",
        Priority,
        ServicePriority);

      IF PAGE.RUNMODAL(0, ServicePriority) = ACTION::LookupOK THEN
        VALIDATE(Priority, ServicePriority.Code);
    END;

    PROCEDURE AssistEditDiscipline@1100485009();
    VAR
      ContrDiscRec@1100485002 : Record 11012881;
      LocDiscRec@1100485005 : Record 11012844;
      DiscRec@1100485001 : Record 11020204;
      ContrRec@1100525000 : Record 11012812;
    BEGIN
      IF "Service Contract No." <> '' THEN BEGIN
        ContrDiscRec.SETRANGE("Service Contract No.", "Service Contract No.");
        ContrDiscRec.SETFILTER(Discipline, '<>%1', '');
        IF ContrDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF NOT ContrRec.GET(ContrDiscRec."Service Contract No.") THEN ContrRec.INIT;  //db, 24-10-13: C008633
            IF (ContrRec.Blocked = FALSE) AND (ContrRec.Status <> ContrRec.Status::Expired) THEN BEGIN
              IF DiscRec.GET(ContrDiscRec.Discipline) THEN
                DiscRec.MARK := TRUE;
            END;
          UNTIL ContrDiscRec.NEXT = 0;
          DiscRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Service Location No." <> '' THEN BEGIN
        LocDiscRec.SETRANGE("Service Location No.", "Service Location No.");
        LocDiscRec.SETFILTER(Discipline, '<>%1', '');
        IF LocDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF DiscRec.GET(LocDiscRec.Discipline) THEN
              DiscRec.MARK := TRUE;
          UNTIL LocDiscRec.NEXT = 0;
          DiscRec.MARKEDONLY(TRUE);
        END;
      END;

      IF Discipline <> '' THEN
        DiscRec.GET(Discipline);

      IF PAGE.RUNMODAL(0, DiscRec) = ACTION::LookupOK THEN
        VALIDATE(Discipline, DiscRec.Code);
    END;

    PROCEDURE AssistEditTradeSpeciality@1100485028();
    VAR
      TradeSpecRec@1100485003 : Record 11020285;
      ContrDiscRec@1100485004 : Record 11012881;
      LocDiscRec@1100485005 : Record 11012844;
      ContrRec@1100525000 : Record 11012812;
    BEGIN
      IF "Service Contract No." <> '' THEN BEGIN
        ContrDiscRec.SETRANGE("Service Contract No.", "Service Contract No.");
        IF Discipline <> '' THEN  //db, 27-03-09: M13480
          ContrDiscRec.SETRANGE(Discipline, Discipline);
        ContrDiscRec.SETFILTER("Trade Speciality", '<>%1', '');
        IF ContrDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF NOT ContrRec.GET(ContrDiscRec."Service Contract No.") THEN ContrRec.INIT; //db, 24-10-13: C008633
            IF (ContrRec.Blocked = FALSE) AND (ContrRec.Status <> ContrRec.Status::Expired) THEN BEGIN
              IF TradeSpecRec.GET(ContrDiscRec.Discipline, ContrDiscRec."Trade Speciality") THEN
                TradeSpecRec.MARK := TRUE;
            END;
          UNTIL ContrDiscRec.NEXT = 0;
          TradeSpecRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Service Location No." <> '' THEN BEGIN
        LocDiscRec.SETRANGE("Service Location No.", "Service Location No.");
        IF Discipline <> '' THEN  //db, 27-03-09: M13480
          LocDiscRec.SETRANGE(Discipline, Discipline);
        LocDiscRec.SETFILTER("Trade Speciality", '<>%1', '');
        IF LocDiscRec.FINDSET THEN BEGIN
          REPEAT
            IF TradeSpecRec.GET(LocDiscRec.Discipline, LocDiscRec."Trade Speciality") THEN
              TradeSpecRec.MARK := TRUE;
          UNTIL LocDiscRec.NEXT = 0;
          TradeSpecRec.MARKEDONLY(TRUE);
        END;
      END;

      IF "Trade Speciality" <> '' THEN
        TradeSpecRec.GET(Discipline, "Trade Speciality");

      IF Discipline <> '' THEN  //db, 27-03-09: M13480
        TradeSpecRec.SETRANGE(Discipline, Discipline);

      IF PAGE.RUNMODAL(0, TradeSpecRec) = ACTION::LookupOK THEN
        VALIDATE("Trade Speciality", TradeSpecRec.Code);
    END;

    PROCEDURE AssistEditDimension1@1100485021();
    VAR
      ContrDimRec@1100485002 : Record 11012809;
      DimValRec@1100485001 : Record 349;
    BEGIN
      DimValRec.SETRANGE("Global Dimension No.", 1);

      IF "Service Contract No." <> '' THEN BEGIN
        ServContrRec.GET("Service Contract No.");
        DimValRec.SETFILTER(Code, '%1|%2', ServContrRec."Global Dimension 1 Code", ServContrRec."Department Code (Other)");
        IF DimValRec.FINDSET THEN BEGIN
          REPEAT
            DimValRec.MARK := TRUE;
          UNTIL DimValRec.NEXT = 0;
        END;

        ContrDimRec.SETRANGE("Service Contract No.", "Service Contract No.");
        ContrDimRec.SETFILTER("Global Dimension 1 Code", '<>%1', '');
        IF ContrDimRec.FINDSET THEN BEGIN
          REPEAT
            DimValRec.SETRANGE(Code, ContrDimRec."Global Dimension 1 Code");
            IF DimValRec.FINDSET THEN
              DimValRec.MARK := TRUE;
          UNTIL ContrDimRec.NEXT = 0;
          DimValRec.MARKEDONLY(TRUE);
        END;
        DimValRec.SETRANGE(Code);
      END;

      IF "Global Dimension 1 Code" <> '' THEN
        DimMgt.GetDimValueRec(1, "Global Dimension 1 Code", DimValRec, TRUE,'');

      IF PAGE.RUNMODAL(0, DimValRec) = ACTION::LookupOK THEN
        VALIDATE("Global Dimension 1 Code", DimValRec.Code);
    END;

    PROCEDURE CheckContrDiscPrio@1100485011();
    VAR
      ContrDiscRec@1100485009 : Record 11012881;
      ContrPrioRec@1100485010 : Record 11012880;
    BEGIN
      //db, 04-06-08: M11937
      IF "Service Contract No." = '' THEN EXIT;

      ContrDiscRec.SETRANGE("Service Contract No.", "Service Contract No.");
      IF ContrDiscRec.COUNT = 1 THEN BEGIN
        ContrDiscRec.FINDFIRST;
        VALIDATE(Discipline, ContrDiscRec.Discipline);
      END;

      ContrPrioRec.SETRANGE("Service Contract No.", "Service Contract No.");
      IF ContrPrioRec.COUNT = 1 THEN BEGIN
        ContrPrioRec.FINDFIRST;
        VALIDATE(Priority, ContrPrioRec.Priority);
      END;
    END;

    PROCEDURE CheckUpdateDocRefPoint@1100485016(IUpdateMode@1100485000 : Code[1]);
    VAR
      lvDocRefPointRec@1100485001 : Record 11020296;
      lvServCallxRec@1100485002 : Record 11012822;
    BEGIN
      lvDocRefPointRec.SetModifiedByEmployee(ReferencePointModifiedByEmployee);
      CASE IUpdateMode OF
        'I':
          lvDocRefPointRec.InsertDocRefPoint(lvDocRefPointRec.Type::ServCall,"No.",Status,TODAY,TIME);
        'M':
          BEGIN
            IF lvServCallxRec.GET("No.") THEN BEGIN  //* Get old (so always call before change is saved!)
              IF (lvServCallxRec.Status <> Status) THEN
                lvDocRefPointRec.InsertDocRefPoint(lvDocRefPointRec.Type::ServCall,"No.",Status,TODAY,TIME);
            END;
          END;
      END;
    END;

    PROCEDURE UpdateNextDeadline@1100485012();
    VAR
      DateTimeMgt@1100485000 : Codeunit 11020218;
      RefLimit@1100485001 : Text[50];
      CurrDeadline@1100485002 : DateTime;
    BEGIN
      "Next Reference Period" := '';
      "Next Deadline" := 0DT;

      RefPeriodRec.SETRANGE(Type, RefPeriodRec.Type::ServCall);
      RefPeriodRec.SETRANGE("Document No.", "No.");
      IF RefPeriodRec.FINDSET THEN BEGIN
        REPEAT
          IF (RefPeriodRec.Norm <> 0) AND
             (RefPeriodRec."Starting Date" <> 0D) AND
             (RefPeriodRec."Starting Time" <> 0T) AND
             (RefPeriodRec."Ending Date" = 0D) AND
             (RefPeriodRec."Ending Time" = 0T) THEN BEGIN
            RefLimit := RefPeriodRec.CheckRefPeriod(1,RefPeriodRec.Type::ServCall,"No.",RefPeriodRec.Code,0);
            IF RefLimit <> '' THEN BEGIN
              CurrDeadline := DateTimeMgt.Text2Datetime(RefLimit);
              IF ("Next Deadline" = 0DT) OR (CurrDeadline <= "Next Deadline") THEN BEGIN
                "Next Deadline" := CurrDeadline;
                "Next Reference Period" := RefPeriodRec.Code;
              END;
            END;
          END;
        UNTIL RefPeriodRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckExpectedHours@1100485017(lvType@1100485000 : Integer;lvIndication@1100485001 : Code[10]);
    VAR
      ServIndicationRec@1100485002 : Record 11012837;
    BEGIN
      IF ServIndicationRec.GET(lvType, lvIndication) THEN
        IF ServIndicationRec."Expected Hours" <> 0 THEN
          VALIDATE("Expected Hours", ServIndicationRec."Expected Hours");
    END;

    PROCEDURE CheckAvailableWatches@1100485018() : Text[30];
    VAR
      TmpWatchRec@1210190000 : TEMPORARY Record 11012861;
      lvWatchRec@1100485001 : Record 11012861;
      lvConsTimeRec@1100485002 : Record 11012864;
      lvNumWatch@1100485000 : Integer;
      lvNumDefault@1100525000 : Integer;
    BEGIN
      //db, 12-05-09: M14956
      IF "No." = '' THEN EXIT('');
      IF ContrPrioRec.GET("Service Contract No.", Priority) THEN
        IF ContrPrioRec."Deactivate Consignment" THEN EXIT('');  //db, 12-10-09: M16190
      IF NOT CheckConsignmentTime(lvConsTimeRec) THEN EXIT('');

      IF NOT ServLocRec.GET("Service Location No.") THEN ServLocRec.INIT;  //db, 30-05-11

      lvWatchRec.RESET;
      IF lvWatchRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          IF lvWatchRec.Code = ServLocRec.Watch THEN BEGIN
            lvWatchRec.MARK := TRUE;
            //db.sn (23-06-11: M28003-attachment2)
            lvWatchRec.Default := TRUE;
            CheckMarkLocationWatch(lvWatchRec,TmpWatchRec);
            //db.en (23-06-11: M28003-attachment2)
          END ELSE BEGIN
            lvWatchRec.MARK := lvWatchRec.CheckFilters("Territory Code", "Global Dimension 1 Code", Discipline, "Trade Speciality");
            CheckMarkLocationWatch(lvWatchRec,TmpWatchRec);
          END;
        UNTIL lvWatchRec.NEXT = 0;
      END;

      CheckTmpWatch(lvWatchRec,TmpWatchRec);

      lvWatchRec.MARKEDONLY(TRUE);
      lvNumWatch := lvWatchRec.COUNT;
      //db.sn (23-06-11: M28003-attachment2)
      IF CheckValidateWatch = TRUE THEN BEGIN
        lvWatchRec.SETRANGE(Default, TRUE);
        lvNumDefault := lvWatchRec.COUNT;
        IF lvNumDefault = 1 THEN
          lvNumWatch := 1
        ELSE
          lvWatchRec.SETRANGE(Default);
        IF ServLocRec.Watch <> '' THEN BEGIN
          lvWatchRec.SETRANGE(Code, ServLocRec.Watch);
          lvWatchRec.SETRANGE(Default);
          lvNumWatch := 1;  //available watch reset by CheckValidateWatch=false
        END;
        IF lvWatchRec.FINDFIRST THEN BEGIN
          Watch := lvWatchRec.Code;
        END;
      END;
      //db.en (23-06-11: M28003-attachment2)

      IF lvNumWatch = 0 THEN
        EXIT('')
      ELSE
        EXIT(STRSUBSTNO('[%1]', lvNumWatch));
    END;

    PROCEDURE LookupPreviousCall@1100485013();
    VAR
      ServCallRec@1100485000 : Record 11012822;
    BEGIN
      IF "Previous Call No." <> '' THEN
        ServCallRec.GET("Previous Call No.");
      ServCallRec.SETFILTER("No.", '<>%1', "No.");
      IF "Customer No." <> '' THEN
        ServCallRec.SETRANGE("Customer No.", "Customer No.");
      IF "Service Contract No." <> '' THEN
        ServCallRec.SETRANGE("Service Contract No.", "Service Contract No.");
      IF "Service Location No." <> '' THEN
        ServCallRec.SETRANGE("Service Location No.", "Service Location No.");
      IF PAGE.RUNMODAL(PAGE::"Service Call List", ServCallRec) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Previous Call No.", ServCallRec."No.");
      END;
    END;

    PROCEDURE CheckDeactivateConsignment@1100485022();
    VAR
      lvPrioRec@1100485003 : Record 11012829;
      lvContrPrioRec@1100485001 : Record 11012880;
      lvConsTimeRec@1100485000 : Record 11012864;
      lvDeactivate@1100485002 : Boolean;
    BEGIN
      IF CheckConsignmentTime(lvConsTimeRec) THEN BEGIN
        IF lvContrPrioRec.GET("Service Contract No.", Priority) THEN BEGIN
          lvDeactivate := lvContrPrioRec."Deactivate Consignment";
        END ELSE BEGIN
          IF lvPrioRec.GET(Priority) THEN  //db, 05-12-12: allow clear field
            lvDeactivate := lvPrioRec."Deactivate Consignment";
        END;
        IF lvDeactivate THEN BEGIN
          IF Watch <> '' THEN BEGIN
            Watch := '';
            VALIDATE("Employee No.", '');   //db, 30-08-10: M22460
          END;
        END ELSE BEGIN
          IF Watch = '' THEN
            CheckConsignment;
        END;
      END;
    END;

    PROCEDURE CopyServText@1100485026();
    VAR
      TextRec@1100485000 : Record 11012882;
      TextRec2@1100485001 : Record 11012882;
    BEGIN
      TextRec.SETRANGE("Table Name", TextRec."Table Name"::"Service Call");
      TextRec.SETRANGE("No.", "No.");
      IF TextRec.FINDSET THEN BEGIN
        REPEAT
          TextRec2.COPY(TextRec);
          TextRec2."Table Name" := TextRec."Table Name"::"Service Order";
          IF TextRec."Table Field" = 60 THEN
            TextRec2."Table Field" := 90;
          IF TextRec."Table Field" = 70 THEN
            TextRec2."Table Field" := 91;
          IF TextRec."Table Field" = 75 THEN
            TextRec2."Table Field" := 92;
          TextRec2."No." := "Service Order No.";
          TextRec2.INSERT;
        UNTIL TextRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckDateOutOfUse@1100485024() StartDate : Date;
    BEGIN
      IF "Expected Date" <> 0D THEN
        StartDate := "Expected Date"
      ELSE
        StartDate := "Receiving Date";

      IF StartDate = 0D THEN
        StartDate := TODAY;  //db, 16-11-09: M16603

      EXIT(StartDate);
    END;

    PROCEDURE CheckAvailableDim1@1100485027() : Text[30];
    VAR
      ContrDimRec@1100485001 : Record 11012809;
      DimValRec@1100485000 : Record 349;
      NumDim1@1100485002 : Integer;
    BEGIN
      DimValRec.SETRANGE("Global Dimension No.", 1);

      IF "Service Contract No." <> '' THEN BEGIN
        ServContrRec.GET("Service Contract No.");
        DimValRec.SETFILTER(Code, '%1|%2', ServContrRec."Global Dimension 1 Code", ServContrRec."Department Code (Other)");
        IF DimValRec.FINDSET THEN BEGIN
          REPEAT
            DimValRec.MARK := TRUE;
          UNTIL DimValRec.NEXT = 0;
        END;

        ContrDimRec.SETRANGE("Service Contract No.", "Service Contract No.");
        ContrDimRec.SETFILTER("Global Dimension 1 Code", '<>%1', '');
        IF ContrDimRec.FINDSET THEN BEGIN
          REPEAT
            DimValRec.SETRANGE(Code, ContrDimRec."Global Dimension 1 Code");
            IF DimValRec.FINDSET THEN
              DimValRec.MARK := TRUE;
          UNTIL ContrDimRec.NEXT = 0;
        END;
        DimValRec.SETRANGE(Code);
        DimValRec.MARKEDONLY(TRUE);
        NumDim1 := DimValRec.COUNT;
      END;

      IF NumDim1 = 0 THEN
        EXIT('')
      ELSE
        EXIT(STRSUBSTNO('[%1]', NumDim1));
    END;

    PROCEDURE DrillDownActualRefPoint@1100525000();
    VAR
      DocumentReferencePointsFRM@1100485000 : Page 11020345;
    BEGIN
      DocumentReferencePointsFRM.SetServiceCallNo("No.");
      DocumentReferencePointsFRM.EDITABLE(FALSE);
      DocumentReferencePointsFRM.RUNMODAL;
    END;

    PROCEDURE CheckCreditLimit@1100525001();
    VAR
      SalesSetup@1100525000 : Record 311;
    BEGIN
      //db, 31-10-08: M13190
      SalesSetup.GET;
      IF SalesSetup."Credit Warnings" = SalesSetup."Credit Warnings"::"No Warning" THEN
        EXIT;
    END;

    PROCEDURE ActivateCreditLimit@1100525033(lvAction@1100525001 : Integer) ShowWarning : Boolean;
    VAR
      CreditLimitFrm@1100525000 : Page 343;
    BEGIN
      //db, 16-12-10: M23068
      ShowWarning := CreditLimitFrm.ServiceOrderShowWarning("Bill-to Customer No.");
      IF lvAction = 1 THEN
        CreditLimitFrm.RUNMODAL;
      EXIT(ShowWarning);
    END;

    PROCEDURE CheckOrderNoCustomer@1100525004();
    VAR
      lvCallRec@1100525000 : Record 11012822;
      lvText000@1100525001 : TextConst 'ENU=%1 %2 of %3 %4 also assigned to %5 %6;NOR=%1 %2 av %3 %4 ogsÜ tilordnet %5 %6;SVE=%1 %2 av %3 %4 Ñven tilldelade till %5 %6';
    BEGIN
      //db, 16-11-09: M13354
      IF ("Order No. Customer" = '') OR ("Customer No." = '') THEN EXIT;

      lvCallRec.SETCURRENTKEY("Customer No.");
      lvCallRec.SETRANGE("Customer No.", "Customer No.");
      lvCallRec.SETRANGE("Order No. Customer", "Order No. Customer");
      lvCallRec.SETFILTER("No.", '<>%1', "No.");
      IF lvCallRec.FINDFIRST THEN BEGIN
        IF "Previous Call No." = '' THEN
          MESSAGE(lvText000,  //db, 11-03-11: M25256 (error->message)
            FIELDCAPTION("Order No. Customer"), "Order No. Customer",
            FIELDCAPTION("Customer No."), "Customer No.",
            lvCallRec.TABLECAPTION, lvCallRec."No.");
      END;
    END;

    PROCEDURE CopyServCall@1100525005();
    VAR
      lvText000@1100525002 : TextConst 'ENU="Service Contract is expired; continue ?";NOR=Servicekontrakt er utgÜtt, fortsette?;SVE=Servicekontraktet har gÜtt ut. Vill du fortsÑtta?';
      lvText001@1100525001 : TextConst 'ENU="Customer is blocked; continue ?";NOR=Kunde er blokkert, fortsette?;SVE=Kunden Ñr spÑrrd.Vill du fortsÑtta?';
      lvText002@1100525000 : TextConst 'ENU="%1 is out of use; continue ?";NOR=%1 er ikke i bruk, fortsette?;SVE="%1 kan inte anvÑndas; fortsÑtta?"';
      CallRec@1100525008 : Record 11012822;
      ServContrRec@1100525007 : Record 11012812;
      ServLocRec@1100525006 : Record 11012801;
      CustRec@1100525003 : Record 18;
      CommLineRec@1100525012 : Record 97;
      CommLineRec2@1100525011 : Record 97;
      ServTextRec@1100525010 : Record 11012882;
      ServTextRec2@1100525009 : Record 11012882;
    BEGIN
      //db, 18-12-09
      IF ServContrRec.GET("Service Contract No.") THEN BEGIN
        IF ServContrRec.Status = ServContrRec.Status::Closed THEN
          ServContrRec.FIELDERROR(Status);
        IF ServContrRec.Status = ServContrRec.Status::Expired THEN
          IF CONFIRM(lvText000, FALSE) = FALSE THEN EXIT;
      END;

      IF CustRec.GET("Bill-to Customer No.") THEN
        IF CustRec.Blocked <> CustRec.Blocked::" " THEN
          IF CONFIRM(lvText001, FALSE) = FALSE THEN EXIT;

      IF ServLocRec.GET("Service Location No.") THEN
        IF (ServLocRec."Date Out of Use" <> 0D) THEN
          IF CONFIRM(lvText002, FALSE, ServLocRec.TABLECAPTION) = FALSE THEN EXIT;

      CallRec.COPY(Rec);
      CallRec."No." := '';
      CallRec.INSERT(TRUE);
      CallRec.VALIDATE("Global Dimension 1 Code", "Global Dimension 1 Code");  //db, 27-03-09: M12680
      CallRec."Previous Call No." := "No.";
      CallRec.MODIFY;

      CommLineRec.SETRANGE("Table Name", CommLineRec."Table Name"::"Service Call");  //db, 18-12-09: M16647
      CommLineRec.SETRANGE("No.", "No.");
      IF CommLineRec.FINDSET THEN BEGIN
        REPEAT
          CommLineRec2.COPY(CommLineRec);
          CommLineRec2."No." := CallRec."No.";
          CommLineRec2.INSERT;
        UNTIL CommLineRec.NEXT = 0;
      END;

      ServTextRec.SETRANGE("Table Name", ServTextRec."Table Name"::"Service Call");  //db, 18-12-09: M16647
      ServTextRec.SETRANGE("No.", "No.");
      IF ServTextRec.FINDSET THEN BEGIN
        REPEAT
          ServTextRec2.COPY(ServTextRec);
          ServTextRec2."No." := CallRec."No.";
          ServTextRec2.INSERT;
        UNTIL ServTextRec.NEXT = 0;
      END;


      //db.sn, 01-08-13: C007416
      //DP00465.so  No employee by call anymore (also now no resource by call)
      //EmployeeRec.SETRANGE(Type, EmployeeRec.Type::Call);
      //EmployeeRec.SETRANGE("No.", "No.");
      //IF EmployeeRec.FINDSET THEN BEGIN
      //  REPEAT
      //    EmployeeRec2.COPY(EmployeeRec);
      //    EmployeeRec2."No." := CallRec."No.";
      //    EmployeeRec2."Date/Time Export to FSA" := 0DT;
      //    EmployeeRec2."Export to FSA" := FALSE;
      //    EmployeeRec2."Actual Service Status" := '';
      //    EmployeeRec2."Actual Reference Point" := 0;
      //    EmployeeRec2."Starting Date" := 0D;
      //    EmployeeRec2."Starting Time" := 0T;
      //    EmployeeRec2."Ending Date" := 0D;
      //    EmployeeRec2."Ending Time" := 0T;
      //    EmployeeRec2.INSERT;
      //  UNTIL EmployeeRec.NEXT = 0;
      //END;
      //db.en, 01-08-13: C007416

      Rec := CallRec;
    END;

    PROCEDURE DisplayMap@1100525007();
    VAR
      MapPoint@1001 : Record 800;
      MapMgt@1000 : Codeunit 802;
    BEGIN
      IF MapPoint.FIND('-') THEN
        MapMgt.MakeSelection(DATABASE::"Service Call",GETPOSITION)
      ELSE
        MESSAGE(Text013);
    END;

    PROCEDURE CheckContractStatus@1100525024(ServContrRec@1100525001 : Record 11012812);
    VAR
      OrderDate@1100525000 : Date;
    BEGIN
      //db, 10-06-10: M19644, M19645
      ServContrRec.TESTFIELD(Blocked, FALSE);
      IF ServContrRec.Status < ServContrRec.Status::Order THEN
        ERROR(Text004b, ServContrRec."No.", ServContrRec.Status);
      IF "Receiving Date" = 0D THEN
        OrderDate:= WORKDATE
      ELSE
        OrderDate := "Receiving Date";
      IF OrderDate < ServContrRec."Starting Date" THEN
        MESSAGE(Text004a, ServContrRec."No.", ServContrRec."Starting Date", FIELDCAPTION("Receiving Date"));
      IF ServContrRec."Expiring Date" <> 0D THEN BEGIN
        IF ServContrRec."Expiring Date" < OrderDate THEN
          ERROR(Text004, ServContrRec."No.", ServContrRec."Expiring Date");
        //IF ServContrRec."Ending Date" >= ServContrRec."Expiring Date" THEN
        //  MESSAGE(Text004, ServContrRec."No.", ServContrRec."Expiring Date");  //db, 30-12-10: M21843
      END;
    END;

    PROCEDURE CheckMarkLocationWatch@1210190006(VAR WatchRec@1210190000 : Record 11012861;VAR TmpWatchRec@1210190001 : TEMPORARY Record 11012861);
    BEGIN
      IF (WatchRec.MARK) AND (WatchRec."Location Watch") THEN BEGIN
        IF NOT ServLocRec.GET("Service Location No.") THEN ServLocRec.INIT;
        IF ServLocRec.Watch <> WatchRec.Code THEN
          //IF ServLocRec.Watch <> '' THEN  //??
          WatchRec.MARK := FALSE;
      END;

      //check if match discipline+Trade Speciality is compleet
      IF (WatchRec.MARK) THEN BEGIN
        IF (Discipline <> '') AND (WatchRec."Discipline Filter" <> '') AND
           ("Trade Speciality" <> '') AND (WatchRec."Trade Speciality Filter" <> '') THEN BEGIN
           TmpWatchRec := WatchRec;
           IF TmpWatchRec.INSERT THEN;
        END;
      END;
    END;

    PROCEDURE CheckTmpWatch@1210190013(VAR WatchRec@1210190000 : Record 11012861;VAR TmpWatchRec@1210190001 : TEMPORARY Record 11012861);
    BEGIN
      IF TmpWatchRec.FINDSET THEN BEGIN
        WatchRec.CLEARMARKS;
        REPEAT
          WatchRec := TmpWatchRec;
          WatchRec.MARK := TRUE;
        UNTIL TmpWatchRec.NEXT = 0;
        TmpWatchRec.DELETEALL;
      END;
    END;

    LOCAL PROCEDURE FillVesselFieldsOfServiceOrder@1210190010(VAR ServiceOrder@1210190000 : Record 11012823);
    VAR
      ServiceOrderExtension@1210190001 : Record 11071727;
    BEGIN
      //kkleermaker, 110816, m28689
      IF ("Vessel No." = '') AND
         ("Vessel Name" = '') AND
         ("Agent No." = '') AND
         (Port = '') AND
         ("Quay Berth" = '')
      THEN EXIT;

      ServiceOrder."Vessel No." := "Vessel No.";
      ServiceOrder."First Possible Starting Date" := "First Possible Starting Date"; //kkleermaker.n, 110816, m28691
      ServiceOrder."First Possible Starting Time" := "First Possible Starting Time"; //kkleermaker.n, 110816, m28691
      ServiceOrder."Last Possible Ending Date" := "Last Possible Ending Date";
      ServiceOrder."Last Possible Ending Time" := "Last Possible Ending Time";

      IF NOT ServiceOrderExtension.GET(ServiceOrder."No.") THEN ServiceOrderExtension.INIT;
      ServiceOrderExtension."Vessel Name" := "Vessel Name";
      ServiceOrderExtension."Agent No." := "Agent No.";
      ServiceOrderExtension.Port := Port;
      ServiceOrderExtension."Quay Berth" := "Quay Berth";
      ServiceOrderExtension.UpdateServOrderExtension(ServiceOrder."No.");
    END;

    LOCAL PROCEDURE UpdateVessel@1210190019();
    VAR
      Vessel@1210190000 : Record 11071737;
    BEGIN
      //kkleermaker, 110817, M28697
      IF "Service Location No." <> xRec."Service Location No." THEN
        IF Vessel.GET("Service Location No.") THEN BEGIN
          "Vessel No." := Vessel."No.";
          "Vessel Name" := Vessel.Name;
        END ELSE BEGIN
          "Vessel No." := '';
          "Vessel Name" := '';
        END
    END;

    PROCEDURE DPA_SetDefaultDpmtFromNoSeries@1100000995(xRecRef@1100525002 : RecordRef);
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      xRecRef.SETTABLE(xRec);
      DPA_Management.SetDepartmentCodeNoSeries(
        TABLENAME,
        "Global Dimension 1 Code",
        "No. Series",
        xRec."No. Series" );
    END;

    LOCAL PROCEDURE DPA_OnInsert@1100000991();
    VAR
      Dimension1Code@1100528400 : Code[20];
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      Dimension1Code :=
        DPA_Management.GetNoSeriesDepartmentCode(
          "No. Series",
          xRec."No. Series",
          DATABASE::"Service Call");
      IF Dimension1Code <> '' THEN
        "Global Dimension 1 Code" := Dimension1Code;

      IF "Global Dimension 1 Code" <> '' THEN
        VALIDATE("Global Dimension 1 Code");
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012822) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012822');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Service Call", "Global Dimension 1 Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Global Dimension 1 Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Global Dimension 1 Code");
    END;

    PROCEDURE CheckPlanLimitDateTime@1100525021();
    BEGIN
      //db, 19-03-10: M18520
       IF ("First Possible Starting Date" = "Last Possible Ending Date") THEN
        IF ("First Possible Starting Time" <> 0T) AND ("Last Possible Ending Time" <> 0T) THEN
          IF ("First Possible Starting Time" > "Last Possible Ending Time") THEN
            FIELDERROR("First Possible Starting Time",STRSUBSTNO(Text000,FIELDCAPTION("Last Possible Ending Time")));
    END;

    PROCEDURE NormalizePostCodeHouseNo@1100526200();
    VAR
      ObjectImpWorkSheetMgt@1100526200 : Codeunit 11012839;
      PostCode@1100526201 : Code[20];
    BEGIN
      IF ObjectImpWorkSheetMgt.NormalizePostCode("Post Code", "Country/Region Code", PostCode) THEN
        "Post Code" := PostCode;
      "House No." := ObjectImpWorkSheetMgt.DetermineHouseNo(Address, "House No. Ext.");
    END;

    PROCEDURE GetObjectDescriptions@1100528600(VAR ODescription@1100528600 : Text[100];VAR ODescription2@1100528602 : Text[50]);
    VAR
      ServiceObject@1100528601 : Record 11071691;
    BEGIN
      ODescription := '';
      ODescription2 := '';
      IF "Object No." = '' THEN
        EXIT;

      IF ServiceObject.GET("Object No.") THEN BEGIN
        ODescription := ServiceObject.Description;
        ODescription2 := ServiceObject."Description 2";
      END;
    END;

    PROCEDURE SearchPlantLocation@1100529300() : Boolean;
    VAR
      PlantLocation@1100529300 : Record 11012554;
    BEGIN
      PlantLocation.CHANGECOMPANY("Plant Company");
      PlantLocation.SETCURRENTKEY("Post Code", "House No.", "House No. Ext.");
      IF PAGE.RUNMODAL(PAGE::"Plant Location Search", PlantLocation) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Plant Location", PlantLocation.Code);
        EXIT(TRUE);
      END;
    END;

    PROCEDURE SearchServiceLocation@1100528602() : Boolean;
    VAR
      ServiceLocation@1100528601 : Record 11012801;
    BEGIN
      ServiceLocation.SETCURRENTKEY("Post Code", "House No.", "House No. Ext.");
      IF PAGE.RUNMODAL(PAGE::"Find Service Location", ServiceLocation) = ACTION::LookupOK THEN BEGIN
      //  xRec := Rec;
      //  CurrFieldNo := FIELDNO("Service Location No.");
        VALIDATE("Service Location No.", ServiceLocation."No.");
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ActivateServCallCard@1210190014();
    VAR
      ServiceSetup@1100525000 : Record 11012800;
      ServiceCall@1100409000 : Record 11012822;
    BEGIN
      ServiceSetup.GET;
      ServiceCall := Rec;  //db, 28-09-12: C002699
      IF ServiceSetup."Page ID Call" <> 0 THEN
        PAGE.RUN(ServiceSetup."Page ID Call", ServiceCall)
      ELSE
        PAGE.RUN(PAGE::"Service Call", ServiceCall);
    END;

    PROCEDURE UpdateCustomerProblem@1210190016();
    VAR
      CustomerServiceAnalysis@1210190000 : Record 11071728;
    BEGIN
      IF ("Customer No." = '') OR (Problem = '') THEN
        EXIT;
      CustomerServiceAnalysis.SETRANGE("Analysis Type", CustomerServiceAnalysis."Analysis Type"::Problem);
      CustomerServiceAnalysis.SETRANGE("Customer No.", "Customer No.");
      CustomerServiceAnalysis.SETRANGE("Standard Analysis Code", Problem);
      IF CustomerServiceAnalysis.COUNT = 1 THEN BEGIN
        CustomerServiceAnalysis.FINDFIRST;
        VALIDATE("Customer Problem", CustomerServiceAnalysis.Code);
      END;
    END;

    PROCEDURE EditDocuments@1100528702(ContactNo@1210190003 : Code[20];ContactPersonNo@1210190004 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      DocumentTemplate@1210190001 : Record 11012401;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      DocumentMailing.EditDocuments(
        STRSUBSTNO('%1', DocumentTemplate.Type::"Service Order"), DocumentLinkRIDs,
        "Global Dimension 1 Code", ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE ShowTodos@1100528700();
    VAR
      To_do@1100528700 : Record 5080;
    BEGIN
      To_do.SETRANGE("Service Call No.", "No.");
      To_do.SETRANGE("System To-do Type", To_do."System To-do Type"::Organizer);
      PAGE.RUNMODAL(PAGE::"Task List", To_do);
    END;

    PROCEDURE FillSubcontractor@1100409000();
    VAR
      SubcontractorService@1100409000 : Record 11071789;
      ResourceWOP@1100528601 : Record 11229278;
      NewSubcontractorNo@1100528600 : Code[20];
    BEGIN
      NewSubcontractorNo :=
        SubcontractorService.GetSubcontractorResourceNo(
          "Service Contract No.", "Service Location No.", "Object No.", '', Discipline, "Trade Speciality");
      IF Subcontractor <> '' THEN
        IF GUIALLOWED THEN
          IF NOT CONFIRM(Text018, TRUE, FIELDCAPTION(Subcontractor), Subcontractor,
            ResourceWOP.GetResourceName(Subcontractor), NewSubcontractorNo, ResourceWOP.GetResourceName(NewSubcontractorNo))
          THEN
            EXIT;
      VALIDATE(Subcontractor, NewSubcontractorNo);
    END;

    PROCEDURE StartServCalls@1100409002(lvAction@1100485000 : Integer;lvCount@1100485001 : Boolean) : Integer;
    VAR
      lvServCallRec@1100485002 : Record 11012822;
      lvServOrderRec@1100525000 : Record 11012823;
    BEGIN
      //db, 31-12-12: moved from form to table, not yet integrated with same function of codeunit 11012825
      IF lvCount AND ("No." = '') THEN EXIT(0);  //C026680

      lvServCallRec.SETFILTER("No.", '<>%1', "No.");
      CASE lvAction OF
        0:
          BEGIN
            lvServCallRec.SETCURRENTKEY("Service Contract No.");
            lvServCallRec.SETRANGE("Service Contract No.", "Service Contract No.");
            IF (lvCount = TRUE) AND ("Service Contract No." = '') THEN EXIT(0);
          END;
        1:
          BEGIN
            lvServCallRec.SETCURRENTKEY("Service Location No.");
            lvServCallRec.SETRANGE("Service Location No.", "Service Location No.");
            IF (lvCount = TRUE) AND ("Service Location No." = '') THEN EXIT(0);
          END;
        2:
          BEGIN
            lvServOrderRec.SETCURRENTKEY("Call No.");
            lvServOrderRec.SETRANGE("Call No.", "No.");
            IF lvCount = FALSE THEN BEGIN
              PAGE.RUNMODAL(0, lvServOrderRec);
              EXIT;
            END ELSE BEGIN
              IF "Service Order No." = '' THEN
                EXIT(0)
              ELSE
                EXIT(lvServOrderRec.COUNT);
            END;
          END;
        3:
          BEGIN
            lvServCallRec.SETCURRENTKEY("Customer No.");
            lvServCallRec.SETRANGE("Customer No.", "Customer No.");
            IF (lvCount = TRUE) AND ("Customer No." = '') THEN EXIT(0);
          END;
        4:
          BEGIN
            lvServCallRec.SETCURRENTKEY("Object No.");
            lvServCallRec.SETRANGE("Object No.", "Object No.");
            IF (lvCount = TRUE) AND ("Object No." = '') THEN EXIT(0);
          END;

      END;

      IF lvCount = FALSE THEN BEGIN
        PAGE.RUNMODAL(0, lvServCallRec);
      END ELSE BEGIN
        EXIT(lvServCallRec.COUNT);
      END;
    END;

    LOCAL PROCEDURE LinkDocumentsToServiceOrder@1100409006(IServiceOrder@1100409001 : Record 11012823);
    VAR
      DocumentProperties@1100409004 : Record 11012746;
      DocumentLinkManagement@1100409002 : Codeunit 11012401;
      ServiceCallRecRef@1100409006 : RecordRef;
      ServiceOrderRecRef@1100409005 : RecordRef;
      DocLinkRID@1100409003 : ARRAY [5] OF RecordID;
    BEGIN
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DocumentProperties) THEN
        EXIT;
      ServiceCallRecRef.GETTABLE(Rec);
      ServiceOrderRecRef.GETTABLE(IServiceOrder);
      DocLinkRID[2] := ServiceOrderRecRef.RECORDID; // Don't use as Source (> 1)
      DocumentLinkManagement.GetDocuments(DocumentProperties, ServiceCallRecRef);
      DocumentProperties.MARKEDONLY(TRUE);
      IF DocumentProperties.FINDSET THEN
        REPEAT
          DocumentLinkManagement.CreateDocumentLink(DocumentProperties, DocLinkRID);
        UNTIL DocumentProperties.NEXT = 0;
    END;

    LOCAL PROCEDURE DetermineContractNo@1100528603();
    VAR
      ServiceLocationInfoMgt@1100528600 : Codeunit 11012856;
      ActualServiceContractNo@1100528601 : Code[20];
      ServiceSetup@1100528200 : Record 11012800;
    BEGIN
      ServiceSetup.GET;
      IF ("Service Location No." <> '') AND (ServiceSetup."Use Contract from Location") THEN BEGIN
        IF "Service Location No." <> '' THEN BEGIN
          ActualServiceContractNo := ServiceLocationInfoMgt.GetActualContractFromLocation("Service Location No.", "Object No.", TODAY);
          IF ActualServiceContractNo <> '' THEN
            VALIDATE("Service Contract No.", ActualServiceContractNo);
        END;
      END;
    END;

    PROCEDURE DetermineObjectNo@1100525009();
    VAR
      LocationServiceObject@1100525003 : Record 11071691;
      ServiceObject@1100525001 : Record 11071691;
      ServiceLocation@1100525000 : Record 11012801;
      ServiceContractObject@1100525002 : Record 11071702;
      ServiceContract@1100525005 : Record 11012812;
      FoundServiceObjectNo@1100525004 : Code[20];
    BEGIN
      IF "Service Contract No." <> '' THEN BEGIN
        ServiceContract.GET("Service Contract No.");
        ServiceContractObject.SETRANGE("Service Contract No.", "Service Contract No.");
        ServiceContractObject.SETRANGE(Blocked, FALSE);
        IF "Service Location No." <> '' THEN
          ServiceContractObject.SETRANGE("Service Location No.", "Service Location No.");
        IF ServiceContractObject.FINDFIRST THEN BEGIN
          IF ServiceContractObject.NEXT = 0 THEN
            FoundServiceObjectNo := ServiceContractObject."Service Object No."
          ELSE BEGIN
            IF ServiceLocation.GET("Service Location No.") THEN BEGIN
              ServiceLocation.GetRelatedObjects(LocationServiceObject);
              LocationServiceObject.SETRANGE(Blocked, FALSE);
              ServiceContractObject.FINDSET;
              ServiceObject.MARKEDONLY(TRUE);
              REPEAT
                LocationServiceObject.SETRANGE("No.", ServiceContractObject."Service Object No.");
                IF NOT LocationServiceObject.ISEMPTY THEN BEGIN
                  ServiceObject."No." := ServiceContractObject."Service Object No.";
                  ServiceObject.MARK(TRUE);
                END;
              UNTIL (ServiceObject.COUNT > 1) OR (ServiceContractObject.NEXT = 0);
              IF ServiceObject.FINDFIRST AND (ServiceObject.NEXT = 0) THEN
                FoundServiceObjectNo := ServiceObject."No.";
            END;
          END;
        END;
      END;
      IF (ServiceContract."Contract Form" <> ServiceContract."Contract Form"::"Framework Contract") AND
         (FoundServiceObjectNo = '') AND ("Service Location No." <> '')
      THEN BEGIN
        IF ServiceLocation.GET("Service Location No.") THEN BEGIN
          ServiceLocation.GetRelatedObjects(LocationServiceObject);
          LocationServiceObject.SETRANGE(Blocked, FALSE);
          IF LocationServiceObject.FINDFIRST AND (LocationServiceObject.NEXT = 0) THEN
            FoundServiceObjectNo := LocationServiceObject."No.";
        END;
      END;

      IF (FoundServiceObjectNo <> '') OR
         (ServiceContract."Contract Form" = ServiceContract."Contract Form"::"Framework Contract")
      THEN BEGIN
        CurrFieldNo := 0;
        VALIDATE("Object No.", FoundServiceObjectNo);
      END;
    END;

    PROCEDURE GetComplexCode@1100528629() : Code[20];
    VAR
      ServiceLocation@1100528600 : Record 11012801;
    BEGIN
      IF ServiceLocation.GET("Service Location No.") THEN
        EXIT(ServiceLocation.GetComplexCode);
    END;

    PROCEDURE SyncServiceLocationData@1100528637(IFieldNo@1100528600 : Integer);
    VAR
      ServiceSetup@1100528601 : Record 11012800;
      ServiceLocation@1100528602 : Record 11012801;
    BEGIN
      ServiceSetup.GET;
      IF NOT ServiceSetup."Sync. Location by Order/Call" THEN
        EXIT;
      IF NOT ServiceLocation.GET("Service Location No.") THEN
        EXIT;
      CASE IFieldNo OF
        FIELDNO(Name):
          ServiceLocation.VALIDATE(Description, Name);
        FIELDNO("Contact Name"):
          ServiceLocation.VALIDATE("Contact Name", "Contact Name");
        FIELDNO("Phone No."):
          BEGIN
            ServiceLocation.VALIDATE("Phone No.", "Phone No.");
            "Phone No." := ServiceLocation."Phone No.";
          END;
        FIELDNO("Phone No. 2"):
          BEGIN
            ServiceLocation.VALIDATE("Phone No. 2", "Phone No. 2");
            "Phone No. 2" := ServiceLocation."Phone No. 2";
          END;
        FIELDNO("Mobile Phone No."):
          BEGIN
            ServiceLocation.VALIDATE("Mobile Phone No.", "Mobile Phone No.");
            "Mobile Phone No." := ServiceLocation."Mobile Phone No.";
          END;
        FIELDNO("E-Mail"):
          ServiceLocation.VALIDATE("E-Mail", "E-Mail");
        FIELDNO("Fax No."):
          ServiceLocation.VALIDATE("Fax No.", "Fax No.");
        FIELDNO("Bill-to Contact Name"):
          ServiceLocation.VALIDATE("Bill-to Contact Name", "Bill-to Contact Name");
      ELSE
        EXIT;
      END;
      ServiceLocation.MODIFY(TRUE);
    END;

    PROCEDURE GetFilteredAnalysisOnProblem@1100409008(Problem@1100409000 : Code[10];AnalysisType@1100409003 : Option;VAR ServiceAnalysis@1100409001 : Record 11012842);
    VAR
      ServiceAnalysisRelation@1100409002 : Record 11072199;
    BEGIN
      // dp00662
      ServiceAnalysisRelation.SETRANGE("Problem Code", Problem);
      ServiceAnalysisRelation.SETRANGE("Analysis Type", AnalysisType);
      IF ServiceAnalysisRelation.FINDSET THEN BEGIN
        REPEAT
          ServiceAnalysis."Analysis Type" := ServiceAnalysisRelation."Analysis Type";
          ServiceAnalysis.Code := ServiceAnalysisRelation."Analysis Code";
          ServiceAnalysis.MARK(TRUE);
        UNTIL ServiceAnalysisRelation.NEXT = 0;
        ServiceAnalysis.MARKEDONLY(TRUE);
      END;
    END;

    PROCEDURE GetFilteredProblemsOnDisciplines@1100409009(VAR ServiceAnalysis@1100409001 : Record 11012842);
    VAR
      Resource@1100409000 : Record 11229278;
      ServiceContractDiscipline@1100409004 : Record 11012881;
      ServiceLocationDiscipline@1100409003 : Record 11012844;
      ServiceAnalysisDiscipline@1100409002 : Record 11072198;
      DisciplineFilter@1100525000 : Text;
    BEGIN
      // dp00662
      IF NOT Resource.GET("Employee No.") THEN
        Resource.INIT;
      Resource.CALCFIELDS("Disciplines Exist");
      IF (Discipline <> '') OR Resource."Disciplines Exist" THEN BEGIN
         ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
         DisciplineFilter := Resource.GetDisciplineFilter;
         IF DisciplineFilter <> '' THEN
           DisciplineFilter += '|';
         IF Discipline <> '' THEN
           DisciplineFilter += Discipline
         ELSE
           DisciplineFilter += '''''';
         ServiceAnalysisDiscipline.SETFILTER(Discipline, DisciplineFilter);
         IF ServiceAnalysisDiscipline.FINDSET THEN BEGIN
           REPEAT
             IF ServiceAnalysis.GET(ServiceAnalysisDiscipline."Analysis Type", ServiceAnalysisDiscipline."Analysis Code") THEN BEGIN
               ServiceAnalysis.MARK(TRUE);
               ServiceAnalysis.MARKEDONLY(TRUE);
             END;
           UNTIL ServiceAnalysisDiscipline.NEXT = 0;
         END;
      END ELSE BEGIN
        IF "Service Contract No." <> '' THEN BEGIN
          ServiceContractDiscipline.SETRANGE("Service Contract No.", "Service Contract No.");
          IF ServiceContractDiscipline.FINDSET THEN BEGIN
            REPEAT
              ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
              ServiceAnalysisDiscipline.SETRANGE(Discipline, ServiceContractDiscipline.Discipline);
              IF ServiceAnalysisDiscipline.FINDSET THEN BEGIN
                REPEAT
                  IF ServiceAnalysis.GET(ServiceAnalysisDiscipline."Analysis Type", ServiceAnalysisDiscipline."Analysis Code") THEN BEGIN
                    ServiceAnalysis.MARK(TRUE);
                    ServiceAnalysis.MARKEDONLY(TRUE);
                  END;
                UNTIL ServiceAnalysisDiscipline.NEXT = 0;
              END;
            UNTIL ServiceContractDiscipline.NEXT = 0;
          END;
        END;

        IF "Service Location No." <> '' THEN BEGIN
          ServiceLocationDiscipline.SETRANGE("Service Location No.", "Service Location No.");
          IF ServiceLocationDiscipline.FINDSET THEN BEGIN
            REPEAT
              ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
              ServiceAnalysisDiscipline.SETRANGE(Discipline, ServiceLocationDiscipline.Discipline);
              IF ServiceAnalysisDiscipline.FINDSET THEN BEGIN
                REPEAT
                  IF ServiceAnalysis.GET(ServiceAnalysisDiscipline."Analysis Type", ServiceAnalysisDiscipline."Analysis Code") THEN BEGIN
                    ServiceAnalysis.MARK(TRUE);
                    ServiceAnalysis.MARKEDONLY(TRUE);
                  END;
                UNTIL ServiceAnalysisDiscipline.NEXT = 0;
              END;
            UNTIL ServiceLocationDiscipline.NEXT = 0;
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE GetFilteredProblemsOnSUP@1100528653(VAR ServiceAnalysis@1100528600 : Record 11012842);
    VAR
      ServiceLocationTypeRoom@1100528601 : Record 11072281;
      SUPRoomPart@1100528602 : Record 11072282;
      SUPPartServiceAnalysis@1100528603 : Record 11072283;
      ServiceAnalysis2@1100525003 : Record 11012842;
      ServiceUnitPriceManagement@1100525001 : Codeunit 11012846;
      CustomerNo@1100525000 : Code[20];
      Skip@1100525002 : Boolean;
    BEGIN
      IF ("Room (SUP)" = '') AND ("Part (SUP)" = '') THEN
        EXIT;
      CustomerNo := "Customer No.";
      IF NOT ServiceUnitPriceManagement.CustomerHasCustomizations(CustomerNo) THEN
        CustomerNo := '';

      ServiceLocationTypeRoom.SETRANGE("Customer No.", CustomerNo);
      IF "Service Location Type" <> '' THEN
        ServiceLocationTypeRoom.SETRANGE("Service Location Type", "Service Location Type");
      SUPRoomPart.SETRANGE("Customer No.", CustomerNo);
      IF "Room (SUP)" <> '' THEN
        SUPRoomPart.SETRANGE("Room (SUP)", "Room (SUP)");
      IF "Part (SUP)" <> '' THEN
        SUPRoomPart.SETRANGE("Part (SUP)", "Part (SUP)");
      IF SUPRoomPart.FINDSET THEN
        REPEAT
          Skip := FALSE;
          IF "Service Location Type" <> '' THEN BEGIN
            ServiceLocationTypeRoom.SETRANGE("Room (SUP)", SUPRoomPart."Room (SUP)");
            Skip := ServiceLocationTypeRoom.ISEMPTY;
          END;
          IF NOT Skip THEN BEGIN
            SUPPartServiceAnalysis.SETRANGE("Customer No.", CustomerNo);
            SUPPartServiceAnalysis.SETRANGE("Part (SUP)", SUPRoomPart."Part (SUP)");
            IF SUPPartServiceAnalysis.FINDSET THEN
              REPEAT
                ServiceAnalysis.SETRANGE("Analysis Type", SUPPartServiceAnalysis."Analysis Type");
                ServiceAnalysis.SETRANGE(Code, SUPPartServiceAnalysis."Analysis Code");
                IF NOT ServiceAnalysis.ISEMPTY THEN BEGIN // Already marked, mark also in second record
                  ServiceAnalysis2."Analysis Type" := SUPPartServiceAnalysis."Analysis Type";
                  ServiceAnalysis2.Code := SUPPartServiceAnalysis."Analysis Code";
                  ServiceAnalysis2.MARK(TRUE);
                END;
                ServiceAnalysis.SETRANGE("Analysis Type");
                ServiceAnalysis.SETRANGE(Code);
              UNTIL SUPPartServiceAnalysis.NEXT = 0;
          END;
        UNTIL SUPRoomPart.NEXT = 0;
      ServiceAnalysis.COPY(ServiceAnalysis2);
      ServiceAnalysis.MARKEDONLY(TRUE);
    END;

    PROCEDURE SetUseFilledOrderDateTime@1100525003(IUseOrderDateTime@1100485000 : Boolean);
    BEGIN
      //C022644
      gUseFilledOrderDateTime := IUseOrderDateTime;
    END;

    PROCEDURE DetermineBilltoCustomerbySC@1100528623();
    VAR
      SCCustSourceTypeSetup@1100528600 : Record 11071800;
      ServiceContract@1100528601 : Record 11012812;
      ServiceLocation@1100528602 : Record 11012801;
      ShiptoAddress@1100528500 : Record 222;
    BEGIN
      //C022970
      IF "Service Contract No." = '' THEN
        EXIT;
      IF NOT ServiceContract.GET("Service Contract No.") THEN
        EXIT;
      IF ("Service Location No." <> '') AND
         SCCustSourceTypeSetup.GET(SCCustSourceTypeSetup.Type::Contract, "Service Contract No.", SCCustSourceTypeSetup."Source Type"::Call) AND
         (SCCustSourceTypeSetup."Bill-to" = SCCustSourceTypeSetup."Bill-to"::"Service Location")
      THEN BEGIN
        IF ServiceLocation.GET("Service Location No.") THEN BEGIN
          IF ServiceLocation."Bill-to Customer No." <> '' THEN BEGIN
            VALIDATE("Bill-to Customer No.", ServiceLocation."Bill-to Customer No.");
            IF ServiceLocation."Alternative Bill-to Address" <> '' THEN
              VALIDATE("Alternative Bill-to Address", ServiceLocation."Alternative Bill-to Address")
          END ELSE
            IF ServiceLocation."Customer No." <> '' THEN BEGIN
              VALIDATE("Bill-to Customer No.", ServiceLocation."Customer No.");
              //
              ShiptoAddress.SETRANGE("Customer No.", ServiceLocation."Customer No.");
              ShiptoAddress.SETRANGE(Code,ServiceLocation."Address Code");
              ShiptoAddress.SETRANGE("Billing Address", TRUE);
              IF ShiptoAddress.FINDFIRST THEN
              //
                VALIDATE("Alternative Bill-to Address", ServiceLocation."Address Code");
            END;
          IF ServiceLocation."Bill-to Contact Name" <> '' THEN
            "Bill-to Contact Name" := ServiceLocation."Bill-to Contact Name";
        END;
      END ELSE BEGIN
        IF ServiceContract."Bill-to Customer No. (CP)" <> '' THEN BEGIN
          VALIDATE("Bill-to Customer No.", ServiceContract."Bill-to Customer No. (CP)");
          VALIDATE("Alternative Bill-to Address", ServiceContract."Alt. Bill-to Address (CP)");
        END;
      END;
      CheckInvoiceAddress;
    END;

    PROCEDURE FillPreferredEmployee@1100528650();
    VAR
      PreferredEmployee@1100528600 : Record 11012843;
      ResourceWOP@1100528604 : Record 11229278;
      DummyOption@1100528602 : Option;
      Origin@1100528601 : ' ,Call,Service Order';
      NewPreferredEmployeeNo@1100528603 : Code[20];
    BEGIN
      NewPreferredEmployeeNo :=
        PreferredEmployee.GetPreferredEmployee(
          "Service Contract No.", "Service Location No.", "Object No.", '', '', Discipline, "Trade Speciality", "Expected Date", DummyOption, Origin::Call);
      IF "Preferred Employee No." <> '' THEN
        IF GUIALLOWED THEN
          IF NOT CONFIRM(Text018, TRUE, FIELDCAPTION("Preferred Employee No."), "Preferred Employee No.",
            ResourceWOP.GetResourceName("Preferred Employee No."), NewPreferredEmployeeNo, ResourceWOP.GetResourceName(NewPreferredEmployeeNo))
          THEN
            EXIT;
      VALIDATE("Preferred Employee No.", NewPreferredEmployeeNo);
    END;

    LOCAL PROCEDURE ApplyProblemCodeAdditionalInfo@1100528652();
    VAR
      ServiceAnalysis@1100528600 : Record 11012842;
      ServiceAnalysisDiscipline@1100528601 : Record 11072198;
    BEGIN
      IF Problem <> '' THEN BEGIN
        IF ServiceAnalysis.GET(ServiceAnalysis."Analysis Type"::Problem, Problem) THEN BEGIN
          IF ServiceAnalysis.Priority <> '' THEN
            VALIDATE(Priority, ServiceAnalysis.Priority);
          IF ServiceAnalysis."Expected Hours" <> 0 THEN
            VALIDATE("Expected Hours", ServiceAnalysis."Expected Hours");
          ServiceAnalysisDiscipline.SETRANGE("Analysis Type", ServiceAnalysisDiscipline."Analysis Type"::Problem);
          ServiceAnalysisDiscipline.SETRANGE("Analysis Code", Problem);
          IF ServiceAnalysisDiscipline.FINDSET THEN
            IF ServiceAnalysisDiscipline.NEXT = 0 THEN
              VALIDATE(Discipline, ServiceAnalysisDiscipline.Discipline);
        END;
      END ELSE
        VALIDATE(Discipline, '');
    END;

    PROCEDURE InsertServiceText@1100528608(IAnalysisType@1100528600 : 'Problem,Cause,Solution';IAnalysisCode@1100528601 : Code[10];ITableFieldNo@1100528602 : Integer);
    VAR
      ServiceText@1100528603 : Record 11012882;
      ServiceAnalysis@1100528606 : Record 11012842;
    BEGIN
      //IF SkipUpdateServiceText THEN EXIT;

      IF IAnalysisCode = '' THEN EXIT;

      ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Call");
      ServiceText.SETRANGE("No.", "No.");
      ServiceText.SETRANGE("Table Field", ITableFieldNo);
      IF NOT ServiceText.ISEMPTY THEN
        EXIT;

      IF ServiceAnalysis.GET(IAnalysisType, IAnalysisCode) THEN BEGIN
        ServiceText."Table Name" := ServiceText."Table Name"::"Service Call";
        ServiceText."No." := "No.";
        ServiceText."Table Field" := ITableFieldNo;
        ServiceText."Line No." := 10000;
        ServiceText.Date := TODAY;
        ServiceText."Time Created" := TIME;
        ServiceText."Created DateTime" := CREATEDATETIME(ServiceText.Date, ServiceText."Time Created");
        ServiceText.Comment := ServiceAnalysis.Description;
        ServiceText."Active in FSA" := ServiceText.GetDefaultValueOfActiveInFSA;
        ServiceText.INSERT(TRUE);
      END;
    END;

    PROCEDURE GetRoomDescription@1100525047() : Text[50];
    VAR
      SUPRoom@1100525000 : Record 11071950;
      ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
      CustomerNo@1100528601 : Code[20];
    BEGIN
      IF ServiceUnitPriceManagement.CustomerHasCustomizations("Customer No.") THEN
        CustomerNo := "Customer No.";
      IF SUPRoom.GET(CustomerNo, "Room (SUP)") THEN
        EXIT(SUPRoom.Description);
    END;

    PROCEDURE GetPartDescription@1100525048() : Text[50];
    VAR
      SUPPart@1100525000 : Record 11071951;
      ServiceUnitPriceManagement@1100528600 : Codeunit 11012846;
      CustomerNo@1100528601 : Code[20];
    BEGIN
      IF ServiceUnitPriceManagement.CustomerHasCustomizations("Customer No.") THEN
        CustomerNo := "Customer No.";
      IF SUPPart.GET(CustomerNo, "Part (SUP)") THEN
        EXIT(SUPPart.Description);
    END;

    PROCEDURE NotifyUsersOnNewServPortCall@1100528604();
    VAR
      ServPortUserstoNotify@1100528600 : Record 11126068;
      RecordLinkManagement@1100528603 : Codeunit 447;
      ServiceCallPage@1100528604 : Page 11125208;
      RecRef@1100528602 : RecordRef;
    BEGIN
      IF Origin <> Origin::"4PS Service Portal" THEN
        EXIT;
      IF "No." = '' THEN
        EXIT;
      IF "Customer No." = '' THEN
        EXIT;
      ServPortUserstoNotify.SETRANGE("Customer No.", "Customer No.");
      IF ServPortUserstoNotify.FINDSET THEN BEGIN
        SetLanguage;
        REPEAT
          RecRef.GETTABLE(Rec);
          IF UserSetup.GET(ServPortUserstoNotify."User ID") THEN
            RecordLinkManagement.CreateNote(RecRef, ServiceCallPage.OBJECTID(FALSE), STRSUBSTNO(Text017, "No."), UserSetup."User ID");
        UNTIL ServPortUserstoNotify.NEXT = 0;
        RestoreLanguage;
      END;
    END;

    LOCAL PROCEDURE SetLanguage@1100525006();
    VAR
      UserPersonalization@1100525000 : Record 2000000073;
    BEGIN
      CurrentGlobalLanguage := GLOBALLANGUAGE;
      IF UserPersonalization.GET(USERSECURITYID) THEN
        IF UserPersonalization."Language ID" <> 0 THEN
          GLOBALLANGUAGE(UserPersonalization."Language ID");
    END;

    LOCAL PROCEDURE RestoreLanguage@1100525012();
    BEGIN
      IF CurrentGlobalLanguage <> 0 THEN
        GLOBALLANGUAGE(CurrentGlobalLanguage);
    END;

    LOCAL PROCEDURE DetermineMasterProject@1100528605();
    VAR
      ServiceLocation@1100528600 : Record 11012801;
    BEGIN
      IF "Service Location No." = '' THEN
        EXIT;
      IF ServiceLocation.GET("Service Location No.") THEN BEGIN
        IF (ServiceLocation."Warranty Expires On" = 0D) OR (ServiceLocation."Warranty Expires On" > TODAY) THEN
          IF ServiceLocation."Warranty Project No." <> '' THEN BEGIN
            "Master Company" := '';
            VALIDATE("Master Project", ServiceLocation."Warranty Project No.");
            IF ServiceLocation."Warranty Element No" <> '' THEN
              VALIDATE("Master Element", ServiceLocation."Warranty Element No");
        END;
      END;
    END;

    PROCEDURE CheckCompanyIC@1100528200();
    VAR
      lvCompName@1210190027 : Text[50];
    BEGIN
      IF "Master Company" <> '' THEN
        lvCompName := "Master Company"
      ELSE
        lvCompName := COMPANYNAME;

      MasterProjRec.CHANGECOMPANY(lvCompName);
      MasterProjElemRec.CHANGECOMPANY(lvCompName);
    END;

    PROCEDURE OnLookupJobNo@1100528203(EditableMode@1100525000 : Boolean);
    VAR
      PageNo@1100525001 : Integer;
    BEGIN
      CheckCompanyIC;
      MasterProjRec."No." := "Master Project";
      IF RefersToOtherCompany THEN
        PageNo := PAGE::"Job List IC";
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(PageNo, MasterProjRec)
      ELSE BEGIN
        IF PAGE.RUNMODAL(PageNo, MasterProjRec) = ACTION::LookupOK THEN
          VALIDATE("Master Project", MasterProjRec."No.");
      END;
    END;

    PROCEDURE RefersToOtherCompany@1100525008() : Boolean;
    BEGIN
      EXIT(("Master Company" <> '') AND ("Master Company" <> COMPANYNAME));
    END;

    LOCAL PROCEDURE DetermineTenantID@1100528607();
    VAR
      ServiceLocation@1100528600 : Record 11012801;
    BEGIN
      IF NOT ServiceLocation.GET("Service Location No.") THEN
        ServiceLocation.INIT;
      VALIDATE("Tenant No.", ServiceLocation."Tenant No.");
    END;

    LOCAL PROCEDURE DetermineAlternativeBilltoAddress@1100528663();
    VAR
      ShiptoAddress@1100528600 : Record 222;
    BEGIN
      IF ShiptoAddress.GetAlternativeBilltoAddress("Bill-to Customer No.", ShiptoAddress.Code) THEN
        VALIDATE("Alternative Bill-to Address", ShiptoAddress.Code);
    END;

    LOCAL PROCEDURE DetermineServiceType@1100409003(VAR OServiceTypeFromSCSourceType@1100529400 : Boolean);
    VAR
      SCCustSourceTypeSetup@1100409001 : Record 11071800;
      ServiceSourceTypeSetup@1100409003 : Record 11071726;
      ServiceType@1100409004 : Code[20];
      Level@1100409006 : Integer;
    BEGIN
      IF ServiceType = '' THEN BEGIN
        IF "Service Contract No." = '' THEN
          Level += 1;
        IF (Level = 1) AND ("Customer No." = '') THEN
          Level += 1;
        REPEAT
          CASE Level OF
            0:
              BEGIN
                IF SCCustSourceTypeSetup.GET(SCCustSourceTypeSetup.Type::Contract, "Service Contract No.", 0) THEN BEGIN
                  ServiceType :=  SCCustSourceTypeSetup."Service Type";
                  OServiceTypeFromSCSourceType := TRUE;
                END;
              END;
            1:
              BEGIN
                IF SCCustSourceTypeSetup.GET(SCCustSourceTypeSetup.Type::Customer, "Bill-to Customer No.", 0) THEN BEGIN
                  IF ServiceType = '' THEN
                    ServiceType :=  SCCustSourceTypeSetup."Service Type";
                END;
              END;
            2:
              BEGIN
                IF ServiceSourceTypeSetup.GET(0) THEN BEGIN
                  IF ServiceType = '' THEN
                    ServiceType :=  ServiceSourceTypeSetup."Service Type";
                END;
              END;
          END;
          Level += 1;
        UNTIL (Level > 2) OR (ServiceType <> '');
      END;

      IF (ServiceType <> '') AND (ServiceType <> "Service Type") THEN
        VALIDATE("Service Type", ServiceType);
    END;

    LOCAL PROCEDURE DetermineOrderKindByWarranty@1100528609();
    VAR
      ServiceObject@1100528600 : Record 11071691;
      ServiceWarranty@1100528601 : Record 11071810;
    BEGIN
      IF "Object No." = '' THEN
        EXIT;
      IF NOT ServiceObject.GET("Object No.") THEN
        EXIT;
      IF ServiceObject."Warranty Code Customer" = '' THEN
        EXIT;
      IF (ServiceObject."Warranty Starting Date Cust." <= "Receiving Date") AND
        ((ServiceObject."Warranty Exp. Date Customer" = 0D) OR (ServiceObject."Warranty Exp. Date Customer" >= "Receiving Date"))
      THEN BEGIN
        ServiceWarranty.GET(ServiceObject."Warranty Code Customer");
        IF ServiceWarranty."Order Kind" <> '' THEN
          VALIDATE("Order Kind", ServiceWarranty."Order Kind");
      END;
    END;

    PROCEDURE LookupPlantPart@1100529000(EditableMode@1100529000 : Boolean);
    VAR
      PlantPartPlantLevel@1100529001 : Record 11229932;
    BEGIN
      TESTFIELD("Plant Type");
      TESTFIELD("Plant Number");
      PlantPartPlantLevel.CHANGECOMPANY("Plant Company");
      PlantPartPlantLevel.FILTERGROUP(4);
      PlantPartPlantLevel.SETRANGE(Level, PlantPartPlantLevel.Level::PlantNumber);
      PlantPartPlantLevel.SETRANGE("Plant Type", "Plant Type");
      PlantPartPlantLevel.SETRANGE("Plant No.", "Plant Number");
      PlantPartPlantLevel.FILTERGROUP(0);
      PlantPartPlantLevel.Level := PlantPartPlantLevel.Level::PlantNumber;
      PlantPartPlantLevel."Plant Type" := "Plant Type";
      PlantPartPlantLevel."Plant No." := "Plant Number";
      PlantPartPlantLevel."Plant Part" := "Plant Part";
      IF NOT EditableMode THEN
        PAGE.RUNMODAL(PAGE::"Plant Number Part List", PlantPartPlantLevel)
      ELSE BEGIN
        IF PAGE.RUNMODAL(PAGE::"Plant Number Part List", PlantPartPlantLevel) = ACTION::LookupOK THEN BEGIN
          IF (PlantPartPlantLevel."Plant Part" <> '') AND (PlantPartPlantLevel."Plant Part" <> "Plant Part") THEN
            VALIDATE("Plant Part", PlantPartPlantLevel."Plant Part");
        END;
      END;
    END;

    LOCAL PROCEDURE CheckProblemOfPlantPart@1100529001();
    VAR
      PlantPartProblem@1100529001 : Record 11229931;
    BEGIN
      IF Problem = '' THEN
        EXIT;
      CASE GetPlantPartProblemLevel OF
        PlantPartProblem.Level::PlantNumber:
          PlantPartProblem.GET(PlantPartProblem.Level::PlantNumber, "Plant Type", "Plant Number", "Plant Part", Problem);
        PlantPartProblem.Level::PlantType:
          PlantPartProblem.GET(PlantPartProblem.Level::PlantType, "Plant Type", '', "Plant Part", Problem);
        PlantPartProblem.Level::General:
          PlantPartProblem.GET(PlantPartProblem.Level::General, '', '', "Plant Part", Problem);
      END;
    END;

    LOCAL PROCEDURE LookupProblem@1100529002(EditableMode@1100529000 : Boolean);
    VAR
      ServiceAnalysis@1100529003 : Record 11012842;
      PlantPartProblem@1100529002 : Record 11229931;
      ServiceContractInfoMgt@1100528600 : Codeunit 11012842;
      ProblemLevel@1100529001 : Option;
    BEGIN
      ProblemLevel := GetPlantPartProblemLevel;
      IF ProblemLevel < 0 THEN BEGIN
        GetFilteredProblemsOnDisciplines(ServiceAnalysis);
        GetFilteredProblemsOnSUP(ServiceAnalysis);
        ServiceContractInfoMgt.GetFilteredAnalysisByContract("Service Contract No.", ServiceAnalysis."Analysis Type"::Problem, ServiceAnalysis);
        ServiceAnalysis.Code := Problem;
        IF NOT EditableMode THEN
          PAGE.RUNMODAL(PAGE::"Service Analysis (Problem)", ServiceAnalysis)
        ELSE BEGIN
          IF PAGE.RUNMODAL(PAGE::"Service Analysis (Problem)", ServiceAnalysis) = ACTION::LookupOK THEN BEGIN
            IF (ServiceAnalysis.Code <> '') AND (ServiceAnalysis.Code <> Problem) THEN
            VALIDATE(Problem, ServiceAnalysis.Code);
          END;
        END;
      END ELSE BEGIN
        PlantPartProblem.FILTERGROUP(4);
        PlantPartProblem.SETRANGE(Level, ProblemLevel);
        PlantPartProblem.SETRANGE("Plant Part", "Plant Part");
        CASE ProblemLevel OF
          PlantPartProblem.Level::PlantNumber:
            BEGIN
              PlantPartProblem.SETRANGE("Plant Type", "Plant Type");
              PlantPartProblem.SETRANGE("Plant No.", "Plant Number");
            END;
          PlantPartProblem.Level::PlantType:
            BEGIN
              PlantPartProblem.SETRANGE("Plant Type", "Plant Type");
              PlantPartProblem.SETRANGE("Plant No.", '');
            END;
          PlantPartProblem.Level::General:
            BEGIN
              PlantPartProblem.SETRANGE("Plant Type", '');
              PlantPartProblem.SETRANGE("Plant No.", '');
            END;
        END;
        PlantPartProblem.FILTERGROUP(0);
        PlantPartProblem.Problem := Problem;
        IF NOT EditableMode THEN
          PAGE.RUNMODAL(PAGE::"Plant Part Problem List", PlantPartProblem)
        ELSE BEGIN
          IF PAGE.RUNMODAL(PAGE::"Plant Part Problem List", PlantPartProblem) = ACTION::LookupOK THEN BEGIN
            IF (PlantPartProblem.Problem <> '') AND (PlantPartProblem.Problem <> Problem) THEN
              VALIDATE(Problem, PlantPartProblem.Problem);
          END;
        END;
      END;
    END;

    LOCAL PROCEDURE GetPlantPartProblemLevel@1100529003() : Integer;
    VAR
      PlantPartProblem@1100529000 : Record 11229931;
      Level@1100529001 : Integer;
    BEGIN
      IF ("Plant Type" <> '') AND ("Plant Number" <> '') AND ("Plant Part" <> '') THEN BEGIN
        PlantPartProblem.SETRANGE(Level, PlantPartProblem.Level::PlantNumber);
        PlantPartProblem.SETRANGE("Plant Type", "Plant Type");
        PlantPartProblem.SETRANGE("Plant No.", "Plant Number");
        PlantPartProblem.SETRANGE("Plant Part", "Plant Part");
        PlantPartProblem.SETFILTER(Problem, '<>%1', '');
        FOR Level := 1 TO 3 DO BEGIN
          IF Level = 2 THEN BEGIN
            PlantPartProblem.SETRANGE(Level, PlantPartProblem.Level::PlantType);
            PlantPartProblem.SETRANGE("Plant No.", '');
          END;
          IF Level = 3 THEN BEGIN
            PlantPartProblem.SETRANGE(Level, PlantPartProblem.Level::General);
            PlantPartProblem.SETRANGE("Plant Type", '');
          END;
          IF PlantPartProblem.FINDFIRST THEN
            EXIT(PlantPartProblem.Level);
        END;
      END;
      EXIT(-1);
    END;

    LOCAL PROCEDURE CopyPlantPartToServiceOrder@1100529004(ServiceOrder@1100529003 : Record 11012823;PlantPart@1100529002 : Code[30]);
    VAR
      ServiceOrderPlantPart@1100529004 : Record 11072320;
      ServiceText@1100529000 : Record 11012882;
      ServiceOrderPlantPartText@1100529001 : Record 11072321;
    BEGIN
      IF (ServiceOrder."No." = '') OR (ServiceOrder."Plant Type" = '') OR (ServiceOrder."Plant Number" = '') OR (PlantPart = '') THEN
        EXIT;
      ServiceOrderPlantPart.INIT;
      ServiceOrderPlantPart."Service Order No." := ServiceOrder."No.";
      ServiceOrderPlantPart."Line No." := 10000;
      ServiceOrderPlantPart."Plant Part" := PlantPart;
      ServiceOrderPlantPart.Problem := ServiceOrder.Problem;
      ServiceOrderPlantPart.INSERT(TRUE);

      ServiceText.SETRANGE("Table Name", ServiceText."Table Name"::"Service Call");
      ServiceText.SETRANGE("No.", ServiceOrder."No.");
      ServiceText.SETRANGE("Table Field", 60);
      IF ServiceText.FINDSET THEN BEGIN
        ServiceOrderPlantPartText.INIT;
        ServiceOrderPlantPartText."Service Order No." := ServiceOrder."No.";
        ServiceOrderPlantPartText."Plant Part Line No." := ServiceOrderPlantPart."Line No.";
        ServiceOrderPlantPartText."Analysis Type" := ServiceOrderPlantPartText."Analysis Type"::Problem;
        ServiceOrderPlantPartText."Line No." := 0;
        REPEAT
          ServiceOrderPlantPartText."Line No." += 10000;
          ServiceOrderPlantPartText.Date := ServiceText.Date;
          ServiceOrderPlantPartText.Code := ServiceText.Code;
          ServiceOrderPlantPartText.Comment := ServiceText.Comment;
          ServiceOrderPlantPartText.VALIDATE("Time Created", ServiceText."Time Created");
          ServiceOrderPlantPartText."Created by" := ServiceText."Created by";
          ServiceOrderPlantPartText."Line Break" := ServiceText."Line Break";
          ServiceOrderPlantPartText.INSERT(FALSE);
        UNTIL ServiceText.NEXT = 0;
      END;
    END;

    PROCEDURE LookupServiceObjectNo@1100528610() : Boolean;
    VAR
      ServiceObject@1100528600 : Record 11071691;
      TmpServiceObject@1100528602 : TEMPORARY Record 11071691;
      ContractObject@1100528601 : Record 11071702;
      ServiceLocStructureLine@1100528603 : Record 11071720;
    BEGIN
      IF "Service Location No." <> '' THEN BEGIN
        ServiceObject.SETCURRENTKEY("Service Location No.");
        ServiceObject.SETRANGE("Service Location No.", "Service Location No.");
      END;

      IF "Service Contract No." <> '' THEN BEGIN
        ContractObject.SETRANGE("Service Contract No.", "Service Contract No.");
        IF "Service Location No." <> '' THEN
          ContractObject.SETFILTER("Service Location No.", '%1|%2', '', "Service Location No.");
        IF ContractObject.FINDSET THEN
          REPEAT
            TmpServiceObject."No." := ContractObject."Service Object No.";
            TmpServiceObject.INSERT;
          UNTIL ContractObject.NEXT = 0;
      END;

      IF ("Service Location Struct. No." <> 0) AND ("Service Loc. Struct. Line No." <> '') THEN BEGIN
        ServiceLocStructureLine.SETRANGE("Service Location No.", "Service Location No.");
        ServiceLocStructureLine.SETRANGE("Structure No.", "Service Location Struct. No.");
        ServiceLocStructureLine.SETRANGE("No.", "Service Loc. Struct. Line No.");
        ServiceLocStructureLine.SETRANGE("Object Line", TRUE);
        IF TmpServiceObject.ISEMPTY THEN BEGIN
          IF ServiceLocStructureLine.FINDSET THEN
            REPEAT
              TmpServiceObject."No." := ServiceLocStructureLine."Service Object No.";
              IF TmpServiceObject.INSERT THEN;
            UNTIL ServiceLocStructureLine.NEXT = 0;
        END ELSE BEGIN
          IF TmpServiceObject.FINDSET THEN
            REPEAT
              ServiceLocStructureLine.SETRANGE("Service Object No.", TmpServiceObject."No.");
              IF ServiceLocStructureLine.ISEMPTY THEN
                TmpServiceObject.DELETE;
            UNTIL TmpServiceObject.NEXT = 0;
        END;
      END;

      IF NOT TmpServiceObject.ISEMPTY THEN
        IF TmpServiceObject.FINDSET THEN BEGIN
          REPEAT
            ServiceObject."No." := TmpServiceObject."No.";
            ServiceObject.MARK(TRUE);
          UNTIL TmpServiceObject.NEXT = 0;
          ServiceObject.MARKEDONLY(TRUE);
        END;

      IF "Object No." <> '' THEN
        ServiceObject.GET("Object No.");
      ServiceObject.SETRANGE(Blocked, FALSE);
      IF PAGE.RUNMODAL(PAGE::"Service Object List", ServiceObject) = ACTION::LookupOK THEN BEGIN
        VALIDATE("Object No.", ServiceObject."No.");
        EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE UpdateServiceLocationStructure@1100528611();
    VAR
      ServiceLocStructureLine@1100528600 : Record 11071720;
    BEGIN
      IF "Service Location No." = '' THEN
        EXIT;
      IF ("Service Location Struct. No." = 0) OR ("Service Loc. Struct. Line No." = '') THEN
        EXIT;
      ServiceLocStructureLine.SETRANGE("Service Location No.", "Service Location No.");
      ServiceLocStructureLine.SETRANGE("Structure No.", "Service Location Struct. No.");
      ServiceLocStructureLine.SETRANGE("No.", "Service Loc. Struct. Line No.");
      ServiceLocStructureLine.SETRANGE("Object Line", TRUE);
      ServiceLocStructureLine.SETRANGE("Service Object No.", "Object No.");
      IF ServiceLocStructureLine.ISEMPTY THEN
        ServiceLocStructureLine.SETRANGE("No.");
      IF ServiceLocStructureLine.FINDFIRST THEN
        IF "Service Loc. Struct. Line No." <> ServiceLocStructureLine."No." THEN
          VALIDATE("Service Loc. Struct. Line No.", ServiceLocStructureLine."No.");
    END;

    LOCAL PROCEDURE ValidateServiceCluster@1100528633();
    VAR
      ServiceCluster@1100528600 : Record 11071742;
    BEGIN
      IF "Service Cluster" <> '' THEN BEGIN
        ServiceCluster.SETRANGE(Type, ServiceCluster.Type::"Source Type");
        ServiceCluster.SETRANGE("Type Code", '');
        ServiceCluster.SETRANGE("Source Type", ServiceCluster."Source Type"::Call);
        ServiceCluster.SETRANGE(Code, "Service Cluster");
        ServiceCluster.SETFILTER("Order Kind", '%1|%2', '', "Order Kind");
        ServiceCluster.SETFILTER("Order Type", '%1|%2', '', "Order Type");
        ServiceCluster.SETFILTER(Discipline, '%1|%2', '', Discipline);
        ServiceCluster.SETFILTER("Territory Code", '%1|%2', '', "Territory Code");
        ServiceCluster.FINDFIRST;
      END;
      VALIDATE("Service Cluster Seqn.", 0);
    END;

    LOCAL PROCEDURE LookupServiceCluster@1100528632();
    VAR
      ServiceCluster@1100528601 : Record 11071742;
    BEGIN
      ServiceCluster.SETRANGE(Type, ServiceCluster.Type::"Source Type");
      ServiceCluster.SETRANGE("Type Code", '');
      ServiceCluster.SETRANGE("Source Type", ServiceCluster."Source Type"::Call);
      ServiceCluster.SETFILTER("Order Kind", '%1|%2', '', "Order Kind");
      ServiceCluster.SETFILTER("Order Type", '%1|%2', '', "Order Type");
      ServiceCluster.SETFILTER(Discipline, '%1|%2', '', Discipline);
      ServiceCluster.SETFILTER("Territory Code", '%1|%2', '', "Territory Code");
      IF "Service Cluster" <> '' THEN
        ServiceCluster.GET(ServiceCluster.Type::"Source Type", '', ServiceCluster."Source Type"::Call, "Service Cluster");
      IF PAGE.RUNMODAL(0, ServiceCluster) = ACTION::LookupOK THEN
        VALIDATE("Service Cluster", ServiceCluster.Code);
    END;

    LOCAL PROCEDURE ValidateServiceClusterSeqn@1100528631();
    VAR
      ServiceOrder@1100528601 : Record 11012823;
      ServiceClusterSeq@1100528600 : Record 11071966;
    BEGIN
      IF ("Service Cluster" <> '') AND ("Service Cluster Seqn." <> 0) THEN BEGIN
        ServiceClusterSeq.GET(ServiceClusterSeq.Type::"Source Type", '', ServiceOrder."Source Type"::Call, "Service Cluster", "Service Cluster Seqn.");
        VALIDATE("First Possible Starting Date", ServiceClusterSeq."Execution Period Start Date");
        VALIDATE("Last Possible Ending Date", ServiceClusterSeq."Execution Period Ending Date");
      END;
    END;

    LOCAL PROCEDURE LookupServiceClusterSeqn@1100528630();
    VAR
      ServiceClusterSeq@1100528601 : Record 11071966;
    BEGIN
      ServiceClusterSeq.SETRANGE(Type, ServiceClusterSeq.Type::"Source Type");
      ServiceClusterSeq.SETRANGE("Type Code", '');
      ServiceClusterSeq.SETRANGE("Cluster Code", "Service Cluster");
      ServiceClusterSeq.SETRANGE("Source Type", ServiceClusterSeq."Source Type"::Call);
      IF "Service Cluster Seqn." <> 0 THEN
        ServiceClusterSeq.GET(ServiceClusterSeq.Type::"Source Type", '', ServiceClusterSeq."Source Type"::Call, "Service Cluster", "Service Cluster Seqn.");
      IF PAGE.RUNMODAL(0, ServiceClusterSeq) = ACTION::LookupOK THEN
        VALIDATE("Service Cluster Seqn.", ServiceClusterSeq."Seq. No.");
    END;

    LOCAL PROCEDURE DetermineServiceCluster@1100528670();
    VAR
      ServiceCluster@1100528600 : Record 11071742;
    BEGIN
      ServiceCluster.SETRANGE(Type, ServiceCluster.Type::"Source Type");
      ServiceCluster.SETRANGE("Type Code", '');
      ServiceCluster.SETRANGE("Source Type", ServiceCluster."Source Type"::Call);
      ServiceCluster.SETFILTER("Order Kind", '%1|%2', '', "Order Kind");
      ServiceCluster.SETFILTER("Order Type", '%1|%2', '', "Order Type");
      ServiceCluster.SETFILTER("Territory Code", '%1|%2', '', "Territory Code");
      ServiceCluster.SETFILTER(Discipline, '%1|%2', '', Discipline);
      IF ServiceCluster.FINDFIRST THEN
        VALIDATE("Service Cluster", ServiceCluster.Code);
    END;

    LOCAL PROCEDURE DetermineServiceClusterSeqn@1100528612();
    VAR
      ServiceClusterSeq@1100528600 : Record 11071966;
    BEGIN
      ServiceClusterSeq.SETRANGE(Type, ServiceClusterSeq.Type::"Source Type");
      ServiceClusterSeq.SETRANGE("Type Code", '');
      ServiceClusterSeq.SETRANGE("Source Type", ServiceClusterSeq."Source Type"::Call);
      ServiceClusterSeq.SETRANGE("Cluster Code", "Service Cluster");
      ServiceClusterSeq.SETFILTER("Execution Period Start Date", '<=%1', WORKDATE);
      ServiceClusterSeq.SETFILTER("Execution Period Ending Date", '%1|>=%2', 0D, WORKDATE);
      IF ServiceClusterSeq.FINDFIRST THEN
        VALIDATE("Service Cluster Seqn.", ServiceClusterSeq."Seq. No.")
      ELSE BEGIN
        ServiceClusterSeq.SETRANGE("Execution Period Start Date");
        IF ServiceClusterSeq.FINDSET THEN
          VALIDATE("Service Cluster Seqn.", ServiceClusterSeq."Seq. No.");
      END;
    END;

    PROCEDURE CreateTryoutQuote@1100528614();
    VAR
      TryoutQuote@1100528600 : Record 11012758;
      TryoutSuccessor@1100528602 : Record 11012761;
      ContactBusinessRelation@1100528601 : Record 5054;
    BEGIN
      TESTFIELD("Next Step", "Next Step"::" ");
      "Next Step" := "Next Step"::TryoutQuote;
      Status := Status::"In Process";
      TryoutQuote.INSERT(TRUE);
      TryoutQuote."Your reference" := "Your Reference";
      ContactBusinessRelation.SETCURRENTKEY("Link to Table", "No.");
      ContactBusinessRelation.SETRANGE("No.", "Customer No.");
      ContactBusinessRelation.SETRANGE("Link to Table", ContactBusinessRelation."Link to Table"::Customer);
      IF ContactBusinessRelation.FIND('-') THEN
        TryoutQuote.VALIDATE("Contact No.", ContactBusinessRelation."Contact No.");
      TryoutQuote."Global Dimension 1 Code" := "Global Dimension 1 Code";
      TryoutQuote.Discipline := Discipline;
      IF "Service Location No." <> '' THEN BEGIN
        TryoutQuote."Copy Address from" := TryoutQuote."Copy Address from"::"Service Location";
        TryoutQuote.VALIDATE("Service Location", "Service Location No.");
      END ELSE
        TryoutQuote."Copy Address from" := TryoutQuote."Copy Address from"::Company;
      TryoutQuote.Description := Description;
      TryoutQuote."Description 2" := Name;
      TryoutQuote.Address := Address;
      TryoutQuote.City := City;
      TryoutQuote."Post Code" := "Post Code";
      TryoutQuote."Territory Code" := "Territory Code";
      TryoutQuote.VALIDATE("Bill-to Customer No.", "Bill-to Customer No.");
      TryoutQuote.MODIFY(TRUE);

      TryoutSuccessor.INIT;
      TryoutSuccessor."Try-out No." := TryoutQuote."Try-out No.";
      TryoutSuccessor."Try-out Quote" := TryoutQuote.Code;
      TryoutSuccessor."Line No." := 10000;
      TryoutSuccessor.INSERT(TRUE);
      TryoutSuccessor."Service Call No." := "No.";
      TryoutSuccessor."Service Contract No." := "Service Contract No.";
      TryoutSuccessor."Service Location No." := "Service Location No.";
      TryoutSuccessor.MODIFY(TRUE);

      MESSAGE(Text019, TryoutQuote.TABLECAPTION, TryoutQuote.Code);
    END;

    LOCAL PROCEDURE LinkServiceOrderToTryoutSuccessor@1100528613();
    VAR
      TryoutSuccessor@1100528600 : Record 11012761;
    BEGIN
      TryoutSuccessor.SETCURRENTKEY("Service Call No.");
      TryoutSuccessor.SETRANGE("Service Call No.", "No.");
      IF NOT TryoutSuccessor.FINDFIRST THEN
        EXIT;
      IF TryoutSuccessor."Service Order No." = '' THEN BEGIN
        TryoutSuccessor."Service Order No." := "Service Order No.";
        TryoutSuccessor.MODIFY(TRUE);
      END;
    END;

    PROCEDURE CreateAndDisplayServiceCall@1100527600(OfficeAddinContext@1100527600 : Record 1600);
    VAR
      Customer@1100527601 : Record 18;
    BEGIN
      INIT;

      Customer.SETRANGE("E-Mail", OfficeAddinContext.Email);
      IF Customer.FINDFIRST THEN
        "Customer No." := Customer."No.";

      Name := OfficeAddinContext.Name;
      "E-Mail" := OfficeAddinContext.Email;
      INSERT(TRUE);
      COMMIT;
      PAGE.RUN(PAGE::"Service Call",Rec);
    END;

    PROCEDURE SetReferencePointModifiedByEmployee@1100528701(Employee@1100528700 : Code[20]);
    BEGIN
      ReferencePointModifiedByEmployee := Employee;
    END;

    PROCEDURE LookupPlantLocation@1100529604();
    VAR
      PlantLocation@1100525001 : Record 11012554;
    BEGIN
      PlantLocation.CHANGECOMPANY("Plant Company");
      IF "Plant Location" <> '' THEN
        IF PlantLocation.GET("Plant Location") THEN;
      IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN
        IF PlantLocation.Code <> "Plant Location" THEN
          VALIDATE("Plant Location", PlantLocation.Code);
    END;

    LOCAL PROCEDURE LookupPlantType@1100529605();
    VAR
      PlantType@1100529600 : Record 11012551;
    BEGIN
      PlantType.CHANGECOMPANY("Plant Company");
      IF "Plant Type" <> '' THEN
        IF PlantType.GET("Plant Type") THEN;
      IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN
        IF PlantType.Code <> "Plant Type" THEN
          VALIDATE("Plant Type", PlantType.Code);
    END;

    PROCEDURE LookupPlantInventory@1100529601(ILevel@1100485003 : Integer);
    VAR
      PlantInventory@1100485001 : Record 11012555;
      PlantType@1100529600 : Record 11012551;
      PlantInventoryPage@1100485000 : Page 11012559;
      LocDetails@1100485002 : 'InventEntry,PlantType,PlantNo,RateCode';
    BEGIN
      //* Level: 1-Plant Type, 2-Plant No.
      PlantInventory.CHANGECOMPANY("Plant Company");

      IF ILevel = 1 THEN BEGIN
        PlantInventory.SETRANGE(Removed, FALSE);
        PlantInventory.SETRANGE(Location, "Plant Location");
      END;
      IF ILevel = 2 THEN
        PlantInventory.SETRANGE("Plant Type", "Plant Type");

      PlantInventory.Removed := FALSE;
      PlantInventory.Location := "Plant Location";
      PlantInventory."Plant Type" := "Plant Type";
      PlantInventory."Plant No." := "Plant Number";

      PlantInventoryPage.SetCompany("Plant Company");
      PlantInventoryPage.SetDetailSelection(LocDetails::PlantNo);

      PlantInventoryPage.SETTABLEVIEW(PlantInventory);
      PlantInventoryPage.SETRECORD(PlantInventory);

      PlantInventoryPage.LOOKUPMODE := TRUE;
      IF PlantInventoryPage.RUNMODAL = ACTION::LookupOK THEN BEGIN
        PlantInventoryPage.GETRECORD(PlantInventory);
        PlantInventoryPage.GetDetailSelection(LocDetails);
        IF (ILevel = 1) THEN
          VALIDATE("Plant Type", PlantInventory."Plant Type");
        IF ((ILevel = 1) OR (ILevel = 2)) AND (LocDetails <> LocDetails::PlantType) THEN BEGIN
          PlantType.CHANGECOMPANY("Plant Company");
          IF NOT PlantType.GET("Plant Type") THEN
            CLEAR(PlantType);
          IF NOT PlantType.Bulk THEN
            VALIDATE("Plant Number", PlantInventory."Plant No.");
        END;
      END;
    END;

    LOCAL PROCEDURE LookupCostComponentPlant@1100529618();
    VAR
      CostComponentPlant@1100525001 : Record 11012575;
    BEGIN
      CostComponentPlant.CHANGECOMPANY("Plant Company");
      IF "Cost Component Plant" <> '' THEN
        IF CostComponentPlant.GET("Cost Component Plant") THEN ;
      IF PAGE.RUNMODAL(0, CostComponentPlant) = ACTION::LookupOK THEN
        "Cost Component Plant" := CostComponentPlant.Code;
    END;

    PROCEDURE GetPlantValues@1100529613();
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN BEGIN
        CALCFIELDS("Plant Location Description", "Plant Type Description", "Plant Number Description");
        EXIT;
      END;
      GetPlantLocationDescription;
      GetPlantTypeDescription;
      GetPlantNumberDescription;
    END;

    PROCEDURE GetPlantLocationDescription@1100529606();
    VAR
      PlantLocation@1100529600 : Record 11012554;
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
        CALCFIELDS("Plant Location Description")
      ELSE BEGIN
        "Plant Location Description" := '';
        IF "Plant Location" <> '' THEN BEGIN
          PlantLocation.CHANGECOMPANY("Plant Company");
          IF PlantLocation.GET("Plant Location") THEN
            "Plant Location Description" := PlantLocation.Description;
        END;
      END;
    END;

    PROCEDURE GetPlantTypeDescription@1100529616();
    VAR
      PlantType@1100529601 : Record 11012551;
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
        CALCFIELDS("Plant Type Description")
      ELSE BEGIN
        "Plant Type Description" := '';
        IF "Plant Type" <> '' THEN BEGIN
          PlantType.CHANGECOMPANY("Plant Company");
          IF PlantType.GET("Plant Type") THEN
            "Plant Type Description" := PlantType.Description;
        END;
      END;
    END;

    PROCEDURE GetPlantNumberDescription@1100529617();
    VAR
      PlantNumber@1100529602 : Record 11012552;
    BEGIN
      IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
        CALCFIELDS("Plant Number Description")
      ELSE BEGIN
        "Plant Number Description" := '';
        IF "Plant Number" <> '' THEN BEGIN
          PlantNumber.CHANGECOMPANY("Plant Company");
          IF PlantNumber.GET("Plant Type", "Plant Number") THEN
            "Plant Number Description" := PlantNumber.Description;
        END;
      END;
    END;

    LOCAL PROCEDURE LookupPlantLocationDescription@1100529608();
    VAR
      PlantLocation@1100529600 : Record 11012554;
    BEGIN
      PlantLocation.CHANGECOMPANY("Plant Company");
      PlantLocation.SETRANGE(Code, "Plant Location");
      PAGE.RUN(0, PlantLocation);
    END;

    LOCAL PROCEDURE LookupPlantTypeDescription@1100529602();
    VAR
      PlantType@1100529600 : Record 11012551;
    BEGIN
      PlantType.CHANGECOMPANY("Plant Company");
      PlantType.SETRANGE(Code, "Plant Type");
      PAGE.RUN(0, PlantType);
    END;

    LOCAL PROCEDURE LookupPlantNumberDescription@1100529609();
    VAR
      PlantNumber@1100529600 : Record 11012552;
    BEGIN
      PlantNumber.CHANGECOMPANY("Plant Company");
      PlantNumber.SETRANGE("Plant Type", "Plant Type");
      PlantNumber.SETRANGE("No.", "Plant Number");
      PAGE.RUN(0, PlantNumber);
    END;

    LOCAL PROCEDURE DetermineCostComponentPlant@1100529615();
    VAR
      OrderKind@1100529600 : Record 11012837;
      CostComponentPlant@1100529000 : Record 11012575;
    BEGIN
      IF "Order Kind" <> '' THEN BEGIN
        IF OrderKind.GET(OrderKind.Indication::Kind, "Order Kind") THEN BEGIN
          IF OrderKind."Cost Component Plant" <> '' THEN BEGIN
            CostComponentPlant.CHANGECOMPANY("Plant Company");
            IF CostComponentPlant.GET("Cost Component Plant") THEN
              VALIDATE("Cost Component Plant", OrderKind."Cost Component Plant");
          END;
        END;
      END;
    END;

    PROCEDURE SetDisciplineExists@1100527450(IDisciplineExists@1100528500 : Boolean);
    BEGIN
      DisciplineExists := IDisciplineExists;
    END;

    PROCEDURE ApplyDefaultsByProcessStructure@1100528671();
    VAR
      ServiceProcessManagement@1100528600 : Codeunit 11012883;
      RecRef@1100528601 : RecordRef;
    BEGIN
      IF "Process Structure Code" = '' THEN
        EXIT;
      IF ServiceProcessManagement.AssignDefaultValues(Rec, "Process Structure Code", RecRef) THEN
        RecRef.SETTABLE(Rec);
      IF MODIFY(TRUE) THEN;
    END;

    LOCAL PROCEDURE DetermineProcessStructure@1100528669();
    VAR
      ServiceProcessManagement@1100528603 : Codeunit 11012883;
      FoundProcessStructureCode@1100528601 : Code[10];
    BEGIN
      IF ServiceProcessManagement.DetermineProcessStructure(Rec, FoundProcessStructureCode) THEN
        VALIDATE("Process Structure Code", FoundProcessStructureCode);
    END;

    LOCAL PROCEDURE FormatPhoneNumberWhenNotSynced@1100527300(VAR PhoneNumber@1100527303 : Text);
    VAR
      PhoneNumberFormatting@1100527302 : Codeunit 11012276;
      ServiceSetup@1100527301 : Record 11012800;
      ServiceLocation@1100527300 : Record 11012801;
    BEGIN
      ServiceSetup.GET;
      IF NOT ServiceSetup."Sync. Location by Order/Call" OR NOT ServiceLocation.GET("Service Location No.") THEN
        PhoneNumberFormatting.ValidatePhoneNumber("Country/Region Code", PhoneNumber);
    END;

    PROCEDURE LookupPlantNumber@1100527550();
    VAR
      PlantNumber@1100527550 : Record 11012552;
    BEGIN
      PlantNumber.CHANGECOMPANY("Plant Company");
      PlantNumber.SETRANGE("Plant Type", "Plant Type");
      PlantNumber."Plant Type" := "Plant Type";
      PlantNumber."No." := "Plant Number";
      IF PAGE.RUNMODAL(0, PlantNumber) = ACTION::LookupOK THEN
        IF PlantNumber."No." <> "Plant Number" THEN
          VALIDATE("Plant Number", PlantNumber."No.");
    END;

    BEGIN
    {
      4PS, 15-11-13, DP00483, Performance tuning: Key Status,Receiving Date added
      200512 ORANGO.EE New fields
    }
    END.
  }
}

