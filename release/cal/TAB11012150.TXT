OBJECT Table 11012150 Estimate Setup
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    OnModify=BEGIN
               IF "Rates Based On" = "Rates Based On"::"Budget Rate" THEN
                 TESTFIELD("Rate Group", '');
               IF "Part (Surcharge)" <> '' THEN
                 TESTFIELD("Surcharge Method", "Surcharge Method"::"Predefined Part"); //DP02080
             END;

    CaptionML=[ENU=Estimate Setup;
               NOR=Kalkyle Õ innstillinger;
               SVE=Kalkyl Õ instÑllningar];
  }
  FIELDS
  {
    { 10  ;   ;Primary Key         ;Code10        ;CaptionML=[ENU=Primary Key;
                                                              NOR=Primërnõkkel;
                                                              SVE=PrimÑrnyckel] }
    { 20  ;   ;Estimate Nos.       ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=Estimate Nos.;
                                                              NOR=Kalkylenr.;
                                                              SVE=Kalkylnr] }
    { 25  ;   ;Quantity Sheet Nos. ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=ENU=Quantity Sheet Nos.;
                                                   Description=DP00686 }
    { 30  ;   ;Path Name Norm Groups;Text250      ;OnValidate=BEGIN
                                                                FileMgt.AddBackSlashToDirectoryName("Path Name Norm Groups");
                                                              END;

                                                   CaptionML=[ENU=Path Name Norm Groups;
                                                              NOR=Filbanenavn til Normgrupper;
                                                              SVE=SîkvÑg till normgrupper] }
    { 40  ;   ;Operations          ;Text30        ;CaptionML=[ENU=Operations;
                                                              NOR=Operasjoner;
                                                              SVE=Operationer] }
    { 50  ;   ;Sub-Operations      ;Text30        ;CaptionML=[ENU=Sub-Operations;
                                                              NOR=Underinnsatser;
                                                              SVE=Underinsatser] }
    { 60  ;   ;Sub Operation Texts ;Text30        ;CaptionML=[ENU=Sub Operation Texts;
                                                              NOR=Underinnsatstekster;
                                                              SVE=Underinsatstexter] }
    { 70  ;   ;Operation Text Relation;Text30     ;CaptionML=[ENU=Operation Text Relation;
                                                              NOR=Innsatstekstrelasjon;
                                                              SVE=Insatstextrelation] }
    { 80  ;   ;Norms               ;Text30        ;CaptionML=[ENU=Norms;
                                                              NOR=Normer;
                                                              SVE=Normer] }
    { 90  ;   ;Search Directory    ;BLOB          ;CaptionML=[ENU=Search Directory;
                                                              NOR=Sõk katalog;
                                                              SVE=Sîkkatalog];
                                                   SubType=User-Defined }
    { 100 ;   ;Import Operations   ;Boolean       ;CaptionML=[ENU=Import Operations;
                                                              NOR=Importer Innsatser;
                                                              SVE=Importera insatser] }
    { 110 ;   ;Import Sub-Operations;Boolean      ;CaptionML=[ENU=Import Sub-Operations;
                                                              NOR=Importer Underinnsatser;
                                                              SVE=Importera underinsatser] }
    { 120 ;   ;Import Sub-Operation Texts;Boolean ;CaptionML=[ENU=Import Sub-Operation Texts;
                                                              NOR=Importer Underinnsatstekster;
                                                              SVE=Importera underinsatstexter] }
    { 130 ;   ;Import Operation Text Relation;Boolean;
                                                   CaptionML=[ENU=Import Operation Text Relation;
                                                              NOR=Importer Relasjon til innsatstekst;
                                                              SVE=Importera relation till insatstext] }
    { 140 ;   ;Import Norms        ;Boolean       ;CaptionML=[ENU=Import Norms;
                                                              NOR=Importer normer;
                                                              SVE=Importera normer] }
    { 141 ;   ;Copy Experience Result;Boolean     ;CaptionML=[ENU=Copy Experience Result;
                                                              NOR=Kopier Erfaringsresultat;
                                                              SVE=Kopiera erfarenhetsresultat] }
    { 150 ;   ;Pathname Excel Sheets;Text250      ;OnValidate=BEGIN
                                                                ValidatePathName("Pathname Excel Sheets");
                                                              END;

                                                   CaptionML=[ENU=Pathname Excel Sheets;
                                                              NOR=Filbanenavn til Excel-ark;
                                                              SVE=SîkvÑg till Excel-ark] }
    { 155 ;   ;Pathname Excel Templates;Text250   ;OnValidate=BEGIN
                                                                ValidatePathName("Pathname Excel Templates");
                                                              END;

                                                   CaptionML=[ENU=Pathname Excel Templates;
                                                              NOR=Filbanenavn til Excel-maler;
                                                              SVE=SîkvÑg till Excel-mallar] }
    { 160 ;   ;Part Format         ;Code20        ;CaptionML=[ENU=Part Format;
                                                              NOR=Delformat;
                                                              SVE=Delformat] }
    { 165 ;   ;Sub-Estimate Format ;Code20        ;CaptionML=[ENU=Sub-Estimate Format;
                                                              NOR=Delkalkyleformat;
                                                              SVE=Delkalkylformat] }
    { 170 ;   ;Absence Value Labor ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Labor),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Absence Value Labor;
                                                              NOR=Fravërverdi, arbeidskraft;
                                                              SVE=FrÜnvarovÑrde, arbetskraft] }
    { 180 ;   ;Absence Value Material;Code20      ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Material),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Absence Value Material;
                                                              NOR=Fravërverdi, Materiale;
                                                              SVE=FrÜnvarovÑrde, material] }
    { 190 ;   ;Absence Value Subcontracting;Code20;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Subcontracting),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Absence Value Subcontracting;
                                                              NOR=Fravërverdi, underentrepenõr;
                                                              SVE=FrÜnvarovÑrde, underentreprenad] }
    { 200 ;   ;Absence Value Plant ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Plant),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Absence Value Plant;
                                                              NOR=Fravërverdi, maskin;
                                                              SVE=FrÜnvarovÑrde, Maskin] }
    { 210 ;   ;Absence Value Sundry Cost;Code20   ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Sundry),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Absence Value Sundry Cost;
                                                              NOR=Fravërverdi, diversekost;
                                                              SVE=FrÜnvarovÑrde, diversekostnad] }
    { 220 ;   ;Rates Based On      ;Option        ;CaptionML=[ENU=Rates Based On;
                                                              NOR=Avgifter basert pÜ;
                                                              SVE=Avgifter baseras pÜ];
                                                   OptionCaptionML=[ENU=Rate Group,Budget Rate;
                                                                    NOR=Satsgruppe,Budsjettsats;
                                                                    SVE=Kostnadsgrupp,Budgetavgift];
                                                   OptionString=Rate Group,Budget Rate }
    { 230 ;   ;Estimate Based On   ;Option        ;CaptionML=[ENU=Estimate Based On;
                                                              NOR=Kalkyle Basert pÜ;
                                                              SVE=Kalkyl baserad pÜ];
                                                   OptionCaptionML=[ENU=Item,Cost Object;
                                                                    NOR=Artikkel,Kostnadsobjekt;
                                                                    SVE=Artikel,kostnadsobjekt];
                                                   OptionString=Item,CostObject }
    { 250 ;   ;Pathname Excel Estimates;Text250   ;OnValidate=BEGIN
                                                                ValidatePathName("Pathname Excel Estimates");
                                                              END;

                                                   CaptionML=[ENU=Pathname Excel Estimates;
                                                              NOR=Filbanenavn til Excel-kalkyler;
                                                              SVE=SîkvÑg till Excel-kalkyler] }
    { 260 ;   ;Worksheet Excel Estimates;Text50   ;CaptionML=[ENU=Worksheet;
                                                              NOR=Regneark;
                                                              SVE=Fîrslag] }
    { 270 ;   ;Excel Estimate Template;Text50     ;CaptionML=[ENU=Excel Estimate Template;
                                                              NOR=Excel-kalkylemal;
                                                              SVE=Excel-kalkylmall] }
    { 271 ;   ;Excel Estimate Template RAW;Text50 ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Excel Estimate Template RAW;
                                                   Description=DP01561 }
    { 280 ;   ;First Worksheet Data Line;Integer  ;CaptionML=[ENU=First Worksheet Data Line;
                                                              NOR=Fõrste Datarad i Regneark;
                                                              SVE=Fîrsta dataraden i kalkylblad] }
    { 290 ;   ;Pathname Excel Est. Template;Text250;
                                                   OnValidate=BEGIN
                                                                ValidatePathName("Pathname Excel Est. Template");
                                                              END;

                                                   CaptionML=[ENU=Pathname Excel Estimate Templates;
                                                              NOR=Filbanenavn til Excel-kalkylemaler;
                                                              SVE=SîkvÑg till Excel-kalkylmallar] }
    { 300 ;   ;Rate Group          ;Code10        ;TableRelation="Rate Group".No.;
                                                   CaptionML=[ENU=Rate Group;
                                                              NOR=Kostgruppe;
                                                              SVE=Kostnadsgrupp] }
    { 305 ;   ;Rate Code           ;Code10        ;TableRelation=IF (Rates Based On=CONST(Budget Rate)) "Budget Rate".Code WHERE (Apply as Estimate Rate=CONST(Yes))
                                                                 ELSE IF (Rates Based On=CONST(Rate Group)) "Rate by Group"."Rate Code";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Rate Code;
                                                              NOR=Avgiftskode;
                                                              SVE=Avgiftskod] }
    { 310 ;   ;Recipe Group        ;Code10        ;TableRelation="Recipe Group".No.;
                                                   OnValidate=BEGIN
                                                                ValidateRecipeGroup;  //db, 07-02-14: C013041
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Recipe Group;
                                                              NOR=Maltype;
                                                              SVE=Malltyp] }
    { 320 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   CaptionML=[ENU=Norm Group;
                                                              NOR=Normgruppe;
                                                              SVE=Normgrupp] }
    { 330 ;   ;Part Group          ;Code10        ;TableRelation="Estimate Group".No. WHERE (Type=CONST(Part));
                                                   CaptionML=[ENU=Part Group;
                                                              NOR=Del gruppe;
                                                              SVE=Delgrupp] }
    { 340 ;   ;Copy Part Lines     ;Boolean       ;CaptionML=[ENU=Copy Part Lines;
                                                              NOR=Kopier Delrader;
                                                              SVE=Kopiera delrader] }
    { 350 ;   ;Estimate Source     ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate Source;
                                                              NOR=Kalkyle Õ kilde;
                                                              SVE=Kalkyl Õ kÑlla] }
    { 360 ;   ;Summary Source (Cost);Code10       ;TableRelation="Summary Sheet".Summary WHERE (Estimate No.=FIELD(Estimate Source),
                                                                                                Summary Type=CONST(Cost));
                                                   CaptionML=[ENU=Summary Source (Cost);
                                                              NOR=Summeringskilde (Kostnad);
                                                              SVE=SummeringskÑlla (kostnad)] }
    { 361 ;   ;Summary Source (Sales);Code10      ;TableRelation="Summary Sheet".Summary WHERE (Estimate No.=FIELD(Estimate Source),
                                                                                                Summary Type=CONST(Sales));
                                                   CaptionML=[ENU=Summary Source (Sales);
                                                              NOR=Summeringskilde (Salg);
                                                              SVE=SummeringskÑlla (fîrsÑljning)] }
    { 370 ;   ;Default Purchase Action;Boolean    ;CaptionML=[ENU=Default Purchase Action from Cost Object;
                                                              NOR=Standardinnkjõpshandling fra Kostnadsobjekt;
                                                              SVE=StandardinkîpsÜtgÑrd frÜn kostnadsobjekt] }
    { 380 ;   ;Path Quote Comp. Excel Files;Text250;
                                                   OnValidate=BEGIN
                                                                ValidatePathName("Path Quote Comp. Excel Files");
                                                              END;

                                                   CaptionML=[ENU=Path Quote Comp. Excel Files;
                                                              NOR=Filbane til selskapstilbud Excel-filer;
                                                              SVE=SîkvÑg till fîretagsoffert Excel-filer] }
    { 390 ;   ;Quantity Sheet with Relations;Boolean;
                                                   CaptionML=[ENU=Estimate Quantity Sheet with extra Relations;
                                                              NOR=Kalkyle Õ antallsspesifikasjon med Ekstra Relasjoner;
                                                              SVE=Kalkyl Õ antalsspecifikation med extra relationer] }
    { 410 ;   ;Upd. Cost Object by Rate Code;Boolean;
                                                   CaptionML=[ENU=Update Cost Object by Rate Code;
                                                              NOR=Oppdater Kostnadsobjekt etter satskode;
                                                              SVE=Uppdatera kostnadsobjekt efter avgiftskod] }
    { 430 ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Currency Code;
                                                              SVE=Valutakod];
                                                   Description=DP02114 }
    { 440 ;   ;Surcharge % Labor   ;Decimal       ;CaptionML=[ENU=Surcharge % Labor;
                                                              NOR=Tilleggsgebyrsprosent, arbeidskraft;
                                                              SVE=TillÑggsavgiftsprocent, arbetskraft];
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 441 ;   ;Surcharge % Material;Decimal       ;CaptionML=[ENU=Surcharge % Material;
                                                              NOR=Tilleggsgebyrsprosent, Materiale;
                                                              SVE=TillÑggsavgiftsprocent, material];
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 442 ;   ;Surcharge % Subcontracting;Decimal ;CaptionML=[ENU=Surcharge % Subcontracting;
                                                              NOR=Tilleggsgebyrsprosent, underentrepenõr;
                                                              SVE=TillÑggsavgiftsprocent, underentreprenad];
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 443 ;   ;Surcharge % Plant   ;Decimal       ;CaptionML=[ENU=Surcharge % Plant;
                                                              NOR=Tilleggsgebyrsprosent, maskin;
                                                              SVE=TillÑggsavgiftsprocent, maskin];
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 445 ;   ;Surcharge % Sundry  ;Decimal       ;CaptionML=[ENU=Surcharge % Sundry;
                                                              NOR=PÜslagssatser, diverse;
                                                              SVE=TillÑggsavgiftsprocent, diverse];
                                                   BlankZero=Yes;
                                                   Description=DP00381 }
    { 450 ;   ;Norm Group (Sales)  ;Code10        ;TableRelation="Norm Group".Code;
                                                   CaptionML=[ENU=Norm Group (Sales);
                                                              SVE=Kopiera till];
                                                   Description=DP00381 }
    { 460 ;   ;Item Sales Price Based On;Option   ;CaptionML=ENU=Item Sales Price Based On;
                                                   OptionCaptionML=[ENU=Cost Price,Gross Price - Sales Discount;
                                                                    NOR=Selvkostpris,Bruttopris Õ Salgsrabatt;
                                                                    SVE=SjÑlvkostnadspris,Bruttopris Õ FîrsÑljningsrabatt];
                                                   OptionString=CostPrice,GrossMin;
                                                   Description=DP00381 }
    { 470 ;   ;Init Sales From Cost;Boolean       ;CaptionML=ENU=Iintialize Sales From Cost;
                                                   Description=DP00381 }
    { 480 ;   ;Copy Norm Group from Target;Boolean;CaptionML=ENU=Copy Norm Group from Target instead of Source }
    { 490 ;   ;Plant Rates in Hours;Boolean       ;CaptionML=[ENU=Plant Rates in Hours;
                                                              NOR=Maskingebyrer i timer;
                                                              SVE=Maskinavgifter i timmar];
                                                   Description=DP01047 }
    { 491 ;   ;Kind of Plant Rate  ;Option        ;InitValue=Intern;
                                                   CaptionML=ENU=Kind of Plant Rate;
                                                   OptionCaptionML=[ENU=Internal,External;
                                                                    NOR=Internt,Eksternt;
                                                                    SVE=Internt,Externt];
                                                   OptionString=Intern,Extern;
                                                   Description=DP01047 }
    { 495 ;   ;Plant Company       ;Text30        ;TableRelation="Plant Management Company"."Plant Company";
                                                   OnValidate=BEGIN
                                                                IF "Plant Company" = COMPANYNAME THEN
                                                                  "Plant Company" := '';
                                                              END;

                                                   CaptionML=[ENU=Plant Company;
                                                              NOR=Maskinselskap;
                                                              SVE=Maskinfîretag];
                                                   Description=DP01407+DP02115 }
    { 500 ;   ;Apply Surcharge Recipe Header;Option;
                                                   CaptionML=ENU=Apply Surcharge Recipe Header as;
                                                   OptionCaptionML=ENU=Initial Value Recipe Line,Cumulative Surcharge on Recipe Lines;
                                                   OptionString=Default,Cumulative;
                                                   Description=DP01183 }
    { 510 ;   ;Excel Template contains Macros;Boolean;
                                                   CaptionML=[ENU=Excel Template used Macros;
                                                              NOR=Excel-mal brukte Makroer;
                                                              SVE=Excel-mall anvÑnde makron] }
    { 520 ;   ;Apply Linked Recipe ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Apply Linked Recipe;
                                                              NOR=Beregnet radlengde felttittel;
                                                              SVE=Uppsk. radlÑngd fÑltrubrik];
                                                   Description=DP02082 }
    { 530 ;   ;Cost Object (GeneralCost);Code20   ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Sundry),
                                                                                               Global Dimension No.=CONST(2));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Cost Object (General Cost);
                                                              SVE=Kostnadsobjekt tillÑggsavgift];
                                                   Description=DP02080 }
    { 531 ;   ;Cost Object (Profit/Risk);Code20   ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Sundry),
                                                                                               Global Dimension No.=CONST(2));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Cost Object (Profit/Risk);
                                                   Description=DP02080 }
    { 532 ;   ;Cost Object (ExecutionCost);Code20 ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Sundry),
                                                                                               Global Dimension No.=CONST(2));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Cost Object (Execution Cost);
                                                   Description=DP02080 }
    { 540 ;   ;Part (Surcharge)    ;Code20        ;TableRelation="Estimate Base Part".Code WHERE (Part Group=FIELD(Part Group));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Part (Surcharge);
                                                   Description=DP02080 }
    { 550 ;   ;Surcharge Method    ;Option        ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Surcharge Method;
                                                   OptionCaptionML=ENU=Summary,Surcharge By Part,Predefined Part;
                                                   OptionString=Summary,Surcharge By Part,Predefined Part;
                                                   Description=DP02080 }
    { 560 ;   ;Percentage (GeneralCost);Decimal   ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Percentage (General Cost);
                                                              SVE=Procent (tillÑggsavgift)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP02080 }
    { 561 ;   ;Percentage (Profit/Risk);Decimal   ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Percentage (Profit/Risk);
                                                              SVE=Procent (vinst/risk)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP02080 }
    { 562 ;   ;Percentage (ExecutionCost);Decimal ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Percentage (Execution Cost);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP02080 }
    { 11128270;;Status Code Preparation;Code10    ;TableRelation="Estimate Status";
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Status Code Preparation;
                                                              NOR=Statuskode Forberedelse;
                                                              SVE=Statuskod fîrberedelse];
                                                   Description=EVRY }
    { 11128271;;Status Code Open   ;Code10        ;TableRelation="Estimate Status";
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Status Code Open;
                                                              NOR=Statuskode èpen;
                                                              SVE=Statuskod ôppen];
                                                   Description=EVRY }
    { 11128272;;Status Code Order  ;Code10        ;TableRelation="Estimate Status";
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Status Code Order;
                                                              NOR=Statuskode Ordre;
                                                              SVE=Statuskod Order];
                                                   Description=EVRY }
  }
  KEYS
  {
    {    ;Primary Key                             ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@11012000 : TextConst 'ENU=Do you want to import Norm Groups ?;NOR=Vil du importere normgrupper?;SVE=Vill du importera normgrupper?';
      FileMgt@1100525003 : Codeunit 419;
      DocumentServiceeMgt@1100529600 : Codeunit 9510;
      Text001@1100529601 : TextConst 'ENU=Select File:';
      Text002@1100528600 : TextConst 'ENU=Select Opertions File...';
      Text003@1100528601 : TextConst 'ENU=Select Sub Opertions File...';
      Text004@1100528602 : TextConst 'ENU=Select Sub Opertion Texts File...';
      Text005@1100528603 : TextConst 'ENU=Select Opertion Text Relation File...';
      Text006@1100528604 : TextConst 'ENU=Select Norms File...';

    PROCEDURE Import@2(InputRec@11012000 : Record 11012150);
    VAR
      TempBlob@1100525004 : Record 99008535;
      ClientTypeManagement@1100528600 : Codeunit 4;
      ImportOperations@1100525001 : XMLport 11012150;
      ImportSubOperations@1100525002 : XMLport 11012151;
      ImportSubOperationTexts@1100525006 : XMLport 11012152;
      ImportOperationTextRelation@1100525007 : XMLport 11012153;
      ImportNormsUneto@1100525008 : XMLport 11012154;
      IStream@1100525005 : InStream;
      FileName@1100525000 : Text[1024];
    BEGIN
      IF NOT ClientTypeManagement.IsCommonWebClientType THEN BEGIN
        TESTFIELD("Path Name Norm Groups");
        IF COPYSTR("Path Name Norm Groups", STRLEN("Path Name Norm Groups"), 1) <> '\' THEN
                   "Path Name Norm Groups" := "Path Name Norm Groups" + '\';
      END;

      IF NOT CONFIRM(Text000) THEN
        EXIT;

      IF "Import Operations" THEN BEGIN
        IF ClientTypeManagement.IsCommonWebClientType THEN BEGIN
          IF NOT UPLOADINTOSTREAM(Text002, '', '', FileName, IStream) THEN
            ERROR('');
        END ELSE BEGIN
          TESTFIELD(Operations);
          FileName := "Path Name Norm Groups" + Operations;
          FileMgt.BLOBImport4PS(TempBlob, FileName, FALSE);
          TempBlob.Blob.CREATEINSTREAM(IStream);
        END;
        ImportOperations.SETSOURCE(IStream);
        ImportOperations.IMPORT;
      END;

      IF "Import Sub-Operations" THEN BEGIN
        TESTFIELD("Import Norms", TRUE);  //C031512
        IF ClientTypeManagement.IsCommonWebClientType THEN BEGIN
          IF NOT UPLOADINTOSTREAM(Text003, '', '', FileName, IStream) THEN
            ERROR('');
        END ELSE BEGIN
          TESTFIELD("Sub-Operations");
          FileName := "Path Name Norm Groups" + "Sub-Operations";
          FileMgt.BLOBImport4PS(TempBlob, FileName, FALSE);
          TempBlob.Blob.CREATEINSTREAM(IStream);
        END;
        ImportSubOperations.SETSOURCE(IStream);
        ImportSubOperations.IMPORT;
      END;

      IF "Import Sub-Operation Texts" THEN BEGIN
        IF ClientTypeManagement.IsCommonWebClientType THEN BEGIN
          IF NOT UPLOADINTOSTREAM(Text004, '', '', FileName, IStream) THEN
            ERROR('');
        END ELSE BEGIN
          TESTFIELD("Sub Operation Texts");
          FileName := "Path Name Norm Groups" + "Sub Operation Texts";
          FileMgt.BLOBImport4PS(TempBlob, FileName, FALSE);
          TempBlob.Blob.CREATEINSTREAM(IStream);
        END;
        ImportSubOperationTexts.SETSOURCE(IStream);
        ImportSubOperationTexts.IMPORT;
      END;

      IF "Import Operation Text Relation" THEN BEGIN
        IF ClientTypeManagement.IsCommonWebClientType THEN BEGIN
          IF NOT UPLOADINTOSTREAM(Text005, '', '', FileName, IStream) THEN
            ERROR('');
        END ELSE BEGIN
          TESTFIELD("Operation Text Relation");
          FileName := "Path Name Norm Groups" + "Operation Text Relation";
          FileMgt.BLOBImport4PS(TempBlob, FileName, FALSE);
          TempBlob.Blob.CREATEINSTREAM(IStream);
        END;
        ImportOperationTextRelation.SETSOURCE(IStream);
        ImportOperationTextRelation.IMPORT;
      END;

      IF "Import Norms" THEN BEGIN
        TESTFIELD("Import Sub-Operations", TRUE);  //C031512
        IF ClientTypeManagement.IsCommonWebClientType THEN BEGIN
          IF NOT UPLOADINTOSTREAM(Text006, '', '', FileName, IStream) THEN
            ERROR('');
        END ELSE BEGIN
          TESTFIELD(Norms);
          FileName := "Path Name Norm Groups" + Norms;
          FileMgt.BLOBImport4PS(TempBlob, FileName, FALSE);
          TempBlob.Blob.CREATEINSTREAM(IStream);
        END;
        ImportNormsUneto.SETSOURCE(IStream);
        ImportNormsUneto.IMPORT;
      END;

      CheckNormAndUnitFactor;  //C031512
    END;

    PROCEDURE LookupRecipeGroup@1100525020();
    VAR
      RecipeGroupRec@1100525000 : Record 11020580;
    BEGIN
      IF PAGE.RUNMODAL(0, RecipeGroupRec) = ACTION::LookupOK THEN
        "Recipe Group":= RecipeGroupRec."No.";
    END;

    PROCEDURE ValidateRecipeGroup@1100525022();
    VAR
      RecipeGroupRec@1100525000 : Record 11020580;
    BEGIN
      IF "Recipe Group" = '' THEN EXIT;
      RecipeGroupRec.GET("Recipe Group");
    END;

    PROCEDURE CheckNormAndUnitFactor@1100529900();
    VAR
      SubOperation@1100529900 : Record 11012166;
      SubOperation2@1100529902 : Record 11012166;
      NormRec@1100529901 : Record 11012163;
      ErrorRec@1100529903 : Record 11012051;
      MessageTxt@1100529905 : Text[250];
      NormOld@1100529906 : Decimal;
      NormNew@1100529907 : Decimal;
    BEGIN
      //C031512
      ErrorRec.SETRANGE("User ID", USERID);
      ErrorRec.SETRANGE("Source Type", ErrorRec."Source Type"::General);
      ErrorRec.DELETEALL;
      //
      SubOperation.SETFILTER("Unit Factor", '<>%1&<>%2', 0, 1);
      IF SubOperation.FINDSET THEN BEGIN
        REPEAT
          NormRec.SETRANGE("Sub Operation Code", SubOperation.Code);
          IF NormRec.FINDSET THEN BEGIN
            REPEAT
              NormOld := NormRec.Norm;
              NormNew := NormRec.Norm / SubOperation."Unit Factor";
              NormRec.Norm := NormNew;
              NormRec.MODIFY;
              MessageTxt :=
                NormRec.FIELDCAPTION("Sub Operation Code") + ': ' + NormRec."Sub Operation Code" + '; ' +
                NormRec.FIELDCAPTION(Norm) + ': '+ FORMAT(NormOld) + ' -> ' + FORMAT(NormNew);
              StoreMessage('', MessageTxt);
            UNTIL NormRec.NEXT = 0;
          END;
        UNTIL SubOperation.NEXT = 0;
        SubOperation2.MODIFYALL("Unit Factor", 1);
      END;
      //
      ErrorRec.SETRANGE("User ID", USERID);
      ErrorRec.SETRANGE("Source Type", ErrorRec."Source Type"::General);
      IF ErrorRec.FIND('-') THEN BEGIN
        COMMIT;
        PAGE.RUNMODAL(PAGE::Errors, ErrorRec);
      END;
    END;

    PROCEDURE StoreMessage@5(lvDesc@11012000 : Text[50];lvMess@11012001 : Text[250]);
    VAR
      ErrorRec@1210190000 : Record 11012051;
      lvError@11012002 : Integer;
    BEGIN
      //C031512
      WITH ErrorRec DO BEGIN
        SETRANGE("User ID", USERID);
        SETRANGE("Source Type", "Source Type"::General);
        IF FINDLAST THEN
          lvError := "Line No." + 1
        ELSE
          lvError := 1;

        INIT;
        "User ID" := USERID;
        "Source Type" := "Source Type"::General;
        "Line No." := lvError;
        "Error message" := lvMess;
        Description := lvDesc;
        INSERT;
      END;
    END;

    PROCEDURE AssistEditPathName@1100529600(VAR PathName@1100529600 : Text[250]);
    VAR
      PathNameLoc@1100529603 : Text;
    BEGIN
      IF NOT FileMgt.ClientAvailable THEN BEGIN
        DocumentServiceeMgt.SetUseDocumentService4PS(TRUE);
        IF DocumentServiceeMgt.CanConnect THEN BEGIN
          DocumentServiceeMgt.SetDoNotShowError(TRUE);
          IF DocumentServiceeMgt.IsServiceUri(PathName) THEN
            PathNameLoc := PathName
          ELSE
            PathNameLoc := DocumentServiceeMgt.GetDocumentServiceURL;
          HYPERLINK(PathNameLoc);
        END;
        EXIT;
      END;

      FileMgt.SelectDirectoryNameWithBackSlash(PathName);
    END;

    PROCEDURE ValidatePathName@1100529602(VAR PathName@1100529600 : Text[250]);
    BEGIN
      IF PathName = '' THEN
        EXIT;
      IF STRLEN(PathName) = MAXSTRLEN(PathName) THEN
        EXIT;

      IF STRPOS(PathName, '/') <> 0 THEN BEGIN
        IF COPYSTR(PathName, STRLEN(PathName)) <> '/' THEN
          PathName := PathName + '/';
        EXIT;
      END;

      FileMgt.AddBackSlashToDirectoryName(PathName);
    END;

    PROCEDURE SelectFile@1100529601(PathName@1100529600 : Text[250];VAR FileName@1100529603 : Text[50]);
    VAR
      NameValueBuffer@1100529604 : TEMPORARY Record 823;
      DirectoryName@1100529602 : Text;
      FileAbsPathName@1100529601 : Text;
      FileList@1100529605 : Text;
      FileNumber@1100529606 : Integer;
    BEGIN
      IF FileMgt.ClientAvailable THEN BEGIN
        DirectoryName := PathName;
        FileMgt.SelectFile('xlt', DirectoryName, "Excel Estimate Template", FileAbsPathName);
      END ELSE BEGIN
        FileMgt.GetServerDirectoryFilesListByExtension(NameValueBuffer, PathName, 'xlt');
        IF NameValueBuffer.ISEMPTY THEN
          EXIT;
        IF (NameValueBuffer.COUNT = 1) OR (NameValueBuffer.COUNT > 30) OR (NOT GUIALLOWED) THEN BEGIN
          NameValueBuffer.FINDFIRST;
          FileName := NameValueBuffer.Value;
          EXIT;
        END;

        NameValueBuffer.FINDSET;
        REPEAT
          FileList := FileList + NameValueBuffer.Value + ',';
        UNTIL NameValueBuffer.NEXT = 0;
        FileList := COPYSTR(FileList, 1, STRLEN(FileList) - 1);

        FileNumber := STRMENU(FileList, 1, Text001);
        IF FileNumber <> 0 THEN
          FileName := SELECTSTR(FileNumber, FileList);
      END;
    END;

    BEGIN
    {
      C031512: db, 04-07-17
      - import Norm and Sub Operation not allowed separately;
      - new function to convert Norm if Unit Factor (stored on Sub Operation) > 1 to prevent recalculate Norm on Estimate/Recipe/Budget Line
    }
    END.
  }
}

