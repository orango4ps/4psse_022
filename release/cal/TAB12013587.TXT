OBJECT Table 12013587 Exflow Purch. Document Header
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=EXF513000,4PS,EXFFI1.01;
  }
  PROPERTIES
  {
    DataCaptionFields=ExFlow Entry Type,ExFlow Document Type;
    OnInsert=VAR
               ExfPurchDocHead2@1100285000 : Record 12013587;
             BEGIN
               PurchSetup.GET;

               ExfJnlTemplate.GET("Journal Template Name");
               ExfJnlBatch.GET("Journal Template Name","Journal Batch Name");

               ExfPurchDocHead2.RESET;
               ExfPurchDocHead2.LOCKTABLE;
               ExfPurchDocHead2.SETCURRENTKEY("Inbound Document No.");
               IF ExfPurchDocHead2.FIND('+') THEN
                 "Inbound Document No." := ExfPurchDocHead2."Inbound Document No." + 1
               ELSE
                 "Inbound Document No." := 1;

               InitRecord;

               IF GETFILTER("Buy-from Vendor No.") <> '' THEN
                 IF GETRANGEMIN("Buy-from Vendor No.") = GETRANGEMAX("Buy-from Vendor No.") THEN
                   VALIDATE("Buy-from Vendor No.",GETRANGEMIN("Buy-from Vendor No."));
             END;

    OnDelete=VAR
               ExfWorkflowMgt@1100285000 : Codeunit 12013593;
               ExImportAttachment@1100285001 : Record 12013592;
               ExfImportedArchiveHead@1100285002 : Record 12013650;
               PurchDocWarningDoc@1100285003 : Record 12013636;
               RODocument@1100285004 : Record 12057083;
               PurchaseHeader@1100285006 : Record 38;
               ExPurchDocHead@1100285005 : Record 12013587;
             BEGIN
               ExPurchDocHead := Rec;
               CheckRevertPrePost;

               ExfPurchDocLine.RESET;
               ExfPurchDocLine.LOCKTABLE;
               ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
               ExfPurchDocLine.SETRANGE(Type,ExfPurchDocLine.Type::"Charge (Item)");
               DeletePurchaseLines;
               ExfPurchDocLine.SETRANGE(Type);
               DeletePurchaseLines;

               ExfWorkflowMgt.RestoreDeletedPDFandXML(Rec);

               ImageBlobBuffer.RESET;
               ImageBlobBuffer.LOCKTABLE;
               ImageBlobBuffer.SETRANGE("No.","Image Buffer ID");
               ImageBlobBuffer.DELETEALL;

               ExImportAttachment.RESET;
               ExImportAttachment.SETRANGE("Inbound Document No.", "Inbound Document No.");
               ExImportAttachment.DELETEALL(TRUE);

               ExfImportedArchiveHead.LOCKTABLE;
               IF ExfImportedArchiveHead.GET("Import Document No.") THEN BEGIN
                 ExfImportedArchiveHead.Deleted := TRUE;
                 ExfImportedArchiveHead."Deleted by User" := USERID;
                 ExfImportedArchiveHead."Deleted at DateTime" := CREATEDATETIME(TODAY,TIME);
                 ExfImportedArchiveHead.MODIFY;
               END;

               PurchDocWarningDoc.RESET;
               PurchDocWarningDoc.SETRANGE("Inbound Document No.", "Inbound Document No.");
               PurchDocWarningDoc.DELETEALL;

               IF "RO Entry No." <> 0 THEN BEGIN
                 RODocument.RESET;
                 IF RODocument.GET("RO Entry No.") THEN BEGIN
                   RODocument.Status := RODocument.Status::Processed;
                   RODocument.MODIFY;
                 END;
               END;
             END;

    OnRename=BEGIN
               ERROR(Text003,TABLECAPTION);
             END;

    CaptionML=[ENU=Exflow Purch. Document Header;
               SVE=Exflow ink”psdokument huvud];
    LookupPageID=Page12013592;
    DrillDownPageID=Page12013592;
  }
  FIELDS
  {
    { 1   ;   ;Document Type       ;Option        ;InitValue=Invoice;
                                                   CaptionML=[ENU=Document Type;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=[ENU=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order;
                                                                    SVE=Offert,Order,Faktura,Kreditnota,Avropsorder,Returorder];
                                                   OptionString=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order }
    { 2   ;   ;Buy-from Vendor No. ;Code20        ;TableRelation=Vendor;
                                                   OnValidate=VAR
                                                                ExPurchImpHeader2@1100285005 : Record 12013587;
                                                                VendorIDMgt@1100285000 : Codeunit 12013667;
                                                                lcduExfVerifyDoc@1100285001 : Codeunit 12013594;
                                                                ExFlowVend@1100285006 : Record 12013595;
                                                                TempStrLen@1100285002 : Integer;
                                                              BEGIN
                                                                TESTFIELD("ExFlow Document Type");

                                                                IF ("Buy-from Vendor No." <> xRec."Buy-from Vendor No.") AND
                                                                   (xRec."Buy-from Vendor No." <> '')
                                                                THEN BEGIN
                                                                  IF HideValidationDialog THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed := CONFIRM(Text004,FALSE,FIELDCAPTION("Buy-from Vendor No."));
                                                                  IF Confirmed THEN BEGIN
                                                                    CheckRevertPrePost;
                                                                    ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
                                                                    IF "Buy-from Vendor No." = '' THEN BEGIN
                                                                      IF NOT ExfPurchDocLine.ISEMPTY THEN
                                                                        ERROR(
                                                                          Text005,
                                                                          FIELDCAPTION("Buy-from Vendor No."));

                                                                      INIT;
                                                                      "Document Type" := xRec."Document Type";
                                                                      // Amounts
                                                                      "Document Amount Including VAT" := xRec."Document Amount Including VAT";
                                                                      "Document Amount VAT" := xRec."Document Amount VAT";
                                                                      "Document Amount" := xRec."Document Amount";
                                                                      "Calculated VAT %" := xRec."Calculated VAT %";

                                                                      // Dates
                                                                      "Posting Date" := xRec."Posting Date";
                                                                      "Document Date" := xRec."Document Date";
                                                                      "Due Date" := xRec."Due Date";

                                                                      // Overhead
                                                                      "Order No. (Import)" := xRec."Order No.";
                                                                      Reference := xRec.Reference;
                                                                      "Image File Name" := xRec."Image File Name";
                                                                      "Image Buffer ID" := xRec."Image Buffer ID";
                                                                      "ExFlow Document Type" := xRec."ExFlow Document Type";
                                                                      "Document Type" := xRec."Document Type";
                                                                      "Journal Template Name" := xRec."Journal Template Name";
                                                                      "Journal Batch Name" := xRec."Journal Batch Name";

                                                                      EXIT;
                                                                    END;

                                                                    IF "Document Type" = "Document Type"::Order THEN
                                                                      ExfPurchDocLine.SETFILTER("Quantity Received",'<>0')
                                                                    ELSE
                                                                      IF "Document Type" = "Document Type"::Invoice THEN BEGIN
                                                                        ExfPurchDocLine.SETRANGE("Buy-from Vendor No.",xRec."Buy-from Vendor No.");
                                                                        ExfPurchDocLine.SETFILTER("Receipt No.",'<>%1','');
                                                                      END;
                                                                    IF ExfPurchDocLine.FINDFIRST THEN
                                                                      IF "Document Type" = "Document Type"::Order THEN
                                                                        ExfPurchDocLine.TESTFIELD("Quantity Received",0)
                                                                      ELSE
                                                                        ExfPurchDocLine.TESTFIELD("Receipt No.",'');

                                                                    ExfPurchDocLine.SETRANGE("Receipt No.");
                                                                    ExfPurchDocLine.SETRANGE("Quantity Received");
                                                                    ExfPurchDocLine.SETRANGE("Buy-from Vendor No.");

                                                                    IF "Document Type" = "Document Type"::Order THEN BEGIN
                                                                      ExfPurchDocLine.SETFILTER("Prepmt. Amt. Inv.",'<>0');
                                                                      IF ExfPurchDocLine.FIND('-') THEN
                                                                        ExfPurchDocLine.TESTFIELD("Prepmt. Amt. Inv.",0);
                                                                      ExfPurchDocLine.SETRANGE("Prepmt. Amt. Inv.");
                                                                    END;

                                                                    IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                      ExfPurchDocLine.SETFILTER("Return Qty. Shipped",'<>0')
                                                                    ELSE
                                                                      IF "Document Type" = "Document Type"::"Credit Memo" THEN BEGIN
                                                                        ExfPurchDocLine.SETRANGE("Buy-from Vendor No.",xRec."Buy-from Vendor No.");
                                                                        ExfPurchDocLine.SETFILTER("Return Shipment No.",'<>%1','');
                                                                      END;
                                                                    IF ExfPurchDocLine.FINDFIRST THEN
                                                                      IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                        ExfPurchDocLine.TESTFIELD("Return Qty. Shipped",0)
                                                                      ELSE
                                                                        ExfPurchDocLine.TESTFIELD("Return Shipment No.",'');

                                                                    ExfPurchDocLine.RESET;
                                                                  END ELSE BEGIN
                                                                    Rec := xRec;
                                                                    EXIT;
                                                                  END;
                                                                END;

                                                                GetVend("Buy-from Vendor No.");
                                                                IF CurrFieldNo <> 0 THEN BEGIN
                                                                  Vend.CheckBlockedVendOnDocs(Vend,FALSE);
                                                                  Vend.TESTFIELD("Vendor Posting Group");
                                                                END;
                                                                "Buy-from Vendor Name" := Vend.Name;
                                                                "Buy-from Vendor Name 2" := Vend."Name 2";
                                                                "Buy-from Address" := Vend.Address;
                                                                "Buy-from Address 2" := Vend."Address 2";
                                                                "Buy-from City" := Vend.City;
                                                                "Buy-from Post Code" := Vend."Post Code";
                                                                "Buy-from County" := Vend.County;
                                                                "Buy-from Country/Region Code" := Vend."Country/Region Code";
                                                                IF NOT SkipBuyFromContact THEN
                                                                  "Buy-from Contact" := Vend.Contact;
                                                                "Gen. Bus. Posting Group" := Vend."Gen. Bus. Posting Group";
                                                                "VAT Bus. Posting Group" := Vend."VAT Bus. Posting Group";
                                                                "Tax Area Code" := Vend."Tax Area Code";
                                                                "Tax Liable" := Vend."Tax Liable";
                                                                "VAT Country/Region Code" := Vend."Country/Region Code";
                                                                "VAT Registration No." := Vend."VAT Registration No.";
                                                                VALIDATE("Sell-to Customer No.",'');
                                                                VALIDATE("Location Code",UserMgt.GetLocation(1,Vend."Location Code",''));
                                                                //**4PS.sn
                                                                "VAT Prod. Posting Group" :=  Vend."VAT Prod. Posting Group";
                                                                //**4PS.en

                                                                IF "Buy-from Vendor No." = xRec."Pay-to Vendor No." THEN BEGIN
                                                                  IF ReceivedPurchLinesExist OR ReturnShipmentExist THEN BEGIN
                                                                    TESTFIELD("VAT Bus. Posting Group",xRec."VAT Bus. Posting Group");
                                                                    TESTFIELD("Gen. Bus. Posting Group",xRec."Gen. Bus. Posting Group");
                                                                  END;
                                                                END;

                                                                IF Vend."Pay-to Vendor No." <> '' THEN
                                                                  VALIDATE("Pay-to Vendor No.",Vend."Pay-to Vendor No.")
                                                                ELSE BEGIN
                                                                  IF "Buy-from Vendor No." = "Pay-to Vendor No." THEN
                                                                    SkipPayToContact := TRUE;
                                                                  VALIDATE("Pay-to Vendor No.","Buy-from Vendor No.");
                                                                  SkipPayToContact := FALSE;
                                                                END;
                                                                "Order Address Code" := '';

                                                                VALIDATE("Order Address Code");

                                                                IF CurrFieldNo <> 0 THEN
                                                                  IF ((xRec."Buy-from Vendor No." <> "Buy-from Vendor No.") AND (xRec."Buy-from Vendor No." <> '')) OR
                                                                     (xRec."Currency Code" <> "Currency Code") OR
                                                                     (xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group") OR
                                                                     (xRec."VAT Bus. Posting Group" <> "VAT Bus. Posting Group")
                                                                  THEN
                                                                    RecreatePurchLines(FIELDCAPTION("Buy-from Vendor No."));

                                                                Factoring := Vend.Factoring;

                                                                "Block Document" := "Block Document"::" ";
                                                                IF ExFlowVend.GET("Buy-from Vendor No.") THEN BEGIN
                                                                  "Receipt No. Mandatory" := ExFlowVend."Receipt No. Mandatory";

                                                                  IF ExFlowVend."Template Rule" <> '' THEN
                                                                    VALIDATE("Template Rule",ExFlowVend."Template Rule");

                                                                  IF ExFlowVend."Block Journal" THEN BEGIN
                                                                    IF ExFlowVend."Do not block Jnl Doc No starts" <> '' THEN BEGIN
                                                                      TempStrLen := STRLEN(ExFlowVend."Do not block Jnl Doc No starts");
                                                                      IF ExFlowVend."Do not block Jnl Doc No starts" <> COPYSTR("Vendor Document No.",1,TempStrLen) THEN
                                                                        "Block Document" := "Block Document"::Creation;
                                                                    END
                                                                    ELSE
                                                                      "Block Document" := "Block Document"::Creation;
                                                                  END;
                                                                END;

                                                                ExFlowSetup.GET;
                                                                "Propose Line" := ExFlowSetup."Propose Line";
                                                                "Propose VAT Line" := ExFlowSetup."Propose VAT Line";
                                                                GetDefaultPropAccounts(Rec);

                                                                GetDefaultVATPerc("Default VAT Prod. Post. Group","Default VAT %");

                                                                IF "Document Amount" <> 0 THEN
                                                                  "Calculated VAT %" := ROUND(100 * "Document Amount VAT" / "Document Amount",0.1);

                                                                IF "Propose VAT Line" THEN
                                                                  GetVATLineVATProdPostGroup("VAT Line VAT Prod. Post. Gr.","VAT Line G/L Account");

                                                                IF ("Buy-from Vendor No." <> xRec."Buy-from Vendor No.") AND ("Vendor ID" <> '') AND
                                                                   ("Buy-from Vendor No." <> '') AND (NOT HideValidationDialog) THEN
                                                                  VendorIDMgt.AddFromImportForm("Vendor ID","Buy-from Vendor No.");

                                                                IF ("Buy-from Vendor No." <> xRec."Buy-from Vendor No.") AND (CurrFieldNo <> 0) AND
                                                                  ExPurchImpHeader2.GET("Inbound Document No.") THEN BEGIN
                                                                  MODIFY;

                                                                  IF Rec."ExFlow Entry Type" <> "ExFlow Entry Type"::"OCR Import" THEN
                                                                    IF Reference <> '' THEN
                                                                      lcduExfVerifyDoc.InsertRefDim(Rec);

                                                                  lcduExfVerifyDoc.RUN(Rec);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Buy-from Vendor No.;
                                                              SVE=Leverant”rsnr] }
    { 4   ;   ;Pay-to Vendor No.   ;Code20        ;TableRelation=Vendor;
                                                   OnValidate=VAR
                                                                ExFlowValidateDoc@1100285002 : Codeunit 12013594;
                                                                TempCurrencyCode@1100285001 : Code[20];
                                                                ExWatchMgt@1100285003 : Codeunit 12013685;
                                                              BEGIN
                                                                IF (xRec."Pay-to Vendor No." <> "Pay-to Vendor No.") AND ("Pay-to Vendor No." <> '') THEN
                                                                  ExWatchMgt.CheckPurchHead(Rec);

                                                                IF (xRec."Pay-to Vendor No." <> "Pay-to Vendor No.") AND
                                                                   (xRec."Pay-to Vendor No." <> '')
                                                                THEN BEGIN
                                                                  IF HideValidationDialog THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed := CONFIRM(Text004,FALSE,FIELDCAPTION("Pay-to Vendor No."));
                                                                  IF Confirmed THEN BEGIN
                                                                    CheckRevertPrePost;
                                                                    ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");

                                                                    IF "Document Type" = "Document Type"::Order THEN
                                                                      ExfPurchDocLine.SETFILTER("Quantity Received",'<>0');
                                                                    IF "Document Type" = "Document Type"::Invoice THEN
                                                                      ExfPurchDocLine.SETFILTER("Receipt No.",'<>%1','');
                                                                    IF ExfPurchDocLine.FINDFIRST THEN
                                                                      IF "Document Type" = "Document Type"::Order THEN
                                                                        ExfPurchDocLine.TESTFIELD("Quantity Received",0)
                                                                      ELSE
                                                                        ExfPurchDocLine.TESTFIELD("Receipt No.",'');

                                                                    ExfPurchDocLine.SETRANGE("Receipt No.");
                                                                    ExfPurchDocLine.SETRANGE("Quantity Received");

                                                                    IF "Document Type" = "Document Type"::Order THEN BEGIN
                                                                      ExfPurchDocLine.SETFILTER("Prepmt. Amt. Inv.",'<>0');
                                                                      IF ExfPurchDocLine.FIND('-') THEN
                                                                        ExfPurchDocLine.TESTFIELD("Prepmt. Amt. Inv.",0);
                                                                      ExfPurchDocLine.SETRANGE("Prepmt. Amt. Inv.");
                                                                    END;

                                                                    IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                      ExfPurchDocLine.SETFILTER("Return Qty. Shipped",'<>0');
                                                                    IF "Document Type" = "Document Type"::"Credit Memo" THEN
                                                                      ExfPurchDocLine.SETFILTER("Return Shipment No.",'<>%1','');
                                                                    IF ExfPurchDocLine.FINDFIRST THEN
                                                                      IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                        ExfPurchDocLine.TESTFIELD("Return Qty. Shipped",0)
                                                                      ELSE
                                                                        ExfPurchDocLine.TESTFIELD("Return Shipment No.",'');

                                                                    ExfPurchDocLine.RESET;
                                                                  END ELSE
                                                                    Rec."Pay-to Vendor No." := xRec."Pay-to Vendor No.";
                                                                END;

                                                                GetVend("Pay-to Vendor No.");
                                                                IF CurrFieldNo <> 0 THEN BEGIN
                                                                  Vend.CheckBlockedVendOnDocs(Vend,FALSE);
                                                                  Vend.TESTFIELD("Vendor Posting Group");
                                                                END;

                                                                "Pay-to Name" := Vend.Name;
                                                                "Pay-to Name 2" := Vend."Name 2";
                                                                "Pay-to Address" := Vend.Address;
                                                                "Pay-to Address 2" := Vend."Address 2";
                                                                "Pay-to City" := Vend.City;
                                                                "Pay-to Post Code" := Vend."Post Code";
                                                                "Pay-to County" := Vend.County;
                                                                "Pay-to Country/Region Code" := Vend."Country/Region Code";
                                                                "VAT Country/Region Code" := Vend."Country/Region Code";
                                                                IF NOT SkipPayToContact THEN
                                                                  "Pay-to Contact" := Vend.Contact;
                                                                "Payment Terms Code" := Vend."Payment Terms Code";

                                                                IF "Document Type" = "Document Type"::"Credit Memo" THEN BEGIN
                                                                  "Payment Method Code" := '';
                                                                  IF PaymentTerms.GET("Payment Terms Code") THEN
                                                                    IF PaymentTerms."Calc. Pmt. Disc. on Cr. Memos" THEN
                                                                      "Payment Method Code" := Vend."Payment Method Code"
                                                                END ELSE
                                                                  "Payment Method Code" := Vend."Payment Method Code";

                                                                "Shipment Method Code" := Vend."Shipment Method Code";
                                                                "Vendor Posting Group" := Vend."Vendor Posting Group";
                                                                GLSetup.GET;
                                                                IF GLSetup."Bill-to/Sell-to VAT Calc." = GLSetup."Bill-to/Sell-to VAT Calc."::"Bill-to/Pay-to No." THEN BEGIN
                                                                  "VAT Bus. Posting Group" := Vend."VAT Bus. Posting Group";
                                                                  "VAT Country/Region Code" := Vend."Country/Region Code";
                                                                  "VAT Registration No." := Vend."VAT Registration No.";
                                                                  "Gen. Bus. Posting Group" := Vend."Gen. Bus. Posting Group";
                                                                END;

                                                                "Prices Including VAT" := Vend."Prices Including VAT";

                                                                IF "Currency Code (Import)" <> '' THEN BEGIN
                                                                  TempCurrencyCode := ExFlowValidateDoc.OcrCurr("Currency Code (Import)", "Buy-from Vendor No.");
                                                                  IF "Currency Code" <> TempCurrencyCode THEN
                                                                    VALIDATE("Currency Code", TempCurrencyCode);
                                                                END
                                                                ELSE
                                                                  "Currency Code" := Vend."Currency Code";

                                                                "Invoice Disc. Code" := Vend."Invoice Disc. Code";
                                                                "Language Code" := Vend."Language Code";
                                                                "Purchaser Code" := Vend."Purchaser Code";
                                                                IF CurrFieldNo <> 0 THEN
                                                                  IF "Posting Date (Import)" <> 0D THEN
                                                                    "Document Date" := "Posting Date (Import)"
                                                                  ELSE
                                                                    "Document Date" := WORKDATE;

                                                                VALIDATE("Payment Terms Code");
                                                                VALIDATE("Payment Method Code");
                                                                VALIDATE("Currency Code");
                                                                VALIDATE("Creditor No.",Vend."Creditor No.");

                                                                IF ExFlowSetup."Automatic Pre. Reg. of Inwards" THEN
                                                                   "Pre Posting" := "Pre Posting"::"Pre Post";

                                                                IF "Pay-to Vendor No." = xRec."Pay-to Vendor No." THEN BEGIN
                                                                  IF ReceivedPurchLinesExist THEN
                                                                    TESTFIELD("Currency Code",xRec."Currency Code");
                                                                END;

                                                                CreateDim(
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::Job,"Job No.",
                                                                  0,'');

                                                                IF (xRec."Buy-from Vendor No." = "Buy-from Vendor No.") AND
                                                                   (xRec."Pay-to Vendor No." <> "Pay-to Vendor No.")
                                                                   AND (CurrFieldNo <> 0)
                                                                THEN
                                                                  RecreatePurchLines(FIELDCAPTION("Pay-to Vendor No."));
                                                              END;

                                                   CaptionML=[ENU=Pay-to Vendor No.;
                                                              SVE=Betalas leverant”rsnr];
                                                   NotBlank=Yes }
    { 5   ;   ;Pay-to Name         ;Text50        ;CaptionML=[ENU=Pay-to Name;
                                                              SVE=Betalas namn] }
    { 6   ;   ;Pay-to Name 2       ;Text50        ;CaptionML=[ENU=Pay-to Name 2;
                                                              SVE=Betalas namn 2] }
    { 7   ;   ;Pay-to Address      ;Text50        ;CaptionML=[ENU=Pay-to Address;
                                                              SVE=Betalas adress] }
    { 8   ;   ;Pay-to Address 2    ;Text50        ;CaptionML=[ENU=Pay-to Address 2;
                                                              SVE=Betalas adress 2] }
    { 9   ;   ;Pay-to City         ;Text30        ;CaptionML=[ENU=Pay-to City;
                                                              SVE=Betalas ort] }
    { 10  ;   ;Pay-to Contact      ;Text50        ;CaptionML=[ENU=Pay-to Contact;
                                                              SVE=Betalas kontaktperson] }
    { 11  ;   ;Your Reference      ;Text30        ;CaptionML=[ENU=Your Reference;
                                                              SVE=Er referens] }
    { 12  ;   ;Ship-to Code        ;Code10        ;TableRelation="Ship-to Address".Code WHERE (Customer No.=FIELD(Sell-to Customer No.));
                                                   CaptionML=[ENU=Ship-to Code;
                                                              SVE=Leveransadresskod] }
    { 13  ;   ;Ship-to Name        ;Text50        ;CaptionML=[ENU=Ship-to Name;
                                                              SVE=Leveransnamn] }
    { 14  ;   ;Ship-to Name 2      ;Text50        ;CaptionML=[ENU=Ship-to Name 2;
                                                              SVE=Leveransnamn 2] }
    { 15  ;   ;Ship-to Address     ;Text50        ;CaptionML=[ENU=Ship-to Address;
                                                              SVE=Leveransadress] }
    { 16  ;   ;Ship-to Address 2   ;Text50        ;CaptionML=[ENU=Ship-to Address 2;
                                                              SVE=Leveransadress 2] }
    { 17  ;   ;Ship-to City        ;Text30        ;CaptionML=[ENU=Ship-to City;
                                                              SVE=Leveransort] }
    { 18  ;   ;Ship-to Contact     ;Text50        ;CaptionML=[ENU=Ship-to Contact;
                                                              SVE=Leveranskontaktperson] }
    { 19  ;   ;Order Date          ;Date          ;CaptionML=[ENU=Order Date;
                                                              SVE=Orderdatum] }
    { 20  ;   ;Posting Date        ;Date          ;OnValidate=BEGIN
                                                                ExFlowSetup.GET;
                                                                IF ExFlowSetup."Set Document Date To" = ExFlowSetup."Set Document Date To"::"Posting Date" THEN
                                                                  VALIDATE("Document Date","Posting Date");

                                                                IF ("Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"]) AND
                                                                   NOT ("Posting Date" = xRec."Posting Date")
                                                                THEN BEGIN
                                                                  PriceMessageIfPurchLinesExist(FIELDCAPTION("Posting Date"));
                                                                END;

                                                                IF "Currency Code" <> '' THEN BEGIN
                                                                  UpdateCurrencyFactor;
                                                                  IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                    ConfirmUpdateCurrencyFactor;
                                                                END;

                                                                IF "Posting Date" <> xRec."Posting Date" THEN
                                                                  IF ExPeriodicMgt.DeferralHeadersExist("Document Type","Inbound Document No.") THEN
                                                                    ConfirmUpdateDeferralDate;

                                                                IF PurchLinesExist THEN
                                                                  JobUpdatePurchLines;
                                                              END;

                                                   CaptionML=[ENU=Posting Date;
                                                              SVE=Bokf”ringsdatum] }
    { 21  ;   ;Expected Receipt Date;Date         ;OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Expected Receipt Date"));
                                                              END;

                                                   CaptionML=[ENU=Expected Receipt Date;
                                                              SVE=F”rv„ntat inleveransdatum] }
    { 22  ;   ;Posting Description ;Text50        ;CaptionML=[ENU=Posting Description;
                                                              SVE=Bokf”ringsbeskrivning] }
    { 23  ;   ;Payment Terms Code  ;Code10        ;TableRelation="Payment Terms";
                                                   OnValidate=VAR
                                                                UseDueDateFromImport@1100285000 : Boolean;
                                                              BEGIN
                                                                IF ("Payment Terms Code" <> '') AND ("Document Date" <> 0D) THEN BEGIN
                                                                  PaymentTerms.GET("Payment Terms Code");
                                                                  IF (("Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"]) AND
                                                                      NOT PaymentTerms."Calc. Pmt. Disc. on Cr. Memos")
                                                                  THEN BEGIN
                                                                    VALIDATE("Due Date","Document Date");
                                                                    VALIDATE("Pmt. Discount Date",0D);
                                                                    VALIDATE("Payment Discount %",0);
                                                                  END ELSE BEGIN
                                                                    "Due Date" := CALCDATE(PaymentTerms."Due Date Calculation","Document Date");
                                                                    "Pmt. Discount Date" := CALCDATE(PaymentTerms."Discount Date Calculation","Document Date");
                                                                    IF NOT UpdateDocumentDate THEN
                                                                      VALIDATE("Payment Discount %",PaymentTerms."Discount %")
                                                                  END;
                                                                END ELSE BEGIN
                                                                  VALIDATE("Due Date","Document Date");
                                                                  IF NOT UpdateDocumentDate THEN BEGIN
                                                                    VALIDATE("Pmt. Discount Date",0D);
                                                                    VALIDATE("Payment Discount %",0);
                                                                  END;
                                                                END;

                                                                UseDueDateFromImport := TRUE;
                                                                IF VendorAdvOpt.GET("Pay-to Vendor No.") THEN BEGIN
                                                                  IF VendorAdvOpt."Set Due Date To (OCR)" = VendorAdvOpt."Set Due Date To (OCR)"::"From Payment Term" THEN
                                                                    UseDueDateFromImport := FALSE
                                                                  ELSE
                                                                    IF VendorAdvOpt."Set Due Date To (OCR)" = VendorAdvOpt."Set Due Date To (OCR)"::"From ExFlow Setup" THEN BEGIN
                                                                      ExFlowSetup.GET;
                                                                      IF ExFlowSetup."Set Due Date To (OCR)" = ExFlowSetup."Set Due Date To (OCR)"::"From Payment Term" THEN
                                                                        UseDueDateFromImport := FALSE;
                                                                    END;
                                                                END
                                                                ELSE BEGIN
                                                                  ExFlowSetup.GET;
                                                                  IF ExFlowSetup."Set Due Date To (OCR)" = ExFlowSetup."Set Due Date To (OCR)"::"From Payment Term" THEN
                                                                    UseDueDateFromImport := FALSE;
                                                                END;

                                                                IF UseDueDateFromImport THEN BEGIN
                                                                  IF (CurrFieldNo <> 0) AND (CurrFieldNo <> FIELDNO("Payment Terms Code")) AND ("Due Days (Import)" <> 0) THEN
                                                                    ExfValidatePurchDoc.CalcIntDate("Document Date","Due Days (Import)");

                                                                  IF (CurrFieldNo <> 0) AND (CurrFieldNo <> FIELDNO("Payment Terms Code")) AND ("Due Date (Import)" <> 0D) THEN
                                                                    "Due Date" := "Due Date (Import)";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Payment Terms Code;
                                                              SVE=Betalningsvillkorskod] }
    { 24  ;   ;Due Date            ;Date          ;CaptionML=[ENU=Due Date;
                                                              SVE=F”rfallodatum] }
    { 25  ;   ;Payment Discount %  ;Decimal       ;OnValidate=BEGIN
                                                                GLSetup.GET;
                                                                IF "Payment Discount %" < GLSetup."VAT Tolerance %" THEN
                                                                  "VAT Base Discount %" := "Payment Discount %"
                                                                ELSE
                                                                  "VAT Base Discount %" := GLSetup."VAT Tolerance %";
                                                                VALIDATE("VAT Base Discount %");
                                                              END;

                                                   CaptionML=[ENU=Payment Discount %;
                                                              SVE=Kassarabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 26  ;   ;Pmt. Discount Date  ;Date          ;CaptionML=[ENU=Pmt. Discount Date;
                                                              SVE=Kassarabattsdatum] }
    { 27  ;   ;Shipment Method Code;Code10        ;TableRelation="Shipment Method";
                                                   CaptionML=[ENU=Shipment Method Code;
                                                              SVE=Leveransvillkorskod] }
    { 28  ;   ;Location Code       ;Code10        ;TableRelation=Location WHERE (Use As In-Transit=CONST(No));
                                                   OnValidate=BEGIN
                                                                IF ("Location Code" <> xRec."Location Code") AND
                                                                   (xRec."Buy-from Vendor No." = "Buy-from Vendor No.")
                                                                THEN
                                                                  UpdatePurchLines(FIELDCAPTION("Location Code"));
                                                              END;

                                                   CaptionML=[ENU=Location Code;
                                                              SVE=Lagerst„llekod] }
    { 29  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 1 Code;
                                                              SVE=Genv„g dimension 1 kod];
                                                   CaptionClass='1,2,1' }
    { 30  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                "* 4PS *"@1100285025 : Integer;
                                                                PurchSetup@1100285024 : Record 312;
                                                                PurchHeader@1100285023 : Record 38;
                                                                PurchLine2@1100285022 : Record 39;
                                                                ICProjSetupRec@1100285021 : Record 315;
                                                                ProjElemRec@1100285020 : Record 11012010;
                                                                ProjTypeRec@1100285019 : Record 11012009;
                                                                ExtensionContract@1100285018 : Record 11012004;
                                                                PlantSetup@1100285017 : Record 11012550;
                                                                PlantTypeRec@1100285016 : Record 11012551;
                                                                PlantNoRec@1100285015 : Record 11012552;
                                                                CostCompPlantRec@1100285014 : Record 11012575;
                                                                PlantPostingSetup@1100285013 : Record 11012570;
                                                                InvtSetup@1100285012 : Record 313;
                                                                ItemRec@1100285011 : Record 27;
                                                                ProjRec@1100285010 : Record 11072003;
                                                                PlantVendorRec@1100285009 : Record 11012596;
                                                                PlantVendorType@1100285008 : Option;
                                                                ElementFormat@1100285007 : Codeunit 11012022;
                                                                ValidateCu@1100285006 : Codeunit 11012033;
                                                                HideDialog@1100285005 : Boolean;
                                                                SaveFieldNo@1100285004 : Integer;
                                                                ItemTypeOpt@1100285003 : 'Item,Basic Item,Trade Item,Trade Vendor';
                                                                DimVal2Rec@1100285002 : Record 349;
                                                                Dim1@1100285001 : Code[20];
                                                                Dim2@1100285000 : Code[20];
                                                                ServOrderRec@1101285000 : Record 11012823;
                                                                ServTypeRec@1101285001 : Record 11012814;
                                                              BEGIN
                                                                //4PS
                                                                IF "Shortcut Dimension 2 Code" <> xRec."Shortcut Dimension 2 Code" THEN BEGIN
                                                                  ExfPurchDocLine.RESET;
                                                                  ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
                                                                  ExfPurchDocLine.SETFILTER("Exflow-Created Entry", '>0');
                                                                  ExfPurchDocLine.DELETEALL;
                                                                  VALIDATE("Prop. Line G/L Account",'')
                                                                END;

                                                                IF ("Shortcut Dimension 2 Code" <> '') THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimVal2Rec, TRUE, "Job No.");
                                                                  DimVal2Rec.TESTFIELD(Blocked, FALSE);

                                                                  IF ("Job No." <> '') THEN BEGIN

                                                                    DimMgt.GetDimValueRec(2, "Shortcut Dimension 2 Code", DimVal2Rec, TRUE, "Job No.");
                                                                    DimVal2Rec.TESTFIELD(Blocked, FALSE);

                                                                    ICProjSetupRec.GET;
                                                                    ProjRec.GET("Job No.");
                                                                    ProjRec.TESTFIELD("Project Type");
                                                                    ProjTypeRec.GET(ProjRec."Project Type");
                                                                    "Shortcut Dimension 1 Code" := ProjRec."Global Dimension 1 Code";
                                                                    ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                                    "Prop. Line G/L Account" := ProjTypeRec.GetWipAcc(ProjTypeRec.Code,
                                                                                                       DimVal2Rec."Cost Type",
                                                                                                       ProjRec."Project Status",
                                                                                                       ICProjSetupRec."Provisions at Closure",
                                                                                                       COMPANYNAME,
                                                                                                       DimVal2Rec."Cost Type" + 1, "Buy-from Vendor No.",'');
                                                                     VALIDATE("Prop. Line G/L Account");


                                                                  END ELSE IF "Service Order No." <> '' THEN BEGIN
                                                                    //******* Service Order *********************************************************
                                                                    ExfPurchDocLine.RESET;
                                                                    ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
                                                                    ExfPurchDocLine.SETFILTER("Exflow-Created Entry", '>0');
                                                                    ExfPurchDocLine.DELETEALL;

                                                                    ServOrderRec.GET("Service Order No.");
                                                                    //IF ServOrderRec."Additional Cost (Service)" = TRUE THEN BEGIN
                                                                    //  ServOrderRec.TESTFIELD("Service Type (Other)");
                                                                    //  ServTypeRec.GET(ServOrderRec."Service Type (Other)");
                                                                    //END ELSE BEGIN
                                                                      ServOrderRec.TESTFIELD("Service Type");
                                                                      ServTypeRec.GET(ServOrderRec."Service Type");
                                                                    //END;

                                                                     "Prop. Line G/L Account" := ServTypeRec.GetWipAcc(ServTypeRec.Code,
                                                                                                    DimVal2Rec."Cost Type",
                                                                                                    COMPANYNAME,
                                                                                                    DimVal2Rec."Cost Type",
                                                                                                    PurchHeader."Buy-from Vendor No.",'');

                                                                    VALIDATE("Prop. Line G/L Account");
                                                                    //IF "Additional Cost (Service)" = TRUE THEN
                                                                    //  VALIDATE("Shortcut Dimension 1 Code", ServOrderRec."Department Code (Other)")
                                                                    //ELSE
                                                                    VALIDATE("Shortcut Dimension 1 Code", ServOrderRec."Global Dimension 1 Code");
                                                                  END;
                                                                END;

                                                                //4PS
                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                                //4PS
                                                                  IF "Shortcut Dimension 2 Code" <> xRec."Shortcut Dimension 2 Code" THEN
                                                                    UpdatePurchLines(FIELDCAPTION("Shortcut Dimension 2 Code"));
                                                                //4PS
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 2 Code;
                                                              SVE=Genv„g dimension 2 kod];
                                                   CaptionClass='1,2,2' }
    { 31  ;   ;Vendor Posting Group;Code20        ;TableRelation="Vendor Posting Group";
                                                   CaptionML=[ENU=Vendor Posting Group;
                                                              SVE=Leverant”rsbokf”ringsmall];
                                                   Editable=No }
    { 32  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                IF (CurrFieldNo <> FIELDNO("Currency Code")) AND ("Currency Code" = xRec."Currency Code") THEN
                                                                  UpdateCurrencyFactor
                                                                ELSE BEGIN
                                                                  IF "Currency Code" <> xRec."Currency Code" THEN BEGIN
                                                                    UpdateCurrencyFactor;
                                                                    IF PurchLinesExist THEN
                                                                      IF HideValidationDialog THEN
                                                                        RecreatePurchLines(FIELDCAPTION("Currency Code"))
                                                                      ELSE
                                                                        IF CONFIRM(ChangeCurrencyQst,FALSE,FIELDCAPTION("Currency Code")) THEN BEGIN
                                                                          SetHideValidationDialog(TRUE);
                                                                          RecreatePurchLines(FIELDCAPTION("Currency Code"));
                                                                          SetHideValidationDialog(FALSE);
                                                                        END ELSE
                                                                          ERROR(Text018,FIELDCAPTION("Currency Code"));
                                                                  END ELSE
                                                                    IF "Currency Code" <> '' THEN BEGIN
                                                                      UpdateCurrencyFactor;
                                                                      IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                        ConfirmUpdateCurrencyFactor;
                                                                    END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              SVE=Valutakod] }
    { 33  ;   ;Currency Factor     ;Decimal       ;OnValidate=BEGIN
                                                                IF "Currency Factor" <> xRec."Currency Factor" THEN
                                                                  UpdatePurchLines(FIELDCAPTION("Currency Factor"));
                                                              END;

                                                   CaptionML=[ENU=Currency Factor;
                                                              SVE=Valutafaktor];
                                                   DecimalPlaces=0:15;
                                                   MinValue=0;
                                                   Editable=Yes }
    { 35  ;   ;Prices Including VAT;Boolean       ;OnValidate=VAR
                                                                ExfPurchDocLine@1000 : Record 12013588;
                                                                Currency@1001 : Record 4;
                                                                RecalculatePrice@1002 : Boolean;
                                                              BEGIN
                                                                IF "Prices Including VAT" <> xRec."Prices Including VAT" THEN BEGIN
                                                                  ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
                                                                  ExfPurchDocLine.SETFILTER("Direct Unit Cost",'<>%1',0);
                                                                  ExfPurchDocLine.SETFILTER("VAT %",'<>%1',0);
                                                                  IF ExfPurchDocLine.FINDFIRST THEN BEGIN
                                                                    RecalculatePrice :=
                                                                      CONFIRM(
                                                                        STRSUBSTNO(
                                                                          EXF025 +
                                                                          EXF027,
                                                                          FIELDCAPTION("Prices Including VAT"),ExfPurchDocLine.FIELDCAPTION("Direct Unit Cost")),
                                                                        TRUE);
                                                                    ExfPurchDocLine.SetExfPurchDocHeader(Rec);

                                                                    IF "Currency Code" = '' THEN
                                                                      Currency.InitRoundingPrecision
                                                                    ELSE
                                                                      Currency.GET("Currency Code");

                                                                    REPEAT
                                                                      ExfPurchDocLine.TESTFIELD("Quantity Invoiced",0);
                                                                      ExfPurchDocLine.TESTFIELD("Prepmt. Amt. Inv.",0);
                                                                      IF NOT RecalculatePrice THEN BEGIN
                                                                        ExfPurchDocLine."VAT Difference" := 0;
                                                                        ExfPurchDocLine.InitOutstandingAmount;
                                                                      END ELSE
                                                                        IF "Prices Including VAT" THEN BEGIN
                                                                          ExfPurchDocLine."Direct Unit Cost" :=
                                                                            ROUND(
                                                                              ExfPurchDocLine."Direct Unit Cost" * (1 + ExfPurchDocLine."VAT %" / 100),
                                                                              Currency."Unit-Amount Rounding Precision");
                                                                          IF ExfPurchDocLine.Quantity <> 0 THEN BEGIN
                                                                            ExfPurchDocLine."Line Discount Amount" :=
                                                                              ROUND(
                                                                                ExfPurchDocLine.Quantity * ExfPurchDocLine."Direct Unit Cost" * ExfPurchDocLine."Line Discount %" / 100,
                                                                                Currency."Amount Rounding Precision");
                                                                            ExfPurchDocLine.VALIDATE("Inv. Discount Amount",
                                                                              ROUND(
                                                                                ExfPurchDocLine."Inv. Discount Amount" * (1 + ExfPurchDocLine."VAT %" / 100),
                                                                                Currency."Amount Rounding Precision"));
                                                                          END;
                                                                        END ELSE BEGIN
                                                                          ExfPurchDocLine."Direct Unit Cost" :=
                                                                            ROUND(
                                                                              ExfPurchDocLine."Direct Unit Cost" / (1 + ExfPurchDocLine."VAT %" / 100),
                                                                              Currency."Unit-Amount Rounding Precision");
                                                                          IF ExfPurchDocLine.Quantity <> 0 THEN BEGIN
                                                                            ExfPurchDocLine."Line Discount Amount" :=
                                                                              ROUND(
                                                                                ExfPurchDocLine.Quantity * ExfPurchDocLine."Direct Unit Cost" * ExfPurchDocLine."Line Discount %" / 100,
                                                                                Currency."Amount Rounding Precision");
                                                                            ExfPurchDocLine.VALIDATE("Inv. Discount Amount",
                                                                              ROUND(
                                                                                ExfPurchDocLine."Inv. Discount Amount" / (1 + ExfPurchDocLine."VAT %" / 100),
                                                                                Currency."Amount Rounding Precision"));
                                                                          END;
                                                                        END;
                                                                      ExfPurchDocLine.MODIFY;
                                                                    UNTIL ExfPurchDocLine.NEXT = 0;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Prices Including VAT;
                                                              SVE=Priser inkl. moms] }
    { 37  ;   ;Invoice Disc. Code  ;Code20        ;OnValidate=BEGIN
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Invoice Disc. Code"));
                                                              END;

                                                   CaptionML=[ENU=Invoice Disc. Code;
                                                              SVE=Fakturarabattkod] }
    { 41  ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   OnValidate=BEGIN
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Language Code"));
                                                              END;

                                                   CaptionML=[ENU=Language Code;
                                                              SVE=Spr†kkod] }
    { 43  ;   ;Purchaser Code      ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::Job,"Job No.",
                                                                  0,'');
                                                              END;

                                                   CaptionML=[ENU=Purchaser Code;
                                                              SVE=Ink”parkod] }
    { 45  ;   ;Order Class         ;Code10        ;CaptionML=[ENU=Order Class;
                                                              SVE=Orderstatistiknr] }
    { 46  ;   ;Comment             ;Boolean       ;FieldClass=Normal;
                                                   CaptionML=[ENU=Comment;
                                                              SVE=Kommentar];
                                                   Editable=No }
    { 47  ;   ;No. Printed         ;Integer       ;CaptionML=[ENU=No. Printed;
                                                              SVE=Utskriven];
                                                   Editable=No }
    { 51  ;   ;On Hold             ;Code3         ;CaptionML=[ENU=On Hold;
                                                              SVE=Stoppad] }
    { 52  ;   ;Applies-to Doc. Type;Option        ;CaptionML=[ENU=Applies-to Doc. Type;
                                                              SVE=Kopplas till dokumenttyp];
                                                   OptionCaptionML=[ENU=" ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund";
                                                                    SVE=" ,Betalning,Faktura,Kreditnota,R„ntefaktura,Betalningsp†minnelse,terbetalning"];
                                                   OptionString=[ ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund] }
    { 53  ;   ;Applies-to Doc. No. ;Code20        ;OnValidate=BEGIN
                                                                IF "Applies-to Doc. No." <> '' THEN
                                                                  TESTFIELD("Bal. Account No.",'');

                                                                IF ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") AND (xRec."Applies-to Doc. No." <> '') AND
                                                                   ("Applies-to Doc. No." <> '')
                                                                THEN BEGIN
                                                                  SetAmountToApply("Applies-to Doc. No.","Buy-from Vendor No.");
                                                                  SetAmountToApply(xRec."Applies-to Doc. No.","Buy-from Vendor No.");
                                                                END ELSE
                                                                  IF ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") AND (xRec."Applies-to Doc. No." = '') THEN
                                                                    SetAmountToApply("Applies-to Doc. No.","Buy-from Vendor No.")
                                                                  ELSE IF ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") AND ("Applies-to Doc. No." = '') THEN
                                                                      SetAmountToApply(xRec."Applies-to Doc. No.","Buy-from Vendor No.");
                                                              END;

                                                   OnLookup=BEGIN
                                                              TESTFIELD("Bal. Account No.",'');
                                                              VendLedgEntry.SETCURRENTKEY("Vendor No.",Open,Positive,"Due Date");
                                                              VendLedgEntry.SETRANGE("Vendor No.","Pay-to Vendor No.");
                                                              VendLedgEntry.SETRANGE(Open,TRUE);
                                                              IF "Applies-to Doc. No." <> '' THEN BEGIN
                                                                VendLedgEntry.SETRANGE("Document Type","Applies-to Doc. Type");
                                                                VendLedgEntry.SETRANGE("Document No.","Applies-to Doc. No.");
                                                                IF VendLedgEntry.FINDFIRST THEN;
                                                                VendLedgEntry.SETRANGE("Document Type");
                                                                VendLedgEntry.SETRANGE("Document No.");
                                                              END ELSE IF "Applies-to Doc. Type" <> 0 THEN BEGIN
                                                                  VendLedgEntry.SETRANGE("Document Type","Applies-to Doc. Type");
                                                                  IF VendLedgEntry.FINDFIRST THEN;
                                                                  VendLedgEntry.SETRANGE("Document Type");
                                                                END ELSE IF Amount <> 0 THEN BEGIN
                                                                    VendLedgEntry.SETRANGE(Positive,Amount < 0);
                                                                    IF VendLedgEntry.FINDFIRST THEN;
                                                                    VendLedgEntry.SETRANGE(Positive);
                                                                  END;

                                                              PurchHeadTemp.TRANSFERFIELDS(Rec);
                                                              ApplyVendEntries.SetPurch(PurchHeadTemp,VendLedgEntry,PurchHeadTemp.FIELDNO("Applies-to Doc. No."));
                                                              ApplyVendEntries.SETTABLEVIEW(VendLedgEntry);
                                                              ApplyVendEntries.SETRECORD(VendLedgEntry);
                                                              ApplyVendEntries.LOOKUPMODE(TRUE);
                                                              IF ApplyVendEntries.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                                ApplyVendEntries.GetVendLedgEntry(VendLedgEntry);
                                                                GenJnlApply.CheckAgainstApplnCurrency(
                                                                  "Currency Code",VendLedgEntry."Currency Code",GenJnILine."Account Type"::Vendor,TRUE);
                                                                "Applies-to Doc. Type" := VendLedgEntry."Document Type";
                                                                "Applies-to Doc. No." := VendLedgEntry."Document No.";
                                                              END;
                                                              CLEAR(ApplyVendEntries);
                                                            END;

                                                   CaptionML=[ENU=Applies-to Doc. No.;
                                                              SVE=Kopplas till ver.nr] }
    { 55  ;   ;Bal. Account No.    ;Code20        ;TableRelation=IF (Bal. Account Type=CONST(G/L Account)) "G/L Account"
                                                                 ELSE IF (Bal. Account Type=CONST(Bank Account)) "Bank Account";
                                                   OnValidate=BEGIN
                                                                IF "Bal. Account No." <> '' THEN
                                                                  CASE "Bal. Account Type" OF
                                                                    "Bal. Account Type"::"G/L Account":
                                                                      BEGIN
                                                                        GLAcc.GET("Bal. Account No.");
                                                                        GLAcc.CheckGLAcc;
                                                                        GLAcc.TESTFIELD("Direct Posting",TRUE);
                                                                      END;
                                                                    "Bal. Account Type"::"Bank Account":
                                                                      BEGIN
                                                                        BankAcc.GET("Bal. Account No.");
                                                                        BankAcc.TESTFIELD(Blocked,FALSE);
                                                                        BankAcc.TESTFIELD("Currency Code","Currency Code");
                                                                      END;
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Bal. Account No.;
                                                              SVE=Motkonto] }
    { 56  ;   ;Job No.             ;Code20        ;TableRelation=Job;
                                                   OnValidate=VAR
                                                                Job@1100285000 : Record 11072003;
                                                                lcduExfVerifyDoc@1000000000 : Codeunit 12013594;
                                                              BEGIN
                                                                IF "Job No." = '' THEN BEGIN
                                                                  CreateDim(
                                                                    DATABASE::Job,"Job No.",
                                                                    DATABASE::Vendor,"Pay-to Vendor No.",
                                                                    DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                    0,'');

                                                                  EXIT;
                                                                END;

                                                                Job.GET("Job No.");
                                                                Job.TestBlocked;

                                                                CreateDim(
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code",
                                                                  0,'');

                                                                //4PS
                                                                IF "Shortcut Dimension 2 Code" = '' THEN BEGIN
                                                                  ExFlowSetup.GET;
                                                                  IF ExFlowSetup."Default Cost Object (Job)" <> '' THEN
                                                                    VALIDATE("Shortcut Dimension 2 Code",ExFlowSetup."Default Cost Object (Job)");
                                                                  IF CurrFieldNo <> 0 THEN
                                                                    lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE,TRUE);
                                                                END;
                                                                //4PS

                                                                UpdatePurchLines(FIELDCAPTION("Job No."));
                                                              END;

                                                   CaptionML=[ENU=Job No.;
                                                              SVE=Projektnr] }
    { 57  ;   ;Receive             ;Boolean       ;CaptionML=[ENU=Receive;
                                                              SVE=Inleverera] }
    { 58  ;   ;Invoice             ;Boolean       ;CaptionML=[ENU=Invoice;
                                                              SVE=Faktura] }
    { 60  ;   ;Amount              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line".Amount WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 61  ;   ;Amount Including VAT;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line"."Amount Including VAT" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount Including VAT;
                                                              SVE=Belopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 66  ;   ;Vendor Order No.    ;Code20        ;CaptionML=[ENU=Vendor Order No.;
                                                              SVE=Leverant”rens ordernr] }
    { 67  ;   ;Vendor Shipment No. ;Code20        ;CaptionML=[ENU=Vendor Shipment No.;
                                                              SVE=Leverant”rens leveransnr] }
    { 70  ;   ;VAT Registration No.;Text20        ;CaptionML=[ENU=VAT Registration No.;
                                                              SVE=Momsregistreringsnr] }
    { 72  ;   ;Sell-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=BEGIN
                                                                VALIDATE("Ship-to Code",'');
                                                              END;

                                                   CaptionML=[ENU=Sell-to Customer No.;
                                                              SVE=F”rs.kundnr] }
    { 73  ;   ;Reason Code         ;Code10        ;TableRelation="Reason Code";
                                                   CaptionML=[ENU=Reason Code;
                                                              SVE=Uppf”ljningskod] }
    { 74  ;   ;Gen. Bus. Posting Group;Code20     ;TableRelation="Gen. Business Posting Group";
                                                   OnValidate=BEGIN
                                                                IF (xRec."Buy-from Vendor No." = "Buy-from Vendor No.") AND
                                                                   (xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group")
                                                                THEN
                                                                  IF GenBusPostingGrp.ValidateVatBusPostingGroup(GenBusPostingGrp,"Gen. Bus. Posting Group") THEN BEGIN
                                                                    "VAT Bus. Posting Group" := GenBusPostingGrp."Def. VAT Bus. Posting Group";
                                                                    RecreatePurchLines(FIELDCAPTION("Gen. Bus. Posting Group"));
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Gen. Bus. Posting Group;
                                                              SVE=Gen. r”relsebokf”ringsmall] }
    { 76  ;   ;Transaction Type    ;Code10        ;TableRelation="Transaction Type";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Transaction Type"));
                                                              END;

                                                   CaptionML=[ENU=Transaction Type;
                                                              SVE=EU transaktionstyp] }
    { 77  ;   ;Transport Method    ;Code10        ;TableRelation="Transport Method";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Transport Method"));
                                                              END;

                                                   CaptionML=[ENU=Transport Method;
                                                              SVE=Transports„tt] }
    { 78  ;   ;VAT Country/Region Code;Code10     ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=VAT Country/Region Code;
                                                              SVE=Momskod f”r land/region] }
    { 79  ;   ;Buy-from Vendor Name;Text50        ;CaptionML=[ENU=Buy-from Vendor Name;
                                                              SVE=Leverant”rsnamn] }
    { 80  ;   ;Buy-from Vendor Name 2;Text50      ;CaptionML=[ENU=Buy-from Vendor Name 2;
                                                              SVE=Leverant”rsnamn 2] }
    { 81  ;   ;Buy-from Address    ;Text50        ;CaptionML=[ENU=Buy-from Address;
                                                              SVE=Leverant”rsadress] }
    { 82  ;   ;Buy-from Address 2  ;Text50        ;CaptionML=[ENU=Buy-from Address 2;
                                                              SVE=Leverant”rsadress 2] }
    { 83  ;   ;Buy-from City       ;Text30        ;CaptionML=[ENU=Buy-from City;
                                                              SVE=Leverant”rsort] }
    { 84  ;   ;Buy-from Contact    ;Text50        ;CaptionML=[ENU=Buy-from Contact;
                                                              SVE=Leverant”rskontakt] }
    { 85  ;   ;Pay-to Post Code    ;Code20        ;TableRelation="Post Code";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Pay-to Post Code;
                                                              SVE=Betalas postnr] }
    { 86  ;   ;Pay-to County       ;Text30        ;CaptionML=[ENU=Pay-to County;
                                                              SVE=Betalas delstat] }
    { 87  ;   ;Pay-to Country/Region Code;Code10  ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Pay-to Country/Region Code;
                                                              SVE=Lands-/regionkod f”r betalning] }
    { 88  ;   ;Buy-from Post Code  ;Code20        ;TableRelation="Post Code";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Buy-from Post Code;
                                                              SVE=Leverant”rspostnr] }
    { 89  ;   ;Buy-from County     ;Text30        ;CaptionML=[ENU=Buy-from County;
                                                              SVE=Leverant”rsdelstat] }
    { 90  ;   ;Buy-from Country/Region Code;Code10;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Buy-from Country/Region Code;
                                                              SVE=Lands-/regionkod f”r leverant”r] }
    { 91  ;   ;Ship-to Post Code   ;Code20        ;TableRelation="Post Code";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Ship-to Post Code;
                                                              SVE=Leveranspostnrkod] }
    { 92  ;   ;Ship-to County      ;Text30        ;CaptionML=[ENU=Ship-to County;
                                                              SVE=Leveransdelstat] }
    { 93  ;   ;Ship-to Country/Region Code;Code10 ;TableRelation=Country/Region;
                                                   CaptionML=[ENU=Ship-to Country/Region Code;
                                                              SVE=Kod f”r leveransland/-region] }
    { 94  ;   ;Bal. Account Type   ;Option        ;CaptionML=[ENU=Bal. Account Type;
                                                              SVE=Motkontotyp];
                                                   OptionCaptionML=[ENU=G/L Account,Bank Account;
                                                                    SVE=Konto,Bank];
                                                   OptionString=G/L Account,Bank Account }
    { 95  ;   ;Order Address Code  ;Code10        ;TableRelation="Order Address".Code WHERE (Vendor No.=FIELD(Buy-from Vendor No.));
                                                   OnValidate=BEGIN
                                                                IF "Order Address Code" <> '' THEN BEGIN
                                                                  OrderAddr.GET("Buy-from Vendor No.","Order Address Code");
                                                                  "Buy-from Vendor Name" := OrderAddr.Name;
                                                                  "Buy-from Vendor Name 2" := OrderAddr."Name 2";
                                                                  "Buy-from Address" := OrderAddr.Address;
                                                                  "Buy-from Address 2" := OrderAddr."Address 2";
                                                                  "Buy-from City" := OrderAddr.City;
                                                                  "Buy-from Contact" := OrderAddr.Contact;
                                                                  "Buy-from Post Code" := OrderAddr."Post Code";
                                                                  "Buy-from County" := OrderAddr.County;
                                                                  "Buy-from Country/Region Code" := OrderAddr."Country/Region Code";

                                                                  IF ("Document Type" = "Document Type"::"Return Order") OR
                                                                     ("Document Type" = "Document Type"::"Credit Memo")
                                                                  THEN BEGIN
                                                                    "Ship-to Name" := OrderAddr.Name;
                                                                    "Ship-to Name 2" := OrderAddr."Name 2";
                                                                    "Ship-to Address" := OrderAddr.Address;
                                                                    "Ship-to Address 2" := OrderAddr."Address 2";
                                                                    "Ship-to City" := OrderAddr.City;
                                                                    "Ship-to Post Code" := OrderAddr."Post Code";
                                                                    "Ship-to County" := OrderAddr.County;
                                                                    "Ship-to Country/Region Code" := OrderAddr."Country/Region Code";
                                                                    "Ship-to Contact" := OrderAddr.Contact;
                                                                  END

                                                                END ELSE BEGIN
                                                                  GetVend("Buy-from Vendor No.");
                                                                  "Buy-from Vendor Name" := Vend.Name;
                                                                  "Buy-from Vendor Name 2" := Vend."Name 2";
                                                                  "Buy-from Address" := Vend.Address;
                                                                  "Buy-from Address 2" := Vend."Address 2";
                                                                  "Buy-from City" := Vend.City;
                                                                  "Buy-from Contact" := Vend.Contact;
                                                                  "Buy-from Post Code" := Vend."Post Code";
                                                                  "Buy-from County" := Vend.County;
                                                                  "Buy-from Country/Region Code" := Vend."Country/Region Code";

                                                                  IF ("Document Type" = "Document Type"::"Return Order") OR
                                                                     ("Document Type" = "Document Type"::"Credit Memo")
                                                                  THEN BEGIN
                                                                    "Ship-to Name" := Vend.Name;
                                                                    "Ship-to Name 2" := Vend."Name 2";
                                                                    "Ship-to Address" := Vend.Address;
                                                                    "Ship-to Address 2" := Vend."Address 2";
                                                                    "Ship-to City" := Vend.City;
                                                                    "Ship-to Post Code" := Vend."Post Code";
                                                                    "Ship-to County" := Vend.County;
                                                                    "Ship-to Country/Region Code" := Vend."Country/Region Code";
                                                                    "Ship-to Contact" := Vend.Contact;
                                                                    "Shipment Method Code" := Vend."Shipment Method Code";
                                                                    IF Vend."Location Code" <> '' THEN
                                                                      VALIDATE("Location Code",Vend."Location Code");
                                                                  END

                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Order Address Code;
                                                              SVE=Ink”psadresskod] }
    { 97  ;   ;Entry Point         ;Code10        ;TableRelation="Entry/Exit Point";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Entry Point"));
                                                              END;

                                                   CaptionML=[ENU=Entry Point;
                                                              SVE=Inskeppningshamn] }
    { 98  ;   ;Correction          ;Boolean       ;CaptionML=[ENU=Correction;
                                                              SVE=R„ttningstransaktion] }
    { 99  ;   ;Document Date       ;Date          ;OnValidate=BEGIN
                                                                IF xRec."Document Date" <> "Document Date" THEN
                                                                  UpdateDocumentDate := TRUE;

                                                                VALIDATE("Payment Terms Code");
                                                              END;

                                                   CaptionML=[ENU=Document Date;
                                                              SVE=Dokumentdatum] }
    { 101 ;   ;Area                ;Code10        ;TableRelation=Area;
                                                   OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION(Area));
                                                              END;

                                                   CaptionML=[ENU=Area;
                                                              SVE=Omr†de] }
    { 102 ;   ;Transaction Specification;Code10   ;TableRelation="Transaction Specification";
                                                   OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Transaction Specification"));
                                                              END;

                                                   CaptionML=[ENU=Transaction Specification;
                                                              SVE=EU transaktionsspecifikation] }
    { 104 ;   ;Payment Method Code ;Code10        ;TableRelation="Payment Method";
                                                   OnValidate=BEGIN
                                                                PaymentMethod.INIT;
                                                                IF "Payment Method Code" <> '' THEN
                                                                  PaymentMethod.GET("Payment Method Code");
                                                                "Bal. Account Type" := PaymentMethod."Bal. Account Type";
                                                                "Bal. Account No." := PaymentMethod."Bal. Account No.";
                                                                IF "Bal. Account No." <> '' THEN BEGIN
                                                                  TESTFIELD("Applies-to Doc. No.",'');
                                                                  TESTFIELD("Applies-to ID",'');
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Payment Method Code;
                                                              SVE=Betalningss„tt] }
    { 114 ;   ;Tax Area Code       ;Code20        ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Tax Area Code"));
                                                              END;

                                                   CaptionML=[ENU=Tax Area Code;
                                                              SVE=Skatteomr†deskod] }
    { 115 ;   ;Tax Liable          ;Boolean       ;OnValidate=BEGIN
                                                                MessageIfPurchLinesExist(FIELDCAPTION("Tax Liable"));
                                                              END;

                                                   CaptionML=[ENU=Tax Liable;
                                                              SVE=Skattepliktig] }
    { 116 ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=BEGIN
                                                                IF (xRec."Buy-from Vendor No." = "Buy-from Vendor No.") AND
                                                                   (xRec."VAT Bus. Posting Group" <> "VAT Bus. Posting Group")
                                                                THEN BEGIN
                                                                  RecreatePurchLines(FIELDCAPTION("VAT Bus. Posting Group"));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=VAT Bus. Posting Group;
                                                              SVE=Moms r”relsebokf”ringsmall] }
    { 117 ;   ;Reserve             ;Option        ;CaptionML=[ENU=Reserve;
                                                              SVE=Reservera];
                                                   OptionCaptionML=[ENU=Never,Optional,Always;
                                                                    SVE=Aldrig,Valfri,Alltid];
                                                   OptionString=Never,Optional,Always }
    { 118 ;   ;Applies-to ID       ;Code20        ;OnValidate=VAR
                                                                TempVendLedgEntry@1100285000 : TEMPORARY Record 25;
                                                              BEGIN
                                                                IF "Applies-to ID" <> '' THEN
                                                                  TESTFIELD("Bal. Account No.",'');
                                                                IF ("Applies-to ID" <> xRec."Applies-to ID") AND (xRec."Applies-to ID" <> '') THEN BEGIN
                                                                  VendLedgEntry.SETCURRENTKEY("Vendor No.",Open);
                                                                  VendLedgEntry.SETRANGE("Vendor No.","Pay-to Vendor No.");
                                                                  VendLedgEntry.SETRANGE(Open,TRUE);
                                                                  VendLedgEntry.SETRANGE("Applies-to ID",xRec."Applies-to ID");
                                                                  IF VendLedgEntry.FINDFIRST THEN
                                                                    VendEntrySetApplID.SetApplId(VendLedgEntry,TempVendLedgEntry,'');
                                                                  VendLedgEntry.RESET;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Applies-to ID;
                                                              SVE=Koppla till ID] }
    { 119 ;   ;VAT Base Discount % ;Decimal       ;OnValidate=BEGIN
                                                                GLSetup.GET;
                                                                IF "VAT Base Discount %" > GLSetup."VAT Tolerance %" THEN BEGIN
                                                                  IF HideValidationDialog THEN
                                                                    Confirmed := TRUE
                                                                  ELSE
                                                                    Confirmed :=
                                                                      CONFIRM(
                                                                        Text007 +
                                                                        Text008,FALSE,
                                                                        FIELDCAPTION("VAT Base Discount %"),
                                                                        GLSetup.FIELDCAPTION("VAT Tolerance %"),
                                                                        GLSetup.TABLECAPTION);
                                                                  IF NOT Confirmed THEN
                                                                    "VAT Base Discount %" := xRec."VAT Base Discount %";
                                                                END;

                                                                IF ("VAT Base Discount %" = xRec."VAT Base Discount %") AND
                                                                   (CurrFieldNo <> 0)
                                                                THEN
                                                                  EXIT;

                                                                ExfPurchDocLine.RESET;
                                                                ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
                                                                IF ExfPurchDocLine.FINDFIRST THEN BEGIN
                                                                  ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
                                                                  ExfPurchDocLine.SETFILTER(Type,'<>%1',ExfPurchDocLine.Type::" ");
                                                                  ExfPurchDocLine.SETFILTER(Quantity,'<>0');
                                                                  ExfPurchDocLine.LOCKTABLE;
                                                                  IF ExfPurchDocLine.FINDSET THEN BEGIN
                                                                    MODIFY;
                                                                    REPEAT
                                                                      ExfPurchDocLine.UpdateAmounts;
                                                                      ExfPurchDocLine.MODIFY;
                                                                    UNTIL ExfPurchDocLine.NEXT = 0;
                                                                  END;
                                                                  ExfPurchDocLine.RESET;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=VAT Base Discount %;
                                                              SVE=Nettobelopprabatt %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 121 ;   ;Invoice Discount Calculation;Option;CaptionML=[ENU=Invoice Discount Calculation;
                                                              SVE=Fakturarabattber„kning];
                                                   OptionCaptionML=[ENU=None,%,Amount;
                                                                    SVE=Ingen,%,Belopp];
                                                   OptionString=None,%,Amount;
                                                   Editable=No }
    { 122 ;   ;Invoice Discount Value;Decimal     ;CaptionML=[ENU=Invoice Discount Value;
                                                              SVE=Fakturarabattv„rde];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 160 ;   ;Job Queue Status    ;Option        ;OnLookup=VAR
                                                              JobQueueEntry@1000 : Record 472;
                                                            BEGIN
                                                              IF "Job Queue Status" = "Job Queue Status"::" " THEN
                                                                EXIT;
                                                              JobQueueEntry.ShowStatusMsg("Job Queue Entry ID");
                                                            END;

                                                   CaptionML=[ENU=Job Queue Status;
                                                              SVE=Status f”r jobbk”];
                                                   OptionCaptionML=[ENU=" ,Scheduled for Posting,Error,Posting";
                                                                    SVE=" ,Planerat f”r bokf”ring,Fel,Bokf”ring"];
                                                   OptionString=[ ,Scheduled for Posting,Error,Posting];
                                                   Editable=No }
    { 161 ;   ;Job Queue Entry ID  ;GUID          ;CaptionML=[ENU=Job Queue Entry ID;
                                                              SVE=Transaktions-ID f”r jobbk”];
                                                   Editable=No }
    { 170 ;   ;Creditor No.        ;Code20        ;CaptionML=[ENU=Creditor No.;
                                                              SVE=Fordrings„garenr.];
                                                   Numeric=Yes }
    { 171 ;   ;Payment Reference   ;Code50        ;OnValidate=BEGIN
                                                                IF "Payment Reference" <> '' THEN
                                                                  TESTFIELD("Creditor No.");
                                                              END;

                                                   CaptionML=[ENU=Payment Reference;
                                                              SVE=Betalningsreferens];
                                                   Numeric=Yes }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnLookup=BEGIN
                                                              ShowDocDim;
                                                            END;

                                                   CaptionML=[ENU=Dimension Set ID;
                                                              SVE=Dimensionsupps„ttnings-ID];
                                                   Editable=No }
    { 1305;   ;Invoice Discount Amount;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line"."Inv. Discount Amount" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Invoice Discount Amount;
                                                              SVE=Fakturarabatt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 11200;  ;EU 3-Party Trade    ;Boolean       ;CaptionML=[ENU=EU 3-Party Trade;
                                                              SVE=EU trepartshandel] }
    { 90003;  ;Vendor Contract No  ;Code20        ;CaptionML=[ENU=Vendor Contract No;
                                                              SVE=Leverant”rkontraktnr.];
                                                   Description=EXFFI1.02, Finnish Enable Agreement No Import }
    { 99000;  ;Message Type        ;Option        ;InitValue=Reference No.;
                                                   CaptionML=[ENU=Message Type;
                                                              NOR=Meldingstype;
                                                              SVE=Meddelandetyp];
                                                   OptionCaptionML=ENU=Reference No.,Invoice Information,Message,Long Message,Tax Message;
                                                   OptionString=Reference No.,Invoice Information,Message,Long Message,Tax Message;
                                                   Description=EXFFI1.00, Finnish Referencenumber Type }
    { 99001;  ;Invoice Message     ;Text95        ;CaptionML=ENU=Invoice Message;
                                                   Description=EXFFI1.00, Finnish Reference number 1 }
    { 99002;  ;Invoice Message 2   ;Text95        ;OnValidate=BEGIN
                                                                IF "Message Type" = "Message Type"::"Long Message" THEN
                                                                  IF STRLEN("Invoice Message" + "Invoice Message 2") > 420 THEN
                                                                    ERROR(Text1090003, FIELDCAPTION("Invoice Message"), FIELDCAPTION("Invoice Message 2"), 420);
                                                              END;

                                                   CaptionML=ENU=Invoice Message 2;
                                                   Description=EXFFI1.00, Finnish Reference number 2 }
    { 11012140;;VAT Prod. Posting Group;Code10    ;TableRelation="VAT Product Posting Group".Code;
                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              SVE=Moms produktbokf”ringsmall] }
    { 11012800;;Service Order No.  ;Code20        ;TableRelation="Service Order".No.;
                                                   OnValidate=VAR
                                                                ServOrderRec@1101285000 : Record 11012823;
                                                              BEGIN
                                                                //**4PS.n
                                                                IF "Service Order No." <> '' THEN BEGIN
                                                                  TESTFIELD("Job No.", '');
                                                                  ServOrderRec.GET("Service Order No.");
                                                                  ServOrderRec.TestServiceContractMandatory;
                                                                  //IF "Document Type" <= "Document Type"::Order THEN
                                                                  //  ServOrderRec.CheckStatus(2);
                                                                  ServOrderRec.CheckStatus(1);  //db, 24-09-13: C009516 (conform check on project status)
                                                                END;
                                                                //ELSE BEGIN
                                                                  //IF (Deliver = Deliver::"Service Location") THEN //*25063.n  //*27675.o
                                                                  //  FIELDERROR(Deliver); //*25063.n  //*27675.o
                                                                  //*27675.sn
                                                                  //IF (Deliver = Deliver::"Service Location") THEN BEGIN
                                                                  //  IF ("Document Type" IN ["Document Type"::Order, "Document Type"::Quote]) THEN
                                                                  //    FIELDERROR(Deliver)
                                                                  //  ELSE BEGIN
                                                                  //    Deliver := Deliver::" ";
                                                                  //    "Ship To Location" := '';
                                                                  //  END
                                                                  //END;
                                                                  //*27675.en
                                                                //END;

                                                                //UpdateOrderAddressByDepartment; //**4PS.n

                                                                //**4PS 09-06-2010 sn
                                                                CreateDim(
                                                                  DATABASE::"Service Order","Service Order No.",
                                                                  DATABASE::Vendor,"Pay-to Vendor No.",
                                                                  DATABASE::Job,"Job No.",
                                                                  DATABASE::"Salesperson/Purchaser","Purchaser Code");
                                                                  //DATABASE::Campaign,"Campaign No.",
                                                                  //DATABASE::"Responsibility Center","Responsibility Center");
                                                                  //DATABASE::Location,"Location Code"); //**4PS.n  //*C007227.o
                                                                //**4PS 09-06-2010 sn

                                                                //4PS
                                                                IF (CurrFieldNo = FIELDNO("Service Order No.")) THEN
                                                                  VALIDATE("Shortcut Dimension 2 Code");
                                                                //4PS
                                                              END;

                                                   CaptionML=[ENU=Service Order No.;
                                                              SVE=Serviceordernr] }
    { 12013587;;Journal Template Name;Code10      ;TableRelation="Exflow Journal Template";
                                                   CaptionML=[ENU=Journal Template Name;
                                                              SVE=Mallnamn f”r journal] }
    { 12013588;;Journal Batch Name ;Code10        ;TableRelation="Exflow Journal Batch".Name WHERE (Journal Template Name=FIELD(Journal Template Name));
                                                   CaptionML=[ENU=Journal Batch Name;
                                                              SVE=Journalnamn] }
    { 12013589;;ExFlow Entry Type  ;Option        ;CaptionML=[ENU=Import Type;
                                                              SVE=Importtyp];
                                                   OptionCaptionML=[ENU=" ,Manual Entry,Image Import,OCR Import";
                                                                    SVE=" ,Manuell rad,Bild Import,OCR Import"];
                                                   OptionString=[ ,Manual Entry,Image Import,OCR Import];
                                                   Editable=No }
    { 12013590;;Image File Name    ;Text250       ;OnValidate=BEGIN
                                                                IF ("Image File Name" = '') <> (xRec."Image File Name" <> '') THEN BEGIN
                                                                  IF "Image Buffer ID" <> 0 THEN BEGIN
                                                                    ImageBlobBuffer.LOCKTABLE;
                                                                    ImageBlobBuffer.GET("Image Buffer ID");
                                                                    ImageBlobBuffer.DELETE;
                                                                    "Image Buffer ID" := 0;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Image File Name;
                                                              SVE=Filnamn] }
    { 12013591;;ExFlow Document Type;Option       ;InitValue=Invoice;
                                                   OnValidate=BEGIN
                                                                CASE "ExFlow Document Type" OF
                                                                  "ExFlow Document Type"::Invoice:
                                                                    "Document Type" := "Document Type"::Invoice;
                                                                  "ExFlow Document Type"::"Credit Memo":
                                                                    "Document Type" := "Document Type"::"Credit Memo";
                                                                  "ExFlow Document Type"::"Prepayment Invoice":
                                                                    "Document Type" := "Document Type"::Invoice;
                                                                  ELSE
                                                                    ERROR(EXF102);
                                                                END;

                                                                SwitchExFlowDocumentType;
                                                              END;

                                                   CaptionML=[ENU=Document Type;
                                                              SVE=Dokumenttyp];
                                                   OptionCaptionML=[ENU=" ,Invoice,Credit Memo,Prepayment";
                                                                    SVE=" ,Faktura,Kreditnota,F”rskottsbetalning"];
                                                   OptionString=[ ,Invoice,Credit Memo,Prepayment Invoice] }
    { 12013592;;Document Amount    ;Decimal       ;OnValidate=VAR
                                                                lcduExfVerifyDoc@1100285000 : Codeunit 12013594;
                                                              BEGIN
                                                                CalculateHeaderAmounts(CurrFieldNo);

                                                                lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE,TRUE);
                                                              END;

                                                   CaptionML=[ENU=Amount;
                                                              SVE=Belopp];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013593;;Document Amount Including VAT;Decimal;
                                                   OnValidate=BEGIN
                                                                IF "Document Amount Including VAT" < 0 THEN
                                                                  ERROR(STRSUBSTNO(EXF116,FIELDCAPTION("Document Amount Including VAT")));

                                                                CalculateHeaderAmounts(CurrFieldNo);
                                                                VALIDATE("Document Amount","Document Amount Including VAT" - "Document Amount VAT");
                                                              END;

                                                   CaptionML=[ENU=Amount Including VAT;
                                                              SVE=Belopp inkl. moms];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013594;;Document Amount VAT;Decimal       ;OnValidate=VAR
                                                                lcduExfVerifyDoc@1100285000 : Codeunit 12013594;
                                                              BEGIN
                                                                CalculateHeaderAmounts(CurrFieldNo);
                                                                IF (xRec."Document Amount VAT" <> "Document Amount VAT") OR
                                                                   (CurrFieldNo IN [FIELDNO("Document Amount Including VAT"),FIELDNO("Document Amount VAT"),FIELDNO("Document Amount")]) THEN
                                                                  lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE, TRUE);
                                                              END;

                                                   CaptionML=[ENU=VAT Amount;
                                                              SVE=Momsbelopp];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12013595;;Inbound Document No.;Integer      ;CaptionML=[ENU=Inbound Document No.;
                                                              SVE=Ing†ende dokumentnr];
                                                   Editable=No }
    { 12013596;;Date Created       ;Date          ;CaptionML=[ENU=Date Created;
                                                              SVE=Skapat datum] }
    { 12013597;;Time Created       ;Time          ;CaptionML=[ENU=Time Created;
                                                              SVE=Skapat tid] }
    { 12013598;;User ID            ;Code50        ;CaptionML=[ENU=User ID;
                                                              SVE=Anv„ndar ID] }
    { 12013599;;First Approver     ;Code50        ;TableRelation="EX User Group".Code WHERE (Blocked=CONST(No));
                                                   OnValidate=VAR
                                                                GroupName@1100285000 : Text[100];
                                                              BEGIN
                                                                "First Approver" := ExFlow.FindUserGroup("First Approver",GroupName,FALSE);

                                                                IF "First Approver" <> xRec."First Approver" THEN
                                                                  UpdatePurchLines(FIELDCAPTION("First Approver"));
                                                              END;

                                                   CaptionML=[ENU=First Approver;
                                                              SVE=F”rsta attestant] }
    { 12013600;;RO Entry No.       ;Integer       ;CaptionML=[ENU=RO Entry No.;
                                                              SVE=RO L”pnr] }
    { 12013610;;Default VAT %      ;Decimal       ;CaptionML=[ENU=Default VAT %;
                                                              SVE=Standard Moms %] }
    { 12013611;;Default VAT Prod. Post. Group;Code10;
                                                   TableRelation="VAT Product Posting Group";
                                                   CaptionML=[ENU=Default VAT Prod. Post. Group;
                                                              SVE=Standard Moms Prod. bokf”ringsmall] }
    { 12013612;;Propose Line       ;Boolean       ;CaptionML=[ENU=Propose Line;
                                                              SVE=F”rslagsrad] }
    { 12013613;;Propose VAT Line   ;Boolean       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Propose VAT Line") THEN
                                                                  IF (xRec."Propose VAT Line" <> "Propose VAT Line") AND PurchLinesExist THEN
                                                                    ERROR(STRSUBSTNO(EXF114,FIELDCAPTION("Propose VAT Line")));


                                                                IF "Propose VAT Line" THEN BEGIN
                                                                  GetDefaultVATPerc("Default VAT Prod. Post. Group","Default VAT %");
                                                                  GetVATLineVATProdPostGroup("VAT Line VAT Prod. Post. Gr.","VAT Line G/L Account");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Propose VAT Line;
                                                              SVE=Momsf”rslagsrad] }
    { 12013614;;Prop. Line G/L Account;Code20     ;TableRelation="G/L Account" WHERE (Direct Posting=CONST(Yes),
                                                                                      Account Type=CONST(Posting),
                                                                                      Blocked=CONST(No));
                                                   OnValidate=VAR
                                                                lcduExfVerifyDoc@1100285001 : Codeunit 12013594;
                                                              BEGIN
                                                                IF "Prop. Line G/L Account" <> '' THEN BEGIN
                                                                  "Predefined Purch. Code" := '';

                                                                  IF GLAcc.GET("Prop. Line G/L Account") THEN BEGIN
                                                                    IF CurrFieldNo = FIELDNO("Prop. Line G/L Account") THEN
                                                                      GLAcc.TESTFIELD("Direct Posting");

                                                                    GetDefaultVATPerc("Default VAT Prod. Post. Group","Default VAT %");
                                                                  END;
                                                                END;

                                                                IF "Propose VAT Line" THEN
                                                                  GetVATLineVATProdPostGroup("VAT Line VAT Prod. Post. Gr.","VAT Line G/L Account");

                                                                //4PS
                                                                IF (CurrFieldNo = FIELDNO("Prop. Line G/L Account")) OR (CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")) THEN
                                                                //4PS
                                                                  IF "ExFlow Entry Type" <> "ExFlow Entry Type"::"OCR Import" THEN
                                                                    CASE "VAT calculated from" OF
                                                                      "VAT calculated from"::"Gross Amount":
                                                                        CalculateHeaderAmounts(FIELDNO("Document Amount Including VAT"));
                                                                      "VAT calculated from"::"Net Amount":
                                                                        CalculateHeaderAmounts(FIELDNO("Document Amount"));
                                                                    END;

                                                                //4PS
                                                                IF (CurrFieldNo = FIELDNO("Prop. Line G/L Account")) OR ((CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")) AND ("Job No." <> ''))
                                                                  OR ((CurrFieldNo = FIELDNO("Shortcut Dimension 2 Code")) AND ("Service Order No." <> ''))THEN
                                                                //4PS
                                                                  lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE,TRUE);
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Prop. Line G/L Account;
                                                              SVE=F”rslagskonto] }
    { 12013615;;VAT Line VAT Prod. Post. Gr.;Code10;
                                                   TableRelation="VAT Product Posting Group";
                                                   CaptionML=[ENU=VAT Line VAT Prod. Post. Gr.;
                                                              SVE=Momsrads Moms Prod. bok”ringsmall] }
    { 12013616;;VAT Line G/L Account;Code20       ;TableRelation="G/L Account";
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("VAT Line G/L Account") THEN BEGIN
                                                                  TESTFIELD("Propose VAT Line");

                                                                  GLAcc.GET("VAT Line G/L Account");
                                                                  GLAcc.TESTFIELD("Direct Posting");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=VAT Line G/L Account;
                                                              SVE=Momsrads f”rslagskonto] }
    { 12013617;;Image Buffer ID    ;Integer       ;CaptionML=[ENU=Image Buffer ID;
                                                              SVE=Filbuffer ID] }
    { 12013619;;VAT calculated from;Option        ;CaptionML=[ENU=VAT calculated from;
                                                              SVE=Moms ber„knat fr†n];
                                                   OptionCaptionML=[ENU=Net Amount,Gross Amount;
                                                                    SVE=Netto belopp,Brutto belopp];
                                                   OptionString=Net Amount,Gross Amount }
    { 12013620;;Reference          ;Code50        ;TableRelation="EX Reference";
                                                   OnValidate=VAR
                                                                lrecRef@1100285000 : Record 12013632;
                                                                ExValidatePurchDoc@1100285001 : Codeunit 12013594;
                                                              BEGIN
                                                                IF Reference <> '' THEN BEGIN
                                                                  lrecRef.SETRANGE(Reference, Reference);
                                                                  lrecRef.SETFILTER("Vendor No.", '%1|%2', '', "Buy-from Vendor No.");
                                                                  IF lrecRef.FINDLAST THEN BEGIN
                                                                    IF lrecRef."First Approver" <> '' THEN BEGIN
                                                                      VALIDATE("First Approver", lrecRef."First Approver");
                                                                      IF "Template Rule" <> '' THEN
                                                                        VALIDATE("Template Rule",'');
                                                                    END
                                                                    ELSE
                                                                      IF lrecRef."Template Rule" <> '' THEN BEGIN
                                                                        VALIDATE("Template Rule", lrecRef."Template Rule");
                                                                        IF "First Approver" <> '' THEN
                                                                          VALIDATE("First Approver",'');
                                                                      END;

                                                                    IF lrecRef."Predefined Purch. Code" <> '' THEN
                                                                      VALIDATE("Predefined Purch. Code",lrecRef."Predefined Purch. Code");

                                                                    IF lrecRef."Purchaser Code" <> '' THEN BEGIN
                                                                      IF CurrFieldNo = FIELDNO(Reference) THEN
                                                                        VALIDATE("Purchaser Code", lrecRef."Purchaser Code")
                                                                      ELSE BEGIN
                                                                        IF "Purchaser Code" = '' THEN
                                                                          VALIDATE("Purchaser Code", lrecRef."Purchaser Code")
                                                                        ELSE
                                                                          IF "Order No." = '' THEN
                                                                            VALIDATE("Purchaser Code", lrecRef."Purchaser Code");
                                                                      END;
                                                                    END;
                                                                    IF lrecRef."Contract No." <> 0 THEN
                                                                      VALIDATE("Contract No.",lrecRef."Contract No.");
                                                                    ExValidatePurchDoc.InsertRefDim(Rec);
                                                                  END;
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              lrecRef@1100285000 : Record 12013632;
                                                            BEGIN
                                                              lrecRef.SETRANGE(Reference, Reference);
                                                              lrecRef.SETFILTER("Vendor No.", '%1|%2', '', "Buy-from Vendor No.");
                                                              IF lrecRef.FINDFIRST THEN;

                                                              lrecRef.RESET;
                                                              IF PAGE.RUNMODAL(0,lrecRef) = ACTION::LookupOK THEN
                                                                VALIDATE(Reference,lrecRef.Reference);
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Reference;
                                                              SVE=Referens] }
    { 12013621;;Vendor ID          ;Code100       ;OnValidate=VAR
                                                                VendorIDMgt@1100285000 : Codeunit 12013667;
                                                                VendId@1100285001 : Code[20];
                                                              BEGIN
                                                                IF ("Vendor ID" <> '') AND ("Vendor ID" <> xRec."Vendor ID") THEN BEGIN
                                                                  VendId := VendorIDMgt.FindVendor("Vendor ID");
                                                                  IF (VendId <> '') AND (VendId <> "Buy-from Vendor No.") THEN
                                                                    VALIDATE("Buy-from Vendor No.", VendId);
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              VendorIDsForm@1100285000 : Page 12013678;
                                                              VendorIDs@1100285001 : Record 12013667;
                                                            BEGIN
                                                              IF "Buy-from Vendor No." <> '' THEN BEGIN
                                                                VendorIDs.SETCURRENTKEY("Vendor No.");
                                                                VendorIDs.SETRANGE("Vendor No.","Buy-from Vendor No.");
                                                                VendorIDsForm.SETTABLEVIEW(VendorIDs);
                                                              END;

                                                              VendorIDsForm.RUNMODAL;
                                                            END;

                                                   CaptionML=[ENU=Vendor ID;
                                                              SVE=Leverant”rs ID] }
    { 12013622;;Prepayment Order No.;Code20       ;TableRelation="Purchase Header".No. WHERE (Document Type=CONST(Order));
                                                   OnValidate=BEGIN
                                                                IF "Prepayment Order No." <> '' THEN BEGIN
                                                                  TESTFIELD("ExFlow Document Type","ExFlow Document Type"::"Prepayment Invoice");

                                                                  "Propose Line" := TRUE;
                                                                  "Order No." := '';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Order No.;
                                                              SVE=F”rskottsordernr.] }
    { 12013623;;Order No.          ;Code20        ;OnValidate=VAR
                                                                lPurchHeader@1100285002 : Record 38;
                                                                RetrieveLines@1100285001 : Boolean;
                                                              BEGIN
                                                                IF "ExFlow Document Type" = "ExFlow Document Type"::"Prepayment Invoice" THEN BEGIN
                                                                  VALIDATE("Prepayment Order No.", "Order No.");

                                                                  EXIT;
                                                                END;

                                                                AppSetup.GET;

                                                                IF ("Order No." <> xRec."Order No.") AND (AppSetup."Order Applies-to" <> AppSetup."Order Applies-to"::"Order not used") THEN
                                                                  BEGIN
                                                                    IF "Order No." <> '' THEN
                                                                      BEGIN
                                                                        CASE "ExFlow Document Type" OF
                                                                          "ExFlow Document Type"::Invoice:
                                                                            IF NOT lPurchHeader.GET(lPurchHeader."Document Type"::Order,"Order No.") THEN
                                                                              ERROR(EXF019,"Order No.");
                                                                          "ExFlow Document Type"::"Credit Memo":
                                                                            IF NOT lPurchHeader.GET(lPurchHeader."Document Type"::"Return Order","Order No.") THEN
                                                                              ERROR(EXF019,"Order No.");
                                                                          ELSE
                                                                            ERROR(EXF119);
                                                                        END;

                                                                        IF "Buy-from Vendor No." = '' THEN
                                                                          VALIDATE("Buy-from Vendor No.", lPurchHeader."Buy-from Vendor No.")
                                                                        ELSE
                                                                          IF "Buy-from Vendor No." <> lPurchHeader."Buy-from Vendor No." THEN
                                                                            ERROR(EXF050);

                                                                        IF lPurchHeader."Purchaser Code" <> '' THEN
                                                                          "Purchaser Code" := lPurchHeader."Purchaser Code";
                                                                      END
                                                                  END;

                                                                IF (("Order No." = '') AND ("Order No. (Import)" = '')) THEN BEGIN
                                                                  "PO Matched Document" := FALSE;
                                                                  IF NOT PurchLinesExist THEN BEGIN
                                                                    ExFlowSetup.GET;
                                                                    "Propose Line" := ExFlowSetup."Propose Line";
                                                                  END;
                                                                END;

                                                                UpdatePurchLines(FIELDCAPTION("Order No."));

                                                                IF ("Order No." <> '') THEN BEGIN
                                                                  RetrieveLines := TRUE;
                                                                  IF OCRLinesExist THEN BEGIN
                                                                    IF NOT HideValidationDialog THEN
                                                                      RetrieveLines := CONFIRM(EXF120,FALSE)
                                                                    ELSE
                                                                      RetrieveLines := FALSE;
                                                                  END;

                                                                  IF RetrieveLines THEN
                                                                    RetrievePurchaseLines(Rec);
                                                                END;
                                                              END;

                                                   ValidateTableRelation=Yes;
                                                   TestTableRelation=Yes;
                                                   CaptionML=[ENU=Order No.;
                                                              SVE=Ordernr.] }
    { 12013624;;Error Message      ;Text250       ;CaptionML=[ENU=Action Message;
                                                              SVE=tg„rdsmeddelande];
                                                   Editable=No }
    { 12013625;;Validation Error   ;Boolean       ;CaptionML=[ENU=Validation Error;
                                                              SVE=Valideringsfel];
                                                   Editable=No }
    { 12013626;;Template Rule      ;Code20        ;TableRelation="Template Rule".Code;
                                                   OnValidate=BEGIN
                                                                IF "Template Rule" <> xRec."Template Rule" THEN
                                                                  UpdatePurchLines(FIELDCAPTION("Template Rule"));
                                                              END;

                                                   CaptionML=[ENU=Template Rule;
                                                              SVE=Attestregel] }
    { 12013627;;Calculated VAT %   ;Decimal       ;CaptionML=[ENU=Calculated VAT %;
                                                              SVE=Utr„knad Moms %];
                                                   DecimalPlaces=0:2;
                                                   Editable=No }
    { 12013630;;Admin Comment      ;Text180       ;CaptionML=[ENU=Comments;
                                                              SVE=Kommentar] }
    { 12013635;;Factoring          ;Boolean       ;CaptionML=[ENU=Factoring Vendor;
                                                              SVE=Factoringleverant”r] }
    { 12013637;;Vendor Document No.;Code100       ;CaptionML=[ENU=Vendor Document No.;
                                                              SVE=Leverant”rens dokumentnr.] }
    { 12013638;;Block Document     ;Option        ;CaptionML=[ENU=Block Document;
                                                              SVE=Stoppa Dokument];
                                                   OptionCaptionML=[ENU=" ,Creation,Posting";
                                                                    SVE=" ,Skapa,Bokf”ring"];
                                                   OptionString=[ ,Creation,Posting] }
    { 12013640;;Receipt No. Mandatory;Boolean     ;OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Receipt No. Mandatory"));
                                                              END;

                                                   CaptionML=[ENU=Receipt No. Mandatory;
                                                              SVE=Inleveransnr obligatoriskt] }
    { 12013645;;PO Matched Document;Boolean       ;CaptionML=[ENU=Matched against Purchase Order;
                                                              SVE=Kopplat mot ink”psorder] }
    { 12013650;;Vendor Document No. 2;Code50      ;CaptionML=[ENU=Vendor Document No. 2;
                                                              NOR=KID nummer;
                                                              SVE=OCR nummer;
                                                              NON=KID nummer] }
    { 12013668;;Contract No.       ;Integer       ;TableRelation="ExFlow Contract Matching" WHERE (Vendor No.=FIELD(Buy-from Vendor No.));
                                                   OnValidate=VAR
                                                                ExFlowContract@1100285000 : Record 12013633;
                                                                lcduExfVerifyDoc@1100285001 : Codeunit 12013594;
                                                              BEGIN
                                                                IF "Contract No." <> 0 THEN BEGIN
                                                                  ExFlowContract.GET("Contract No.");
                                                                  IF ExFlowContract."Predefined Purch. Code" <> '' THEN BEGIN
                                                                    VALIDATE("Predefined Purch. Code", ExFlowContract."Predefined Purch. Code");
                                                                    "Prop. Line G/L Account" :='';

                                                                    IF CurrFieldNo <> 0 THEN
                                                                      lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE,TRUE);
                                                                  END;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Contract No.;
                                                              SVE=Avtalsnr.] }
    { 12013670;;Dimension 1 (Import);Code20       ;CaptionML=[ENU=Dimension 1 (Import);
                                                              SVE=Dimension 1 (Import)] }
    { 12013671;;Dimension 2 (Import);Code20       ;CaptionML=[ENU=Dimension 2 (Import);
                                                              SVE=Dimension 2 (Import)] }
    { 12013699;;Has Attachments    ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("ExFlow Import Attachment" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Has Attachments;
                                                              SVE=Har Bilagor];
                                                   Editable=No }
    { 12013700;;Currency Code (Import);Code10     ;CaptionML=[ENU=Currency Code (Import);
                                                              SVE=Valutakod (Import)] }
    { 12013702;;Order No. (Import) ;Code20        ;OnValidate=VAR
                                                                ExfPurchLine@1100285000 : Record 12013588;
                                                              BEGIN
                                                                IF "Order No. (Import)" <> '' THEN
                                                                  VALIDATE("Order No.", ExfValidatePurchDoc.ConvertVendorOrderNo(Rec));

                                                                IF (CurrFieldNo = FIELDNO("Order No. (Import)")) THEN
                                                                  IF "Order No. (Import)" <> xRec."Order No. (Import)" THEN BEGIN
                                                                    ExfPurchLine.RESET;
                                                                    ExfPurchLine.SETRANGE("Order No. (Import)",xRec."Order No. (Import)");
                                                                    ExfPurchLine.SETRANGE("OCR Imported Line",TRUE);
                                                                    ExfPurchLine.SETFILTER("Order No.",'%1','');
                                                                    ExfPurchLine.MODIFYALL("Order No. (Import)","Order No. (Import)");
                                                                  END;

                                                                IF (("Order No." = '') AND ("Order No. (Import)" = '')) THEN BEGIN
                                                                  "PO Matched Document" := FALSE;
                                                                  IF NOT PurchLinesExist THEN BEGIN
                                                                    ExFlowSetup.GET;
                                                                    "Propose Line" := ExFlowSetup."Propose Line";
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Order No. (Import);
                                                              SVE=Ordernr. (Import)] }
    { 12013703;;Job No. (Import)   ;Code20        ;OnValidate=BEGIN
                                                                IF "Job No. (Import)" <> '' THEN
                                                                  VALIDATE("Job No.", ExfValidatePurchDoc.ConvertJobNo(Rec));
                                                              END;

                                                   CaptionML=[ENU=Job No. (Import);
                                                              SVE=Projekt Nr. (Import)] }
    { 12013706;;Posting Date (Import);Date        ;CaptionML=[ENU=Posting Date (Import);
                                                              SVE=Bokf”ringsdatum (Import)] }
    { 12013707;;Due Date (Import)  ;Date          ;CaptionML=[ENU=Due Date (Import);
                                                              SVE=F”rfallodatum (Import)] }
    { 12013709;;Propose Diff. Line ;Boolean       ;CaptionML=[ENU=Propose Diff. Line;
                                                              SVE=F”resl† diffrad] }
    { 12013710;;Predefined Purch. Code;Code10     ;TableRelation="EX Standard Purchase Code".Code;
                                                   OnValidate=VAR
                                                                lcduExfVerifyDoc@1100285000 : Codeunit 12013594;
                                                              BEGIN
                                                                IF "Predefined Purch. Code" <> '' THEN BEGIN
                                                                  "Prop. Line G/L Account" := '';
                                                                  ExFStdPurchCode.GET("Predefined Purch. Code");
                                                                  IF ExFStdPurchCode."Propose VAT Line" THEN BEGIN
                                                                    IF PurchLinesExist THEN
                                                                      DeletePurchaseLines;

                                                                    VALIDATE("Propose VAT Line", TRUE);
                                                                  END;
                                                                END;

                                                                IF CurrFieldNo = FIELDNO("Predefined Purch. Code") THEN BEGIN
                                                                  IF "ExFlow Entry Type" <> "ExFlow Entry Type"::"OCR Import" THEN BEGIN
                                                                    CASE "VAT calculated from" OF
                                                                      "VAT calculated from"::"Gross Amount":
                                                                        CalculateHeaderAmounts(FIELDNO("Document Amount Including VAT"));
                                                                      "VAT calculated from"::"Net Amount":
                                                                        CalculateHeaderAmounts(FIELDNO("Document Amount"));
                                                                    END;
                                                                  END;

                                                                  lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE,TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=ExFlow Purchase Code;
                                                              SVE=ExFlow ink”pskod] }
    { 12013711;;Diffline Purch. Code;Code10       ;TableRelation="EX Standard Purchase Code".Code;
                                                   CaptionML=[ENU=Diff.Line Purch. Code;
                                                              SVE=Diffrad f”rslagskod] }
    { 12013715;;Approval           ;Boolean       ;OnValidate=BEGIN
                                                                IF xRec.Approval AND (NOT Approval) THEN
                                                                  IF NOT ExFlow.IsUserSuperior(USERID) THEN
                                                                    ERROR(STRSUBSTNO(EXF121,USERID));

                                                                UpdatePurchLines(FIELDCAPTION(Approval));
                                                              END;

                                                   CaptionML=[ENU=Approval;
                                                              SVE=Attest] }
    { 12013716;;Check Order Line (OCR);Boolean    ;OnValidate=BEGIN
                                                                UpdatePurchLines(FIELDCAPTION("Check Order Line (OCR)"));
                                                              END;

                                                   CaptionML=[ENU=Check Order Line (OCR);
                                                              SVE=Kontrollera order rad (OCR)] }
    { 12013722;;Import Document No.;Integer       ;CaptionML=[ENU=Import Document No.;
                                                              SVE=Import dokumentnr];
                                                   Editable=No }
    { 12013727;;Due Days (Import)  ;Integer       ;OnValidate=BEGIN
                                                                IF "Due Days (Import)" <> xRec."Due Days (Import)" THEN
                                                                  "Due Date" := ExfValidatePurchDoc.CalcIntDate("Document Date","Due Days (Import)");
                                                              END;

                                                   CaptionML=[ENU=Due Days (Import);
                                                              SVE=F”rfallodagar (Import)] }
    { 12013728;;Vendor No. (Import);Code20        ;CaptionML=[ENU=Vendor No. (Import);
                                                              SVE=Leverant”rsnr. (Import)] }
    { 12013729;;Pay to Account (Import);Text50    ;CaptionML=[ENU=Payment Validation Account No;
                                                              SVE=Betalningsvaliderings kontonummer] }
    { 12057070;;Error category code;Code10        ;TableRelation="EX Purch. Document Category";
                                                   OnValidate=BEGIN
                                                                "Error category code changed" := CREATEDATETIME(TODAY,TIME);
                                                              END;

                                                   CaptionML=[ENU=Error category code;
                                                              SVE=Felkategori] }
    { 12057071;;Error category code changed;DateTime;
                                                   CaptionML=[ENU=Error category code last changed;
                                                              SVE=Felkategori senast „ndrat];
                                                   Editable=No }
    { 12057072;;Potential UOM Mismatch;Boolean    ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Exflow Purchase Document Line" WHERE (Inbound Document No.=FIELD(Inbound Document No.),
                                                                                                            Potential UOM Mismatch=CONST(Yes)));
                                                   CaptionML=[ENU=Potential unit of measure mismatch;
                                                              SVE=M”jlig enhetskonflikt];
                                                   Editable=No }
    { 12057075;;Misc Amount 1      ;Decimal       ;OnValidate=BEGIN
                                                                AppSetup.GET;
                                                                IF "Misc Amount 1" = 0 THEN BEGIN
                                                                  ExfPurchDocLine.RESET;
                                                                  ExfPurchDocLine.SETRANGE("Inbound Document No.", "Inbound Document No.");
                                                                  ExfPurchDocLine.SETRANGE("Exflow-Created Entry", ExfPurchDocLine."Exflow-Created Entry"::MiscAmount);
                                                                  IF NOT ExfPurchDocLine.ISEMPTY THEN
                                                                    ExfPurchDocLine.DELETEALL(TRUE);
                                                                END
                                                                ELSE
                                                                  ExfValidatePurchDoc.InsertMiscLines(Rec,AppSetup,TRUE);
                                                              END;

                                                   CaptionML=[ENU=Misc Amount 1;
                                                              SVE=Till„ggsbelopp 1] }
    { 12057076;;Misc Amount 2      ;Decimal       ;OnValidate=BEGIN
                                                                AppSetup.GET;
                                                                IF "Misc Amount 2" = 0 THEN BEGIN
                                                                  ExfPurchDocLine.RESET;
                                                                  ExfPurchDocLine.SETRANGE("Inbound Document No.", "Inbound Document No.");
                                                                  ExfPurchDocLine.SETRANGE("Exflow-Created Entry", ExfPurchDocLine."Exflow-Created Entry"::MiscAmount);
                                                                  IF NOT ExfPurchDocLine.ISEMPTY THEN
                                                                    ExfPurchDocLine.DELETEALL(TRUE);
                                                                END
                                                                ELSE
                                                                  ExfValidatePurchDoc.InsertMiscLines(Rec,AppSetup,TRUE);
                                                              END;

                                                   CaptionML=[ENU=Misc Amount 2;
                                                              SVE=Till„ggsbelopp 2] }
    { 12057160;;Total Amount Lines ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line".Amount WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount;
                                                              SVE=Belopp];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12057161;;Total Amount Incl. VAT Lines;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Exflow Purchase Document Line"."Amount Including VAT" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=Amount Including VAT;
                                                              SVE=Belopp inkl. moms];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 12057162;;PO Matching E-Mails;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("ExFlow Email Log" WHERE (Inbound Document No.=FIELD(Inbound Document No.)));
                                                   CaptionML=[ENU=No. of E-mail Reminders Sent;
                                                              SVE=Antal skickede e-postp†minnelser];
                                                   Editable=No }
    { 12057163;;Pre Posting        ;Option        ;CaptionML=[ENU=Pre Posting Status;
                                                              SVE=F”rankomstregistrerad status];
                                                   OptionCaptionML=[ENU=" ,Pre Post,Pre Posted";
                                                                    SVE=" ,F”rboka, F”rbokad"];
                                                   OptionString=[ ,Pre Post,Pre Posted] }
    { 12057164;;Pre Post No.       ;Code20        ;OnLookup=VAR
                                                              PurchHeader@1100285000 : Record 38;
                                                              PurchaseList@1100285001 : Page 53;
                                                            BEGIN
                                                            END;

                                                   CaptionML=[ENU=Pre Post No.;
                                                              SVE=F”rankomstregistrerat nr] }
  }
  KEYS
  {
    {    ;Inbound Document No.                    ;Clustered=Yes }
    {    ;Journal Batch Name,Inbound Document No.  }
    {    ;Vendor Document No.                      }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      PurchHeadTemp@1100285023 : TEMPORARY Record 38;
      PurchSetup@1100285006 : Record 312;
      GLSetup@1100285005 : Record 98;
      ExfJnlTemplate@1100285001 : Record 12013589;
      ExfJnlBatch@1100285000 : Record 12013590;
      ExfPurchDocHead@1004 : Record 12013587;
      ExfPurchDocLine@1000 : Record 12013588;
      xExfPurchDocLine@1100285024 : Record 12013588;
      DimMgt@1100285008 : Codeunit 408;
      GLAcc@1100285061 : Record 15;
      VendLedgEntry@1100285058 : Record 25;
      Vend@1100285057 : Record 23;
      PaymentTerms@1100285056 : Record 3;
      PaymentMethod@1100285055 : Record 289;
      CurrExchRate@1100285054 : Record 330;
      CompanyInfo@1100285049 : Record 79;
      OrderAddr@1100285047 : Record 224;
      BankAcc@1100285046 : Record 270;
      GenBusPostingGrp@1100285039 : Record 250;
      GenJnILine@1100285038 : Record 81;
      Location@1100285036 : Record 14;
      GenJnlApply@1100285030 : Codeunit 225;
      VendEntrySetApplID@1100285028 : Codeunit 111;
      UserMgt@1100285025 : Codeunit 5700;
      ApplyVendEntries@1100285022 : Page 233;
      CurrencyDate@1100285021 : Date;
      HideValidationDialog@1100285020 : Boolean;
      Confirmed@1100285019 : Boolean;
      SkipBuyFromContact@1100285018 : Boolean;
      SkipPayToContact@1100285017 : Boolean;
      UpdateDocumentDate@1100285134 : Boolean;
      ExFlowSetup@1100285010 : Record 12013601;
      Text003@1100285102 : TextConst 'ENU=You cannot rename a %1.;SVE=Du kan inte byta namn p† %1.';
      Text004@1100285101 : TextConst 'ENU=Do you want to change %1?;SVE=Vill du „ndra %1?';
      Text005@1100285100 : TextConst 'ENU=You cannot reset %1 because the document still has one or more lines.;SVE=Du kan inte †terst„lla %1 d„rf”r att dokumentet har en eller flera rader.';
      Text007@1100285098 : TextConst 'ENU=%1 is greater than %2 in the %3 table.\;SVE=%1 „r st”rre „n %2 i tabellen %3.\';
      Text008@1100285097 : TextConst 'ENU=Confirm change?;SVE=Bekr„fta f”r„ndring?';
      Text016@1100285089 : TextConst 'ENU=If you change %1, the existing purchase lines will be deleted and new purchase lines based on the new information in the header will be created.\\;SVE=Om du „ndrar %1 kommer befintliga ink”psrader att tas bort och nya ink”psrader baserade p† den nya informationen i huvudet kommer att skapas.\\';
      Text018@1100285088 : TextConst 'ENU=You must delete the existing purchase lines before you can change %1.;SVE=Du m†ste ta bort de befintliga ink”psraderna innan du kan „ndra %1.';
      Text019@1100285087 : TextConst 'ENU=You have changed %1 on the purchase header, but it has not been changed on the existing purchase lines.\;SVE=Du har „ndrat p† %1 p† ink”pshuvudet men det har inte „ndrats p† de befintliga ink”psraderna.\';
      Text020@1100285086 : TextConst 'ENU=You must update the existing purchase lines manually.;SVE=Du m†ste uppdatera de befintliga  ink”psraderna manuellt.';
      Text021@1100285085 : TextConst 'ENU=The change may affect the exchange rate used on the price calculation of the purchase lines.;SVE=Žndringen kan p†verka v„xelkursen som anv„nts vid prisber„kning av ink”psrader.';
      Text022@1100285084 : TextConst 'ENU=Do you want to update the exchange rate?;SVE=Vill du uppdatera valutakursen?';
      Text032@1100285076 : TextConst 'ENU=You have modified %1.\\;SVE=Du har „ndrat %1.\\';
      Text033@1100285075 : TextConst 'ENU=Do you want to update the lines?;SVE=Vill du uppdatera raderna?';
      Text041@1100285069 : TextConst 'ENU=The purchase %1 %2 has item tracking. Do you want to delete it anyway?;SVE=Artikelsp†rning „r aktivt f”r ink”ps%1 %2. Vill du ta bort den/det „nd†?';
      ImageBlobBuffer@1100285118 : Record 12013591;
      Currency@1100285120 : Record 4;
      AppSetup@1100285123 : Record 12013601;
      EXF019@1100285127 : TextConst 'ENU=Order No. (%1) does not exist.;SVE=Order saknas!';
      EXF025@1100285121 : TextConst 'ENU="You have modified the %1 field. Note that the recalculation of VAT may cause penny differences, so you must check the amounts afterwards. ";SVE="Du har „ndrat f„ltet %1. Observera att omr„kningen av moms kan orsaka ”resskillnader, s† du m†ste efter†t kontrollera beloppen. "';
      EXF027@1100285119 : TextConst 'ENU=Do you want to update the %2 field on the lines to reflect the new value of %1?;SVE=Vill du uppdatera f„ltet %2 p†  raderna f”r att †terspegla det nya v„rdet av %1?';
      EXF050@1100285129 : TextConst 'ENU=Wrong Vendor on Order.;SVE=Ordern har fel leverant”r!';
      EXF101@1100285116 : TextConst 'ENU=You must define VAT Product Posting Group on G/L Account %1;SVE=Du m†ste definiera Moms prod. Bokf”ringsmall f”r Konto %1';
      EXF102@1100285114 : TextConst 'ENU=You must select document type;SVE=Du m†ste v„lja dokumenttyp';
      EXF106@1100285107 : TextConst 'ENU=Exflow document %1 does not have an attached image;SVE=Exflow dokument %1 har ingen bifogad fakturabild';
      EXF113@1100285135 : TextConst 'ENU=The existing lines will be deleted. Are you sure you want to continue?;SVE=De befintliga raderna kommer att tas bort. Žr du s„ker p† att du vill forts„tta?';
      EXF114@1100285140 : TextConst 'ENU=%1 cannot be changed - instead, delete the line and start over.;SVE=%1 kan inte „ndras. Raden m†ste ist„llet tas bort och skapas p† nytt.';
      EXF116@1100285059 : TextConst 'ENU=Negative values cannot be entered into field %1!;SVE=Negative v„rden kan inte anv„ndas i f„lt %1!';
      EXF117@1100285108 : TextConst 'ENU=Detailed Import information does not exist.;SVE=Detaljerad Importinformation finns ej.';
      EXF119@1100285115 : TextConst 'ENU=Select Document Type.;SVE=V„lj dokumenttyp.';
      EXF120@1100285124 : TextConst 'ENU=The system has detected imported Lines, Do you want to Retrieve new receipt lines anyway?;SVE=Sytemet har hittad importerade rader, Vill du h„mta in nya Inleveransrader i alla fall?';
      VendorAdvOpt@1100285125 : Record 12013595;
      EXF121@1100285009 : TextConst 'ENU=User %1 must be Superior in ExFlow User Setup!;SVE=Anv„ndare %1 m†ste var satt som ”verordnad i ExFlow''s anv„ndarbeh”righeter!';
      EXF122@1100285111 : TextConst 'ENU=Operation aborted.;SVE=F”rslagsrad skapad av EXFLOW';
      ChangeCurrencyQst@1100285907 : TextConst 'ENU=If you change %1, the existing purchase lines will be deleted and new purchase lines based on the new information in the header will be created. You may need to update the price information manually.\\Do you want to change %1?;SVE=Om du „ndrar %1 kommer befintliga ink”psrader att tas bort och nya ink”psrader baserade p† den nya informationen i huvudet kommer att skapas. Du kan beh”va uppdatera prisinformationen manuellt.\\Vill du „ndra %1?';
      ExFStdPurchCode@1100285004 : Record 12013682;
      ExfValidatePurchDoc@1100285002 : Codeunit 12013594;
      ExFlow@1100285007 : Codeunit 12013601;
      DeferralLineQst@1100285011 : TextConst '@@@="%1=The posting date on the document.";ENU=You have changed the %1 on the purchase header, do you want to update the deferral schedules for the lines with this date?;SVE=Du har „ndrat %1 p† ink”pshuvudet. Vill du uppdatera periodiseringsschemana f”r raderna med detta datum?';
      ExPeriodicMgt@1100285003 : Codeunit 12013599;
      Text34@1100285012 : TextConst 'ENU=Delete Pre Post Invoice;SVE=Ta bort f”rankomstregistrerad faktura';
      EXF123@1100285013 : TextConst 'ENU=%1 %2 is Pre Inward registrated. Do you want to proceed by reverting the intial inward registration?;SVE=%1 %2 „r f”rankomstregistrerad. Vill du forts„tta genom att v„nda ankomstregistreringen?';
      Text1090003@1101285000 : TextConst 'ENU=%1 and %2 are too long, maximum length is %3 characters.';

    PROCEDURE EmptyLine@1100285001() : Boolean;
    BEGIN
      EXIT((Amount = 0) AND ("Bal. Account No." = ''));
    END;

    PROCEDURE SetupNewLine@1100285000(LastExfDocHead@1100285002 : Record 12013587);
    BEGIN
      ExFlowSetup.GET;
      ExfJnlTemplate.GET("Journal Template Name");
      ExfJnlBatch.GET("Journal Template Name","Journal Batch Name");

      ExfPurchDocHead.SETRANGE("Journal Template Name", LastExfDocHead."Journal Template Name");
      ExfPurchDocHead.SETRANGE("Journal Batch Name", LastExfDocHead."Journal Batch Name");
      IF ExfPurchDocHead.FIND('-') THEN BEGIN
        "Journal Template Name" := "Journal Template Name";
        "Journal Batch Name" := "Journal Batch Name";
        "ExFlow Document Type" := LastExfDocHead."ExFlow Document Type";
        "ExFlow Entry Type" := LastExfDocHead."ExFlow Entry Type";
      END;

      "Date Created" := TODAY();
      "Time Created" := TIME();
      "User ID" := USERID();
      "Posting Date" := WORKDATE;

      CASE ExfJnlBatch."Import Type" OF
        ExfJnlBatch."Import Type"::None:
          "ExFlow Entry Type" := "ExFlow Entry Type"::"Manual Entry";
        ExfJnlBatch."Import Type"::"Image File":
          "ExFlow Entry Type" := "ExFlow Entry Type"::"Image Import";
        ExfJnlBatch."Import Type"::"XML File":
          "ExFlow Entry Type" := "ExFlow Entry Type"::"OCR Import";
      END;

      "ExFlow Document Type" := ExfJnlBatch."Default Document Type";

      CASE ExfJnlBatch."Default Document Type" OF
        ExfJnlBatch."Default Document Type"::" ":
          BEGIN
            "Document Type" := LastExfDocHead."Document Type";
            "ExFlow Document Type" := LastExfDocHead."ExFlow Document Type";
          END;
        ExfJnlBatch."Default Document Type"::Invoice:
          BEGIN
            "ExFlow Document Type" := ExfJnlBatch."Default Document Type";
          END;
        ExfJnlBatch."Default Document Type"::"Credit Memo":
          BEGIN
            "ExFlow Document Type" := ExfJnlBatch."Default Document Type";
          END;
      END;

      CASE "ExFlow Document Type" OF
        "ExFlow Document Type"::Invoice:
          "Document Type" := "Document Type"::Invoice;
        "ExFlow Document Type"::"Credit Memo":
          "Document Type" := "Document Type"::"Credit Memo";
        ELSE
          ERROR(EXF102);
      END;

      VALIDATE("Bal. Account No.",ExfJnlBatch."Predefined Account");
    END;

    PROCEDURE InitRecord@1100285011();
    BEGIN
      IF "Document Type" IN ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::"Return Order"] THEN
        "Order Date" := WORKDATE;

      IF "Document Type" = "Document Type"::Invoice THEN
        "Expected Receipt Date" := WORKDATE;

      IF NOT ("Document Type" IN ["Document Type"::"Blanket Order","Document Type"::Quote]) AND
         ("Posting Date" = 0D)
      THEN
        "Posting Date" := WORKDATE;

      "Document Date" := WORKDATE;

      VALIDATE("Sell-to Customer No.",'');

      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
        GLSetup.GET;
        Correction := GLSetup."Mark Cr. Memos as Corrections";
      END;

      "Date Created" := TODAY();
      "Time Created" := TIME();
      "User ID" := USERID;

      Approval := TRUE;
      "Check Order Line (OCR)" := TRUE;
    END;

    LOCAL PROCEDURE GetVend@1100285009(VendNo@1000 : Code[20]);
    BEGIN
      IF VendNo <> Vend."No." THEN
        Vend.GET(VendNo);
    END;

    PROCEDURE PurchLinesExist@3() : Boolean;
    BEGIN
      ExfPurchDocLine.RESET;
      ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
      EXIT(ExfPurchDocLine.FINDFIRST);
    END;

    PROCEDURE OCRLinesExist@1100285013() : Boolean;
    BEGIN
      ExfPurchDocLine.RESET;
      ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
      ExfPurchDocLine.SETRANGE("OCR Imported Line",TRUE);
      EXIT(ExfPurchDocLine.FINDFIRST);
    END;

    PROCEDURE RecreatePurchLines@4(ChangedFieldName@1000 : Text[100]);
    VAR
      ExPurchLineTemp@1001 : TEMPORARY Record 12013588;
      ExtendedTextAdded@1002 : Boolean;
      ExFWorkFlowMgt@1100285000 : Codeunit 12013593;
    BEGIN
      IF "Document Amount" = 0 THEN
        EXIT;

      IF PurchLinesExist THEN BEGIN
        IF HideValidationDialog THEN
          Confirmed := TRUE
        ELSE
          Confirmed :=
            CONFIRM(
              Text016 +
              Text004,FALSE,ChangedFieldName);
        IF Confirmed THEN BEGIN
          ExfPurchDocLine.LOCKTABLE;

          MODIFY;

          ExfPurchDocLine.RESET;
          ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");

          IF ExfPurchDocLine.FINDSET THEN BEGIN
            REPEAT
              ExfPurchDocLine.TESTFIELD("Quantity Received",0);
              ExfPurchDocLine.TESTFIELD("Quantity Invoiced",0);
              ExfPurchDocLine.TESTFIELD("Return Qty. Shipped",0);
              ExfPurchDocLine.TESTFIELD("Receipt No.",'');
              ExfPurchDocLine.TESTFIELD("Return Shipment No.",'');

              ExfPurchDocLine.TESTFIELD("Prepmt. Amt. Inv.",0);
              ExPurchLineTemp := ExfPurchDocLine;
              ExPurchLineTemp.INSERT;
            UNTIL ExfPurchDocLine.NEXT = 0;

            ExfPurchDocLine.DELETEALL(TRUE);

            ExfPurchDocLine.INIT;
            ExfPurchDocLine."Line No." := 0;
            ExPurchLineTemp.FINDSET;
            ExtendedTextAdded := FALSE;
            REPEAT
              IF ExPurchLineTemp."Attached to Line No." = 0 THEN BEGIN
                ExfPurchDocLine.INIT;

                ExfPurchDocLine."Document Type" := "Document Type";

                ExfPurchDocLine."Line No." := ExfPurchDocLine."Line No." + 10000;
                ExfPurchDocLine.VALIDATE(Type,ExPurchLineTemp.Type);
                IF ExPurchLineTemp."No." = '' THEN BEGIN
                  ExfPurchDocLine.VALIDATE(Description,ExPurchLineTemp.Description);
                  ExfPurchDocLine.VALIDATE("Description 2",ExPurchLineTemp."Description 2");
                  ExfPurchDocLine.CopyImportFieldsFromTempTable(ExPurchLineTemp);
                  ExfPurchDocLine.INSERT;
                END ELSE BEGIN
                  ExfPurchDocLine.VALIDATE("No.",ExPurchLineTemp."No.");
                  IF ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" " THEN BEGIN
                    ExfPurchDocLine.VALIDATE("Unit of Measure Code",ExPurchLineTemp."Unit of Measure Code");
                    ExfPurchDocLine.VALIDATE("Variant Code",ExPurchLineTemp."Variant Code");
                    ExfPurchDocLine."Prod. Order No." := ExPurchLineTemp."Prod. Order No.";
                    IF ExfPurchDocLine."Prod. Order No." <> '' THEN BEGIN
                      ExfPurchDocLine.Description := ExPurchLineTemp.Description;
                      ExfPurchDocLine.VALIDATE("VAT Prod. Posting Group",ExPurchLineTemp."VAT Prod. Posting Group");
                      ExfPurchDocLine.VALIDATE("Gen. Prod. Posting Group",ExPurchLineTemp."Gen. Prod. Posting Group");
                      ExfPurchDocLine.VALIDATE("Qty. per Unit of Measure",ExPurchLineTemp."Qty. per Unit of Measure");
                    END;
                    IF (ExPurchLineTemp."Job No." <> '') AND (ExPurchLineTemp."Job Task No." <> '') THEN BEGIN
                      ExfPurchDocLine.VALIDATE("Job No.",ExPurchLineTemp."Job No.");
                      ExfPurchDocLine.VALIDATE("Job Task No.",ExPurchLineTemp."Job Task No.");
                      ExfPurchDocLine."Job Line Type" := ExPurchLineTemp."Job Line Type";
                    END;

                    IF (ExPurchLineTemp."Job No." <> '') AND (ExPurchLineTemp."Job Task No." <> '') THEN BEGIN
                      ExfPurchDocLine.VALIDATE("Job No.",ExPurchLineTemp."Job No.");
                      ExfPurchDocLine.VALIDATE("Job Task No.",ExPurchLineTemp."Job Task No.");
                      ExfPurchDocLine."Job Line Type" := ExPurchLineTemp."Job Line Type";
                    END;
                    IF ExPurchLineTemp.Quantity <> 0 THEN
                      ExfPurchDocLine.VALIDATE(Quantity,ExPurchLineTemp.Quantity);
                    IF ExPurchLineTemp."Direct Unit Cost" <> 0 THEN
                      ExfPurchDocLine.VALIDATE("Direct Unit Cost",ExPurchLineTemp."Direct Unit Cost");
                    IF ExPurchLineTemp."Line Discount %" <> 0 THEN
                      ExfPurchDocLine.VALIDATE("Line Discount %",ExPurchLineTemp."Line Discount %");

                    ExfPurchDocLine."Routing No." := ExPurchLineTemp."Routing No.";
                    ExfPurchDocLine."Routing Reference No." := ExPurchLineTemp."Routing Reference No.";
                    ExfPurchDocLine."Operation No." := ExPurchLineTemp."Operation No.";
                    ExfPurchDocLine."Work Center No." := ExPurchLineTemp."Work Center No.";
                    ExfPurchDocLine."Prod. Order Line No." := ExPurchLineTemp."Prod. Order Line No.";
                    ExfPurchDocLine."Overhead Rate" := ExPurchLineTemp."Overhead Rate";

                    IF CurrFieldNo = FIELDNO("Currency Code") THEN BEGIN
                      ExfPurchDocLine."Gen. Prod. Posting Group" := ExPurchLineTemp."Gen. Prod. Posting Group";
                      ExfPurchDocLine."VAT Prod. Posting Group" := ExPurchLineTemp."VAT Prod. Posting Group";
                      ExfPurchDocLine."VAT Identifier" := ExPurchLineTemp."VAT Identifier";
                      ExfPurchDocLine."VAT %" := ExPurchLineTemp."VAT %";
                      ExfPurchDocLine."VAT Calculation Type" := ExPurchLineTemp."VAT Calculation Type";
                      ExfPurchDocLine."VAT Base Amount" := ExPurchLineTemp."VAT Base Amount";
                      ExfPurchDocLine."VAT Difference" := ExPurchLineTemp."VAT Difference";
                    END;

                    ExfPurchDocLine."Exflow-Created Entry" := ExPurchLineTemp."Exflow-Created Entry";
                    ExfPurchDocLine."First Approver" := ExPurchLineTemp."First Approver";
                    ExfPurchDocLine."Template Rule" := ExPurchLineTemp."Template Rule";

                    ExfPurchDocLine.CopyImportFieldsFromTempTable(ExPurchLineTemp);

                    IF CurrFieldNo <> FIELDNO("Currency Code") THEN BEGIN
                      ExfPurchDocLine."Order No." := '';
                      ExfPurchDocLine."Quantity Received (Order)" := 0;
                      ExfPurchDocLine."Quantity Invoiced (Order)" := 0;
                      ExfPurchDocLine."Direct Unit Cost (Order)" := 0;
                      ExfPurchDocLine."Line Discount % (Order)":= 0;
                      ExfPurchDocLine."Order Line No." := 0;
                    END;

                    ExfPurchDocLine.INSERT;
                  END;
                END;
                ExtendedTextAdded := FALSE;
              END;
            UNTIL ExPurchLineTemp.NEXT = 0;

            ExFWorkFlowMgt.PrePostUpdateApprovers(Rec);

            ExPurchLineTemp.SETRANGE(Type);
            ExPurchLineTemp.DELETEALL;
          END;
        END ELSE
          ERROR(
            Text018,ChangedFieldName);
      END;
    END;

    PROCEDURE MessageIfPurchLinesExist@5(ChangedFieldName@1000 : Text[100]);
    BEGIN
      IF PurchLinesExist AND NOT HideValidationDialog THEN
        MESSAGE(
          Text019 +
          Text020,
          ChangedFieldName);
    END;

    PROCEDURE PriceMessageIfPurchLinesExist@7(ChangedFieldName@1000 : Text[100]);
    BEGIN
      IF PurchLinesExist AND NOT HideValidationDialog THEN
        MESSAGE(
          Text019 +
          Text021,ChangedFieldName);
    END;

    LOCAL PROCEDURE UpdateCurrencyFactor@12();
    BEGIN
      IF "Currency Code" <> '' THEN BEGIN
        IF "Posting Date" <> 0D THEN
          CurrencyDate := "Posting Date"
        ELSE
          CurrencyDate := WORKDATE;

        //"Currency Factor" := CurrExchRate.ExchangeRate(CurrencyDate,"Currency Code");
        "Currency Factor" := CurrExchRate.ExchangeRate(0,"Job No.",CurrencyDate,"Currency Code",FALSE); // 4PS
      END ELSE
        "Currency Factor" := 0;
    END;

    LOCAL PROCEDURE ConfirmUpdateCurrencyFactor@13();
    BEGIN
      IF HideValidationDialog THEN
        Confirmed := TRUE
      ELSE
        Confirmed := CONFIRM(Text022,FALSE);
      IF Confirmed THEN
        VALIDATE("Currency Factor")
      ELSE
        "Currency Factor" := xRec."Currency Factor";
    END;

    PROCEDURE SetHideValidationDialog@14(NewHideValidationDialog@1000 : Boolean);
    BEGIN
      HideValidationDialog := NewHideValidationDialog;
    END;

    PROCEDURE UpdatePurchLines@15(ChangedFieldName@1000 : Text[100]);
    VAR
      UpdateConfirmed@1002 : Boolean;
      ExFWorkFlowMgt@1100285000 : Codeunit 12013593;
    BEGIN
      ExfPurchDocLine.RESET;
      ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
      IF NOT ExfPurchDocLine.FINDSET(TRUE) THEN
        EXIT;

      HideValidationDialog := TRUE;

      IF NOT GUIALLOWED OR HideValidationDialog THEN
        UpdateConfirmed := TRUE
      ELSE
        UpdateConfirmed :=
          CONFIRM(
            STRSUBSTNO(
              Text032 +
              Text033,ChangedFieldName),TRUE);

      ExfPurchDocLine.LOCKTABLE;
      MODIFY;

      REPEAT
        xExfPurchDocLine := ExfPurchDocLine;
        CASE ChangedFieldName OF
          FIELDCAPTION("Currency Factor"):
            IF ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" " THEN
              ExfPurchDocLine.VALIDATE("Direct Unit Cost");
          FIELDCAPTION("Entry Point"):
            ExfPurchDocLine.VALIDATE("Entry Point","Entry Point");
          FIELDCAPTION(Area):
            ExfPurchDocLine.VALIDATE(Area,Area);
          FIELDCAPTION("Transaction Specification"):
            ExfPurchDocLine.VALIDATE("Transaction Specification","Transaction Specification");
          FIELDCAPTION("First Approver"):
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.VALIDATE("First Approver","First Approver");
          FIELDCAPTION("Template Rule"):
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.VALIDATE("Template Rule","Template Rule");
          FIELDCAPTION("Order No."):
            IF UpdateConfirmed THEN BEGIN
              IF (ExfPurchDocLine."Return Shipment No." <> '') OR (ExfPurchDocLine."Receipt No." <> '') THEN
                ERROR(Text018,FIELDCAPTION("Order No."));

              IF ExfPurchDocLine."OCR Imported Line" THEN
                IF (ExfPurchDocLine."Order No. (Import)" = '') OR (ExfPurchDocLine."Order No. (Import)" = "Order No. (Import)") THEN
                  ExfPurchDocLine.VALIDATE("Order No. (Import)", "Order No.");

              IF ExfPurchDocLine."Exflow-Created Entry" <> ExfPurchDocLine."Exflow-Created Entry"::DiffLine THEN
                IF ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" " THEN
                  ExfPurchDocLine.VALIDATE("Order No.","Order No.");
            END;
          FIELDCAPTION("Location Code"):
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.VALIDATE("Location Code","Location Code");
          ExfPurchDocLine.FIELDCAPTION("Deferral Code"):
              IF ExfPurchDocLine."No." <> '' THEN
                ExfPurchDocLine.VALIDATE("Deferral Code");
          FIELDCAPTION("Job No."):
            IF NOT ExfPurchDocLine.IsLineVATLine(ExfPurchDocLine) THEN
              IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
                ExfPurchDocLine.VALIDATE("Job No.","Job No.");
          FIELDCAPTION(Approval):
            IF Approval THEN BEGIN
              IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN BEGIN
                IF ExFlow.LineTypeAllowed(ExfPurchDocLine.Type, FALSE) THEN
                  ExfPurchDocLine.Approval := Approval;
              END
            END
            ELSE BEGIN // Approval = False
              IF UpdateConfirmed THEN
                ExfPurchDocLine.Approval := Approval;
            END;
          FIELDCAPTION("Check Order Line (OCR)"):
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.VALIDATE("Check Order Line (OCR)", "Check Order Line (OCR)");
          FIELDCAPTION("Receipt No. Mandatory"):
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.VALIDATE("Receipt No. Mandatory", "Receipt No. Mandatory");
        END;
        ExfPurchDocLine.MODIFY;
      UNTIL ExfPurchDocLine.NEXT = 0;
      ExFWorkFlowMgt.PrePostUpdateApprovers(Rec);
    END;

    PROCEDURE CreateDim@16(Type1@1000 : Integer;No1@1001 : Code[20];Type2@1002 : Integer;No2@1003 : Code[20];Type3@1004 : Integer;No3@1005 : Code[20];Type4@1006 : Integer;No4@1007 : Code[20]);
    VAR
      SourceCodeSetup@1010 : Record 242;
      TableID@1011 : ARRAY [10] OF Integer;
      No@1012 : ARRAY [10] OF Code[20];
      OldDimSetID@1100285000 : Integer;
    BEGIN
      SourceCodeSetup.GET;
      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;
      TableID[4] := Type4;
      No[4] := No4;
      "Shortcut Dimension 1 Code" := '';
      "Shortcut Dimension 2 Code" := '';
      OldDimSetID := "Dimension Set ID";
      "Dimension Set ID" :=
        DimMgt.GetDefaultDimID(TableID,No,SourceCodeSetup.Purchases,"Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",0,0);

      IF (OldDimSetID <> "Dimension Set ID") AND PurchLinesExist THEN BEGIN
        MODIFY;
        UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      END;
    END;

    PROCEDURE ValidateShortcutDimCode@19(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    VAR
      OldDimSetID@1100285000 : Integer;
    BEGIN
      OldDimSetID := "Dimension Set ID";
      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");
      IF "Inbound Document No." <> 0 THEN
        MODIFY;

      IF OldDimSetID <> "Dimension Set ID" THEN BEGIN
        MODIFY;
        IF PurchLinesExist THEN
          UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      END;
    END;

    PROCEDURE ReceivedPurchLinesExist@20() : Boolean;
    BEGIN
      ExfPurchDocLine.RESET;
      ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");

      ExfPurchDocLine.SETFILTER("Quantity Received",'<>0');
      EXIT(ExfPurchDocLine.FINDFIRST);
    END;

    PROCEDURE ReturnShipmentExist@5800() : Boolean;
    BEGIN
      ExfPurchDocLine.RESET;
      ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");

      ExfPurchDocLine.SETFILTER("Return Qty. Shipped",'<>0');
      EXIT(ExfPurchDocLine.FINDFIRST);
    END;

    LOCAL PROCEDURE UpdateShipToAddress@21();
    BEGIN
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        EXIT;

      IF ("Location Code" <> '') AND
         Location.GET("Location Code") AND
         ("Sell-to Customer No." = '')
      THEN BEGIN
        "Ship-to Name" := Location.Name;
        "Ship-to Name 2" := Location."Name 2";
        "Ship-to Address" := Location.Address;
        "Ship-to Address 2" := Location."Address 2";
        "Ship-to City" := Location.City;
        "Ship-to Post Code" := Location."Post Code";
        "Ship-to County" := Location.County;
        "Ship-to Country/Region Code" := Location."Country/Region Code";
        "Ship-to Contact" := Location.Contact;
      END;

      IF ("Location Code" = '') AND
         ("Sell-to Customer No." = '')
      THEN BEGIN
        CompanyInfo.GET;
        "Ship-to Code" := '';
        "Ship-to Name" := CompanyInfo."Ship-to Name";
        "Ship-to Name 2" := CompanyInfo."Ship-to Name 2";
        "Ship-to Address" := CompanyInfo."Ship-to Address";
        "Ship-to Address 2" := CompanyInfo."Ship-to Address 2";
        "Ship-to City" := CompanyInfo."Ship-to City";
        "Ship-to Post Code" := CompanyInfo."Ship-to Post Code";
        "Ship-to County" := CompanyInfo."Ship-to County";
        "Ship-to Country/Region Code" := CompanyInfo."Ship-to Country/Region Code";
        "Ship-to Contact" := CompanyInfo."Ship-to Contact";
      END;
    END;

    LOCAL PROCEDURE DeletePurchaseLines@17();
    BEGIN
      IF ExfPurchDocLine.FINDSET(TRUE) THEN BEGIN
        HandleItemTrackingDeletion;
        REPEAT
          ExfPurchDocLine.SuspendStatusCheck(TRUE);
          ExfPurchDocLine.DELETE(TRUE);
        UNTIL ExfPurchDocLine.NEXT = 0;
      END;
    END;

    PROCEDURE HandleItemTrackingDeletion@36();
    VAR
      ReservEntry@1000 : Record 337;
      ReservEntry2@1001 : Record 337;
    BEGIN
      WITH ReservEntry DO BEGIN
        RESET;
        SETCURRENTKEY(
          "Source ID","Source Ref. No.","Source Type","Source Subtype",
          "Source Batch Name","Source Prod. Order Line","Reservation Status");
        SETRANGE("Source Type",DATABASE::"Exflow Purchase Document Line");
        SETRANGE("Source Subtype","Document Type");
        SETRANGE("Source ID",FORMAT("Inbound Document No."));
        SETRANGE("Source Batch Name",'');
        SETRANGE("Source Prod. Order Line",0);
        SETFILTER("Item Tracking",'> %1',"Item Tracking"::None);
        IF ISEMPTY THEN
          EXIT;

        IF HideValidationDialog OR NOT GUIALLOWED THEN
          Confirmed := TRUE
        ELSE
          Confirmed := CONFIRM(Text041,FALSE,LOWERCASE(FORMAT("Document Type")),FORMAT("Inbound Document No."));

        IF NOT Confirmed THEN
          ERROR(EXF122);

        IF FINDSET THEN
          REPEAT
            ReservEntry2 := ReservEntry;
            ReservEntry2.ClearItemTrackingFields;
            ReservEntry2.MODIFY;
          UNTIL NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE ClearItemAssgntPurchFilter@22(VAR TempItemChargeAssgntPurch@1000 : Record 5805);
    BEGIN
      TempItemChargeAssgntPurch.SETRANGE("Document Line No.");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Type");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. No.");
      TempItemChargeAssgntPurch.SETRANGE("Applies-to Doc. Line No.");
    END;

    PROCEDURE ShowDocDim@32();
    VAR
      OldDimSetID@1100285000 : Integer;
    BEGIN
      OldDimSetID := "Dimension Set ID";
      "Dimension Set ID" :=
        DimMgt.EditDimensionSet2(
          "Dimension Set ID",STRSUBSTNO('%1 %2',"Document Type",FORMAT("Inbound Document No.")),
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");

      IF OldDimSetID <> "Dimension Set ID" THEN BEGIN
        MODIFY;
        IF PurchLinesExist THEN
          UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      END;
    END;

    LOCAL PROCEDURE UpdateAllLineDim@34(NewParentDimSetID@1000 : Integer;OldParentDimSetID@1001 : Integer);
    VAR
      NewDimSetID@1002 : Integer;
      ExFWorkFlowMgt@1100285000 : Codeunit 12013593;
    BEGIN
      // Update all lines with changed dimensions.

      IF NewParentDimSetID = OldParentDimSetID THEN
        EXIT;

      ExfPurchDocLine.RESET;
      ExfPurchDocLine.SETRANGE("Inbound Document No.","Inbound Document No.");
      IF ExfPurchDocLine.FINDSET(TRUE) THEN BEGIN
        REPEAT
          NewDimSetID := DimMgt.GetDeltaDimSetID(ExfPurchDocLine."Dimension Set ID",NewParentDimSetID,OldParentDimSetID);
          IF ExfPurchDocLine."Dimension Set ID" <> NewDimSetID THEN BEGIN
            ExfPurchDocLine."Dimension Set ID" := NewDimSetID;
            DimMgt.UpdateGlobalDimFromDimSetID(
              ExfPurchDocLine."Dimension Set ID",ExfPurchDocLine."Shortcut Dimension 1 Code",ExfPurchDocLine."Shortcut Dimension 2 Code");
            ExfPurchDocLine.MODIFY;
          END;
        UNTIL ExfPurchDocLine.NEXT = 0;

        ExFWorkFlowMgt.PrePostUpdateApprovers(Rec);
      END;
    END;

    PROCEDURE SetAmountToApply@18(AppliesToDocNo@1000 : Code[20];VendorNo@1001 : Code[20]);
    BEGIN
      VendLedgEntry.SETCURRENTKEY("Document No.");
      VendLedgEntry.SETRANGE("Document No.",AppliesToDocNo);
      VendLedgEntry.SETRANGE("Vendor No.",VendorNo);
      VendLedgEntry.SETRANGE(Open,TRUE);
      IF VendLedgEntry.FINDFIRST THEN BEGIN
        IF VendLedgEntry."Amount to Apply" = 0 THEN  BEGIN
          VendLedgEntry.CALCFIELDS("Remaining Amount");
          VendLedgEntry."Amount to Apply" := VendLedgEntry."Remaining Amount";
        END ELSE
          VendLedgEntry."Amount to Apply" := 0;
        VendLedgEntry."Accepted Payment Tolerance" := 0;
        VendLedgEntry."Accepted Pmt. Disc. Tolerance" := FALSE;
        CODEUNIT.RUN(CODEUNIT::"Vend. Entry-Edit",VendLedgEntry);
      END;
    END;

    PROCEDURE SetShipToForSpecOrder@23();
    BEGIN
      IF Location.GET("Location Code") THEN BEGIN
        "Ship-to Code" := '';
        "Ship-to Name" := Location.Name;
        "Ship-to Name 2" := Location."Name 2";
        "Ship-to Address" := Location.Address;
        "Ship-to Address 2" := Location."Address 2";
        "Ship-to City" := Location.City;
        "Ship-to Post Code" := Location."Post Code";
        "Ship-to County" := Location.County;
        "Ship-to Country/Region Code" := Location."Country/Region Code";
        "Ship-to Contact" := Location.Contact;
        "Location Code" := Location.Code;
      END ELSE BEGIN
        CompanyInfo.GET;
        "Ship-to Code" := '';
        "Ship-to Name" := CompanyInfo."Ship-to Name";
        "Ship-to Name 2" := CompanyInfo."Ship-to Name 2";
        "Ship-to Address" := CompanyInfo."Ship-to Address";
        "Ship-to Address 2" := CompanyInfo."Ship-to Address 2";
        "Ship-to City" := CompanyInfo."Ship-to City";
        "Ship-to Post Code" := CompanyInfo."Ship-to Post Code";
        "Ship-to County" := CompanyInfo."Ship-to County";
        "Ship-to Country/Region Code" := CompanyInfo."Ship-to Country/Region Code";
        "Ship-to Contact" := CompanyInfo."Ship-to Contact";
        "Location Code" := '';
      END;
    END;

    PROCEDURE JobUpdatePurchLines@28();
    BEGIN
      WITH ExfPurchDocLine DO BEGIN
        SETFILTER("Job No.",'<>%1','');
        SETFILTER("Job Task No.",'<>%1','');
        LOCKTABLE;
        IF FINDSET(TRUE,FALSE) THEN BEGIN
          ExfPurchDocLine.SetExfPurchDocHeader(Rec);
          REPEAT
            JobSetCurrencyFactor;
            CreateTempJobJnlLine(FALSE);
            UpdatePricesFromJobJnlLine;
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END
    END;

    PROCEDURE GetDefaultVATProdPostGroup@1100285003() DefaultVATProdPostGroup : Code[10];
    VAR
      GLAccount@1100285000 : Record 15;
    BEGIN
      IF GLAccount.GET("Prop. Line G/L Account") THEN BEGIN
        IF GLAccount."VAT Prod. Posting Group" <> '' THEN
          DefaultVATProdPostGroup := GLAccount."VAT Prod. Posting Group"
        ELSE BEGIN
          //4PS
          IF "VAT Prod. Posting Group" <> '' THEN
            DefaultVATProdPostGroup := "VAT Prod. Posting Group"
          ELSE BEGIN
          //4PS
            ExFlowSetup.GET;
            IF ExFlowSetup."Std. VAT Prod. Posting Group" <> '' THEN
              DefaultVATProdPostGroup := ExFlowSetup."Std. VAT Prod. Posting Group"
            ELSE
              ERROR(EXF101,GLAccount."No.");
          END;
        END;
      END;
    END;

    PROCEDURE GetDefaultVATPerc@1100285004(VAR DefaultVATProdPostGroup@1100285002 : Code[10];VAR DefaultVATPerc@1100285003 : Decimal);
    VAR
      VATPostSetup@1100285000 : Record 325;
    BEGIN
      DefaultVATProdPostGroup := GetDefaultVATProdPostGroup;
      IF NOT VATPostSetup.GET("VAT Bus. Posting Group",DefaultVATProdPostGroup) THEN
        EXIT;

      DefaultVATPerc := VATPostSetup."VAT %";

      CASE VATPostSetup."VAT Calculation Type" OF
        VATPostSetup."VAT Calculation Type"::"Reverse Charge VAT",
        VATPostSetup."VAT Calculation Type"::"Sales Tax":
          DefaultVATPerc := 0;
        VATPostSetup."VAT Calculation Type"::"Full VAT": ;
      END;
    END;

    PROCEDURE GetVATLineVATProdPostGroup@1100285005(VAR VATLineVATProdPostGroup@1100285001 : Code[10];VAR VATLineGLAccount@1100285002 : Code[20]);
    VAR
      VATPostSetup@1100285000 : Record 325;
    BEGIN
      VATPostSetup.SETRANGE("VAT Bus. Posting Group","VAT Bus. Posting Group");

      IF ExFlowSetup."VAT Prod. Grp From VAT Acc" THEN
        VATPostSetup.SETRANGE("VAT Prod. Posting Group", "Default VAT Prod. Post. Group")
      ELSE BEGIN
        ExFlowSetup.GET;
        VATPostSetup.SETRANGE("VAT Prod. Posting Group", ExFlowSetup."VAT Prod. Posting Group 100%");
      END;

      IF NOT VATPostSetup.FINDFIRST THEN
        EXIT;

      VATLineVATProdPostGroup := VATPostSetup."VAT Prod. Posting Group";
      VATLineGLAccount := VATPostSetup."Purchase VAT Account";
    END;

    PROCEDURE ShowImage@1100285014();
    VAR
      ImageBLOB@1100285007 : Record 12013591;
    BEGIN
      ExFlowSetup.GET;

      IF NOT ImageBLOB.GET("Image Buffer ID") THEN
        ERROR(EXF106,"Inbound Document No.");

      ImageBLOB.ShowBLOB;
    END;

    PROCEDURE CalculateHeaderAmounts@1100285015(CalledFromFieldNo@1100285000 : Integer);
    VAR
      VATCorrection@1100285001 : Decimal;
      NetCorrection@1100285002 : Decimal;
      GrossCorrection@1100285003 : Decimal;
      RoundingCorrection@1100285004 : Decimal;
    BEGIN
      PurchSetup.GET;

      IF "Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET("Currency Code");

      CASE GetFieldCaption(CalledFromFieldNo) OF

        FIELDCAPTION("Document Amount"):
          BEGIN
            "VAT calculated from" := "VAT calculated from"::"Net Amount";
            IF "Default VAT %" <> 0 THEN
              "Document Amount VAT" := ROUND(
                                         "Document Amount" * ("Default VAT %" / 100),
                                         Currency."Amount Rounding Precision")
            ELSE
              "Document Amount VAT" := 0;

            IF PurchSetup."Invoice Rounding" THEN BEGIN
              "Document Amount Including VAT" := ROUND(
                                                   "Document Amount" + "Document Amount VAT",
                                                   Currency."Invoice Rounding Precision");
            END ELSE BEGIN
              "Document Amount Including VAT" := ROUND(
                                                   "Document Amount" + "Document Amount VAT",
                                                   Currency."Amount Rounding Precision");
            END;
          END;

        FIELDCAPTION("Document Amount Including VAT"):
          BEGIN
            "VAT calculated from" := "VAT calculated from"::"Gross Amount";
            IF "ExFlow Entry Type" <> "ExFlow Entry Type"::"OCR Import" THEN BEGIN
              IF "Default VAT %" <> 0 THEN
                "Document Amount VAT" := ROUND(
                                           ("Document Amount Including VAT" / (100 + "Default VAT %")) * "Default VAT %",
                                           Currency."Amount Rounding Precision")
              ELSE
                "Document Amount VAT" := 0;
            END;
            "Document Amount" := "Document Amount Including VAT" - "Document Amount VAT";
          END;

        FIELDCAPTION("Document Amount VAT"):
          BEGIN
            CASE "VAT calculated from" OF
              "VAT calculated from"::"Net Amount":
                BEGIN
                  IF PurchSetup."Invoice Rounding" THEN BEGIN
                    "Document Amount Including VAT" := ROUND(
                                                         "Document Amount" + "Document Amount VAT",
                                                         Currency."Invoice Rounding Precision");
                  END ELSE BEGIN
                    "Document Amount Including VAT" := ROUND(
                                                         "Document Amount" + "Document Amount VAT",
                                                         Currency."Amount Rounding Precision");
                  END;
                END;
              "VAT calculated from"::"Gross Amount":
                  BEGIN
                    IF PurchSetup."Invoice Rounding" THEN BEGIN
                      VATCorrection := "Document Amount VAT" - xRec."Document Amount VAT";
                      IF "Default VAT %" <> 0 THEN
                        GrossCorrection := (VATCorrection / "Default VAT %") * (100 + "Default VAT %")
                      ELSE
                        GrossCorrection := VATCorrection;
                      NetCorrection := GrossCorrection - VATCorrection;
                      RoundingCorrection := -GrossCorrection;
                      CASE TRUE OF
                        (ABS(GrossCorrection) > (Currency."Invoice Rounding Precision" / 2)):
                          BEGIN
                            "Document Amount" := "Document Amount Including VAT" - "Document Amount VAT";
                          END;
                        (ABS(GrossCorrection) < (Currency."Invoice Rounding Precision" / 2)):
                          BEGIN
                            "Document Amount" := "Document Amount" + NetCorrection;
                          END;
                        (ABS(GrossCorrection) = (Currency."Invoice Rounding Precision" / 2)):
                          BEGIN
                            CASE TRUE OF
                              VATCorrection > 0:
                                BEGIN
                                  "Document Amount" := "Document Amount Including VAT" - "Document Amount VAT";
                                END;
                              VATCorrection < 0:
                                BEGIN
                                  "Document Amount" := "Document Amount" + NetCorrection;
                                END;
                            END;
                          END;
                      END;
                    END ELSE BEGIN
                      "Document Amount" := "Document Amount Including VAT" - "Document Amount VAT";
                    END;
                  END;
            END;
          END;
      END;

      IF "Document Amount" <> 0 THEN
        "Calculated VAT %" := ROUND(100 * "Document Amount VAT" / "Document Amount",0.01);
    END;

    LOCAL PROCEDURE GetFieldCaption@31(FieldNumber@1000 : Integer) : Text[100];
    VAR
      Field@1001 : Record 2000000041;
    BEGIN
      IF FieldNumber = 0 THEN
        EXIT('');

      IF Field.GET(DATABASE::"Exflow Purch. Document Header",FieldNumber) THEN
        EXIT(Field."Field Caption")
      ELSE
        EXIT('');
    END;

    PROCEDURE RetrievePurchaseLines@1100285024(VAR precExPurchDocHead@1100285000 : Record 12013587);
    VAR
      PurchRcptLine@1100285003 : Record 121;
      ReturnShptLine@1100285005 : Record 6651;
      PurchLine@1100285002 : Record 39;
      ExFPurchLine@1100285008 : Record 12013588;
      GetReturnShipments@1100285006 : Codeunit 12013590;
      GetReceipts@1100285001 : Codeunit 12013588;
      GetOrders@1100285004 : Codeunit 12013608;
      ExFlowValidatePurchDoc@1100285007 : Codeunit 12013594;
      ExDimMgt@1100285009 : Codeunit 12013605;
      ExFWorkFlowMgt@1100285010 : Codeunit 12013593;
    BEGIN
      WITH precExPurchDocHead DO BEGIN
        IF ("Buy-from Vendor No." <> '') AND ("Order No." <> '') THEN BEGIN
          precExPurchDocHead.MODIFY;

          ExFlowSetup.GET;
          IF ExFlowSetup."Order Applies-to" = ExFlowSetup."Order Applies-to"::"Receipts Lines" THEN BEGIN
            CASE "ExFlow Document Type" OF
              "ExFlow Document Type"::Invoice:
                BEGIN
                  PurchRcptLine.SETCURRENTKEY("Pay-to Vendor No.");
                  PurchRcptLine.SETRANGE("Pay-to Vendor No.","Pay-to Vendor No.");
                  PurchRcptLine.SETRANGE("Buy-from Vendor No.","Buy-from Vendor No.");
                  PurchRcptLine.SETFILTER("Qty. Rcd. Not Invoiced",'<>0');
                  PurchRcptLine.SETRANGE("Currency Code","Currency Code");
                  PurchRcptLine.SETRANGE("Order No.", "Order No.");
                  GetReceipts.SetPurchHeader(precExPurchDocHead);
                  GetReceipts.DeleteProposedLines(precExPurchDocHead);
                  GetReceipts.CreateInvLines(PurchRcptLine,FALSE,CurrFieldNo = 0);
                END;
              "ExFlow Document Type"::"Credit Memo":
                BEGIN
                  ReturnShptLine.SETCURRENTKEY("Pay-to Vendor No.");
                  ReturnShptLine.SETRANGE("Pay-to Vendor No.","Pay-to Vendor No.");
                  ReturnShptLine.SETRANGE("Buy-from Vendor No.","Buy-from Vendor No.");
                  ReturnShptLine.SETFILTER("Return Qty. Shipped Not Invd.",'<>0');
                  ReturnShptLine.SETRANGE("Currency Code","Currency Code");
                  ReturnShptLine.SETRANGE("Return Order No.", "Order No.");
                  GetReturnShipments.SetPurchHeader(precExPurchDocHead);
                  GetReturnShipments.DeleteProposedLines(precExPurchDocHead);
                  GetReturnShipments.CreateInvLines(ReturnShptLine,FALSE);
                END;
            END;
          END
          ELSE BEGIN
            IF ExFlowSetup."Order Applies-to" IN [ExFlowSetup."Order Applies-to"::"Purch Order Lines",
                                                  ExFlowSetup."Order Applies-to"::"First Order then Receipt"] THEN BEGIN

              GetOrders.SetFilters(precExPurchDocHead,PurchLine,ExFlowSetup,FALSE);
              PurchLine.SETRANGE("Document No.", "Order No.");
              GetOrders.DeleteProposedLines(precExPurchDocHead);
              GetOrders.CreateInvLines(PurchLine,precExPurchDocHead,FALSE);
            END;
          END;

          precExPurchDocHead.GET(precExPurchDocHead."Inbound Document No.");

          IF ExFlowSetup."Copy Line Dimensions to Header" THEN BEGIN
            ExFPurchLine.RESET;
            ExFPurchLine.SETRANGE("Inbound Document No.",precExPurchDocHead."Inbound Document No.");
            ExFPurchLine.SETFILTER(Quantity, '<>%1', 0);
            IF ExFPurchLine.FINDLAST THEN BEGIN
              precExPurchDocHead.GET(precExPurchDocHead."Inbound Document No.");
              ExDimMgt.UpdateDimHeaderImportWorksheet(precExPurchDocHead);
            END;
          END;

          ExFlowValidatePurchDoc.InsertMiscLines(precExPurchDocHead,ExFlowSetup,FALSE);

          IF precExPurchDocHead."Propose Diff. Line" THEN
            ExFlowValidatePurchDoc.CreateDiffLine(precExPurchDocHead,AppSetup,FALSE);

          ExFWorkFlowMgt.PrePostUpdateApprovers(precExPurchDocHead);

          precExPurchDocHead.GET(precExPurchDocHead."Inbound Document No.");
        END;
      END;
    END;

    PROCEDURE SwitchExFlowDocumentType@1100285018();
    VAR
      ExPurchDocLine@1100285002 : Record 12013588;
      lcduExfVerifyDoc@1100285003 : Codeunit 12013594;
    BEGIN
      IF CurrFieldNo <> 0 THEN
        IF "ExFlow Document Type" = "ExFlow Document Type"::"Prepayment Invoice" THEN BEGIN
          GetDefaultPropAccounts(Rec);
          "Propose Line" := TRUE;
          IF "Prepayment Order No." = '' THEN
            VALIDATE("Prepayment Order No.", "Order No.");

          lcduExfVerifyDoc.CreatePurchProposalLine(Rec,FALSE,TRUE);
        END;

      IF xRec."Document Type" = "Document Type" THEN
        EXIT;

      VALIDATE("Payment Terms Code");

      IF "Inbound Document No." <> 0 THEN BEGIN
        ExPurchDocLine.RESET;
        ExPurchDocLine.SETRANGE("Inbound Document No.", "Inbound Document No.");
        ExPurchDocLine.SETFILTER("Receipt No.", '<>%1', '');
        IF ExPurchDocLine.FINDFIRST THEN
          IF NOT CONFIRM(EXF113) THEN
            ERROR(EXF122)
          ELSE BEGIN
            ExPurchDocLine.SETRANGE("Receipt No.");
            ExPurchDocLine.DELETEALL(TRUE);
          END;

        ExPurchDocLine.SETRANGE("Receipt No.");
        ExPurchDocLine.SETFILTER("Return Shipment No.", '<>%1', '');
        IF ExPurchDocLine.FINDFIRST THEN
          IF NOT CONFIRM(EXF113) THEN
            ERROR(EXF122)
          ELSE BEGIN
            ExPurchDocLine.SETRANGE("Return Shipment No.");
            ExPurchDocLine.DELETEALL(TRUE);
          END;

        ExPurchDocLine.SETRANGE("Return Shipment No.");
        IF ExPurchDocLine.FINDSET THEN
          REPEAT
            WITH ExPurchDocLine DO BEGIN
              VALIDATE("Document Type", Rec."Document Type");

              "Qty. to Receive" := 0;
              "Qty. to Receive (Base)" := 0;
              "Qty. to Invoice" := 0;
              "Qty. to Invoice (Base)" := 0;
              "Return Qty. to Ship" := 0;
              "Return Qty. to Ship (Base)" := 0;
              "Qty. to Invoice" := 0;
              "Qty. to Invoice (Base)" := 0;

              IF "Document Type" IN ["Document Type"::"Return Order",
                                     "Document Type"::"Credit Memo"] THEN
                InitQtyToShip
              ELSE
                InitQtyToReceive;

              MODIFY;
            END;
          UNTIL ExPurchDocLine.NEXT = 0;
        END;
    END;

    PROCEDURE LookupShortcutDimCode@30(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      DimMgt.LookupDimValueCode(FieldNumber,ShortcutDimCode);
      ValidateShortcutDimCode(FieldNumber,ShortcutDimCode);
    END;

    PROCEDURE ShowShortcutDimCode@27(VAR ShortcutDimCode@1000 : ARRAY [8] OF Code[20]);
    BEGIN
      DimMgt.GetShortcutDimensions("Dimension Set ID",ShortcutDimCode);
    END;

    PROCEDURE UpdatePurchLinesShortcutDim@1100285019(ShortcutDimNo@1000 : Integer;ShortcutDimCode@1100285001 : Code[20]);
    VAR
      ChangedFieldName@1100285002 : ARRAY [8] OF Text[100];
      UpdateConfirmed@1002 : Boolean;
      CaptionManagement@1100583000 : Codeunit 42;
    BEGIN
      IF NOT PurchLinesExist THEN
        EXIT;

      HideValidationDialog := TRUE;

      IF NOT GUIALLOWED OR HideValidationDialog THEN
        UpdateConfirmed := TRUE
      ELSE
        CASE ShortcutDimNo OF
          3:
            BEGIN
              ChangedFieldName[3] := CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE,'1,2,3');
              UpdateConfirmed :=
                CONFIRM(
                  STRSUBSTNO(
                    Text032 +
                    Text033,ChangedFieldName[3]),TRUE);
            END;
          4:
            BEGIN
              ChangedFieldName[4] := CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE,'1,2,4');
              UpdateConfirmed :=
                CONFIRM(
                  STRSUBSTNO(
                    Text032 +
                    Text033,ChangedFieldName[4]),TRUE);
            END;
          5:
            BEGIN
              ChangedFieldName[5] := CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE,'1,2,5');
              UpdateConfirmed :=
                CONFIRM(
                  STRSUBSTNO(
                    Text032 +
                    Text033,ChangedFieldName[5]),TRUE);
            END;
          6:
            BEGIN
              ChangedFieldName[6] := CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE,'1,2,6');
              UpdateConfirmed :=
                CONFIRM(
                  STRSUBSTNO(
                    Text032 +
                    Text033,ChangedFieldName[6]),TRUE);
            END;
          7:
            BEGIN
              ChangedFieldName[7] := CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE,'1,2,7');
              UpdateConfirmed :=
                CONFIRM(
                  STRSUBSTNO(
                    Text032 +
                    Text033,ChangedFieldName[7]),TRUE);
            END;
          8:
            BEGIN
              ChangedFieldName[8] := CaptionManagement.CaptionClassTranslate(GLOBALLANGUAGE,'1,2,8');
              UpdateConfirmed :=
                CONFIRM(
                  STRSUBSTNO(
                    Text032 +
                    Text033,ChangedFieldName[8]),TRUE);
            END;
        END;

      ExfPurchDocLine.LOCKTABLE;

      REPEAT
        xExfPurchDocLine := ExfPurchDocLine;
        CASE ShortcutDimNo OF
          3:
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.ValidateShortcutDimCode(3,ShortcutDimCode);
          4:
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.ValidateShortcutDimCode(4,ShortcutDimCode);
          5:
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.ValidateShortcutDimCode(5,ShortcutDimCode);
          6:
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.ValidateShortcutDimCode(6,ShortcutDimCode);
          7:
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.ValidateShortcutDimCode(7,ShortcutDimCode);
          8:
            IF UpdateConfirmed AND (ExfPurchDocLine.Type <> ExfPurchDocLine.Type::" ") THEN
              ExfPurchDocLine.ValidateShortcutDimCode(8,ShortcutDimCode);
        END;
        ExfPurchDocLine.MODIFY(TRUE);
      UNTIL ExfPurchDocLine.NEXT = 0;
    END;

    PROCEDURE OrderNoLookup@1100285007();
    VAR
      PurchHeader@1100285001 : Record 38;
      PurchLine@1100285002 : Record 39;
      PurchaseList@1100285000 : Page 53;
    BEGIN
      PurchHeader.RESET;
      CASE "Document Type" OF
        "Document Type"::Invoice:
          PurchHeader.SETRANGE("Document Type", PurchHeader."Document Type"::Order);
        "Document Type"::"Credit Memo":
          PurchHeader.SETRANGE("Document Type", PurchHeader."Document Type"::"Return Order");
      END;

      PurchHeader.SETRANGE("Currency Code", "Currency Code");
      PurchHeader.SETRANGE("Pay-to Vendor No.", "Pay-to Vendor No.");
      PurchHeader.SETRANGE("Buy-from Vendor No.", "Buy-from Vendor No.");
      IF "Order No." <> '' THEN BEGIN
        PurchHeader.SETRANGE("No.","Order No.");
        IF PurchHeader.FINDFIRST THEN
          PurchaseList.SETRECORD(PurchHeader);
        PurchHeader.SETRANGE("No.");
      END;

      IF PurchHeader.FINDSET THEN BEGIN
        REPEAT
          PurchLine.SETRANGE("Document Type",PurchHeader."Document Type");
          PurchLine.SETRANGE("Document No.",PurchHeader."No.");
          PurchLine.SETRANGE("Fully Matched", FALSE);
          IF NOT PurchLine.ISEMPTY THEN
            PurchHeader.MARK(TRUE);
        UNTIL PurchHeader.NEXT = 0;

        PurchHeader.MARKEDONLY(TRUE);
      END;

      PurchaseList.SETTABLEVIEW(PurchHeader);
      PurchaseList.LOOKUPMODE := TRUE;
      IF PurchaseList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        PurchaseList.GETRECORD(PurchHeader);
        VALIDATE("Order No.", PurchHeader."No.");
      END;
    END;

    PROCEDURE GetDefaultPropAccounts@1100285012(VAR ExPurchHeader@1100285000 : Record 12013587);
    VAR
      ApprovalSetup@1100285001 : Record 12013601;
      Vendor@1100285002 : Record 23;
      JournalBatch@1100285003 : Record 12013590;
      ExFlowVend@1100285004 : Record 12013595;
      ExContract@1100285005 : Record 12013633;
    BEGIN
      ApprovalSetup.GET;

      ExPurchHeader."Predefined Purch. Code" := '';
      ExPurchHeader."Predefined Purch. Code" := '';

      JournalBatch.GET("Journal Template Name","Journal Batch Name");
      ExPurchHeader."Diffline Purch. Code" := ApprovalSetup."Diffline Purch. Code";

      IF JournalBatch."Diffline Purch. Code" <> '' THEN
        ExPurchHeader."Diffline Purch. Code" := JournalBatch."Diffline Purch. Code";

      IF ExPurchHeader."Contract No." <> 0 THEN BEGIN
        ExContract.GET(ExPurchHeader."Contract No.");
        IF ExContract."Predefined Purch. Code" <> '' THEN BEGIN
          ExPurchHeader.VALIDATE("Predefined Purch. Code", ExContract."Predefined Purch. Code");

          EXIT;
        END;
      END;

      IF ExPurchHeader."ExFlow Document Type" = ExPurchHeader."ExFlow Document Type"::"Prepayment Invoice" THEN
        IF ApprovalSetup."Prepmt. Predefined Account" <> '' THEN BEGIN
          ExPurchHeader."Prop. Line G/L Account" := ApprovalSetup."Prepmt. Predefined Account";

          EXIT;
        END;

      IF Vendor.GET("Buy-from Vendor No.") THEN BEGIN
        IF ExFlowVend.GET("Buy-from Vendor No.") THEN
          IF ExFlowVend."Diffline Purch. Code" <> '' THEN
            ExPurchHeader."Diffline Purch. Code" := ExFlowVend."Diffline Purch. Code";

        IF Vendor."Predefined Purch. Code" <> '' THEN BEGIN
          ExPurchHeader.VALIDATE("Predefined Purch. Code", Vendor."Predefined Purch. Code");

          EXIT;
        END;

        IF Vendor."Predefined Account" <> '' THEN BEGIN
          ExPurchHeader."Prop. Line G/L Account" := Vendor."Predefined Account";

          EXIT;
        END;
      END;

      IF JournalBatch."Predefined Purch. Code" <> '' THEN BEGIN
        ExPurchHeader.VALIDATE("Predefined Purch. Code", JournalBatch."Predefined Purch. Code");

        EXIT;
      END;

      IF JournalBatch."Predefined Account" <> '' THEN BEGIN
        ExPurchHeader."Prop. Line G/L Account" := JournalBatch."Predefined Account";

        EXIT;
      END;

      IF ApprovalSetup."Predefined Purch. Code" <> '' THEN BEGIN
        ExPurchHeader.VALIDATE("Predefined Purch. Code", ApprovalSetup."Predefined Purch. Code");

        EXIT;
      END;

      IF ApprovalSetup."Predefined Account" <> '' THEN BEGIN
        ExPurchHeader."Prop. Line G/L Account" := ApprovalSetup."Predefined Account";

        EXIT;
      END;
    END;

    PROCEDURE ShowImportCard@1100285002();
    VAR
      ExfImportedPurchHead@1100285000 : Record 12013650;
    BEGIN
      IF ExfImportedPurchHead.GET("Import Document No.") THEN
        PAGE.RUNMODAL(12013635,ExfImportedPurchHead)
      ELSE
        MESSAGE(EXF117);
    END;

    PROCEDURE OpenImportAttachments@1100285006();
    VAR
      ImportAttachment@1100285000 : Record 12013592;
      ExFlowFileMgt@1100285001 : Codeunit 12013602;
    BEGIN
      ImportAttachment.RESET;
      ImportAttachment.SETRANGE("Inbound Document No.", "Inbound Document No.");
      IF ImportAttachment.FINDSET THEN
        REPEAT
          IF ImportAttachment."Attached File" <> '' THEN
            ExFlowFileMgt.ShowDoc(ImportAttachment."Attached File");
        UNTIL ImportAttachment.NEXT = 0;
    END;

    PROCEDURE DisplayFileName@1100285010() : Text[250];
    VAR
      ExFlowFileMgt@1100285000 : Codeunit 12013602;
    BEGIN
      EXIT(ExFlowFileMgt.GetFileName("Image File Name"));
    END;

    LOCAL PROCEDURE ConfirmUpdateDeferralDate@85();
    BEGIN
      IF HideValidationDialog THEN
        Confirmed := TRUE
      ELSE
        Confirmed := CONFIRM(DeferralLineQst,FALSE,FIELDCAPTION("Posting Date"));
      IF Confirmed THEN
        UpdatePurchLines(ExfPurchDocLine.FIELDCAPTION("Deferral Code"));
    END;

    PROCEDURE DeferralHeadersExist@38() : Boolean;
    VAR
      DeferralHeader@1000 : Record 1701;
      DeferralUtilities@1001 : Codeunit 1720;
    BEGIN
      DeferralHeader.SETRANGE("Deferral Doc. Type",DeferralUtilities.GetPurchDeferralDocType);
      DeferralHeader.SETRANGE("Gen. Jnl. Template Name",'');
      DeferralHeader.SETRANGE("Gen. Jnl. Batch Name",'');
      DeferralHeader.SETRANGE("Document Type","Document Type");
      DeferralHeader.SETRANGE("Document No.",FORMAT("Inbound Document No."));
      EXIT(NOT DeferralHeader.ISEMPTY);
    END;

    PROCEDURE BatchConfirmUpdateDeferralDate@78(VAR BatchConfirm@1000 : ' ,Skip,Update';ReplacePostingDate@1001 : Boolean;PostingDateReq@1002 : Date);
    BEGIN
      IF (NOT ReplacePostingDate) OR (PostingDateReq = "Posting Date") OR (BatchConfirm = BatchConfirm::Skip) THEN
        EXIT;

      IF NOT ExPeriodicMgt.DeferralHeadersExist("Document Type","Inbound Document No.") THEN
        EXIT;

      "Posting Date" := PostingDateReq;
      CASE BatchConfirm OF
        BatchConfirm::" ":
          BEGIN
            ConfirmUpdateDeferralDate;
            IF Confirmed THEN
              BatchConfirm := BatchConfirm::Update
            ELSE
              BatchConfirm := BatchConfirm::Skip;
          END;
        BatchConfirm::Update:
          UpdatePurchLines(ExfPurchDocLine.FIELDCAPTION("Deferral Code"));
      END;
      COMMIT;
    END;

    PROCEDURE ConfirmDeletePrePost@1100285016();
    BEGIN
      IF HideValidationDialog THEN
        Confirmed := TRUE
      ELSE
        Confirmed := CONFIRM(Text34,FALSE,FIELDCAPTION("Posting Date"));
      IF Confirmed THEN
      //  Delete(ExfPurchDocLine.FIELDCAPTION("Deferral Code"));
    END;

    PROCEDURE RetrievePrePost@1100285008(VAR ExfPurchDocHead@1100285004 : Record 12013587;DocType@1100285001 : Integer;DocNo@1100285002 : Code[20]) : Boolean;
    BEGIN
      WITH ExfPurchDocHead DO BEGIN
        RESET;
        CLEAR(ExfPurchDocHead);
        SETRANGE("Document Type", DocType);
        SETRANGE("Pre Post No.", DocNo);
        EXIT(FINDFIRST);
      END;
    END;

    LOCAL PROCEDURE CheckRevertPrePost@1100285017();
    VAR
      PurchaseHeader@1100285000 : Record 38;
    BEGIN
      IF "Pre Post No." <> '' THEN BEGIN
        IF HideValidationDialog THEN
          Confirmed := FALSE
        ELSE
          Confirmed := CONFIRM(EXF123,TRUE,"Document Type","Vendor Document No.","Document Type","Pre Post No.");

        IF Confirmed THEN BEGIN
          PurchaseHeader.GET("Document Type", "Pre Post No.");
          "Pre Post No." := '';
          "Pre Posting" := ExFlowSetup."Automatic Reg. of Inwards";
          MODIFY;
          PurchaseHeader.DELETE(TRUE);
        END ELSE
          ERROR(EXF122);
      END;
    END;

    BEGIN
    END.
  }
}

