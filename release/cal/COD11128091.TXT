OBJECT Codeunit 11128091 Project Details
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PSSE,EXF;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      tabErrorLogTEMP@1100285100 : TEMPORARY Record 11128052;
      useLogging@1100285101 : Boolean;
      ProgBudget@1100583000 : Boolean;
      FromUpdate@1100583001 : Boolean;
      BudgetSaved@1100583002 : Decimal;
      OtherDescription@1101285001 : Text[150];
      tProjDetail@1101285000 : TEMPORARY Record 11128083;
      PeriodFilter@1101285002 : Text;

    PROCEDURE MgtProjDetail@1100285008(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      Period@1100285100 : Text;
      ProjDetail@1100285101 : Record 11128083;
      startDT@1100285104 : DateTime;
      startstartDT@1100285105 : DateTime;
    BEGIN
      useLogging := FALSE;//(COPYSTR(UserId,1,5) IN ['DECID','ITERO']);
      startDT := CURRENTDATETIME;startstartDT:=startDT;
      //190927 ORANGO.EE #24023
      SaveValues(UserId,ProjNo);
      DeleteProjDetail(UserId,ProjNo);            LogDuration(tabErrorLogTEMP,startDT,'DeleteProjDetail');
      CreateProjDetail(ProjDetail,UserId,ProjNo); LogDuration(tabErrorLogTEMP,startDT,'CreateProjDetail');
      //191107 ORANGO.EE
      GetSavedValues(UserId,ProjNo);
      //

      GetBudgetLines(UserId,ProjNo,'');              LogDuration(tabErrorLogTEMP,startDT,'GetBudgetLines');
      GetGLEntrys(UserId,ProjNo,'');                 LogDuration(tabErrorLogTEMP,startDT,'GetGLEntrys');
      Period := FORMAT(DMY2DATE(1,DATE2DMY(WORKDATE,2),DATE2DMY(WORKDATE,3))) + '..' + FORMAT(CALCDATE('<CM>',WORKDATE));
      LogDuration(tabErrorLogTEMP,startDT,'CreatePeriod');
      GetGLEntrysPeriod(UserId,ProjNo,Period,'');    LogDuration(tabErrorLogTEMP,startDT,'GetGLEntrysPeriod');
      GetGLEntrysLocked(UserId,ProjNo,'');           LogDuration(tabErrorLogTEMP,startDT,'GetGLEntrysLocked');
      GetPrognosisLine(UserId,ProjNo,'');            LogDuration(tabErrorLogTEMP,startDT,'GetPrognosisLine');
      BudgetContract(UserId,ProjNo);              LogDuration(tabErrorLogTEMP,startDT,'BudgetContract');
      GetExFlowLines(UserId,ProjNo);              LogDuration(tabErrorLogTEMP,startDT,'GetExFlowLines');
      GetExFlowLinesUnderProject(UserId,ProjNo);  LogDuration(tabErrorLogTEMP,startDT,'GetExFlowLinesUnderProject');
      GetOpenPurchase(UserId,ProjNo);             LogDuration(tabErrorLogTEMP,startDT,'GetOpenPurchase');
      //200120 ORANGO.EE BYGG #27258
      GetTargetBudget(UserId, ProjNo);
      //200416 ORANGO.EE CERTEGO >>
      GetPurchaseRecievedNotInvoiced(UserId, ProjNo);
      GetOpenPurchaseNotRecieved(UserId,ProjNo);
      GetGLEntriesExtension(UserId, ProjNo,'');
      //<<
      SumProjDetail(UserId,ProjNo);               LogDuration(tabErrorLogTEMP,startDT,'SumProjDetail');
      OverheadCost(UserId,ProjNo);                LogDuration(tabErrorLogTEMP,startDT,'OverheadCost');
      CodeLines(UserId,ProjNo);                   LogDuration(tabErrorLogTEMP,startDT,'CodeLines');

      UpdateJobHours(UserId,ProjNo);              LogDuration(tabErrorLogTEMP,startDT,'UpdateJobHours');
      //191107 ORANGO.EE Moved function
      //190927 ORANGO.EE #24023
      //GetSavedValues(UserId,ProjNo);

      TotalLines(UserId,ProjNo);                  LogDuration(tabErrorLogTEMP,startDT,'TotalLines');
      ShowThousands(UserId,ProjNo);               LogDuration(tabErrorLogTEMP,startDT,'ShowThousands');LogDuration(tabErrorLogTEMP,startstartDT,'GrandTotal');
      ShowProjDetailPage(UserId,ProjNo);          //LogDuration(tabErrorLogTEMP,startDT,'ShowProjDetailPage');

      IF useLogging AND NOT tabErrorLogTEMP.ISEMPTY THEN
        PAGE.RUN(PAGE::"Error Log Work Schedule",tabErrorLogTEMP);
    END;

    LOCAL PROCEDURE LogDuration@1100285117(VAR tabErrorLogTEMP@1100285103 : TEMPORARY Record 11128052;VAR startDT@1100285101 : DateTime;descr@1100285104 : Text);
    VAR
      endDT@1100285100 : DateTime;
      EntryNo@1100285102 : Integer;
    BEGIN
      IF NOT useLogging THEN
        EXIT;

      IF tabErrorLogTEMP.FINDLAST THEN
        EntryNo := tabErrorLogTEMP."Entry No." + 1;

      endDT := CURRENTDATETIME;
      tabErrorLogTEMP."Entry No." := EntryNo;
      tabErrorLogTEMP."Error TimeStamp":= endDT;
      tabErrorLogTEMP."Error Message" := FORMAT(endDT-startDT);
      tabErrorLogTEMP.FileName := descr;
      tabErrorLogTEMP.Date := WORKDATE;
      tabErrorLogTEMP."Salary No." := '-';
      startDT := endDT;
      tabErrorLogTEMP.INSERT(FALSE);
    END;

    PROCEDURE DeleteProjDetail@1100285001(UserId@1100285000 : Code[50];ProjNo@1100285001 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      IF ProjDetail.FINDSET THEN
        ProjDetail.DELETEALL;
    END;

    PROCEDURE CreateProjDetail@1100285002(VAR ProjDetail@1100285100 : Record 11128083;UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetailTemplate@1100285002 : Record 11128082;
      Job@1100285004 : Record 11072003;
      TmplCode@1101285000 : Code[10];
    BEGIN
      Job.GET(ProjNo);
      ProjDetailTemplate.SETFILTER("Line No.",'<>%1',0);
      //>>180123
      ProjDetailTemplate.SETRANGE("Template Code", GetProjDetailTemplateCode(UserId));
      //<<
      IF ProjDetailTemplate.FIND('-') THEN BEGIN
        REPEAT
          ProjDetail.INIT;
          ProjDetail.UserID := UserId;
          ProjDetail."Project No." := ProjNo;
          ProjDetail."Line No." := ProjDetailTemplate."Line No.";
          ProjDetail.Caption := ProjDetailTemplate.Caption;
          ProjDetail."Budget Line Cost Object" := ProjDetailTemplate."Budget Line Cost Object";
          ProjDetail."Budget Line Filter 2" := ProjDetailTemplate."Budget Line Filter 2";
          ProjDetail."GL Entry Cost Object" := ProjDetailTemplate."GL Entry Cost Object";
          ProjDetail."Exclude Account" := ProjDetailTemplate."Exclude Account";
          ProjDetail."Prognosis Cost Object" := ProjDetailTemplate."Prognosis Cost Object";
          ProjDetail."Prognosis Line Filter 2" := ProjDetailTemplate."Prognosis Line Filter 2";
          ProjDetail."Total Line No. From" := ProjDetailTemplate."Total Line No. From";
          ProjDetail."Total Line No. To" := ProjDetailTemplate."Total Line No. To";
          ProjDetail."Code line" := ProjDetailTemplate."Code line";
          ProjDetail."Sum Line" := ProjDetailTemplate."Sum Line";
          ProjDetail."Sum Amount" := ProjDetailTemplate."Sum Amount";
          ProjDetail."Sum Quantity" := ProjDetailTemplate."Sum Quantity";
          ProjDetail.Hide := ProjDetailTemplate.Hide;
          ProjDetail.Description := ProjDetailTemplate.Description;
          ProjDetail."Cost Type" := ProjDetailTemplate."Cost Type";
          ProjDetail."Ovearhead Level" := ProjDetailTemplate."Ovearhead Level";
          ProjDetail.Calcualation := ProjDetailTemplate.Calcualation;
          ProjDetail."Global Dimension 1 Code" := Job."Global Dimension 1 Code";
          ProjDetail."Budget Contractamount" := ProjDetailTemplate."Budget Contractamount";
          ProjDetail."Switch Sign" := ProjDetailTemplate."Switch Sign G/L";
          ProjDetail.Procent := ProjDetailTemplate.Procent;
          ProjDetail.InOverview :=  ProjDetailTemplate.InOverview;
          ProjDetail."Cost Component Code" := ProjDetailTemplate."Cost Component Code";
          ProjDetail."Budget Contractamount Ext" := ProjDetailTemplate."Budget Contractamount Ext";
          ProjDetail.INSERT;
        UNTIL ProjDetailTemplate.NEXT = 0;
      END;
    END;

    PROCEDURE GetBudgetLines@1100285004(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];PosFilter@1100583003 : Code[10]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      BL@1100285003 : Record 11012001;
      BSum@1100285004 : Decimal;
      BSumOrg@1000000000 : Decimal;
      BSumadj@1000000001 : Decimal;
      BSumExt@1100285100 : Decimal;
      ExtContr@1100285101 : Record 11012004;
      BSumProg@1100583000 : Decimal;
      Job@1100583001 : Record 11072003;
      SESetup@1100583002 : Record 11128004;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("Budget Line Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          BSum := 0;
          BSumadj := 0;
          BSumOrg := 0;
          BSumExt := 0;
          BSumProg := 0;
          CLEAR(BL);
          BL.SETCURRENTKEY("Project No.",Element,"Cost Object");
          BL.SETRANGE("Project No.",ProjNo);
          BL.SETRANGE("Cost Object",ProjDetail."Budget Line Cost Object");
          IF PosFilter <> '' THEN
            BL.SETRANGE(Position,PosFilter);
          IF BL.FIND('-') THEN BEGIN
            REPEAT
              IF ProjDetail."Sum Amount" THEN BEGIN
                BSum := BSum + BL."Amount (LCY)";
                BSumProg := BSumProg + BL."New prognosis amount";
                IF BL."Extension Contract"<>'' THEN BEGIN
                  IF (ExtContr.GET(ProjNo,BL."Extension Contract")) AND ((ExtContr.Status=ExtContr.Status::Order) OR (ExtContr.Status=ExtContr.Status::"Invoicing Allowed")) THEN
                    BSumExt := BSumExt + BL."Amount (LCY)";
                END ELSE IF BL.Adjustment <> '' THEN BEGIN
                  BSumadj := BSumadj + BL."Amount (LCY)";
                END ELSE BEGIN
                  BSumOrg := BSumOrg + BL."Amount (LCY)";
                END;
              END ELSE IF ProjDetail."Sum Quantity" THEN BEGIN
                BSum := BSum + BL.Quantity;
                BSumProg := BSumProg + BL."New prognosis amount";
                IF BL."Extension Contract"<>'' THEN BEGIN
                  IF (ExtContr.GET(ProjNo,BL."Extension Contract")) AND ((ExtContr.Status=ExtContr.Status::Order) OR (ExtContr.Status=ExtContr.Status::"Invoicing Allowed")) THEN
                    BSumExt := BSumExt + BL.Quantity;
                END ELSE IF BL.Adjustment <> '' THEN BEGIN
                  BSumadj := BSumadj + BL.Quantity;
                END ELSE BEGIN
                  BSumOrg := BSumOrg + BL.Quantity;
                END;
              END;
              IF BL."External Text" <> '' THEN
                ProjDetail."Budget Comment" := TRUE;
            UNTIL BL.NEXT = 0;
          END;
          ProjDetail."Budget Amount" := BSum;
          ProjDetail."Original Budget" := BSumOrg;
          ProjDetail."Budget adjustment" := BSumadj;
          ProjDetail."Budget Extension Contract":=BSumExt;

          Job.GET(ProjNo);
          IF Job."Prognosis Budget Line" THEN BEGIN
            ProgBudget:=TRUE;
            IF ProjDetail."Cost Type"<>ProjDetail."Cost Type"::Revenue THEN
              ProjDetail."Prognosis Budget Line":=BSumProg;
          END;
      //    SESetup.SETRANGE("Line type",SESetup."Line type"::Setup);
      //    SESetup.SETRANGE(Code,'PROJDETAIL');
      //    SESetup.SETRANGE("Code 2",'SHOWTHOUSANDS');
      //    IF (SESetup.FINDFIRST) AND (SESetup."Value (bool)") THEN
      //      ProjDetail.VALIDATE("New Prognosis Amount (rem)",ProjDetail."New Prognosis Amount (rem)" / 1000);
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;

      CLEAR(ProjDetail);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      //ProjDetail.SETFILTER("Budget Line Cost Object",'<>%1','');
      ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          BSum := 0;
          BSumadj := 0;
          BSumOrg := 0;
          BSumExt := 0;
          CLEAR(BL);
          BL.SETCURRENTKEY("Project No.",Element,"Cost Object");
          BL.SETRANGE("Project No.",ProjNo);
          //BL.SETRANGE("Cost Object",ProjDetail."Budget Line Cost Object");
          BL.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
          IF BL.FIND('-') THEN BEGIN
            REPEAT
              IF ProjDetail."Sum Amount" THEN BEGIN
                BSum := BSum + BL."Amount (LCY)";
                IF BL."Extension Contract"<>'' THEN BEGIN
                  IF (ExtContr.GET(ProjNo,BL."Extension Contract")) AND ((ExtContr.Status=ExtContr.Status::Order) OR (ExtContr.Status=ExtContr.Status::"Invoicing Allowed")) THEN
                    BSumExt := BSumExt + BL."Amount (LCY)";
                END ELSE IF BL.Adjustment <> '' THEN BEGIN
                  BSumadj := BSumadj + BL."Amount (LCY)";
                END ELSE BEGIN
                  BSumOrg := BSumOrg + BL."Amount (LCY)";
                END;
              END ELSE IF ProjDetail."Sum Quantity" THEN BEGIN
                BSum := BSum + BL.Quantity;
                IF BL."Extension Contract"<>'' THEN BEGIN
                  IF (ExtContr.GET(ProjNo,BL."Extension Contract")) AND ((ExtContr.Status=ExtContr.Status::Order) OR (ExtContr.Status=ExtContr.Status::"Invoicing Allowed")) THEN
                    BSumExt := BSumExt + BL.Quantity;
                END ELSE IF BL.Adjustment <> '' THEN BEGIN
                  BSumadj := BSumadj + BL.Quantity;
                END ELSE BEGIN
                  BSumOrg := BSumOrg + BL.Quantity;
                END;
              END;
              IF BL."External Text" <> '' THEN
                ProjDetail."Budget Comment" := TRUE;
            UNTIL BL.NEXT = 0;
          END;
          ProjDetail."Budget Amount" := BSum;
          ProjDetail."Original Budget" := BSumOrg;
          ProjDetail."Budget adjustment" := BSumadj;
          ProjDetail."Budget Extension Contract":=BSumExt;
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetGLEntrys@1100285005(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];PosFilter@1101285000 : Code[10]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      GSum@1100285004 : Decimal;
      AFilt1@1100285005 : Code[10];
      AFilt2@1100285006 : Code[10];
      AFilt3@1100285007 : Code[10];
      AFilt4@1100285008 : Code[10];
      AFilt5@1100285009 : Code[10];
      Strangen@1100285010 : Text[50];
      AFilt6@1100285100 : Code[10];
      AFilt7@1100285101 : Code[10];
      AFilt8@1100285103 : Code[10];
      AFilt9@1100285102 : Code[10];
      JLE@1100285104 : Record 11072005;
      Job@1100285105 : Record 11072003;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
          JLE.SETRANGE(Element,PosFilter);
          //<<
          JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)"+JLE."Total Price (LCY)"; //>> 171201 ITERO.SB Added Total price in calc (C4)
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."GL Amount" := GSum;
          //190527 ORANGO.EE
          //ProjDetail."Prognosis Amount (rem tot)" := ProjDetail."Locked GL Amount" + ProjDetail."Prognosis Budget Line";
          //ProjDetail."Prognosis Amount (rem tot)" := GSum + ProjDetail."New Prognosis Amount (rem)";
          {IF (ProjDetail."Cost Type" = ProjDetail."Cost Type"::Revenue) OR (NOT ProgBudget) THEN
            ProjDetail."Prognosis Amount (rem tot)" := GSum + (ProjDetail."New Prognosis Amount (rem)"*1000);
            }
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;

      CLEAR(ProjDetail);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      //ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          //JLE.SETRANGE("Job No.",ProjNo);

          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
          JLE.SETRANGE(Element,PosFilter);
          //<<
          //JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          JLE.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."GL Amount" := GSum;
          //190527 ORANGO.EE
          //ProjDetail."Prognosis Amount (rem tot)" := GSum + ProjDetail."New Prognosis Amount (rem)";;
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetPrognosisLine@1100285006(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];PosFilter@1100583000 : Code[10]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      PL@1100285003 : Record 11012035;
      PSum@1100285004 : Decimal;
      Prognosis@1100285005 : Record 11012034;
      ProjectPreclosureResult@1100285100 : Record 11012093;
      Job@1100285101 : Record 11072003;
      PLCC@1100285102 : Record 11128270;
      JobSub@1101285000 : Record 11072003;
      SESetup@1101285001 : Record 11128004;
      qProjDetGetPrognosisLine@1100285103 : Query 11128092;
    BEGIN
      //when updating this function, check also GetPrognosisLinesCC() / GetPrognosisLinesCO()  in pag11128291

      IF Job.GET(ProjNo) THEN BEGIN
        //Prognos p† kostnadsobjektsniv†
        IF Job."Forecast Level"=Job."Forecast Level"::"Cost Object" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Prognosis Cost Object",'<>%1','');

          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
              //Senaste prognos kostnadsobjekt
              Prognosis.SETRANGE("Project No.",ProjNo);
              IF Prognosis.FINDLAST THEN BEGIN
      //>>190313
      //          PSum := 0;
      //          CLEAR(PL);
      //          PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //          PL.SETRANGE("Project No.",ProjNo);
      //          PL.SETRANGE("Cost Object",ProjDetail."Prognosis Cost Object");
      //          PL.SETRANGE("Prognosis Date",Prognosis."Prognosis Date");
      //          IF PL.FIND('-') THEN BEGIN
      //            REPEAT
      //              IF ProjDetail."Sum Amount" THEN BEGIN
      //                IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                  PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                ELSE
      //                  PSum := PSum + PL."Prognosis Total Cost";
      //              END ELSE BEGIN
      //                PSum := PSum + PL."Prognosis Total Hours"//PL.Quantity;
      //              END;
      //            UNTIL PL.NEXT = 0;
      //          END;
                PSum := GetPrognosisLineSum(ProjNo, ProjDetail."Prognosis Cost Object", '',Prognosis."Prognosis Date", ProjDetail."Sum Amount",TRUE,PosFilter);
      //<<190313
                ProjDetail."Prognosis Amount" := PSum;
                //>>190507 ORANGO.EE
                //190523
                {IF ProjDetail."Cost Type" = ProjDetail."Cost Type"::Revenue THEN
                ProjDetail."Prognosis Budget Line" := PSum - ProjDetail."GL Amount";}
                //<<

                //>> 170926 ITERO.SB REK001 Create setup for option to fill new prognosis
                SESetup.SETRANGE("Line type",SESetup."Line type"::Setup);
                SESetup.SETRANGE(Code,'PROJDETAIL');
                SESetup.SETRANGE("Code 2",'FILLPROG');
                //>>180816
                //IF SESetup.FINDFIRST AND SESetup."Value (bool)" THEN
                ProjDetail."New Prognosis Amount":=0;
                IF SESetup.FINDFIRST THEN BEGIN
                  IF SESetup."Value (bool)" THEN
                    ProjDetail."New Prognosis Amount":=0
                  ELSE
                    ProjDetail."New Prognosis Amount":=PSum;
                END;

                IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Sundry THEN BEGIN
                  SESetup.SETRANGE("Code 2",'FILLSUNDRY');
                  IF SESetup.ISEMPTY THEN
                    ProjDetail."New Prognosis Amount":=0;
                END;
                //<<

      //>>190313
                CLEAR(PL);
                PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
                PL.SETRANGE("Project No.",ProjNo);
                PL.SETRANGE("Cost Object",ProjDetail."Prognosis Cost Object");
                PL.SETRANGE("Prognosis Date",Prognosis."Prognosis Date");
                PL.SETFILTER(Comment,'<>%1','');
                IF PL.FINDLAST THEN
      //<<190313
                  ProjDetail."Prognosis comment" := PL.Comment;
                ProjDetail.MODIFY;

              //>> 170925 ITERO.SB TS003 Sum prognosis on main project level
              END ELSE BEGIN
                IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN BEGIN
                  PSum := 0;
                  JobSub.SETRANGE("Main Project",Job."No.");
                  IF JobSub.FINDSET(FALSE) THEN REPEAT
                    Prognosis.SETRANGE("Project No.", JobSub."No.");
                    IF Prognosis.FINDLAST THEN BEGIN
      //>>190313
      //                CLEAR(PL);
      //                PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //                PL.SETRANGE("Project No.",JobSub."No.");
      //                PL.SETRANGE("Cost Object",ProjDetail."Prognosis Cost Object");
      //                PL.SETRANGE("Prognosis Date",Prognosis."Prognosis Date");
      //                IF PL.FIND('-') THEN BEGIN
      //                  REPEAT
      //                    IF ProjDetail."Sum Amount" THEN BEGIN
      //                      IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                        PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                      ELSE
      //                        PSum := PSum + PL."Prognosis Total Cost";
      //                    END ELSE BEGIN
      //                      PSum := PSum + PL.Quantity;
      //                    END;
      //                  UNTIL PL.NEXT = 0;
      //                END;
                      PSum += GetPrognosisLineSum(JobSub."No.", ProjDetail."Prognosis Cost Object", '',Prognosis."Prognosis Date", ProjDetail."Sum Amount",FALSE,PosFilter);
      //<<190313
                    END;
                  UNTIL JobSub.NEXT=0;
                  ProjDetail."Prognosis Amount" := PSum;
                  ProjDetail."New Prognosis Amount":= PSum;
                  ProjDetail.MODIFY;
                END;
              END;
              //<<
              //F”rsta prognos kostnadsobjekt
              Prognosis.RESET;
              Prognosis.SETRANGE("Project No.",ProjNo);
              IF Prognosis.FINDFIRST THEN BEGIN
      //>>190313
      //          PSum := 0;
      //          CLEAR(PL);
      //          PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //          PL.SETRANGE("Project No.",ProjNo);
      //          PL.SETRANGE("Cost Object",ProjDetail."Prognosis Cost Object");
      //          PL.SETRANGE("Prognosis Date",Prognosis."Prognosis Date");
      //          IF PL.FIND('-') THEN BEGIN
      //            REPEAT
      //              IF ProjDetail."Sum Amount" THEN BEGIN
      //                IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                  PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                ELSE
      //                  PSum := PSum + PL."Prognosis Total Cost";
      //              END ELSE BEGIN
      //                PSum := PSum + PL."Prognosis Total Hours";//PL.Quantity;
      //              END;
      //            UNTIL PL.NEXT = 0;
      //          END;
                PSum := GetPrognosisLineSum(ProjNo, ProjDetail."Prognosis Cost Object", '', Prognosis."Prognosis Date", ProjDetail."Sum Amount", TRUE,PosFilter);
      //<<190313
                ProjDetail."First prognosis" := PSum;
                ProjDetail.MODIFY;
              END;
              //Senast v„rderade prognos kostnadsobjekt
              ProjectPreclosureResult.SETRANGE("Project No.",ProjNo);
              ProjectPreclosureResult.SETRANGE(Posted,TRUE);
              IF ProjectPreclosureResult.FINDLAST THEN BEGIN
      //>>190313
      //          PSum := 0;
      //          CLEAR(PL);
      //          PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //          PL.SETRANGE("Project No.",ProjNo);
      //          PL.SETRANGE("Cost Object",ProjDetail."Prognosis Cost Object");
      //          PL.SETRANGE("Prognosis Date",ProjectPreclosureResult."Prognosis Date");
      //          IF PL.FIND('-') THEN BEGIN
      //            REPEAT
      //              IF ProjDetail."Sum Amount" THEN BEGIN
      //                IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                  PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                ELSE
      //                  PSum := PSum + PL."Prognosis Total Cost";
      //              END ELSE BEGIN
      //                PSum := PSum + PL."Prognosis Total Hours";//PL.Quantity;
      //              END;
      //            UNTIL PL.NEXT = 0;
      //          END;
                PSum := GetPrognosisLineSum(ProjNo, ProjDetail."Prognosis Cost Object", '', ProjectPreclosureResult."Prognosis Date", ProjDetail."Sum Amount",TRUE,PosFilter);
      //<<190313
                ProjDetail."Prognosis (last preclosure)" := PSum;
                ProjDetail.MODIFY;
              END;

            UNTIL ProjDetail.NEXT = 0;
          END;
          //Fyll kostnadskomponentrad „ven f”r prognos p† kostnadsobjekt
          CLEAR(ProjDetail);
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          //ProjDetail.SETFILTER("Prognosis Cost Object",'<>%1','');
          ProjDetail.SETFILTER("Cost Component Code",'<>%1','');

          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
              //Senaste prognos kostnadsobjekt
              Prognosis.SETRANGE("Project No.",ProjNo);
              IF Prognosis.FINDLAST THEN BEGIN
      //>>190313
      //          PSum := 0;
      //          CLEAR(PL);
      //          PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //          PL.SETRANGE("Project No.",ProjNo);
      //          //>> 170524 RFC-229 Fix
      //          IF ProjDetail."Cost Component Code"='1I' THEN
      //            PL.SETRANGE("Cost Type",PL."Cost Type"::Revenue)
      //          ELSE IF ProjDetail."Cost Component Code"='7O' THEN
      //            PL.SETRANGE("Cost Type",PL."Cost Type"::Sundry)
      //          ELSE
      //            PL.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
      //          //<<
      //          PL.SETRANGE("Prognosis Date",Prognosis."Prognosis Date");
      //          IF PL.FIND('-') THEN BEGIN
      //            REPEAT
      //              IF ProjDetail."Sum Amount" THEN BEGIN
      //                IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                  PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                ELSE
      //                  PSum := PSum + PL."Prognosis Total Cost";
      //              END ELSE BEGIN
      //                PSum := PSum + PL."Prognosis Total Hours";//PL.Quantity;
      //              END;
      //            UNTIL PL.NEXT = 0;
      //          END;
                PSum := GetPrognosisLineSum(ProjNo, '', ProjDetail."Cost Component Code", Prognosis."Prognosis Date", ProjDetail."Sum Amount",TRUE,PosFilter);
      //<<190313
                ProjDetail."Prognosis Amount" := PSum;
                ProjDetail."New Prognosis Amount":=PSum;
                IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Sundry THEN
                  ProjDetail."New Prognosis Amount":=0;

                //ProjDetail."Prognosis comment" := PL.Comment;
                ProjDetail.MODIFY;
              END;
              //F”rsta prognos kostnadsobjekt
              Prognosis.RESET;
              Prognosis.SETRANGE("Project No.",ProjNo);
              IF Prognosis.FINDFIRST THEN BEGIN
      //>>190313
      //          PSum := 0;
      //          CLEAR(PL);
      //          PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //          PL.SETRANGE("Project No.",ProjNo);
      //          //>> 170524 RFC-229 Fix
      //          IF ProjDetail."Cost Component Code"='1I' THEN
      //            PL.SETRANGE("Cost Type",PL."Cost Type"::Revenue)
      //          ELSE IF ProjDetail."Cost Component Code"='7O' THEN
      //            PL.SETRANGE("Cost Type",PL."Cost Type"::Sundry)
      //          ELSE
      //            PL.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
      //          //<<
      //          PL.SETRANGE("Prognosis Date",Prognosis."Prognosis Date");
      //          IF PL.FIND('-') THEN BEGIN
      //            REPEAT
      //              IF ProjDetail."Sum Amount" THEN BEGIN
      //                IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                  PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                ELSE
      //                  PSum := PSum + PL."Prognosis Total Cost";
      //              END ELSE BEGIN
      //                PSum := PSum + PL."Prognosis Total Hours";//PL.Quantity;
      //              END;
      //            UNTIL PL.NEXT = 0;
      //          END;
                PSum := GetPrognosisLineSum(ProjNo, '', ProjDetail."Cost Component Code", Prognosis."Prognosis Date", ProjDetail."Sum Amount",TRUE,PosFilter);
      //<<190313
                ProjDetail."First prognosis" := PSum;
                ProjDetail.MODIFY;
              END;
              //Senast v„rderade prognos kostnadsobjekt
              ProjectPreclosureResult.SETRANGE("Project No.",ProjNo);
              ProjectPreclosureResult.SETRANGE(Posted,TRUE);
              IF ProjectPreclosureResult.FINDLAST THEN BEGIN
      //>>190313
      //          PSum := 0;
      //          CLEAR(PL);
      //          PL.SETCURRENTKEY("Project No.","Prognosis Date","Cost Type",Element,"Cost Object");
      //          PL.SETRANGE("Project No.",ProjNo);
      //          //>> 170524 RFC-229 Fix
      //          IF ProjDetail."Cost Component Code"='1I' THEN
      //            PL.SETRANGE("Cost Type",PL."Cost Type"::Revenue)
      //          ELSE IF ProjDetail."Cost Component Code"='7O' THEN
      //            PL.SETRANGE("Cost Type",PL."Cost Type"::Sundry)
      //          ELSE
      //            PL.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
      //          //<<
      //          PL.SETRANGE("Prognosis Date",ProjectPreclosureResult."Prognosis Date");
      //          IF PL.FIND('-') THEN BEGIN
      //            REPEAT
      //              IF ProjDetail."Sum Amount" THEN BEGIN
      //                IF PL."Cost Type"=PL."Cost Type"::Revenue THEN
      //                  PSum := PSum + (PL."Amount Revenue"+PL.Invoiced)
      //                ELSE
      //                  PSum := PSum + PL."Prognosis Total Cost";
      //              END ELSE BEGIN
      //                PSum := PSum + PL."Prognosis Total Hours";//PL.Quantity;
      //              END;
      //            UNTIL PL.NEXT = 0;
      //          END;
                PSum := GetPrognosisLineSum(ProjNo, '', ProjDetail."Cost Component Code", ProjectPreclosureResult."Prognosis Date", ProjDetail."Sum Amount",TRUE,PosFilter);
      //<<190313
                ProjDetail."Prognosis (last preclosure)" := PSum;
                ProjDetail.MODIFY;
              END;

            UNTIL ProjDetail.NEXT = 0;
          END;

        //Prongos p† kostnadskomponentsniv†
        END ELSE IF Job."Forecast Level"=Job."Forecast Level"::"Cost Component" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
          ProjDetail.SETRANGE("Sum Line",FALSE);
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
              //Senaste prognos (kostnadskomponent)
              Prognosis.SETRANGE("Project No.",ProjNo);
              IF Prognosis.FINDLAST THEN BEGIN
                PSum := 0;
                CLEAR(PLCC);
                IF PLCC.GET(ProjNo,Prognosis."Prognosis Date",ProjDetail."Cost Component Code") THEN BEGIN
                  IF ProjDetail."Sum Amount" THEN BEGIN
                    IF PLCC."Cost Type"=PLCC."Cost Type"::Revenue THEN
                      PSum := PSum + PLCC."Prognosis Total Revenues"
                    ELSE
                      PSum := PSum + PLCC."Prognosis Total Cost";
                  END ELSE
                    PSum := PSum + PLCC."Prognosis Total Hours";
                END;
                ProjDetail."Prognosis Amount" := PSum;
                ProjDetail."New Prognosis Amount":=PSum;
                IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Sundry THEN
                  ProjDetail."New Prognosis Amount":=0;
                ProjDetail."Prognosis comment" := PLCC.Comment;
                ProjDetail.MODIFY;
              END;
              //F”rsta prognos kostnadskomponent
              Prognosis.RESET;
              Prognosis.SETRANGE("Project No.",ProjNo);
              IF Prognosis.FINDFIRST THEN BEGIN
                PSum := 0;
                CLEAR(PLCC);
                IF PLCC.GET(ProjNo,Prognosis."Prognosis Date",ProjDetail."Cost Component Code") THEN BEGIN
                  IF ProjDetail."Sum Amount" THEN BEGIN
                    IF PLCC."Cost Type"=PLCC."Cost Type"::Revenue THEN
                      PSum := PSum + PLCC."Prognosis Total Revenues"
                    ELSE
                      PSum := PSum + PLCC."Prognosis Total Cost";
                  END ELSE
                    PSum := PSum + PLCC."Prognosis Total Hours";
                END;
                ProjDetail."First prognosis" := PSum;
                ProjDetail.MODIFY;
              END;
              //Senast v„rderade prognos kostnadskomponent
              ProjectPreclosureResult.SETRANGE("Project No.",ProjNo);
              ProjectPreclosureResult.SETRANGE(Posted,TRUE);
              IF ProjectPreclosureResult.FINDLAST THEN BEGIN
                PSum := 0;
                CLEAR(PLCC);
                IF PLCC.GET(ProjNo,ProjectPreclosureResult."Prognosis Date",ProjDetail."Cost Component Code") THEN BEGIN
                  IF ProjDetail."Sum Amount" THEN BEGIN
                    IF PLCC."Cost Type"=PLCC."Cost Type"::Revenue THEN
                      PSum := PSum + PLCC."Prognosis Total Revenues"
                    ELSE
                      PSum := PSum + PLCC."Prognosis Total Cost";
                  END ELSE
                    PSum := PSum + PLCC."Prognosis Total Hours";
                END;
                ProjDetail."Prognosis (last preclosure)" := PSum;
                ProjDetail.MODIFY;
              END;
            UNTIL ProjDetail.NEXT = 0;
          END;

        END;
      END;
    END;

    LOCAL PROCEDURE GetPrognosisLineSum@1100285114(ProjNo@1100285101 : Code[20];PrognosisCostObject@1100285102 : Code[10];PrognosisCostComponent@1100285105 : Code[10];PrognosisDate@1100285103 : Date;SumAmount@1100285104 : Boolean;UseTotHours@1100285106 : Boolean;PosFilter@1100583000 : Code[10]) PSum : Decimal;
    VAR
      qProjDetGetPrognosisLine@1100285100 : Query 11128092;
    BEGIN
      //190313
      PSum:=0;

      qProjDetGetPrognosisLine.SETRANGE(Project_No,ProjNo);
      qProjDetGetPrognosisLine.SETRANGE(Prognosis_Date,PrognosisDate);
      qProjDetGetPrognosisLine.SETRANGE(Cost_Type);
      qProjDetGetPrognosisLine.SETRANGE(Cost_Component);
      qProjDetGetPrognosisLine.SETRANGE(Cost_Object);
      qProjDetGetPrognosisLine.SETRANGE(ElementC);

      IF PrognosisCostComponent <> '' THEN
        CASE PrognosisCostComponent OF
          '1I': qProjDetGetPrognosisLine.SETRANGE(Cost_Type,qProjDetGetPrognosisLine.CostType::Revenue);
          '7O': qProjDetGetPrognosisLine.SETRANGE(Cost_Type,qProjDetGetPrognosisLine.CostType::Sundry);
          ELSE  qProjDetGetPrognosisLine.SETRANGE(Cost_Component,PrognosisCostComponent);
        END;

      IF PrognosisCostObject <> '' THEN
        qProjDetGetPrognosisLine.SETRANGE(Cost_Object,PrognosisCostObject);
      IF PosFilter <> '' THEN
        qProjDetGetPrognosisLine.SETRANGE(ElementC,PosFilter);

      qProjDetGetPrognosisLine.OPEN;
      WHILE qProjDetGetPrognosisLine.READ DO BEGIN
        IF SumAmount THEN BEGIN
          IF qProjDetGetPrognosisLine.CostType = qProjDetGetPrognosisLine.CostType::Revenue THEN
            PSum := PSum + (qProjDetGetPrognosisLine.Sum_Amount_Revenue + qProjDetGetPrognosisLine.Sum_Invoiced)
          ELSE
            PSum := PSum + qProjDetGetPrognosisLine.Sum_Prognosis_Total_Cost;
        END ELSE BEGIN
          CASE UseTotHours OF
            TRUE: PSum := PSum + qProjDetGetPrognosisLine.Sum_Prognosis_Total_Hours;
            FALSE: PSum := PSum + qProjDetGetPrognosisLine.Sum_Quantity;
          END;
        END;
      END;
      qProjDetGetPrognosisLine.CLOSE;
    END;

    PROCEDURE SumProjDetail@1100285000(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285005 : Record 11128083;
      ProjDetail2@1100285006 : Record 11128083;
      PSum@1100285004 : Decimal;
      BSum@1100285003 : Decimal;
      GSum@1100285002 : Decimal;
      OSum@1100285301 : Decimal;
      JSum@1100285300 : Decimal;
      ESum@1100285100 : Decimal;
      Job@1100285101 : Record 11072003;
      LSum@1100285102 : Decimal;
      FSum@1100285103 : Decimal;
      MSum@1100285104 : Decimal;
      ExSum@1100285302 : Decimal;
      SESetup@1101285000 : Record 11128004;
      NSum@1100583000 : Decimal;
      RSum@1100583001 : Decimal;
      TBSum@1101285001 : Decimal;
      GLESum@1100285105 : Decimal;
      POSum@1100285106 : Decimal;
      RNISum@1100285107 : Decimal;
    BEGIN
      Job.GET(ProjNo);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Sum Line",TRUE);
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          CLEAR(ProjDetail2);
          BSum := 0;
          GSum := 0;
          PSum := 0;
          OSum := 0;
          JSum := 0;
          ESum := 0;
          FSum := 0;
          LSum := 0;
          MSum := 0;
          NSum := 0;
          ExSum:=0;
          RSum:=0;
          //200120 ORANGO.EE #27258
          TBSum := 0;
          //200416 ORANGO.EE >>
          GLESum := 0;
          POSum := 0;
          RNISum := 0;
          //<<

          ProjDetail2.SETRANGE(UserID,UserId);
          ProjDetail2.SETRANGE("Project No.",ProjNo);
          ProjDetail2.SETRANGE("Code line",FALSE);
          ProjDetail2.SETRANGE("Sum Line",FALSE);
          ProjDetail2.SETRANGE("Sum Quantity",FALSE);
          ProjDetail2.SETRANGE("Sum Amount",TRUE);
          ProjDetail2.SETFILTER("Line No.",'%1..%2',ProjDetail."Total Line No. From",ProjDetail."Total Line No. To");
          IF ProjDetail2.FIND('-') THEN BEGIN
            REPEAT
              IF ProjDetail2."Cost Component Code"=''THEN BEGIN
              BSum := BSum + ProjDetail2."Budget Amount";
              GSum := GSum + ProjDetail2."GL Amount";
              OSum := OSum + ProjDetail2."Original Budget";
              JSum := JSum + ProjDetail2."Budget adjustment";
              ESum := ESum + ProjDetail2."Budget Extension Contract";
              //>> 170428 ITERO.SB RFC-101.2
              MSum := MSum + ProjDetail2."GL Amount Period";
              //<<
              //200120 ORANGO.EE #27258 >>
              TBSum := TBSum + ProjDetail2."Target Budget";
              //<<
              //200416 ORANGO.EE
              GLESum := GLESum + ProjDetail2."Extension GL Amount";
              POSum := POSum + ProjDetail2."Open Purchase Orders";
              RNISum := RNISum + ProjDetail2."Recieved Not Invoiced";
              //<<
              //190603 ORANGO.EE #23919
              NSum := NSum + ProjDetail2."Locked GL Amount";
              RSum := RSum + ProjDetail2."Prognosis Budget Line";
              PSum := PSum + ProjDetail2."Prognosis Amount";
              FSum := FSum + ProjDetail2."First prognosis";
              LSum := LSum + ProjDetail2."Prognosis (last preclosure)";
              ExSum:= ExSum + ProjDetail2."Expected Cost";
              END ELSE IF Job."Forecast Level"=Job."Forecast Level"::"Cost Component" THEN BEGIN
                PSum := PSum + ProjDetail2."Prognosis Amount";
                FSum := FSum + ProjDetail2."First prognosis";
                LSum := LSum + ProjDetail2."Prognosis (last preclosure)";
                //200120 ORANGO.EE #27258 >>
                TBSum := TBSum + ProjDetail2."Target Budget";
                //<<

              END;
            UNTIL ProjDetail2.NEXT = 0;

            ProjDetail."Budget Amount" := BSum;
            ProjDetail."GL Amount" := GSum;
            ProjDetail."Prognosis Amount" := PSum;
            //>> 170926 ITERO.SB REK001 Create setup for option to fill new prognosis
            //ProjDetail."New Prognosis Amount":=PSum;
            SESetup.SETRANGE("Line type",SESetup."Line type"::Setup);
            SESetup.SETRANGE(Code,'PROJDETAIL');
            SESetup.SETRANGE("Code 2",'FILLPROG');
            IF (SESetup.FINDFIRST) AND (SESetup."Value (bool)") THEN
              ProjDetail."New Prognosis Amount":=0
            ELSE
              ProjDetail."New Prognosis Amount":=PSum;
            //<<
            ProjDetail."Original Budget" := OSum;
            ProjDetail."Budget adjustment" := JSum;
            ProjDetail."Budget Extension Contract" := ESum;
            ProjDetail."First prognosis":= FSum;
            ProjDetail."Prognosis (last preclosure)":=LSum;
            //>> 170428 ITERO.SB RFC-101.2
            ProjDetail."GL Amount Period" := MSum;
            //<<
            //200120 ORANGO.EE #27258 >>
            ProjDetail."Target Budget" := TBSum;
            //<<
            //200416 ORANGO.EE
            ProjDetail."Extension GL Amount" := GLESum;
            ProjDetail."Open Purchase Orders" := POSum;
            ProjDetail."Recieved Not Invoiced" := RNISum;
            //<<
            //190603 ORANGO.EE #23919
            ProjDetail."Locked GL Amount" := NSum;
            ProjDetail."Expected Cost" := ExSum;
            ProjDetail."Prognosis Budget Line" := RSum;
            ProjDetail.MODIFY;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE BudgetContract@1100285009(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      ProcPrin@1100285003 : Record 11012005;
      Job@1100285004 : Record 11072003;
      ExtensionContract@1100285100 : Record 11012004;
    BEGIN
      IF Job.GET(ProjNo) THEN BEGIN
        //Job.CALCFIELDS("Contract Amount","Extension Contract Amount");
        IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN BEGIN
          ProcPrin.SETRANGE("Main Project No.",ProjNo);
          ExtensionContract.SETRANGE("Main Project No.",ProjNo);
        END ELSE BEGIN
          ProcPrin.SETRANGE("Project No.",ProjNo);
          ExtensionContract.SETRANGE("Project No.",ProjNo);
        END;
        ProcPrin.CALCSUMS("Contract Amount (LCY)");
        ExtensionContract.CALCSUMS("Expected Contract Amount");
        //>> 171213 ITERO.SB Handle Budget Extension contract
        ProjDetail.SETRANGE(UserID,UserId);
        ProjDetail.SETRANGE("Project No.",ProjNo);
        ProjDetail.SETRANGE("Budget Contractamount",TRUE);
        IF ProjDetail.FIND('-') THEN BEGIN
          REPEAT
            ProjDetail."Original Budget":= ProcPrin."Contract Amount (LCY)";//Job."Contract Amount";
            //ProjDetail."Budget Extension Contract":= ExtensionContract."Expected Contract Amount";
            ProjDetail."Budget Amount":= ProjDetail."Original Budget"+ProjDetail."Budget Extension Contract";
            ProjDetail.MODIFY;
          UNTIL ProjDetail.NEXT = 0;
        END;
        CLEAR(ProjDetail);
        ProjDetail.SETRANGE(UserID,UserId);
        ProjDetail.SETRANGE("Project No.",ProjNo);
        ProjDetail.SETRANGE("Budget Contractamount Ext",TRUE);
        IF ProjDetail.FIND('-') THEN BEGIN
          REPEAT
            //ProjDetail."Original Budget":= ProcPrin."Contract Amount (LCY)";//Job."Contract Amount";
            ProjDetail."Budget Extension Contract":= ExtensionContract."Expected Contract Amount";
            ProjDetail."Budget Amount":= ProjDetail."Original Budget"+ProjDetail."Budget Extension Contract";
            ProjDetail.MODIFY;
          UNTIL ProjDetail.NEXT = 0;
        END;
      END;
      //<<
    END;

    PROCEDURE OverheadCost@1100285010(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      OverheadS@1100285003 : Record 11020208;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETFILTER("Ovearhead Level",'<>%1',0);
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          OverheadS.SETRANGE(Level,ProjDetail."Ovearhead Level");
          OverheadS.SETRANGE(Department,ProjDetail."Global Dimension 1 Code");
          IF ProjDetail."Budget Line Cost Object" <> '' THEN BEGIN
            OverheadS.SETRANGE("Cost Object Surcharge",ProjDetail."Budget Line Cost Object");
          END ELSE BEGIN
            IF ProjDetail."GL Entry Cost Object" <> '' THEN BEGIN
              OverheadS.SETRANGE("Cost Object Surcharge",ProjDetail."GL Entry Cost Object");
            END ELSE BEGIN
              OverheadS.SETRANGE("Cost Object Surcharge",ProjDetail."Prognosis Cost Object");
            END;
          END;
          //>> 180212 ITERO.SB RAD-074
          IF OverheadS.FINDLAST THEN BEGIN
            IF OverheadS.Amount<>0 THEN BEGIN
              ProjDetail."Budget Amount" := OverheadS.Amount;
              ProjDetail."GL Amount" := OverheadS.Amount;
              ProjDetail."Prognosis Amount" := OverheadS.Amount;
              ProjDetail.MODIFY;
            END ELSE IF OverheadS.Percentage <> 0 THEN BEGIN
              ProjDetail."Budget Amount" := OverheadS.Percentage/100;
              ProjDetail."GL Amount" := OverheadS.Percentage/100;
              ProjDetail."Prognosis Amount" := OverheadS.Percentage/100;
              ProjDetail.MODIFY;
            END;
          END;
          //<<
      //    IF OverheadS.FIND('-') THEN BEGIN
      //      ProjDetail."Budget Amount" := OverheadS.Amount;
      //      ProjDetail."GL Amount" := OverheadS.Amount;
      //      ProjDetail."Prognosis Amount" := OverheadS.Amount;
      //      ProjDetail.MODIFY;
      //    END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE CodeLines@1100285003(UserId@1100285002 : Code[50];ProjNo@1100285001 : Code[20]);
    VAR
      ProjDetail@1100285000 : Record 11128083;
      ProjDetail2@1100285020 : Record 11128083;
      ProjDetail3@1100285021 : Record 11128083;
      BSum@1100285003 : Decimal;
      GSum@1100285004 : Decimal;
      PSum@1100285005 : Decimal;
      Strangen@1100285006 : Text[50];
      Line1@1100285007 : Integer;
      Operator1@1100285008 : Code[10];
      Line2@1100285010 : Integer;
      Operator2@1100285009 : Code[10];
      Line3@1100285012 : Integer;
      Operator3@1100285011 : Code[10];
      Line4@1100285014 : Integer;
      Operator4@1100285013 : Code[10];
      Line5@1100285015 : Integer;
      LO1@1100285016 : Decimal;
      LO2@1100285017 : Decimal;
      LO3@1100285018 : Decimal;
      LO4@1100285019 : Decimal;
      OSum@1100285301 : Decimal;
      JSum@1100285300 : Decimal;
      ExSum@1000000000 : Decimal;
      ESum@1100285100 : Decimal;
      FSum@1100285101 : Decimal;
      LSum@1100285102 : Decimal;
      MSum@1100285103 : Decimal;
      NSum@1100583000 : Decimal;
      RSum@1100583001 : Decimal;
      TBSum@1101285000 : Decimal;
      GLESum@1100285104 : Decimal;
      POSum@1100285105 : Decimal;
      RNISum@1100285106 : Decimal;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",TRUE);
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          CLEAR(Line1);
          CLEAR(Line2);
          CLEAR(Line3);
          CLEAR(Line4);
          CLEAR(Line5);
          CLEAR(Operator1);
          CLEAR(Operator2);
          CLEAR(Operator3);
          CLEAR(Operator4);
          BSum := 0;
          GSum := 0;
          PSum := 0;
          OSum := 0;
          JSum := 0;
          ExSum := 0;
          ESum := 0;
          FSum := 0;
          LSum := 0;
          NSum := 0;
          //200120 ORANGO.EE #27258 >>
          TBSum := 0;
          //<<

          //200416 ORANGO.EE
          GLESum := 0;
          POSum := 0;
          RNISum := 0;
          //<<

          Strangen := ProjDetail.Calcualation;
          IF STRPOS(Strangen,';') > 0 THEN BEGIN
            EVALUATE(Line1,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
            Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
            IF STRPOS(Strangen,';') > 0 THEN BEGIN
              EVALUATE(Operator1,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
              Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
              IF STRPOS(Strangen,';') > 0 THEN BEGIN
                EVALUATE(Line2,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
              END ELSE BEGIN
                EVALUATE(Line2,Strangen);
              END;
              IF STRPOS(Strangen,';') > 0 THEN BEGIN
                EVALUATE(Operator2,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
                IF STRPOS(Strangen,';') > 0 THEN BEGIN
                  EVALUATE(Line3,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                  Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
                END ELSE BEGIN
                  EVALUATE(Line3,Strangen);
                END;
                IF STRPOS(Strangen,';') > 0 THEN BEGIN
                  EVALUATE(Operator3,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                  Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
                  IF STRPOS(Strangen,';') > 0 THEN BEGIN
                    EVALUATE(Line4,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                    Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
                  END ELSE BEGIN
                    EVALUATE(Line4,Strangen);
                  END;
                  IF STRPOS(Strangen,';') > 0 THEN BEGIN
                    EVALUATE(Operator4,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                    Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
                    IF STRPOS(Strangen,';') > 0 THEN BEGIN
                      EVALUATE(Line5,COPYSTR(Strangen,1,STRPOS(Strangen,';')-1));
                      Strangen := COPYSTR(Strangen,STRPOS(Strangen,';')+1);
                    END ELSE BEGIN
                      EVALUATE(Line5,Strangen);
                    END;
                  END;
                END;
              END;
            END;
          END;
          IF (Line1 <> 0) AND (Operator1 <> '') AND (Line2 <> 0) THEN BEGIN
            CLEAR(ProjDetail2);
            ProjDetail2.SETRANGE(UserID,UserId);
            ProjDetail2.SETRANGE("Project No.",ProjNo);
            ProjDetail2.SETRANGE("Line No.",Line1);
            IF ProjDetail2.FIND('-') THEN BEGIN
              CLEAR(ProjDetail3);
              ProjDetail3.SETRANGE(UserID,UserId);
              ProjDetail3.SETRANGE("Project No.",ProjNo);
              ProjDetail3.SETRANGE("Line No.",Line2);
              IF ProjDetail3.FIND('-') THEN BEGIN
      //>>190313
                BSum := CodeLinesEvaluate(0,ProjDetail2."Budget Amount" , Operator1,  ProjDetail3."Budget Amount");
                GSum := CodeLinesEvaluate(0,ProjDetail2."GL Amount" , Operator1,  ProjDetail3."GL Amount");
                PSum := CodeLinesEvaluate(0,ProjDetail2."Prognosis Amount" , Operator1,  ProjDetail3."Prognosis Amount");
                OSum := CodeLinesEvaluate(0,ProjDetail2."Original Budget" , Operator1,  ProjDetail3."Original Budget");
                JSum := CodeLinesEvaluate(0,ProjDetail2."Budget adjustment" , Operator1,  ProjDetail3."Budget adjustment");
                ESum := CodeLinesEvaluate(0,ProjDetail2."Budget Extension Contract" , Operator1,  ProjDetail3."Budget Extension Contract");
                FSum := CodeLinesEvaluate(0,ProjDetail2."First prognosis" , Operator1,  ProjDetail3."First prognosis");
                LSum := CodeLinesEvaluate(0,ProjDetail2."Prognosis (last preclosure)" , Operator1,  ProjDetail3."Prognosis (last preclosure)");
                //>> 170428 ITERO.SB RFC-101.2
                MSum := CodeLinesEvaluate(0,ProjDetail2."GL Amount Period" , Operator1,  ProjDetail3."GL Amount Period");
                //<<
                ExSum := CodeLinesEvaluate(0,ProjDetail2."Expected Cost" , Operator1,  ProjDetail3."Expected Cost");
                //190603 ORANGO.EE #23919
                NSum := CodeLinesEvaluate(0,ProjDetail2."Locked GL Amount" , Operator1,  ProjDetail3."Locked GL Amount");
                RSum := CodeLinesEvaluate(0,ProjDetail2."Prognosis Budget Line" , Operator1,  ProjDetail3."Prognosis Budget Line");

                //200120 ORANGO.EE #27258 >>
                TBSum := CodeLinesEvaluate(0,ProjDetail2."Target Budget", Operator1, ProjDetail3."Target Budget");
                //<<

                //200416 ORANGO.EE
                GLESum := CodeLinesEvaluate(0,ProjDetail2."Extension GL Amount", Operator1, ProjDetail3."Extension GL Amount");
                POSum := CodeLinesEvaluate(0,ProjDetail2."Open Purchase Orders", Operator1, ProjDetail3."Open Purchase Orders");
                RNISum := CodeLinesEvaluate(0,ProjDetail2."Recieved Not Invoiced", Operator1, ProjDetail3."Recieved Not Invoiced");
                //<<

      //          IF Operator1 = '+' THEN BEGIN
      //            BSum := ProjDetail2."Budget Amount" + ProjDetail3."Budget Amount";
      //            GSum := ProjDetail2."GL Amount" + ProjDetail3."GL Amount";
      //            PSum := ProjDetail2."Prognosis Amount" + ProjDetail3."Prognosis Amount";
      //            OSum := ProjDetail2."Original Budget" + ProjDetail3."Original Budget";
      //            JSum := ProjDetail2."Budget adjustment" + ProjDetail3."Budget adjustment";
      //            ESum := ProjDetail2."Budget Extension Contract" + ProjDetail3."Budget Extension Contract";
      //            FSum := ProjDetail2."First prognosis" + ProjDetail3."First prognosis";
      //            LSum := ProjDetail2."Prognosis (last preclosure)" + ProjDetail3."Prognosis (last preclosure)";
      //            //>> 170428 ITERO.SB RFC-101.2
      //            MSum := ProjDetail2."GL Amount Period" + ProjDetail3."GL Amount Period";
      //            //<<
      //            ExSum := ProjDetail2."Expected Cost" + ProjDetail3."Expected Cost";
      //          END;
      //          IF Operator1 = '-' THEN BEGIN
      //            BSum := ProjDetail2."Budget Amount" - ProjDetail3."Budget Amount";
      //            GSum := ProjDetail2."GL Amount" - ProjDetail3."GL Amount";
      //            PSum := ProjDetail2."Prognosis Amount" - ProjDetail3."Prognosis Amount";
      //            OSum := ProjDetail2."Original Budget" - ProjDetail3."Original Budget";
      //            JSum := ProjDetail2."Budget adjustment" - ProjDetail3."Budget adjustment";
      //            ESum := ProjDetail2."Budget Extension Contract" - ProjDetail3."Budget Extension Contract";
      //            FSum := ProjDetail2."First prognosis" - ProjDetail3."First prognosis";
      //            LSum := ProjDetail2."Prognosis (last preclosure)" - ProjDetail3."Prognosis (last preclosure)";
      //            //>> 170428 ITERO.SB RFC-101.2
      //            MSum := ProjDetail2."GL Amount Period" - ProjDetail3."GL Amount Period";
      //            //<<
      //            ExSum := ProjDetail2."Expected Cost" - ProjDetail3."Expected Cost";
      //          END;
      //          IF Operator1 = '*' THEN BEGIN
      //            BSum := ProjDetail2."Budget Amount" * ProjDetail3."Budget Amount";
      //            GSum := ProjDetail2."GL Amount" * ProjDetail3."GL Amount";
      //            PSum := ProjDetail2."Prognosis Amount" * ProjDetail3."Prognosis Amount";
      //            OSum := ProjDetail2."Original Budget" * ProjDetail3."Original Budget";
      //            JSum := ProjDetail2."Budget adjustment" * ProjDetail3."Budget adjustment";
      //            ESum := ProjDetail2."Budget Extension Contract" * ProjDetail3."Budget Extension Contract";
      //            FSum := ProjDetail2."First prognosis" * ProjDetail3."First prognosis";
      //            LSum := ProjDetail2."Prognosis (last preclosure)" * ProjDetail3."Prognosis (last preclosure)";
      //            //>> 170428 ITERO.SB RFC-101.2
      //            MSum := ProjDetail2."GL Amount Period" * ProjDetail3."GL Amount Period";
      //            //<<
      //            ExSum := ProjDetail2."Expected Cost" * ProjDetail3."Expected Cost";
      //          END;
      //          IF Operator1 = '/' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (ProjDetail3."Budget Amount" <> 0) THEN
      //              BSum := ProjDetail2."Budget Amount" / ProjDetail3."Budget Amount";
      //            IF (ProjDetail2."GL Amount" <> 0) AND (ProjDetail3."GL Amount" <> 0) THEN
      //              GSum := ProjDetail2."GL Amount" / ProjDetail3."GL Amount";
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (ProjDetail3."Prognosis Amount" <> 0) THEN
      //              PSum := ProjDetail2."Prognosis Amount" / ProjDetail3."Prognosis Amount";
      //            IF (ProjDetail2."Original Budget" <> 0) AND (ProjDetail3."Original Budget" <> 0) THEN
      //              OSum := ProjDetail2."Original Budget" / ProjDetail3."Original Budget";
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (ProjDetail3."Budget adjustment" <> 0) THEN
      //              JSum := ProjDetail2."Budget adjustment" / ProjDetail3."Budget adjustment";
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ProjDetail3."Expected Cost" <> 0) THEN
      //              ExSum := ProjDetail2."Expected Cost" / ProjDetail3."Expected Cost";
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ProjDetail3."Budget Extension Contract" <> 0) THEN
      //              ESum := ProjDetail2."Budget Extension Contract" / ProjDetail3."Budget Extension Contract";
      //            IF (ProjDetail2."First prognosis" <> 0) AND (ProjDetail3."First prognosis" <> 0) THEN
      //              FSum := ProjDetail2."First prognosis" / ProjDetail3."First prognosis";
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (ProjDetail3."Prognosis (last preclosure)" <> 0) THEN
      //              LSum := ProjDetail2."Prognosis (last preclosure)" / ProjDetail3."Prognosis (last preclosure)";
      //            //>> 170428 ITERO.SB RFC-101.2
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (ProjDetail3."GL Amount Period" <> 0) THEN
      //              MSum := ProjDetail2."GL Amount Period" / ProjDetail3."GL Amount Period";
      //            //<<
      //          END;
      //          IF Operator1 = '%' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (ProjDetail3."Budget Amount" <> 0) THEN
      //              BSum := (ProjDetail2."Budget Amount" / ProjDetail3."Budget Amount") * 100;
      //            IF (ProjDetail2."GL Amount" <> 0) AND (ProjDetail3."GL Amount" <> 0) THEN
      //              GSum := (ProjDetail2."GL Amount" / ProjDetail3."GL Amount") * 100;
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (ProjDetail3."Prognosis Amount" <> 0) THEN
      //              PSum := (ProjDetail2."Prognosis Amount" / ProjDetail3."Prognosis Amount") * 100;
      //            IF (ProjDetail2."Original Budget" <> 0) AND (ProjDetail3."Original Budget" <> 0) THEN
      //              OSum := (ProjDetail2."Original Budget" / ProjDetail3."Original Budget") * 100;
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (ProjDetail3."Budget adjustment" <> 0) THEN
      //              JSum := (ProjDetail2."Budget adjustment" / ProjDetail3."Budget adjustment") * 100;
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ProjDetail3."Expected Cost" <> 0) THEN
      //              ExSum := (ProjDetail2."Expected Cost" / ProjDetail3."Expected Cost") * 100;
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ProjDetail3."Budget Extension Contract" <> 0) THEN
      //              ESum := (ProjDetail2."Budget Extension Contract" / ProjDetail3."Budget Extension Contract")*100;
      //            IF (ProjDetail2."First prognosis" <> 0) AND (ProjDetail3."First prognosis" <> 0) THEN
      //              FSum := (ProjDetail2."First prognosis" / ProjDetail3."First prognosis")*100;
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (ProjDetail3."Prognosis (last preclosure)" <> 0) THEN
      //              LSum := (ProjDetail2."Prognosis (last preclosure)" / ProjDetail3."Prognosis (last preclosure)")*100;
      //            //>> 170428 ITERO.SB RFC-101.2
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (ProjDetail3."GL Amount Period" <> 0) THEN
      //              MSum := (ProjDetail2."GL Amount Period" / ProjDetail3."GL Amount Period") * 100;
      //            //<<
      //          END;
      //<<190313
              END;
            END;
            IF (Operator2 <> '') AND (Line3 <> 0) THEN BEGIN
              CLEAR(ProjDetail2);
              ProjDetail2.SETRANGE(UserID,UserId);
              ProjDetail2.SETRANGE("Project No.",ProjNo);
              ProjDetail2.SETRANGE("Line No.",Line3);
              IF ProjDetail2.FIND('-') THEN BEGIN
      //>>190313
                BSum := CodeLinesEvaluate(BSum, BSum, Operator2, ProjDetail2."Budget Amount");
                GSum := CodeLinesEvaluate(GSum, GSum, Operator2, ProjDetail2."GL Amount");
                PSum := CodeLinesEvaluate(PSum, PSum, Operator2, ProjDetail2."Prognosis Amount");
                OSum := CodeLinesEvaluate(OSum, OSum, Operator2, ProjDetail2."Original Budget");
                JSum := CodeLinesEvaluate(JSum, JSum, Operator2, ProjDetail2."Budget adjustment");
                ExSum := CodeLinesEvaluate(ExSum, ExSum, Operator2, ProjDetail2."Expected Cost");
                ESum := CodeLinesEvaluate(ESum, ESum, Operator2, ProjDetail2."Budget Extension Contract");
                FSum := CodeLinesEvaluate(FSum, FSum, Operator2, ProjDetail2."First prognosis");
                LSum := CodeLinesEvaluate(LSum, LSum, Operator2, ProjDetail2."Prognosis (last preclosure)");
                MSum := CodeLinesEvaluate(MSum, MSum, Operator2, ProjDetail2."GL Amount Period");
                //190603 ORANGO.EE #23919
                NSum := CodeLinesEvaluate(NSum, NSum, Operator2, ProjDetail2."Locked GL Amount");
                RSum := CodeLinesEvaluate(RSum, RSum, Operator2, ProjDetail2."Prognosis Budget Line");
                //200120 ORANGO.EE #27258 >>
                TBSum := CodeLinesEvaluate(TBSum, TBSum, Operator2, ProjDetail2."Target Budget");
                //<<

                //200416 ORANGO.EE
                GLESum := CodeLinesEvaluate(GLESum, GLESum, Operator2,ProjDetail2."Extension GL Amount");
                POSum := CodeLinesEvaluate(POSum, POSum, Operator2 ,ProjDetail2."Open Purchase Orders");
                RNISum := CodeLinesEvaluate(RNISum, RNISum, Operator2, ProjDetail2."Recieved Not Invoiced");
                //<<
      //          IF Operator2 = '+' THEN BEGIN
      //            BSum := BSum + ProjDetail2."Budget Amount";
      //            GSum := GSum + ProjDetail2."GL Amount";
      //            PSum := PSum + ProjDetail2."Prognosis Amount";
      //            OSum := OSum + ProjDetail2."Original Budget";
      //            JSum := JSum + ProjDetail2."Budget adjustment";
      //            ExSum := ExSum + ProjDetail2."Expected Cost";
      //            ESum := ESum + ProjDetail2."Budget Extension Contract";
      //            FSum := FSum + ProjDetail2."First prognosis";
      //            LSum := LSum + ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum + ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator2 = '-' THEN BEGIN
      //            BSum := BSum - ProjDetail2."Budget Amount";
      //            GSum := GSum - ProjDetail2."GL Amount";
      //            PSum := PSum - ProjDetail2."Prognosis Amount";
      //            OSum := OSum - ProjDetail2."Original Budget";
      //            JSum := JSum - ProjDetail2."Budget adjustment";
      //            ExSum := ExSum - ProjDetail2."Expected Cost";
      //            ESum := ESum - ProjDetail2."Budget Extension Contract";
      //            FSum := FSum - ProjDetail2."First prognosis";
      //            LSum := LSum - ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum - ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator2 = '*' THEN BEGIN
      //            BSum := BSum * ProjDetail2."Budget Amount";
      //            GSum := GSum * ProjDetail2."GL Amount";
      //            PSum := PSum * ProjDetail2."Prognosis Amount";
      //            OSum := OSum * ProjDetail2."Original Budget";
      //            JSum := JSum * ProjDetail2."Budget adjustment";
      //            ExSum := ExSum * ProjDetail2."Expected Cost";
      //            ESum := ESum * ProjDetail2."Budget Extension Contract";
      //            FSum := FSum * ProjDetail2."First prognosis";
      //            LSum := LSum * ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum * ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator2 = '/' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (BSum <> 0) THEN
      //              BSum := BSum / ProjDetail2."Budget Amount";
      //            IF (ProjDetail2."GL Amount" <> 0) AND (GSum <> 0) THEN
      //              GSum := GSum / ProjDetail2."GL Amount";
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (PSum <> 0) THEN
      //              PSum := PSum / ProjDetail2."Prognosis Amount";
      //            IF (ProjDetail2."Original Budget" <> 0) AND (OSum <> 0) THEN
      //              OSum := OSum / ProjDetail2."Original Budget";
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (JSum <> 0) THEN
      //              JSum := JSum / ProjDetail2."Budget adjustment";
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ExSum <> 0) THEN
      //              ExSum := ExSum / ProjDetail2."Expected Cost";
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ESum <> 0) THEN
      //              ESum := ESum / ProjDetail2."Budget Extension Contract";
      //            IF (ProjDetail2."First prognosis" <> 0) AND (FSum <> 0) THEN
      //              FSum := FSum / ProjDetail2."First prognosis";
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (LSum <> 0) THEN
      //              LSum := LSum / ProjDetail2."Prognosis (last preclosure)";
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (MSum <> 0) THEN
      //              MSum := MSum / ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator2 = '%' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (BSum <> 0) THEN
      //              BSum := (BSum / ProjDetail2."Budget Amount") * 100;
      //            IF (ProjDetail2."GL Amount" <> 0) AND (GSum <> 0) THEN
      //              GSum := (GSum / ProjDetail2."GL Amount") * 100;
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (PSum <> 0) THEN
      //              PSum := (PSum / ProjDetail2."Prognosis Amount") * 100;
      //            IF (ProjDetail2."Original Budget" <> 0) AND (OSum <> 0) THEN
      //              OSum := (OSum / ProjDetail2."Original Budget") * 100;
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (JSum <> 0) THEN
      //              JSum := (JSum / ProjDetail2."Budget adjustment") * 100;
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ExSum <> 0) THEN
      //              ExSum := (ExSum / ProjDetail2."Expected Cost") * 100;
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ESum <> 0) THEN
      //              ESum := (ESum / ProjDetail2."Budget Extension Contract")*100;
      //            IF (ProjDetail2."First prognosis" <> 0) AND (FSum <> 0) THEN
      //              FSum := (FSum / ProjDetail2."First prognosis")*100;
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (LSum <> 0) THEN
      //              LSum := (LSum / ProjDetail2."Prognosis (last preclosure)")*100;
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (MSum <> 0) THEN
      //              MSum := (MSum / ProjDetail2."GL Amount Period") * 100;
      //          END;
      //<<190313
              END;
            END;
            IF (Operator3 <> '') AND (Line4 <> 0) THEN BEGIN
              CLEAR(ProjDetail2);
              ProjDetail2.SETRANGE(UserID,UserId);
              ProjDetail2.SETRANGE("Project No.",ProjNo);
              ProjDetail2.SETRANGE("Line No.",Line4);
              IF ProjDetail2.FIND('-') THEN BEGIN
      //>>190313
                BSum := CodeLinesEvaluate(BSum, BSum, Operator3, ProjDetail2."Budget Amount");
                GSum := CodeLinesEvaluate(GSum, GSum, Operator3, ProjDetail2."GL Amount");
                PSum := CodeLinesEvaluate(PSum, PSum, Operator3, ProjDetail2."Prognosis Amount");
                OSum := CodeLinesEvaluate(OSum, OSum, Operator3, ProjDetail2."Original Budget");
                JSum := CodeLinesEvaluate(JSum, JSum, Operator3, ProjDetail2."Budget adjustment");
                ExSum := CodeLinesEvaluate(ExSum, ExSum, Operator3, ProjDetail2."Expected Cost");
                ESum := CodeLinesEvaluate(ESum, ESum, Operator3, ProjDetail2."Budget Extension Contract");
                FSum := CodeLinesEvaluate(FSum, FSum, Operator3, ProjDetail2."First prognosis");
                LSum := CodeLinesEvaluate(LSum, LSum, Operator3, ProjDetail2."Prognosis (last preclosure)");
                MSum := CodeLinesEvaluate(MSum, MSum, Operator3, ProjDetail2."GL Amount Period");
                //190603 ORANGO.EE #23919
                NSum := CodeLinesEvaluate(NSum, NSum, Operator3, ProjDetail2."Locked GL Amount");
                RSum := CodeLinesEvaluate(RSum, RSum, Operator3, ProjDetail2."Prognosis Budget Line");
                //200120 ORANGO.EE #27258 >>
                TBSum := CodeLinesEvaluate(TBSum,TBSum, Operator3, ProjDetail2."Target Budget");
                //<<
                //200416 ORANGO.EE
                GLESum := CodeLinesEvaluate(GLESum, GLESum, Operator3,ProjDetail2."Extension GL Amount");
                POSum := CodeLinesEvaluate(POSum, POSum, Operator3 ,ProjDetail2."Open Purchase Orders");
                RNISum := CodeLinesEvaluate(RNISum, RNISum, Operator3, ProjDetail2."Recieved Not Invoiced");
                //<<

      //          IF Operator3 = '+' THEN BEGIN
      //            BSum := BSum + ProjDetail2."Budget Amount";
      //            GSum := GSum + ProjDetail2."GL Amount";
      //            PSum := PSum + ProjDetail2."Prognosis Amount";
      //            OSum := OSum + ProjDetail2."Original Budget";
      //            JSum := JSum + ProjDetail2."Budget adjustment";
      //            ExSum := ExSum + ProjDetail2."Expected Cost";
      //            ESum := ESum + ProjDetail2."Budget Extension Contract";
      //            FSum := FSum + ProjDetail2."First prognosis";
      //            LSum := LSum + ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum + ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator3 = '-' THEN BEGIN
      //            BSum := BSum - ProjDetail2."Budget Amount";
      //            GSum := GSum - ProjDetail2."GL Amount";
      //            PSum := PSum - ProjDetail2."Prognosis Amount";
      //            OSum := OSum - ProjDetail2."Original Budget";
      //            JSum := JSum - ProjDetail2."Budget adjustment";
      //            ExSum := ExSum - ProjDetail2."Expected Cost";
      //            ESum := ESum - ProjDetail2."Budget Extension Contract";
      //            FSum := FSum - ProjDetail2."First prognosis";
      //            LSum := LSum - ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum - ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator3 = '*' THEN BEGIN
      //            BSum := BSum * ProjDetail2."Budget Amount";
      //            GSum := GSum * ProjDetail2."GL Amount";
      //            PSum := PSum * ProjDetail2."Prognosis Amount";
      //            OSum := OSum * ProjDetail2."Original Budget";
      //            JSum := JSum * ProjDetail2."Budget adjustment";
      //            ExSum := ExSum * ProjDetail2."Expected Cost";
      //            ESum := ESum * ProjDetail2."Budget Extension Contract";
      //            FSum := FSum * ProjDetail2."First prognosis";
      //            LSum := LSum * ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum * ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator3 = '/' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (BSum <> 0) THEN
      //              BSum := BSum / ProjDetail2."Budget Amount";
      //            IF (ProjDetail2."GL Amount" <> 0) AND (GSum <> 0) THEN
      //              GSum := GSum / ProjDetail2."GL Amount";
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (PSum <> 0) THEN
      //              PSum := PSum / ProjDetail2."Prognosis Amount";
      //            IF (ProjDetail2."Original Budget" <> 0) AND (OSum <> 0) THEN
      //              OSum := OSum / ProjDetail2."Original Budget";
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (JSum <> 0) THEN
      //              JSum := JSum / ProjDetail2."Budget adjustment";
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ExSum <> 0) THEN
      //              ExSum := ExSum / ProjDetail2."Expected Cost";
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ESum <> 0) THEN
      //              ESum := ESum / ProjDetail2."Budget Extension Contract";
      //            IF (ProjDetail2."First prognosis" <> 0) AND (FSum <> 0) THEN
      //              FSum := FSum / ProjDetail2."First prognosis";
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (LSum <> 0) THEN
      //              LSum := LSum / ProjDetail2."Prognosis (last preclosure)";
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (MSum <> 0) THEN
      //              MSum := MSum / ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator3 = '%' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (BSum <> 0) THEN
      //              BSum := (BSum / ProjDetail2."Budget Amount") * 100;
      //            IF (ProjDetail2."GL Amount" <> 0) AND (GSum <> 0) THEN
      //              GSum := (GSum / ProjDetail2."GL Amount") * 100;
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (PSum <> 0) THEN
      //              PSum := (PSum / ProjDetail2."Prognosis Amount") * 100;
      //            IF (ProjDetail2."Original Budget" <> 0) AND (OSum <> 0) THEN
      //              OSum := (OSum / ProjDetail2."Original Budget") * 100;
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (JSum <> 0) THEN
      //              JSum := (JSum / ProjDetail2."Budget adjustment") * 100;
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ExSum <> 0) THEN
      //              ExSum := (ExSum / ProjDetail2."Expected Cost") * 100;
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ESum <> 0) THEN
      //              ESum := (ESum / ProjDetail2."Budget Extension Contract")*100;
      //            IF (ProjDetail2."First prognosis" <> 0) AND (FSum <> 0) THEN
      //              FSum := (FSum / ProjDetail2."First prognosis")*100;
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (LSum <> 0) THEN
      //              LSum := (LSum / ProjDetail2."Prognosis (last preclosure)")*100;
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (MSum <> 0) THEN
      //              MSum := (MSum / ProjDetail2."GL Amount Period") * 100;
      //          END;
      //<<190313
              END;
            END;
            IF (Operator4 <> '') AND (Line5 <> 0) THEN BEGIN
              CLEAR(ProjDetail2);
              ProjDetail2.SETRANGE(UserID,UserId);
              ProjDetail2.SETRANGE("Project No.",ProjNo);
              ProjDetail2.SETRANGE("Line No.",Line5);
              IF ProjDetail2.FIND('-') THEN BEGIN
      //>>190313
                BSum := CodeLinesEvaluate(BSum, BSum, Operator4, ProjDetail2."Budget Amount");
                GSum := CodeLinesEvaluate(GSum, GSum, Operator4, ProjDetail2."GL Amount");
                PSum := CodeLinesEvaluate(PSum, PSum, Operator4, ProjDetail2."Prognosis Amount");
                OSum := CodeLinesEvaluate(OSum, OSum, Operator4, ProjDetail2."Original Budget");
                JSum := CodeLinesEvaluate(JSum, JSum, Operator4, ProjDetail2."Budget adjustment");
                ExSum := CodeLinesEvaluate(ExSum, ExSum, Operator4, ProjDetail2."Expected Cost");
                ESum := CodeLinesEvaluate(ESum, ESum, Operator4, ProjDetail2."Budget Extension Contract");
                FSum := CodeLinesEvaluate(FSum, FSum, Operator4, ProjDetail2."First prognosis");
                LSum := CodeLinesEvaluate(LSum, LSum, Operator4, ProjDetail2."Prognosis (last preclosure)");
                MSum := CodeLinesEvaluate(MSum, MSum, Operator4, ProjDetail2."GL Amount Period");
                //190603 ORANGO.EE #23919
                NSum := CodeLinesEvaluate(NSum, NSum, Operator4, ProjDetail2."Locked GL Amount");
                RSum := CodeLinesEvaluate(RSum, RSum, Operator4, ProjDetail2."Prognosis Budget Line");

                //200120 ORANGO.EE #27258 >>
                TBSum := CodeLinesEvaluate(TBSum,TBSum, Operator4, ProjDetail2."Target Budget");
                //<<

                //200416 ORANGO.EE
                GLESum := CodeLinesEvaluate(GLESum, GLESum, Operator4,ProjDetail2."Extension GL Amount");
                POSum := CodeLinesEvaluate(POSum, POSum, Operator4,ProjDetail2."Open Purchase Orders");
                RNISum := CodeLinesEvaluate(RNISum, RNISum, Operator4, ProjDetail2."Recieved Not Invoiced");
                //<<

      //          IF Operator4 = '+' THEN BEGIN
      //            BSum := BSum + ProjDetail2."Budget Amount";
      //            GSum := GSum + ProjDetail2."GL Amount";
      //            PSum := PSum + ProjDetail2."Prognosis Amount";
      //            OSum := OSum + ProjDetail2."Original Budget";
      //            JSum := JSum + ProjDetail2."Budget adjustment";
      //            ExSum := ExSum + ProjDetail2."Expected Cost";
      //            ESum := ESum + ProjDetail2."Budget Extension Contract";
      //            FSum := FSum + ProjDetail2."First prognosis";
      //            LSum := LSum + ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum + ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator4 = '-' THEN BEGIN
      //            BSum := BSum - ProjDetail2."Budget Amount";
      //            GSum := GSum - ProjDetail2."GL Amount";
      //            PSum := PSum - ProjDetail2."Prognosis Amount";
      //            OSum := OSum - ProjDetail2."Original Budget";
      //            JSum := JSum - ProjDetail2."Budget adjustment";
      //            ExSum := ExSum - ProjDetail2."Expected Cost";
      //            ESum := ESum - ProjDetail2."Budget Extension Contract";
      //            FSum := FSum - ProjDetail2."First prognosis";
      //            LSum := LSum - ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum - ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator4 = '*' THEN BEGIN
      //            BSum := BSum * ProjDetail2."Budget Amount";
      //            GSum := GSum * ProjDetail2."GL Amount";
      //            PSum := PSum * ProjDetail2."Prognosis Amount";
      //            OSum := OSum * ProjDetail2."Original Budget";
      //            JSum := JSum * ProjDetail2."Budget adjustment";
      //            ExSum := ExSum * ProjDetail2."Expected Cost";
      //            ESum := ESum * ProjDetail2."Budget Extension Contract";
      //            FSum := FSum * ProjDetail2."First prognosis";
      //            LSum := LSum * ProjDetail2."Prognosis (last preclosure)";
      //            MSum := MSum * ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator4 = '/' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (BSum <> 0) THEN
      //              BSum := BSum / ProjDetail2."Budget Amount";
      //            IF (ProjDetail2."GL Amount" <> 0) AND (GSum <> 0) THEN
      //              GSum := GSum / ProjDetail2."GL Amount";
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (PSum <> 0) THEN
      //              PSum := PSum / ProjDetail2."Prognosis Amount";
      //            IF (ProjDetail2."Original Budget" <> 0) AND (OSum <> 0) THEN
      //              OSum := OSum / ProjDetail2."Original Budget";
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (JSum <> 0) THEN
      //              JSum := JSum / ProjDetail2."Budget adjustment";
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ExSum <> 0) THEN
      //              ExSum := ExSum / ProjDetail2."Expected Cost";
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ESum <> 0) THEN
      //              ESum := ESum / ProjDetail2."Budget Extension Contract";
      //            IF (ProjDetail2."First prognosis" <> 0) AND (FSum <> 0) THEN
      //              FSum := FSum / ProjDetail2."First prognosis";
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (LSum <> 0) THEN
      //              LSum := LSum / ProjDetail2."Prognosis (last preclosure)";
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (MSum <> 0) THEN
      //              MSum := MSum / ProjDetail2."GL Amount Period";
      //          END;
      //          IF Operator3 = '%' THEN BEGIN
      //            IF (ProjDetail2."Budget Amount" <> 0) AND (BSum <> 0) THEN
      //              BSum := (BSum / ProjDetail2."Budget Amount") * 100;
      //            IF (ProjDetail2."GL Amount" <> 0) AND (GSum <> 0) THEN
      //              GSum := (GSum / ProjDetail2."GL Amount") * 100;
      //            IF (ProjDetail2."Prognosis Amount" <> 0) AND (PSum <> 0) THEN
      //              PSum := (PSum / ProjDetail2."Prognosis Amount") * 100;
      //            IF (ProjDetail2."Original Budget" <> 0) AND (OSum <> 0) THEN
      //              OSum := (OSum / ProjDetail2."Original Budget") * 100;
      //            IF (ProjDetail2."Budget adjustment" <> 0) AND (JSum <> 0) THEN
      //              JSum := (JSum / ProjDetail2."Budget adjustment") * 100;
      //            IF (ProjDetail2."Expected Cost" <> 0) AND (ExSum <> 0) THEN
      //              ExSum := (ExSum / ProjDetail2."Expected Cost") * 100;
      //            IF (ProjDetail2."Budget Extension Contract" <> 0) AND (ESum <> 0) THEN
      //              ESum := (ESum / ProjDetail2."Budget Extension Contract")*100;
      //            IF (ProjDetail2."First prognosis" <> 0) AND (FSum <> 0) THEN
      //              FSum := (FSum / ProjDetail2."First prognosis")*100;
      //            IF (ProjDetail2."Prognosis (last preclosure)" <> 0) AND (LSum <> 0) THEN
      //              LSum := (LSum / ProjDetail2."Prognosis (last preclosure)")*100;
      //            IF (ProjDetail2."GL Amount Period" <> 0) AND (MSum <> 0) THEN
      //              MSum := (MSum / ProjDetail2."GL Amount Period") * 100;
      //          END;
      //<<190313
              END;
            END;
          END;
          IF ProjDetail.Procent = TRUE THEN BEGIN
            ProjDetail."Budget Amount" := BSum*100;
            ProjDetail."GL Amount" := GSum*100;
            ProjDetail."Prognosis Amount" := PSum*100;
            ProjDetail."Original Budget" := OSum * 100;
            ProjDetail."Budget adjustment" := JSum * 100;
            //ProjDetail."Expected Cost" := (ExSum * 100) * -1;
            ProjDetail."Expected Cost" := ExSum * 100;
            ProjDetail."Budget Extension Contract" := ESum * 100;
            ProjDetail."First prognosis" := FSum * 100;
            ProjDetail."Prognosis (last preclosure)" := LSum * 100;
            ProjDetail."GL Amount Period" := MSum*100;
            ProjDetail."Locked GL Amount" := NSum*100;
            ProjDetail."Prognosis Budget Line" := RSum*100;
            ProjDetail.MODIFY;
          END ELSE BEGIN
            ProjDetail."Budget Amount" := BSum;
            ProjDetail."GL Amount" := GSum;
            ProjDetail."Prognosis Amount" := PSum;
            ProjDetail."Original Budget" := OSum;
            ProjDetail."Budget adjustment" := JSum;
            //ProjDetail."Expected Cost" := ExSum * -1;
            ProjDetail."Expected Cost" := ExSum;
            ProjDetail."Budget Extension Contract" := ESum;
            ProjDetail."First prognosis" := FSum;
            ProjDetail."Prognosis (last preclosure)" := LSum;
            ProjDetail."GL Amount Period" := MSum;
            ProjDetail."Locked GL Amount" := NSum;
            ProjDetail."Prognosis Budget Line" := RSum;

            //200120 ORANGO.EE #27258 >>
            ProjDetail."Target Budget":= TBSum;
            //<<

            //200416 ORANGO.EE >>
            ProjDetail."Extension GL Amount" := GLESum;
            ProjDetail."Open Purchase Orders" := POSum;
            ProjDetail."Recieved Not Invoiced" := RNISum;
            //<<
            ProjDetail.MODIFY;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE CodeLinesEvaluate@1100285108(res@1100285103 : Decimal;inValue@1100285100 : Decimal;operand@1100285101 : Code[2];handlevalue@1100285102 : Decimal) : Decimal;
    BEGIN
      //190313
      CASE operand OF
        '+': res := (inValue + handlevalue);
        '-': res := (inValue - handlevalue);
        '*': res := (inValue * handlevalue);
        '/': IF (inValue<>0) AND (handlevalue<>0) THEN res := (inValue/handlevalue);
        '%': IF (inValue<>0) AND (handlevalue<>0) THEN res := ((inValue/handlevalue)*100);
      END;
      EXIT(res);
    END;

    PROCEDURE ShowProjDetailPage@1100285007(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
    BEGIN
      COMMIT;
      //>> 170905 ITERO.SB
      ProjDetail.FILTERGROUP(26);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.FILTERGROUP(0);
      //<<
      IF ProjDetail.FIND('-') THEN
        PAGE.RUNMODAL(PAGE::"Project Details", ProjDetail);
    END;

    PROCEDURE MgtProjDetailUpdate@1100285011(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];PosFilter@1100583000 : Code[10]);
    VAR
      Period@1101285001 : Text;
      startDT@1101285000 : DateTime;
    BEGIN

      GetBudgetLines(UserId,ProjNo,PosFilter);
      GetGLEntrys(UserId,ProjNo,PosFilter);
      //190527 ORANGO.EE Moved code
      //>>190426 ORANGO.EE
      //191017 ORANGO.EE
      //Period := FORMAT(DMY2DATE(1,DATE2DMY(WORKDATE,2),DATE2DMY(WORKDATE,3))) + '..' + FORMAT(CALCDATE('<CM>',WORKDATE));
      //
      LogDuration(tabErrorLogTEMP,startDT,'CreatePeriod');
      GetGLEntrysPeriod(UserId,ProjNo,Period,PosFilter);
      //<<
      GetGLEntrysLocked(UserId,ProjNo,PosFilter);
      GetPrognosisLine(UserId,ProjNo,PosFilter);
      BudgetContract(UserId,ProjNo);
      //200120 ORANGO.EE BYGG #27258
      GetTargetBudget(UserId, ProjNo);
      //200416 ORANGO.EE CERTEGO >>
      GetPurchaseRecievedNotInvoiced(UserId, ProjNo);
      GetOpenPurchaseNotRecieved(UserId,ProjNo);
      GetGLEntriesExtension(UserId, ProjNo,'');
      //<<
      SumProjDetail(UserId,ProjNo);
      OverheadCost(UserId,ProjNo);
      CodeLines(UserId,ProjNo);
      GetExFlowLines(UserId,ProjNo);
      //>> 171122 ITERO.SB
      TotalLines(UserId,ProjNo);
      //<<
      ShowThousands(UserId,ProjNo);
    END;

    PROCEDURE GetExFlowLines@1100285300(UserId@1100285300 : Code[50];ProjNo@1100285301 : Code[20]);
    VAR
      ExFlowLine@1100285302 : Record 12013609;
      ExFlowDim@1100285303 : Record 12013611;
      ExSum@1100285304 : Decimal;
      ExSumPart@1100285102 : Decimal;
      ProjDetail@1100285305 : Record 11128083;
      ProjDet@1100285306 : Record 11128083;
      HourALine@1100285307 : Record 11012039;
      GLSetup@1100285308 : Record 98;
      ExFlowSetup@1100285309 : Record 12013601;
      PurchHead@1100285310 : Record 38;
      modifProjDetail@1100285100 : Boolean;
      qGetExFlowLinesUnderProject@1100285101 : Query 11128091;
    BEGIN
      IF NOT ExFlowSetup.GET THEN
        EXIT;

      GLSetup.GET;

      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          modifProjDetail:=FALSE;
          ExSum := 0;
      //>>190312
          qGetExFlowLinesUnderProject.SETRANGE(Job_No,ProjNo);
          qGetExFlowLinesUnderProject.SETRANGE(Dimension_Code,GLSetup."Global Dimension 2 Code");
          qGetExFlowLinesUnderProject.SETRANGE(Dimension_Value,ProjDetail."GL Entry Cost Object");
          qGetExFlowLinesUnderProject.SETRANGE(Document_Type,PurchHead."Document Type"::Invoice);
          qGetExFlowLinesUnderProject.OPEN;
          WHILE qGetExFlowLinesUnderProject.READ DO BEGIN
            ExSumPart := qGetExFlowLinesUnderProject.Sum_Amount;
            IF (qGetExFlowLinesUnderProject.Currency_Factor <> 0) AND (ExSumPart<>0) THEN
              ExSumPart := ExSumPart/qGetExFlowLinesUnderProject.Currency_Factor;
            ExSum += ExSumPart;
          END;
          qGetExFlowLinesUnderProject.SETRANGE(Document_Type,PurchHead."Document Type"::"Credit Memo");
          qGetExFlowLinesUnderProject.OPEN;
          WHILE qGetExFlowLinesUnderProject.READ DO BEGIN
            ExSumPart := qGetExFlowLinesUnderProject.Sum_Amount;
            IF (qGetExFlowLinesUnderProject.Currency_Factor <> 0) AND (ExSumPart<>0) THEN
              ExSumPart := ExSumPart/qGetExFlowLinesUnderProject.Currency_Factor;
            ExSum -= ExSumPart;
          END;
          qGetExFlowLinesUnderProject.CLOSE;
      //    ExFlowLine.SETRANGE("Job No.",ProjNo);
      //    IF ExFlowLine.FIND('-') THEN BEGIN
      //      ExSum := 0;
      //      REPEAT
      //        ExFlowDim.SETRANGE("Document Line ID",ExFlowLine.ID);
      //        ExFlowDim.SETRANGE("Dimension Code",GLSetup."Global Dimension 2 Code");
      //        ExFlowDim.SETRANGE("Dimension Value",ProjDetail."GL Entry Cost Object");
      //        IF ExFlowDim.FIND('-') THEN BEGIN
      //          IF PurchHead.GET(PurchHead."Document Type"::Invoice,ExFlowLine."Document No.") THEN BEGIN
      //            IF PurchHead."Currency Factor" > 0 THEN BEGIN
      //              ExSum := ExSum + (ExFlowLine.Amount/PurchHead."Currency Factor");
      //            END ELSE BEGIN
      //              ExSum := ExSum + ExFlowLine.Amount;
      //            END;
      //          END ELSE BEGIN
      //            IF PurchHead.GET(PurchHead."Document Type"::"Credit Memo",ExFlowLine."Document No.") THEN BEGIN
      //                IF PurchHead."Currency Factor" > 0 THEN BEGIN
      //                  ExSum := ExSum - (ExFlowLine.Amount/PurchHead."Currency Factor");
      //                END ELSE BEGIN
      //                  ExSum := ExSum - ExFlowLine.Amount;
      //                END;
      //            END ELSE BEGIN
      //              ExSum := ExSum - ExFlowLine.Amount;
      //            END;
      //          END;
      //        END;
      //      UNTIL ExFlowLine.NEXT = 0;
            IF ExSum <> 0 THEN
              modifProjDetail := TRUE;
      //<<190312
            ProjDetail."Expected Cost" := ExSum;
      //    ProjDetail.MODIFY;
      //    END;


          HourALine.SETCURRENTKEY("Project No.","Cost Type","Cost Object","Posting Date");
          HourALine.SETRANGE("Project No.",ProjNo);
          HourALine.SETRANGE("Cost Object",ProjDetail."GL Entry Cost Object");
          IF HourALine.FIND('-') THEN BEGIN
            ExSum := 0;
      //>>190312
      //        REPEAT
      //          ExSum := ExSum + HourALine.Amount;
      //        UNTIL HourALine.NEXT = 0;
            HourALine.CALCSUMS(Amount);
            ExSum := HourALine.Amount;
            IF ExSum <> 0 THEN
              modifProjDetail := TRUE;
      //<<190312
            ProjDetail."Expected Cost" := ProjDetail."Expected Cost" + ExSum;
      //      ProjDetail.MODIFY;
          END;
          IF modifProjDetail THEN
            ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetExFlowLinesUnderProject@1000000000(UserId@1000000001 : Code[50];ProjNo@1000000000 : Code[20]);
    VAR
      Job@1000000003 : Record 11072003;
      JobUnder@1000000002 : Record 11072003;
      ExFlowLine@1000000012 : Record 12013609;
      ExFlowDim@1000000011 : Record 12013611;
      ExSum@1000000010 : Decimal;
      ExSumPart@1100285107 : Decimal;
      ProjDetail@1000000009 : Record 11128083;
      ProjDet@1000000008 : Record 11128083;
      HourALine@1000000007 : Record 11012039;
      GLSetup@1000000006 : Record 98;
      ExFlowSetup@1000000005 : Record 12013601;
      PurchHead@1000000004 : Record 38;
      modifProjDetail@1100285100 : Boolean;
      startDT@1100285101 : DateTime;
      step1DT@1100285102 : DateTime;
      step2DT@1100285105 : DateTime;
      qGetExFlowLinesUnderProject@1100285106 : Query 11128091;
    BEGIN
      //Om "ProjNo" „r ett main project - snurra igenom alla projekt som har detta som huvudprojekt.
      IF NOT ExFlowSetup.GET THEN
        EXIT;

      GLSetup.GET;
      IF useLogging THEN
        startDT:=CURRENTDATETIME;
      JobUnder.SETCURRENTKEY("Main Project");
      JobUnder.SETRANGE("Main Project",ProjNo);
      JobUnder.SETFILTER("No.",'<>%1',ProjNo);
      IF JobUnder.FINDSET(FALSE) THEN BEGIN
        REPEAT
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
          IF ProjDetail.FINDSET(TRUE) THEN BEGIN
            IF useLogging THEN
              step1DT := CURRENTDATETIME;
            REPEAT
              ExSum := 0;
      //>>190312
              modifProjDetail:=FALSE;
              qGetExFlowLinesUnderProject.SETRANGE(Job_No,JobUnder."No.");
              qGetExFlowLinesUnderProject.SETRANGE(Dimension_Code,GLSetup."Global Dimension 2 Code");
              qGetExFlowLinesUnderProject.SETRANGE(Dimension_Value,ProjDetail."GL Entry Cost Object");
              qGetExFlowLinesUnderProject.SETRANGE(Document_Type,PurchHead."Document Type"::Invoice);
              qGetExFlowLinesUnderProject.OPEN;
              WHILE qGetExFlowLinesUnderProject.READ DO BEGIN
                ExSumPart := qGetExFlowLinesUnderProject.Sum_Amount;
                IF (qGetExFlowLinesUnderProject.Currency_Factor <> 0) AND (ExSumPart<>0) THEN
                  ExSumPart := ExSumPart/qGetExFlowLinesUnderProject.Currency_Factor;
                ExSum += ExSumPart;
              END;
              qGetExFlowLinesUnderProject.SETRANGE(Document_Type,PurchHead."Document Type"::"Credit Memo");
              qGetExFlowLinesUnderProject.OPEN;
              WHILE qGetExFlowLinesUnderProject.READ DO BEGIN
                ExSumPart := qGetExFlowLinesUnderProject.Sum_Amount;
                IF (qGetExFlowLinesUnderProject.Currency_Factor <> 0) AND (ExSumPart<>0) THEN
                  ExSumPart := ExSumPart/qGetExFlowLinesUnderProject.Currency_Factor;
                ExSum -= ExSumPart;
              END;
              qGetExFlowLinesUnderProject.CLOSE;
      //          modifProjDetail:=FALSE;i+=1;step2DT:=CURRENTDATETIME;
      //          ExFlowLine.SETRANGE("Job No.",JobUnder."No.");
      //          IF ExFlowLine.FINDset(false) THEN BEGIN
      //            ExSum := 0;
      //            REPEAT
      //              ExFlowDim.SETRANGE("Document Line ID",ExFlowLine.ID);
      //              ExFlowDim.SETRANGE("Dimension Code",GLSetup."Global Dimension 2 Code");
      //              ExFlowDim.SETRANGE("Dimension Value",ProjDetail."GL Entry Cost Object");
      //              IF ExFlowDim.FINDset(false) THEN BEGIN
      //                IF PurchHead.GET(PurchHead."Document Type"::Invoice,ExFlowLine."Document No.") THEN BEGIN
      //                  IF PurchHead."Currency Factor" > 0 THEN BEGIN
      //                    ExSum := ExSum + (ExFlowLine.Amount/PurchHead."Currency Factor");
      //                  END ELSE BEGIN
      //                    ExSum := ExSum + ExFlowLine.Amount;
      //                  END;
      //                END ELSE BEGIN
      //                  IF PurchHead.GET(PurchHead."Document Type"::"Credit Memo",ExFlowLine."Document No.") THEN BEGIN
      //                      IF PurchHead."Currency Factor" > 0 THEN BEGIN
      //                        ExSum := ExSum - (ExFlowLine.Amount/PurchHead."Currency Factor");
      //                      END ELSE BEGIN
      //                        ExSum := ExSum - ExFlowLine.Amount;
      //                      END;
      //                    END ELSE BEGIN
      //                    ExSum := ExSum - ExFlowLine.Amount;
      //                  END;
      //                END;
      //              END;
      //            UNTIL ExFlowLine.NEXT = 0;
      // IF useLogging THEN LogDuration(tabErrorLogTEMP,step2DT,'ProjDetail ExFlowLine '+JobUnder."No." + ' ' + FORMAT(ProjDetail."Line No."));
            IF ExSum <> 0 THEN
              modifProjDetail := TRUE;
      //<<190312
            ProjDetail."Expected Cost" := ProjDetail."Expected Cost" + ExSum;
      //          END;
            HourALine.SETCURRENTKEY("Project No.","Cost Type","Cost Object","Posting Date");
            HourALine.SETRANGE("Project No.",JobUnder."No.");
            HourALine.SETRANGE("Cost Object",ProjDetail."GL Entry Cost Object");
            IF HourALine.FINDSET(FALSE) THEN BEGIN
              ExSum := 0;
      //>>190312
      //        REPEAT
      //          ExSum := ExSum + HourALine.Amount;
      //        UNTIL HourALine.NEXT = 0;
              HourALine.CALCSUMS(Amount);
              ExSum := HourALine.Amount;
              IF ExSum <> 0 THEN
                modifProjDetail := TRUE;
      //<<190312
              ProjDetail."Expected Cost" := ProjDetail."Expected Cost" + ExSum;
            END;
      // IF useLogging THEN LogDuration(tabErrorLogTEMP,step2DT,'ProjDetail HourALine '+JobUnder."No.");
            IF modifProjDetail THEN
              ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
            IF useLogging THEN LogDuration(tabErrorLogTEMP,step1DT,'ProjDetail '+JobUnder."No.");
          END;
        UNTIL JobUnder.NEXT = 0;
        IF useLogging THEN LogDuration(tabErrorLogTEMP,startDT,'GetExFlowLinesUnderProject JobUnder');
      END;
    END;

    PROCEDURE SetPrognosisAcc@1100285100(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      PL@1100285003 : Record 11012035;
      PSum@1100285004 : Decimal;
      Prognosis@1100285005 : Record 11012034;
      ProjectPreclosureResult@1100285100 : Record 11012093;
      Job@1100285101 : Record 11072003;
    BEGIN
      IF Job.GET(ProjNo) THEN BEGIN
        IF Job."Forecast Level"=Job."Forecast Level"::"Cost Object" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Prognosis Cost Object",'<>%1','');
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
                ProjDetail."New Prognosis Amount":=ProjDetail."GL Amount";
                ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
            ProjDetail.VALIDATE("New Prognosis Amount")
          END;
        END ELSE IF Job."Forecast Level"=Job."Forecast Level"::"Cost Component" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
                ProjDetail."New Prognosis Amount":=ProjDetail."GL Amount";
                ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
            ProjDetail.VALIDATE("New Prognosis Amount");
          END;

        END;
      END;
    END;

    PROCEDURE TotalLines@1100285101(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      ProcPrin@1100285003 : Record 11012005;
      Job@1100285004 : Record 11072003;
    BEGIN
      //IF Job.GET(ProjNo) THEN BEGIN
      //  Job.CALCFIELDS("Contract Amount","Extension Contract Amount");
        ProjDetail.SETRANGE(UserID,UserId);
        ProjDetail.SETRANGE("Project No.",ProjNo);
        //ProjDetail.SETRANGE("Budget Contractamount",TRUE);
        IF ProjDetail.FIND('-') THEN BEGIN
          REPEAT
            //ProjDetail."Original Budget":= Job."Contract Amount";
            //ProjDetail."Budget Extension Contract":= Job."Extension Contract Amount";
            //ProjDetail."Budget Amount":= Job."Contract Amount"+Job."Extension Contract Amount";
            //ProjDetail.Total:=ProjDetail."Budget Amount"+ProjDetail."GL Amount"+ProjDetail."Prognosis Amount";
            //ProjDetail.Total:=ProjDetail."Budget Amount"+ProjDetail."GL Amount"+ProjDetail."Prognosis Amount"+ProjDetail."Expected Cost"; //PR180409
            ProjDetail.Total :=ProjDetail."Budget Amount"+ProjDetail."GL Amount"+ProjDetail."Prognosis Amount"+ProjDetail."Expected Cost" + ProjDetail."Target Budget" + ProjDetail."Prognosis Budget Line"; // ##27258
            ProjDetail.Total+=ProjDetail."Original Budget";//150809
            ProjDetail.TotalNotZero := (ProjDetail.Total<>0) OR (ProjDetail."GL Amount Period"<>0) OR ProjDetail.InOverview;//180920, Support #18876
            IF ProjDetail.InOverview THEN
              ProjDetail.Total:=ProjDetail.Total+1;
            ProjDetail.MODIFY;
          UNTIL ProjDetail.NEXT = 0;
        END;
      //END;
    END;

    PROCEDURE UpdateJobHours@1100285102(UserId@1100285101 : Code[50];ProjNo@1100285100 : Code[20]);
    VAR
      ProjDetail@1100285104 : Record 11128083;
      Job@1100285102 : Record 11072003;
      HourAccountingLine@1100285105 : Record 11012039;
    BEGIN
      //RFC157
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Cost Type",ProjDetail."Cost Type"::Labor);
      IF ProjDetail.FINDSET(TRUE) THEN BEGIN
        REPEAT
          IF Job.GET(ProjDetail."Project No.") THEN BEGIN
            IF (ProjDetail."Open Amount (Hours)" <> 0) OR (ProjDetail."Open Hours" <> 0 ) THEN BEGIN
              ProjDetail."Open Amount (Hours)" := 0;
              ProjDetail."Open Hours" := 0;
              ProjDetail.MODIFY;
            END;

            IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
              HourAccountingLine.SETRANGE("Main Project No.",ProjDetail."Project No.")
            ELSE
              HourAccountingLine.SETRANGE("Project No.",ProjDetail."Project No.");
            HourAccountingLine.SETRANGE("Cost Object",ProjDetail."Prognosis Cost Object");
            HourAccountingLine.SETRANGE(HourAccountingLine."Department Code",ProjDetail."Global Dimension 1 Code");//"Shortcut Dimension 1 Code",ProjDetail."Global Dimension 1 Code");

            IF HourAccountingLine.FINDSET(FALSE) THEN BEGIN
              REPEAT
                IF ProjDetail."Sum Amount" THEN ProjDetail."Open Amount (Hours)" += HourAccountingLine."Amount (LCY)";
                IF ProjDetail."Sum Quantity" THEN ProjDetail."Open Hours" += HourAccountingLine."Total Line";
              UNTIL HourAccountingLine.NEXT=0;
              ProjDetail.MODIFY;
            END;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetGLEntrysPeriod@1100285103(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];Period@1100285106 : Text;PosFilter@1101285000 : Text[10]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      GSum@1100285004 : Decimal;
      AFilt1@1100285005 : Code[10];
      AFilt2@1100285006 : Code[10];
      AFilt3@1100285007 : Code[10];
      AFilt4@1100285008 : Code[10];
      AFilt5@1100285009 : Code[10];
      Strangen@1100285010 : Text[50];
      AFilt6@1100285100 : Code[10];
      AFilt7@1100285101 : Code[10];
      AFilt8@1100285103 : Code[10];
      AFilt9@1100285102 : Code[10];
      JLE@1100285104 : Record 11072005;
      Job@1100285105 : Record 11072003;
    BEGIN
      //>> 170425 ITERO.SB RFC-101.2
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          JLE.SETFILTER("Posting Date",Period);

          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
            JLE.SETRANGE(Element, PosFilter);
          //<<

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."GL Amount Period" := GSum;
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;

      CLEAR(ProjDetail);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      //ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          //JLE.SETRANGE("Job No.",ProjNo);
          //JLE.SETRANGE("Main Project No.",ProjNo);
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          //JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          JLE.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
          JLE.SETFILTER("Posting Date",Period);

         //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
            JLE.SETRANGE(Element, PosFilter);
          //<<

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."GL Amount Period" := GSum;
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;
      //<<
      FromUpdate:=TRUE;
    END;

    PROCEDURE GetProjDetailTemplateCode@1101285000(UserId@1101285001 : Code[50]) TmplCode : Code[10];
    VAR
      UserSetup@1101285003 : Record 91;
      UserPersonalization@1101285002 : Record 2000000073;
      ProjectDetailUserTemplates@1101285004 : Record 11128084;
      Profile@1101285005 : Record 2000000072;
    BEGIN
      TmplCode:='';
      IF UserId = '' THEN
        EXIT(TmplCode);

      //user setup
      IF ProjectDetailUserTemplates.GET(ProjectDetailUserTemplates."User Type"::"User Setup ID", UserId) THEN
        TmplCode := ProjectDetailUserTemplates."Template Code";
      IF HasProjectDetailUserTemplate(TmplCode) THEN
        EXIT(TmplCode);

      //user profile setup
      UserPersonalization.SETRANGE("User ID",UserId);
      IF UserPersonalization.FINDLAST THEN
        IF ProjectDetailUserTemplates.GET(ProjectDetailUserTemplates."User Type"::"Profile ID", UserPersonalization."Profile ID") THEN
          TmplCode := ProjectDetailUserTemplates."Template Code";
      IF HasProjectDetailUserTemplate(TmplCode) THEN
        EXIT(TmplCode);

      //default profile
      Profile.SETRANGE("Default Role Center",TRUE);
      IF Profile.FINDLAST THEN
        IF ProjectDetailUserTemplates.GET(ProjectDetailUserTemplates."User Type"::"Profile ID", Profile."Profile ID") THEN
          TmplCode := ProjectDetailUserTemplates."Template Code";
      IF HasProjectDetailUserTemplate(TmplCode) THEN
        EXIT(TmplCode);

      EXIT('');
    END;

    LOCAL PROCEDURE HasProjectDetailUserTemplate@1101285006(VAR TmplCode@1101285001 : Code[10]) : Boolean;
    VAR
      ProjDetailTemplate@1101285000 : Record 11128082;
    BEGIN
      IF TmplCode = '' THEN
        EXIT(FALSE);

      ProjDetailTemplate.SETFILTER("Line No.",'<>%1',0);
      ProjDetailTemplate.SETRANGE("Template Code", TmplCode);
      IF NOT ProjDetailTemplate.ISEMPTY THEN
        EXIT(TRUE);

      TmplCode := '';
      EXIT(FALSE);
    END;

    PROCEDURE GetAmountAndExpCost@1000000002(UserID@1000000000 : Code[50];ProjNo@1000000001 : Code[50];CostObj@1000000002 : Code[50]);
    VAR
      AmountExpCost@1100285100 : Record 11128085;
      ExFlowLine@1000000007 : Record 12013609;
      ExFlowDim@1000000006 : Record 12013611;
      ExFlowSetup@1000000005 : Record 12013601;
      PurchLine@1000000004 : Record 39;
      i@1000000008 : Integer;
      PurchHead@1000000009 : Record 38;
      HourALine@1000000010 : Record 11012039;
      GLSetup@1000000011 : Record 98;
      JobUnder@1000000012 : Record 11072003;
      AmountExpCostKoll@1000000013 : Record 11128085;
      EXDocumentLineApprover@1101285000 : Record 12013610;
    BEGIN
      AmountExpCost.SETRANGE(UserID,UserID);
      AmountExpCost.SETRANGE("Project No.",ProjNo);
      //AmountExpCost.SETRANGE("Cost Object",CostObj);
      IF AmountExpCost.FINDSET THEN
        AmountExpCost.DELETEALL;

      i := 10000;

      IF ExFlowSetup.GET THEN BEGIN
        ExFlowLine.SETRANGE("Job No.",ProjNo);
        IF ExFlowLine.FIND('-') THEN BEGIN
          GLSetup.GET;
          REPEAT
            ExFlowDim.SETRANGE("Document Line ID",ExFlowLine.ID);
            ExFlowDim.SETRANGE("Dimension Code",GLSetup."Global Dimension 2 Code");
            ExFlowDim.SETRANGE("Dimension Value",CostObj);
            IF ExFlowDim.FIND('-') THEN BEGIN
              IF PurchHead.GET(PurchHead."Document Type"::Invoice,ExFlowLine."Document No.") THEN BEGIN
                AmountExpCost.INIT;
                AmountExpCost.UserID := UserID;
                AmountExpCost."Project No." := ProjNo;
                AmountExpCost."Cost Object" := ExFlowDim."Dimension Value";
                AmountExpCost."Line No." := i;
                i := i + 10000;
                AmountExpCost.Description := ExFlowLine.Description;
                AmountExpCost."Invoice No." := ExFlowLine."Document No.";
                AmountExpCost."No." := ExFlowLine."No.";
                AmountExpCost."Invoice Line No." := ExFlowLine."Line No.";
                AmountExpCost.Quantity := ExFlowLine.Quantity;
                IF PurchHead."Currency Factor" > 0 THEN BEGIN
                  AmountExpCost."Direct Unit Cost" := (ExFlowLine."Direct Unit Cost"/PurchHead."Currency Factor");
                  AmountExpCost."Line Amount" := (ExFlowLine.Amount/PurchHead."Currency Factor");
                END ELSE BEGIN
                  AmountExpCost."Direct Unit Cost" := ExFlowLine."Direct Unit Cost";
                  AmountExpCost."Line Amount" := ExFlowLine.Amount;
                END;
                AmountExpCost."Vendor Name" := PurchHead."Buy-from Vendor Name";
                AmountExpCost."Document Date" := PurchHead."Document Date";

                //190604 ORANGO.EE BYGG >>
                EXDocumentLineApprover.SETRANGE("Document No.", ExFlowLine."Document No.");
                EXDocumentLineApprover.SETRANGE("Line No.", ExFlowLine."Line No.");
                EXDocumentLineApprover.SETRANGE(Flowstatus, EXDocumentLineApprover.Flowstatus::Current);
                IF EXDocumentLineApprover.FIND('-') THEN
                   AmountExpCost.Approver := EXDocumentLineApprover.Approver;
                //<<

                //190607 ORANGO.EE BYGG >>
                PurchLine.SETRANGE("Document No.", ExFlowLine."Document No.");
                PurchLine.SETRANGE("Line No.", ExFlowLine."Line No.");
                IF PurchLine.FIND('-') THEN
                  AmountExpCost.Position := PurchLine.Element;
                //<<

                AmountExpCostKoll.SETCURRENTKEY(UserID,"Invoice No.","Invoice Line No.");
                AmountExpCostKoll.SETRANGE(UserID,UserID);
                AmountExpCostKoll.SETRANGE("Invoice No.",AmountExpCost."Invoice No.");
                AmountExpCostKoll.SETRANGE("Invoice Line No.",AmountExpCost."Invoice Line No.");
                IF NOT AmountExpCostKoll.FIND('-') THEN
                  AmountExpCost.INSERT;
              END ELSE BEGIN
                IF PurchHead.GET(PurchHead."Document Type"::"Credit Memo",ExFlowLine."Document No.") THEN BEGIN
                  AmountExpCost.INIT;
                  AmountExpCost.UserID := UserID;
                  AmountExpCost."Project No." := ProjNo;
                  AmountExpCost."Cost Object" := ExFlowDim."Dimension Value";
                  AmountExpCost."Line No." := i;
                  i := i + 10000;
                  AmountExpCost.Description := ExFlowLine.Description;
                  AmountExpCost."Invoice No." := ExFlowLine."Document No.";
                  AmountExpCost."No." := ExFlowLine."No.";
                  AmountExpCost.Quantity := ExFlowLine.Quantity;
                  IF PurchHead."Currency Factor" > 0 THEN BEGIN
                    AmountExpCost."Direct Unit Cost" := (ExFlowLine."Direct Unit Cost"/PurchHead."Currency Factor") * -1;
                    AmountExpCost."Line Amount" := (ExFlowLine.Amount/PurchHead."Currency Factor") * -1;
                  END ELSE BEGIN
                    AmountExpCost."Direct Unit Cost" := ExFlowLine."Direct Unit Cost" * -1;
                    AmountExpCost."Line Amount" := ExFlowLine.Amount * -1;
                  END;
                  AmountExpCost."Vendor Name" := PurchHead."Buy-from Vendor Name";
                  AmountExpCost."Document Date" := PurchHead."Document Date";

                  //190604 ORANGO.EE BYGG >>
                  EXDocumentLineApprover.SETRANGE("Document No.", ExFlowLine."Document No.");
                  EXDocumentLineApprover.SETRANGE("Line No.", ExFlowLine."Line No.");
                  EXDocumentLineApprover.SETRANGE(Flowstatus, EXDocumentLineApprover.Flowstatus::Current);
                  IF EXDocumentLineApprover.FIND('-') THEN
                     AmountExpCost.Approver := EXDocumentLineApprover.Approver;
                  //<<
                  AmountExpCostKoll.SETCURRENTKEY(UserID,"Invoice No.","Invoice Line No.");
                  AmountExpCostKoll.SETRANGE(UserID,UserID);
                  AmountExpCostKoll.SETRANGE("Invoice No.",ExFlowLine."Document No.");
                  AmountExpCostKoll.SETRANGE("Invoice Line No.",ExFlowLine."Line No.");
                  IF NOT AmountExpCostKoll.FIND('-') THEN
                    AmountExpCost.INSERT;
                END;
              END;
            END;
          UNTIL ExFlowLine.NEXT = 0;
          HourALine.SETCURRENTKEY("Project No.","Cost Type","Cost Object","Posting Date");
          HourALine.SETRANGE("Project No.",ProjNo);
          HourALine.SETRANGE("Cost Object",CostObj);
          IF HourALine.FIND('-') THEN BEGIN
            REPEAT
              AmountExpCost.INIT;
              AmountExpCost.UserID := UserID;
              AmountExpCost."Project No." := ProjNo;
              AmountExpCost."Cost Object" := CostObj;
              AmountExpCost."Line No." := i;
              i := i + 10000;
              AmountExpCost.Description := HourALine.Comment;
              AmountExpCost."Cost Type" := HourALine."Cost Type";
              AmountExpCost."Invoice No." := '';
              AmountExpCost."No." := HourALine."Employee No.";
              AmountExpCost.Quantity := HourALine."Total Line";
              AmountExpCost."Direct Unit Cost" := HourALine.Amount;
              AmountExpCost."Line Amount" := HourALine.Amount;
              AmountExpCost.INSERT;
            UNTIL HourALine.NEXT = 0;
          END;
        END;
        JobUnder.SETCURRENTKEY("Main Project");
        JobUnder.SETRANGE("Main Project",ProjNo);
        IF JobUnder.FIND('-') THEN BEGIN
          REPEAT
            IF JobUnder."No." <> JobUnder."Main Project" THEN BEGIN
              ExFlowLine.SETRANGE("Job No.",JobUnder."No.");
              IF ExFlowLine.FIND('-') THEN BEGIN
                GLSetup.GET;
                REPEAT
                  ExFlowDim.SETRANGE("Document Line ID",ExFlowLine.ID);
                  ExFlowDim.SETRANGE("Dimension Code",GLSetup."Global Dimension 2 Code");
                  ExFlowDim.SETRANGE("Dimension Value",CostObj);
                  IF ExFlowDim.FIND('-') THEN BEGIN
                    IF PurchHead.GET(PurchHead."Document Type"::Invoice,ExFlowLine."Document No.") THEN BEGIN
                      AmountExpCost.INIT;
                      AmountExpCost.UserID := UserID;
                      AmountExpCost."Project No." := ProjNo;
                      AmountExpCost."Cost Object" := ExFlowDim."Dimension Value";
                      AmountExpCost."Line No." := i;
                      i := i + 10000;
                      AmountExpCost.Description := ExFlowLine.Description;
                      AmountExpCost."Invoice No." := ExFlowLine."Document No.";
                      AmountExpCost."No." := ExFlowLine."No.";
                      AmountExpCost.Quantity := ExFlowLine.Quantity;
                      IF PurchHead."Currency Factor" > 0 THEN BEGIN
                        AmountExpCost."Direct Unit Cost" := (ExFlowLine."Direct Unit Cost"/PurchHead."Currency Factor");
                        AmountExpCost."Line Amount" := (ExFlowLine.Amount/PurchHead."Currency Factor");
                      END ELSE BEGIN
                        AmountExpCost."Direct Unit Cost" := ExFlowLine."Direct Unit Cost";
                        AmountExpCost."Line Amount" := ExFlowLine.Amount;
                      END;
                      AmountExpCost."Vendor Name" := PurchHead."Buy-from Vendor Name";
                      AmountExpCost."Document Date" := PurchHead."Document Date";
                      AmountExpCostKoll.SETCURRENTKEY(UserID,"Invoice No.","Invoice Line No.");
                      AmountExpCostKoll.SETRANGE(UserID,UserID);
                      AmountExpCostKoll.SETRANGE("Invoice No.",ExFlowLine."Document No.");
                      AmountExpCostKoll.SETRANGE("Invoice Line No.",ExFlowLine."Line No.");
                      IF NOT AmountExpCostKoll.FIND('-') THEN
                        AmountExpCost.INSERT;
                    END ELSE BEGIN
                      AmountExpCost.INIT;
                      AmountExpCost.UserID := UserID;
                      AmountExpCost."Project No." := ProjNo;
                      AmountExpCost."Cost Object" := ExFlowDim."Dimension Value";
                      AmountExpCost."Line No." := i;
                      i := i + 10000;
                      AmountExpCost.Description := ExFlowLine.Description;
                      AmountExpCost."Invoice No." := ExFlowLine."Document No.";
                      AmountExpCost."No." := ExFlowLine."No.";
                      AmountExpCost.Quantity := ExFlowLine.Quantity;
                      IF PurchHead."Currency Factor" > 0 THEN BEGIN
                        AmountExpCost."Direct Unit Cost" := (ExFlowLine."Direct Unit Cost"/PurchHead."Currency Factor") * -1;
                        AmountExpCost."Line Amount" := (ExFlowLine.Amount/PurchHead."Currency Factor") * -1;
                      END ELSE BEGIN
                        AmountExpCost."Direct Unit Cost" := ExFlowLine."Direct Unit Cost" * -1;
                        AmountExpCost."Line Amount" := ExFlowLine.Amount * -1;
                      END;
                      AmountExpCost."Vendor Name" := PurchHead."Buy-from Vendor Name";
                      AmountExpCost."Document Date" := PurchHead."Document Date";
                      AmountExpCostKoll.SETCURRENTKEY(UserID,"Invoice No.","Invoice Line No.");
                      AmountExpCostKoll.SETRANGE(UserID,UserID);
                      AmountExpCostKoll.SETRANGE("Invoice No.",ExFlowLine."Document No.");
                      AmountExpCostKoll.SETRANGE("Invoice Line No.",ExFlowLine."Line No.");
                      IF NOT AmountExpCostKoll.FIND('-') THEN
                        AmountExpCost.INSERT;
                    END;
                  END;
                UNTIL ExFlowLine.NEXT = 0;
                HourALine.SETCURRENTKEY("Project No.","Cost Type","Cost Object","Posting Date");
                HourALine.SETRANGE("Project No.",ProjNo);
                HourALine.SETRANGE("Cost Object",CostObj);
                IF HourALine.FIND('-') THEN BEGIN
                  REPEAT
                    AmountExpCost.INIT;
                    AmountExpCost.UserID := UserID;
                    AmountExpCost."Project No." := ProjNo;
                    AmountExpCost."Cost Object" := CostObj;
                    AmountExpCost."Line No." := i;
                    i := i + 10000;
                    AmountExpCost.Description := HourALine.Comment;
                    AmountExpCost."Cost Type" := HourALine."Cost Type";
                    AmountExpCost."Invoice No." := '';
                    AmountExpCost."No." := HourALine."Employee No.";
                    AmountExpCost.Quantity := HourALine."Total Line";
                    AmountExpCost."Direct Unit Cost" := HourALine.Amount;
                    AmountExpCost."Line Amount" := HourALine.Amount;
                    AmountExpCost.INSERT;
                  UNTIL HourALine.NEXT = 0;
                END;
              END;
            END;
          UNTIL JobUnder.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetAndComputeSubPrognosis@1101285001(VAR pJobRec@1101285000 : Record 11072003;PrognosisDate@1101285001 : Date);
    VAR
      lPrognosisLineCC@1101285004 : Record 11128270;
      lPrognosisLine@1101285003 : Record 11012035;
      lJobSetup@1101285013 : Record 315;
      lPrognosisRec@1101285010 : Record 11012034;
      lCostContMgt@1101285009 : Codeunit 11012006;
      lDetermineProgressDate@1101285008 : Codeunit 11012014;
      lDeterminePrognosisDate@1101285007 : Codeunit 11012029;
      lProjFilter@1101285006 : Text[250];
      lPrognEndResVersusContractPr@1101285005 : Decimal;
      lJobSub@1101285002 : Record 11072003;
      lPrognosisSub@1101285011 : Record 11012034;
      lPrognosisLineSubCC@1101285014 : Record 11128270;
      lPrognosisLineSub@1101285012 : Record 11012035;
      lPrognosisPerElement@1100285101 : Record 11071893;
      lPrognosisPerElementSub@1100285102 : Record 11071893;
    BEGIN
      IF (pJobRec."Single/Main/Sub Project" <> pJobRec."Single/Main/Sub Project"::"Main Project") OR (PrognosisDate=0D) THEN
        EXIT;

      lJobSetup.GET;
      IF lPrognosisRec.GET(pJobRec."No.",PrognosisDate) THEN
        lPrognosisRec.DELETE(FALSE);

      CLEAR(lPrognosisRec);
      lPrognosisRec.INIT;
      lPrognosisRec.VALIDATE("Project No.",pJobRec."No.");
      lPrognosisRec.VALIDATE("Prognosis Date",PrognosisDate);
      lPrognosisRec.INSERT(TRUE);

      lPrognosisLine.SETRANGE("Project No.",lPrognosisRec."Project No.");
      lPrognosisLine.SETRANGE("Prognosis Date",lPrognosisRec."Prognosis Date");
      lPrognosisLine.DELETEALL(FALSE);
      lPrognosisLineCC.SETRANGE("Project No.",lPrognosisRec."Project No.");
      lPrognosisLineCC.SETRANGE("Prognosis Date",lPrognosisRec."Prognosis Date");
      lPrognosisLineCC.DELETEALL(FALSE);

      //hitta underprojekt
      lJobSub.COPYFILTERS(pJobRec);
      lJobSub.SETFILTER("No.",'<>%1',pJobRec."No.");
      lJobSub.SETRANGE("Main Project",pJobRec."No.");
      IF lJobSub.FINDSET(FALSE) THEN REPEAT

        lPrognosisSub.SETRANGE("Project No.",lJobSub."No.");
        lPrognosisSub.SETRANGE("Prognosis Date",0D,PrognosisDate);
        IF lPrognosisSub.FINDLAST THEN BEGIN
          lPrognosisRec."Project Invoiced" += lPrognosisSub."Project Invoiced";
          lPrognosisRec."Cost Plus Invoiced" += lPrognosisSub."Cost Plus Invoiced";
          lPrognosisRec."Cost Plus to Invoice" += lPrognosisSub."Cost Plus to Invoice";
          lPrognosisRec."Contract Amount to Invoice" += lPrognosisSub."Contract Amount to Invoice";
          lPrognosisRec."Contract Amount Invoiced" += lPrognosisSub."Contract Amount Invoiced";
          lPrognosisRec."Contract Amount Project" += lPrognosisSub."Contract Amount Project";
          lPrognosisRec."To Invoice Incl Offered Ext." += lPrognosisSub."To Invoice Incl Offered Ext.";
          lPrognosisRec.MODIFY(FALSE);

          lPrognosisLineSub.SETRANGE("Project No.",lPrognosisSub."Project No.");
          lPrognosisLineSub.SETRANGE("Prognosis Date",lPrognosisSub."Prognosis Date");
          IF lPrognosisLineSub.FINDSET(FALSE) THEN REPEAT

            IF NOT lPrognosisLine.GET(lPrognosisRec."Project No.",lPrognosisRec."Prognosis Date",lPrognosisLineSub."Cost Type",
                lPrognosisLineSub.Element,lPrognosisLineSub."Cost Object") THEN BEGIN
              CLEAR(lPrognosisLine);
              lPrognosisLine."Project No." := lPrognosisRec."Project No.";
              lPrognosisLine."Prognosis Date" := lPrognosisRec."Prognosis Date";
              lPrognosisLine."Cost Type" := lPrognosisLineSub."Cost Type";
              lPrognosisLine.Element := lPrognosisLineSub.Element;
              lPrognosisLine."Cost Object" := lPrognosisLineSub."Cost Object";
              lPrognosisLine.INSERT(FALSE);
            END;

            lPrognosisLine.Chapter := lPrognosisLineSub.Chapter;
            lPrognosisLine.Paragraph := lPrognosisLineSub.Paragraph;
            lPrognosisLine."Unit Cost Object" := lPrognosisLineSub."Unit Cost Object";
            lPrognosisLine."Unit of Measure" := lPrognosisLineSub."Unit of Measure";
            lPrognosisLine."Rate Code" := lPrognosisLineSub."Rate Code";
            lPrognosisLine.Rate := lPrognosisLineSub.Rate;
        //    lPrognosisLine."Fix Prognosis Line" += lPrognosisLineSub."Fix Prognosis Line";
        //    lPrognosisLine."Comment" += lPrognosisLineSub."Comment";
            lPrognosisLine."Cost Component" := lPrognosisLineSub."Cost Component";
            lPrognosisLine."Main Project No." := lPrognosisLineSub."Main Project No.";

            lPrognosisLine.Quantity += lPrognosisLineSub.Quantity;
            lPrognosisLine.Price += lPrognosisLineSub.Price;
            lPrognosisLine."Amount incl. Surcharge" += lPrognosisLineSub."Amount incl. Surcharge";
            lPrognosisLine.Amount += lPrognosisLineSub.Amount;
            lPrognosisLine."Ovh. Surcharge" += lPrognosisLineSub."Ovh. Surcharge";
            lPrognosisLine.Level += lPrognosisLineSub.Level;
            lPrognosisLine."Budget Amount" += lPrognosisLineSub."Budget Amount";
            lPrognosisLine."Budget Surcharge Amount" += lPrognosisLineSub."Budget Surcharge Amount";
            lPrognosisLine."Budget Hours" += lPrognosisLineSub."Budget Hours";
            lPrognosisLine."Actual Costs" += lPrognosisLineSub."Actual Costs";
            lPrognosisLine."Actual Hours" += lPrognosisLineSub."Actual Hours";
            lPrognosisLine."Open (Purchase)" += lPrognosisLineSub."Open (Purchase)";
            lPrognosisLine."Received/Not Invoiced" += lPrognosisLineSub."Received/Not Invoiced";
            lPrognosisLine."Open Ovh. Surch. (Purchase)" += lPrognosisLineSub."Open Ovh. Surch. (Purchase)";
            lPrognosisLine."Open Amount (Hours)" += lPrognosisLineSub."Open Amount (Hours)";
            lPrognosisLine."Open Hours" += lPrognosisLineSub."Open Hours";
            lPrognosisLine."Open Ovh. Surch. (Hours)" += lPrognosisLineSub."Open Ovh. Surch. (Hours)";
            lPrognosisLine."Open (Inventory)" += lPrognosisLineSub."Open (Inventory)";
            lPrognosisLine."Open Ovh. Surch. (Inventory)" += lPrognosisLineSub."Open Ovh. Surch. (Inventory)";
            lPrognosisLine."Allowed Costs" += lPrognosisLineSub."Allowed Costs";
            lPrognosisLine."Allowed Hours" += lPrognosisLineSub."Allowed Hours";
            lPrognosisLine."Prognosis End Result" += lPrognosisLineSub."Prognosis End Result";
            lPrognosisLine."Total Cost" += lPrognosisLineSub."Total Cost";
            lPrognosisLine."Total Cost (Excl. Risc Cov.)" += lPrognosisLineSub."Total Cost (Excl. Risc Cov.)";
            lPrognosisLine."Total Hours" += lPrognosisLineSub."Total Hours";
            lPrognosisLine."Prognosis Total Cost" += lPrognosisLineSub."Prognosis Total Cost";
            lPrognosisLine."Prognosis Total Hours" += lPrognosisLineSub."Prognosis Total Hours";
            lPrognosisLine."Prognosis End Result Hours" += lPrognosisLineSub."Prognosis End Result Hours";
            lPrognosisLine."Result Hours" += lPrognosisLineSub."Result Hours";
            lPrognosisLine."Estimated Purchase Result" += lPrognosisLineSub."Estimated Purchase Result";
            lPrognosisLine."Amount Revenue" += lPrognosisLineSub."Amount Revenue";
            lPrognosisLine."Risc Coverage" += lPrognosisLineSub."Risc Coverage";
            lPrognosisLine.Invoiced += lPrognosisLineSub.Invoiced;
            lPrognosisLine."Total Risc Coverage Amount" += lPrognosisLineSub."Total Risc Coverage Amount";
            lPrognosisLine."Total Release Risc Coverage" += lPrognosisLineSub."Total Release Risc Coverage";
            lPrognosisLine."Original Budget Amount" += lPrognosisLineSub."Original Budget Amount";
            lPrognosisLine.Adjustments += lPrognosisLineSub.Adjustments;
            lPrognosisLine.Extension += lPrognosisLineSub.Extension;
            lPrognosisLine.Options += lPrognosisLineSub.Options;
            lPrognosisLine."Purchase Budget" += lPrognosisLineSub."Purchase Budget";
            lPrognosisLine."Purchase Amount" += lPrognosisLineSub."Purchase Amount";
            lPrognosisLine."Purchase Amount (Get Orders)" += lPrognosisLineSub."Purchase Amount (Get Orders)";
            lPrognosisLine."Actual Costs (Purchase Action)" += lPrognosisLineSub."Actual Costs (Purchase Action)";
            lPrognosisLine.MODIFY(FALSE);
          UNTIL lPrognosisLineSub.NEXT=0;

          lPrognosisLineSubCC.SETRANGE("Project No.",lPrognosisSub."Project No.");
          lPrognosisLineSubCC.SETRANGE("Prognosis Date",lPrognosisSub."Prognosis Date");
          IF lPrognosisLineSubCC.FINDSET(FALSE) THEN REPEAT
            IF NOT lPrognosisLineCC.GET(lPrognosisRec."Project No.",lPrognosisRec."Prognosis Date",lPrognosisLineSubCC."Cost Component Code") THEN BEGIN
              CLEAR(lPrognosisLineCC);
              lPrognosisLineCC."Project No." := lPrognosisRec."Project No.";
              lPrognosisLineCC.VALIDATE("Prognosis Date", lPrognosisRec."Prognosis Date");
              lPrognosisLineCC."Cost Component Code" := lPrognosisLineSubCC."Cost Component Code";
              lPrognosisLineCC.INSERT(FALSE);
            END;

            lPrognosisLineCC.Element := lPrognosisLineSubCC.Element;
            lPrognosisLineCC.Level := lPrognosisLineSubCC.Level;
            lPrognosisLineCC.Chapter := lPrognosisLineSubCC.Chapter;
            lPrognosisLineCC.Paragraph := lPrognosisLineSubCC.Paragraph;
            lPrognosisLineCC."Unit Cost Object" := lPrognosisLineSubCC."Unit Cost Object";
            lPrognosisLineCC."Unit of Measure" := lPrognosisLineSubCC."Unit of Measure";
            lPrognosisLineCC."Rate Code" := lPrognosisLineSubCC."Rate Code";
            lPrognosisLineCC.Rate := lPrognosisLineSubCC.Rate;
        //    lPrognosisLineCC."PrevPrognDateFilter" := lPrognosisLineSubCC."PrevPrognDateFilter";
        //    lPrognosisLineCC."Fix Prognosis Line" += lPrognosisLineSubCC."Fix Prognosis Line";
            lPrognosisLineCC."Cost Type" := lPrognosisLineSubCC."Cost Type";
        //    lPrognosisLineCC."Comment" := lPrognosisLineSubCC."Comment";
            lPrognosisLineCC."Main Project No." := lPrognosisLineSubCC."Main Project No.";

            lPrognosisLineCC.Quantity += lPrognosisLineSubCC.Quantity;
            lPrognosisLineCC."Prognosis Hours" += lPrognosisLineSubCC."Prognosis Hours";
            lPrognosisLineCC.Price += lPrognosisLineSubCC.Price;
            lPrognosisLineCC."Amount incl. Surcharge" += lPrognosisLineSubCC."Amount incl. Surcharge";
            lPrognosisLineCC."Prognosis Costs" += lPrognosisLineSubCC."Prognosis Costs";
            lPrognosisLineCC."Ovh. Surcharge" += lPrognosisLineSubCC."Ovh. Surcharge";
            lPrognosisLineCC."Budget Amount" += lPrognosisLineSubCC."Budget Amount";
            lPrognosisLineCC."Budget Surcharge Amount" += lPrognosisLineSubCC."Budget Surcharge Amount";
            lPrognosisLineCC."Budget Hours" += lPrognosisLineSubCC."Budget Hours";
            lPrognosisLineCC."Actual Costs" += lPrognosisLineSubCC."Actual Costs";
            lPrognosisLineCC."Actual Hours" += lPrognosisLineSubCC."Actual Hours";
            lPrognosisLineCC."Open (Purchase)" += lPrognosisLineSubCC."Open (Purchase)";
            lPrognosisLineCC."Received/Not Invoiced" += lPrognosisLineSubCC."Received/Not Invoiced";
            lPrognosisLineCC."Open Ovh. Surch. (Purchase)" += lPrognosisLineSubCC."Open Ovh. Surch. (Purchase)";
            lPrognosisLineCC."Open Amount (Hours)" += lPrognosisLineSubCC."Open Amount (Hours)";
            lPrognosisLineCC."Open Hours" += lPrognosisLineSubCC."Open Hours";
            lPrognosisLineCC."Open Ovh. Surch. (Hours)" += lPrognosisLineSubCC."Open Ovh. Surch. (Hours)";
            lPrognosisLineCC."Open (Inventory)" += lPrognosisLineSubCC."Open (Inventory)";
            lPrognosisLineCC."Open Ovh. Surch. (Inventory)" += lPrognosisLineSubCC."Open Ovh. Surch. (Inventory)";
            lPrognosisLineCC."Allowed Costs" += lPrognosisLineSubCC."Allowed Costs";
            lPrognosisLineCC."Allowed Hours" += lPrognosisLineSubCC."Allowed Hours";
            lPrognosisLineCC."Prognosis End Result" += lPrognosisLineSubCC."Prognosis End Result";
            lPrognosisLineCC."Total Cost" += lPrognosisLineSubCC."Total Cost";
            lPrognosisLineCC."Total Cost (Excl. Risc Cov.)" += lPrognosisLineSubCC."Total Cost (Excl. Risc Cov.)";
            lPrognosisLineCC."Total Hours" += lPrognosisLineSubCC."Total Hours";
            lPrognosisLineCC."Prognosis Total Cost" += lPrognosisLineSubCC."Prognosis Total Cost";
            lPrognosisLineCC."Prognosis Total Hours" += lPrognosisLineSubCC."Prognosis Total Hours";
            lPrognosisLineCC."Prognosis End Result Hours" += lPrognosisLineSubCC."Prognosis End Result Hours";
            lPrognosisLineCC."Result Hours" += lPrognosisLineSubCC."Result Hours";
            lPrognosisLineCC."Estimated Purchase Result" += lPrognosisLineSubCC."Estimated Purchase Result";
            lPrognosisLineCC."Amount Revenue" += lPrognosisLineSubCC."Amount Revenue";
            lPrognosisLineCC."Risc Coverage" += lPrognosisLineSubCC."Risc Coverage";
            lPrognosisLineCC.Invoiced += lPrognosisLineSubCC.Invoiced;
            lPrognosisLineCC."Total Risc Coverage Amount" += lPrognosisLineSubCC."Total Risc Coverage Amount";
            lPrognosisLineCC."Total Release Risc Coverage" += lPrognosisLineSubCC."Total Release Risc Coverage";
            lPrognosisLineCC.Available += lPrognosisLineSubCC.Available;
            lPrognosisLineCC."Available Hours" += lPrognosisLineSubCC."Available Hours";
            lPrognosisLineCC."Actual Revenues" += lPrognosisLineSubCC."Actual Revenues";
            lPrognosisLineCC."Open Revenues" += lPrognosisLineSubCC."Open Revenues";
            lPrognosisLineCC."Expected Revenues Installments" += lPrognosisLineSubCC."Expected Revenues Installments";
            lPrognosisLineCC."Expected Revenues Cost Plus" += lPrognosisLineSubCC."Expected Revenues Cost Plus";
            lPrognosisLineCC."Prognosis Amount Revenue" += lPrognosisLineSubCC."Prognosis Amount Revenue";
            lPrognosisLineCC."Total Revenues" += lPrognosisLineSubCC."Total Revenues";
            lPrognosisLineCC."Prognosis Total Revenues" += lPrognosisLineSubCC."Prognosis Total Revenues";
            lPrognosisLineCC."Open Overhead Surcharge" += lPrognosisLineSubCC."Open Overhead Surcharge";
            lPrognosisLineCC."Overhead Surch. Progn. Costs" += lPrognosisLineSubCC."Overhead Surch. Progn. Costs";
            lPrognosisLineCC.MODIFY(FALSE);
          UNTIL lPrognosisLineSubCC.NEXT=0;

          lPrognosisPerElementSub.SETRANGE("Project No.",lPrognosisSub."Project No.");
          lPrognosisPerElementSub.SETRANGE("Prognosis Date",lPrognosisSub."Prognosis Date");
          IF lPrognosisPerElementSub.FINDSET(FALSE) THEN REPEAT
            IF NOT lPrognosisPerElement.GET(lPrognosisRec."Project No.",lPrognosisRec."Prognosis Date",lPrognosisPerElementSub.Element) THEN BEGIN
              CLEAR(lPrognosisPerElement);
              lPrognosisPerElement."Project No." := lPrognosisRec."Project No.";
              lPrognosisPerElement.VALIDATE("Prognosis Date", lPrognosisRec."Prognosis Date");
              lPrognosisPerElement.Element := lPrognosisPerElementSub.Element;
              lPrognosisPerElement.INSERT(FALSE);
            END;

            lPrognosisPerElement.Level  := lPrognosisPerElementSub.Level;
            lPrognosisPerElement.Chapter  := lPrognosisPerElementSub.Chapter;
            lPrognosisPerElement.Paragraph  := lPrognosisPerElementSub.Paragraph;
            lPrognosisPerElement."Unit of Measure"  := lPrognosisPerElementSub."Unit of Measure";
            // lPrognosisPerElement."Fix Prognosis Line"  := lPrognosisPerElementSub."Fix Prognosis Line";
            // lPrognosisPerElement."Comment"  := lPrognosisPerElementSub."Comment";
            lPrognosisPerElement."Cost Component"  := lPrognosisPerElementSub."Cost Component";
            lPrognosisPerElement."Main Project No."  := lPrognosisPerElementSub."Main Project No.";

            lPrognosisPerElement.Quantity  += lPrognosisPerElementSub.Quantity;
            lPrognosisPerElement.Price  += lPrognosisPerElementSub.Price;
            lPrognosisPerElement."Amount incl. Surcharge"  += lPrognosisPerElementSub."Amount incl. Surcharge";
            lPrognosisPerElement.Amount  += lPrognosisPerElementSub.Amount;
            lPrognosisPerElement."Ovh. Surcharge"  += lPrognosisPerElementSub."Ovh. Surcharge";
            lPrognosisPerElement."Budget Amount"  += lPrognosisPerElementSub."Budget Amount";
            lPrognosisPerElement."Budget Surcharge Amount"  += lPrognosisPerElementSub."Budget Surcharge Amount";
            lPrognosisPerElement."Actual Costs"  += lPrognosisPerElementSub."Actual Costs";
            lPrognosisPerElement."Open (Purchase)"  += lPrognosisPerElementSub."Open (Purchase)";
            lPrognosisPerElement."Received/Not Invoiced"  += lPrognosisPerElementSub."Received/Not Invoiced";
            lPrognosisPerElement."Open Ovh. Surch. (Purchase)"  += lPrognosisPerElementSub."Open Ovh. Surch. (Purchase)";
            lPrognosisPerElement."Open (Inventory)"  += lPrognosisPerElementSub."Open (Inventory)";
            lPrognosisPerElement."Open Ovh. Surch. (Inventory)"  += lPrognosisPerElementSub."Open Ovh. Surch. (Inventory)";
            lPrognosisPerElement."Allowed Costs"  += lPrognosisPerElementSub."Allowed Costs";
            lPrognosisPerElement."Prognosis End Result"  += lPrognosisPerElementSub."Prognosis End Result";
            lPrognosisPerElement."Total Cost"  += lPrognosisPerElementSub."Total Cost";
            lPrognosisPerElement."Total Cost (Excl. Risc Cov.)"  += lPrognosisPerElementSub."Total Cost (Excl. Risc Cov.)";
            lPrognosisPerElement."Prognosis Total Cost"  += lPrognosisPerElementSub."Prognosis Total Cost";
            lPrognosisPerElement."Estimated Purchase Result"  += lPrognosisPerElementSub."Estimated Purchase Result";
            lPrognosisPerElement."Risc Coverage"  += lPrognosisPerElementSub."Risc Coverage";
            lPrognosisPerElement.Invoiced  += lPrognosisPerElementSub.Invoiced;
            lPrognosisPerElement."Total Risc Coverage Amount"  += lPrognosisPerElementSub."Total Risc Coverage Amount";
            lPrognosisPerElement."Total Release Risc Coverage"  += lPrognosisPerElementSub."Total Release Risc Coverage";
            lPrognosisPerElement."Best Case Result"  += lPrognosisPerElementSub."Best Case Result";
            lPrognosisPerElement."Worst Case Result"  += lPrognosisPerElementSub."Worst Case Result";
            lPrognosisPerElement.MODIFY(FALSE);
          UNTIL lPrognosisPerElementSub.NEXT=0;

        END;
      UNTIL lJobSub.NEXT = 0;
    END;

    PROCEDURE GetLastSubPrognosisDate@1100285104(lJob@1100285104 : Record 11072003) : Date;
    VAR
      lPrognosis@1100285103 : Record 11012034;
      DeterminePrognosisDate@1100285102 : Codeunit 11012029;
      ProjectDetails@1100285101 : Codeunit 11128091;
      EndDate@1100285100 : Date;
    BEGIN
      IF (lJob."Single/Main/Sub Project" <> lJob."Single/Main/Sub Project"::"Main Project") THEN
        EXIT(0D);

      lPrognosis.SETFILTER("Project No.",'<>%1',lJob."No.");
      lPrognosis.SETRANGE("Main Project No.",lJob."No.");
      lPrognosis.SETRANGE("Prognosis Date",0D,WORKDATE);
      EndDate:=0D;
      IF lPrognosis.FINDSET(FALSE) THEN REPEAT
        IF lPrognosis."Prognosis Date">EndDate THEN BEGIN
          EndDate := lPrognosis."Prognosis Date";
        END;
      UNTIL lPrognosis.NEXT=0;
      EXIT(EndDate);
    END;

    PROCEDURE ShowThousands@1100583000(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      SESetup@1100583000 : Record 11128004;
    BEGIN
      //>>190314 ORANGO.SB Feature #22824/BYGG001_9
      SESetup.SETRANGE("Line type",SESetup."Line type"::Setup);
      SESetup.SETRANGE(Code,'PROJDETAIL');
      SESetup.SETRANGE("Code 2",'SHOWTHOUSANDS');
      IF (SESetup.FINDFIRST) AND (SESetup."Value (bool)") THEN BEGIN
        ProjDetail.SETRANGE(UserID,UserId);
        ProjDetail.SETRANGE("Project No.",ProjNo);
        ProjDetail.SETRANGE("Sum Quantity",FALSE);
        IF ProjDetail.FIND('-') THEN BEGIN
          REPEAT
            ProjDetail."Budget Amount" := ProjDetail."Budget Amount"/1000;
            ProjDetail."GL Amount":=ProjDetail."GL Amount"/1000;
            ProjDetail."Prognosis Amount" := ProjDetail."Prognosis Amount"/1000;
            ProjDetail."New Prognosis Amount":=ProjDetail."New Prognosis Amount"/1000;
            ProjDetail."Original Budget" := ProjDetail."Original Budget"/1000;
            ProjDetail."Budget adjustment" := ProjDetail."Budget adjustment" /1000;
            ProjDetail."Budget Extension Contract" := ProjDetail."Budget Extension Contract"/1000;
            ProjDetail."First prognosis" := ProjDetail."First prognosis"/1000;
            ProjDetail."Prognosis (last preclosure)" := ProjDetail."Prognosis (last preclosure)"/1000;
            ProjDetail."Open Amount (Hours)" := ProjDetail."Open Amount (Hours)"/1000;
            IF FromUpdate THEN
              ProjDetail."GL Amount Period" := ProjDetail."GL Amount Period"/1000;
            ProjDetail."Expected Cost" := ProjDetail."Expected Cost"/1000;
            ProjDetail."Prognosis Amount (rem tot)" := ProjDetail."Prognosis Amount (rem tot)" /1000;
            ProjDetail."Locked GL Amount" := ProjDetail."Locked GL Amount" /1000;
            IF (ProjDetail."Cost Type"<>ProjDetail."Cost Type"::Revenue) AND (ProgBudget) THEN BEGIN
              ProjDetail."Prognosis Budget Line" := ProjDetail."Prognosis Budget Line" /1000;
              ProjDetail."New Prognosis Amount (rem)" := ProjDetail."New Prognosis Amount (rem)" /1000;
            END;
            ProjDetail.MODIFY;
          UNTIL ProjDetail.NEXT = 0;
        END;
      END;
      //<<
    END;

    PROCEDURE GetGLEntrysLocked@1100583001(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];PosFilter@1101285000 : Code[10]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      GSum@1100285004 : Decimal;
      AFilt1@1100285005 : Code[10];
      AFilt2@1100285006 : Code[10];
      AFilt3@1100285007 : Code[10];
      AFilt4@1100285008 : Code[10];
      AFilt5@1100285009 : Code[10];
      Strangen@1100285010 : Text[50];
      AFilt6@1100285100 : Code[10];
      AFilt7@1100285101 : Code[10];
      AFilt8@1100285103 : Code[10];
      AFilt9@1100285102 : Code[10];
      JLE@1100285104 : Record 11072005;
      Job@1100285105 : Record 11072003;
      ProjectDetailLockedAmount@1100583000 : Record 11128112;
    BEGIN
      IF NOT ProjectDetailLockedAmount.GET(ProjNo) THEN
        EXIT;

      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          JLE.SETFILTER("Entry No.",'..%1',ProjectDetailLockedAmount."Last Entry No");
          JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
            JLE.SETRANGE(Element, PosFilter);
          //<<

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."Locked GL Amount" := GSum;
          //ORANGO.EE 190527
          ProjDetail."Prognosis Amount (rem tot)" := ProjDetail."Locked GL Amount" + ProjDetail."Prognosis Budget Line";
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;

      CLEAR(ProjDetail);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);
          JLE.SETFILTER("Entry No.",'..%1',ProjectDetailLockedAmount."Last Entry No");
          JLE.SETRANGE("Cost Component",ProjDetail."Cost Component Code");

          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
            JLE.SETRANGE(Element, PosFilter);
          //<<

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."Locked GL Amount" := GSum;
          //190527 ORANGO.EE
          ProjDetail."New Prognosis Amount (rem)" := ProjDetail."Locked GL Amount" + ProjDetail."Prognosis Budget Line";
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetGLEntrysLockedFiltered@1101285013(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];EntryNo@1101285000 : Integer);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      GSum@1100285004 : Decimal;
      AFilt1@1100285005 : Code[10];
      AFilt2@1100285006 : Code[10];
      AFilt3@1100285007 : Code[10];
      AFilt4@1100285008 : Code[10];
      AFilt5@1100285009 : Code[10];
      Strangen@1100285010 : Text[50];
      AFilt6@1100285100 : Code[10];
      AFilt7@1100285101 : Code[10];
      AFilt8@1100285103 : Code[10];
      AFilt9@1100285102 : Code[10];
      JLE@1100285104 : Record 11072005;
      Job@1100285105 : Record 11072003;
      ProjectDetailLockedAmount@1100583000 : Record 11128112;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          JLE.SETFILTER("Entry No.",'..%1',EntryNo);
          JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."Locked GL Amount" := GSum;
          //190527 ORANGO.EE
          ProjDetail."New Prognosis Amount (rem)" := ProjDetail."Locked GL Amount" + ProjDetail."Prognosis Budget Line";
          ProjDetail.MODIFY(TRUE);
        UNTIL ProjDetail.NEXT = 0;
      END;

      CLEAR(ProjDetail);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);
          JLE.SETFILTER("Entry No.",'..%1', EntryNo);
          JLE.SETRANGE("Cost Component",ProjDetail."Cost Component Code");

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."Locked GL Amount" := GSum;
          ProjDetail.MODIFY(TRUE);
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetOpenPurchase@1000000001(UserId@1000000001 : Code[50];ProjNo@1000000000 : Code[20]);
    VAR
      PurchLine@1000000002 : Record 39;
      PSum@1000000003 : Decimal;
      ProjDetail@1000000004 : Record 11128083;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        PSum := 0;
        REPEAT
          PurchLine.SETCURRENTKEY("Job No.","Shortcut Dimension 2 Code");
          PurchLine.SETRANGE("Document Type",PurchLine."Document Type"::Order);
          PurchLine.SETRANGE("Job No.",ProjNo);
          PurchLine.SETRANGE("Shortcut Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          IF PurchLine.FIND('-') THEN BEGIN
            REPEAT
              PSum := PSum + PurchLine."Direct Unit Cost";
            UNTIL PurchLine.NEXT = 0;
            ProjDetail."Open Purchase" := PSum;
            ProjDetail.MODIFY;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE SetPrognosisBudgetRemaining@1100583002(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      PL@1100285003 : Record 11012035;
      PSum@1100285004 : Decimal;
      Prognosis@1100285005 : Record 11012034;
      ProjectPreclosureResult@1100285100 : Record 11012093;
      Job@1100285101 : Record 11072003;
      Amount@1100583000 : Decimal;
      BudgetLine@1101285000 : Record 11012001;
      MgtProjectDetails@1101285001 : Codeunit 11128091;
    BEGIN
      IF Job.GET(ProjNo) THEN BEGIN

      //190627 ORANGO.EE >>
      IF Job."Prognosis Budget Line" THEN BEGIN
        BudgetLine.SETRANGE("Project No.", Job."No.");
        IF BudgetLine.FIND('-') THEN REPEAT
          BudgetLine."New prognosis amount" := BudgetLine."Amount (LCY)";
          BudgetLine.MODIFY;
        UNTIL BudgetLine.NEXT = 0;
        MgtProjectDetails.GetBudgetLines(UserId,ProjNo,'');
        MgtProjectDetails.BudgetContract(UserId, ProjNo);
        MgtProjectDetails.SumProjDetail(UserId,ProjNo);
        MgtProjectDetails.CodeLines(UserId, ProjNo);
        MgtProjectDetails.TotalLines(UserId, ProjNo);

        END ELSE BEGIN
      //<<


          IF Job."Forecast Level"=Job."Forecast Level"::"Cost Object" THEN BEGIN
            ProjDetail.SETRANGE(UserID,UserId);
            ProjDetail.SETRANGE("Project No.",ProjNo);
            ProjDetail.SETRANGE("Code line",FALSE);
            ProjDetail.SETRANGE("Sum Line",FALSE);
            ProjDetail.SETFILTER("Budget Amount", '<>%1', 0);
            ProjDetail.SETFILTER("Prognosis Cost Object",'<>%1','');
            IF ProjDetail.FIND('-') THEN BEGIN
              REPEAT
                  ProjDetail.VALIDATE("Prognosis Budget Line", (ProjDetail."Budget Amount" - ProjDetail."GL Amount"));
                  //ProjDetail."Prognosis Budget Line":= (ProjDetail."Budget Amount" - ProjDetail."GL Amount");
                  ProjDetail.MODIFY;
              UNTIL ProjDetail.NEXT = 0;
              ProjDetail.VALIDATE("Prognosis Budget Line")
            END;
          END ELSE IF Job."Forecast Level"=Job."Forecast Level"::"Cost Component" THEN BEGIN
            ProjDetail.SETRANGE(UserID,UserId);
            ProjDetail.SETRANGE("Project No.",ProjNo);
            ProjDetail.SETRANGE("Code line",FALSE);
            ProjDetail.SETRANGE("Sum Line",FALSE);
            ProjDetail.SETFILTER("Budget Amount", '<>%1', 0);
            ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
            IF ProjDetail.FIND('-') THEN BEGIN
              REPEAT
                  ProjDetail.VALIDATE("Prognosis Budget Line", (ProjDetail."Budget Amount" - ProjDetail."GL Amount"));
                  //ProjDetail."Prognosis Budget Line":= (ProjDetail."Budget Amount" - ProjDetail."GL Amount");
                  ProjDetail.MODIFY;
              UNTIL ProjDetail.NEXT = 0;
              ProjDetail.VALIDATE("Prognosis Budget Line");
            END;
          END;

        END;
      END;
    END;

    PROCEDURE SetPrognosisBudget@1100583003(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      PL@1100285003 : Record 11012035;
      PSum@1100285004 : Decimal;
      Prognosis@1100285005 : Record 11012034;
      ProjectPreclosureResult@1100285100 : Record 11012093;
      Job@1100285101 : Record 11072003;
    BEGIN
      IF Job.GET(ProjNo) THEN BEGIN
        IF Job."Forecast Level"=Job."Forecast Level"::"Cost Object" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Prognosis Cost Object",'<>%1','');
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
                ProjDetail.VALIDATE("New Prognosis Amount",ProjDetail."Budget Amount");
                ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
          END;
        END ELSE IF Job."Forecast Level"=Job."Forecast Level"::"Cost Component" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
                ProjDetail.VALIDATE("New Prognosis Amount",ProjDetail."Budget Amount");
                ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
          END;

        END;
      END;
    END;

    PROCEDURE SetPrognosisAccRemaining@1101285003(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      PL@1100285003 : Record 11012035;
      PSum@1100285004 : Decimal;
      Prognosis@1100285005 : Record 11012034;
      ProjectPreclosureResult@1100285100 : Record 11012093;
      Job@1100285101 : Record 11072003;
    BEGIN
      IF Job.GET(ProjNo) THEN BEGIN
        IF Job."Forecast Level"=Job."Forecast Level"::"Cost Object" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Prognosis Cost Object",'<>%1','');
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
                ProjDetail.VALIDATE("Prognosis Budget Line", (ProjDetail."GL Amount" - ProjDetail."Locked GL Amount"));
                ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
          END;
        END ELSE IF Job."Forecast Level"=Job."Forecast Level"::"Cost Component" THEN BEGIN
          ProjDetail.SETRANGE(UserID,UserId);
          ProjDetail.SETRANGE("Project No.",ProjNo);
          ProjDetail.SETRANGE("Code line",FALSE);
          ProjDetail.SETRANGE("Sum Line",FALSE);
          ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
          IF ProjDetail.FIND('-') THEN BEGIN
            REPEAT
                ProjDetail.VALIDATE("Prognosis Budget Line", (ProjDetail."GL Amount" - ProjDetail."Locked GL Amount"));
                ProjDetail.MODIFY;
            UNTIL ProjDetail.NEXT = 0;
          END;

        END;
      END;
    END;

    PROCEDURE SaveValues@1101285002(UserId@1101285001 : Code[50];ProjNo@1101285000 : Code[20]);
    VAR
      ProjDetail@1101285003 : Record 11128083;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          tProjDetail.UserID := ProjDetail.UserID;
          tProjDetail."Project No." := ProjDetail."Project No.";
          tProjDetail."Line No." := ProjDetail."Line No.";
          tProjDetail."Other Description" := ProjDetail."Other Description";
          tProjDetail."Cost Type" := ProjDetail."Cost Type";
          IF ProjDetail."Cost Type" = ProjDetail."Cost Type"::Revenue THEN
            tProjDetail."Prognosis Budget Line" := ProjDetail."Prognosis Budget Line";
          tProjDetail.INSERT;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetSavedValues@1101285004(UserId@1101285001 : Code[50];ProjNo@1101285000 : Code[20]);
    VAR
      ProjDetail@1101285002 : Record 11128083;
      ProjDetail2@1101285003 : Record 11128083;
      ProjDetail3@1101285004 : Record 11128083;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          CLEAR(tProjDetail);
          CLEAR(ProjDetail2);
          CLEAR(ProjDetail3);

          tProjDetail.SETRANGE(UserID,ProjDetail.UserID);
          tProjDetail.SETRANGE("Project No.",ProjDetail."Project No.");
          tProjDetail.SETRANGE("Line No.",ProjDetail."Line No.");
          IF tProjDetail.FIND('-') THEN
            ProjDetail."Other Description" := tProjDetail."Other Description";

          IF  tProjDetail."Cost Type" = tProjDetail."Cost Type" THEN
            ProjDetail."Prognosis Budget Line" := tProjDetail."Prognosis Budget Line";

          //200116 ORANGO.EE #27223 >>
          IF ProjDetail2.GET('TEMPLATE',ProjDetail."Project No.",ProjDetail."Line No.") THEN BEGIN
          ProjDetail."Other Description" := ProjDetail2."Other Description";

            IF ProjDetail2."Cost Type" = ProjDetail2."Cost Type"::Revenue THEN
            ProjDetail."Prognosis Budget Line" := ProjDetail2."Prognosis Budget Line";
            //<<
          END;

          ProjDetail.MODIFY;
          UNTIL ProjDetail.NEXT = 0;
        END;
    END;

    PROCEDURE SetPeriodFilter@1100583004(VAR PeriodIn@1100583000 : Text[50]);
    BEGIN
      PeriodFilter := PeriodIn;
    END;

    PROCEDURE ShowPostedExfPurchaseInvoices@1100525027(ProjectNo@1100525000 : Code[20]);
    VAR
      TempPurchInvHeader@1100285101 : TEMPORARY Record 122;
      PurchInvHeader@1100525001 : Record 122;
      DocumentLink@1101285000 : Record 11012747;
      ExDoc2@1101285002 : Record 12013612;
      EXPostedDocument@1100583000 : Record 12013626;
      JobLedgerEntry@1100285100 : Record 11072005;
      PurchCrMemoHdr@1100285102 : Record 124;
      SourceCodeSetup@1100285103 : Record 242;
    BEGIN
      //191209
      IF ProjectNo = '' THEN
        EXIT;

      SourceCodeSetup.GET;

      JobLedgerEntry.SETCURRENTKEY("Job No.");
      JobLedgerEntry.SETRANGE("Job No.",ProjectNo);
      JobLedgerEntry.SETRANGE("Source Code",SourceCodeSetup.Purchases);
      IF JobLedgerEntry.FINDSET(FALSE) THEN REPEAT
        IF NOT TempPurchInvHeader.GET(JobLedgerEntry."Document No.") THEN BEGIN
          TempPurchInvHeader."No." := JobLedgerEntry."Document No.";
          TempPurchInvHeader.INSERT;
          IF PurchInvHeader.GET(JobLedgerEntry."Document No.") THEN
            PurchInvHeader.MARK(TRUE);
          IF PurchCrMemoHdr.GET(JobLedgerEntry."Document No.") THEN
            PurchCrMemoHdr.MARK(TRUE);
        END;
      UNTIL JobLedgerEntry.NEXT=0;

      PurchInvHeader.MARKEDONLY(TRUE);
      IF PurchInvHeader.FINDSET(FALSE) THEN REPEAT
        IF ExDoc2.RetrieveRecord(ExDoc2,ExDoc2."Document Type"::"Posted Invoice",PurchInvHeader."No.") THEN
          IF (STRPOS(UPPERCASE(ExDoc2."Image Name"),'PDF') <> 0) THEN BEGIN
            IF ExDoc2."Image Blob".HASVALUE THEN BEGIN
              ExDoc2.MARK(TRUE);
            END ELSE
              IF GetImageFileName(ExDoc2) THEN
                ExDoc2.MARK(TRUE);
            IF ExDoc2.MARK THEN BEGIN
              EXPostedDocument.SETRANGE("Document Type",ExDoc2."Document Type");
              EXPostedDocument.SETRANGE("Document No.",ExDoc2."Document No.");
              IF EXPostedDocument.FINDSET(FALSE) THEN REPEAT
                EXPostedDocument.MARK(TRUE);
              UNTIL EXPostedDocument.NEXT=0;
            END;
          END;
      UNTIL PurchInvHeader.NEXT=0;

      PurchCrMemoHdr.MARKEDONLY(TRUE);
      IF PurchCrMemoHdr.FINDSET(FALSE) THEN REPEAT
        IF ExDoc2.RetrieveRecord(ExDoc2,ExDoc2."Document Type"::"Posted Credit Memo",PurchCrMemoHdr."No.") THEN
          IF (STRPOS(UPPERCASE(ExDoc2."Image Name"),'PDF') <> 0) THEN BEGIN
            IF ExDoc2."Image Blob".HASVALUE THEN BEGIN
              ExDoc2.MARK(TRUE);
            END ELSE
              IF GetImageFileName(ExDoc2) THEN
                ExDoc2.MARK(TRUE);
            IF ExDoc2.MARK THEN BEGIN
              EXPostedDocument.SETRANGE("Document Type",ExDoc2."Document Type");
              EXPostedDocument.SETRANGE("Document No.",ExDoc2."Document No.");
              IF EXPostedDocument.FINDSET(FALSE) THEN REPEAT
                EXPostedDocument.MARK(TRUE);
              UNTIL EXPostedDocument.NEXT=0;
            END;
          END;
      UNTIL PurchCrMemoHdr.NEXT=0;

      EXPostedDocument.SETRANGE("Document Type");
      EXPostedDocument.SETRANGE("Document No.");

      EXPostedDocument.MARKEDONLY(TRUE);
      PAGE.RUNMODAL(11128132,EXPostedDocument);
    END;

    LOCAL PROCEDURE GetImageFileName@1101285005(VAR ExDoc2@1100583001 : Record 12013612) : Boolean;
    VAR
      ExFlowSetup@1100583004 : Record 12013601;
      FileManagement@1100583003 : Codeunit 419;
      TempFileName@1100583002 : Text;
    BEGIN
      //191209
      ExFlowSetup.GET;
      IF ExFlowSetup."Path to Used Invoices" = '' THEN
        EXIT(FALSE);

      TempFileName := ExFlowSetup."Path to Used Invoices" + ExDoc2."Image Name";

      IF FileManagement.ServerFileExists(TempFileName) THEN
        EXIT(TRUE)
      ELSE
        IF FileManagement.ClientFileExists(TempFileName) THEN
          EXIT(TRUE);
      EXIT(FALSE);
    END;

    PROCEDURE GetTargetBudget@1101285008(UserId@1101285001 : Code[50];ProjNo@1101285000 : Code[20]);
    VAR
      ProjDetail@1101285002 : Record 11128083;
      TargetBudget@1101285003 : Record 11128036;
      TargetBudgetSum@1101285004 : Decimal;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          TargetBudgetSum := 0;
          TargetBudget.SETCURRENTKEY("Project No.", "Cost Object");
          TargetBudget.SETRANGE("Project No.", ProjNo);
          TargetBudget.SETRANGE("Cost Object", ProjDetail."GL Entry Cost Object");
          IF TargetBudget.FIND('-') THEN BEGIN
            REPEAT
              TargetBudgetSum += TargetBudget.Amount;
            UNTIL TargetBudget.NEXT = 0;
            ProjDetail."Target Budget" := TargetBudgetSum;
            ProjDetail.MODIFY;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetOpenPurchaseNotRecieved@1100285105(UserId@1000000001 : Code[50];ProjNo@1000000000 : Code[20]);
    VAR
      PurchLine@1000000002 : Record 39;
      PSum@1000000003 : Decimal;
      ProjDetail@1000000004 : Record 11128083;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        PSum := 0;
        REPEAT
          PurchLine.SETCURRENTKEY("Job No.","Shortcut Dimension 2 Code");
          PurchLine.SETRANGE("Document Type",PurchLine."Document Type"::Order);
          PurchLine.SETRANGE("Job No.",ProjNo);
          PurchLine.SETRANGE("Shortcut Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          IF PurchLine.FIND('-') THEN BEGIN
            REPEAT
              PSum := PSum + (PurchLine."Amount (LCY)" - PurchLine."Amnt. Received");
            UNTIL PurchLine.NEXT = 0;
            ProjDetail."Open Purchase Orders" := PSum;
            ProjDetail.MODIFY;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetPurchaseRecievedNotInvoiced@1100285109(UserId@1000000001 : Code[50];ProjNo@1000000000 : Code[20]);
    VAR
      PurchLine@1000000002 : Record 39;
      PSum@1000000003 : Decimal;
      ProjDetail@1000000004 : Record 11128083;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        PSum := 0;
        REPEAT
          PurchLine.SETCURRENTKEY("Job No.","Shortcut Dimension 2 Code");
          PurchLine.SETRANGE("Document Type",PurchLine."Document Type"::Order);
          PurchLine.SETRANGE("Job No.",ProjNo);
          PurchLine.SETRANGE("Shortcut Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          IF PurchLine.FIND('-') THEN BEGIN
            REPEAT
              PSum := PSum + (PurchLine."Amnt. Received" - PurchLine."Amnt. Invoiced");
            UNTIL PurchLine.NEXT = 0;
            ProjDetail."Recieved Not Invoiced" := PSum;
            ProjDetail.MODIFY;
          END;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE GetGLEntriesExtension@1100285107(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20];PosFilter@1101285000 : Code[10]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
      GSum@1100285004 : Decimal;
      AFilt1@1100285005 : Code[10];
      AFilt2@1100285006 : Code[10];
      AFilt3@1100285007 : Code[10];
      AFilt4@1100285008 : Code[10];
      AFilt5@1100285009 : Code[10];
      Strangen@1100285010 : Text[50];
      AFilt6@1100285100 : Code[10];
      AFilt7@1100285101 : Code[10];
      AFilt8@1100285103 : Code[10];
      AFilt9@1100285102 : Code[10];
      JLE@1100285104 : Record 11072005;
      Job@1100285105 : Record 11072003;
    BEGIN
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
          JLE.SETRANGE(Element,PosFilter);
          //<<
          JLE.SETFILTER("Extension Contract", '<>%1', '');
          JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");

          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)"+JLE."Total Price (LCY)"; //>> 171201 ITERO.SB Added Total price in calc (C4)
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."Extension GL Amount" := GSum;
          //190527 ORANGO.EE
          //ProjDetail."Prognosis Amount (rem tot)" := ProjDetail."Locked GL Amount" + ProjDetail."Prognosis Budget Line";
          //ProjDetail."Prognosis Amount (rem tot)" := GSum + ProjDetail."New Prognosis Amount (rem)";
          {IF (ProjDetail."Cost Type" = ProjDetail."Cost Type"::Revenue) OR (NOT ProgBudget) THEN
            ProjDetail."Prognosis Amount (rem tot)" := GSum + (ProjDetail."New Prognosis Amount (rem)"*1000);
            }
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;

      CLEAR(ProjDetail);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.SETRANGE("Code line",FALSE);
      ProjDetail.SETRANGE("Sum Line",FALSE);
      //ProjDetail.SETFILTER("GL Entry Cost Object",'<>%1','');
      ProjDetail.SETFILTER("Cost Component Code",'<>%1','');
      IF ProjDetail.FIND('-') THEN BEGIN
        REPEAT
          GSum := 0;
          CLEAR(JLE);
          JLE.SETCURRENTKEY("Job No.","Posting Date");
          //JLE.SETRANGE("Job No.",ProjNo);

          Job.GET(ProjNo);
          IF Job."Single/Main/Sub Project"=Job."Single/Main/Sub Project"::"Main Project" THEN
            JLE.SETRANGE("Main Project No.",ProjNo)
          ELSE
            JLE.SETRANGE("Job No.",ProjNo);

          //190607 ORANGO.EE BYGG >>
          IF PosFilter <> '' THEN
          JLE.SETRANGE(Element,PosFilter);
          //<<
          JLE.SETFILTER("Extension Contract", '<>%1', '');

          //JLE.SETRANGE("Global Dimension 2 Code",ProjDetail."GL Entry Cost Object");
          JLE.SETRANGE("Cost Component",ProjDetail."Cost Component Code");
          JLE.CALCSUMS(Quantity,"Total Cost (LCY)","Total Price (LCY)");
          IF ProjDetail."Sum Amount" THEN BEGIN
            IF ProjDetail."Cost Type"=ProjDetail."Cost Type"::Revenue THEN
              GSum := JLE."Total Price (LCY)"
            ELSE
              GSum := JLE."Total Cost (LCY)";
          END ELSE IF ProjDetail."Sum Quantity" THEN
                GSum := JLE.Quantity;

          IF ProjDetail."Switch Sign" THEN
            GSum:=GSum*-1;

          ProjDetail."Extension GL Amount" := GSum;
          //190527 ORANGO.EE
          //ProjDetail."Prognosis Amount (rem tot)" := GSum + ProjDetail."New Prognosis Amount (rem)";;
          ProjDetail.MODIFY;
        UNTIL ProjDetail.NEXT = 0;
      END;
    END;

    PROCEDURE MgtProjDetailSelectedValues@1100285106(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      Period@1100285100 : Text;
      ProjDetail@1100285101 : Record 11128083;
      startDT@1100285104 : DateTime;
      startstartDT@1100285105 : DateTime;
      SetupProjectDetails@1100285102 : Record 11128600;
    BEGIN
      useLogging := FALSE;//(COPYSTR(UserId,1,5) IN ['DECID','ITERO']);
      startDT := CURRENTDATETIME;startstartDT:=startDT;
      //190927 ORANGO.EE #24023
      SaveValues(UserId,ProjNo);
      DeleteProjDetail(UserId,ProjNo);            LogDuration(tabErrorLogTEMP,startDT,'DeleteProjDetail');
      CreateProjDetail(ProjDetail,UserId,ProjNo); LogDuration(tabErrorLogTEMP,startDT,'CreateProjDetail');
      //191107 ORANGO.EE
      GetSavedValues(UserId,ProjNo);
      //

      IF SetupProjectDetails.GET('5') THEN
        IF SetupProjectDetails.Activated = TRUE THEN BEGIN
          GetBudgetLines(UserId,ProjNo,'');              LogDuration(tabErrorLogTEMP,startDT,'GetBudgetLines');
          BudgetContract(UserId,ProjNo);              LogDuration(tabErrorLogTEMP,startDT,'BudgetContract');
        END;

      IF SetupProjectDetails.GET('6') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetGLEntrys(UserId,ProjNo,'');                 LogDuration(tabErrorLogTEMP,startDT,'GetGLEntrys');

      IF SetupProjectDetails.GET('11012241') THEN
        IF SetupProjectDetails.Activated = TRUE THEN BEGIN
        Period := FORMAT(DMY2DATE(1,DATE2DMY(WORKDATE,2),DATE2DMY(WORKDATE,3))) + '..' + FORMAT(CALCDATE('<CM>',WORKDATE));
        LogDuration(tabErrorLogTEMP,startDT,'CreatePeriod');
        GetGLEntrysPeriod(UserId,ProjNo,Period,'');    LogDuration(tabErrorLogTEMP,startDT,'GetGLEntrysPeriod');
      END;

      IF SetupProjectDetails.GET('11012246') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetGLEntrysLocked(UserId,ProjNo,'');           LogDuration(tabErrorLogTEMP,startDT,'GetGLEntrysLocked');

      IF SetupProjectDetails.GET('7') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetPrognosisLine(UserId,ProjNo,'');            LogDuration(tabErrorLogTEMP,startDT,'GetPrognosisLine');

      IF SetupProjectDetails.GET('11012242') THEN
        IF SetupProjectDetails.Activated = TRUE THEN BEGIN
          GetExFlowLines(UserId,ProjNo);              LogDuration(tabErrorLogTEMP,startDT,'GetExFlowLines');
          GetExFlowLinesUnderProject(UserId,ProjNo);  LogDuration(tabErrorLogTEMP,startDT,'GetExFlowLinesUnderProject');
        END;

      IF SetupProjectDetails.GET('11012248') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetOpenPurchase(UserId,ProjNo);             LogDuration(tabErrorLogTEMP,startDT,'GetOpenPurchase');
      //200120 ORANGO.EE BYGG #27258

      IF SetupProjectDetails.GET('11012250') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetTargetBudget(UserId, ProjNo);
      //200416 ORANGO.EE CERTEGO >>

      IF SetupProjectDetails.GET('11012252') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetPurchaseRecievedNotInvoiced(UserId, ProjNo);

      IF SetupProjectDetails.GET('11012251') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetOpenPurchaseNotRecieved(UserId,ProjNo);

      IF SetupProjectDetails.GET('11012253') THEN
        IF SetupProjectDetails.Activated = TRUE THEN
      GetGLEntriesExtension(UserId, ProjNo,'');

      //<<
      SumProjDetail(UserId,ProjNo);               LogDuration(tabErrorLogTEMP,startDT,'SumProjDetail');
      OverheadCost(UserId,ProjNo);                LogDuration(tabErrorLogTEMP,startDT,'OverheadCost');
      CodeLines(UserId,ProjNo);                   LogDuration(tabErrorLogTEMP,startDT,'CodeLines');

      UpdateJobHours(UserId,ProjNo);              LogDuration(tabErrorLogTEMP,startDT,'UpdateJobHours');
      TotalLines(UserId,ProjNo);                  LogDuration(tabErrorLogTEMP,startDT,'TotalLines');
      ShowThousands(UserId,ProjNo);               LogDuration(tabErrorLogTEMP,startDT,'ShowThousands');LogDuration(tabErrorLogTEMP,startstartDT,'GrandTotal');
      ShowProjDetailPageSelectedValues(UserId,ProjNo);          //LogDuration(tabErrorLogTEMP,startDT,'ShowProjDetailPage');

      IF useLogging AND NOT tabErrorLogTEMP.ISEMPTY THEN
        PAGE.RUN(PAGE::"Error Log Work Schedule",tabErrorLogTEMP);
    END;

    PROCEDURE ShowProjDetailPageSelectedValues@1100285110(UserId@1100285001 : Code[50];ProjNo@1100285000 : Code[20]);
    VAR
      ProjDetail@1100285002 : Record 11128083;
    BEGIN
      COMMIT;
      //>> 170905 ITERO.SB
      ProjDetail.FILTERGROUP(26);
      ProjDetail.SETRANGE(UserID,UserId);
      ProjDetail.SETRANGE("Project No.",ProjNo);
      ProjDetail.FILTERGROUP(0);
      //<<
      IF ProjDetail.FIND('-') THEN
        PAGE.RUNMODAL(PAGE::"Project Details New", ProjDetail);
    END;

    BEGIN
    {
      151110 ITERO.WG Changed length of USERID from 20 to 50
      160921 ITERO.PR New funktion GetExFlowLines
      160921 ITERO.SB RAD-029, RAD-030, RAD-030
          161206 ITERO.DL RFC157, 2 new columns
      170111 ITERO.PR Sum Expected Cost
      170421 ITERO.SB RFC-214 Use "Prognosis Total Hours" instead of "Quantity"
      170425 ITERO.SB RFC-101.2 Added function GetGLEntrysPeriod
      170524 RFC-229 Fix
      170925 ITERO.SB TS003 Sum prognosis on main project level
      170926 ITERO.SB REK001 Create setup for option to fill new prognosis
      170905 ITERO.SB Added filtergroup
      171122 ITERO.SB
      171201 ITERO.SB Added Total price in calculation
      171213 ITERO.SB Handle Budget Extension contract
      180123 ITERO.DL CreateProjDetail from a template-set by user, GetProjDetailTemplateCode()
      180212 ITERO.SB RAD-074
      180307 ORANGO.DL Prognosis overview, made GetProjDetailTemplateCode() global, extend CreateProjDetail() with recRef
      180409 ORANGO.PR Added "Expected Cost" in total
      180413 ORANGO.PR Added "Budget Comment"
      180509 ORANGO.DL added 'original amout' to Total
      180816 ORANGO.DL correct nested if-statement
      180920 ORANGO.DL Support #18876, change display from "Total<>0" to "TotalNotZero"
      190312 ORANGO.DL optimize GetExFlowLines() & GetExFlowLinesUnderProject() with use of queries and other stuff
                       added LogDuration
      190313 ORANGO.DL optimize GetPrognosisLine() with use of queries and local functions
      190314 ORANGO.SB Feature #22824/BYGG001_9 Added function ShowThousands(UserId,ProjNo)
      190319 ORANGO.SB Feature #22823/BYGG001_8 Add functionality for prognosis remaining amount
      190321 ORANGO.SB Feature #22819/BYGG001_4 Locked GL Amount
      190404 ORANGO.SB Feature #22822 BYGG001_7 Added funktionality for prognosis on budget line
      190412 ORANGO.DL Upgrade SG: 180122 ITERO.PR GetOpenPurchase
      190507 ORANGO.EE - Get Amount for Prognosis Budget Line for Revenues
      190603 ORANGO.EE REK Feature #24023, New functions SaveValues and GetSavedValues
      190603 ORANGO.EE REK Feature #23919, Calculations for Locked Amount
      190604 ORANGO.EE BYGG Approver on Exflow Lines
      190607 ORANGO.EE BYGG Element on Exflow Lines and added posibility to filter on Position
      190927 ORANGO.EE BYGG New functionality if project has prognosis per budgetline
      190927 ORANGO.EE BYGG New functionality on saving values in project details
      191017 ORANGO.EE Fix period filter
      191209 ORANGO.DL BYGG #25624 all PDFs to one PDF, 2 functions; ShowPostedExfPurchaseInvoices, GetImageFileName
      200116 ORANGO.EE BYGG #27223
      200120 ORANGO.EE BYGG #27258 (4PSSE)
      200416 ORANGO.EE New functions GetOpenPurchaseNotRecieved, GetPurchaseRecievedNotInvoiced & GetGLEntriesExtension + added code in SumProjDetail & CodeLines
    }
    END.
  }
}

