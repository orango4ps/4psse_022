OBJECT Table 11072075 Estimate Recipe Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    Permissions=TableData 91=rm;
    OnInsert=BEGIN
               IF "Recipe (Child)" = '' THEN BEGIN
                 IF "Cost Type (Hours)" <> "Cost Type (Hours)"::Labor THEN  //DP01047
                   "Rate Code" := ''  //related fields will be cleared on validate
                 ELSE
                   CheckDefaultRate;
                 xRec."Rate Type" := "Rate Type";  //disable function ConvertNorm by next validate
                 xRec."Team Size" := "Team Size";
                 VALIDATE("Rate Code");            //get actual rate (if copied from old template)
                 DetermineNormGroup;
               END;

               InitRecipeLine(FALSE);
               InitAdjustmentFactor;
               IF Quantity <> 0 THEN BEGIN
                 IF CurrFieldNo = 0 THEN
                   CurrFieldNo := FIELDNO(Quantity);  //C016233 (UpdateEstLines when copy+paste used)
                 VALIDATE(Quantity);  //if Ctrl C+V used, force update hours based on adjustment factor
               END;
               CheckLinkedRecipe(1, Rec, RcpLineRec);  //DP02082
             END;

    OnModify=BEGIN
               EstRec.UpdateLogbook("Estimate No.");
               CheckLinkedRecipe(2, Rec, RcpLineRec);  //DP02082
             END;

    OnDelete=VAR
               EstLineRec@11012000 : Record 11072072;
               QuanSheetRec@1210190001 : Record 11012186;
               QuantityRelation@1100409000 : Record 11020463;
               BufferRec@1100485002 : Record 11012195;
               SurchLine@1100485001 : Integer;
               TextRec@1100409001 : Record 11020595;
               ChrgRec2@1100409002 : Record 11229771;
             BEGIN
               IF NOT FromRecipeLineDelete THEN
                 CheckLinkedRecipe(3, Rec, RcpLineRec);  //DP02082
               IF NOT FromRecipeLineDelete THEN  //skip check on Attached to Line; complete recipe will be deleted
                 EstimateMgmt.ModifyLinkedEstRcpLines(0,Rec,0); //0:delete

               EstCodeRec.RESET;
               EstCodeRec.SETRANGE("Estimate No.","Estimate No.");
               EstCodeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstCodeRec.SETRANGE("Part Group","Part Group");
               EstCodeRec.SETRANGE(Part,Part);
               EstCodeRec.SETRANGE("Estimate Line","Estimate Line");
               EstCodeRec.SETRANGE("Recipe Group","Recipe Group");
               EstCodeRec.SETRANGE(Recipe,Recipe);
               EstCodeRec.SETRANGE("Recipe Line","Line No.");
               IF NOT EstCodeRec.ISEMPTY THEN
                 EstCodeRec.DELETEALL;

               ChrgRec.RESET;
               ChrgRec.SETRANGE("Estimate No.","Estimate No.");
               ChrgRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               ChrgRec.SETRANGE("Part Group","Part Group");
               ChrgRec.SETRANGE(Part,Part);
               ChrgRec.SETRANGE("Recipe Line","Estimate Line");
               ChrgRec.SETRANGE("Recipe Group","Recipe Group");
               ChrgRec.SETRANGE(Recipe,Recipe);
               ChrgRec.SETRANGE("Basic Line","Line No."); //remove estimated lines included in surcharge
               IF NOT ChrgRec.ISEMPTY THEN BEGIN  //C030221
                 ChrgRec.FINDSET;
                 REPEAT
                   SurchLine := ChrgRec."Surcharge Line";
                   ChrgRec.DELETE;
                   IF "Cost Amount" <> 0 THEN BEGIN  //skip calculate charge if current line will not change result
                     IF RcpLineRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part,
                       "Estimate Line", "Recipe Group", Recipe, SurchLine) THEN BEGIN
                       RcpLineRec.CheckRecipeCharge;
                       //if last basic line deleted for surcharge, initialise surcharge line to disable totals
                       ChrgRec2.COPY(ChrgRec);
                       ChrgRec2.SETFILTER("Basic Line", '<>%1', "Line No.");
                       ChrgRec2.SETRANGE("Surcharge Line",SurchLine);
                       IF NOT ChrgRec2.FINDFIRST THEN BEGIN
                         RcpLineRec.InitNormPrice;
                         RcpLineRec.CalculateTotals;
                         RcpLineRec.MODIFY;
                       END;
                     END;
                   END;
                 UNTIL ChrgRec.NEXT = 0;
               END;

               ChrgRec.SETRANGE("Basic Line");
               ChrgRec.SETRANGE("Surcharge Line","Line No.");  //delete surcharge lines
               IF NOT ChrgRec.ISEMPTY THEN  //C030221
                 ChrgRec.DELETEALL;

               QuanSheetRec.RESET;
               QuanSheetRec.SETRANGE("Estimate No.","Estimate No.");
               QuanSheetRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanSheetRec.SETRANGE("Part Group","Part Group");
               QuanSheetRec.SETRANGE(Part,Part);
               QuanSheetRec.SETRANGE("Estimate Line","Estimate Line");
               QuanSheetRec.SETRANGE("Recipe Group","Recipe Group");
               QuanSheetRec.SETRANGE(Recipe,Recipe);
               QuanSheetRec.SETRANGE("Recipe Line","Line No.");
               IF NOT QuanSheetRec.ISEMPTY THEN
                 QuanSheetRec.DELETEALL;

               //DP00686.sn
               QuantityRelation.RESET;
               QuantityRelation.SETRANGE("Estimate No.","Estimate No.");
               QuantityRelation.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuantityRelation.SETRANGE("Part Group","Part Group");
               QuantityRelation.SETRANGE(Part,Part);
               QuantityRelation.SETRANGE("Estimate Line","Estimate Line");
               QuantityRelation.SETRANGE("Recipe Group","Recipe Group");
               QuantityRelation.SETRANGE(Recipe,Recipe);
               QuantityRelation.SETRANGE("Recipe Line","Line No.");
               IF NOT QuantityRelation.ISEMPTY THEN
                 QuantityRelation.DELETEALL;
               //DP00686.en

               BufferRec.RESET;
               BufferRec.SETRANGE("Estimate No.","Estimate No.");
               BufferRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               BufferRec.SETRANGE("Part Group","Part Group");
               BufferRec.SETRANGE(Part,Part);
               BufferRec.SETRANGE("Estimate Line","Estimate Line");
               BufferRec.SETRANGE("Recipe Group","Recipe Group");
               BufferRec.SETRANGE(Recipe,Recipe);
               BufferRec.SETRANGE("Recipe Line","Line No.");
               IF NOT BufferRec.ISEMPTY THEN
                 BufferRec.DELETEALL;

               TextRec.RESET;
               TextRec.SETRANGE("Table Name",TextRec."Table Name"::Estimate);
               TextRec.SETRANGE("Estimate No.","Estimate No.");
               TextRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               TextRec.SETRANGE("Part Group","Part Group");
               TextRec.SETRANGE(Part,Part);
               TextRec.SETRANGE("Estimate Line No.","Estimate Line");
               TextRec.SETRANGE("Recipe Line No.","Line No.");   //DP00686
               IF NOT TextRec.ISEMPTY THEN
                 TextRec.DELETEALL;

               //DP00381.sn
               DELETE;
               IF NOT FromRecipeLineDelete THEN BEGIN
                 IF EstLineRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line") THEN BEGIN
                   EstLineRec.CalculateTotals;
                   EstLineRec.MODIFY;
                   EstLineRec.CheckEstimateCharge;  //C027611
                 END;
                 EstRec.UpdateLogbook("Estimate No.");
               END;
               INSERT;
               //DP00381.en
             END;

    CaptionML=ENU=Estimate Recipe Line;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr] }
    { 20  ;   ;Sub-Estimate No.    ;Code20        ;TableRelation=Sub-Estimate."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Sub-Estimate No.;
                                                              NOR=Delkalkylenummer;
                                                              SVE=Delkalkylnr] }
    { 21  ;   ;Sub-Estimate Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Sub-Estimate.Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=[ENU=Sub-Estimate Description;
                                                              NOR=Beskrivelse av delkalkyle;
                                                              SVE=Beskrivning av delkalkyl];
                                                   Editable=No }
    { 25  ;   ;Part Group          ;Code10        ;TableRelation="Estimate Part"."Part Group" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.));
                                                   CaptionML=[ENU=Part Group;
                                                              NOR=Del gruppe;
                                                              SVE=Delgrupp] }
    { 30  ;   ;Part                ;Code20        ;TableRelation="Estimate Part".Part WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                             Part Group=FIELD(Part Group));
                                                   CaptionML=[ENU=Part;
                                                              NOR=Del;
                                                              SVE=Del] }
    { 31  ;   ;Part Description    ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Part".Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                         Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                         Part=FIELD(Part)));
                                                   CaptionML=[ENU=Part Description;
                                                              NOR=Delbeskrivelse;
                                                              SVE=Delbeskrivning];
                                                   Editable=No }
    { 40  ;   ;Estimate Line       ;Integer       ;TableRelation="Estimate Line"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part=FIELD(Part));
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Estimate Line;
                                                              NOR=Kalkylerad;
                                                              SVE=Uppskattningsrad] }
    { 41  ;   ;Recipe              ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Recipe Group));
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Recipe;
                                                              NOR=Mal;
                                                              SVE=Mall] }
    { 42  ;   ;Recipe Group        ;Code10        ;TableRelation="Recipe Group".No.;
                                                   CaptionML=[ENU=Recipe Group;
                                                              NOR=Maltype;
                                                              SVE=Malltyp] }
    { 50  ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 51  ;   ;Attached to Line No.;Integer       ;TableRelation="Estimate Recipe Line"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                          Part Group=FIELD(Part Group),
                                                                                                          Part=FIELD(Part),
                                                                                                          Estimate Line=FIELD(Estimate Line),
                                                                                                          Recipe=FIELD(Recipe),
                                                                                                          Recipe Group=FIELD(Recipe Group));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              NOR=Knyttet til linjenr.;
                                                              SVE=Bifogad till radnr] }
    { 52  ;   ;Set Level           ;Integer       ;CaptionML=[ENU=Set Level;
                                                              NOR=Still inn nivÜ;
                                                              SVE=StÑll in nivÜ] }
    { 55  ;   ;Set Code            ;Code10        ;TableRelation="Plant Set";
                                                   OnValidate=BEGIN
                                                                IF "Set Code" <> xRec."Set Code" THEN
                                                                  IF "Cost Type (Price)" <> "Cost Type (Price)"::Plant THEN
                                                                    CheckCostTypePriceAllowed;
                                                                ValidateSetCode;
                                                                IF "Line No." <> 0 THEN
                                                                  EstimateMgmt.ModifyLinkedEstRcpLines(0,Rec,0); //0:delete
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Set Code;
                                                              NOR=Still inn kode;
                                                              SVE=StÑll in kod] }
    { 60  ;   ;Description         ;Text100       ;OnValidate=BEGIN
                                                                UpdateMgt.CheckBackSlash(Description);  //DP00381
                                                              END;

                                                   CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 70  ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSalesQuantity; //C058658
                                                                EstimateMgmt.SetQuantityRatio(Quantity, xRec.Quantity);  //C044680
                                                                EstimateMgmt.ModifyLinkedEstRcpLines(1,Rec,0); //1:modify quantity

                                                                IF CurrFieldNo = FIELDNO(Quantity) THEN
                                                                  CheckBomLines;  //DP02339
                                                                FillQuantityRecipeChild;  //C044680
                                                                CalculateTotals;
                                                                //C031184: OnLookup (Quantity) removed -> activate on flowfield (AssistEditQuantity)
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 71  ;   ;Quantity Sheet Present;Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Quantity Relation" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                         Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                         Part Group=FIELD(Part Group),
                                                                                                         Part=FIELD(Part),
                                                                                                         Estimate Line=FIELD(Estimate Line),
                                                                                                         Recipe Group=FIELD(Recipe Group),
                                                                                                         Recipe=FIELD(Recipe),
                                                                                                         Recipe Line=FIELD(Line No.)));
                                                   OnLookup=BEGIN
                                                              AssistEditQuantity;  //C031184
                                                            END;

                                                   CaptionML=ENU=Quantity Sheet Present;
                                                   Editable=No }
    { 75  ;   ;Estimate Quantity   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Line".Quantity WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Part Group=FIELD(Part Group),
                                                                                                      Part=FIELD(Part),
                                                                                                      Line No.=FIELD(Estimate Line)));
                                                   CaptionML=[ENU=Estimate Quantity;
                                                              NOR=Kalkyle Õ antall;
                                                              SVE=Kalkyl Õ antal];
                                                   Editable=No }
    { 80  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN
                                                                  ValidateUnitOfMeasure("Unit of Measure");
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=Enhet;
                                                              SVE=MÜttenhet] }
    { 85  ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                DetermineNorm;
                                                              END;

                                                   CaptionML=[ENU=Norm Group;
                                                              NOR=Normgruppe;
                                                              SVE=Normgrupp] }
    { 87  ;   ;Sub Operation Code  ;Code20        ;TableRelation="Sub Operation".Code;
                                                   OnValidate=VAR
                                                                ValidateNewCostObject@1210190000 : Boolean;
                                                              BEGIN
                                                                DetermineNormGroup;
                                                                DetermineNorm;
                                                                DetermineNormSales;  //DP00381

                                                                IF "Sub Operation Code" <> '' THEN
                                                                  IF SubOperRec.GET("Sub Operation Code") THEN BEGIN
                                                                    SubOperRec.TESTFIELD(Expired,FALSE);
                                                                    IF SubOperRec.Operation <> '' THEN
                                                                      IF OperRec.GET(SubOperRec.Operation) THEN BEGIN
                                                                        IF ("Cost Object Labor" = '') THEN
                                                                          ValidateNewCostObject := TRUE
                                                                        ELSE
                                                                          ValidateNewCostObject := OldSubOperationDefault;
                                                                        IF ValidateNewCostObject THEN BEGIN
                                                                          IF OperRec."Cost Object" <> '' THEN BEGIN  //C045349
                                                                            VALIDATE("Cost Object Labor", OperRec."Cost Object");
                                                                            CheckCostObject("Cost Object Labor");
                                                                          END;
                                                                        END;
                                                                        IF OperRec."Rate Code" <> '' THEN
                                                                          IF "Rate Code" <> OperRec."Rate Code" THEN  //C045349
                                                                            VALIDATE("Rate Code", OperRec."Rate Code");
                                                                      END;
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Sub Operation Code;
                                                              NOR=Underinnsatskode;
                                                              SVE=Underinsatskod] }
    { 90  ;   ;Norm                ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo <> FIELDNO("Production Rate") THEN
                                                                  IF Norm <> 0 THEN
                                                                    "Production Rate" := 1 / Norm
                                                                  ELSE
                                                                    "Production Rate" := 0;

                                                                UpdateSalesNorm;  //DP00381
                                                                CalculateTotals;  //norm and production rate used to calculate hours
                                                              END;

                                                   CaptionML=[ENU=Norm;
                                                              NOR=Norm;
                                                              SVE=Norm];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 95  ;   ;Production Rate     ;Decimal       ;OnValidate=BEGIN
                                                                IF ("Recipe Header") THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Production Rate") THEN
                                                                    UpdateFieldOfRecipeLines;
                                                                END ELSE BEGIN
                                                                  IF "Production Rate" <> 0 THEN
                                                                    VALIDATE(Norm, 1 / "Production Rate")
                                                                  ELSE
                                                                    VALIDATE(Norm, 0);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Production Rate;
                                                              NOR=Produksjonsrate;
                                                              SVE=Produktionstakt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 100 ;   ;Rate Code           ;Code10        ;TableRelation="Estimate Rate"."Rate Code" WHERE (Estimate No.=FIELD(Estimate No.));
                                                   OnValidate=BEGIN
                                                                IF "Rate Code" = '' THEN BEGIN
                                                                  IF ("Sub Operation Code" <> '') AND ("Estimate No." <> '') THEN
                                                                    TESTFIELD("Rate Code");
                                                                  InitRateRelatedFields;  //DP01047
                                                                  InitNormRelatedFields(0);  //C053751
                                                                END;

                                                                GetEstSetup;  //DP01183
                                                                GetEstRate;
                                                                IF (EstSetup."Upd. Cost Object by Rate Code") OR ("Cost Object Labor" = '') THEN BEGIN
                                                                  IF RateRec."Cost Object" <> '' THEN BEGIN
                                                                    "Cost Object Labor" := RateRec."Cost Object";
                                                                    GetEstimate("Estimate No.", TRUE);
                                                                    DimMgt.GetDimValueRec(2, "Cost Object Labor", DimValRec, TRUE,'');
                                                                    VALIDATE("Cost Component", DimValRec."Cost Component");
                                                                    //IF NOT EntityDefined THEN  //C044586
                                                                    //  "Unit of Measure" := DimValRec."Unit of Measure";  //db, 05-03-18 (on hold: 29-03)
                                                                    IF EstRec."Estimate Based On" = EstRec."Estimate Based On"::CostObject THEN  //db, 16-01-15: C016230
                                                                      IF CostObjectLeading THEN  //C050221
                                                                        Description := DimValRec.Name;
                                                                  END;
                                                                END;
                                                                IF RateRec."Currency Code" = '' THEN BEGIN
                                                                  VALIDATE("Cost Rate", RateRec."Cost Rate");
                                                                  VALIDATE("Sales Rate", RateRec."Sales Rate");
                                                                END ELSE BEGIN
                                                                  IF RateRec."Currency Code" = "Currency Code" THEN BEGIN
                                                                    VALIDATE("Cost Rate (FCY)", RateRec."Cost Rate (FCY)");
                                                                    VALIDATE("Sales Rate (FCY)", RateRec."Sales Rate (FCY)");
                                                                  END ELSE BEGIN
                                                                    VALIDATE("Cost Rate (FCY)", ExchangeAmtFCYToFCY(RateRec."Cost Rate (FCY)", RateRec."Currency Code", "Currency Code", FALSE, TRUE));
                                                                    VALIDATE("Sales Rate (FCY)", ExchangeAmtFCYToFCY(RateRec."Sales Rate (FCY)", RateRec."Currency Code", "Currency Code", TRUE, TRUE));
                                                                  END;
                                                                END;
                                                                "Rate Type" := RateRec."Rate Type";
                                                                IF "Rate Type" = "Rate Type"::Minuts THEN
                                                                  "Team Size" := RateRec."Team Size"
                                                                ELSE
                                                                  "Team Size" := 0;

                                                                //check conversion norm after change of rate type and team size:
                                                                IF ("Rate Type" <> xRec."Rate Type") OR ("Team Size" <> xRec."Team Size") THEN BEGIN
                                                                  ConvertNorm(("Rate Type" <> xRec."Rate Type"), ("Team Size" <> xRec."Team Size"));
                                                                  ConvertNormSales(("Rate Type" <> xRec."Rate Type"), ("Team Size" <> xRec."Team Size"));  //C036875
                                                                END;

                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Rate Code;
                                                              NOR=Avgiftskode;
                                                              SVE=Avgiftskod] }
    { 110 ;   ;Cost Rate           ;Decimal       ;OnValidate=BEGIN
                                                                IF "Currency Code" = '' THEN
                                                                  "Cost Rate (FCY)" := ExchangeAmtLCYToFCY("Cost Rate", FALSE, TRUE, FALSE);
                                                              END;

                                                   CaptionML=[ENU=Cost Rate;
                                                              SVE=Avgift];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 120 ;   ;Net Cost Price      ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Net Cost Price (FCY)" := ExchangeAmtLCYToFCY("Net Cost Price", FALSE, TRUE, FALSE);
                                                                CalculateDiscount(FALSE);
                                                                //EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",0,"Net Cost Price","Buy Back Price","Buy Back %");  //C061014
                                                                //"Buy Back Price (FCY)" := ExchangeAmtLCYToFCY("Buy Back Price", FALSE, TRUE, FALSE);
                                                                UpdateSalesPriceFromCostPrice;  //C014487
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Net Cost Price;
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 141 ;   ;Buy Back Price      ;Decimal       ;OnValidate=BEGIN
                                                                EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",1,"Net Sales Price","Buy Back Price","Buy Back %");  //C061014
                                                                "Buy Back Price (FCY)" := ExchangeAmtLCYToFCY("Buy Back Price", FALSE, TRUE, FALSE);
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Buy Back Price;
                                                              NOR=Tilbakekjõpspris;
                                                              SVE=èterkîpspris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 144 ;   ;Buy Back %          ;Decimal       ;OnValidate=BEGIN
                                                                EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",2,"Net Sales Price","Buy Back Price","Buy Back %");  //C061014
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Buy Back %;
                                                              NOR=Tilbakekjõpsprosent;
                                                              SVE=èterkîpsprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 150 ;   ;Hours               ;Decimal       ;CaptionML=[ENU=Hours;
                                                              NOR="Timer ";
                                                              SVE=Timmar];
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 155 ;   ;Original Hours      ;Decimal       ;CaptionML=[ENU=Original Hours;
                                                              NOR=Opprinnelige timer;
                                                              SVE=Ursprungliga timmar];
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 160 ;   ;Labor Cost Amount   ;Decimal       ;CaptionML=[ENU=Labor Cost Amount;
                                                              SVE=Arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 170 ;   ;Net Cost Amount     ;Decimal       ;CaptionML=ENU=Net Cost Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 171 ;   ;Gross Amount        ;Decimal       ;CaptionML=[ENU=Gross Amount;
                                                              NOR=Bruttobelõp;
                                                              SVE=Bruttobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 175 ;   ;Original Net Amount ;Decimal       ;CaptionML=ENU=Original Net Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 176 ;   ;Original Gross Amount;Decimal      ;CaptionML=[ENU=Original Gross Amount;
                                                              NOR=Opprinnelig Bruttobelõp;
                                                              SVE=Ursprungligt bruttobelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 191 ;   ;Buy Back Amount     ;Decimal       ;CaptionML=[ENU=Buy Back Amount;
                                                              NOR=Tilbakekjõpsbelõp;
                                                              SVE=èterkîpsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 200 ;   ;Cost Amount         ;Decimal       ;CaptionML=[ENU=Cost Amount;
                                                              NOR=Kostbelõp;
                                                              SVE=Kostnadsbelopp];
                                                   NotBlank=No;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Plant Type          ;Code20        ;TableRelation="Plant Type";
                                                   OnValidate=BEGIN
                                                                IF ("Plant Type" <> xRec."Plant Type") AND ("Plant Type" <> '') THEN BEGIN
                                                                  IF "Cost Type (Price)" <> "Cost Type (Price)"::Plant THEN
                                                                    CheckCostTypePriceAllowed;
                                                                  GetDefaultsPlantType;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp] }
    { 271 ;   ;Plant Price Type    ;Option        ;CaptionML=[ENU=Plant Price Type;
                                                              NOR=Maskin Pristype;
                                                              SVE=Maskin pristyp];
                                                   OptionCaptionML=[ENU=" ,Day,Week,,Month,,,,,Hour";
                                                                    NOR=" ,Dag,Uke,,MÜned,,,,,Time";
                                                                    SVE=" ,Dag,Vecka,,MÜnad,,,,,Timme"];
                                                   OptionString=[ ,Day,Week,,Month,,,,,Hour];
                                                   Editable=No }
    { 272 ;   ;Start Rental Period ;Date          ;OnValidate=BEGIN
                                                                CalcRentalUnits;
                                                                EstimateMgmt.ModifyLinkedEstRcpLines(3,Rec,FIELDNO("Start Rental Period")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=Start Rental Period;
                                                              NOR=Start Leieperiode;
                                                              SVE=Starta uthyrningsperiod] }
    { 273 ;   ;End Rental Period   ;Date          ;OnValidate=BEGIN
                                                                CalcRentalUnits;
                                                                EstimateMgmt.ModifyLinkedEstRcpLines(3,Rec,FIELDNO("End Rental Period")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=End Rental Period;
                                                              NOR=Slutt pÜ Leieperiode;
                                                              SVE=Slut pÜ uthyrningsperiod] }
    { 274 ;   ;Rental Period Formula;DateFormula  ;OnValidate=BEGIN
                                                                IF FORMAT("Rental Period Formula") <> '' THEN BEGIN
                                                                  IF "Set Code" = '' THEN
                                                                    TESTFIELD("Plant Price Type");
                                                                  VALIDATE("Time Quantity",EstimateMgmt.ConvPlantCalcPeriod("Rental Period Formula","Plant Price Type"));
                                                                END ELSE BEGIN
                                                                  IF "Rental Time Units" <> 0 THEN
                                                                    VALIDATE("Time Quantity","Rental Time Units")
                                                                  ELSE
                                                                    VALIDATE("Time Quantity",1);
                                                                END;
                                                                EstimateMgmt.ModifyLinkedEstRcpLines(3,Rec,FIELDNO("Rental Period Formula")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=Rental Period Formula;
                                                              NOR=Formel for Leieperiode;
                                                              SVE=Formel fîr uthyrningsperiod] }
    { 275 ;   ;Rental Time Units   ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Rental Period Formula");
                                                                EstimateMgmt.ModifyLinkedEstRcpLines(3,Rec,FIELDNO("Rental Time Units")); //3:fields
                                                              END;

                                                   CaptionML=[ENU=Rental Time Units;
                                                              NOR=Leietidsenhet;
                                                              SVE=Uthyrningstidsenhet];
                                                   BlankZero=Yes }
    { 280 ;   ;Project No.         ;Code20        ;TableRelation=Job;
                                                   OnValidate=BEGIN
                                                                IF "Project No." = '' THEN
                                                                  "Extension Contract" := '';  //DP00260
                                                              END;

                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr.;
                                                              SVE=Projektnr] }
    { 290 ;   ;Element             ;Code20        ;TableRelation="Base Element";
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                GetDisciplineByElement;  //DP02460
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 291 ;   ;Project Element Description;Text50 ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Element)));
                                                   CaptionML=ENU=Project Element Description;
                                                   Editable=No }
    { 295 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=éTA] }
    { 300 ;   ;Cost Object Labor   ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Labor),
                                                                                               Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Cost Object Labor;
                                                              NOR=Kostnadsobjekt, arbeidskraft;
                                                              SVE=Kostnadsobjekt, arbetskraft] }
    { 335 ;   ;Cost Object Price   ;Code20        ;TableRelation="Dimension Value".Code WHERE (Cost Type=FILTER(Material..Sundry),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=BEGIN
                                                                //C050221
                                                                IF ("Cost Object Price" <> xRec."Cost Object Price") AND ("Cost Object Price" <> '') THEN
                                                                  GetDefaultsCostObject("Cost Type (Price)", "Cost Object Price");
                                                              END;

                                                   CaptionML=ENU=Cost Object Price }
    { 400 ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=BEGIN
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  ClearFields(1); //Plant
                                                                  GetEstimate("Estimate No.", TRUE);
                                                                  ValidateItem(ItemTypeOpt::Item, EstRec, TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              NOR=Artikkelnr;
                                                              SVE=Artikelnr] }
    { 410 ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  GetEstimate("Estimate No.", TRUE);
                                                                  ValidateItem(ItemTypeOpt::"Basic Item", EstRec, TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              NOR=Fabrikantartikkel;
                                                              SVE=Basartikel] }
    { 411 ;   ;Item Type           ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Type" WHERE (Product Code=FIELD(Basic Item),
                                                                                                      Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Type;
                                                              NOR=Artikkeltype;
                                                              SVE=Artikeltyp];
                                                   Editable=No }
    { 412 ;   ;Item Brand          ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Brand" WHERE (Product Code=FIELD(Basic Item),
                                                                                                       Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Brand;
                                                              NOR=Artikkelens Varemerke;
                                                              SVE=Artikelns varumÑrke];
                                                   Editable=No }
    { 413 ;   ;Item Series         ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Series" WHERE (Product Code=FIELD(Basic Item),
                                                                                                        Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Series;
                                                              NOR=Artikkelserier;
                                                              SVE=Artikelserier];
                                                   Editable=No }
    { 420 ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
                                                                  GetEstimate("Estimate No.", TRUE);
                                                                  ValidateItem(ItemTypeOpt::"Trade Item", EstRec, TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              NOR=Katalogartikkel;
                                                              SVE=Anskaffningsartikel] }
    { 440 ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF lvExecValidate THEN BEGIN
                                                                    GetEstimate("Estimate No.", TRUE);
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item",EstRec,TRUE)
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor",EstRec,TRUE);
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              NOR=Leverandõr (katalogartikkel);
                                                              SVE=Leverantîr (skaffningsartikel)] }
    { 450 ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              NOR=Produsent;
                                                              SVE=Tillverkare] }
    { 460 ;   ;Gross Price         ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Gross Price (FCY)" := ExchangeAmtLCYToFCY("Gross Price", FALSE, TRUE, FALSE);
                                                                CalculateNetPrice;
                                                                UpdateSalesPriceFromCostPrice;  //C014487
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              NOR=Bruttopris;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 468 ;   ;Purchase Discount % ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Purchase Discount %") THEN BEGIN
                                                                  TESTFIELD("Gross Price");
                                                                END;

                                                                //DP00381.sn
                                                                CalculateNetPrice;
                                                                UpdateSalesPriceFromCostPrice;  //C014487
                                                                CalculateTotals;
                                                                //DP00381.en
                                                              END;

                                                   CaptionML=[ENU=Purchase Discount %;
                                                              NOR=Innkjõpsrabattprosent;
                                                              SVE=Inkîpsrabattprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 469 ;   ;Sales Discount %    ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Sales Discount %") THEN BEGIN
                                                                  TESTFIELD("Gross Price");
                                                                END;

                                                                //DP00381.sn
                                                                IF "Sales Discount %"<> 0 THEN BEGIN  //C014487
                                                                  GetEstimate("Estimate No.", FALSE);
                                                                  IF "Surcharge Type" = "Surcharge Type"::" " THEN  //C026570 (if SalesPrice=CostPrice+SurchPerc then SalesDisc<0)
                                                                    IF "Plant Type" = '' THEN  //db, 04-10-19: accept discount as result of SalesPrice-CostPrice for PlantType
                                                                      EstRec.TESTFIELD("Item Sales Price Based On", EstRec."Item Sales Price Based On"::GrossMin);
                                                                END;
                                                                CalculateNetPrice;
                                                                CalculateTotals;
                                                                //DP00381.en
                                                              END;

                                                   CaptionML=[ENU=Sales Discount %;
                                                              NOR=Salgsrabattprosent;
                                                              SVE=FîrsÑljningsrabattprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 480 ;   ;Price Reference Date;Date          ;CaptionML=[ENU=Price Reference Date;
                                                              NOR=Referansedato for pris;
                                                              SVE=PrissÑttningsdatum];
                                                   Editable=No }
    { 490 ;   ;Variable            ;Boolean       ;CaptionML=[ENU=Variable;
                                                              NOR=Variabel;
                                                              SVE=Variabel] }
    { 500 ;   ;Rate Type           ;Option        ;CaptionML=[ENU=Rate Type;
                                                              NOR=Avgiftstype;
                                                              SVE=Avgiftstyp];
                                                   OptionCaptionML=[ENU=Hours,Minuts;
                                                                    NOR=Timer,Minutter;
                                                                    SVE=Timmar,Minuter];
                                                   OptionString=Hours,Minuts;
                                                   Editable=No }
    { 510 ;   ;Team Size           ;Decimal       ;CaptionML=[ENU=Team Size;
                                                              NOR=Teamstõrrelse;
                                                              SVE=Teamstorlek];
                                                   Editable=No }
    { 520 ;   ;Time Quantity       ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                IF ("Recipe Header") THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Time Quantity") THEN
                                                                    UpdateFieldOfRecipeLines;
                                                                  TESTFIELD("Time Quantity" , 1);
                                                                END;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Time Quantity;
                                                              NOR=Tidskvantitet;
                                                              SVE=Tidskvantitet];
                                                   BlankZero=Yes }
    { 530 ;   ;Unit of Time        ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Time;
                                                              NOR=Tidsenhet;
                                                              SVE=Tidsenhet] }
    { 540 ;   ;Surcharge %         ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge %;
                                                              NOR=Tilleggsgebyrsprosent;
                                                              SVE=TillÑggsavgiftsprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 545 ;   ;Surcharge Type      ;Option        ;OnValidate=BEGIN
                                                                IF "Surcharge Type" <> "Surcharge Type"::" " THEN BEGIN
                                                                  IF (xRec."Surcharge Type" = xRec."Surcharge Type"::" ") AND
                                                                     (Quantity + Norm + "Net Cost Price" <> 0) THEN
                                                                        ERROR(Text005);
                                                                  "Norm Group" := '';
                                                                  "Sub Operation Code" := '';
                                                                  InitAdjustmentFactor;
                                                                  EvaluateSurchargeCostType;  //DP00381
                                                                END ELSE BEGIN
                                                                  ERROR(Text004);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Surcharge Type;
                                                              NOR=Tilleggsgebyrtype;
                                                              SVE=TillÑggsavgiftstyp];
                                                   OptionCaptionML=[ENU=" ,Labor,Material,Subcontracting,Plant,Sundry";
                                                                    NOR=" ,Arbeidskraft,Materiale,Underentrepenõr,Maskin,Diverse";
                                                                    SVE=" ,Arbetskraft,Material,Underentreprenad,Maskin,Diverse"];
                                                   OptionString=[ ,Labor,Material,Subcontracting,Plant,Sundry] }
    { 547 ;   ;Recipe Level        ;Integer       ;CaptionML=[ENU=Recipe Level;
                                                              NOR=MalnivÜ;
                                                              SVE=MallnivÜ] }
    { 550 ;   ;Line Status         ;Code10        ;TableRelation="Line Status".Status;
                                                   CaptionML=[ENU=Line Status;
                                                              NOR=Radstatus;
                                                              SVE=Radstatus] }
    { 552 ;   ;Subcontracting Activity;Code10     ;TableRelation="Subcontracting Activity".Code;
                                                   OnValidate=BEGIN
                                                                IF "Cost Type (Price)" <> "Cost Type (Price)"::Subcontracting THEN
                                                                  CheckCostTypePriceAllowed;
                                                                GetSubcontractorActivity(FIELDNO("Subcontracting Activity"));  //DP01958a
                                                              END;

                                                   CaptionML=ENU=Subcontracting Activity;
                                                   Description=DP01492-2 }
    { 555 ;   ;Subcontractor       ;Code20        ;TableRelation=IF (Subcontracting Activity=FILTER(='')) Vendor.No. WHERE (Subcontractor Type=FILTER(Subcontractor|Self Employed|Employment Agency))
                                                                 ELSE IF (Subcontracting Activity=FILTER(<>'')) "Subcontracting Activity Price"."Subcontractor No." WHERE (Subcontracting Activity=FIELD(Subcontracting Activity));
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO(Subcontractor));  //DP01958a
                                                              END;

                                                   CaptionML=[ENU=Subcontractor;
                                                              NOR=Underentreprenõr;
                                                              SVE=Underentreprenîr];
                                                   Description=DP01492-2 }
    { 556 ;   ;Subcontractor Name  ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=[ENU=Subcontractor Name;
                                                              NOR=Underentreprenõrens navn;
                                                              SVE=Underentreprenîrens namn];
                                                   Editable=No }
    { 560 ;   ;Cumulative Hours    ;Decimal       ;CaptionML=[ENU=Cumulative Hours;
                                                              NOR=Akkumulerte timer;
                                                              SVE=Ackumulerade timmar] }
    { 565 ;   ;Cumulative Labor    ;Decimal       ;CaptionML=[ENU=Cumulative Labor;
                                                              NOR=Akkumulert arbeidskraft;
                                                              SVE=Ackumulerad arbetskraft];
                                                   AutoFormatType=1 }
    { 566 ;   ;Cumulative Net Amount;Decimal      ;CaptionML=ENU=Cumulative Net Amount;
                                                   AutoFormatType=1 }
    { 569 ;   ;Cumulative Buy Back ;Decimal       ;CaptionML=[ENU=Cumulative Buy Back;
                                                              NOR=Akkumulert Tilbakekjõp;
                                                              SVE=Ackumulerat Üterkîp];
                                                   AutoFormatType=1 }
    { 570 ;   ;Length              ;Decimal       ;OnValidate=BEGIN
                                                                ScalingFactorIsEmpty;
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Length;
                                                              NOR=Lengde;
                                                              SVE=LÑngd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,1' }
    { 571 ;   ;Width               ;Decimal       ;OnValidate=BEGIN
                                                                ScalingFactorIsEmpty;
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Width;
                                                              NOR=Bredde;
                                                              SVE=Bredd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,2' }
    { 572 ;   ;Height              ;Decimal       ;OnValidate=BEGIN
                                                                ScalingFactorIsEmpty;
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Height;
                                                              NOR=Hõyde;
                                                              SVE=Hîjd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,3' }
    { 573 ;   ;Estimate Part Quantity;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Line"."Part Quantity" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Part=FIELD(Part),
                                                                                                             Line No.=FIELD(Estimate Line)));
                                                   CaptionML=[ENU=Estimate Part Quantity;
                                                              NOR=Kalkyle Õ delantall;
                                                              SVE=Kalkyl Õ delantal];
                                                   Editable=No }
    { 575 ;   ;Weight              ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Weight;
                                                              NOR=Vekt;
                                                              SVE=Vikt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 576 ;   ;Total Weight        ;Decimal       ;CaptionML=[ENU=Total Weight;
                                                              NOR=Totalvekt;
                                                              SVE=Viktsumma];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 577 ;   ;Cumulative Weight   ;Decimal       ;CaptionML=[ENU=Cumulative Weight;
                                                              NOR=Akkumulert Vekt;
                                                              SVE=Ackumulerad vikt];
                                                   DecimalPlaces=0:2 }
    { 580 ;   ;Uncoded Labor       ;Boolean       ;CaptionML=[ENU=Uncoded Labor;
                                                              NOR=Ukodet arbeidskraft;
                                                              SVE=Okodad arbetskraft];
                                                   Editable=No }
    { 581 ;   ;Uncoded Material    ;Boolean       ;CaptionML=[ENU=Uncoded Material;
                                                              NOR=Ukodat Materiale;
                                                              SVE=Okodat material];
                                                   Editable=No }
    { 582 ;   ;Uncoded Subcontracting;Boolean     ;CaptionML=[ENU=Uncoded Subcontracting;
                                                              NOR=Ukodet underentrepenõr;
                                                              SVE=Okodad underentreprenad];
                                                   Editable=No }
    { 583 ;   ;Uncoded Plant       ;Boolean       ;CaptionML=[ENU=Uncoded Plant;
                                                              NOR=Ukodet maskin;
                                                              SVE=Okodad Maskin];
                                                   Editable=No }
    { 584 ;   ;Uncoded Line        ;Boolean       ;CaptionML=[ENU=Uncoded Line;
                                                              NOR=Ukodet Rad;
                                                              SVE=Okodad rad];
                                                   Editable=No }
    { 590 ;   ;Adjustment Factor Hours;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,1);  //DP00555
                                                              END;

                                                   CaptionML=[ENU=Hours Adjustment Factor;
                                                              NOR=Timejusteringsfaktor;
                                                              SVE=Timjusteringsfaktor];
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 591 ;   ;Adjustment Factor Price;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(2,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Price Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 595 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=[ENU=Hours Cum. Adjustment Factor;
                                                              NOR=Timer Akkumulert Justeringsfaktor;
                                                              SVE=Timmar ackum. Justeringsfaktor];
                                                   DecimalPlaces=0:6 }
    { 596 ;   ;Cum. Adj. Factor Price;Decimal     ;CaptionML=ENU=Price Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 600 ;   ;External Text       ;Text250       ;OnValidate=BEGIN
                                                                "External Text Block" := "External Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=External Text;
                                                              NOR=Ekstern Tekst;
                                                              SVE=Extern text] }
    { 601 ;   ;External Text Block ;Boolean       ;CaptionML=[ENU=External Text Block;
                                                              NOR=Ekstern Tekstblokk;
                                                              SVE=Externt textblock];
                                                   Editable=No }
    { 605 ;   ;Internal Text       ;Text250       ;OnValidate=BEGIN
                                                                "Internal Text Block" := "Internal Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=Internal Text;
                                                              NOR=Intern tekst;
                                                              SVE=Intern text] }
    { 606 ;   ;Internal Text Block ;Boolean       ;CaptionML=[ENU=Internal Text Block;
                                                              NOR=Intern tekstblokkering;
                                                              SVE=Internt textblock];
                                                   Editable=No }
    { 620 ;   ;Ask for Quote       ;Boolean       ;OnValidate=BEGIN
                                                                IF "Ask for Quote" THEN BEGIN
                                                                  IF ("Estimate No." = '') THEN
                                                                    "Ask for Quote" := FALSE
                                                                  ELSE BEGIN
                                                                    IF ("Net Cost Price" = 0) AND ("Cost Object Price" = '') THEN BEGIN
                                                                      "Ask for Quote" := FALSE;
                                                                      IF CurrFieldNo <> 0 THEN
                                                                        FIELDERROR("Ask for Quote", Text000);
                                                                    END;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Ask for Quote;
                                                              NOR=Be om tilbud;
                                                              SVE=BegÑr offert] }
    { 630 ;   ;Purchase Route Reference;Code20    ;OnLookup=VAR
                                                              lvRouteRefMgtCU@1210190000 : Codeunit 11012045;
                                                            BEGIN
                                                              IF ("Estimate No." <> '') THEN
                                                                lvRouteRefMgtCU.ShowReferenceList("Purchase Route Reference");
                                                            END;

                                                   CaptionML=[ENU=Purchase Route Reference;
                                                              NOR=Referanse for Innkjõpsrute;
                                                              SVE=Referens fîr inkîpsfîljd];
                                                   Editable=No }
    { 640 ;   ;Document No.        ;Code20        ;TableRelation="Document Properties";
                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Document No.;
                                                              NOR=Dokumentnr.;
                                                              SVE=Verifikationsnr] }
    { 650 ;   ;Code                ;Code20        ;OnValidate=VAR
                                                                CodingSystem@1210190005 : Record 11012088;
                                                              BEGIN
                                                                GetEstimate("Estimate No.", FALSE);
                                                                EstRec.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  CodingSystem.GET(EstRec."Coding System");
                                                                  IF CodingSystem."Deviant Code allowed" = FALSE THEN BEGIN
                                                                    FormatMgt.SetSelection(EstRec."Coding System");
                                                                    FormatMgt.FormatElem(Code,4,'');
                                                                    CodeRec.GET(EstRec."Coding System", Code);
                                                                  END;
                                                                END;

                                                                EstCodeRec.RESET;
                                                                EstCodeRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstCodeRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstCodeRec.SETRANGE("Part Group", "Part Group");
                                                                EstCodeRec.SETRANGE(Part, Part);
                                                                EstCodeRec.SETRANGE("Estimate Line", "Estimate Line");
                                                                EstCodeRec.SETRANGE("Recipe Group", "Recipe Group");
                                                                EstCodeRec.SETRANGE(Recipe, Recipe);
                                                                EstCodeRec.SETRANGE("Recipe Line", "Line No.");
                                                                EstCodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                                EstCodeRec.DELETEALL;

                                                                IF Code <> '' THEN BEGIN
                                                                  EstCodeRec.INIT;
                                                                  EstCodeRec."Estimate No." := "Estimate No.";
                                                                  EstCodeRec."Sub-Estimate No." := "Sub-Estimate No.";
                                                                  EstCodeRec."Part Group" := "Part Group";
                                                                  EstCodeRec.Part := Part;
                                                                  EstCodeRec."Estimate Line" := "Estimate Line";
                                                                  EstCodeRec."Recipe Group" := "Recipe Group";
                                                                  EstCodeRec.Recipe := Recipe;
                                                                  EstCodeRec."Recipe Line" := "Line No.";
                                                                  EstCodeRec."Coding System" := EstRec."Coding System";
                                                                  EstCodeRec.Code := Code;
                                                                  EstCodeRec.INSERT;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              GetEstimate("Estimate No.", FALSE);
                                                              EstRec.TESTFIELD("Coding System");
                                                              CodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                              CodeRec.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeRec) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeRec.Code);
                                                            END;

                                                   CaptionML=[ENU=Code;
                                                              NOR=Kode;
                                                              SVE=Kod] }
    { 660 ;   ;Price Agreement     ;Boolean       ;CaptionML=[ENU=Price Agreement;
                                                              NOR=Prisavtale;
                                                              SVE=Prisavtal] }
    { 661 ;   ;Norm Agreement      ;Boolean       ;CaptionML=[ENU=Norm Agreement;
                                                              NOR=Normavtale;
                                                              SVE=Normavtal] }
    { 670 ;   ;Vendor              ;Code20        ;TableRelation=Vendor;
                                                   CaptionML=[ENU=Vendor;
                                                              NOR=Leverandõr;
                                                              SVE=Leverantîr] }
    { 671 ;   ;Vendor Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=[ENU=Vendor Name;
                                                              NOR=Leverandõrnavn;
                                                              SVE=Leverantîrsnamn];
                                                   Editable=No }
    { 680 ;   ;Discipline          ;Code10        ;TableRelation=Discipline;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo <> FIELDNO(Discipline) THEN
                                                                  GetDisciplineByElement;  //DP02460
                                                              END;

                                                   CaptionML=[ENU=Discipline;
                                                              NOR=Disiplin;
                                                              SVE=Disciplin] }
    { 685 ;   ;Trade Speciality    ;Code10        ;TableRelation="Trade Speciality".Code WHERE (Discipline=FIELD(Discipline));
                                                   CaptionML=[ENU=Trade Speciality;
                                                              NOR=SNI-nummer;
                                                              SVE=SNI-nummer] }
    { 690 ;   ;Trade Expertise     ;Code10        ;TableRelation="Trade Expertise";
                                                   OnValidate=BEGIN
                                                                TradeExpRec.GetRelatedValue(Discipline, "Trade Speciality", "Trade Expertise");
                                                              END;

                                                   CaptionML=[ENU=Trade Expertise;
                                                              NOR=Bransjeekspertise;
                                                              SVE=Branschexpertis] }
    { 700 ;   ;Recipe (Child)      ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD("Recipe Group (Child)"));
                                                   OnValidate=BEGIN
                                                                //CheckParentChildRecipe("Recipe Group (Child)", "Recipe (Child)");  //DP01183

                                                                IF "Recipe (Child)" <> '' THEN BEGIN
                                                                  //C053970.sn
                                                                  TESTFIELD("Recipe Exploded", FALSE);  //rename child-recipe not supported
                                                                  "Recipe Header" := TRUE;  //(not exploded child-recipe contains amount while Cost Type(Price) not filled)
                                                                  "Recipe Level" := 0;
                                                                  "Norm Group" := '';
                                                                  "Norm Group (Sales)" := '';
                                                                  "Sub Operation Code" := '';
                                                                  //C053970.en
                                                                  IF "Cost Type (Price)" <> "Cost Type (Price)"::" " THEN
                                                                    CheckCostTypePriceAllowed;
                                                                  RecipeRec.GET("Recipe Group (Child)", "Recipe (Child)");
                                                                  RecipeRec.CALCFIELDS(Hours, "Labor Cost Amount",
                                                                    "Gross Amount", "Material Cost Amount", "Subcontracting Cost Amount", "Plant Cost Amount", "Sundry Cost Amount");
                                                                  RecipeRec.CALCFIELDS("Labor Sales Amount",
                                                                    "Material Sales Amount", "Subcontracting Sales Amount", "Plant Sales Amount", "Sundry Sales Amount");
                                                                END ELSE BEGIN
                                                                  CLEAR(RecipeRec);
                                                                  //C053970.sn
                                                                  "Recipe Exploded" := FALSE;
                                                                  "Recipe Header" := FALSE;
                                                                  "Recipe Level" := 0;
                                                                  //C053970.en
                                                                END;

                                                                Description := RecipeRec.Description;
                                                                "Unit of Measure" := RecipeRec."Unit of Measure";
                                                                Norm := RecipeRec.Hours;
                                                                IF Norm <> 0 THEN
                                                                  "Production Rate" := 1 / Norm
                                                                ELSE
                                                                  "Production Rate" := 0;

                                                                "Net Cost Price" := RecipeRec."Material Cost Amount" + RecipeRec."Subcontracting Cost Amount" +
                                                                  RecipeRec."Plant Cost Amount" + RecipeRec."Sundry Cost Amount";
                                                                "Gross Price" := RecipeRec."Gross Amount";
                                                                "Net Sales Price" := RecipeRec."Material Sales Amount" + RecipeRec."Subcontracting Sales Amount" +
                                                                  RecipeRec."Plant Sales Amount" + RecipeRec."Sundry Sales Amount";
                                                                "Net Cost Price (FCY)" := ExchangeAmtLCYToFCY("Net Cost Price", FALSE, TRUE, FALSE);
                                                                "Gross Price (FCY)" := ExchangeAmtLCYToFCY("Gross Price", FALSE, TRUE, FALSE);
                                                                "Net Sales Price (FCY)" := ExchangeAmtLCYToFCY("Net Sales Price", FALSE, TRUE, FALSE);

                                                                //CheckDefaultRate;  //DP00381
                                                                IF "Rate Code" = '' THEN BEGIN
                                                                  IF RecipeRec.Hours = 0 THEN BEGIN
                                                                    "Cost Rate" := 0;
                                                                    "Cost Rate (FCY)" := 0;
                                                                    "Sales Rate" := 0;
                                                                    "Sales Rate (FCY)" := 0;
                                                                  END ELSE BEGIN
                                                                    "Cost Rate" := RecipeRec."Labor Cost Amount" / RecipeRec.Hours;
                                                                    "Cost Rate (FCY)" := ExchangeAmtLCYToFCY(RecipeRec."Labor Cost Amount", FALSE, TRUE, FALSE) / RecipeRec.Hours;
                                                                    "Sales Rate" := RecipeRec."Labor Sales Amount" / RecipeRec.Hours;
                                                                    "Sales Rate (FCY)" := ExchangeAmtLCYToFCY(RecipeRec."Labor Sales Amount", FALSE, TRUE, FALSE) / RecipeRec.Hours;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  xRec."Rate Type" := "Rate Type"::Hours;
                                                                  xRec."Team Size" := 0;
                                                                  VALIDATE("Rate Code");
                                                                END;

                                                                //C053970.sn
                                                                IF "Recipe Header" THEN BEGIN
                                                                  "Cost Object Labor" := '';
                                                                  "Cost Object Price" := '';
                                                                END;
                                                                //C053970.en

                                                                CalculateDiscount(FALSE);
                                                                CalculateTotals;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Recipe (Child);
                                                              NOR=Mal (Underordnet);
                                                              SVE=Mall (underordnad)] }
    { 705 ;   ;Recipe Header       ;Boolean       ;CaptionML=[ENU=Recipe Header;
                                                              NOR=Maltittel;
                                                              SVE=Mallrubrik] }
    { 710 ;   ;Recipe Group (Child);Code10        ;TableRelation="Recipe Group".No.;
                                                   CaptionML=[ENU=Recipe Group (Child);
                                                              NOR=Maltype (Underordnet);
                                                              SVE=Malltyp (underordnad)] }
    { 715 ;   ;Recipe Quantity     ;Decimal       ;CaptionML=ENU=Recipe Quantity;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=C044680;
                                                   Editable=No }
    { 716 ;   ;Recipe Quantity (Sales);Decimal    ;CaptionML=ENU=Recipe Quantity (Sales);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=C044680;
                                                   Editable=No }
    { 720 ;   ;Additional Cost     ;Boolean       ;CaptionML=[ENU=Additional Cost;
                                                              NOR=Tilleggskoster;
                                                              SVE=TillÑggskostnader] }
    { 740 ;   ;Removal Contribution;Boolean       ;CaptionML=[ENU=Removal Contribution;
                                                              NOR=Fjerningsbidrag;
                                                              SVE=Borttagningsbidrag] }
    { 750 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadsdel] }
    { 755 ;   ;Comments            ;Text50        ;CaptionML=[ENU=Comments;
                                                              NOR=Merknader;
                                                              SVE=Kommentar] }
    { 770 ;   ;Supply              ;Boolean       ;CaptionML=[ENU=Supply;
                                                              NOR=Tilfõrsel;
                                                              SVE=FîrrÜd] }
    { 780 ;   ;Comments for Logistics;Text50      ;CaptionML=[ENU=Comments for Logistics;
                                                              NOR=Kommentarer for logistikk;
                                                              SVE=Kommentarer fîr logistik] }
    { 790 ;   ;Material Sheet      ;Option        ;CaptionML=[ENU=Material Sheet;
                                                              NOR=Materialeark;
                                                              SVE=Materialark];
                                                   OptionCaptionML=[ENU=Customer and Assemly,Customer Only,Assembly only,Do not report;
                                                                    NOR="Kunde og montering,Kun kunde,Kun montering,Ikke Rapporter ";
                                                                    SVE=Kund och montering,Endast kund,Endast montering,Rapportera inte];
                                                   OptionString=Customer and Assemly,Customer Only,Assembly only,Do not report }
    { 791 ;   ;Scheme Code         ;Code15        ;CaptionML=[ENU=Scheme Code;
                                                              NOR=Plankode;
                                                              SVE=Plankod] }
    { 808 ;   ;Object Type         ;Text30        ;CaptionML=[ENU=Object Type;
                                                              NOR=Objekttype;
                                                              SVE=Objekttyp] }
    { 809 ;   ;Object Brand        ;Text30        ;CaptionML=[ENU=Object Brand;
                                                              NOR=Objektsmerke;
                                                              SVE=ObjektsmÑrke] }
    { 900 ;   ;Text Composition    ;Text50        ;CaptionML=[ENU=Text Composition;
                                                              NOR=Tekstsammensettning;
                                                              SVE=TextsammansÑttning] }
    { 910 ;   ;Product Discount Line;Boolean      ;CaptionML=ENU=Product Discount Line;
                                                   Description=DP01727 }
    { 930 ;   ;Admicode            ;Code10        ;TableRelation="Admi Code";
                                                   OnValidate=VAR
                                                                lvAdmiCodeRec@1100485000 : Record 11012390;
                                                              BEGIN
                                                                IF Admicode <> '' THEN BEGIN
                                                                  lvAdmiCodeRec.GET(Admicode);
                                                                  IF Description = '' THEN
                                                                    Description := lvAdmiCodeRec.Description;
                                                                  //DP00381.sn
                                                                  IF ("Cost Object Price" = '') THEN BEGIN
                                                                    IF ("Cost Type (Price)" = "Cost Type (Price)"::Material) AND (lvAdmiCodeRec."Cost Object Material" <> '') THEN
                                                                      GetDefaultsCostObject("Cost Type (Price)", lvAdmiCodeRec."Cost Object Material");
                                                                    IF ("Cost Type (Price)" = "Cost Type (Price)"::Subcontracting) AND (lvAdmiCodeRec."Cost Object Subcontracting" <> '') THEN
                                                                      GetDefaultsCostObject("Cost Type (Price)", lvAdmiCodeRec."Cost Object Subcontracting");
                                                                    IF ("Cost Type (Price)" = "Cost Type (Price)"::Plant) AND (lvAdmiCodeRec."Cost Object Plant" <> '') THEN
                                                                      GetDefaultsCostObject("Cost Type (Price)", lvAdmiCodeRec."Cost Object Plant");
                                                                    IF ("Cost Type (Price)" = "Cost Type (Price)"::Sundry) AND (lvAdmiCodeRec."Cost Object Sundry" <> '') THEN
                                                                      GetDefaultsCostObject("Cost Type (Price)", lvAdmiCodeRec."Cost Object Sundry");
                                                                  END;
                                                                  //DP00381.en
                                                                 END;
                                                              END;

                                                   CaptionML=[ENU=Admi Code;
                                                              NOR=Admi-kode;
                                                              SVE=Admi-kod] }
    { 940 ;   ;Purchase Action     ;Code10        ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action;
                                                              NOR=Innkjõpshandling, Materiale;
                                                              SVE=InkîpsÜtgÑrdsmaterial] }
    { 950 ;   ;Purchase Action Filter;Code10      ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Purchase Action Filter;
                                                              NOR=Innkjõpshandlingsfilter, Materiale;
                                                              SVE=InkîpsÜtgÑrdsfilter, material] }
    { 960 ;   ;Purchase Phase      ;Code10        ;CaptionML=[ENU=Purchase Phase;
                                                              NOR=Innkjõpsfase, Materiale;
                                                              SVE=Inkîpsfas, material];
                                                   Numeric=Yes }
    { 970 ;   ;Purchase Action Status;Option      ;CaptionML=[ENU=Purchase Action Status;
                                                              NOR=Innkjõpshandlingsstatus, Materiale;
                                                              SVE=InkîpsÜtgÑrdsstatus, material];
                                                   OptionCaptionML=[ENU=Concept,Applied,Approved,Definitive;
                                                                    NOR=Konsept,Anvendt,Godkjent,Definitiv;
                                                                    SVE=Koncept,TillÑmpat,GodkÑnt,Definitiv];
                                                   OptionString=Concept,Applied,Approved,Definitive;
                                                   Editable=No }
    { 980 ;   ;Purch. Action Appr. Date;Date      ;CaptionML=[ENU=Purch. Action Approval Date;
                                                              NOR=Godkjenningsdato for for Innkjõpshandling, Materiale;
                                                              SVE=Inkîp GodkÑnnandedatum fîr ÜtgÑrd, material];
                                                   Editable=No }
    { 990 ;   ;Advised             ;Boolean       ;CaptionML=[ENU=Advised;
                                                              NOR=ForeslÜtt Materiale;
                                                              SVE=Fîreslaget material] }
    { 1000;   ;PurchAction Subc. OLD;Code10       ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action Subcontracting OLD;
                                                              NOR=Innkjõpshandling, underentrepenõr;
                                                              SVE=InkîpsÜtgÑrd, underentreprenad];
                                                   Description=DP01676: expired }
    { 1010;   ;PurchAction Filter Subc. OLD;Code10;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Purchase Action Filter Subcontracting OLD;
                                                              NOR=Innkjõpshandlingsfilter, underentrepenõr;
                                                              SVE=InkîpsÜtgÑrdsfilter, underentreprenad];
                                                   Description=DP01676: expired }
    { 1020;   ;PurchPhase Subc. OLD;Code10        ;CaptionML=[ENU=Purchase Phase Subcontracting OLD;
                                                              NOR=Innkjõpsfase, underentrepenõr;
                                                              SVE=Inkîpsfas, underentreprenad];
                                                   Numeric=Yes;
                                                   Description=DP01676: expired }
    { 1030;   ;PurchAction Status Subc. OLD;Option;CaptionML=[ENU=Purchase Action Status Subcontracting OLD;
                                                              NOR=Innkjõpshandlingsstatus, underentrepenõr;
                                                              SVE=InkîpsÜtgÑrdsstatus, underentreprenad];
                                                   OptionCaptionML=[ENU=Concept,Applied,Approved,Definitive;
                                                                    NOR=Konsept,Anvendt,Godkjent,Definitiv;
                                                                    SVE=Koncept,TillÑmpat,GodkÑnt,Definitiv];
                                                   OptionString=Concept,Applied,Approved,Definitive;
                                                   Description=DP01676: expired;
                                                   Editable=No }
    { 1040;   ;PurchAction ApprDate Subc. OLD;Date;CaptionML=[ENU=Purch. Action Approval Date Subcontracting OLD;
                                                              NOR=Innkjõpshandling Godkjenningsdato , underentrepenõr;
                                                              SVE=Inkîp GodkÑnnandedatum fîr ÜtgÑrd, underentreprenad];
                                                   Description=DP01676: expired;
                                                   Editable=No }
    { 1050;   ;Advised Subc. OLD   ;Boolean       ;CaptionML=[ENU=Advised Subcontracting OLD;
                                                              NOR=ForeslÜtt underentrepenõr;
                                                              SVE=Fîreslagen underentreprenad];
                                                   Description=DP01676: expired }
    { 1060;   ;PurchAction Plant OLD;Code10       ;TableRelation="Estimate Purchase Action".Code WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Purchase Action Plant OLD;
                                                              NOR=Innkjõpshandling for maskin;
                                                              SVE=InkîpsÜtgÑrd fîr Maskin];
                                                   Description=DP01676: expired }
    { 1070;   ;PurchAction Filter Plant OLD;Code10;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Purchase Action Filter Plant OLD;
                                                              NOR=Innkjõpshandlingsfilter, maskin;
                                                              SVE=InkîpsÜtgÑrdsfilter, Maskin];
                                                   Description=DP01676: expired }
    { 1080;   ;PurchPhase Plant OLD;Code10        ;CaptionML=[ENU=Purchase Phase Plant OLD;
                                                              NOR=Innkjõpsfase, maskin;
                                                              SVE=Inkîpsfas, Maskin];
                                                   Numeric=Yes;
                                                   Description=DP01676: expired }
    { 1090;   ;PurchAction Status Plant OLD;Option;CaptionML=[ENU=Purchase Action Status Plant OLD;
                                                              NOR=Innkjõpshandlingsstatus, maskin;
                                                              SVE=InkîpsÜtgÑrdsstatus, Maskin];
                                                   OptionCaptionML=[ENU=Concept,Applied,Approved,Definitive;
                                                                    NOR=Konsept,Anvendt,Godkjent,Definitiv;
                                                                    SVE=Koncept,TillÑmpat,GodkÑnt,Definitiv];
                                                   OptionString=Concept,Applied,Approved,Definitive;
                                                   Description=DP01676: expired;
                                                   Editable=No }
    { 1100;   ;PurchAction ApprDate Plant OLD;Date;CaptionML=[ENU=Purch. Action Approval Date Plant OLD;
                                                              NOR=Innkjõpshandling Godkjenningsdato, maskin;
                                                              SVE=Inkîp GodkÑnnandedatum fîr ÜtgÑrd, Maskin];
                                                   Description=DP01676: expired;
                                                   Editable=No }
    { 1110;   ;Advised Plant OLD   ;Boolean       ;CaptionML=[ENU=Advised Plant OLD;
                                                              NOR=ForeslÜtt maskin;
                                                              SVE=Fîreslagen Maskin];
                                                   Description=DP01676: expired }
    { 1120;   ;Ignore Recipe Quantity;Boolean     ;OnValidate=BEGIN
                                                                IF ("Recipe Header") THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Ignore Recipe Quantity") THEN
                                                                    UpdateFieldOfRecipeLines;
                                                                END;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Ignore Recipe Quantity;
                                                              NOR=Ignorer Malantall;
                                                              SVE=Ignorera mallantal] }
    { 1130;   ;Rates Based On      ;Option        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Estimate Setup"."Rates Based On");
                                                   CaptionML=[ENU=Rates Based On;
                                                              NOR=Avgifter basert pÜ;
                                                              SVE=Avgifter baseras pÜ];
                                                   OptionCaptionML=[ENU=Rate Group,Budget Rate;
                                                                    NOR=Satsgruppe,Budsjettsats;
                                                                    SVE=Kostnadsgrupp,Budgetavgift];
                                                   OptionString=Rate Group,Budget Rate;
                                                   Editable=No }
    { 1140;   ;Wage Component      ;Code10        ;TableRelation="Wage Component";
                                                   OnValidate=BEGIN
                                                                CalculateTotals;  //C026032
                                                              END;

                                                   CaptionML=[ENU=Wage Component;
                                                              NOR=Lõnnsart;
                                                              SVE=Lîneart] }
    { 1150;   ;Price History 0 Exists;Boolean     ;CaptionML=ENU=Price History 0 Exists;
                                                   Editable=No }
    { 1160;   ;Quantity Sheet Feature;Code10      ;TableRelation="Est. Quantity Sheet Feature";
                                                   OnValidate=VAR
                                                                i@1100409000 : Integer;
                                                              BEGIN
                                                                //DP00686
                                                                REPEAT
                                                                  CheckFeatureRelation(i);
                                                                  i := i + 1;
                                                                UNTIL i=3;
                                                              END;

                                                   CaptionML=ENU=Quantity Sheet Feature }
    { 1215;   ;Part of Line        ;Integer       ;TableRelation="Estimate Recipe Line"."Line No." WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                          Part Group=FIELD(Part Group),
                                                                                                          Part=FIELD(Part),
                                                                                                          Estimate Line=FIELD(Estimate Line),
                                                                                                          Recipe=FIELD(Recipe),
                                                                                                          Recipe Group=FIELD(Recipe Group));
                                                   OnValidate=BEGIN
                                                                DetermineBOMLevel("Part of Line","Level BOM");
                                                              END;

                                                   CaptionML=[ENU=Part of Line;
                                                              NOR=Del av Rad;
                                                              SVE=Del av rad];
                                                   Description=BOM }
    { 1220;   ;Original Quantity   ;Decimal       ;CaptionML=[ENU=Original Quantity BOM;
                                                              NOR=Opprinnelig antall Õ stykkliste];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=BOM }
    { 1225;   ;Level BOM           ;Integer       ;CaptionML=[ENU=Level BOM;
                                                              NOR=NivÜ Õ stykkliste;
                                                              SVE=NivÜstruktur];
                                                   Description=BOM;
                                                   Editable=No }
    { 1230;   ;BOM Item No.        ;Code20        ;TableRelation=Item;
                                                   CaptionML=[ENU=BOM Item No.;
                                                              NOR=Strukturartikkelnr;
                                                              SVE=Strukturartikelnr];
                                                   Description=BOM }
    { 1500;   ;Plant Rates in Hours;Boolean       ;OnValidate=BEGIN
                                                                IF ("Recipe Header") THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Plant Rates in Hours") THEN
                                                                    UpdateFieldOfRecipeLines;
                                                                END;
                                                                //C053751.sn
                                                                IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN BEGIN
                                                                  IF NOT "Plant Rates in Hours" THEN BEGIN
                                                                    CLEAR("Cost Type (Hours)");
                                                                    Quantity := Hours;
                                                                    "Quantity (Sales)" := "Hours (Sales)";
                                                                    InitNormRelatedFields(0);
                                                                  END ELSE BEGIN
                                                                    "Cost Type (Hours)" := "Cost Type (Hours)"::Plant;
                                                                    InitNormRelatedFields(1);
                                                                  END;
                                                                END;
                                                                //C053751.en
                                                                DeterminePlantPrice;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Plant Rates in Hours;
                                                              NOR=Maskingebyrer i timer;
                                                              SVE=Maskinavgifter i timmar];
                                                   Description=DP01492-5 }
    { 1510;   ;Subcontracting in Hours;Boolean    ;OnValidate=BEGIN
                                                                IF ("Recipe Header") THEN BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Subcontracting in Hours") THEN
                                                                    UpdateFieldOfRecipeLines;
                                                                END;
                                                                //C053751.sn
                                                                IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN BEGIN
                                                                  IF NOT "Subcontracting in Hours" THEN BEGIN
                                                                    CLEAR("Cost Type (Hours)");
                                                                    Quantity := Hours;
                                                                    "Quantity (Sales)" := "Hours (Sales)";
                                                                    InitNormRelatedFields(0);
                                                                  END ELSE BEGIN
                                                                    "Cost Type (Hours)" := "Cost Type (Hours)"::Subcontracting;
                                                                    InitNormRelatedFields(1);
                                                                  END;
                                                                END;
                                                                //C053751.en
                                                                CalculateTotals;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Subcontracting in Hours;
                                                   Description=C053751 }
    { 2000;   ;Cost Type (Price)   ;Option        ;InitValue=Material;
                                                   OnValidate=BEGIN
                                                                //DP00381
                                                                IF CurrFieldNo = FIELDNO("Cost Type (Price)") THEN BEGIN  //C012735
                                                                  GetEstSetup;  //DP01183
                                                                  IF "Cost Type (Price)" <> "Cost Type (Price)"::" " THEN BEGIN
                                                                    TESTFIELD("Recipe (Child)", '');
                                                                    TESTFIELD("Item No.", '');
                                                                    TESTFIELD("Basic Item", '');
                                                                    TESTFIELD("Trade Item", '');
                                                                    TESTFIELD("Plant Type", '');
                                                                    TESTFIELD("Set Code", '');
                                                                    TESTFIELD("Subcontracting Activity", '');
                                                                    IF ("Cost Type (Price)" = "Cost Type (Price)"::Plant) OR
                                                                       ("Cost Type (Price)" = "Cost Type (Price)"::Subcontracting) THEN BEGIN  //C061168
                                                                      "Rate Code":= '';
                                                                      InitRateRelatedFields;
                                                                    END;
                                                                    IF "Cost Type (Price)" <> "Cost Type (Price)"::Plant THEN
                                                                      TESTFIELD("Cost Type (Hours)", "Cost Type (Hours)"::Labor);  //C038168
                                                                  END ELSE BEGIN
                                                                    "Cost Object Price" := '';
                                                                  END;
                                                                  GetAbsenceValue;  //C050221
                                                                END;
                                                                IF CurrFieldNo = FIELDNO("Cost Type (Price)") THEN BEGIN  //C012735
                                                                  InitSurcharge(TRUE);  //C015031
                                                                  InitAdjustmentFactor;  //C037125
                                                                  CalculateTotals;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Cost Type (Price);
                                                   OptionCaptionML=[ENU=" ,Material,Subcontracting,Plant,Sundry";
                                                                    SVE=" ,Material,Underentreprenad,Maskin,Diverse"];
                                                   OptionString=[ ,Material,Subcontracting,Plant,Sundry] }
    { 2005;   ;Cost Type (Hours)   ;Option        ;OnValidate=BEGIN
                                                                //DP01047
                                                                IF CurrFieldNo = FIELDNO("Cost Type (Hours)") THEN BEGIN
                                                                  IF "Cost Type (Hours)" <> "Cost Type (Hours)"::Labor THEN BEGIN
                                                                    IF "Cost Type (Hours)" = "Cost Type (Hours)"::Plant THEN  //DP01676
                                                                      TESTFIELD("Plant Rates in Hours",TRUE);  //DP01492
                                                                    IF "Cost Type (Hours)" = "Cost Type (Hours)"::Subcontracting THEN
                                                                      TESTFIELD("Subcontracting in Hours",TRUE);  //C053751
                                                                    VALIDATE("Rate Code", '');
                                                                  END;
                                                                  IF "Cost Type (Hours)" = "Cost Type (Hours)"::Plant THEN
                                                                    TESTFIELD("Cost Type (Price)", "Cost Type (Price)"::Plant);  //C038168
                                                                  IF "Cost Type (Hours)" = "Cost Type (Hours)"::Subcontracting THEN
                                                                    TESTFIELD("Cost Type (Price)", "Cost Type (Price)"::Subcontracting);  //C053751
                                                                  CalculateTotals;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Cost Type (Hours);
                                                   OptionCaptionML=ENU=Labor,,Subcontracting,Plant;
                                                   OptionString=Labor,,Subcontracting,Plant;
                                                   Description=DP01047+DP01676 }
    { 2010;   ;Net Sales Price     ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Net Sales Price (FCY)" := ExchangeAmtLCYToFCY("Net Sales Price", TRUE, TRUE, FALSE);
                                                                CalculateDiscount(TRUE);
                                                                EstimateMgmt.CalcBuyBackRates("Item No.","Plant Type","Estimate No.",0,"Net Sales Price","Buy Back Price","Buy Back %");  //C061014
                                                                "Buy Back Price (FCY)" := ExchangeAmtLCYToFCY("Buy Back Price", FALSE, TRUE, FALSE);
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Net Sales Price;
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 2015;No ;Sales Price         ;Decimal       ;CaptionML=[ENU=Sales Price;
                                                              NOR=Salgspris;
                                                              SVE=FîrsÑljningspris];
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 2020;   ;Norm Group (Sales)  ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                DetermineNormSales;
                                                              END;

                                                   CaptionML=[ENU=Norm Group (Sales);
                                                              SVE=Kopiera till] }
    { 2030;   ;Norm (Sales)        ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo <> FIELDNO("Production Rate (Sales)") THEN
                                                                  IF "Norm (Sales)" <> 0 THEN
                                                                    "Production Rate (Sales)" := 1 / "Norm (Sales)"
                                                                  ELSE
                                                                    "Production Rate (Sales)" := 0;

                                                                CalculateTotals;  //norm and production rate used to calculate hours
                                                              END;

                                                   CaptionML=ENU=Norm (Sales);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 2035;   ;Production Rate (Sales);Decimal    ;OnValidate=BEGIN
                                                                IF "Production Rate (Sales)" <> 0 THEN
                                                                  VALIDATE("Norm (Sales)", 1 / "Production Rate (Sales)")
                                                                ELSE
                                                                  VALIDATE("Norm (Sales)",1);
                                                              END;

                                                   CaptionML=ENU=Production Rate (Sales);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 2040;   ;Sales Rate          ;Decimal       ;OnValidate=BEGIN
                                                                IF "Currency Code" = '' THEN
                                                                  "Sales Rate (FCY)" := ExchangeAmtLCYToFCY("Sales Rate", TRUE, TRUE, FALSE);
                                                              END;

                                                   CaptionML=[ENU=Sales Rate;
                                                              NOR=Salgsrate;
                                                              SVE=FîrsÑljningsavgift];
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 2050;   ;Quantity (Sales)    ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Quantity (Sales);
                                                              NOR=Antall (salg);
                                                              SVE=Antal (fîrsÑljning)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 2055;   ;Deviating Sales Quantity;Boolean   ;CaptionML=ENU=Deviating Sales Quantity;
                                                   Editable=No }
    { 2060;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge % Labor;
                                                              NOR=Tilleggsgebyrsprosent, arbeidskraft;
                                                              SVE=TillÑggsavgiftsprocent, arbetskraft];
                                                   BlankZero=Yes }
    { 2065;   ;Surcharge % Price   ;Decimal       ;OnValidate=BEGIN
                                                                IF "Surcharge % Price" <> 0 THEN TESTFIELD("Recipe Header", FALSE);  //C033781
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Surcharge % Price;
                                                   BlankZero=Yes }
    { 2066;   ;Recipe Surcharge % Material;Decimal;OnValidate=BEGIN
                                                                IF "Recipe Surcharge % Material" <> 0 THEN TESTFIELD("Recipe Header");  //C033781
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Recipe Surcharge % Material;
                                                   BlankZero=Yes;
                                                   Description=C033781 }
    { 2067;   ;Recipe Surcharge % Subc.;Decimal   ;OnValidate=BEGIN
                                                                IF "Recipe Surcharge % Subc." <> 0 THEN TESTFIELD("Recipe Header");  //C033781
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Recipe Surcharge % Subcontracting;
                                                   BlankZero=Yes;
                                                   Description=C033781 }
    { 2068;   ;Recipe Surcharge % Plant;Decimal   ;OnValidate=BEGIN
                                                                IF "Recipe Surcharge % Plant" <> 0 THEN TESTFIELD("Recipe Header");  //C033781
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Recipe Surcharge % Plant;
                                                   BlankZero=Yes;
                                                   Description=C033781 }
    { 2069;   ;Recipe Surcharge % Sundry;Decimal  ;OnValidate=BEGIN
                                                                IF "Recipe Surcharge % Sundry" <> 0 THEN TESTFIELD("Recipe Header");  //C033781
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=ENU=Recipe Surcharge % Sundry;
                                                   BlankZero=Yes;
                                                   Description=C033781 }
    { 2070;   ;Sales Condition Present;Boolean    ;CaptionML=[ENU=Sales Condition Present;
                                                              SVE=FîrsÑljningsvillkor Present];
                                                   Editable=No }
    { 2090;   ;Uncoded Sundry      ;Boolean       ;CaptionML=ENU=Uncoded Sundry;
                                                   Editable=No }
    { 2100;   ;Labor Sales Amount  ;Decimal       ;CaptionML=[ENU=Labor Sales Amount;
                                                              NOR=Belõp salg arbied;
                                                              SVE=Arbetskraft fîrsÑljningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2110;   ;Net Sales Amount    ;Decimal       ;CaptionML=ENU=Net Sales Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2115;   ;Hours (Sales)       ;Decimal       ;CaptionML=[ENU=Hours (Sales);
                                                              SVE=Timmar];
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 2200;   ;Sales Amount        ;Decimal       ;CaptionML=[ENU=Sales Amount;
                                                              NOR=Salgsbelõp;
                                                              SVE=FîrsÑljningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2210;   ;Cumulative Hours (Sales);Decimal   ;CaptionML=ENU=Cumulative Hours (Sales) }
    { 2220;   ;Cumulative Labor (Sales);Decimal   ;CaptionML=ENU=Cumulative Labo (Sales)r;
                                                   AutoFormatType=1 }
    { 2230;   ;Cumulative Net Amount (Sales);Decimal;
                                                   CaptionML=ENU=Cumulative Net Amount (Sales);
                                                   AutoFormatType=1 }
    { 2240;   ;Cumulative Buy Back (Sales);Decimal;CaptionML=ENU=Cumulative Buy Back (Sales);
                                                   AutoFormatType=1 }
    { 2250;   ;Recipe Cost Amount  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                               Part Group=FIELD(Part Group),
                                                                                                               Part=FIELD(Part),
                                                                                                               Estimate Line=FIELD(Estimate Line),
                                                                                                               Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Cost Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2251;   ;Recipe Labor Cost Amount;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                     Part Group=FIELD(Part Group),
                                                                                                                     Part=FIELD(Part),
                                                                                                                     Estimate Line=FIELD(Estimate Line),
                                                                                                                     Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Labor Cost Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2252;   ;Recipe Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                       Part Group=FIELD(Part Group),
                                                                                                       Part=FIELD(Part),
                                                                                                       Estimate Line=FIELD(Estimate Line),
                                                                                                       Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Hours;
                                                   DecimalPlaces=2:;
                                                   Description=total nested recipe;
                                                   Editable=No }
    { 2253;   ;Recipe Net Cost Amount;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Net Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Part Group=FIELD(Part Group),
                                                                                                                   Part=FIELD(Part),
                                                                                                                   Estimate Line=FIELD(Estimate Line),
                                                                                                                   Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Net Cost Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2254;   ;Recipe Gross Amount ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part Group=FIELD(Part Group),
                                                                                                                Part=FIELD(Part),
                                                                                                                Estimate Line=FIELD(Estimate Line),
                                                                                                                Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Gross Cost Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2260;   ;Recipe Sales Amount ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part Group=FIELD(Part Group),
                                                                                                                Part=FIELD(Part),
                                                                                                                Estimate Line=FIELD(Estimate Line),
                                                                                                                Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Sales Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2261;   ;Recipe Labor Sales Amount;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part Group=FIELD(Part Group),
                                                                                                                      Part=FIELD(Part),
                                                                                                                      Estimate Line=FIELD(Estimate Line),
                                                                                                                      Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Labor Sales Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2262;   ;Recipe Hours (Sales);Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Part=FIELD(Part),
                                                                                                                 Estimate Line=FIELD(Estimate Line),
                                                                                                                 Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Hours (Sales);
                                                   DecimalPlaces=2:;
                                                   Description=total nested recipe;
                                                   Editable=No }
    { 2263;   ;Recipe Net Sales Amount;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Recipe Line"."Net Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part Group=FIELD(Part Group),
                                                                                                                    Part=FIELD(Part),
                                                                                                                    Estimate Line=FIELD(Estimate Line),
                                                                                                                    Attached to Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=Recipe Net Sales Amount;
                                                   Description=total nested recipe;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2270;   ;Recipe Exploded     ;Boolean       ;CaptionML=ENU=Recipe Exploded }
    { 2300;   ;Material Cost Amount;Decimal       ;CaptionML=[ENU=Material Cost Amount;
                                                              SVE=Material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2305;   ;Material Sales Amount;Decimal      ;CaptionML=[ENU=Material Sales Amount;
                                                              NOR=Belõp salg materialer;
                                                              SVE=FîrsÑljningsbelopp material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2310;   ;Subcontracting Cost Amount;Decimal ;CaptionML=[ENU=Subcontracting Cost Amount;
                                                              SVE=Underentreprenad];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2315;   ;Subcontracting Sales Amount;Decimal;CaptionML=[ENU=Subcontracting Sales Amount;
                                                              NOR=Belõp salg underentreprenõr;
                                                              SVE=Underentreprenad, fîrsÑljningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2320;   ;Plant Cost Amount   ;Decimal       ;CaptionML=[ENU=Plant Cost Amount;
                                                              SVE=Maskin];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2325;   ;Plant Sales Amount  ;Decimal       ;CaptionML=[ENU=Plant Sales Amount;
                                                              NOR=Belõp maskinsalg;
                                                              SVE=MaskinfîrsÑljningsbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2330;   ;Sundry Cost Amount  ;Decimal       ;CaptionML=[ENU=Sundry Cost Amount;
                                                              SVE=Diverse];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2335;   ;Sundry Sales Amount ;Decimal       ;CaptionML=[ENU=Sundry Sales Amount;
                                                              SVE=FîrsÑljningsbelopp, diverse];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2340;   ;Price Agreement (Sales);Boolean    ;CaptionML=ENU=Price Agreement (Sales) }
    { 2345;   ;Norm Agreement (Sales);Boolean     ;CaptionML=ENU=Norm Agreement (Sales) }
    { 2350;   ;Adj. Factor Hours (Sales);Decimal  ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,2);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 2360;   ;Cum. Adj. Factor Hours (Sales);Decimal;
                                                   CaptionML=ENU=Cum. Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6 }
    { 2500;   ;Plant Need Location ;Code20        ;CaptionML=ENU=Plant Need Location;
                                                   Description=Copied to Plant Need (in Plant Company of Estimate);
                                                   Editable=No }
    { 2501;   ;Plant Need Line No. ;Integer       ;CaptionML=ENU=Plant Need Line No.;
                                                   Editable=No }
    { 3000;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                CheckCurrencyAgreement;
                                                                VALIDATE("Rate Code");
                                                                IF "Currency Agreement" THEN BEGIN  //C054524
                                                                  VALIDATE("Gross Price (FCY)");
                                                                  "Gross Price" := ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, FALSE);
                                                                END ELSE BEGIN
                                                                  VALIDATE("Gross Price");
                                                                  "Gross Price (FCY)" := ExchangeAmtLCYToFCY("Gross Price", FALSE, TRUE, FALSE);
                                                                END;
                                                                CalculateTotals;
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod] }
    { 3001;   ;Currency Agreement  ;Boolean       ;CaptionML=[ENU=Currency Agreement;
                                                              SVE=Valuta avtal] }
    { 3010;   ;Net Cost Price (FCY);Decimal       ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Net Cost Price", ExchangeAmtFCYToLCY("Net Cost Price (FCY)", FALSE, TRUE, FALSE));
                                                              END;

                                                   CaptionML=ENU=Net Cost Price (FCY);
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 3020;   ;Net Sales Price (FCY);Decimal      ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Net Sales Price", ExchangeAmtFCYToLCY("Net Sales Price (FCY)", TRUE, TRUE, FALSE));
                                                              END;

                                                   CaptionML=ENU=Net Sales Price (FCY);
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 3030;   ;Gross Price (FCY)   ;Decimal       ;OnValidate=VAR
                                                                SaveGrossPrice@1100525000 : Decimal;
                                                              BEGIN
                                                                //C026956.sn
                                                                //SetSkipValidateFCY(TRUE);
                                                                SaveGrossPrice := "Gross Price (FCY)";
                                                                VALIDATE("Gross Price", ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, FALSE));
                                                                IF CurrFieldNo = FIELDNO("Gross Price (FCY)") THEN
                                                                  "Gross Price (FCY)" := SaveGrossPrice;  //function CalculateDiscount cleared input on validate GrossPrice
                                                                //C026956.en
                                                              END;

                                                   CaptionML=ENU=Gross Price (FCY);
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 3040;   ;Cost Rate (FCY)     ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Cost Rate", ExchangeAmtFCYToLCY("Cost Rate (FCY)", FALSE, TRUE, FALSE));
                                                              END;

                                                   CaptionML=ENU=Cost Rate (FCY);
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 3050;   ;Sales Rate (FCY)    ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Sales Rate", ExchangeAmtFCYToLCY("Sales Rate (FCY)", TRUE, TRUE, FALSE));
                                                              END;

                                                   CaptionML=ENU=Sales Rate (FCY);
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 3060;   ;Material Cost Amount (FCY);Decimal ;CaptionML=ENU=Material Cost Amount (FCY);
                                                   Editable=No }
    { 3070;   ;Material Sales Amount (FCY);Decimal;CaptionML=ENU=Material Sales Amount (FCY);
                                                   Editable=No }
    { 3080;   ;Gross Amount (FCY)  ;Decimal       ;CaptionML=ENU=Gross Amount (FCY);
                                                   Editable=No }
    { 3090;   ;Subcontr. Cost Amount (FCY);Decimal;CaptionML=ENU=Subcontracting Cost Amount (FCY);
                                                   Editable=No }
    { 3100;   ;Subcontr. Sales Amount (FCY);Decimal;
                                                   CaptionML=ENU=Subcontracting Sales Amount (FCY);
                                                   Editable=No }
    { 3120;   ;Plant Cost Amount (FCY);Decimal    ;CaptionML=ENU=Plant Cost Amount (FCY);
                                                   Editable=No }
    { 3130;   ;Plant Sales Amount (FCY);Decimal   ;CaptionML=ENU=Plant Sales Amount (FCY);
                                                   Editable=No }
    { 3150;   ;Sundry Cost Amount (FCY);Decimal   ;CaptionML=ENU=Sundry Cost Amount (FCY);
                                                   Editable=No }
    { 3160;   ;Sundry Sales Amount (FCY);Decimal  ;CaptionML=ENU=Sundry Sales Amount (FCY);
                                                   Editable=No }
    { 3180;   ;Cost Amount (FCY)   ;Decimal       ;CaptionML=ENU=Cost Amount (FCY);
                                                   Editable=No }
    { 3190;   ;Sales Amount (FCY)  ;Decimal       ;CaptionML=ENU=Sales Amount (FCY);
                                                   Editable=No }
    { 3200;   ;Labor Cost Amount (FCY);Decimal    ;CaptionML=ENU=Labor Cost Amount (FCY);
                                                   Editable=No }
    { 3210;   ;Labor Sales Amount (FCY);Decimal   ;CaptionML=ENU=Labor Sales Amount (FCY);
                                                   Editable=No }
    { 3230;   ;Net Cost Amount (FCY);Decimal      ;CaptionML=ENU=Net Cost Amount (FCY);
                                                   Editable=No }
    { 3240;   ;Net Sales Amount (FCY);Decimal     ;CaptionML=ENU=Net Sales Amount (FCY);
                                                   Editable=No }
    { 3250;   ;Buy Back Price (FCY);Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Buy Back Price", ExchangeAmtFCYToLCY("Buy Back Price (FCY)", FALSE, TRUE, FALSE));
                                                              END;

                                                   CaptionML=ENU=Buy Back Price (FCY) }
    { 3260;   ;Buy Back Amount (FCY);Decimal      ;CaptionML=ENU=Buy Back Amount (FCY);
                                                   Editable=No }
    { 11012434;;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Project Planning Activity Code;
                                                              NOR=Prosjektplan, Aktivitetskode;
                                                              SVE=Projektplan, aktivitetskod];
                                                   Description=RAW }
    { 11125671;;VAT Prod. Posting Group;Code20    ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=VAR
                                                                GWWSetup@1100525000 : Record 11012260;
                                                              BEGIN
                                                                GWWSetup.GET;
                                                                CASE "VAT Prod. Posting Group" OF
                                                                  GWWSetup."VAT Prod. Posting Group (L)": "VAT Type" := "VAT Type"::Low;
                                                                  GWWSetup."VAT Prod. Posting Group (Z)": "VAT Type" := "VAT Type"::Zero;
                                                                  ELSE BEGIN
                                                                    "VAT Type" := "VAT Type"::High;
                                                                    IF "VAT Prod. Posting Group" <> '' THEN
                                                                      TESTFIELD("VAT Prod. Posting Group", GWWSetup."VAT Prod. Posting Group (H)");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=VAT Prod. Posting Group;
                                                              NOR=Moms produktbokfõringsmal;
                                                              SVE=Moms produktbokfîringsmall];
                                                   Description=RAW }
    { 11125672;;VAT Type           ;Option        ;CaptionML=[ENU=VAT Type;
                                                              NOR=Mva.-type;
                                                              SVE=Momstyp];
                                                   OptionCaptionML=[ENU=High,Low,Zero;
                                                                    NOR=Hõg,Lav,Null;
                                                                    SVE=Hîg,LÜg,Noll];
                                                   OptionString=High,Low,Zero;
                                                   Description=RAW;
                                                   Editable=No }
    { 11125673;;Scaling Factor     ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD(Length, 0);
                                                                TESTFIELD(Height, 0);
                                                                TESTFIELD(Width, 0);

                                                                CalculateQuantityScalingFactor;
                                                              END;

                                                   CaptionML=ENU=Scaling Factor;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,4' }
    { 11125674;;Base Quantity      ;Decimal       ;OnValidate=BEGIN
                                                                IF "Scaling Factor" <> 0 THEN
                                                                    CalculateQuantityScalingFactor
                                                                ELSE
                                                                  CalculateQuantity;
                                                              END;

                                                   CaptionML=ENU=Base Quantity;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   CaptionClass='11012150,5' }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part,Estimate Line,Recipe Group,Recipe,Line No.;
                                                   Clustered=Yes }
    {    ;Purchase Route Reference,Ask for Quote   }
    {    ;Recipe Group (Child),Recipe (Child)      }
    {    ;Recipe Group,Recipe                      }
    {    ;Project Planning Activity Code           }
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part,Estimate Line,Attached to Line No. }
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part,Estimate Line,Cost Type (Price) }
    {    ;Estimate No.,Text Composition            }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      EstSetup@1210190001 : Record 11012150;
      EstRec@11012002 : Record 11012151;
      SubEstRec@11012003 : Record 11072074;
      EstPartRec@11012004 : Record 11072073;
      EstLineRec@1210190005 : Record 11072072;
      RecipeRec@11012005 : Record 11020581;
      RcpLineRec@1100485000 : Record 11072075;
      EstCodeRec@1210190014 : Record 11229772;
      CodeRec@1210190015 : Record 11012089;
      ChrgRec@1210190000 : Record 11229771;
      RateRec@1210190006 : Record 11012160;
      OperRec@11012006 : Record 11012165;
      SubOperRec@11012007 : Record 11012166;
      TradeItemRec@1210190019 : Record 11012317;
      BasicItemRec@11012008 : Record 11012316;
      ItemRec@1210190004 : Record 27;
      DimValRec@1210190002 : Record 349;
      ElemRec@1210190021 : Record 11012060;
      ProjElemRec@1210190020 : Record 11012010;
      TradeExpRec@1100485001 : Record 11020286;
      FormatMgt@11012009 : Codeunit 11012022;
      UpdateMgt@1210190009 : Codeunit 11012229;
      ValidateCu@11012010 : Codeunit 11012033;
      DimMgt@1210190003 : Codeunit 408;
      EstimateMgmt@1100525000 : Codeunit 11012232;
      ItemTypeOpt@1210190011 : 'Item,Basic Item,Trade Item,Trade Vendor';
      Text000@1210190013 : TextConst 'ENU=only allowed for material, subcontracting or plant (fill one of the prices or cost objects);NOR=kun tillatt for Materiale, underentrepenõr eller maskin (fyll ut en av prisene eller kostnadsobjektene);SVE=endast tillÜtet fîr material, underentreprenad eller Maskin (fyll i ett av priserna eller kostnadsobjekten)';
      Text004@1210190016 : TextConst 'ENU=Remove Charge Line;NOR=Fjern gebyrrader;SVE=Ta bort avgiftsrader';
      Text005@1210190017 : TextConst 'ENU=Switch to Surcharge Line not allowed for Recipe Line with filled Quantity, Norm or Price;NOR=Bytting til tilleggsgebyrsraden er ikke tillatt for Malrad med antall, Norm eller Pris fylt ut;SVE=VÑxling till tillÑggsavgiftsraden Ñr inte tillÜtet fîr mallrad med antal, norm eller pris ifyllt';
      EstSetupRead@1210190028 : Boolean;
      SkipCalculateTotals@1210190010 : Boolean;
      NormPresent@1210190018 : Boolean;
      NormGroupPresent@1210190022 : Boolean;
      SubEstPresent@1210190023 : Boolean;
      FromRecipeLineDelete@1210190024 : Boolean;
      SkipBlockedItem@1100525001 : Boolean;
      Text011@1100409000 : TextConst 'ENU=Add Line first.;NOR=Legg til rad fõrst.;SVE=LÑgg till rad fîrst.';
      SkipValidateFCY@1100528600 : Boolean;
      CalledFromUpdateTotals@1100409001 : Boolean;
      RecipeExpanded@1100529402 : Boolean;
      SkipReadEstimate@1100529900 : Boolean;
      SkipLinkedRecipe@1100528500 : Boolean;

    PROCEDURE CalculateTotals@1();
    VAR
      EstLineRec@1210190000 : Record 11072072;
      WageCompRec@1100528900 : Record 11012014;
      OverTimeFactorCost@1100528901 : Decimal;
      OverTimeFactorSales@1100528902 : Decimal;
      ChildRecipe@1100529500 : Record 11072075;
      SaveRecipeLine@1100529501 : Record 11072075;
      SaveRecipeLine2@1100525000 : Record 11072075;
      SurchargeFactorLabor@1100529503 : Decimal;
      SurchargeFactorPrice@1100529502 : Decimal;
    BEGIN
      IF SkipCalculateTotals THEN
        EXIT;

      IF "Item No." + "Basic Item" + "Trade Item" <> '' THEN
        "Cost Type (Price)" := "Cost Type (Price)"::Material;  //DP00381

      IF "Surcharge Type" <> "Surcharge Type"::" " THEN BEGIN
        "Time Quantity" := 1;
        "Unit of Time" := '';
        Quantity := "Surcharge %" / 100;
        "Quantity (Sales)" := Quantity;
        //C026570.sn
        "Surcharge % Labor" := 0;
        "Surcharge % Price" := 0;
        //C026570.en
        //C033781.sn
        "Recipe Surcharge % Material" := 0;
        "Recipe Surcharge % Subc." := 0;
        "Recipe Surcharge % Plant" := 0;
        "Recipe Surcharge % Sundry" := 0;
        //C033781.en
      END;

      //C033781.sn
      SurchargeFactorLabor := (1 + "Surcharge % Labor"/100);
      SurchargeFactorPrice := (1 + "Surcharge % Price"/100);

      //C044680.sn
      IF "Attached to Line No." <> 0 THEN BEGIN
        SaveRecipeLine2 := Rec;
        IF ChildRecipe.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line", "Recipe Group", Recipe, "Attached to Line No.") THEN BEGIN
          IF "Recipe Quantity" = 0 THEN
            Quantity := 0;
          IF "Recipe Quantity (Sales)" = 0 THEN
            "Quantity (Sales)" := 0;
        END;
      END;
      //C044680.en

      IF "Recipe (Child)" <> '' THEN BEGIN
        SaveRecipeLine := Rec;
        GetEstSetup;
        IF "Recipe Header" THEN BEGIN
          //do not reset surcharge recipe child header; assumed that this type of line is not filled with amount
          SurchargeFactorLabor := 0;
          SurchargeFactorPrice := 0;
          "Production Rate" := 0;
          Norm := 0;
        END ELSE BEGIN
          //get default from header-line
          IF EstSetup."Apply Surcharge Recipe Header" = EstSetup."Apply Surcharge Recipe Header"::Cumulative THEN BEGIN
            IF ChildRecipe.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line", "Recipe Group", Recipe, "Attached to Line No.") THEN BEGIN
              SurchargeFactorLabor := SurchargeFactorLabor * (1 + ChildRecipe."Surcharge % Labor"/100);
              CASE  "Cost Type (Price)" OF
                "Cost Type (Price)"::Material: SurchargeFactorPrice := SurchargeFactorPrice * (1 + ChildRecipe."Recipe Surcharge % Material"/100);
                "Cost Type (Price)"::Subcontracting: SurchargeFactorPrice := SurchargeFactorPrice * (1 + ChildRecipe."Recipe Surcharge % Subc."/100);
                "Cost Type (Price)"::Plant: SurchargeFactorPrice := SurchargeFactorPrice * (1 + ChildRecipe."Recipe Surcharge % Plant"/100);
                "Cost Type (Price)"::Sundry: SurchargeFactorPrice := SurchargeFactorPrice * (1 + ChildRecipe."Recipe Surcharge % Sundry"/100);
              END;
            END ELSE BEGIN
              IF NOT EstLineRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line") THEN
                EstLineRec.INIT;  //take care: record may be not present in database when exploding recipe
              SurchargeFactorLabor := SurchargeFactorLabor * (1 + EstLineRec."Surcharge % Labor"/100);
              IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN
                SurchargeFactorPrice := SurchargeFactorPrice * (1 + EstLineRec."Recipe Surcharge % Material"/100);
              IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN
                SurchargeFactorPrice := SurchargeFactorPrice * (1 + EstLineRec."Recipe Surcharge % Subc."/100);
              IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN
                SurchargeFactorPrice := SurchargeFactorPrice * (1 + EstLineRec."Recipe Surcharge % Plant"/100);
              IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN
                SurchargeFactorPrice := SurchargeFactorPrice * (1 + EstLineRec."Recipe Surcharge % Sundry"/100);
            END;
          END;
        END;
      END;
      //C033781.en

      //C033315.sn
      IF "Cost Type (Price)" = "Cost Type (Price)"::" " THEN BEGIN
        IF ("Net Cost Price" <> 0) OR ("Net Sales Price" <> 0) THEN BEGIN
          IF "Recipe Header" THEN BEGIN
            //C033781: (not exploded child-recipe contains amount while Cost Type(Price) not filled)
            IF "Recipe Exploded" THEN
              TESTFIELD("Cost Type (Price)");
          END ELSE BEGIN
            TESTFIELD("Cost Type (Price)");  //take care with ExplodeRecipe
          END;
        END;
      END;
      //C033315.en

      //DP01047.sn
      IF "Production Rate" > 100000 THEN
        Hours := "Time Quantity" * Quantity / "Production Rate"
      ELSE
        Hours := "Time Quantity" * Quantity * Norm;
      IF "Production Rate (Sales)" > 100000 THEN
        "Hours (Sales)":= "Time Quantity" * "Quantity (Sales)" / "Production Rate (Sales)"
      ELSE
        "Hours (Sales)" := "Time Quantity" * "Quantity (Sales)" * "Norm (Sales)";
      //DP01047.en

      IF NOT EstLineRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line") THEN
        EstLineRec.INIT;

      IF ("Ignore Recipe Quantity" = TRUE) THEN BEGIN
        IF (EstLineRec.Quantity <> 0) THEN
          Hours := Hours / EstLineRec.Quantity;
        IF (EstLineRec."Quantity (Sales)" <> 0) THEN
          "Hours (Sales)" := "Hours (Sales)" / EstLineRec."Quantity (Sales)";
      END;

      "Original Hours" := Hours;

      IF "Rate Type" = "Rate Type"::Minuts THEN
        "Original Hours" := "Original Hours" * "Team Size" / 60;
      IF "Cum. Adj. Factor Hours" <> 0 THEN
        Hours := Hours * "Cum. Adj. Factor Hours";
      IF "Cum. Adj. Factor Hours (Sales)" <> 0 THEN  //DP00555
        "Hours (Sales)" := "Hours (Sales)" * "Cum. Adj. Factor Hours (Sales)";
      "Labor Cost Amount" := Hours * "Cost Rate";
      "Labor Cost Amount (FCY)" := Hours * "Cost Rate (FCY)";
      "Labor Sales Amount" := "Hours (Sales)" * "Sales Rate" * SurchargeFactorLabor;  //C033781
      "Labor Sales Amount (FCY)" := "Hours (Sales)" * "Sales Rate (FCY)" * SurchargeFactorLabor;  //C033781
      //DP00236.sn
      IF "Wage Component" <> '' THEN BEGIN
        WageCompRec.GetOverTimeFactors("Wage Component",OverTimeFactorCost, OverTimeFactorSales);
        IF OverTimeFactorCost <> 0 THEN BEGIN
          "Labor Cost Amount" := "Labor Cost Amount" * OverTimeFactorCost;
          "Labor Cost Amount (FCY)" := "Labor Cost Amount (FCY)" * OverTimeFactorCost;
        END;
        IF OverTimeFactorSales <> 0 THEN BEGIN
          "Labor Sales Amount" := "Labor Sales Amount" * OverTimeFactorSales;
          "Labor Sales Amount (FCY)" := "Labor Sales Amount (FCY)" * OverTimeFactorSales;
        END;
      END;
      //DP00236.en
      IF "Rate Type" = "Rate Type"::Minuts THEN BEGIN
        Hours := Hours * "Team Size" / 60;
        "Hours (Sales)" := "Hours (Sales)" * "Team Size" / 60;
      END;

      "Gross Amount" := "Time Quantity" * Quantity * "Gross Price";
      "Gross Amount (FCY)" := "Time Quantity" * Quantity * ExchangeAmtLCYToFCY("Gross Price", FALSE, TRUE, FALSE);
      "Net Cost Amount" := "Time Quantity" * Quantity * "Net Cost Price";
      "Net Cost Amount (FCY)" := "Time Quantity" * Quantity * ExchangeAmtLCYToFCY("Net Cost Price", FALSE, TRUE, FALSE);
      "Net Sales Amount" := "Time Quantity" * "Quantity (Sales)" * "Net Sales Price" * SurchargeFactorPrice;  //C033781
      "Net Sales Amount (FCY)" := "Time Quantity" * "Quantity (Sales)" * ExchangeAmtLCYToFCY("Net Sales Price", TRUE, TRUE, FALSE) * SurchargeFactorPrice;  //C033781

      //DP01047.sn
      IF (("Cost Type (Hours)" = "Cost Type (Hours)"::Subcontracting) AND ("Cost Type (Price)" = "Cost Type (Price)"::Subcontracting)) OR  //DP01676
         (("Cost Type (Hours)" = "Cost Type (Hours)"::Plant) AND ("Cost Type (Price)" = "Cost Type (Price)"::Plant)) THEN BEGIN  //C038168
        "Gross Amount" := Hours * "Gross Price";
        "Gross Amount (FCY)" := Hours * ExchangeAmtLCYToFCY("Gross Price", FALSE, TRUE, FALSE);
        "Net Cost Amount" := Hours * "Net Cost Price";
        "Net Cost Amount (FCY)" := Hours * ExchangeAmtLCYToFCY("Net Cost Price", FALSE, TRUE, FALSE);
        "Net Sales Amount" := "Hours (Sales)" * "Net Sales Price" * SurchargeFactorPrice;  //C033781
        "Net Sales Amount (FCY)" := "Hours (Sales)" * ExchangeAmtLCYToFCY("Net Sales Price", FALSE, TRUE, FALSE) * SurchargeFactorPrice;  //C033781
      END;
      //DP01047.en

      IF ("Ignore Recipe Quantity" = TRUE) THEN BEGIN
        IF (EstLineRec.Quantity <> 0) THEN BEGIN
          "Gross Amount" := "Gross Amount" / EstLineRec.Quantity;
          "Gross Amount (FCY)" := "Gross Amount (FCY)" / EstLineRec.Quantity;
          "Net Cost Amount" := "Net Cost Amount" / EstLineRec.Quantity;
          "Net Cost Amount (FCY)" := "Net Cost Amount (FCY)" / EstLineRec.Quantity;
        END;
        IF (EstLineRec."Quantity (Sales)" <> 0) THEN BEGIN
          "Net Sales Amount" := "Net Sales Amount" / EstLineRec."Quantity (Sales)";
          "Net Sales Amount (FCY)" := "Net Sales Amount (FCY)" / EstLineRec."Quantity (Sales)";
        END;
      END;
      "Original Net Amount" := "Net Cost Amount";
      "Original Gross Amount" := "Gross Amount";
      IF "Cum. Adj. Factor Price" <> 0 THEN BEGIN
        "Net Cost Amount" := "Net Cost Amount" * "Cum. Adj. Factor Price";
        "Net Cost Amount (FCY)" := "Net Cost Amount (FCY)" * "Cum. Adj. Factor Price";
        "Net Sales Amount" := "Net Sales Amount" * "Cum. Adj. Factor Price";
        "Net Sales Amount (FCY)" := "Net Sales Amount (FCY)" * "Cum. Adj. Factor Price";
        "Gross Amount" := "Gross Amount" * "Cum. Adj. Factor Price";
        "Gross Amount (FCY)" := "Gross Amount (FCY)" * "Cum. Adj. Factor Price";
      END;

      IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN BEGIN
        "Material Cost Amount" := "Net Cost Amount";
        "Material Cost Amount (FCY)" := "Net Cost Amount (FCY)";
        "Material Sales Amount" := "Net Sales Amount";
        "Material Sales Amount (FCY)" := "Net Sales Amount (FCY)";
      END ELSE BEGIN  //C012735
        "Material Cost Amount" := 0;
        "Material Cost Amount (FCY)" := 0;
        "Material Sales Amount" := 0;
        "Material Sales Amount (FCY)" := 0;
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN BEGIN
        "Subcontracting Cost Amount" := "Net Cost Amount";
        "Subcontr. Cost Amount (FCY)" := "Net Cost Amount (FCY)";
        "Subcontracting Sales Amount" := "Net Sales Amount";
        "Subcontr. Sales Amount (FCY)" := "Net Sales Amount (FCY)";
      END ELSE BEGIN  //C012735
        "Subcontracting Cost Amount" := 0;
        "Subcontr. Cost Amount (FCY)" := 0;
        "Subcontracting Sales Amount" := 0;
        "Subcontr. Sales Amount (FCY)" := 0;
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN BEGIN
        "Plant Cost Amount" := "Net Cost Amount";
        "Plant Cost Amount (FCY)" := "Net Cost Amount (FCY)";
        "Plant Sales Amount" := "Net Sales Amount";
        "Plant Sales Amount (FCY)" := "Net Sales Amount (FCY)";
      END ELSE BEGIN  //C012735
        "Plant Cost Amount" := 0;
        "Plant Cost Amount (FCY)" := 0;
        "Plant Sales Amount" := 0;
        "Plant Sales Amount (FCY)" := 0;
      END;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN BEGIN
        "Sundry Cost Amount" := "Net Cost Amount";
        "Sundry Cost Amount (FCY)" := "Net Cost Amount (FCY)";
        "Sundry Sales Amount" := "Net Sales Amount";
        "Sundry Sales Amount (FCY)" := "Net Sales Amount (FCY)";
      END ELSE BEGIN  //C012735
        "Sundry Cost Amount" := 0;
        "Sundry Cost Amount (FCY)" := 0;
        "Sundry Sales Amount" := 0;
        "Sundry Sales Amount (FCY)" := 0;
      END;

      "Cost Amount" := "Labor Cost Amount" + "Net Cost Amount";
      "Cost Amount (FCY)" := "Labor Cost Amount (FCY)" + "Net Cost Amount (FCY)";
      "Sales Amount" := "Labor Sales Amount" + "Net Sales Amount";
      "Sales Amount (FCY)" := "Labor Sales Amount (FCY)" + "Net Sales Amount (FCY)";

      "Total Weight" := ROUND(Quantity * Weight);
      "Buy Back Amount" := ROUND(Quantity * "Buy Back Price");
      "Buy Back Amount (FCY)" := ROUND(Quantity * ExchangeAmtLCYToFCY("Buy Back Price", FALSE, TRUE, FALSE));

      UpdateCumTotals(EstLineRec);

      IF CurrFieldNo <> 0 THEN
        UpdateEstLines;  //moved from OnValidate several fields (as Quantity, Norm, Price)

      IF "Surcharge Type" <> "Surcharge Type"::" " THEN BEGIN
        Quantity := 1;
        "Quantity (Sales)" := 1;
      END;

      //C033781.sn
      IF "Recipe (Child)" <> '' THEN BEGIN
        "Surcharge % Labor" := SaveRecipeLine."Surcharge % Labor";
        IF "Recipe Header" THEN
          "Surcharge % Price" := 0;
        "Recipe Surcharge % Material" := SaveRecipeLine."Recipe Surcharge % Material";
        "Recipe Surcharge % Subc." := SaveRecipeLine."Recipe Surcharge % Subc.";
        "Recipe Surcharge % Plant" := SaveRecipeLine."Recipe Surcharge % Plant";
        "Recipe Surcharge % Sundry" := SaveRecipeLine."Recipe Surcharge % Sundry";
        Norm := SaveRecipeLine.Norm;
        "Production Rate" := SaveRecipeLine."Production Rate";
      END;
      //C033781.en

      //C044680.sn
      IF "Attached to Line No." <> 0 THEN BEGIN
        Quantity := SaveRecipeLine2.Quantity;
        "Quantity (Sales)" := SaveRecipeLine2."Quantity (Sales)";
      END;
      //C044680.en

      "Deviating Sales Quantity" := (Quantity <> "Quantity (Sales)");  //C020959
    END;

    PROCEDURE CalculateQuantity@11012000();
    VAR
      lv1@1210190000 : Decimal;
      lv2@1210190001 : Decimal;
      lv3@1210190002 : Decimal;
      BaseQuantity@1100527200 : Decimal;
    BEGIN
      lv1 := Length;
      lv2 := Width;
      lv3 := Height;
      BaseQuantity := "Base Quantity";

      IF Length = 0 THEN lv1 := 1;
      IF Width = 0 THEN lv2 := 1;
      IF Height = 0 THEN lv3 := 1;
      IF BaseQuantity = 0 THEN BaseQuantity := 1;

      VALIDATE(Quantity, lv1 * lv2 * lv3 * BaseQuantity);
    END;

    LOCAL PROCEDURE CalculateQuantityScalingFactor@1100527200();
    VAR
      ScalingFactor@1100527201 : Decimal;
    BEGIN
      ScalingFactor := "Scaling Factor";

      IF ScalingFactor = 0 THEN ScalingFactor := 1;

      VALIDATE(Quantity, "Base Quantity" / ScalingFactor);
    END;

    LOCAL PROCEDURE ScalingFactorIsEmpty@1100527214();
    BEGIN
      TESTFIELD("Scaling Factor", 0);
    END;

    PROCEDURE CalculateNetPrice@13();
    BEGIN
      VALIDATE("Net Cost Price","Gross Price" - (("Gross Price"/100) * "Purchase Discount %"));
      VALIDATE("Net Sales Price","Gross Price" - (("Gross Price"/100) * "Sales Discount %"));
    END;

    PROCEDURE CalculateDiscount@1210190012(SalesBln@1100528900 : Boolean);
    BEGIN
      IF "Gross Price" <> 0 THEN BEGIN
        IF  ("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Purchase Discount %" = 0) THEN BEGIN
          "Gross Price" := "Net Cost Price";
          "Gross Price (FCY)" := "Net Cost Price (FCY)";
          IF NOT SalesBln THEN
            VALIDATE("Net Sales Price","Gross Price" - (("Gross Price"/100) * "Sales Discount %"));
        END ELSE BEGIN
          IF SalesBln THEN
            "Sales Discount %" := (("Gross Price" - "Net Sales Price") / "Gross Price") * 100
          ELSE
            "Purchase Discount %" := (("Gross Price" - "Net Cost Price") / "Gross Price") * 100;
        END;
      END ELSE BEGIN
        IF NOT SalesBln THEN BEGIN
          IF "Purchase Discount %" = 0 THEN BEGIN
            "Gross Price" := "Net Cost Price";
            "Gross Price (FCY)" := "Net Cost Price (FCY)";
            VALIDATE("Net Sales Price","Gross Price" - (("Gross Price"/100) * "Sales Discount %"));
          END;
        END;
        IF "Purchase Discount %" <> 100 THEN BEGIN
          IF NOT (("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Purchase Discount %" = 0)) THEN BEGIN
            "Gross Price" := "Net Cost Price" / ((100 - "Purchase Discount %") / 100);
            "Gross Price (FCY)" := "Net Cost Price (FCY)" / ((100 - "Purchase Discount %") / 100);
          END
        END ELSE BEGIN
          "Gross Price" := "Net Cost Price";
          "Gross Price (FCY)" := "Net Cost Price (FCY)";
        END;
      END;
    END;

    PROCEDURE CalculateGrossPrice@1100485000();
    BEGIN
      IF "Purchase Discount %" <> 100 THEN BEGIN
        "Gross Price" := "Net Cost Price" * 100 / (100 - "Purchase Discount %");
        "Gross Price (FCY)" := "Net Cost Price (FCY)" * 100 / (100 - "Purchase Discount %");
      END;
    END;

    PROCEDURE UpdateCumTotals@1210190001(EstLineRec@1210190000 : Record 11072072);
    BEGIN
      "Cumulative Hours" := Hours * EstLineRec.Quantity * EstLineRec."Part Quantity";
      "Cumulative Labor" := "Labor Cost Amount" * EstLineRec.Quantity * EstLineRec."Part Quantity";
      "Cumulative Net Amount" := "Net Cost Amount" * EstLineRec.Quantity * EstLineRec."Part Quantity";
      "Cumulative Buy Back" := "Buy Back Amount" * EstLineRec.Quantity * EstLineRec."Part Quantity";
      "Cumulative Weight" := "Total Weight" * EstLineRec.Quantity * EstLineRec."Part Quantity";
      //DP00381:
      //C035725 (use Quantity (Sales))
      "Cumulative Hours (Sales)" := "Hours (Sales)" * EstLineRec."Quantity (Sales)" * EstLineRec."Part Quantity";
      "Cumulative Labor (Sales)" := "Labor Sales Amount" * EstLineRec."Quantity (Sales)" * EstLineRec."Part Quantity";
      "Cumulative Net Amount (Sales)" := "Net Sales Amount" * EstLineRec."Quantity (Sales)" * EstLineRec."Part Quantity";
    END;

    PROCEDURE UpdateEstLines@2();
    VAR
      EstLineRec@11012000 : Record 11072072;
      EstimateLineOriginal@1210190005 : Record 11072072;
    BEGIN
      //DP00381
      IF EstLineRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line") THEN BEGIN
        IF EstLineRec.Recipe = '' THEN
          EXIT;
        EstimateLineOriginal := EstLineRec;
        EstLineRec.CalculateTotals;
        IF FORMAT(EstLineRec) <> FORMAT(EstimateLineOriginal) THEN
          EstLineRec.MODIFY;
        //check for surcharges over recipe lines in estimate (after update)
        EstLineRec.CheckEstimateCharge;
      END;
    END;

    PROCEDURE ValidateItem@3(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item,Trade Vendor';lvEstRec@1210190000 : Record 11012151;lvSwitchItem@1210190001 : Boolean);
    VAR
      lvRefDate@1100485001 : Date;
      lvItemOper@1100485002 : Code[20];
    BEGIN
      IF lvSwitchItem = TRUE THEN BEGIN
        "Price Agreement" := FALSE;
        "Price Agreement (Sales)" := FALSE;  //DP00381
      END;

      IF ("Purchase Route Reference" = '') AND ("Price Agreement" = FALSE) THEN BEGIN
        CalcItemCostPriceAndDiscount(lvEstRec, LTypeArtOpt);  //C013433
        IF "Cost Object Price" <> xRec."Cost Object Price" THEN
          GetDefaultsCostObject("Cost Type (Price)", "Cost Object Price");

        ClearFields(2); //Buyback
        IF LTypeArtOpt = LTypeArtOpt::Item THEN BEGIN
          IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
          IF ItemRec."Sales/Buy-Back Item (Plant)" THEN BEGIN
            lvRefDate := ValidateCu.GetRefDateEstimate(lvEstRec);
            ValidateCu.GetSalesBuyBackRates("Item No.", lvEstRec."Plant Location",lvRefDate,
              "Gross Price","Buy Back Price");
            //C061014.sn
            IF lvEstRec."Item Sales Price Based On" = lvEstRec."Item Sales Price Based On"::GrossMin THEN
              "Net Sales Price" := "Gross Price";
            //C061014.en
            VALIDATE("Buy Back Price");
            VALIDATE("Net Cost Price");
          END;
        END;
      END;
      IF ("Purchase Route Reference" = '') AND ("Price Agreement (Sales)" = FALSE) THEN BEGIN  //C018758
        CalcItemSalesPriceAndDiscount(lvEstRec);  //C013433
      END;

      IF lvSwitchItem = TRUE THEN BEGIN
        InitSurcharge(TRUE);
        CheckSurchargeMaterialPrice;  //C005338
        lvItemOper := '';  //provisionally operation not saved per basis/trade item
        IF ItemRec.GET("Item No.") THEN BEGIN
          CopyItemText;  //DP00686
          IF ItemRec.Text <> '' THEN
            VALIDATE("External Text", ItemRec.Text);
          lvItemOper := ItemRec."Sub Operation Code";
        END;

        IF "Rate Code" = '' THEN BEGIN
          IF EstPartRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN
            IF EstPartRec."Rate Code" <> '' THEN
              "Rate Code" := EstPartRec."Rate Code"
            ELSE
              IF SubEstRec.GET("Estimate No.", "Sub-Estimate No.") THEN
                IF SubEstRec."Rate Code" <> '' THEN
                  "Rate Code" := SubEstRec."Rate Code"
                ELSE
                  "Rate Code" := lvEstRec."Rate Code";
          IF "Rate Code" <> '' THEN
            VALIDATE("Rate Code");
        END;

        CASE LTypeArtOpt OF
          LTypeArtOpt::Item:
            BEGIN
              IF NOT ItemRec.GET("Item No.") THEN ItemRec.INIT;
              IF ItemRec.Blocked THEN BEGIN
                IF SkipBlockedItem THEN
                  MESSAGE(TABLECAPTION + ': ' + Description + '\' +
                    ItemRec.TABLECAPTION + ' ' + "Item No." + '='  + ItemRec.FIELDCAPTION(Blocked))
                ELSE
                  ItemRec.TESTFIELD(Blocked,FALSE);
              END;
              Weight := ItemRec.Weight;
            END;
          LTypeArtOpt::"Basic Item":
            BEGIN
              IF NOT BasicItemRec.GET(Manufacturer, "Basic Item") THEN BasicItemRec.INIT;
              IF BasicItemRec.Expired THEN BEGIN
                IF SkipBlockedItem THEN
                  MESSAGE(TABLECAPTION + ': ' + Description + '\' +
                    BasicItemRec.TABLECAPTION + ' ' + "Basic Item" + '='  + BasicItemRec.FIELDCAPTION(Expired))
                ELSE
                   BasicItemRec.TESTFIELD(Expired,FALSE);
              END;
              Weight := BasicItemRec."Net Weight";
              IF BasicItemRec."Sub Operation Code" <> '' THEN
                lvItemOper := BasicItemRec."Sub Operation Code";
            END;
          LTypeArtOpt::"Trade Item",
          LTypeArtOpt::"Trade Vendor":
            BEGIN
              IF NOT TradeItemRec.GET("Vendor (Trade Item)", "Trade Item") THEN TradeItemRec.INIT;
              IF TradeItemRec.Expired THEN BEGIN
                IF SkipBlockedItem THEN
                  MESSAGE(TABLECAPTION + ': ' + Description + '\' +
                    TradeItemRec.TABLECAPTION + ' ' + "Trade Item" + '='  + TradeItemRec.FIELDCAPTION(Expired))
                ELSE
                  TradeItemRec.TESTFIELD(Expired,FALSE);
              END;
              Weight := TradeItemRec."Gross Weight";
              IF TradeItemRec."Sub Operation Code" <> '' THEN
                lvItemOper := TradeItemRec."Sub Operation Code";
            END;
        END;
        IF lvItemOper <> '' THEN   //(problem at replacing trade item as a result of preferred vendor)
          VALIDATE("Sub Operation Code", lvItemOper);
      END;

      CalculateTotals;
    END;

    PROCEDURE CalcItemCostPriceAndDiscount@1100525011(lvEstRec@1100525005 : Record 11012151;LTypeArtOpt@1100525006 : 'Item,Basic Item,Trade Item,Trade Vendor');
    VAR
      lvRefDate@1100525003 : Date;
      lvDiscRef1@1100525002 : Code[20];
      lvDiscRef2@1100525001 : Code[20];
      lvRefPrio@1100525000 : Code[10];
      lvDiscType@1100525004 : 'Purchase,Sales';
      Desc1Txt@1100525008 : Text[50];
      Desc2Txt@1100525007 : Text[50];
    BEGIN
      //C013433
      IF "Price Agreement" THEN EXIT;  //C030087
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2, lvEstRec, lvDiscType::Purchase);
      lvRefPrio := ValidateCu.GetRefPrioEstimate(lvEstRec, lvDiscType::Purchase);
      IF GetSubEstimate("Estimate No.", "Sub-Estimate No.", TRUE) THEN
        ValidateCu.SetLanguageCode(SubEstRec."Language Code");

      ValidateCu.ValidateItem(
        LTypeArtOpt, "Trade Item", "Item No.", Manufacturer, "Vendor (Trade Item)", "Basic Item",
        "Cost Object Price", Desc1Txt, "Unit of Measure", "Net Cost Price",
        "Purchase Discount %", "Price Reference Date", "Gross Price", Desc2Txt, "Cost Component",
        lvDiscRef1, lvDiscRef2, lvRefDate, lvRefPrio);

      IF LTypeArtOpt = LTypeArtOpt::"Trade Item" THEN
        "Price History 0 Exists" := ValidateCu.PriceHistory0Exists("Trade Item", "Vendor (Trade Item)", lvRefDate)
      ELSE
        "Price History 0 Exists" := FALSE;

      IF Desc2Txt = '' THEN
        Description := Desc1Txt
      ELSE
        Description := COPYSTR((Desc1Txt + '\' + Desc2Txt), 1, MAXSTRLEN(Description));

      EstRec := lvEstRec;  //C032335: tmp-table used in CopyMgt (problem with BasedOn)
      VALIDATE("Gross Price");
    END;

    PROCEDURE CalcItemSalesPriceAndDiscount@1100525010(lvEstRec@1100525005 : Record 11012151);
    VAR
      lvRefDate@1100525003 : Date;
      lvDiscRef1@1100525002 : Code[20];
      lvDiscRef2@1100525001 : Code[20];
      lvRefPrio@1100525000 : Code[10];
      lvDiscType@1100525004 : 'Purchase,Sales';
    BEGIN
      //C013433
      IF "Price Agreement (Sales)" THEN EXIT;  //C030087
      //C061014.sn
      IF ItemRec.GET("Item No.") THEN
        IF ItemRec."Sales/Buy-Back Item (Plant)" THEN EXIT;
      //C061014.en
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2, lvEstRec, lvDiscType::Sales);
      lvRefPrio := ValidateCu.GetRefPrioEstimate(lvEstRec, lvDiscType::Sales);
      "Sales Condition Present" := ValidateCu.GetSalesDiscount(  //C015604
        lvEstRec."Customer No.", "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
        "Net Sales Price", "Sales Discount %", "Gross Price", lvRefDate, lvEstRec."Customer Disc. Group",
        lvDiscRef1, lvDiscRef2, lvRefPrio);

      IF lvEstRec."Item Sales Price Based On" = lvEstRec."Item Sales Price Based On"::CostPrice THEN BEGIN
        EstRec := lvEstRec;  //(solves problem with GetEstimate in next function)
        UpdateSalesPriceFromCostPrice;  //C014487
      END;
    END;

    PROCEDURE UpdateSalesPriceFromCostPrice@1100525026();
    BEGIN
      //C014487
      IF NOT SkipReadEstimate THEN  //C038554
        GetEstimate("Estimate No.", FALSE);
      IF EstRec."Item Sales Price Based On" = EstRec."Item Sales Price Based On"::GrossMin THEN EXIT;

      IF "Surcharge Type" <> "Surcharge Type"::" " THEN EXIT;  //C044963
      IF "Price Agreement (Sales)" THEN EXIT;
      //DP01243.sn
      IF EstRec."Apply SalesPrice for SurchMat" AND "Sales Condition Present" THEN EXIT;  //C034137
      //DP01243.en

      "Sales Discount %" := 0;
      "Net Sales Price" := "Net Cost Price";
      "Net Sales Price (FCY)" := ExchangeAmtLCYToFCY("Net Sales Price", TRUE, TRUE, FALSE);
    END;

    PROCEDURE DetermineNormGroup@4();
    BEGIN
      IF "Norm Group" = '' THEN BEGIN
        IF GetEstPart THEN
          IF EstPartRec."Norm Group" = '' THEN BEGIN
            IF GetSubEstimate("Estimate No.", "Sub-Estimate No.", TRUE) THEN
              IF SubEstRec."Norm Group" = '' THEN BEGIN
                GetEstimate("Estimate No.", TRUE);
                IF EstRec."No." = "Estimate No." THEN
                  "Norm Group" := EstRec."Norm Group";
              END ELSE
                "Norm Group" := SubEstRec."Norm Group";
          END ELSE
            "Norm Group" := EstPartRec."Norm Group";
      END;

      IF "Norm Group (Sales)" = '' THEN BEGIN  //DP00381
        IF GetEstPart THEN
          IF EstPartRec."Norm Group (Sales)" = '' THEN BEGIN
            IF GetSubEstimate("Estimate No.", "Sub-Estimate No.", TRUE) THEN
              IF SubEstRec."Norm Group (Sales)" = '' THEN BEGIN
                GetEstimate("Estimate No.", TRUE);
                IF EstRec."No." = "Estimate No." THEN
                  "Norm Group (Sales)" := EstRec."Norm Group (Sales)";
              END ELSE
                "Norm Group (Sales)" := SubEstRec."Norm Group (Sales)";
          END ELSE
            "Norm Group (Sales)" := EstPartRec."Norm Group (Sales)";
      END;
    END;

    PROCEDURE DetermineNorm@7();
    VAR
      NormRec@11012000 : Record 11012163;
    BEGIN
      IF (NormRec."Sub Operation Code" <> "Sub Operation Code") OR (NormRec."Norm Group" <> "Norm Group") THEN
        NormPresent := NormRec.GET("Sub Operation Code","Norm Group");
      IF NormPresent THEN BEGIN
        VALIDATE(Norm, NormRec.Norm);
        ConvertNorm(FALSE, FALSE);
      END ELSE BEGIN
        IF ("Norm Group" <> '') AND ("Sub Operation Code" <> '') THEN BEGIN
          VALIDATE(Norm, 0);
        END;
      END;
      CalculateTotals;
    END;

    PROCEDURE DetermineNormSales@1100528902();
    VAR
      NormRec@11012000 : Record 11012163;
    BEGIN
      //DP00381
      IF NormRec.GET("Sub Operation Code","Norm Group (Sales)") THEN BEGIN
        VALIDATE("Norm (Sales)", NormRec.Norm);
        ConvertNormSales(FALSE, FALSE);
      END ELSE BEGIN
        IF ("Norm Group (Sales)" <> '') AND ("Sub Operation Code" <> '') THEN BEGIN
          VALIDATE("Norm (Sales)", 0);
        END;
      END;
      CalculateTotals;
    END;

    PROCEDURE ConvertNorm@1210190002(SwitchType@1210190001 : Boolean;SwitchSize@1210190002 : Boolean);
    VAR
      NormGrpRec@1210190000 : Record 11012164;
    BEGIN
      IF (SwitchType = FALSE) AND (SwitchSize = FALSE) THEN BEGIN
        IF NormGrpRec.Code <> "Norm Group" THEN
          NormGroupPresent := NormGrpRec.GET("Norm Group");
        IF NormGroupPresent THEN BEGIN
          IF NormGrpRec."Rate Type" <> "Rate Type" THEN
            SwitchType := TRUE;
          IF NormGrpRec."Team Size" <> "Team Size" THEN BEGIN
            SwitchSize := TRUE;
            xRec."Team Size" := NormGrpRec."Team Size";
          END;
        END;
      END;

      IF SwitchType = TRUE THEN
        IF "Rate Type" = "Rate Type"::Hours THEN
          Norm := Norm / 60
        ELSE
          Norm := Norm * 60;

      IF SwitchSize = TRUE THEN BEGIN
        IF "Team Size" <> 0 THEN
          Norm := Norm / "Team Size";
        IF xRec."Team Size" <> 0 THEN
          Norm := Norm * xRec."Team Size";
      END;

      IF SwitchType OR SwitchSize THEN
        IF Norm <> 0 THEN
          "Production Rate" := 1 / Norm
        ELSE
          "Production Rate" := 0;
    END;

    PROCEDURE ConvertNormSales@1100528903(SwitchType@1210190001 : Boolean;SwitchSize@1210190002 : Boolean);
    VAR
      NormGrpRec@1210190000 : Record 11012164;
    BEGIN
      //DP00381
      IF (SwitchType = FALSE) AND (SwitchSize = FALSE) THEN BEGIN
        IF NormGrpRec.GET("Norm Group (Sales)") THEN BEGIN
          IF NormGrpRec."Rate Type" <> "Rate Type" THEN
            SwitchType := TRUE;
          IF NormGrpRec."Team Size" <> "Team Size" THEN BEGIN
            SwitchSize := TRUE;
            xRec."Team Size" := NormGrpRec."Team Size";
          END;
        END;
      END;

      IF SwitchType = TRUE THEN
        IF "Rate Type" = "Rate Type"::Hours THEN
          "Norm (Sales)" := "Norm (Sales)"/ 60
        ELSE
          "Norm (Sales)" := "Norm (Sales)" * 60;

      IF SwitchSize = TRUE THEN BEGIN
        IF "Team Size" <> 0 THEN
          "Norm (Sales)" := "Norm (Sales)" / "Team Size";
        IF xRec."Team Size" <> 0 THEN
          "Norm (Sales)" := "Norm (Sales)" * xRec."Team Size";
      END;

      IF SwitchType OR SwitchSize THEN
        IF "Norm (Sales)" <> 0 THEN
          "Production Rate (Sales)" := 1 / "Norm (Sales)"
        ELSE
          "Production Rate (Sales)" := 0;
    END;

    PROCEDURE HandleLookupOperationNorm@1100528901(SalesBln@1100409000 : Boolean) lvRefresh : Boolean;
    VAR
      NormGroupFrm@1100528902 : Page 11012174;
      SubOperationCode@1100528900 : Code[20];
    BEGIN
      //DP00381
      IF ("Recipe (Child)" <> '') OR ("Surcharge Type" <> "Surcharge Type"::" ") THEN EXIT;

      CLEAR(NormGroupFrm);
      IF SalesBln THEN BEGIN
        NormGroupFrm.SetSubOperation("Sub Operation Code");
        NormGroupFrm.RUNMODAL;  //read only
        EXIT;
      END;
      NormGroupFrm.SetSelection(DATABASE::"Estimate Recipe Line","Estimate No.","Sub-Estimate No.",
        "Part Group",Part,"Estimate Line","Recipe Group",Recipe);
      NormGroupFrm.SetSubOperation("Sub Operation Code");
      NormGroupFrm.LOOKUPMODE(TRUE);
      IF NormGroupFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
        lvRefresh := NormGroupFrm.ApplySelection;
        IF lvRefresh = FALSE THEN BEGIN
          NormGroupFrm.GetSubOperation(SubOperationCode);
          IF SubOperationCode <> '' THEN BEGIN
            VALIDATE("Sub Operation Code", SubOperationCode);
            ProcessSubOperation;  //C013489
          END;
        END;
      END;

      EXIT(lvRefresh);
    END;

    PROCEDURE HandleLookupRecipe@1100529400() lvRefresh : Boolean;
    VAR
      RecipeFrm@1100528903 : Page 11125073;
      RecipeRec@1100528902 : Record 11020581;
    BEGIN
      //DP01183
      IF ("Item No." <> '') OR ("Basic Item" <> '') OR ("Trade Item" <> '') OR
         ("Surcharge Type" <> "Surcharge Type"::" ")
      THEN EXIT;

      CLEAR(RecipeFrm);
      RecipeFrm.LOOKUPMODE(TRUE);
      RecipeFrm.SetSelection(DATABASE::"Estimate Recipe Line",
        "Estimate No.","Sub-Estimate No.","Part Group",Part,"Recipe Group",Recipe,'','','',TRUE,"Estimate Line");

      RecipeRec.RESET;
      IF "Recipe Group (Child)" = '' THEN
        RecipeRec.SETRANGE("Recipe Group","Recipe Group")  //C046429: search in same group as parent
      ELSE
        RecipeRec.SETRANGE("Recipe Group","Recipe Group (Child)");
      IF RecipeRec.GET("Recipe Group (Child)","Recipe (Child)") THEN
        RecipeFrm.SETRECORD(RecipeRec);
      RecipeFrm.SETTABLEVIEW(RecipeRec);
      IF RecipeFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
        RecipeFrm.GETRECORD(RecipeRec);
        "Recipe Group (Child)" := RecipeRec."Recipe Group";
        VALIDATE("Recipe (Child)", RecipeRec."No.");
      END ELSE BEGIN
        lvRefresh := RecipeFrm.CheckMultiCopy;
      END;

      EXIT(lvRefresh);
    END;

    PROCEDURE HandleLookupItem@1100525003(iFieldNo@1100525004 : Integer) lvRefresh : Boolean;
    VAR
      ItemRec@1100525012 : Record 27;
      BasicItemRec@1100525011 : Record 11012316;
      TradeItemRec@1100525010 : Record 11012317;
      ItemFrm@1100525009 : Page 31;
      BasicItemFrm@1100525008 : Page 11012333;
      TradeItemFrm@1100525007 : Page 11012334;
      RefDate@1100525003 : Date;
      PurchDiscRef1@1100525002 : Code[20];
      PurchDiscRef2@1100525001 : Code[20];
      DiscType@1100525000 : 'Purchase,Sales';
      TempRecipeLine@1100525005 : TEMPORARY Record 11072075;
      g_ItemCode@1100525014 : Code[20];
      g_Vendor@1100525013 : Code[20];
      SalesDiscRef1@1100528901 : Code[20];
      SalesDiscRef2@1100528900 : Code[20];
    BEGIN
      IF "Recipe Header"  THEN EXIT;  //C013896

      GetEstimate("Estimate No.", TRUE);
      GetReferenceData(RefDate, PurchDiscRef1, PurchDiscRef2, EstRec, DiscType::Purchase);

      IF Rec."Line No." <> xRec."Line No." THEN  //C041964
        xRec.INIT;  //required OnValidate (Trade) Item

      IF iFieldNo = FIELDNO("Item No.") THEN BEGIN
        CLEAR(ItemFrm);
        ItemFrm.LOOKUPMODE(TRUE);
        ItemFrm.DetermineInterface(DATABASE::"Estimate Recipe Line","Estimate No.","Sub-Estimate No.",
          Part,Recipe,"Estimate Line","Recipe Group","Part Group","Line No.",'','');

        IF ItemRec.GET("Item No.") THEN
          ItemFrm.SETRECORD(ItemRec);

        IF ItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          ItemFrm.GETRECORD(ItemRec);
          VALIDATE("Item No.", ItemRec."No.");
        END ELSE BEGIN
          lvRefresh := ItemFrm.CheckMultiCopy;
        END;
      END;

      IF iFieldNo = FIELDNO("Basic Item") THEN BEGIN
        CLEAR(BasicItemFrm);
        BasicItemFrm.LOOKUPMODE(TRUE);
        BasicItemFrm.SetSelection(DATABASE::"Estimate Recipe Line","Estimate No.","Sub-Estimate No.",
          Part,Recipe,"Estimate Line","Recipe Group","Part Group","Line No.",'','');

        BasicItemFrm.SetReference(RefDate, PurchDiscRef1, PurchDiscRef2);

        BasicItemRec.InitLookup(BasicItemRec, "Basic Item", Manufacturer);
        BasicItemFrm.SETRECORD(BasicItemRec);

        IF BasicItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          BasicItemFrm.GETRECORD(BasicItemRec);
          Manufacturer := BasicItemRec.Manufacturer;
          VALIDATE("Basic Item", BasicItemRec."Product Code");
        END ELSE BEGIN
          lvRefresh :=  BasicItemFrm.CheckMultiCopy;
        END;
      END;

      IF iFieldNo = FIELDNO("Trade Item") THEN BEGIN
        IF "Item No." <> '' THEN BEGIN
          TempRecipeLine.COPY(Rec);
          TempRecipeLine.VALIDATE("Item No.","Item No.");
          g_ItemCode := TempRecipeLine."Trade Item";
          g_Vendor := TempRecipeLine."Vendor (Trade Item)";
        END ELSE BEGIN
          g_ItemCode := '';
          g_Vendor := '';
        END;
        //C051377.sn
        IF "Vendor (Trade Item)" = '' THEN BEGIN
          EstRec.GET("Estimate No.");
          EstRec.CALCFIELDS("Vendor (Trade Item)");
          "Vendor (Trade Item)" := EstRec."Vendor (Trade Item)";
        END;
        //C051377.en

        CLEAR(TradeItemFrm);
        TradeItemFrm.LOOKUPMODE(TRUE);
        TradeItemFrm.SetSelection(DATABASE::"Estimate Recipe Line",
          "Estimate No.", "Sub-Estimate No.", Part, Recipe, "Estimate Line",
          "Recipe Group", "Part Group", "Line No.", '', '',
          "Vendor (Trade Item)", "Trade Item", Manufacturer, "Basic Item", g_ItemCode, g_Vendor);

        TradeItemFrm.SetReference(RefDate, PurchDiscRef1, PurchDiscRef2);
        //DP02213.sn
        ValidateCu.GetRefDiscEstimate(EstRec, SalesDiscRef1, SalesDiscRef2, DiscType::Sales);
        TradeItemFrm.SetReferenceSales(SalesDiscRef1, SalesDiscRef2);
        //DP02213.en

        TradeItemRec.InitLookup(TradeItemRec, "Basic Item", Manufacturer, "Trade Item", "Vendor (Trade Item)");
        TradeItemFrm.SETRECORD(TradeItemRec);

        IF TradeItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          TradeItemFrm.GETRECORD(TradeItemRec);
          Manufacturer := TradeItemRec.Manufacturer;
          "Basic Item" := TradeItemRec."Product Code";
          "Vendor (Trade Item)" := TradeItemRec.Vendor;
          VALIDATE("Trade Item", TradeItemRec."Item Code");
        END ELSE BEGIN
          lvRefresh := TradeItemFrm.CheckMultiCopy;
        END;
      END;

      EXIT(lvRefresh);
    END;

    PROCEDURE HandleAssistEditItem@1100528300(lvFieldNo@1210190000 : Integer) lvRefresh : Boolean;
    VAR
      WebshopItemMgt@1100528300 : Codeunit 11012306;
      RecRef@1100528301 : RecordRef;
    BEGIN
      IF lvFieldNo = FIELDNO("Trade Item") THEN BEGIN
        RecRef.GETTABLE(Rec);
        WebshopItemMgt.RunModalDialogForMultipleItems("Vendor (Trade Item)", "Trade Item", RecRef);
        lvRefresh := TRUE;
      END;
    END;

    PROCEDURE HandleLookupUnit@1210190008();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";
        VALIDATE("Unit of Measure", lvUnit);
      END;
    END;

    PROCEDURE CheckItemUnitConversion@1210190010(VAR MainNewRec@1210190006 : Record 11072075;MainOldRec@1210190007 : Record 11072075);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
      DummyFactor@1100525000 : Decimal;
    BEGIN
      WITH MainNewRec DO BEGIN
        UnitFactorOld := 1;
        UnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            Quantity,"Unit of Measure",UnitFactorNew);
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            "Quantity (Sales)","Unit of Measure",DummyFactor);  //C036708
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              Quantity,"Unit of Measure",UnitFactorNew);
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              "Quantity (Sales)","Unit of Measure",DummyFactor);  //C036708
          END ELSE BEGIN
            IF "Item No." <> '' THEN BEGIN
              ItemRec.GET("Item No.");
              UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, MainOldRec."Unit of Measure");
              UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, "Unit of Measure");
              UnitFactor := UnitFactorOld;
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                Quantity,"Unit of Measure",UnitFactor);
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                "Quantity (Sales)","Unit of Measure",DummyFactor);  //C036708
            END;
          END;
        END;
        IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
          IF UnitFactorNew <> UnitFactorOld THEN BEGIN
            VALIDATE("Gross Price", ("Gross Price" * UnitFactorNew / UnitFactorOld));
            VALIDATE(Weight,(Weight * UnitFactorNew / UnitFactorOld));
          END;
        END;
      END;
    END;

    PROCEDURE CreateCharge@1100485005();
    VAR
      RecipeLine@1100485004 : Record 11072075;
      ChrgRec@11012000 : Record 11229771;
      ChrgLine@11012001 : Integer;
      ChrgDesc@11012002 : Text[100];
      lvText001@1100485003 : TextConst 'ENU=Current line is not a surcharge line.;NOR=Aktuell rad er ikke en tilleggsgebyrsrad.;SVE=Aktuell rad Ñr inte en tillÑggsavgiftrad.';
      lvText003@1100485001 : TextConst 'ENU=Are these recipe lines the basis for calculating surcharge for %1 ?;NOR=Utgjõr disse malrader Beregningsunderlag for tilleggsgebyr for %1?;SVE=Utgîr dessa mallrader berÑkningsunderlag fîr tillÑggsavgift fîr %1?';
      lvText004@1100525000 : TextConst 'ENU=First select Lines;NOR=Velg rad(er) fõrst;SVE=VÑlj rader fîrst';
    BEGIN
      RecipeLine.COPY(Rec);

      WITH RecipeLine DO BEGIN
        ChrgLine := "Line No.";
        ChrgDesc := Description;
        IF "Surcharge Type" = "Surcharge Type"::" " THEN BEGIN
          MESSAGE(lvText001);
          EXIT;
        END;
        IF "Surcharge Type" = "Surcharge Type"::Labor THEN
          TESTFIELD("Rate Code");  //C049505

        SETFILTER("Surcharge Type", '%1', "Surcharge Type"::" ");
        SETFILTER("Line No.", '<>%1', "Line No.");

        IF NOT FINDFIRST THEN BEGIN
          MESSAGE(lvText004);
        END ELSE BEGIN
          IF CONFIRM(lvText003, TRUE, ChrgDesc) THEN BEGIN
            FINDSET(FALSE, FALSE);
            REPEAT;
              IF NOT ChrgRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line", 0, '', 0,  //DP00481
                                 "Recipe Group", Recipe, ChrgLine, "Line No.") THEN
              BEGIN
                ChrgRec.INIT;
                ChrgRec."Estimate No." := "Estimate No.";
                ChrgRec."Sub-Estimate No." := "Sub-Estimate No.";
                ChrgRec."Part Group" := "Part Group";
                ChrgRec.Part := Part;
                ChrgRec."Recipe Line" := "Estimate Line";
                ChrgRec."Recipe Group" := "Recipe Group";
                ChrgRec.Recipe := Recipe;
                ChrgRec."Surcharge Line" := ChrgLine;
                ChrgRec."Basic Line" := "Line No.";
                ChrgRec.INSERT(TRUE);
              END;
            UNTIL NEXT = 0;
          END;
        END;
        MARKEDONLY(FALSE);
      END;

      CLEARMARKS;
    END;

    PROCEDURE CheckRecipeCharge@8();
    VAR
      ChrgRec1@11012000 : Record 11229771;
      ChrgRec2@11012001 : Record 11229771;
      RcpLineRec1@11012002 : Record 11072075;
      RcpLineRec2@11012003 : Record 11072075;
      RecipeLineOriginal@1210190000 : Record 11072075;
    BEGIN
      //read with current recipe line in surcharge table whether this is a basic line for surcharge lines.
      ChrgRec1.SETRANGE("Estimate No.", "Estimate No.");
      ChrgRec1.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      ChrgRec1.SETRANGE("Part Group", "Part Group");
      ChrgRec1.SETRANGE(Part, Part);
      ChrgRec1.SETRANGE("Recipe Line", "Estimate Line");
      ChrgRec1.SETRANGE("Recipe Group", "Recipe Group");
      ChrgRec1.SETRANGE(Recipe, Recipe);
      IF "Surcharge Type" <> "Surcharge Type"::" " THEN
        ChrgRec1.SETRANGE("Surcharge Line", "Line No.")
      ELSE
        ChrgRec1.SETRANGE("Basic Line", "Line No.");
      IF ChrgRec1.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          //make surcharge line in estimate current
          RcpLineRec2.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
            "Recipe Group", Recipe, ChrgRec1."Surcharge Line");
          RecipeLineOriginal := RcpLineRec2;
          RcpLineRec2.InitNormPrice;
          //check all basic lines in surcharge table for surcharge line
          ChrgRec2.COPY(ChrgRec1);
          ChrgRec2.SETRANGE("Surcharge Line", ChrgRec1."Surcharge Line");
          ChrgRec2.SETRANGE("Basic Line");
          IF ChrgRec2.FINDSET(FALSE, FALSE) THEN BEGIN
            REPEAT
              //determine Line Total per Cost Type for Basic Lines belonging to Surcharge
              IF RcpLineRec1.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
                 "Recipe Group", Recipe, ChrgRec2."Basic Line") THEN BEGIN
                IF RcpLineRec2."Surcharge Type" = RcpLineRec2."Surcharge Type"::Labor THEN BEGIN
                  RcpLineRec2.Norm := RcpLineRec2.Norm + RcpLineRec1.Hours;
                  RcpLineRec2."Norm (Sales)" := RcpLineRec2."Norm (Sales)" + RcpLineRec1."Hours (Sales)";
                END ELSE BEGIN
                  RcpLineRec2."Gross Price" := RcpLineRec2."Gross Price" + RcpLineRec1."Gross Amount";
                  RcpLineRec2."Net Cost Price" := RcpLineRec2."Net Cost Price" + RcpLineRec1."Net Cost Amount";
                  RcpLineRec2."Net Sales Price" := RcpLineRec2."Net Sales Price" + RcpLineRec1."Net Sales Amount";
                END;
              END;
            UNTIL ChrgRec2.NEXT = 0;
          END;
          //update surcharge line with totals by Cost Type of basic lines
          IF RcpLineRec2."Gross Price" <> 0 THEN BEGIN
            RcpLineRec2."Purchase Discount %" :=
              100 * (RcpLineRec2."Gross Price" - RcpLineRec2."Net Cost Price") / RcpLineRec2."Gross Price";
            RcpLineRec2."Sales Discount %" :=
              100 * (RcpLineRec2."Gross Price" - RcpLineRec2."Net Sales Price") / RcpLineRec2."Gross Price";
          END;
          IF RcpLineRec2."Surcharge Type" = RcpLineRec2."Surcharge Type"::Labor THEN BEGIN
            IF NOT RateRec.GET(RcpLineRec2."Estimate No.",RcpLineRec2."Rate Code") THEN
              RateRec.INIT;  //C036869
            IF RateRec."Rate Type" = RateRec."Rate Type"::Minuts THEN BEGIN
              RcpLineRec2.Norm := RcpLineRec2.Norm * 60;
              RcpLineRec2."Norm (Sales)" := RcpLineRec2."Norm (Sales)" * 60;
              IF RateRec."Team Size" <> 0 THEN BEGIN
                RcpLineRec2.Norm := RcpLineRec2.Norm / RateRec."Team Size";
                RcpLineRec2."Norm (Sales)" := RcpLineRec2."Norm (Sales)" / RateRec."Team Size";
              END;
            END;
            IF RcpLineRec2.Norm <> 0 THEN
              RcpLineRec2."Production Rate" := 1 / RcpLineRec2.Norm
            ELSE
              RcpLineRec2."Production Rate" := 0;
            IF RcpLineRec2."Norm (Sales)" <> 0 THEN
              RcpLineRec2."Production Rate (Sales)" := 1 / RcpLineRec2."Norm (Sales)"
            ELSE
              RcpLineRec2."Production Rate (Sales)" := 0;
          END;
          RcpLineRec2.CalculateTotals;
          IF FORMAT(RcpLineRec2) <> FORMAT(RecipeLineOriginal) THEN
            RcpLineRec2.MODIFY("Estimate No."='');   //(Central Mgt)
        UNTIL ChrgRec1.NEXT = 0;
      END;
    END;

    PROCEDURE CheckRecipeCharge2@1100525008(VAR ChrgRec1@1100525000 : Record 11229771);
    VAR
      ChrgRec2@11012001 : Record 11229771;
      RcpLineRec1@11012002 : Record 11072075;
      RcpLineRec2@11012003 : Record 11072075;
      RecipeLineOriginal@1210190000 : Record 11072075;
    BEGIN
      //filter based on tmp-table (called from EstLineRec)

      //read with current recipe line in surcharge table whether this is a basic line for surcharge lines.
      IF ChrgRec1.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          //make surcharge line in estimate current
          RcpLineRec2.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
            "Recipe Group", Recipe, ChrgRec1."Surcharge Line");
          RecipeLineOriginal := RcpLineRec2;
          RcpLineRec2.InitNormPrice;
          //check all basic lines in surcharge table for surcharge line
          ChrgRec2.SETRANGE("Estimate No.", "Estimate No.");
          ChrgRec2.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          ChrgRec2.SETRANGE("Part Group", "Part Group");
          ChrgRec2.SETRANGE(Part, Part);
          ChrgRec2.SETRANGE("Recipe Line", "Estimate Line");
          ChrgRec2.SETRANGE("Recipe Group", "Recipe Group");
          ChrgRec2.SETRANGE(Recipe, Recipe);
          ChrgRec2.SETRANGE("Surcharge Line", ChrgRec1."Surcharge Line");
          ChrgRec2.SETRANGE("Basic Line");
          IF ChrgRec2.FINDSET(FALSE, FALSE) THEN BEGIN
            REPEAT
              //determine Line Total per Cost Type for Basic Lines belonging to Surcharge
              IF RcpLineRec1.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
                 "Recipe Group", Recipe, ChrgRec2."Basic Line") THEN BEGIN
                IF RcpLineRec2."Surcharge Type" = RcpLineRec2."Surcharge Type"::Labor THEN BEGIN
                  RcpLineRec2.Norm := RcpLineRec2.Norm + RcpLineRec1.Hours;
                  RcpLineRec2."Norm (Sales)" := RcpLineRec2."Norm (Sales)" + RcpLineRec1."Hours (Sales)";
                END ELSE BEGIN
                  RcpLineRec2."Gross Price" := RcpLineRec2."Gross Price" + RcpLineRec1."Gross Amount";
                  RcpLineRec2."Net Cost Price" := RcpLineRec2."Net Cost Price" + RcpLineRec1."Net Cost Amount";
                  RcpLineRec2."Net Sales Price" := RcpLineRec2."Net Sales Price" + RcpLineRec1."Net Sales Amount";
                END;
              END;
            UNTIL ChrgRec2.NEXT = 0;
          END;
          //update surcharge line with totals by Cost Type of basic lines
          IF RcpLineRec2."Gross Price" <> 0 THEN BEGIN
            RcpLineRec2."Purchase Discount %" :=
              100 * (RcpLineRec2."Gross Price" - RcpLineRec2."Net Cost Price") / RcpLineRec2."Gross Price";
            RcpLineRec2."Sales Discount %" :=
              100 * (RcpLineRec2."Gross Price" - RcpLineRec2."Net Sales Price") / RcpLineRec2."Gross Price";
          END;
          IF RcpLineRec2."Surcharge Type" = RcpLineRec2."Surcharge Type"::Labor THEN BEGIN
            RateRec.GET(RcpLineRec2."Estimate No.",RcpLineRec2."Rate Code");
            IF RateRec."Rate Type" = RateRec."Rate Type"::Minuts THEN BEGIN
              RcpLineRec2.Norm := RcpLineRec2.Norm * 60;
              RcpLineRec2."Norm (Sales)" := RcpLineRec2."Norm (Sales)" * 60;
              IF RateRec."Team Size" <> 0 THEN BEGIN
                RcpLineRec2.Norm := RcpLineRec2.Norm / RateRec."Team Size";
                RcpLineRec2."Norm (Sales)" := RcpLineRec2."Norm (Sales)" / RateRec."Team Size";
              END;
            END;
            IF RcpLineRec2.Norm <> 0 THEN
              RcpLineRec2."Production Rate" := 1 / RcpLineRec2.Norm
            ELSE
              RcpLineRec2."Production Rate" := 0;
            IF RcpLineRec2."Norm (Sales)" <> 0 THEN
              RcpLineRec2."Production Rate (Sales)" := 1 / RcpLineRec2."Norm (Sales)"
            ELSE
              RcpLineRec2."Production Rate (Sales)" := 0;
          END;
          RcpLineRec2.CalculateTotals;
          IF FORMAT(RcpLineRec2) <> FORMAT(RecipeLineOriginal) THEN
            RcpLineRec2.MODIFY("Estimate No."='');
        UNTIL ChrgRec1.NEXT = 0;
      END;
    END;

    PROCEDURE CheckSameValue@1210190009(lvCostType@1210190001 : Integer;lvCostObjectOld@1210190002 : Code[20]);
    VAR
      lvRcpLineRec@1210190000 : Record 11072075;
    BEGIN
      lvRcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      IF lvCostType = 1 THEN
        lvRcpLineRec.SETFILTER("Cost Object Labor", '%1', lvCostObjectOld)
      ELSE
        lvRcpLineRec.SETFILTER("Cost Object Price", '%1', lvCostObjectOld);
      lvRcpLineRec.SETRANGE(Description, Description);
      lvRcpLineRec.SETRANGE("Unit of Measure", "Unit of Measure");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvCostType = 1 THEN
            lvRcpLineRec."Cost Object Labor" := "Cost Object Labor"
          ELSE
            lvRcpLineRec."Cost Object Price" := "Cost Object Price";
          lvRcpLineRec.MODIFY;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckCostObject@1210190005(CostObject@1210190000 : Code[20]);
    VAR
      DefRate@1100485000 : Code[10];
    BEGIN
      GetEstimate("Estimate No.", FALSE);
      DefRate := EstRec."Rate Code";

      IF CostObject <> '' THEN BEGIN
        DimMgt.GetDimValueRec(2, CostObject, DimValRec, TRUE,'');
        VALIDATE("Cost Component", DimValRec."Cost Component");
        //IF NOT EntityDefined THEN  //C044586
        //  "Unit of Measure" := DimValRec."Unit of Measure";  //db, 05-03-18 (on hold: 29-03)
        IF EstRec."Estimate Based On" <> EstRec."Estimate Based On"::CostObject THEN EXIT;
        IF "Sub Operation Code" <> '' THEN BEGIN
          ProcessSubOperation;
          EXIT;
        END;
        IF "Norm Agreement" OR "Price Agreement" THEN BEGIN
          IF DimValRec."Cost Type" = DimValRec."Cost Type"::Labor THEN BEGIN
            IF DimValRec."Rate Code" = '' THEN
              VALIDATE("Rate Code", DefRate)
            ELSE
              VALIDATE("Rate Code", DimValRec."Rate Code");
          END;
          EXIT;
        END;
        IF CostObjectLeading THEN  //C050221
          Description := DimValRec.Name;
        InitNormPrice;
        IF DimValRec."Cost Type" = DimValRec."Cost Type"::Labor THEN BEGIN
          IF DimValRec."Rate Code" = '' THEN
            VALIDATE("Rate Code", DefRate)
          ELSE
            VALIDATE("Rate Code", DimValRec."Rate Code");
          IF "Sub Operation Code" <> '' THEN
            DetermineNorm
          ELSE
            VALIDATE(Norm, DimValRec.Norm);
        END ELSE BEGIN
          TESTFIELD("Cost Type (Price)");  //DP00381
          VALIDATE("Gross Price", DimValRec.Price);
        END;
      END;
    END;

    PROCEDURE OldSubOperationDefault@1210190006() : Boolean;
    VAR
      OldSubOperRec@1210190001 : Record 11012166;
      OldOperRec@1210190000 : Record 11012165;
    BEGIN
      IF xRec."Sub Operation Code" <> '' THEN
        IF OldSubOperRec.GET(xRec."Sub Operation Code") THEN
          IF OldSubOperRec.Operation <> '' THEN
            IF OldOperRec.GET(OldSubOperRec.Operation) THEN;

      EXIT(xRec."Cost Object Labor" = OldOperRec."Cost Object");
    END;

    PROCEDURE ProcessSubOperation@1100485002();
    VAR
      SubOperRec@1100485000 : Record 11012166;
    BEGIN
      IF "Item No." + "Basic Item" + "Trade Item" <> '' THEN EXIT;

      IF SubOperRec.GET("Sub Operation Code") THEN BEGIN
        Description := COPYSTR(SubOperRec.Description, 1, MAXSTRLEN(Description));
        IF SubOperRec."Unit of Measure" <> '' THEN
          "Unit of Measure" := SubOperRec."Unit of Measure";
      END;
    END;

    PROCEDURE EnterQuantity@1210190013(lvOrigin@1210190002 : Integer) : Boolean;
    VAR
      QuanRec@1210190000 : Record 11012186;
      QuantityRelation@1100409001 : Record 11020463;
    BEGIN
      //DP00686
      //lvOrigin:
      //  1 = Length, Width and Height
      //  2 = quantity (input)
      //  3 = house type
      //  4 = quantity (lookup)

      IF "Surcharge Type" <> "Surcharge Type"::" " THEN EXIT(FALSE);

      IF lvOrigin <> 1 THEN BEGIN
        IF Length <> 0 THEN EXIT(FALSE);
        IF Width <> 0 THEN EXIT(FALSE);
        IF Height <> 0 THEN EXIT(FALSE);
        IF "Scaling Factor" <> 0 THEN EXIT(FALSE);
        IF "Base Quantity" <> 0 THEN EXIT(FALSE);
      END;

      GetEstSetup;  //DP01183
      IF lvOrigin <> 4 THEN BEGIN
        IF NOT EstSetup."Quantity Sheet with Relations" THEN BEGIN
          QuanRec.SETRANGE("Estimate No.", "Estimate No.");
          QuanRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          QuanRec.SETRANGE("Part Group", "Part Group");
          QuanRec.SETRANGE(Part, Part);
          QuanRec.SETRANGE("Estimate Line", "Estimate Line");
          QuanRec.SETRANGE("Recipe Group", "Recipe Group");
          QuanRec.SETRANGE(Recipe, Recipe);
          QuanRec.SETRANGE("Recipe Line", "Line No.");
          IF QuanRec.FINDFIRST THEN EXIT(FALSE);
        END ELSE
          IF QuantityRelation.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line","Recipe Group",Recipe,"Line No.") THEN
            EXIT(FALSE);
      END;

      EXIT(TRUE);
    END;

    PROCEDURE EditQuanSheet@1210190007();
    VAR
      QuanRec@1210190000 : Record 11012186;
      QuanSheetRec@1100409004 : Record 11020462;
      QuanSheetFrm@1100409003 : Page 11020462;
      QuantityRelation@1100409002 : Record 11020463;
      EstimateLine@1100409005 : Record 11072072;
    BEGIN
      //DP00686
      IF "Line No." = 0 THEN
        ERROR(Text011);

      GetEstSetup;  //DP01183
      IF NOT EstSetup."Quantity Sheet with Relations" THEN BEGIN
        QuanRec.SETRANGE("Estimate No.", "Estimate No.");
        QuanRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        QuanRec.SETRANGE("Part Group", "Part Group");
        QuanRec.SETRANGE(Part, Part);
        QuanRec.SETRANGE("Estimate Line", "Estimate Line");
        QuanRec.SETRANGE("Recipe Group", "Recipe Group");
        QuanRec.SETRANGE(Recipe, Recipe);
        QuanRec.SETRANGE("Recipe Line", "Line No.");
        PAGE.RUNMODAL(PAGE::"Estimate Quantity Sheet", QuanRec);
        QuanRec.SETRANGE("Row No.", 0);
        IF QuanRec.FINDFIRST THEN
          VALIDATE(Quantity, QuanRec.Result);
      END ELSE BEGIN
        QuanSheetRec.SETRANGE("Estimate No.","Estimate No.");
        QuanSheetRec.SETFILTER("Sub-Estimate No.",'%1|%2', '', "Sub-Estimate No.");
        QuanSheetRec.SETFILTER("Part Group", '%1|%2', '',"Part Group");
        QuanSheetRec.SETFILTER(Part,'%1|%2', '',Part);
        QuanSheetFrm.SETTABLEVIEW(QuanSheetRec);
        IF NOT QuantityRelation.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line","Recipe Group",Recipe,"Line No.") THEN QuantityRelation.INIT;
        IF NOT QuanSheetRec.GET("Estimate No.", QuantityRelation."Quantity Sheet") THEN QuanSheetRec.INIT;
        QuanSheetFrm.SETRECORD(QuanSheetRec);
        EstimateLine.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line");
        QuanSheetFrm.SetDefaultNEW(EstimateLine,Rec,TRUE,QuantityRelation);
        QuanSheetFrm.RUNMODAL;
        IF QuantityRelation.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line","Recipe Group",Recipe,"Line No.") THEN
          IF GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line","Recipe Group",Recipe,"Line No.") THEN
            VALIDATE(Quantity);
      END;
      CALCFIELDS("Quantity Sheet Present");
    END;

    PROCEDURE InitAdjustmentFactor@1210190003();
    VAR
      CumFactorPrice@1100528900 : Decimal;
    BEGIN
      //DP00381
      IF "Adjustment Factor Hours" = 0 THEN
        "Adjustment Factor Hours" := 1;
      IF "Adjustment Factor Price" = 0 THEN
        "Adjustment Factor Price" := 1;

      IF "Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
        "Adj. Factor Hours (Sales)" := 1;

      IF ("Surcharge Type" <> "Surcharge Type"::" ") THEN BEGIN
        "Cum. Adj. Factor Hours" := "Adjustment Factor Hours";
        "Cum. Adj. Factor Price" := "Adjustment Factor Price";
        "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)";   //DP00555
      END ELSE BEGIN
        EstPartRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part);
        IF (EstPartRec."Cum. Adj. Factor Hours" = 0) THEN
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
        ELSE
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * EstPartRec."Cum. Adj. Factor Hours";
        IF (EstPartRec."Cum. Adj. Factor Hours (Sales)" = 0) THEN  //DP00555
          "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)"
        ELSE
          "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)" * EstPartRec."Cum. Adj. Factor Hours (Sales)";

        IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN
          CumFactorPrice := EstPartRec."Cum. Adj. Factor Material";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN
          CumFactorPrice := EstPartRec."Cum. Adj. Factor Subcontr.";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN
          CumFactorPrice := EstPartRec."Cum. Adj. Factor Plant";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN
          CumFactorPrice := EstPartRec."Cum. Adj. Factor Sundry";

        IF CumFactorPrice = 0 THEN
          "Cum. Adj. Factor Price" := "Adjustment Factor Price"
        ELSE
          "Cum. Adj. Factor Price" := "Adjustment Factor Price" * CumFactorPrice;
      END;
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190004(IAdjType@1210190000 : Integer;IEstType@1100525000 : Integer);
    BEGIN
      IF (IEstType = 0) OR (IEstType = 2) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adj. Factor Hours (Sales)" = 0 THEN
              "Adj. Factor Hours (Sales)" := 1;
        END;
      END;
      IF (IEstType = 0) OR (IEstType = 1) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adjustment Factor Hours" = 0 THEN
              "Adjustment Factor Hours" := 1;
          2:
            IF "Adjustment Factor Price" = 0 THEN
              "Adjustment Factor Price" := 1;
        END;
      END;
      MODIFY;

      UpdateMgt.ResetAdjustmentFactor("Estimate No.", "Sub-Estimate No.", "Part Group", Part,
        "Estimate Line", TRUE, 4, IAdjType, IEstType);  //DP00555

      GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
          "Recipe Group", Recipe, "Line No.");
    END;

    PROCEDURE CheckDefaultRate@1100485003();
    BEGIN
      IF "Rate Code" <> '' THEN
        EXIT;
      IF GetEstPart THEN
        "Rate Code" := EstPartRec."Rate Code";
      IF "Rate Code" = '' THEN
        IF GetSubEstimate("Estimate No.", "Sub-Estimate No.", FALSE) THEN
          "Rate Code" := SubEstRec."Rate Code";
      IF "Rate Code" = '' THEN BEGIN
        GetEstimate("Estimate No.", FALSE);
        "Rate Code" := EstRec."Rate Code";
      END;
    END;

    PROCEDURE GetItemSpecifications@1100485006();
    BEGIN
      IF ItemRec.GET("Item No.") THEN BEGIN
        "Item Series" := ItemRec."Item Series";
        "Item Type" := ItemRec."Item Type";
        "Item Brand" := ItemRec."Item Brand";
      END;
    END;

    PROCEDURE GetDefaultsPlantType@1100485010();
    VAR
      PlantTypeRec@1100485000 : Record 11012551;
    BEGIN
      GetEstimate("Estimate No.", TRUE);
      IF EstRec."Plant Company" <> '' THEN
        PlantTypeRec.CHANGECOMPANY(EstRec."Plant Company");  //DP01208
      PlantTypeRec.GET("Plant Type");
      Description := PlantTypeRec.Description;
      "Unit of Measure" := PlantTypeRec."Unit of Measure";
      "Cost Object Price" := PlantTypeRec."Cost Object";
      Weight := PlantTypeRec.Weight;
      CLEAR("Price Agreement");
      DeterminePlantPrice;

      IF "Attached to Line No." <> 0 THEN
        GetRentalPeriodFromSet;
    END;

    PROCEDURE DeterminePlantPrice@1100485011();
    VAR
      SearchRateCu@1100485000 : Codeunit 11012567;
      RefDate@1100485001 : Date;
      RentalType@1100525006 : Option;
      DummyPlantPriceType@1100525005 : Option;
      DummyRentalType@1100525004 : Option;
      PlantDiscount@1100525003 : Decimal;
      SalesPrice@1100525002 : Decimal;
      BuyBackPrice@1100525001 : Decimal;
      PlantTypeRec@1100525000 : Record 11012551;
    BEGIN
      IF ("Plant Type" = '') OR "Price Agreement" THEN
        EXIT;
      ClearFields(2); //Buyback
      ClearFields(3); //Discount
      GetEstimate("Estimate No.", FALSE);
      IF "Start Rental Period" <> 0D THEN
        RefDate := "Start Rental Period"
      ELSE BEGIN
        IF EstRec."Reference Date (Rate)" <> 0D THEN
          RefDate := EstRec."Reference Date (Rate)"
        ELSE
          RefDate := TODAY;
      END;

      //DP01047.sn
      RentalType := -1;  //0=rental, 1=sales, 2=buy-back, 3= hours
      IF EstRec."Plant Company" <> '' THEN
        PlantTypeRec.CHANGECOMPANY(EstRec."Plant Company");  //DP01208
      PlantTypeRec.GET("Plant Type");
      IF "Plant Rates in Hours" THEN BEGIN  //DP01492
        "Cost Type (Hours)" := "Cost Type (Hours)"::Plant;
        "Rate Code" := '';
        InitRateRelatedFields;
        IF (PlantTypeRec."Rental Type" <> PlantTypeRec."Rental Type"::"Sales/Buy Back") THEN
          RentalType := 3;
      END;

      VALIDATE("Net Cost Price", SearchRateCu.CostRateFromEstimate("Plant Type",'', EstRec."Plant Location",RefDate,EstRec."Plant Company",RentalType,"Plant Price Type"));
      VALIDATE("Gross Price","Net Cost Price");
      SalesPrice := SearchRateCu.SalesRateFromEstimate(
        "Plant Type",'',EstRec."Plant Location",EstRec."Customer No.",EstRec."Kind of Plant Rate"+1,RefDate,EstRec."Plant Company",RentalType,"Plant Price Type");
      IF RentalType = 1 THEN BEGIN
        DummyRentalType := 2;
        BuyBackPrice := SearchRateCu.SalesRateFromEstimate("Plant Type",'',EstRec."Plant Location",EstRec."Customer No.",0,RefDate,EstRec."Plant Company",DummyRentalType,DummyPlantPriceType);
      END;
      PlantDiscount := SearchRateCu.SalesDiscountFromEstimate(
        "Plant Type",'',EstRec."Plant Location",EstRec."Customer No.",EstRec."Customer Disc. Group",RefDate,EstRec."Plant Company",RentalType);
      VALIDATE("Net Sales Price", SalesPrice * (100-PlantDiscount)/100);
      VALIDATE("Buy Back Price", BuyBackPrice * (100-PlantDiscount)/100);
      //DP01047.en
    END;

    PROCEDURE GetDefaultsCostObject@1100485012(CostType@1100485000 : 'Labor,Material,Subcontracting,Plant,Sundry';CostObject@1100485001 : Code[20]);
    VAR
      DimensionValue@1100485002 : Record 349;
      EstimatePurchaseAction@1100485003 : Record 11012366;
    BEGIN
      //DP01676: function derived from BudgetLine; skip message on validate
      EstSetup.GET;
      IF CostObject = '' THEN EXIT;

      DimMgt.GetDimValueRec(2, CostObject, DimensionValue, TRUE, '');
      DimensionValue.TESTFIELD(Blocked, FALSE);

      //C050221.sn
      GetEstimate("Estimate No.", FALSE);
      IF EstRec."Estimate Based On" = EstRec."Estimate Based On"::CostObject THEN BEGIN
        IF CostObjectLeading THEN
          Description := DimensionValue.Name;
      END;
      //C050221.en

      IF EstSetup."Default Purchase Action" THEN BEGIN  //C050221
        IF (CostType = CostType::Material) OR (CostType = CostType::Subcontracting) OR (CostType = CostType::Plant) THEN BEGIN
          IF NOT EstimatePurchaseAction.GET("Estimate No.", DimensionValue."Purchase Action") THEN EXIT;
          IF EstimatePurchaseAction.Status >= EstimatePurchaseAction.Status::Applied THEN EXIT;
          IF ("Purchase Action" = '') AND (DimensionValue."Purchase Action" <> '') THEN
            VALIDATE("Purchase Action", DimensionValue."Purchase Action");
        END;
      END;
    END;

    LOCAL PROCEDURE CostObjectLeading@1100528503() : Boolean;
    BEGIN
      //C050221
      IF ("Item No." + "Basic Item" + "Trade Item" <> '') OR
         ("Sub Operation Code" + "Subcontracting Activity" <> '') OR
         ("Plant Type" + "Set Code" <> '') OR
         ("Recipe (Child)" <> '') OR
         ("Surcharge Type" <> "Surcharge Type"::" ") THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE GetAbsenceValue@1100528501();
    BEGIN
      //C050221
      GetEstSetup;
      IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN
         VALIDATE("Cost Object Price", EstSetup."Absence Value Material");
      IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN
         VALIDATE("Cost Object Price", EstSetup."Absence Value Subcontracting");
      IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN
         VALIDATE("Cost Object Price", EstSetup."Absence Value Plant");
      IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN
         VALIDATE("Cost Object Price", EstSetup."Absence Value Sundry Cost");
    END;

    PROCEDURE GetReferenceData@1100525002(VAR lvRefDate@1100525003 : Date;VAR lvDiscRef1@1100525002 : Code[20];VAR lvDiscRef2@1100525001 : Code[20];lvEstRec@1100525000 : Record 11012151;lvDiscType@1100525004 : 'Purchase,Sales');
    BEGIN
      lvRefDate := ValidateCu.GetRefDateEstimate(lvEstRec);
      ValidateCu.GetRefDiscEstimate(lvEstRec, lvDiscRef1, lvDiscRef2, lvDiscType);
    END;

    PROCEDURE CalcRentalUnits@1100525007();
    VAR
      PlantLocation@1100525000 : Record 11012554;
      RateTypeUsed@1100525002 : Option;
      CalcRentalPeriodsCu@1100525001 : Codeunit 11012568;
    BEGIN
      //DP01208.sn
      GetEstimate("Estimate No.", FALSE);
      IF EstRec."Plant Location" <> '' THEN BEGIN
        IF EstRec."Plant Company" <> '' THEN
          PlantLocation.CHANGECOMPANY(EstRec."Plant Company");
        PlantLocation.GET(EstRec."Plant Location");
      END ELSE BEGIN
        PlantLocation.INIT;
        PlantLocation.InitRecord;
      END;
      //DP01208.en

      VALIDATE("Rental Time Units",
        CalcRentalPeriodsCu.NumberRentalPeriods(
          PlantLocation,"Start Rental Period","End Rental Period","Plant Type",'',RateTypeUsed));

      IF "Set Code" = '' THEN
        TESTFIELD("Plant Price Type", RateTypeUsed + 1);
    END;

    PROCEDURE ClearFields@1100525004(FieldGroup@1100525000 : 'Item,PlantType,BuyBack,Discount');
    BEGIN
      CASE FieldGroup OF
        FieldGroup::Item:
          BEGIN
            VALIDATE("Net Cost Price",0);
            VALIDATE("Item No.",'')
          END;
        FieldGroup::PlantType:
          BEGIN
            VALIDATE("Net Cost Price",0);
            VALIDATE("Plant Type",'');
          END;
        FieldGroup::BuyBack:
          BEGIN
            CLEAR("Buy Back Price");
            CLEAR("Buy Back %");
          END;
        FieldGroup::Discount:  //C036770 (option added conform Estimate Line)
          BEGIN
            CLEAR("Gross Price");
            CLEAR("Purchase Discount %");
          END;
      END;
    END;

    PROCEDURE ChkFieldsEmpty@1100525028(FieldGroup@1100525000 : 'Material,Plant,BuyBack,Discount');
    BEGIN
      CASE FieldGroup OF
        FieldGroup::Material:
          BEGIN
            //TESTFIELD("Material Price",0);
            //TESTFIELD("Item No.",0)
          END;
        FieldGroup::Plant:
          BEGIN
            //TESTFIELD("Plant Type",0);
            //TESTFIELD("Plant Price Type",0);
          END;
        FieldGroup::BuyBack:
          BEGIN
            TESTFIELD("Buy Back Price",0);
            TESTFIELD("Buy Back %",0);
          END;
        FieldGroup::Discount:
          BEGIN
            TESTFIELD("Purchase Discount %",0);
            TESTFIELD("Gross Price",0);
          END;
      END;
    END;

    PROCEDURE InitRecipeLine@1100525000(SaveOrig@1100525000 : Boolean);
    BEGIN
      InitRecord; // 34595.n

      "Purchase Route Reference" := '';
      "Plant Need Location" := '';
      "Plant Need Line No." := 0;
      IF SaveOrig = FALSE THEN BEGIN
        "Price Agreement" := FALSE;
        "Price Agreement (Sales)" := FALSE;  //DP00381
        "Norm Agreement" := FALSE;
        "Norm Agreement (Sales)" := FALSE;   //DP00381
      END;
    END;

    LOCAL PROCEDURE GetRentalPeriodFromSet@1100525014();
    VAR
      RecipeLine2@1100525000 : Record 11072075;
    BEGIN
      IF "Attached to Line No." = 0 THEN
        EXIT;

      RecipeLine2.GET(
        "Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
        "Recipe Group", Recipe, "Attached to Line No.");

      IF RecipeLine2."Set Code" = '' THEN
        EXIT;

      IF "Plant Rates in Hours" THEN EXIT;  //DP01492

      VALIDATE("Start Rental Period", RecipeLine2."Start Rental Period");
      VALIDATE("End Rental Period", RecipeLine2."End Rental Period");
      VALIDATE("Rental Period Formula", RecipeLine2."Rental Period Formula");
      VALIDATE("Rental Time Units", RecipeLine2."Rental Time Units");
    END;

    PROCEDURE GetEstSetup@1210190014();
    BEGIN
      IF NOT EstSetupRead THEN BEGIN
        EstSetup.GET;
        EstSetupRead := TRUE;
      END;
    END;

    PROCEDURE GetEstPart@1210190018() : Boolean;
    BEGIN
      IF (EstPartRec."Estimate No." = "Estimate No.") AND
         (EstPartRec."Sub-Estimate No." = "Sub-Estimate No.") AND
         (EstPartRec."Part Group" = "Part Group") AND
         (EstPartRec.Part = Part) THEN
        EXIT(TRUE);

      EXIT(EstPartRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part));
    END;

    PROCEDURE GetEstimate@1210190015(EstimateNo@1210190000 : Code[20];CatchRead@1210190001 : Boolean);
    BEGIN
      IF (EstRec."No." = EstimateNo) THEN
        EXIT;

      IF CatchRead THEN BEGIN
        IF NOT EstRec.GET(EstimateNo) THEN
          EstRec.INIT;
      END ELSE
        EstRec.GET(EstimateNo);
    END;

    PROCEDURE GetSubEstimate@1210190017(EstimateNo@1210190000 : Code[20];SubEstimateNo@1210190002 : Code[20];CatchRead@1210190001 : Boolean) : Boolean;
    BEGIN
      IF (SubEstRec."Estimate No." = EstimateNo) AND (SubEstRec."Sub-Estimate No." = SubEstimateNo) THEN
        EXIT(TRUE);

      IF CatchRead THEN BEGIN
        SubEstPresent := SubEstRec.GET(EstimateNo, SubEstimateNo);
        IF NOT SubEstPresent THEN
          SubEstRec.INIT;
      END ELSE
        SubEstPresent := SubEstRec.GET(EstimateNo, SubEstimateNo);

      EXIT(SubEstPresent);
    END;

    PROCEDURE GetEstRate@1210190019();
    BEGIN
      IF (RateRec."Estimate No." = "Estimate No.") AND (RateRec."Rate Code" = "Rate Code") THEN
        EXIT;

      IF "Rate Code" = '' THEN
        CLEAR(RateRec)
      ELSE
        RateRec.GET("Estimate No.","Rate Code");
    END;

    PROCEDURE SetSkipCalculateTotals@1210190016(SetCalculateTotals@1210190000 : Boolean);
    BEGIN
      SkipCalculateTotals := SetCalculateTotals;
    END;

    PROCEDURE SetFromEstimateLineDelete@1210190020(FromRecipeLine@1210190000 : Boolean);
    BEGIN
      FromRecipeLineDelete := FromRecipeLine;
    END;

    PROCEDURE CalculateSalesDiscount@1100525017(lvEstRec@1100525001 : Record 11012151);
    VAR
      lvRefDate@1100525005 : Date;
      lvDiscRef1@1100525004 : Code[20];
      lvDiscRef2@1100525003 : Code[20];
      lvRefPrio@1100525002 : Code[10];
      lvDiscType@1100525000 : 'Purchase,Sales';
    BEGIN
      //function previously used in codeunit 11012227, but replaced by CalcItemSalesPriceAndDiscount
      IF "Price Agreement (Sales)" THEN EXIT;  //C030087
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2, lvEstRec, lvDiscType::Sales);
      lvRefPrio := ValidateCu.GetRefPrioEstimate(lvEstRec, lvDiscType::Sales);
      "Sales Condition Present" := ValidateCu.GetSalesDiscount(  //C015604
        lvEstRec."Customer No.", "Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)",
        "Net Sales Price", "Sales Discount %", "Gross Price", lvRefDate, lvEstRec."Customer Disc. Group",  //C032335
        lvDiscRef1, lvDiscRef2, lvRefPrio);

      CalculateTotals;
    END;

    PROCEDURE InitRecord@1210190023();
    VAR
      BaseActRec@1100409000 : Record 11012434;
      Estimate@1100528600 : Record 11012151;
    BEGIN
      // 34595.n
      IF EstPartRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part) THEN BEGIN
        "Project No." := EstPartRec."Project No.";
        IF NOT ElemRec.GET(Element) THEN  //C002867
          Element := EstPartRec.Element;
        GetDisciplineByElement;  //DP02460
        IF Discipline = '' THEN
          Discipline := EstPartRec.Discipline;  //DP02460
        IF "Project No." <> '' THEN
          "Extension Contract" := EstPartRec."Extension Contract";  //DP00260
        IF NOT BaseActRec.GET("Project Planning Activity Code") THEN
          "Project Planning Activity Code" := EstPartRec."Project Planning Activity Code";
      END;
      IF EstLineRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line") THEN BEGIN
        //get initial value from recipe header
        IF ("Plant Type" <> '') OR ("Set Code" <> '') THEN BEGIN
          //C032892.sn
          IF FORMAT(EstLineRec."Rental Period Formula") <> '' THEN
            VALIDATE("Rental Period Formula", EstLineRec."Rental Period Formula");
          IF  EstLineRec."Start Rental Period" <> 0D THEN
            "Start Rental Period" := EstLineRec."Start Rental Period";
          IF  EstLineRec."End Rental Period" <> 0D THEN
            "End Rental Period" := EstLineRec."End Rental Period";
          //C032892.en
        END;
      END;
      IF NOT Estimate.GET("Estimate No.") THEN
        Estimate.INIT;
      "Plant Rates in Hours" := Estimate."Plant Rates in Hours";  //C039780
      "Subcontracting in Hours" := Estimate."Subcontracting in Hours";  //C053751
      IF (Estimate."Currency Code" <> '') THEN
        "Currency Code" := Estimate."Currency Code";
      InitSurcharge(FALSE);  //DP00381
    END;

    PROCEDURE IsFixed@1210190021() : Boolean;
    VAR
      Estimate@1210190000 : Record 11012151;
    BEGIN
      IF Estimate.GET("Estimate No.") THEN
        EXIT(Estimate.Fixed);
    END;

    PROCEDURE GetTotalQuantityEstimate@1100409001() TotalQuantity : Decimal;
    VAR
      RecipeQuantity@1100409000 : Decimal;
    BEGIN
      //C002156
      CALCFIELDS("Estimate Quantity");
      IF "Ignore Recipe Quantity" THEN
        RecipeQuantity := 1
      ELSE
        RecipeQuantity := "Estimate Quantity";
      TotalQuantity := ROUND(RecipeQuantity * Quantity * "Estimate Part Quantity");
      EXIT(TotalQuantity);
    END;

    PROCEDURE UpdateSalesQuantity@1100528904();
    BEGIN
      //DP00381
      IF CalledFromUpdateTotals THEN EXIT;  //C021215
      IF (xRec.Quantity = "Quantity (Sales)") OR ("Quantity (Sales)" = 0) THEN
        "Quantity (Sales)" := Quantity;
    END;

    PROCEDURE UpdateSalesNorm@1100528905();
    BEGIN
      //DP00381
      IF (xRec.Norm = "Norm (Sales)") OR ("Norm (Sales)" = 0) THEN BEGIN
        "Norm (Sales)" := Norm;
        IF "Norm (Sales)" <> 0 THEN
          "Production Rate (Sales)" := 1 / "Norm (Sales)"
        ELSE
          "Production Rate (Sales)" := 0;
      END;
    END;

    PROCEDURE ProcessCostObject@1100528906(iAction@1210190000 : Integer;iCostType@1100528900 : Integer;iCostObject@1100528901 : Code[20]);
    VAR
      DimValRec@1100528902 : Record 349;
    BEGIN
      //DP00381
      IF (("Recipe (Child)" <> '') AND ("Recipe Header"= TRUE)) THEN EXIT;

      IF iAction = 1 THEN BEGIN   //validate
        IF iCostObject <> '' THEN BEGIN
          DimValRec.RESET;
          DimValRec.SETRANGE("Global Dimension No.",2);
          DimValRec.SETRANGE(Code, iCostObject);
          IF iCostType = 0 THEN BEGIN
            DimValRec.SETRANGE("Cost Type", DimValRec."Cost Type"::Labor);
          END ELSE BEGIN
            IF "Cost Type (Price)" = "Cost Type (Price)"::" " THEN
              DimValRec.SETRANGE("Cost Type", DimValRec."Cost Type"::Material, DimValRec."Cost Type"::Sundry)
            ELSE
              DimValRec.SETRANGE("Cost Type","Cost Type (Price)");
          END;
          DimValRec.FINDFIRST;
          IF iCostType <> 0 THEN
            IF "Item No." + "Basic Item" + "Trade Item" <> '' THEN
              DimValRec.TESTFIELD("Cost Type", DimValRec."Cost Type"::Material);
          DetermineCostObject(DimValRec);
        END;
      END;

      IF iAction = 2 THEN BEGIN   //lookup
        DimValRec.RESET;
        DimValRec.Code := iCostObject;
        DimValRec.SETRANGE("Global Dimension No.",2);
        IF iCostType = 0 THEN BEGIN
          DimValRec.SETRANGE("Cost Type", DimValRec."Cost Type"::Labor);
        END ELSE BEGIN
          IF "Cost Type (Price)" = "Cost Type (Price)"::" " THEN
            DimValRec.SETRANGE("Cost Type", DimValRec."Cost Type"::Material, DimValRec."Cost Type"::Sundry)
          ELSE
            DimValRec.SETRANGE("Cost Type","Cost Type (Price)");
        END;
        IF PAGE.RUNMODAL(PAGE::"Cost Object List", DimValRec) = ACTION::LookupOK THEN BEGIN
          iCostObject := DimValRec.Code;
          ProcessCostObject(1, iCostType, iCostObject);
        END;
      END;
    END;

    LOCAL PROCEDURE DetermineCostObject@1100528900(DimValRec@1100528900 : Record 349);
    BEGIN
      //DP00381
      IF DimValRec."Cost Type" = DimValRec."Cost Type"::Labor THEN BEGIN
        VALIDATE("Cost Object Labor", DimValRec.Code);
      END ELSE BEGIN
        VALIDATE("Cost Type (Price)", DimValRec."Cost Type");
        VALIDATE("Cost Object Price", DimValRec.Code);
      END;

      CheckCostObject(DimValRec.Code);
      IF "Item No." + "Basic Item" + "Trade Item" = '' THEN BEGIN
        IF "Sub Operation Code" <> '' THEN BEGIN
          ProcessSubOperation;
        END ELSE BEGIN
          IF EstRec."Estimate Based On" = EstRec."Estimate Based On"::CostObject THEN BEGIN  //C017158
            IF CostObjectLeading THEN  //C050221
              Description := DimValRec.Name;
            //"Unit of Measure" := DimValRec."Unit of Measure";  //db, 05-03-18 (on hold: 29-03)
          END;
        END;
      END;
    END;

    PROCEDURE InitSurcharge@1100528911(SwitchCostType@1100528900 : Boolean);
    VAR
      ApplySurchargeRecipe@1100525001 : Boolean;
      BaseRcpLineRec@1100525000 : Record 11020582;
    BEGIN
      //DP00381
      IF "Surcharge Type" <> "Surcharge Type"::" " THEN EXIT;

      IF EstPartRec.GET("Estimate No.","Sub-Estimate No.","Part Group",Part) THEN BEGIN
        IF SwitchCostType = FALSE THEN
          "Surcharge % Labor" := EstPartRec."Surcharge % Labor";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN BEGIN
          "Surcharge % Price" :=  EstPartRec."Surcharge % Material";
          CheckSurchargeMaterialPrice;  //C005338
        END;
        IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN
          "Surcharge % Price" := EstPartRec."Surcharge % Subcontracting";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN
          "Surcharge % Price" := EstPartRec."Surcharge % Plant";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN
          "Surcharge % Price" := EstPartRec."Surcharge % Sundry";
      END;

      GetEstimate("Estimate No.", FALSE);
      ApplySurchargeRecipe := EstRec."Apply Surcharge Recipe";
      IF NOT BaseRcpLineRec.GET("Recipe Group", Recipe, "Line No.") THEN
        ApplySurchargeRecipe := FALSE;
      IF ApplySurchargeRecipe THEN BEGIN  //DP00594
        IF BaseRcpLineRec."Surcharge % Labor" <> 0 THEN
          "Surcharge % Labor" := BaseRcpLineRec."Surcharge % Labor";
        IF BaseRcpLineRec."Surcharge % Price" <> 0 THEN
          "Surcharge % Price" := BaseRcpLineRec."Surcharge % Price";
        IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN
          CheckSurchargeMaterialPrice;
      END;
    END;

    PROCEDURE CheckSurchargeMaterialPrice@1100528912();
    BEGIN
      //DP00381
      IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN BEGIN
        GetEstimate("Estimate No.", FALSE);
        IF EstRec."Apply SurchMat PriceZero Only" THEN  //C034137
          IF "Trade Item" + "Basic Item" + "Item No." <> '' THEN
            IF "Sales Condition Present" THEN  //C015604
              "Surcharge % Price" := 0;
      END;
    END;

    PROCEDURE GetRecipeTotals@1100528907(VAR EstLineRec@1100528900 : Record 11072072;VAR TotalRecipeCost@1100528901 : Decimal;VAR TotalRecipeSales@1100528902 : Decimal;VAR TotalRecipeGross@1100528903 : Decimal);
    BEGIN
      //DP00381
      IF NOT EstLineRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line") THEN EstLineRec.INIT;
      EstLineRec.CALCFIELDS(
        "Hours Recipe (Cost)", "Hours Recipe (Sales)",
        "Labor Recipe (Cost)", "Labor Recipe (Sales)",
        "Material Recipe (Cost)", "Material Recipe (Sales)", "Gross Amount Recipe (Mat)",
        "Subcontracting Recipe (Cost)", "Subcontracting Recipe (Sales)", "Gross Amount Recipe (Subc)",
        "Plant Recipe (Cost)", "Plant Recipe (Sales)", "Gross Amount Recipe (Plant)",
        "Sundry Recipe (Cost)", "Sundry Recipe (Sales)","Gross Amount Recipe (Sundry)");

      TotalRecipeCost := EstLineRec."Labor Recipe (Cost)" + EstLineRec."Material Recipe (Cost)" +
        EstLineRec."Subcontracting Recipe (Cost)" + EstLineRec."Plant Recipe (Cost)" + EstLineRec."Sundry Recipe (Cost)";
      TotalRecipeSales := EstLineRec."Labor Recipe (Sales)" + EstLineRec."Material Recipe (Sales)" +
        EstLineRec."Subcontracting Recipe (Sales)" + EstLineRec."Plant Recipe (Sales)" + EstLineRec."Sundry Recipe (Sales)";
      TotalRecipeGross := EstLineRec."Labor Recipe (Cost)" + EstLineRec."Gross Amount Recipe (Mat)" +
        EstLineRec."Gross Amount Recipe (Subc)" + EstLineRec."Gross Amount Recipe (Plant)" + EstLineRec."Gross Amount Recipe (Sundry)";
    END;

    PROCEDURE ChargePresent@1100528908(VAR chrg0@1100528905 : Boolean;VAR chrg1@1100528904 : Boolean;VAR chrg2@1100528903 : Boolean;VAR chrg3@1100528902 : Boolean;VAR chrg4@1100528901 : Boolean;VAR chrg5@1100528900 : Boolean);
    VAR
      ChrgRec@1100528906 : Record 11229771;
    BEGIN
      //DP00381
      chrg0 := FALSE;
      chrg1 := FALSE;
      chrg2 := FALSE;
      chrg3 := FALSE;
      chrg4 := FALSE;
      chrg5 := FALSE;

      ChrgRec.RESET;
      ChrgRec.SETRANGE("Estimate No.", "Estimate No.");
      ChrgRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      ChrgRec.SETRANGE("Part Group", "Part Group");
      ChrgRec.SETRANGE(Part, Part);
      ChrgRec.SETRANGE("Recipe Line", "Estimate Line");
      ChrgRec.SETRANGE("Recipe Group", "Recipe Group");
      ChrgRec.SETRANGE(Recipe, Recipe);
      ChrgRec.SETRANGE("Basic Line", "Line No.");
      ChrgRec.SETRANGE("Surcharge Line");
      IF NOT ChrgRec.ISEMPTY THEN BEGIN
        ChrgRec.FINDSET;
        REPEAT
          IF RcpLineRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
                            "Recipe Group", Recipe, ChrgRec."Surcharge Line") THEN BEGIN
            CASE RcpLineRec."Surcharge Type" OF
              RcpLineRec."Surcharge Type"::Labor:
                chrg1 := TRUE;
              RcpLineRec."Surcharge Type"::Material:
                chrg2 := TRUE;
              RcpLineRec."Surcharge Type"::Subcontracting:
                chrg3 := TRUE;
              RcpLineRec."Surcharge Type"::Plant:
                chrg4 := TRUE;
              RcpLineRec."Surcharge Type"::Sundry:
                chrg5 := TRUE;
            END;
          END;
        UNTIL ChrgRec.NEXT = 0;
      END;

      ChrgRec.SETRANGE("Basic Line");
      ChrgRec.SETRANGE("Surcharge Line", "Line No.");
      IF NOT ChrgRec.ISEMPTY THEN
        chrg0 := TRUE;
    END;

    PROCEDURE InitNormPrice@1100528909();
    BEGIN
      Norm := 0;
      "Norm (Sales)" := 0;
      "Production Rate" := 0;
      "Net Cost Price" := 0;
      "Purchase Discount %" := 0;
      "Gross Price" := 0;
      "Net Sales Price" := 0;
      "Sales Discount %" := 0;
    END;

    PROCEDURE GetMinuts@1100485009(lvType@1100485002 : Integer;iCostSales@1100528900 : 'Cost,Sales') Result : Decimal;
    VAR
      NormDec@1100528901 : Decimal;
    BEGIN
      IF iCostSales = iCostSales::Sales THEN  //DP00381
        NormDec := "Norm (Sales)"
      ELSE
        NormDec := Norm;
      IF "Rate Type" = "Rate Type"::Hours THEN
        Result := NormDec * 60
      ELSE
        Result := NormDec;
      IF "Surcharge Type" <> "Surcharge Type"::" " THEN
        Result := Result * "Surcharge %" / 100;
      IF iCostSales = iCostSales::Sales THEN BEGIN  //DP00381
        IF "Cum. Adj. Factor Hours (Sales)" <> 0 THEN
          Result := Result * "Cum. Adj. Factor Hours (Sales)";
      END ELSE BEGIN
        IF "Cum. Adj. Factor Hours" <> 0 THEN
          Result := Result * "Cum. Adj. Factor Hours";
      END;
      IF "Team Size" > 0 THEN
        Result := Result * "Team Size";
      IF lvType = 1 THEN BEGIN
        IF iCostSales = iCostSales::Sales THEN  //DP00381
          Result := Result * "Quantity (Sales)"
        ELSE
          Result := Result * Quantity;
      END;
      EXIT(Result);
    END;

    PROCEDURE EvaluateSurchargeCostType@1100525020();
    BEGIN
      "Cost Type (Price)" := "Surcharge Type" - 1;
      IF "Surcharge Type" = "Surcharge Type"::Labor THEN
        "Cost Object Price" := ''
      ELSE
        "Cost Object Labor" := '';

      GetEstSetup;  //DP01183
      CASE "Surcharge Type" OF
        "Surcharge Type"::Labor: "Cost Object Labor" := EstSetup."Absence Value Labor";
        "Surcharge Type"::Material: "Cost Object Price" := EstSetup."Absence Value Material";
        "Surcharge Type"::Subcontracting: "Cost Object Price" := EstSetup."Absence Value Subcontracting";
        "Surcharge Type"::Plant: "Cost Object Price" := EstSetup."Absence Value Plant";
        "Surcharge Type"::Sundry: "Cost Object Price" := EstSetup."Absence Value Sundry Cost";
      END;
    END;

    PROCEDURE SetSkipBlockedItem@1100528915(iSkipBlockedItem@1100528900 : Boolean);
    BEGIN
      SkipBlockedItem := iSkipBlockedItem;
    END;

    PROCEDURE CheckCostTypePriceAllowed@1100525009();
    BEGIN
      IF "Cost Type (Price)" <> "Cost Type (Price)"::" " THEN BEGIN
        IF ("Set Code" = '') AND ("Plant Type" = '') THEN BEGIN
          //skip check on quantity; init value for set code is 1 to fill cumulative quantity on related lines
          TESTFIELD(Quantity, 0);
          TESTFIELD("Quantity (Sales)", 0);
        END;
        TESTFIELD("Net Cost Price", 0);
        TESTFIELD("Net Sales Price", 0);
      END;
      IF "Item No." + "Basic Item" + "Trade Item" <> '' THEN BEGIN
        IF ("Recipe Header") THEN  //C053970
          TESTFIELD("Recipe (Child)", '');
        TESTFIELD("Plant Type", '');
        TESTFIELD("Set Code", '');
        TESTFIELD("Subcontracting Activity", '');
      END;
      IF ("Recipe (Child)" <> '') AND ("Recipe Header") THEN BEGIN  //C053970
        TESTFIELD("Item No.", '');
        TESTFIELD("Basic Item", '');
        TESTFIELD("Trade Item", '');
        TESTFIELD("Plant Type", '');
        TESTFIELD("Set Code", '');
        TESTFIELD("Subcontracting Activity", '');
      END;
      IF "Plant Type" <> '' THEN BEGIN
        TESTFIELD("Item No.", '');
        TESTFIELD("Basic Item", '');
        TESTFIELD("Trade Item", '');
        IF ("Recipe Header") THEN  //C053970
          TESTFIELD("Recipe (Child)", '');
        TESTFIELD("Set Code", '');
        TESTFIELD("Subcontracting Activity", '');
      END;
      IF "Set Code" <> '' THEN BEGIN
        TESTFIELD("Item No.", '');
        TESTFIELD("Basic Item", '');
        TESTFIELD("Trade Item", '');
        IF ("Recipe Header") THEN  //C053970
          TESTFIELD("Recipe (Child)", '');
        TESTFIELD("Plant Type", '');
        TESTFIELD("Subcontracting Activity", '');
      END;
      IF "Subcontracting Activity" <> '' THEN BEGIN
        IF ("Recipe Header") THEN  //C053970
          TESTFIELD("Recipe (Child)", '');
        TESTFIELD("Item No.", '');
        TESTFIELD("Basic Item", '');
        TESTFIELD("Trade Item", '');
        TESTFIELD("Plant Type", '');
        TESTFIELD("Set Code", '');
      END;

      "Cost Type (Price)" := "Cost Type (Price)"::" ";
      IF "Item No." + "Basic Item" + "Trade Item" <> '' THEN
        "Cost Type (Price)" := "Cost Type (Price)"::Material;
      IF "Plant Type" + "Set Code" <> '' THEN
        "Cost Type (Price)" := "Cost Type (Price)"::Plant;
      IF "Subcontracting Activity" <> '' THEN
        "Cost Type (Price)" := "Cost Type (Price)"::Subcontracting;
    END;

    PROCEDURE SortLines@1100525023(VAR gvRcpLineRec@1100525000 : Record 11072075;SortOption@1100525001 : 'SubEst,Part,Item,TradeItem,CostObject,CodingSystem,Recipe');
    VAR
      EstRec@1210190004 : Record 11012151;
      RcpLineRec@1100525002 : Record 11072075;
      sep@1210190003 : Text[1];
    BEGIN
      RcpLineRec.COPY(gvRcpLineRec);
      sep := '~';
      RcpLineRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.","Part Group",Part);
      IF RcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          RcpLineRec."Text Composition" := '';
          IF SortOption = SortOption::SubEst THEN
            RcpLineRec."Text Composition" := RcpLineRec."Sub-Estimate No.";
          IF SortOption = SortOption::Part THEN
            RcpLineRec."Text Composition" := RcpLineRec."Part Group" + sep + RcpLineRec.Part;
          IF SortOption = SortOption::Item THEN
            RcpLineRec."Text Composition" := RcpLineRec."Item No.";
          IF SortOption = SortOption::TradeItem THEN
            IF RcpLineRec."Trade Item" <> '' THEN
              RcpLineRec."Text Composition" := RcpLineRec."Vendor (Trade Item)" + sep + RcpLineRec."Trade Item";
          IF SortOption = SortOption::CostObject THEN BEGIN
            IF RcpLineRec."Labor Cost Amount" > RcpLineRec."Cost Amount" - RcpLineRec."Labor Cost Amount" THEN
              RcpLineRec."Text Composition" := RcpLineRec."Cost Object Labor"
            ELSE
              RcpLineRec."Text Composition" := RcpLineRec."Cost Object Price";
          END;
          IF SortOption = SortOption::CodingSystem THEN BEGIN
            IF EstRec."No." <> RcpLineRec."Estimate No." THEN
              EstRec.GET(RcpLineRec."Estimate No.");
            IF RcpLineRec.Code <> '' THEN
              RcpLineRec."Text Composition" := EstRec."Coding System" + sep + RcpLineRec.Code;
          END;
          IF SortOption = SortOption::Recipe THEN
            IF RcpLineRec."Recipe (Child)" <> '' THEN
              RcpLineRec."Text Composition" := RcpLineRec."Recipe Group (Child)" + sep + RcpLineRec."Recipe (Child)";
          RcpLineRec.MODIFY;
        UNTIL RcpLineRec.NEXT = 0;
      END;
      SETCURRENTKEY("Estimate No.","Text Composition");
    END;

    PROCEDURE CheckFeatureRelation@1100409004(i@1100409004 : Integer);
    VAR
      QuantityRelation@1100409003 : Record 11020463;
      QuantitySheetHeader@1100409002 : Record 11020462;
      QuantitySheetLine@1100409000 : Record 11020464;
      FieldCode@1100409001 : Code[10];
    BEGIN
      //DP00686
      IF "Quantity Sheet Feature" = '' THEN EXIT;
      IF "Line No."= 0 THEN EXIT;

      EstPartRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part);

      QuantitySheetHeader.SETRANGE("Estimate No.", "Estimate No.");
      QuantitySheetHeader.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      QuantitySheetHeader.SETRANGE("Part Group", "Part Group");
      CASE i OF
        0: QuantitySheetHeader.SETRANGE(Part, EstPartRec.Part);
        1: QuantitySheetHeader.SETRANGE(Part, EstPartRec.Chapter);
        2: QuantitySheetHeader.SETRANGE(Part, EstPartRec.Paragraph);
      END;
      IF QuantitySheetHeader.FINDSET THEN BEGIN
        REPEAT
          QuantitySheetLine.SETRANGE("Estimate No.", QuantitySheetHeader."Estimate No.");
          QuantitySheetLine.SETRANGE("Quantity Sheet", QuantitySheetHeader.Code);
          IF QuantitySheetLine.FINDSET THEN BEGIN
            REPEAT
              IF QuantitySheetLine.Feature = "Quantity Sheet Feature" THEN BEGIN
                CASE QuantitySheetLine."Related to Column" OF
                  QuantitySheetLine."Related to Column"::Quantity: FieldCode := 'A';
                  QuantitySheetLine."Related to Column"::Length: FieldCode := 'B';
                  QuantitySheetLine."Related to Column"::TotalLength: FieldCode := 'C';
                  QuantitySheetLine."Related to Column"::Width: FieldCode := 'D';
                  QuantitySheetLine."Related to Column"::TotalWidth: FieldCode := 'E';
                  QuantitySheetLine."Related to Column"::Height: FieldCode := 'F';
                  QuantitySheetLine."Related to Column"::TotalHeight: FieldCode := 'G';
                  QuantitySheetLine."Related to Column"::Result: FieldCode := 'R';
                END;
                IF FieldCode <> '' THEN BEGIN
                  QuantityRelation.EditRelation(
                    "Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line", "Recipe Group", Recipe, "Line No.",
                    QuantitySheetLine."Quantity Sheet",
                    QuantitySheetLine."Row No.",
                    FieldCode);
                END;
              END;
            UNTIL QuantitySheetLine.NEXT = 0;
          END;
        UNTIL QuantitySheetHeader.NEXT = 0;
      END;
    END;

    PROCEDURE CopyItemText@1100409003();
    VAR
      TextRec@1100485000 : Record 11020595;
      TextRec2@1100485001 : Record 11020595;
      CurrLino@1100525001 : Integer;
      CommentLine@1100409000 : Record 97;
    BEGIN
      //DP00686
      IF "Line No." = 0 THEN EXIT;
      IF NOT EstRec.GET("Estimate No.") THEN CLEAR(EstRec);  //DP01183 (EstRec.INIT disables check GetEstimate)

      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::Item);
      CommentLine.SETRANGE("No.", "Item No.");
      IF NOT CommentLine.FINDFIRST THEN EXIT;

      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETRANGE(Group, "Recipe Group");
      TextRec.SETRANGE("No.", Recipe);
      TextRec.SETRANGE("Estimate No.", "Estimate No.");
      TextRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, Part);
      TextRec.SETRANGE("Estimate Line No.", "Estimate Line");
      TextRec.SETRANGE("Recipe Line No.", "Line No.");
      TextRec.SETRANGE("Part Line No.", 0);
      IF EstRec."Language Code" <> '' THEN
        TextRec.SETFILTER("Language Code", '%1|%2', '', EstRec."Language Code");
      TextRec.DELETEALL;

      IF TextRec.FINDLAST THEN
        CurrLino := TextRec."Line No."
      ELSE
        CurrLino := 0;
      IF CommentLine.FINDSET THEN BEGIN
        REPEAT
          TextRec2.INIT;
          TextRec2."Table Name" := TextRec2."Table Name"::Estimate;
          TextRec2.Group := "Recipe Group";
          TextRec2."No." := Recipe;

          TextRec2.Date := CommentLine.Date;
          TextRec2.Code := CommentLine.Code;
          TextRec2.Comment := CommentLine.Comment;
          TextRec2."Comment Code" := CommentLine."Comment Code";
          TextRec2."Language Code" := CommentLine."Language Code";
          TextRec2."Line Break" := CommentLine."Line Break";
          TextRec2."Created by" := USERID;
          TextRec2."Time Created" := TIME;

          TextRec2."Estimate No." := "Estimate No.";
          TextRec2."Sub-Estimate No." := "Sub-Estimate No.";
          TextRec2."Part Group" := "Part Group";
          TextRec2.Part := Part;
          TextRec2."Estimate Line No." := "Estimate Line";
          TextRec2."Recipe Line No." := "Line No.";
          CurrLino := CurrLino + 10000;
          TextRec2."Line No." := CurrLino;
          TextRec2.INSERT;
        UNTIL CommentLine.NEXT = 0;
      END;
    END;

    PROCEDURE CopyRecipeLineText@1100409008();
    VAR
      TextRec@1100485000 : Record 11020595;
      TextRec2@1100485001 : Record 11020595;
      CurrLino@1100525001 : Integer;
    BEGIN
      //DP00686
      IF "Line No." = 0 THEN EXIT;
      IF NOT EstRec.GET("Estimate No.") THEN CLEAR(EstRec);  //DP01183 (EstRec.INIT disables check GetEstimate)

      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETRANGE(Group, "Recipe Group");
      TextRec.SETRANGE("No.", Recipe);
      TextRec.SETRANGE("Estimate No.", "Estimate No.");
      TextRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, Part);
      TextRec.SETRANGE("Estimate Line No.", "Estimate Line");
      TextRec.SETRANGE("Recipe Line No.", "Line No.");
      TextRec.SETRANGE("Part Line No.", 0);
      TextRec.DELETEALL;

      IF TextRec.FINDLAST THEN
        CurrLino := TextRec."Line No."
      ELSE
        CurrLino := 0;

      TextRec.SETFILTER("Estimate No.", '%1', '');
      TextRec.SETFILTER("Sub-Estimate No.", '%1', '');
      TextRec.SETFILTER("Part Group", '%1', '');
      TextRec.SETFILTER(Part, '%1', '');
      TextRec.SETRANGE("Estimate Line No.", 0);
      IF EstRec."Language Code" <> '' THEN
        TextRec.SETFILTER("Language Code", '%1|%2', '', EstRec."Language Code");
      IF TextRec.FINDSET THEN BEGIN
        REPEAT
          TextRec2.COPY(TextRec);
          TextRec2."Created by" := USERID;
          TextRec2."Time Created" := TIME;

          TextRec2."Estimate No." := "Estimate No.";
          TextRec2."Sub-Estimate No." := "Sub-Estimate No.";
          TextRec2."Part Group" := "Part Group";
          TextRec2.Part := Part;
          TextRec2."Estimate Line No." := "Estimate Line";
          CurrLino := CurrLino + 10000;
          TextRec2."Line No." := CurrLino;
          TextRec2.INSERT;
        UNTIL TextRec.NEXT = 0;
      END;
    END;

    PROCEDURE InitSalesFromCost@1100525029(UpdateNorm@1100525000 : Boolean);
    BEGIN
      //C020959
      EstRec.GET("Estimate No.");
      EstPartRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part);
      "Surcharge % Labor" := EstPartRec."Surcharge % Labor";
      IF "Cost Type (Price)" = "Cost Type (Price)"::Material THEN
        "Surcharge % Price" := EstPartRec."Surcharge % Material";
      IF "Cost Type (Price)" = "Cost Type (Price)"::Subcontracting THEN
        "Surcharge % Price" := EstPartRec."Surcharge % Subcontracting";
      IF "Cost Type (Price)" = "Cost Type (Price)"::Plant THEN
        "Surcharge % Price" := EstPartRec."Surcharge % Plant";
      IF "Cost Type (Price)" = "Cost Type (Price)"::Sundry THEN
        "Surcharge % Price" := EstPartRec."Surcharge % Sundry";
      "Quantity (Sales)" := Quantity;
      "Norm Agreement (Sales)" := FALSE;
      "Price Agreement (Sales)" := FALSE;
      IF UpdateNorm THEN BEGIN  //C041108
        IF "Sub Operation Code" <> '' THEN
          DetermineNormSales
        ELSE
          VALIDATE("Norm (Sales)", Norm);
      END;
      CalcItemSalesPriceAndDiscount(EstRec);
      CalculateTotals;
    END;

    LOCAL PROCEDURE CheckCurrencyAgreement@1100525034();
    BEGIN
      IF "Currency Code" = '' THEN BEGIN
        "Currency Agreement" := FALSE;
      END ELSE BEGIN
        EstRec.GET("Estimate No.");
        IF CurrFieldNo = FIELDNO("Currency Code") THEN //C054524
          "Currency Agreement" := ("Currency Code" <> EstRec."Currency Code");
      END;
    END;

    PROCEDURE GetCurrencyFactor@1100528601(IUseSalesExchange@1100528600 : Boolean;IUseReportCurrency@1100528602 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528601 : Record 330;
      CurrencyCode@1100528603 : Code[10];
    BEGIN
      GetEstimate("Estimate No.", TRUE);
      IF IUseReportCurrency THEN
        CurrencyCode := EstRec."Report Currency Code"
      ELSE
        CurrencyCode := "Currency Code";
      EXIT(CurrencyExchangeRate.ExchangeRate(2, "Estimate No.", EstRec."Reference Date (Rate)", CurrencyCode, IUseSalesExchange));
    END;

    PROCEDURE ExchangeAmtLCYToFCY@1100528602(IAmount@1100528601 : Decimal;IUseSalesExchange@1100528602 : Boolean;IUsePriceRounding@1100528605 : Boolean;IUseReportCurrency@1100528607 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528600 : Record 330;
      Currency@1100528604 : Record 4;
      Amount@1100528603 : Decimal;
      CurrencyCode@1100528606 : Code[10];
    BEGIN
      IF "Currency Code" = '' THEN
        EXIT(IAmount);
      GetEstimate("Estimate No.", TRUE);
      IF IUseReportCurrency THEN
        CurrencyCode := EstRec."Report Currency Code"
      ELSE
        CurrencyCode := "Currency Code";
      Amount := CurrencyExchangeRate.ExchangeAmtLCYToFCY(
        2, "Estimate No.", EstRec."Reference Date (Rate)", CurrencyCode, IAmount, GetCurrencyFactor(IUseSalesExchange, IUseReportCurrency), IUseSalesExchange);
      IF NOT Currency.GET(CurrencyCode) THEN
        Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    PROCEDURE ExchangeAmtFCYToLCY@1100528600(IAmount@1100528601 : Decimal;IUseSalesExchange@1100528602 : Boolean;IUsePriceRounding@1100528605 : Boolean;IUseReportCurrency@1100528606 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528600 : Record 330;
      Currency@1100528604 : Record 4;
      Amount@1100528603 : Decimal;
      CurrencyCode@1100528607 : Code[10];
    BEGIN
      IF "Currency Code" = '' THEN
        EXIT(IAmount);
      GetEstimate("Estimate No.", TRUE);
      IF IUseReportCurrency THEN
        CurrencyCode := EstRec."Report Currency Code"
      ELSE
        CurrencyCode := "Currency Code";
      Amount := CurrencyExchangeRate.ExchangeAmtFCYToLCY(
        2, "Estimate No.", EstRec."Reference Date (Rate)", CurrencyCode, IAmount, GetCurrencyFactor(IUseSalesExchange, IUseReportCurrency), IUseSalesExchange);
      Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    PROCEDURE ExchangeAmtFCYToFCY@1100528604(IAmount@1100528606 : Decimal;IFromCurrencyCode@1100528604 : Code[10];IToCurrencyCode@1100528605 : Code[10];IUseSalesExchange@1100528607 : Boolean;IUsePriceRounding@1100528608 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528603 : Record 330;
      Currency@1100528602 : Record 4;
      CurrencyFactor@1100528609 : Decimal;
      Amount@1100528601 : Decimal;
    BEGIN
      GetEstimate("Estimate No.", TRUE);
      Amount := IAmount;
      IF IFromCurrencyCode <> '' THEN BEGIN
        CurrencyFactor := CurrencyExchangeRate.ExchangeRate(2, "Estimate No.", EstRec."Reference Date (Rate)", IFromCurrencyCode, IUseSalesExchange);
        Amount := CurrencyExchangeRate.ExchangeAmtFCYToLCY(2, "Estimate No.", EstRec."Reference Date (Rate)", IFromCurrencyCode, Amount, CurrencyFactor, IUseSalesExchange);
      END;
      IF IToCurrencyCode <> '' THEN BEGIN
        CurrencyFactor := CurrencyExchangeRate.ExchangeRate(2, "Estimate No.", EstRec."Reference Date (Rate)", IToCurrencyCode, IUseSalesExchange);
        Amount := CurrencyExchangeRate.ExchangeAmtLCYToFCY(2, "Estimate No.", EstRec."Reference Date (Rate)", IToCurrencyCode, Amount, CurrencyFactor, IUseSalesExchange);
      END;
      IF NOT Currency.GET(IToCurrencyCode) THEN
        Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      SkipValidateFCY := ISkipValidateFCY;
    END;

    PROCEDURE SetFromUpdateTotals@1100525030(FromUpdateTotals@1100525000 : Boolean);
    BEGIN
      CalledFromUpdateTotals := FromUpdateTotals;
    END;

    PROCEDURE SetFilterZeroLinesByUser@1100525025(VAR RecipeLine@1100525001 : Record 11072075);
    VAR
      UserSetup@1100525000 : Record 91;
    BEGIN
      //C025240
      WITH RecipeLine DO BEGIN
        UserSetup.GET(USERID);
        IF UserSetup."Hide Zero Lines" = FALSE THEN BEGIN
          UserSetup."Hide Zero Lines" := TRUE;
        END ELSE BEGIN
          UserSetup."Hide Zero Lines" := FALSE;
        END;
        UserSetup.MODIFY;
      END;
      GetFilterZeroLinesByUser(RecipeLine);
    END;

    PROCEDURE GetFilterZeroLinesByUser@1100525012(VAR RecipeLine@1100525000 : Record 11072075);
    VAR
      UserSetup@1100525001 : Record 91;
    BEGIN
      //C025240
      WITH RecipeLine DO BEGIN
        UserSetup.GET(USERID);
        IF UserSetup."Hide Zero Lines" = FALSE THEN BEGIN
          SETRANGE(Quantity);
        END ELSE BEGIN
          SETFILTER(Quantity, '<>%1', 0);
        END;
      END;
    END;

    PROCEDURE CheckHideZeroLines@1100525001();
    VAR
      UserSetup@1100525000 : Record 91;
    BEGIN
      //C025240
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("Hide Zero Lines", FALSE);
    END;

    PROCEDURE InitRateRelatedFields@1100525033();
    BEGIN
      //DP01047
      "Cost Rate" := 0;
      "Cost Rate (FCY)" := 0;
      "Sales Rate" := 0;
      "Sales Rate (FCY)" := 0;
      CLEAR("Rate Type");
      "Team Size" := 0;
      "Wage Component" := '';  //DP00236
    END;

    PROCEDURE InitNormRelatedFields@1100525006(iValue@1100528900 : Decimal);
    BEGIN
      //C053751: 0=clear; 1=init (switch plant/norm in hours should be budget neutral)
      Norm := iValue;
      "Production Rate" := iValue;
      "Norm (Sales)" := iValue;
      "Production Rate (Sales)" := iValue;
    END;

    PROCEDURE ExpandRecipe@1100529401();
    BEGIN
      //DP01183
      IF RecipeExpanded THEN BEGIN
        SETRANGE("Attached to Line No.");
        RecipeExpanded := FALSE;
      END ELSE BEGIN
        SETRANGE("Attached to Line No.", 0);
        RecipeExpanded := TRUE;
      END;
    END;

    PROCEDURE AssistEditQuantity@1100525013();
    BEGIN
      //C031184: lookup quantity moved to flowfield
      IF EnterQuantity(4) THEN
        EditQuanSheet;
    END;

    PROCEDURE LookupPlantType@1100529402();
    VAR
      PlantType@1100529400 : Record 11012551;
    BEGIN
      //DP01208
      GetEstimate("Estimate No.", TRUE);
      IF EstRec."Plant Company" <> '' THEN
         PlantType.CHANGECOMPANY(EstRec."Plant Company");
      PlantType.Code := "Plant Type";  //C036768
      IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN
        VALIDATE("Plant Type", PlantType.Code);
    END;

    PROCEDURE ValidateUnitOfMeasure@1100528400(UnitOfMeasureCode@1100528400 : Code[10]);
    BEGIN
      "Unit of Measure" := UnitOfMeasureCode;
      IF "Unit of Measure" <>  xRec."Unit of Measure" THEN
        CheckItemUnitConversion(Rec, xRec);
      CalculateTotals;
    END;

    PROCEDURE LookupSetCode@1100529403();
    VAR
      PlantSet@1100529400 : Record 11012587;
    BEGIN
      //DP01208
      GetEstimate("Estimate No.", TRUE);
      IF EstRec."Plant Company" <> '' THEN
         PlantSet.CHANGECOMPANY(EstRec."Plant Company");
      PlantSet.Code := "Set Code";  //C036768
      IF PAGE.RUNMODAL(0, PlantSet) = ACTION::LookupOK THEN
        VALIDATE("Set Code", PlantSet.Code);
    END;

    PROCEDURE ValidateSetCode@1100529404();
    VAR
      PlantSet@1100529400 : Record 11012587;
    BEGIN
      //DP01208
      IF "Set Code" = '' THEN EXIT;
      GetEstimate("Estimate No.", TRUE);
      IF EstRec."Plant Company" <> '' THEN
        PlantSet.CHANGECOMPANY(EstRec."Plant Company");
      PlantSet.GET("Set Code");
      Description := PlantSet.Description;
      "Unit of Measure" := PlantSet."Unit of Measure";
    END;

    PROCEDURE RecalculateSurcharge@1100529501();
    VAR
      RcpLineRec@1100529401 : Record 11072075;
    BEGIN
      //C033781
      GetEstSetup;
      IF EstSetup."Apply Surcharge Recipe Header" <> EstSetup."Apply Surcharge Recipe Header"::Cumulative THEN EXIT;

      RcpLineRec.SETRANGE("Estimate No.","Estimate No.");
      RcpLineRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      RcpLineRec.SETRANGE("Part Group","Part Group");
      RcpLineRec.SETRANGE(Part,Part);
      RcpLineRec.SETRANGE("Estimate Line","Estimate Line");
      RcpLineRec.SETRANGE("Recipe Group", "Recipe Group");
      RcpLineRec.SETRANGE(Recipe, Recipe);
      RcpLineRec.SETRANGE("Recipe Group (Child)", "Recipe Group (Child)");
      RcpLineRec.SETRANGE("Recipe (Child)", "Recipe (Child)");
      RcpLineRec.SETFILTER("Attached to Line No.", '<>%1', 0);
      IF RcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          RcpLineRec.CalculateTotals;
          RcpLineRec.MODIFY;
        UNTIL RcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE SetTempEstimate@1100529900(lvEstRec@1100529900 : Record 11012151);
    BEGIN
      //C038554
      EstRec := lvEstRec;
      SkipReadEstimate := TRUE;
    END;

    PROCEDURE GetSubcontractorActivity@1100529901(CalledBy@1100528500 : Integer);
    VAR
      SubcontractingActivityPrice@1100529900 : Record 11229373;
      Estimate@1100525000 : Record 11012151;
    BEGIN
      //DP01492-2
      Estimate.GET("Estimate No.");
      Estimate.TESTFIELD(Fixed, FALSE);  //C041836

      TESTFIELD("Cost Type (Price)", "Cost Type (Price)"::Subcontracting);
      SubcontractingActivityPrice.SETRANGE("Subcontracting Activity", "Subcontracting Activity");
      IF CalledBy = FIELDNO("Subcontracting Activity") THEN  //DP01958a
        SubcontractingActivityPrice.SETRANGE("Preferred Subcontractor", TRUE)
      ELSE
        SubcontractingActivityPrice.SETRANGE("Subcontractor No.", Subcontractor);
      IF SubcontractingActivityPrice.FINDFIRST THEN BEGIN
        VALIDATE("Net Cost Price", SubcontractingActivityPrice.GetPrice(Estimate."Reference Date (Rate)"));
        IF CalledBy = FIELDNO("Subcontracting Activity") THEN BEGIN  //DP01958a
          SubcontractingActivityPrice.CALCFIELDS("Activity Description");
          Description := SubcontractingActivityPrice."Activity Description";
        END;
        "Unit of Measure" := SubcontractingActivityPrice."Unit of Measure";
        "Cost Object Price" := SubcontractingActivityPrice."Cost Object";
        Subcontractor := SubcontractingActivityPrice."Subcontractor No.";
      END;
      IF "Subcontracting in Hours" THEN BEGIN  //C053751
        "Cost Type (Hours)" := "Cost Type (Hours)"::Subcontracting;
        "Rate Code" := '';
        InitRateRelatedFields;
      END;
    END;

    LOCAL PROCEDURE EntityDefined@1100528500() : Boolean;
    BEGIN
      //C044586
      IF ("Item No." + "Basic Item" + "Trade Item" = '') AND
         ("Sub Operation Code" + "Subcontracting Activity" = '') AND
         ("Plant Type" + "Set Code" = '') THEN
        EXIT(FALSE)
      ELSE
        EXIT(TRUE);
    END;

    PROCEDURE FillQuantityRecipeChild@1100525015();
    VAR
      EstimateRecipeLine@1100525000 : Record 11072075;
    BEGIN
      //C044680
      IF NOT "Recipe Header" THEN EXIT;
      //
      EstimateRecipeLine.SETRANGE("Estimate No.", "Estimate No.");
      EstimateRecipeLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstimateRecipeLine.SETRANGE("Part Group", "Part Group");
      EstimateRecipeLine.SETRANGE(Part, Part);
      EstimateRecipeLine.SETRANGE("Estimate Line", "Estimate Line");
      EstimateRecipeLine.SETRANGE("Attached to Line No.", "Line No.");
      IF EstimateRecipeLine.FINDSET THEN BEGIN
        REPEAT
          EstimateRecipeLine."Recipe Quantity" := Quantity;
          EstimateRecipeLine."Recipe Quantity (Sales)" := "Quantity (Sales)";
          EstimateRecipeLine.MODIFY;
        UNTIL EstimateRecipeLine.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateFieldOfRecipeLines@1100525016();
    VAR
      lvRcpLineRec@1100525000 : Record 11072075;
      EstimatePlantMgt@1100528401 : Codeunit 11012232;
      NewTimeQuan@1100525002 : Decimal;
      lvText000@1100525004 : TextConst 'ENU="Changing %1 for Recipe Header not allowed; update related Recipe Lines?"';
      NewProductionRate@1100528400 : Decimal;
      lvFieldName@1100525005 : Text[100];
    BEGIN
      CASE CurrFieldNo OF
        FIELDNO("Time Quantity"):
          BEGIN
            NewTimeQuan := "Time Quantity";
            "Time Quantity" := 1;
            lvFieldName := FIELDCAPTION("Time Quantity");
          END;
        FIELDNO("Production Rate"):
          BEGIN
            NewProductionRate := "Production Rate";
            lvFieldName := FIELDCAPTION("Production Rate");
          END;
      END;
      IF MODIFY THEN;
      COMMIT;

      IF CurrFieldNo = FIELDNO("Production Rate") THEN
        IF NOT CONFIRM(lvText000, TRUE, lvFieldName) THEN EXIT;

      lvRcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvRcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvRcpLineRec.SETRANGE("Part Group", "Part Group");
      lvRcpLineRec.SETRANGE(Part, Part);
      lvRcpLineRec.SETRANGE("Estimate Line", "Estimate Line");
      lvRcpLineRec.SETRANGE("Attached to Line No.", "Line No.");
      lvRcpLineRec.SETRANGE("Surcharge Type", lvRcpLineRec."Surcharge Type"::" ");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          CASE CurrFieldNo OF
            FIELDNO("Time Quantity"):
              lvRcpLineRec.VALIDATE("Time Quantity", NewTimeQuan);
            FIELDNO("Production Rate"):
              IF ((lvRcpLineRec."Cost Type (Hours)" = lvRcpLineRec."Cost Type (Hours)"::Plant) AND (lvRcpLineRec."Plant Rates in Hours")) OR
                 ((lvRcpLineRec."Cost Type (Hours)" = lvRcpLineRec."Cost Type (Hours)"::Subcontracting) AND (lvRcpLineRec."Subcontracting in Hours")) OR  //C053751
                 ((lvRcpLineRec."Cost Type (Hours)" = lvRcpLineRec."Cost Type (Hours)"::Labor) AND (lvRcpLineRec."Cost Object Labor" <> '')) THEN  //C043895
                IF EstimatePlantMgt.EstRcpFieldIsEditable(FIELDNO(Norm), lvRcpLineRec) THEN
                  IF (lvRcpLineRec."Norm Agreement" = FALSE) THEN  //DP02243
                    lvRcpLineRec.VALIDATE("Production Rate", NewProductionRate);
            FIELDNO("Plant Rates in Hours"):
              IF (lvRcpLineRec."Cost Type (Hours)" = lvRcpLineRec."Cost Type (Hours)"::Plant) THEN
                lvRcpLineRec.VALIDATE("Plant Rates in Hours", "Plant Rates in Hours");
            FIELDNO("Subcontracting in Hours"):  //C053751
              IF (lvRcpLineRec."Cost Type (Hours)" = lvRcpLineRec."Cost Type (Hours)"::Subcontracting) THEN
                lvRcpLineRec.VALIDATE("Subcontracting in Hours", "Subcontracting in Hours");
            FIELDNO("Ignore Recipe Quantity"):
              lvRcpLineRec.VALIDATE("Ignore Recipe Quantity", "Ignore Recipe Quantity");
          END;
          lvRcpLineRec.MODIFY;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;

      lvRcpLineRec.SETFILTER("Surcharge Type", '<>%1', lvRcpLineRec."Surcharge Type"::" ");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvRcpLineRec.CheckRecipeCharge;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;

      lvRcpLineRec.UpdateEstLines;
    END;

    PROCEDURE DetermineBOMLevel@1100525019(LineNo@1100525000 : Integer;VAR BOMLevel@1100525002 : Integer);
    VAR
      EstimateRecipeLine3@1100525003 : Record 11072075;
    BEGIN
      //T008150
      EstimateRecipeLine3.SETRANGE("Estimate No.","Estimate No.");
      EstimateRecipeLine3.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      EstimateRecipeLine3.SETRANGE("Part Group","Part Group");
      EstimateRecipeLine3.SETRANGE(Part,Part);
      EstimateRecipeLine3.SETRANGE("Estimate Line","Estimate Line");
      EstimateRecipeLine3.SETRANGE("Recipe Group","Recipe Group");
      EstimateRecipeLine3.SETRANGE(Recipe,Recipe);
      EstimateRecipeLine3.SETRANGE("Line No.",LineNo);
      IF EstimateRecipeLine3.FINDFIRST THEN
        BOMLevel := EstimateRecipeLine3."Level BOM" + 1;
    END;

    PROCEDURE CheckLinkedRecipe@1100528910(iAction@1100528902 : Integer;iSourceLine@1100528904 : Record 11072075;iTargetLine@1100528905 : Record 11072075);
    VAR
      EstimateRecipeLine@1100528900 : Record 11072075;
      EstimateLine@1100528901 : Record 11072072;
      UpdateRecipe@1100528903 : Boolean;
    BEGIN
      //DP02082
      //iAction: 1=insert, 2=modify, 3=delete; 4=activate link (EstimateLine)
      WITH iSourceLine DO BEGIN
        IF SkipLinkedRecipe THEN EXIT;  //C053864
        IF NOT EstimateLine.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line") THEN
          EstimateLine.INIT;
        IF NOT EstimateLine."Linked Recipe" THEN
          EXIT;
        //
        IF (iAction = 1) THEN BEGIN
          EstimateLine.SETRANGE("Estimate No.", iSourceLine."Estimate No.");
          EstimateLine.SETRANGE("Recipe Group", iSourceLine."Recipe Group");
          EstimateLine.SETRANGE(Recipe, iSourceLine.Recipe);
          EstimateLine.SETRANGE("Linked Recipe", TRUE);
          IF EstimateLine.FINDSET THEN BEGIN
            REPEAT
              IF (EstimateLine."Sub-Estimate No." <> iSourceLine."Sub-Estimate No.") OR
                (EstimateLine."Part Group" <> iSourceLine."Part Group") OR
                (EstimateLine.Part <> iSourceLine.Part) OR
                (EstimateLine."Line No." <> iSourceLine."Estimate Line") THEN
              BEGIN
                iTargetLine."Estimate No." := EstimateLine."Estimate No.";
                iTargetLine."Sub-Estimate No." := EstimateLine."Sub-Estimate No.";
                iTargetLine."Part Group" := EstimateLine."Part Group";
                iTargetLine.Part := EstimateLine.Part;
                iTargetLine."Estimate Line" := EstimateLine."Line No.";
                iTargetLine."Recipe Group" := iSourceLine."Recipe Group";
                iTargetLine.Recipe := iSourceLine.Recipe;
                iTargetLine."Line No." := iSourceLine."Line No.";
                UpdateLinkedRecipeLine(iSourceLine, iTargetLine);
              END;
            UNTIL EstimateLine.NEXT = 0;
          END;
          EXIT;
        END;
        //
        EstimateRecipeLine.SETRANGE("Estimate No.", iSourceLine."Estimate No.");
        EstimateRecipeLine.SETRANGE("Recipe Group", iSourceLine."Recipe Group");
        EstimateRecipeLine.SETRANGE(Recipe, iSourceLine.Recipe);
        IF (iAction = 4) THEN BEGIN
          EstimateRecipeLine.SETRANGE("Sub-Estimate No.", iSourceLine."Sub-Estimate No.");
          EstimateRecipeLine.SETRANGE("Part Group", iSourceLine."Part Group");
          EstimateRecipeLine.SETRANGE(Part, iSourceLine.Part);
          EstimateRecipeLine.SETRANGE("Estimate Line", iSourceLine."Estimate Line");
        END;
        EstimateRecipeLine.SETRANGE("Line No.", iSourceLine."Line No.");
        IF EstimateRecipeLine.FINDSET THEN BEGIN
          REPEAT
            UpdateRecipe := FALSE;
            IF (iAction = 4) THEN BEGIN
              UpdateLinkedRecipeLine(iSourceLine, iTargetLine);
            END ELSE BEGIN
              IF (EstimateRecipeLine."Sub-Estimate No." <> iSourceLine."Sub-Estimate No.") OR
                (EstimateRecipeLine."Part Group" <> iSourceLine."Part Group") OR
                (EstimateRecipeLine.Part <> iSourceLine.Part) OR
                (EstimateRecipeLine."Estimate Line" <> iSourceLine."Estimate Line") THEN
              BEGIN
                UpdateRecipe := TRUE;
                iTargetLine := EstimateRecipeLine;
              END;
            END;
            IF UpdateRecipe THEN BEGIN
              IF NOT EstimateLine.GET(EstimateRecipeLine."Estimate No.", EstimateRecipeLine."Sub-Estimate No.",
                EstimateRecipeLine."Part Group", EstimateRecipeLine.Part, EstimateRecipeLine."Estimate Line") THEN
                EstimateLine.INIT;
              IF EstimateLine."Linked Recipe" THEN BEGIN
                IF (iAction = 2) OR (iAction = 3) THEN
                  EstimateRecipeLine.DELETE;
                IF (iAction <> 3) THEN
                  UpdateLinkedRecipeLine(iSourceLine, iTargetLine);
              END;
            END;
          UNTIL EstimateRecipeLine.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE UpdateLinkedRecipeLine@1100528913(iSourceLine@1100528903 : Record 11072075;iTargetLine@1100528902 : Record 11072075);
    VAR
      EstimateRecipeLine@1100528901 : Record 11072075;
      EstimateCode@1100528904 : Record 11229772;
      EstimateCode2@1100528906 : Record 11229772;
      EstimateSurcharge@1100528900 : Record 11229771;
      EstimateSurcharge2@1100528907 : Record 11229771;
      CommentLineGroup@1100528905 : Record 11020595;
      CommentLineGroup2@1100528908 : Record 11020595;
    BEGIN
      //DP02082
      EstimateRecipeLine := iSourceLine;
      EstimateRecipeLine."Estimate No." := iTargetLine."Estimate No.";
      EstimateRecipeLine."Sub-Estimate No." := iTargetLine."Sub-Estimate No.";
      EstimateRecipeLine."Part Group" := iTargetLine."Part Group";
      EstimateRecipeLine.Part := iTargetLine.Part;
      EstimateRecipeLine."Estimate Line" := iTargetLine."Estimate Line";
      EstimateRecipeLine."Recipe Group" := iTargetLine."Recipe Group";
      EstimateRecipeLine.Recipe := iTargetLine.Recipe;
      EstimateRecipeLine."Line No." := iTargetLine."Line No.";
      EstimateRecipeLine.INSERT;
      EstimateRecipeLine.CalculateTotals;
      EstimateRecipeLine.MODIFY;
      //
      EstimateCode2.SETRANGE("Estimate No.", iTargetLine."Estimate No.");
      EstimateCode2.SETRANGE("Sub-Estimate No.", iTargetLine."Sub-Estimate No.");
      EstimateCode2.SETRANGE("Part Group", iTargetLine."Part Group");
      EstimateCode2.SETRANGE(Part, iTargetLine.Part);
      EstimateCode2.SETRANGE("Estimate Line", iTargetLine."Estimate Line");
      EstimateCode2.SETRANGE("Recipe Group", iTargetLine."Recipe Group");
      EstimateCode2.SETRANGE(Recipe, iTargetLine.Recipe);
      EstimateCode2.SETRANGE("Recipe Line", iTargetLine."Line No.");
      EstimateCode2.DELETEALL;
      //
      EstimateCode.SETRANGE("Estimate No.", iSourceLine."Estimate No.");
      EstimateCode.SETRANGE("Sub-Estimate No.", iSourceLine."Sub-Estimate No.");
      EstimateCode.SETRANGE("Part Group", iSourceLine."Part Group");
      EstimateCode.SETRANGE(Part, iSourceLine.Part);
      EstimateCode.SETRANGE("Estimate Line", iSourceLine."Estimate Line");
      EstimateCode.SETRANGE("Recipe Group", iSourceLine."Recipe Group");
      EstimateCode.SETRANGE(Recipe, iSourceLine.Recipe);
      EstimateCode.SETRANGE("Recipe Line", iSourceLine."Line No.");
      IF EstimateCode.FINDSET THEN BEGIN
        REPEAT
          EstimateCode2 := EstimateCode;
          EstimateCode2."Sub-Estimate No." := iTargetLine."Sub-Estimate No.";
          EstimateCode2."Part Group" := iTargetLine."Part Group";
          EstimateCode2.Part := iTargetLine.Part;
          EstimateCode2."Estimate Line" := iTargetLine."Estimate Line";
          EstimateCode2.INSERT;
        UNTIL EstimateCode.NEXT = 0;
      END;
      //
      EstimateSurcharge2.SETRANGE("Estimate No.", iTargetLine."Estimate No.");
      EstimateSurcharge2.SETRANGE("Sub-Estimate No.", iTargetLine."Sub-Estimate No.");
      EstimateSurcharge2.SETRANGE("Part Group", iTargetLine."Part Group");
      EstimateSurcharge2.SETRANGE(Part, iTargetLine.Part);
      EstimateSurcharge2.SETRANGE("Recipe Line", iTargetLine."Estimate Line");
      EstimateSurcharge2.SETRANGE("Recipe Group", iTargetLine."Recipe Group");
      EstimateSurcharge2.SETRANGE(Recipe, iTargetLine.Recipe);
      EstimateSurcharge2.SETRANGE("Basic Line", iTargetLine."Line No.");
      EstimateSurcharge2.DELETEALL;
      //
      EstimateSurcharge.SETRANGE("Estimate No.", iSourceLine."Estimate No.");
      EstimateSurcharge.SETRANGE("Sub-Estimate No.", iSourceLine."Sub-Estimate No.");
      EstimateSurcharge.SETRANGE("Part Group", iSourceLine."Part Group");
      EstimateSurcharge.SETRANGE(Part, iSourceLine.Part);
      EstimateSurcharge.SETRANGE("Recipe Line", iSourceLine."Estimate Line");
      EstimateSurcharge.SETRANGE("Recipe Group", iSourceLine."Recipe Group");
      EstimateSurcharge.SETRANGE(Recipe, iSourceLine.Recipe);
      EstimateSurcharge.SETRANGE("Basic Line", iSourceLine."Line No.");
      IF EstimateSurcharge.FINDSET THEN BEGIN
        REPEAT
          EstimateSurcharge2 := EstimateSurcharge;
          EstimateSurcharge2."Sub-Estimate No." := iTargetLine."Sub-Estimate No.";
          EstimateSurcharge2."Part Group" := iTargetLine."Part Group";
          EstimateSurcharge2.Part := iTargetLine.Part;
          EstimateSurcharge2."Recipe Line" := iTargetLine."Estimate Line";
          EstimateSurcharge2.INSERT;
        UNTIL EstimateSurcharge.NEXT = 0;
      END;
      //
      CommentLineGroup2.SETRANGE("Table Name", CommentLineGroup."Table Name"::Estimate);
      CommentLineGroup2.SETRANGE("Estimate No.", iTargetLine."Estimate No.");
      CommentLineGroup2.SETRANGE("Sub-Estimate No.", iTargetLine."Sub-Estimate No.");
      CommentLineGroup2.SETRANGE("Part Group", iTargetLine."Part Group");
      CommentLineGroup2.SETRANGE(Part, iTargetLine.Part);
      CommentLineGroup2.SETRANGE("Estimate Line No.", iTargetLine."Estimate Line");
      CommentLineGroup2.SETRANGE("Recipe Line No.", iTargetLine."Line No.");
      CommentLineGroup2.DELETEALL;
      //
      CommentLineGroup.SETRANGE("Table Name", CommentLineGroup."Table Name"::Estimate);
      CommentLineGroup.SETRANGE("Estimate No.", iSourceLine."Estimate No.");
      CommentLineGroup.SETRANGE("Sub-Estimate No.", iSourceLine."Sub-Estimate No.");
      CommentLineGroup.SETRANGE("Part Group", iSourceLine."Part Group");
      CommentLineGroup.SETRANGE(Part, iSourceLine.Part);
      CommentLineGroup.SETRANGE("Estimate Line No.", iSourceLine."Estimate Line");
      CommentLineGroup.SETRANGE("Recipe Line No.", iSourceLine."Line No.");
      IF CommentLineGroup.FINDSET THEN BEGIN
        REPEAT
          CommentLineGroup2 := CommentLineGroup;
          CommentLineGroup2."Sub-Estimate No." := iTargetLine."Sub-Estimate No.";
          CommentLineGroup2."Part Group" := iTargetLine."Part Group";
          CommentLineGroup2.Part := iTargetLine.Part;
          CommentLineGroup2."Estimate Line No." := iTargetLine."Estimate Line";
          CommentLineGroup2.INSERT;
        UNTIL CommentLineGroup.NEXT = 0;
      END;
    END;

    PROCEDURE AddLineToHeader@1100528502();
    VAR
      EstimateRecipeLine@1100528900 : Record 11072075;
      HeaderLine@1100528903 : Record 11072075;
      NextLine@1100528901 : Integer;
      BaseLine@1100528902 : Integer;
    BEGIN
      //C053970
      IF "Line No." = 0 THEN BEGIN
        EstimateRecipeLine.SETRANGE("Estimate No.", "Estimate No.");
        EstimateRecipeLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstimateRecipeLine.SETRANGE("Part Group", "Part Group");
        EstimateRecipeLine.SETRANGE(Part, Part);
        EstimateRecipeLine.SETRANGE("Estimate Line", "Estimate Line");
        IF NOT EstimateRecipeLine.FINDLAST THEN EXIT;
        //
        NextLine := EstimateRecipeLine."Line No." + 10000;
        IF (EstimateRecipeLine."Plant Type" <> '') OR
           (EstimateRecipeLine."Set Code" <> '') OR
           (EstimateRecipeLine."Recipe (Child)" <> '') THEN
          BaseLine := EstimateRecipeLine."Line No.";
        IF EstimateRecipeLine."Attached to Line No." <> 0 THEN
          IF EstimateRecipeLine.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
            "Recipe Group", Recipe, EstimateRecipeLine."Attached to Line No.") THEN
            BaseLine := EstimateRecipeLine."Line No.";
      END ELSE BEGIN
        IF ("Plant Type" <> '') OR
           ("Set Code" <> '') OR
           ("Recipe (Child)" <> '') THEN
          BaseLine := "Line No.";
        IF "Attached to Line No." <> 0 THEN
          IF EstimateRecipeLine.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line",
            "Recipe Group", Recipe, "Attached to Line No.") THEN
            BaseLine := EstimateRecipeLine."Line No.";
        //
        EstimateRecipeLine.SETRANGE("Estimate No.", "Estimate No.");
        EstimateRecipeLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstimateRecipeLine.SETRANGE("Part Group", "Part Group");
        EstimateRecipeLine.SETRANGE(Part, Part);
        EstimateRecipeLine.SETRANGE("Estimate Line", "Estimate Line");
        EstimateRecipeLine.SETFILTER("Line No.", '>%1', "Line No.");
        IF EstimateRecipeLine.FINDFIRST THEN
          NextLine := "Line No." + ROUND(((EstimateRecipeLine."Line No." - "Line No.")/2),1)
        ELSE
          NextLine := "Line No." + 10000;
      END;

      IF BaseLine = 0 THEN EXIT;
      HeaderLine.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Estimate Line", "Recipe Group", Recipe, BaseLine);
      //
      EstimateRecipeLine.INIT;
      EstimateRecipeLine."Estimate No." := "Estimate No.";
      EstimateRecipeLine.VALIDATE("Sub-Estimate No.", "Sub-Estimate No.");
      EstimateRecipeLine."Part Group" := "Part Group";
      EstimateRecipeLine.VALIDATE(Part, Part);
      EstimateRecipeLine."Estimate Line" := "Estimate Line";
      EstimateRecipeLine."Recipe Group" := "Recipe Group";
      EstimateRecipeLine.Recipe := Recipe;
      EstimateRecipeLine."Line No." := NextLine;
      EstimateRecipeLine.INSERT(TRUE);
      //
      IF (HeaderLine."Plant Type" <> '') OR
         (HeaderLine."Set Code" <> '') THEN BEGIN
        EstimateRecipeLine.Description := '<' + FIELDCAPTION("Attached to Line No.") + ': ' + FORMAT(BaseLine) + '>';
        EstimateRecipeLine."Attached to Line No." := BaseLine;
        EstimateRecipeLine."Set Level" := HeaderLine."Set Level" + 1;
      END;
      //
      IF (HeaderLine."Recipe (Child)" <> '') THEN BEGIN
        EstimateRecipeLine.Description := '<' + FIELDCAPTION("Attached to Line No.") + ': ' + FORMAT(BaseLine) + '>';
        EstimateRecipeLine."Attached to Line No." := BaseLine;
        EstimateRecipeLine."Recipe Level" := HeaderLine."Recipe Level" + 1;
        EstimateRecipeLine."Recipe Group (Child)" := HeaderLine."Recipe Group (Child)";
        EstimateRecipeLine."Recipe (Child)" := HeaderLine."Recipe (Child)";
        EstimateRecipeLine."Recipe Exploded" := TRUE;  //C053970
      END;
      EstimateRecipeLine.MODIFY;
    END;

    PROCEDURE SetSkipLinkedRecipe@1100528504(iSkipLinkedRecipe@1100528500 : Boolean);
    BEGIN
      SkipLinkedRecipe := iSkipLinkedRecipe;  //C053864
    END;

    PROCEDURE CheckBomLines@1100528919();
    VAR
      EstimateRecipeLine@1210190000 : Record 11072075;
      OldQuan@1210190001 : Decimal;
      NewQuan@1210190002 : Decimal;
    BEGIN
      IF ("BOM Item No." = '') THEN EXIT;
      IF ("Level BOM" <> 0) THEN EXIT;

      //DP02339.sn
      OldQuan := xRec.Quantity;
      NewQuan := Quantity;
      //DP02339.en

      EstimateRecipeLine.SETRANGE("Estimate No.", "Estimate No.");
      EstimateRecipeLine.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstimateRecipeLine.SETRANGE("Part Group", "Part Group");
      EstimateRecipeLine.SETRANGE(Part, Part);
      EstimateRecipeLine.SETRANGE("Estimate Line", "Estimate Line");
      EstimateRecipeLine.SETRANGE("Recipe Group", "Recipe Group");
      EstimateRecipeLine.SETRANGE(Recipe, Recipe);
      EstimateRecipeLine.SETRANGE("BOM Item No.", "BOM Item No.");
      EstimateRecipeLine.SETRANGE("Part of Line", "Line No.");
      IF EstimateRecipeLine.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF OldQuan = 0 THEN
            EstimateRecipeLine.Quantity := EstimateRecipeLine."Original Quantity" * NewQuan  //DP02339
          ELSE
            EstimateRecipeLine.Quantity := EstimateRecipeLine.Quantity * NewQuan / OldQuan;
          EstimateRecipeLine.CalculateTotals;
          EstimateRecipeLine.MODIFY(TRUE);
        UNTIL EstimateRecipeLine.NEXT = 0;
      END;
    END;

    PROCEDURE GetDisciplineByElement@1100528920();
    VAR
      BaseElement@1100528900 : Record 11012060;
      ProjectElement@1100528901 : Record 11012010;
    BEGIN
      //DP02460
      IF Element = '' THEN EXIT;
      IF "Project No." <> '' THEN BEGIN
        IF NOT ProjectElement.GET("Project No.", Element) THEN ProjectElement.INIT;
        IF ProjectElement.Discipline <> '' THEN
          Discipline := ProjectElement.Discipline;
      END ELSE BEGIN
        IF NOT BaseElement.GET(Element) THEN BaseElement.INIT;
        IF BaseElement.Discipline <> '' THEN
          Discipline := BaseElement.Discipline;
      END;
    END;

    BEGIN
    END.
  }
}

