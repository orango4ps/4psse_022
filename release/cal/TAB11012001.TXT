OBJECT Table 11012001 Budget Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00,4PSSE;
  }
  PROPERTIES
  {
    Permissions=TableData 11012001=rimd,
                TableData 11072003=rm;
    OnInsert=VAR
               lvSummarySheetLineRec@1100485000 : Record 11012064;
               lvBudgetLineRec@1100485001 : Record 11012001;
             BEGIN
               ProjRec.GET("Project No.");

               IF (ProjRec."Project Status" > ProjRec."Project Status"::Production) AND
                  ("Extension Contract" = '')  THEN
                 ERROR(Text013,ProjRec."Project Status");

               IF (ProjRec."Project Status" > ProjRec."Project Status"::Finished) THEN
                 ERROR(Text013,ProjRec."Project Status");

               "Department Code" := ProjRec."Global Dimension 1 Code";  //**4PS.n DPA
               "Currency Code" := ProjRec."Currency Code";  //DP00883
               "Plant Rates in Hours" := ProjRec."Plant Rates in Hours";  //DP02115

               IF BudgetFixed(Rec) THEN
                 ERROR(Text014);

               FillMainProject;
               GetVersionDate;

               CLEAR("Purchase Action");
               CLEAR("Purchase Phase");
               CLEAR("Purchase Action Status");
               "Purch. Action Approval Date" := 0D;
               Advised := FALSE;
               "Copied to Adjustment" := FALSE;
               "Purchase Route Reference" := '';
               "Price Agreement" := FALSE;
               CLEAR("Option Line Type");
               "Quantity (Result Obligation)" := 0;  //DP01676
               "Apply Obligation" := FALSE;  //DP01676

               UpdateCostControlStatus(UpdateAction::Insert);
               UpdateExtContractStatus;
               UpdateLogbook;
               IF Adjustment <> '' THEN
                 UpdateAdjustmentByPhaseChange;

               IF NOT "Budget Summary Line" AND (Option = '') THEN BEGIN

                 IF ((ProjRec."Summary Sheet Project" <> '') AND ("Extension Contract" = '')) OR
                    ((ProjRec."Summary Sheet Contract" <> '') AND ("Extension Contract" <> '')) THEN BEGIN

                   lvBudgetLineRec.SETRANGE("Project No.", "Project No.");
                   lvBudgetLineRec.SETFILTER("Extension Contract", '%1', "Extension Contract");
                   //lvBudgetLineRec.SETFILTER("Plot No.", '%1', '');  //DP02088: plot can be assigned to sub-estimate; not only to option
                   lvBudgetLineRec.SETFILTER(Option, '%1', '');
                   IF NOT lvBudgetLineRec.FINDFIRST THEN BEGIN
                     //Only add default summary sheet at insert of first line of a budget

                     lvSummarySheetLineRec.SETRANGE("Project No.", "Project No.");
                     lvSummarySheetLineRec.SETFILTER("Contract No.", '%1', "Extension Contract");
                     //lvSummarySheetLineRec.SETFILTER("Plot No.", '%1', '');  //DP02088
                     lvSummarySheetLineRec.SETFILTER(Option, '%1', '');
                     IF NOT lvSummarySheetLineRec.FINDFIRST THEN BEGIN
                       lvSummarySheetLineRec.RESET;
                       IF "Extension Contract" <> '' THEN
                         lvSummarySheetLineRec.CopyTemplate2(ProjRec."Summary Sheet Contract", "Project No.", "Extension Contract",
                                                         '', '', '', '', '', '')
                       ELSE
                         lvSummarySheetLineRec.CopyTemplate2(ProjRec."Summary Sheet Project", "Project No.", '',
                                                         '', '', '', '', '', '');

                       lvSummarySheetLineRec.SETRANGE("Project No.", "Project No.");
                       lvSummarySheetLineRec.SETFILTER("Contract No.", '%1', "Extension Contract");
                       //lvSummarySheetLineRec.SETFILTER("Plot No.", '%1', '');  //DP02088
                       lvSummarySheetLineRec.SETFILTER(Option, '%1', '');
                       IF lvSummarySheetLineRec.FINDFIRST THEN BEGIN
                         lvSummarySheetLineRec.ReCalcSummaryLines(Adjustment); //Summary Adjustment
                         lvSummarySheetLineRec.UpdateBudgetLines(TRUE,Adjustment);  //Summary Adjustment
                       END;
                     END;
                   END;
                END;

               END;
             END;

    OnModify=BEGIN
               CheckIfChangingIsAllowedInCurrentElementPhase(xRec);
               UpdatePurchActionStatusInLine;
               UpdateCostControlStatus(UpdateAction::Modify);
               UpdateExtContractStatus;
               UpdateLogbook;
               IF "Source Type" = "Source Type"::"Recipe Header" THEN BEGIN
                 TESTFIELD(Hours, 0);
                 TESTFIELD("Amount (LCY)", 0);
               END;
               IF (SalesPriceBudgetLine.GET("Project No.",Adjustment,"Extension Contract","Line No.")) THEN
                 SalesPriceBudgetLine.DELETE();  //DP00789-RFC20
               //>> 180206 ITERO.SB REK-055
               "Last Date Modified" := CURRENTDATETIME;
               "Modified by" := USERID;
               //<<
             END;

    OnDelete=VAR
               lvBudgetLine@1100485000 : Record 11012001;
               BudgetPlanningActivity@1100529400 : Record 11229302;
               PurchaseLineDetail@1100529600 : Record 11020660;
               PlotOption@1100528500 : Record 11012502;
               BudgetLine@1100529900 : Record 11012001;
             BEGIN
               CheckIfChangingIsAllowedInCurrentElementPhase(xRec);
               IF NOT DeleteCompleteProject THEN BEGIN  //*C004759.n
                 IF ("Purchase Action" <> '') AND ("Purchase Action Status" = "Purchase Action Status"::Definitive) THEN
                   FIELDERROR("Purchase Action Status",
                     STRSUBSTNO(Text015, FIELDCAPTION("Purchase Action"), "Purchase Action", "Purchase Action Status"));

                 IF "Line No." <> 0 THEN BEGIN   //(when line no.=0 Navision will be closed; error probably caused by import)
                   lvBudgetLine.RESET;
                   lvBudgetLine.SETRANGE("Project No.","Project No.");
                   lvBudgetLine.SETRANGE(Adjustment, Adjustment);
                   lvBudgetLine.SETRANGE("Attached to Line No.","Line No.");
                   lvBudgetLine.DELETEALL(TRUE);
                   IF ("Source Type" = "Source Type"::"Recipe Header") AND (Recipe <> '') THEN BEGIN
                     lvBudgetLine.SETRANGE("Attached to Line No.");
                     lvBudgetLine.SETRANGE("Attached to Recipe Line","Line No.");
                     lvBudgetLine.DELETEALL(TRUE);
                   END;
                 END;

                 UpdateCostControlStatus(UpdateAction::Delete);
                 UpdateLogbook;
               END;  //*C004759.n

               DeleteTenderParagraph;  //C056424
               DeleteCommentLine();

               IF (SalesPriceBudgetLine.GET("Project No.",Adjustment,"Extension Contract","Line No.")) THEN
                  SalesPriceBudgetLine.DELETE();  //DP00789-RFC20

               BudgetPlanningActivity.SETRANGE("Project No.","Project No.");
               BudgetPlanningActivity.SETRANGE(Adjustment,Adjustment);
               BudgetPlanningActivity.SETRANGE("Extension Contract","Extension Contract");
               BudgetPlanningActivity.SETRANGE(Option,Option);
               BudgetPlanningActivity.SETRANGE("Budget Line No.","Line No.");
               IF BudgetPlanningActivity.FINDSET THEN
                 BudgetPlanningActivity.DELETEALL;

               IF PurchaseLineDetail.GET(PurchaseLineDetail."Line Type"::"Budget Line", PurchaseLineDetail."Record Type"::Project,
                                         "Project No.", Adjustment, "Extension Contract", 0, '', '', Option, "Line No.")
               THEN
                 PurchaseLineDetail.DELETE;

               PlotOption.SETRANGE(PlotOption."Project No.","Project No.");
               PlotOption.SETRANGE(PlotOption."Plot No.","Plot No.");
               PlotOption.SETRANGE(PlotOption."House Model","House Model");
               PlotOption.SETRANGE(PlotOption."Main Group","Main Group");
               PlotOption.SETRANGE(PlotOption.Group, Group);
               PlotOption.SETRANGE(PlotOption."Sub Group", "Sub Group");
               PlotOption.SETRANGE(PlotOption.Option,Option);
               IF PlotOption.FINDFIRST THEN BEGIN
                 PlotOption."Contract Am.- Net Am.Trans." := FALSE;
                 PlotOption.MODIFY(TRUE);
               END;
             END;

    OnRename=VAR
               BudgetPlanningActivity@1100529400 : Record 11229302;
               BudgetPlanningActivity2@1100529401 : Record 11229302;
               PurchaseLineDetail@1100529600 : Record 11020660;
             BEGIN
               UpdatePurchActionStatusInLine;
               UpdateLogbook;

               BudgetPlanningActivity.SETRANGE("Project No.",xRec."Project No.");
               BudgetPlanningActivity.SETRANGE(Adjustment,xRec.Adjustment);
               BudgetPlanningActivity.SETRANGE("Extension Contract",xRec."Extension Contract");
               BudgetPlanningActivity.SETRANGE(Option,xRec.Option);
               BudgetPlanningActivity.SETRANGE("Budget Line No.",xRec."Line No.");
               IF BudgetPlanningActivity.FINDSET THEN BEGIN
                 REPEAT
                   IF NOT BudgetPlanningActivity2.GET("Project No.",Adjustment,"Extension Contract",Option,"Line No.",BudgetPlanningActivity."Project Planning Activity No.") THEN BEGIN
                     BudgetPlanningActivity2 := BudgetPlanningActivity;
                     BudgetPlanningActivity2."Project No." := "Project No.";
                     BudgetPlanningActivity2.Adjustment := Adjustment;
                     BudgetPlanningActivity2."Extension Contract" := "Extension Contract";
                     BudgetPlanningActivity2.Option := Option;
                     BudgetPlanningActivity2."Budget Line No." := "Line No.";
                     BudgetPlanningActivity2.INSERT;
                   END;
                 UNTIL BudgetPlanningActivity.NEXT = 0;
                 BudgetPlanningActivity.DELETEALL;
               END;

               IF PurchaseLineDetail.GET(PurchaseLineDetail."Line Type"::"Budget Line", PurchaseLineDetail."Record Type"::Project,
                                         xRec."Project No.", xRec.Adjustment, xRec."Extension Contract", 0, '', '', xRec.Option, xRec."Line No.")
               THEN
                 PurchaseLineDetail.DELETE;
             END;

    CaptionML=[ENU=Budget Line;
               NOR=Budsjettrad;
               SVE=Budgetrad];
    LookupPageID=Page11012005;
    DrillDownPageID=Page11012005;
  }
  FIELDS
  {
    { 1   ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=[ENU=Project No.;
                                                              NOR=Prosjektnr;
                                                              SVE=Projektnr] }
    { 2   ;   ;Element             ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                ElementFormat.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN BEGIN
                                                                  IF "Project No." = '' THEN BEGIN
                                                                    ElemRec.GET(Element);
                                                                    Chapter := ElemRec.Chapter;
                                                                    Paragraph := ElemRec.Paragraph;
                                                                  END ELSE BEGIN
                                                                    ProjElemRec.GET("Project No.",Element);
                                                                    Chapter := ProjElemRec.Chapter;
                                                                    Paragraph := ProjElemRec.Paragraph;
                                                                    Discipline := ProjElemRec.Discipline;
                                                                    VALIDATE("Element Phase Code", ProjElemRec."Phase Code");
                                                                  END;
                                                                END ELSE BEGIN
                                                                  CLEAR(Chapter);
                                                                  CLEAR(Paragraph);
                                                                  CLEAR("Element Phase Code");
                                                                END;
                                                                CALCFIELDS("Element Description");
                                                              END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=[ENU=Element;
                                                              NOR=Element;
                                                              SVE=Element] }
    { 3   ;   ;Cost Object         ;Code20        ;TableRelation=IF (Cost Type=CONST(Labor)) "Dimension Value".Code WHERE (Cost Type=FILTER(Labor),
                                                                                                                           Global Dimension No.=CONST(2),
                                                                                                                           Project Filter=FIELD(Project No.))
                                                                                                                           ELSE IF (Cost Type=CONST(Material)) "Dimension Value".Code WHERE (Cost Type=FILTER(Material),
                                                                                                                                                                                             Global Dimension No.=CONST(2),
                                                                                                                                                                                             Project Filter=FIELD(Project No.))
                                                                                                                                                                                             ELSE IF (Cost Type=CONST(Plant)) "Dimension Value".Code WHERE (Cost Type=FILTER(Plant),
                                                                                                                                                                                                                                                            Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                            Project Filter=FIELD(Project No.))
                                                                                                                                                                                                                                                            ELSE IF (Cost Type=CONST(Sundry)) "Dimension Value".Code WHERE (Cost Type=FILTER(Sundry),
                                                                                                                                                                                                                                                                                                                            Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                                                                                            Project Filter=FIELD(Project No.))
                                                                                                                                                                                                                                                                                                                            ELSE IF (Cost Type=CONST(Subcontracting)) "Dimension Value".Code WHERE (Cost Type=FILTER(Subcontracting),
                                                                                                                                                                                                                                                                                                                                                                                                    Global Dimension No.=CONST(2),
                                                                                                                                                                                                                                                                                                                                                                                                    Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                JobsSetup@1100528000 : Record 315;
                                                                UserSetup@1100529600 : Record 91;
                                                                Selection@1100525000 : Integer;
                                                              BEGIN
                                                                IF "Cost Object" <> '' THEN BEGIN
                                                                  DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE, "Project No.");
                                                                  DimValRec.TESTFIELD(Blocked, FALSE);
                                                                  IF xRec."Cost Object" = '' THEN
                                                                    GetDefaultsCostObject(FALSE)
                                                                  ELSE BEGIN
                                                                    IF "Cost Object" <> xRec."Cost Object" THEN BEGIN
                                                                      IF "Item No." + "Basic Item" + "Trade Item" = '' THEN BEGIN
                                                                        IF NOT UserSetup.GET(USERID) THEN
                                                                          CLEAR(UserSetup);
                                                                        IF GUIALLOWED AND (UserSetup."Answer Change CO in Budget" = UserSetup."Answer Change CO in Budget"::"Ask Question") THEN
                                                                          Selection := STRMENU(Text018, 3)
                                                                        ELSE
                                                                          Selection := UserSetup."Answer Change CO in Budget";
                                                                        IF Selection < 3 THEN
                                                                          GetDefaultsCostObject(Selection=2);
                                                                      END;
                                                                    END;
                                                                  END;
                                                                  //*C018222.sn
                                                                  JobsSetup.GET();
                                                                  IF (NOT JobsSetup."Cost Component Editable") AND (DimValRec."Cost Component" <> '') AND ("Cost Component" <> DimValRec."Cost Component") THEN
                                                                    VALIDATE("Cost Component", DimValRec."Cost Component");
                                                                  //*C018222.en
                                                                END;
                                                                IF ("Cost Object" <> xRec."Cost Object") AND ("FSC Type Code" = '') THEN  //*DP00129
                                                                  FillDefaultFscType();
                                                              END;

                                                   CaptionML=[ENU=Global Dimension 2 Code;
                                                              NOR=Kostnadsobjekt;
                                                              SVE=Kostnadsobjekt];
                                                   CaptionClass='1,1,2' }
    { 4   ;   ;Description         ;Text100       ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse;
                                                              SVE=Beskrivning] }
    { 5   ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              NOR=Beskrivelse 2;
                                                              SVE=Beskrivning 2] }
    { 6   ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                CalcTotals;
                                                                IF CurrFieldNo = FIELDNO(Quantity) THEN BEGIN
                                                                  CheckRecipeTotals;
                                                                  CheckBomLines;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              NOR=Antall;
                                                              SVE=Antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 7   ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN
                                                                  ValidateUnitOfMeasure("Unit of Measure");
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=[ENU=Unit of Measure;
                                                              NOR=M†leenhet;
                                                              SVE=M†ttenhet] }
    { 8   ;   ;Norm                ;Decimal       ;OnValidate=BEGIN
                                                                IF ("Cost Type" = "Cost Type"::Labor) OR ("Cost Type" = "Cost Type"::Subcontracting) OR ("Cost Type" = "Cost Type"::Plant) THEN  //DP01676
                                                                  CalcTotals
                                                                ELSE BEGIN
                                                                  IF Norm <> 0 THEN
                                                                    MESSAGE(Text002, "Cost Type");
                                                                  Norm := 0;
                                                                END;

                                                                IF CurrFieldNo <> FIELDNO("Production Rate") THEN BEGIN
                                                                  IF "Apply Obligation" THEN BEGIN  //DP01676
                                                                    IF "Production Rate" <> 0 THEN
                                                                      Norm := 1
                                                                    ELSE
                                                                      Norm := 0;
                                                                  END ELSE BEGIN
                                                                    IF Norm <> 0 THEN
                                                                      "Production Rate" := 1 / Norm
                                                                    ELSE
                                                                      "Production Rate" := 0;
                                                                  END;
                                                                END;
                                                                CheckCombinationOfCostTypeAndNorm;
                                                              END;

                                                   CaptionML=[ENU=Norm;
                                                              NOR=Norm;
                                                              SVE=Norm];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 9   ;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Main Project No.;
                                                              NOR=Hovedprosjektnr.;
                                                              SVE=Huvudprojektnr] }
    { 10  ;   ;Rate Code           ;Code10        ;TableRelation="Budget Rate".Code WHERE (Project Filter=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                BudgetHourRateManagement@1100528600 : Codeunit 11012358;
                                                                BudgetRateFoundAt@1100528601 : Text[250];
                                                                Project@1100527550 : Record 11072003;
                                                              BEGIN
                                                                IF ("Cost Type" = "Cost Type"::Labor) THEN BEGIN
                                                                  "Rate (LCY)" := 0;
                                                                  IF "Version Date" = 0D THEN
                                                                    GetVersionDate;
                                                                  IF "Department Code" = '' THEN
                                                                    IF Project.GET("Project No.") THEN
                                                                      "Department Code" := Project."Global Dimension 1 Code";
                                                                  "Rate (LCY)" :=
                                                                    BudgetHourRateManagement.GetBudgetRate(
                                                                      0, "Project No.", '', '', "Department Code", "Rate Code", "Version Date", BudgetRateFoundAt);
                                                                  VALIDATE("Rate (LCY)");  //DP00883
                                                                  CalcTotals;
                                                                END ELSE BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Rate Code") THEN
                                                                    MESSAGE(Text003, "Cost Type");
                                                                  "Rate Code" := '';
                                                                  "Wage Component" := '';  //DP00236
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              BudgetRate@1100528501 : Record 11012000;
                                                              BudgetRateList@1100528504 : Page 11020265;
                                                            BEGIN
                                                              BudgetRateList.SetOnLookupForRateCode("Project No.");
                                                              BudgetRateList.LOOKUPMODE(TRUE);
                                                              IF BudgetRateList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                                BudgetRateList.GETRECORD(BudgetRate);
                                                                VALIDATE("Rate Code", BudgetRate.Code);
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=Rate Code;
                                                              NOR=Avgiftskode;
                                                              SVE=Avgiftskod] }
    { 11  ;   ;Rate (LCY)          ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Rate (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Rate (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886

                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Rate (LCY);
                                                              SVE=Avgift (BVA)];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 12  ;   ;Hours               ;Decimal       ;FieldClass=Normal;
                                                   CaptionML=[ENU=Hours;
                                                              NOR="Timer ";
                                                              SVE=Timmar];
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 13  ;   ;Amount (LCY)        ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Amount (LCY)") THEN
                                                                  "Amount (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Amount (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);
                                                                CALCFIELDS("Total Amount","Total Hours","Total Labor","Total material","Total Subcontracting","Total Plant","Total Sundry");
                                                              END;

                                                   CaptionML=[ENU=Amount (LCY);
                                                              NOR=Bel›p (NOK);
                                                              SVE=Belopp (BVA)];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=1 }
    { 14  ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.;
                                                              SVE=Radnr] }
    { 15  ;   ;Project Description ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=[ENU=Project Description;
                                                              NOR=Prosjektbeskrivelse;
                                                              SVE=Projektbeskrivning];
                                                   Editable=No }
    { 17  ;   ;Cost Object Description;Text50     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Code=FIELD(Cost Object),
                                                                                                    Global Dimension No.=CONST(2)));
                                                   CaptionML=[ENU=Cost Object Description;
                                                              NOR=Kostnadsobjekt, Beskrivelse;
                                                              SVE=Kostnadsobjekt, beskrivning];
                                                   Editable=No;
                                                   CaptionClass=[ '1,11012000,2, , ' + Text100] }
    { 18  ;   ;Element Description ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Element)));
                                                   CaptionML=[ENU=Element Description;
                                                              NOR=Elementbeskrivelse;
                                                              SVE=Elementbeskrivning];
                                                   Editable=No }
    { 19  ;   ;Total Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=[ENU=Total Amount;
                                                              NOR=Totalt bel›p;
                                                              SVE=Total Amount];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 20  ;   ;Total Hours         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Adjustment=FIELD(Adjustment Filter),
                                                                                              Extension Contract=FIELD(Extension Filter),
                                                                                              Option=FIELD(Option Filter),
                                                                                              Purchase Action=FIELD(Purchase Action Filter),
                                                                                              Cost Type=FILTER(Labor)));
                                                   CaptionML=[ENU=Total Hours;
                                                              NOR=Timer totalt;
                                                              SVE=Totalt timmar];
                                                   Editable=No }
    { 21  ;   ;Line Quantity       ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Budget Line");
                                                   CaptionML=[ENU=Line Quantity;
                                                              NOR=Radantall;
                                                              SVE=Radantal];
                                                   Editable=No }
    { 22  ;   ;Cost Type           ;Option        ;OnValidate=VAR
                                                                BudgetRateManagement@1100528600 : Codeunit 11012358;
                                                                BudgetRateFoundAt@1100528601 : Text[250];
                                                              BEGIN
                                                                IF "Cost Object" <> '' THEN BEGIN
                                                                  IF "Cost Type" <> xRec."Cost Type" THEN
                                                                    IF CONFIRM(Text004,TRUE) THEN BEGIN
                                                                      "Cost Object" := '';
                                                                      "Cost Component" := '';
                                                                      //only fill fields below for cost type Material
                                                                      "Item No." := '';
                                                                      "Basic Item" := '';
                                                                      "Trade Item" := '';
                                                                      Manufacturer := '';
                                                                      "Vendor (Trade Item)" := '';
                                                                    END ELSE BEGIN
                                                                      "Cost Type" := xRec."Cost Type";
                                                                      EXIT;
                                                                    END;
                                                                END;
                                                                IF ("Cost Type" <> xRec."Cost Type") OR ("Line No." = 0) THEN
                                                                  FillDefaultPlantCompany;
                                                                IF ("Cost Type" = "Cost Type"::Labor) THEN BEGIN
                                                                  ProjRec.GET("Project No.");
                                                                  IF "Version Date" = 0D THEN
                                                                    GetVersionDate;
                                                                  "Rate (LCY)" := BudgetRateManagement.GetBudgetRate(
                                                                    0, "Project No.", '', '', ProjRec."Global Dimension 1 Code", ProjRec."Default Rate Code", "Version Date", BudgetRateFoundAt);
                                                                  IF "Rate (LCY)" = 0 THEN BEGIN
                                                                    IF "Price (LCY)" <> 0 THEN
                                                                      ERROR(Text007);
                                                                  END ELSE
                                                                    "Rate Code" := ProjRec."Default Rate Code";
                                                                  IF ("Rate (LCY)" <> 0) AND ("Price (LCY)" <> 0) THEN BEGIN
                                                                    Norm := "Price (LCY)" / "Rate (LCY)";
                                                                    "Production Rate" := 1 / Norm
                                                                  END;
                                                                  "Price (LCY)" := 0;
                                                                END ELSE BEGIN
                                                                  IF ("Rate (LCY)" <> 0) THEN
                                                                    "Price (LCY)" := Norm * "Rate (LCY)";
                                                                  "Rate Code" := '';
                                                                  "Rate (LCY)" := 0;
                                                                  IF ("Plant Rates in Hours" = FALSE) AND ("Subcontracting in Hours" = FALSE) THEN  //C053751
                                                                    InitNormRelatedFields(0);
                                                                END;
                                                                IF ("Cost Type" <> "Cost Type"::Plant) THEN
                                                                  "Plant Rates in Hours" := FALSE;  //DP02115
                                                                IF ("Cost Type" <> "Cost Type"::Subcontracting) THEN
                                                                  "Subcontracting in Hours" := FALSE;  //C053751

                                                                CheckCombinationOfCostTypeAndNorm;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Cost Type;
                                                              NOR=Kosttype;
                                                              SVE=Kostnadstyp];
                                                   OptionCaptionML=[ENU=Labor,Material,Subcontracting,Plant,Sundry;
                                                                    NOR=Arbeidskraft,Materiale,Underentrepen›r,Maskin,Diverse;
                                                                    SVE=Arbetskraft,Material,Underentreprenad,Maskin,Diverse];
                                                   OptionString=Labor,Material,Subcontracting,Plant,Sundry }
    { 23  ;   ;Price (LCY)         ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886

                                                                IF ("Cost Type" = "Cost Type"::Labor) THEN BEGIN
                                                                  IF ("Price (LCY)" <> 0) OR ("Price (FCY)" <> 0) THEN
                                                                    MESSAGE(Text005);
                                                                  "Price (LCY)" := 0;
                                                                  "Price (FCY)" := 0;
                                                                END ELSE BEGIN
                                                                  CalculateDiscount;
                                                                  CalcTotals;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Price (LCY);
                                                              SVE=Pris (BVA)];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 24  ;   ;Time Quantity       ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Time Quantity;
                                                              NOR=Tidskvantitet;
                                                              SVE=Tidskvantitet];
                                                   BlankZero=Yes }
    { 25  ;   ;Unit of Time        ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=[ENU=Unit of Time;
                                                              NOR=Tidsenhet;
                                                              SVE=Tidsenhet] }
    { 26  ;   ;Total Labor         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Labor),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=[ENU=Total Labor;
                                                              NOR=Total arbeidskraft;
                                                              SVE=Total arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 27  ;   ;Total material      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Material),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=[ENU=Total material;
                                                              NOR=Totalt materiale;
                                                              SVE=Totalt material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 28  ;   ;Total Subcontracting;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Subcontracting),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=[ENU=Total Subcontracting;
                                                              NOR=Underleverand›r Total;
                                                              SVE=Underentreprenad totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 29  ;   ;Total Plant         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Plant),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=[ENU=Total Plant;
                                                              NOR=Maskin total;
                                                              SVE=Maskin totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 30  ;   ;Total Sundry        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Sundry),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=[ENU=Total Sundry;
                                                              NOR=Totalt diverse;
                                                              SVE=Totalt diverse];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 31  ;   ;Adjustment          ;Code10        ;TableRelation="Budget Adjustment".No. WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Adjustment;
                                                              NOR=Justering;
                                                              SVE=Justering] }
    { 32  ;   ;Adjustment Filter   ;Code10        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Adjustment Filter;
                                                              NOR=Justeringsfilter;
                                                              SVE=Justeringsfilter] }
    { 33  ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Extension Contract;
                                                              NOR=ETA;
                                                              SVE=ŽTA] }
    { 34  ;   ;Extension Filter    ;Code10        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Extension Filter;
                                                              NOR=ETA-filter;
                                                              SVE=ŽTA-filter] }
    { 35  ;   ;Version Date        ;Date          ;CaptionML=[ENU=Version Date;
                                                              NOR=Versjonsdato;
                                                              SVE=Versionsdatum] }
    { 36  ;   ;Chapter             ;Code20        ;CaptionML=[ENU=Chapter;
                                                              NOR=Kapittel;
                                                              SVE=Kapitel];
                                                   Editable=No }
    { 37  ;   ;Paragraph           ;Code20        ;CaptionML=[ENU=Paragraph;
                                                              NOR=Avsnitt;
                                                              SVE=Stycke];
                                                   Editable=No }
    { 38  ;   ;Option              ;Code20        ;TableRelation=Option.Option WHERE (Project No.=FIELD(Project No.),
                                                                                      Plot No.=FIELD(Plot No.),
                                                                                      House Model=FIELD(House Model),
                                                                                      Main Group=FIELD(Main Group),
                                                                                      Group=FIELD(Group),
                                                                                      Sub Group=FIELD(Sub Group));
                                                   OnValidate=BEGIN
                                                                IF Option <> '' THEN BEGIN
                                                                  OptionRec.GET("Project No.", "Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
                                                                  IF NOT (OptionRec.Status IN [OptionRec.Status::Order, OptionRec.Status::Invoice]) THEN
                                                                    OptionRec.FIELDERROR(Status);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Option;
                                                              NOR=Alternativ;
                                                              SVE=Alternativ] }
    { 39  ;   ;Option Filter       ;Code20        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Option Filter;
                                                              NOR=Alternativfilter;
                                                              SVE=Alternativfilter] }
    { 55  ;   ;Department Code     ;Code20        ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Code;
                                                              NOR=Avdelingskode;
                                                              SVE=Mottagande avdelningskod];
                                                   Editable=No;
                                                   CaptionClass='1,1,1' }
    { 60  ;   ;Purchase Action     ;Code10        ;TableRelation="Project Purchase Action".Code WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=VAR
                                                                ProjectPurchaseAction@1100525000 : Record 11012026;
                                                              BEGIN
                                                                IF "Purchase Action" <> xRec."Purchase Action" THEN BEGIN
                                                                  IF xRec."Purchase Action" <> '' THEN BEGIN
                                                                    IF ProjectPurchaseAction.GET("Project No.", xRec."Purchase Action") THEN BEGIN
                                                                      IF ProjectPurchaseAction.Status = ProjectPurchaseAction.Status::Definitive THEN
                                                                       FIELDERROR("Purchase Action Status", STRSUBSTNO(Text026, ProjectPurchaseAction.Status, FIELDCAPTION("Purchase Action")));
                                                                    END;
                                                                  END;
                                                                  IF "Purchase Action" <> '' THEN BEGIN
                                                                    IF ProjectPurchaseAction.GET("Project No.", "Purchase Action") THEN BEGIN
                                                                      IF ProjectPurchaseAction.Status = ProjectPurchaseAction.Status::Definitive THEN
                                                                       FIELDERROR("Purchase Action", STRSUBSTNO(Text027, "Purchase Action", FIELDCAPTION("Purchase Action Status"), ProjectPurchaseAction.Status));
                                                                    END;
                                                                  END;
                                                                END;
                                                                IF "Purchase Action" <> '' THEN
                                                                  IF ("Extension Contract" <> '') THEN BEGIN
                                                                    ExtensionRec.GET("Project No.","Extension Contract");
                                                                    IF NOT (ExtensionRec.Status IN [ExtensionRec.Status::Order, ExtensionRec.Status::"Invoicing Allowed"]) THEN
                                                                      ExtensionRec.FIELDERROR(Status);
                                                                  END;
                                                              END;

                                                   CaptionML=[ENU=Purchase Action;
                                                              NOR=Innkj›pshandling;
                                                              SVE=Ink”ps†tg„rd] }
    { 65  ;   ;Purchase Action Filter;Code10      ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Purchase Action Filter;
                                                              NOR=Innkj›pshandlingsfilter;
                                                              SVE=Ink”ps†tg„rdsfilter] }
    { 70  ;   ;Purchase Phase      ;Code10        ;CaptionML=[ENU=Purchase Phase;
                                                              NOR=Innkj›psfase;
                                                              SVE=Ink”psfas];
                                                   Numeric=Yes }
    { 80  ;   ;Purchase Action Status;Option      ;CaptionML=[ENU=Purchase Action Status;
                                                              NOR=Innkj›pshandlingsstatus;
                                                              SVE=Ink”ps†tg„rdsstatus];
                                                   OptionCaptionML=[ENU=Concept,Applied,Approved,Definitive;
                                                                    NOR=Konsept,Anvendt,Godkjent,Definitiv;
                                                                    SVE=Koncept,Till„mpat,Godk„nt,Definitiv];
                                                   OptionString=Concept,Applied,Approved,Definitive;
                                                   Editable=No }
    { 85  ;   ;Purch. Action Approval Date;Date   ;CaptionML=[ENU=Purch. Action Approval Date;
                                                              NOR=Innkj›p Godkjenningsdato for Handling;
                                                              SVE=Ink”p Godk„nnandedatum f”r †tg„rd];
                                                   Editable=No }
    { 90  ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=BEGIN
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                                  ItemRec.TESTFIELD(Blocked,FALSE);
                                                                  ValidateVendor;
                                                                END;
                                                                IF "Item No." <> xRec."Item No." THEN
                                                                  "Variant Code" := '';
                                                              END;

                                                   CaptionML=[ENU=Item No.;
                                                              NOR=Artikkelnr;
                                                              SVE=Artikelnr] }
    { 91  ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::"Basic Item");
                                                                  ValidateVendor;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Basic Item;
                                                              NOR=Fabrikantartikkel;
                                                              SVE=Basartikel] }
    { 92  ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::"Trade Item");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Trade Item;
                                                              NOR=Katalogartikkel;
                                                              SVE=Anskaffningsartikel] }
    { 94  ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   OnValidate=VAR
                                                                TradeItemRec@1100525000 : Record 11012317;
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Vendor (Trade Item);
                                                              NOR=Leverand›r (katalogartikkel);
                                                              SVE=Leverant”r (skaffningsartikel)] }
    { 95  ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor - Central Mgt";
                                                   CaptionML=[ENU=Manufacturer;
                                                              NOR=Produsent;
                                                              SVE=Tillverkare] }
    { 101 ;   ;Advised             ;Boolean       ;CaptionML=[ENU=Advised;
                                                              NOR=Anbefalt;
                                                              SVE=F”reslaget] }
    { 105 ;   ;Copied to Adjustment;Boolean       ;CaptionML=[ENU=Copied to Adjustment;
                                                              NOR=Kopiert til Justering;
                                                              SVE=Kopierat till justering] }
    { 110 ;   ;Extension Contract Status;Option   ;CaptionML=[ENU=Extension Contract Status;
                                                              NOR=Status for ETA;
                                                              SVE=Status f”r ŽTA];
                                                   OptionCaptionML=[ENU=Not Applicable,Applied,Offered,Order,Invoicing Allowed,Expired;
                                                                    NOR=Ikke Anvendelig,Anvendt,Tilbudt,Ordre,Fakturering Tillatt,Utg†tt;
                                                                    SVE=Ej till„mpligt,Till„mpat,Erbjudet,Order,Fakturering till†ten,Utg†nget];
                                                   OptionString=Not Applicable,Applied,Offered,Order,Invoicing Allowed,Expired }
    { 115 ;   ;Total Summary       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Budget Summary Line=CONST(Yes)));
                                                   CaptionML=[ENU=Total Summary;
                                                              NOR=Totalt Sammendrag;
                                                              SVE=Totalt sammandrag];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 117 ;   ;Total Summary Actual;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Budget Summary Line=CONST(Yes),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=ENU=Total Summary Actual;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 120 ;   ;Total Amount Actual ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total Amount Actual;
                                                              NOR=Faktisk Totalbel›p;
                                                              SVE=Verkligt totalbelopp];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;Total Hours Actual  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Adjustment=FIELD(Adjustment Filter),
                                                                                              Extension Contract=FIELD(Extension Filter),
                                                                                              Option=FIELD(Option Filter),
                                                                                              Purchase Action=FIELD(Purchase Action Filter),
                                                                                              Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed),
                                                                                              Cost Type=CONST(Labor)));
                                                   CaptionML=[ENU=Total Hours Actual;
                                                              NOR=Faktiske timer Totalt;
                                                              SVE=Verkliga timmar totalt];
                                                   Description=DP01047;
                                                   Editable=No }
    { 131 ;   ;Total Hours Plant Actual;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Adjustment=FIELD(Adjustment Filter),
                                                                                              Extension Contract=FIELD(Extension Filter),
                                                                                              Option=FIELD(Option Filter),
                                                                                              Purchase Action=FIELD(Purchase Action Filter),
                                                                                              Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed),
                                                                                              Cost Type=CONST(Plant)));
                                                   CaptionML=ENU=Total Hours Plant Actual;
                                                   Description=DP02115;
                                                   Editable=No }
    { 132 ;   ;Total Hours Plant   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Adjustment=FIELD(Adjustment Filter),
                                                                                              Extension Contract=FIELD(Extension Filter),
                                                                                              Option=FIELD(Option Filter),
                                                                                              Purchase Action=FIELD(Purchase Action Filter),
                                                                                              Cost Type=FILTER(Plant)));
                                                   CaptionML=ENU=Total Hours Plant;
                                                   Description=DP02115;
                                                   Editable=No }
    { 140 ;   ;Total Labor Actual  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Labor),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total Labor Actual;
                                                              NOR=Total Faktisk arbeidskraft;
                                                              SVE=Total verklig arbetskraft];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 150 ;   ;Total Material Actual;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Material),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total material Actual;
                                                              NOR=Faktisk Totalt Materiale;
                                                              SVE=Verkligt totalt material];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 160 ;   ;Total Subcontracting Actual;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Subcontracting),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total Subcontracting Actual;
                                                              NOR=Faktisk underentrepen›r Totalt;
                                                              SVE=Verklig underentreprenad totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 170 ;   ;Total Plant Actual  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Plant),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total Plant Actual;
                                                              NOR=Faktisk maskin totalt;
                                                              SVE=Verklig Maskin totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 180 ;   ;Total Sundry Actual ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Cost Type=CONST(Sundry),
                                                                                                       Adjustment=FIELD(Adjustment Filter),
                                                                                                       Extension Contract=FIELD(Extension Filter),
                                                                                                       Option=FIELD(Option Filter),
                                                                                                       Purchase Action=FIELD(Purchase Action Filter),
                                                                                                       Extension Contract Status=FILTER(Not Applicable|Order|Invoicing Allowed)));
                                                   CaptionML=[ENU=Total Sundry Actual;
                                                              NOR=Faktiske diversekoster Totalt;
                                                              SVE=Verkliga diversekostnader totalt];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 190 ;   ;External Text       ;Text250       ;OnValidate=BEGIN
                                                                "External Text Block" := "External Text" <> '';
                                                              END;

                                                   CaptionML=[ENU=External Text;
                                                              NOR=Ekstern Tekst;
                                                              SVE=Extern text] }
    { 191 ;   ;External Text Block ;Boolean       ;CaptionML=[ENU=External Text Block;
                                                              NOR=Ekstern Tekstblokk;
                                                              SVE=Externt textblock];
                                                   Editable=No }
    { 195 ;   ;Project Related Name;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project - Cost Object".Name WHERE (Project No.=FIELD(Project No.),
                                                                                                          Cost Object=FIELD(Cost Object)));
                                                   CaptionML=[ENU=Project Related Name;
                                                              NOR=Prosjektrelatert navn;
                                                              SVE=Projektrelaterat namn];
                                                   Description=Name Cost Object;
                                                   Editable=No }
    { 200 ;   ;Plot No.            ;Code10        ;TableRelation=Plot."Plot No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Plot No.;
                                                              NOR=Tegningnr;
                                                              SVE=Ritningnr] }
    { 201 ;   ;Plot No. Filter     ;Code10        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Plot No. Filter;
                                                              NOR=Tegningsnummerfilter;
                                                              SVE=Ritningsnummerfilter] }
    { 202 ;   ;Block No.           ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Plot."Block No." WHERE (Project No.=FIELD(Project No.),
                                                                                              Plot No.=FIELD(Plot No.)));
                                                   CaptionML=[ENU=Block No.;
                                                              SVE=Sp„rrnr];
                                                   Description=DP02088;
                                                   Editable=No }
    { 210 ;   ;Budget Summary Line ;Boolean       ;CaptionML=[ENU=Budget Summary Line;
                                                              NOR=Budsjettsammendragsrad;
                                                              SVE=Budgetsammandragsrad] }
    { 215 ;   ;Budget Summary Row No.;Code10      ;CaptionML=[ENU=Budget Summary Row No.;
                                                              NOR=Budsjettsammendrag, Radnr;
                                                              SVE=Budgetsammandrag, radnr] }
    { 220 ;   ;Purchase Route Reference;Code20    ;OnLookup=VAR
                                                              lvRouteRefMgtCU@1210190000 : Codeunit 11012045;
                                                            BEGIN
                                                              lvRouteRefMgtCU.ShowReferenceList("Purchase Route Reference");
                                                            END;

                                                   CaptionML=[ENU=Purchase Route Reference;
                                                              NOR=Referanse for Innkj›psrute;
                                                              SVE=Referens f”r ink”psf”ljd];
                                                   Editable=No }
    { 225 ;   ;Reference No.       ;GUID          ;CaptionML=[ENU=Reference No.;
                                                              NOR=Referansenr;
                                                              SVE=Referensnummer];
                                                   Description=DP00042;
                                                   Editable=No }
    { 230 ;   ;Price Agreement     ;Boolean       ;CaptionML=[ENU=Price Agreement;
                                                              NOR=Prisavtale;
                                                              SVE=Prisavtal] }
    { 240 ;   ;Vendor              ;Code20        ;TableRelation=IF (Subcontracting Activity=FILTER(='')) Vendor.No.
                                                                 ELSE IF (Subcontracting Activity=FILTER(<>'')) "Subcontracting Activity Price"."Subcontractor No." WHERE (Subcontracting Activity=FIELD(Subcontracting Activity));
                                                   OnValidate=BEGIN
                                                                IF "Subcontracting Activity" <> '' THEN
                                                                  GetSubcontractorActivity(FIELDNO(Vendor));  //DP01958a
                                                              END;

                                                   CaptionML=[ENU=Vendor;
                                                              NOR=Leverand›r;
                                                              SVE=Leverant”r] }
    { 245 ;   ;Vendor Name         ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=[ENU=Vendor Name;
                                                              NOR=Leverand›rsnavn;
                                                              SVE=Leverant”rsnamn];
                                                   Editable=No }
    { 250 ;   ;Gross Price (LCY)   ;Decimal       ;OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Gross Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Gross Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886

                                                                CalculateNetPrice;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Gross Price (LCY);
                                                              NOR=Bruttopris (NOK);
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 260 ;   ;Discount %          ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNetPrice;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Discount %;
                                                              NOR=Rabatt-%;
                                                              SVE=Rabatt %];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 270 ;   ;Option Line Type    ;Option        ;CaptionML=[ENU=Option Line Type;
                                                              NOR=Alternativradtype;
                                                              SVE=Alternativradtyp];
                                                   OptionCaptionML=[ENU=" ,Option Budget,Option Surcharge";
                                                                    NOR=" ,Alternativbudsjett,Alternativtilleggsgebyr";
                                                                    SVE=" ,Alternativbudget,Alternativtill„ggsavgift"];
                                                   OptionString=[ ,Option Budget,Option Surcharge];
                                                   Editable=No }
    { 271 ;   ;Budget Level for Options;Option    ;CaptionML=[ENU=Budget Level for Options;
                                                              NOR=Budsjettniv† for Alternativ;
                                                              SVE=Budgetniv† f”r alternativ];
                                                   OptionCaptionML=[ENU=Detailed,Option-Cost Type,Option-Cost Object,Option-Element-Cost Type,Option-Element-Cost Object;
                                                                    NOR=Detaljert,Alternativ-Kostnadstype,Alternativ-Kostnadsobjekt,Alternativ-Element-Kostnadstype,Alternativ-Element-Kostnadsobjekt;
                                                                    SVE=Detaljerad,Alternativ-kostnadstyp,Alternativ-kostnadsobjekt,Alternativ-element-kostnadstyp,Alternativ-element-kostnadsobjekt];
                                                   OptionString=Detailed,Option-Cost Type,Option-Cost Object,Option-Element-Cost Type,Option-Element-Cost Object;
                                                   Editable=No }
    { 272 ;   ;Budget Level for Settl. Q.;Option  ;CaptionML=[ENU=Budget Level for Settlement Quantities;
                                                              SVE=Budgetniv† f”r avr„kningsantal];
                                                   OptionCaptionML=[ENU=Detailed,Cost Type,Cost Object,Element-Cost Type,Element-Cost Object;
                                                                    SVE=Detaljerad,Kostnadstyper,Kostnadsobjekt,Element - Kostnadstyper,Element - Kostnadsobjekt];
                                                   OptionString=Detailed,SQ-Cost Type,SQ-Cost Object,SQ-Element-Cost Type,SQ-Element-Cost Object;
                                                   Editable=No }
    { 273 ;   ;Settl. Q. Line Type ;Option        ;CaptionML=ENU=Settlement Quantity Line Type;
                                                   OptionCaptionML=ENU=" ,Settlement Quantity Budget,Settlement Quantity Surcharge";
                                                   OptionString=[ ,SQ Budget,SQ Surcharge];
                                                   Editable=No }
    { 274 ;   ;Settl. Q. Line No.  ;Integer       ;CaptionML=ENU=Settlement Quantity Line No.;
                                                   Editable=No }
    { 275 ;   ;Option Line No.     ;Integer       ;CaptionML=[ENU=Option Line No.;
                                                              NOR=Alternativradnr.;
                                                              SVE=Alternativradnr];
                                                   Editable=No }
    { 280 ;   ;House Model         ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=House Model;
                                                              NOR=Husmodell;
                                                              SVE=Husmodell] }
    { 290 ;   ;Main Group          ;Code20        ;TableRelation="Option Main Group".Code WHERE (Project No.=FIELD(Project No.),
                                                                                                 Plot No.=FIELD(Plot No.));
                                                   CaptionML=[ENU=Main Group;
                                                              NOR=Hovedgruppe;
                                                              SVE=Huvudgrupp] }
    { 300 ;   ;Group               ;Code20        ;TableRelation="Option Group".Code WHERE (Project No.=FIELD(Project No.),
                                                                                            Plot No.=FIELD(Plot No.));
                                                   CaptionML=[ENU=Group;
                                                              NOR=Gruppe;
                                                              SVE=Grupp] }
    { 310 ;   ;Sub Group           ;Code20        ;TableRelation="Option Sub Group".Code WHERE (Project No.=FIELD(Project No.),
                                                                                                Plot No.=FIELD(Plot No.));
                                                   CaptionML=[ENU=Sub Group;
                                                              NOR=Undergruppe;
                                                              SVE=Undergrupp] }
    { 320 ;   ;FSC Type Code       ;Code10        ;TableRelation="FSC Type";
                                                   CaptionML=[ENU=FSC Type Code;
                                                              NOR=FSC Typekode;
                                                              SVE=FSC typkod] }
    { 400 ;   ;Tender Paragraph    ;Text20        ;TableRelation="Project Tender Paragraph"."Tender Paragraph" WHERE (Project No.=FIELD(Project No.),
                                                                                                                      Level=CONST(Tender Paragraph));
                                                   OnValidate=BEGIN
                                                                GWWMgtCU.FormatTenderElement("Tender Paragraph");
                                                                IF "Tender Paragraph" = '' THEN
                                                                  "Tender Paragraph Part" := ''
                                                                ELSE BEGIN
                                                                  IF "Tender Paragraph" <> xRec."Tender Paragraph" THEN BEGIN
                                                                    "Tender Paragraph Part" := '';
                                                                    FillDefaultTenderElementPart();
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph;
                                                              NOR=Tilbudsavsnitt;
                                                              SVE=Anbudsstycke];
                                                   Description=DP01676 }
    { 405 ;   ;Description Tender Paragraph;Text100;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Tender Paragraph".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                                    Tender Paragraph=FIELD(Tender Paragraph)));
                                                   CaptionML=[ENU=Description Tender Paragraph;
                                                              NOR=Beskrivelse, tilbudsavsnitt;
                                                              SVE=Beskrivning, anbudsparagraf];
                                                   Editable=No }
    { 406 ;   ;Tender Paragraph Text;Text80       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Tender Paragraph Text".Text WHERE (Project No.=FIELD(Project No.),
                                                                                                                  Tender Paragraph=FIELD(Tender Paragraph)));
                                                   CaptionML=[ENU=Tender Paragraph Text;
                                                              NOR=Tilbudsavsnitttekst;
                                                              SVE=Anbudsstycketext];
                                                   Editable=No }
    { 410 ;   ;Tender Paragraph Part;Text20       ;TableRelation="Project Tender Paragraph Part"."Tender Paragraph Part" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                Tender Paragraph=FIELD(Tender Paragraph));
                                                   OnValidate=BEGIN
                                                                GWWMgtCU.FormatTenderElementPart("Tender Paragraph Part");
                                                              END;

                                                   CaptionML=[ENU=Tender Paragraph Part;
                                                              NOR=Tilbudsavsnittdel;
                                                              SVE=Anbudsstyckedel];
                                                   Description=DP01676 }
    { 415 ;   ;Descr Tender Paragraph Part;Text100;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Tender Paragraph Part".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                                         Tender Paragraph=FIELD(Tender Paragraph),
                                                                                                                         Tender Paragraph Part=FIELD(Tender Paragraph Part)));
                                                   CaptionML=[ENU=Description Tender Paragraph Part;
                                                              NOR=Beskrivelse, tilbudsavsnittdel;
                                                              SVE=Beskrivning, anbudsparagrafdel];
                                                   Editable=No }
    { 420 ;   ;Production Rate     ;Decimal       ;OnValidate=BEGIN
                                                                //DP01676
                                                                IF "Apply Obligation" THEN BEGIN
                                                                  IF "Production Rate" <> 0 THEN BEGIN
                                                                    Norm := 1;
                                                                    VALIDATE(Quantity, "Quantity (Result Obligation)" / "Production Rate")
                                                                  END ELSE BEGIN
                                                                    Norm := 0;
                                                                    VALIDATE(Quantity, 0);
                                                                  END;
                                                                END ELSE BEGIN
                                                                  IF "Production Rate" <> 0 THEN
                                                                    VALIDATE(Norm, 1 / "Production Rate")
                                                                  ELSE
                                                                    VALIDATE(Norm, 0);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Production Rate;
                                                              NOR=Produksjonsrate;
                                                              SVE=Produktionstakt];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=GWW }
    { 425 ;   ;Quantity (Result Obligation);Decimal;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Quantity  (Result Obligation);
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   Editable=No }
    { 426 ;   ;Apply Obligation    ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Apply Obligation;
                                                   Description=DP01676;
                                                   Editable=No }
    { 430 ;   ;Cost Component      ;Code20        ;TableRelation="Cost Component".Code;
                                                   CaptionML=[ENU=Cost Component;
                                                              NOR=Kostnadskomponent;
                                                              SVE=Kostnadskomponent] }
    { 440 ;   ;Item Type           ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Type" WHERE (Product Code=FIELD(Basic Item),
                                                                                                      Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Type;
                                                              NOR=Artikkeltype;
                                                              SVE=Artikeltyp];
                                                   Editable=No }
    { 441 ;   ;Item Brand          ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Brand" WHERE (Product Code=FIELD(Basic Item),
                                                                                                       Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Brand;
                                                              NOR=Artikkelens Varemerke;
                                                              SVE=Artikelns varum„rke];
                                                   Editable=No }
    { 442 ;   ;Item Series         ;Text40        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Basic Item"."Item Series" WHERE (Product Code=FIELD(Basic Item),
                                                                                                        Manufacturer=FIELD(Manufacturer)));
                                                   CaptionML=[ENU=Item Series;
                                                              NOR=Artikkelserier;
                                                              SVE=Artikelserier];
                                                   Editable=No }
    { 443 ;   ;Scheme Code         ;Code15        ;CaptionML=[ENU=Scheme Code;
                                                              NOR=Plankode;
                                                              SVE=Plankod] }
    { 444 ;   ;Comments            ;Text50        ;CaptionML=[ENU=Comments;
                                                              NOR=Kommentarer;
                                                              SVE=Kommentarer] }
    { 445 ;   ;Supply              ;Boolean       ;CaptionML=[ENU=Supply;
                                                              NOR=Tilf›rsel;
                                                              SVE=F”rr†d] }
    { 446 ;   ;Comments for Logistics;Text50      ;CaptionML=[ENU=Comments for Logistics;
                                                              NOR=Kommentarer for logistikk;
                                                              SVE=Kommentarer f”r logistik] }
    { 447 ;   ;Material Sheet      ;Option        ;CaptionML=[ENU=Material Sheet;
                                                              NOR=Materialeark;
                                                              SVE=Materialark];
                                                   OptionCaptionML=[ENU=Customer and Assemly,Customer Only,Assembly only,Do not report;
                                                                    NOR="Kunde og montering,Kun kunde,Kun montering,Ikke Rapporter ";
                                                                    SVE=Kund och montering,Endast kund,Endast montering,Rapportera inte];
                                                   OptionString=Customer and Assemly,Customer Only,Assembly only,Do not report }
    { 450 ;   ;Item Route Reference;Code20        ;CaptionML=[ENU=Item Route Reference;
                                                              NOR=Referanse for artikkelrute;
                                                              SVE=Referens f”r artikeloperationsf”ljd];
                                                   Editable=No }
    { 460 ;   ;Attached to Line No.;Integer       ;TableRelation="Budget Line"."Line No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              NOR=Tilknyttet Radnr;
                                                              SVE=Bifogad till radnr];
                                                   Editable=No }
    { 470 ;   ;Surcharge %         ;Decimal       ;OnValidate=BEGIN
                                                                CheckCombinationOfCostTypeAndNorm;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge %;
                                                              NOR=Tilleggsgebyrsprosent;
                                                              SVE=Till„ggsavgiftsprocent];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 475 ;   ;Surcharge Price (LCY);Decimal      ;OnValidate=BEGIN
                                                                CheckCombinationOfCostTypeAndNorm;
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Surcharge Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Surcharge Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);  //DP00886

                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Surcharge Price (LCY);
                                                              SVE=Omkostnadspris (BVA)];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 480 ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=[ENU=Estimate No.;
                                                              NOR=Kalkylenr;
                                                              SVE=Kalkylnr];
                                                   Editable=No }
    { 485 ;   ;Sub-Estimate No.    ;Code20        ;TableRelation=Sub-Estimate."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=[ENU=Sub-Estimate No.;
                                                              NOR=Delkalkylenummer;
                                                              SVE=Delkalkylnr];
                                                   Description=DP00381;
                                                   Editable=No }
    { 490 ;   ;Line No. External Estimate;Integer ;CaptionML=[ENU=Line No. External Estimate;
                                                              NOR=Radnr, Ekstern Kalkyle;
                                                              SVE=Radnr, extern kalkyl];
                                                   BlankZero=Yes }
    { 491 ;   ;Project Planning Activity No.;Code30;
                                                   TableRelation="Project Planning Activity".No. WHERE (Project No.=FIELD(Project No.),
                                                                                                        Type=CONST(Activity));
                                                   CaptionML=[ENU=Project Planning Activity No.;
                                                              NOR=Aktivitetsnummer for prosjektplanlegging;
                                                              SVE=Projektplaneringsaktivitetsnr] }
    { 492 ;   ;Proj. Plann. Parent Activ. No.;Code30;
                                                   TableRelation="Project Planning Activity".No. WHERE (Project No.=FIELD(Project No.),
                                                                                                        Type=CONST(Summary));
                                                   CaptionML=[ENU=Proj. Plann. Parent Activ. No.;
                                                              NOR=Prosjektplanlegging, Overordnet Aktivitetsnummer;
                                                              SVE=Proj.plan., ”verordnad akt. nr];
                                                   Editable=No }
    { 493 ;   ;Proj. Plan. Par. Activ. Descr.;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Planning Activity".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                                     No.=FIELD(Project Planning Activity No.)));
                                                   CaptionML=[ENU=Project Planning Activity Description;
                                                              NOR=Beskrivelse av prosjektplanleggingsaktivitet;
                                                              SVE=Beskrivning av projektplaneringsaktivitet];
                                                   Editable=No }
    { 500 ;   ;Recipe Group        ;Code10        ;TableRelation="Recipe Group".No.;
                                                   OnValidate=BEGIN
                                                                IF ("Recipe Group" = '') AND (Recipe <> '') THEN
                                                                  Recipe := '';
                                                              END;

                                                   CaptionML=[ENU=Recipe Group;
                                                              NOR=Maltype;
                                                              SVE=Malltyp];
                                                   Description=DP01090 }
    { 510 ;   ;Recipe              ;Code20        ;TableRelation="Base Recipe".No. WHERE (Recipe Group=FIELD(Recipe Group));
                                                   OnValidate=VAR
                                                                RecipeRec@1210190000 : Record 11020581;
                                                              BEGIN
                                                                IF (Recipe <> xRec.Recipe) AND (Recipe <> '') THEN BEGIN
                                                                  RecipeRec.GET("Recipe Group", Recipe);
                                                                  RecipeRec.TESTFIELD(Blocked, FALSE);
                                                                  Description := COPYSTR(RecipeRec.Description, 1, MAXSTRLEN(Description));
                                                                  "Description 2" := COPYSTR(RecipeRec.Description, MAXSTRLEN(Description) + 1);
                                                                  "Unit of Measure" := RecipeRec."Unit of Measure";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Recipe;
                                                              NOR=Mal;
                                                              SVE=Mall];
                                                   Description=DP01090 }
    { 520 ;   ;Source Type         ;Option        ;CaptionML=[ENU=Source Type;
                                                              NOR=Kildetype;
                                                              SVE=Ursprungstyp];
                                                   OptionCaptionML=[ENU=" ,Recipe Header,Recipe Line";
                                                                    NOR=" ,Maltittel,Malrad";
                                                                    SVE=" ,Mallrubrik,Mallrad"];
                                                   OptionString=[ ,Recipe Header,Recipe Line] }
    { 530 ;   ;Attached to Recipe Line;Integer    ;TableRelation="Budget Line"."Line No." WHERE (Project No.=FIELD(Project No.),
                                                                                                 Adjustment=FIELD(Adjustment),
                                                                                                 Extension Contract=FIELD(Extension Contract),
                                                                                                 Option=FIELD(Option));
                                                   CaptionML=[ENU=Attached to Recipe Line;
                                                              NOR=Tilknyttet Malrad;
                                                              SVE=Bifogad till mallrad];
                                                   Editable=No }
    { 540 ;   ;Surcharge Amnt from Summary;Decimal;CaptionML=[ENU=Overhead Surcharge Amount from Summary;
                                                              NOR=Overheadkostbel›p fra sammendrag;
                                                              SVE=Overheadkostnadsbelopp fr†n sammandrag] }
    { 550 ;   ;Overhead Surcharge from Summ.;Boolean;
                                                   OnValidate=BEGIN
                                                                IF (CurrFieldNo = FIELDNO("Overhead Surcharge from Summ.")) AND (NOT "Budget Summary Line") THEN BEGIN
                                                                  IF "Overhead Surcharge from Summ." THEN
                                                                    "Surcharge Amnt from Summary" := "Amount (LCY)"
                                                                  ELSE
                                                                    "Surcharge Amnt from Summary" := 0;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Overhead Surcharge from Summary;
                                                              NOR=Overheadkost fra sammendrag;
                                                              SVE=Overheadkostnad fr†n sammandrag] }
    { 560 ;   ;Part of Line        ;Integer       ;TableRelation="Budget Line"."Line No." WHERE (Project No.=FIELD(Project No.),
                                                                                                 Adjustment=FIELD(Adjustment),
                                                                                                 Extension Contract=FIELD(Extension Contract),
                                                                                                 Option=FIELD(Option));
                                                   OnValidate=BEGIN
                                                                DetermineBOMLevel("Part of Line","Level BOM");
                                                              END;

                                                   CaptionML=[ENU=Part of Line;
                                                              NOR=Del av Rad;
                                                              SVE=Del av rad] }
    { 565 ;   ;Original Quantity   ;Decimal       ;CaptionML=[ENU=Original Quantity;
                                                              NOR=Opprinnelig antall;
                                                              SVE=Ursprungligt antal];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 570 ;   ;Level BOM           ;Integer       ;CaptionML=[ENU=Level BOM;
                                                              NOR=Niv† Í stykkliste;
                                                              SVE=Niv†struktur];
                                                   Description=Level after exploding BOM-Item;
                                                   Editable=No }
    { 575 ;   ;BOM Item No.        ;Code20        ;TableRelation=Item;
                                                   CaptionML=[ENU=BOM Item No.;
                                                              NOR=Strukturartikkelnr;
                                                              SVE=Strukturartikelnr];
                                                   Description=Original Item before exploding BOM }
    { 580 ;   ;Variant Code        ;Code10        ;TableRelation="Item Variant".Code WHERE (Item No.=FIELD(Item No.));
                                                   OnValidate=BEGIN
                                                                IF "Variant Code" <> '' THEN
                                                                  TESTFIELD("Item No.");
                                                              END;

                                                   CaptionML=[ENU=Variant Code;
                                                              NOR=Variantkode;
                                                              SVE=Variantkod] }
    { 590 ;   ;Plant Type          ;Code20        ;TableRelation=IF (Plant Company=FILTER('')) "Plant Type";
                                                   OnValidate=VAR
                                                                PlantType@1100525000 : Record 11012551;
                                                              BEGIN
                                                                IF "Plant Type" <> '' THEN BEGIN
                                                                  TESTFIELD("Cost Type", "Cost Type"::Plant);

                                                                  IF "Plant Company" <> '' THEN
                                                                    PlantType.CHANGECOMPANY("Plant Company");

                                                                  //**4PS.sn DPA Plant
                                                                  PlantType.Code := "Plant Type";
                                                                  PlantType.DPA_FindRecWithDPAFilterAppld;
                                                                  //**4PS.en DPA Plant

                                                                  IF ("Plant Type" <> xRec."Plant Type") OR (Description = '') THEN BEGIN
                                                                    PlantType.GET("Plant Type");
                                                                    Description := PlantType.Description;
                                                                    "Unit of Measure" := PlantType."Unit of Measure";
                                                                    "Cost Object" := PlantType."Cost Object";
                                                                    "Price Agreement" := FALSE;  //DP02115
                                                                  END;
                                                                  DeterminePlantPrice;  //DP02115
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantType;
                                                            END;

                                                   CaptionML=[ENU=Plant Type;
                                                              NOR=Maskintype;
                                                              SVE=Maskintyp] }
    { 591 ;   ;Plant Price Type    ;Option        ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Plant Price Type;
                                                              SVE=Maskin pristyp];
                                                   OptionCaptionML=[ENU=" ,Day,Week,,Month,,,,,Hour";
                                                                    SVE=" ,Dag,Vecka,,M†nad,,,,,Timme"];
                                                   OptionString=[ ,Day,Week,,Month,,,,,Hour];
                                                   Description=DP02115;
                                                   Editable=No }
    { 595 ;   ;Plant Rates in Hours;Boolean       ;OnValidate=BEGIN
                                                                //C053751.sn
                                                                IF "Cost Type" = "Cost Type"::Plant THEN BEGIN
                                                                  IF NOT "Plant Rates in Hours" THEN BEGIN
                                                                    Quantity := Hours;
                                                                    InitNormRelatedFields(0);
                                                                  END ELSE BEGIN
                                                                    InitNormRelatedFields(1);
                                                                  END;
                                                                END;
                                                                //C053751.en
                                                                DeterminePlantPrice;
                                                                CalcTotals;
                                                                //DP02115.en
                                                              END;

                                                   CaptionML=[ENU=Plant Rates in Hours;
                                                              NOR=Maskingebyrer i timer;
                                                              SVE=Maskinavgifter i timmar];
                                                   Description=DP02115 }
    { 600 ;   ;Chapter Description ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Chapter)));
                                                   CaptionML=[ENU=Chapter Description;
                                                              NOR=Kapittelbeskrivelse;
                                                              SVE=Kapitelbeskrivning];
                                                   Editable=No }
    { 610 ;   ;Paragraph Description;Text50       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Description WHERE (Project No.=FIELD(Project No.),
                                                                                                           Element=FIELD(Paragraph)));
                                                   CaptionML=[ENU=Paragraph Description;
                                                              NOR=Avsnitt, Beskrivelse;
                                                              SVE=Stycke, beskrivning];
                                                   Editable=No }
    { 620 ;   ;Cost Component Description;Text30  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Cost Component".Description WHERE (Code=FIELD(Cost Component)));
                                                   CaptionML=[ENU=Cost Component Description;
                                                              NOR=Kostnadskomponent, Beskrivelse;
                                                              SVE=Kostnadsdel, beskrivning];
                                                   Editable=No }
    { 630 ;   ;Wage Component      ;Code10        ;TableRelation="Wage Component";
                                                   OnValidate=BEGIN
                                                                CalcTotals;  //C032135
                                                              END;

                                                   CaptionML=[ENU=Wage Component;
                                                              NOR=L›nnsart;
                                                              SVE=L”neart] }
    { 640 ;   ;Purchase Order No.  ;Code20        ;CaptionML=[ENU=Purchase Order No.;
                                                              NOR=Innkj›psordrenr.;
                                                              SVE=Ink”psordernr] }
    { 650 ;   ;Purchase Order Line No.;Integer    ;CaptionML=[ENU=Purchase Order Line No.;
                                                              SVE=Ink”psorderradnr] }
    { 660 ;   ;Price History 0 Exists;Boolean     ;CaptionML=ENU=Price History 0 Exists;
                                                   Editable=No }
    { 670 ;   ;Room                ;Code10        ;CaptionML=[ENU=Room;
                                                              NOR=Rom;
                                                              SVE=Rum];
                                                   Description=RAW }
    { 680 ;   ;Location Code (CUF) ;Code20        ;CaptionML=ENU=Location Code (CUF) }
    { 690 ;   ;Product Discount Line;Boolean      ;CaptionML=ENU=Product Discount Line;
                                                   Description=DP01727 }
    { 695 ;   ;Product Discount Total;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                       Product Discount Line=CONST(Yes)));
                                                   CaptionML=ENU=Product Discount Total;
                                                   Description=DP01727;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 699 ;   ;Subcontracting in Hours;Boolean    ;OnValidate=BEGIN
                                                                //C053751.sn
                                                                IF "Cost Type" = "Cost Type"::Subcontracting THEN BEGIN
                                                                  IF NOT "Subcontracting in Hours" THEN BEGIN
                                                                    Quantity := Hours;
                                                                    InitNormRelatedFields(0);
                                                                  END ELSE BEGIN
                                                                    InitNormRelatedFields(1);
                                                                  END;
                                                                END;
                                                                //C053751.en
                                                                CalcTotals;
                                                              END;

                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Subcontracting in Hours;
                                                   Description=C053751 }
    { 700 ;   ;Subcontracting Activity;Code10     ;TableRelation="Subcontracting Activity".Code;
                                                   OnValidate=BEGIN
                                                                GetSubcontractorActivity(FIELDNO("Subcontracting Activity"));  //DP01958a
                                                              END;

                                                   CaptionML=ENU=Subcontracting Activity;
                                                   Description=DP01492-2 }
    { 710 ;   ;Plant Company       ;Text30        ;TableRelation="Plant Management Company"."Plant Company";
                                                   OnValidate=VAR
                                                                PlantMgtCompany@1100529600 : Record 11020586;
                                                                TmpPlantMgtCompany@1100529601 : TEMPORARY Record 11020586;
                                                              BEGIN
                                                                IF "Plant Company" = COMPANYNAME THEN
                                                                  "Plant Company" := '';
                                                                IF "Plant Company" <> '' THEN BEGIN
                                                                  TESTFIELD("Cost Type", "Cost Type"::Plant);
                                                                  TESTFIELD("Project No.");
                                                                  PlantMgtCompany.GET("Plant Company");
                                                                  IF PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', FALSE) = 0 THEN
                                                                    ERROR(Text030, FIELDCAPTION("Plant Location"),
                                                                      FIELDCAPTION("Project No."), "Project No.", FIELDCAPTION("Plant Company"), "Plant Company");
                                                                END;
                                                                IF "Plant Company" <> xRec."Plant Company" THEN BEGIN
                                                                  "Plant Location" := '';
                                                                  "Plant Type" := '';
                                                                END;
                                                                IF "Plant Location" = '' THEN
                                                                  FillDefaultPlantLocation;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantCompany;
                                                            END;

                                                   CaptionML=[ENU=Plant Company;
                                                              NOR=Maskinselskap;
                                                              SVE=Maskinf”retag] }
    { 720 ;   ;Plant Location      ;Code20        ;OnValidate=VAR
                                                                PlantLocation@1100529600 : Record 11012554;
                                                                PlantMgtCompany@1100529601 : Record 11020586;
                                                              BEGIN
                                                                IF "Plant Location" <> '' THEN BEGIN
                                                                  TESTFIELD("Cost Type", "Cost Type"::Plant);
                                                                  TESTFIELD("Project No.");
                                                                  IF "Plant Company" = '' THEN
                                                                    PlantMgtCompany.GET(COMPANYNAME)
                                                                  ELSE
                                                                    PlantLocation.CHANGECOMPANY("Plant Company");
                                                                  PlantLocation.GET("Plant Location");
                                                                  IF PlantLocation."Project No." <> '' THEN
                                                                    PlantLocation.TESTFIELD("Project No.", "Project No.")
                                                                  ELSE BEGIN
                                                                    PlantLocation.TESTFIELD("Customer No.");
                                                                    PlantLocation.TESTFIELD("Service Order No.", '');
                                                                    PlantLocation.TESTFIELD("Employee No.", '');
                                                                    PlantLocation.TESTFIELD("Plant Type", '');
                                                                  END;
                                                                  PlantLocation.TESTFIELD(Depot, FALSE);
                                                                  IF ("Plant Company" = '') OR ("Plant Company" = COMPANYNAME) THEN
                                                                    PlantLocation.TESTFIELD("Company Name", '')
                                                                  ELSE
                                                                    PlantLocation.TESTFIELD("Company Name", COMPANYNAME);
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupPlantLocation;
                                                            END;

                                                   CaptionML=[ENU=Plant Location;
                                                              NOR=Maskinplassering;
                                                              SVE=Maskinutplacering] }
    { 800 ;   ;Entity No.          ;Code20        ;CaptionML=[ENU=Entity No.;
                                                              NOR=Enhetsnr;
                                                              SVE=Enhetsnr];
                                                   Description=DP00481;
                                                   Editable=No }
    { 810 ;   ;Rental Unit         ;Code20        ;TableRelation="Rental Unit"."Rental Unit" WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=[ENU=Rental Unit;
                                                              NOR=Leieenhet;
                                                              SVE=Uthyrningsenhet] }
    { 850 ;   ;Settlement Quantity Code;Code20    ;TableRelation="Settlement Quantity".Code WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                IF Option <> '' THEN BEGIN
                                                                  OptionRec.GET("Project No.", "Plot No.", "House Model", "Main Group", Group, "Sub Group", Option);
                                                                  IF NOT (OptionRec.Status IN [OptionRec.Status::Order, OptionRec.Status::Invoice]) THEN
                                                                    OptionRec.FIELDERROR(Status);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Settlement Quantity Code;
                                                              SVE=Avr„kningsantalkod] }
    { 851 ;   ;Settlement Quantity Cde Filter;Code20;
                                                   FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Settlement Quantity Code Filter;
                                                              SVE=Avr„kningsantalkod filter] }
    { 900 ;   ;Quantity Orig. Proj. Element;Decimal;
                                                   CaptionML=[ENU=Quantity Original Project Element;
                                                              SVE=Antal orginalprojektelement] }
    { 1000;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                CheckCurrencyAgreement;
                                                                VALIDATE("Rate (LCY)");
                                                                IF "Currency Agreement" THEN BEGIN  //C054524
                                                                  VALIDATE("Gross Price (FCY)");
                                                                  "Gross Price (LCY)" := ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);
                                                                END ELSE BEGIN
                                                                  VALIDATE("Gross Price (LCY)");
                                                                  "Gross Price (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Gross Price (LCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);
                                                                END;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=[ENU=Currency Code;
                                                              NOR=Valutakode;
                                                              SVE=Valutakod];
                                                   Description=DP00883 }
    { 1001;   ;Currency Agreement  ;Boolean       ;CaptionML=[ENU=Currency Agreement;
                                                              SVE=Valuta avtal];
                                                   Description=DP00883 }
    { 1010;   ;Price (FCY)         ;Decimal       ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Price;
                                                              NOR=Pris;
                                                              SVE=Pris];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 1015;   ;Gross Price (FCY)   ;Decimal       ;OnValidate=VAR
                                                                SaveGrossPrice@1100525000 : Decimal;
                                                              BEGIN
                                                                //C026956.sn
                                                                //SetSkipValidateFCY(TRUE);
                                                                SaveGrossPrice := "Gross Price (FCY)";
                                                                VALIDATE("Gross Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Gross Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                                IF CurrFieldNo = FIELDNO("Gross Price (FCY)") THEN
                                                                  "Gross Price (FCY)" := SaveGrossPrice;  //function CalculateDiscount cleared input on validate GrossPrice
                                                                //C026956.en
                                                              END;

                                                   CaptionML=[ENU=Gross Price;
                                                              NOR=Bruttopris;
                                                              SVE=Bruttopris];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 1020;   ;Rate (FCY)          ;Decimal       ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Rate (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Rate (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Rate;
                                                              NOR=Avgift;
                                                              SVE=Avgift];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   Editable=No;
                                                   AutoFormatType=2 }
    { 1030;   ;Amount (FCY)        ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Amount (FCY)") THEN
                                                                  "Amount (LCY)" := ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Amount (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D);
                                                              END;

                                                   CaptionML=[ENU=Amount;
                                                              NOR=Bel›p;
                                                              SVE=Belopp];
                                                   Description=DP00883;
                                                   Editable=No }
    { 1040;   ;Surcharge Price (FCY);Decimal      ;OnValidate=BEGIN
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Surcharge Price (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Surcharge Price (FCY)", FALSE, TRUE, "Currency Code", "Project No.", '', 0D));  //DP00886
                                                              END;

                                                   CaptionML=[ENU=Surcharge Price;
                                                              NOR=Tilleggsgebyrspris;
                                                              SVE=Till„ggsavgiftspris];
                                                   BlankZero=Yes;
                                                   Description=DP00883;
                                                   AutoFormatType=2 }
    { 1050;   ;Service Company     ;Text30        ;TableRelation=Company;
                                                   CaptionML=ENU=Service Company;
                                                   Editable=No }
    { 1060;   ;Service Order No.   ;Code20        ;TableRelation="Service Order";
                                                   CaptionML=[ENU=Service Order No.;
                                                              NOR=Serviceordrenr;
                                                              SVE=Serviceordernr];
                                                   Editable=No }
    { 1070;   ;Service Recording Line No.;Integer ;TableRelation="SUP Recording Line"."Line No." WHERE (Service Order No.=FIELD(Service Order No.));
                                                   CaptionML=ENU=Service Recording Line No.;
                                                   Editable=No }
    { 1080;   ;Service Order Budget Line No.;Integer;
                                                   TableRelation="Service Order Budget Line"."Line No." WHERE (Service Order No.=FIELD(Service Order No.));
                                                   CaptionML=ENU=Service Order Budget Line No.;
                                                   Editable=No }
    { 1090;   ;Modular Option      ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Option.Modular WHERE (Project No.=FIELD(Project No.),
                                                                                            Plot No.=FIELD(Plot No.),
                                                                                            House Model=FIELD(House Model),
                                                                                            Main Group=FIELD(Main Group),
                                                                                            Group=FIELD(Group),
                                                                                            Sub Group=FIELD(Sub Group),
                                                                                            Option=FIELD(Option)));
                                                   CaptionML=ENU=Modular Option;
                                                   Editable=No }
    { 1100;   ;Discipline          ;Code10        ;TableRelation=Discipline;
                                                   CaptionML=[ENU=Discipline;
                                                              SVE=Disciplin] }
    { 1110;   ;Length              ;Decimal       ;OnValidate=BEGIN
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Length;
                                                              NOR=Lengde;
                                                              SVE=L„ngd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   CaptionClass='11012150,1' }
    { 1120;   ;Width               ;Decimal       ;OnValidate=BEGIN
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Width;
                                                              NOR=Bredde;
                                                              SVE=Bredd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   CaptionClass='11012150,2' }
    { 1130;   ;Height              ;Decimal       ;OnValidate=BEGIN
                                                                CalculateQuantity;
                                                              END;

                                                   CaptionML=[ENU=Height;
                                                              NOR=H›yde;
                                                              SVE=H”jd];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Description=DP01676;
                                                   CaptionClass='11012150,3' }
    { 1140;   ;Element Phase Code  ;Code10        ;TableRelation="Project Element Phase".Code WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=ENU=Element Phase Code }
    { 1150;   ;Generated by Phase Change;Option   ;CaptionML=ENU=Generated by Phase Change;
                                                   OptionCaptionML=ENU=No,Positive,Negative;
                                                   OptionString=No,Positive,Negative }
    { 1160;   ;Adjustment by Phase Change;Boolean ;CaptionML=ENU=Adjustment by Phase Change }
    { 11128002;;Last Date Modified ;DateTime      ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Last Date Modified;
                                                              NOR=Endret den;
                                                              SVE=Uppdateringsdatum];
                                                   Description=REK-055;
                                                   Editable=No }
    { 11128003;;Modified by        ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Modified by;
                                                              NOR=Endret av;
                                                              SVE=Žndrad av];
                                                   Description=REK-055;
                                                   Editable=No }
    { 11128004;;New prognosis amount;Decimal      ;DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=New prognosis amount (rem);
                                                              SVE=Nytt prognosv„rde (†terst†ende)] }
    { 11128005;;Position           ;Code10        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=[ENU=Position;
                                                              SVE=L„ge] }
    { 11128006;;Last Prognosis Amount;Decimal     ;CaptionML=[ENU=Last Prognosis Amount;
                                                              SVE=Senast BK];
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Project No.,Adjustment,Extension Contract,Option,Line No.;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Project No.,Cost Object,Purchase Action Status,Purch. Action Approval Date;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Cost Type,Adjustment,Extension Contract,Option,Line No.;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary }
    {    ;Project No.,Cost Type,Cost Object,Extension Contract Status,Version Date,Adjustment,Extension Contract,Option,Purchase Action,Budget Summary Line;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Extension Contract,Line No. ;MaintainSIFTIndex=No }
    {    ;Purchase Route Reference                ;MaintainSIFTIndex=No }
    {    ;Item Route Reference                    ;MaintainSIFTIndex=No }
    {    ;Budget Summary Line,Project No.,Extension Contract,Element,Cost Type,Cost Object,Option;
                                                   MaintainSIFTIndex=No }
    {    ;Main Project No.,Project No.,Extension Contract Status,Cost Type,Version Date;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary }
    {    ;Main Project No.,Project No.,Purchase Action Status,Purch. Action Approval Date;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary }
    {    ;Main Project No.,Project No.,Cost Component,Adjustment,Extension Contract,Option,Cost Type,Line No.,Extension Contract Status,Purchase Action Status,Purch. Action Approval Date;
                                                   MaintainSIFTIndex=No }
    {    ;Main Project No.,Project No.,Cost Type,Cost Component,Version Date,Extension Contract Status;
                                                   MaintainSIFTIndex=No }
    {    ;Main Project No.,Project No.,Cost Object,Purchase Action Status,Purch. Action Approval Date;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary }
    {    ;Main Project No.,Project No.,Cost Type,Cost Object,Extension Contract Status,Version Date;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary,Quantity }
    {    ;Main Project No.,Project No.,Element,Cost Type,Cost Object,Extension Contract Status,Version Date;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary;
                                                   MaintainSQLIndex=No }
    {    ;Main Project No.,Cost Component         ;MaintainSIFTIndex=No }
    {    ;Main Project No.,Element,Cost Object    ;MaintainSIFTIndex=No }
    {    ;Project No.,Cost Component              ;MaintainSIFTIndex=No }
    {    ;Project Planning Activity No.,Cost Type,Cost Object;
                                                   SumIndexFields=Hours,Amount (LCY),Surcharge Amnt from Summary;
                                                   SQLIndex=Project Planning Activity No.,Cost Type,Cost Object,Amount (LCY) }
    {    ;Proj. Plann. Parent Activ. No.          ;MaintainSIFTIndex=No }
    {    ;Project No.,Adjustment,Option           ;SumIndexFields=Amount (LCY);
                                                   MaintainSQLIndex=No }
    {    ;Main Project No.,Project No.,Element,Cost Type,Cost Object,Version Date,Extension Contract,Currency Code;
                                                   SumIndexFields=Hours,Amount (FCY);
                                                   MaintainSQLIndex=No }
    {    ;Project No.,Element,Extension Contract Status;
                                                   SumIndexFields=Hours }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1100525006 : TextConst 'ENU=%1 ''%2'' has %3 ''%4''. Material Requirement can''t be generated.;NOR=%1 ''%2'' har %3 ''%4''. Materialbehov kan ikke genereres.;SVE=%1 ''%2'' har %3 ''%4''. Materialbehov kan inte genereras.';
      Text001@1100525007 : TextConst 'ENU=Material Requirement is already present for %1 ''%2''. This will be deleted first.\Continue?;NOR=Materialbehov finnes allerede for %1 ''%2''. Dette vil fjernes f›rst.\Vil du fortsette?;SVE=Materialbehov finns redan f”r %1 ''%2''. Detta kommer att tas bort f”rst.\Vill du forts„tta?';
      Text002@11012015 : TextConst 'ENU=Cost Type of Line is %1, input of norm not allowed;NOR=Kostnadstypen for raden er %1, Norm kan ikke angis;SVE=Kostnadstypen f”r raden „r %1, norm kan inte anges';
      Text003@11012016 : TextConst 'ENU=Cost Type of line is %1, input of rate code not allowed.;NOR=Kostnadstypen for raden er %1, satskode kan ikke angis.;SVE=Kostnadstypen f”r raden „r %1, avgiftskod kan inte anges';
      Text004@11012017 : TextConst 'ENU=Change Cost Type ?;NOR=Endre kostnadstype?;SVE=Žndra kostnadstyp?';
      Text005@11012018 : TextConst 'ENU=Unit Price not allowed because Cost Type of this record is Labor !;NOR=Enhetsprisen er ikke tillatt siden Kostnadstypen for denne posten er arbeidskraft!;SVE=Enhetspriset „r inte till†tet eftersom kostnadstypen f”r denna post „r arbetskraft!';
      Text006@11012019 : TextConst 'ENU=Default Purchase Action %1 not present for Project %2.;NOR=Standardinnkj›pshandlingen %1 finnes ikke for prosjektet %2.;SVE=Standardink”ps†tg„rden %1 finns inte f”r projektet %2.';
      DimValRec@11012001 : Record 349;
      ProjRec@11012002 : Record 11072003;
      AdjustmentRec@11012003 : Record 11012003;
      ExtensionRec@11012004 : Record 11012004;
      ElemRec@1210190003 : Record 11012060;
      ProjElemRec@11012005 : Record 11012010;
      ItemRec@1210190002 : Record 27;
      OptionRec@11012006 : Record 11012502;
      ProjPurchActRec@11012007 : Record 11012026;
      ElementFormat@11012010 : Codeunit 11012022;
      ValidateCu@11012011 : Codeunit 11012033;
      DimMgt@11012020 : Codeunit 408;
      GWWMgtCU@1100485000 : Codeunit 11012163;
      ItemTypeOpt@1100485006 : 'Item,Basic Item,Trade Item,Trade Vendor';
      UpdateAction@1100485004 : 'Insert,Modify,Delete';
      Text007@1210190004 : TextConst 'ENU=Switch to Cost Type Labor requires default Rate Code per Project (or there is no Budget Rate of this Budget Rate present before the current date).;NOR=Bytting til Kostnadstypen arbeidskraft krever Standard satskode per prosjekt (eller det mangler budsjettsats for denne budsjettsatsen f›r den aktuelle datoen).;SVE=V„xling till kostnadstypen arbetskraft kr„ver en standardavgiftskod per projekt (annars finns det ingen budgetavgift f”r denna budgetavgift f”re det aktuella datumet).';
      Text008@1100485003 : TextConst 'ENU=Assign these Budget Lines to Purchase Action %1?;NOR=Tilordne disse budsjettradene til innkj›pshandlingen %1?;SVE=Tilldela dessa budgetrader till ink”ps†tg„rden %1?';
      Text009@1100485001 : TextConst 'ENU=Do you want to remove Budget Lines from attached Purchase Actions  ?;NOR=Vil du fjerne Budsjettrader fra vedlagte Innkj›pshandlinger?;SVE=Vill du ta bort budgetrader fr†n bifogade ink”ps†tg„rder?';
      Text011@1100485005 : TextConst 'ENU=Do you want to reverse quantities ?;NOR=Vil du reversere antallet?;SVE=Vill du †terf”ra antalen?';
      Text012@1100485007 : TextConst 'ENU=%1 of %2 is not adopted, because Status is %3.;NOR=%1 av %2 er ikke adoptert siden statusen er %3.;SVE=%1 av %2 har inte antagits eftersom statusen „r %3.';
      Text013@1100485008 : TextConst 'ENU=Adding Budget Lines is not allowed, job state is %1.;NOR=Legge til budsjettrader er ikke tillatt, jobbstatus er %1.;SVE=Till„gg av budgetrader „r inte till†tet, jobbstatus „r %1.';
      Text014@1100485009 : TextConst 'ENU=Budget is frozen, Changes not allowed.;NOR=Budsjettet er fryst og kan ikke endres.;SVE=Budgeten „r fryst och kan inte „ndras.';
      Text015@1100525000 : TextConst 'ENU=of %1 ''%2'' is %3, delete budget line not allowed;NOR=av %1 ''%2'' er %3. Det er ikke tillatt † fjerne budsjettraden;SVE=av %1 ''%2'' „r %3. Det „r inte till†tet att ta bort budgetraden';
      Text016@1100525001 : TextConst 'ENU=Nothing to Apply;NOR=Ingenting † Anvende;SVE=Det finns inget att till„mpa';
      Text017@1100525002 : TextConst 'ENU=must be No (%1 ''%2'');NOR=M† v‘re nr (%1 ''%2'');SVE=m†ste vara nr (%1 ''%2'')';
      DeleteCompleteProject@1100409000 : Boolean;
      DPA_Management@1100000999 : Codeunit 11012783;
      Text018@1100525003 : TextConst 'ENU=&Complete with Cost Object Data,Co&py Cost Object Data,&Don''t Copy Cost Object Data;NOR=&Komplett med Kostnadsobjektdata,Ko&pier Kostnadsobjektdata,&Ikke kopier Kostnadsobjektdata;SVE=&Komplett med kostnadsobjektdata,Ko&piera kostnadsobjektdata,&Kopiera inte kostnadsobjektdata';
      Text019@1100525004 : TextConst 'ENU=Line is already adjusted. Continue?;NOR=Raden er allerede justert. Fortsette?;SVE=Raden har redan justerats. Forts„tta?';
      Text020@1100525005 : TextConst 'ENU=%1 of %2 lines already adjusted. Continue?;NOR=%1 av %2 rader er allerede justert. Fortsette?;SVE=%1 av %2 rader har redan justerats. Forts„tta?';
      Text021@1100525008 : TextConst 'ENU=%1 Material Requirement lines generated.;NOR=%1 Materialbehovsrader er generert.;SVE=%1 materialbehovsrader har genererats.';
      Text022@1100525013 : TextConst 'ENU=First select Purchase Budget Lines;NOR=Velg f›rst Innkj›psbudsjettrader;SVE=V„lj f”rst ink”psbudgetrader';
      Text023@1100525014 : TextConst 'ENU=First select Budget Lines;NOR=Velg f›rst Budsjettrader;SVE=V„lj f”rst budgetrader';
      Text024@1100525015 : TextConst 'ENU=Copied %1 Line(s).;NOR=Kopierte %1 Rader';
      Text025@1100525009 : TextConst 'ENU=No lines with %1 selected.';
      SalesPriceBudgetLine@1100528000 : Record 11229910;
      SkipValidateFCY@1100525010 : Boolean;
      Text026@1100525011 : TextConst 'ENU=is ''%1'', modify %2 not allowed';
      Text027@1100525012 : TextConst 'ENU=''%1'' not allowed, %2 is ''%3''';
      ProjectCurrencyExchangeRate@1100525016 : Record 11020628;
      Text028@1100529400 : TextConst 'ENU=Replace existed Planning Activity lines with the selected?';
      Text029@1100529401 : TextConst 'ENU=Delete %1 records in %2 table';
      Text030@1100529600 : TextConst 'ENU=There is no %1 of %2 ''%3'' present in %4 ''%5''.';
      Text098@1100529502 : TextConst 'ENU=Update Summary?';
      Text099@1100529500 : TextConst 'ENU=Update Summary #1###############;NOR=Oppdater sammendrag #1###############;SVE=Uppdatera sammandrag #1###############';
      TmpBudgSummaryRec@1100529501 : TEMPORARY Record 11012064;
      FPSLicenseManagement@1100527400 : Codeunit 11229289;
      Text100@1100527350 : TextConst 'ENU=Description;SVE=Beskrivning';
      Text101@1100527300 : TextConst 'ENU=The combination of %1 and %2 does not use %3 and %4';

    PROCEDURE CalcTotals@1();
    VAR
      WageCompRec@1100528901 : Record 11012014;
      OverTimeFactor@1100528900 : Decimal;
    BEGIN
      CASE "Cost Type" OF
        "Cost Type"::Labor:
          BEGIN
            Hours := ROUND("Time Quantity" * Quantity * Norm);
            IF (Quantity <> 0) OR // Amount can be entered manually when Quantity = 0 and Norm = 0;
               (Norm <> 0)
            THEN BEGIN
              "Amount (LCY)" := ROUND("Time Quantity" * Quantity * Norm * "Rate (LCY)");
              "Amount (FCY)" := ROUND("Time Quantity" * Quantity * Norm * "Rate (FCY)");  //DP00883
            END;
            //DP00236.sn
            IF "Wage Component" <> '' THEN BEGIN
              OverTimeFactor := WageCompRec.GetBudgetOverTimeFactor("Wage Component");  //DP01090
              IF OverTimeFactor <> 0 THEN BEGIN
                "Amount (LCY)" := "Amount (LCY)" * OverTimeFactor;
                "Amount (FCY)" := "Amount (FCY)" * OverTimeFactor;  //DP00883
              END;
            END;
            //DP00236.en
          END;
        "Cost Type"::Subcontracting,  //DP01676
        "Cost Type"::Plant:
          BEGIN
            CASE Norm = 0 OF
              TRUE:
                BEGIN
                  Hours := 0;
                  "Amount (LCY)" := ROUND("Time Quantity" * Quantity * ("Price (LCY)" * ((100+"Surcharge %")/100) + "Surcharge Price (LCY)"));
                  "Amount (FCY)" := ROUND("Time Quantity" * Quantity * ("Price (FCY)" * ((100+"Surcharge %")/100) + "Surcharge Price (FCY)"));  //DP00883
                END;
              FALSE: // GWW
                BEGIN
                  Hours := ROUND("Time Quantity" * Quantity * Norm);
                  "Amount (LCY)" := ROUND("Time Quantity" * Quantity * Norm * "Price (LCY)");
                  "Amount (FCY)" := ROUND("Time Quantity" * Quantity * Norm * "Price (FCY)");  //DP00883
                END;
            END;
          END;
        ELSE
          BEGIN
            Hours := 0;
            "Amount (LCY)" := ROUND("Time Quantity" * Quantity * ("Price (LCY)" * ((100+"Surcharge %")/100) + "Surcharge Price (LCY)"));
            "Amount (FCY)" := ROUND("Time Quantity" * Quantity * ("Price (FCY)" * ((100+"Surcharge %")/100) + "Surcharge Price (FCY)"));  //DP00883
          END;
      END;
      IF (CurrFieldNo <> 0) THEN //Line is added for SQL performance when importing large number of lines
        CALCFIELDS("Total Amount","Total Hours","Total Labor","Total material","Total Subcontracting","Total Plant","Total Sundry");

      IF (CurrFieldNo <> 0)  AND ("Overhead Surcharge from Summ.") AND (NOT "Budget Summary Line") THEN
        "Surcharge Amnt from Summary" := "Amount (LCY)";

      CalcBudgetPlanActivityLines();
    END;

    PROCEDURE CalculateNetPrice@13();
    BEGIN
      //DP00883
      VALIDATE("Price (LCY)", "Gross Price (LCY)" - (("Gross Price (LCY)"/100) * "Discount %"));
      "Price (FCY)" := "Gross Price (FCY)" - (("Gross Price (FCY)"/100) * "Discount %");
    END;

    PROCEDURE CalculateDiscount@1100525024();
    BEGIN
      //DP00883
      IF "Gross Price (LCY)" <> 0 THEN BEGIN
        IF ("Item No." + "Basic Item" + "Trade Item" + "Plant Type" = '') AND ("Discount %" = 0) THEN BEGIN
          "Gross Price (LCY)" := "Price (LCY)";
          "Gross Price (FCY)" := "Price (FCY)";
        END ELSE BEGIN
          "Discount %" := (("Gross Price (LCY)" - "Price (LCY)") / "Gross Price (LCY)") * 100;
        END;
      END ELSE BEGIN
        IF "Discount %" <> 100 THEN BEGIN
          "Gross Price (LCY)" := "Price (LCY)" / ((100 - "Discount %") / 100);
          "Gross Price (FCY)" := "Price (FCY)" / ((100 - "Discount %") / 100);
        END ELSE BEGIN
          "Gross Price (LCY)" := "Price (LCY)";
          "Gross Price (FCY)" := "Price (FCY)";
        END;
      END;
    END;

    PROCEDURE GetDefaultsCostObject@3(Replace@1100525001 : Boolean);
    VAR
      ProjectPlanningActivity@1100525000 : Record 11012431;
      BudgetRateManagement@1100528601 : Codeunit 11012358;
      BudgetRateFoundAt@1100528602 : Text[250];
    BEGIN
      //Function can be used in 2 ways: 1. only add data, 2: replace data
      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, TRUE, "Project No.");
      DimValRec.TESTFIELD(Blocked, FALSE);

      IF (Description = '') OR Replace THEN
        Description := DimValRec.Name;
      IF ("Unit of Measure" = '') OR Replace  THEN
        VALIDATE("Unit of Measure", DimValRec."Unit of Measure");
      IF ("Unit of Time" = '') OR Replace  THEN
        VALIDATE("Unit of Time", DimValRec."Unit of Time");
      IF ("Cost Component" = '') OR Replace  THEN
        VALIDATE("Cost Component", DimValRec."Cost Component");

      CASE "Cost Type" OF
        "Cost Type"::Labor:
          BEGIN
            IF (Norm = 0) OR Replace  THEN
              VALIDATE(Norm, DimValRec.Norm);
            IF NOT ProjRec.GET("Project No.") THEN  //*C-025993.n
              ProjRec.INIT;
            //IF (("Rate Code" = '') AND (Rate = 0)) OR Replace THEN BEGIN  //*C-025993.o
            IF (("Rate Code" = '') AND ("Rate (LCY)" = 0)) OR (Replace AND (ProjRec."Default Rate Code" = '')) THEN BEGIN  //*C-025993.n
              "Rate Code" := DimValRec."Rate Code";
              "Rate (LCY)" := 0;
              IF "Version Date" = 0D THEN
                GetVersionDate;
              "Rate (LCY)" := BudgetRateManagement.GetBudgetRate(
                0, "Project No.", '', '', ProjRec."Global Dimension 1 Code", "Rate Code", "Version Date", BudgetRateFoundAt);
            END;
          END;
        ELSE
          IF ("Price (LCY)" = 0) OR Replace  THEN
            "Price (LCY)" := DimValRec.Price;
      END;

      IF ("Purchase Action" = '') AND (DimValRec."Purchase Action" <> '') AND
         (("Extension Contract" = '') OR
          ("Extension Contract Status" IN ["Extension Contract Status"::Order, "Extension Contract Status"::"Invoicing Allowed" ]))
      THEN
        IF NOT ProjPurchActRec.GET("Project No.", DimValRec."Purchase Action") THEN
          MESSAGE(Text006, DimValRec."Purchase Action","Project No.")
        ELSE
          IF ProjPurchActRec.Status >= ProjPurchActRec.Status::Applied THEN
            MESSAGE(Text012, FIELDCAPTION("Purchase Action"), FIELDCAPTION("Cost Object"), FORMAT(ProjPurchActRec.Status))
          ELSE
            VALIDATE("Purchase Action", DimValRec."Purchase Action");

      IF (DimValRec.Element <> '') AND ("Project No." <> '') THEN
      //Overwrite Element, even when it is already filled in the budget line, to keep the element-cost object consistent.
      //It also work this way in other tables (like Sales Line, Requisition Line, Purchase Line, ...
        VALIDATE(Element, DimValRec.Element);

      CalcTotals;

      IF DimValRec."Proj. Plann. Base Activ. Code" <> '' THEN BEGIN
        ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
        ProjectPlanningActivity.SETRANGE(Code, DimValRec."Proj. Plann. Base Activ. Code");

        IF ProjectPlanningActivity.FINDFIRST THEN
          VALIDATE("Project Planning Activity No.", ProjectPlanningActivity."No.");
      END;
    END;

    PROCEDURE UpdateCostControlStatus@10(lUpdateAction@1100485002 : 'Insert,Modify,Delete');
    BEGIN
      IF ProjRec.GET("Project No.") THEN
        ProjRec.UpdateCostControlStatus(lUpdateAction, xRec."Cost Object", "Cost Object");
    END;

    PROCEDURE UpdatePurchActionStatusInLine@2();
    VAR
      ProjPurchActRec@11012000 : Record 11012026;
    BEGIN
      CLEAR("Purchase Action Status");
      "Purch. Action Approval Date" := 0D;
      IF "Purchase Action" <> '' THEN BEGIN
        IF ProjPurchActRec.GET("Project No.","Purchase Action") THEN BEGIN
          "Purchase Action Status" := ProjPurchActRec.Status;
          "Purch. Action Approval Date" := ProjPurchActRec."Approval Date";
        END;
      END;
    END;

    PROCEDURE UpdateExtContractStatus@1100525001();
    BEGIN
      IF "Extension Contract" <> '' THEN BEGIN
        IF ExtensionRec.GET("Project No.", "Extension Contract") THEN BEGIN
          IF (ExtensionRec.Status < ExtensionRec.Status::Order) AND ExtensionRec."Treat like Order" THEN
            "Extension Contract Status" := "Extension Contract Status"::Order
          ELSE
            "Extension Contract Status" := ExtensionRec.Status + 1;
        END ELSE
          "Extension Contract Status" := "Extension Contract Status"::Applied;
      END ELSE
        "Extension Contract Status" := "Extension Contract Status"::"Not Applicable";
    END;

    PROCEDURE UpdateLogbook@4();
    BEGIN
      IF Adjustment <> '' THEN
        IF AdjustmentRec.GET("Project No.",Adjustment) THEN
          AdjustmentRec.MODIFY(TRUE);

      IF "Extension Contract" <> '' THEN
        IF ExtensionRec.GET("Project No.","Extension Contract") THEN
          ExtensionRec.MODIFY(TRUE);

      //C010337.sn
      IF "Purchase Action" <> '' THEN BEGIN
        IF ProjPurchActRec.GET("Project No.","Purchase Action") THEN BEGIN
          ProjPurchActRec.MODIFY(TRUE);
        END;
      END;
      //C010337.en
    END;

    PROCEDURE ValidateItem@31(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item');
    VAR
      lvRefDate@11012001 : Date;
      lvDiscRef1@1100485002 : Code[20];
      lvDiscRef2@1100485001 : Code[20];
      lvDummyDate@1100485000 : Date;
    BEGIN
      GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);

      ValidateCu.ValidateItem(LTypeArtOpt,"Trade Item","Item No.",Manufacturer,"Vendor (Trade Item)",
                              "Basic Item","Cost Object",Description,"Unit of Measure","Price (LCY)",
                              "Discount %",lvDummyDate,"Gross Price (LCY)","Description 2","Cost Component",
                              lvDiscRef1, lvDiscRef2, lvRefDate, '');

      IF LTypeArtOpt = LTypeArtOpt::"Trade Item" THEN
        "Price History 0 Exists" := ValidateCu.PriceHistory0Exists("Trade Item", "Vendor (Trade Item)", lvRefDate)
      ELSE
        "Price History 0 Exists" := FALSE;

      VALIDATE("Cost Object");

      IF ItemRec.GET("Item No.") THEN BEGIN
        IF ItemRec.Text <> '' THEN
          VALIDATE("External Text", ItemRec.Text);
      END;

      CheckItemRouteReference;
      VALIDATE("Gross Price (LCY)");  //DP00883: calculate FCY-fields
      CalcTotals;
    END;

    PROCEDURE ValidateVendor@6506();
    VAR
      VendorRec@1210190000 : Record 23;
    BEGIN
      IF "Basic Item" = '' THEN EXIT;

      ProjRec.GET("Project No.");
      IF NOT VendorRec.GET(ProjRec."Project Supplier") THEN VendorRec.INIT;
      IF VendorRec."Vendor (Trade Item)" = '' THEN EXIT;

      xRec."Vendor (Trade Item)" := '';
      VALIDATE("Vendor (Trade Item)", VendorRec."Vendor (Trade Item)");

      IF "Trade Item" = '' THEN BEGIN
        xRec."Vendor (Trade Item)" := '';
        VALIDATE("Vendor (Trade Item)", Manufacturer);
      END;
    END;

    LOCAL PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    VAR
      DimensionManagement@1100525000 : Codeunit 408;
    BEGIN
      DimensionManagement.ValidateDimValueCode(FieldNumber,ShortcutDimCode);
      MODIFY;
    END;

    PROCEDURE HandleLookupUnit@1210190008();
    VAR
      ItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := ItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") AND NOT BudgetFixed(Rec) THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";  //standard bug
        VALIDATE("Unit of Measure", lvUnit);
      END;
    END;

    PROCEDURE CheckItemUnitConversion@1210190010(VAR MainNewRec@1210190006 : Record 11012001;MainOldRec@1210190007 : Record 11012001);
    VAR
      ItemRec@1210190004 : Record 27;
      UnitFactor@1210190005 : Decimal;
      UnitFactorOld@1210190003 : Decimal;
      UnitFactorNew@1210190002 : Decimal;
      UnitControl@1210190001 : Codeunit 5402;
    BEGIN
      WITH MainNewRec DO BEGIN
        UnitFactorOld := 1;
        UnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          ValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            Quantity,"Unit of Measure",UnitFactorNew);
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            ValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              Quantity,"Unit of Measure",UnitFactorNew);
          END ELSE BEGIN
            IF "Item No." <> '' THEN BEGIN
              ItemRec.GET("Item No.");
              UnitFactorOld := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, MainOldRec."Unit of Measure");
              UnitFactorNew := UnitControl.GetQtyPerUnitOfMeasure(ItemRec, "Unit of Measure");
              UnitFactor := UnitFactorOld;
              ValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                Quantity,"Unit of Measure",UnitFactor);
            END;
          END;
        END;
        IF (UnitFactorNew * UnitFactorOld) <> 0 THEN BEGIN
          IF UnitFactorNew <> UnitFactorOld THEN BEGIN
            IF "Gross Price (LCY)" <> 0 THEN
              VALIDATE("Gross Price (LCY)", ("Gross Price (LCY)" * UnitFactorNew / UnitFactorOld))
            ELSE
              VALIDATE("Price (LCY)", ("Price (LCY)" * UnitFactorNew / UnitFactorOld));
          END;
        END;
      END;
    END;

    PROCEDURE GetDefaultPurchAction@1210190000();
    BEGIN
      "Purchase Action" := '';

      IF "Cost Object" = '' THEN
        EXIT;
      IF NOT
         (("Extension Contract" = '') OR
          ("Extension Contract Status" IN ["Extension Contract Status"::Order, "Extension Contract Status"::"Invoicing Allowed" ]))
      THEN
        EXIT;

      IF DimValRec.Code <> "Cost Object" THEN BEGIN
        DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, FALSE,'');
        IF DimValRec.Code = '' THEN
          EXIT;
      END;

      IF DimValRec."Purchase Action" <> '' THEN
        IF ProjPurchActRec.GET("Project No.", DimValRec."Purchase Action") THEN
          IF ProjPurchActRec.Status < ProjPurchActRec.Status::Applied THEN
            "Purchase Action" := DimValRec."Purchase Action";
    END;

    PROCEDURE FillDefaultTenderElementPart@1100485000();
    VAR
      lvTenderElemPartRec@1100485000 : Record 11012264;
    BEGIN
      lvTenderElemPartRec.SETRANGE("Project No.", "Project No.");
      lvTenderElemPartRec.SETRANGE("Tender Paragraph", "Tender Paragraph");
      IF lvTenderElemPartRec.FINDFIRST THEN BEGIN
        IF lvTenderElemPartRec.NEXT = 0 THEN  //* Fill if one Part is present for Tender Paragraph
          "Tender Paragraph Part" := lvTenderElemPartRec."Tender Paragraph Part"
      END;
    END;

    PROCEDURE FillMainProject@1100485001();
    BEGIN
      IF "Project No." <> '' THEN BEGIN
        ProjRec.GET("Project No.");
        "Main Project No." := ProjRec."Main Project";
      END ELSE
        "Main Project No." := ''; //This occurs when using Budget Line is used as a temporary for import standard budget.
    END;

    PROCEDURE AssignToPurchaseAction@1100485003(PurchAction@11012000 : Code[20]);
    VAR
      lvBudgetLineRec@1210190000 : Record 11012001;
    BEGIN
      lvBudgetLineRec.COPY(Rec);
      WITH lvBudgetLineRec DO BEGIN
        IF NOT FINDFIRST THEN BEGIN
          MESSAGE(Text022);
          EXIT;
        END;
        IF CONFIRM(Text008,TRUE,PurchAction) THEN BEGIN
          FINDSET(TRUE,FALSE);
          REPEAT;
            "Purchase Action" := PurchAction;
            UpdatePurchActionStatusInLine;
            MODIFY(TRUE); //C010337.e
          UNTIL NEXT = 0;
        END;
      END;
    END;

    PROCEDURE DisconnectFromPurchaseAction@1100485002(PurchAction@1100485001 : Code[20]);
    VAR
      lvBudgetLineRec@1100485000 : Record 11012001;
    BEGIN
      lvBudgetLineRec.COPY(Rec);
      WITH lvBudgetLineRec DO BEGIN
        IF NOT FINDFIRST THEN BEGIN
          MESSAGE(Text022);
          EXIT;
        END;
        IF CONFIRM(Text009,TRUE,PurchAction) THEN BEGIN
          FILTERGROUP(9);
          IF PurchAction = '' THEN
            SETFILTER("Purchase Action", '<>%1', '');
          FILTERGROUP(0);
          IF NOT FINDSET(TRUE,FALSE) THEN
            ERROR(Text025, FIELDCAPTION("Purchase Action"));
          REPEAT;
            IF Advised THEN  //* C-019130 (C-019131)
              FIELDERROR(Advised, STRSUBSTNO(Text017, FIELDCAPTION("Purchase Action"), "Purchase Action"));
            UpdateLogbook; //C010337.n
            "Purchase Action" := '';
            "Purchase Action Status" := 0;
            "Purch. Action Approval Date" := 0D;
            MODIFY(TRUE);
          UNTIL NEXT = 0;
        END;
      END;
    END;

    PROCEDURE ReverseBudgetLines@1100485004();
    VAR
      lvBudgetLineRec@1100485000 : Record 11012001;
    BEGIN
      lvBudgetLineRec.COPY(Rec);
      WITH lvBudgetLineRec DO BEGIN
        IF NOT FINDSET(FALSE,FALSE) THEN BEGIN
          MESSAGE(Text023);
          EXIT;
        END ELSE BEGIN
          REPEAT
            IF BudgetFixed(lvBudgetLineRec) THEN BEGIN
              MESSAGE(Text014);
              EXIT;
            END;
          UNTIL NEXT = 0;
        END;
        FINDFIRST;
        IF CONFIRM(Text011,TRUE) THEN BEGIN
          FINDSET(TRUE,FALSE);
          REPEAT;
            Quantity := Quantity * -1;
            Hours := Hours * -1;
            "Amount (LCY)" := "Amount (LCY)" * -1;
            "Amount (FCY)" := "Amount (FCY)" * -1;  //DP00883
            CALCFIELDS("Total Amount","Total Hours","Total Labor","Total material",
              "Total Subcontracting","Total Plant","Total Sundry");
            MODIFY;
          UNTIL NEXT = 0;
        END;
      END;
    END;

    PROCEDURE BudgetFixed@8(lvBudgetLineRec@1100485001 : Record 11012001) Fixed : Boolean;
    BEGIN
      Fixed := FALSE;

      WITH lvBudgetLineRec DO BEGIN
        CASE TRUE OF
          Adjustment <> '':
            IF AdjustmentRec.GET("Project No.", Adjustment) THEN
              Fixed := AdjustmentRec."Budget Correction Fixed";
          Option <> '':
            Fixed := FALSE; //Options can not be frozen
          "Extension Contract" <> '':
            IF ExtensionRec.GET("Project No.","Extension Contract") THEN
              Fixed := ExtensionRec."Budget Fixed";
          "Project No." <> '':
            IF ProjRec.GET("Project No.") THEN
              Fixed := ProjRec."Budget Fixed";
        END;
      END;

      EXIT(Fixed);
    END;

    PROCEDURE GiveErrorMessageBudgetFixed@1100529401(BudgetLine@1100485001 : Record 11012001);
    VAR
      BudgetAdjustment@1100525001 : Record 11012003;
      ExtensionContract@1100525000 : Record 11012004;
      Job@1100529100 : Record 11072003;
    BEGIN
      //checked on import-procedures (C016643 + T007154)
      CASE TRUE OF
        BudgetLine.Adjustment <> '':
          BEGIN
            BudgetAdjustment.GET(BudgetLine."Project No.",BudgetLine.Adjustment);
            BudgetAdjustment.TESTFIELD("Budget Correction Fixed",FALSE);
          END;
        BudgetLine."Extension Contract" <> '':
          BEGIN
            ExtensionContract.GET(BudgetLine."Project No.",BudgetLine."Extension Contract");
            ExtensionContract.TESTFIELD("Budget Fixed",FALSE);
          END;
        BudgetLine."Project No." <> '':
          BEGIN
            Job.GET(BudgetLine."Project No.");
            Job.TESTFIELD("Budget Fixed",FALSE);
          END;
      END;
    END;

    PROCEDURE GetItemSpecifications@1100485006();
    BEGIN
      IF ItemRec.GET("Item No.") THEN BEGIN
        "Item Series" := ItemRec."Item Series";
        "Item Type" := ItemRec."Item Type";
        "Item Brand" := ItemRec."Item Brand";
      END;
    END;

    PROCEDURE CheckItemRouteReference@1100485005();
    VAR
      ItemFeatureRec@1100485000 : Record 11020301;
      DocFeatureRec@1100485002 : Record 11020303;
      LastRefNo@1100485001 : Code[20];
    BEGIN
      IF "Item No." <> xRec."Item No." THEN BEGIN
        DocFeatureRec.RESET;
        DocFeatureRec.SETRANGE("Document No.", "Item Route Reference");
        DocFeatureRec.SETRANGE("Item No.", xRec."Item No.");
        DocFeatureRec.DELETEALL;
        "Item Route Reference" := '';
      END;

      IF "Item No." = '' THEN EXIT;
      IF "Item Route Reference" = '' THEN BEGIN
        DocFeatureRec.RESET;
        IF DocFeatureRec.FINDLAST THEN
          LastRefNo := DocFeatureRec."Document No."
        ELSE
          LastRefNo := PADSTR('', MAXSTRLEN("Item Route Reference"), '0');
      END ELSE BEGIN
        EXIT;
      END;

      ItemFeatureRec.SETRANGE("Item No.", "Item No.");
      IF ItemFeatureRec.FINDSET THEN BEGIN
        LastRefNo := INCSTR(LastRefNo);
        "Item Route Reference" := LastRefNo;
        REPEAT
          DocFeatureRec.INIT;
          DocFeatureRec."Document No." := LastRefNo;
          DocFeatureRec."Item No." := ItemFeatureRec."Item No.";
          DocFeatureRec.Feature := ItemFeatureRec.Feature;
          DocFeatureRec.Value := ItemFeatureRec.Value;
          DocFeatureRec."Surcharge %" := ItemFeatureRec."Surcharge %";
          DocFeatureRec."Surcharge Price" := ItemFeatureRec."Surcharge Price";
          IF DocFeatureRec.INSERT THEN;
        UNTIL ItemFeatureRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetReferenceData@1100485008(VAR lvRefDate@1100485002 : Date;VAR lvDiscRef1@1100485001 : Code[20];VAR lvDiscRef2@1100485000 : Code[20]);
    BEGIN
      ProjRec.GET("Project No.");
      lvRefDate := ValidateCu.GetRefDateProject(ProjRec);
      lvDiscRef1 := ProjRec."Purch Discount Term Group 1";
      lvDiscRef2 := ProjRec."Purch Discount Term Group 2";
    END;

    PROCEDURE GetVersionDate@1100525000();
    BEGIN
      IF Adjustment <> '' THEN
        IF AdjustmentRec.GET("Project No.", Adjustment) THEN BEGIN
          "Version Date" := AdjustmentRec."Version Date";
          EXIT;
        END;

      IF "Extension Contract" <> '' THEN
        IF ExtensionRec.GET("Project No.","Extension Contract") THEN BEGIN
          "Version Date" := ExtensionRec."Version Date";
          EXIT;
        END;

      IF Option <> '' THEN BEGIN
        OptionRec.SETRANGE("Project No.","Project No.");
        OptionRec.SETRANGE(Option,Option);
        OptionRec.SETRANGE("Plot No.", "Plot No.");
        IF OptionRec.FINDFIRST THEN BEGIN
          "Version Date" := OptionRec."Version Date";
          EXIT;
        END;
      END;

      IF "Project No." <> '' THEN
        IF ProjRec.GET("Project No.") THEN
          "Version Date" := ProjRec."Version Date";
    END;

    PROCEDURE FillElementPhaseCodeBasedOnElement@1100528409();
    VAR
      ProjectElement@1100528400 : Record 11012010;
    BEGIN
      IF ("Project No." <> '') AND (Element <> '') THEN
        IF ProjectElement.GET("Project No.", Element) THEN BEGIN
          VALIDATE("Element Phase Code", ProjectElement."Phase Code");
          EXIT;
        END;

      "Element Phase Code" := '';
    END;

    PROCEDURE StartCopyAndApply@1100525003(lvStartfrom@1100525000 : 'Adjustment,Purchase Action';lvCostObjectCde@1100525001 : Code[20];lvAdjCde@1100525002 : Code[10]);
    VAR
      lvApplyBln@1100525003 : Boolean;
      lvText001@1100525004 : TextConst 'ENU=Do you immediately want to settle the Selected Lines?;NOR=Vil du umiddelbart gj›re opp de Valgte Radene?;SVE=Vill du omedelbart r„kna av de valda raderna?';
    BEGIN
      CASE lvStartfrom OF
        lvStartfrom::Adjustment:
          BEGIN
            lvApplyBln := CONFIRM(lvText001,TRUE);
            CopyAndApply(lvCostObjectCde,lvAdjCde,lvApplyBln);
          END;
        lvStartfrom::"Purchase Action":
          CopyAndApply(lvCostObjectCde,lvAdjCde,TRUE);
      END;
    END;

    PROCEDURE CopyAndApply@1100525002(lvCostObjectCde@1100525004 : Code[20];lvAdjCde@1100525001 : Code[10];lvApplyBln@1100525003 : Boolean);
    VAR
      lvBudgetLineRec@1100485000 : Record 11012001;
      NewBudgetLine@1100525000 : Record 11012001;
      TempNewBudgetLine@1100528400 : TEMPORARY Record 11012001;
      BudgetPlanningActivity@1100529401 : Record 11229302;
      BudgetPlanningActivityTmp@1100529400 : TEMPORARY Record 11229302;
      LastLineNo@1100525002 : Integer;
      lvBudgetAdjRec@1100525005 : Record 11012003;
      lvBudgetApplyFrm@1100525006 : Page 11012148;
      CounterAdjust@1100525010 : Integer;
      CounterMarked@1100525012 : Integer;
      lvAmntToApply@1100525007 : Decimal;
      lvDescription@1100525008 : Text[100];
      ConfirmText@1100525011 : Text[200];
      BudgetLineAdjust@1100528500 : Record 11012001;
    BEGIN
      lvBudgetLineRec.COPY(Rec);
      lvBudgetLineRec.Adjustment := lvAdjCde;
      IF BudgetFixed(lvBudgetLineRec) THEN
        ERROR(Text014);

      WITH lvBudgetLineRec DO BEGIN
        IF ISEMPTY THEN BEGIN
          MESSAGE(Text022);
          EXIT;
        END;

        //C051151.sn
        CounterMarked := COUNT;
        BudgetLineAdjust.COPY(lvBudgetLineRec);
        BudgetLineAdjust.MARKEDONLY(TRUE);
        BudgetLineAdjust.SETRANGE("Copied to Adjustment", TRUE);
        CounterAdjust := BudgetLineAdjust.COUNT;
        //C051151.en

        IF CounterAdjust > 0 THEN BEGIN
          //CounterMarked := COUNT;  //C051151.o
          IF CounterMarked = 1 THEN
            ConfirmText := Text019
          ELSE
            ConfirmText := STRSUBSTNO(Text020, CounterAdjust, CounterMarked);
          IF NOT CONFIRM(ConfirmText, FALSE) THEN
            EXIT;
        END;
        FINDSET(TRUE,FALSE);

        lvDescription := Description;
        LastLineNo := GetLastLineNo("Project No.", lvAdjCde, "Extension Contract", Option);
        REPEAT
          IF (Description <> lvDescription) AND (lvDescription <> '') THEN
            lvDescription := '';  //* Fill only when all processed budget lines have the same description
          TempNewBudgetLine := lvBudgetLineRec;
          TempNewBudgetLine.Adjustment := lvAdjCde;
          TempNewBudgetLine."Copied to Adjustment" := FALSE;

          TempNewBudgetLine."Line No." := LastLineNo + 10000;
          LastLineNo := TempNewBudgetLine."Line No.";
          IF lvApplyBln THEN BEGIN
            TempNewBudgetLine.Quantity := TempNewBudgetLine.Quantity * -1;
            TempNewBudgetLine.Hours := TempNewBudgetLine.Hours * -1;
            TempNewBudgetLine."Amount (LCY)" := TempNewBudgetLine."Amount (LCY)" * -1;
            TempNewBudgetLine."Amount (FCY)" := TempNewBudgetLine."Amount (FCY)" * -1;
          END;
          TempNewBudgetLine."Adjustment by Phase Change" := FALSE;
          TempNewBudgetLine.UpdateAdjustmentByPhaseChange;
          TempNewBudgetLine."Generated by Phase Change" := TempNewBudgetLine."Generated by Phase Change"::No;
          TempNewBudgetLine."Element Phase Code" := '';
          TempNewBudgetLine.FillElementPhaseCodeBasedOnElement;
          TempNewBudgetLine.GetVersionDate;
          TempNewBudgetLine.INSERT;

          BudgetPlanningActivity.SETRANGE("Project No.", lvBudgetLineRec."Project No.");
          BudgetPlanningActivity.SETRANGE(Adjustment, lvBudgetLineRec.Adjustment);
          BudgetPlanningActivity.SETRANGE("Extension Contract", lvBudgetLineRec."Extension Contract");
          BudgetPlanningActivity.SETRANGE(Option, lvBudgetLineRec.Option);
          BudgetPlanningActivity.SETRANGE("Budget Line No.", lvBudgetLineRec."Line No.");
          IF BudgetPlanningActivity.FINDSET THEN
            REPEAT
              BudgetPlanningActivityTmp := BudgetPlanningActivity;
              BudgetPlanningActivityTmp.Adjustment := TempNewBudgetLine.Adjustment;
              BudgetPlanningActivityTmp."Budget Line No." := TempNewBudgetLine."Line No.";
              IF lvApplyBln THEN BEGIN
                BudgetPlanningActivityTmp.Quantity := BudgetPlanningActivityTmp.Quantity * -1;
                BudgetPlanningActivityTmp.Amount := BudgetPlanningActivityTmp.Amount * -1;
              END;
              BudgetPlanningActivityTmp.INSERT;
            UNTIL BudgetPlanningActivity.NEXT = 0;

          lvAmntToApply := lvAmntToApply + "Amount (LCY)";

          "Copied to Adjustment" := TRUE;
          MODIFY;
        UNTIL NEXT = 0;

        BudgetPlanningActivity.RESET;

        IF TempNewBudgetLine.FINDSET THEN
          REPEAT
            NewBudgetLine := TempNewBudgetLine;
            NewBudgetLine.INSERT;
            NewBudgetLine.MARK(TRUE);

            BudgetPlanningActivityTmp.SETRANGE("Project No.", NewBudgetLine."Project No.");
            BudgetPlanningActivityTmp.SETRANGE(Adjustment, NewBudgetLine.Adjustment);
            BudgetPlanningActivityTmp.SETRANGE("Extension Contract", NewBudgetLine."Extension Contract");
            BudgetPlanningActivityTmp.SETRANGE(Option, NewBudgetLine.Option);
            BudgetPlanningActivityTmp.SETRANGE("Budget Line No.", NewBudgetLine."Line No.");
            IF BudgetPlanningActivityTmp.FINDSET THEN
              REPEAT
                BudgetPlanningActivity := BudgetPlanningActivityTmp;
                BudgetPlanningActivity.INSERT;
              UNTIL BudgetPlanningActivityTmp.NEXT = 0;

          UNTIL TempNewBudgetLine.NEXT = 0;

        IF lvApplyBln THEN BEGIN
          IF lvAmntToApply = 0 THEN
            ERROR(Text016);

          COMMIT;
          lvBudgetAdjRec.GET("Project No.",lvAdjCde);
          lvBudgetApplyFrm.SetDefaults(lvBudgetAdjRec,lvAmntToApply,lvCostObjectCde,"Purchase Action");
          IF lvDescription <> '' THEN
            lvBudgetApplyFrm.SetDefaultNewDescription(lvDescription);

          NewBudgetLine.MARKEDONLY(TRUE);
          lvBudgetApplyFrm.SetMarkedBudgetLines(NewBudgetLine, TRUE);
          lvBudgetApplyFrm.RUNMODAL;

        END;
      END;
      CLEARMARKS;
    END;

    PROCEDURE GetLastLineNo@1100528400(ProjectNo@1100528400 : Code[20];Adjustment@1100528401 : Code[10];ExtensionContract@1100528402 : Code[10];Option@1100528403 : Code[20]) LineNo : Integer;
    VAR
      BudgetLine@1100528404 : Record 11012001;
    BEGIN
      BudgetLine.SETRANGE("Project No.", ProjectNo);
      BudgetLine.SETRANGE(Adjustment, Adjustment);
      BudgetLine.SETRANGE("Extension Contract", ExtensionContract);
      BudgetLine.SETRANGE(Option, Option);
      IF BudgetLine.FINDLAST THEN
        LineNo := BudgetLine."Line No.";
    END;

    PROCEDURE CheckRecipeTotals@1210190002();
    VAR
      BudgetLine@1210190000 : Record 11012001;
      OldQuan@1210190001 : Decimal;
      NewQuan@1210190002 : Decimal;
    BEGIN
      IF "Source Type" <> "Source Type"::"Recipe Header" THEN EXIT;

      //DP02339.sn
      OldQuan := xRec.Quantity;
      NewQuan := Quantity;
      //DP02339.en

      BudgetLine.SETRANGE("Project No.", "Project No.");
      BudgetLine.SETRANGE("Extension Contract", "Extension Contract");
      BudgetLine.SETRANGE(Adjustment, Adjustment);
      BudgetLine.SETRANGE(Option, '');

      BudgetLine.SETRANGE("Source Type", BudgetLine."Source Type"::"Recipe Line");
      BudgetLine.SETRANGE("Recipe Group", "Recipe Group");
      BudgetLine.SETRANGE(Recipe, Recipe);
      BudgetLine.SETRANGE("Attached to Recipe Line", "Line No.");
      IF BudgetLine.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF OldQuan = 0 THEN
            BudgetLine.Quantity := BudgetLine."Original Quantity" * NewQuan  //DP02339
          ELSE
            BudgetLine.Quantity := BudgetLine.Quantity * NewQuan / OldQuan;
          BudgetLine.CalcTotals;
          BudgetLine.MODIFY(TRUE);
        UNTIL BudgetLine.NEXT = 0;
      END;
    END;

    PROCEDURE CheckBomLines@1100529400();
    VAR
      BudgetLine@1210190000 : Record 11012001;
      OldQuan@1210190001 : Decimal;
      NewQuan@1210190002 : Decimal;
    BEGIN
      IF ("BOM Item No." = '') THEN EXIT;
      IF ("Level BOM" <> 0) THEN EXIT;

      //DP02339.sn
      OldQuan := xRec.Quantity;
      NewQuan := Quantity;
      //DP02339.en

      BudgetLine.SETRANGE("Project No.", "Project No.");
      BudgetLine.SETRANGE("Extension Contract", "Extension Contract");
      BudgetLine.SETRANGE(Adjustment, Adjustment);
      BudgetLine.SETRANGE(Option, '');

      BudgetLine.SETRANGE("BOM Item No.", "BOM Item No.");
      BudgetLine.SETRANGE("Part of Line", "Line No.");
      IF BudgetLine.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF OldQuan = 0 THEN
            BudgetLine.Quantity := BudgetLine."Original Quantity" * NewQuan  //DP02339
          ELSE
            BudgetLine.Quantity := BudgetLine.Quantity * NewQuan / OldQuan;
          BudgetLine.CalcTotals;
          BudgetLine.MODIFY(TRUE);
        UNTIL BudgetLine.NEXT = 0;
      END;
    END;

    PROCEDURE CopyAndPasteRTC@1100525508(ProjectNo@1100525004 : Code[20];ExtensionCode@1100525001 : Code[20];CurrLineNo@1100525006 : Integer);
    VAR
      BudgetLine2@1100525000 : Record 11012001;
      TempBudgetLine@1100525005 : TEMPORARY Record 11012001;
      BudgetPlanningActivity@1100529401 : Record 11229302;
      BudgetPlanningActivityTmp@1100529400 : TEMPORARY Record 11229302;
      NextLineNo@1100525002 : Integer;
      LineCount@1100525003 : Integer;
      PrevLineNo@1100525007 : Integer;
      Gap@1100525008 : Integer;
    BEGIN
      BudgetLine2.COPY(Rec);
      BudgetLine2."Project No." := ProjectNo;
      BudgetLine2."Extension Contract" := ExtensionCode;

      IF BudgetFixed(BudgetLine2) THEN
        ERROR(Text014);

      IF NOT FINDSET(FALSE,FALSE) THEN BEGIN
        MESSAGE(Text023);
        EXIT;
      END;

      LineCount := 0;
      REPEAT;
        LineCount += 1;
        //Temp Table is needed in case all records are selected
        TempBudgetLine := Rec;
        TempBudgetLine."Project No." := ProjectNo;
        TempBudgetLine."Extension Contract" := ExtensionCode;
        TempBudgetLine.Adjustment := '';
        TempBudgetLine.Option := '';
        TempBudgetLine."Line No." := LineCount;
        TempBudgetLine.INSERT;

        BudgetPlanningActivity.SETRANGE("Project No.", "Project No.");
        BudgetPlanningActivity.SETRANGE(Adjustment, Adjustment);
        BudgetPlanningActivity.SETRANGE("Extension Contract", "Extension Contract");
        BudgetPlanningActivity.SETRANGE(Option, Option);
        BudgetPlanningActivity.SETRANGE("Budget Line No.", "Line No.");
        IF BudgetPlanningActivity.FINDSET THEN
          REPEAT
            BudgetPlanningActivityTmp := BudgetPlanningActivity;
            BudgetPlanningActivityTmp."Project No." := TempBudgetLine."Project No.";
            BudgetPlanningActivityTmp.Adjustment := TempBudgetLine.Adjustment;
            BudgetPlanningActivityTmp."Extension Contract" := TempBudgetLine."Extension Contract";
            BudgetPlanningActivityTmp.Option := TempBudgetLine.Option;
            BudgetPlanningActivityTmp."Budget Line No." := TempBudgetLine."Line No.";
            BudgetPlanningActivityTmp.INSERT;
          UNTIL BudgetPlanningActivity.NEXT = 0;
      UNTIL NEXT = 0;

      BudgetPlanningActivity.RESET;

      IF TempBudgetLine.FINDSET THEN BEGIN
        BudgetLine2.RESET;
        BudgetLine2.SETCURRENTKEY("Project No.",Adjustment,"Extension Contract",Option,"Line No.");
        BudgetLine2.SETRANGE("Project No.", TempBudgetLine."Project No.");
        BudgetLine2.SETRANGE(Adjustment, TempBudgetLine.Adjustment);
        BudgetLine2.SETRANGE("Extension Contract", TempBudgetLine."Extension Contract");
        BudgetLine2.SETRANGE(Option,TempBudgetLine.Option);
        IF CurrLineNo > 0 THEN BEGIN
          BudgetLine2.SETFILTER("Line No.", '<%1', CurrLineNo);
          IF BudgetLine2.FINDLAST THEN
            PrevLineNo := BudgetLine2."Line No.";
          IF LineCount < (CurrLineNo - PrevLineNo) THEN BEGIN
            Gap := ROUND((CurrLineNo - PrevLineNo) / (LineCount + 1), 1);
            IF Gap > 10000 THEN
              Gap := 10000;
            NextLineNo := PrevLineNo + Gap;
          END;
          BudgetLine2.SETRANGE("Line No."); //Reset filter
        END;
        IF (Gap = 0) OR (NextLineNo = 0) THEN BEGIN
          Gap := 10000;
          NextLineNo := Gap;
          IF BudgetLine2.FINDLAST THEN
            NextLineNo := BudgetLine2."Line No." + Gap;
        END;
        REPEAT
          BudgetLine2 := TempBudgetLine;
          BudgetLine2."Line No." := NextLineNo;
          BudgetLine2.INSERT(TRUE);
          BudgetLine2."Currency Code" := TempBudgetLine."Currency Code";
          BudgetLine2.MODIFY;
          NextLineNo := NextLineNo + Gap;

          BudgetPlanningActivityTmp.SETRANGE("Project No.", TempBudgetLine."Project No.");
          BudgetPlanningActivityTmp.SETRANGE(Adjustment, TempBudgetLine.Adjustment);
          BudgetPlanningActivityTmp.SETRANGE("Extension Contract", TempBudgetLine."Extension Contract");
          BudgetPlanningActivityTmp.SETRANGE(Option, TempBudgetLine.Option);
          BudgetPlanningActivityTmp.SETRANGE("Budget Line No.", TempBudgetLine."Line No.");
          IF BudgetPlanningActivityTmp.FINDSET THEN
            REPEAT
              BudgetPlanningActivity := BudgetPlanningActivityTmp;
              BudgetPlanningActivity."Budget Line No." := BudgetLine2."Line No.";
              BudgetPlanningActivity.INSERT;
            UNTIL BudgetPlanningActivityTmp.NEXT = 0;
        UNTIL TempBudgetLine.NEXT = 0;
      END;

      IF LineCount > 0 THEN
        MESSAGE(Text024, LineCount);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT FPSLicenseManagement.LicenseAndReadPermissionForTable(DepartmentAuthorizObject) THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012001) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012001');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Budget Line", "Department Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Department Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Department Code");
    END;

    PROCEDURE ChangeQuantityExplodedLines@1100525004(QuantityFactor@1100525000 : Decimal);
    VAR
      BudgetLine2@1100525001 : Record 11012001;
    BEGIN
      BudgetLine2.RESET;
      BudgetLine2.SETRANGE("Project No.","Project No.");
      BudgetLine2.SETRANGE("Part of Line","Line No.");
      BudgetLine2.SETFILTER("Line No.", '<>%1', "Line No.");
      IF BudgetLine2.FINDSET(TRUE, FALSE) THEN
        REPEAT
          IF NOT ((BudgetLine2."Item No." = '') AND (BudgetLine2."Original Quantity" = 0)) THEN BEGIN
            IF BudgetLine2."Item No." = '' THEN BEGIN
              BudgetLine2.ChangeQuantityExplodedLines(QuantityFactor);
              BudgetLine2."Original Quantity" := QuantityFactor * BudgetLine2."Original Quantity";
            END ELSE
              BudgetLine2.VALIDATE(Quantity, QuantityFactor * BudgetLine2.Quantity);
            BudgetLine2.MODIFY;
          END;
        UNTIL BudgetLine2.NEXT = 0;
    END;

    PROCEDURE GenerateBudgetToMatReqLines@1100525005(ProjectNoFilter@1100525002 : Text[250]);
    VAR
      Job@1100525005 : Record 11072003;
      ProjectMaterialReqLine@1100525004 : Record 11012526;
      BudgetLine@1100525003 : Record 11012001;
      NoOfLinesGenerated@1210190000 : Integer;
    BEGIN
      //Checks are done upfront, because the input is a filter and not a single project number
      Job.SETFILTER("No.", '%1', ProjectNoFilter);
      IF Job.FINDSET THEN REPEAT
        IF Job."Project Status" >= Job."Project Status"::"Technical Finished" THEN BEGIN
          MESSAGE(Text000, Job.FIELDCAPTION(Job."No."), Job."No.", Job.FIELDCAPTION("Project Status"), Job."Project Status");
          EXIT;
        END;
        ProjectMaterialReqLine.SETRANGE("Project No.", Job."No.");
        ProjectMaterialReqLine.SETRANGE(Origin, ProjectMaterialReqLine.Origin::Budget);
        IF (ProjectMaterialReqLine.COUNT > 0) THEN BEGIN
          IF (NOT CONFIRM(Text001, FALSE, Job.FIELDCAPTION("No."), Job."No.")) THEN
            EXIT;
        END;
        DeleteMatReqLines(Job."No.");
      UNTIL (Job.NEXT = 0);

      BudgetLine.SETFILTER("Project No.", '%1', ProjectNoFilter);
      BudgetLine.SETFILTER("Cost Type", '%1|%2', BudgetLine."Cost Type"::Subcontracting, BudgetLine."Cost Type"::Material);
      IF BudgetLine.FINDSET THEN REPEAT
        GenerateBudgetToMatReqLine(BudgetLine);
        NoOfLinesGenerated +=1;
      UNTIL (BudgetLine.NEXT = 0);
      MESSAGE(Text021, NoOfLinesGenerated);
    END;

    LOCAL PROCEDURE GenerateBudgetToMatReqLine@1100525006(VAR BudgetLine@1100525002 : Record 11012001);
    VAR
      ProjectMaterialReqLine@1100525001 : Record 11012526;
      Job@1100525000 : Record 11072003;
      ProjectElement@1100525003 : Record 11012010;
      LastRefNo@1100528501 : Code[20];
      RouteRefMgtCU@1100528500 : Codeunit 11012045;
    BEGIN
      //C046460: BudgetLine=VAR
      ProjectMaterialReqLine.INIT;

      ProjectMaterialReqLine."Project No." := BudgetLine."Project No.";
      ProjectMaterialReqLine.Element := BudgetLine.Element;
      ProjectMaterialReqLine.Origin := ProjectMaterialReqLine.Origin::Budget;
      ProjectMaterialReqLine."Item No." := BudgetLine."Item No.";
      ProjectMaterialReqLine."Basic Item" := BudgetLine."Basic Item";
      ProjectMaterialReqLine."Trade Item" := BudgetLine."Trade Item";
      ProjectMaterialReqLine."Vendor (Trade Item)" := BudgetLine."Vendor (Trade Item)";
      ProjectMaterialReqLine.Manufacturer := BudgetLine.Manufacturer;
      ProjectMaterialReqLine.Description := BudgetLine.Description;
      ProjectMaterialReqLine.Description2 := BudgetLine."Description 2";
      ProjectMaterialReqLine."Variant Code" := BudgetLine."Variant Code";
      //DP00803.sn
      ProjectMaterialReqLine."Expected Price" := BudgetLine."Price (LCY)";
      ProjectMaterialReqLine.VALIDATE(Quantity, BudgetLine.Quantity);  //validate Quantity to Procure and Expected Amount
      //DP00803.en
      ProjectMaterialReqLine."Unit of Measure" := BudgetLine."Unit of Measure";
      ProjectMaterialReqLine."Cost Object" := BudgetLine."Cost Object";
      IF (BudgetLine.Element = '') THEN BEGIN
        Job.GET(BudgetLine."Project No.");
        ProjectMaterialReqLine."Delivery Date" := Job."Starting Date";
      END ELSE BEGIN
        ProjectElement.GET(BudgetLine."Project No.", BudgetLine.Element);
        ProjectMaterialReqLine."Delivery Date" := ProjectElement."Starting Date";
      END;
      ProjectMaterialReqLine."Unique Traceable" := TRUE;
      ProjectMaterialReqLine."Exclude Logistics" := FALSE;

      IF BudgetLine."Entity No." <> '' THEN BEGIN
        ProjectMaterialReqLine."Entity Type" := ProjectMaterialReqLine."Entity Type"::Position;
        ProjectMaterialReqLine."Entity No." := BudgetLine."Entity No.";
      END;

      ProjectMaterialReqLine.INSERT(TRUE);
      ProjectMaterialReqLine."Price Agreement" := BudgetLine."Price Agreement";  //C045565
      //C046460.sn
      IF (BudgetLine."Purchase Route Reference" = '') THEN BEGIN
        LastRefNo := RouteRefMgtCU.GetLastRefNo();
        LastRefNo := INCSTR(LastRefNo);
        BudgetLine."Purchase Route Reference" := LastRefNo;
        RouteRefMgtCU.WriteLastRefNo(LastRefNo);
      END;
      ProjectMaterialReqLine."Purchase Route Reference" := BudgetLine."Purchase Route Reference";
      ProjectMaterialReqLine."Created from Budget" := TRUE;
      //C046460.en
      ProjectMaterialReqLine.MODIFY;

      //C046460.sn
      BudgetLine.Advised := TRUE;  //C024706: required for Available Quantity per period (page 353)
      BudgetLine.MODIFY;
      //C046460.en
    END;

    LOCAL PROCEDURE DeleteMatReqLines@1100525011(ProjectNo@1100525002 : Code[20]);
    VAR
      ProjectMaterialReqLine@1100525004 : Record 11012526;
    BEGIN
      ProjectMaterialReqLine.SETRANGE("Project No.", ProjectNo);
      ProjectMaterialReqLine.SETRANGE(Origin, ProjectMaterialReqLine.Origin::Budget);
      ProjectMaterialReqLine.DELETEALL;
    END;

    PROCEDURE DetermineBOMLevel@1100525007(LineNo@1100525000 : Integer;VAR BOMLevel@1100525002 : Integer);
    VAR
      BudgetLine@1100525001 : Record 11012001;
    BEGIN
      BudgetLine.SETRANGE("Project No.","Project No.");
      BudgetLine.SETRANGE(Adjustment,Adjustment);
      BudgetLine.SETRANGE("Extension Contract","Extension Contract");
      BudgetLine.SETRANGE(Option,Option);
      BudgetLine.SETRANGE("Line No.",LineNo);
      IF BudgetLine.FINDFIRST THEN
        BOMLevel := BudgetLine."Level BOM" + 1;
    END;

    PROCEDURE DeleteCommentLine@1100529800();
    VAR
      CommentLine@1100529801 : Record 11020634;
      RecRef@1100529800 : RecordRef;
    BEGIN
      RecRef.GETTABLE(Rec);

      CommentLine.RESET;
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::Budget);
      CommentLine.SETFILTER("Record ID", FORMAT(RecRef.RECORDID()));
      CommentLine.DELETEALL(TRUE);
    END;

    PROCEDURE CommentLineExist@1210190011() : Boolean;
    VAR
      RecRef@1210190000 : RecordRef;
      CommentLine@1210190001 : Record 11020634;
    BEGIN
      RecRef.GETTABLE(Rec);
      CommentLine.SETRANGE("Table Name", CommentLine."Table Name"::Budget);
      CommentLine.SETFILTER("Record ID", FORMAT(RecRef.RECORDID()));
      IF NOT CommentLine.ISEMPTY THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE GetProjPlanActivityDescription@1210190001() : Text[50];
    VAR
      ProjPlanAct@1210190000 : Record 11012431;
    BEGIN
      IF "Project Planning Activity No." <> '' THEN BEGIN
        IF FPSLicenseManagement.LicenseAndReadPermissionForTable(ProjPlanAct) THEN BEGIN
          IF ProjPlanAct.GET("Project Planning Activity No.") THEN
            EXIT(ProjPlanAct.Description);
        END;
      END;
      EXIT('');
    END;

    PROCEDURE SummaryAmount@1210190003() : Decimal;
    VAR
      BudgetLine@1210190000 : Record 11012001;
    BEGIN
      BudgetLine.SETCURRENTKEY(
        "Project No.","Cost Type","Cost Object","Extension Contract Status","Version Date",
        Adjustment,"Extension Contract",Option,"Purchase Action", "Budget Summary Line");
      BudgetLine.SETRANGE("Project No.","Project No.");
      BudgetLine.SETRANGE("Extension Contract", "Extension Contract");
      BudgetLine.SETRANGE(Adjustment, Adjustment);
      BudgetLine.SETRANGE("Budget Summary Line",TRUE);
      IF BudgetLine.FINDFIRST THEN BEGIN
        BudgetLine.CALCSUMS("Amount (LCY)");
        EXIT(BudgetLine."Amount (LCY)");
      END;
      EXIT(0);
    END;

    PROCEDURE DeleteSummaryLinesExtAdjust@1210190004() : Boolean;
    VAR
      BudgetLine@1210190000 : Record 11012001;
    BEGIN
      IF (Adjustment = '') AND ("Extension Contract" = '') THEN  //29724-2.n
        EXIT(FALSE);                                             //29724-2.n

      BudgetLine.SETRANGE("Project No.","Project No.");
      BudgetLine.SETRANGE("Extension Contract", "Extension Contract");
      BudgetLine.SETRANGE(Adjustment, Adjustment);
      //BudgetLine.SETRANGE(Option, '');  //C000697.o
      BudgetLine.SETRANGE("Budget Summary Line", FALSE);
      IF BudgetLine.COUNT = 1 THEN BEGIN  // If last line of contract and/or adjusment is deleted
        BudgetLine.SETRANGE("Budget Summary Line", TRUE);
        BudgetLine.DELETEALL(TRUE);
        EXIT(TRUE);  //29724-2.n
      END;
      EXIT(FALSE);  //29724-2.n
    END;

    PROCEDURE FillDefaultFscType@1100529000();
    BEGIN
      //*DP00129
      IF ("Cost Object" = '') OR ("Project No."= '') THEN
        EXIT;
      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, FALSE, '');
      IF NOT DimValRec."FSC Applicable" THEN
        EXIT;
      IF NOT ProjRec.GET("Project No.") THEN
        EXIT;
      IF ProjRec."FSC Type Code" <> '' THEN
        "FSC Type Code" :=  ProjRec."FSC Type Code";
    END;

    PROCEDURE SetDeleteCompleteProject@1100409000();
    BEGIN
      //*C004759
      DeleteCompleteProject := TRUE;
    END;

    PROCEDURE LookupRecipe@1100525008(iFixed@1100525002 : Boolean);
    VAR
      BaseRecipeList@1100525001 : Page 11125073;
      BaseRecipe@1100525000 : Record 11020581;
    BEGIN
      //DP00381
      BaseRecipeList.LOOKUPMODE(TRUE);
      BaseRecipeList.SetSelection(
        DATABASE::"Budget Line","Project No.","Extension Contract",Adjustment,Element,'','','','','',TRUE,"Line No.");   //C027336
      IF "Recipe Group" <> '' THEN
        BaseRecipe.SETRANGE("Recipe Group","Recipe Group");
      BaseRecipeList.SETTABLEVIEW(BaseRecipe);
      IF BaseRecipeList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        IF iFixed THEN EXIT;
        BaseRecipeList.GETRECORD(BaseRecipe);
        "Recipe Group" := BaseRecipe."Recipe Group";
        VALIDATE(Recipe, BaseRecipe."No.");
      END;
    END;

    PROCEDURE UndoAdvised@1100525009();
    VAR
      PurchaseLine@1100525000 : Record 39;
      BudgetLine@1100525001 : Record 11012001;
    BEGIN
      BudgetLine.SETRANGE("Project No.", "Project No.");
      BudgetLine.SETRANGE(Advised, TRUE);
      BudgetLine.SETFILTER("Purchase Order No.",'<>%1','');
      IF BudgetLine.FINDSET(TRUE,FALSE) THEN BEGIN
        REPEAT
          PurchaseLine.SETRANGE("Document Type", PurchaseLine."Document Type"::Order);
          PurchaseLine.SETRANGE("Document No.",BudgetLine."Purchase Order No.");
          PurchaseLine.SETRANGE("Line No.",BudgetLine."Purchase Order Line No.");
          PurchaseLine.SETRANGE("Job No.",BudgetLine."Project No.");
          IF NOT PurchaseLine.FINDFIRST THEN BEGIN
            BudgetLine.Advised := FALSE;
            BudgetLine."Purchase Order No." := '';
            BudgetLine."Purchase Order Line No." := 0;
            BudgetLine.MODIFY;
          END;
        UNTIL BudgetLine.NEXT = 0;
      END;
    END;

    PROCEDURE GetLineNoStepSize@1100528800(iBudgetLine@1100528800 : Record 11012001;NoOfNewLines@1100528804 : Integer) : Integer;
    VAR
      BudgetLine@1100528801 : Record 11012001;
      FirstLineNo@1100528802 : Integer;
      LastLineNo@1100528803 : Integer;
    BEGIN
      FirstLineNo := iBudgetLine."Line No.";

      BudgetLine.SETRANGE("Project No.",iBudgetLine."Project No.");
      BudgetLine.SETRANGE(Adjustment, iBudgetLine.Adjustment);
      BudgetLine.SETRANGE("Extension Contract", iBudgetLine."Extension Contract");
      BudgetLine.SETRANGE(Option, iBudgetLine.Option);

      IF BudgetLine.GET(
        iBudgetLine."Project No.",
        iBudgetLine.Adjustment,
        iBudgetLine."Extension Contract",
        iBudgetLine.Option,
        iBudgetLine."Line No.") THEN

        IF BudgetLine.NEXT = 0 THEN
          EXIT(10000)
        ELSE
          LastLineNo := BudgetLine."Line No.";

      EXIT(ROUND((((LastLineNo-1) - FirstLineNo)/(NoOfNewLines)), 1, '<'));
    END;

    PROCEDURE GetTotalHoursToBePlanned@1100528401() : Decimal;
    VAR
      Job@1100528400 : Record 11072003;
    BEGIN
      IF NOT Job.GET("Project No.") THEN EXIT(0);

      CALCFIELDS("Total Hours Actual");
      EXIT("Total Hours Actual" - Job.GetBudgetHoursPlannedOnWO);
    END;

    PROCEDURE HandleAssistEditItem@1100528600(IFieldNo@1100528600 : Integer) ORefresh : Boolean;
    VAR
      WebshopItemMgt@1100528602 : Codeunit 11012306;
      RecRef@1100528601 : RecordRef;
    BEGIN
      IF IFieldNo = FIELDNO("Trade Item") THEN BEGIN
        RecRef.GETTABLE(Rec);
        WebshopItemMgt.RunModalDialogForMultipleItems("Vendor (Trade Item)", "Trade Item", RecRef);
        ORefresh := TRUE;
      END;
    END;

    PROCEDURE CheckCurrencyAgreement@1100525013();
    BEGIN
      IF "Currency Code" = '' THEN BEGIN
        "Currency Agreement" := FALSE;
      END ELSE BEGIN
        ProjRec.GET("Project No.");
        IF CurrFieldNo = FIELDNO("Currency Code") THEN //C054524
          "Currency Agreement" := ("Currency Code" <> ProjRec."Currency Code");
      END;
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      //DP00883
      SkipValidateFCY := ISkipValidateFCY;
    END;

    PROCEDURE HandleLookupItem@1100525012(lvFieldNo@1100525004 : Integer) lvRefresh : Boolean;
    VAR
      ItemRec@1100525012 : Record 27;
      BasicItemRec@1100525011 : Record 11012316;
      TradeItemRec@1100525010 : Record 11012317;
      ItemFrm@1100525009 : Page 31;
      BasicItemFrm@1100525008 : Page 11012333;
      TradeItemFrm@1100525007 : Page 11012334;
      lvRefDate@1100525003 : Date;
      lvDiscRef1@1100525002 : Code[20];
      lvDiscRef2@1100525001 : Code[20];
      g_ItemCode@1100525014 : Code[20];
      g_Vendor@1100525013 : Code[20];
      lvTempBudgetLine@1100525006 : TEMPORARY Record 11012001;
    BEGIN
      IF lvFieldNo = FIELDNO("Item No.") THEN BEGIN
        CLEAR(ItemFrm);
        ItemFrm.LOOKUPMODE(TRUE);
        ItemFrm.DetermineInterface(
          DATABASE::"Budget Line","Project No.","Extension Contract",Adjustment,Element,0,'','',"Line No.",'','');
        IF ItemRec.GET("Item No.") THEN
          ItemFrm.SETRECORD(ItemRec);
        IF ItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cost Type", "Cost Type"::Material);
          IF "Cost Type" = "Cost Type"::Material THEN BEGIN
            ItemFrm.GETRECORD(ItemRec);
            VALIDATE("Item No.", ItemRec."No.");
          END;
        END ELSE BEGIN
          lvRefresh := ItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Basic Item") THEN BEGIN
        CLEAR(BasicItemFrm);
        BasicItemFrm.LOOKUPMODE(TRUE);
        BasicItemFrm.SetSelection(DATABASE::"Budget Line",
          "Project No.","Extension Contract",Adjustment,Element,0,'','',"Line No.",'','');

        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
        BasicItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);

        BasicItemRec.InitLookup(BasicItemRec, "Basic Item", Manufacturer);
        BasicItemFrm.SETRECORD(BasicItemRec);

        IF BasicItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cost Type", "Cost Type"::Material);
          IF "Cost Type" = "Cost Type"::Material THEN BEGIN
            BasicItemFrm.GETRECORD(BasicItemRec);
            Manufacturer := BasicItemRec.Manufacturer;
            VALIDATE("Basic Item", BasicItemRec."Product Code");
          END;
        END ELSE BEGIN
          lvRefresh := BasicItemFrm.CheckMultiCopy;
        END;
      END;

      IF lvFieldNo = FIELDNO("Trade Item") THEN BEGIN
        IF "Item No." <> '' THEN BEGIN
          lvTempBudgetLine.COPY(Rec);
          lvTempBudgetLine.VALIDATE("Item No.","Item No.");
          g_ItemCode := lvTempBudgetLine."Trade Item";
          g_Vendor := lvTempBudgetLine."Vendor (Trade Item)";
        END ELSE BEGIN
          g_ItemCode := '';
          g_Vendor := '';
        END;

        CLEAR(TradeItemFrm);
        TradeItemFrm.LOOKUPMODE(TRUE);
        TradeItemFrm.SetSelection(DATABASE::"Budget Line",
          "Project No.", "Extension Contract", Adjustment, Element, 0, '', '', "Line No.", '', '',
          "Vendor (Trade Item)", "Trade Item", Manufacturer, "Basic Item", g_ItemCode, g_Vendor);

        GetReferenceData(lvRefDate, lvDiscRef1, lvDiscRef2);
        TradeItemFrm.SetReference(lvRefDate, lvDiscRef1, lvDiscRef2);

        TradeItemRec.InitLookup(TradeItemRec, "Basic Item", Manufacturer, "Trade Item", "Vendor (Trade Item)");
        TradeItemFrm.SETRECORD(TradeItemRec);

        IF TradeItemFrm.RUNMODAL = ACTION::LookupOK THEN BEGIN
          VALIDATE("Cost Type", "Cost Type"::Material);
          IF "Cost Type" = "Cost Type"::Material THEN BEGIN
            TradeItemFrm.GETRECORD(TradeItemRec);
            Manufacturer := TradeItemRec.Manufacturer;
            "Basic Item" := TradeItemRec."Product Code";
            "Vendor (Trade Item)" := TradeItemRec.Vendor;
            VALIDATE("Trade Item", TradeItemRec."Item Code");
          END;
        END ELSE BEGIN
          lvRefresh := TradeItemFrm.CheckMultiCopy;
        END;
      END;
      EXIT(lvRefresh);
    END;

    PROCEDURE ValidateUnitOfMeasure@1100528402(UnitOfMeasureCode@1100528400 : Code[10]);
    BEGIN
      "Unit of Measure" := UnitOfMeasureCode;
      IF ("Cost Type" = "Cost Type"::Material) THEN
        IF "Unit of Measure" <>  xRec."Unit of Measure" THEN
          CheckItemUnitConversion(Rec, xRec);
      CalcTotals;
    END;

    PROCEDURE GetBudgetPlanningActivitiesForDisplay@1100528604(VAR pBudgetPlanningActivityNo@1100529400 : Code[30];VAR pBudgetPlanningActDescr@1100529401 : Text[50]);
    VAR
      BudgetPlanningActivityRec@1100525000 : Record 11229302;
      NoOfLines@1100525001 : Integer;
    BEGIN
      //UKR-C21177 (BI017)
      BudgetPlanningActivityRec.SETRANGE("Project No.","Project No.");
      BudgetPlanningActivityRec.SETRANGE(Adjustment,Adjustment);
      BudgetPlanningActivityRec.SETRANGE("Extension Contract","Extension Contract");
      BudgetPlanningActivityRec.SETRANGE(Option,Option);
      BudgetPlanningActivityRec.SETRANGE("Budget Line No.","Line No.");

      IF BudgetPlanningActivityRec.ISEMPTY THEN BEGIN
        CLEAR(pBudgetPlanningActivityNo);
        CLEAR(pBudgetPlanningActDescr);
        EXIT;
      END;

      NoOfLines := BudgetPlanningActivityRec.COUNT;
      IF NoOfLines = 1 THEN BEGIN
        BudgetPlanningActivityRec.FINDFIRST;
        pBudgetPlanningActivityNo := BudgetPlanningActivityRec."Project Planning Activity No.";
        BudgetPlanningActivityRec.CALCFIELDS("Project Plan. Act. Description");
        pBudgetPlanningActDescr := BudgetPlanningActivityRec."Project Plan. Act. Description";
      END ELSE BEGIN
        CLEAR(pBudgetPlanningActDescr);
        pBudgetPlanningActivityNo := STRSUBSTNO('[%1]',NoOfLines);
      END;
    END;

    PROCEDURE ReplaceBudgetPlaningActivities@1100529405(VAR pProjectPlanningActivity@1100529400 : Record 11012431) : Boolean;
    VAR
      BudgetPlanningActivityRec@1100525003 : Record 11229302;
      NoOfLines@1100529401 : Integer;
    BEGIN
      //UKR-C21177 (BI017)
      IF NOT pProjectPlanningActivity.FINDSET THEN
        EXIT(FALSE);

      BudgetPlanningActivityRec.SETRANGE("Project No.","Project No.");
      BudgetPlanningActivityRec.SETRANGE(Adjustment,Adjustment);
      BudgetPlanningActivityRec.SETRANGE("Extension Contract","Extension Contract");
      BudgetPlanningActivityRec.SETRANGE(Option,Option);
      BudgetPlanningActivityRec.SETRANGE("Budget Line No.","Line No.");
      NoOfLines := BudgetPlanningActivityRec.COUNT;
      IF NoOfLines > 0 THEN BEGIN
        IF NoOfLines > 1 THEN
          IF NOT CONFIRM(Text028) THEN
            EXIT(FALSE);
        BudgetPlanningActivityRec.DELETEALL;
      END;

      NoOfLines := pProjectPlanningActivity.COUNT;

      REPEAT
        BudgetPlanningActivityRec.INIT;
        BudgetPlanningActivityRec.VALIDATE("Project No.","Project No.");
        BudgetPlanningActivityRec.VALIDATE(Adjustment,Adjustment);
        BudgetPlanningActivityRec.VALIDATE("Extension Contract","Extension Contract");
        BudgetPlanningActivityRec.VALIDATE(Option,Option);
        BudgetPlanningActivityRec.VALIDATE("Budget Line No.","Line No.");
        BudgetPlanningActivityRec.VALIDATE("Project Planning Activity No.",pProjectPlanningActivity."No.");
        IF NoOfLines = 1 THEN
          BudgetPlanningActivityRec.VALIDATE(Percentage, 100);
        BudgetPlanningActivityRec.INSERT;
      UNTIL pProjectPlanningActivity.NEXT = 0;
      EXIT(TRUE);
    END;

    PROCEDURE BudgetPlanningActivityNoOnLookup@1100529406(VAR pProjectPlanningActivity@1100529402 : Record 11012431) : Boolean;
    VAR
      ProjectPlanningActivityList@1100529401 : Page 11072312;
      ProjectPlanningActivity@1100529400 : Record 11012431;
    BEGIN
      //C21177 (BI017)
      CLEAR(pProjectPlanningActivity);
      ProjectPlanningActivity.FILTERGROUP(2);
      ProjectPlanningActivity.SETRANGE("Project No.","Project No.");
      ProjectPlanningActivity.SETRANGE(Type,ProjectPlanningActivity.Type::Activity);
      ProjectPlanningActivity.FILTERGROUP(0);
      ProjectPlanningActivityList.EDITABLE(FALSE);
      ProjectPlanningActivityList.LOOKUPMODE(TRUE);
      ProjectPlanningActivityList.SETTABLEVIEW(ProjectPlanningActivity);
      IF ProjectPlanningActivityList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        ProjectPlanningActivityList.SETSELECTIONFILTER(ProjectPlanningActivity);
        pProjectPlanningActivity.COPY(ProjectPlanningActivity);
        EXIT(TRUE);
      END;
    END;

    PROCEDURE BudgetPlanningActivityNoOnValidate@1100529503(BudgetPlanningActivityNo@1100529401 : Code[30]);
    VAR
      BudgetPlanningActivityRec@1100529400 : Record 11229302;
      ProjectPlanningActivity@1100529402 : Record 11012431;
      PrevBudgetPlanningActivityNo@1100529403 : Code[30];
      PrevBudgetPlanningActivityDesc@1100529404 : Text[50];
      NoOfLines@1100529405 : Integer;
    BEGIN
      //C21177 (BI017)
      GetBudgetPlanningActivitiesForDisplay(PrevBudgetPlanningActivityNo,PrevBudgetPlanningActivityDesc);
      IF PrevBudgetPlanningActivityNo = BudgetPlanningActivityNo THEN
          EXIT;
      IF (PrevBudgetPlanningActivityNo <> '') AND (BudgetPlanningActivityNo = '') THEN BEGIN
        BudgetPlanningActivityRec.SETRANGE("Project No.","Project No.");
        BudgetPlanningActivityRec.SETRANGE(Adjustment,Adjustment);
        BudgetPlanningActivityRec.SETRANGE("Extension Contract","Extension Contract");
        BudgetPlanningActivityRec.SETRANGE(Option,Option);
        BudgetPlanningActivityRec.SETRANGE("Budget Line No.","Line No.");
        NoOfLines := BudgetPlanningActivityRec.COUNT;
        IF NoOfLines = 0 THEN
          EXIT;
        IF NoOfLines > 1 THEN
          IF NOT CONFIRM(STRSUBSTNO(Text029,NoOfLines,BudgetPlanningActivityRec.TABLECAPTION)) THEN
            EXIT;
        BudgetPlanningActivityRec.DELETEALL;
        EXIT;
      END;
      IF NOT ProjectPlanningActivity.GET(BudgetPlanningActivityNo) THEN
        ERROR('');
      ProjectPlanningActivity.SETRECFILTER;
      ReplaceBudgetPlaningActivities(ProjectPlanningActivity);
    END;

    PROCEDURE BudgetPlanningActivityNoOnAssistEdit@1100529504();
    VAR
      BudgetPlanningActivityRec@1100529400 : Record 11229302;
      BudgetPlanningActivitiesPage@1100529401 : Page 11229492;
    BEGIN
      BudgetPlanningActivityRec.FILTERGROUP(2);
      BudgetPlanningActivityRec.SETRANGE("Project No.","Project No.");
      BudgetPlanningActivityRec.SETRANGE(Adjustment,Adjustment);
      BudgetPlanningActivityRec.SETRANGE("Extension Contract","Extension Contract");
      BudgetPlanningActivityRec.SETRANGE(Option,Option);
      BudgetPlanningActivityRec.SETRANGE("Budget Line No.","Line No.");
      BudgetPlanningActivityRec.FILTERGROUP(0);

      BudgetPlanningActivityRec.SETRANGE("Project No.","Project No.");
      BudgetPlanningActivityRec.SETRANGE(Adjustment,Adjustment);
      BudgetPlanningActivityRec.SETRANGE("Extension Contract","Extension Contract");
      BudgetPlanningActivityRec.SETRANGE(Option,Option);
      BudgetPlanningActivityRec.SETRANGE("Budget Line No.","Line No.");

      BudgetPlanningActivitiesPage.SETTABLEVIEW(BudgetPlanningActivityRec);
      BudgetPlanningActivitiesPage.SetCheckAmountOnClose(TRUE);
      BudgetPlanningActivitiesPage.RUNMODAL;
    END;

    PROCEDURE CalcBudgetPlanActivityLines@1100539404();
    VAR
      BudgetPlanningActivity@1100529400 : Record 11229302;
    BEGIN
      //C21177 (BI017)
      BudgetPlanningActivity.SETRANGE("Project No.","Project No.");
      BudgetPlanningActivity.SETRANGE(Adjustment,Adjustment);
      BudgetPlanningActivity.SETRANGE("Extension Contract","Extension Contract");
      BudgetPlanningActivity.SETRANGE(Option,Option);
      BudgetPlanningActivity.SETRANGE("Budget Line No.","Line No.");

      IF BudgetPlanningActivity.ISEMPTY THEN
        EXIT;

      BudgetPlanningActivity.FINDSET;
      REPEAT
        BudgetPlanningActivity.VALIDATE(Percentage);
        BudgetPlanningActivity.MODIFY;
      UNTIL BudgetPlanningActivity.NEXT=0;
    END;

    PROCEDURE ProcessSummarySheet@1100529402(lvBudgetLineRec@1100529401 : Record 11012001;FromDeleteLastTrigger@1100529400 : Boolean);
    BEGIN
      //DP01269
      FillChangedSummarySheet(lvBudgetLineRec, FromDeleteLastTrigger);
      RecalcSummarySheet;
    END;

    PROCEDURE FillChangedSummarySheet@1100529404(lvBudgetLineRec@1100485001 : Record 11012001;FromDeleteLastTrigger@1210190002 : Boolean);
    VAR
      lvBudgSummaryRec@1100485000 : Record 11012064;
      lBudgetAdjustment@1210190000 : Record 11012003;
      lBudgetLineRec@1210190001 : Record 11012001;
    BEGIN
      //DP01269 (moved from page 11012004)
      WITH lvBudgetLineRec DO BEGIN
        lvBudgSummaryRec.SETRANGE("Project No.", "Project No.");
        lvBudgSummaryRec.SETRANGE("Contract No.", "Extension Contract");
        lvBudgSummaryRec.SETRANGE("House Model", '');
        lvBudgSummaryRec.SETRANGE("Main Group", '');
        lvBudgSummaryRec.SETRANGE(Group, '');
        lvBudgSummaryRec.SETRANGE("Sub Group", '');
        lvBudgSummaryRec.SETRANGE(Option, '');
        IF NOT lvBudgSummaryRec.FIND('-') THEN
          EXIT;

        IF NOT FromDeleteLastTrigger THEN BEGIN
          TmpBudgSummaryRec.RESET;
          TmpBudgSummaryRec.SETRANGE("Project No.", "Project No.");
          TmpBudgSummaryRec.SETRANGE("Contract No.", "Extension Contract");
          TmpBudgSummaryRec.SETRANGE("Row No.", Adjustment);    //Summary Adjustments
          IF NOT TmpBudgSummaryRec.FIND('-') THEN BEGIN
            TmpBudgSummaryRec.INIT;
            TmpBudgSummaryRec."Project No." := "Project No.";
            TmpBudgSummaryRec."Contract No." := "Extension Contract";
            TmpBudgSummaryRec."Row No." := Adjustment;  //Summary Adjustments
            TmpBudgSummaryRec.INSERT;
          END;
        END;

        //Summary Adjustment
        //More recent adjustments are re-calculated.
        lBudgetAdjustment.RESET;
        lBudgetAdjustment.SETRANGE("Project No.", "Project No.");
        lBudgetAdjustment.SETFILTER("No.", '%1..', Adjustment);
        IF lBudgetAdjustment.FINDSET THEN BEGIN
          IF lBudgetAdjustment."No." <> Adjustment THEN BEGIN
            IF "Extension Contract" = '' THEN BEGIN
              TmpBudgSummaryRec.RESET;
              TmpBudgSummaryRec.SETRANGE("Project No.", "Project No.");
              TmpBudgSummaryRec.SETRANGE("Contract No.", "Extension Contract");
              TmpBudgSummaryRec.SETRANGE("Row No.", lBudgetAdjustment."No." );
              IF NOT TmpBudgSummaryRec.FIND('-') THEN BEGIN
                TmpBudgSummaryRec.INIT;
                TmpBudgSummaryRec."Project No." := "Project No.";
                TmpBudgSummaryRec."Contract No." := "Extension Contract";
                TmpBudgSummaryRec."Row No." := lBudgetAdjustment."No.";
                TmpBudgSummaryRec.INSERT;
              END;
            END ELSE BEGIN
              lBudgetLineRec.RESET;
              lBudgetLineRec.SETCURRENTKEY("Project No.","Cost Type","Cost Object","Extension Contract Status","Version Date",
                Adjustment,"Extension Contract",Option,"Purchase Action");
              lBudgetLineRec.SETRANGE("Project No.","Project No.");
              lBudgetLineRec.SETFILTER("Extension Contract", "Extension Contract");
              lBudgetLineRec.SETFILTER(Adjustment, lBudgetAdjustment."No.");
              lBudgetLineRec.SETFILTER(Option, '%1','');
              lBudgetLineRec.SETRANGE("Budget Summary Line",FALSE);
              IF lBudgetLineRec.FINDFIRST THEN BEGIN
                TmpBudgSummaryRec.RESET;
                TmpBudgSummaryRec.SETRANGE("Project No.", "Project No.");
                TmpBudgSummaryRec.SETRANGE("Contract No.", "Extension Contract");
                TmpBudgSummaryRec.SETRANGE("Row No.", lBudgetAdjustment."No." );
                IF NOT TmpBudgSummaryRec.FIND('-') THEN BEGIN
                  TmpBudgSummaryRec.INIT;
                  TmpBudgSummaryRec."Project No." := "Project No.";
                  TmpBudgSummaryRec."Contract No." := "Extension Contract";
                  TmpBudgSummaryRec."Row No." := lBudgetAdjustment."No.";
                  TmpBudgSummaryRec.INSERT;
                END;
              END;
            END;
           END;
        END;
        //Summary Adjustment
        TmpBudgSummaryRec.RESET;
      END;
    END;

    PROCEDURE RecalcSummarySheet@1100529403() : Boolean;
    VAR
      lvBudgSummaryRec@1100485000 : Record 11012064;
      CalcSummaryWindow@1100529402 : Dialog;
      StartTime@1100527000 : Time;
      WindowOpened@1100527003 : Boolean;
    BEGIN
      //DP01269 (moved from page 11012004)
      IF NOT TmpBudgSummaryRec.FIND('-') THEN
        EXIT(FALSE);

      StartTime := TIME;
      REPEAT
        IF TIME - StartTime > 2000 THEN BEGIN
          CalcSummaryWindow.OPEN(Text099);
          WindowOpened := TRUE;
        END;

        IF WindowOpened THEN
          CalcSummaryWindow.UPDATE(1, "Project No.");

        lvBudgSummaryRec.SETRANGE("Project No.", TmpBudgSummaryRec."Project No.");
        lvBudgSummaryRec.SETRANGE("Contract No.", TmpBudgSummaryRec."Contract No.");
        lvBudgSummaryRec.SETRANGE("House Model", '');
        lvBudgSummaryRec.SETRANGE("Main Group", '');
        lvBudgSummaryRec.SETRANGE(Group, '');
        lvBudgSummaryRec.SETRANGE("Sub Group", '');
        lvBudgSummaryRec.SETRANGE(Option, '');
        IF lvBudgSummaryRec.FIND('-') THEN BEGIN
          //Summary Adjustments  The Adjustment is stored in the field "Row No."
          lvBudgSummaryRec.ReCalcSummaryLines(TmpBudgSummaryRec."Row No.");
          lvBudgSummaryRec.UpdateBudgetLines(FALSE,TmpBudgSummaryRec."Row No.");
          //Summary Adjustments
        END;
        TmpBudgSummaryRec.DELETE;
      UNTIL TmpBudgSummaryRec.NEXT = 0;

      IF WindowOpened THEN
        CalcSummaryWindow.CLOSE;

      EXIT(TRUE);
    END;

    PROCEDURE AskProcessSummarySheet@1100529500(BudgetLine@1100529500 : Record 11012001);
    VAR
      lvBudgetLine@1100529501 : Record 11012001;
    BEGIN
      //DP01269
      lvBudgetLine.SETFILTER("Project No.", BudgetLine."Project No.");
      lvBudgetLine.SETFILTER("Extension Contract", BudgetLine."Extension Contract");
      lvBudgetLine.SETRANGE("Budget Summary Line", TRUE);
      IF lvBudgetLine.ISEMPTY THEN EXIT;
      //
      IF CONFIRM(Text098,TRUE) THEN BEGIN
        ProcessSummarySheet(BudgetLine,FALSE);
        COMMIT;
      END;
    END;

    LOCAL PROCEDURE GetSubcontractorActivity@1100529900(CalledBy@1100528900 : Integer);
    VAR
      SubcontractingActivityPrice@1100529900 : Record 11229373;
    BEGIN
      //DP01492-2
      IF BudgetFixed(Rec) THEN
        ERROR(Text014);  //C041836

      TESTFIELD("Cost Type", "Cost Type"::Subcontracting);
      SubcontractingActivityPrice.SETRANGE("Subcontracting Activity", "Subcontracting Activity");
      IF CalledBy = FIELDNO("Subcontracting Activity") THEN  //DP01958a
        SubcontractingActivityPrice.SETRANGE("Preferred Subcontractor", TRUE)
      ELSE
        SubcontractingActivityPrice.SETRANGE("Subcontractor No.", Vendor);
      IF SubcontractingActivityPrice.FINDFIRST THEN BEGIN
        IF "Version Date" = 0D THEN
          GetVersionDate;
        VALIDATE("Price (LCY)", SubcontractingActivityPrice.GetPrice("Version Date"));
        IF CalledBy = FIELDNO("Subcontracting Activity") THEN BEGIN  //DP01958a
          SubcontractingActivityPrice.CALCFIELDS("Activity Description");
          Description := SubcontractingActivityPrice."Activity Description";
        END;
        "Unit of Measure" := SubcontractingActivityPrice."Unit of Measure";
        "Cost Object" := SubcontractingActivityPrice."Cost Object";
        Vendor := SubcontractingActivityPrice."Subcontractor No.";
      END;
      IF "Subcontracting in Hours" THEN BEGIN  //C053751
        "Rate Code" := '';
        InitRateRelatedFields;
      END;
    END;

    LOCAL PROCEDURE FillDefaultPlantCompany@1100529601();
    VAR
      PlantMgtCompany@1100529600 : Record 11020586;
      TmpPlantMgtCompany@1100529601 : TEMPORARY Record 11020586;
      NoOfPlantCompanies@1100529602 : Integer;
    BEGIN
      IF "Cost Type" = "Cost Type"::Plant THEN BEGIN
        //DP02115.sn
        ProjRec.GET("Project No.");
        IF ProjRec."Plant Company" <> '' THEN BEGIN
          "Plant Company" := ProjRec."Plant Company";
          EXIT;
        END;
        //DP02115.en
        NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', TRUE);
      END;

      CASE TRUE OF
        NoOfPlantCompanies = 0:
          VALIDATE("Plant Company", '');
        NoOfPlantCompanies = 1:
          BEGIN
            TmpPlantMgtCompany.FINDFIRST;
            IF TmpPlantMgtCompany."Plant Company" = COMPANYNAME THEN
              VALIDATE("Plant Company", '')
            ELSE
              VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
          END;
        NoOfPlantCompanies > 1:
          BEGIN
            TmpPlantMgtCompany.SETRANGE(Default, TRUE);
            IF NOT TmpPlantMgtCompany.FINDFIRST THEN
              VALIDATE("Plant Company", '')
            ELSE BEGIN
              IF TmpPlantMgtCompany."Plant Company" = COMPANYNAME THEN
                VALIDATE("Plant Company", '')
              ELSE
                VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE FillDefaultPlantLocation@1100529602();
    VAR
      PlantLocation@1100529600 : Record 11012554;
      PlantLocCompany@1100529601 : Text;
    BEGIN
      IF ("Cost Type" <> "Cost Type"::Plant) OR ("Project No." = '') THEN BEGIN
        VALIDATE("Plant Location", '');
        EXIT;
      END;

      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.");
      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantLocCompany := COMPANYNAME;
        PlantLocation.CHANGECOMPANY("Plant Company");
      END;
      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.SETRANGE("Company Name", PlantLocCompany);
      PlantLocation.SETRANGE("Project No.", "Project No.");
      PlantLocation.SETRANGE( "Service Order No.", '');
      IF PlantLocation.FINDFIRST THEN
        IF PlantLocation.NEXT = 0 THEN
          VALIDATE("Plant Location", PlantLocation.Code);
    END;

    PROCEDURE LookupPlantCompany@1100529603();
    VAR
      PlantMgtCompany@1100529600 : Record 11020586;
      TmpPlantMgtCompany@1100529601 : TEMPORARY Record 11020586;
      NoOfPlantCompanies@1100529602 : Integer;
    BEGIN
      IF ("Cost Type" <> "Cost Type"::Plant) OR ("Project No." = '') THEN
        EXIT;

      PlantMgtCompany.GetPlantCompany(TRUE, NoOfPlantCompanies, '');
      NoOfPlantCompanies := PlantMgtCompany.GetPlantCompaniesForProject("Project No.", TmpPlantMgtCompany, '', FALSE);

      IF NoOfPlantCompanies = 0 THEN BEGIN
        PlantMgtCompany."Plant Company" := "Plant Company";
        IF PlantMgtCompany."Plant Company" = '' THEN
          PlantMgtCompany."Plant Company" := COMPANYNAME;
        PAGE.RUNMODAL(0, PlantMgtCompany);
      END ELSE BEGIN
        TmpPlantMgtCompany."Plant Company" := "Plant Company";
        IF TmpPlantMgtCompany."Plant Company" = '' THEN
          TmpPlantMgtCompany."Plant Company" := COMPANYNAME;
        IF BudgetFixed(Rec) THEN
          PAGE.RUNMODAL(0, TmpPlantMgtCompany)
        ELSE BEGIN
          IF PAGE.RUNMODAL(0, TmpPlantMgtCompany) = ACTION::LookupOK THEN
            IF TmpPlantMgtCompany."Plant Company" <> "Plant Company" THEN
              VALIDATE("Plant Company", TmpPlantMgtCompany."Plant Company");
        END;
      END;
    END;

    PROCEDURE LookupPlantLocation@1100529604();
    VAR
      PlantLocation@1100529600 : Record 11012554;
      PlantLocCompany@1100529602 : Text;
    BEGIN
      IF ("Cost Type" <> "Cost Type"::Plant) OR ("Project No." = '') THEN
        EXIT;

      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantLocCompany := COMPANYNAME;
        PlantLocation.CHANGECOMPANY("Plant Company");
      END;
      PlantLocation.SETCURRENTKEY("Company Name", "Project No.", "Service Order No.", "Employee No.");
      PlantLocation.FILTERGROUP(9);
      PlantLocation.SETRANGE(Depot, FALSE);
      PlantLocation.SETRANGE("Company Name", PlantLocCompany);
      PlantLocation.SETRANGE("Project No.", "Project No.");
      PlantLocation.SETRANGE( "Service Order No.", '');
      PlantLocation.FILTERGROUP(0);
      PlantLocation.SETRANGE(Code, "Plant Location");
      IF NOT PlantLocation.FINDFIRST THEN BEGIN
        PlantLocation."Company Name" := PlantLocCompany;
        PlantLocation."Project No." := "Project No.";
        PlantLocation."Service Order No." := '';
      END;
      PlantLocation.SETRANGE(Code);
      IF BudgetFixed(Rec) THEN
        PAGE.RUNMODAL(0, PlantLocation)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantLocation) = ACTION::LookupOK THEN
          IF PlantLocation.Code <> "Plant Location" THEN
            VALIDATE("Plant Location", PlantLocation.Code);
      END;
    END;

    PROCEDURE LookupPlantType@1100529605();
    VAR
      PlantType@1100529600 : Record 11012551;
    BEGIN
      IF ("Cost Type" <> "Cost Type"::Plant) OR ("Project No." = '') THEN
        EXIT;

      IF ("Plant Company" <> '') AND ("Plant Company" <> COMPANYNAME) THEN
        PlantType.CHANGECOMPANY("Plant Company");
      PlantType.Code := "Plant Type";
      IF BudgetFixed(Rec) THEN
        PAGE.RUNMODAL(0, PlantType)
      ELSE BEGIN
        IF PAGE.RUNMODAL(0, PlantType) = ACTION::LookupOK THEN
          IF PlantType.Code <> "Plant Type" THEN
            VALIDATE("Plant Type", PlantType.Code);
      END;
    END;

    PROCEDURE CompressBudgetLines@1100528403();
    VAR
      TempCompressedBudgetLine@1100528401 : TEMPORARY Record 11012001;
      Job@1100528402 : Record 11072003;
      CompressBudgetLines@1100528400 : Page 11129893;
    BEGIN
      IF COUNT < 2 THEN
        EXIT;

      FINDSET;
      Job.GET("Project No.");
      Job.TESTFIELD("Budget Fixed", FALSE);

      InitTempCompressedBudgetLine(
        "Project No.", "Line No.", "Cost Type", "Cost Object", Element, TempCompressedBudgetLine);
      REPEAT
        CheckIfBudgetLineCanBeAddedToCompressedBudgetLine(TempCompressedBudgetLine);
        TempCompressedBudgetLine.VALIDATE("Amount (LCY)", TempCompressedBudgetLine."Amount (LCY)" + "Amount (LCY)");
      UNTIL NEXT = 0;

      CompressBudgetLines.SetTempCompressedBudgetLine(TempCompressedBudgetLine);
      IF CompressBudgetLines.RUNMODAL = ACTION::OK THEN BEGIN
        DELETEALL(TRUE);
        CompressBudgetLines.GetUpdatedTempCompressedBudgetLine(TempCompressedBudgetLine);
        Rec := TempCompressedBudgetLine;
        INSERT(TRUE);
      END;
    END;

    PROCEDURE InitTempCompressedBudgetLine@1100528408(ProjectNo@1100528401 : Code[20];LineNo@1100528402 : Integer;CostType@1100528405 : Integer;CostObject@1100528403 : Code[20];ElementCode@1100528404 : Code[20];VAR TempCompressedBudgetLine@1100528400 : TEMPORARY Record 11012001);
    BEGIN
      TempCompressedBudgetLine.VALIDATE("Project No.", ProjectNo);
      TempCompressedBudgetLine.VALIDATE("Line No.", LineNo);
      TempCompressedBudgetLine.VALIDATE("Cost Type", CostType);
      TempCompressedBudgetLine.VALIDATE("Cost Object", CostObject);
      TempCompressedBudgetLine.VALIDATE(Element, ElementCode);
      TempCompressedBudgetLine.VALIDATE(Quantity, 1);
      IF ("Cost Type" = "Cost Type"::Labor) OR ("Cost Type" = "Cost Type"::Plant) THEN
        TempCompressedBudgetLine.VALIDATE(Norm, 1);
      TempCompressedBudgetLine.VALIDATE("Rate Code", '');
    END;

    LOCAL PROCEDURE CheckIfBudgetLineCanBeAddedToCompressedBudgetLine@1100528411(TempCompressedBudgetLine@1100528400 : TEMPORARY Record 11012001);
    BEGIN
      TESTFIELD("Project No.", TempCompressedBudgetLine."Project No.");
      TESTFIELD(Adjustment, '');
      TESTFIELD("Extension Contract", '');
      TESTFIELD(Option, '');
      TESTFIELD("Cost Type", TempCompressedBudgetLine."Cost Type");
      CheckIfChangingIsAllowedInCurrentElementPhase(Rec);
    END;

    PROCEDURE CalculateQuantity@11012000();
    VAR
      lv1@1210190000 : Decimal;
      lv2@1210190001 : Decimal;
      lv3@1210190002 : Decimal;
    BEGIN
      lv1 := Length;
      lv2 := Width;
      lv3 := Height;

      IF Length = 0 THEN lv1 := 1;
      IF Width = 0 THEN lv2 := 1;
      IF Height = 0 THEN lv3 := 1;

      VALIDATE(Quantity, lv1 * lv2 * lv3);
    END;

    PROCEDURE DeterminePlantPrice@1100485011();
    VAR
      SearchRateCu@1100485000 : Codeunit 11012567;
      RefDate@1100485001 : Date;
      RentalType@1100525000 : Option;
      PlantTypeRec@1100525001 : Record 11012551;
      PlantCompany@1100528500 : Text;
      PlantLocation@1100528501 : Text;
    BEGIN
      //DP02115
      IF ("Plant Type" = '') OR "Price Agreement" THEN
        EXIT;

      "Gross Price (LCY)" := 0;
      "Discount %" := 0;

      ProjRec.GET("Project No.");
      RefDate := TODAY;

      RentalType := -1;  //0=rental, 1=sales, 2=buy-back, 3= hours
      IF "Plant Company" <> '' THEN
        PlantCompany := "Plant Company"
      ELSE
        PlantCompany := ProjRec."Plant Company";

      IF "Plant Location" <> '' THEN
        PlantLocation := "Plant Location"
      ELSE
        PlantLocation := ProjRec."Plant Location";
      IF PlantCompany <> '' THEN
        PlantTypeRec.CHANGECOMPANY(PlantCompany);
      PlantTypeRec.GET("Plant Type");
      IF "Plant Rates in Hours" THEN BEGIN
        "Rate Code" := '';
        InitRateRelatedFields;
        IF (PlantTypeRec."Rental Type" <> PlantTypeRec."Rental Type"::"Sales/Buy Back") THEN
          RentalType := 3;
      END;

      VALIDATE("Price (LCY)", SearchRateCu.CostRateFromEstimate("Plant Type",'', PlantLocation,RefDate,PlantCompany,RentalType,"Plant Price Type"));
      VALIDATE("Gross Price (LCY)","Price (LCY)");
    END;

    PROCEDURE CheckIfChangingIsAllowedInCurrentElementPhase@1100528406(BudgetLine@1100528401 : Record 11012001);
    VAR
      ProjectElement@1100528400 : Record 11012010;
    BEGIN
      IF DeleteCompleteProject THEN
        EXIT;

      IF (BudgetLine."Project No." <> '') AND
         (BudgetLine.Element <> '')
      THEN
        IF ProjectElement.GET(BudgetLine."Project No.", BudgetLine.Element) THEN
          IF BudgetLine."Element Phase Code" <> '' THEN
            ProjectElement.TESTFIELD("Phase Code", BudgetLine."Element Phase Code");
    END;

    PROCEDURE UpdateAdjustmentByPhaseChange@1100528407();
    VAR
      JobsSetup@1100528400 : Record 315;
      BudgetAdjustment@1100528401 : Record 11012003;
    BEGIN
      IF NOT JobsSetup.GET THEN
        EXIT;
      IF JobsSetup."El. Phase Adjustment Type Code" = '' THEN
        EXIT;
      IF NOT BudgetAdjustment.GET("Project No.", Adjustment) THEN
        EXIT;

      IF JobsSetup."El. Phase Adjustment Type Code" = BudgetAdjustment."Budget Adjustment Type" THEN
        "Adjustment by Phase Change" := TRUE;
    END;

    PROCEDURE InitRateRelatedFields@1100525033();
    BEGIN
      //C053751
      "Rate (LCY)" := 0;
      "Rate (FCY)" := 0;
      "Wage Component" := '';
    END;

    PROCEDURE InitNormRelatedFields@1100525032(iValue@1100528900 : Decimal);
    BEGIN
      //C053751: 0=clear; 1=init (switch plant/norm in hours should be budget neutral)
      Norm := iValue;
      "Production Rate" := iValue;
    END;

    LOCAL PROCEDURE DeleteTenderParagraph@1100528900();
    VAR
      ProjectTenderParagraph@1100528900 : Record 11012263;
      BudgetLine@1100528901 : Record 11012001;
    BEGIN
      //C056424: repair badfix C049796
      IF "Tender Paragraph" = '' THEN EXIT;

      BudgetLine.SETRANGE("Project No.", "Project No.");
      BudgetLine.SETRANGE("Tender Paragraph", "Tender Paragraph");
      BudgetLine.SETFILTER("Line No.", '<>%1', "Line No.");
      IF NOT BudgetLine.ISEMPTY THEN EXIT;

      ProjectTenderParagraph.SETRANGE("Project No.", "Project No.");
      ProjectTenderParagraph.SETRANGE("Tender Paragraph", "Tender Paragraph");
      ProjectTenderParagraph.DELETEALL(TRUE);  //incl. delete paragraph part and text
    END;

    PROCEDURE GetVendorPrice@1100528901(iVendor@1100525000 : Code[20];iPrice@1100525004 : Decimal;VAR oCurrency@1100525002 : Code[20]) oPrice : Decimal;
    VAR
      VendorRec@1100525003 : Record 23;
      ProjRec@1100528900 : Record 11072003;
      CurrExchRate@1100525006 : Record 330;
      CurrFactor@1100525005 : Decimal;
      lvText000@1100525001 : TextConst 'ENU=%1 not found;SVE=%1 hittades inte';
      RefDate@1100525007 : Date;
    BEGIN
      //C055996
      oCurrency := '';
      IF VendorRec.GET(iVendor) THEN BEGIN
        oCurrency := VendorRec."Currency Code";
        RefDate := WORKDATE;
        //Type: 0=General, 1=Project, 2=Estimate
        IF ProjRec.GET("Project No.") THEN BEGIN
          IF ProjRec."Reference Date (Currency)" <> 0D THEN
            RefDate := ProjRec."Reference Date (Currency)";
          CurrFactor := CurrExchRate.ExchangeRate(1, "Project No.", RefDate, oCurrency, FALSE);
        END ELSE BEGIN
          CurrFactor := CurrExchRate.ExchangeRate(0, '', RefDate, oCurrency, FALSE);
        END;
        IF CurrFactor = 0 THEN
          ERROR(lvText000, CurrExchRate.TABLECAPTION);
      END;
      IF oCurrency = '' THEN
        oPrice := iPrice
      ELSE
        oPrice := iPrice * CurrFactor;

      EXIT(oPrice);
    END;

    LOCAL PROCEDURE CheckCombinationOfCostTypeAndNorm@1100527300();
    BEGIN
      IF ("Surcharge %" = 0) AND ("Surcharge Price (LCY)" = 0) THEN
        EXIT;

      IF ("Cost Type" = "Cost Type"::Labor) OR (("Cost Type" IN ["Cost Type"::Subcontracting, "Cost Type"::Plant]) AND (Norm <> 0)) THEN
        ERROR(Text101, FIELDCAPTION("Cost Type"), FIELDCAPTION(Norm), FIELDCAPTION("Surcharge %"), FIELDCAPTION("Surcharge Price (LCY)"));
    END;

    BEGIN
    {
      4PS, 07-09-11, call28927. Index "Project No.,Cost Type,Adjustment,Extension Contract,Option,Line No."
        MaintainSQLIndex and MaintainSIFTIndex changed from No to Yes.

      4PS, 08-02-2012, call 32744, SQL Index added because of performance problem in GPP
                                   (index:Project Planning Activity No.,Cost Type,Cost Object,Amount)

      DP00886: db, 11-03-16
      - local functions for ExchangeAmt (introduced by DP00883) moved to ProjectCurrencyExchangeRate.

      4PS 27-07-2016 UKR-C21177 OTRO: Link 1 budget line to mult planning act (DP01143 BI017)
      4PS 05-01-2017 UKR-C26352 KD: Foreign currency in the forecast (BI042) - Added key "Main Project No.,Project No.,Element,Cost Type,Cost Object,Version Date,Extension Contract,Currency Code"
      180206 ITERO.SB REK-055 Added fields "Last Date Modified","Modified by"
      190404 ORANGO.SB Feature #22822 BYGG001_7 Added field New prognosis amount
      190610 ORANGO.EE BYGG Added field "Position"
    }
    END.
  }
}

