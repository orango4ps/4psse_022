OBJECT Codeunit 11012232 Estimate Plant Mgt
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS14.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      TmpCostLine@1100525000 : TEMPORARY Record 11012591;
      Text000@1100525001 : TextConst 'DEU=Es gibt nicht genÅgend Raum damit alle Zeilen eingefÅgt werden kînnen.;ENU=There is not enough space to insert all lines.;NLD=Er is niet voldoende ruimte om alle regels in te voegen.;NOR=Det er ikke nok plass til Ü sette inn alle radene.;SVE=Det finns inte tillrÑckligt med utrymme fîr att infoga alla rader.';
      TmpSetLine@1100525006 : TEMPORARY Record 11012588;
      TmpPlantNeed@1100525011 : TEMPORARY Record 11012579;
      TmpPlantNeedEstKey@1100529001 : TEMPORARY Record 11020579;
      EstimateSetup@1100525028 : Record 11012150;
      DimManagement@1100525005 : Codeunit 408;
      Window@1100525015 : Dialog;
      WindowLastUpdated@1100525012 : Time;
      QuantityRatio@1100525007 : Decimal;
      NewHeadLineNo@1100525023 : Integer;
      NextLineNo@1100525004 : Integer;
      LineSpacing@1100525003 : Integer;
      Counter@1100525014 : Integer;
      MaxCounter@1100525013 : Integer;
      MakeUpdateRequired@1100525002 : Boolean;
      Text001@1100525008 : TextConst 'DEU=%1 %2 ist bereits in %3 %4 Åbertragen.\Mîchten Sie die vorhandenen Zeilen ersetzen?;ENU=%1 %2 is already transferred to %3 %4.\Do you want to replace the existing lines?;NLD=%1 %2 is al overgezet naar %3 %4.\Wilt u de bestaande regels vervangen?;NOR=%1 %2 er allerede overfõrt til %3 %4.\Vil du erstatte de eksisterende radene?;SVE=%1 %2 har redan îverfîrts till %3 %4.\Vill du ersÑtta de befintliga raderna?';
      Text002@1100525009 : TextConst 'DEU=Es wurden keine Zeile Åbertragen.;ENU=No lines transferred.;NLD=Er zijn geen regels overgezet.;NOR=Ingen rader overfõrt.;SVE=Inga rader har îverfîrts.';
      Text003@1100525010 : TextConst 'DEU=%1 %2 wurde bereits in %3 %4 Åbertragen und es wurden bereits %3 Zeilen verarbeitet.;ENU=%1 %2 is already transferred to %3 %4, and some of the %3 lines are already processed.;NLD=%1 %2 is al overgezet naar %3 %4, en er zijn al %3 regels verwerkt.;NOR=%1 %2 er allerede overfõrt til %3 %4, og noen av radene %3 er allerede behandlet.;SVE=%1 %2 har redan îverfîrts till %3 %4, och vissa av raderna %3 Ñr redan behandlade.';
      Text004@1100525016 : TextConst 'DEU=Mîchten Sie %1 Zeilen erstellen?;ENU=Do you want to create %1 lines?;NLD=Wilt u %1 regels aanmaken?;NOR=Vil du opprette %1 rader?;SVE=Vill du skapa %1 rader?';
      Text005@1100525017 : TextConst 'DEU=Lesen Kalkulationszeilen    @3@@@@@@@@@@@@@\;ENU=Reading Estimate lines     @3@@@@@@@@@@@@@\;NLD=Lezen Calculatieregels       @3@@@@@@@@@@@@@\;NOR=Leser kalkylerader     @3@@@@@@@@@@@@@\;SVE=LÑser kalkylrader     @3@@@@@@@@@@@@@\';
      Text006@1100525018 : TextConst 'DEU=Lesen Rezeptzeilen           @4@@@@@@@@@@@@@\;ENU=Reading Recipe lines     @4@@@@@@@@@@@@@\;NLD=Lezen Receptregels          @4@@@@@@@@@@@@@\;NOR=Leser marader     @4@@@@@@@@@@@@@\;SVE=LÑser mallrader     @4@@@@@@@@@@@@@\';
      Text007@1100525019 : TextConst 'DEU=Erstellen Werkzeugbedarf @5@@@@@@@@@@@@@;ENU=Writing Plant Need lines @5@@@@@@@@@@@@@;NLD=Aanmaken Materieelbehoefte @5@@@@@@@@@@@@@;NOR=Skriver maskinbehovsrader @5@@@@@@@@@@@@@;SVE=Skriver Maskinsbehovsrader @5@@@@@@@@@@@@@';
      Text008@1100525021 : TextConst 'DEU=Summe Gewicht: %2\;ENU=Total Weight: %2\;NLD=Totaal Gewicht: %2\;NOR=Total Vekt: %2\;SVE=Totalvikt: %2\';
      Text009@1100525020 : TextConst 'DEU=Endsumme ZurÅckkauf: %3;ENU=Total Buy Back: %3;NLD=Totaal Terugkoop: %3;NOR=Tilbakekjõp totalt: %3;SVE=èterkîp totalt: %3';
      Text010@1100525022 : TextConst 'DEU=Endsummen berechnen;ENU=Calculating totals...;NLD=Totalen berekenen;NOR=Beregner totaler...;SVE=BerÑknar totaltˇ...';
      Text011@1100525025 : TextConst 'DEU=Angewend. Filter:\%1 \ \;ENU=Applied filter:\%1 \ \;NLD=Toegepast filter:\%1 \ \;NOR=Anvendt filter:\%1 \ \;SVE=TillÑmpat filter:\%1 \ \';
      Text012@1100525024 : TextConst 'DEU=Kalkulation,Teilkalkulation;ENU=Estimate,Part of Estimate;NLD=Calculatie,Deelcalculatie;NOR=Kalkyle,Del av Kalkyle;SVE=Kalkyl,Del av kalkyl';
      Text013@1100525026 : TextConst 'DEU=Mîchten Sie Standardartikel und Kostenzeilen hinzufÅgen?;ENU=Do you want to add standard Item and Cost Lines?;NLD=Wilt u standaard artikelen en kostenregels toevoegen?;NOR=Vil du legge til Standardartikkels- og Kostrader?;SVE=Vill du lÑgga till standardartikels- och kostnadsrader?';
      Text014@1100525027 : TextConst 'DEU=Mîchten Sie %1s auseinanderziehen?;ENU=Do you want to explode %1s?;NLD=Wilt u %1s exploderen?;NOR=Vil du utfolde %1?;SVE=Vill du expandera %1s?';
      EstimateSetupRead@1100525029 : Boolean;
      EstLine@1100528901 : Record 11072072;
      EstRcpLine@1100528900 : Record 11072075;
      BaseRcpLine@1100528902 : Record 11020582;
      Estimate@1100529400 : Record 11012151;
      PlantCompany@1100529401 : Text[50];
      DisableTotal@1100525030 : Boolean;
      ActivateTotal@1100525031 : Boolean;
      IgnoreQuestion@1100528500 : Boolean;
      NumCostLine@1100528903 : Integer;

    PROCEDURE CalcBuyBackRates@1100525005(ItemNo@1100525000 : Code[20];PlantTypeCode@1100525007 : Code[20];EstimateNo@1100529400 : Code[20];FieldTriggered@1100525001 : 'Sales,BuyBack,Percentage';SalesRate@1100525004 : Decimal;VAR BuyBackRate@1100525005 : Decimal;VAR BuyBackPerc@1100525006 : Decimal);
    VAR
      Item2@1100525002 : Record 27;
      PlantType2@1100525003 : Record 11012551;
      Estimate2@1100529401 : Record 11012151;
    BEGIN
      IF ItemNo <> '' THEN BEGIN
        Item2.GET(ItemNo);
        IF (BuyBackRate <> 0) OR (BuyBackPerc <> 0) THEN
          Item2.TESTFIELD(Item2."Sales/Buy-Back Item (Plant)");
      END;

      IF PlantTypeCode <> '' THEN BEGIN
        //DP01208.sn
        IF EstimateNo <> '' THEN BEGIN
          IF NOT Estimate2.GET(EstimateNo) THEN Estimate2.INIT;
          IF Estimate2."Plant Company" <> '' THEN
            PlantType2.CHANGECOMPANY(Estimate2."Plant Company");
        END ELSE BEGIN
          //DP01407.sn
          EstimateSetup.GET;
          IF EstimateSetup."Plant Company" <> '' THEN
            PlantType2.CHANGECOMPANY(EstimateSetup."Plant Company");
          //DP01407.en
        END;
        //DP01208.en
        PlantType2.GET(PlantTypeCode);
        IF (BuyBackRate <> 0) OR (BuyBackPerc <> 0) THEN
          PlantType2.TESTFIELD(PlantType2."Rental Type",PlantType2."Rental Type"::"Sales/Buy Back");
      END;

      CASE FieldTriggered OF
        FieldTriggered::BuyBack:
          IF SalesRate <> 0 THEN
            BuyBackPerc := ROUND(BuyBackRate / SalesRate * 100, 0.00001)
          ELSE
            BuyBackPerc := 0;
        FieldTriggered::Sales,FieldTriggered::Percentage:
          BuyBackRate := ROUND(SalesRate * BuyBackPerc / 100,PriceRoundingPrecision);
      END;
    END;

    PROCEDURE PriceRoundingPrecision@1100525006() : Decimal;
    VAR
      GLSetup@1100525000 : Record 98;
    BEGIN
      GLSetup.GET;
      GLSetup.TESTFIELD("Unit-Amount Rounding Precision");
      EXIT(GLSetup."Unit-Amount Rounding Precision");
    END;

    PROCEDURE ConvPeriodToTimesPerYear@1100525008(PeriodFormula@1100525000 : DateFormula) : Decimal;
    VAR
      PeriodFormText@1100525001 : Text[30];
      NumberPart@1100485001 : Decimal;
      PeriodPart@1100485002 : Text[30];
    BEGIN
      PeriodFormText := FORMAT(PeriodFormula);
      IF PeriodFormText = '' THEN
        EXIT(1);

      PeriodPart := DELCHR(PeriodFormText,'=','0123456789');
      IF (PeriodPart = '') THEN
        EXIT(0);

      EVALUATE(NumberPart, COPYSTR(PeriodFormText,1,STRPOS(PeriodFormText,PeriodPart) - 1));
      IF NumberPart = 0 THEN
        EXIT(0);

      CASE PeriodPart OF
        'D': EXIT(365/NumberPart);
        'W': EXIT(52/NumberPart);
        'M': EXIT(12/NumberPart);
      //'K','Q': EXIT(4/NumberPart);
      //'J','Y': EXIT(1/NumberPart);
      END;
    END;

    PROCEDURE ConvPlantCalcPeriod@1100525010(PeriodFormula@1100525000 : DateFormula;PlantPriceType@1100525001 : ' ,Day,Week,,Month') : Decimal;
    VAR
      Result@1100525002 : Decimal;
      PeriodFormText@1210190001 : Text[30];
      PeriodPart@1210190000 : Text[30];
    BEGIN
      IF FORMAT(PeriodFormula) = '' THEN
        EXIT(1);

      PeriodPart := '';
      PeriodFormText := FORMAT(PeriodFormula);
      PeriodPart := DELCHR(PeriodFormText,'=','0123456789');

      CASE PlantPriceType OF
        PlantPriceType::Day:
          BEGIN
            IF PeriodPart = 'W' THEN
              Result := 364/ConvPeriodToTimesPerYear(PeriodFormula)   //Call 33688, ivm afronding dagen bij weekformule
            ELSE
              Result := 365/ConvPeriodToTimesPerYear(PeriodFormula);
          END;
        PlantPriceType::Week:  Result := 52/ConvPeriodToTimesPerYear(PeriodFormula);
        PlantPriceType::Month:  Result := 12/ConvPeriodToTimesPerYear(PeriodFormula);
        ELSE
          EXIT(1);
      END;

      //to avoid e.g. rental period of 7.02 days when converted from week to days
      IF Result > 10 THEN EXIT(ROUND(Result,1));
      IF Result > 5 THEN EXIT(ROUND(Result,0.5));
      IF Result > 1 THEN EXIT(ROUND(Result,0.1));
      IF Result > 0.5 THEN EXIT(ROUND(Result,0.05));
      //everything else should be rounded to 0.01
      IF Result > 0.005 THEN EXIT(ROUND(Result,0.01));
      //and below rounding threshold round up to 0.01
      IF Result > 0 THEN EXIT(ROUND(Result,0.01,'>'));
    END;

    PROCEDURE CostTypeEstLineIsMat@1100525013(EstimateLine@1100525001 : Record 11072072) : Boolean;
    BEGIN
      WITH EstimateLine DO BEGIN
        EXIT(
          ("Item No." + "Basic Item" + "Trade Item" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Object Price" <>''));
      END;
    END;

    PROCEDURE CostTypeEstLineRAWIsMat@1100525032(EstimateLineRAW@1100525000 : Record 11125698) : Boolean;
    BEGIN
      WITH EstimateLineRAW DO BEGIN
        EXIT(
          ("Item No." + "Basic Item" + "Trade Item" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Type" = "Cost Type"::Material));  //DP01676
      END;
    END;

    PROCEDURE CostTypeEstCompositionIsMat@1100526000(EstimateComposition@1100525001 : Record 11020458) : Boolean;
    BEGIN
      WITH EstimateComposition DO BEGIN
        EXIT(
          ("Item No." + "Basic Item" + "Trade Item" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Type (Price)" = EstimateComposition."Cost Type (Price)"::Material));
      END;
    END;

    PROCEDURE CostTypeRcpLineIsMat@1100525022(RecipeLine@1100525001 : Record 11072075) : Boolean;
    BEGIN
      WITH RecipeLine DO BEGIN
        EXIT(
          ("Item No." + "Basic Item" + "Trade Item" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Object Price" <>''));
      END;
    END;

    PROCEDURE CostTypeEstLineIsPlant@1100525014(EstimateLine@1100525001 : Record 11072072) : Boolean;
    BEGIN
      WITH EstimateLine DO BEGIN
        EXIT(
          ("Plant Type" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Object Price" <> ''));
      END;
    END;

    PROCEDURE CostTypeEstLineRAWIsPlant@1100525033(EstimateLineRAW@1100525000 : Record 11125698) : Boolean;
    BEGIN
      WITH EstimateLineRAW DO BEGIN
        EXIT(
          ("Plant Type" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Type" = "Cost Type"::Plant));  //DP01676
      END;
    END;

    PROCEDURE CostTypeEstCompositionIsPlant@1100526001(EstimateComposition@1100525001 : Record 11020458) : Boolean;
    BEGIN
      WITH EstimateComposition DO BEGIN
        EXIT(
          ("Plant Type" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Type (Price)" = "Cost Type (Price)"::Plant));
      END;
    END;

    PROCEDURE CostTypeRcpLineIsPlant@1100525024(RecipeLine@1100525000 : Record 11072075) : Boolean;
    BEGIN
      WITH RecipeLine DO BEGIN
        EXIT(
          ("Plant Type" <> '') OR
          ("Net Cost Price" <> 0) OR
          ("Cost Object Price" <> ''));
      END;
    END;

    PROCEDURE CostTypeEstLineRAWIsSubc@1100525040(EstimateLineRAW@1100525000 : Record 11125698) : Boolean;
    BEGIN
      //C036706
      WITH EstimateLineRAW DO BEGIN
        EXIT(
          ("Net Cost Price" <> 0) OR
          ("Cost Type" = "Cost Type"::Subcontracting));  //DP01676
      END;
    END;

    PROCEDURE CostTypeEstLineRAWIsSundry@1100525041(EstimateLineRAW@1100525000 : Record 11125698) : Boolean;
    BEGIN
      //C036706
      WITH EstimateLineRAW DO BEGIN
        EXIT(
          ("Net Cost Price" <> 0) OR
          ("Cost Type" = "Cost Type"::Sundry));  //DP01676
      END;
    END;

    PROCEDURE InsPltCostItmLinesToEstLine@1100525031(VAR Rec2@1100525002 : Record 11072072) : Boolean;
    BEGIN
      IF Rec2.FINDSET THEN BEGIN
        PlantCompany := GetDefaultPlantCompany(DATABASE::Estimate, Rec2."Estimate No.");  //DP01208 (db, 27-10-16)
        IF Rec2.COUNT = 1 THEN
          IF NOT PlantCostItmLnsExist(Rec2."Plant Type") THEN
            EXIT(FALSE);

        IF IgnoreQuestion = FALSE THEN   //C051896
          IF NOT CONFIRM(Text013,TRUE) THEN
            EXIT(FALSE);

        REPEAT
          IF CheckIfPltCostItmLnsForEstLine(Rec2) THEN
            TmpBuffersInsertToEstLine(Rec2);
        UNTIL Rec2.NEXT = 0;

        EXIT(MakeUpdate);
      END;
    END;

    PROCEDURE InsPltCostItmLinesToEstRcpLine@1100525028(VAR Rec2@1100525002 : Record 11072075) : Boolean;
    BEGIN
      IF Rec2.FINDSET THEN BEGIN
        PlantCompany := GetDefaultPlantCompany(DATABASE::Estimate, Rec2."Estimate No.");  //DP01208 (db, 27-10-16)
        IF Rec2.COUNT = 1 THEN
          IF NOT PlantCostItmLnsExist(Rec2."Plant Type") THEN
            EXIT(FALSE);

        IF IgnoreQuestion = FALSE THEN   //C051896
          IF NOT CONFIRM(Text013,TRUE) THEN
            EXIT;

        REPEAT
          IF CheckIfPltCostItmLnsForRcpLine(Rec2) THEN
            TmpBuffersInsertToEstRcpLine(Rec2);
        UNTIL Rec2.NEXT = 0;

        EXIT(MakeUpdate);
      END;
    END;

    PROCEDURE InsPltCostItmLinesToBasRcpLine@1100528923(VAR Rec2@1100528900 : Record 11020582) : Boolean;
    VAR
      PlantCompany@1100529400 : Text[50];
    BEGIN
      //DP00381
      IF Rec2.FINDSET THEN BEGIN
        PlantCompany := GetDefaultPlantCompany(DATABASE::"Base Recipe", '');  //DP01208 (db, 27-10-16)
        IF Rec2.COUNT = 1 THEN
          IF NOT PlantCostItmLnsExist(Rec2."Plant Type") THEN
            EXIT(FALSE);

        IF IgnoreQuestion = FALSE THEN   //C051896
          IF NOT CONFIRM(Text013,TRUE) THEN
            EXIT;

        REPEAT
          IF CheckIfPltCostItmLnsForBasLine(Rec2) THEN
            TmpBuffersInsertToBaseRcpLine(Rec2);
        UNTIL Rec2.NEXT = 0;

        EXIT(MakeUpdate);
      END;
    END;

    PROCEDURE InsPltCostItmLinesToEstLineRAW@1100529407(VAR Rec2@1100525002 : Record 11125698) : Boolean;
    BEGIN
      //DP01208
      IF Rec2.FINDSET THEN BEGIN
        PlantCompany := GetDefaultPlantCompany(DATABASE::Estimate, Rec2."Estimate No.");  //DP01208 (db, 27-10-16)
        IF Rec2.COUNT = 1 THEN
          IF NOT PlantCostItmLnsExist(Rec2."Plant Type") THEN
            EXIT(FALSE);

        IF IgnoreQuestion = FALSE THEN   //C051896
          IF NOT CONFIRM(Text013,TRUE) THEN
            EXIT(FALSE);

        REPEAT
          IF CheckIfPltCostItmLnsForEstLineRAW(Rec2) THEN
            TmpBuffersInsertToEstLineRAW(Rec2);
        UNTIL Rec2.NEXT = 0;

        EXIT(MakeUpdate);
      END;
    END;

    PROCEDURE ExplodeSetLinesToEstLine@1100525030(VAR Rec2@1100525001 : Record 11072072) : Boolean;
    VAR
      Set2@1100525000 : Record 11012587;
    BEGIN
      IF IgnoreQuestion = FALSE THEN   //C051896
        IF NOT CONFIRM(Text014,TRUE,Set2.TABLECAPTION) THEN
          EXIT;

      IF Rec2.FINDSET THEN
        PlantCompany := GetDefaultPlantCompany(DATABASE::Estimate, Rec2."Estimate No.");  //DP01208 (db, 27-10-16)
        REPEAT
          IF CheckIfSetLnsForEstLine(Rec2) THEN
            TmpBuffersInsertToEstLine(Rec2);
        UNTIL Rec2.NEXT = 0;

      EXIT(MakeUpdate);
    END;

    PROCEDURE ExplodeSetLinesToEstRcpLine@1100525029(VAR Rec2@1100525001 : Record 11072075) : Boolean;
    VAR
      Set2@1100525000 : Record 11012587;
    BEGIN
      IF IgnoreQuestion = FALSE THEN   //C051896
        IF NOT CONFIRM(Text014,TRUE,Set2.TABLECAPTION) THEN
          EXIT;

      IF Rec2.FINDSET THEN
        PlantCompany := GetDefaultPlantCompany(DATABASE::Estimate, Rec2."Estimate No.");  //DP01208 (db, 27-10-16)
        REPEAT
          IF CheckIfSetLnsForEstRcpLine(Rec2) THEN
            TmpBuffersInsertToEstRcpLine(Rec2);
        UNTIL Rec2.NEXT = 0;

      EXIT(MakeUpdate);
    END;

    PROCEDURE ExplodeSetLinesToBaseRcpLine@1100528917(VAR Rec2@1100525001 : Record 11020582) : Boolean;
    VAR
      Set2@1100525000 : Record 11012587;
    BEGIN
      //Dp00381
      IF IgnoreQuestion = FALSE THEN   //C051896
        IF NOT CONFIRM(Text014,TRUE,Set2.TABLECAPTION) THEN
          EXIT;

      IF Rec2.FINDSET THEN
        PlantCompany := GetDefaultPlantCompany(DATABASE::"Base Recipe", '');  //DP01208 (db, 27-10-16)
        REPEAT
          IF CheckIfSetLnsForBaseRcpLine(Rec2) THEN
            TmpBuffersInsertToBaseRcpLine(Rec2);
        UNTIL Rec2.NEXT = 0;

      EXIT(MakeUpdate);
    END;

    PROCEDURE ExplodeSetLinesToEstLineRAW@1100529401(VAR Rec2@1100525001 : Record 11125698) : Boolean;
    VAR
      Set2@1100525000 : Record 11012587;
    BEGIN
      //DP01208
      IF IgnoreQuestion = FALSE THEN   //C051896
        IF NOT CONFIRM(Text014,TRUE,Set2.TABLECAPTION) THEN
          EXIT;

      IF Rec2.FINDSET THEN
        REPEAT
          IF CheckIfSetLnsForEstLineRAW(Rec2) THEN
            TmpBuffersInsertToEstLineRAW(Rec2);
        UNTIL Rec2.NEXT = 0;

      EXIT(MakeUpdate);
    END;

    PROCEDURE AssignPltCostItmFldsToEstLn@1100525003(PlantCostLine@1100525000 : Record 11012591;VAR Rec2@1100525001 : Record 11072072);
    VAR
      DimValue@1100525003 : Record 349;
      Est@1100529000 : Record 11012151;
      RefDate@1100529001 : Date;
    BEGIN
      DimManagement.GetDimValueRec(2,PlantCostLine."No.",DimValue,TRUE,'');
      IF Est.GET(Rec2."Estimate No.") THEN  //DP00241.n (16930)
        RefDate := Est."Reference Date (Rate)";

      CASE DimValue."Cost Type" OF
        DimValue."Cost Type"::Labor:
          BEGIN
            Rec2.VALIDATE("Cost Object Labor",PlantCostLine."No.");
            Rec2.VALIDATE("Cost Rate",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
            Rec2.Norm := 1;
          END;
        DimValue."Cost Type"::Material,
        DimValue."Cost Type"::Subcontracting,
        DimValue."Cost Type"::Plant,
        DimValue."Cost Type"::Sundry:
          BEGIN
            Rec2."Cost Type (Price)" := DimValue."Cost Type";  //C051896
            Rec2.VALIDATE("Cost Object Price",PlantCostLine."No.");
            Rec2.VALIDATE("Net Cost Price",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
          END;
        DimValue."Cost Type"::Revenue: EXIT;
      END;

      Rec2.Description := PlantCostLine.Description;
      Rec2.VALIDATE(Vendor,PlantCostLine."Vendor No.");
      Rec2.VALIDATE("Unit of Measure",PlantCostLine."Unit of Measure");
      Rec2.VALIDATE(Quantity,PlantCostLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignPltCostItmFldsToEstRcpLn@1100525016(PlantCostLine@1100525000 : Record 11012591;VAR Rec2@1100525001 : Record 11072075);
    VAR
      DimValue@1100525003 : Record 349;
      Est@1100529000 : Record 11012151;
      RefDate@1100529001 : Date;
    BEGIN
      IF PlantCostLine.Type <> PlantCostLine.Type::Text THEN BEGIN
        DimManagement.GetDimValueRec(2,PlantCostLine."No.",DimValue,TRUE,'');
        IF Est.GET(Rec2."Estimate No.") THEN  //DP00241.n (16930)
          RefDate := Est."Reference Date (Rate)";

        CASE DimValue."Cost Type" OF
          DimValue."Cost Type"::Labor:
            BEGIN
              Rec2.VALIDATE("Cost Object Labor",PlantCostLine."No.");
              Rec2.VALIDATE("Cost Rate",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
              Rec2.Norm := 1;
            END;
          DimValue."Cost Type"::Material,
          DimValue."Cost Type"::Subcontracting,
          DimValue."Cost Type"::Plant,
          DimValue."Cost Type"::Sundry:
            BEGIN
              Rec2."Cost Type (Price)" := DimValue."Cost Type";  //C051896
              Rec2.VALIDATE("Cost Object Price",PlantCostLine."No.");
              Rec2.VALIDATE("Net Cost Price",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
            END;
          DimValue."Cost Type"::Revenue: EXIT;
        END;
      END;

      Rec2.Description := PlantCostLine.Description;
      Rec2.VALIDATE(Vendor,PlantCostLine."Vendor No.");
      Rec2.VALIDATE("Unit of Measure",PlantCostLine."Unit of Measure");
      Rec2.VALIDATE(Quantity,PlantCostLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignPltCostItmFldsToBasRcpLn@1100528921(PlantCostLine@1100525000 : Record 11012591;VAR Rec2@1100525001 : Record 11020582);
    VAR
      DimValue@1100525003 : Record 349;
      RefDate@1100529001 : Date;
    BEGIN
      //DP00381
      IF PlantCostLine.Type <> PlantCostLine.Type::Text THEN BEGIN
        DimManagement.GetDimValueRec(2,PlantCostLine."No.",DimValue,TRUE,'');
        RefDate := TODAY;  //db, 12-08-13

        CASE DimValue."Cost Type" OF
          DimValue."Cost Type"::Labor:
            BEGIN
              Rec2.VALIDATE("Cost Object Labor",PlantCostLine."No.");
              Rec2.VALIDATE("Cost Rate",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
              Rec2.Norm := 1;
            END;
          DimValue."Cost Type"::Material,
          DimValue."Cost Type"::Subcontracting,
          DimValue."Cost Type"::Plant,
          DimValue."Cost Type"::Sundry:
            BEGIN
              Rec2."Cost Type (Price)" := DimValue."Cost Type";  //C051896
              Rec2.VALIDATE("Cost Object Price",PlantCostLine."No.");
              Rec2.VALIDATE("Net Cost Price",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
            END;
          DimValue."Cost Type"::Revenue: EXIT;
        END;
      END;

      Rec2.Description := PlantCostLine.Description;
      Rec2.VALIDATE(Vendor,PlantCostLine."Vendor No.");
      Rec2.VALIDATE("Unit of Measure",PlantCostLine."Unit of Measure");
      Rec2.VALIDATE(Quantity,PlantCostLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignPltCostItmFldsToEstLnRAW@1100529405(PlantCostLine@1100525000 : Record 11012591;VAR Rec2@1100525001 : Record 11125698);
    VAR
      DimValue@1100525003 : Record 349;
      Est@1100529000 : Record 11012151;
      RefDate@1100529001 : Date;
    BEGIN
      //DP01208
      DimManagement.GetDimValueRec(2,PlantCostLine."No.",DimValue,TRUE,'');
      IF Est.GET(Rec2."Estimate No.") THEN  //DP00241.n (16930)
        RefDate := Est."Reference Date (Rate)";

      CASE DimValue."Cost Type" OF
        DimValue."Cost Type"::Labor:
          BEGIN
            Rec2.VALIDATE("Cost Object",PlantCostLine."No.");  //DP01676
            Rec2.VALIDATE(Rate,PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
            Rec2.Norm := 1;
          END;
        DimValue."Cost Type"::Material:
          BEGIN
            Rec2.VALIDATE("Cost Object",PlantCostLine."No.");  //DP01676
            Rec2.VALIDATE("Net Cost Price",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
          END;
        DimValue."Cost Type"::Subcontracting:
          BEGIN
            Rec2.VALIDATE("Cost Object",PlantCostLine."No.");  //DP01676
            Rec2.VALIDATE("Net Cost Price",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
          END;
        DimValue."Cost Type"::Plant:
          BEGIN
            Rec2.VALIDATE("Cost Object",PlantCostLine."No.");  //DP01676
            Rec2.VALIDATE("Net Cost Price",PlantCostLine.GetCostLinePrice(RefDate));  //DP00241.n (16930)
          END;
        DimValue."Cost Type"::Sundry: EXIT;
        DimValue."Cost Type"::Revenue: EXIT;
      END;

      Rec2.Description := PlantCostLine.Description;
      Rec2.VALIDATE(Vendor,PlantCostLine."Vendor No.");
      Rec2.VALIDATE("Unit of Measure",PlantCostLine."Unit of Measure");
      Rec2.VALIDATE(Quantity,PlantCostLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignSetFldsToEstLn@1100525002(PlantSetLine@1100525000 : Record 11012588;VAR Rec2@1100525001 : Record 11072072);
    BEGIN
      CASE PlantSetLine.Type OF
        PlantSetLine.Type::Plant: Rec2.VALIDATE("Plant Type",PlantSetLine."Plant Type");
        PlantSetLine.Type::Item: Rec2.VALIDATE("Item No.",PlantSetLine."Item No.");
      END;

      Rec2.VALIDATE(Quantity,PlantSetLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignSetFldsToEstRcpLn@1100525023(PlantSetLine@1100525000 : Record 11012588;VAR Rec2@1100525001 : Record 11072075);
    BEGIN
      CASE PlantSetLine.Type OF
        PlantSetLine.Type::Plant: Rec2.VALIDATE("Plant Type",PlantSetLine."Plant Type");
        PlantSetLine.Type::Item: Rec2.VALIDATE("Item No.",PlantSetLine."Item No.");
      END;

      Rec2.VALIDATE(Quantity,PlantSetLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignSetFldsToBaseRcpLn@1100528920(PlantSetLine@1100525000 : Record 11012588;VAR Rec2@1100525001 : Record 11020582);
    BEGIN
      //Dp00381
      CASE PlantSetLine.Type OF
        PlantSetLine.Type::Plant: Rec2.VALIDATE("Plant Type",PlantSetLine."Plant Type");
        PlantSetLine.Type::Item: Rec2.VALIDATE("Item No.",PlantSetLine."Item No.");
      END;

      Rec2.VALIDATE(Quantity,PlantSetLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE AssignSetFldsToEstLnRAW@1100529406(PlantSetLine@1100525000 : Record 11012588;VAR Rec2@1100525001 : Record 11125698);
    BEGIN
      //DP01208
      CASE PlantSetLine.Type OF
        PlantSetLine.Type::Plant: Rec2.VALIDATE("Plant Type",PlantSetLine."Plant Type");
        PlantSetLine.Type::Item: Rec2.VALIDATE("Item No.",PlantSetLine."Item No.");
      END;

      Rec2.VALIDATE(Quantity,PlantSetLine.Quantity * Rec2.Quantity);
    END;

    PROCEDURE CheckIfPltCostItmLnsForEstLine@1(VAR Rec2@1000 : Record 11072072) : Boolean;
    BEGIN
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedEstLines(0,Rec2,0); //0:delete

      EXIT(ReadPlantCostLines(Rec2."Plant Type") OR ReadPlantItmLines(Rec2."Plant Type"));
    END;

    PROCEDURE CheckIfPltCostItmLnsForRcpLine@1100525025(VAR Rec2@1000 : Record 11072075) : Boolean;
    BEGIN
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedEstRcpLines(0,Rec2,0); //0:delete

      EXIT(ReadPlantCostLines(Rec2."Plant Type") OR ReadPlantItmLines(Rec2."Plant Type"));
    END;

    PROCEDURE CheckIfPltCostItmLnsForBasLine@1100528922(VAR Rec2@1000 : Record 11020582) : Boolean;
    BEGIN
      //DP00381
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedBaseRcpLines(0,Rec2,0); //0:delete

      EXIT(ReadPlantCostLines(Rec2."Plant Type") OR ReadPlantItmLines(Rec2."Plant Type"));
    END;

    PROCEDURE CheckIfPltCostItmLnsForEstLineRAW@1100529408(VAR Rec2@1000 : Record 11125698) : Boolean;
    BEGIN
      //DP01208
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedEstLinesRAW(0,Rec2,0); //0:delete

      EXIT(ReadPlantCostLines(Rec2."Plant Type") OR ReadPlantItmLines(Rec2."Plant Type"));
    END;

    PROCEDURE CheckIfSetLnsForEstLine@1100525000(VAR Rec2@1000 : Record 11072072) : Boolean;
    BEGIN
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedEstLines(0,Rec2, 0); //0:delete

      EXIT(ReadSetCostLines(Rec2."Set Code") OR ReadSetItmPltLines(Rec2."Set Code"));
    END;

    PROCEDURE CheckIfSetLnsForEstRcpLine@1100525026(VAR Rec2@1000 : Record 11072075) : Boolean;
    BEGIN
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedEstRcpLines(0,Rec2,0); //0:delete

      EXIT(ReadSetCostLines(Rec2."Set Code") OR ReadSetItmPltLines(Rec2."Set Code"));
    END;

    PROCEDURE CheckIfSetLnsForBaseRcpLine@1100528918(VAR Rec2@1000 : Record 11020582) : Boolean;
    BEGIN
      //DP00381
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedBaseRcpLines(0,Rec2,0); //0:delete

      EXIT(ReadSetCostLines(Rec2."Set Code") OR ReadSetItmPltLines(Rec2."Set Code"));
    END;

    PROCEDURE CheckIfSetLnsForEstLineRAW@1100529402(VAR Rec2@1000 : Record 11125698) : Boolean;
    BEGIN
      //DP01208
      MakeUpdateRequired := FALSE;
      IF Rec2."Line No." <> 0 THEN
        MakeUpdateRequired := ModifyLinkedEstLinesRAW(0,Rec2, 0); //0:delete

      EXIT(ReadSetCostLines(Rec2."Set Code") OR ReadSetItmPltLines(Rec2."Set Code"));
    END;

    PROCEDURE TmpBuffersInsertToEstLine@2(VAR Rec2@1000 : Record 11072072);
    VAR
      ToRec@1001 : Record 11072072;
    BEGIN
      ToRec.RESET;
      ToRec.SETRANGE("Estimate No.",Rec2."Estimate No.");
      ToRec.SETRANGE("Sub-Estimate No.",Rec2."Sub-Estimate No.");
      ToRec.SETRANGE("Part Group",Rec2."Part Group");
      ToRec.SETRANGE(Part,Rec2.Part);

      ToRec := Rec2;
      IF ToRec.FIND('>') THEN BEGIN
        LineSpacing :=
          (ToRec."Line No." - Rec2."Line No.") DIV
          (1 + TmpSetLine.COUNT + NumCostLine);  //C057136
        IF LineSpacing = 0 THEN
          ERROR(Text000);
      END ELSE
        LineSpacing := 10000;

      NextLineNo := Rec2."Line No." + LineSpacing;

      TmpSetLine.RESET;
      IF TmpSetLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Estimate No." := Rec2."Estimate No.";
          ToRec."Sub-Estimate No." := Rec2."Sub-Estimate No.";
          ToRec."Part Group" := Rec2."Part Group";
          ToRec.Part := Rec2.Part;
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          ToRec."Quantity (Sales)" := Rec2.Quantity;  //C053101
          AssignSetFldsToEstLn(TmpSetLine,ToRec);
          ToRec.MODIFY;
        UNTIL TmpSetLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpSetLine.DELETEALL;

      TmpCostLine.RESET;
      IF TmpCostLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Estimate No." := Rec2."Estimate No.";
          ToRec."Sub-Estimate No." := Rec2."Sub-Estimate No.";
          ToRec."Part Group" := Rec2."Part Group";
          ToRec.Part := Rec2.Part;
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          ToRec."Quantity (Sales)" := Rec2.Quantity;  //C053101
          AssignPltCostItmFldsToEstLn(TmpCostLine,ToRec);
          ToRec.MODIFY;
          //C057136.sn
          IF TmpCostLine."Type Cost" = TmpCostLine."Type Cost"::Both THEN BEGIN
            ToRec."Line No." := NextLineNo;
            NextLineNo := NextLineNo + LineSpacing;
            ToRec.INSERT;
          END;
          //C057136.en
        UNTIL TmpCostLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpCostLine.DELETEALL;
    END;

    PROCEDURE TmpBuffersInsertToEstRcpLine@1100525027(VAR Rec2@1000 : Record 11072075);
    VAR
      ToRec@1001 : Record 11072075;
    BEGIN
      ToRec.RESET;
      ToRec.SETRANGE("Estimate No.",Rec2."Estimate No.");
      ToRec.SETRANGE("Sub-Estimate No.",Rec2."Sub-Estimate No.");
      ToRec.SETRANGE("Part Group",Rec2."Part Group");
      ToRec.SETRANGE(Part,Rec2.Part);
      ToRec.SETRANGE("Estimate Line",Rec2."Estimate Line");
      ToRec.SETRANGE("Recipe Group",Rec2."Recipe Group");
      ToRec.SETRANGE(Recipe,Rec2.Recipe);

      ToRec := Rec2;
      IF ToRec.FIND('>') THEN BEGIN
        LineSpacing :=
          (ToRec."Line No." - Rec2."Line No.") DIV
          (1 + TmpSetLine.COUNT + NumCostLine);  //C057136
        IF LineSpacing = 0 THEN
          ERROR(Text000);
      END ELSE
        LineSpacing := 10000;

      NextLineNo := Rec2."Line No." + LineSpacing;

      TmpSetLine.RESET;
      IF TmpSetLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Estimate No." := Rec2."Estimate No.";
          ToRec."Sub-Estimate No." := Rec2."Sub-Estimate No.";
          ToRec."Part Group" := Rec2."Part Group";
          ToRec.Part := Rec2.Part;
          ToRec."Estimate Line" := Rec2."Estimate Line";
          ToRec."Recipe Group" := Rec2."Recipe Group";
          ToRec.Recipe := Rec2.Recipe;
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          ToRec."Quantity (Sales)" := Rec2.Quantity;  //C053101
          AssignSetFldsToEstRcpLn(TmpSetLine,ToRec);
          ToRec.MODIFY;
        UNTIL TmpSetLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpSetLine.DELETEALL;

      TmpCostLine.RESET;
      IF TmpCostLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Estimate No." := Rec2."Estimate No.";
          ToRec."Sub-Estimate No." := Rec2."Sub-Estimate No.";
          ToRec."Part Group" := Rec2."Part Group";
          ToRec.Part := Rec2.Part;
          ToRec."Estimate Line" := Rec2."Estimate Line";
          ToRec."Recipe Group" := Rec2."Recipe Group";
          ToRec.Recipe := Rec2.Recipe;
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          ToRec."Quantity (Sales)" := Rec2.Quantity;  //C053101
          AssignPltCostItmFldsToEstRcpLn(TmpCostLine,ToRec);
          ToRec.MODIFY;
          //C057136.sn
          IF TmpCostLine."Type Cost" = TmpCostLine."Type Cost"::Both THEN BEGIN
            ToRec."Line No." := NextLineNo;
            NextLineNo := NextLineNo + LineSpacing;
            ToRec.INSERT;
          END;
          //C057136.en
        UNTIL TmpCostLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpCostLine.DELETEALL;
    END;

    PROCEDURE TmpBuffersInsertToBaseRcpLine@1100528919(VAR Rec2@1000 : Record 11020582);
    VAR
      ToRec@1001 : Record 11020582;
    BEGIN
      //DP00381
      ToRec.RESET;
      ToRec.SETRANGE("Recipe Group",Rec2."Recipe Group");
      ToRec.SETRANGE(Recipe,Rec2.Recipe);

      ToRec := Rec2;
      IF ToRec.FIND('>') THEN BEGIN
        LineSpacing :=
          (ToRec."Line No." - Rec2."Line No.") DIV
          (1 + TmpSetLine.COUNT + NumCostLine);  //C057136
        IF LineSpacing = 0 THEN
          ERROR(Text000);
      END ELSE
        LineSpacing := 10000;

      NextLineNo := Rec2."Line No." + LineSpacing;

      TmpSetLine.RESET;
      IF TmpSetLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Recipe Group" := Rec2."Recipe Group";
          ToRec.Recipe := Rec2.Recipe;
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          AssignSetFldsToBaseRcpLn(TmpSetLine,ToRec);
          ToRec.MODIFY;
        UNTIL TmpSetLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpSetLine.DELETEALL;

      TmpCostLine.RESET;
      IF TmpCostLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Recipe Group" := Rec2."Recipe Group";
          ToRec.Recipe := Rec2.Recipe;
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          AssignPltCostItmFldsToBasRcpLn(TmpCostLine,ToRec);
          ToRec.MODIFY;
          //C057136.sn
          IF TmpCostLine."Type Cost" = TmpCostLine."Type Cost"::Both THEN BEGIN
            ToRec."Line No." := NextLineNo;
            NextLineNo := NextLineNo + LineSpacing;
            ToRec.INSERT;
          END;
          //C057136.en
        UNTIL TmpCostLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpCostLine.DELETEALL;
    END;

    PROCEDURE TmpBuffersInsertToEstLineRAW@1100529403(VAR Rec2@1000 : Record 11125698);
    VAR
      ToRec@1001 : Record 11125698;
    BEGIN
      //DP01208
      ToRec.RESET;
      ToRec.SETRANGE("Estimate No.",Rec2."Estimate No.");
      ToRec.SETRANGE("Tender Paragraph No.",Rec2."Tender Paragraph No.");

      ToRec := Rec2;
      IF ToRec.FIND('>') THEN BEGIN
        LineSpacing :=
          (ToRec."Line No." - Rec2."Line No.") DIV
          (1 + TmpSetLine.COUNT + NumCostLine);  //C057136
        IF LineSpacing = 0 THEN
          ERROR(Text000);
      END ELSE
        LineSpacing := 10000;

      NextLineNo := Rec2."Line No." + LineSpacing;

      TmpSetLine.RESET;
      IF TmpSetLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Estimate No." := Rec2."Estimate No.";
          ToRec."Tender Paragraph No." := Rec2."Tender Paragraph No.";
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          ToRec."Part Quantity" := Rec2."Part Quantity";  //DP01619
          AssignSetFldsToEstLnRAW(TmpSetLine,ToRec);
          ToRec.MODIFY;
        UNTIL TmpSetLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpSetLine.DELETEALL;

      TmpCostLine.RESET;
      IF TmpCostLine.FINDSET THEN BEGIN
        REPEAT
          ToRec.INIT;
          ToRec."Estimate No." := Rec2."Estimate No.";
          ToRec."Tender Paragraph No." := Rec2."Tender Paragraph No.";
          ToRec."Line No." := NextLineNo;
          NextLineNo := NextLineNo + LineSpacing;
          ToRec.INSERT(TRUE);
          ToRec."Attached to Line No." := Rec2."Line No.";
          ToRec."Set Level" := Rec2."Set Level" + 1;
          ToRec.Quantity := Rec2.Quantity;
          ToRec."Part Quantity" := Rec2."Part Quantity";  //DP01619
          AssignPltCostItmFldsToEstLnRAW(TmpCostLine,ToRec);
          ToRec.MODIFY;
          //C057136.sn
          IF TmpCostLine."Type Cost" = TmpCostLine."Type Cost"::Both THEN BEGIN
            ToRec."Line No." := NextLineNo;
            NextLineNo := NextLineNo + LineSpacing;
            ToRec.INSERT;
          END;
          //C057136.en
        UNTIL TmpCostLine.NEXT = 0;
        MakeUpdateRequired := TRUE;
      END;
      TmpCostLine.DELETEALL;
    END;

    PROCEDURE ModifyLinkedEstLines@1100525004(ModifyAction@1100525000 : 'Delete,ModQuantity,Rename,Fields';VAR Rec2@1000 : Record 11072072;FieldNo@1100525001 : Integer) : Boolean;
    VAR
      Rec3@1001 : Record 11072072;
    BEGIN
      IF (Rec2."Line No." = 0) THEN EXIT;  //C052918

      IF (ModifyAction = ModifyAction::ModQuantity) THEN
        IF (QuantityRatio = 1) THEN
          EXIT;

      Rec3.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", "Part Group", Part, "Attached to Line No.");
      Rec3.SETRANGE("Estimate No.",Rec2."Estimate No.");
      Rec3.SETRANGE("Sub-Estimate No.",Rec2."Sub-Estimate No.");
      Rec3.SETRANGE("Part Group",Rec2."Part Group");
      Rec3.SETRANGE(Part,Rec2.Part);
      Rec3.SETRANGE("Attached to Line No.",Rec2."Line No.");
      Rec3.SETFILTER("Line No.",'>%1',Rec2."Line No.");
      Rec3.SETRANGE("Set Level",Rec2."Set Level" + 1);

      IF Rec3.FINDSET(ModifyAction <> ModifyAction::Delete) THEN BEGIN
        REPEAT
          CASE ModifyAction OF
            ModifyAction::Delete:
              Rec3.DELETE(TRUE);
            ModifyAction::ModQuantity:
              BEGIN
                Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity * QuantityRatio, 0.00001));
                Rec3.MODIFY(TRUE);
              END;
            ModifyAction::Rename:
              BEGIN
                Rec3."Attached to Line No." := NewHeadLineNo;
                Rec3.MODIFY;
              END;
            ModifyAction::Fields:
              IF (Rec3."Plant Type" <> '') OR
                 (Rec3."Set Code" <> '')
              THEN BEGIN
                CASE FieldNo OF
                  Rec2.FIELDNO("Start Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("Start Rental Period", Rec2."Start Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("End Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("End Rental Period", Rec2."End Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Period Formula"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Period Formula", Rec2."Rental Period Formula");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Time Units"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Time Units", Rec2."Rental Time Units");
                      Rec3.MODIFY;
                    END;
                END;
              END;
          END;
        UNTIL Rec3.NEXT = 0;
        MakeUpdateRequired := TRUE;
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ModifyLinkedEstRcpLines@1100525001(ModifyAction@1100525000 : 'Delete,ModQuantity,,Fields';VAR Rec2@1000 : Record 11072075;FieldNo@1100525001 : Integer) : Boolean;
    VAR
      Rec3@1001 : Record 11072075;
    BEGIN
      IF (Rec2."Line No." = 0) THEN EXIT;  //C052918

      IF (ModifyAction = ModifyAction::ModQuantity) THEN
        IF (QuantityRatio = 1) THEN
          IF NOT (DisableTotal OR ActivateTotal) THEN  //C044680
            EXIT;

      Rec3.SETRANGE("Estimate No.",Rec2."Estimate No.");
      Rec3.SETRANGE("Sub-Estimate No.",Rec2."Sub-Estimate No.");
      Rec3.SETRANGE("Part Group",Rec2."Part Group");
      Rec3.SETRANGE(Part,Rec2.Part);
      Rec3.SETRANGE("Estimate Line",Rec2."Estimate Line");
      Rec3.SETRANGE("Recipe Group",Rec2."Recipe Group");
      Rec3.SETRANGE(Recipe,Rec2.Recipe);
      Rec3.SETRANGE("Attached to Line No.",Rec2."Line No.");
      Rec3.SETFILTER("Line No.",'>%1',Rec2."Line No.");

      IF Rec3.FINDSET(ModifyAction <> ModifyAction::Delete) THEN BEGIN
        REPEAT
          CASE ModifyAction OF
            ModifyAction::Delete:
              Rec3.DELETE(TRUE);
            ModifyAction::ModQuantity:
              BEGIN
                //C044680.sn
                IF QuantityRatio = 0 THEN BEGIN
                  IF Rec3."Recipe Quantity" <> 0 THEN  //reset to initial quantity from base recipe
                    Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity / Rec3."Recipe Quantity", 0.00001));
                END ELSE BEGIN
                  Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity * QuantityRatio, 0.00001));
                END;
                Rec3."Recipe Quantity" := Rec2.Quantity;
                Rec3."Recipe Quantity (Sales)" := Rec2."Quantity (Sales)";  //C058658
                Rec3.CalculateTotals;
                //C044680.en
                Rec3.MODIFY(TRUE);
              END;
            ModifyAction::Fields:
              IF (Rec3."Plant Type" <> '') OR
                 (Rec3."Set Code" <> '')
              THEN BEGIN
                CASE FieldNo OF
                  Rec2.FIELDNO("Start Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("Start Rental Period", Rec2."Start Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("End Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("End Rental Period", Rec2."End Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Period Formula"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Period Formula", Rec2."Rental Period Formula");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Time Units"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Time Units", Rec2."Rental Time Units");
                      Rec3.MODIFY;
                    END;
                END;
              END;
          END;
        UNTIL Rec3.NEXT = 0;
        MakeUpdateRequired := TRUE;
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ModifyLinkedBaseRcpLines@1100528901(ModifyAction@1100525000 : 'Delete,ModQuantity,,Fields';VAR Rec2@1000 : Record 11020582;FieldNo@1100525001 : Integer) : Boolean;
    VAR
      Rec3@1001 : Record 11020582;
    BEGIN
      //DP00381
      IF (Rec2."Line No." = 0) THEN EXIT;  //C052918

      IF (ModifyAction = ModifyAction::ModQuantity) THEN
        IF (QuantityRatio = 1) THEN
          EXIT;

      //C054911.sn
      Rec3.SETRANGE("Recipe Group",Rec2."Recipe Group");
      Rec3.SETRANGE(Recipe,Rec2.Recipe);
      //C054911.en
      Rec3.SETRANGE("Attached to Line No.",Rec2."Line No.");
      Rec3.SETFILTER("Line No.",'>%1',Rec2."Line No.");

      IF Rec3.FINDSET(ModifyAction <> ModifyAction::Delete) THEN BEGIN
        REPEAT
          CASE ModifyAction OF
            ModifyAction::Delete:
              Rec3.DELETE(TRUE);
            ModifyAction::ModQuantity:
              BEGIN
                Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity * QuantityRatio, 0.00001));
                Rec3.MODIFY(TRUE);
              END;
            ModifyAction::Fields:
              IF (Rec3."Plant Type" <> '') OR
                 (Rec3."Set Code" <> '')
              THEN BEGIN
                CASE FieldNo OF
                  Rec2.FIELDNO("Start Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("Start Rental Period", Rec2."Start Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("End Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("End Rental Period", Rec2."End Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Period Formula"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Period Formula", Rec2."Rental Period Formula");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Time Units"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Time Units", Rec2."Rental Time Units");
                      Rec3.MODIFY;
                    END;
                END;
              END;
          END;
        UNTIL Rec3.NEXT = 0;
        MakeUpdateRequired := TRUE;
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ModifyLinkedSalesRcpLines@1100525036(ModifyAction@1100525000 : 'Delete,ModQuantity,,Fields';VAR Rec2@1000 : Record 11229789;FieldNo@1100525001 : Integer) : Boolean;
    VAR
      Rec3@1001 : Record 11229789;
    BEGIN
      //DP00481
      IF (Rec2."Line No." = 0) THEN EXIT;  //C052918

      IF (ModifyAction = ModifyAction::ModQuantity) THEN
        IF (QuantityRatio = 1) THEN
          EXIT;

      Rec3.SETRANGE("Sales Document Type", Rec2."Sales Document Type");
      Rec3.SETRANGE("Sales Document No.", Rec2."Sales Document No.");
      Rec3.SETRANGE("Sales Line No.", Rec2."Sales Line No.");
      Rec3.SETRANGE("Recipe Group",Rec2."Recipe Group");
      Rec3.SETRANGE(Recipe,Rec2.Recipe);
      Rec3.SETRANGE("Attached to Line No.",Rec2."Line No.");
      Rec3.SETFILTER("Line No.",'>%1',Rec2."Line No.");

      IF Rec3.FINDSET(ModifyAction <> ModifyAction::Delete) THEN BEGIN
        REPEAT
          CASE ModifyAction OF
            ModifyAction::Delete:
              Rec3.DELETE(TRUE);
            ModifyAction::ModQuantity:
              BEGIN
                Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity * QuantityRatio, 0.00001));
                Rec3.MODIFY(TRUE);
              END;
            ModifyAction::Fields:
              IF (Rec3."Plant Type" <> '') OR
                 (Rec3."Set Code" <> '')
              THEN BEGIN
                CASE FieldNo OF
                  Rec2.FIELDNO("Start Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("Start Rental Period", Rec2."Start Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("End Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("End Rental Period", Rec2."End Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Period Formula"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Period Formula", Rec2."Rental Period Formula");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Time Units"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Time Units", Rec2."Rental Time Units");
                      Rec3.MODIFY;
                    END;
                END;
              END;
          END;
        UNTIL Rec3.NEXT = 0;
        MakeUpdateRequired := TRUE;
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ModifyLinkedPartLines@1100525039(ModifyAction@1100525000 : 'Delete,ModQuantity,,Fields';VAR Rec2@1000 : Record 11072076;FieldNo@1100525001 : Integer) : Boolean;
    VAR
      Rec3@1001 : Record 11072076;
    BEGIN
      //DP00381
      IF (Rec2."Line No." = 0) THEN EXIT;  //C052918

      IF (ModifyAction = ModifyAction::ModQuantity) THEN
        IF (QuantityRatio = 1) THEN
          EXIT;

      Rec3.SETRANGE("Attached to Line No.",Rec2."Line No.");
      Rec3.SETFILTER("Line No.",'>%1',Rec2."Line No.");

      IF Rec3.FINDSET(ModifyAction <> ModifyAction::Delete) THEN BEGIN
        REPEAT
          CASE ModifyAction OF
            ModifyAction::Delete:
              Rec3.DELETE(TRUE);
            ModifyAction::ModQuantity:
              BEGIN
                Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity * QuantityRatio, 0.00001));
                Rec3.MODIFY(TRUE);
              END;
          END;
        UNTIL Rec3.NEXT = 0;
        MakeUpdateRequired := TRUE;
        EXIT(TRUE);
      END;
    END;

    PROCEDURE ModifyLinkedEstLinesRAW@1100529404(ModifyAction@1100525000 : 'Delete,ModQuantity,Rename,Fields';VAR Rec2@1000 : Record 11125698;FieldNo@1100525001 : Integer) : Boolean;
    VAR
      Rec3@1001 : Record 11125698;
    BEGIN
      //DP01208
      IF (Rec2."Line No." = 0) THEN EXIT;  //C052918

      IF (ModifyAction = ModifyAction::ModQuantity) THEN
        IF (QuantityRatio = 1) THEN
          EXIT;

      Rec3.SETRANGE("Estimate No.",Rec2."Estimate No.");
      Rec3.SETRANGE("Tender Paragraph No.",Rec2."Tender Paragraph No.");
      Rec3.SETRANGE("Attached to Line No.",Rec2."Line No.");
      Rec3.SETFILTER("Line No.",'>%1',Rec2."Line No.");
      Rec3.SETRANGE("Set Level",Rec2."Set Level" + 1);

      IF Rec3.FINDSET(ModifyAction <> ModifyAction::Delete) THEN BEGIN
        REPEAT
          CASE ModifyAction OF
            ModifyAction::Delete:
              Rec3.DELETE(TRUE);
            ModifyAction::ModQuantity:
              BEGIN
                Rec3.VALIDATE(Quantity,ROUND(Rec3.Quantity * QuantityRatio, 0.00001));
                Rec3.MODIFY(TRUE);
              END;
            ModifyAction::Rename:
              BEGIN
                Rec3."Attached to Line No." := NewHeadLineNo;
                Rec3.MODIFY;
              END;
            ModifyAction::Fields:
              IF (Rec3."Plant Type" <> '') OR
                 (Rec3."Set Code" <> '')
              THEN BEGIN
                CASE FieldNo OF
                  Rec2.FIELDNO("Start Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("Start Rental Period", Rec2."Start Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("End Rental Period"):
                    BEGIN;
                      Rec3.VALIDATE("End Rental Period", Rec2."End Rental Period");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Period Formula"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Period Formula", Rec2."Rental Period Formula");
                      Rec3.MODIFY;
                    END;
                  Rec2.FIELDNO("Rental Time Units"):
                    BEGIN;
                      Rec3.VALIDATE("Rental Time Units", Rec2."Rental Time Units");
                      Rec3.MODIFY;
                    END;
                END;
              END;
          END;
        UNTIL Rec3.NEXT = 0;
        MakeUpdateRequired := TRUE;
        EXIT(TRUE);
      END;
    END;

    PROCEDURE MakeUpdate@6() : Boolean;
    BEGIN
      EXIT(MakeUpdateRequired);
    END;

    PROCEDURE ReadEstimateSetup@1100525034();
    BEGIN
      IF EstimateSetupRead THEN
        EXIT;

      EstimateSetup.GET;
      EstimateSetupRead := TRUE;
    END;

    LOCAL PROCEDURE ReadPlantCostLines@10(PlantType@1000 : Code[20]) : Boolean;
    VAR
      PlantCostLine@1003 : Record 11012591;
      LineNo@1100525000 : Integer;
    BEGIN
      NumCostLine := 0;  //C057136
      //DP01208.sn (db, 27-10-16)
      IF PlantCompany <> '' THEN
        PlantCostLine.CHANGECOMPANY(PlantCompany);
      //DP01208.en (db, 27-10-16)
      PlantCostLine.SETRANGE("Cost Level", PlantCostLine."Cost Level"::PlantType);  //DP00671
      PlantCostLine.SETRANGE(Code,PlantType);
      PlantCostLine.SETFILTER(Type, '<>%1', PlantCostLine.Type::Damage);  //DP00241 (C004697)
      IF NOT PlantCostLine.FINDSET() THEN
        EXIT(FALSE);

      TmpCostLine.DELETEALL;
      REPEAT
        //* Note: Here only Arrival and/or Removal, so nothing to do with 'Other Transfer' ("Incl. Arrival Other Transfers")
        TmpCostLine := PlantCostLine;
        TmpCostLine.INSERT;
        NumCostLine := NumCostLine + 1;  //C057136
        IF PlantCostLine."Type Cost" = PlantCostLine."Type Cost"::Both THEN
          NumCostLine := NumCostLine + 1;  //C057136
      UNTIL PlantCostLine.NEXT = 0;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE ReadSetCostLines@1100525011(SetCode@1000 : Code[20]) : Boolean;
    VAR
      PlantCostLine@1003 : Record 11012591;
      LineNo@1100525000 : Integer;
    BEGIN
      NumCostLine := 0;  //C057136
      //DP01208.sn (db, 27-10-16)
      IF PlantCompany <> '' THEN
        PlantCostLine.CHANGECOMPANY(PlantCompany);
      //DP01208.en (db, 27-10-16)
      PlantCostLine.SETRANGE("Cost Level", PlantCostLine."Cost Level"::Set);  //DP00671
      PlantCostLine.SETRANGE(Code,SetCode);
      PlantCostLine.SETFILTER(Type, '<>%1', PlantCostLine.Type::Damage);  //DP00241 (C004697)
      IF NOT PlantCostLine.FINDSET THEN
        EXIT(FALSE);

      TmpCostLine.DELETEALL;
      REPEAT
        //* Note: Here only Arrival and/or Removal, so nothing to do with 'Other Transfer' ("Incl. Arrival Other Transfers")
        TmpCostLine := PlantCostLine;
        TmpCostLine.INSERT;
        NumCostLine := NumCostLine + 1;  //C057136
        IF PlantCostLine."Type Cost" = PlantCostLine."Type Cost"::Both THEN
          NumCostLine := NumCostLine + 1;  //C057136
      UNTIL PlantCostLine.NEXT = 0;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE ReadPlantItmLines@1100525020(PlantType@1100525001 : Code[20]) : Boolean;
    VAR
      PlantItemLine@1003 : Record 11020519;
      LineNo@1100525000 : Integer;
    BEGIN
      //DP01208.sn (db, 27-10-16)
      IF PlantCompany <> '' THEN
        PlantItemLine.CHANGECOMPANY(PlantCompany);
      //DP01208.en (db, 27-10-16)
      PlantItemLine.SETRANGE("Plant Type",PlantType);
      IF NOT PlantItemLine.FINDSET THEN
        EXIT(FALSE);

      TmpSetLine.DELETEALL;
      TmpSetLine.Type := TmpSetLine.Type ::Item;
      REPEAT
        TmpSetLine."Item No." := PlantItemLine."Item No.";
        TmpSetLine.Quantity := PlantItemLine.Quantity;
        TmpSetLine."Unit of Measure" := PlantItemLine."Unit of Measure";
        LineNo := LineNo + 10000;
        TmpSetLine."Line No." := LineNo;
        TmpSetLine.INSERT;
      UNTIL PlantItemLine.NEXT = 0;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE ReadSetItmPltLines@1100525012(SetCode@1000 : Code[20]) : Boolean;
    VAR
      PlantSetLine@1003 : Record 11012588;
      LineNo@1100525000 : Integer;
    BEGIN
      //DP01208.sn (db, 27-10-16)
      IF PlantCompany <> '' THEN
        PlantSetLine.CHANGECOMPANY(PlantCompany);
      //DP01208.en (db, 27-10-16)
      PlantSetLine.SETRANGE("Set Code",SetCode);
      IF NOT PlantSetLine.FINDSET THEN
        EXIT(FALSE);

      TmpSetLine.DELETEALL;
      REPEAT
        TmpSetLine := PlantSetLine;
        LineNo := LineNo + 10000;
        TmpSetLine."Line No." := LineNo;
        TmpSetLine.INSERT;
      UNTIL PlantSetLine.NEXT = 0;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE PlantCostItmLnsExist@1100525038(PlantType@1000 : Code[20]) : Boolean;
    VAR
      PlantCostLine@1003 : Record 11012591;
      PlantItemLine@1100525000 : Record 11020519;
    BEGIN
      //DP01208.sn (db, 27-10-16)
      IF PlantCompany <> '' THEN BEGIN
        PlantCostLine.CHANGECOMPANY(PlantCompany);
        PlantItemLine.CHANGECOMPANY(PlantCompany);
      END;
      //DP01208.en (db, 27-10-16)
      PlantCostLine.SETRANGE("Cost Level", PlantCostLine."Cost Level"::PlantType);  //DP00671
      PlantCostLine.SETRANGE(Code,PlantType);
      PlantCostLine.SETFILTER(Type, '<>%1', PlantCostLine.Type::Damage);  //DP00241 (C004697)
      IF PlantCostLine.FINDSET THEN
        EXIT(TRUE);

      PlantItemLine.SETRANGE("Plant Type",PlantType);
      IF PlantItemLine.FINDSET THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE SetQuantityRatio@1100525007(NewQuan@1100525000 : Decimal;OldQuan@1100525001 : Decimal);
    BEGIN
      //C044680
      DisableTotal := FALSE;
      ActivateTotal := FALSE;
      IF (OldQuan <> 0) THEN BEGIN
        QuantityRatio := NewQuan/OldQuan;
        IF (NewQuan = 0) THEN
          DisableTotal := TRUE;
      END ELSE BEGIN
        QuantityRatio := NewQuan;
        IF (NewQuan <> 0) THEN
          ActivateTotal := TRUE
        ELSE
          DisableTotal := TRUE;
      END;
      //IF (QuantityRatio = 0) THEN
      //  QuantityRatio := 1;
    END;

    PROCEDURE SetNewHeadLineNo@1100525015(NewHeadLineNo2@1100525000 : Integer);
    BEGIN
      NewHeadLineNo := NewHeadLineNo2;
    END;

    PROCEDURE GeneratePlantNeed@1100525009(EstimateNo@1100525000 : Code[20]);
    VAR
      PlantNeed@1100525001 : Record 11012579;
      Estimate@1100525005 : Record 11012151;
      Action@1100525003 : ' ,Add,Replace';
      LineNo@1100525004 : Integer;
      LastLineNoTmpPlantNeed@1100525002 : Integer;
    BEGIN
      //Determine appropriate action
      IF NOT CONFIRM(Text004,TRUE,PlantNeed.TABLECAPTION) THEN
        EXIT;
      Estimate.GET(EstimateNo);
      Estimate.TESTFIELD(Estimate."Plant Location");
      Estimate.CalcfieldTransferedToPlantNeed;
      IF Estimate."Transf. to Plant Need" THEN BEGIN
        IF PlantNeedUnTouched(Estimate) THEN BEGIN
          IF CONFIRM(Text001,TRUE,Estimate.TABLECAPTION,Estimate."No.",PlantNeed.TABLECAPTION,Estimate."Plant Location") THEN
            Action := Action::Replace
          ELSE BEGIN
            MESSAGE(Text002);
            EXIT;
          END;
        END ELSE
          ERROR(Text003,Estimate.TABLECAPTION,Estimate."No.",PlantNeed.TABLECAPTION,Estimate."Plant Location");
      END ELSE
         Action := Action::Add;

      Window.OPEN(Text005 +Text006 + Text007);
      //Fill TempBuffer
      TmpPlantNeed.DELETEALL;
      TmpPlantNeedEstKey.DELETEALL;
      LastLineNoTmpPlantNeed := 0;
      FillPlantNeedFromEstLns(Estimate,LastLineNoTmpPlantNeed);
      FillPlantNeedFromRcpLns(Estimate,LastLineNoTmpPlantNeed);

      IF (Estimate."Plant Company" <> '') AND (Estimate."Plant Company" <> COMPANYNAME) THEN
        PlantNeed.CHANGECOMPANY(Estimate."Plant Company");

      //Delete existing Plant Need belonging to this Estimate
      IF Action = Action::Replace THEN BEGIN
        PlantNeed.SETCURRENTKEY(PlantNeed."Transf. from Estimate");
        PlantNeed.SETRANGE("Transf. from Estimate",Estimate."No.");
        PlantNeed.DELETEALL;
      END;

      //Write TempBuffer to Plant Need
      PlantNeed.RESET;
      PlantNeed.SETRANGE(PlantNeed.Location,Estimate."Plant Location");
      IF TmpPlantNeed.FINDSET THEN BEGIN
        MaxCounter := TmpPlantNeed.COUNT;
        ResetCounters;
        IF PlantNeed.FINDLAST THEN
          LineNo := PlantNeed."Line No."
        ELSE
          LineNo := 0;
        REPEAT
          Counter := Counter + 1;
          UpdateWindow(5);
          LineNo := LineNo + 10000;
          PlantNeed.COPY(TmpPlantNeed);
          PlantNeed."Line No." := LineNo;
          PlantNeed.CheckDepartmentCodeFilled(Estimate."Plant Company");
          PlantNeed.FillDefaultFromDepot;
          PlantNeed.INSERT;
          TmpPlantNeedEstKey.GET(TmpPlantNeed.Location, FORMAT(TmpPlantNeed."Line No."), '', '', '', '');
          UpdatePlantNeedLineNoInEst(
            TmpPlantNeedEstKey.Code1, TmpPlantNeedEstKey.Code2, TmpPlantNeedEstKey.Code3, TmpPlantNeedEstKey.Code4,
            TmpPlantNeedEstKey.Int1, TmpPlantNeedEstKey.Code5, TmpPlantNeedEstKey.Code6, TmpPlantNeedEstKey.Int2,
            TmpPlantNeedEstKey.Bool1, PlantNeed.Location, PlantNeed."Line No.", '');
        UNTIL TmpPlantNeed.NEXT = 0;
      END;
      Window.CLOSE;
    END;

    LOCAL PROCEDURE PlantNeedUnTouched@1100525017(Estimate@1100525000 : Record 11012151) : Boolean;
    VAR
      PlantNeed@1100525001 : Record 11012579;
      PlantOrderLine@1100529000 : Record 11012557;
      PlantRequestLine@1100529001 : Record 11020521;
    BEGIN
      IF (Estimate."Plant Company" <> '') AND (Estimate."Plant Company" <> COMPANYNAME) THEN BEGIN
        PlantNeed.CHANGECOMPANY(Estimate."Plant Company");
        PlantOrderLine.CHANGECOMPANY(Estimate."Plant Company");
        PlantRequestLine.CHANGECOMPANY(Estimate."Plant Company");
      END;
      PlantNeed.SETCURRENTKEY(PlantNeed."Transf. from Estimate");
      PlantNeed.SETRANGE("Transf. from Estimate",Estimate."No.");
      PlantNeed.SETRANGE(Location,Estimate."Plant Location");
      PlantNeed.SETFILTER("Line No.", '<>%1', 0);
      IF PlantNeed.FINDSET THEN BEGIN
        PlantOrderLine.SETCURRENTKEY("Location Copied Need", "Line No. Copied Need");
        PlantRequestLine.SETCURRENTKEY("Location Copied Need", "Line No. Copied Need");
        REPEAT
          PlantOrderLine.SETRANGE("Location Copied Need", PlantNeed.Location);
          PlantOrderLine.SETRANGE("Line No. Copied Need", PlantNeed."Line No.");
          IF NOT PlantOrderLine.ISEMPTY THEN
            EXIT(FALSE);
          PlantRequestLine.SETRANGE("Location Copied Need", PlantNeed.Location);
          PlantRequestLine.SETRANGE("Line No. Copied Need", PlantNeed."Line No.");
          IF NOT PlantRequestLine.ISEMPTY THEN
            EXIT(FALSE);
        UNTIL PlantNeed.NEXT = 0;
      END;
      EXIT(TRUE);
    END;

    PROCEDURE FillPlantNeedFromEstLns@1100525018(Estimate@1100525001 : Record 11012151;VAR LastLineNoTmpPlantNeed@1100525002 : Integer);
    VAR
      Line@1100525000 : Record 11072072;
    BEGIN
      IF NOT Line.SETCURRENTKEY("Estimate No.","Plant Type") THEN
        Line.SETCURRENTKEY("Estimate No.");
      Line.SETRANGE("Estimate No.",Estimate."No.");
      Line.SETFILTER("Plant Type",'<>%1','');
      IF Line.FINDSET THEN BEGIN
        MaxCounter := Line.COUNT;
        ResetCounters;
        REPEAT
          Counter := Counter + 1;
          UpdateWindow(3);
          TmpPlantNeed.INIT;
          TmpPlantNeed.Location := Estimate."Plant Location";
          TmpPlantNeed."Transf. from Estimate" := Estimate."No.";
          LastLineNoTmpPlantNeed := LastLineNoTmpPlantNeed + 10000;
          TmpPlantNeed."Line No." := LastLineNoTmpPlantNeed;
          TmpPlantNeed.Type := TmpPlantNeed.Type::Plant;
          TmpPlantNeed."Plant Type" := Line."Plant Type";
          TmpPlantNeed."Starting Date" := Line."Start Rental Period";
          TmpPlantNeed."Ending Date" := Line."End Rental Period";
          TmpPlantNeed.Quantity := Line."Part Quantity" * Line.Quantity;
          TmpPlantNeed."Quantity To Copy" := TmpPlantNeed.Quantity;
          TmpPlantNeed.INSERT;
          TmpPlantNeedEstKey."Key Code1" := TmpPlantNeed.Location;
          TmpPlantNeedEstKey."Key Code2" := FORMAT(TmpPlantNeed."Line No.");
          TmpPlantNeedEstKey.Code1 := Line."Estimate No.";
          TmpPlantNeedEstKey.Code2 := Line."Sub-Estimate No.";
          TmpPlantNeedEstKey.Code3 := Line."Part Group";
          TmpPlantNeedEstKey.Code4 :=  Line.Part;
          TmpPlantNeedEstKey.Int1 := Line."Line No.";
          TmpPlantNeedEstKey.Bool1 := FALSE;  //Level: Estimate Line
          TmpPlantNeedEstKey.INSERT;
        UNTIL Line.NEXT = 0;
      END;
    END;

    PROCEDURE FillPlantNeedFromRcpLns@1100525021(Estimate@1100525001 : Record 11012151;VAR LastLineNoTmpPlantNeed@1100525002 : Integer);
    VAR
      Line@1100525000 : Record 11072075;
    BEGIN
      IF NOT Line.SETCURRENTKEY("Estimate No.","Plant Type") THEN
        Line.SETCURRENTKEY("Estimate No.");
      Line.SETRANGE("Estimate No.",Estimate."No.");
      Line.SETFILTER("Plant Type",'<>%1','');
      IF Line.FINDSET THEN BEGIN
        MaxCounter := Line.COUNT;
        ResetCounters;
        REPEAT
          Counter := Counter + 1;
          UpdateWindow(4);
          TmpPlantNeed.INIT;
          TmpPlantNeed.Location := Estimate."Plant Location";
          TmpPlantNeed."Transf. from Estimate" := Estimate."No.";
          LastLineNoTmpPlantNeed := LastLineNoTmpPlantNeed + 10000;
          TmpPlantNeed."Line No." := LastLineNoTmpPlantNeed;
          TmpPlantNeed.Type := TmpPlantNeed.Type::Plant;
          TmpPlantNeed."Plant Type" := Line."Plant Type";
          TmpPlantNeed."Starting Date" := Line."Start Rental Period";
          TmpPlantNeed."Ending Date" := Line."End Rental Period";
          Line.CALCFIELDS("Estimate Quantity",Line."Estimate Part Quantity");
          TmpPlantNeed.Quantity := Line."Estimate Part Quantity" * Line."Estimate Quantity" * Line.Quantity;
          TmpPlantNeed."Quantity To Copy" := TmpPlantNeed.Quantity;
          TmpPlantNeed.INSERT;
          TmpPlantNeedEstKey."Key Code1" := TmpPlantNeed.Location;
          TmpPlantNeedEstKey."Key Code2" := FORMAT(TmpPlantNeed."Line No.");
          TmpPlantNeedEstKey.Code1 := Line."Estimate No.";
          TmpPlantNeedEstKey.Code2 := Line."Sub-Estimate No.";
          TmpPlantNeedEstKey.Code3 := Line."Part Group";
          TmpPlantNeedEstKey.Code4 :=  Line.Part;
          TmpPlantNeedEstKey.Code5 := Line."Recipe Group";
          TmpPlantNeedEstKey.Code6 :=  Line.Recipe;
          TmpPlantNeedEstKey.Int1 := Line."Estimate Line";
          TmpPlantNeedEstKey.Int2 := Line."Line No.";
          TmpPlantNeedEstKey.Bool1 := TRUE;  //Level: Estimate Recipe Line
          TmpPlantNeedEstKey.INSERT;
        UNTIL Line.NEXT = 0;
      END
    END;

    PROCEDURE CopySelectionToPlantNeed@1100529000(VAR TmpLine@1100529001 : TEMPORARY Record 11012174;PlantNeedLocation@1100529004 : Code[20];EstimateCompany@1100529005 : Text);
    VAR
      PlantNeed@1100529000 : Record 11012579;
      NextLineNo@1100529002 : Integer;
      PlantNeedLineFound@1100529007 : Boolean;
    BEGIN
      IF TmpLine.FINDSET THEN BEGIN
        PlantNeed.SETRANGE(Location, PlantNeedLocation);
        IF PlantNeed.FINDLAST THEN
          NextLineNo := PlantNeed."Line No." + 10000
        ELSE
          NextLineNo := 10000;
        REPEAT
          PlantNeedLineFound := FALSE;
          IF (TmpLine."Plant Need Location" = PlantNeedLocation) AND (TmpLine."Plant Need Line No." <> 0) THEN
            PlantNeedLineFound := PlantNeed.GET(PlantNeedLocation, TmpLine."Plant Need Line No.");
          IF NOT PlantNeedLineFound THEN BEGIN
            PlantNeed.INIT;
            PlantNeed.VALIDATE(Location, PlantNeedLocation);
            PlantNeed."Line No." := NextLineNo;
            PlantNeed.INSERT(TRUE);
            NextLineNo := NextLineNo + 10000;
          END;
          //In estimate/recipe lines never plant type and item no. both can/may be filled, so one est/rcp line results in one plant need line (1:1)
          IF TmpLine."Plant Type" <> '' THEN BEGIN
            PlantNeed.VALIDATE(Type, PlantNeed.Type::Plant);
            PlantNeed.VALIDATE("Plant Type", TmpLine."Plant Type");
            PlantNeed.VALIDATE(Quantity, TmpLine.Quantity);
          END ELSE BEGIN
            PlantNeed.VALIDATE(Type, PlantNeed.Type::Item);
            PlantNeed.VALIDATE("Item No.", TmpLine."Item No.");  // Item must be present in plant and estimate company
            PlantNeed.VALIDATE(Quantity, EstQtyToPlantNeedItemQty(TmpLine.Quantity, TmpLine."Unit of Measure", TmpLine."Item No.", '', TRUE));
          END;
          PlantNeed.CalculateQuantityToCopy(PlantNeed, FALSE, '');
          PlantNeed."Starting Date" := TmpLine."Start Rental Period";
          PlantNeed."Ending Date" := TmpLine."End Rental Period";
          PlantNeed."Transf. from Estimate" := TmpLine."Estimate No.";
          PlantNeed.MODIFY(TRUE);
          UpdatePlantNeedLineNoInEst(
            TmpLine."Estimate No.", TmpLine."Sub-Estimate No.", TmpLine."Part Group", TmpLine.Part,
            TmpLine."Estimate Line No.", TmpLine."Recipe Group", TmpLine.Recipe, TmpLine."Recipe Line No.",
            (TmpLine."Recipe Line No."<>0), PlantNeed.Location, PlantNeed."Line No.", EstimateCompany);
          TmpLine.DELETE;
        UNTIL TmpLine.NEXT = 0;

      END;
    END;

    LOCAL PROCEDURE UpdatePlantNeedLineNoInEst@1100529005(EstimateNo@1100529000 : Code[20];SubEstimate@1100529001 : Code[20];PartGroup@1100529002 : Code[10];Part@1100529003 : Code[20];EstimateLineNo@1100529004 : Integer;RecipeGroup@1100529005 : Code[10];Recipe@1100529006 : Code[20];RecipeLineNo@1100529007 : Integer;RecipeLevel@1100529009 : Boolean;PlantNeedLocation@1100529012 : Code[20];PlantNeedLineNo@1100529013 : Integer;EstimateCompany@1100529008 : Text);
    VAR
      EstimateLine@1100529011 : Record 11072072;
      EstRecipeLine@1100529010 : Record 11072075;
    BEGIN
      IF NOT RecipeLevel THEN BEGIN
        IF (EstimateCompany <> '') AND (EstimateCompany <> COMPANYNAME) THEN
          EstimateLine.CHANGECOMPANY(EstimateCompany);
        EstimateLine.GET(EstimateNo, SubEstimate, PartGroup, Part, EstimateLineNo);
        EstimateLine."Plant Need Location" := PlantNeedLocation;
        EstimateLine."Plant Need Line No." := PlantNeedLineNo;
        EstimateLine.MODIFY(FALSE);
      END ELSE BEGIN
        IF (EstimateCompany <> '') AND (EstimateCompany <> COMPANYNAME) THEN
          EstRecipeLine.CHANGECOMPANY(EstimateCompany);
        EstRecipeLine.GET(EstimateNo, SubEstimate, PartGroup, Part, EstimateLineNo, RecipeGroup, Recipe, RecipeLineNo);
        EstRecipeLine."Plant Need Location" := PlantNeedLocation;
        EstRecipeLine."Plant Need Line No." := PlantNeedLineNo;
        EstRecipeLine.MODIFY(FALSE);
      END;
    END;

    PROCEDURE EstQtyToPlantNeedItemQty@1100529003(EstQty@1100529000 : Decimal;EstUnit@1100529001 : Code[10];ItemNo@1100529005 : Code[20];PlantCompany@1100529002 : Text;ErrorMode@1100529008 : Boolean) RetQty : Decimal;
    VAR
      Item@1100529003 : Record 27;
      ItemUnitOfMeasure@1100529004 : Record 5404;
      QtyPerUnit1@1100529006 : Decimal;
      QtyPerUnit2@1100529007 : Decimal;
    BEGIN
      RetQty := EstQty;
      IF (EstQty = 0) OR (EstUnit = '')  OR (ItemNo = '') THEN
        EXIT;
      IF PlantCompany = '' THEN
        PlantCompany := COMPANYNAME;
      IF PlantCompany <> COMPANYNAME THEN BEGIN
        Item.CHANGECOMPANY(PlantCompany);
        ItemUnitOfMeasure.CHANGECOMPANY(PlantCompany);
      END;
      QtyPerUnit1 := 0;
      QtyPerUnit2 := 0;
      IF Item.GET(ItemNo) THEN BEGIN
        IF EstUnit = Item."Sales Unit of Measure" THEN
          EXIT;
        IF EstUnit = Item."Base Unit of Measure" THEN
          QtyPerUnit1 := 1
        ELSE BEGIN
          IF ItemUnitOfMeasure.GET(ItemNo, EstUnit) THEN
            QtyPerUnit1 := ItemUnitOfMeasure."Qty. per Unit of Measure";
        END;
        IF Item."Sales Unit of Measure" = Item."Base Unit of Measure" THEN
          QtyPerUnit2 := 1
        ELSE BEGIN
          IF ItemUnitOfMeasure.GET(ItemNo, Item."Sales Unit of Measure") THEN
            QtyPerUnit2 := ItemUnitOfMeasure."Qty. per Unit of Measure";
        END;
      END;
      IF ErrorMode AND ((QtyPerUnit1 <= 0) OR (QtyPerUnit2 <= 0)) THEN BEGIN
        ERROR(Text001, ItemUnitOfMeasure.TABLECAPTION,
           EstUnit, Item."Sales Unit of Measure", ItemUnitOfMeasure.FIELDCAPTION("Item No."), ItemNo, PlantCompany);
      END;
      IF (QtyPerUnit1 > 0) AND (QtyPerUnit2 > 0) THEN
        RetQty := ROUND(EstQty * QtyPerUnit1 / QtyPerUnit2, 0.00001);
    END;

    PROCEDURE CalcNonIdxTotals@1100525019(EstimateNo@1100525000 : Code[20]);
    VAR
      EstPart@1100525001 : Record 11072073;
      EstLine@1100525002 : Record 11072072;
      Window@1100525003 : Dialog;
    BEGIN
      CASE STRMENU(Text012) OF
        1:
          EstLine.SETRANGE("Estimate No.",EstimateNo);
        2:
          BEGIN
            EstPart.RESET;
            EstPart.SETRANGE("Estimate No.",EstimateNo);
            IF PAGE.RUNMODAL(0,EstPart) = ACTION::LookupOK THEN
              EstPart.GetEstLineFilterFromEstPart(EstLine)
            ELSE
              EXIT;
           END;
        ELSE
          EXIT;
      END;

      Window.OPEN(Text010);
      EstLine.CalcNonIndexedTotals;
      Window.CLOSE;
      MESSAGE(
        Text011 + Text008 + Text009,
        EstLine.GETFILTERS,
        ROUND(EstLine.GetTotalWeight),
        ROUND(EstLine.GetTotalBuyBack));
    END;

    PROCEDURE ResetCounters@1100485027();
    BEGIN
      Counter := 0;
      WindowLastUpdated := TIME;
    END;

    PROCEDURE UpdateWindow@1100485028(IndicatorNo@1100525000 : Integer);
    BEGIN
      IF (Counter = MaxCounter) OR (TIME - WindowLastUpdated > 300) THEN BEGIN
        Window.UPDATE(IndicatorNo,ROUND(Counter / MaxCounter * 10000,1));
        WindowLastUpdated := TIME;
      END;
    END;

    PROCEDURE EstFieldIsEditable@1100528915(FieldNo2@1100525000 : Integer;Rec@1100525001 : Record 11072072) : Boolean;
    BEGIN
      EstLine := Rec;

      WITH EstLine DO BEGIN
        IF NOT ChkEstSurChgEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkEstRecipeEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkEstSetEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkEstItemEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkEstPlantTpEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkEstConnectEdit(FieldNo2) THEN
          EXIT(FALSE);

        CASE FieldNo2 OF
          FIELDNO("Surcharge %"): EXIT("Surcharge Type" <> "Surcharge Type"::" ");
          FIELDNO(Norm):
            EXIT(
              (Recipe = '') AND ("Sub Operation Code" = '') AND
              ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));
          FIELDNO("Wage Component"):
            EXIT(
              (Recipe = '') AND
              ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));  //DP00236
        END;

        EXIT(TRUE);
      END;
    END;

    PROCEDURE EstRcpFieldIsEditable@1100528914(FieldNo2@1100525000 : Integer;Rec@1100525001 : Record 11072075) : Boolean;
    BEGIN
      EstRcpLine := Rec;

      WITH EstRcpLine DO BEGIN
        IF NOT ChkRcpSurChgEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpRecipeEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpSetEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpItemEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpPlantTpEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpConnectEdit(FieldNo2) THEN
          EXIT(FALSE);

        CASE FieldNo2 OF
          FIELDNO("Surcharge %"): EXIT("Surcharge Type" <> "Surcharge Type"::" ");
          FIELDNO("Rate Code"): EXIT("Cost Type (Hours)"="Cost Type (Hours)"::Labor);  //DP01047;
          FIELDNO(Norm), FIELDNO("Norm (Sales)"):
            EXIT(
              ("Cost Type (Hours)"="Cost Type (Hours)"::Subcontracting) OR  //DP01676
              ("Cost Type (Hours)"="Cost Type (Hours)"::Plant) OR  //DP01047
              ("Recipe Header" = FALSE) AND  //db, 28-03-14: C013896
              ("Sub Operation Code" = '') AND
              ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));
          FIELDNO("Wage Component"):
            EXIT(
              ("Recipe Header" = FALSE) AND  //db, 28-03-14: C013896
              ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));  //DP00236
        END;

        EXIT(TRUE);
      END;
    END;

    PROCEDURE BaseRcpFieldIsEditable@1100528916(FieldNo2@1100525000 : Integer;Rec@1100525001 : Record 11020582) : Boolean;
    BEGIN
      //DP00381
      BaseRcpLine := Rec;
      EstRcpLine.TRANSFERFIELDS(BaseRcpLine);
      EstRcpLine."Recipe Header" := (BaseRcpLine."Recipe (Child)"<>''); //db, 28-03-14: C013896 (for ChkRcpRecipeEdit)

      WITH BaseRcpLine DO BEGIN
        IF NOT ChkRcpSurChgEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpRecipeEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpSetEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpItemEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpPlantTpEdit(FieldNo2) THEN
          EXIT(FALSE);

        IF NOT ChkRcpConnectEdit(FieldNo2) THEN
          EXIT(FALSE);

        CASE FieldNo2 OF
          FIELDNO("Surcharge %"): EXIT("Surcharge Type" <> "Surcharge Type"::" ");
          FIELDNO("Rate Code"): EXIT("Cost Type (Hours)"="Cost Type (Hours)"::Labor);  //DP01047;
          FIELDNO(Norm):
            EXIT(
              ("Cost Type (Hours)"="Cost Type (Hours)"::Subcontracting) OR  //DP01676
              ("Cost Type (Hours)"="Cost Type (Hours)"::Plant) OR  //DP01047
              ("Recipe Header" = FALSE) AND  //db, 28-03-14: C013896
              ("Sub Operation Code" = '') AND
              ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));
          FIELDNO("Wage Component"):
            EXIT(
              ("Recipe Header" = FALSE) AND  //db, 28-03-14: C013896
              ("Surcharge Type" = "Surcharge Type"::" ") AND ("Rate Code" <> ''));  //DP00236
        END;

        EXIT(TRUE);
      END;
    END;

    PROCEDURE SalesRcpFieldIsEditable@1100525037(FieldNo2@1100525000 : Integer;Rec@1100525001 : Record 11229789) : Boolean;
    VAR
      BaseRcpLine2@1100525002 : Record 11020582;
    BEGIN
      //DP00481
      BaseRcpLine2.TRANSFERFIELDS(Rec);

      EXIT(BaseRcpFieldIsEditable(FieldNo2,BaseRcpLine2));
    END;

    PROCEDURE ChkEstSurChgEdit@1100528913(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstLine DO BEGIN
        EXIT(
          ("Surcharge Type" = "Surcharge Type"::" ") OR
          (FieldNo2 IN [
            FIELDNO("Surcharge Type"),
            FIELDNO("Surcharge %"),
            FIELDNO("Rate Code"),
            FIELDNO(Code) ]));
      END;
    END;

    PROCEDURE ChkRcpSurChgEdit@1100528912(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstRcpLine DO BEGIN
        EXIT(
          ("Surcharge Type" = "Surcharge Type"::" ") OR
          (FieldNo2 IN [
            FIELDNO("Surcharge Type"),
            FIELDNO("Surcharge %"),
            FIELDNO("Rate Code"),
            FIELDNO(Code) ]));
      END;
    END;

    PROCEDURE ChkEstRecipeEdit@1100528911(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstLine DO BEGIN
        EXIT(
          (Recipe = '') OR
          (FieldNo2 IN [
            FIELDNO(Recipe),
            FIELDNO("Surcharge %"),
            FIELDNO("Time Quantity"),
            FIELDNO("Unit of Time"),
            FIELDNO("Recipe Group") ]));
      END;
    END;

    PROCEDURE ChkRcpRecipeEdit@1100528910(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstRcpLine DO BEGIN
        IF "Estimate No." <> '' THEN BEGIN
          EXIT(
            ("Recipe Header" = FALSE) OR
            (FieldNo2 IN [
              FIELDNO("Recipe (Child)"),
              FIELDNO("Surcharge %"),
              FIELDNO("Time Quantity"),
              FIELDNO("Unit of Time"),
              FIELDNO("Recipe Group (Child)") ]));
        END ELSE BEGIN
          EXIT(
            ("Recipe (Child)" = '') OR
            (FieldNo2 IN [
              FIELDNO("Recipe (Child)"),
              FIELDNO("Surcharge %"),
              FIELDNO("Time Quantity"),
              FIELDNO("Unit of Time"),
              FIELDNO("Recipe Group (Child)") ]));
        END;
      END;
    END;

    PROCEDURE ChkEstSetEdit@1100528909(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstLine DO BEGIN
        EXIT(
          ("Set Code" = '') OR
          NOT (FieldNo2 IN [
            FIELDNO(Recipe),
            FIELDNO("Plant Type"),
            FIELDNO("Surcharge %"),
            FIELDNO("Item No."),
            FIELDNO(Manufacturer),
            FIELDNO("Basic Item"),
            FIELDNO("Vendor (Trade Item)"),
            FIELDNO("Trade Item") ]));
      END;
    END;

    PROCEDURE ChkRcpSetEdit@1100528908(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstRcpLine DO BEGIN
        EXIT(
          ("Set Code" = '') OR
          NOT (FieldNo2 IN [
            FIELDNO("Recipe (Child)"),
            FIELDNO("Plant Type"),
            FIELDNO("Surcharge %"),
            FIELDNO("Item No."),
            FIELDNO(Manufacturer),
            FIELDNO("Basic Item"),
            FIELDNO("Vendor (Trade Item)"),
            FIELDNO("Trade Item") ]));
      END;
    END;

    PROCEDURE ChkEstItemEdit@1100528907(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstLine DO BEGIN
        EXIT(
          ("Item No." + "Basic Item" + "Trade Item" = '') OR
          NOT (FieldNo2 IN [
            FIELDNO(Recipe),
            FIELDNO("Set Code"),
            FIELDNO("Surcharge Type"),
            FIELDNO("Plant Type") ]));
      END;
    END;

    PROCEDURE ChkRcpItemEdit@1100528906(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstRcpLine DO BEGIN
        EXIT(
          ("Item No." + "Basic Item" + "Trade Item" = '') OR
          NOT (FieldNo2 IN [
            FIELDNO("Recipe (Child)"),
            FIELDNO("Set Code"),
            FIELDNO("Surcharge Type"),
            FIELDNO("Plant Type") ]));
      END;
    END;

    PROCEDURE ChkEstPlantTpEdit@1100528905(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstLine DO BEGIN
        EXIT(
          ("Plant Type" = '') OR
          NOT (FieldNo2 IN [
            FIELDNO(Recipe),
            FIELDNO("Set Code"),
            FIELDNO("Surcharge %"),
            FIELDNO("Item No."),
            FIELDNO(Manufacturer),
            FIELDNO("Basic Item"),
            FIELDNO("Vendor (Trade Item)"),
            FIELDNO("Trade Item") ]));
      END;
    END;

    PROCEDURE ChkRcpPlantTpEdit@1100528904(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstRcpLine DO BEGIN
        EXIT(
          ("Plant Type" = '') OR
          NOT (FieldNo2 IN [
            FIELDNO("Recipe (Child)"),
            FIELDNO("Set Code"),
            FIELDNO("Surcharge %"),
            FIELDNO("Item No."),
            FIELDNO(Manufacturer),
            FIELDNO("Basic Item"),
            FIELDNO("Vendor (Trade Item)"),
            FIELDNO("Trade Item") ]));
      END;
    END;

    PROCEDURE ChkEstConnectEdit@1100528903(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstLine DO BEGIN
        EXIT(
          ("Attached to Line No." = 0) OR
          NOT (FieldNo2 IN [
            FIELDNO("Start Rental Period"),
            FIELDNO("End Rental Period"),
            FIELDNO("Rental Period Formula"),
            FIELDNO("Rental Time Units") ]));
      END;
    END;

    PROCEDURE ChkRcpConnectEdit@1100528900(FieldNo2@1100525000 : Integer) : Boolean;
    BEGIN
      WITH EstRcpLine DO BEGIN
        EXIT(
          ("Attached to Line No." = 0) OR
          NOT (FieldNo2 IN [
            FIELDNO("Start Rental Period"),
            FIELDNO("End Rental Period"),
            FIELDNO("Rental Period Formula"),
            FIELDNO("Rental Time Units") ]));
      END;
    END;

    PROCEDURE GetDefaultPlantCompany@1100529400(SourceTable@1100529400 : Integer;EstimateNo@1100529401 : Code[20]) : Text[50];
    BEGIN
      //DP01208 (db, 27-10-16)
      PlantCompany := '';
      CASE SourceTable OF
        DATABASE::"Base Recipe":
          BEGIN
            //DP01407.sn
            EstimateSetup.GET;
            PlantCompany := EstimateSetup."Plant Company";
            //DP01407.en
          END;
        DATABASE::Estimate:
          BEGIN
            Estimate.GET(EstimateNo);
            PlantCompany := Estimate."Plant Company";
          END;
      END;
      EXIT(PlantCompany);
    END;

    PROCEDURE SkipQuestion@1100528500();
    BEGIN
      IgnoreQuestion := TRUE;  //C051896
    END;

    BEGIN
    END.
  }
}

